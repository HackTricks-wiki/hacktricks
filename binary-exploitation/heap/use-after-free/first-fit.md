# ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ã‚£ãƒƒãƒˆ

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹**

</details>

## **ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ã‚£ãƒƒãƒˆ**

glibcã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã™ã‚‹ã¨ã€ç•°ãªã‚‹ "bins" ãŒãƒ¡ãƒ¢ãƒªãƒãƒ£ãƒ³ã‚¯ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã¯ã€2ã¤ã®ä¸€èˆ¬çš„ãªã‚·ãƒŠãƒªã‚ªã€unsorted bins ã¨ fastbins ã®ç°¡ç•¥åŒ–ã•ã‚ŒãŸèª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚

### Unsorted Bins

é«˜é€Ÿãƒãƒ£ãƒ³ã‚¯ã§ãªã„ãƒ¡ãƒ¢ãƒªãƒãƒ£ãƒ³ã‚¯ã‚’è§£æ”¾ã™ã‚‹ã¨ã€ãã‚Œã¯unsorted bin ã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã®bin ã¯ã€æ–°ã—ãè§£æ”¾ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ãŒå‰æ–¹ï¼ˆ"head"ï¼‰ã«è¿½åŠ ã•ã‚Œã‚‹ãƒªã‚¹ãƒˆã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚æ–°ã—ã„ãƒ¡ãƒ¢ãƒªãƒãƒ£ãƒ³ã‚¯ã‚’è¦æ±‚ã™ã‚‹ã¨ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã¯unsorted bin ã‚’å¾Œæ–¹ï¼ˆ"tail"ï¼‰ã‹ã‚‰è¦‹ã¦ã€å¿…è¦ãªã‚µã‚¤ã‚ºã®ãƒãƒ£ãƒ³ã‚¯ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚unsorted bin ã®ãƒãƒ£ãƒ³ã‚¯ãŒå¿…è¦ãªã‚‚ã®ã‚ˆã‚Šã‚‚å¤§ãã„å ´åˆã€åˆ†å‰²ã•ã‚Œã€å‰åŠéƒ¨åˆ†ãŒè¿”ã•ã‚Œã€æ®‹ã‚Šã®éƒ¨åˆ†ãŒbin ã«æ®‹ã‚Šã¾ã™ã€‚

ä¾‹:

* 300ãƒã‚¤ãƒˆ (`a`) ã‚’å‰²ã‚Šå½“ã¦ã€æ¬¡ã«250ãƒã‚¤ãƒˆ (`b`) ã‚’å‰²ã‚Šå½“ã¦ã€`a` ã‚’è§£æ”¾ã—ã¦ã‹ã‚‰å†åº¦250ãƒã‚¤ãƒˆ (`c`) ã‚’è¦æ±‚ã—ã¾ã™ã€‚
* `a` ã‚’è§£æ”¾ã™ã‚‹ã¨ã€unsorted bin ã«ç§»å‹•ã—ã¾ã™ã€‚
* ãã®å¾Œ250ãƒã‚¤ãƒˆã‚’å†åº¦è¦æ±‚ã™ã‚‹ã¨ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã¯tail ã«ã‚ã‚‹ `a` ã‚’è¦‹ã¤ã‘ã¦åˆ†å‰²ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«åˆã†éƒ¨åˆ†ã‚’è¿”ã—ã€æ®‹ã‚Šã‚’bin ã«ä¿æŒã—ã¾ã™ã€‚
* `c` ã¯ä»¥å‰ã® `a` ã‚’æŒ‡ã—ç¤ºã—ã€`a` ã®å†…å®¹ã§åŸ‹ã‚ã‚‰ã‚Œã¾ã™ã€‚
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbinsã¯å°ã•ãªãƒ¡ãƒ¢ãƒªãƒãƒ£ãƒ³ã‚¯ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚Unsorted binsã¨ã¯ç•°ãªã‚Šã€fastbinsã¯æ–°ã—ã„ãƒãƒ£ãƒ³ã‚¯ã‚’å…ˆé ­ã«è¿½åŠ ã—ã€Last-In-First-Outï¼ˆLIFOï¼‰ã®å‹•ä½œã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ¡ãƒ¢ãƒªã®å°ã•ãªãƒãƒ£ãƒ³ã‚¯ã‚’è¦æ±‚ã™ã‚‹ã¨ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã¯fastbinã®å…ˆé ­ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚

ä¾‹ï¼š

- 20ãƒã‚¤ãƒˆãšã¤4ã¤ã®ãƒãƒ£ãƒ³ã‚¯ï¼ˆ`a`ã€`b`ã€`c`ã€`d`ï¼‰ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
- ä»»æ„ã®é †åºã§ãã‚Œã‚‰ã‚’è§£æ”¾ã™ã‚‹ã¨ã€è§£æ”¾ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ã¯fastbinã®å…ˆé ­ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
- ãã®å¾Œã€20ãƒã‚¤ãƒˆã®ãƒãƒ£ãƒ³ã‚¯ã‚’è¦æ±‚ã™ã‚‹ã¨ã€ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã¯fastbinã®å…ˆé ­ã‹ã‚‰æœ€è¿‘è§£æ”¾ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ã‚’è¿”ã—ã¾ã™ã€‚
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## ãã®ä»–ã®å‚è€ƒæ–‡çŒ®ã¨ä¾‹

* [https://heap-exploitation.dhavalkapil.com/attacks/first\_fit](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64ã€‚Use after free: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’è§£æ”¾ã—ã€è§£æ”¾ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ã‚’å–å¾—ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€ãã‚Œã«æ›¸ãè¾¼ã¿ã‚’è¨±å¯ã—ã€**ä»¥å‰ã®ã‚‚ã®ã‹ã‚‰user->passwordã®ä½ç½®ã‚’ä¸Šæ›¸ã**ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å†åˆ©ç”¨ã—ã¦ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹**ã—ã¾ã™ã€‚
