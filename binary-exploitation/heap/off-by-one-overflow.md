# Off by one overflow

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆ**ã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## åŸºæœ¬æƒ…å ±

1ãƒã‚¤ãƒˆã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯å‰ã®ã‚µã‚¤ã‚ºã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æƒ…å ±ã‚’å¤‰æ›´ã—ã€å®Ÿéš›ã«è§£æ”¾ã•ã‚Œã‚‹ãƒãƒ£ãƒ³ã‚¯ã‚’æ”¹ã–ã‚“ã™ã‚‹ã“ã¨ãŒã§ãã€æœ€çµ‚çš„ã«ã¯åˆ¥ã®åˆæ³•çš„ãªãƒãƒ£ãƒ³ã‚¯ã‚’å«ã‚€ãƒãƒ£ãƒ³ã‚¯ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰ä¾‹ï¼š

* [https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c](https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c)
* ã“ã®æ”»æ’ƒã¯Tcachesã®ä½¿ç”¨ã«ã‚ˆã‚Šã‚‚ã¯ã‚„æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚
* ã•ã‚‰ã«ã€ã‚ˆã‚Šå¤§ããªãƒãƒ£ãƒ³ã‚¯ã‚’ä½¿ç”¨ã—ã¦æ‚ªç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ï¼š`malloc(): invalid next size (unsorted)`

### ã‚´ãƒ¼ãƒ«

* ãƒãƒ£ãƒ³ã‚¯ã‚’åˆ¥ã®ãƒãƒ£ãƒ³ã‚¯ã®ä¸­ã«å«ã¾ã›ã€ãã®2ç•ªç›®ã®ãƒãƒ£ãƒ³ã‚¯ã«å¯¾ã™ã‚‹æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã€å«ã¾ã‚Œã‚‹ãƒãƒ£ãƒ³ã‚¯ã‚’ä¸Šæ›¸ãã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

### å¿…è¦æ¡ä»¶

* å‰ã®ã‚µã‚¤ã‚ºã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã®1ãƒã‚¤ãƒˆã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼

### æ”»æ’ƒ

* 3ã¤ã®ãƒ¡ãƒ¢ãƒªãƒãƒ£ãƒ³ã‚¯ï¼ˆaã€bã€cï¼‰ãŒé †ç•ªã«äºˆç´„ã•ã‚Œã¾ã™ã€‚ãã®å¾Œã€ä¸­é–“ã®ãƒãƒ£ãƒ³ã‚¯ãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚æœ€åˆã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯1ãƒã‚¤ãƒˆã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼è„†å¼±æ€§ãŒã‚ã‚Šã€æ”»æ’ƒè€…ã¯ãã‚Œã‚’æ‚ªç”¨ã—ã¦0x00ã‚’æŒ¿å…¥ã—ã¾ã™ï¼ˆå‰ã®ãƒã‚¤ãƒˆãŒ0x10ã§ã‚ã‚Œã°ã€ä¸­é–“ã®ãƒãƒ£ãƒ³ã‚¯ãŒå®Ÿéš›ã‚ˆã‚Š0x10å°ã•ã„ã“ã¨ã‚’ç¤ºã—ã¾ã™ï¼‰ã€‚
* æ¬¡ã«ã€ä¸­é–“ã®è§£æ”¾ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ï¼ˆbï¼‰ã«2ã¤ã®ã‚ˆã‚Šå°ã•ãªãƒãƒ£ãƒ³ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ãŒã€`b + b->size`ã¯cãƒãƒ£ãƒ³ã‚¯ã‚’æ›´æ–°ã—ãªã„ãŸã‚ã€æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé©åˆ‡ãªã‚µã‚¤ã‚ºã‚ˆã‚Šã‚‚å°ã•ã„ãŸã‚ã§ã™ã€‚
* æ¬¡ã«ã€b1ã¨cãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚`c - c->prev_size`ã¯ã¾ã bï¼ˆä»Šã¯b1ï¼‰ã‚’æŒ‡ã—ã¦ã„ã‚‹ãŸã‚ã€ä¸¡æ–¹ãŒ1ã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«çµ±åˆã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€b2ã¯ã¾ã b1ã¨cã®é–“ã«ã‚ã‚Šã¾ã™ã€‚
* æœ€å¾Œã«ã€æ–°ã—ã„mallocãŒå®Ÿè¡Œã•ã‚Œã€ã“ã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’å†å–å¾—ã—ã€å®Ÿéš›ã«b2ã‚’å«ã‚€ã“ã¨ã«ãªã‚Šã€æ–°ã—ã„mallocã®æ‰€æœ‰è€…ãŒb2ã®å†…å®¹ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ç”»åƒã¯æ”»æ’ƒã‚’å®Œç’§ã«èª¬æ˜ã—ã¦ã„ã¾ã™ï¼š

<figure><img src="../../.gitbook/assets/image (1247).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks">https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks</a></p></figcaption></figure>

## å‚è€ƒæ–‡çŒ®

* [https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks](https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks)

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆ**ã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
