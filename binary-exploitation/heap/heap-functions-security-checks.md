# Verificaci칩n de Seguridad de Funciones del Heap

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## unlink

Esta funci칩n elimina un fragmento de una lista doblemente enlazada. Las verificaciones comunes aseguran que la estructura de la lista enlazada permanezca consistente al desvincular fragmentos.

* **Verificaciones de Consistencia**:
* Verificar si `P->fd->bk == P` y `P->bk->fd == P`.
* Mensaje de error: `corrupted double-linked list`

## \_int\_malloc

Esta funci칩n es responsable de asignar memoria desde el heap. Las verificaciones aqu칤 aseguran que la memoria no se corrompa durante la asignaci칩n.

* **Verificaci칩n de Tama침o de Fastbin**:
* Al eliminar un fragmento de un fastbin, aseg칰rate de que el tama침o del fragmento est칠 dentro del rango de fastbin.
* Mensaje de error: `malloc(): memory corruption (fast)`
* **Verificaci칩n de Consistencia de Smallbin**:
* Al eliminar un fragmento de un smallbin, aseg칰rate de que los enlaces previo y siguiente en la lista doblemente enlazada sean consistentes.
* Mensaje de error: `malloc(): smallbin double linked list corrupted`
* **Verificaci칩n de Rango de Memoria de Unsorted Bin**:
* Asegurar que el tama침o de los fragmentos en el unsorted bin est칠 dentro de los l칤mites m칤nimo y m치ximo.
* Mensaje de error: `malloc(): memory corruption`
* **Verificaci칩n de Consistencia de Unsorted Bin (Primer Escenario)**:
* Al insertar un fragmento restante en el unsorted bin, verificar si `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensaje de error: `malloc(): corrupted unsorted chunks`
* **Verificaci칩n de Consistencia de Unsorted Bin (Segundo Escenario)**:
* Igual que la verificaci칩n anterior, pero se activa al insertar despu칠s de dividir un fragmento r치pido o peque침o.
* Mensaje de error: `malloc(): corrupted unsorted chunks 2`

## \_int\_free

Esta funci칩n libera la memoria asignada previamente. Las verificaciones aqu칤 ayudan a garantizar una correcta liberaci칩n de memoria y prevenir la corrupci칩n de la misma.

* **Verificaci칩n de L칤mites del Puntero**:
* Asegurar que el puntero que se est치 liberando no est칠 envolviendo la memoria.
* Mensaje de error: `free(): invalid pointer`
* **Verificaci칩n de Tama침o**:
* Asegurar que el tama침o del fragmento que se est치 liberando sea al menos `MINSIZE` o un m칰ltiplo de `MALLOC_ALIGNMENT`.
* Mensaje de error: `free(): invalid size`
* **Verificaci칩n de Tama침o de Fastbin**:
* Para fragmentos de fastbin, asegurar que el tama침o del siguiente fragmento est칠 dentro de los l칤mites m칤nimo y m치ximo.
* Mensaje de error: `free(): invalid next size (fast)`
* **Verificaci칩n de Doble Liberaci칩n de Fastbin**:
* Al insertar un fragmento en un fastbin, asegurar que el fragmento en la cabeza no sea el mismo que el que se est치 insertando.
* Mensaje de error: `double free or corruption (fasttop)`
* **Verificaci칩n de Consistencia de Fastbin**:
* Al insertar en un fastbin, asegurar que los tama침os del fragmento en la cabeza y el fragmento que se est치 insertando sean iguales.
* Mensaje de error: `invalid fastbin entry (free)`
* **Verificaci칩n de Consistencia de Top Chunk**:
* Para fragmentos que no son de fastbin, asegurar que el fragmento no sea el mismo que el top chunk.
* Mensaje de error: `double free or corruption (top)`
* **Verificaci칩n de L칤mites de Memoria**:
* Asegurar que el siguiente fragmento por memoria est칠 dentro de los l칤mites del 치rea.
* Mensaje de error: `double free or corruption (out)`
* **Verificaci칩n de Bit Prev_inuse**:
* Asegurar que el bit prev_inuse en el siguiente fragmento est칠 marcado.
* Mensaje de error: `double free or corruption (!prev)`
* **Verificaci칩n de Tama침o Normal**:
* Asegurar que el tama침o del siguiente fragmento est칠 dentro de rangos v치lidos.
* Mensaje de error: `free(): invalid next size (normal)`
* **Verificaci칩n de Consistencia de Unsorted Bin**:
* Al insertar un fragmento fusionado en el unsorted bin, verificar si `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensaje de error: `free(): corrupted unsorted chunks`

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
