<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# Hojas de trucos de forense

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/#)

# Servicios en lÃ­nea

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)

# Herramientas de detecciÃ³n y antivirus sin conexiÃ³n

## Yara

### Instalar
```bash
sudo apt-get install -y yara
```
### Preparar reglas

Utilice este script para descargar y fusionar todas las reglas de malware yara desde Github: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
Cree el directorio _**rules**_ y ejecÃºtelo. Esto crearÃ¡ un archivo llamado _**malware\_rules.yar**_ que contiene todas las reglas yara para malware.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
### Escaneo
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
### YaraGen: Verificar malware y crear reglas

Puedes utilizar la herramienta [**YaraGen**](https://github.com/Neo23x0/yarGen) para generar reglas yara a partir de un binario. Revisa estos tutoriales: [**Parte 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Parte 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Parte 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
 python3 yarGen.py --update
 python3.exe yarGen.py --excludegood -m  ../../mals/
```
## ClamAV

### InstalaciÃ³n
```
sudo apt-get install -y clamav
```
### Escaneo
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
## IOCs

IOC significa Indicador de Compromiso. Un IOC es un conjunto de **condiciones que identifican** algÃºn software potencialmente no deseado o **malware** confirmado. Los equipos de seguridad (Blue Teams) utilizan este tipo de definiciÃ³n para **buscar este tipo de archivos maliciosos** en sus **sistemas** y **redes**.\
Compartir estas definiciones es muy Ãºtil, ya que cuando se identifica malware en un equipo y se crea un IOC para ese malware, otros equipos de seguridad pueden utilizarlo para identificar el malware mÃ¡s rÃ¡pidamente.

Una herramienta para crear o modificar IOCs es [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
Puedes utilizar herramientas como [**Redline**](https://www.fireeye.com/services/freeware/redline.html) para **buscar IOCs definidos en un dispositivo**.

## Loki

[**Loki**](https://github.com/Neo23x0/Loki) es un escÃ¡ner de Indicadores Simples de Compromiso.\
La detecciÃ³n se basa en cuatro mÃ©todos de detecciÃ³n:
```
1. File Name IOC
   Regex match on full file path/name

2. Yara Rule Check
   Yara signature matches on file data and process memory

3. Hash Check
   Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files
   
4. C2 Back Connect Check
   Compares process connection endpoints with C2 IOCs (new since version v.10)
```
## Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) es un escÃ¡ner de malware para Linux lanzado bajo la licencia GNU GPLv2, que estÃ¡ diseÃ±ado en torno a las amenazas que se enfrentan en entornos de alojamiento compartido. Utiliza datos de amenazas de sistemas de detecciÃ³n de intrusiones en el borde de la red para extraer malware que se estÃ¡ utilizando activamente en ataques y genera firmas para la detecciÃ³n. AdemÃ¡s, los datos de amenazas tambiÃ©n se derivan de las presentaciones de los usuarios con la funciÃ³n de pago de LMD y los recursos de la comunidad de malware.

## rkhunter

Herramientas como [**rkhunter**](http://rkhunter.sourceforge.net) se pueden utilizar para comprobar el sistema de archivos en busca de posibles **rootkits** y malware.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
## PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) verifica algunas cosas bÃ¡sicas dentro del ejecutable (datos binarios, entropÃ­a, URLs e IPs, algunas reglas yara).

## NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) es un script de Python que utiliza una variedad de **mÃ©todos estadÃ­sticos** para detectar contenido **ofuscado** y **encriptado** dentro de archivos de texto / script. El propÃ³sito previsto de NeoPI es ayudar en la **detecciÃ³n de cÃ³digo de shell web oculto**.

## **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) hace todo lo posible para detectar cÃ³digo **ofuscado**/**sospechoso** y archivos que utilizan funciones **PHP** a menudo utilizadas en **malwares**/shell web.

## Firmas binarias de Apple

Al verificar alguna muestra de **malware**, siempre debe **verificar la firma** del binario, ya que el **desarrollador** que lo firmÃ³ puede estar **relacionado** con **malware**.
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
# TÃ©cnicas de DetecciÃ³n

## Apilamiento de Archivos

Si sabes que una carpeta que contiene los **archivos** de un servidor web fue **actualizada por Ãºltima vez en alguna fecha**. **Verifica** la **fecha** en que todos los **archivos** del **servidor web fueron creados y modificados** y si alguna fecha es **sospechosa**, verifica ese archivo.

## Baselines

Si los archivos de una carpeta **no deberÃ­an haber sido modificados**, puedes calcular el **hash** de los **archivos originales** de la carpeta y **compararlos** con los **actuales**. Cualquier cosa modificada serÃ¡ **sospechosa**.

## AnÃ¡lisis EstadÃ­stico

Cuando la informaciÃ³n se guarda en registros, puedes **verificar estadÃ­sticas como cuÃ¡ntas veces se accediÃ³ a cada archivo de un servidor web, ya que una shell web podrÃ­a ser una de las mÃ¡s**.
