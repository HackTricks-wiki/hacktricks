# Pcapæ¤œæŸ»

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/)ã¯ã€**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚æŠ€è¡“çš„ãªçŸ¥è­˜ã‚’ä¿ƒé€²ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã€ã“ã®ä¼šè­°ã¯ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®æŠ€è¡“ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å°‚é–€å®¶ã®ãŸã‚ã®æ´»æ°—ã‚ã‚‹äº¤æµã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

{% hint style="info" %}
**PCAP** vs **PCAPNG**ã«ã¤ã„ã¦ã®æ³¨æ„äº‹é …ï¼šPCAPãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«ã¯2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚**PCAPNGã¯æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ã‚Šã€ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“**ã€‚ä»–ã®ãƒ„ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€Wiresharkãªã©ã®äº’æ›æ€§ã®ã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€PCAPNGãƒ•ã‚¡ã‚¤ãƒ«ã‚’PCAPã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

## PCAPã®ãŸã‚ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«

* ã‚‚ã—PCAPã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒ**å£Šã‚Œã¦ã„ã‚‹**å ´åˆã¯ã€[http://f00l.de/hacking/**pcapfix.php**](http://f00l.de/hacking/pcapfix.php)ã‚’ä½¿ç”¨ã—ã¦**ä¿®æ­£**ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
* [**PacketTotal**](https://packettotal.com)ã§PCAPå†…ã®**æƒ…å ±**ã‚’æŠ½å‡ºã—ã€**ãƒãƒ«ã‚¦ã‚§ã‚¢**ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
* [**www.virustotal.com**](https://www.virustotal.com)ã¨[**www.hybrid-analysis.com**](https://www.hybrid-analysis.com)ã‚’ä½¿ç”¨ã—ã¦ã€**æ‚ªæ„ã®ã‚ã‚‹æ´»å‹•**ã‚’æ¤œç´¢ã—ã¾ã™ã€‚

## æƒ…å ±ã®æŠ½å‡º

ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã¯ã€çµ±è¨ˆæƒ…å ±ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’æŠ½å‡ºã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

### Wireshark

{% hint style="info" %}
**PCAPã‚’åˆ†æã™ã‚‹å ´åˆã€åŸºæœ¬çš„ã«ã¯Wiresharkã®ä½¿ç”¨æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**
{% endhint %}

Wiresharkã®ãƒˆãƒªãƒƒã‚¯ã¯æ¬¡ã®å ´æ‰€ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="wireshark-tricks.md" %}
[wireshark-tricks.md](wireshark-tricks.md)
{% endcontent-ref %}

### Xplico Framework

[**Xplico** ](https://github.com/xplico/xplico)_(Linuxã®ã¿)_ã¯ã€**pcap**ã‚’åˆ†æã—ã€æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€pcapãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Xplicoã¯ã€å„ãƒ¡ãƒ¼ãƒ«ï¼ˆPOPã€IMAPã€SMTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ã€ã™ã¹ã¦ã®HTTPã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€å„VoIPé€šè©±ï¼ˆSIPï¼‰ã€FTPã€TFTPãªã©ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
sudo bash -c 'echo "deb http://repo.xplico.org/ $(lsb_release -s -c) main" /etc/apt/sources.list'
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 791C25CE
sudo apt-get update
sudo apt-get install xplico
```
**å®Ÿè¡Œ**
```
/etc/init.d/apache2 restart
/etc/init.d/xplico start
```
_**127.0.0.1:9876**_ã®è³‡æ ¼æƒ…å ±ã¯ _**xplico:xplico**_ ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

æ¬¡ã«ã€**æ–°ã—ã„ã‚±ãƒ¼ã‚¹**ã‚’ä½œæˆã—ã€ã‚±ãƒ¼ã‚¹å†…ã«**æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã‚’ä½œæˆã—ã€**pcap**ãƒ•ã‚¡ã‚¤ãƒ«ã‚’**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã¦ãã ã•ã„ã€‚

### NetworkMiner

Xplicoã¨åŒæ§˜ã«ã€pcapã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’**åˆ†æãŠã‚ˆã³æŠ½å‡º**ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚[**ã“ã¡ã‚‰**](https://www.netresec.com/?page=NetworkMiner)ã‹ã‚‰ç„¡æ–™ç‰ˆã‚’**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã§ãã¾ã™ã€‚**Windows**ã§å‹•ä½œã—ã¾ã™ã€‚\
ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ‘ã‚±ãƒƒãƒˆã‹ã‚‰**ä»–ã®æƒ…å ±ã‚’åˆ†æ**ã—ã¦ã€**ã‚ˆã‚Šè¿…é€Ÿã«**ä½•ãŒèµ·ã“ã£ã¦ã„ãŸã®ã‹ã‚’çŸ¥ã‚‹ãŸã‚ã«ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚

### NetWitness Investigator

[**ã“ã¡ã‚‰**](https://www.rsa.com/en-us/contact-us/netwitness-investigator-freeware)ã‹ã‚‰**NetWitness Investigator**ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼ˆ**Windows**ã§å‹•ä½œã—ã¾ã™ï¼‰ã€‚\
ã“ã‚Œã¯ã€ãƒ‘ã‚±ãƒƒãƒˆã‚’**åˆ†æ**ã—ã€æƒ…å ±ã‚’æœ‰ç”¨ãªæ–¹æ³•ã§**æ•´ç†**ã—ã¦ã€å†…éƒ¨ã§ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚’**æŠŠæ¡**ã™ã‚‹ã®ã«å½¹ç«‹ã¤åˆ¥ã®ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

![](<../../../.gitbook/assets/image (567) (1).png>)

### [BruteShark](https://github.com/odedshimon/BruteShark)

* ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æŠ½å‡ºã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆHTTPã€FTPã€Telnetã€IMAPã€SMTP...ï¼‰
* èªè¨¼ãƒãƒƒã‚·ãƒ¥ã®æŠ½å‡ºã¨Hashcatã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ãƒƒã‚¯ï¼ˆKerberosã€NTLMã€CRAM-MD5ã€HTTP-Digest...ï¼‰
* ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã®ä½œæˆï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
* DNSã‚¯ã‚¨ãƒªã®æŠ½å‡º
* ã™ã¹ã¦ã®TCPãŠã‚ˆã³UDPã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å†æ§‹ç¯‰
* ãƒ•ã‚¡ã‚¤ãƒ«ã®æŠ½å‡º

### Capinfos
```
capinfos capture.pcap
```
### Ngrep

ã‚‚ã— pcap å†…ã§ä½•ã‹ã‚’æ¢ã—ã¦ã„ã‚‹å ´åˆã¯ã€**ngrep** ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ã€ä¸»ãªãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨ã—ãŸä¾‹ã§ã™:
```bash
ngrep -I packets.pcap "^GET" "port 80 and tcp and host 192.168 and dst host 192.168 and src host 192.168"
```
### ã‚«ãƒ¼ãƒ“ãƒ³ã‚°

ä¸€èˆ¬çš„ãªã‚«ãƒ¼ãƒ“ãƒ³ã‚°æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€pcapã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚„æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

{% content-ref url="../partitions-file-systems-carving/file-data-carving-recovery-tools.md" %}
[file-data-carving-recovery-tools.md](../partitions-file-systems-carving/file-data-carving-recovery-tools.md)
{% endcontent-ref %}

### è³‡æ ¼æƒ…å ±ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

[https://github.com/lgandx/PCredz](https://github.com/lgandx/PCredz)ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€pcapã¾ãŸã¯ãƒ©ã‚¤ãƒ–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰è³‡æ ¼æƒ…å ±ã‚’è§£æã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/)ã¯ã€**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚**æŠ€è¡“çš„ãªçŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½**ã¨ã—ã¦ã€ã“ã®ä¼šè­°ã¯ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®æŠ€è¡“ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å°‚é–€å®¶ã®ç†±ã„äº¤æµã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

## Exploits/Malwareã®ãƒã‚§ãƒƒã‚¯

### Suricata

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
```
apt-get install suricata
apt-get install oinkmaster
echo "url = http://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz" >> /etc/oinkmaster.conf
oinkmaster -C /etc/oinkmaster.conf -o /etc/suricata/rules
```
**pcapã®ç¢ºèª**

To analyze network traffic, you can use a packet capture (pcap) file. This file contains recorded network packets that can be inspected to gather information about network communications. The pcap file can be obtained from various sources, such as network monitoring tools or packet sniffers.

To check a pcap file, you can use tools like Wireshark or tcpdump. These tools allow you to open the pcap file and view the captured packets. You can analyze the packet headers, payload, and other relevant information.

When inspecting a pcap file, you should look for any suspicious or abnormal network activity. This can include unusual traffic patterns, unexpected connections, or any signs of malicious activity. By carefully examining the packets, you can identify potential security issues or vulnerabilities in the network.

It is important to note that analyzing pcap files requires some level of expertise in network protocols and packet analysis. It is recommended to have a good understanding of networking concepts and security principles before diving into pcap inspection.

Overall, checking pcap files is an essential part of forensic analysis and can provide valuable insights into network behavior and potential security threats.
```
suricata -r packets.pcap -c /etc/suricata/suricata.yaml -k none -v -l log
```
### YaraPcap

[**YaraPCAP**](https://github.com/kevthehermit/YaraPcap)ã¯ã€æ¬¡ã®æ©Ÿèƒ½ã‚’æŒã¤ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

- PCAPãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€HTTPã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
- åœ§ç¸®ã•ã‚ŒãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’gzipã§è§£å‡ã—ã¾ã™ã€‚
- å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Yaraã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚
- report.txtã‚’ä½œæˆã—ã¾ã™ã€‚
- å¿…è¦ã«å¿œã˜ã¦ä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã¾ã™ã€‚

### ãƒãƒ«ã‚¦ã‚§ã‚¢è§£æ

æ—¢çŸ¥ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã®ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

{% content-ref url="../malware-analysis.md" %}
[malware-analysis.md](../malware-analysis.md)
{% endcontent-ref %}

## Zeek

> Zeekã¯ã€ãƒ‘ãƒƒã‚·ãƒ–ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã§ã™ã€‚å¤šãã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€Zeekã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‹ã‚¿ãƒ¼ï¼ˆNSMï¼‰ã¨ã—ã¦ä½¿ç”¨ã—ã€ä¸å¯©ã¾ãŸã¯æ‚ªæ„ã®ã‚ã‚‹æ´»å‹•ã®èª¿æŸ»ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚Zeekã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¶…ãˆãŸã•ã¾ã–ã¾ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†æã‚¿ã‚¹ã‚¯ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã‚„ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

åŸºæœ¬çš„ã«ã€`zeek`ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹ãƒ­ã‚°ã¯**pcap**ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€pcapã«é–¢ã™ã‚‹**æƒ…å ±**ã‚’è§£æã™ã‚‹ãŸã‚ã«ã¯ã€**ä»–ã®ãƒ„ãƒ¼ãƒ«**ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### æ¥ç¶šæƒ…å ±
```bash
#Get info about longest connections (add "grep udp" to see only udp traffic)
#The longest connection might be of malware (constant reverse shell?)
cat conn.log | zeek-cut id.orig_h id.orig_p id.resp_h id.resp_p proto service duration | sort -nrk 7 | head -n 10

10.55.100.100   49778   65.52.108.225   443     tcp     -       86222.365445
10.55.100.107   56099   111.221.29.113  443     tcp     -       86220.126151
10.55.100.110   60168   40.77.229.82    443     tcp     -       86160.119664


#Improve the metrics by summing up the total duration time for connections that have the same destination IP and Port.
cat conn.log | zeek-cut id.orig_h id.resp_h id.resp_p proto duration | awk 'BEGIN{ FS="\t" } { arr[$1 FS $2 FS $3 FS $4] += $5 } END{ for (key in arr) printf "%s%s%s\n", key, FS, arr[key] }' | sort -nrk 5 | head -n 10

10.55.100.100   65.52.108.225   443     tcp     86222.4
10.55.100.107   111.221.29.113  443     tcp     86220.1
10.55.100.110   40.77.229.82    443     tcp     86160.1

#Get the number of connections summed up per each line
cat conn.log | zeek-cut id.orig_h id.resp_h duration | awk 'BEGIN{ FS="\t" } { arr[$1 FS $2] += $3; count[$1 FS $2] += 1 } END{ for (key in arr) printf "%s%s%s%s%s\n", key, FS, count[key], FS, arr[key] }' | sort -nrk 4 | head -n 10

10.55.100.100   65.52.108.225   1       86222.4
10.55.100.107   111.221.29.113  1       86220.1
10.55.100.110   40.77.229.82    134       86160.1

#Check if any IP is connecting to 1.1.1.1
cat conn.log | zeek-cut id.orig_h id.resp_h id.resp_p proto service | grep '1.1.1.1' | sort | uniq -c

#Get number of connections per source IP, dest IP and dest Port
cat conn.log | zeek-cut id.orig_h id.resp_h id.resp_p proto | awk 'BEGIN{ FS="\t" } { arr[$1 FS $2 FS $3 FS $4] += 1 } END{ for (key in arr) printf "%s%s%s\n", key, FS, arr[key] }' | sort -nrk 5 | head -n 10


# RITA
#Something similar can be done with the tool rita
rita show-long-connections -H --limit 10 zeek_logs

+---------------+----------------+--------------------------+----------------+
|   SOURCE IP   | DESTINATION IP | DSTPORT:PROTOCOL:SERVICE |    DURATION    |
+---------------+----------------+--------------------------+----------------+
| 10.55.100.100 | 65.52.108.225  | 443:tcp:-                | 23h57m2.3655s  |
| 10.55.100.107 | 111.221.29.113 | 443:tcp:-                | 23h57m0.1262s  |
| 10.55.100.110 | 40.77.229.82   | 443:tcp:-                | 23h56m0.1197s  |

#Get connections info from rita
rita show-beacons zeek_logs | head -n 10
Score,Source IP,Destination IP,Connections,Avg Bytes,Intvl Range,Size Range,Top Intvl,Top Size,Top Intvl Count,Top Size Count,Intvl Skew,Size Skew,Intvl Dispersion,Size Dispersion
1,192.168.88.2,165.227.88.15,108858,197,860,182,1,89,53341,108319,0,0,0,0
1,10.55.100.111,165.227.216.194,20054,92,29,52,1,52,7774,20053,0,0,0,0
0.838,10.55.200.10,205.251.194.64,210,69,29398,4,300,70,109,205,0,0,0,0
```
### DNSæƒ…å ±

DNSï¼ˆDomain Name Systemï¼‰ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¯¾å¿œé–¢ä¿‚ã‚’ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚DNSæƒ…å ±ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ä¸­ã«å«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ‘ã‚±ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆPCAPï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿æŸ»ã™ã‚‹ã“ã¨ã§å–å¾—ã§ãã¾ã™ã€‚

PCAPãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿æŸ»ã™ã‚‹éš›ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã†ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚

1. PCAPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¾ã™ã€‚
2. DNSãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç‰¹å®šã—ã¾ã™ã€‚
3. DNSã‚¯ã‚¨ãƒªã¨DNSãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åˆ†æã—ã¾ã™ã€‚
4. ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨é–¢é€£ã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç‰¹å®šã—ã¾ã™ã€‚

DNSæƒ…å ±ã®åˆ†æã«ã‚ˆã‚Šã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§è¡Œã‚ã‚ŒãŸé€šä¿¡ã®è©³ç´°ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä¸æ­£ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡Œã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
#Get info about each DNS request performed
cat dns.log | zeek-cut -c id.orig_h query qtype_name answers

#Get the number of times each domain was requested and get the top 10
cat dns.log | zeek-cut query | sort | uniq | rev | cut -d '.' -f 1-2 | rev | sort | uniq -c | sort -nr | head -n 10

#Get all the IPs
cat dns.log | zeek-cut id.orig_h query | grep 'example\.com' | cut -f 1 | sort | uniq -c

#Sort the most common DNS record request (should be A)
cat dns.log | zeek-cut qtype_name | sort | uniq -c | sort -nr

#See top DNS domain requested with rita
rita show-exploded-dns -H --limit 10 zeek_logs
```
## ãã®ä»–ã®pcapåˆ†æã®ãƒˆãƒªãƒƒã‚¯

{% content-ref url="dnscat-exfiltration.md" %}
[dnscat-exfiltration.md](dnscat-exfiltration.md)
{% endcontent-ref %}

{% content-ref url="wifi-pcap-analysis.md" %}
[wifi-pcap-analysis.md](wifi-pcap-analysis.md)
{% endcontent-ref %}

{% content-ref url="usb-keystrokes.md" %}
[usb-keystrokes.md](usb-keystrokes.md)
{% endcontent-ref %}

â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/)ã¯ã€**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚**æŠ€è¡“çš„ãªçŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½**ã¨ã—ã¦ã€ã“ã®ä¼šè­°ã¯ã€ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®æŠ€è¡“ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å°‚é–€å®¶ã®ãŸã‚ã®æ´»æ°—ã‚ã‚‹äº¤æµã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** HackTricksã§**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡º**ã—ã¦ãã ã•ã„ã€‚

</details>
