# BloodHound & ä»–ã®AD Enumãƒ„ãƒ¼ãƒ«

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ã¦ã¿ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã™
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã™
* **[ğŸ’¬](https://emojipedia.org/speech-balloon/) Discordã‚°ãƒ«ãƒ¼ãƒ—**ã«**å‚åŠ **ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## AD Explorer

[AD Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer) ã¯Sysinternal Suiteã‹ã‚‰ï¼š

> é«˜åº¦ãªActive Directoryï¼ˆADï¼‰ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãŠã‚ˆã³ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã€‚AD Explorerã‚’ä½¿ç”¨ã—ã¦ã€ADãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç°¡å˜ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã€ãŠæ°—ã«å…¥ã‚Šã®å ´æ‰€ã‚’å®šç¾©ã—ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’é–‹ã‹ãšã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨å±æ€§ã‚’è¡¨ç¤ºã—ã€ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ç·¨é›†ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¹ã‚­ãƒ¼ãƒã‚’è¡¨ç¤ºã—ã€ä¿å­˜ãŠã‚ˆã³å†å®Ÿè¡Œã§ãã‚‹è¤‡é›‘ãªæ¤œç´¢ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

AD Explorerã¯ADã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã§ãã‚‹ãŸã‚ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ç¢ºèªã§ãã¾ã™ã€‚\
ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§è„†å¼±æ€§ã‚’ç™ºè¦‹ã—ãŸã‚Šã€ADãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç•°ãªã‚‹çŠ¶æ…‹ã‚’æ¯”è¼ƒã—ãŸã‚Šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

ADã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚‹ã«ã¯ã€æ¥ç¶šã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãŠã‚ˆã³æ–¹å‘ãŒå¿…è¦ã§ã™ã€‚

ADã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚‹ã«ã¯ã€`File` --> `Create Snapshot`ã«ç§»å‹•ã—ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®åå‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

## ADRecon

[**ADRecon**](https://github.com/adrecon/ADRecon) ã¯ã€ADç’°å¢ƒã‹ã‚‰ã•ã¾ã–ã¾ãªã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’æŠ½å‡ºã—ã¦çµ„ã¿åˆã‚ã›ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æƒ…å ±ã¯ã€**ç‰¹åˆ¥ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸ**Microsoft Excel **ãƒ¬ãƒãƒ¼ãƒˆ**ã«è¡¨ç¤ºã•ã‚Œã€åˆ†æã‚’å®¹æ˜“ã«ã—ã€å¯¾è±¡ã®ADç’°å¢ƒã®ç¾åœ¨ã®çŠ¶æ…‹ã®åŒ…æ‹¬çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä»˜ãã®ã‚µãƒãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
```bash
# Run it
.\ADRecon.ps1
```
## BloodHound

From [https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound)

> BloodHoundã¯ã€[Linkurious](http://linkurio.us/)ã‚’ãƒ™ãƒ¼ã‚¹ã«æ§‹ç¯‰ã•ã‚ŒãŸã€[Electron](http://electron.atom.io/)ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸã€C#ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«ã‚ˆã£ã¦ä¾›çµ¦ã•ã‚Œã‚‹Neo4jãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã€ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã®Javascript Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

BloodHoundã¯ã€ã‚°ãƒ©ãƒ•ç†è«–ã‚’ä½¿ç”¨ã—ã¦ã€Active Directoryã‚„Azureç’°å¢ƒå†…ã®éš ã‚ŒãŸé–¢ä¿‚ã‚„æ„å›³ã—ãªã„é–¢ä¿‚ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯BloodHoundã‚’ä½¿ç”¨ã—ã¦ã€é€šå¸¸ç´ æ—©ãç‰¹å®šã™ã‚‹ã“ã¨ãŒä¸å¯èƒ½ã§ã‚ã‚‹é«˜åº¦ã«è¤‡é›‘ãªæ”»æ’ƒçµŒè·¯ã‚’ç°¡å˜ã«ç‰¹å®šã§ãã¾ã™ã€‚é˜²å¾¡è€…ã¯BloodHoundã‚’ä½¿ç”¨ã—ã¦ã€åŒã˜æ”»æ’ƒçµŒè·¯ã‚’ç‰¹å®šã—æ’é™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚é’ãƒãƒ¼ãƒ ã¨èµ¤ãƒãƒ¼ãƒ ã®ä¸¡æ–¹ãŒã€Active Directoryã‚„Azureç’°å¢ƒå†…ã®ç‰¹æ¨©é–¢ä¿‚ã‚’ã‚ˆã‚Šæ·±ãç†è§£ã™ã‚‹ãŸã‚ã«BloodHoundã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€[Bloodhound](https://github.com/BloodHoundAD/BloodHound)ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è‡ªå‹•çš„ã«åˆ—æŒ™ã—ã€ã™ã¹ã¦ã®æƒ…å ±ã‚’ä¿å­˜ã—ã€ç‰¹æ¨©æ˜‡æ ¼çµŒè·¯ã‚’è¦‹ã¤ã‘ã€ã‚°ãƒ©ãƒ•ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®æƒ…å ±ã‚’è¡¨ç¤ºã§ãã‚‹ç´ æ™´ã‚‰ã—ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Bloodhoundã¯ã€**ã‚¤ãƒ³ã‚¸ã‚§ã‚¹ã‚¿**ã¨**å¯è¦–åŒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã®2ã¤ã®ä¸»è¦ãªéƒ¨åˆ†ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

**ã‚¤ãƒ³ã‚¸ã‚§ã‚¹ã‚¿**ã¯ã€**ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ—æŒ™ã—ã€ã™ã¹ã¦ã®æƒ…å ±ã‚’æŠ½å‡º**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

**å¯è¦–åŒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯neo4jã‚’ä½¿ç”¨**ã—ã¦ã€æƒ…å ±ãŒã©ã®ã‚ˆã†ã«é–¢é€£ã—ã¦ã„ã‚‹ã‹ã‚’ç¤ºã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã§ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã•ã¾ã–ã¾ãªæ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
BloodHound CEã®ä½œæˆå¾Œã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ãŒDockerã‚’ä½¿ç”¨ã—ãŸåˆ©ä¾¿æ€§ã®ãŸã‚ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚å§‹ã‚ã‚‹æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã¯ã€äº‹å‰ã«æ§‹æˆã•ã‚ŒãŸDocker Composeæ§‹æˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

1. Docker Composeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã‚Œã¯[Docker Desktop](https://www.docker.com/products/docker-desktop/)ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å«ã¾ã‚Œã‚‹ã¯ãšã§ã™ã€‚
2. å®Ÿè¡Œ:
```
curl -L https://ghst.ly/getbhce | docker compose -f - up
```
3. Docker Composeã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‡ºåŠ›ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚
4. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã€http://localhost:8080/ui/login ã«ç§»å‹•ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’adminã€ãƒ­ã‚°ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

ãã®å¾Œã€ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒæº–å‚™ã•ã‚Œã€ãã“ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¸ã‚§ã‚¹ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

### SharpHound

ã„ãã¤ã‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å‚åŠ ã—ã¦ã„ã‚‹PCã‹ã‚‰SharpHoundã‚’å®Ÿè¡Œã—ã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®æƒ…å ±ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™:
```
./SharpHound.exe --CollectionMethods All
Invoke-BloodHound -CollectionMethod All
```
> **CollectionMethod** ã«ã¤ã„ã¦è©³ã—ãã¯ã€[ã“ã¡ã‚‰](https://support.bloodhoundenterprise.io/hc/en-us/articles/17481375424795-All-SharpHound-Community-Edition-Flags-Explained) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ç•°ãªã‚‹è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ SharpHound ã‚’å®Ÿè¡Œã—ãŸã„å ´åˆã¯ã€CMD netonly ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€ãã“ã‹ã‚‰ SharpHound ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚
```
runas /netonly /user:domain\user "powershell.exe -exec bypass"
```
[**Bloodhoundã«ã¤ã„ã¦è©³ã—ãã¯ired.teamã‚’ã”è¦§ãã ã•ã„ã€‚**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux)


## Group3r

[**Group3r**](https://github.com/Group3r/Group3r)ã¯ã€Active Directoryã«é–¢é€£ã™ã‚‹**ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼**ã®**è„†å¼±æ€§**ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\
**ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ãƒ›ã‚¹ãƒˆ**ã‹ã‚‰**ä»»æ„ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶**ã‚’ä½¿ç”¨ã—ã¦**group3rã‚’å®Ÿè¡Œã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```bash
group3r.exe -f <filepath-name.log>
# -s sends results to stdin
# -f send results to file
```
## PingCastle

[**PingCastle**](https://www.pingcastle.com/documentation/) **ã¯ADç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¹ãƒˆã‚’è©•ä¾¡**ã—ã€ã‚°ãƒ©ãƒ•ä»˜ãã®**ãƒ¬ãƒãƒ¼ãƒˆ**ã‚’æä¾›ã—ã¾ã™ã€‚

å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ãƒã‚¤ãƒŠãƒª`PingCastle.exe`ã‚’å®Ÿè¡Œã—ã€**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã‚’é–‹å§‹ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯**`healthcheck`**ã§ã€ã“ã‚Œã«ã‚ˆã‚Š**ãƒ‰ãƒ¡ã‚¤ãƒ³**ã®åŸºæœ¬çš„ãª**æ¦‚è¦**ãŒç¢ºç«‹ã•ã‚Œã€**è¨­å®šãƒŸã‚¹**ã‚„**è„†å¼±æ€§**ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚&#x20;
