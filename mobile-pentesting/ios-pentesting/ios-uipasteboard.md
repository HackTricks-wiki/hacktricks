<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


O [`UIPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard) permite compartilhar dados dentro de um aplicativo e de um aplicativo para outros aplicativos. Existem dois tipos de pasteboards:

* **pasteboard geral do sistema**: para compartilhar dados com **qualquer aplicativo**. Persistente por padrÃ£o em reinicializaÃ§Ãµes de dispositivos e desinstalaÃ§Ãµes de aplicativos (desde o iOS 10).
* **pasteboards personalizados / nomeados**: para compartilhar dados **com outro aplicativo** (que possui o mesmo ID de equipe do aplicativo a ser compartilhado) ou com o **prÃ³prio aplicativo** (eles estÃ£o disponÃ­veis apenas no processo que os cria). NÃ£o persistentes por padrÃ£o (desde o iOS 10), ou seja, eles existem apenas atÃ© que o aplicativo proprietÃ¡rio (criador) seja encerrado.

Algumas consideraÃ§Ãµes de seguranÃ§a:

* Os usuÃ¡rios **nÃ£o podem conceder ou negar permissÃ£o** para que os aplicativos leiam o **pasteboard**.
* Desde o iOS 9, os aplicativos [nÃ£o podem acessar o pasteboard enquanto estÃ£o em segundo plano](https://forums.developer.apple.com/thread/13760), o que mitiga a monitoraÃ§Ã£o do pasteboard em segundo plano.
* [A Apple adverte sobre pasteboards nomeados persistentes](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc) e **desencoraja seu uso**. Em vez disso, devem ser usados contÃªineres compartilhados.
* A partir do iOS 10, hÃ¡ um novo recurso Handoff chamado **Universal Clipboard** que Ã© ativado por padrÃ£o. Ele permite que o **conteÃºdo do pasteboard geral seja transferido automaticamente entre dispositivos**. Este recurso pode ser desativado se o desenvolvedor optar por fazÃª-lo e tambÃ©m Ã© possÃ­vel definir uma data e hora de expiraÃ§Ã£o para os dados copiados.

Portanto, Ã© importante **verificar se informaÃ§Ãµes confidenciais nÃ£o estÃ£o sendo salvas no pasteboard global**.\
TambÃ©m Ã© importante verificar se um **aplicativo nÃ£o estÃ¡ usando os dados do pasteboard global para executar aÃ§Ãµes**, pois um aplicativo malicioso pode adulterar esses dados.

Um **aplicativo tambÃ©m pode impedir que seus usuÃ¡rios copiem dados confidenciais para a Ã¡rea de transferÃªncia** (o que Ã© recomendado).

## AnÃ¡lise estÃ¡tica

O **pasteboard geral do sistema** pode ser obtido usando [`generalPasteboard`](https://developer.apple.com/documentation/uikit/uipasteboard/1622106-generalpasteboard?language=objc), pesquise o cÃ³digo-fonte ou o binÃ¡rio compilado para este mÃ©todo. O uso do pasteboard geral do sistema deve ser evitado ao lidar com dados confidenciais.

**Pasteboards personalizados** podem ser criados com [`pasteboardWithName:create:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622074-pasteboardwithname?language=objc) ou [`pasteboardWithUniqueName`](https://developer.apple.com/documentation/uikit/uipasteboard/1622087-pasteboardwithuniquename?language=objc). Verifique se os pasteboards personalizados estÃ£o definidos como persistentes, pois isso Ã© obsoleto desde o iOS 10. Deve ser usado um contÃªiner compartilhado.

## AnÃ¡lise dinÃ¢mica

Intercepte ou rastreie o seguinte:

* `generalPasteboard` para o pasteboard geral do sistema.
* `pasteboardWithName:create:` e `pasteboardWithUniqueName` para pasteboards personalizados.

VocÃª tambÃ©m pode interceptar ou rastrear o mÃ©todo obsoleto [`setPersistent:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622096-setpersistent?language=objc) e verificar se ele estÃ¡ sendo chamado.

Ao **monitorar** os **pasteboards**, hÃ¡ vÃ¡rios **detalhes** que podem ser **recuperados** dinamicamente:

* Obtenha o **nome do pasteboard** interceptando `pasteboardWithName:create:` e inspecionando seus parÃ¢metros de entrada ou `pasteboardWithUniqueName` e inspecionando seu valor de retorno.
* Obtenha o **primeiro item disponÃ­vel no pasteboard**: por exemplo, para strings, use o mÃ©todo `string`. Ou use qualquer um dos outros mÃ©todos para os [tipos de dados padrÃ£o](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#1654275).
* Obtenha o **nÃºmero de itens** com `numberOfItems`.
* Verifique a **existÃªncia de tipos de dados padrÃ£o** com os [mÃ©todos de conveniÃªncia](https://developer.apple.com/documentation/uikit/uipasteboard?language=objc#2107142), por exemplo, `hasImages`, `hasStrings`, `hasURLs` (a partir do iOS 10).
* Verifique outros tipos de dados (tipicamente UTIs) com [`containsPasteboardTypes:inItemSet:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622100-containspasteboardtypes?language=objc). VocÃª pode inspecionar tipos de dados mais concretos, como uma imagem como public.png e public.tiff ([UTIs](http://web.archive.org/web/20190616231857/https://developer.apple.com/documentation/mobilecoreservices/uttype)) ou dados personalizados, como com.mycompany.myapp.mytype. Lembre-se de que, nesse caso, apenas os aplicativos que _declararam conhecimento_ do tipo sÃ£o capazes de entender os dados escritos no pasteboard. Recupere-os usando [`itemSetWithPasteboardTypes:`](https://developer.apple.com/documentation/uikit/uipasteboard/1622071-itemsetwithpasteboardtypes?language=objc) e definindo os UTIs correspondentes.
* Verifique itens excluÃ­dos ou expirados interceptando `setItems:options:` e inspecionando suas opÃ§Ãµes para `UIPasteboardOptionLocalOnly` ou `UIPasteboardOptionExpirationDate`.

Se estiver procurando apenas por strings, convÃ©m usar o comando **objection** `ios pasteboard monitor`:

> Interfere na classe UIPasteboard do iOS e verifica o generalPasteboard a cada 5 segundos em busca de dados. Se novos dados forem encontrados, diferentes da pesquisa anterior, esses dados serÃ£o exibidos na tela.

VocÃª tambÃ©m pode criar seu prÃ³prio monitor de pasteboard que monitora informaÃ§Ãµes especÃ­ficas, como visto acima.

Por exemplo, este script (inspirado no script por trÃ¡s do monitor de pasteboard do [objection](https://github.com/sensepost/objection/blob/b39ee53b5ba2e9a271797d2f3931d79c46dccfdb/agent/src/ios/pasteboard.ts)) lÃª os itens do pasteboard a cada 5 segundos, se houver algo novo, ele serÃ¡ impresso:
```javascript
const UIPasteboard = ObjC.classes.UIPasteboard;
    const Pasteboard = UIPasteboard.generalPasteboard();
    var items = "";
    var count = Pasteboard.changeCount().toString();

setInterval(function () {
      const currentCount = Pasteboard.changeCount().toString();
      const currentItems = Pasteboard.items().toString();

      if (currentCount === count) { return; }

      items = currentItems;
      count = currentCount;

      console.log('[* Pasteboard changed] count: ' + count +
      ' hasStrings: ' + Pasteboard.hasStrings().toString() +
      ' hasURLs: ' + Pasteboard.hasURLs().toString() +
      ' hasImages: ' + Pasteboard.hasImages().toString());
      console.log(items);

    }, 1000 * 5);
```
# ReferÃªncias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
