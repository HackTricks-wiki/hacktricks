# Entorno de Pruebas de iOS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desarrolladores de Apple

Una **identidad de aprovisionamiento** es una colecciÃ³n de claves pÃºblicas y privadas asociadas a una cuenta de desarrollador de Apple. Para **firmar aplicaciones**, debes pagar **99$/aÃ±o** para registrarte en el **Programa de Desarrolladores de Apple** y obtener tu identidad de aprovisionamiento. Sin esto, no podrÃ¡s ejecutar aplicaciones desde el cÃ³digo fuente en un dispositivo fÃ­sico. Otra opciÃ³n es utilizar un **dispositivo con jailbreak**.

A partir de Xcode 7.2, Apple ha proporcionado una opciÃ³n para crear un **perfil de aprovisionamiento de desarrollo de iOS gratuito** que permite escribir y probar tu aplicaciÃ³n en un iPhone real. Ve a _Xcode_ --> _Preferencias_ --> _Cuentas_ --> _+_ (Agregar nueva ID de aplicaciÃ³n con tus credenciales) --> _Haz clic en la ID de Apple creada_ --> _Gestionar certificados_ --> _+_ (Desarrollo de Apple) --> _Hecho_\
\_\_Luego, para ejecutar tu aplicaciÃ³n en tu iPhone, primero debes **indicarle al iPhone que confÃ­e en la computadora**. Luego, puedes intentar **ejecutar la aplicaciÃ³n en el mÃ³vil desde Xcode**, pero aparecerÃ¡ un error. Entonces ve a _ConfiguraciÃ³n_ --> _General_ --> _Perfiles y administraciÃ³n de dispositivos_ --> Selecciona el perfil no confiable y haz clic en "**Confiar**".

Ten en cuenta que **las aplicaciones firmadas con el mismo certificado de firma pueden compartir recursos de manera segura, como elementos del llavero**.

Los perfiles de aprovisionamiento se almacenan dentro del telÃ©fono en **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Ten en cuenta que un **simulador no es lo mismo que un emulador**. El simulador solo simula el comportamiento del dispositivo y sus funciones, pero no las utiliza realmente.
{% endhint %}

El simulador del SDK de iOS ofrece una _simulaciÃ³n_ de nivel superior de un dispositivo iOS. Lo mÃ¡s importante es que los binarios del emulador se compilan en cÃ³digo x86 en lugar de cÃ³digo ARM. Las aplicaciones compiladas para un dispositivo real no se ejecutan, lo que hace que el simulador sea inÃºtil para el anÃ¡lisis de caja negra y la ingenierÃ­a inversa.

### **Simulador**

Lo primero que debes saber es que **realizar una prueba de penetraciÃ³n dentro de un simulador serÃ¡ mucho mÃ¡s limitado que hacerlo en un dispositivo con jailbreak**.

Todas las herramientas necesarias para construir y admitir una aplicaciÃ³n de iOS **solo son oficialmente compatibles en Mac OS**.\
La herramienta de facto de Apple para crear/depurar/instrumentar aplicaciones de iOS es **Xcode**. Se puede utilizar para descargar otros componentes como **simuladores** y diferentes **versiones de SDK** necesarios para construir y **probar** tu aplicaciÃ³n.\
Se recomienda encarecidamente **descargar** Xcode desde la **tienda de aplicaciones oficial**. Otras versiones pueden contener malware.

Los archivos del simulador se pueden encontrar en `/Users/<nombre de usuario>/Library/Developer/CoreSimulator/Devices`

Para abrir el simulador, ejecuta Xcode, luego presiona en la pestaÃ±a _Xcode_ --> _Abrir herramientas de desarrollo_ --> _Simulador_\
\_\_En la siguiente imagen, al hacer clic en "iPod touch \[...]", puedes seleccionar otro dispositivo para probar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicaciones en el Simulador

Dentro de `/Users/<nombre de usuario>/Library/Developer/CoreSimulator/Devices`, puedes encontrar todos los **simuladores instalados**. Si deseas acceder a los archivos de una aplicaciÃ³n creada dentro de uno de los emuladores, puede ser difÃ­cil saber **en cuÃ¡l estÃ¡ instalada la aplicaciÃ³n**. Una forma rÃ¡pida de **encontrar el UID correcto** es ejecutar la aplicaciÃ³n en el simulador y ejecutar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una vez que conozcas el UID, las aplicaciones instaladas dentro de Ã©l se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`.

Sin embargo, sorprendentemente no encontrarÃ¡s la aplicaciÃ³n aquÃ­. Debes acceder a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`.

Y en esta carpeta puedes **encontrar el paquete de la aplicaciÃ³n**.

## Emulador

Corellium es el Ãºnico emulador de iOS disponible pÃºblicamente. Es una soluciÃ³n empresarial de SaaS con un modelo de licencia por usuario y no ofrece ninguna licencia de prueba.

## Jailbreaking

Apple exige estrictamente que el cÃ³digo que se ejecuta en el iPhone debe estar **firmado por un certificado emitido por Apple**. **Jailbreaking** es el proceso de **sortear activamente estas restricciones** y otros controles de seguridad establecidos por el sistema operativo. Por lo tanto, una vez que el dispositivo estÃ¡ jailbroken, la **verificaciÃ³n de integridad** que se encarga de verificar las aplicaciones instaladas se parchea y se **bypassa**.

{% hint style="info" %}
A diferencia de Android, **no puedes cambiar al "Modo de desarrollador"** en iOS para ejecutar cÃ³digo no firmado/no confiable en el dispositivo.
{% endhint %}

### ComparaciÃ³n con el acceso root en Android

El jailbreaking de iOS se compara a menudo con el acceso root en Android, pero el proceso es en realidad bastante **diferente**. Para explicar la diferencia, primero revisaremos los conceptos de "rooting" y "flashing" en Android.

* **Rooting**: Esto generalmente implica instalar el binario `su` en el sistema o reemplazar todo el sistema con una ROM personalizada con acceso root. No se requieren exploits para obtener acceso root siempre que el gestor de arranque sea accesible.
* **Flashing de ROMs personalizadas**: Esto te permite reemplazar el sistema operativo que se ejecuta en el dispositivo despuÃ©s de desbloquear el gestor de arranque. El gestor de arranque puede requerir un exploit para desbloquearlo.

**En los dispositivos iOS, es imposible flashear una ROM personalizada** porque el gestor de arranque de iOS **solo permite el arranque y el flasheo de imÃ¡genes firmadas por Apple**. Es por eso que incluso las **imÃ¡genes oficiales de iOS no se pueden instalar si no estÃ¡n firmadas por Apple, y esto hace que las versiones anteriores de iOS solo sean posibles mientras la versiÃ³n anterior de iOS aÃºn estÃ© firmada**.

El propÃ³sito del jailbreaking es **desactivar las protecciones de iOS** (especialmente los mecanismos de firma de cÃ³digo de Apple) para que se pueda ejecutar **cÃ³digo no firmado arbitrario en el dispositivo** (por ejemplo, cÃ³digo personalizado o descargado de tiendas de aplicaciones alternativas como Cydia o Sileo). La palabra "jailbreak" es una referencia coloquial a las herramientas todo en uno que automatizan el proceso de desactivaciÃ³n.

### Consideraciones sobre el jailbreaking

El jailbreaking de un dispositivo iOS se estÃ¡ volviendo cada vez mÃ¡s **complicado** porque Apple sigue fortaleciendo el sistema y parcheando las vulnerabilidades explotadas. El jailbreaking se ha convertido en un procedimiento muy sensible al tiempo porque **Apple deja de firmar estas versiones vulnerables relativamente pronto despuÃ©s de lanzar una correcciÃ³n** (a menos que el jailbreak se beneficie de vulnerabilidades basadas en hardware, como el exploit [limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afecta al BootROM del iPhone 4 y el iPad 1). Esto significa que **no puedes volver a una versiÃ³n especÃ­fica de iOS una vez que Apple deja de firmar el firmware**.

Si tienes un dispositivo jailbroken que utilizas para pruebas de seguridad, **consÃ©rvalo** tal como estÃ¡ a menos que estÃ©s 100% seguro de que puedes volver a hacerle jailbreak despuÃ©s de actualizar a la Ãºltima versiÃ³n de iOS.

Las actualizaciones de iOS se basan en un proceso de desafÃ­o-respuesta (generando los llamados SHSH blobs como resultado). El dispositivo solo permitirÃ¡ la instalaciÃ³n del sistema operativo si la respuesta al desafÃ­o estÃ¡ firmada por Apple. Esto es lo que los investigadores llaman una "ventana de firma", y es la razÃ³n por la cual **no puedes simplemente almacenar el paquete de firmware OTA que descargaste y cargarlo en el dispositivo cuando quieras**. Durante las actualizaciones menores de iOS, es posible que Apple firme dos versiones (la mÃ¡s reciente y la versiÃ³n anterior). Esta es la Ãºnica situaciÃ³n en la que puedes volver a una versiÃ³n anterior de iOS. Puedes **verificar la ventana de firma actual y descargar el firmware OTA desde el** [**sitio web de IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Actualizar el sistema operativo elimina el efecto del jailbreaking**.
{% endhint %}

### Tipos de jailbreak

* Los **jailbreaks tethered** no persisten despuÃ©s de reiniciar, por lo que es necesario conectar (tether) el dispositivo a una computadora en cada reinicio para volver a aplicar el jailbreak. El dispositivo puede no reiniciarse en absoluto si no estÃ¡ conectado a la computadora.
* Los jailbreaks **semi-tethered** no se pueden volver a aplicar a menos que el dispositivo estÃ© conectado a una computadora durante el reinicio. El dispositivo tambiÃ©n puede arrancar en modo sin jailbreak por sÃ­ solo.
* Los jailbreaks **semi-untethered** permiten que el dispositivo arranque por sÃ­ solo, pero los parches del kernel (o las modificaciones en el espacio de usuario) para deshabilitar la firma de cÃ³digo no se aplican automÃ¡ticamente. El usuario debe volver a hacerle jailbreak al dispositivo iniciando una aplicaciÃ³n o visitando un sitio web (sin necesidad de una conexiÃ³n a una computadora, de ahÃ­ el tÃ©rmino untethered).
* Los jailbreaks **untethered** son la opciÃ³n mÃ¡s popular para los usuarios finales porque solo necesitan aplicarse una vez, despuÃ©s de lo cual el dispositivo estarÃ¡ permanentemente jailbroken.

### Herramientas de jailbreaking

Diferentes versiones de iOS requieren **tÃ©cnicas de jailbreaking diferentes**. [Determina si hay un jailbreak pÃºblico disponible para tu versiÃ³n de iOS](https://canijailbreak.com). Ten cuidado con las herramientas falsas y el spyware, que a menudo se esconden detrÃ¡s de nombres de dominio similares al nombre del grupo/autor del jailbreak.

Ejemplos de versiones:

* [Checkra1n](https://checkra.in/): Funciona en dispositivos con el chip A7 y tan nuevos como el chip A11, por ejemplo, iPhone 5S hasta iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) en iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Solo funciona para versiones de iOS hasta 14.8, ya que Apple parcheÃ³ los problemas que permitÃ­an que Unc0ver se ejecutara.

La escena del jailbreak de iOS evoluciona tan rÃ¡pidamente que proporcionar instrucciones actualizadas es difÃ­cil. Sin embargo, podemos seÃ±alarte algunas fuentes que son actualmente confiables:

* [**Can I Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Ten en cuenta que cualquier modificaciÃ³n que realices en tu dispositivo es bajo tu propio riesgo. Si bien el jailbreaking suele ser seguro, las cosas pueden salir mal y puedes terminar bloqueando tu dispositivo. Ninguna otra parte, excepto tÃº mismo, puede ser considerada responsable de cualquier daÃ±o.
### Beneficios

El efecto secundario mÃ¡s importante de hacer Jailbreak es que **elimina cualquier aislamiento de seguridad establecido por el sistema operativo**. Por lo tanto, cualquier **aplicaciÃ³n en el dispositivo puede leer cualquier archivo** en el sistema de archivos, incluyendo archivos de otras aplicaciones, cookies y el llavero.

Un dispositivo con Jailbreak permite a los usuarios **instalar aplicaciones no aprobadas** y aprovechar **mÃ¡s APIs**, a las cuales no se puede acceder de otra manera.

{% hint style="warning" %}
**No se recomienda hacer Jailbreak en el dispositivo mÃ³vil para usuarios regulares**
{% endhint %}

### **DespuÃ©s de hacer Jailbreak**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **DetecciÃ³n de Jailbreak**

**Varias aplicaciones intentarÃ¡n detectar si el dispositivo mÃ³vil tiene Jailbreak y, en ese caso, la aplicaciÃ³n no se ejecutarÃ¡**

* DespuÃ©s de hacer Jailbreak en un dispositivo iOS, **generalmente se instalan archivos y carpetas**, los cuales se pueden buscar para determinar si el dispositivo tiene Jailbreak.
* En un dispositivo con Jailbreak, las aplicaciones obtienen **acceso de lectura/escritura a nuevos archivos** fuera del aislamiento de seguridad.
* Algunas **llamadas a API** se **comportarÃ¡n de manera diferente**
* La presencia del servicio **OpenSSH**
* Llamar a `/bin/sh` devolverÃ¡ 1 en lugar de 0

**MÃ¡s informaciÃ³n sobre cÃ³mo detectar Jailbreak** [**aquÃ­**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puedes intentar evitar estas detecciones utilizando la opciÃ³n `ios jailbreak disable` de **objection**.

## **Bypass de DetecciÃ³n de Jailbreak**

* Puedes intentar evitar estas detecciones utilizando la opciÃ³n `ios jailbreak disable` de **objection**.
* TambiÃ©n puedes instalar la herramienta **Liberty Lite** (https://ryleyangus.com/repo/). Una vez que se haya agregado el repositorio, la aplicaciÃ³n deberÃ­a aparecer en la pestaÃ±a de 'BÃºsqueda'

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres que tu **empresa sea anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
