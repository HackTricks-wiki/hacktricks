# Entorno de Pruebas iOS

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desarrolladores de Apple

Una **identidad de aprovisionamiento** es una colecci√≥n de claves p√∫blicas y privadas que est√°n asociadas a una cuenta de desarrollador de Apple. Para **firmar aplicaciones** necesitas pagar **99$/a√±o** para registrarte en el **Programa de Desarrolladores de Apple** y obtener tu identidad de aprovisionamiento. Sin esto no podr√°s ejecutar aplicaciones desde el c√≥digo fuente en un dispositivo f√≠sico. Otra opci√≥n para hacer esto es usar un **dispositivo con jailbreak**.

A partir de Xcode 7.2, Apple ha proporcionado una opci√≥n para crear un **perfil de aprovisionamiento de desarrollo de iOS gratuito** que permite escribir y probar tu aplicaci√≥n en un iPhone real. Ve a _Xcode_ --> _Preferencias_ --> _Cuentas_ --> _+_ (A√±adir nuevo ID de Apple a tus credenciales) --> _Haz clic en el ID de Apple creado_ --> _Gestionar Certificados_ --> _+_ (Desarrollo de Apple) --> _Hecho_\
\_\_Luego, para ejecutar tu aplicaci√≥n en tu iPhone primero necesitas **indicar al iPhone que conf√≠e en la computadora.** Despu√©s, puedes intentar **ejecutar la aplicaci√≥n en el m√≥vil desde Xcode,** pero aparecer√° un error. As√≠ que ve a _Ajustes_ --> _General_ --> _Gesti√≥n de Perfiles y Dispositivos_ --> Selecciona el perfil no confiable y haz clic en "**Confiar**".

Ten en cuenta que **las aplicaciones firmadas por el mismo certificado de firma pueden compartir recursos de manera segura, como elementos del llavero**.

Los perfiles de aprovisionamiento se almacenan dentro del tel√©fono en **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Ten en cuenta que un **simulador no es lo mismo que un emulador**. El simulador solo simula el comportamiento del dispositivo y sus funciones pero no las utiliza realmente.
{% endhint %}

**E**l simulador del SDK de iOS ofrece una _simulaci√≥n_ de nivel superior de un dispositivo iOS. Lo m√°s importante es que los binarios del emulador est√°n compilados para c√≥digo x86 en lugar de c√≥digo ARM. Las aplicaciones compiladas para un dispositivo real no se ejecutan, lo que hace que el simulador sea in√∫til para an√°lisis de caja negra e ingenier√≠a inversa.

### **Simulador**

Lo primero que necesitas saber es que **realizar un pentest dentro de un simulador ser√° mucho m√°s limitado que hacerlo en un dispositivo con jailbreak**.

Todas las herramientas necesarias para construir y dar soporte a una aplicaci√≥n iOS est√°n **oficialmente soportadas solo en Mac OS**.\
La herramienta de facto de Apple para crear/depurar/instrumentar aplicaciones iOS es **Xcode**. Se puede utilizar para descargar otros componentes como **simuladores** y diferentes **versiones del SDK** necesarias para construir y **probar** tu aplicaci√≥n.\
Es altamente recomendable **descargar** Xcode desde la **tienda oficial de aplicaciones**. Otras versiones pueden contener malware.

Los archivos del simulador se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir el simulador, ejecuta Xcode, luego presiona en la pesta√±a _Xcode_ --> _Herramientas de Desarrollador Abiertas_ --> _Simulador_\
\_\_En la siguiente imagen, haciendo clic en "iPod touch \[...]" puedes seleccionar otro dispositivo para probar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicaciones en el Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices` puedes encontrar todos los **simuladores instalados**. Si quieres acceder a los archivos de una aplicaci√≥n creada dentro de uno de los emuladores, puede ser dif√≠cil saber **en cu√°l de ellos est√° instalada la aplicaci√≥n**. Una forma r√°pida de **encontrar el UID correcto** es ejecutar la aplicaci√≥n en el simulador y ejecutar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Una vez que conozcas el UID, las aplicaciones instaladas dentro de √©l se pueden encontrar en `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Sin embargo, sorprendentemente no encontrar√°s la aplicaci√≥n aqu√≠. Necesitas acceder a `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

Y en esta carpeta puedes **encontrar el paquete de la aplicaci√≥n.**

## Emulador

Corellium es el √∫nico emulador de iOS disponible p√∫blicamente. Es una soluci√≥n empresarial SaaS con un modelo de licencia por usuario y no ofrece ninguna licencia de prueba.

## Jailbreaking

Apple exige estrictamente que el c√≥digo que se ejecuta en el iPhone debe estar **firmado por un certificado emitido por Apple**. **Jailbreaking** es el proceso de **eludir activamente dichas restricciones** y otros controles de seguridad establecidos por el sistema operativo. Por lo tanto, una vez que el dispositivo est√° con jailbreak, la **verificaci√≥n de integridad** que es responsable de comprobar las aplicaciones que se instalan est√° parcheada para que se **evite**.

{% hint style="info" %}
A diferencia de Android, **no puedes cambiar a "Modo Desarrollador"** en iOS para ejecutar c√≥digo no firmado/no confiable en el dispositivo.
{% endhint %}

### Comparaci√≥n con Root en Android

El jailbreaking de iOS a menudo se **compara con el rooting de Android**, pero el proceso es en realidad bastante **diferente**. Para explicar la diferencia, primero revisaremos los conceptos de "rooting" y "flasheo" en Android.

* **Rooting**: Esto generalmente implica instalar el binario `su` en el sistema o reemplazar todo el sistema con una ROM personalizada con root. No se requieren exploits para obtener acceso root siempre que el bootloader sea accesible.
* **Flasheo de ROMs personalizadas**: Esto te permite reemplazar el sistema operativo que se ejecuta en el dispositivo despu√©s de desbloquear el bootloader. El bootloader puede requerir un exploit para desbloquearlo.

**En dispositivos iOS, flashear una ROM personalizada es imposible** porque el bootloader de iOS **solo permite que se inicien y flasheen im√°genes firmadas por Apple**. Por eso incluso **las im√°genes oficiales de iOS no se pueden instalar si no est√°n firmadas por Apple, y hace que las degradaciones de iOS solo sean posibles mientras la versi√≥n anterior de iOS todav√≠a est√© firmada.**

El prop√≥sito del jailbreaking es **deshabilitar las protecciones de iOS** (los mecanismos de firma de c√≥digo de Apple en particular) para que **cualquier c√≥digo no firmado pueda ejecutarse en el dispositivo** (por ejemplo, c√≥digo personalizado o descargado de tiendas de aplicaciones alternativas como Cydia o Sileo). La palabra "jailbreak" es una referencia coloquial a las herramientas todo en uno que automatizan el proceso de deshabilitaci√≥n.

### Consideraciones sobre Jailbreaking

Hacer jailbreak a un dispositivo iOS se est√° volviendo m√°s y m√°s **complicado** porque Apple sigue reforzando el sistema y parcheando las vulnerabilidades explotadas. El jailbreaking se ha convertido en un procedimiento muy sensible al tiempo porque **Apple deja de firmar estas versiones vulnerables relativamente pronto despu√©s de lanzar una soluci√≥n** (a menos que el jailbreak se beneficie de vulnerabilidades basadas en hardware, como el [exploit limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afecta al BootROM del iPhone 4 y iPad 1). Esto significa que **no puedes degradar a una versi√≥n espec√≠fica de iOS una vez que Apple deja de firmar el firmware**.

Si tienes un dispositivo con jailbreak que usas para pruebas de seguridad, **cons√©rvalo** tal como est√° a menos que est√©s 100% seguro de que puedes volver a hacer jailbreak despu√©s de actualizar a la √∫ltima versi√≥n de iOS.

Las actualizaciones de iOS se basan en un proceso de desaf√≠o-respuesta (generando los llamados blobs SHSH como resultado). El dispositivo permitir√° la instalaci√≥n del sistema operativo solo si la respuesta al desaf√≠o est√° firmada por Apple. Esto es lo que los investigadores llaman una "ventana de firma", y es la raz√≥n por la que **no puedes simplemente almacenar el paquete de firmware OTA que descargaste y cargarlo en el dispositivo cuando quieras**. Durante las actualizaciones menores de iOS, dos versiones pueden estar firmadas por Apple (la m√°s reciente y la versi√≥n anterior de iOS). Esta es la √∫nica situaci√≥n en la que puedes degradar el dispositivo iOS. Puedes **verificar la ventana de firma actual y descargar el firmware OTA desde el sitio web de** [**IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Actualizar el sistema operativo elimina el efecto del jailbreaking.**
{% endhint %}

### Tipos de Jailbreak

* Los **jailbreaks atados** no persisten a trav√©s de reinicios, por lo que se requiere volver a aplicar el jailbreak con el dispositivo conectado (atado) a una computadora durante cada reinicio. El dispositivo puede que ni siquiera reinicie si la computadora no est√° conectada.
* Los **jailbreaks semi-atados** no se pueden volver a aplicar a menos que el dispositivo est√© conectado a una computadora durante el reinicio. El dispositivo tambi√©n puede arrancar en modo no jailbreak por s√≠ solo.
* Los **jailbreaks semi-desatados** permiten que el dispositivo arranque por s√≠ solo, pero los parches del kernel (o las modificaciones en el espacio de usuario) para deshabilitar la firma de c√≥digo no se aplican autom√°ticamente. El usuario debe volver a hacer jailbreak al dispositivo iniciando una aplicaci√≥n o visitando un sitio web (sin requerir una conexi√≥n a una computadora, de ah√≠ el t√©rmino desatado).
* Los **jailbreaks desatados** son la opci√≥n m√°s popular para los usuarios finales porque solo necesitan aplicarse una vez, despu√©s de lo cual el dispositivo estar√° permanentemente con jailbreak.

### Herramientas de Jailbreaking

Diferentes versiones de iOS requieren **diferentes t√©cnicas de jailbreaking**. [Determina si hay un jailbreak p√∫blico disponible para tu versi√≥n de iOS](https://canijailbreak.com). Ten cuidado con las herramientas falsas y el spyware, que a menudo se esconden detr√°s de nombres de dominio similares al nombre del grupo/autor del jailbreak.

Ejemplos de versiones:

* [Checkra1n](https://checkra.in/): Funciona en dispositivos con el chip A7 y tan nuevos como el chip A11, por ejemplo, iPhone 5S hasta iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) en iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Solo funciona para versiones de iOS hasta 14.8, ya que Apple parche√≥ los problemas que permit√≠an que Unc0ver se ejecutara

La escena del jailbreak de iOS evoluciona tan r√°pidamente que proporcionar instrucciones actualizadas es dif√≠cil. Sin embargo, podemos se√±alarte algunas fuentes que actualmente son confiables:

* [**¬øPuedo hacer Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Ten en cuenta que cualquier modificaci√≥n que hagas en tu dispositivo es bajo tu propio riesgo. Aunque el jailbreaking suele ser seguro, las cosas pueden salir mal y puedes terminar inutilizando tu dispositivo. Ninguna otra parte excepto t√∫ mismo puede ser considerada responsable de cualquier da√±o.

### Beneficios

El efecto secundario m√°s importante del Jailbreaking es que **elimina cualquier aislamiento impuesto por el sistema operativo**. Por lo tanto, cualquier **aplicaci√≥n en el dispositivo puede leer cualquier archivo** en el sistema de archivos, incluidos los archivos de otras aplicaciones, cookies y llavero.

Un dispositivo con jailbreak permite a los usuarios **instalar aplicaciones no aprobadas** y aprovechar **m√°s APIs**, a las cuales de otro modo no se tendr√≠a acceso.

{% hint style="warning" %}
**No se recomienda hacer jailbreak al m√≥vil para usuarios regulares**
{% endhint %}

### **Despu√©s del Jailbreaking**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Detecci√≥n de Jailbreak**

**Varias aplicaciones intentar√°n detectar si el m√≥vil tiene jailbreak y en ese caso la aplicaci√≥n no se ejecutar√°**

* Despu√©s de hacer jailbreak en un iOS **se instalan usualmente archivos y carpetas**, estos se pueden buscar para determinar si el dispositivo tiene jailbreak.
* En un dispositivo con jailbreak las aplicaciones obtienen **acceso de lectura/escritura a nuevos archivos** fuera del aislamiento
* Algunas **llamadas a API** se **comportar√°n de manera diferente**
* La presencia del servicio **OpenSSH**
* Llamar a `/bin/sh` **devolver√° 1** en lugar de 0

**M√°s informaci√≥n sobre c√≥mo detectar jailbreaking** [**aqu√≠**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**

## **Evasi√≥n de Detecci√≥n de Jailbreak**

* Puedes intentar evitar estas detecciones usando `ios jailbreak disable` de **objection**
* Tambi√©n podr√≠as instalar la herramienta **Liberty Lite** (https://ryleyangus.com/repo/). Una vez que se a√±ade el repositorio, la aplicaci√≥n deber√≠a aparecer en la pesta√±a ‚ÄòBuscar‚Äô

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al grupo de** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) o al grupo de [**telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
