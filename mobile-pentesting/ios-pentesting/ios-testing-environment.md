# Ambiente de Teste iOS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? Ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Programa de Desenvolvedor Apple

Uma **identidade de provisionamento** Ã© uma coleÃ§Ã£o de chaves pÃºblicas e privadas associadas a uma conta de desenvolvedor da Apple. Para **assinar aplicativos**, vocÃª precisa pagar **99$/ano** para se registrar no **Programa de Desenvolvedor Apple** e obter sua identidade de provisionamento. Sem isso, vocÃª nÃ£o poderÃ¡ executar aplicativos a partir do cÃ³digo-fonte em um dispositivo fÃ­sico. Outra opÃ§Ã£o Ã© usar um **dispositivo com jailbreak**.

A partir do Xcode 7.2, a Apple disponibilizou uma opÃ§Ã£o para criar um **perfil de provisionamento de desenvolvimento iOS gratuito** que permite escrever e testar seu aplicativo em um iPhone real. VÃ¡ para _Xcode_ --> _PreferÃªncias_ --> _Contas_ --> _+_ (Adicionar novo ID de Aplicativo com suas credenciais) --> _Clique no ID de Aplicativo criado_ --> _Gerenciar Certificados_ --> _+_ (Desenvolvimento Apple) --> _ConcluÃ­do_\
\_\_Em seguida, para executar seu aplicativo no iPhone, vocÃª precisa primeiro **indicar ao iPhone que confie no computador**. Em seguida, vocÃª pode tentar **executar o aplicativo no celular a partir do Xcode**, mas um erro aparecerÃ¡. Portanto, vÃ¡ para _ConfiguraÃ§Ãµes_ --> _Geral_ --> _Perfis e Gerenciamento de Dispositivos_ --> Selecione o perfil nÃ£o confiÃ¡vel e clique em "**Confiar**".

Observe que **aplicativos assinados pelo mesmo certificado de assinatura podem compartilhar recursos de maneira segura, como itens de chaveiro**.

Os perfis de provisionamento sÃ£o armazenados dentro do telefone em **`/Library/MobileDevice/ProvisioningProfiles`**

## **Simulador**

{% hint style="info" %}
Observe que um **simulador nÃ£o Ã© o mesmo que um emulador**. O simulador apenas simula o comportamento do dispositivo e suas funÃ§Ãµes, mas nÃ£o as utiliza de fato.
{% endhint %}

O simulador do iOS SDK oferece uma _simulaÃ§Ã£o_ de alto nÃ­vel de um dispositivo iOS. Mais importante, os binÃ¡rios do emulador sÃ£o compilados para cÃ³digo x86 em vez de cÃ³digo ARM. Os aplicativos compilados para um dispositivo real nÃ£o sÃ£o executados, tornando o simulador inÃºtil para anÃ¡lise de caixa preta e engenharia reversa.

### **Simulador**

A primeira coisa que vocÃª precisa saber Ã© que **realizar um pentest dentro de um simulador serÃ¡ muito mais limitado do que fazÃª-lo em um dispositivo com jailbreak**.

Todas as ferramentas necessÃ¡rias para construir e dar suporte a um aplicativo iOS sÃ£o **oficialmente suportadas apenas no Mac OS**.\
A ferramenta de fato da Apple para criar/debbugar/instrumentar aplicativos iOS Ã© o **Xcode**. Ele pode ser usado para baixar outros componentes, como **simuladores** e diferentes **versÃµes do SDK** necessÃ¡rias para construir e **testar** seu aplicativo.\
Ã‰ altamente recomendado **baixar** o Xcode da **loja de aplicativos oficial**. Outras versÃµes podem conter malware.

Os arquivos do simulador podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Para abrir o simulador, execute o Xcode e, em seguida, clique na guia _Xcode_ --> _Abrir ferramentas de desenvolvedor_ --> _Simulador_\
\_\_Na imagem a seguir, clicando em "iPod touch \[...]", vocÃª pode selecionar outro dispositivo para testar:

![](<../../.gitbook/assets/image (457).png>)

![](<../../.gitbook/assets/image (458).png>)

### Aplicativos no Simulador

Dentro de `/Users/<username>/Library/Developer/CoreSimulator/Devices`, vocÃª pode encontrar todos os **simuladores instalados**. Se vocÃª deseja acessar os arquivos de um aplicativo criado em um dos emuladores, pode ser difÃ­cil saber **em qual deles o aplicativo estÃ¡ instalado**. Uma maneira rÃ¡pida de **encontrar o UID correto** Ã© executar o aplicativo no simulador e executar:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Uma vez que vocÃª conhece o UID, os aplicativos instalados nele podem ser encontrados em `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

No entanto, surpreendentemente, vocÃª nÃ£o encontrarÃ¡ o aplicativo aqui. VocÃª precisa acessar `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

E nesta pasta vocÃª pode **encontrar o pacote do aplicativo**.

## Emulador

Corellium Ã© o Ãºnico emulador iOS disponÃ­vel publicamente. Ã‰ uma soluÃ§Ã£o SaaS empresarial com um modelo de licenÃ§a por usuÃ¡rio e nÃ£o oferece nenhum teste gratuito.

## Jailbreaking

A Apple exige estritamente que o cÃ³digo executado no iPhone seja **assinado por um certificado emitido pela Apple**. **Jailbreaking** Ã© o processo de **contornar ativamente essas restriÃ§Ãµes** e outros controles de seguranÃ§a implementados pelo sistema operacional. Portanto, uma vez que o dispositivo Ã© jailbroken, a **verificaÃ§Ã£o de integridade**, que Ã© responsÃ¡vel por verificar os aplicativos instalados, Ã© corrigida para ser **burlada**.

{% hint style="info" %}
Ao contrÃ¡rio do Android, **vocÃª nÃ£o pode alternar para o "Modo de Desenvolvedor"** no iOS para executar cÃ³digo nÃ£o assinado/nÃ£o confiÃ¡vel no dispositivo.
{% endhint %}

### ComparaÃ§Ã£o com o Root no Android

O jailbreaking do iOS Ã© frequentemente **comparado ao root no Android**, mas o processo Ã© realmente bastante **diferente**. Para explicar a diferenÃ§a, vamos primeiro revisar os conceitos de "root" e "flashing" no Android.

* **Root**: Isso geralmente envolve a instalaÃ§Ã£o do binÃ¡rio `su` no sistema ou a substituiÃ§Ã£o de todo o sistema por uma ROM personalizada com root. NÃ£o sÃ£o necessÃ¡rios exploits para obter acesso root, desde que o bootloader seja acessÃ­vel.
* **Flashing de ROMs personalizadas**: Isso permite substituir o sistema operacional que estÃ¡ sendo executado no dispositivo depois de desbloquear o bootloader. O bootloader pode exigir um exploit para ser desbloqueado.

**Nos dispositivos iOS, Ã© impossÃ­vel fazer o flashing de uma ROM personalizada** porque o bootloader do iOS **permite apenas a inicializaÃ§Ã£o e o flashing de imagens assinadas pela Apple**. Ã‰ por isso que mesmo **imagens oficiais do iOS nÃ£o podem ser instaladas se nÃ£o forem assinadas pela Apple, e isso torna downgrades do iOS possÃ­veis apenas enquanto a versÃ£o anterior do iOS ainda estiver assinada**.

O objetivo do jailbreaking Ã© **desabilitar as proteÃ§Ãµes do iOS** (principalmente os mecanismos de assinatura de cÃ³digo da Apple) para que **cÃ³digo nÃ£o assinado arbitrÃ¡rio possa ser executado no dispositivo** (por exemplo, cÃ³digo personalizado ou baixado de lojas de aplicativos alternativas como Cydia ou Sileo). A palavra "jailbreak" Ã© uma referÃªncia coloquial a ferramentas que automatizam o processo de desabilitaÃ§Ã£o.

### ConsideraÃ§Ãµes sobre o Jailbreaking

Jailbreak em um dispositivo iOS estÃ¡ se tornando cada vez mais **complicado** porque a Apple continua fortalecendo o sistema e corrigindo as vulnerabilidades exploradas. O jailbreak se tornou um procedimento muito sensÃ­vel ao tempo porque a Apple para de assinar essas versÃµes vulnerÃ¡veis relativamente pouco tempo depois de lanÃ§ar uma correÃ§Ã£o (a menos que o jailbreak se beneficie de vulnerabilidades baseadas em hardware, como o [exploit limera1n](https://www.theiphonewiki.com/wiki/Limera1n) que afeta o BootROM do iPhone 4 e iPad 1). Isso significa que **vocÃª nÃ£o pode fazer o downgrade para uma versÃ£o especÃ­fica do iOS assim que a Apple parar de assinar o firmware**.

Se vocÃª tiver um dispositivo jailbroken que usa para testes de seguranÃ§a, **mantenha-o** como estÃ¡, a menos que vocÃª tenha certeza de que pode fazer o jailbreak novamente apÃ³s atualizar para a versÃ£o mais recente do iOS.

As atualizaÃ§Ãµes do iOS sÃ£o baseadas em um processo de desafio-resposta (gerando os chamados blobs SHSH como resultado). O dispositivo permitirÃ¡ a instalaÃ§Ã£o do sistema operacional apenas se a resposta ao desafio for assinada pela Apple. Isso Ã© o que os pesquisadores chamam de "janela de assinatura" e Ã© a razÃ£o pela qual **vocÃª nÃ£o pode simplesmente armazenar o pacote de firmware OTA que vocÃª baixou e carregÃ¡-lo no dispositivo sempre que quiser**. Durante atualizaÃ§Ãµes menores do iOS, duas versÃµes podem ser assinadas pela Apple (a mais recente e a versÃ£o anterior do iOS). Essa Ã© a Ãºnica situaÃ§Ã£o em que vocÃª pode fazer o downgrade do dispositivo iOS. VocÃª pode **verificar a janela de assinatura atual e baixar o firmware OTA do** [**site IPSW Downloads**](https://ipsw.me).

{% hint style="danger" %}
**Atualizar o sistema operacional remove o efeito do jailbreak**.
{% endhint %}

### Tipos de Jailbreak

* **Jailbreaks tethered** nÃ£o persistem apÃ³s reinicializaÃ§Ãµes, portanto, reaplicar o jailbreak requer que o dispositivo esteja conectado (tethered) a um computador durante cada reinicializaÃ§Ã£o. O dispositivo pode nem reiniciar se o computador nÃ£o estiver conectado.
* **Jailbreaks semi-tethered** nÃ£o podem ser reaplicados a menos que o dispositivo esteja conectado a um computador durante a reinicializaÃ§Ã£o. O dispositivo tambÃ©m pode inicializar no modo nÃ£o jailbroken por conta prÃ³pria.
* **Jailbreaks semi-untethered** permitem que o dispositivo inicialize por conta prÃ³pria, mas os patches do kernel (ou modificaÃ§Ãµes no espaÃ§o do usuÃ¡rio) para desabilitar a assinatura de cÃ³digo nÃ£o sÃ£o aplicados automaticamente. O usuÃ¡rio deve fazer o jailbreak novamente iniciando um aplicativo ou visitando um site (nÃ£o requer uma conexÃ£o com um computador, daÃ­ o termo untethered).
* **Jailbreaks untethered** sÃ£o a escolha mais popular para os usuÃ¡rios finais, pois precisam ser aplicados apenas uma vez, apÃ³s o qual o dispositivo ficarÃ¡ permanentemente jailbroken.

### Ferramentas de Jailbreak

Diferentes versÃµes do iOS requerem **tÃ©cnicas de jailbreak diferentes**. [Verifique se hÃ¡ um jailbreak pÃºblico disponÃ­vel para a sua versÃ£o do iOS](https://canijailbreak.com). Cuidado com ferramentas falsas e spyware, que muitas vezes se escondem por trÃ¡s de nomes de domÃ­nio semelhantes ao nome do grupo/autor do jailbreak.

Exemplos de versÃµes:

* [Checkra1n](https://checkra.in/): Funciona em dispositivos com o chip A7 e mais recentes, como o iPhone 5S atÃ© o iPhone X.
* [Palera1n](https://palera.in/): Dispositivos Checkm8 (A8-A11) no iOS 15.0-16.5.
* [Unc0ver](https://checkra.in/): Funciona apenas para versÃµes do iOS atÃ© 14.8, pois a Apple corrigiu as falhas que permitiam a execuÃ§Ã£o do Unc0ver.

A cena de jailbreak do iOS evolui tÃ£o rapidamente que fornecer instruÃ§Ãµes atualizadas Ã© difÃ­cil. No entanto, podemos indicar algumas fontes que sÃ£o atualmente confiÃ¡veis:

* [**Can I Jailbreak?**](https://canijailbreak.com)
* [**The iPhone Wiki**](https://www.theiphonewiki.com)
* [**Redmond Pie**](https://www.redmondpie.com)
* [**Reddit Jailbreak**](https://www.reddit.com/r/jailbreak/)
* [**https://checkra.in/**](https://checkra.in)

> Observe que qualquer modificaÃ§Ã£o que vocÃª fizer em seu dispositivo Ã© por sua conta e risco. Embora o jailbreak seja geralmente seguro, as coisas podem dar errado e vocÃª pode acabar danificando seu dispositivo. Nenhuma outra parte, exceto vocÃª mesmo, pode ser responsabilizada por qualquer dano.
### BenefÃ­cios

O efeito colateral mais importante do Jailbreaking Ã© que ele **remove qualquer sandboxing implementado pelo sistema operacional**. Portanto, qualquer **aplicativo no dispositivo pode ler qualquer arquivo** no sistema de arquivos, incluindo arquivos de outros aplicativos, cookies e chaveiro.

Um dispositivo com Jailbreak permite aos usuÃ¡rios **instalar aplicativos nÃ£o aprovados** e aproveitar **mais APIs**, que de outra forma nÃ£o seriam acessÃ­veis.

{% hint style="warning" %}
**NÃ£o Ã© recomendado fazer Jailbreak no dispositivo mÃ³vel para usuÃ¡rios comuns**
{% endhint %}

### **ApÃ³s o Jailbreak**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **DetecÃ§Ã£o de Jailbreak**

**VÃ¡rios aplicativos tentarÃ£o detectar se o dispositivo mÃ³vel estÃ¡ com Jailbreak e, nesse caso, o aplicativo nÃ£o serÃ¡ executado**

* ApÃ³s o Jailbreak de um iOS, **arquivos e pastas geralmente sÃ£o instalados**, que podem ser pesquisados para determinar se o dispositivo estÃ¡ com Jailbreak.
* Em um dispositivo com Jailbreak, os aplicativos obtÃªm **acesso de leitura/escrita a novos arquivos** fora da sandbox.
* Algumas **chamadas de API** se comportarÃ£o de maneira diferente.
* A presenÃ§a do serviÃ§o **OpenSSH**
* Chamar `/bin/sh` retornarÃ¡ 1 em vez de 0

**Mais informaÃ§Ãµes sobre como detectar Jailbreak** [**aqui**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

VocÃª pode tentar evitar essas detecÃ§Ãµes usando o comando `ios jailbreak disable` do **objection**.

## **Burlando a DetecÃ§Ã£o de Jailbreak**

* VocÃª pode tentar evitar essas detecÃ§Ãµes usando o comando `ios jailbreak disable` do **objection**.
* VocÃª tambÃ©m pode instalar a ferramenta **Liberty Lite** (https://ryleyangus.com/repo/). Depois de adicionar o repositÃ³rio, o aplicativo deve aparecer na guia 'Pesquisar'

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
