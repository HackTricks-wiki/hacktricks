<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **nete al grupo de**  [**Discord**](https://discord.gg/hRep4RUj7f) o al grupo de [**telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


# Compartir UIActivity

A partir de iOS 6 es posible que aplicaciones de terceros **compartan datos (elementos)** a trav茅s de mecanismos espec铆ficos [como AirDrop, por ejemplo](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Desde la perspectiva del usuario, esta caracter铆stica es la conocida hoja de actividad de compartir del sistema que aparece despu茅s de hacer clic en el bot贸n "Compartir".

Una lista completa de los mecanismos de compartici贸n integrados disponibles se puede encontrar en [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Si no se consideran apropiados para la aplicaci贸n, los **desarrolladores tienen la posibilidad de excluir algunos de estos mecanismos de compartici贸n**.

## **Enviando Elementos**

Al probar la Compartici贸n `UIActivity`, debes prestar especial atenci贸n a:

* los datos (elementos) que se est谩n compartiendo,
* las actividades personalizadas,
* los tipos de actividad excluidos.

La compartici贸n de datos a trav茅s de `UIActivity` funciona creando un `UIActivityViewController` y pas谩ndole los elementos deseados (URLs, texto, una imagen) en [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Si tienes el c贸digo fuente, debes echar un vistazo al `UIActivityViewController`:

* Inspecciona las actividades pasadas al m茅todo `init(activityItems:applicationActivities:)`.
* Comprueba si define actividades personalizadas (tambi茅n pasadas al m茅todo anterior).
* Verifica los `excludedActivityTypes`, si los hay.

Si solo tienes la aplicaci贸n compilada/instalada, intenta buscar el m茅todo y la propiedad anteriores, por ejemplo:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **Recepci贸n de Elementos**

Al recibir elementos, debes verificar:

* si la aplicaci贸n **declara** _**tipos de documentos personalizados**_ mirando en **Exported/Imported UTIs** (pesta帽a "Info" del proyecto Xcode). La lista de todos los UTIs declarados por el sistema (Identificadores de Tipo Uniforme) se puede encontrar en la [documentaci贸n archivada de Apple Developer](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259).
* si la aplicaci贸n especifica _**tipos de documentos que puede abrir**_ mirando en **Document Types** (pesta帽a "Info" del proyecto Xcode). Si est谩n presentes, consisten en un nombre y uno o m谩s UTIs que representan el tipo de datos (por ejemplo, "public.png" para archivos PNG). iOS utiliza esto para determinar si la aplicaci贸n es elegible para abrir un documento dado (especificar Exported/Imported UTIs no es suficiente).
* si la aplicaci贸n _**verifica adecuadamente los datos recibidos**_ mirando en la implementaci贸n de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (o su versi贸n obsoleta [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) en el delegado de la aplicaci贸n.

Si no tienes el c贸digo fuente, a煤n puedes echar un vistazo al archivo `Info.plist` y buscar:

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` si la aplicaci贸n declara _tipos de documentos personalizados_ exportados/importados.
* `CFBundleDocumentTypes` para ver si la aplicaci贸n especifica _tipos de documentos que puede abrir_.

Una explicaci贸n muy completa sobre el uso de estas claves se puede encontrar [en Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i) pero aqu铆 tienes un resumen:

* `UTExportedTypeDeclarations`: salos para definir **tus propios UTIs** que tu aplicaci贸n quiere ense帽ar al sistema en el que est谩 instalada. Un **UTI describe un fragmento de datos** (_隆no necesariamente datos ubicados dentro de un archivo!_) y requiere al menos un **identificador** (`com.example.MyCoolDataType`). Adicionalmente puede tener un **nombre** (`My Cool Data Type`), una o m谩s extensiones de **archivo** (`.myCoolDataType`), uno o m谩s **tipos MIME** (`x-application/my-cool-data-type`), uno o m谩s **tipos de portapapeles** (usados cuando se transfieren datos de ese tipo usando copiar y pegar), y uno o m谩s **tipos de sistema operativo antiguos**. Usualmente tambi茅n quieres que los UTIs se conformen a UTIs existentes (por ejemplo, cuando dices que tu UTI se conforma a `public.data`, cualquier proceso que pueda tratar con datos gen茅ricos tambi茅n puede tratar con tu UTI).
* Ej.: Definiste tu propio formato de archivo de datos propietario y quieres que este formato de datos tambi茅n sea conocido por otras aplicaciones, plugins, extensiones, etc.
* `UTImportedTypeDeclarations`: Usas `UTImportedTypeDeclarations` para **ense帽ar al sistema sobre UTIs que quieres que sean conocidos en el sistema pero que no son tus UTIs**.
* Ej.: Tu aplicaci贸n es capaz de leer el formato de datos propietario de otra aplicaci贸n, pero no sabes si esa aplicaci贸n est谩 siquiera instalada en el sistema.
* `CFBundleDocumentTypes`: Usas `CFBundleDocumentTypes` para decirle al sistema qu茅 tipos de documentos tu aplicaci贸n es capaz de abrir. A menos que **tambi茅n listes tus UTIs aqu铆**, estos UTIs no se asocian con tu aplicaci贸n en Finder y tu aplicaci贸n no aparecer谩 en el men煤 `Abrir con >`. \
Lo 煤nico que siempre debes establecer para un tipo de documento es el rol. El **rol** puede ser "**Viewer**" (puedes mostrar ese tipo de archivo pero no puedes editarlo), "**Editor**" (puedes mostrar y editar ese tipo de archivo), "**None**" (no est谩 especificado qu茅 puedes hacer con ese archivo).
* Ej.: Quieres que tu **aplicaci贸n est茅 asociada con ciertos tipos de archivos**, identificados ya sea por extensi贸n, por tipo MIME o por identificador UTI. **Si quieres que tu aplicaci贸n est茅 asociada con un tipo de UTI, la aplicaci贸n debe importar o exportar el tipo**, de lo contrario el tipo puede no ser conocido por el sistema y registrarse en un tipo de UTI desconocido simplemente no tiene efecto alguno.

## Pruebas Din谩micas

Para **actividades de env铆o** puedes:

* Enganchar el m茅todo que hemos visto en el an谩lisis est谩tico ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) para obtener los `activityItems` y `applicationActivities`.
* Descubrir las actividades excluidas enganchando la propiedad [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Para recibir elementos puedes:

* _Compartir_ un archivo con la aplicaci贸n desde otra aplicaci贸n o enviarlo a trav茅s de AirDrop o correo electr贸nico. Elige el archivo de tal manera que active el di谩logo "Abrir con..." (es decir, no hay una aplicaci贸n predeterminada que abrir谩 el archivo, un PDF por ejemplo).
* Enganchar `application:openURL:options:` y cualquier otro m茅todo que se haya identificado en un an谩lisis est谩tico previo.
* Observar el comportamiento de la aplicaci贸n.
* Adem谩s, podr铆as enviar archivos malformados espec铆ficos y/o utilizar una t茅cnica de fuzzing.

**Lee c贸mo** [**aqu铆**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
