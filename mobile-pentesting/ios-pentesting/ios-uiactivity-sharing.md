# Compartilhamento de UIActivity

A partir do iOS 6, Ã© possÃ­vel para aplicativos de terceiros **compartilhar dados (itens)** por meio de mecanismos especÃ­ficos [como o AirDrop, por exemplo](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple\_ref/doc/uid/TP40007072-CH6-SW3). Do ponto de vista do usuÃ¡rio, esse recurso Ã© a conhecida _folha de atividade de compartilhamento_ do sistema que aparece apÃ³s clicar no botÃ£o "Compartilhar".

Uma lista completa dos mecanismos de compartilhamento integrados disponÃ­veis pode ser encontrada em [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Se nÃ£o considerado apropriado para o aplicativo, os **desenvolvedores tÃªm a possibilidade de excluir alguns desses mecanismos de compartilhamento**.

## **Enviando itens**

Ao testar o Compartilhamento de UIActivity, vocÃª deve prestar atenÃ§Ã£o especial em:

* os dados (itens) sendo compartilhados,
* as atividades personalizadas,
* os tipos de atividade excluÃ­dos.

O compartilhamento de dados via `UIActivity` funciona criando um `UIActivityViewController` e passando os itens desejados (URLs, texto, uma imagem) em [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Se vocÃª tiver o cÃ³digo-fonte, deve dar uma olhada no `UIActivityViewController`:

* Inspecione as atividades passadas para o mÃ©todo `init(activityItems:applicationActivities:)`.
* Verifique se ele define atividades personalizadas (tambÃ©m sendo passadas para o mÃ©todo anterior).
* Verifique os `excludedActivityTypes`, se houver.

Se vocÃª sÃ³ tem o aplicativo compilado/instalado, tente procurar pelo mÃ©todo e propriedade anterior, por exemplo:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **Recebendo itens**

Ao receber itens, vocÃª deve verificar:

* se o aplicativo **declara** _**tipos de documentos personalizados**_ olhando em **UTIs exportados/importados** ("InformaÃ§Ãµes" na guia do projeto Xcode). A lista de todas as UTIs declaradas pelo sistema pode ser encontrada na [DocumentaÃ§Ã£o do Desenvolvedor da Apple arquivada](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple\_ref/doc/uid/TP40009259).
* se o aplicativo especifica quais _**tipos de documentos que ele pode abrir**_ olhando em **Tipos de Documentos** ("InformaÃ§Ãµes" na guia do projeto Xcode). Se presente, eles consistem em nome e uma ou mais UTIs que representam o tipo de dados (por exemplo, "public.png" para arquivos PNG). O iOS usa isso para determinar se o aplicativo Ã© elegÃ­vel para abrir um determinado documento (especificar UTIs exportados/importados nÃ£o Ã© suficiente).
* se o aplicativo verifica corretamente os dados recebidos olhando para a implementaÃ§Ã£o de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (ou sua versÃ£o obsoleta [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) no delegado do aplicativo.

Se nÃ£o tiver o cÃ³digo-fonte, vocÃª ainda pode dar uma olhada no arquivo `Info.plist` e procurar por:

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` se o aplicativo declara _tipos de documentos personalizados_ exportados/importados.
* `CFBundleDocumentTypes` para ver se o aplicativo especifica quais _tipos de documentos que ele pode abrir_.

Uma explicaÃ§Ã£o muito completa sobre o uso dessas chaves pode ser encontrada [no Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), mas aqui vocÃª tem um resumo:

* `UTExportedTypeDeclarations`: Use-os para definir **suas prÃ³prias UTIs** que seu aplicativo deseja ensinar ao sistema em que estÃ¡ instalado. Uma **UTI descreve um pedaÃ§o de dados** (_nÃ£o necessariamente dados localizados dentro de um arquivo!_) e requer pelo menos um **identificador** (`com.example.MyCoolDataType`). AlÃ©m disso, pode ter um **nome** (`My Cool Data Type`), uma ou mais **extensÃµes de nome de arquivo** (`.myCoolDataType`), um ou mais **tipos MIME** (`x-application/my-cool-data-type`), um ou mais **tipos de prancheta** (usados ao transferir dados desse tipo usando copiar e colar) e um ou mais **tipos de sistema operacional legado**. Geralmente, vocÃª tambÃ©m deseja que as UTIs se conformem Ã s UTIs existentes (por exemplo, quando vocÃª diz que sua UTI se conforma com `public.data`, qualquer processo que possa lidar com dados genÃ©ricos tambÃ©m pode lidar com sua UTI).
  * por exemplo: vocÃª define seu prÃ³prio formato de dados de arquivo proprietÃ¡rio e deseja que esse formato de dados tambÃ©m seja conhecido por outros aplicativos, plug-ins, extensÃµes, etc.
* `UTImportedTypeDeclarations`: VocÃª usa `UTImportedTypeDeclarations` para **ensinar o sistema sobre UTIs que vocÃª deseja que sejam conhecidas no sistema, mas que nÃ£o sÃ£o suas UTIs**.
  * por exemplo: seu aplicativo Ã© capaz de ler o formato de dados proprietÃ¡rio de outro aplicativo, mas vocÃª nÃ£o sabe se esse aplicativo estÃ¡ instalado no sistema.
* `CFBundleDocumentTypes`: VocÃª usa `CFBundleDocumentTypes` para informar ao sistema quais tipos de documentos seu aplicativo Ã© capaz de abrir. A menos que vocÃª **tambÃ©m liste suas UTIs aqui**, essas UTIs nÃ£o estÃ£o associadas ao seu aplicativo no Finder e seu aplicativo nÃ£o aparecerÃ¡ no menu `Abrir com >`. \
A Ãºnica coisa que vocÃª sempre deve definir para um tipo de documento Ã© o papel. O **papel** pode ser "**Visualizador**" (vocÃª pode exibir esse tipo de arquivo, mas nÃ£o pode editÃ¡-lo), "**Editor**" (vocÃª pode exibir e editar esse tipo de arquivo) ou "**Nenhum**" (nÃ£o Ã© especificado o que vocÃª pode fazer com esse tipo de arquivo).
  * por exemplo: vocÃª deseja que seu **aplicativo seja associado a determinados tipos de arquivo**, identificados por extensÃ£o, tipo MIME ou identificador UTI. **Se vocÃª deseja que seu aplicativo seja associado a um tipo de UTI, o aplicativo deve importar ou exportar o tipo**, caso contrÃ¡rio, o tipo pode nÃ£o ser conhecido pelo sistema e o registro em um tipo de UTI desconhecido nÃ£o tem efeito algum.

## Teste DinÃ¢mico

Para **enviar atividades**, vocÃª pode:

* Hook o mÃ©todo que vimos na anÃ¡lise estÃ¡tica ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) para obter os `activityItems` e `applicationActivities`.
* Descobrir as atividades excluÃ­das hookando a propriedade [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Para receber itens, vocÃª pode:

* _Compartilhar_ um arquivo com o aplicativo de outro aplicativo ou enviÃ¡-lo via AirDrop ou e-mail. Escolha o arquivo para que ele acione o diÃ¡logo "Abrir com..." (ou seja, nÃ£o hÃ¡ um aplicativo padrÃ£o que abrirÃ¡ o arquivo, um PDF, por exemplo).
* Hook `application:openURL:options:` e quaisquer outros mÃ©todos que foram identificados em uma anÃ¡lise estÃ¡tica anterior.
* Observar o comportamento do aplicativo.
* AlÃ©m disso, vocÃª pode enviar arquivos especÃ­ficos malformados e/ou usar uma tÃ©cnica de fuzzing.

**Leia mais** [**aqui**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
