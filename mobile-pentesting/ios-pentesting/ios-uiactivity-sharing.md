# Compartir UIActivity

A partir de iOS 6, es posible que las aplicaciones de terceros **compartan datos (elementos)** a travÃ©s de mecanismos especÃ­ficos [como AirDrop, por ejemplo](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple\_ref/doc/uid/TP40007072-CH6-SW3). Desde la perspectiva del usuario, esta funciÃ³n es la conocida hoja de actividad de _compartir_ en todo el sistema que aparece despuÃ©s de hacer clic en el botÃ³n "Compartir".

Una lista completa de los mecanismos de intercambio integrados disponibles se puede encontrar en [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Si no se considera apropiado para la aplicaciÃ³n, los **desarrolladores tienen la posibilidad de excluir algunos de estos mecanismos de intercambio**.

## **EnvÃ­o de elementos**

Al probar la ComparticiÃ³n de UIActivity, debe prestar especial atenciÃ³n a:

* los datos (elementos) que se comparten,
* las actividades personalizadas,
* los tipos de actividad excluidos.

El intercambio de datos a travÃ©s de `UIActivity` funciona creando un `UIActivityViewController` y pasÃ¡ndole los elementos deseados (URL, texto, una imagen) en [`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init).

Si tiene el cÃ³digo fuente, debe echar un vistazo al `UIActivityViewController`:

* Inspeccione las actividades pasadas al mÃ©todo `init(activityItems:applicationActivities:)`.
* Compruebe si define actividades personalizadas (que tambiÃ©n se pasan al mÃ©todo anterior).
* Verifique los `excludedActivityTypes`, si los hay.

Si solo tiene la aplicaciÃ³n compilada/instalada, intente buscar el mÃ©todo y la propiedad anterior, por ejemplo:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
## **Recibiendo elementos**

Al recibir elementos, debes verificar:

* si la aplicaciÃ³n **declara** _**tipos de documentos personalizados**_ mirando en los UTI exportados/importados ("InformaciÃ³n" en el proyecto Xcode). La lista de todos los UTI declarados por el sistema se puede encontrar en la [DocumentaciÃ³n de desarrolladores de Apple archivada](https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259).
* si la aplicaciÃ³n especifica algÃºn _**tipo de documento que puede abrir**_ mirando en los Tipos de documento ("InformaciÃ³n" en el proyecto Xcode). Si estÃ¡ presente, consisten en un nombre y uno o mÃ¡s UTI que representan el tipo de datos (por ejemplo, "public.png" para archivos PNG). iOS utiliza esto para determinar si la aplicaciÃ³n es elegible para abrir un documento determinado (especificar UTI exportados/importados no es suficiente).
* si la aplicaciÃ³n verifica adecuadamente los datos recibidos mirando en la implementaciÃ³n de [`application:openURL:options:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623112-application?language=objc) (o su versiÃ³n obsoleta [`UIApplicationDelegate application:openURL:sourceApplication:annotation:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623073-application?language=objc)) en el delegado de la aplicaciÃ³n.

Si no tienes el cÃ³digo fuente, aÃºn puedes echar un vistazo al archivo `Info.plist` y buscar:

* `UTExportedTypeDeclarations`/`UTImportedTypeDeclarations` si la aplicaciÃ³n declara tipos de documentos personalizados exportados/importados.
* `CFBundleDocumentTypes` para ver si la aplicaciÃ³n especifica algÃºn tipo de documento que puede abrir.

Una explicaciÃ³n muy completa sobre el uso de estas claves se puede encontrar [en Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), pero aquÃ­ tienes un resumen:

* `UTExportedTypeDeclarations`: Ãšsalos para definir **tus propios UTI** que tu aplicaciÃ³n quiere enseÃ±ar al sistema en el que estÃ¡ instalado. Un **UTI describe un fragmento de datos** (_Â¡no necesariamente datos ubicados dentro de un archivo!_) y requiere al menos un **identificador** (`com.example.MyCoolDataType`). AdemÃ¡s, puede tener un **nombre** (`Mi tipo de datos genial`), una o mÃ¡s **extensiones de nombre de archivo** (`.myCoolDataType`), uno o mÃ¡s **tipos MIME** (`x-application/my-cool-data-type`), uno o mÃ¡s **tipos de portapapeles** (usados cuando se transfieren datos de ese tipo usando copiar y pegar), y uno o mÃ¡s **tipos de sistema operativo heredados**. Por lo general, tambiÃ©n deseas que los UTI se ajusten a los UTI existentes (por ejemplo, cuando dices que tu UTI se ajusta a `public.data`, cualquier proceso que pueda manejar datos genÃ©ricos tambiÃ©n puede manejar tu UTI).
  * por ejemplo: Definir tu propio formato de datos de archivo patentado y quieres que este formato de datos sea conocido tambiÃ©n por otras aplicaciones, complementos, extensiones, etc.
* `UTImportedTypeDeclarations`: Usas `UTImportedTypeDeclarations` para **enseÃ±ar al sistema sobre UTI que deseas que se conozcan en el sistema pero que no son tus UTI**.
  * por ejemplo: Tu aplicaciÃ³n puede leer el formato de datos patentado de otra aplicaciÃ³n, pero no sabes si esa aplicaciÃ³n estÃ¡ instalada en el sistema.
* `CFBundleDocumentTypes`: Usas `CFBundleDocumentTypes` para decirle al sistema quÃ© tipos de documentos puede abrir tu aplicaciÃ³n. A menos que **tambiÃ©n listes tus UTI aquÃ­**, estos UTI no estÃ¡n asociados con tu aplicaciÃ³n en Finder y tu aplicaciÃ³n no aparecerÃ¡ en el menÃº `Abrir con >`. \
Lo Ãºnico que siempre debes establecer para un tipo de documento es el rol. El **rol** puede ser "**Visor**" (puedes mostrar ese tipo de archivo pero no puedes editarlo), "**Editor**" (puedes mostrar y editar ese tipo de archivo), "**Ninguno**" (no se especifica lo que puedes hacer con ese archivo).
  * por ejemplo: Quieres que tu **aplicaciÃ³n se asocie con ciertos tipos de archivo**, identificados ya sea por extensiÃ³n, por tipo MIME o por identificador UTI. **Si deseas que tu aplicaciÃ³n se asocie con un tipo de UTI, la aplicaciÃ³n debe importar o exportar el tipo**, de lo contrario, el tipo puede no ser conocido por el sistema y registrarse en un tipo de UTI desconocido no tiene ningÃºn efecto en absoluto.

## Pruebas dinÃ¡micas

Para **enviar actividades** puedes:

* Enganchar el mÃ©todo que hemos visto en el anÃ¡lisis estÃ¡tico ([`init(activityItems:applicationActivities:)`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622019-init)) para obtener los `activityItems` y `applicationActivities`.
* Descubrir las actividades excluidas enganchando la propiedad [`excludedActivityTypes`](https://developer.apple.com/documentation/uikit/uiactivityviewcontroller/1622009-excludedactivitytypes).

Para recibir elementos puedes:

* _Compartir_ un archivo con la aplicaciÃ³n desde otra aplicaciÃ³n o enviarlo por AirDrop o correo electrÃ³nico. Elije el archivo para que desencadene el diÃ¡logo "Abrir con..." (es decir, no hay una aplicaciÃ³n predeterminada que abra el archivo, un PDF, por ejemplo).
* Enganchar `application:openURL:options:` y cualquier otro mÃ©todo que se haya identificado en un anÃ¡lisis estÃ¡tico anterior.
* Observar el comportamiento de la aplicaciÃ³n.
* AdemÃ¡s, podrÃ­as enviar archivos especÃ­ficos malformados y/o usar una tÃ©cnica de fuzzing.

**Lee cÃ³mo hacerlo** [**aquÃ­**](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#dynamic-analysis-8)**.**


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿o quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)

- Consigue el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
