# Compartir UIActivity de iOS

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**oficial mercanc铆a de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# Compartir UIActivity Simplificado

Desde iOS 6 en adelante, las aplicaciones de terceros han podido **compartir datos** como texto, URLs o im谩genes utilizando mecanismos como AirDrop, como se describe en la [gu铆a de Comunicaci贸n entre Aplicaciones de Apple](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Esta funci贸n se manifiesta a trav茅s de una _hoja de actividad de compartir_ a nivel del sistema que aparece al interactuar con el bot贸n "Compartir".

Una enumeraci贸n completa de todas las opciones de compartir integradas est谩 disponible en [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Los desarrolladores pueden optar por excluir opciones de compartir espec铆ficas si las consideran inadecuadas para su aplicaci贸n.

## **C贸mo Compartir Datos**

La atenci贸n debe dirigirse a:

- La naturaleza de los datos que se comparten.
- La inclusi贸n de actividades personalizadas.
- La exclusi贸n de ciertos tipos de actividades.

El compartir se facilita mediante la instanciaci贸n de un `UIActivityViewController`, al cual se le pasan los elementos destinados a compartir. Esto se logra llamando a:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Los desarrolladores deben examinar el `UIActivityViewController` para las actividades y actividades personalizadas con las que se inicializa, as铆 como cualquier `excludedActivityTypes` especificado.

## **C贸mo recibir datos**

Los siguientes aspectos son cruciales al recibir datos:

- La declaraci贸n de **tipos de documento personalizados**.
- La especificaci贸n de **tipos de documento que la aplicaci贸n puede abrir**.
- La verificaci贸n de la **integridad de los datos recibidos**.

Sin acceso al c贸digo fuente, a煤n se puede inspeccionar el `Info.plist` en busca de claves como `UTExportedTypeDeclarations`, `UTImportedTypeDeclarations` y `CFBundleDocumentTypes` para comprender los tipos de documentos que una aplicaci贸n puede manejar y declarar.

Una gu铆a concisa sobre estas claves est谩 disponible en [Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), resaltando la importancia de definir e importar UTIs para el reconocimiento a nivel del sistema y asociar tipos de documentos con su aplicaci贸n para la integraci贸n en el di谩logo "Abrir con".

## Enfoque de prueba din谩mica

Para probar **actividades de env铆o**, se podr铆a:

- Engancharse en el m茅todo `init(activityItems:applicationActivities:)` para capturar los elementos y actividades compartidos.
- Identificar actividades excluidas interceptando la propiedad `excludedActivityTypes`.

Para **recibir elementos**, implica:

- Compartir un archivo con la aplicaci贸n desde otra fuente (por ejemplo, AirDrop, correo electr贸nico) que solicite el di谩logo "Abrir con...".
- Enganchar `application:openURL:options:` entre otros m茅todos identificados durante el an谩lisis est谩tico para observar la respuesta de la aplicaci贸n.
- Emplear archivos malformados o t茅cnicas de fuzzing para evaluar la solidez de la aplicaci贸n.

## Referencias
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

<details>

<summary><strong>Aprende a hackear AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
