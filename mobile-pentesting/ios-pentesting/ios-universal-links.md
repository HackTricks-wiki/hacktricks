<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Os links universais permitem **redirecionar usuÃ¡rios diretamente** para o aplicativo sem passar pelo Safari para redirecionamento.\
Os links universais sÃ£o **Ãºnicos**, entÃ£o eles **nÃ£o podem ser reivindicados por outros aplicativos** porque usam links HTTP(S) padrÃ£o para o **site onde o proprietÃ¡rio carregou um arquivo para garantir que o site e o aplicativo estejam relacionados**.\
Como esses links usam esquemas HTTP(S), quando o **aplicativo nÃ£o estÃ¡ instalado, o Safari abrirÃ¡ o link** redirecionando os usuÃ¡rios para a pÃ¡gina. Isso permite que **os aplicativos se comuniquem com o aplicativo mesmo que ele nÃ£o esteja instalado**.

Para criar links universais, Ã© necessÃ¡rio **criar um arquivo JSON chamado `apple-app-site-association`** com os detalhes. Em seguida, este arquivo precisa ser **hospedado no diretÃ³rio raiz do seu servidor da web** (por exemplo, [https://google.com/apple-app-site-association](https://google.com/apple-app-site-association)).\
Para o pentester, este arquivo Ã© muito interessante, pois **revela caminhos**. Ele pode atÃ© estar revelando caminhos de lanÃ§amentos que ainda nÃ£o foram publicados.

## **Verificando a AutorizaÃ§Ã£o de DomÃ­nios Associados**

No Xcode, vÃ¡ para a guia **Capabilities** e procure por **Associated Domains**. VocÃª tambÃ©m pode inspecionar o arquivo `.entitlements` procurando por `com.apple.developer.associated-domains`. Cada um dos domÃ­nios deve ser prefixado com `applinks:`, como `applinks:www.mywebsite.com`.

Aqui estÃ¡ um exemplo do arquivo `.entitlements` do Telegram:
```markup
    <key>com.apple.developer.associated-domains</key>
    <array>
        <string>applinks:telegram.me</string>
        <string>applinks:t.me</string>
    </array>
```
Mais informaÃ§Ãµes detalhadas podem ser encontradas na [DocumentaÃ§Ã£o do Desenvolvedor da Apple arquivada](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Se vocÃª sÃ³ tem o aplicativo compilado, pode extrair as permissÃµes seguindo este guia:

{% content-ref url="extracting-entitlements-from-compiled-application.md" %}
[extracting-entitlements-from-compiled-application.md](extracting-entitlements-from-compiled-application.md)
{% endcontent-ref %}

## Recuperando o Arquivo de AssociaÃ§Ã£o do Site do Aplicativo da Apple

Tente recuperar o arquivo `apple-app-site-association` do servidor usando os domÃ­nios associados que vocÃª obteve na etapa anterior. Este arquivo precisa ser acessÃ­vel via HTTPS, sem redirecionamentos, em `https://<domain>/apple-app-site-association` ou `https://<domain>/.well-known/apple-app-site-association`.

VocÃª pode recuperÃ¡-lo com seu navegador ou usar o [Validador de AssociaÃ§Ã£o do Site do Aplicativo da Apple (AASA)](https://branch.io/resources/aasa-validator/).

## Verificando o MÃ©todo de RecepÃ§Ã£o de Links

Para receber links e manipulÃ¡-los adequadamente, o delegado do aplicativo deve implementar [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Se vocÃª tiver o projeto original, tente procurar por este mÃ©todo.

Observe que se o aplicativo usar [`openURL:options:completionHandler:`](https://developer.apple.com/documentation/uikit/uiapplication/1648685-openurl?language=objc) para abrir um link universal para o site do aplicativo, o link nÃ£o serÃ¡ aberto no aplicativo. Como a chamada se origina do aplicativo, ela nÃ£o serÃ¡ tratada como um link universal.

* O esquema do `webpageURL` deve ser HTTP ou HTTPS (qualquer outro esquema deve gerar uma exceÃ§Ã£o). A propriedade de instÃ¢ncia [`scheme`](https://developer.apple.com/documentation/foundation/urlcomponents/1779624-scheme) de `URLComponents` / `NSURLComponents` pode ser usada para verificar isso.

## Verificando o MÃ©todo de ManipulaÃ§Ã£o de Dados

Quando o iOS abre um aplicativo como resultado de um link universal, o aplicativo recebe um objeto `NSUserActivity` com um valor de `activityType` de `NSUserActivityTypeBrowsingWeb`. A propriedade `webpageURL` do objeto de atividade contÃ©m o URL HTTP ou HTTPS que o usuÃ¡rio acessa. O seguinte exemplo em Swift verifica exatamente isso antes de abrir o URL:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
                 restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
    // ...
    if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
        application.open(url, options: [:], completionHandler: nil)
    }

    return true
}
```
AlÃ©m disso, lembre-se de que se a URL incluir parÃ¢metros, eles nÃ£o devem ser confiÃ¡veis antes de serem cuidadosamente sanitizados e validados (mesmo quando provenientes de um domÃ­nio confiÃ¡vel). Por exemplo, eles podem ter sido falsificados por um atacante ou podem incluir dados malformados. Se esse for o caso, toda a URL e, portanto, a solicitaÃ§Ã£o de link universal devem ser descartadas.

A API `NSURLComponents` pode ser usada para analisar e manipular os componentes da URL. Isso tambÃ©m pode fazer parte do mÃ©todo `application:continueUserActivity:restorationHandler:` em si ou pode ocorrer em um mÃ©todo separado chamado a partir dele. O seguinte [exemplo](https://developer.apple.com/documentation/uikit/core\_app/allowing\_apps\_and\_websites\_to\_link\_to\_your\_content/handling\_universal\_links#3001935) demonstra isso:
```swift
func application(_ application: UIApplication,
                 continue userActivity: NSUserActivity,
                 restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
    guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
        let incomingURL = userActivity.webpageURL,
        let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
        let path = components.path,
        let params = components.queryItems else {
        return false
    }

    if let albumName = params.first(where: { $0.name == "albumname" })?.value,
        let photoIndex = params.first(where: { $0.name == "index" })?.value {
        // Interact with album name and photo index

        return true

    } else {
        // Handle when album and/or album name or photo index missing

        return false
    }
}
```
# ReferÃªncias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
