<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


Los enlaces universales permiten **redirigir a los usuarios directamente** a la aplicaciÃ³n sin pasar por Safari para la redirecciÃ³n.\
Los enlaces universales son **Ãºnicos**, por lo que no pueden ser reclamados por otras aplicaciones porque utilizan enlaces HTTP(S) estÃ¡ndar al **sitio web donde el propietario ha subido un archivo para asegurarse de que el sitio web y la aplicaciÃ³n estÃ¡n relacionados**.\
Como estos enlaces utilizan esquemas HTTP(S), cuando la **aplicaciÃ³n no estÃ¡ instalada, Safari abrirÃ¡ el enlace** redirigiendo a los usuarios a la pÃ¡gina. Esto permite que las **aplicaciones se comuniquen con la aplicaciÃ³n incluso si no estÃ¡ instalada**.

Para crear enlaces universales es necesario **crear un archivo JSON llamado `apple-app-site-association`** con los detalles. Luego, este archivo debe ser **alojado en el directorio raÃ­z de su servidor web** (por ejemplo, [https://google.com/apple-app-site-association](https://google.com/apple-app-site-association)).\
Para el pentester, este archivo es muy interesante ya que **revela rutas**. Incluso puede estar revelando rutas de versiones que aÃºn no se han publicado.

## â€‹**ComprobaciÃ³n de la autorizaciÃ³n de dominios asociados**

En Xcode, vaya a la pestaÃ±a **Capabilities** y busque **Associated Domains**. TambiÃ©n puede inspeccionar el archivo `.entitlements` buscando `com.apple.developer.associated-domains`. Cada uno de los dominios debe tener el prefijo `applinks:`, como `applinks:www.mywebsite.com`.

AquÃ­ hay un ejemplo del archivo `.entitlements` de Telegram:
```markup
    <key>com.apple.developer.associated-domains</key>
    <array>
        <string>applinks:telegram.me</string>
        <string>applinks:t.me</string>
    </array>
```
Se puede encontrar informaciÃ³n mÃ¡s detallada en la [DocumentaciÃ³n de Desarrolladores de Apple archivada](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Si solo tienes la aplicaciÃ³n compilada, puedes extraer los entitlements siguiendo esta guÃ­a:

{% content-ref url="extracting-entitlements-from-compiled-application.md" %}
[extracting-entitlements-from-compiled-application.md](extracting-entitlements-from-compiled-application.md)
{% endcontent-ref %}

## **Recuperando el archivo de asociaciÃ³n de sitio de la aplicaciÃ³n de Apple**

Intenta recuperar el archivo `apple-app-site-association` del servidor utilizando los dominios asociados que obtuviste en el paso anterior. Este archivo debe ser accesible a travÃ©s de HTTPS, sin redireccionamientos, en `https://<dominio>/apple-app-site-association` o `https://<dominio>/.well-known/apple-app-site-association`.

Puedes recuperarlo tÃº mismo con tu navegador o utilizar el [Validador de AsociaciÃ³n de Sitio de AplicaciÃ³n de Apple (AASA)](https://branch.io/resources/aasa-validator/).

## **Comprobando el MÃ©todo Receptor de Enlaces**

Para recibir enlaces y manejarlos adecuadamente, el delegado de la aplicaciÃ³n debe implementar [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). Si tienes el proyecto original, intenta buscar este mÃ©todo.

Ten en cuenta que si la aplicaciÃ³n utiliza [`openURL:options:completionHandler:`](https://developer.apple.com/documentation/uikit/uiapplication/1648685-openurl?language=objc) para abrir un enlace universal al sitio web de la aplicaciÃ³n, el enlace no se abrirÃ¡ en la aplicaciÃ³n. Como la llamada se origina desde la aplicaciÃ³n, no se manejarÃ¡ como un enlace universal.

* El esquema de `webpageURL` debe ser HTTP o HTTPS (cualquier otro esquema deberÃ­a lanzar una excepciÃ³n). La propiedad de instancia [`scheme`](https://developer.apple.com/documentation/foundation/urlcomponents/1779624-scheme) de `URLComponents` / `NSURLComponents` se puede utilizar para verificar esto.

## **Comprobando el MÃ©todo Manejador de Datos**

Cuando iOS abre una aplicaciÃ³n como resultado de un enlace universal, la aplicaciÃ³n recibe un objeto `NSUserActivity` con un valor de `activityType` de `NSUserActivityTypeBrowsingWeb`. La propiedad `webpageURL` del objeto de actividad contiene la URL HTTP o HTTPS a la que accede el usuario. El siguiente ejemplo en Swift verifica exactamente esto antes de abrir la URL:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
                 restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
    // ...
    if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
        application.open(url, options: [:], completionHandler: nil)
    }

    return true
}
```
AdemÃ¡s, recuerda que si la URL incluye parÃ¡metros, no se deben confiar en ellos antes de ser cuidadosamente saneados y validados (incluso cuando provienen de un dominio de confianza). Por ejemplo, podrÃ­an haber sido falsificados por un atacante o podrÃ­an incluir datos malformados. Si ese es el caso, toda la URL y, por lo tanto, la solicitud de enlace universal deben ser descartados.

La API `NSURLComponents` se puede utilizar para analizar y manipular los componentes de la URL. Esto tambiÃ©n puede ser parte del mÃ©todo `application:continueUserActivity:restorationHandler:` en sÃ­ mismo o puede ocurrir en un mÃ©todo separado que se llama desde Ã©l. El siguiente [ejemplo](https://developer.apple.com/documentation/uikit/core\_app/allowing\_apps\_and\_websites\_to\_link\_to\_your\_content/handling\_universal\_links#3001935) lo demuestra:
```swift
func application(_ application: UIApplication,
                 continue userActivity: NSUserActivity,
                 restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
    guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
        let incomingURL = userActivity.webpageURL,
        let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
        let path = components.path,
        let params = components.queryItems else {
        return false
    }

    if let albumName = params.first(where: { $0.name == "albumname" })?.value,
        let photoIndex = params.first(where: { $0.name == "index" })?.value {
        // Interact with album name and photo index

        return true

    } else {
        // Handle when album and/or album name or photo index missing

        return false
    }
}
```
# Referencias

{% embed url="https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8" %}



<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme en** **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PR al repositorio [hacktricks](https://github.com/carlospolop/hacktricks) y al repositorio [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
