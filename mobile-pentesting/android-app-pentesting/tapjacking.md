# Tapjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **InformaciÃ³n bÃ¡sica**

**Tapjacking** es un ataque en el que se lanza una **aplicaciÃ³n maliciosa** y se **posiciona encima de una aplicaciÃ³n vÃ­ctima**. Una vez que oculta visiblemente la aplicaciÃ³n vÃ­ctima, su interfaz de usuario estÃ¡ diseÃ±ada de tal manera que engaÃ±a al usuario para que interactÃºe con ella, mientras pasa la interacciÃ³n a la aplicaciÃ³n vÃ­ctima.\
En efecto, **ciega al usuario para que no sepa que en realidad estÃ¡ realizando acciones en la aplicaciÃ³n vÃ­ctima**.

### DetecciÃ³n

Para detectar aplicaciones vulnerables a este ataque, debes buscar **actividades exportadas** en el manifiesto de Android (ten en cuenta que una actividad con un intent-filter se exporta automÃ¡ticamente por defecto). Una vez que hayas encontrado las actividades exportadas, **verifica si requieren algÃºn permiso**. Esto se debe a que la **aplicaciÃ³n maliciosa tambiÃ©n necesitarÃ¡ ese permiso**.

### ProtecciÃ³n

#### Android 12 (API 31,32) y versiones superiores

[**SegÃºn esta fuente**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** los ataques de tapjacking se previenen automÃ¡ticamente en Android a partir de Android 12 (API 31 y 30) y versiones superiores. Por lo tanto, incluso si la aplicaciÃ³n es vulnerable, **no podrÃ¡s explotarla**.

#### **`setFilterTouchesWhenObscured`**

El atributo **`setFilterTouchesWhenObscured`** establecido en true tambiÃ©n puede prevenir la explotaciÃ³n de esta vulnerabilidad si la versiÃ³n de Android es inferior.\
Si se establece en **`true`**, por ejemplo, un botÃ³n puede ser automÃ¡ticamente **deshabilitado si estÃ¡ oculto**:
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## ExplotaciÃ³n

### Tapjacking-ExportedActivity

La aplicaciÃ³n mÃ¡s **reciente de Android** que realiza un **ataque de Tapjacking** (+ invocando antes una **actividad exportada** de la aplicaciÃ³n atacada) se puede encontrar en [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Sigue las **instrucciones del README para usarla**.

### FloatingWindowApp

Un proyecto de ejemplo que implementa **FloatingWindowApp**, que se puede utilizar para colocar encima de otras actividades y realizar un ataque de clickjacking, se puede encontrar en [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un poco antiguo, buena suerte construyendo el apk).

### Qark

{% hint style="danger" %}
Parece que este proyecto ya no se mantiene y esta funcionalidad ya no funciona correctamente.
{% endhint %}

Puedes usar [**qark**](https://github.com/linkedin/qark) con los parÃ¡metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para crear una aplicaciÃ³n maliciosa y probar posibles vulnerabilidades de **Tapjacking**.

La mitigaciÃ³n es relativamente sencilla, ya que el desarrollador puede optar por no recibir eventos tÃ¡ctiles cuando una vista estÃ¡ cubierta por otra. Utilizando la [Referencia del Desarrollador de Android](https://developer.android.com/reference/android/view/View#security):

> A veces es esencial que una aplicaciÃ³n pueda verificar que una acciÃ³n se realiza con el pleno conocimiento y consentimiento del usuario, como conceder una solicitud de permiso, realizar una compra o hacer clic en un anuncio. Desafortunadamente, una aplicaciÃ³n maliciosa podrÃ­a intentar engaÃ±ar al usuario para que realice estas acciones sin darse cuenta, ocultando el propÃ³sito previsto de la vista. Como remedio, el marco ofrece un mecanismo de filtrado tÃ¡ctil que se puede utilizar para mejorar la seguridad de las vistas que proporcionan acceso a funcionalidades sensibles.
>
> Para habilitar el filtrado tÃ¡ctil, llama a [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o establece el atributo de diseÃ±o android:filterTouchesWhenObscured en true. Cuando estÃ¡ habilitado, el marco descartarÃ¡ los toques que se reciban siempre que la ventana de la vista estÃ© oculta por otra ventana visible. Como resultado, la vista no recibirÃ¡ toques cada vez que aparezca un toast, un diÃ¡logo u otra ventana por encima de la ventana de la vista.

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
