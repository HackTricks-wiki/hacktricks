# Google CTF 2018 - Shall We Play a Game?

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

APKã‚’ã“ã“ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š

APKã‚’[https://appetize.io/](https://appetize.io)ï¼ˆç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€APKã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ï¼š

![](<../../.gitbook/assets/image (46).png>)

ãƒ•ãƒ©ã‚°ã‚’å–å¾—ã™ã‚‹ã«ã¯1000000å›å‹ã¤å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

[Androidã®ãƒšãƒ³ãƒˆãƒ†ã‚¹ãƒˆ](./)ã®æ‰‹é †ã«å¾“ã£ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦smaliã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€jadxã‚’ä½¿ç”¨ã—ã¦Javaã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Javaã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ï¼š

![](<../../.gitbook/assets/image (47).png>)

ãƒ•ãƒ©ã‚°ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ã¯**m()**ã®ã‚ˆã†ã§ã™ã€‚

## **Smaliã®å¤‰æ›´**

### **æœ€åˆã®å‘¼ã³å‡ºã—ã§m()ã‚’å‘¼ã³å‡ºã™**

å¤‰æ•°_this.o != 1000000_ã®å ´åˆã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒm()ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚æ¡ä»¶ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ï¼š
```
if-ne v0, v9, :cond_2
```
/hive/hacktricks/mobile-pentesting/android-app-pentesting/google-ctf-2018-shall-we-play-a-game.md

# Google CTF 2018 - Shall we play a game?

## Challenge Description

This challenge is about an Android application that simulates a game. The goal is to find a vulnerability in the app and exploit it to gain access to the flag.

## Initial Analysis

The first step is to decompile the APK file using a tool like JADX or apktool. Once decompiled, we can analyze the source code to identify potential vulnerabilities.

## Reverse Engineering

In the source code, we find a class called `MainActivity` that handles the main functionality of the app. By analyzing this class, we discover that the app communicates with a remote server using a custom protocol.

## Network Communication

To understand the communication protocol, we need to intercept the network traffic between the app and the server. We can use tools like Wireshark or Burp Suite to capture and analyze the traffic.

## Vulnerability Discovery

After analyzing the network traffic, we find that the app sends a request to the server with a parameter called `command`. By manipulating this parameter, we can trigger a command injection vulnerability.

## Exploitation

To exploit the command injection vulnerability, we can send a malicious command as the value of the `command` parameter. This command will be executed on the server, allowing us to gain control and access the flag.

## Conclusion

By analyzing the source code and intercepting the network traffic, we were able to discover and exploit a command injection vulnerability in the Android app. This allowed us to gain control of the server and access the flag.
```
if-eq v0, v9, :cond_2
```
![Before](<../../.gitbook/assets/image (48).png>)

![After](<../../.gitbook/assets/image (49).png>)

[Androidã®ãƒšãƒ³ãƒˆãƒ†ã‚¹ãƒˆ](./)ã®æ‰‹é †ã«å¾“ã£ã¦ã€APKã‚’å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ç½²åã—ã¾ã™ã€‚ãã®å¾Œã€[https://appetize.io/](https://appetize.io)ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ä½•ãŒèµ·ã“ã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

![](<../../.gitbook/assets/image (50).png>)

ãƒ•ãƒ©ã‚°ãŒå®Œå…¨ã«å¾©å·åŒ–ã•ã‚Œãšã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ãŠãã‚‰ãm()é–¢æ•°ã‚’1000000å›å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’è¡Œã†**åˆ¥ã®æ–¹æ³•**ã¯ã€å‘½ä»¤ã‚’å¤‰æ›´ã›ãšã«æ¯”è¼ƒã™ã‚‹å‘½ä»¤ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã™ï¼š

![](<../../.gitbook/assets/image (55).png>)

**åˆ¥ã®æ–¹æ³•**ã¯ã€1000000ã§ã¯ãªã1ã¨æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«å€¤ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€this.oãŒ1ã¨æ¯”è¼ƒã•ã‚Œã¾ã™ï¼š

![](<../../.gitbook/assets/image (57).png>)

4ç•ªç›®ã®æ–¹æ³•ã¯ã€v9ï¼ˆ1000000ï¼‰ã®å€¤ã‚’v0ï¼ˆthis.oï¼‰ã«ç§»å‹•ã™ã‚‹å‘½ä»¤ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ï¼š

![](<../../.gitbook/assets/image (58).png>)

![](<../../.gitbook/assets/image (52).png>)

## è§£æ±ºç­–

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ€åˆã«å‹ã£ãŸå ´åˆã«ã€ãƒ«ãƒ¼ãƒ—ã‚’100000å›å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€**ï¼šgoto\_6**ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ**\_this.o**ã®å€¤ãŒ100000ã§ãªã„å ´åˆã«ãã“ã«**ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™**ï¼š

![](<../../.gitbook/assets/image (59).png>)

ã“ã‚Œã¯ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹å†…ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆãªãœã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ï¼‰ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã—ãŸã„ã§ã™ã‹ï¼Ÿ** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricks swag**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
