# Pentesting de Aplicativos Android

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais sobre bugs web3

üîî Receba notifica√ß√µes sobre novos programas de recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

## Conceitos B√°sicos de Aplicativos Android

√â altamente recomend√°vel come√ßar a ler esta p√°gina para saber sobre as **partes mais importantes relacionadas √† seguran√ßa do Android e os componentes mais perigosos em um aplicativo Android**:

{% content-ref url="android-applications-basics.md" %}
[android-applications-basics.md](android-applications-basics.md)
{% endcontent-ref %}

## ADB (Android Debug Bridge)

Esta √© a principal ferramenta que voc√™ precisa para se conectar a um dispositivo Android (emulado ou f√≠sico).\
Ele permite que voc√™ controle seu dispositivo por **USB** ou **rede** a partir de um computador, **copie** arquivos de ida e volta, **instale** e desinstale aplicativos, execute comandos **shell**, fa√ßa **backups**, leia **logs** e muito mais.

D√™ uma olhada na seguinte lista de [**Comandos ADB**](adb-commands.md) para aprender como usar o adb.

## Smali

√Äs vezes, √© interessante **modificar o c√≥digo do aplicativo** para acessar **informa√ß√µes ocultas** (talvez senhas bem ofuscadas ou flags). Ent√£o, pode ser interessante descompilar o apk, modificar o c√≥digo e recompil√°-lo.\
[Neste tutorial](smali-changes.md), voc√™ pode **aprender como descompilar um APK, modificar o c√≥digo Smali e recompilar o APK** com a nova funcionalidade. Isso pode ser muito √∫til como uma **alternativa para v√°rios testes durante a an√°lise din√¢mica** que ser√£o apresentados. Ent√£o, **mantenha sempre em mente essa possibilidade**.

## Outros truques interessantes

* [Falsificando sua localiza√ß√£o na Play Store](spoofing-your-location-in-play-store.md)
* **Baixe APKs**: [https://apps.evozi.com/apk-downloader/](https://apps.evozi.com/apk-downloader/), [https://apkpure.com/es/](https://apkpure.com/es/), [https://www.apkmirror.com/](https://www.apkmirror.com), [https://apkcombo.com/es-es/apk-downloader/](https://apkcombo.com/es-es/apk-downloader/)
* Extrair APK do dispositivo:
```
adb shell pm list packages
com.android.insecurebankv2

adb shell pm path com.android.insecurebankv2 
package:/data/app/com.android.insecurebankv2-Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk

adb pull /data/app/com.android.insecurebankv2- Jnf8pNgwy3QA_U5f-n_4jQ==/base.apk
```
<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais sobre bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

## An√°lise Est√°tica

Antes de tudo, para analisar um APK, voc√™ deve **dar uma olhada no c√≥digo Java** usando um decompilador.\
Por favor, [**leia aqui para encontrar informa√ß√µes sobre diferentes decompiladores dispon√≠veis**](apk-decompilers.md).

### Procurando por informa√ß√µes interessantes

Apenas olhando para as **strings** do APK, voc√™ pode procurar por **senhas**, **URLs** ([https://github.com/ndelphit/apkurlgrep](https://github.com/ndelphit/apkurlgrep)), **chaves** de API, **criptografia**, **UUIDs** de Bluetooth, **tokens** e qualquer coisa interessante... procure at√© por **backdoors** de execu√ß√£o de c√≥digo ou backdoors de autentica√ß√£o (credenciais de administrador codificadas no aplicativo).

**Firebase**

Preste aten√ß√£o especial √†s **URLs do Firebase** e verifique se est√£o mal configuradas. [Mais informa√ß√µes sobre o que √© o Firebase e como explor√°-lo aqui.](../../network-services-pentesting/pentesting-web/buckets/firebase-database.md)

### Compreens√£o b√°sica do aplicativo - Manifest.xml, strings.xml

Usando qualquer um dos **decompiladores** mencionados [**aqui**](apk-decompilers.md), voc√™ poder√° ler o _Manifest.xml_. Voc√™ tamb√©m pode **renomear** a extens√£o do arquivo **apk para .zip** e **descompact√°-lo**.\
Lendo o **manifest**, voc√™ pode encontrar **vulnerabilidades**:

* Em primeiro lugar, verifique se **o aplicativo pode ser depurado**. Um APK de produ√ß√£o n√£o deve ser (ou outros poder√£o se conectar a ele). Voc√™ pode verificar se um aplicativo pode ser depurado procurando no manifesto pelo atributo `debuggable="true"` dentro da tag _\<application_ Exemplo: `<application theme="@2131296387" debuggable="true"`
  * [Aprenda aqui](drozer-tutorial/#is-debuggeable) como encontrar aplicativos depur√°veis em um telefone e explor√°-los
* **Backup**: O atributo **`android:allowBackup`** define se os dados do aplicativo podem ser salvos e restaurados por um usu√°rio que habilitou a depura√ß√£o USB. Se a bandeira de backup estiver definida como verdadeira, permite que um invasor fa√ßa backup dos dados do aplicativo via adb, mesmo que o dispositivo n√£o esteja rooteado. Portanto, aplicativos que lidam e armazenam informa√ß√µes sens√≠veis, como detalhes de cart√£o, senhas etc., devem ter essa configura√ß√£o explicitamente definida como **false**, porque por padr√£o ela √© definida como **true** para evitar tais riscos.
  * `<application android:allowBackup="false"`
* **NetworkSecurity:** A seguran√ßa de rede do aplicativo pode sobrescrever os valores padr√£o com **`android:networkSecurityConfig="@xml/network_security_config"`**. Um arquivo com esse nome pode ser colocado em _**res/xml.**_ Este arquivo configurar√° configura√ß√µes de seguran√ßa importantes, como pinos de certificado ou se permite tr√°fego HTTP. Voc√™ pode ler aqui mais informa√ß√µes sobre todas as coisas que podem ser configuradas, mas verifique este exemplo sobre como configurar o tr√°fego HTTP para alguns dom√≠nios:
  * `<domain-config cleartextTrafficPermitted="true"> <domain includeSubdomains="true">formation-software.co.uk </domain></domain-config>`
* **Atividades exportadas**: Verifique as atividades exportadas dentro do manifesto, pois isso pode ser perigoso. Mais tarde, na an√°lise din√¢mica, ser√° explicado como [voc√™ pode abusar desse comportamento](./#exploiting-exported-activities-authorisation-bypass).
* **Provedores de conte√∫do**: Se um provedor exportado estiver sendo exposto, voc√™ poder√° acessar/modificar informa√ß√µes interessantes. Na an√°lise din√¢mica, [voc√™ aprender√° como abus√°-los](./#exploiting-content-providers-accessing-and-manipulating-sensitive-information).
  * Verifique as configura√ß√µes de **FileProviders** dentro do atributo `android:name="android.support.FILE_PROVIDER_PATHS"`. [Leia aqui para saber mais sobre FileProviders](./#fileprovider).
* **Servi√ßos expostos**: Dependendo do que o servi√ßo est√° fazendo internamente, vulnerabilidades podem ser exploradas. Na an√°lise din√¢mica, [voc√™ aprender√° como abus√°-los](./#exploiting-services).
* **Receptores de transmiss√£o**: [Voc√™ aprender√° como possivelmente explor√°-los](./#exploiting-broadcast-receivers) durante a an√°lise din√¢mica.
* **Esquema de URL**: Leia o c√≥digo da atividade que gerencia o esquema e procure por vulnerabilidades gerenciando a entrada do usu√°rio. Mais informa√ß√µes sobre [o que √© um esquema de URL aqui](./#url-schemes).
* **minSdkVersion**, **targetSDKVersion**, **maxSdkVersion**: Eles indicam as vers√µes do Android em que o aplicativo ser√° executado. √â importante mant√™-los em mente porque, do ponto de vista da seguran√ßa, suportar vers√µes antigas permitir√° que vers√µes vulner√°veis conhecidas do Android o executem.

Lendo **resources.arsc/strings.xml**, voc√™ pode encontrar algumas **informa√ß√µes interessantes**:

* Chaves de API
* Esquemas personalizados
* Outras informa√ß√µes interessantes que os desenvolvedores salvam neste arquivo

### Tapjacking

**Tapjacking** √© um ataque em que um **aplicativo malicioso** √© lan√ßado e **se posiciona sobre um aplicativo v√≠tima**. Uma vez que ele obscurece visivelmente o aplicativo v√≠tima, sua interface do usu√°rio √© projetada de tal forma que engana o usu√°rio a interagir com ele, enquanto passa a intera√ß√£o para o aplicativo v√≠tima.\
Na verdade, ele est√° **cegando o usu√°rio de saber que est√° realmente realizando a√ß√µes no aplicativo v√≠tima**.

Para detectar aplicativos vulner√°veis a esse ataque, voc√™ deve procurar por **atividades exportadas** no manifesto do Android (observe que uma atividade com um filtro de inten√ß√£o √© automaticamente exportada por padr√£o). Depois de encontrar as atividades exportadas, **verifique se elas exigem alguma permiss√£o**. Isso ocorre porque o **aplicativo malicioso tamb√©m precisar√° dessa permiss√£o**.\
Por fim, √© importante verificar o c√≥digo para poss√≠veis configura√ß√µes de **`setFilterTouchesWhenObscured`**. Se definido como **`true`**, um bot√£o pode ser automaticamente desativado se estiver obscurecido:
```markup
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content" 
android:filterTouchesWhenObscured="true">
</Button>
```
Voc√™ pode usar o [**qark**](https://github.com/linkedin/qark) com o par√¢metro `--exploit-apk` para criar um aplicativo malicioso para testar poss√≠veis vulnerabilidades de **Tapjacking**.\
Um projeto de exemplo que implementa esse tipo de recurso pode ser encontrado em [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp).

A mitiga√ß√£o √© relativamente simples, pois o desenvolvedor pode optar por n√£o receber eventos de toque quando uma visualiza√ß√£o √© coberta por outra. Usando a [Refer√™ncia do Desenvolvedor Android](https://developer.android.com/reference/android/view/View#security):

> √Äs vezes, √© essencial que um aplicativo possa verificar se uma a√ß√£o est√° sendo realizada com o pleno conhecimento e consentimento do usu√°rio, como conceder uma solicita√ß√£o de permiss√£o, fazer uma compra ou clicar em um an√∫ncio. Infelizmente, um aplicativo malicioso pode tentar enganar o usu√°rio a realizar essas a√ß√µes, sem saber, ocultando o prop√≥sito pretendido da visualiza√ß√£o. Como rem√©dio, o framework oferece um mecanismo de filtragem de toque que pode ser usado para melhorar a seguran√ßa de visualiza√ß√µes que fornecem acesso a funcionalidades sens√≠veis.
>
> Para habilitar a filtragem de toque, chame [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) ou defina o atributo de layout android:filterTouchesWhenObscured como true. Quando habilitado, o framework descartar√° toques que s√£o recebidos sempre que a janela da visualiza√ß√£o estiver obscurecida por outra janela vis√≠vel. Como resultado, a visualiza√ß√£o n√£o receber√° toques sempre que um toast, di√°logo ou outra janela aparecer acima da janela da visualiza√ß√£o.

### Sequestro de Tarefas

{% content-ref url="android-task-hijacking.md" %}
[android-task-hijacking.md](android-task-hijacking.md)
{% endcontent-ref %}

### Armazenamento de Dados Inseguro

**Armazenamento Interno**

Arquivos **criados** no **armazenamento interno** s√£o **acess√≠veis** apenas pelo **aplicativo**. Essa prote√ß√£o √© implementada pelo Android e √© suficiente para a maioria dos aplicativos. Mas os desenvolvedores frequentemente usam `MODE_WORLD_READBALE` e `MODE_WORLD_WRITABLE` para dar acesso a esses arquivos a um aplicativo diferente, mas isso n√£o impede que outros aplicativos (maliciosos) os acessem.\
Durante a **an√°lise est√°tica**, verifique o uso desses **modos**, durante a **an√°lise din√¢mica**, verifique as **permiss√µes** dos arquivos criados (talvez alguns deles sejam leg√≠veis/grav√°veis em todo o mundo).\
[Mais informa√ß√µes sobre essa vulnerabilidade e como corrigi-la aqui.](https://manifestsecurity.com/android-application-security-part-8/)

**Armazenamento Externo**

Arquivos criados no **armazenamento externo**, como cart√µes SD, s√£o **globalmente leg√≠veis e grav√°veis**. Como o armazenamento externo pode ser removido pelo usu√°rio e tamb√©m modificado por qualquer aplicativo, voc√™ **n√£o deve armazenar informa√ß√µes confidenciais usando o armazenamento externo**.\
Assim como dados de qualquer fonte n√£o confi√°vel, voc√™ deve **realizar valida√ß√£o de entrada** ao lidar com **dados do armazenamento externo**. Recomendamos fortemente que voc√™ n√£o armazene arquivos execut√°veis ou de classe no armazenamento externo antes do carregamento din√¢mico. Se o seu aplicativo recuperar arquivos execut√°veis do armazenamento externo, os arquivos devem ser assinados e verificados criptograficamente antes do carregamento din√¢mico.\
Informa√ß√µes retiradas daqui [aqui](https://manifestsecurity.com/android-application-security-part-8/).

O armazenamento externo pode ser **acessado** em `/storage/emulated/0`, `/sdcard`, `/mnt/sdcard`

{% hint style="info" %}
A partir do Android 4.4 (**API 17**), o cart√£o SD tem uma estrutura de diret√≥rio que **limita o acesso de um aplicativo ao diret√≥rio que √© especificamente para esse aplicativo**. Isso impede que aplicativos maliciosos obtenham acesso de leitura ou grava√ß√£o aos arquivos de outro aplicativo.
{% endhint %}

**Dados Sens√≠veis Armazenados em Texto Claro**

* **Prefer√™ncias compartilhadas**: O Android permite que cada aplicativo salve facilmente arquivos xml no caminho `/data/data/<nomedopacote>/shared_prefs/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes confidenciais em texto claro nessa pasta.
* **Bancos de dados**: O Android permite que cada aplicativo salve bancos de dados sqlite facilmente no caminho `/data/data/<nomedopacote>/databases/` e √†s vezes √© poss√≠vel encontrar informa√ß√µes confidenciais em texto claro nessa pasta.

### TLS Quebrado

**Aceitar Todos os Certificados**

Por algum motivo, √†s vezes os desenvolvedores aceitam todos os certificados, mesmo que, por exemplo, o nome do host n√£o corresponda com linhas de c√≥digo como a seguinte:
```java
SSLSocketFactory sf = new cc(trustStore);
sf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
```
Uma boa maneira de testar isso √© tentar capturar o tr√°fego usando algum proxy como o Burp sem autorizar o CA do Burp dentro do dispositivo. Al√©m disso, voc√™ pode gerar com o Burp um certificado para um nome de host diferente e us√°-lo.

### Criptografia Quebrada

**Processos de Gerenciamento de Chave Ruins**

Alguns desenvolvedores salvam dados sens√≠veis no armazenamento local e os criptografam com uma chave codificada/prediz√≠vel no c√≥digo. Isso n√£o deve ser feito, pois alguns reversos podem permitir que os atacantes extraiam informa√ß√µes confidenciais.

**Uso de Algoritmos Inseguros e/ou Obsoletos**

Os desenvolvedores n√£o devem usar algoritmos **obsoletos** para realizar verifica√ß√µes de autoriza√ß√£o, armazenar ou enviar dados. Alguns desses algoritmos s√£o: RC4, MD4, MD5, SHA1... Se **hashes** forem usados para armazenar senhas, por exemplo, hashes resistentes a **ataques de for√ßa bruta** devem ser usados com sal.

### Outras verifica√ß√µes

* √â recomend√°vel **ofuscar o APK** para dificultar o trabalho de engenharia reversa para os atacantes.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve realizar suas **pr√≥prias verifica√ß√µes para ver se o dispositivo m√≥vel est√° rooteado** e agir em consequ√™ncia.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve verificar se um **emulador** est√° sendo usado.
* Se o aplicativo for sens√≠vel (como aplicativos banc√°rios), ele deve **verificar sua pr√≥pria integridade antes de execut√°-lo** para verificar se foi modificado.
* Use o [**APKiD**](https://github.com/rednaga/APKiD) para verificar qual compilador/packer/ofuscador foi usado para construir o APK.

### Aplica√ß√£o React Native

Leia a seguinte p√°gina para aprender como acessar facilmente o c√≥digo JavaScript de aplicativos React:

{% content-ref url="react-native-application.md" %}
[react-native-application.md](react-native-application.md)
{% endcontent-ref %}

### Aplicativos Xamarin

Os aplicativos **Xamarin** s√£o escritos em **C#**, para acessar o c√≥digo C# **descompactado**, voc√™ precisa obter os arquivos do **apk**:
```bash
7z r app.apk #Or any other zip decompression cmd
```
Em seguida, descompacte todos os DLsL usando o [**xamarin-decompress**](https://github.com/NickstaDB/xamarin-decompress)**:**
```
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
E, finalmente, voc√™ pode usar [**essas ferramentas recomendadas**](../../reversing/reversing-tools-basic-methods/#net-decompiler) para **ler o c√≥digo C#** dos DLLs.

### An√°lise de c√≥digo est√°tico automatizada

A ferramenta [**mariana-trench**](https://github.com/facebook/mariana-trench) √© capaz de encontrar **vulnerabilidades** **analisando** o **c√≥digo** do aplicativo. Essa ferramenta cont√©m uma s√©rie de **fontes conhecidas** (que indicam √† ferramenta os **locais** onde a **entrada** √© **controlada pelo usu√°rio**), **sinks** (que indicam √† ferramenta **locais perigosos** onde a entrada maliciosa do usu√°rio pode causar danos) e **regras**. Essas regras indicam a **combina√ß√£o** de **fontes-sinks** que indicam uma vulnerabilidade.

Com esse conhecimento, **mariana-trench revisar√° o c√≥digo e encontrar√° poss√≠veis vulnerabilidades nele**.

### Vazamentos de segredos

Um aplicativo pode conter segredos (chaves de API, senhas, URLs ocultas, subdom√≠nios...) dentro dele que voc√™ pode descobrir. Voc√™ pode usar uma ferramenta como [https://github.com/dwisiswant0/apkleaks](https://github.com/dwisiswant0/apkleaks)

### Bypass na autentica√ß√£o biom√©trica

{% content-ref url="bypass-biometric-authentication-android.md" %}
[bypass-biometric-authentication-android.md](bypass-biometric-authentication-android.md)
{% endcontent-ref %}

### Outras fun√ß√µes interessantes

* **Execu√ß√£o de c√≥digo**: `Runtime.exec(), ProcessBuilder(), c√≥digo nativo:system()`
* **Envio de SMS**: `sendTextMessage, sendMultipartTestMessage`
* **Fun√ß√µes nativas** declaradas como `native`: `public native, System.loadLibrary, System.load`
  * [Leia isso para aprender **como reverter fun√ß√µes nativas**](reversing-native-libraries.md)

### **Outros truques**

{% content-ref url="content-protocol.md" %}
[content-protocol.md](content-protocol.md)
{% endcontent-ref %}

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga o HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

## An√°lise din√¢mica

> Em primeiro lugar, voc√™ precisa de um ambiente onde possa instalar o aplicativo e todo o ambiente (certificado Burp CA, Drozer e Frida principalmente). Portanto, um dispositivo com root (emulado ou n√£o) √© extremamente recomendado.

### An√°lise din√¢mica online

Voc√™ pode criar uma **conta gratuita** em: [https://appetize.io/](https://appetize.io). Essa plataforma permite que voc√™ **carregue** e **execute** APKs, portanto, √© √∫til para ver como um APK est√° se comportando.

Voc√™ pode at√© **ver os logs do seu aplicativo** na web e se conectar por meio de **adb**.

![](<../../.gitbook/assets/image (60).png>)

Gra√ßas √† conex√£o ADB, voc√™ pode usar **Drozer** e **Frida** dentro dos emuladores.

### An√°lise din√¢mica local

Voc√™ pode usar algum **emulador** como:

* [**Android Studio**](https://developer.android.com/studio) (Voc√™ pode criar dispositivos **x86** e **arm**, e de acordo com [**este**](https://android-developers.googleblog.com/2020/03/run-arm-apps-on-android-emulator.html) **√∫ltimas vers√µes x86** suportam **bibliotecas ARM** sem precisar de um emulador ARM lento).
  * Se voc√™ quiser tentar **instalar** uma **imagem** e depois quiser **exclu√≠-la**, poder√° fazer isso no Windows:`C:\Users\<User>\AppData\Local\Android\sdk\system-images\` ou Mac: `/Users/myeongsic/Library/Android/sdk/system-image`
  * Este √© o **principal emulador que recomendo usar e voc√™ pode** [**aprender a configur√°-lo nesta p√°gina**](avd-android-virtual-device.md).
* [**Genymotion**](https://www.genymotion.com/fun-zone/) **(Vers√£o gratuita:** Personal Edition, voc√™ precisa criar uma conta. _√â recomend√°vel **baixar** a vers√£o **COM**_ _**VirtualBox** para evitar erros potenciais._)
* [Nox](https://es.bignox.com) (Gr√°tis, mas n√£o suporta Frida ou Drozer).

{% hint style="info" %}
Ao criar um novo emulador em qualquer plataforma, lembre-se de que quanto maior a tela, mais lento o emulador ser√° executado. Portanto, selecione telas pequenas, se poss√≠vel.
{% endhint %}

Como a maioria das pessoas usar√° o **Genymotion**, observe este truque. Para **instalar servi√ßos do Google** (como AppStore), voc√™ precisa clicar no bot√£o marcado em vermelho na seguinte imagem:

![](<../../.gitbook/assets/image (200) (1).png>)

Al√©m disso, observe que na **configura√ß√£o da VM Android no Genymotion** voc√™ pode selecionar o **modo de rede Bridge** (isso ser√° √∫til se voc√™ se conectar √† VM Android de uma VM diferente com as ferramentas).

Ou voc√™ pode usar um **dispositivo f√≠sico** (voc√™ precisa ativar as op√ß√µes de depura√ß√£o e ser√° legal se puder fazer root):

1. **Configura√ß√µes**.
2. (A partir do Android 8.0) Selecione **Sistema**.
3. Selecione **Sobre o telefone**.
4. Pressione **N√∫mero da compila√ß√£o** 7 vezes.
5. Volte e voc√™ encontrar√° as **Op√ß√µes do desenvolvedor**.

> Depois de instalar o aplicativo, a primeira coisa que voc√™ deve fazer √© experiment√°-lo e investigar o que ele faz, como funciona e se sentir confort√°vel com ele.\
> Eu sugeriria **realizar essa an√°lise din√¢mica inicial usando a an√°lise din√¢mica do MobSF + pidcat**, para que voc√™ possa **aprender como o aplicativo funciona** enquanto o MobSF **captura** muitos **dados interessantes** que voc√™ pode revisar posteriormente.

### Vazamento de dados n√£o intencional

**Logging**

Com frequ√™ncia, os desenvolvedores deixam informa√ß√µes de depura√ß√£o publicamente. Portanto, qualquer aplicativo com permiss√£o `READ_LOGS` pode **acessar esses logs** e pode obter informa√ß√µes confidenciais por meio deles.\
Ao navegar pelo aplicativo, use [**pidcat**](https://github.com/JakeWharton/pidcat)_(Recomendado, √© mais f√°cil de usar e ler_) ou [adb logcat](adb-commands.md#logcat) para ler os logs criados e **procurar informa√ß√µes confidenciais**.

{% hint style="warning" %}
Observe que a partir das vers√µes posteriores ao Android 4.0, **os aplicativos s√≥ podem acessar seus pr√≥prios logs**. Portanto, os aplicativos n√£o podem acessar os logs de outros aplicativos.\
De qualquer forma, ainda √© recomend√°vel **n√£o registrar informa√ß√µes confidenciais**.
{% endhint %}

**Caching do buffer de c√≥pia/cola**

O Android fornece um **quadro baseado em clipboard** para fornecer a fun√ß√£o de c√≥pia e colagem em aplicativos Android. Mas isso cria um problema s√©
```
adb shell am start -n com.example.demo/com.example.test.MainActivity
```
**NOTA**: O MobSF detectar√° como malicioso o uso de _**singleTask/singleInstance**_ como `android:launchMode` em uma atividade, mas devido a [isso](https://github.com/MobSF/Mobile-Security-Framework-MobSF/pull/750), aparentemente isso √© perigoso apenas em vers√µes antigas (API vers√µes < 21).

{% hint style="info" %}
Observe que uma viola√ß√£o de autoriza√ß√£o nem sempre √© uma vulnerabilidade, depender√° de como a viola√ß√£o funciona e quais informa√ß√µes s√£o expostas.
{% endhint %}

**Vazamento de informa√ß√µes sens√≠veis**

**As atividades tamb√©m podem retornar resultados**. Se voc√™ conseguir encontrar uma atividade exportada e desprotegida que chame o m√©todo **`setResult`** e **retorne informa√ß√µes sens√≠veis**, haver√° um vazamento de informa√ß√µes sens√≠veis.

### Explorando Provedores de Conte√∫do - Acessando e manipulando informa√ß√µes sens√≠veis

[**Leia isto se quiser lembrar o que √© um Provedor de Conte√∫do.**](android-applications-basics.md#content-provider)\
Os provedores de conte√∫do s√£o basicamente usados para **compartilhar dados**. Se um aplicativo tiver provedores de conte√∫do dispon√≠veis, voc√™ poder√° **extrair dados sens√≠veis** deles. Tamb√©m √© interessante testar poss√≠veis **inje√ß√µes de SQL** e **travessias de caminho** pois eles podem ser vulner√°veis.\
[**Aprenda a explorar Provedores de Conte√∫do com o Drozer.**](drozer-tutorial/#content-providers)

### **Explorando Servi√ßos**

[**Leia isto se quiser lembrar o que √© um Servi√ßo.**](android-applications-basics.md#services)\
Lembre-se de que as a√ß√µes de um servi√ßo come√ßam no m√©todo `onStartCommand`.

Um servi√ßo √© basicamente algo que **pode receber dados**, **process√°-los** e **retornar** (ou n√£o) uma resposta. Ent√£o, se um aplicativo estiver exportando alguns servi√ßos, voc√™ deve **verificar** o **c√≥digo** para entender o que ele est√° fazendo e **test√°-lo** **dinamicamente** para extrair informa√ß√µes confidenciais, contornar medidas de autentica√ß√£o...\
[**Aprenda a explorar Servi√ßos com o Drozer.**](drozer-tutorial/#services)

### **Explorando Receptores de Transmiss√£o**

[**Leia isto se quiser lembrar o que √© um Receptor de Transmiss√£o.**](android-applications-basics.md#broadcast-receivers)\
Lembre-se de que as a√ß√µes de um Receptor de Transmiss√£o come√ßam no m√©todo `onReceive`.

Um receptor de transmiss√£o estar√° aguardando um tipo de mensagem. Dependendo de como o receptor manipula a mensagem, ele pode ser vulner√°vel.\
[**Aprenda a explorar Receptores de Transmiss√£o com o Drozer.**](./#exploiting-broadcast-receivers)

### **Explorando Esquemas / Links Profundos**

Voc√™ pode procurar links profundos manualmente, usando ferramentas como MobSF ou scripts como [este](https://github.com/ashleykinguk/FBLinkBuilder/blob/master/FBLinkBuilder.py).\
Voc√™ pode **abrir** um **esquema** declarado usando **adb** ou um **navegador**:
```bash
adb shell am start -a android.intent.action.VIEW -d "scheme://hostname/path?param=value" [your.package.name]
```
Observe que voc√™ pode **omitir o nome do pacote** e o dispositivo m√≥vel automaticamente chamar√° o aplicativo que deve abrir o link.
```markup
<!-- Browser regular link -->
<a href="scheme://hostname/path?param=value">Click me</a>
<!-- fallback in your url you could try the intent url -->
<a href="intent://hostname#Intent;scheme=scheme;package=your.package.name;S.browser_fallback_url=http%3A%2F%2Fwww.example.com;end">with alternative</a>
```
**C√≥digo executado**

Para encontrar o **c√≥digo que ser√° executado no aplicativo**, v√° para a atividade chamada pelo deep link e procure a fun√ß√£o **`onNewIntent`**.

![](<../../.gitbook/assets/image (436) (1) (1) (1).png>)

**Informa√ß√µes sens√≠veis**

Sempre que encontrar um deep link, verifique se ele n√£o est√° recebendo dados sens√≠veis (como senhas) por meio de par√¢metros de URL, porque qualquer outro aplicativo pode **se passar pelo deep link e roubar esses dados!**

**Par√¢metros no caminho**

Voc√™ **tamb√©m deve verificar se algum deep link est√° usando um par√¢metro dentro do caminho** do URL, como: `https://api.example.com/v1/users/{username}`, nesse caso, voc√™ pode for√ßar uma travessia de caminho acessando algo como: `example://app/users?username=../../unwanted-endpoint%3fparam=value`.\
Observe que, se voc√™ encontrar os endpoints corretos dentro do aplicativo, poder√° causar um **Redirecionamento Aberto** (se parte do caminho for usada como nome de dom√≠nio), **assumir a conta** (se puder modificar os detalhes dos usu√°rios sem token CSRF e o endpoint vulner√°vel usar o m√©todo correto) e qualquer outra vulnerabilidade. Mais [informa√ß√µes sobre isso aqui](http://dphoeniixx.com/2020/12/13-2/).

**Mais exemplos**

Um [relat√≥rio interessante de bug bounty](https://hackerone.com/reports/855618) sobre links (_/.well-known/assetlinks.json_).

### Prote√ß√£o Insuficiente da Camada de Transporte

* **Falta de Inspe√ß√£o de Certificado:** O aplicativo Android n√£o verifica a identidade do certificado apresentado a ele. A maioria dos aplicativos ignora os avisos e aceita qualquer certificado autoassinado apresentado. Alguns aplicativos, em vez disso, passam o tr√°fego por uma conex√£o HTTP.
* **Negocia√ß√£o de Handshake Fraca:** O aplicativo e o servidor realizam um handshake SSL/TLS, mas usam uma su√≠te de criptografia insegura que √© vulner√°vel a ataques MITM. Assim, qualquer atacante pode facilmente descriptografar essa conex√£o.
* **Vazamento de Informa√ß√µes de Privacidade:** Na maioria das vezes, acontece que os aplicativos fazem autentica√ß√£o por meio de um canal seguro, mas todas as outras conex√µes por meio de um canal n√£o seguro. Isso n√£o adiciona seguran√ßa ao aplicativo, porque o restante dos dados sens√≠veis, como cookie de sess√£o ou dados do usu√°rio, pode ser interceptado por um usu√°rio mal-intencionado.

Dos 3 cen√°rios apresentados, vamos discutir **como verificar a identidade do certificado**. Os outros 2 cen√°rios dependem da **configura√ß√£o TLS** do servidor e se o **aplicativo envia dados n√£o criptografados**. O pentester deve verificar por conta pr√≥pria a configura√ß√£o TLS do servidor ([aqui](../../network-services-pentesting/pentesting-web/#ssl-tls-vulnerabilites)) e detectar se algum **informa√ß√£o confidencial √© enviada por um canal n√£o criptografado/vulner√°vel**.\
Mais informa√ß√µes sobre como descobrir e corrigir esse tipo de vulnerabilidades [**aqui**](https://manifestsecurity.com/android-application-security-part-10/).

**SSL Pinning**

Por padr√£o, ao fazer uma conex√£o SSL, o cliente (aplicativo Android) verifica se o certificado do servidor tem uma cadeia de confian√ßa verific√°vel de volta a um certificado confi√°vel (raiz) e corresponde ao nome do host solicitado. Isso leva ao problema de **ataques Man in the Middle (MITM)**.\
No certificate Pinnning, um aplicativo Android em si cont√©m o certificado do servidor e s√≥ transmite dados se o mesmo certificado for apresentado.\
√â recomend√°vel **aplicar o SSL Pinning** para os sites onde informa√ß√µes sens√≠veis ser√£o enviadas.

### Inspe√ß√£o de tr√°fego HTTP

Em primeiro lugar, voc√™ deve (deve) **instalar o certificado** da ferramenta de **proxy** que voc√™ vai usar, provavelmente o Burp. Se voc√™ n√£o instalar o certificado CA da ferramenta de proxy, provavelmente n√£o ver√° o tr√°fego criptografado no proxy.\
**Por favor,** [**leia este guia para aprender como instalar um certificado CA personalizado**](android-burp-suite-settings.md)**.**

Para aplicativos direcionados ao **API Level 24+ n√£o √© suficiente instalar o certificado Burp** no dispositivo. Para contornar essa nova prote√ß√£o, voc√™ precisa modificar o arquivo de Configura√ß√£o de Seguran√ßa de Rede. Portanto, voc√™ pode modificar este arquivo para autorizar seu certificado CA ou pode [**ler esta p√°gina para um tutorial sobre como for√ßar o aplicativo a aceitar novamente todos os certificados instalados no dispositivo**](make-apk-accept-ca-certificate.md).

**SSL Pinning**

J√° discutimos o que √© SSL Pinning apenas 2 par√°grafos antes. Quando implementado em um aplicativo, voc√™ precisar√° ignor√°-lo para inspecionar o tr√°fego HTTPS ou n√£o o ver√°.\
Aqui vou apresentar algumas op√ß√µes que usei para ignorar essa prote√ß√£o:

* **Modificar automaticamente** o **apk** para **ignorar** o SSLPinning com [**apk-mitm**](https://github.com/shroudedcode/apk-mitm). O melhor pr√≥ dessa op√ß√£o √© que voc√™ n√£o precisar√° de root para ignorar o SSL Pinning, mas precisar√° excluir o aplicativo e reinstalar o novo, e isso nem sempre funcionar√°.
* Voc√™ pode usar **Frida** (discutido abaixo) para ignorar essa prote√ß√£o. Aqui est√° um guia para usar Burp+Frida+Genymotion: [https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/](https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/)
* Voc√™ tamb√©m pode tentar **ignorar automaticamente o SSL Pinning** usando [**objection**](frida-tutorial/objection-tutorial.md)**:** `objection --gadget com.package.app explore --startup-command "android sslpinning disable"`
* Voc√™ tamb√©m pode tentar **ignorar automaticamente o SSL Pinning** usando **MobSF dynamic analysis** (explicado abaixo)
* Se voc√™ ainda acha que h√° algum tr√°fego que n√£o est√° capturando, pode tentar **encaminhar o tr√°fego para o burp usando iptables**. Leia este blog: [https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62](https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62)

**Vulnerabilidades Web comuns**

Observe que, nesta etapa, voc√™ deve procurar vulnerabilidades web comuns. Muitas informa√ß√µes sobre vulnerabilidades web podem ser encontradas neste livro, ent√£o n√£o vou mencion√°-las aqui.

### Frida

Kit de instrumenta√ß√£o din√¢mica para desenvolvedores, engenheiros reversos e pesquisadores de seguran√ßa. Saiba mais em [www.frida.re](https://www.frida.re).\
**√â incr√≠vel, voc√™ pode acessar o aplicativo em execu√ß√£o e conectar m√©todos em tempo de execu√ß√£o para alterar o comportamento, alterar valores, extrair
```
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
Observe que o MobSF pode analisar aplicativos **Android** (apk), **IOS** (ipa) e **Windows** (apx) (os aplicativos do Windows devem ser analisados a partir de um MobSF instalado em um host do Windows).\
Al√©m disso, se voc√™ criar um arquivo **ZIP** com o c√≥digo-fonte de um aplicativo **Android** ou **IOS** (v√° para a pasta raiz do aplicativo, selecione tudo e crie um arquivo ZIP), o MobSF tamb√©m poder√° analis√°-lo.

O MobSF tamb√©m permite que voc√™ fa√ßa uma **compara√ß√£o/diferencia√ß√£o** de an√°lises e integre o **VirusTotal** (voc√™ precisar√° definir sua chave de API em _MobSF/settings.py_ e ativ√°-la: `VT_ENABLED = TRUE` `VT_API_KEY = <Sua chave de API>` `VT_UPLOAD = TRUE`). Voc√™ tamb√©m pode definir `VT_UPLOAD` como `False`, ent√£o o **hash** ser√° **carregado** em vez do arquivo.

### An√°lise din√¢mica assistida com MobSF

O **MobSF** tamb√©m pode ser muito √∫til para an√°lise **din√¢mica** no **Android**, mas nesse caso voc√™ precisar√° instalar o MobSF e o **genymotion** em seu host (uma VM ou Docker n√£o funcionar√°). _Observa√ß√£o: voc√™ precisa **iniciar primeiro uma VM no genymotion** e **depois o MobSF**._\
O analisador din√¢mico do **MobSF** pode:

* **Despejar dados do aplicativo** (URLs, logs, √°rea de transfer√™ncia, capturas de tela feitas por voc√™, capturas de tela feitas pelo "**Exported Activity Tester**", e-mails, bancos de dados SQLite, arquivos XML e outros arquivos criados). Tudo isso √© feito automaticamente, exceto pelas capturas de tela, voc√™ precisa pressionar quando desejar uma captura de tela ou precisa pressionar "**Exported Activity Tester**" para obter capturas de tela de todas as atividades exportadas.
* Capturar **tr√°fego HTTPS**
* Usar o **Frida** para obter **informa√ß√µes em tempo de execu√ß√£o**

A partir das vers√µes do **Android > 5**, ele iniciar√° **automaticamente o Frida** e definir√° as configura√ß√µes globais de **proxy** para **capturar** o tr√°fego. Ele capturar√° apenas o tr√°fego do aplicativo testado.

**Frida**

Por padr√£o, ele tamb√©m usar√° alguns scripts do Frida para **burlar o SSL pinning**, **detec√ß√£o de root** e **detec√ß√£o de depurador** e para **monitorar APIs interessantes**.\
O MobSF tamb√©m pode **invocar atividades exportadas**, capturar **capturas de tela** delas e **salv√°-las** para o relat√≥rio.

Para **iniciar** o teste din√¢mico, pressione o bot√£o verde: "**Start Instrumentation**". Pressione "**Frida Live Logs**" para ver os logs gerados pelos scripts do Frida e "**Live API Monitor**" para ver todas as invoca√ß√µes aos m√©todos conectados, argumentos passados e valores retornados (isso aparecer√° ap√≥s pressionar "Start Instrumentation").\
O MobSF tamb√©m permite que voc√™ carregue seus pr√≥prios **scripts do Frida** (para enviar os resultados de seus scripts do Friday para o MobSF, use a fun√ß√£o `send()`). Ele tamb√©m possui **v√°rios scripts pr√©-escritos** que voc√™ pode carregar (voc√™ pode adicionar mais em `MobSF/DynamicAnalyzer/tools/frida_scripts/others/`), basta **selecion√°-los**, pressionar "**Load**" e pressionar "**Start Instrumentation**" (voc√™ poder√° ver os logs desses scripts dentro de "**Frida Live Logs**").

![](<../../.gitbook/assets/image (215).png>)

Al√©m disso, voc√™ tem algumas funcionalidades auxiliares do Frida:

* **Enumerate Loaded Classes**: Ele imprimir√° todas as classes carregadas
* **Capture Strings**: Ele imprimir√° todas as strings capturadas enquanto usa o aplicativo (super barulhento)
* **Capture String Comparisons**: Pode ser muito √∫til. Ele **mostrar√° as 2 strings sendo comparadas** e se o resultado foi Verdadeiro ou Falso.
* **Enumerate Class Methods**: Coloque o nome da classe (como "java.io.File") e ele imprimir√° todos os m√©todos da classe.
* **Search Class Pattern**: Pesquise classes por padr√£o
* **Trace Class Methods**: **Trace** uma **classe inteira** (veja as entradas e sa√≠das de todos os m√©todos da classe). Lembre-se de que, por padr√£o, o MobSF rastreia v√°rios m√©todos interessantes da API do Android.

Depois de selecionar o m√≥dulo auxiliar que deseja usar, voc√™ precisa pressionar "**Start Intrumentation**" e ver√° todas as sa√≠das em "**Frida Live Logs**".

**Shell**

O Mobsf tamb√©m oferece um shell com alguns comandos **adb**, comandos **MobSF** e comandos **shell** comuns na parte inferior da p√°gina de an√°lise din√¢mica. Alguns comandos interessantes:
```
help
shell ls
activities
exported_activities
services
receivers
```
**Ferramentas HTTP**

Quando o tr√°fego http √© capturado, voc√™ pode ver uma vis√£o desagrad√°vel do tr√°fego capturado na parte inferior "**HTTP(S) Traffic**" ou uma vis√£o mais agrad√°vel no bot√£o verde "**Start HTTPTools**". A partir da segunda op√ß√£o, voc√™ pode **enviar** as **solicita√ß√µes capturadas** para **proxies** como Burp ou Owasp ZAP.\
Para fazer isso, _ligue o Burp -->_ _desligue o Intercept --> no MobSB HTTPTools selecione a solicita√ß√£o_ --> pressione "**Send to Fuzzer**" --> _selecione o endere√ßo do proxy_ ([http://127.0.0.1:8080\\](http://127.0.0.1:8080)).

Depois de concluir a an√°lise din√¢mica com o MobSF, voc√™ pode pressionar "**Start Web API Fuzzer**" para **fuzz http requests** e procurar por vulnerabilidades.

{% hint style="info" %}
Depois de realizar uma an√°lise din√¢mica com o MobSF, as configura√ß√µes de proxy podem estar incorretas e voc√™ n√£o poder√° corrigi-las pela GUI. Voc√™ pode corrigir as configura√ß√µes de proxy fazendo:
```
adb shell settings put global http_proxy :0
```
{% endhint %}

### An√°lise Din√¢mica Assistida com Inspeckage

Voc√™ pode obter a ferramenta em [**Inspeckage**](https://github.com/ac-pm/Inspeckage).\
Essa ferramenta usa alguns **Hooks** para permitir que voc√™ saiba **o que est√° acontecendo no aplicativo** enquanto voc√™ realiza uma **an√°lise din√¢mica**.

{% content-ref url="inspeckage-tutorial.md" %}
[inspeckage-tutorial.md](inspeckage-tutorial.md)
{% endcontent-ref %}

### [Yaazhini](https://www.vegabird.com/yaazhini/)

Esta √© uma **√≥tima ferramenta para realizar an√°lise est√°tica com uma GUI**

![](<../../.gitbook/assets/image (527).png>)

### [Qark](https://github.com/linkedin/qark)

Esta ferramenta √© projetada para procurar v√°rias **vulnerabilidades de seguran√ßa relacionadas ao aplicativo Android**, seja no **c√≥digo-fonte** ou em **APKs empacotados**. A ferramenta tamb√©m √© **capaz de criar um APK implant√°vel "Proof-of-Concept"** e **comandos ADB**, para explorar algumas das vulnerabilidades encontradas (atividades expostas, inten√ß√µes, tapjacking...). Assim como o Drozer, n√£o √© necess√°rio fazer root no dispositivo de teste.
```bash
pip3 install --user qark  # --user is only needed if not using a virtualenv
qark --apk path/to/my.apk
qark --java path/to/parent/java/folder
qark --java path/to/specific/java/file.java
```
### [**ReverseAPK**](https://github.com/1N3/ReverseAPK.git)

* Exibe todos os arquivos extra√≠dos para f√°cil refer√™ncia
* Decompila automaticamente arquivos APK para formato Java e Smali
* Analisa o AndroidManifest.xml em busca de vulnerabilidades e comportamentos comuns
* An√°lise est√°tica do c√≥digo-fonte em busca de vulnerabilidades e comportamentos comuns
  * Informa√ß√µes do dispositivo
  * Inten√ß√µes
  * Execu√ß√£o de comandos
  * Refer√™ncias SQLite
  * Refer√™ncias de registro
  * Provedores de conte√∫do
  * Receptores de transmiss√£o
  * Refer√™ncias de servi√ßo
  * Refer√™ncias de arquivo
  * Refer√™ncias de criptografia
  * Segredos codificados
  * URL's
  * Conex√µes de rede
  * Refer√™ncias SSL
  * Refer√™ncias WebView
```
reverse-apk relative/path/to/APP.apk
```
### [SUPER Android Analyzer](https://github.com/SUPERAndroidAnalyzer/super)

O SUPER √© um aplicativo de linha de comando que pode ser usado no Windows, MacOS X e Linux, que analisa arquivos _.apk_ em busca de vulnerabilidades. Ele faz isso descompactando APKs e aplicando uma s√©rie de regras para detectar essas vulnerabilidades.

Todas as regras est√£o centralizadas em um arquivo `rules.json`, e cada empresa ou testador pode criar suas pr√≥prias regras para analisar o que precisam.

Baixe os bin√°rios mais recentes na [p√°gina de download](https://superanalyzer.rocks/download.html).
```
super-analyzer {apk_file}
```
### [StaCoAn](https://github.com/vincentcox/StaCoAn)

![](<../../.gitbook/assets/image (62).png>)

StaCoAn √© uma ferramenta **multiplataforma** que ajuda desenvolvedores, ca√ßadores de bugs e hackers √©ticos a realizar an√°lise de c√≥digo est√°tico em aplicativos m√≥veis\*.

O conceito √© que voc√™ arraste e solte o arquivo do seu aplicativo m√≥vel (um arquivo .apk ou .ipa) na aplica√ß√£o StaCoAn e ela gerar√° um relat√≥rio visual e port√°til para voc√™. Voc√™ pode ajustar as configura√ß√µes e listas de palavras para obter uma experi√™ncia personalizada.

Baixe a [√∫ltima vers√£o](https://github.com/vincentcox/StaCoAn/releases):
```
./stacoan
```
### [AndroBugs](https://github.com/AndroBugs/AndroBugs\_Framework)

O AndroBugs Framework √© um sistema de an√°lise de vulnerabilidades do Android que ajuda desenvolvedores ou hackers a encontrar poss√≠veis vulnerabilidades de seguran√ßa em aplicativos Android.\
[Releases para Windows](https://github.com/AndroBugs/AndroBugs\_Framework/releases)
```
python androbugs.py -f [APK file]
androbugs.exe -f [APK file]
```
### [Androwarn](https://github.com/maaaaz/androwarn)

**Androwarn** √© uma ferramenta cujo objetivo principal √© detectar e alertar o usu√°rio sobre poss√≠veis comportamentos maliciosos desenvolvidos por um aplicativo Android.

A detec√ß√£o √© realizada com a **an√°lise est√°tica** do bytecode Dalvik do aplicativo, representado como **Smali**, com a biblioteca [`androguard`](https://github.com/androguard/androguard).

Esta ferramenta procura por **comportamentos comuns de aplicativos "ruins"** como: exfiltra√ß√£o de identificadores de telefonia, intercepta√ß√£o de fluxo de √°udio/v√≠deo, modifica√ß√£o de dados PIM, execu√ß√£o de c√≥digo arbitr√°rio...
```
python androwarn.py -i my_application_to_be_analyzed.apk -r html -v 3
```
### [MARA Framework](https://github.com/xtiankisutsa/MARA\_Framework)

![](<../../.gitbook/assets/image (81).png>)

**MARA** √© um **F**ramework de **R**everse **E**ngineering e **A**n√°lise de **A**plicativos **M**√≥veis. √â uma ferramenta que re√∫ne ferramentas comumente usadas para an√°lise e reverse engineering de aplicativos m√≥veis, para ajudar no teste de aplicativos m√≥veis contra amea√ßas de seguran√ßa m√≥vel OWASP. Seu objetivo √© tornar essa tarefa mais f√°cil e amig√°vel para desenvolvedores de aplicativos m√≥veis e profissionais de seguran√ßa.

Ele √© capaz de:

* Extrair c√≥digo Java e Smali usando diferentes ferramentas
* Analisar APKs usando: [smalisca](https://github.com/dorneanu/smalisca), [ClassyShark](https://github.com/google/android-classyshark), [androbugs](https://github.com/AndroBugs/AndroBugs\_Framework), [androwarn](https://github.com/maaaaz/androwarn), [APKiD](https://github.com/rednaga/APKiD)
* Extrair informa√ß√µes privadas do APK usando regexps.
* Analisar o Manifest.
* Analisar dom√≠nios encontrados usando: [pyssltest](https://github.com/moheshmohan/pyssltest), [testssl](https://github.com/drwetter/testssl.sh) e [whatweb](https://github.com/urbanadventurer/WhatWeb)
* Desofuscar APK via [apk-deguard.com](http://www.apk-deguard.com)

### Koodous

√ötil para detectar malware: [https://koodous.com/](https://koodous.com)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

## Ofuscando/Desofuscando c√≥digo

Observe que, dependendo do servi√ßo e da configura√ß√£o que voc√™ usa para ofuscar o c√≥digo, segredos podem ou n√£o ser ofuscados.

### [ProGuard](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

**ProGuard** √© uma ferramenta de linha de comando de c√≥digo aberto que encolhe, otimiza e ofusca o c√≥digo Java. Ele √© capaz de otimizar o bytecode e detectar e remover instru√ß√µes n√£o utilizadas. O ProGuard √© um software gratuito e √© distribu√≠do sob a Licen√ßa P√∫blica Geral GNU, vers√£o 2.

O ProGuard √© distribu√≠do como parte do Android SDK e √© executado ao compilar o aplicativo no modo de lan√ßamento.

De: [https://en.wikipedia.org/wiki/ProGuard\_(software)](https://en.wikipedia.org/wiki/ProGuard\_\(software\))

### [DexGuard](https://www.guardsquare.com/dexguard)

Encontre um guia passo a passo para desofuscar o apk em [https://blog.lexfo.fr/dexguard.html](https://blog.lexfo.fr/dexguard.html)

(Daquele guia) Da √∫ltima vez que verificamos, o modo de opera√ß√£o do Dexguard foi:

* carregar um recurso como um InputStream;
* alimentar o resultado para uma classe herdando de FilterInputStream para descriptograf√°-lo;
* fazer alguma ofusca√ß√£o in√∫til para desperdi√ßar alguns minutos de tempo de um reverser;
* alimentar o resultado descriptografado para um ZipInputStream para obter um arquivo DEX;
* finalmente carregar o DEX resultante como um recurso usando o m√©todo `loadDex`.

### [DeGuard](http://apk-deguard.com)

**DeGuard reverte o processo de ofusca√ß√£o realizado pelas ferramentas de ofusca√ß√£o do Android. Isso permite in√∫meras an√°lises de seguran√ßa, incluindo inspe√ß√£o de c√≥digo e previs√£o de bibliotecas.**

Voc√™ pode fazer upload de um APK ofuscado para a plataforma deles.

### [Simplify](https://github.com/CalebFenton/simplify)

√â um **desofuscador gen√©rico do Android.** Simplify **executa virtualmente um aplicativo** para entender seu comportamento e, em seguida, **tenta otimizar o c√≥digo** para que ele se comporte de forma id√™ntica, mas seja mais f√°cil para um humano entender. Cada tipo de otimiza√ß√£o √© simples e gen√©rico, portanto, n√£o importa qual o tipo espec√≠fico de ofusca√ß√£o usado.

### [APKiD](https://github.com/rednaga/APKiD)

APKiD fornece informa√ß√µes sobre **como um APK foi feito**. Ele identifica muitos **compiladores**, **empacotadores**, **ofuscadores** e outras coisas estranhas. √â o [_PEiD_](https://www.aldeid.com/wiki/PEiD) para Android.

### Manual

[Leia este tutorial para aprender alguns truques sobre **como reverter a ofusca√ß√£o personalizada**](manual-deobfuscation.md)

## Laborat√≥rios

### [Androl4b](https://github.com/sh4hin/Androl4b)

AndroL4b √© uma m√°quina virtual de seguran√ßa Android baseada no ubuntu-mate que inclui a cole√ß√£o dos √∫ltimos frameworks, tutoriais e laborat√≥rios de diferentes geeks e pesquisadores de seguran√ßa para engenharia reversa e an√°lise de malware.

### OWASP

{% embed url="https://github.com/OWASP/owasp-mstg%0Ahttps://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06g-testing-network-communication" %}

### Reposit√≥rios Git

[https://github.com/riddhi-shree/nullCommunity/tree/master/Android](https://github.com/riddhi-shree/nullCommunity/tree/master/Android)\
[https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec](https://www.youtube.com/watch?v=PMKnPaGWxtg\&feature=youtu.be\&ab\_channel=B3nacSec)

## Refer√™ncias

Para mais informa√ß√µes, visite:

* [https://appsecwiki.com/#/](https://appsecwiki.com/#/) √â uma √≥tima lista de recursos
* [https://maddiestone.github.io/AndroidAppRE/](https://maddiestone.github.io/AndroidAppRE/) Curso r√°pido de Android
* [https://manifestsecurity.com/android-application-security/](https://manifestsecurity.com/android-application-security/)
* [https://github.com/Ralireza/Android-Security-Teryaagh](https://github.com/Ralireza/Android-Security-Teryaagh)

## Para Testar

* [https://www.vegabird.com/yaazhini/](https://www.vegabird.com/yaazhini/)
* [https://github.com/abhi-r3v0/Adhrit](https://github.com/abhi-r3v0/Adhrit)

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em
