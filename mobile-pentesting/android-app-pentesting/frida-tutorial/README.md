# Fridaãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ’ãƒ³ãƒˆ**ï¼šãƒãƒƒã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãª**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹Intigriti**ã«**ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**ã—ã¦ãã ã•ã„ï¼ä»Šã™ã[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ã«å‚åŠ ã—ã¦ã€æœ€å¤§**$100,000**ã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã‚’ç²å¾—ã—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**fridaãƒ„ãƒ¼ãƒ«**ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š
```bash
pip install frida-tools
pip install frida
```
**frida server**ã‚’Androidã«**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ã—ã¾ã™ï¼ˆ[æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/frida/frida/releases)ï¼‰ã€‚\
ãƒ«ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã§adbã‚’å†èµ·å‹•ã—ã€æ¥ç¶šã—ã€frida-serverã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ï¼š
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**å‹•ä½œã‚’ç¢ºèªã™ã‚‹**ï¼š
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« 1](frida-tutorial-1.md)

**å…ƒè¨˜äº‹**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

[ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚€](frida-tutorial-1.md)ã€‚

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« 2](frida-tutorial-2.md)

**å…ƒè¨˜äº‹**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (ãƒ‘ãƒ¼ãƒˆ 2, 3, 4)\
**APK ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

[ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚€](frida-tutorial-2.md)ã€‚

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« 3](owaspuncrackable-1.md)

**å…ƒè¨˜äº‹**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

[ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚€](owaspuncrackable-1.md)ã€‚\
**ã“ã“ã§ç´ æ™´ã‚‰ã—ã„ Frida ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## æ—©ã„ä¾‹

ã“ã“ã§ã¯ã€Fridaã®åŸºæœ¬çš„ã§èˆˆå‘³æ·±ã„æ©Ÿèƒ½ã‚’ä½¿ã£ãŸã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰Fridaã‚’å‘¼ã³å‡ºã™
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### åŸºæœ¬çš„ãªPythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Modify the behavior of the target method
        console.log("Target method hooked!");
        // Call the original method
        this.targetMethod();
    };
});
"""

# Create a script from the JavaScript code
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

ã“ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã€JavaScriptã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

```python
import frida

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹
session = frida.attach("com.example.app")

# æ³¨å…¥ã™ã‚‹JavaScriptã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©ã™ã‚‹
js_code = """
Java.perform(function () {
    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œã‚’å¤‰æ›´ã™ã‚‹
        console.log("ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");
        // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
        this.targetMethod();
    };
});
"""

# JavaScriptã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹
script = session.create_script(js_code)

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
script.load()

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ãƒ‡ã‚¿ãƒƒãƒã™ã‚‹
session.detach()
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã€æŒ‡å®šã—ãŸã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã—ã¦å‹•ä½œã‚’å¤‰æ›´ã—ã¾ã™ã€‚ãƒ•ãƒƒã‚¯ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãªã„é–¢æ•°ã®ãƒ•ãƒƒã‚¯

ã‚¯ãƒ©ã‚¹ `sg.vantagepoint.a.c` ã®é–¢æ•° `a()` ã‚’ãƒ•ãƒƒã‚¯ã—ã¾ã™ã€‚
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Java

In this tutorial, we will learn how to use Frida to hook the `exit()` function in Java. By hooking this function, we can intercept the program's exit and perform additional actions before the application terminates.

## Prerequisites

Before we begin, make sure you have the following:

- A rooted Android device or an emulator
- Frida installed on your machine
- Basic knowledge of JavaScript and Java

## Steps

1. Start by creating a new JavaScript file, for example `hook_exit.js`, and open it in a text editor.

2. Import the necessary Frida modules:

```javascript
const { Java } = require('frida');
```

3. Attach to the target process using Frida:

```javascript
Java.perform(function () {
  // Code goes here
});
```

4. Find the class and method that contains the `exit()` function. You can use the `Java.use()` function to obtain a reference to the class:

```javascript
const System = Java.use('java.lang.System');
```

5. Hook the `exit()` method using the `System.exit.implementation` property:

```javascript
System.exit.implementation = function (code) {
  // Code goes here
  this.exit(code);
};
```

6. Inside the hook, you can add your custom logic. For example, you can log the exit code before the application terminates:

```javascript
System.exit.implementation = function (code) {
  console.log('Exit code:', code);
  this.exit(code);
};
```

7. Save the JavaScript file.

8. Launch the target application on your Android device or emulator.

9. Use Frida to inject the JavaScript code into the target process:

```bash
frida -U -l hook_exit.js -f <package_name>
```

Replace `<package_name>` with the package name of the target application.

10. You should see the exit code being logged in the console whenever the `exit()` function is called.

## Conclusion

By hooking the `exit()` function in Java using Frida, we can intercept the program's exit and perform additional actions. This technique can be useful for debugging or analyzing the behavior of an application during its termination process.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Frida Tutorial: ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® `.onStart()` ã¨ `.onCreate()` ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® `.onStart()` ã¨ `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

## å‰ææ¡ä»¶

- FridaãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹Androidãƒ‡ãƒã‚¤ã‚¹ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨

## ã‚¹ãƒ†ãƒƒãƒ—1: Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

ã¾ãšã€Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® `.onStart()` ã¨ `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```javascript
Java.perform(function() {
  var MainActivity = Java.use('com.example.MainActivity');

  MainActivity.onStart.implementation = function() {
    console.log('MainActivity.onStart() ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
    this.onStart();
  };

  MainActivity.onCreate.implementation = function() {
    console.log('MainActivity.onCreate() ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
    this.onCreate();
  };
});
```

## ã‚¹ãƒ†ãƒƒãƒ—2: Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ

æ¬¡ã«ã€ä½œæˆã—ãŸFridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
frida -U -l script.js -f com.example.app
```

- `-U` ãƒ•ãƒ©ã‚°ã¯ã€USBæ¥ç¶šã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¾ã™ã€‚
- `-l` ãƒ•ãƒ©ã‚°ã¯ã€å®Ÿè¡Œã™ã‚‹Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚
- `-f` ãƒ•ãƒ©ã‚°ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹ã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’æŒ‡å®šã—ã¾ã™ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ãƒƒã‚¯ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã®ç¢ºèª

Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® `.onStart()` ã¨ `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚Œã€ãƒ­ã‚°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã§ã€Androidã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã® `.onStart()` ã¨ `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Frida Tutorial: ãƒ•ãƒƒã‚¯ Android ã® `.onCreate()`

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Frida ã‚’ä½¿ç”¨ã—ã¦ Android ã‚¢ãƒ—ãƒªã® `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## 1. Frida ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã¾ãšã€Frida ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Frida ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
$ pip install frida-tools
```

## 2. ãƒ‡ãƒã‚¤ã‚¹ã¸ã®æ¥ç¶š

Frida ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã—ã¾ã™ã€‚

```bash
$ adb devices
```

## 3. ãƒ•ãƒƒã‚¯ã®å®Ÿè£…

Frida ã‚’ä½¿ç”¨ã—ã¦ `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```javascript
Java.perform(function() {
  var MainActivity = Java.use('com.example.MainActivity');
  
  MainActivity.onCreate.implementation = function() {
    console.log('onCreate() ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼');
    
    // ã“ã“ã«ãƒ•ãƒƒã‚¯å¾Œã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™
    
    // å…ƒã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™
    this.onCreate();
  };
});
```

## 4. ãƒ•ãƒƒã‚¯ã®å®Ÿè¡Œ

ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```bash
$ frida -U -f com.example.app -l script.js --no-pause
```

`com.example.app` ã®éƒ¨åˆ†ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚`script.js` ã®éƒ¨åˆ†ã‚’ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

## 5. çµæœã®ç¢ºèª

ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€`.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚ŒãŸã“ã¨ã‚’ç¤ºã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ•ãƒƒã‚¯å¾Œã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€å¿…è¦ãªæ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸Šã§ã€Android ã‚¢ãƒ—ãƒªã® `.onCreate()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ãŒå®Œäº†ã§ã™ã€‚
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤é–¢æ•°ã®ãƒ•ãƒƒã‚¯ã¨å€¤ã®å–å¾—

å¾©å·åŒ–é–¢æ•°ã®ãƒ•ãƒƒã‚¯ã€‚å…¥åŠ›ã‚’è¡¨ç¤ºã—ã€å…ƒã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦å…¥åŠ›ã‚’å¾©å·åŒ–ã—ã€æœ€å¾Œã«å¹³æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ãƒƒã‚¯ã¨å…¥åŠ›ã‚’ä½¿ç”¨ã—ãŸå‘¼ã³å‡ºã—

é–¢æ•°ã‚’ãƒ•ãƒƒã‚¯ã—ã¦ã€æ–‡å­—åˆ—ã‚’å—ã‘å–ã‚Šã€ä»–ã®æ–‡å­—åˆ—ã§å‘¼ã³å‡ºã—ã¾ã™ï¼ˆ[ã“ã¡ã‚‰](https://11x256.github.io/Frida-hooking-android-part-2/)ã‹ã‚‰ï¼‰ã€‚
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### ã‚¯ãƒ©ã‚¹ã®æ—¢å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å–å¾—

ä½œæˆæ¸ˆã¿ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å±æ€§ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã¯ã€ã“ã‚Œã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã€ã‚¯ãƒ©ã‚¹my\_activityã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå±æ€§ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°.secret()ã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ’ãƒ³ãƒˆ**: **Intigriti**ã«**ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ãƒãƒƒã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãª**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã§ã™ï¼ä»Šã™ã[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ã«å‚åŠ ã—ã¦ã€æœ€å¤§**$100,000**ã®å ±é…¬ã‚’ç²å¾—ã—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„**ã€‚

</details>
