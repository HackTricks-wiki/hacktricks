# Fridaãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ’ãƒ³ãƒˆ**ï¼šãƒãƒƒã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãª**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹Intigritiã«ç™»éŒ²**ã—ã¦ãã ã•ã„ï¼ä»Šã™ã[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ã«å‚åŠ ã—ã¦ã€æœ€å¤§**$100,000**ã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã‚’ç²å¾—ã—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**fridaãƒ„ãƒ¼ãƒ«**ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š
```bash
pip install frida-tools
pip install frida
```
**frida server**ã‚’Androidã«**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ã—ã¾ã™ï¼ˆ[æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/frida/frida/releases)ï¼‰ã€‚\
ãƒ«ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã§adbã‚’å†èµ·å‹•ã—ã€æ¥ç¶šã—ã€frida-serverã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å®Ÿè¡Œæ¨©é™ã‚’ä¸ãˆã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ï¼š

{% code overflow="wrap" %}
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
{% endcode %}

**å‹•ä½œã‚’ç¢ºèªã™ã‚‹**ï¼š
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«1](frida-tutorial-1.md)

**å…ƒè¨˜äº‹**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

[ãƒªãƒ³ã‚¯](frida-tutorial-1.md)ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚“ã§ãã ã•ã„ã€‚

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«2](frida-tutorial-2.md)

**å…ƒè¨˜äº‹**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (ãƒ‘ãƒ¼ãƒˆ2ã€3ã€4)\
**APKã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

[ãƒªãƒ³ã‚¯](frida-tutorial-2.md)ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚“ã§ãã ã•ã„ã€‚

### [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«3](owaspuncrackable-1.md)

**å…ƒè¨˜äº‹**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level\_01/UnCrackable-Level1.apk)

[ãƒªãƒ³ã‚¯](owaspuncrackable-1.md)ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã‚“ã§ãã ã•ã„ã€‚\
**ã“ã“ã§ç´ æ™´ã‚‰ã—ã„Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## æ—©ã„ä¾‹

ã“ã“ã§ã¯ã€Fridaã®åŸºæœ¬çš„ã§èˆˆå‘³æ·±ã„æ©Ÿèƒ½ã‚’ä½¿ã£ãŸã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰Fridaã‚’å‘¼ã³å‡ºã™
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### åŸºæœ¬çš„ãªPythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```python
import frida

# Attach to the target process
session = frida.attach("com.example.app")

# Define the JavaScript code to be injected
js_code = """
Java.perform(function () {
    // Hook the target method
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // Print the arguments passed to the method
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // Call the original method
        var result = this.targetMethod.apply(this, arguments);
        
        // Print the result
        console.log("Result: " + result);
        
        // Modify the result
        result += 1;
        
        // Return the modified result
        return result;
    };
});
"""

# Create the script
script = session.create_script(js_code)

# Load the script into the target process
script.load()

# Detach from the target process
session.detach()
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã€JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ãƒˆã™ã‚‹åŸºæœ¬çš„ãªPythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

```python
import frida

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹
session = frida.attach("com.example.app")

# ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ãƒˆã™ã‚‹JavaScriptã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©ã™ã‚‹
js_code = """
Java.perform(function () {
    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹
    var targetClass = Java.use("com.example.app.TargetClass");
    targetClass.targetMethod.implementation = function () {
        // ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’è¡¨ç¤ºã™ã‚‹
        console.log("Arguments: " + Array.prototype.slice.call(arguments));
        
        // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
        var result = this.targetMethod.apply(this, arguments);
        
        // çµæœã‚’è¡¨ç¤ºã™ã‚‹
        console.log("Result: " + result);
        
        // çµæœã‚’å¤‰æ›´ã™ã‚‹
        result += 1;
        
        // å¤‰æ›´ã•ã‚ŒãŸçµæœã‚’è¿”ã™
        return result;
    };
});
"""

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹
script = session.create_script(js_code)

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
script.load()

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ãƒ‡ã‚¿ãƒƒãƒã™ã‚‹
session.detach()
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€`frida`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã€`com.example.app`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã®Androidã‚¢ãƒ—ãƒªã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦ã„ã¾ã™ã€‚JavaScriptã‚³ãƒ¼ãƒ‰ã¯ã€`Java.perform`é–¢æ•°å†…ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã—ã€ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’è¡¨ç¤ºã—ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã•ã‚‰ã«ã€çµæœã‚’å¤‰æ›´ã—ã¦å¤‰æ›´ã•ã‚ŒãŸçµæœã‚’è¿”ã—ã¾ã™ã€‚æœ€å¾Œã«ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ã—ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ãƒ‡ã‚¿ãƒƒãƒã—ã¾ã™ã€‚
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãªã„é–¢æ•°ã®ãƒ•ãƒƒã‚¯

ã‚¯ãƒ©ã‚¹ `sg.vantagepoint.a.c` ã®é–¢æ•° `a()` ã‚’ãƒ•ãƒƒã‚¯ã—ã¾ã™ã€‚
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
# Frida Tutorial: Hooking `exit()` in Android Apps

In this tutorial, we will learn how to hook the `exit()` function in Java code using Frida. By hooking this function, we can intercept the app's exit process and perform additional actions or modifications.

## Prerequisites

Before we begin, make sure you have the following:

- An Android device or emulator with a rooted or jailbroken environment.
- Frida installed on your machine. You can find installation instructions [here](https://frida.re/docs/installation/).

## Step 1: Setting up the Environment

First, we need to set up the environment for Frida. Follow these steps:

1. Connect your Android device or start the emulator.
2. Open a terminal and run the following command to check if the device is connected:

   ```bash
   adb devices
   ```

   You should see your device listed.

3. Start the target app on your device or emulator.

## Step 2: Writing the Frida Script

Now, let's write the Frida script to hook the `exit()` function. Create a new file called `hook_exit.js` and add the following code:

```javascript
Java.perform(function() {
  var System = Java.use('java.lang.System');
  var Runtime = Java.use('java.lang.Runtime');

  // Hook System.exit()
  System.exit.implementation = function(code) {
    console.log('System.exit() called with code: ' + code);

    // Perform additional actions or modifications here

    // Call the original System.exit() function
    this.exit(code);
  };

  // Hook Runtime.exit()
  Runtime.exit.implementation = function(code) {
    console.log('Runtime.exit() called with code: ' + code);

    // Perform additional actions or modifications here

    // Call the original Runtime.exit() function
    this.exit(code);
  };
});
```

## Step 3: Running the Frida Script

To run the Frida script, follow these steps:

1. Open a terminal and navigate to the directory where you saved `hook_exit.js`.
2. Run the following command to start the Frida server:

   ```bash
   frida-server
   ```

3. Open another terminal and navigate to the same directory.
4. Run the following command to attach Frida to the target app:

   ```bash
   frida -U -l hook_exit.js <package_name>
   ```

   Replace `<package_name>` with the package name of the target app.

5. You should see the output of the `console.log()` statements whenever `System.exit()` or `Runtime.exit()` is called in the app.

## Conclusion

In this tutorial, we learned how to hook the `exit()` function in Java code using Frida. By intercepting this function, we can perform additional actions or modifications during the app's exit process. This technique can be useful for various purposes, such as debugging or analyzing the behavior of an app.
```javascript
var sysexit = Java.use("java.lang.System");
sysexit.exit.overload("int").implementation = function(var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)");
};
```
# Fridaã‚’ä½¿ç”¨ã—ãŸAndroidã‚¢ãƒ—ãƒªã®ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®`.onStart()`ã¨`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

- Androidãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿
- FridaãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨

## æ‰‹é †

1. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹Androidã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

2. Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€`.onStart()`ã¨`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```javascript
Java.perform(function() {
    var MainActivity = Java.use('com.example.app.MainActivity');

    MainActivity.onStart.implementation = function() {
        console.log('Hooked MainActivity.onStart()');
        this.onStart();
    };

    MainActivity.onCreate.implementation = function() {
        console.log('Hooked MainActivity.onCreate()');
        this.onCreate();
    };
});
```

3. Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`hook.js`ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¾ã™ã€‚

4. Fridaã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€Androidã‚¢ãƒ—ãƒªã«å¯¾ã—ã¦Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é©ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
frida -U -l hook.js -f com.example.app
```

5. Androidã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`.onStart()`ã¨`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚ŒãŸã“ã¨ã‚’ç¤ºã™ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
[Android Emulator::com.example.app]-> Hooked MainActivity.onStart()
[Android Emulator::com.example.app]-> Hooked MainActivity.onCreate()
```

ã“ã‚Œã§ã€Androidã‚¢ãƒ—ãƒªã®`.onStart()`ã¨`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ãƒ•ãƒƒã‚¯ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä»»æ„ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity");
mainactivity.onStart.overload().implementation = function() {
send("MainActivity.onStart() HIT!!!");
var ret = this.onStart.overload().call(this);
};
mainactivity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("MainActivity.onCreate() HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
# Fridaã‚’ä½¿ç”¨ã—ãŸAndroidã‚¢ãƒ—ãƒªã®`.onCreate()`ã®ãƒ•ãƒƒã‚¯

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¢ãƒ—ãƒªã®èµ·å‹•æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é‡è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã®å‹•ä½œã‚’ç›£è¦–ã—ãŸã‚Šã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å‰ææ¡ä»¶

ä»¥ä¸‹ã®å‰ææ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- Androidãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨
- FridaãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ[Fridaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•](https://frida.re/docs/installation/)ã‚’å‚ç…§ï¼‰
- Fridaã‚µãƒ¼ãƒãƒ¼ãŒãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ[Fridaã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè¡Œæ–¹æ³•](https://frida.re/docs/android/)ã‚’å‚ç…§ï¼‰

## æ‰‹é †

1. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹Androidã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

2. Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```javascript
Java.perform(function() {
  var targetClass = Java.use('com.example.app.MainActivity');
  targetClass.onCreate.implementation = function() {
    console.log('onCreate() ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
    this.onCreate();
  };
});
```

3. Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`hook.js`ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¾ã™ã€‚

4. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
frida -U -f com.example.app -l hook.js --no-pause
```

5. ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã¨ã€`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ•ãƒƒã‚¯ã•ã‚Œã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## çµè«–

Fridaã‚’ä½¿ç”¨ã—ã¦Androidã‚¢ãƒ—ãƒªã®`.onCreate()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ•ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã®å‹•ä½œã‚’ç›£è¦–ã—ãŸã‚Šã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã«å½¹ç«‹ã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
```javascript
var activity = Java.use("android.app.Activity");
activity.onCreate.overload("android.os.Bundle").implementation = function(var_0) {
send("Activity HIT!!!");
var ret = this.onCreate.overload("android.os.Bundle").call(this,var_0);
};
```
### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤é–¢æ•°ã®ãƒ•ãƒƒã‚¯ã¨å€¤ã®å–å¾—

å¾©å·åŒ–é–¢æ•°ã®ãƒ•ãƒƒã‚¯ã€‚å…¥åŠ›ã‚’è¡¨ç¤ºã—ã€å…ƒã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦å…¥åŠ›ã‚’å¾©å·åŒ–ã—ã€æœ€å¾Œã«å¹³æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
```javascript
function getString(data){
var ret = "";
for (var i=0; i < data.length; i++){
ret += data[i].toString();
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a");
aes_decrypt.a.overload("[B","[B").implementation = function(var_0,var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding");
send("Key       : " + getString(var_0));
send("Encrypted : " + getString(var_1));
var ret = this.a.overload("[B","[B").call(this,var_0,var_1);
send("Decrypted : " + ret);

var flag = "";
for (var i=0; i < ret.length; i++){
flag += String.fromCharCode(ret[i]);
}
send("Decrypted flag: " + flag);
return ret; //[B
};
```
### ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ãƒƒã‚¯ã¨å…¥åŠ›ã‚’ä½¿ç”¨ã—ãŸå‘¼ã³å‡ºã—

é–¢æ•°ã‚’ãƒ•ãƒƒã‚¯ã—ã¦ã€æ–‡å­—åˆ—ã‚’å—ã‘å–ã‚Šã€ä»–ã®æ–‡å­—åˆ—ã§å‘¼ã³å‡ºã—ã¾ã™ï¼ˆ[ã“ã¡ã‚‰](https://11x256.github.io/Frida-hooking-android-part-2/)ã‹ã‚‰ï¼‰ã€‚
```javascript
var string_class = Java.use("java.lang.String"); // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function(x){ //hooking the new function
var my_string = string_class.$new("My TeSt String#####"); //creating a new String by using `new` operator
console.log("Original arg: " +x );
var ret =  this.fun(my_string); // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: "+ret);
return ret;
};
```
### æ—¢ã«ä½œæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹

ä½œæˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å±æ€§ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã¯ã€ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã€ã‚¯ãƒ©ã‚¹my\_activityã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå±æ€§ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°.secret()ã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity" , {
onMatch : function(instance){ //This function will be called for every instance found by frida
console.log("Found instance: "+instance);
console.log("Result of secret func: " + instance.secret());
},
onComplete:function(){}
});
```
## ä»–ã®Fridaãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

* [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)



<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ’ãƒ³ãƒˆ**: **Intigriti**ã«**ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ãƒãƒƒã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãª**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã§ã™ï¼ä»Šã™ã[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ã«å‚åŠ ã—ã¦ã€æœ€å¤§**$100,000**ã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã‚’ç²å¾—ã—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
