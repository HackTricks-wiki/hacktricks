# Tutorial de Objection

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo para bug bounty**: **reg铆strate** en **Intigriti**, una plataforma premium de **bug bounty creada por hackers, para hackers**. nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo, y comienza a ganar recompensas de hasta **$100,000**.

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introducci贸n**

[![objection](https://github.com/sensepost/objection/raw/master/images/objection.png)](https://github.com/sensepost/objection)

**objection - Exploraci贸n M贸vil en Tiempo de Ejecuci贸n**

`objection` es un kit de herramientas para la exploraci贸n m贸vil en tiempo de ejecuci贸n, impulsado por [Frida](https://www.frida.re). Fue creado con el objetivo de ayudar a evaluar aplicaciones m贸viles y su postura de seguridad sin la necesidad de un dispositivo m贸vil con jailbreak o root.

**Nota:** Esto no es una forma de eludir jailbreak / root. Al usar `objection`, todav铆a est谩s limitado por todas las restricciones impuestas por el sandbox aplicable al que te enfrentas.

### Resumen

El **objetivo** de **objection** es permitir al usuario llamar a las **acciones principales que ofrece Frida**. **De lo contrario**, el usuario necesitar谩 crear un **script individual para cada aplicaci贸n** que quiera probar.

## Tutorial

Para este tutorial voy a usar el APK que puedes descargar aqu铆:

{% file src="../../../.gitbook/assets/app-release.zip" %}

O desde su [repositorio original](https://github.com/asvid/FridaApp) (descargar app-release.apk)

### Instalaci贸n
```bash
pip3 install objection
```
### Conexi贸n

Establezca una **conexi贸n ADB regular** y **inicie** el servidor **frida** en el dispositivo (y verifique que frida est茅 funcionando tanto en el cliente como en el servidor).

Si est谩 utilizando un **dispositivo rooteado**, es necesario seleccionar la aplicaci贸n que desea probar dentro de la opci贸n _**--gadget**_. en este caso:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Acciones B谩sicas

No se van a listar todos los posibles comandos de objection en este tutorial, solo aquellos que he encontrado m谩s 煤tiles.

#### Entorno

Alguna informaci贸n interesante (como contrase帽as o rutas) podr铆a encontrarse dentro del entorno.
```bash
env
```
#### Informaci贸n de Frida
```bash
frida
```
#### Subida/Descarga
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importar script de frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detecci贸n de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Comando Exec
```bash
android shell_exec whoami
```
#### Capturas de pantalla
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### An谩lisis est谩tico hecho din谩mico

En una aplicaci贸n real deber铆amos conocer toda la informaci贸n descubierta en esta parte antes de usar objection gracias al **an谩lisis est谩tico**. De todos modos, quiz谩s puedas ver **algo nuevo**, ya que aqu铆 solo tendr谩s una lista completa de clases, m茅todos y objetos exportados.

Esto tambi茅n es 煤til si de alguna manera **no puedes obtener alg煤n c贸digo fuente legible** de la app.

#### Listar actividades, receptores y servicios
```
android hooking list activities
```
Como no se proporcion贸 texto en ingl茅s para traducir, no puedo realizar la traducci贸n solicitada. Si proporcionas el texto en ingl茅s relevante, estar茅 encantado de ayudarte con la traducci贸n al espa帽ol.
```
android hooking list services
android hooking list receivers
```
Frida lanzar谩 un error si no se encuentra ninguna

#### Obtener la actividad actual
```
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (73) (1).png>)

#### Buscar Clases

Comencemos buscando clases dentro de nuestra aplicaci贸n
```
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (69).png>)

#### Buscar m茅todos de una clase

Ahora extraigamos los m茅todos dentro de la clase _MainActivity:_
```
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (70) (1).png>)

#### Listar m茅todos declarados de una clase con sus par谩metros

Vamos a determinar qu茅 par谩metros necesitan los m茅todos de la clase:
```
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (79).png>)

#### Listar clases

Tambi茅n puedes listar todas las clases que se cargaron dentro de la aplicaci贸n actual:
```
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Esto es muy 煤til si quieres **enganchar el m茅todo de una clase y solo conoces el nombre de la clase**. Podr铆as usar esta funci贸n para **buscar qu茅 m贸dulo posee la clase** y luego enganchar su m茅todo.

### Enganchar siendo f谩cil

#### Enganchar (observar) un m茅todo

Desde el [c贸digo fuente](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de la aplicaci贸n sabemos que la **funci贸n** _**sum()**_ **de** _**MainActivity**_ se ejecuta **cada segundo**. Intentemos **volcar toda la informaci贸n posible** cada vez que se llama a la funci贸n (argumentos, valor de retorno y rastreo de pila):
```
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (71).png>)

#### Haciendo hooking (monitoreo) de una clase completa

De hecho, encuentro todos los m茅todos de la clase MainActivity realmente interesantes, vamos a **hacerles hook a todos**. Ten cuidado, esto podr铆a **hacer que una aplicaci贸n se cierre inesperadamente**.
```
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si juegas con la aplicaci贸n mientras la clase est谩 enganchada, ver谩s cu谩ndo **se llama a cada funci贸n**, sus **argumentos** y el valor de **retorno**.

![](<../../../.gitbook/assets/image (72).png>)

#### Cambiando el valor de retorno booleano de una funci贸n

Desde el c贸digo fuente puedes ver que la funci贸n _checkPin_ recibe un _String_ como argumento y devuelve un _boolean_. Hagamos que la funci贸n **siempre devuelva true**:

![](<../../../.gitbook/assets/image (74).png>)

Ahora, si escribes cualquier cosa en el cuadro de texto para el c贸digo PIN, ver谩s que cualquier cosa es v谩lida:

![](<../../../.gitbook/assets/image (77).png>)

### Instancias de clases

Busca e imprime **instancias activas de una clase Java espec铆fica**, especificada por un nombre de clase completamente calificado. Out es el resultado de un intento de obtener un valor de cadena para un objeto descubierto que t铆picamente **contendr铆a valores de propiedad para el objeto**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Puedes interactuar con el keystore y los intents utilizando:
```
android keystore list
android intents launch_activity
android intent launch_service
```
### Memoria

#### Volcado
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```
memory list modules
```
![](<../../../.gitbook/assets/image (66).png>)

En la parte inferior de la lista puedes ver frida:

![](<../../../.gitbook/assets/image (67).png>)

Veamos qu茅 est谩 exportando frida:

![](<../../../.gitbook/assets/image (68).png>)

#### Buscar/Escribir

Tambi茅n puedes buscar y escribir dentro de la memoria con objection:
```
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puedes usar el comando `sqlite` para interactuar con bases de datos sqlite.

### Salir
```
exit
```
## Lo que echo en falta en Objection

* Los m茅todos de hooking a veces hacen que la aplicaci贸n se cierre (esto tambi茅n se debe a Frida).
* No puedes usar las instancias de las clases para llamar a funciones de la instancia. Y no puedes crear nuevas instancias de clases y usarlas para llamar a funciones.
* No hay un atajo (como el que existe para sslpinnin) para enganchar todos los m茅todos criptogr谩ficos comunes que utiliza la aplicaci贸n para ver texto cifrado, texto plano, claves, IVs y algoritmos utilizados.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Consejo para cazar bugs**: **reg铆strate** en **Intigriti**, una plataforma de caza de bugs premium creada por hackers, para hackers. 隆nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy mismo y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
