# Bypass Biometric Authentication (Android)

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ã¦ã¿ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discordã‚°ãƒ«ãƒ¼ãƒ—**ã«å‚åŠ ã™ã‚‹ã‹ã€[Telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€**[**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)**ã¨**[**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„**ã€‚

</details>

## **æ–¹æ³•1 â€“ æš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨ãªã—ã§ã®ãƒã‚¤ãƒ‘ã‚¹**

ã“ã“ã§ã¯ã€èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã§é‡è¦ãª_onAuthenticationSucceeded_ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã™ã€‚WithSecureã®ç ”ç©¶è€…ãŸã¡ã¯ã€\*onAuthenticationSucceeded(...)\*ã§ã®NULL _CryptoObject_ã®ãƒã‚¤ãƒ‘ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹[Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js)ã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—æ™‚ã«æŒ‡ç´‹èªè¨¼ã‚’è‡ªå‹•çš„ã«ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€Androidã®æŒ‡ç´‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒã‚¤ãƒ‘ã‚¹ã‚’ç¤ºã™ç°¡ç•¥åŒ–ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã§ã‚ã‚Šã€å®Œå…¨ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯[GitHub](https://github.com/St3v3nsS/InsecureBanking)ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```

```bash
frida -U -f <package_name> -l <script_name.js> --no-pause
```

```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```

## **æ–¹æ³•2 â€“ ä¾‹å¤–å‡¦ç†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

åˆ¥ã®[Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js)ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±ãªæš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¿°ã¹ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ‡ç´‹ã«ã‚ˆã£ã¦èªè¨¼ã•ã‚Œã¦ã„ãªã„_CryptoObject_ã‚’ä½¿ç”¨ã—ã¦_onAuthenticationSucceeded_ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç•°ãªã‚‹æš—å·ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€_onAuthenticationSucceeded_ã‚’å‘¼ã³å‡ºã™æº–å‚™ã‚’ã—ã€\_Cipher\_ã‚¯ãƒ©ã‚¹ã§_javax.crypto.IllegalBlockSizeException_ã‚’å‡¦ç†ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹å¾Œç¶šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ–°ã—ã„ã‚­ãƒ¼ã§æš—å·åŒ–ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

Fridaã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼š

```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```

ä»¥ä¸‹ã¯ã€Fridaã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§`bypass()`ã‚’å…¥åŠ›ã—ã¦ãƒã‚¤ãƒ‘ã‚¹ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã™ã‚‹ãŸã‚ã«ã€æŒ‡ç´‹èªè¨¼ç”»é¢ã«åˆ°é”ã—`authenticate()`ã‚’é–‹å§‹ã—ãŸå¾Œã®æ‰‹é †ã§ã™ï¼š

```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```

## **æ–¹æ³•3 â€“ Instrumentation Frameworks**

Instrumentation frameworks like Xposed or Frida can be used to hook into application methods at runtime. For fingerprint authentication, these frameworks can:

1. **Mock the Authentication Callbacks**: By hooking into the `onAuthenticationSucceeded`, `onAuthenticationFailed`, or `onAuthenticationError` methods of the `BiometricPrompt.AuthenticationCallback`, you can control the outcome of the fingerprint authentication process.
2. **Bypass SSL Pinning**: This allows an attacker to intercept and modify the traffic between the client and the server, potentially altering the authentication process or stealing sensitive data.

Example command for Frida:

```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```

## **æ–¹æ³•4 â€“ é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´**

`APKTool`ã€`dex2jar`ã€`JD-GUI`ãªã©ã®é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Androidã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã€èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€èˆ¬çš„ãªæ‰‹é †ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

1. **APKã®é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«**: APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ˆã‚Šäººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼ï¼ˆä¾‹ï¼šJavaã‚³ãƒ¼ãƒ‰ï¼‰ã«å¤‰æ›ã—ã¾ã™ã€‚
2. **ã‚³ãƒ¼ãƒ‰ã®åˆ†æ**: æŒ‡ç´‹èªè¨¼ã®å®Ÿè£…ã‚’æ¢ã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚„é©åˆ‡ã§ãªã„æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãªã©ã®æ½œåœ¨çš„ãªå¼±ç‚¹ã‚’ç‰¹å®šã—ã¾ã™ã€‚
3. **APKã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«**: æŒ‡ç´‹èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€ç½²åã—ã¦ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

## **æ–¹æ³•5 â€“ ã‚«ã‚¹ã‚¿ãƒ èªè¨¼ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨**

èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒ†ã‚¹ãƒˆãŠã‚ˆã³ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸå°‚é–€ãƒ„ãƒ¼ãƒ«ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š

1. **MAGISKãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: MAGISKã¯Androidç”¨ã®ãƒ„ãƒ¼ãƒ«ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒ«ãƒ¼ãƒˆåŒ–ã—ã€æŒ‡ç´‹ãªã©ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«ã®æƒ…å ±ã‚’å¤‰æ›´ã¾ãŸã¯ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã§ãã¾ã™ã€‚
2. **ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦ã€Android Debug Bridgeï¼ˆADBï¼‰ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ç›´æ¥ã‚„ã‚Šå–ã‚Šã—ã€æŒ‡ç´‹èªè¨¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ãŸã‚Šãƒã‚¤ãƒ‘ã‚¹ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)
