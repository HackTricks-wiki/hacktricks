# Secuestro de Tareas en Android

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Tarea, Pila de Actividades y Actividades en Primer Plano

En Android, una **tarea** es esencialmente un conjunto de actividades con las que los usuarios interact煤an para completar un trabajo espec铆fico, organizadas dentro de una **pila de actividades**. Esta pila ordena las actividades seg煤n cu谩ndo se abrieron, con la actividad m谩s reciente mostrada en la parte superior como la **actividad en primer plano**. En cualquier momento, solo esta actividad es visible en la pantalla, haci茅ndola parte de la **tarea en primer plano**.

Aqu铆 tienes un desglose r谩pido de las transiciones de actividad:

* **Actividad 1** comienza como la 煤nica actividad en primer plano.
* Al iniciar **Actividad 2**, se empuja **Actividad 1** a la pila de atr谩s, llevando **Actividad 2** al primer plano.
* Al iniciar **Actividad 3**, se mueven **Actividad 1** y **Actividad 2** m谩s atr谩s en la pila, con **Actividad 3** ahora al frente.
* Al cerrar **Actividad 3**, se trae de vuelta **Actividad 2** al primer plano, mostrando el mecanismo de navegaci贸n de tareas simplificado de Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (548).png>)

## Ataque de Afinidad de Tareas

### Visi贸n general de la Afinidad de Tareas y Modos de Inicio

En las aplicaciones de Android, la **afinidad de tareas** especifica la tarea preferida de una actividad, aline谩ndose t铆picamente con el nombre del paquete de la aplicaci贸n. Esta configuraci贸n es fundamental para crear una aplicaci贸n de prueba de concepto (PoC) que demuestre el ataque.

### Modos de Inicio

El atributo `launchMode` dirige el manejo de instancias de actividad dentro de las tareas. El modo **singleTask** es fundamental para este ataque, dictando tres escenarios basados en las instancias de actividad existentes y las coincidencias de afinidad de tareas. El exploit se basa en la capacidad de la aplicaci贸n de un atacante para imitar la afinidad de tareas de la aplicaci贸n objetivo, enga帽ando al sistema de Android para que lance la aplicaci贸n del atacante en lugar de la aplicaci贸n objetivo prevista.

### Pasos Detallados del Ataque

1. **Instalaci贸n de la Aplicaci贸n Maliciosa**: La v铆ctima instala la aplicaci贸n del atacante en su dispositivo.
2. **Activaci贸n Inicial**: La v铆ctima abre primero la aplicaci贸n maliciosa, preparando el dispositivo para el ataque.
3. **Intento de Inicio de la Aplicaci贸n Objetivo**: La v铆ctima intenta abrir la aplicaci贸n objetivo.
4. **Ejecuci贸n del Secuestro**: Debido a la afinidad de tareas coincidente, la aplicaci贸n maliciosa se inicia en lugar de la aplicaci贸n objetivo.
5. **Enga帽o**: La aplicaci贸n maliciosa presenta una pantalla de inicio de sesi贸n falsa que se asemeja a la de la aplicaci贸n objetivo, enga帽ando al usuario para que ingrese informaci贸n sensible.

Para una implementaci贸n pr谩ctica de este ataque, consulta el repositorio de Secuestro de Tareas Strandhogg en GitHub: [Secuestro de Tareas Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Medidas de Prevenci贸n

Para prevenir tales ataques, los desarrolladores pueden establecer `taskAffinity` en una cadena vac铆a y optar por el modo de inicio `singleInstance`, asegurando el aislamiento de su aplicaci贸n de otras. Personalizar la funci贸n `onBackPressed()` ofrece protecci贸n adicional contra el secuestro de tareas.

## **Referencias**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
