# Secuestro de Tareas en Android

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encuentra las vulnerabilidades que m치s importan para que puedas solucionarlas m치s r치pido. Intruder rastrea tu superficie de ataque, ejecuta escaneos proactivos de amenazas, encuentra problemas en toda tu pila tecnol칩gica, desde APIs hasta aplicaciones web y sistemas en la nube. [**춰Pru칠balo gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoy.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Tarea, Pila de Atr치s y Actividades en Primer Plano

En Android, una **tarea** es esencialmente un conjunto de actividades con las que los usuarios interact칰an para completar un trabajo espec칤fico, organizadas dentro de una **pila de atr치s**. Esta pila ordena las actividades seg칰n cu치ndo se abrieron, con la actividad m치s reciente mostrada en la parte superior como la **actividad en primer plano**. En cualquier momento, solo esta actividad es visible en la pantalla, haci칠ndola parte de la **tarea en primer plano**.

Aqu칤 tienes un desglose r치pido de las transiciones de actividad:

- **Actividad 1** comienza como la 칰nica actividad en primer plano.
- Al lanzar **Actividad 2**, se empuja **Actividad 1** a la pila de atr치s, llevando **Actividad 2** al primer plano.
- Al iniciar **Actividad 3**, se mueven **Actividad 1** y **Actividad 2** m치s atr치s en la pila, con **Actividad 3** ahora al frente.
- Al cerrar **Actividad 3**, se trae de vuelta **Actividad 2** al primer plano, mostrando el mecanismo de navegaci칩n de tareas simplificado de Android.

![https://developer.android.com/images/fundamentals/diagram_backstack.png](<../../.gitbook/assets/image (548).png>)

## Ataque de Afinidad de Tarea

### Visi칩n general de la Afinidad de Tarea y Modos de Inicio

En las aplicaciones de Android, la **afinidad de tarea** especifica la tarea preferida de una actividad, aline치ndose t칤picamente con el nombre del paquete de la aplicaci칩n. Esta configuraci칩n es fundamental para crear una aplicaci칩n de prueba de concepto (PoC) que demuestre el ataque.

### Modos de Inicio

El atributo `launchMode` dirige el manejo de instancias de actividad dentro de las tareas. El modo **singleTask** es fundamental para este ataque, dictando tres escenarios basados en las instancias de actividad existentes y las coincidencias de afinidad de tarea. El exploit se basa en la capacidad de la aplicaci칩n de un atacante para imitar la afinidad de tarea de la aplicaci칩n objetivo, enga침ando al sistema Android para que lance la aplicaci칩n del atacante en lugar de la aplicaci칩n objetivo prevista.

### Pasos Detallados del Ataque

1. **Instalaci칩n de la Aplicaci칩n Maliciosa**: La v칤ctima instala la aplicaci칩n del atacante en su dispositivo.
2. **Activaci칩n Inicial**: La v칤ctima abre primero la aplicaci칩n maliciosa, preparando el dispositivo para el ataque.
3. **Intento de Inicio de la Aplicaci칩n Objetivo**: La v칤ctima intenta abrir la aplicaci칩n objetivo.
4. **Ejecuci칩n de Secuestro**: Debido a la afinidad de tarea coincidente, la aplicaci칩n maliciosa se inicia en lugar de la aplicaci칩n objetivo.
5. **Enga침o**: La aplicaci칩n maliciosa presenta una pantalla de inicio de sesi칩n falsa que se asemeja a la aplicaci칩n objetivo, enga침ando al usuario para que ingrese informaci칩n sensible.

Para una implementaci칩n pr치ctica de este ataque, consulta el repositorio de Secuestro de Tareas Strandhogg en GitHub: [Secuestro de Tareas Strandhogg](https://github.com/az0mb13/Task_Hijacking_Strandhogg).

### Medidas de Prevenci칩n

Para prevenir tales ataques, los desarrolladores pueden establecer `taskAffinity` en una cadena vac칤a y optar por el modo de inicio `singleInstance`, asegurando el aislamiento de su aplicaci칩n de otras. Personalizar la funci칩n `onBackPressed()` ofrece protecci칩n adicional contra el secuestro de tareas.

## **Referencias**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encuentra las vulnerabilidades que m치s importan para que puedas solucionarlas m치s r치pido. Intruder rastrea tu superficie de ataque, ejecuta escaneos proactivos de amenazas, encuentra problemas en toda tu pila tecnol칩gica, desde APIs hasta aplicaciones web y sistemas en la nube. [**춰Pru칠balo gratis**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoy.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
