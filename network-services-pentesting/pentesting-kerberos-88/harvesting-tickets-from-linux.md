No Linux, os tickets sÃ£o armazenados em caches de credenciais ou ccaches. Existem 3 tipos principais, que indicam onde os tickets podem ser encontrados:

* **Arquivos**, por padrÃ£o no diretÃ³rio **/tmp**, na forma de **krb5cc\_%{uid}.**
* **Kernel Keyrings**, um espaÃ§o especial no kernel do Linux fornecido para armazenar chaves.
* **MemÃ³ria do processo**, usada quando apenas um processo precisa usar os tickets.

Para verificar qual tipo de armazenamento Ã© usado em uma mÃ¡quina especÃ­fica, a variÃ¡vel _**default\_ccache\_name**_ deve ser verificada no arquivo **/etc/krb5.conf**, que por padrÃ£o tem permissÃ£o de leitura para qualquer usuÃ¡rio. Caso esse parÃ¢metro esteja faltando, seu valor padrÃ£o Ã© _FILE:/tmp/krb5cc\_%{uid}_.

Para extrair tickets das outras 2 fontes (keyrings e processos), um Ã³timo artigo, [**Kerberos Credential Thievery (GNU/Linux)**](https://www.delaat.net/rp/2016-2017/p97/report.pdf), lanÃ§ado em 2017, explica maneiras de recuperar os tickets deles.

### Keyring - Do artigo

> O **kernel do Linux** possui um recurso chamado **keyrings**. Esta Ã© uma **Ã¡rea de memÃ³ria** que reside dentro do kernel e Ã© usada para **gerenciar e reter chaves**.
>
> A chamada do sistema **keyctl** foi introduzida na versÃ£o do kernel 2.6.10 5. Isso fornece **Ã s aplicaÃ§Ãµes do espaÃ§o do usuÃ¡rio uma API** que pode ser usada para interagir com keyrings do kernel.

> O **nome do keyring** em uso pode ser analisado a partir do **arquivo de configuraÃ§Ã£o do Kerberos /etc/krb5.conf**, que tem permissÃ£o de leitura habilitada para qualquer pessoa (octal 644) por padrÃ£o. Um invasor pode entÃ£o aproveitar essa informaÃ§Ã£o para **procurar por tickets** 11 contendo keyrings e extrair os tickets. Um script de prova de conceito que implementa essa funcionalidade pode ser visto na SeÃ§Ã£o A.2 **(hercules.sh)**. Em um keyring, o ccache Ã© armazenado como componentes. Como visto na Figura 2, um ccache de arquivo Ã© composto por 3 componentes distintos: cabeÃ§alho, principal padrÃ£o e uma sequÃªncia de credenciais. Um **keyring contÃ©m o principal padrÃ£o e as credenciais**. Este script irÃ¡ despejar esses componentes em arquivos separados. Em seguida, usando um **cabeÃ§alho sintetizado pelo invasor**, esses pedaÃ§os sÃ£o combinados na ordem correta para **reconstruir um ccache de arquivo**. Este arquivo reconstruÃ­do pode entÃ£o ser exfiltrado para uma mÃ¡quina invasora e depois usado para se passar por um usuÃ¡rio Kerberos. Um programa simples para gerar um cabeÃ§alho ccache vÃ¡lido pode ser visto na SeÃ§Ã£o A.3.

Com base no **script heracles.sh** (do artigo), uma ferramenta em C que vocÃª pode usar (criada pelo autor do post completo) Ã© [**tickey**](https://github.com/TarlogicSecurity/tickey), e ela extrai tickets de keyrings:
```
/tmp/tickey -i
```
**Esta informaÃ§Ã£o foi retirada de:** [**https://www.tarlogic.com/en/blog/how-to-attack-kerberos/**](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
