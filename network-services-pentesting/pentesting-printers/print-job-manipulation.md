<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# ConteÃºdo Overlay

Uma maneira simples de manipular a aparÃªncia de impressÃµes Ã© **usar overlays**. \
[**PCL**](./#pcl) tem uma funÃ§Ã£o documentada para colocar **macros de overlay** em cima de um documento. Infelizmente, esse recurso Ã© **limitado ao trabalho de impressÃ£o atual** e nÃ£o pode ser tornar permanente. \
[**PostScript**](./#postscript-ps) nÃ£o oferece tal funcionalidade por padrÃ£o, no entanto, pode ser programado para **redefinir o operador showpage** que estÃ¡ contido em cada documento PostScript para imprimir a pÃ¡gina atual. O atacante pode **inserir seu cÃ³digo** lÃ¡, executÃ¡-lo e depois chamar a versÃ£o original do operador.\
Portanto, ela pode sobrepor todas as pÃ¡ginas a serem impressas com um arquivo EPS personalizado. Esse hack pode ser usado para **adicionar grÃ¡ficos ou fontes arbitrÃ¡rios a cÃ³pias impressas de um documento** (Ã© possÃ­vel alterar completamente a aparÃªncia de um documento sobrepondo uma pÃ¡gina em branco e depois adicionando conteÃºdo personalizado).\
Obviamente, tal abordagem sÃ³ pode ser bem-sucedida se o PostScript for usado como driver de impressora e nenhum `StartJobPassword` estiver definido.

![](http://hacking-printers.net/wiki/images/thumb/9/93/Overlay.jpg/300px-Overlay.jpg)

**Como testar esse ataque?**

Use os comandos `cross` ou `overlay` do [**PRET**](https://github.com/RUB-NDS/PRET) no modo ps, desconecte e imprima um documento arbitrÃ¡rio:
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> overlay overlays/smiley.eps
printer:/> cross whoa "HACKED"
printer:/> exit
```
# SubstituiÃ§Ã£o de ConteÃºdo

Mesmo que um invasor possa colocar uma sobreposiÃ§Ã£o acima de documentos existentes, ela nÃ£o poderÃ¡ **alterar valores especÃ­ficos** no documento original, a menos que sua estrutura exata seja conhecida. Ã€s vezes, nÃ£o se quer apenas adicionar conteÃºdo personalizado, mas **analisar e substituir partes** do documento existente. \
O problema de substituir texto em arquivos PostScript pode ser reduzido ao **problema de extrair strings** do documento renderizado. Isso nÃ£o Ã© trivial, porque as strings podem ser construÃ­das dinamicamente pelo prÃ³prio programa PostScript. Portanto, a anÃ¡lise e substituiÃ§Ã£o simples dentro do cÃ³digo-fonte do documento nÃ£o Ã© uma opÃ§Ã£o.\
VocÃª pode usar um **operador `show` redefinido**. O operador show aceita uma string como entrada, que Ã© pintada em uma determinada localizaÃ§Ã£o da pÃ¡gina atual. Ao redefinir o operador, o **texto** pode ser **extraÃ­do** de forma elegante. Essa abordagem tambÃ©m pode ser usada para **pesquisar e substituir** strings imediatamente **antes** de serem **pintadas**. \
A abordagem Ã© **bem-sucedida** para documentos PostScript baseados em **LaTeX** que sÃ£o enviados diretamente para a impressora, enquanto **falha** para arquivos PostScript gerados pelo **GIMP**, que em vez de strings **cria grÃ¡ficos raster** de sua representaÃ§Ã£o. O mesmo problema ocorre para qualquer formato de documento - atÃ© mesmo o prÃ³prio PostScript - quando processado pelo CUPS. Teoricamente, tais construÃ§Ãµes de linguagem tambÃ©m poderiam ser analisadas e devem ser objeto de pesquisas adicionais.

**Como testar esse ataque?**

Use o comando `replace` do [**PRET**](https://github.com/RUB-NDS/PRET) no modo ps, desconecte e imprima um documento PostScript contendo 'DEF':
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> replace "ABC" "DEF"
printer:/> exit
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
