# 22 - SSH/SFTPã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
- **HackTricks**ãŠã‚ˆã³**HackTricks Cloud**ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€**ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>

<figure><img src="../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ’ãƒ³ãƒˆ**ï¼š**ãƒãƒƒã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãªãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã§ã‚ã‚‹**Intigriti**ã«**ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**ã—ã¦ãã ã•ã„ï¼ä»Šã™ã[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ã«å‚åŠ ã—ã¦ã€æœ€å¤§**$100,000**ã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã‚’ç²å¾—ã—å§‹ã‚ã¾ã—ã‚‡ã†ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## åŸºæœ¬æƒ…å ±

**SSHï¼ˆSecure Shellã¾ãŸã¯Secure Socket Shellï¼‰**ã¯ã€ã‚»ã‚­ãƒ¥ã‚¢ãªæ¥ç¶šã‚’å¯èƒ½ã«ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãªã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«å®‰å…¨ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒªãƒ¢ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ãƒ‡ãƒ¼ã‚¿ã®æ©Ÿå¯†æ€§ã¨æ•´åˆæ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ:** 22
```
22/tcp open  ssh     syn-ack
```
**SSHã‚µãƒ¼ãƒãƒ¼:**

* [openSSH](http://www.openssh.org) â€“ OpenBSD SSHã€BSDã€Linuxãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€ãŠã‚ˆã³Windowsï¼ˆWindows 10ä»¥é™ï¼‰ã«æ­è¼‰ã•ã‚Œã¦ã„ã¾ã™
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) â€“ ä½ãƒ¡ãƒ¢ãƒªã¨ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒªã‚½ãƒ¼ã‚¹ç’°å¢ƒå‘ã‘ã®SSHå®Ÿè£…ã§ã€OpenWrtã«æ­è¼‰ã•ã‚Œã¦ã„ã¾ã™
* [PuTTY](https://www.chiark.greenend.org.uk/\~sgtatham/putty/) â€“ Windowså‘ã‘ã®SSHå®Ÿè£…ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã‚µãƒ¼ãƒãƒ¼ã®ä½¿ç”¨ã¯ç¨€ã§ã™
* [CopSSH](https://www.itefix.net/copssh) â€“ Windowså‘ã‘ã®OpenSSHã®å®Ÿè£…

**SSHãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å®Ÿè£…ï¼‰:**

* [libssh](https://www.libssh.org) â€“ SSHv2ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å®Ÿè£…ã—ãŸãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®Cãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€[Python](https://github.com/ParallelSSH/ssh-python)ã€[Perl](https://github.com/garnier-quentin/perl-libssh/)ã€ãŠã‚ˆã³[R](https://github.com/ropensci/ssh)å‘ã‘ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒã‚ã‚Šã¾ã™ã€‚KDEã§ã¯sftpã«ä½¿ç”¨ã•ã‚Œã€GitHubã§ã¯git SSHã‚¤ãƒ³ãƒ•ãƒ©ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) â€“ ANSI Cã§è¨˜è¿°ã•ã‚ŒãŸSSHv2ã‚µãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€çµ„ã¿è¾¼ã¿ã€RTOSã€ãŠã‚ˆã³ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„ã®ç’°å¢ƒå‘ã‘ã§ã™
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) â€“ Apache SSHD Javaãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Apache MINAã«åŸºã¥ã„ã¦ã„ã¾ã™
* [paramiko](https://github.com/paramiko/paramiko) â€“ Python SSHv2ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

## åˆ—æŒ™

### ãƒãƒŠãƒ¼ã®å–å¾—
```bash
nc -vn <IP> 22
```
### è‡ªå‹•åŒ–ã•ã‚ŒãŸssh-audit

ssh-auditã¯sshã‚µãƒ¼ãƒãƒ¼ãŠã‚ˆã³ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ§‹æˆç›£æŸ»ã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit)ã¯[https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/)ã‹ã‚‰æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ã‚¯ã§ã™ã€‚

**æ©Ÿèƒ½:**

* SSH1ãŠã‚ˆã³SSH2ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ;
* SSHã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ§‹æˆã®åˆ†æ;
* ãƒãƒŠãƒ¼ã®å–å¾—ã€ãƒ‡ãƒã‚¤ã‚¹ã¾ãŸã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŠã‚ˆã³ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®èªè­˜ã€åœ§ç¸®ã®æ¤œå‡º;
* éµäº¤æ›ã€ãƒ›ã‚¹ãƒˆã‚­ãƒ¼ã€æš—å·åŒ–ãŠã‚ˆã³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åé›†;
* ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æƒ…å ±ã®å‡ºåŠ›ï¼ˆåˆ©ç”¨å¯èƒ½ãªæœŸé–“ã€å‰Šé™¤/ç„¡åŠ¹åŒ–ã€å®‰å…¨ã§ãªã„/å¼±ã„/ãƒ¬ã‚¬ã‚·ãƒ¼ãªã©ï¼‰;
* ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ¨å¥¨äº‹é …ã®å‡ºåŠ›ï¼ˆèªè­˜ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åŸºã¥ã„ã¦è¿½åŠ ã¾ãŸã¯å‰Šé™¤ï¼‰;
* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã®å‡ºåŠ›ï¼ˆé–¢é€£ã™ã‚‹å•é¡Œã€å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸCVEãƒªã‚¹ãƒˆãªã©ï¼‰;
* ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æƒ…å ±ã«åŸºã¥ã„ãŸSSHãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®äº’æ›æ€§ã®åˆ†æ;
* OpenSSHã€Dropbear SSHã€libsshã‹ã‚‰ã®å±¥æ­´æƒ…å ±;
* LinuxãŠã‚ˆã³Windowsã§å®Ÿè¡Œå¯èƒ½;
* ä¾å­˜é–¢ä¿‚ãªã—
```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

-1,  --ssh1             force ssh version 1 only
-2,  --ssh2             force ssh version 2 only
-4,  --ipv4             enable IPv4 (order of precedence)
-6,  --ipv6             enable IPv6 (order of precedence)
-p,  --port=<port>      port to connect
-b,  --batch            batch output
-c,  --client-audit     starts a server on port 2222 to audit client
software config (use -p to change port;
use -t to change timeout)
-n,  --no-colors        disable colors
-j,  --json             JSON output
-v,  --verbose          verbose output
-l,  --level=<level>    minimum output level (info|warn|fail)
-t,  --timeout=<secs>   timeout (in seconds) for connection and reading
(default: 5)
$ python3 ssh-audit <IP>
```
### ã‚µãƒ¼ãƒãƒ¼ã®å…¬é–‹SSHã‚­ãƒ¼

[ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹ï¼ˆAsciinemaï¼‰](https://asciinema.org/a/96ejZKxpbuupTK9j7h8BdClzp)
```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```
### å¼±ã„æš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**nmap**ã«ã‚ˆã£ã¦ç™ºè¦‹ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€**sslcan**ã‚„**sslyze**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### Nmapã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```
### Shodan

* `ssh`

## Brute force usernames, passwords and private keys

### ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®åˆ—æŒ™

ä¸€éƒ¨ã®OpenSSHãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«metasploitãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```
msf> use scanner/ssh/ssh_enumusers
```
### [Brute force](../generic-methodologies-and-resources/brute-force.md#ssh)

ä¸€èˆ¬çš„ãªsshã®è³‡æ ¼æƒ…å ±ã¯[ã“ã¡ã‚‰](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt)ã¨[ã“ã¡ã‚‰](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt)ã«ã‚ã‚Šã¾ã™ã€‚

### ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã®ç·å½“ãŸã‚Šæ”»æ’ƒ

ä½¿ç”¨å¯èƒ½ãªsshãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆã¯ã€è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚nmapã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```
ã¾ãŸã¯ã€MSFè£œåŠ©ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼š
```
msf> use scanner/ssh/ssh_identify_pubkeys
```
#### Known badkeys can be found here:

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### Weak SSH keys / Debian predictable PRNG

Some systems have known flaws in the random seed used to generate cryptographic material. This can result in a dramatically reduced keyspace which can be bruteforced. Pre-generated sets of keys generated on Debian systems affected by weak PRNG are available here: [g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh).

You should look here in order to search for valid keys for the victim machine.

### Kerberos

**crackmapexec** using the `ssh` protocol can use the option `--kerberos` to **authenticate via kerberos**.\
For more info run `crackmapexec ssh --help`.

## Default Credentials

| **Vendor** | **Usernames**                                                                                               | **Passwords**                                                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC        | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade    | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco      | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix     | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link     | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell       | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC        | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com    | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei     | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM        | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper    | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp     | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle     | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware     | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

If you are in the local network as the victim which is going to connect to the SSH server using username and password you could try to **perform a MitM attack to steal those credentials:**

**Attack path:**

* **Traffic Redirection:** The attacker **diverts** the victim's traffic to their machine, effectively **intercepting** the connection attempt to the SSH server.
* **Interception and Logging:** The attacker's machine acts as a **proxy**, **capturing** the user's login details by pretending to be the legitimate SSH server.
* **Command Execution and Relay:** Finally, the attacker's server **logs the user's credentials**, **forwards the commands** to the real SSH server, **executes** them, and **sends the results back** to the user, making the process appear seamless and legitimate.

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) does exactly what is described above.

In order to capture perform the actual MitM you could use techniques like ARP spoofing, DNS spoofin or others described in the [**Network Spoofing attacks**](../generic-methodologies-and-resources/pentesting-network/#spoofing).

## SSH-Snake

If you want to traverse a network using discovered SSH private keys on systems, utilizing each private key on each system for new hosts, then [**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake) is what you need.

SSH-Snake performs the following tasks automatically and recursively:

1. On the current system, find any SSH private keys,
2. On the current system, find any hosts or destinations (user@host) that the private keys may be accepted,
3. Attempt to SSH into all of the destinations using all of the private keys discovered,
4. If a destination is successfully connected to, repeats steps #1 - #4 on the connected-to system.

It's completely self-replicating and self-propagating -- and completely fileless.

## Config Misconfigurations

### Root login

It's common for SSH servers to allow root user login by default, which poses a significant security risk. **Disabling root login** is a critical step in securing the server. Unauthorized access with administrative privileges and brute force attacks can be mitigated by making this change.

**To Disable Root Login in OpenSSH:**

1. **Edit the SSH config file** with: `sudoedit /etc/ssh/sshd_config`
2. **Change the setting** from `#PermitRootLogin yes` to **`PermitRootLogin no`**.
3. **Reload the configuration** using: `sudo systemctl daemon-reload`
4. **Restart the SSH server** to apply changes: `sudo systemctl restart sshd`

### SFTP Brute Force

* [**SFTP Brute Force**](../generic-methodologies-and-resources/brute-force.md#sftp)

### SFTP command execution

There is a common oversight occurs with SFTP setups, where administrators intend for users to exchange files without enabling remote shell access. Despite setting users with non-interactive shells (e.g., `/usr/bin/nologin`) and confining them to a specific directory, a security loophole remains. **Users can circumvent these restrictions** by requesting the execution of a command (like `/bin/bash`) immediately after logging in, before their designated non-interactive shell takes over. This allows for unauthorized command execution, undermining the intended security measures.

[Example from here](https://community.turgensec.com/ssh-hacking-guide/):
```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```
ä»¥ä¸‹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼`noraj`ã®ã‚»ã‚­ãƒ¥ã‚¢ãªSFTPæ§‹æˆã®ä¾‹ã§ã™ï¼ˆ`/etc/ssh/sshd_config` â€“ openSSHï¼‰:
```
Match User noraj
ChrootDirectory %h
ForceCommand internal-sftp
AllowTcpForwarding no
PermitTunnel no
X11Forwarding no
PermitTTY no
```
ã“ã®è¨­å®šã§ã¯ã€ã‚·ã‚§ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã—ã¦ã€é–‹å§‹ã‚³ãƒãƒ³ãƒ‰ã‚’å¼·åˆ¶ã—ã€TTYã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã ã‘ã§ãªãã€ã™ã¹ã¦ã®ç¨®é¡ã®ãƒãƒ¼ãƒˆè»¢é€ã‚„ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ã‚‚ç„¡åŠ¹ã«ã—ã¾ã™ã€‚

### SFTPãƒˆãƒ³ãƒãƒªãƒ³ã‚°

SFTPã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚‹å ´åˆã€ä¸€èˆ¬çš„ãªãƒãƒ¼ãƒˆè»¢é€ã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒˆãƒ³ãƒãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```
### SFTP ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯

**sftp** ã«ã¯ **symlink** ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã§ **æ›¸ãè¾¼ã¿æ¨©é™** ãŒã‚ã‚‹å ´åˆã€**ä»–ã®ãƒ•ã‚©ãƒ«ãƒ€/ãƒ•ã‚¡ã‚¤ãƒ«** ã® **ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯** ã‚’ä½œæˆã§ãã¾ã™ã€‚ãŠãã‚‰ãã‚ãªãŸã¯ **chroot** ã« **é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã¦ã„ã‚‹** ãŸã‚ã€ã“ã‚Œã¯ã‚ãªãŸã«ã¨ã£ã¦ **ç‰¹ã«æœ‰ç”¨ã§ã¯ãªã„**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä½œæˆã—ãŸ **ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯** ã« **no-chroot** **ã‚µãƒ¼ãƒ“ã‚¹** ã‹ã‚‰ **ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã‚‹å ´åˆï¼ˆãŸã¨ãˆã°ã€Web ã‹ã‚‰ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆï¼‰ã€**Web ã‚’ä»‹ã—ã¦ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã**ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã¨ãˆã°ã€æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ« **"froot"** ã‹ã‚‰ **"/"** ã¸ã® **ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯** ã‚’ä½œæˆã™ã‚‹ã«ã¯:
```bash
sftp> symlink / froot
```
### èªè¨¼æ–¹æ³•

é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç’°å¢ƒã§ã¯ã€å˜ç´”ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚ˆã‚Šã‚‚éµãƒ™ãƒ¼ã‚¹èªè¨¼ã‚„äºŒè¦ç´ èªè¨¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚ã—ã‹ã—ã€ã‚ˆã‚Šå¼·åŠ›ãªèªè¨¼æ–¹æ³•ã‚’æœ‰åŠ¹ã«ã—ãªãŒã‚‰ã‚‚ã€å¼±ã„èªè¨¼æ–¹æ³•ã‚’ç„¡åŠ¹ã«ã—ãªã„ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚ã‚ˆãã‚ã‚‹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€openSSHæ§‹æˆã§`publickey`ã‚’æœ‰åŠ¹ã«ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–¹æ³•ã¨ã—ã¦è¨­å®šã™ã‚‹ãŒã€`password`ã‚’ç„¡åŠ¹ã«ã—ãªã„ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€SSHã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†—é•·ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯å¼±ã„æ–¹æ³•ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚
```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```
ãŸã¨ãˆã°ã€èªè¨¼å¤±æ•—ã®åˆ¶é™ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ°é”ã™ã‚‹æ©Ÿä¼šãŒãªã„å ´åˆã¯ã€`PreferredAuthentications`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¼·åˆ¶çš„ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```
### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

SSHã‚µãƒ¼ãƒãƒ¼ã®æ§‹æˆã‚’ç¢ºèªã™ã‚‹ã“ã¨ã¯é‡è¦ã§ã™ã€‚äºˆæƒ³ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ãŒ\
èªå¯ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§è©³ç´°ãƒ¢ãƒ¼ãƒ‰ã‚’\
ä½¿ç”¨ã™ã‚‹ã¨ã€æ§‹æˆã®åŠ¹æœã‚’ç¢ºèªã§ãã¾ã™ã€‚
```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```
## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2)

## References

* You can find interesting guides on how to harden SSH in [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening\_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<figure><img src="../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## HackTricks Automatic Commands
```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
Name: Hydra Brute Force
Description: Need Username
Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh

Entry_2:
Name: consolesless mfs enumeration
Description: SSH enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'

```
<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
