# 143,993 - IMAPã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ï¼š[**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æœ€ã‚‚é‡è¦ãªè„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã¦è¿…é€Ÿã«ä¿®æ­£ã§ãã¾ã™ã€‚Intruderã¯æ”»æ’ƒé¢ã‚’è¿½è·¡ã—ã€ç©æ¥µçš„ãªè„…å¨ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã€APIã‹ã‚‰Webã‚¢ãƒ—ãƒªã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¾ã§ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“ã§å•é¡Œã‚’è¦‹ã¤ã‘ã¾ã™ã€‚[**ç„¡æ–™ã§ãŠè©¦ã—ãã ã•ã„**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ä»Šã™ãã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Internet Message Access Protocol

ãã®åå‰ãŒç¤ºã™ã‚ˆã†ã«ã€IMAPã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**ã©ã“ã«ã„ã¦ã‚‚é›»å­ãƒ¡ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã¾ã™ã€‚ã»ã¨ã‚“ã©ã®å ´åˆã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¾ã™ã€‚åŸºæœ¬çš„ã«ã€é›»å­ãƒ¡ãƒ¼ãƒ«**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜**ã•ã‚Œã¾ã™ã€‚å—ä¿¡ãƒˆãƒ¬ã‚¤ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã³ã«ã€é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒãƒ¼ã«é€£çµ¡ã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ¥ç¶šã—ã¾ã™ã€‚IMAPã‚’ä½¿ç”¨ã—ã¦é›»å­ãƒ¡ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã‚€ã¨ãã€å®Ÿéš›ã«ã¯ãã‚Œã‚’ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šä¿å­˜ã—ãŸã‚Šã—ã¦ã„ã¾ã›ã‚“**ã€‚ä»£ã‚ã‚Šã«ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰**èª­ã¿å–ã£ã¦ã„ã¾ã™**ã€‚ãã®çµæœã€ç•°ãªã‚‹ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰**ãƒ¡ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã€ä½•ã‚‚è¦‹é€ƒã™ã“ã¨ãªãè¡Œãˆã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€IMAPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯2ã¤ã®ãƒãƒ¼ãƒˆã§å‹•ä½œã—ã¾ã™ï¼š

* **ãƒãƒ¼ãƒˆ143** - ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®IMAPéæš—å·åŒ–ãƒãƒ¼ãƒˆã§ã™
* **ãƒãƒ¼ãƒˆ993** - ã“ã‚Œã¯IMAPã‚’å®‰å…¨ã«ä½¿ç”¨ã™ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒãƒ¼ãƒˆã§ã™
```
PORT    STATE SERVICE REASON
143/tcp open  imap    syn-ack
```
## ãƒãƒŠãƒ¼ã®å–å¾—
```bash
nc -nv <IP> 143
openssl s_client -connect <IP>:993 -quiet
```
### NTLMèªè¨¼ - æƒ…å ±æ¼æ´©

ã‚µãƒ¼ãƒãƒ¼ãŒNTLMèªè¨¼ï¼ˆWindowsï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€æ©Ÿå¯†æƒ…å ±ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ã‚’å–å¾—ã§ãã¾ã™ï¼š
```
root@kali: telnet example.com 143
* OK The Microsoft Exchange IMAP4 service is ready.
>> a1 AUTHENTICATE NTLM
+
>> TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=
+ TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA
```
ã¾ãŸã¯ã€**nmap**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³`imap-ntlm-info.nse`ã‚’ä½¿ç”¨ã—ã¦ã“ã‚Œã‚’**è‡ªå‹•åŒ–**ã—ã¾ã™ã€‚

### [IMAPãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹](../generic-methodologies-and-resources/brute-force.md#imap)

## æ§‹æ–‡

[ã“ã¡ã‚‰](https://donsutherland.org/crib/imap)ã‹ã‚‰ã®IMAPã‚³ãƒãƒ³ãƒ‰ã®ä¾‹ï¼š
```
Login
A1 LOGIN username password
Values can be quoted to enclose spaces and special characters. A " must then be escape with a \
A1 LOGIN "username" "password"

List Folders/Mailboxes
A1 LIST "" *
A1 LIST INBOX *
A1 LIST "Archive" *

Create new Folder/Mailbox
A1 CREATE INBOX.Archive.2012
A1 CREATE "To Read"

Delete Folder/Mailbox
A1 DELETE INBOX.Archive.2012
A1 DELETE "To Read"

Rename Folder/Mailbox
A1 RENAME "INBOX.One" "INBOX.Two"

List Subscribed Mailboxes
A1 LSUB "" *

Status of Mailbox (There are more flags than the ones listed)
A1 STATUS INBOX (MESSAGES UNSEEN RECENT)

Select a mailbox
A1 SELECT INBOX

List messages
A1 FETCH 1:* (FLAGS)
A1 UID FETCH 1:* (FLAGS)

Retrieve Message Content
A1 FETCH 2 body[text]
A1 FETCH 2 all
A1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])

Close Mailbox
A1 CLOSE

Logout
A1 LOGOUT
```
### é€²åŒ–
```
apt install evolution
```
![](<../.gitbook/assets/image (528).png>)

### CURL

åŸºæœ¬çš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯[CURL](https://ec.haxx.se/usingcurl/usingcurl-reademail#imap)ã§å¯èƒ½ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è©³ç´°ãŒå°‘ãªã„ãŸã‚ã€æ­£ç¢ºãªè©³ç´°ã‚’ç¢ºèªã™ã‚‹ã«ã¯[ã‚½ãƒ¼ã‚¹](https://github.com/curl/curl/blob/master/lib/imap.c)ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

1. ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã®ãƒªã‚¹ãƒˆè¡¨ç¤º (imapã‚³ãƒãƒ³ãƒ‰ `LIST "" "*"`)

```bash
$ curl -k 'imaps://1.2.3.4/' --user user:pass
```
2. ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹å†…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆè¡¨ç¤º (imapã‚³ãƒãƒ³ãƒ‰ `SELECT INBOX` ãã—ã¦ `SEARCH ALL`)

```bash
$ curl -k 'imaps://1.2.3.4/INBOX?ALL' --user user:pass
```

ã“ã®æ¤œç´¢ã®çµæœã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒªã‚¹ãƒˆã§ã™ã€‚

ã‚ˆã‚Šè¤‡é›‘ãªæ¤œç´¢æ¡ä»¶ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä¾‹: ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ä¸‹æ›¸ãã‚’æ¤œç´¢ã™ã‚‹å ´åˆ:

```bash
$ curl -k 'imaps://1.2.3.4/Drafts?TEXT password' --user user:pass
```

å¯èƒ½ãªæ¤œç´¢æ¡ä»¶ã®è‰¯ã„æ¦‚è¦ã¯[ã“ã¡ã‚‰](https://www.atmail.com/blog/imap-commands/)ã«ã‚ã‚Šã¾ã™ã€‚
3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (imapã‚³ãƒãƒ³ãƒ‰ `SELECT Drafts` ãã—ã¦ `FETCH 1 BODY[]`)

```bash
$ curl -k 'imaps://1.2.3.4/Drafts;MAILINDEX=1' --user user:pass
```

ãƒ¡ãƒ¼ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯æ¤œç´¢æ“ä½œã‹ã‚‰è¿”ã•ã‚ŒãŸåŒã˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€`UID` (ãƒ¦ãƒ‹ãƒ¼ã‚¯ID) ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€å°‘ã—æ‰‹é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚ä¾‹:
```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'UID SEARCH ALL' --user user:pass
$ curl -k 'imaps://1.2.3.4/INBOX;UID=1' --user user:pass
```
ã¾ãŸã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸€éƒ¨ã ã‘ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ãŸã¨ãˆã°ã€æœ€åˆã®5ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä»¶åã¨é€ä¿¡è€…ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆ`-v`ã‚’ä½¿ç”¨ã—ã¦ä»¶åã¨é€ä¿¡è€…ã‚’è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰:
```bash
$ curl -k 'imaps://1.2.3.4/INBOX' -X 'FETCH 1:5 BODY[HEADER.FIELDS (SUBJECT FROM)]' --user user:pass -v 2>&1 | grep '^<'
```
ãŸã¶ã‚“ã€å˜ç´”ã«forãƒ«ãƒ¼ãƒ—ã‚’æ›¸ãæ–¹ãŒã‚¯ãƒªãƒ¼ãƒ³ã§ã—ã‚‡ã†:
```
for m in {1..5}; do
echo $m
curl "imap://1.2.3.4/INBOX;MAILINDEX=$m;SECTION=HEADER.FIELDS%20(SUBJECT%20FROM)" --user user:pass
done
```
## Shodan

* `port:143 CAPABILITY`
* `port:993 CAPABILITY`

## HackTricks è‡ªå‹•ã‚³ãƒãƒ³ãƒ‰
```
Protocol_Name: IMAP    #Protocol Abbreviation if there is one.
Port_Number:  143,993     #Comma separated if there is more than one.
Protocol_Description: Internet Message Access Protocol         #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WHOIS
Note: |
As its name implies, IMAP allows you to access your email messages wherever you are; much of the time, it is accessed via the Internet. Basically, email messages are stored on servers. Whenever you check your inbox, your email client contacts the server to connect you with your messages. When you read an email message using IMAP, you aren't actually downloading or storing it on your computer; instead, you are reading it off of the server. As a result, it's possible to check your email from several different devices without missing a thing.

https://book.hacktricks.xyz/pentesting/pentesting-imap

Entry_2:
Name: Banner Grab
Description: Banner Grab 143
Command: nc -nv {IP} 143

Entry_3:
Name: Secure Banner Grab
Description: Banner Grab 993
Command: openssl s_client -connect {IP}:993 -quiet

Entry_4:
Name: consolesless mfs enumeration
Description: IMAP enumeration without the need to run msfconsole
Note: sourced from https://github.com/carlospolop/legion
Command: msfconsole -q -x 'use auxiliary/scanner/imap/imap_version; set RHOSTS {IP}; set RPORT 143; run; exit'
```
<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æœ€ã‚‚é‡è¦ãªè„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã¦ä¿®æ­£ã‚’è¿…é€ŸåŒ–ã—ã¾ã™ã€‚Intruderã¯æ”»æ’ƒå¯¾è±¡ã‚’è¿½è·¡ã—ã€ç©æ¥µçš„ãªè„…å¨ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã€APIã‹ã‚‰Webã‚¢ãƒ—ãƒªã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¾ã§ã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“ã§å•é¡Œã‚’è¦‹ã¤ã‘ã¾ã™ã€‚[**ç„¡æ–™ã§ãŠè©¦ã—ãã ã•ã„**](https://www.intruder.io/?utm_source=referral\&utm_campaign=hacktricks) ä»Šã™ãã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
