# Envenenamento TNS

Se vocÃª encontrar uma versÃ£o mais recente do listener, nÃ£o hÃ¡ muito espaÃ§o para manobra, exceto a forÃ§a bruta. No entanto, todas as versÃµes atÃ© a versÃ£o 12c sÃ£o vulnerÃ¡veis a um ataque chamado 'TNS Poison'. Embora a Ãºltima versÃ£o seja vulnerÃ¡vel apenas em algumas configuraÃ§Ãµes especiais. Por exemplo, uma das maneiras de corrigir essa vulnerabilidade Ã© desativando a configuraÃ§Ã£o dinÃ¢mica do listener, o que Ã© impossÃ­vel ao usar o Oracle DataGuard, PL/SQL Gateway em conexÃ£o com APEX e em algumas versÃµes do SAP. Em geral, o problema Ã© que, por padrÃ£o, o serviÃ§o de listener suporta configuraÃ§Ã£o remota e, alÃ©m disso, permite fazÃª-lo anonimamente. Ã‰ aqui que estÃ¡ o coraÃ§Ã£o da vulnerabilidade.

[![Fig. 1. Vulnerabilidade TNS Poison](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

Fig. 1. Vulnerabilidade TNS Poison

Este Ã© um algoritmo de ataque de amostra (veja a Fig. 1):

* Envie a seguinte consulta TNS: 'CONNECT_DATA = \(COMMAND = SERVICE_REGISTER_NSGR\)\)'.
* O servidor vulnerÃ¡vel responderÃ¡: '\(DESCRIPTION = \(TMP = \)\)'. Isso Ã© o que serÃ¡ a resposta de um servidor corrigido: '\(ERROR_STACK = \(ERROR = 1194\)\)'.
* Gere um pacote de configuraÃ§Ã£o com SID e IP do novo listener (para futura MITM). O nÃºmero de caracteres no nome do SID atual Ã© de fundamental importÃ¢ncia. VocÃª precisa saber disso, jÃ¡ que Ã© disso que depende um pacote bem formado.
* Em seguida, envie todos esses recursos para o listener.
* Se tudo estiver correto, todas as novas conexÃµes serÃ£o encaminhadas pelo listener por meio do seu IP controlado.

Ã‰ importante nÃ£o esquecer de habilitar o proxy de consultas (como IP_forwarding no Linux), caso contrÃ¡rio, em vez de um ataque MITM limpo, vocÃª obterÃ¡ um DoS bruto, porque os novos clientes nÃ£o conseguirÃ£o se conectar ao banco de dados. Como resultado, um invasor pode incorporar seus prÃ³prios comandos dentro da sessÃ£o de outro usuÃ¡rio. **VocÃª pode verificar se o servidor Ã© vulnerÃ¡vel usando o seguinte mÃ³dulo MSF: 'auxiliary/scanner/oracle/tnspoison_checker'.**

Toda esta pÃ¡gina foi extraÃ­da daqui: [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**Outra maneira de testar:**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
