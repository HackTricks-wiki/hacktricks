# Envenenamiento TNS

Si te encuentras con una versiÃ³n mÃ¡s reciente del listener, no hay mucho margen de maniobra excepto el ataque de fuerza bruta. Sin embargo, todas las versiones hasta la versiÃ³n 12c son vulnerables a un ataque llamado 'TNS Poison'. Aunque la Ãºltima versiÃ³n es vulnerable solo en algunas configuraciones especiales. Por ejemplo, una de las formas de solucionar esta vulnerabilidad es desactivando la configuraciÃ³n dinÃ¡mica del listener, lo cual es imposible cuando se utiliza Oracle DataGuard, PL/SQL Gateway en conexiÃ³n con APEX y en algunas versiones de SAP. En general, el problema es que, por defecto, el servicio del listener admite la configuraciÃ³n remota y, ademÃ¡s, permite hacerlo de forma anÃ³nima. AquÃ­ es donde radica el corazÃ³n de la vulnerabilidad.

[![Fig. 1. Vulnerabilidad TNS Poison](https://hackmag.com/wp-content/uploads/2015/04/poison.png)](https://hackmag.com/wp-content/uploads/2015/04/poison.png)

Fig. 1. Vulnerabilidad TNS Poison

Este es un algoritmo de ataque de muestra (ver Fig. 1):

* Enviar la siguiente consulta TNS: 'CONNECT_DATA = (COMMAND = SERVICE_REGISTER_NSGR))'.
* El servidor vulnerable responderÃ¡: '(DESCRIPTION = (TMP =))'. Esto es lo que serÃ¡ la respuesta de un servidor parcheado: '(ERROR_STACK = (ERROR = 1194))'.
* Generar un paquete de configuraciÃ³n con SID e IP del nuevo listener (para futuros MITM). El nÃºmero de caracteres en el nombre del SID actual es de fundamental importancia. Debes saberlo, ya que de esto depende un paquete bien formado.
* A continuaciÃ³n, enviar todas estas golosinas al listener.
* Si todo es correcto, entonces todas las nuevas conexiones serÃ¡n redirigidas por el listener a travÃ©s de tu IP controlada.

Es importante no olvidar habilitar el proxy de consultas (como IP_forwarding en Linux), de lo contrario, en lugar de un ataque MITM ordenado, obtendrÃ¡s un DoS brusco, porque los nuevos clientes no podrÃ¡n conectarse a la base de datos. Como resultado, un atacante puede incrustar sus propios comandos dentro de la sesiÃ³n de otro usuario. **Puedes comprobar si el servidor es vulnerable utilizando el siguiente mÃ³dulo MSF: 'auxiliary/scanner/oracle/tnspoison_checker'.**

Toda esta pÃ¡gina fue extraÃ­da de aquÃ­: [https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/](https://hackmag.com/uncategorized/looking-into-methods-to-penetrate-oracle-db/)

**Otra forma de probar:**
```text
./odat.py tnspoison -s <IP> -p <PORT> -d <SID> --test-module
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n la [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme en** **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al repositorio [hacktricks](https://github.com/carlospolop/hacktricks) y al repositorio [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
