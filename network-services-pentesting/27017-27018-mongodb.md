# 27017,27018 - Pentesting MongoDB

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais sobre bugs web3

üîî Receba notifica√ß√µes sobre novos programas de recompensa por bugs

üí¨ Participe de discuss√µes na comunidade

## Informa√ß√µes B√°sicas

O MongoDB √© um sistema de gerenciamento de banco de dados (DBMS) de c√≥digo aberto que usa um modelo de banco de dados orientado a documentos que suporta v√°rios tipos de dados. (De [aqui](https://searchdatamanagement.techtarget.com/definition/MongoDB))

**Porta padr√£o:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Enumera√ß√£o

### Manual
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
    print(db)
    print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Alguns comandos do MongoDB:**

- `show dbs`: mostra todas as bases de dados.
- `use <db>`: seleciona a base de dados `<db>`.
- `show collections`: mostra todas as cole√ß√µes da base de dados selecionada.
- `db.<collection>.find()`: mostra todos os documentos da cole√ß√£o `<collection>`.
- `db.<collection>.find(<query>)`: mostra os documentos da cole√ß√£o `<collection>` que correspondem √† consulta `<query>`.
- `db.<collection>.find().pretty()`: mostra todos os documentos da cole√ß√£o `<collection>` de forma formatada.
- `db.<collection>.findOne()`: mostra o primeiro documento da cole√ß√£o `<collection>`.
- `db.<collection>.insert(<document>)`: insere o documento `<document>` na cole√ß√£o `<collection>`.
- `db.<collection>.update(<query>, <update>)`: atualiza os documentos da cole√ß√£o `<collection>` que correspondem √† consulta `<query>` com os valores de `<update>`.
- `db.<collection>.remove(<query>)`: remove os documentos da cole√ß√£o `<collection>` que correspondem √† consulta `<query>`.
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Autom√°tico
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* Todos os mongodb: `"informa√ß√£o do servidor mongodb"`
* Buscar por servidores mongodb totalmente abertos: `"informa√ß√£o do servidor mongodb" -"parcialmente habilitado"`
* Apenas habilitar parcialmente a autentica√ß√£o: `"informa√ß√£o do servidor mongodb" "parcialmente habilitado"`

## Login

Por padr√£o, o mongo n√£o requer senha.\
**Admin** √© um banco de dados mongo comum.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
O script do nmap: _**mongodb-brute**_ ir√° verificar se as credenciais s√£o necess√°rias.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**For√ßa bruta**](../generic-methodologies-and-resources/brute-force.md#mongo)

Verifique dentro de _/opt/bitnami/mongodb/mongodb.conf_ para saber se as credenciais s√£o necess√°rias:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Previs√£o de Mongo Objectid

Os IDs de objetos Mongo s√£o strings hexadecimais de **12 bytes**:

![](../.gitbook/assets/id-and-objectids-in-mongodb.png)

Por exemplo, aqui est√° como podemos dissecar um ID de objeto real retornado por um aplicativo: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 em decimal = Sexta-feira, 31 de julho de 2020 17:49:32
2. 9fa6dc: Identificador de m√°quina
3. 2500: ID do processo
4. 314019: Um contador incremental

Dos elementos acima, o identificador da m√°quina permanecer√° o mesmo enquanto o banco de dados estiver executando na mesma m√°quina f√≠sica/virtual. O ID do processo s√≥ mudar√° se o processo do MongoDB for reiniciado. O carimbo de data/hora ser√° atualizado a cada segundo. O √∫nico desafio em adivinhar IDs de objetos simplesmente incrementando os valores de contador e carimbo de data/hora √© o fato de que o Mongo DB gera IDs de objetos e atribui IDs de objetos em um n√≠vel do sistema.

A ferramenta [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), dada uma ID de objeto inicial (voc√™ pode criar uma conta e obter uma ID inicial), envia de volta cerca de 1000 IDs de objetos prov√°veis que poderiam ter sido atribu√≠dos aos pr√≥ximos objetos, ent√£o voc√™ s√≥ precisa for√ß√°-los.

## Post

Se voc√™ √© root, pode **modificar** o arquivo **mongodb.conf** para que n√£o sejam necess√°rias credenciais (_noauth = true_) e **fazer login sem credenciais**.

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga** me no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
