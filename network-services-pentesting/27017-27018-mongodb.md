# 27017,27018 - Pentesting MongoDB

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

ğŸ Leia tutoriais de bugs web3

ğŸ”” Receba notificaÃ§Ãµes sobre novos programas de recompensa por bugs

ğŸ’¬ Participe de discussÃµes na comunidade

## InformaÃ§Ãµes BÃ¡sicas

O MongoDB Ã© um sistema de gerenciamento de banco de dados (DBMS) de cÃ³digo aberto que usa um modelo de banco de dados orientado a documentos que suporta vÃ¡rios tipos de dados. (De [aqui](https://searchdatamanagement.techtarget.com/definition/MongoDB))

**Porta padrÃ£o:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## EnumeraÃ§Ã£o

### Manual
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
    print(db)
    print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Alguns comandos do MongoDB:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### AutomÃ¡tico
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

* Todos os mongodb: `"informaÃ§Ã£o do servidor mongodb"`
* Buscar por servidores mongodb totalmente abertos: `"informaÃ§Ã£o do servidor mongodb" -"parcialmente habilitado"`
* Apenas habilitar parcialmente a autenticaÃ§Ã£o: `"informaÃ§Ã£o do servidor mongodb" "parcialmente habilitado"`

## Login

Por padrÃ£o, o mongo nÃ£o requer senha.\
**Admin** Ã© um banco de dados mongo comum.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
O script do nmap: _**mongodb-brute**_ irÃ¡ verificar se credenciais sÃ£o necessÃ¡rias.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**ForÃ§a bruta**](../generic-methodologies-and-resources/brute-force.md#mongo)

Verifique dentro de _/opt/bitnami/mongodb/mongodb.conf_ para saber se as credenciais sÃ£o necessÃ¡rias:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## PrevisÃ£o de Mongo Objectid

Os IDs de objetos Mongo sÃ£o strings **hexadecimais de 12 bytes**:

![](../.gitbook/assets/id-and-objectids-in-mongodb.png)

Por exemplo, aqui estÃ¡ como podemos dissecar um ID de objeto real retornado por um aplicativo: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 em decimal = Sexta-feira, 31 de julho de 2020 17:49:32
2. 9fa6dc: Identificador de mÃ¡quina
3. 2500: ID do processo
4. 314019: Um contador incremental

Dos elementos acima, o identificador da mÃ¡quina permanecerÃ¡ o mesmo enquanto o banco de dados estiver sendo executado na mesma mÃ¡quina fÃ­sica/virtual. O ID do processo sÃ³ mudarÃ¡ se o processo do MongoDB for reiniciado. O carimbo de data/hora serÃ¡ atualizado a cada segundo. O Ãºnico desafio em adivinhar IDs de objetos simplesmente incrementando os valores do contador e do carimbo de data/hora, Ã© o fato de que o Mongo DB gera IDs de objetos e atribui IDs de objetos em um nÃ­vel do sistema.

A ferramenta [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), dada uma ID de objeto inicial (vocÃª pode criar uma conta e obter uma ID inicial), envia de volta cerca de 1000 IDs de objetos provÃ¡veis que poderiam ter sido atribuÃ­dos aos prÃ³ximos objetos, entÃ£o vocÃª sÃ³ precisa forÃ§Ã¡-los.

## Post

Se vocÃª Ã© root, pode **modificar** o arquivo **mongodb.conf** para que nÃ£o sejam necessÃ¡rias credenciais (_noauth = true_) e **fazer login sem credenciais**.

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

ğŸ Leia tutoriais de bugs web3

ğŸ”” Receba notificaÃ§Ãµes sobre novas recompensas por bugs

ğŸ’¬ Participe de discussÃµes na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga** me no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
