# Memcache ã‚³ãƒãƒ³ãƒ‰

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

- **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)** ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ ã§ **@carlospolopm** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
- **ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰**ã™ã‚‹ã«ã¯ã€[HackTricks](https://github.com/carlospolop/hacktricks) ã¨ [HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud) ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã™ã‚‹

</details>

## ã‚³ãƒãƒ³ãƒ‰ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

**From** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)

ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆå…¬å¼ãŠã‚ˆã³éå…¬å¼ï¼‰ã¯ã€[doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ã€æ§‹æ–‡ã®èª¬æ˜ã¯ã‚ã¾ã‚Šæ˜ç¢ºã§ã¯ãªãã€æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å˜ç´”ãªãƒ˜ãƒ«ãƒ—ã‚³ãƒãƒ³ãƒ‰ãŒã¯ã‚‹ã‹ã«è‰¯ã„ã§ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã¯ã€[ã‚½ãƒ¼ã‚¹](https://github.com/memcached/memcached) ã§è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã®æ¦‚è¦ã§ã™ï¼ˆ2016å¹´8æœˆ19æ—¥ç¾åœ¨ï¼‰:

| ã‚³ãƒãƒ³ãƒ‰               | èª¬æ˜                                                     | ä¾‹                                                                                                                                                                                                                                     |
| --------------------- | --------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | å€¤ã‚’èª­ã¿å–ã‚‹                                                   | `get mykey`                                                                                                                                                                                                                                 |
| set                   | ã‚­ãƒ¼ã‚’ç„¡æ¡ä»¶ã§è¨­å®šã™ã‚‹                                       | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>Unix CLI ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€æ”¹è¡Œã¨ã—ã¦ \r\n ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ä¾‹ãˆã°&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | æ–°ã—ã„ã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹                                           | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | æ—¢å­˜ã®ã‚­ãƒ¼ã‚’ä¸Šæ›¸ãã™ã‚‹                                          | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | æ—¢å­˜ã®ã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹                                     | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | æ—¢å­˜ã®ã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆé ­ã«è¿½åŠ ã™ã‚‹                                    | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | æŒ‡å®šã•ã‚ŒãŸæ•°å€¤ã§æ•°å€¤ã‚­ãƒ¼ã®å€¤ã‚’å¢—ã‚„ã™                  | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | æŒ‡å®šã•ã‚ŒãŸæ•°å€¤ã§æ•°å€¤ã‚­ãƒ¼ã®å€¤ã‚’æ¸›ã‚‰ã™                  | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | æ—¢å­˜ã®ã‚­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹                                         | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å³åº§ã«ç„¡åŠ¹ã«ã™ã‚‹                                | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | n ç§’å¾Œã«ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç„¡åŠ¹ã«ã™ã‚‹                               | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | ä¸€èˆ¬çš„ãªçµ±è¨ˆã‚’è¡¨ç¤º                                       | `stats`                                                                                                                                                                                                                                     |
|                       | ãƒ¡ãƒ¢ãƒªçµ±è¨ˆã‚’è¡¨ç¤º                                        | `stats slabs`                                                                                                                                                                                                                               |
|                       | ã‚ˆã‚Šé«˜ã„ãƒ¬ãƒ™ãƒ«ã®å‰²ã‚Šå½“ã¦çµ±è¨ˆã‚’è¡¨ç¤º                        | `stats malloc`                                                                                                                                                                                                                              |
|                       | ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¡¨ç¤º                                             | `stats items`                                                                                                                                                                                                                               |
|                       |                                                                 | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                                 | `stats sizes`                                                                                                                                                                                                                               |
|                       | çµ±è¨ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ                                      | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ï¼ˆã»ã¨ã‚“ã©ã®ï¼‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤º                                          | `version`                                                                                                                                                                                                                                   |
| verbosity             | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’å¢—ã‚„ã™                                             | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã™ã‚‹                                               | `quit`                                                                                                                                                                                                                                      |

#### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆ <a href="#traffic-statistics" id="traffic-statistics"></a>

ç¾åœ¨ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
stats
```
ä»¥ä¸‹ã¯ã€æ¥ç¶šæ•°ã€ãƒã‚¤ãƒˆã®å…¥å‡ºåŠ›ãªã©ã‚’æä¾›ã™ã‚‹ãƒªã‚¹ãƒˆã§ã™ã€‚

**Example Output:**
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### ãƒ¡ãƒ¢ãƒªçµ±è¨ˆ <a href="#memory-statistics" id="memory-statistics"></a>

ç¾åœ¨ã®ãƒ¡ãƒ¢ãƒªçµ±è¨ˆã‚’ã‚¯ã‚¨ãƒªã§ãã¾ã™ã€‚
```
stats slabs
```
## Memcache Commands

### Stats Command

The `stats` command is used to retrieve statistics from the Memcache server. This command provides information such as the total number of items stored, the number of connections, and the memory used by the server.

#### Syntax

```plaintext
stats
```

#### Example

```plaintext
stats
STAT pid 1
STAT uptime 260
STAT time 1600778923
STAT version 1.5.20
STAT libevent 2.1.8-stable
STAT pointer_size 64
STAT rusage_user 0.000000
STAT rusage_system 0.000000
STAT curr_connections 5
STAT total_connections 6
STAT connection_structures 6
STAT reserved_fds 20
STAT cmd_get 0
STAT cmd_set 0
STAT cmd_flush 0
STAT get_hits 0
STAT get_misses 0
STAT delete_misses 0
STAT delete_hits 0
STAT incr_misses 0
STAT incr_hits 0
STAT decr_misses 0
STAT decr_hits 0
STAT cas_misses 0
STAT cas_hits 0
STAT cas_badval 0
STAT auth_cmds 0
STAT auth_errors 0
STAT bytes_read 0
STAT bytes_written 0
STAT limit_maxbytes 67108864
STAT accepting_conns 1
STAT listen_disabled_num 0
STAT threads 4
STAT conn_yields 0
STAT hash_power_level 16
STAT hash_bytes 524288
STAT hash_is_expanding 0
STAT slab_reassign_rescues 0
STAT slab_reassign_chunk_rescues 0
STAT slab_reassign_evictions_nomem 0
STAT slab_reassign_inline_reclaim 0
STAT slab_reassign_busy_items 0
STAT slab_reassign_busy_deletes 0
STAT slab_reassign_busy_loops 0
STAT slab_reassign_running 0
STAT slabs_moved 0
STAT lru_crawler_running 0
STAT lru_crawler_starts 0
STAT lru_maintainer_juggles 0
STAT malloc_fails 0
STAT log_worker_dropped 0
STAT log_worker_written 0
STAT log_watcher_skipped 0
STAT log_watcher_sent 0
STAT bytes 0
STAT curr_items 0
STAT total_items 0
STAT expired_unfetched 0
STAT evicted_unfetched 0
STAT evictions 0
STAT reclaimed 0
STAT crawler_reclaimed 0
STAT crawler_items_checked 0
STAT lrutail_reflocked 0
STAT moves_to_cold 0
STAT moves_to_warm 0
STAT moves_within_lru 0
STAT direct_reclaims 0
STAT lru_bumps_dropped 0
END
```

#### Explanation

This example shows the output of the `stats` command, which provides various statistics about the Memcache server. The information includes process ID, uptime, version, memory usage, connections, and various cache-related statistics.
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
#### ã©ã®ã‚­ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ <a href="#which-keys-are-used" id="which-keys-are-used"></a>

ã‚‚ã—ãƒ¡ãƒ¢ãƒªãŒååˆ†ã‚ã‚‹ã‹ã©ã†ã‹ã‚ã‹ã‚‰ãªã„å ´åˆã¯ã€"stats"ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ä¸ãˆã‚‰ã‚Œã‚‹"evictions"ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ååˆ†ãªãƒ¡ãƒ¢ãƒªãŒã‚ã‚‹å ´åˆã€"evictions"ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯0ã§ã‚ã‚‹ã‹ã€å°‘ãªãã¨ã‚‚å¢—åŠ ã—ã¦ã„ã¾ã›ã‚“ã€‚
```
stats items
```
### Command to determine how many keys do exist

To determine the number of keys that exist in a Memcache server, you can use the following command:

```bash
stats items
```

This command will provide you with information about the number of items (keys) stored in the Memcache server.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
ã“ã‚Œã«ã‚ˆã‚Šã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ã‚’ç¢ºèªã§ãã¾ã™ã€‚æ—¢ã«memcacheã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã£ã¦ã„ã‚‹PHPã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã‚­ãƒ¼åã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã«ã¯ã€[100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html)ã®PHPã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
