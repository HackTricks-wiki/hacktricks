# Memcacheã‚³ãƒãƒ³ãƒ‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## ã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

**From** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)\*\*\*\*

ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆå…¬å¼ã®ã‚‚ã®ã¨éå…¬å¼ã®ã‚‚ã®ï¼‰ã¯ã€[doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt)ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ®‹å¿µãªãŒã‚‰ã€æ§‹æ–‡ã®èª¬æ˜ã¯å®Ÿéš›ã«ã¯æ˜ç¢ºã§ã¯ãªãã€æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å˜ç´”ãªãƒ˜ãƒ«ãƒ—ã‚³ãƒãƒ³ãƒ‰ã®æ–¹ãŒã¯ã‚‹ã‹ã«è‰¯ã„ã§ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã¯ã€[source](https://github.com/memcached/memcached)ï¼ˆ2016å¹´8æœˆ19æ—¥ç¾åœ¨ï¼‰ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ã®æ¦‚è¦ã§ã™ï¼š

| ã‚³ãƒãƒ³ãƒ‰               | èª¬æ˜                                                     | ä¾‹                                                                                                                                                                                                                                     |
| --------------------- | --------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | å€¤ã‚’èª­ã¿å–ã‚‹                                                   | `get mykey`                                                                                                                                                                                                                                 |
| set                   | ã‚­ãƒ¼ã‚’ç„¡æ¡ä»¶ã§è¨­å®šã™ã‚‹                                       | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>Unix CLIãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€æ”¹è¡Œã¨ã—ã¦\r\nã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ä¾‹ãˆã°&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | æ–°ã—ã„ã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹                                                   | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | æ—¢å­˜ã®ã‚­ãƒ¼ã‚’ä¸Šæ›¸ãã™ã‚‹                                          | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | æ—¢å­˜ã®ã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹                                     | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | æ—¢å­˜ã®ã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆé ­ã«è¿½åŠ ã™ã‚‹                                    | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | æ•°å€¤ã‚­ãƒ¼ã®å€¤ã‚’æŒ‡å®šã•ã‚ŒãŸæ•°å€¤ã ã‘å¢—ã‚„ã™                  | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | æ•°å€¤ã‚­ãƒ¼ã®å€¤ã‚’æŒ‡å®šã•ã‚ŒãŸæ•°å€¤ã ã‘æ¸›ã‚‰ã™                  | `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | æ—¢å­˜ã®ã‚­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹                                         | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å³åº§ã«ç„¡åŠ¹ã«ã™ã‚‹                                | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | nç§’å¾Œã«ã™ã¹ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç„¡åŠ¹ã«ã™ã‚‹                               | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | ä¸€èˆ¬çš„ãªçµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹                                       | `stats`                                                                                                                                                                                                                                     |
|                       | ãƒ¡ãƒ¢ãƒªã®çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹                                        | `stats slabs`                                                                                                                                                                                                                               |
|                       | ã‚ˆã‚Šé«˜ã„ãƒ¬ãƒ™ãƒ«ã®å‰²ã‚Šå½“ã¦çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹                        | `stats malloc`                                                                                                                                                                                                                              |
|                       | ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹                                             | `stats items`                                                                                                                                                                                                                               |
|                       |                                                                 | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                                 | `stats sizes`                                                                                                                                                                                                                               |
|                       | çµ±è¨ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹                                      | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ï¼ˆã»ã¨ã‚“ã©ã®ï¼‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ | `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã€‚                                          | `version`                                                                                                                                                                                                                                   |
| verbosity             | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ã‚‹                                             | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã™ã‚‹                                               | `quit`                                                                                                                                                                                                                                      |

#### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆ <a href="#traffic-statistics" id="traffic-statistics"></a>

ç¾åœ¨ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯çµ±è¨ˆã‚’å•ã„åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
stats
```
ä»¥ä¸‹ã¯ã€æ¥ç¶šæ•°ã€é€å—ä¿¡ãƒã‚¤ãƒˆæ•°ãªã©ã‚’è¡¨ç¤ºã™ã‚‹ãƒªã‚¹ãƒˆã§ã™ã€‚

å‡ºåŠ›ä¾‹ï¼š
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### ãƒ¡ãƒ¢ãƒªçµ±è¨ˆ <a href="#memory-statistics" id="memory-statistics"></a>

ç¾åœ¨ã®ãƒ¡ãƒ¢ãƒªçµ±è¨ˆã‚’ã‚¯ã‚¨ãƒªã§å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
stats slabs
```
# memcache-commands

## Introduction

Memcache is a widely used distributed memory caching system. It is commonly used to speed up dynamic database-driven websites by caching data and objects in memory to reduce the number of times an external data source (such as a database or API) needs to be accessed.

## Basic Commands

### SET

The `SET` command is used to store a value in the cache. It takes three arguments: the key, the value, and an optional expiration time in seconds.

```bash
SET key value [expiration]
```

### GET

The `GET` command is used to retrieve a value from the cache. It takes one argument: the key.

```bash
GET key
```

### DELETE

The `DELETE` command is used to remove a value from the cache. It takes one argument: the key.

```bash
DELETE key
```

### FLUSH_ALL

The `FLUSH_ALL` command is used to remove all values from the cache.

```bash
FLUSH_ALL
```

## Advanced Commands

### INCR

The `INCR` command is used to increment the value of a key by a specified amount. If the key does not exist, it is created with an initial value of 0.

```bash
INCR key amount
```

### DECR

The `DECR` command is used to decrement the value of a key by a specified amount. If the key does not exist, it is created with an initial value of 0.

```bash
DECR key amount
```

### APPEND

The `APPEND` command is used to append a value to the existing value of a key.

```bash
APPEND key value
```

### PREPEND

The `PREPEND` command is used to prepend a value to the existing value of a key.

```bash
PREPEND key value
```

### CAS

The `CAS` command is used to perform a "check and set" operation. It allows you to update a value only if it has not been modified by another client since you last retrieved it.

```bash
CAS key value cas_unique_id [expiration]
```

### STATS

The `STATS` command is used to retrieve statistics about the memcache server.

```bash
STATS
```

### VERSION

The `VERSION` command is used to retrieve the version of the memcache server.

```bash
VERSION
```

### FLUSH_ALL

The `FLUSH_ALL` command is used to remove all values from the cache.

```bash
FLUSH_ALL
```

### QUIT

The `QUIT` command is used to close the connection to the memcache server.

```bash
QUIT
```

## Conclusion

These are some of the most commonly used commands in memcache. Understanding how to use these commands effectively can greatly enhance your ability to work with memcache and optimize the performance of your applications.
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
ã‚‚ã—ã€ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ååˆ†ãªãƒ¡ãƒ¢ãƒªãŒã‚ã‚‹ã‹ã©ã†ã‹ç¢ºä¿¡ãŒæŒã¦ãªã„å ´åˆã¯ã€"stats"ã‚³ãƒãƒ³ãƒ‰ã§è¡¨ç¤ºã•ã‚Œã‚‹"evictions"ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ååˆ†ãªãƒ¡ãƒ¢ãƒªãŒã‚ã‚‹å ´åˆã€"evictions"ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯0ã¾ãŸã¯å¢—åŠ ã—ã¦ã„ãªã„ã¯ãšã§ã™ã€‚

#### ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ <a href="#which-keys-are-used" id="which-keys-are-used"></a>

ç¾åœ¨ã®ã‚­ãƒ¼ã®ã‚»ãƒƒãƒˆã‚’ç›´æ¥ç¢ºèªã™ã‚‹ãŸã‚ã®çµ„ã¿è¾¼ã¿é–¢æ•°ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ã‚’æ¨æ¸¬ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
stats items
```
## Command to Determine How Many Keys Exist

To determine the number of keys that exist in a Memcache server, you can use the `stats` command. This command provides statistics about the server, including the total number of keys stored.

To execute the command, follow these steps:

1. Connect to the Memcache server using a Memcache client.
2. Send the `stats` command to the server.
3. Parse the response to extract the value of the `total_items` statistic.

Here is an example of how to execute the command using Telnet:

```bash
$ telnet <memcache_server_ip> 11211
stats
```

The server will respond with a list of statistics. Look for the `total_items` statistic and note its value. This value represents the total number of keys stored in the Memcache server.

Keep in mind that the `stats` command provides various other statistics as well, which can be useful for monitoring and troubleshooting purposes.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
ã“ã‚Œã«ã‚ˆã‚Šã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ—¢ã«memcacheã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã£ã¦ã„ã‚‹PHPã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã‚­ãƒ¼åã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã«ã¯ã€[100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html)ã®PHPã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„HackTricksã®PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
