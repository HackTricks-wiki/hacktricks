# Moodle

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã€‚

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

**ãƒãƒƒã‚­ãƒ³ã‚°ã‚­ãƒ£ãƒªã‚¢**ã«èˆˆå‘³ãŒã‚ã‚Šã€ãƒãƒƒã‚«ãƒ–ãƒ«ã§ã¯ãªã„ã‚‚ã®ã‚’ãƒãƒƒã‚¯ã—ãŸã„æ–¹ - **æ¡ç”¨ä¸­ã§ã™ï¼** (_æµæš¢ãªãƒãƒ¼ãƒ©ãƒ³ãƒ‰èªã®èª­ã¿æ›¸ããŒå¿…è¦ã§ã™_).

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVE

è‡ªå‹•ãƒ„ãƒ¼ãƒ«ã¯**Moodleãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹ã®ã«ã»ã¨ã‚“ã©å½¹ã«ç«‹ãŸãªã„**ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚[**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)ã§ãã‚Œã‚‰ã‚’**ãƒã‚§ãƒƒã‚¯**ã§ãã¾ã™ã€‚

## **RCE**

**ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**ã®å½¹å‰²ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã€**"ã‚µã‚¤ãƒˆç®¡ç†"**ã‚¿ãƒ–å†…ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™**ï¼š

![](<../../.gitbook/assets/image (447).png>)

ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã‚ã£ã¦ã‚‚ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’**æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚Moodleæ¨©é™æ˜‡æ ¼ã®PoCã§æ–¹æ³•ã‚’ç¢ºèªã§ãã¾ã™ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

ãã®å¾Œã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªpentest-monkeyã®php r**ev shell**ã‚’å«ã‚€**ä»¥ä¸‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™**ï¼ˆ_ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‰ã«è§£å‡ã—ã€revshellã®IPã¨ãƒãƒ¼ãƒˆã‚’å¤‰æ›´ã—ã¦å†åº¦åœ§ç¸®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™_ï¼‰

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

ã¾ãŸã¯ã€"cmd"ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦é€šå¸¸ã®PHPã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«[https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE)ã‹ã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

æ‚ªæ„ã®ã‚ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€æ¬¡ã®å ´æ‰€ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ãƒ€ãƒ³ãƒ—
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
```markdown
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

**ãƒãƒƒã‚­ãƒ³ã‚°ã‚­ãƒ£ãƒªã‚¢**ã«èˆˆå‘³ãŒã‚ã‚Šã€ãƒãƒƒã‚¯ä¸å¯èƒ½ã‚’ãƒãƒƒã‚¯ã—ãŸã„æ–¹ - **æ¡ç”¨æƒ…å ±ï¼** (_æµæš¢ãªãƒãƒ¼ãƒ©ãƒ³ãƒ‰èªã®èª­ã¿æ›¸ããŒå¿…è¦ã§ã™_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ã§</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
```
