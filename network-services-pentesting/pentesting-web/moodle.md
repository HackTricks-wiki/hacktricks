# Moodle

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

ã‚‚ã—ã€**ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚­ãƒ£ãƒªã‚¢**ã«èˆˆå‘³ãŒã‚ã‚Šã€**è§£èª­ä¸èƒ½ãªã‚‚ã®ã‚’ãƒãƒƒã‚¯**ã—ãŸã„å ´åˆã¯ã€**æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼**ï¼ˆæµæš¢ãªãƒãƒ¼ãƒ©ãƒ³ãƒ‰èªã®èª­ã¿æ›¸ããŒå¿…è¦ã§ã™ï¼‰ã€‚

{% embed url="https://www.stmcyber.com/careers" %}

## è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
`moodlescan` is a command-line tool used for scanning and pentesting Moodle installations. It is designed to identify vulnerabilities and security weaknesses in Moodle websites. The tool performs various tests and checks, including version detection, plugin enumeration, and known vulnerability scanning. It can also perform brute-force attacks to test the strength of user credentials. `moodlescan` is a valuable tool for security professionals and penetration testers to assess the security posture of Moodle installations.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMapã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Moodleãªã©ã®CMSï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®è„†å¼±æ€§ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

CMSMapã¯ã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€ãƒ†ãƒ¼ãƒã€ãŠã‚ˆã³ãã®ä»–ã®é‡è¦ãªæƒ…å ±ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

CMSMapã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€Pythonã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®URLã‚’æŒ‡å®šã—ã€è‡ªå‹•çš„ã«æƒ…å ±ã‚’åé›†ã—ã¾ã™ã€‚ã¾ãŸã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„ãƒ†ãƒ¼ãƒã®è„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚

CMSMapã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã«ãŠã„ã¦éå¸¸ã«å½¹ç«‹ã¤ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®è„†å¼±æ€§ã‚’ç‰¹å®šã—ã€ãã‚Œã‚‰ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã‹ã‚‰ã®æ”»æ’ƒã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

è‡ªå‹•ãƒ„ãƒ¼ãƒ«ã¯ã€Moodleã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹ã®ã«ã¯ã»ã¨ã‚“ã©å½¹ã«ç«‹ãŸãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®è„†å¼±æ€§ã¯ã€[https://snyk.io/vuln/composer:moodle%2Fmoodle](https://snyk.io/vuln/composer:moodle%2Fmoodle)ã§ç¢ºèªã§ãã¾ã™ã€‚

## RCE

ã€Œã‚µã‚¤ãƒˆç®¡ç†ã€ã‚¿ãƒ–å†…ã§ã€**ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®å½¹å‰²ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚

![](<../../.gitbook/assets/image (447).png>)

ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã‚ã£ã¦ã‚‚ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’**æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™**ã€‚Moodleç‰¹æ¨©ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³PoCã§ç¢ºèªã§ãã¾ã™ï¼š[https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321)ã€‚

æ¬¡ã«ã€ä»¥ä¸‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã¯ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªpentest-monkey php r**evã‚·ã‚§ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‰ã«è§£å‡ã—ã€revshellã®IPã¨ãƒãƒ¼ãƒˆã‚’å¤‰æ›´ã—ã€å†åº¦åœ§ç¸®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰**ã€‚

{% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

ã¾ãŸã¯ã€ã€Œcmdã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦é€šå¸¸ã®PHPã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€[https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE)ã‹ã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

æ‚ªæ„ã®ã‚ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è³‡æ ¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è³‡æ ¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãã¾ã™ã€‚
2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«é©å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
3. ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹ã¨ãã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã‚’é–‹ãã¾ã™ã€‚
4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ã€POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã¤ã‘ã¾ã™ã€‚
5. POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒœãƒ‡ã‚£ã‚’ç¢ºèªã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è³‡æ ¼æƒ…å ±ã‚’æ¢ã—ã¾ã™ã€‚
6. è³‡æ ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ¡ãƒ¢ã—ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è³‡æ ¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è³‡æ ¼æƒ…å ±ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹

To dump credentials from a database, you can use various techniques depending on the type of database and the access you have. Here are some common methods:

1. **SQL Injection**: If the application is vulnerable to SQL injection, you can exploit it to extract credentials from the database. By injecting malicious SQL queries, you can retrieve usernames, passwords, and other sensitive information.

2. **Brute-forcing**: If you have access to the database server, you can attempt to brute-force the login credentials. This involves trying different combinations of usernames and passwords until you find the correct ones.

3. **Exploiting Misconfigurations**: Sometimes, databases are misconfigured and allow unauthorized access. By identifying and exploiting these misconfigurations, you can gain access to the database and extract credentials.

4. **Dumping Hashes**: If you have read access to the database, you can dump the password hashes stored in the database. These hashes can then be cracked using various techniques, such as rainbow tables or brute-forcing, to obtain the actual passwords.

Remember, it is important to have proper authorization and legal permission before attempting to dump credentials from a database. Unauthorized access is illegal and unethical. Always ensure you are conducting penetration testing or security assessments within the boundaries of the law and with proper authorization.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

ã‚‚ã—ã‚ãªãŸãŒ**ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚­ãƒ£ãƒªã‚¢**ã«èˆˆå‘³ãŒã‚ã‚Šã€**è§£èª­ä¸èƒ½ãªã‚‚ã®ã‚’ãƒãƒƒã‚¯**ã—ãŸã„ã®ã§ã‚ã‚Œã° - **ç§ãŸã¡ã¯æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼** (_æµæš¢ãªãƒãƒ¼ãƒ©ãƒ³ãƒ‰èªã®èª­ã¿æ›¸ããŒå¿…è¦ã§ã™_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ã‚ãªãŸã¯**ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**](https://opensea.io/collection/the-peass-family)
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
