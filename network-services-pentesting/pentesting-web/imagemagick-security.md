# Seguridad de ImageMagick

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Consulta m치s detalles en [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

ImageMagick, una vers치til biblioteca de procesamiento de im치genes, presenta un desaf칤o en la configuraci칩n de su pol칤tica de seguridad debido a sus extensas opciones y la falta de documentaci칩n detallada en l칤nea. Los usuarios a menudo crean pol칤ticas basadas en fuentes de internet fragmentadas, lo que puede llevar a posibles configuraciones incorrectas. La biblioteca admite una amplia gama de m치s de 100 formatos de imagen, lo que contribuye a su complejidad y perfil de vulnerabilidad, como lo demuestran incidentes de seguridad hist칩ricos.

## Hacia Pol칤ticas M치s Seguras
Para abordar estos desaf칤os, se ha [desarrollado una herramienta](https://imagemagick-secevaluator.doyensec.com/) para ayudar en el dise침o y auditor칤a de las pol칤ticas de seguridad de ImageMagick. Esta herramienta se basa en una investigaci칩n extensa y tiene como objetivo garantizar que las pol칤ticas no solo sean s칩lidas, sino tambi칠n libres de lagunas que podr칤an ser explotadas.

## Enfoque de Lista Blanca vs Lista Negra
Hist칩ricamente, las pol칤ticas de ImageMagick se basaban en un enfoque de lista negra, donde se denegaba el acceso a codificadores espec칤ficos. Sin embargo, los cambios en ImageMagick 6.9.7-7 cambiaron este paradigma, permitiendo un enfoque de lista blanca. Este enfoque primero niega el acceso a todos los codificadores y luego otorga selectivamente acceso a los confiables, mejorando la postura de seguridad.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Sensibilidad a may칰sculas en las pol칤ticas
Es crucial tener en cuenta que los patrones de pol칤ticas en ImageMagick distinguen entre may칰sculas y min칰sculas. Por lo tanto, es vital asegurarse de que los codificadores y m칩dulos est칠n correctamente en may칰sculas en las pol칤ticas para evitar permisos no deseados.

## L칤mites de recursos
ImageMagick es propenso a ataques de denegaci칩n de servicio si no se configura correctamente. Establecer l칤mites de recursos expl칤citos en la pol칤tica es esencial para prevenir tales vulnerabilidades.

## Fragmentaci칩n de pol칤ticas
Las pol칤ticas pueden estar fragmentadas en diferentes instalaciones de ImageMagick, lo que puede provocar conflictos o anulaciones potenciales. Se recomienda localizar y verificar los archivos de pol칤ticas activos utilizando comandos como:
```shell
$ find / -iname policy.xml
```
## Una pol칤tica inicial restrictiva
Se ha propuesto una plantilla de pol칤tica restrictiva que se centra en limitaciones estrictas de recursos y controles de acceso. Esta plantilla sirve como base para desarrollar pol칤ticas personalizadas que se alineen con los requisitos espec칤ficos de la aplicaci칩n.

La efectividad de una pol칤tica de seguridad se puede confirmar utilizando el comando `identify -list policy` en ImageMagick. Adem치s, la [herramienta de evaluaci칩n](https://imagemagick-secevaluator.doyensec.com/) mencionada anteriormente se puede utilizar para refinar la pol칤tica en funci칩n de las necesidades individuales.

## Referencias
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)
