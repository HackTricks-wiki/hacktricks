# InformaÃ§Ãµes BÃ¡sicas do Tomcat

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira [**produtos oficiais PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

### Evite executar com root

Para nÃ£o executar o Tomcat com root, uma configuraÃ§Ã£o muito comum Ã© definir um servidor Apache na porta 80/443 e, se o caminho solicitado corresponder a uma expressÃ£o regular, a solicitaÃ§Ã£o Ã© enviada para o Tomcat em execuÃ§Ã£o em uma porta diferente.

### Estrutura PadrÃ£o
```
â”œâ”€â”€ bin
â”œâ”€â”€ conf
â”‚   â”œâ”€â”€ catalina.policy
â”‚   â”œâ”€â”€ catalina.properties
â”‚   â”œâ”€â”€ context.xml
â”‚   â”œâ”€â”€ tomcat-users.xml
â”‚   â”œâ”€â”€ tomcat-users.xsd
â”‚   â””â”€â”€ web.xml
â”œâ”€â”€ lib
â”œâ”€â”€ logs
â”œâ”€â”€ temp
â”œâ”€â”€ webapps
â”‚   â”œâ”€â”€ manager
â”‚   â”‚   â”œâ”€â”€ images
â”‚   â”‚   â”œâ”€â”€ META-INF
â”‚   â”‚   â””â”€â”€ WEB-INF
|   |       â””â”€â”€ web.xml
â”‚   â””â”€â”€ ROOT
â”‚       â””â”€â”€ WEB-INF
â””â”€â”€ work
    â””â”€â”€ Catalina
        â””â”€â”€ localhost
```
* A `WEB-INF` folder that contains the `web.xml` file, which is the deployment descriptor for the web application.
* A `classes` folder that contains the compiled Java classes.
* A `lib` folder that contains the JAR files needed for the web application.
* Any other files or folders that are part of the web application.

---

* A pasta `bin` armazena scripts e binÃ¡rios necessÃ¡rios para iniciar e executar um servidor Tomcat.
* A pasta `conf` armazena vÃ¡rios arquivos de configuraÃ§Ã£o usados pelo Tomcat.
* O arquivo `tomcat-users.xml` armazena as credenciais do usuÃ¡rio e suas funÃ§Ãµes atribuÃ­das.
* A pasta `lib` contÃ©m vÃ¡rios arquivos JAR necessÃ¡rios para o correto funcionamento do Tomcat.
* As pastas `logs` e `temp` armazenam arquivos de log temporÃ¡rios.
* A pasta `webapps` Ã© a raiz do Tomcat e hospeda todas as aplicaÃ§Ãµes. A pasta `work` atua como um cache e Ã© usada para armazenar dados durante a execuÃ§Ã£o.

Cada pasta dentro de `webapps` deve ter a seguinte estrutura.

* Uma pasta `WEB-INF` que contÃ©m o arquivo `web.xml`, que Ã© o descritor de implantaÃ§Ã£o para a aplicaÃ§Ã£o web.
* Uma pasta `classes` que contÃ©m as classes Java compiladas.
* Uma pasta `lib` que contÃ©m os arquivos JAR necessÃ¡rios para a aplicaÃ§Ã£o web.
* Quaisquer outros arquivos ou pastas que fazem parte da aplicaÃ§Ã£o web.
```
webapps/customapp
â”œâ”€â”€ images
â”œâ”€â”€ index.jsp
â”œâ”€â”€ META-INF
â”‚   â””â”€â”€ context.xml
â”œâ”€â”€ status.xsd
â””â”€â”€ WEB-INF
    â”œâ”€â”€ jsp
    |   â””â”€â”€ admin.jsp
    â””â”€â”€ web.xml
    â””â”€â”€ lib
    |    â””â”€â”€ jdbc_drivers.jar
    â””â”€â”€ classes
        â””â”€â”€ AdminServlet.class 
```
O arquivo mais importante entre eles Ã© o `WEB-INF/web.xml`, que Ã© conhecido como descritor de implantaÃ§Ã£o. Este arquivo armazena **informaÃ§Ãµes sobre as rotas** usadas pela aplicaÃ§Ã£o e as classes que lidam com essas rotas.\
Todas as classes compiladas usadas pela aplicaÃ§Ã£o devem ser armazenadas na pasta `WEB-INF/classes`. Essas classes podem conter lÃ³gica de negÃ³cios importantes, bem como informaÃ§Ãµes confidenciais. Qualquer vulnerabilidade nesses arquivos pode levar Ã  comprometimento total do site. A pasta `lib` armazena as bibliotecas necessÃ¡rias para essa aplicaÃ§Ã£o especÃ­fica. A pasta `jsp` armazena [Jakarta Server Pages (JSP)](https://en.wikipedia.org/wiki/Jakarta\_Server\_Pages), anteriormente conhecido como `JavaServer Pages`, que pode ser comparado a arquivos PHP em um servidor Apache.

Aqui estÃ¡ um exemplo de arquivo **web.xml**.
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">

<web-app>
  <servlet>
    <servlet-name>AdminServlet</servlet-name>
    <servlet-class>com.inlanefreight.api.AdminServlet</servlet-class>
  </servlet>

  <servlet-mapping>
    <servlet-name>AdminServlet</servlet-name>
    <url-pattern>/admin</url-pattern>
  </servlet-mapping>
</web-app>   
```
A configuraÃ§Ã£o `web.xml` acima define um **novo servlet chamado `AdminServlet`** que Ã© mapeado para a **classe `com.inlanefreight.api.AdminServlet`**. Java usa a notaÃ§Ã£o de ponto para criar nomes de pacotes, o que significa que o caminho no disco para a classe definida acima seria:

* **`classes/com/inlanefreight/api/AdminServlet.class`**

Em seguida, Ã© criado um novo mapeamento de servlet para **mapear solicitaÃ§Ãµes para `/admin` com `AdminServlet`**. Essa configuraÃ§Ã£o enviarÃ¡ qualquer solicitaÃ§Ã£o recebida para **`/admin` para a classe `AdminServlet.class`** para processamento. O descritor **`web.xml`** contÃ©m muitas informaÃ§Ãµes **sensÃ­veis** e Ã© um arquivo importante para verificar ao aproveitar uma vulnerabilidade de **InclusÃ£o de Arquivo Local (LFI)**.

### tomcat-users

O arquivo **`tomcat-users.xml`** Ã© usado para **permitir** ou negar o acesso Ã s pÃ¡ginas de administraÃ§Ã£o **`/manager` e `host-manager`**.
```xml
<?xml version="1.0" encoding="UTF-8"?>

<SNIP>
  
<tomcat-users xmlns="http://tomcat.apache.org/xml"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd"
              version="1.0">
<!--
  By default, no user is included in the "manager-gui" role required
  to operate the "/manager/html" web application.  If you wish to use this app,
  you must define such a user - the username and password are arbitrary.

  Built-in Tomcat manager roles:
    - manager-gui    - allows access to the HTML GUI and the status pages
    - manager-script - allows access to the HTTP API and the status pages
    - manager-jmx    - allows access to the JMX proxy and the status pages
    - manager-status - allows access to the status pages only

  The users below are wrapped in a comment and are therefore ignored. If you
  wish to configure one or more of these users for use with the manager web
  application, do not forget to remove the <!.. ..> that surrounds them. You
  will also need to set the passwords to something appropriate.
-->

   
 <SNIP>
  
!-- user manager can access only manager section -->
<role rolename="manager-gui" />
<user username="tomcat" password="tomcat" roles="manager-gui" />

<!-- user admin can access manager and admin section both -->
<role rolename="admin-gui" />
<user username="admin" password="admin" roles="manager-gui,admin-gui" />


</tomcat-users>
```
O arquivo nos mostra para que cada um dos papÃ©is `manager-gui`, `manager-script`, `manager-jmx` e `manager-status` fornecem acesso. Neste exemplo, podemos ver que um usuÃ¡rio `tomcat` com a senha `tomcat` tem o papel `manager-gui`, e uma segunda senha fraca `admin` Ã© definida para a conta de usuÃ¡rio `admin`.

## ReferÃªncias

* [https://academy.hackthebox.com/module/113/section/1090](https://academy.hackthebox.com/module/113/section/1090)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live).
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
