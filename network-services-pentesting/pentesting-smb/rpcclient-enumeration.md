# rpcclient enumeration

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** **ğŸ¦**[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Find vulnerabilities that matter most so you can fix them faster. Intruder tracks your attack surface, runs proactive threat scans, finds issues across your whole tech stack, from APIs to web apps and cloud systems. [**Try it for free**](https://www.intruder.io/?utm_source=referral\&utm_campaign=hacktricks) today.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### **What is a RID**

A [Relative Identifier (RID)](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) is a **unique identifier** (represented in hexadecimal format) utilized by Windows to **track and identify objects**. To explain how this fits in, let's look at the examples below:

* The [SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) for the NAME\_DOMAIN.LOCAL domain is: `S-1-5-21-1038751438-1834703946-36937684957`.
* When an object is created within a domain, the number above (SID) will be combined with a RID to make a unique value used to represent the object.
* So the domain user `john` with a RID:\[0x457] Hex 0x457 would = decimal `1111`, will have a full user SID of: `S-1-5-21-1038751438-1834703946-36937684957-1111`.
* This is unique to the `john` object in the NAME\_DOMAIN.LOCAL domain and you will never see this paired value tied to another object in this domain or any other.

Definition from [**here**](https://academy.hackthebox.com/module/143/section/1269).

### **Enumeration with rpcclient**

The **`rpcclient`** utility from Samba is utilized for interacting with **RPC endpoints through named pipes**. Below commands that can be issued to the SAMR, LSARPC, and LSARPC-DS interfaces after a **SMB session is established**, often necessitating credentials.

#### Server Information

* To obtain **Server Information**: `srvinfo` command is used.

#### Enumeration of Users

* **Users can be listed** using: `querydispinfo` and `enumdomusers`.
* **Details of a user** by: `queryuser <0xrid>`.
* **Groups of a user** with: `queryusergroups <0xrid>`.
* **A user's SID is retrieved** through: `lookupnames <username>`.
* **Aliases of users** by: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### ã‚°ãƒ«ãƒ¼ãƒ—ã®åˆ—æŒ™

* **ã‚°ãƒ«ãƒ¼ãƒ—**ï¼š`enumdomgroups`ã«ã‚ˆã‚‹ã€‚
* **ã‚°ãƒ«ãƒ¼ãƒ—ã®è©³ç´°**ï¼š`querygroup <0xrid>`ã‚’ä½¿ç”¨ã€‚
* **ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼**ï¼š`querygroupmem <0xrid>`ã‚’ä»‹ã—ã¦ã€‚

#### ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®åˆ—æŒ™

* **ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—**ï¼š`enumalsgroups <builtin|domain>`ã«ã‚ˆã‚‹ã€‚
* **ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼**ï¼š`queryaliasmem builtin|domain <0xrid>`ã‚’ä½¿ç”¨ã€‚

#### ãƒ‰ãƒ¡ã‚¤ãƒ³ã®åˆ—æŒ™

* **ãƒ‰ãƒ¡ã‚¤ãƒ³**ï¼š`enumdomains`ã‚’ä½¿ç”¨ã€‚
* **ãƒ‰ãƒ¡ã‚¤ãƒ³ã®SIDã®å–å¾—**ï¼š`lsaquery`ã«ã‚ˆã‚‹ã€‚
* **ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®å–å¾—**ï¼š`querydominfo`ã«ã‚ˆã‚‹ã€‚

#### å…±æœ‰ã®åˆ—æŒ™

* **åˆ©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®å…±æœ‰**ï¼š`netshareenumall`ã«ã‚ˆã‚‹ã€‚
* **ç‰¹å®šã®å…±æœ‰ã«é–¢ã™ã‚‹æƒ…å ±ã®å–å¾—**ï¼š`netsharegetinfo <share>`ã‚’ä½¿ç”¨ã€‚

#### SIDã‚’ä½¿ç”¨ã—ãŸè¿½åŠ æ“ä½œ

* **åå‰ã‹ã‚‰SIDã¸ã®å¤‰æ›**ï¼š`lookupnames <username>`ã‚’ä½¿ç”¨ã€‚
* **ã•ã‚‰ãªã‚‹SID**ï¼š`lsaenumsid`ã‚’ä»‹ã—ã¦ã€‚
* **RIDã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ã•ã‚‰ãªã‚‹SIDã®ç¢ºèª**ï¼š`lookupsids <sid>`ã«ã‚ˆã£ã¦å®Ÿè¡Œã€‚

#### **è¿½åŠ ã‚³ãƒãƒ³ãƒ‰**

| **ã‚³ãƒãƒ³ãƒ‰**         | **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**                                                                                                                                     | **èª¬æ˜**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—                                                                                                                 |
| querygroup          | ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã®å–å¾—                                                                                                                        |                                                                                                                                           |
| querydominfo        | ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®å–å¾—                                                                                                                       |                                                                                                                                           |
| enumdomusers        | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ—æŒ™                                                                                                                            |                                                                                                                                           |
| enumdomgroups       | ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®åˆ—æŒ™                                                                                                                           |                                                                                                                                           |
| createdomuser       | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ                                                                                                                              |                                                                                                                                           |
| deletedomuser       | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤                                                                                                                              |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8)å€¤ã«å¤‰æ›ã™ã‚‹ |
| lookupsids          | SIDã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«å¤‰æ›ã™ã‚‹ï¼ˆRID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°ï¼‰ |                                                                                                                                           |
| lsaaddacctrights    | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ¨©é™ã‚’è¿½åŠ                                                                                                                       |                                                                                                                                           |
| lsaremoveacctrights | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰æ¨©é™ã‚’å‰Šé™¤                                                                                                                 |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®å–å¾—                                                                                                            |
| dsenumdomtrusts     | ADãƒ•ã‚©ãƒ¬ã‚¹ãƒˆå†…ã®ä¿¡é ¼ã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã®åˆ—æŒ™                                                                                                     |                                                                                                                                           |

**_samrdump_** **ãŠã‚ˆã³** **_rpcdump_** ã®å‹•ä½œã‚’ç†è§£ã™ã‚‹ã«ã¯ã€[**Pentesting MSRPC**](../135-pentesting-msrpc.md)ã‚’èª­ã‚€ã¹ãã§ã™ã€‚

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æœ€ã‚‚é‡è¦ãªè„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã¦è¿…é€Ÿã«ä¿®æ­£ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚Intruderã¯æ”»æ’ƒå¯¾è±¡ã‚’è¿½è·¡ã—ã€ç©æ¥µçš„ãªè„…å¨ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã€APIã‹ã‚‰Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¾ã§ã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å…¨ä½“ã§å•é¡Œã‚’è¦‹ã¤ã‘ã¾ã™ã€‚[**ç„¡æ–™ã§ãŠè©¦ã—ãã ã•ã„**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã™
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹
* **[ğŸ’¬](https://emojipedia.org/speech-balloon/) Discordã‚°ãƒ«ãƒ¼ãƒ—**ã«å‚åŠ ã™ã‚‹ã‹ã€[Telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§[**@carlospolopm**](https://twitter.com/hacktricks_live)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„**ã€‚

</details>
