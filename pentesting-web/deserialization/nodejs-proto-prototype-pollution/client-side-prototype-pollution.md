# PoluiÃ§Ã£o de ProtÃ³tipo do Lado do Cliente

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Descobrindo usando ferramentas automÃ¡ticas

As ferramentas [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **e** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) podem ser usadas para **encontrar vulnerabilidades de poluiÃ§Ã£o de protÃ³tipo**.

AlÃ©m disso, vocÃª tambÃ©m pode usar a **extensÃ£o do navegador** [**PPScan**](https://github.com/msrkp/PPScan) para **escanear automaticamente** as **pÃ¡ginas** que vocÃª **acessa** em busca de vulnerabilidades de poluiÃ§Ã£o de protÃ³tipo.

### Depurando onde uma propriedade Ã© usada <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
    console.trace();
    return 'test';
}})
```
{% endcode %}

### Encontrando a causa raiz da PoluiÃ§Ã£o de ProtÃ³tipos <a href="#5530" id="5530"></a>

Uma vez que qualquer uma das ferramentas tenha **identificado** uma **vulnerabilidade de poluiÃ§Ã£o de protÃ³tipos**, se o **cÃ³digo** nÃ£o for muito **complexo**, vocÃª pode **procurar** o cÃ³digo JS pelas palavras-chave **`location.hash/decodeURIComponent/location.search`** no Chrome Developer Tools e encontrar o local vulnerÃ¡vel.

Se o cÃ³digo for grande e complexo, hÃ¡ uma maneira fÃ¡cil de **descobrir onde estÃ¡ o cÃ³digo vulnerÃ¡vel**:

* Usando uma das ferramentas, **encontre uma vulnerabilidade** e obtenha um **payload** que irÃ¡ **definir uma propriedade** no construtor. No ppmap, vocÃª receberÃ¡ algo como: `constructor[prototype][ppmap]=reserved`
* Agora, defina um **ponto de interrupÃ§Ã£o na primeira linha do cÃ³digo JS** que serÃ¡ executado na pÃ¡gina e atualize a pÃ¡gina com o payload para que a **execuÃ§Ã£o seja interrompida lÃ¡**.
* Enquanto a execuÃ§Ã£o do JS estiver interrompida, **cole o seguinte script no console JS**. Este cÃ³digo indicarÃ¡ quando a propriedade 'ppmap' for criada, para que vocÃª possa encontrar onde ela foi criada.
```javascript
function debugAccess(obj, prop, debugGet=true){

    var origValue = obj[prop];

    Object.defineProperty(obj, prop, {
        get: function () {
            if ( debugGet )
                debugger;
            return origValue;
        },
        set: function(val) {
            debugger;
            return origValue = val;
        }
    });

};

debugAccess(Object.prototype, 'ppmap')
```
Volte para **Fontes** e clique em â€œ**Continuar** a **execuÃ§Ã£o** do scriptâ€. Depois de fazer isso, todo o **javascript** serÃ¡ **executado** e o ppmap serÃ¡ poluÃ­do novamente, como esperado. Com a ajuda do Snippet, podemos encontrar exatamente onde a propriedade ppmap estÃ¡ poluÃ­da. Podemos **clicar** na **Pilha de Chamadas** e vocÃª enfrentarÃ¡ **diferentes** **pilhas** onde a **poluiÃ§Ã£o** **ocorreu**.

Mas qual escolher? Na maioria das vezes, a Prototype Pollution ocorre em bibliotecas Javascript, entÃ£o aponte para a pilha que estÃ¡ anexada aos arquivos de biblioteca .js (olhe para o lado direito, assim como na imagem, para saber a qual endpoint a pilha estÃ¡ anexada). Neste caso, temos 2 pilhas na linha 4 e 6, logicamente escolheremos a 4Âª linha porque essa linha Ã© a primeira vez em que a poluiÃ§Ã£o ocorre, o que significa que essa linha Ã© a razÃ£o da vulnerabilidade. Clicar na pilha nos redirecionarÃ¡ para o cÃ³digo vulnerÃ¡vel.

![](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Encontrando Gadgets de Script

O gadget Ã© o **cÃ³digo que serÃ¡ abusado assim que uma vulnerabilidade PP for descoberta**.

Se a aplicaÃ§Ã£o for simples, podemos **procurar** por **palavras-chave** como **`srcdoc/innerHTML/iframe/createElement`** e revisar o cÃ³digo-fonte e verificar se ele **leva Ã  execuÃ§Ã£o do javascript**. Ã€s vezes, as tÃ©cnicas mencionadas podem nÃ£o encontrar gadgets. Nesse caso, a revisÃ£o pura do cÃ³digo-fonte revela alguns gadgets interessantes, como o exemplo abaixo.

### Exemplo de Encontrar Gadget PP no CÃ³digo da Biblioteca Mithil

Confira este artigo: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## RecompilaÃ§Ã£o de payloads para bibliotecas vulnerÃ¡veis

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## ReferÃªncias

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
