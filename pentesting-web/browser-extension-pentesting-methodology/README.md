# ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®ä¾µå…¥ãƒ†ã‚¹ãƒˆæ–¹æ³•è«–

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong>ã‚’ä½¿ã£ã¦ã€ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã¾ãŸã¯[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>

## åŸºæœ¬æƒ…å ±

ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã¯JavaScriptã§æ›¸ã‹ã‚Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ãã‚Œã¯è‡ªèº«ã®[DOM](https://www.w3schools.com/js/js\_htmldom.asp)ã‚’æŒã£ã¦ãŠã‚Šã€ä»–ã®ã‚µã‚¤ãƒˆã®DOMã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ä»–ã®ã‚µã‚¤ãƒˆã®æ©Ÿå¯†æ€§ã€æ•´åˆæ€§ã€å¯ç”¨æ€§ï¼ˆCIAï¼‰ã‚’å±é™ºã«ã•ã‚‰ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯è¦–è¦šåŒ–ã•ã‚ŒãŸéš›ã«æœ€ã‚‚è¦‹æ „ãˆãŒã‚ˆãã€3ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

<figure><img src="../../.gitbook/assets/image (16) (1).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

å„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯**å˜ä¸€ã®Webãƒšãƒ¼ã‚¸**ã®DOMã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€ã—ãŸãŒã£ã¦**æ½œåœ¨çš„ã«æ‚ªæ„ã®ã‚ã‚‹å…¥åŠ›**ã«ã•ã‚‰ã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹æ¨©é™ä»¥å¤–ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

### **æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢**

æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã»ã¨ã‚“ã©ã®æ¨©é™/ã‚¢ã‚¯ã‚»ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã¯[XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)ãŠã‚ˆã³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»‹ã—ã¦Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã®ã¿ã‚„ã‚Šå–ã‚Šã§ãã¾ã™ã€‚ã¾ãŸã€æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã¯ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ã‚’æŒã£ã¦ã„ã¾ã›ã‚“ã€‚

### **ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒª**

æ‹¡å¼µæ©Ÿèƒ½ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å®Œå…¨ãªæ¨©é™ã‚’æŒã¤ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒªãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒªã¯ã€Flashã‚„ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹æ¨™æº–ã®Netscape Plugin Application Programming Interfaceï¼ˆ[NPAPI](https://en.wikipedia.org/wiki/NPAPI)ï¼‰ã‚’ä»‹ã—ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã¨ã‚„ã‚Šå–ã‚Šã—ã¾ã™ã€‚

### å¢ƒç•Œ

{% hint style="danger" %}
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å®Œå…¨ãªæ¨©é™ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€æ”»æ’ƒè€…ã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã«ã€ãã—ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã‹ã‚‰ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒªã«æ‚ªæ„ã®ã‚ã‚‹å…¥åŠ›ã‚’æ¸¡ã™ã‚ˆã†ã«æ‹¡å¼µæ©Ÿèƒ½ã‚’èª¬å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

æ‹¡å¼µæ©Ÿèƒ½ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€**å¼·åŠ›ãªä¿è­·å¢ƒç•Œ**ã«ã‚ˆã£ã¦äº’ã„ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯**åˆ¥ã€…ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ã‚»ã‚¹**ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨æ‹¡å¼µæ©Ÿèƒ½ã‚³ã‚¢ã¯ã€ã»ã¨ã‚“ã©ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯åˆ©ç”¨ã§ããªã„**ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ—ãƒ­ã‚»ã‚¹**ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã•ã‚‰ã«ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯**åˆ¥ã€…ã®JavaScriptãƒ’ãƒ¼ãƒ—**ã§å®Ÿè¡Œã•ã‚Œã€é–¢é€£ã™ã‚‹Webãƒšãƒ¼ã‚¸ã‹ã‚‰åˆ†é›¢ã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨Webãƒšãƒ¼ã‚¸ã¯**åŒã˜åŸºç¤ã¨ãªã‚‹DOMã«ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã¾ã™ãŒã€2ã¤ã¯**JavaScriptãƒã‚¤ãƒ³ã‚¿ã‚’äº¤æ›ã›ãš**ã€JavaScriptæ©Ÿèƒ½ã®æ¼æ´©ã‚’é˜²ãã¾ã™ã€‚

## **`manifest.json`**

Chromeæ‹¡å¼µæ©Ÿèƒ½ã¯ã€[.crxãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­](https://www.lifewire.com/crx-file-2620391)ã‚’æŒã¤ZIPãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã§ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½ã®ã‚³ã‚¢ã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹**`manifest.json`**ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€æ¨©é™ã€ãŠã‚ˆã³ãã®ä»–ã®æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚

ä¾‹ï¼š
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€è‡´ã™ã‚‹ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ãŸã³ã«**ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™**ã€‚ã“ã®å ´åˆã€**`https://example.com/*`**ã¨ä¸€è‡´ã™ã‚‹ãƒšãƒ¼ã‚¸ãŠã‚ˆã³**`*://*/*/business*`**ã¨ä¸€è‡´ã—ãªã„ãƒšãƒ¼ã‚¸ã§ã™ã€‚ã“ã‚Œã‚‰ã¯ãƒšãƒ¼ã‚¸è‡ªä½“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚ˆã†ã«**å®Ÿè¡Œã•ã‚Œã€ãƒšãƒ¼ã‚¸ã®[Document Object Model (DOM)](https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model)**ã«ä»»æ„ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
ä»¥ä¸‹ã¯ã€**`include_globs`** ã¨ **`exclude_globs`** ã‚’ä½¿ç”¨ã—ã¦ã•ã‚‰ã«URLã‚’å«ã‚ãŸã‚Šé™¤å¤–ã—ãŸã‚Šã™ã‚‹æ–¹æ³•ã§ã™ã€‚

ã“ã‚Œã¯ã€ãƒšãƒ¼ã‚¸ã«èª¬æ˜ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹ã§ã™ã€‚[ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage)ã‚’ä½¿ç”¨ã—ã¦ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ `message` ã®å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

ã“ã®ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã£ã¦æ‹¡å¼µæ©Ÿèƒ½ãƒšãƒ¼ã‚¸ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€`storage`ãŒä¾‹å¤–ã®ä¸­ã«ã‚ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒAPIã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„åˆ¶é™ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã‚Œã‚‰ã®ä¾‹å¤–ã‚’è¶…ãˆã‚‹æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒé€šä¿¡ã§ãã‚‹æ‹¡å¼µæ©Ÿèƒ½ãƒšãƒ¼ã‚¸ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ©Ÿèƒ½ã¯ã‚ãšã‹ã«ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚Chromiumãƒ™ãƒ¼ã‚¹ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã€æ©Ÿèƒ½ã®ãƒªã‚¹ãƒˆã¯[Chrome Developers documentation](https://developer.chrome.com/docs/extensions/mv3/content\_scripts/#capabilities)ã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€Firefoxã§ã¯[MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content\_scripts#webextension\_apis)ãŒä¸»è¦ãªæƒ…å ±æºã¨ãªã‚Šã¾ã™ã€‚\
ã¾ãŸã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨é€šä¿¡ã™ã‚‹èƒ½åŠ›ã‚’æŒã¡ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€å¿œç­”ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

Chromeã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¡¨ç¤ºãŠã‚ˆã³ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã«ã¯ã€Chromeãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Options > More tools > Developer toolsã‚’é¸æŠã™ã‚‹ã‹ã€Ctrl + Shift + Iã‚’æŠ¼ã—ã¾ã™ã€‚

ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€**Sourceã‚¿ãƒ–**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãã®å¾Œ**Content Scriptsã‚¿ãƒ–**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã•ã¾ã–ã¾ãªæ‹¡å¼µæ©Ÿèƒ½ã‹ã‚‰å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¦³å¯Ÿã—ã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã§ãã¾ã™ã€‚

### æ³¨å…¥ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

{% hint style="success" %}
**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¿…é ˆã§ã¯ãªã„**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**å‹•çš„ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥**ã—ãŸã‚Šã€**`tabs.executeScript`**ã‚’ä½¿ç”¨ã—ã¦ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«**ãƒ—ãƒ­ã‚°ãƒ©ãƒ çš„ã«æ³¨å…¥**ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚ˆã‚Š**ç´°ã‹ã„åˆ¶å¾¡**ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ çš„ã«æ³¨å…¥ã™ã‚‹ã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥ã™ã‚‹ãƒšãƒ¼ã‚¸ã«å¯¾ã—ã¦[ãƒ›ã‚¹ãƒˆæ¨©é™](https://developer.chrome.com/docs/extensions/reference/permissions)ãŒæ‹¡å¼µæ©Ÿèƒ½ã«å¿…è¦ã§ã™ã€‚ã“ã‚Œã‚‰ã®æ¨©é™ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå†…ã§ãã‚Œã‚‰ã‚’**è¦æ±‚**ã™ã‚‹ã‹ã€[**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab)ã‚’ä»‹ã—ã¦ä¸€æ™‚çš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### activeTabãƒ™ãƒ¼ã‚¹ã®æ‹¡å¼µæ©Ÿèƒ½ã®ä¾‹

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **ã‚¯ãƒªãƒƒã‚¯æ™‚ã«JSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ãƒˆã™ã‚‹:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **ã‚¯ãƒªãƒƒã‚¯æ™‚ã«é–¢æ•°ã‚’æ³¨å…¥ã™ã‚‹**:
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¨©é™ã®ä¾‹
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
### Content Scripts `run_at`

`run_at`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€**JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ãŒWebãƒšãƒ¼ã‚¸ã«æ³¨å…¥ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°**ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚æ¨å¥¨ã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯`"document_idle"`ã§ã™ã€‚

å¯èƒ½ãªå€¤ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

- **`document_idle`**ï¼šå¯èƒ½ãªé™ã‚Š
- **`document_start`**ï¼š`css`ã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å¾Œã€ãŸã ã—ä»–ã®DOMãŒæ§‹ç¯‰ã•ã‚Œã‚‹å‰ã‚„ä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«
- **`document_end`**ï¼šDOMãŒå®Œå…¨ã«ãªã£ãŸç›´å¾Œã€ãŸã ã—ç”»åƒã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãªã©ã®ã‚µãƒ–ãƒªã‚½ãƒ¼ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å‰

#### `manifest.json`ã‚’ä»‹ã—ã¦
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
**`service-worker.js`**ã‚’ä»‹ã—ã¦
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰`

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã£ã¦é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸**ã«ã‚ˆã£ã¦å—ä¿¡ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª¿æ•´ã™ã‚‹ä¸­å¿ƒçš„ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ç‰¹ç­†ã™ã¹ãã¯ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ãŒæ‹¡å¼µæ©Ÿèƒ½ã®å¯¿å‘½å…¨ä½“ã«ã‚ãŸã£ã¦æŒç¶šã—ã€ç›´æ¥çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ã‚„ã‚Šå–ã‚Šãªã—ã«é™ã‹ã«å‹•ä½œã—ã¾ã™ã€‚ç‹¬è‡ªã®Document Object Modelï¼ˆDOMï¼‰ã‚’æŒã¡ã€è¤‡é›‘ãªç›¸äº’ä½œç”¨ã‚„çŠ¶æ…‹ç®¡ç†ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

**ä¸»ãªãƒã‚¤ãƒ³ãƒˆ**:

* **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ã®å½¹å‰²:** æ‹¡å¼µæ©Ÿèƒ½ã®ä¸­å¿ƒéƒ¨ã¨ã—ã¦æ©Ÿèƒ½ã—ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã•ã¾ã–ã¾ãªéƒ¨åˆ†ã¨ã®é€šä¿¡ã¨èª¿æ•´ã‚’ç¢ºå®Ÿã«ã—ã¾ã™ã€‚
* **æŒç¶šæ€§:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ãˆãªã„ãŒã€æ‹¡å¼µæ©Ÿèƒ½ã®æ©Ÿèƒ½æ€§ã«ã¯ä¸å¯æ¬ ãªã€å¸¸ã«å­˜åœ¨ã™ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã™ã€‚
* **è‡ªå‹•ç”Ÿæˆ:** æ˜ç¤ºçš„ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§æŒ‡å®šã•ã‚ŒãŸã™ã¹ã¦ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå«ã¾ã‚Œã€æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªå‹•ä½œã‚’ä¿è¨¼ã—ã¾ã™ã€‚

{% hint style="success" %}
ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã“ã¨ã§ï¼ˆæ˜ç¤ºçš„ã«å®£è¨€ã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰ã€å¿…è¦ãªã™ã¹ã¦ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒçµ±åˆã•ã‚Œã€æ“ä½œã•ã‚Œã‚‹ã“ã¨ã§ã€æ‹¡å¼µæ©Ÿèƒ½ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ—ãƒ­ã‚»ã‚¹ãŒåˆç†åŒ–ã•ã‚Œã¾ã™ã€‚
{% endhint %}

ä¾‹: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
It uses [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage) to listen to messages. When an `"explain"` message is received, it uses [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) to open a page in a new tab.

To debug the background script you could go to the **extension details and inspect the service worker,** this will open the developer tools with the background script:

<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>

### Options pages and other

Browser extensions can contain various kinds of pages:

* **Action pages** are displayed in a **drop-down when the extension ico**n is clicked.
* Pages that the extension will **load in a new tab**.
* **Option Pages**: This page displays on top of the extension when clicked. In the previous manifest In my case I was able to access this page in `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca` or clicking:

<figure><img src="../../.gitbook/assets/image (24).png" alt="" width="375"><figcaption></figcaption></figure>

Note that these pages aren't persistent like background pages as they load dynamically content on necessity. Despite this, they share certain capabilities with the background page:

* **Communication with Content Scripts:** Similar to the background page, these pages can receive messages from content scripts, facilitating interaction within the extension.
* **Access to Extension-Specific APIs:** These pages enjoy comprehensive access to extension-specific APIs, subject to the permissions defined for the extension.

### `permissions` & `host_permissions`

**`permissions`** and **`host_permissions`** are entries from the `manifest.json` that will indicate **which permissions** the browser extensions has (storage, location...) and in **which web pages**.

As browser extensions can be so **privileged**, a malicious one or one being compromised could allow the attacker **different means to steal sensitive information and spy on the user**.

Check how these settings work and how they could get abused in:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

A **content security policy** can be declared also inside the `manifest.json`. If there is one defined, it could be **vulnerable**.

The default setting for browser extension pages is rather restrictive:
```bash
script-src 'self'; object-src 'self';
```
ä»¥ä¸‹ã¯CSPã¨æ½œåœ¨çš„ãªãƒã‚¤ãƒ‘ã‚¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã§ã™ï¼š

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ãŒãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®ãƒšãƒ¼ã‚¸ï¼ˆä¾‹ï¼š`.html`ãƒšãƒ¼ã‚¸ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯ã€`manifest.json`ã®**`web_accessible_resources`**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã“ã®ãƒšãƒ¼ã‚¸ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\
ä¾‹ï¼š
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ã¯æ¬¡ã®ã‚ˆã†ãªURLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š
```
chrome-extension://<extension-id>/message.html
```
å…¬é–‹æ‹¡å¼µæ©Ÿèƒ½ã§ã¯ã€**extension-id ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã§ã™ï¼š

<figure><img src="../../.gitbook/assets/image (1194).png" alt="" width="375"><figcaption></figcaption></figure>

ãŸã ã—ã€`manifest.json` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ **`use_dynamic_url`** ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã“ã® **id ã¯å‹•çš„ã«ãªã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% hint style="success" %}
ã“ã“ã§ãƒšãƒ¼ã‚¸ãŒè¨€åŠã•ã‚Œã¦ã„ã¦ã‚‚ã€**Content Security Policy** ã«ã‚ˆã£ã¦ **ClickJacking ã«å¯¾ã—ã¦ä¿è­·**ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ClickJacking æ”»æ’ƒãŒå¯èƒ½ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹å‰ã«ãã‚Œã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆframe-ancestors ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã€‚
{% endhint %}

ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ã¯ **æ½œåœ¨çš„ã«è„†å¼±ãª ClickJacking** ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ãŒãƒ©ãƒ³ãƒ€ãƒ ãª URL ã§ã¯ãªãæ‹¡å¼µæ©Ÿèƒ½ã«ã‚ˆã£ã¦ã®ã¿èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã€ClickJacking æ”»æ’ƒã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

{% hint style="danger" %}
**`web_accessible_resources`** ã‹ã‚‰ã®ãƒšãƒ¼ã‚¸ã‚„æ‹¡å¼µæ©Ÿèƒ½ã®ä»–ã®ãƒšãƒ¼ã‚¸ã‚‚ **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«æ¥è§¦**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ã®ã†ã¡ã®1ã¤ãŒ **XSS ã«è„†å¼±**ã§ã‚ã‚‹å ´åˆã€ã‚ˆã‚Šå¤§ããªè„†å¼±æ€§ãŒé–‹ã‹ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€**`web_accessible_resources`** ã§æŒ‡å®šã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã¯ iframes å†…ã§ã®ã¿é–‹ãã“ã¨ãŒã§ãã¾ã™ãŒã€æ–°ã—ã„ã‚¿ãƒ–ã‹ã‚‰ã¯æ‹¡å¼µæ©Ÿèƒ½å†…ã®ä»»æ„ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€åŒã˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ‚ªç”¨ã—ãŸ XSS ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ãã®ãƒšãƒ¼ã‚¸ãŒ **`web_accessible_resources`** ã«æ§‹æˆã•ã‚Œã¦ã„ãªãã¦ã‚‚æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### `externally_connectable`

[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable) ã«ã‚ˆã‚‹ã¨ã€`"externally_connectable"` ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€[runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) ãŠã‚ˆã³ [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) ã‚’ä»‹ã—ã¦æ‹¡å¼µæ©Ÿèƒ½ã«æ¥ç¶šã§ãã‚‹ **ã©ã®æ‹¡å¼µæ©Ÿèƒ½ã‚„ Web ãƒšãƒ¼ã‚¸ãŒæ¥ç¶šã§ãã‚‹ã‹** ã‚’å®£è¨€ã—ã¾ã™ã€‚

- æ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§ **`externally_connectable`** ã‚­ãƒ¼ãŒå®£è¨€ã•ã‚Œã¦ã„ãªã„ã‹ã€**`"ids": ["*"]`** ã¨ã—ã¦å®£è¨€ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**ã™ã¹ã¦ã®æ‹¡å¼µæ©Ÿèƒ½ãŒæ¥ç¶šã§ãã¾ã™ãŒã€Web ãƒšãƒ¼ã‚¸ã¯æ¥ç¶šã§ãã¾ã›ã‚“**ã€‚
- ç‰¹å®šã® ID ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãŸã¨ãˆã° `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]` ã®ã‚ˆã†ã«ã€**ãã‚Œã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿** æ¥ç¶šã§ãã¾ã™ã€‚
- ä¸€è‡´ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚‰ã® Web ã‚¢ãƒ—ãƒªãŒæ¥ç¶šã§ãã¾ã™ï¼š
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* ã‚‚ã—ç©ºã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ: **`"externally_connectable": {}`**ã€ã©ã®ã‚¢ãƒ—ãƒªã‚„ã‚¦ã‚§ãƒ–ã‚‚æ¥ç¶šã§ãã¾ã›ã‚“ã€‚

ã“ã“ã§ç¤ºã•ã‚Œã¦ã„ã‚‹**æ‹¡å¼µæ©Ÿèƒ½ã‚„URLãŒå°‘ãªã„ã»ã©**ã€**æ”»æ’ƒé¢ãŒå°ã•ã**ãªã‚Šã¾ã™ã€‚

{% hint style="danger" %}
ã‚‚ã—**`externally_connectable`**ã§ç¤ºã•ã‚ŒãŸã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ãŒ**XSSã«å¯¾ã—ã¦è„†å¼±**ã§ã‚ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡**ã™ã‚‹ã“ã¨ãŒã§ãã€Content Scriptã¨ãã®CSPã‚’å®Œå…¨ã«ãƒã‚¤ãƒ‘ã‚¹ã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã“ã‚Œã¯**éå¸¸ã«å¼·åŠ›ãªãƒã‚¤ãƒ‘ã‚¹**ã§ã™ã€‚

ã•ã‚‰ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒä¸æ­£ãªæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆã€è„†å¼±ãªæ‹¡å¼µæ©Ÿèƒ½ã¨ã®é€šä¿¡ãŒè¨±å¯ã•ã‚Œã¦ã„ãªãã¦ã‚‚ã€è¨±å¯ã•ã‚ŒãŸã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«**XSSãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥**ã—ãŸã‚Šã€**`WebRequest`**ã‚„**`DeclarativeNetRequest`** APIã‚’æ‚ªç”¨ã—ã¦å¯¾è±¡ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ“ä½œã—ã€ãƒšãƒ¼ã‚¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’**JavaScriptãƒ•ã‚¡ã‚¤ãƒ«**ã«å¤‰æ›´ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆå¯¾è±¡ãƒšãƒ¼ã‚¸ã®CSPãŒã“ã‚Œã‚‰ã®æ”»æ’ƒã‚’é˜²ãå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚ã“ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã¯[**ã“ã®è§£èª¬ã‹ã‚‰æ¥ã¦ã„ã¾ã™**](https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability)ã€‚
{% endhint %}

## é€šä¿¡ã®è¦ç´„

### æ‹¡å¼µæ©Ÿèƒ½ <--> Webã‚¢ãƒ—ãƒª

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸é–“ã§é€šä¿¡ã™ã‚‹ãŸã‚ã«ã¯é€šå¸¸ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯é€šå¸¸ã€**`window.postMessage`** é–¢æ•°ã¸ã®å‘¼ã³å‡ºã—ã‚„ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®ãƒªã‚¹ãƒŠãƒ¼ã§ã‚ã‚‹ **`window.addEventListener`** ã®ã‚ˆã†ãªã‚‚ã®ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚ãŸã ã—ã€æ‹¡å¼µæ©Ÿèƒ½ã¯**ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã« Post Message ã‚’é€ä¿¡ã™ã‚‹**ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆã—ãŸãŒã£ã¦ã€ã‚¦ã‚§ãƒ–ã¯ãã‚Œã‚’æœŸå¾…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€ã¾ãŸã¯å˜ã«ã‚¦ã‚§ãƒ–ã«æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### æ‹¡å¼µæ©Ÿèƒ½å†…éƒ¨

é€šå¸¸ã€**`chrome.runtime.sendMessage`** é–¢æ•°ãŒæ‹¡å¼µæ©Ÿèƒ½å†…ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œï¼ˆé€šå¸¸ã¯`background`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‡¦ç†ã•ã‚Œã¾ã™ï¼‰ã€ãã‚Œã‚’å—ä¿¡ã—ã¦å‡¦ç†ã™ã‚‹ãŸã‚ã«ã¯ã€**`chrome.runtime.onMessage.addListener`** ã‚’å‘¼ã³å‡ºã™ãƒªã‚¹ãƒŠãƒ¼ãŒå®£è¨€ã•ã‚Œã¾ã™ã€‚

ã¾ãŸã€**`chrome.runtime.connect()`** ã‚’ä½¿ç”¨ã—ã¦å˜ä¸€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ä»£ã‚ã‚Šã«æ°¸ç¶šçš„ãªæ¥ç¶šã‚’æŒã¤ã“ã¨ã‚‚å¯èƒ½ã§ã€æ¬¡ã®ä¾‹ã®ã‚ˆã†ã«ãã‚Œã‚’ä½¿ç”¨ã—ã¦**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡**ãŠã‚ˆã³**å—ä¿¡**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<details>

<summary><code>chrome.runtime.connect()</code> ã®ä¾‹</summary>
```javascript
var port = chrome.runtime.connect();

// Listen for messages from the web page
window.addEventListener("message", (event) => {
// Only accept messages from the same window
if (event.source !== window) {
return;
}

// Check if the message type is "FROM_PAGE"
if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage({ type: 'FROM_PAGE', text: event.data.text });
}
}, false);

// Listen for messages from the background script
port.onMessage.addListener(function(msg) {
console.log("Content script received message from background script:", msg);
// Handle the response message from the background script
});
```
</details>

ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ç‰¹å®šã®ã‚¿ãƒ–ã«ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã€**`chrome.tabs.sendMessage`**ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«**ã‚¿ãƒ–ã®ID**ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### æ‹¡å¼µæ©Ÿèƒ½ã¸ã®`externally_connectable`ã‹ã‚‰

`externally_connectable`æ§‹æˆã§è¨±å¯ã•ã‚ŒãŸ**Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½**ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã¾ã™ï¼š
```javascript
chrome.runtime.sendMessage(extensionId, ...
```
## Web **â†”ï¸** Content Script Communication

**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ãŒå‹•ä½œã—ã€ãƒ›ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹ç’°å¢ƒã¯ãŠäº’ã„ã«**åˆ†é›¢**ã•ã‚Œã¦ãŠã‚Šã€**éš”é›¢**ãŒç¢ºä¿ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®éš”é›¢çŠ¶æ…‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ä¸¡è€…ã¯ãƒšãƒ¼ã‚¸ã®**Document Object Model (DOM)** ã¨ã„ã†å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹èƒ½åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ãƒ›ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒ**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ã¨é€šä¿¡ã—ãŸã‚Šã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»‹ã—ã¦é–“æ¥çš„ã«æ‹¡å¼µæ©Ÿèƒ½ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã«ã¯ã€ä¸¡è€…ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãª**DOM**ã‚’é€šä¿¡ãƒãƒ£ãƒãƒ«ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ãƒã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

{% code title="content-script.js" %}
```javascript
// This is like "chrome.runtime.sendMessage" but to maintain the connection
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

ã‚»ã‚­ãƒ¥ã‚¢ãªPost Messageé€šä¿¡ã¯ã€å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿¡é ¼æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™:

* **`event.isTrusted`**: ã“ã®å€¤ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸå ´åˆã«ã®ã¿Trueã§ã™ã€‚
* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸå ´åˆã«ã®ã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœŸå¾…ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
* **ã‚ªãƒªã‚¸ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœŸå¾…ã™ã‚‹ã®ã¯ç‰¹å®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
* æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯éå¸¸ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
* **ã‚½ãƒ¼ã‚¹**: `received_message.source !== window` ã¯ã€Content ScriptãŒãƒªã‚¹ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹**åŒã˜ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

å‰è¿°ã®ãƒã‚§ãƒƒã‚¯ã¯ã€å®Ÿè¡Œã•ã‚Œã¦ã„ã¦ã‚‚è„†å¼±æ€§ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ¬¡ã®ãƒšãƒ¼ã‚¸ã§**æ½œåœ¨çš„ãªPost Messageãƒã‚¤ãƒ‘ã‚¹**ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### Iframe

ã‚‚ã†1ã¤ã®é€šä¿¡æ–¹æ³•ã¯**Iframe URL**ã‚’ä»‹ã—ãŸã‚‚ã®ã§ã™ã€‚ä¾‹ã¯ä»¥ä¸‹ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

ã“ã‚Œã¯å³å¯†ã«ã¯é€šä¿¡æ–¹æ³•ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€**webã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯web DOMã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ãŒãã‚Œã‹ã‚‰æƒ…å ±ã‚’èª­ã¿å–ã£ã¦ã„ã‚‹å ´åˆã€**web DOMã‚’ä¿¡é ¼ã—ã¦ã„ã‚‹**å ´åˆã€webã¯ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’**å¤‰æ›´**ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆwebã¯ä¿¡é ¼ã•ã‚Œã¦ã„ãªã„ã‹ã€XSSã®è„†å¼±æ€§ãŒã‚ã‚‹ãŸã‚ï¼‰ãã—ã¦**Content Scriptã‚’å±é™ºã«ã•ã‚‰ã™**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€**ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’å±é™ºã«ã•ã‚‰ã™DOMãƒ™ãƒ¼ã‚¹ã®XSSã®ä¾‹**ã‚’ä»¥ä¸‹ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Content Script **â†”ï¸** Background Script Communication

Content Scriptã¯ã€[**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **ã¾ãŸã¯** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦**ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ã®JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ãª**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã¾ã™ã€‚

**å¿œç­”**ã‚’å‡¦ç†ã™ã‚‹ã«ã¯ã€è¿”ã•ã‚ŒãŸ**Promise**ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãŸã ã—ã€å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã«ã€æœ€å¾Œã®å¼•æ•°ã¨ã—ã¦**ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯**ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**æ‹¡å¼µæ©Ÿèƒ½**ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ï¼ˆé€šå¸¸ã¯**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ï¼‰ã€‚é¸æŠã—ãŸã‚¿ãƒ–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã®ä¾‹ï¼š
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**å—ä¿¡å´**ã§ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«[**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼**ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„æ‹¡å¼µæ©Ÿèƒ½ãƒšãƒ¼ã‚¸ã‹ã‚‰è¦‹ãŸå ´åˆã«åŒã˜ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
ä¾‹ã§å¼·èª¿ã•ã‚ŒãŸã‚ˆã†ã«ã€**`sendResponse()`** ã¯åŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚`sendResponse()` ã‚’éåŒæœŸã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã« `onMessage` ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€`return true;` ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ãŒé‡è¦ã§ã™ã€‚

é‡è¦ãªè€ƒæ…®äº‹é …ã¨ã—ã¦ã€è¤‡æ•°ã®ãƒšãƒ¼ã‚¸ãŒ `onMessage` ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã™ã‚‹ã‚·ãƒŠãƒªã‚ªã§ã¯ã€ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦æœ€åˆã« `sendResponse()` ã‚’å®Ÿè¡Œã™ã‚‹ãƒšãƒ¼ã‚¸ã ã‘ãŒåŠ¹æœçš„ã«å¿œç­”ã‚’æä¾›ã§ãã¾ã™ã€‚åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®å¾Œç¶šã®å¿œç­”ã¯è€ƒæ…®ã•ã‚Œã¾ã›ã‚“ã€‚

æ–°ã—ã„æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½œæˆã™ã‚‹éš›ã«ã¯ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã¯ãªããƒ—ãƒ­ãƒŸã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¥½ã¾ã—ã„ã§ã™ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ä½¿ç”¨ã«é–¢ã—ã¦ã¯ã€`sendResponse()` é–¢æ•°ã¯ã€åŒæœŸçš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã§ç›´æ¥å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãŒéåŒæœŸæ“ä½œã‚’ç¤ºã™ãŸã‚ã« `true` ã‚’è¿”ã™å ´åˆã«ã®ã¿æœ‰åŠ¹ã¨è¦‹ãªã•ã‚Œã¾ã™ã€‚ãƒãƒ³ãƒ‰ãƒ©ã®ã„ãšã‚Œã‚‚ `true` ã‚’è¿”ã•ãªã„å ´åˆã‚„ã€`sendResponse()` é–¢æ•°ãŒãƒ¡ãƒ¢ãƒªã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸå ´åˆï¼ˆã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ãƒˆã•ã‚ŒãŸå ´åˆï¼‰ã€`sendMessage()` é–¢æ•°ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

## ãƒ¡ãƒ¢ãƒª/ã‚³ãƒ¼ãƒ‰/ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å†…ã®æ©Ÿå¯†æƒ…å ±

ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ãŒ**ãƒ¡ãƒ¢ãƒªå†…ã«æ©Ÿå¯†æƒ…å ±ã‚’ä¿å­˜**ã—ã¦ã„ã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®æƒ…å ±ã¯ï¼ˆç‰¹ã«Windowsãƒã‚·ãƒ³ã§ï¼‰**ãƒ€ãƒ³ãƒ—**ã•ã‚Œã€ã“ã®æƒ…å ±ã‚’**æ¤œç´¢**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ¡ãƒ¢ãƒªã¯**å®‰å…¨ã§ã¯ãªã„**ã¨è¦‹ãªã•ã‚Œã€è³‡æ ¼æƒ…å ±ã‚„ãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ã‚ºãªã©ã®**æ©Ÿå¯†æƒ…å ±ã¯ä¿å­˜ã•ã‚Œã¦ã¯ã„ã‘ã¾ã›ã‚“**ã€‚

ã‚‚ã¡ã‚ã‚“ã€ã‚³ãƒ¼ãƒ‰ã«æ©Ÿå¯†æƒ…å ±ã‚’å…¥ã‚Œãªã„ã§ãã ã•ã„ã€‚ãã‚Œã¯**å…¬é–‹**ã•ã‚Œã¾ã™ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã«ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã‹ã€ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®šã«ç§»å‹•ã—ã¦**`Inspect pop-up`**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€**`Memory`**ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§**`Take a snaphost`**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå†…ã§æ©Ÿå¯†æƒ…å ±ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«**`CTRL+F`**ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€ãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ã‚­ãƒ¼ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã®éå¸¸ã«æ©Ÿå¯†æ€§ã®é«˜ã„æƒ…å ±ã¯ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‚’è¨±å¯ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆã¾ãŸã¯å°‘ãªãã¨ã‚‚æ•°ç§’å¾Œã«ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€ãªãœãªã‚‰ã°ãã®å¾Œã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚’ç›£è¦–ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒãã‚Œã‚‰ã‚’å–å¾—ã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚

## ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æ‹¡å¼µæ©Ÿèƒ½ã®èª­ã¿è¾¼ã¿

1. ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ã¦è§£å‡ã—ã¾ã™
2. **`chrome://extensions/`** ã«ç§»å‹•ã—ã€`Developer Mode`ã‚’**æœ‰åŠ¹**ã«ã—ã¾ã™
3. **`Load unpacked`** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™

**Firefox**ã§ã¯ã€**`about:debugging#/runtime/this-firefox`** ã«ç§»å‹•ã—ã€**`Load Temporary Add-on`** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

## ã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹

Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã•ã¾ã–ã¾ãªæ–¹æ³•ã§å–å¾—ã§ãã¾ã™ã€‚ä»¥ä¸‹ã«å„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ãªèª¬æ˜ã¨æ‰‹é †ã‚’ç¤ºã—ã¾ã™ã€‚

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ZIPå½¢å¼ã§æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ZIPãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ã€`curl`ã‚’ä½¿ç”¨ã—ã¦ç‰¹å®šã®URLã‹ã‚‰ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å±•é–‹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯æ‰‹é †ã§ã™ï¼š

1. `"extension_id"` ã‚’å®Ÿéš›ã®æ‹¡å¼µæ©Ÿèƒ½ã®IDã«ç½®ãæ›ãˆã¾ã™ã€‚
2. æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### CRX Viewer ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’ä½¿ç”¨ã™ã‚‹

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### CRX Viewer æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹

ã‚‚ã†1ã¤ã®ä¾¿åˆ©ãªæ–¹æ³•ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ Chrome æ‹¡å¼µæ©Ÿèƒ½ã‚½ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚[Chrome Web ã‚¹ãƒˆã‚¢](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚ãƒ“ãƒ¥ãƒ¼ã‚¢ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã€[GitHub ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/Rob--W/crxviewer)ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

### ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹

ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ Chrome æ‹¡å¼µæ©Ÿèƒ½ã‚‚æ¤œæŸ»ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã„ã¾ã™ï¼š

1. `chrome://version/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€"Profile Path" ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã¤ã‘ã¦ Chrome ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
2. ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® `Extensions/` ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™ã€‚
3. ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã¯ã€é€šå¸¸ã€èª­ã¿ã‚„ã™ã„å½¢å¼ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

æ‹¡å¼µæ©Ÿèƒ½ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã«ã€ãã‚Œã‚‰ã® ID ã‚’åå‰ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã¾ã™ï¼š

* `about:extensions` ãƒšãƒ¼ã‚¸ã§ã€Œé–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹ã«ã—ã¦ã€å„æ‹¡å¼µæ©Ÿèƒ½ã® ID ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
* å„æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚‹ `manifest.json` ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ã‚’è­˜åˆ¥ã™ã‚‹ã®ã«å½¹ç«‹ã¤èª­ã¿ã‚„ã™ã„ `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒã¾ãŸã¯ã‚¢ãƒ³ãƒ‘ãƒƒã‚«ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹

Chrome Web ã‚¹ãƒˆã‚¢ã«ç§»å‹•ã—ã¦ã€æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯ `.crx` ã«ãªã‚Šã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ `.crx` ã‹ã‚‰ `.zip` ã«å¤‰æ›´ã—ã¾ã™ã€‚ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒï¼ˆWinRARã€7-Zip ãªã©ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

### Chrome ã§é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹

Chrome ã‚’é–‹ã„ã¦ `chrome://extensions/` ã«ç§»å‹•ã—ã¾ã™ã€‚å³ä¸Šã®ã€Œé–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚"ã‚¢ãƒ³ãƒ‘ãƒƒã‚¯ã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€" ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã›ã‚“ãŒã€ã™ã§ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚Šé–‹ç™ºã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºãŠã‚ˆã³å¤‰æ›´ã™ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã€‚

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã¯ **æ”»æ’ƒé¢ãŒé™ã‚‰ã‚Œã¦ã„ã¾ã™** ãŒã€ä¸€éƒ¨ã«ã¯ **è„†å¼±æ€§** ã‚„ **æ½œåœ¨çš„ãªå¼·åŒ–æ”¹å–„** ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯æœ€ã‚‚ä¸€èˆ¬çš„ãªã‚‚ã®ã§ã™ï¼š

* [ ] **è¦æ±‚ã•ã‚Œã‚‹ `permissions` ã‚’ã§ãã‚‹ã ã‘åˆ¶é™ã™ã‚‹**
* [ ] **`host_permissions` ã‚’ã§ãã‚‹ã ã‘åˆ¶é™ã™ã‚‹**
* **`content_security_policy` ã‚’å¼·åŒ–ã™ã‚‹**
* [ ] **`externally_connectable` ã‚’ã§ãã‚‹ã ã‘åˆ¶é™ã™ã‚‹**ã€‚å¿…è¦ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ®‹ã•ãšã€`{}` ã‚’æŒ‡å®šã—ã¾ã™ã€‚
* [ ] ã“ã“ã§ **XSS ã¾ãŸã¯ä¹—ã£å–ã‚Šã«è„†å¼±ãª URL** ãŒè¨€åŠã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡** ã§ãã¾ã™ã€‚éå¸¸ã«å¼·åŠ›ãªãƒã‚¤ãƒ‘ã‚¹ã§ã™ã€‚
* [ ] **`web_accessible_resources` ã‚’ã§ãã‚‹ã ã‘åˆ¶é™ã™ã‚‹**ã€‚å¯èƒ½ã§ã‚ã‚Œã°ç©ºã«ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚
* [ ] ã‚‚ã— **`web_accessible_resources` ãŒãªã„å ´åˆ**ã€[**ClickJacking**](browext-clickjacking.md) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™
* [ ] æ‹¡å¼µæ©Ÿèƒ½ã‹ã‚‰ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¸ã® **é€šä¿¡** ãŒç™ºç”Ÿã™ã‚‹å ´åˆã€é€šä¿¡ä¸­ã«å¼•ãèµ·ã“ã•ã‚Œã‚‹ [**XSS ã®è„†å¼±æ€§**](browext-xss-example.md) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
* [ ] Post Messages ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€[**Post Message ã®è„†å¼±æ€§**](../postmessage-vulnerabilities/) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
* [ ] **Content Script ãŒ DOM è©³ç´°ã«ã‚¢ã‚¯ã‚»ã‚¹** ã™ã‚‹å ´åˆã€ãã‚Œã‚‰ãŒã‚¦ã‚§ãƒ–ã«ã‚ˆã£ã¦ **å¤‰æ›´** ã•ã‚Œã‚‹ã¨ XSS ã‚’å°å…¥ã—ã¦ã„ãªã„ã‹ç¢ºèªã—ã¾ã™ã€‚
* [ ] ã“ã®é€šä¿¡ãŒ **Content Script -> Background script é€šä¿¡** ã«ã‚‚é–¢ä¸ã—ã¦ã„ã‚‹å ´åˆã€ç‰¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
* [ ] ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®ä¸­ã« **æ©Ÿå¯†æƒ…å ±ã‚’ä¿å­˜** ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“
* [ ] ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®ä¸­ã« **æ©Ÿå¯†æƒ…å ±ã‚’ä¿å­˜** ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“

## ãƒ„ãƒ¼ãƒ«

### [**Tarnish**](https://thehackerblog.com/tarnish/)

* æä¾›ã•ã‚ŒãŸ Chrome Web ã‚¹ãƒˆã‚¢ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ä»»æ„ã® Chrome æ‹¡å¼µæ©Ÿèƒ½ã‚’å–å¾—ã—ã¾ã™ã€‚
* [**manifest.json**](https://developer.chrome.com/extensions/manifest) **ãƒ“ãƒ¥ãƒ¼ã‚¢**ï¼šæ‹¡å¼µæ©Ÿèƒ½ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã® JSON ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç°¡å˜ã«è¡¨ç¤ºã—ã¾ã™ã€‚
* **ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆè§£æ**ï¼š[web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ã®æ¤œå‡ºãŠã‚ˆã³ Chrome æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ JavaScript ã®è‡ªå‹•ç”Ÿæˆã€‚
* **æ½œåœ¨çš„ãª Clickjacking è§£æ**ï¼š[web\_accessible\_resources](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒè¨­å®šã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ HTML ãƒšãƒ¼ã‚¸ã®æ¤œå‡ºã€‚ã“ã‚Œã‚‰ã¯ãƒšãƒ¼ã‚¸ã®ç›®çš„ã«å¿œã˜ã¦ Clickjacking ã®è„†å¼±æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* **è¨±å¯è­¦å‘Šãƒ“ãƒ¥ãƒ¼ã‚¢**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã™ã¹ã¦ã® Chrome è¨±å¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè­¦å‘Šã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
* **å±é™ºãªæ©Ÿèƒ½**ï¼šæ”»æ’ƒè€…ã«ã‚ˆã£ã¦æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å±é™ºãªæ©Ÿèƒ½ã®å ´æ‰€ã‚’è¡¨ç¤ºã—ã¾ã™ï¼ˆãŸã¨ãˆã°ã€innerHTMLã€chrome.tabs.executeScript ãªã©ã®æ©Ÿèƒ½ï¼‰ã€‚
* **ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ**ï¼šæ‹¡å¼µæ©Ÿèƒ½ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼/å¤–éƒ¨å…¥åŠ›ã‚’å—ã‘å…¥ã‚Œã‚‹å ´æ‰€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã‚Œã¯æ‹¡å¼µæ©Ÿèƒ½ã®è¡¨é¢ç©ã‚’ç†è§£ã—ã€æ‚ªæ„ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ‹¡å¼µæ©Ÿèƒ½ã«é€ä¿¡ã™ã‚‹æ½œåœ¨çš„ãªãƒã‚¤ãƒ³ãƒˆã‚’æ¢ã™ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
* å±é™ºãªæ©Ÿèƒ½ã¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã«ã¯ã€æ¬¡ã®ã‚‚ã®ãŒç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ©ãƒ¼ãƒˆã«å«ã¾ã‚Œã¾ã™ï¼š
* ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¼•ãèµ·ã“ã—ãŸé–¢é€£ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã¨è¡Œã€‚
* å•é¡Œã®èª¬æ˜ã€‚
* ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¼•ãèµ·ã“ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã€‚
* ã‚¢ãƒ©ãƒ¼ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã€‚
* ã‚¢ãƒ©ãƒ¼ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å®Œå…¨ãª Chrome æ‹¡å¼µæ©Ÿèƒ½ URIã€‚
* JavaScript ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«è„†å¼±ãªè¡ŒãŒã‚ã‚‹å ´åˆã€ãã‚ŒãŒå«ã¾ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã¨ã€ã“ã‚Œã‚‰ã®ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒ—ã€[web\_accessible\_resource](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€‚
* **Content Security Policy (CSP) ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ãŠã‚ˆã³ãƒã‚¤ãƒ‘ã‚¹ãƒã‚§ãƒƒã‚«ãƒ¼**ï¼šæ‹¡å¼µæ©Ÿèƒ½ã® CSP ã®å¼±ç‚¹ã‚’æŒ‡æ‘˜ã—ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚ŒãŸ CDN ãªã©ã«ã‚ˆã‚‹ CSP ã®ãƒã‚¤ãƒ‘ã‚¹æ–¹æ³•ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚
* **æ—¢çŸ¥ã®è„†å¼±ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ï¼š[Retire.js](https://retirejs.github.io/retire.js/) ã‚’ä½¿ç”¨ã—ã¦æ—¢çŸ¥ã®è„†å¼±ãª JavaScript ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
* æ‹¡å¼µæ©Ÿèƒ½ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
* ã‚ªãƒªã‚¸ãƒŠãƒ«ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
* æ‹¡å¼µæ©Ÿèƒ½ã®æ•´å½¢ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆè‡ªå‹•æ•´å½¢ã•ã‚ŒãŸ HTML ãŠã‚ˆã³ JavaScriptï¼‰ã€‚
* ã‚¹ã‚­ãƒ£ãƒ³çµæœã®è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–ã€‚æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æœ€åˆã®å®Ÿè¡Œã«ã¯ã‹ãªã‚Šã®æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ãŒã€2å›ç›®ä»¥é™ã¯ã€æ‹¡å¼µæ©Ÿèƒ½ãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„é™ã‚Šã€çµæœãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã»ã¼å³åº§ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* ãƒ¬ãƒãƒ¼ãƒˆã® URL ã‚’ãƒªãƒ³ã‚¯ã§ãã‚‹ã‚ˆã†ã«ã—ã€Tarnish ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ãƒ¬ãƒãƒ¼ãƒˆã‚’ä»–ã®äººã«ç°¡å˜ã«ãƒªãƒ³ã‚¯ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

### [Neto](https://github.com/elevenpaths/neto)

Project Neto ã¯ã€Firefox ã‚„ Chrome ãªã©ã®ã‚ˆãçŸ¥ã‚‰ã‚ŒãŸãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„æ‹¡å¼µæ©Ÿèƒ½ã®éš ã‚ŒãŸæ©Ÿèƒ½ã‚’åˆ†æã—è§£æ˜ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸ Python 3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã—ã¦ã€`manifest.json`ã€ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ«ãƒ€ã€JavaScriptã€ãŠã‚ˆã³ HTML ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’æŠ½å‡ºã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* ã“ã®æ–¹æ³•è«–ã®æ”¯æ´ã«æ„Ÿè¬ã—ã¾ã™ [**@naivenom**](https://twitter.com/naivenom)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)
* [https://palant.info/2022/08/10/anatomy-of-a-basic-extension/](https://palant.info/2022/08/10/anatomy-of-a-basic-extension/)
* [https://palant.info/2022/08/24/attack-surface-of-extension-pages/](https://palant.info/2022/08/24/attack-surface-of-extension-pages/)
* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://help.passbolt.com/assets/files/PBL-02-report.pdf](https://help.passbolt.com/assets/files/PBL-02-report.pdf)
* [https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts](https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts)
* [https://developer.chrome.com/docs/extensions/mv2/background-pages](https://developer.chrome.com/docs/extensions/mv2/background-pages)
* [https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/](https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/)
* [https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0](https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0)

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã® AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:
* ã‚‚ã—**HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**ã‹**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**
