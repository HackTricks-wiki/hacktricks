# Encabezados hop-by-hop

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres que tu **empresa sea anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n la [**ropa oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

**Este es un resumen del post [https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)**

Los encabezados hop-by-hop son especÃ­ficos de una Ãºnica conexiÃ³n a nivel de transporte, utilizados principalmente en HTTP/1.1 para gestionar datos entre dos nodos (como cliente-proxy o proxy-proxy), y no estÃ¡n destinados a ser reenviados. Los encabezados hop-by-hop estÃ¡ndar incluyen `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` y `Proxy-Authenticate`, segÃºn lo definido en [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Encabezados adicionales pueden designarse como hop-by-hop a travÃ©s del encabezado `Connection`.

### Abuso de Encabezados Hop-by-Hop
La gestiÃ³n incorrecta de los encabezados hop-by-hop por parte de los proxies puede llevar a problemas de seguridad. Si bien se espera que los proxies eliminen estos encabezados, no todos lo hacen, lo que crea posibles vulnerabilidades.

### Pruebas de Manejo de Encabezados Hop-by-Hop
El manejo de los encabezados hop-by-hop se puede probar observando los cambios en las respuestas del servidor cuando se marcan ciertos encabezados como hop-by-hop. Herramientas y scripts pueden automatizar este proceso, identificando cÃ³mo los proxies gestionan estos encabezados y potencialmente descubriendo configuraciones incorrectas o comportamientos de proxy.

El abuso de los encabezados hop-by-hop puede tener diversas implicaciones de seguridad. A continuaciÃ³n se presentan un par de ejemplos que demuestran cÃ³mo estos encabezados pueden manipularse para posibles ataques:

### Saltarse los Controles de Seguridad con `X-Forwarded-For`
Un atacante puede manipular el encabezado `X-Forwarded-For` para evadir los controles de acceso basados en IP. Este encabezado suele ser utilizado por los proxies para rastrear la direcciÃ³n IP de origen de un cliente. Sin embargo, si un proxy trata este encabezado como hop-by-hop y lo reenvÃ­a sin una validaciÃ³n adecuada, un atacante puede falsificar su direcciÃ³n IP.

**Escenario de Ataque:**
1. El atacante envÃ­a una solicitud HTTP a una aplicaciÃ³n web detrÃ¡s de un proxy, incluyendo una direcciÃ³n IP falsa en el encabezado `X-Forwarded-For`.
2. El atacante tambiÃ©n incluye el encabezado `Connection: close, X-Forwarded-For`, lo que hace que el proxy trate `X-Forwarded-For` como hop-by-hop.
3. El proxy mal configurado reenvÃ­a la solicitud a la aplicaciÃ³n web sin el encabezado falsificado `X-Forwarded-For`.
4. La aplicaciÃ³n web, al no ver el encabezado original `X-Forwarded-For`, podrÃ­a considerar la solicitud como proveniente directamente de un proxy de confianza, lo que potencialmente permite el acceso no autorizado.

### Envenenamiento de CachÃ© mediante la InyecciÃ³n de Encabezados Hop-by-Hop
Si un servidor de cachÃ© almacena incorrectamente contenido basado en encabezados hop-by-hop, un atacante podrÃ­a inyectar encabezados maliciosos para envenenar la cachÃ©. Esto servirÃ­a contenido incorrecto o malicioso a los usuarios que soliciten el mismo recurso.

**Escenario de Ataque:**
1. Un atacante envÃ­a una solicitud a una aplicaciÃ³n web con un encabezado hop-by-hop que no deberÃ­a ser almacenado en cachÃ© (por ejemplo, `Connection: close, Cookie`).
2. El servidor de cachÃ© mal configurado no elimina el encabezado hop-by-hop y almacena la respuesta especÃ­fica de la sesiÃ³n del atacante.
3. Los usuarios futuros que soliciten el mismo recurso reciben la respuesta en cachÃ©, que fue adaptada para el atacante, lo que podrÃ­a llevar al secuestro de sesiÃ³n o la exposiciÃ³n de informaciÃ³n sensible.

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> - <a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres que tu **empresa sea anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n la [**ropa oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al [repositorio de hacktricks](https://github.com/carlospolop/hacktricks) y al [repositorio de hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
