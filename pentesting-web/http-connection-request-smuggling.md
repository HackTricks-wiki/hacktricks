# HTTP Connection Request Smuggling

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* 驴Trabajas en una **empresa de ciberseguridad**? 驴Quieres ver tu **empresa anunciada en HackTricks**? 驴O quieres tener acceso a la **煤ltima versi贸n del PEASS o descargar HackTricks en PDF**? 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **nete al** [****](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter** [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Este es un resumen del post** [**https://portswigger.net/research/browser-powered-desync-attacks**](https://portswigger.net/research/browser-powered-desync-attacks)

## Ataques de Manipulaci贸n del Estado de Conexi贸n <a href="#state" id="state"></a>

### Validaci贸n de la Primera Solicitud

Al enrutar solicitudes, los servidores proxy inversos pueden depender del **encabezado Host** para determinar el servidor de destino en el backend, a menudo confiando en una lista blanca de hosts que tienen acceso permitido. Sin embargo, existe una vulnerabilidad en algunos servidores proxy donde la lista blanca solo se aplica en la solicitud inicial de una conexi贸n. En consecuencia, los atacantes podr铆an explotar esto primero realizando una solicitud a un host permitido y luego solicitando un sitio interno a trav茅s de la misma conexi贸n:
```
GET / HTTP/1.1
Host: [allowed-external-host]

GET / HTTP/1.1
Host: [internal-host]
```
### Enrutamiento de la primera solicitud

En algunas configuraciones, un servidor frontal puede usar el **encabezado Host de la primera solicitud** para determinar el enrutamiento del servidor de destino para esa solicitud, y luego enrutar de manera persistente todas las solicitudes posteriores desde la misma conexi贸n del cliente a la misma conexi贸n del servidor de destino. Esto se puede demostrar de la siguiente manera:
```
GET / HTTP/1.1
Host: example.com

POST /pwreset HTTP/1.1
Host: psres.net
```
Este problema potencialmente se puede combinar con [ataques de encabezado de host](https://portswigger.net/web-security/host-header), como envenenamiento de restablecimiento de contrase帽a o [envenenamiento de cach茅 web](https://portswigger.net/web-security/web-cache-poisoning), para explotar otras vulnerabilidades o obtener acceso no autorizado a hosts virtuales adicionales.

{% hint style="info" %}
Para identificar estas vulnerabilidades, se puede utilizar la funci贸n 'sonda de estado de conexi贸n' en HTTP Request Smuggler.
{% endhint %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* 驴Trabajas en una **empresa de ciberseguridad**? 驴Quieres ver tu **empresa anunciada en HackTricks**? 驴O quieres tener acceso a la **煤ltima versi贸n del PEASS o descargar HackTricks en PDF**? 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **nete al** [****](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter** [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
