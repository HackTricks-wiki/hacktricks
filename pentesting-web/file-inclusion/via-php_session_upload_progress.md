# PHP\_SESSION\_UPLOAD\_PROGRESSã‚’ä»‹ã—ãŸLFI2RCE

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

### åŸºæœ¬æƒ…å ±

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„**å ´åˆã§ã‚‚ã€**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€`session.auto_start`ãŒ`Off`ã§ã‚ã£ã¦ã‚‚ã€**`session.upload_progress.enabled`**ãŒ**`On`**ã§ã‚ã‚Šã€**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’**ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆPOST**ãƒ‡ãƒ¼ã‚¿ã§æä¾›ã™ã‚‹ã¨ã€PHPã¯**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¾ã™**ã€‚
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€åˆ¶å¾¡å¯èƒ½ãªéƒ¨åˆ†ï¼ˆãŸã¨ãˆã°ã€PHPã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="info" %}
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã»ã¨ã‚“ã©ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€ãƒ‡ãƒãƒƒã‚°ç›®çš„ã§`session.upload_progress.cleanup`ã‚’`Off`ã«è¨­å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€PHPã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`session.upload_progress.cleanup`ã¯ã¾ã `On`ã§ã™ã€‚ã¤ã¾ã‚Šã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²è¡ŒçŠ¶æ³ã¯ã§ãã‚‹ã ã‘æ—©ãã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã¯**ç«¶åˆçŠ¶æ…‹**ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

### CTF

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹[**å…ƒã®CTF**](https://blog.orange.tw/2018/10/)ã§ã¯ã€ç«¶åˆçŠ¶æ…‹ã‚’æ‚ªç”¨ã™ã‚‹ã ã‘ã§ã¯ååˆ†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯`@<?php`ã¨ã„ã†æ–‡å­—åˆ—ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

`session.upload_progress.prefix`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«ã‚ˆã‚Šã€**SESSIONãƒ•ã‚¡ã‚¤ãƒ«ã¯`upload_progress_`ã¨ã„ã†å„ä»‹ãªæ¥é ­è¾ã§å§‹ã¾ã‚Šã¾ã™**ã€‚ä¾‹ãˆã°ï¼š`upload_progress_controlledcontentbyattacker`

åˆæœŸã®æ¥é ­è¾ã‚’**å‰Šé™¤ã™ã‚‹ãƒˆãƒªãƒƒã‚¯**ã¯ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’**3å›ãƒ™ãƒ¼ã‚¹64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**ã—ã€`convert.base64-decode`ãƒ•ã‚£ãƒ«ã‚¿ã‚’ä»‹ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã—ãŸã€‚ã“ã‚Œã¯ã€**ãƒ™ãƒ¼ã‚¹64ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã«PHPãŒå¥‡å¦™ãªæ–‡å­—ã‚’å‰Šé™¤**ã™ã‚‹ãŸã‚ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€3å›ç›®ã®ãƒ™ãƒ¼ã‚¹64ãƒ‡ã‚³ãƒ¼ãƒ‰å¾Œã«ã¯ã€æ”»æ’ƒè€…ãŒ**é€ä¿¡ã—ãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ã¿ãŒæ®‹ã‚Šã¾ã™**ï¼ˆãã—ã¦æ”»æ’ƒè€…ã¯åˆæœŸã®éƒ¨åˆ†ã‚’åˆ¶å¾¡ã§ãã¾ã™ï¼‰ã€‚

è©³ç´°ãªæƒ…å ±ã¯ã€å…ƒã®è§£èª¬[https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/)ã¨æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ[https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)ã§å…¥æ‰‹ã§ãã¾ã™ã€‚ã¾ãŸã€[https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)ã«ã‚‚åˆ¥ã®è§£èª¬ãŒã‚ã‚Šã¾ã™ã€‚

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã—ãŸã„ã§ã™ã‹ï¼Ÿ** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
