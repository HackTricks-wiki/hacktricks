# InjeÃ§Ã£o de Unicode

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## IntroduÃ§Ã£o

Dependendo de como o back-end/front-end estÃ¡ se comportando quando **recebe caracteres Unicode estranhos**, um invasor pode ser capaz de **burlar proteÃ§Ãµes e injetar caracteres arbitrÃ¡rios** que poderiam ser usados para **explorar vulnerabilidades de injeÃ§Ã£o** como XSS ou SQLi.

## NormalizaÃ§Ã£o Unicode

A normalizaÃ§Ã£o Unicode ocorre quando os **caracteres Unicode sÃ£o normalizados para caracteres ASCII**.

Um cenÃ¡rio comum desse tipo de vulnerabilidade ocorre quando o sistema estÃ¡ **modificando** de alguma forma a **entrada** do usuÃ¡rio **depois de tÃª-la verificado**. Por exemplo, em alguns idiomas, uma simples chamada para tornar a **entrada maiÃºscula ou minÃºscula** pode normalizar a entrada fornecida e o **Unicode serÃ¡ transformado em ASCII** gerando novos caracteres.\
Para mais informaÃ§Ãµes, consulte:

{% content-ref url="unicode-normalization.md" %}
[unicode-normalization.md](unicode-normalization.md)
{% endcontent-ref %}

## `\u` para `%`

Os caracteres Unicode sÃ£o geralmente representados com o prefixo **`\u`**. Por exemplo, o caractere `ã±‹` Ã© `\u3c4b`([verifique aqui](https://unicode-explorer.com/c/3c4B)). Se um back-end **transforma** o prefixo **`\u` em `%`**, a string resultante serÃ¡ `%3c4b`, que decodificada por URL Ã©: **`<4b`**. E, como vocÃª pode ver, um **caractere `<` Ã© injetado**.\
VocÃª pode usar essa tÃ©cnica para **injetar qualquer tipo de caractere** se o back-end for vulnerÃ¡vel.\
Verifique [https://unicode-explorer.com/](https://unicode-explorer.com/) para encontrar os caracteres de que vocÃª precisa.

Essa vulnerabilidade na verdade vem de uma vulnerabilidade que um pesquisador encontrou, para uma explicaÃ§Ã£o mais detalhada, verifique [https://www.youtube.com/watch?v=aUsAHb0E7Cg](https://www.youtube.com/watch?v=aUsAHb0E7Cg)

## InjeÃ§Ã£o de Emoji

Os back-ends Ã s vezes se comportam de maneira estranha quando **recebem emojis**. Foi o que aconteceu neste [**writeup**](https://medium.com/@fpatrik/how-i-found-an-xss-vulnerability-via-using-emojis-7ad72de49209) onde o pesquisador conseguiu alcanÃ§ar um XSS com um payload como: `ğŸ’‹img src=x onerror=alert(document.domain)//ğŸ’›`

Neste caso, o erro foi que o servidor, apÃ³s remover os caracteres maliciosos, **converteu a string UTF-8 de Windows-1252 para UTF-8** (basicamente a codificaÃ§Ã£o de entrada e a conversÃ£o de codificaÃ§Ã£o nÃ£o correspondiam). EntÃ£o, isso nÃ£o dÃ¡ um < apropriado, apenas um Unicode estranho: `â€¹`\
``EntÃ£o eles pegaram essa saÃ­da e **converteram novamente agora de UTF-8 para ASCII**. Isso **normalizou** o `â€¹` para `<` e Ã© assim que o exploit poderia funcionar nesse sistema.\
Isso Ã© o que aconteceu:
```php
<?php

$str = isset($_GET["str"]) ? htmlspecialchars($_GET["str"]) : "";

$str = iconv("Windows-1252", "UTF-8", $str);
$str = iconv("UTF-8", "ASCII//TRANSLIT", $str);

echo "String: " . $str;
```
Listas de emojis:

* [https://github.com/iorch/jakaton\_feminicidios/blob/master/data/emojis.csv](https://github.com/iorch/jakaton\_feminicidios/blob/master/data/emojis.csv)
* [https://unicode.org/emoji/charts-14.0/full-emoji-list.html](https://unicode.org/emoji/charts-14.0/full-emoji-list.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de ciberseguranÃ§a**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [repositÃ³rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
