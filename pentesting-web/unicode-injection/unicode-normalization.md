# Normalizaci贸n Unicode

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b煤squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares de robo**.

El objetivo principal de WhiteIntel es combatir los secuestros de cuentas y los ataques de ransomware resultantes de malwares que roban informaci贸n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

---

**Este es un resumen de:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Consulta para m谩s detalles (im谩genes tomadas de all铆).

## Comprendiendo Unicode y Normalizaci贸n

La normalizaci贸n Unicode es un proceso que asegura que diferentes representaciones binarias de caracteres se estandaricen al mismo valor binario. Este proceso es crucial para tratar cadenas en programaci贸n y procesamiento de datos. El est谩ndar Unicode define dos tipos de equivalencia de caracteres:

1. **Equivalencia Can贸nica**: Los caracteres se consideran equivalentes can贸nicamente si tienen la misma apariencia y significado al ser impresos o mostrados.
2. **Equivalencia de Compatibilidad**: Una forma m谩s d茅bil de equivalencia donde los caracteres pueden representar el mismo car谩cter abstracto pero mostrarse de manera diferente.

Existen **cuatro algoritmos de normalizaci贸n Unicode**: NFC, NFD, NFKC y NFKD. Cada algoritmo emplea t茅cnicas de normalizaci贸n can贸nica y de compatibilidad de manera diferente. Para una comprensi贸n m谩s profunda, puedes explorar estas t茅cnicas en [Unicode.org](https://unicode.org/).

### Puntos Clave sobre la Codificaci贸n Unicode

Comprender la codificaci贸n Unicode es fundamental, especialmente al tratar problemas de interoperabilidad entre diferentes sistemas o lenguajes. Aqu铆 est谩n los puntos principales:

* **Puntos de C贸digo y Caracteres**: En Unicode, a cada car谩cter o s铆mbolo se le asigna un valor num茅rico conocido como "punto de c贸digo".
* **Representaci贸n en Bytes**: El punto de c贸digo (o car谩cter) se representa por uno o m谩s bytes en memoria. Por ejemplo, los caracteres LATIN-1 (comunes en pa铆ses de habla inglesa) se representan usando un byte. Sin embargo, los idiomas con un conjunto m谩s grande de caracteres necesitan m谩s bytes para la representaci贸n.
* **Codificaci贸n**: Este t茅rmino se refiere a c贸mo los caracteres se transforman en una serie de bytes. UTF-8 es un est谩ndar de codificaci贸n prevalente donde los caracteres ASCII se representan usando un byte, y hasta cuatro bytes para otros caracteres.
* **Procesamiento de Datos**: Los sistemas que procesan datos deben ser conscientes de la codificaci贸n utilizada para convertir correctamente el flujo de bytes en caracteres.
* **Variantes de UTF**: Adem谩s de UTF-8, existen otros est谩ndares de codificaci贸n como UTF-16 (usando un m铆nimo de 2 bytes, hasta 4) y UTF-32 (usando 4 bytes para todos los caracteres).

Es crucial comprender estos conceptos para manejar y mitigar eficazmente los problemas potenciales derivados de la complejidad de Unicode y sus diversos m茅todos de codificaci贸n.

Un ejemplo de c贸mo Unicode normaliza dos bytes diferentes que representan el mismo car谩cter:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Una lista de caracteres equivalentes Unicode se puede encontrar aqu铆:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) y [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Descubrimiento

Si encuentras dentro de una aplicaci贸n web un valor que se est谩 devolviendo, podr铆as intentar enviar el **'SIGNO DE KELVIN' (U+0212A)** que se **normaliza a "K"** (puedes enviarlo como `%e2%84%aa`). **Si se devuelve un "K"**, entonces se est谩 realizando alg煤n tipo de **normalizaci贸n Unicode**.

Otro **ejemplo**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` despu茅s de la **normalizaci贸n Unicode** es `Leonishan`.

## **Ejemplos Vulnerables**

### **Burla del filtro de Inyecci贸n SQL**

Imagina una p谩gina web que utiliza el car谩cter `'` para crear consultas SQL con la entrada del usuario. Esta web, como medida de seguridad, **elimina** todas las ocurrencias del car谩cter **`'`** de la entrada del usuario, pero **despu茅s de esa eliminaci贸n** y **antes de la creaci贸n** de la consulta, **normaliza** utilizando **Unicode** la entrada del usuario.

Entonces, un usuario malintencionado podr铆a insertar un car谩cter Unicode diferente equivalente a `' (0x27)` como `%ef%bc%87`, cuando la entrada se normaliza, se crea una comilla simple y aparece una **vulnerabilidad de Inyecci贸n SQL**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (699).png>)

**Algunos caracteres Unicode interesantes**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### Plantilla sqlmap

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Puedes usar uno de los siguientes caracteres para enga帽ar a la aplicaci贸n web y explotar un XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Ten en cuenta que, por ejemplo, el primer car谩cter Unicode propuesto puede ser enviado como: `%e2%89%ae` o como `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing de Regexes

Cuando el backend est谩 **verificando la entrada del usuario con una regex**, podr铆a ser posible que la **entrada** se est茅 **normalizando** para la **regex** pero **no** para donde se est谩 **utilizando**. Por ejemplo, en una Redirecci贸n Abierta o SSRF la regex podr铆a estar **normalizando la URL enviada** pero luego **accedi茅ndola tal cual**.

La herramienta [**recollapse**](https://github.com/0xacb/recollapse) permite **generar variaciones de la entrada** para fuzzear el backend. Para m谩s informaci贸n, revisa el **github** y este [**post**](https://0xacb.com/2022/11/21/recollapse/).

## Referencias

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b煤squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares de robo**.

El objetivo principal de WhiteIntel es combatir los secuestros de cuentas y los ataques de ransomware resultantes de malwares que roban informaci贸n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
