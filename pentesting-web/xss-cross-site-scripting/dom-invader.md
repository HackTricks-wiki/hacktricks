# DOM Invader

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DOM Invader

DOM Invader es una herramienta de navegador instalada en el navegador integrado de Burp. Ayuda a **detectar vulnerabilidades de XSS en el DOM** utilizando varias fuentes y sumideros, incluyendo mensajes web y contaminaciÃ³n de prototipos. La herramienta estÃ¡ preinstalada como una extensiÃ³n.

DOM Invader integra una pestaÃ±a dentro del panel de DevTools del navegador que permite lo siguiente:

1. **IdentificaciÃ³n de sumideros controlables** en una pÃ¡gina web para pruebas de XSS en el DOM, proporcionando detalles de contexto y de saneamiento.
2. **Registro, ediciÃ³n y reenvÃ­o de mensajes web** enviados a travÃ©s del mÃ©todo `postMessage()` para pruebas de XSS en el DOM. DOM Invader tambiÃ©n puede detectar automÃ¡ticamente vulnerabilidades utilizando mensajes web especialmente diseÃ±ados.
3. DetecciÃ³n de **fuentes de contaminaciÃ³n de prototipos del lado del cliente** y escaneo de dispositivos controlables enviados a sumideros riesgosos.
4. IdentificaciÃ³n de **vulnerabilidades de clobbering del DOM**.

### Habilitar

En el navegador integrado de Burp, vaya a la **extensiÃ³n de Burp** y habilÃ­tela:

<figure><img src="../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

Ahora actualice la pÃ¡gina y en las **Dev Tools** encontrarÃ¡ la pestaÃ±a **DOM Invader:**

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

### Inyectar un canario

En la imagen anterior se puede ver un **grupo aleatorio de caracteres, que es el canario**. Ahora debe comenzar a **inyectarlo** en diferentes partes de la web (parÃ¡metros, formularios, URL...) y cada vez hacer clic en buscar. DOM Invader comprobarÃ¡ si el **canario terminÃ³ en algÃºn sumidero interesante** que pueda ser explotado.

AdemÃ¡s, las opciones **Inyectar parÃ¡metros de URL** e Inyectar formularios abrirÃ¡n automÃ¡ticamente una **nueva pestaÃ±a** **inyectando** el **canario** en cada **parÃ¡metro de URL** y **formulario** que encuentre.

### Inyectar un canario vacÃ­o

Si solo desea encontrar sumideros potenciales que la pÃ¡gina pueda tener, incluso si no son explotables, puede **buscar un canario vacÃ­o**.

### Mensajes web

DOM Invader permite probar XSS en el DOM utilizando mensajes web con caracterÃ­sticas como:

1. **Registro de mensajes web** enviados a travÃ©s de `postMessage()`, similar al registro de historial de solicitudes/respuestas HTTP de Burp Proxy.
2. **ModificaciÃ³n** y **reenvÃ­o** de mensajes web para probar manualmente XSS en el DOM, similar a la funciÃ³n de Burp Repeater.
3. **AlteraciÃ³n automÃ¡tica** y envÃ­o de mensajes web para sondear XSS en el DOM.

#### Detalles del mensaje

Puede hacer clic en cada mensaje para ver informaciÃ³n mÃ¡s detallada sobre Ã©l, incluyendo si las propiedades `origin`, `data` o `source` del mensaje son accedidas por el JavaScript del lado del cliente.

* **`origin`**: Si la **informaciÃ³n de origen del mensaje no se comprueba**, es posible que pueda enviar mensajes entre dominios al controlador de eventos **desde un dominio externo arbitrario**. Pero si se comprueba, aÃºn podrÃ­a ser inseguro.
* **`data`**: AquÃ­ es donde se envÃ­a la carga Ãºtil. Si estos datos no se utilizan, el sumidero es inÃºtil.
* **`source`**: EvalÃºa si la propiedad de origen, que generalmente hace referencia a un iframe, se valida en lugar del origen. Incluso si esto se comprueba, no asegura que la validaciÃ³n no pueda ser eludida.

#### Responder a un mensaje

1. Desde la vista de **Mensajes**, haga clic en cualquier mensaje para abrir el cuadro de diÃ¡logo de detalles del mensaje.
2. Edite el campo **Datos** segÃºn sea necesario.
3. Haga clic en **Enviar**.

### ContaminaciÃ³n de prototipos

DOM Invader tambiÃ©n puede buscar **vulnerabilidades de contaminaciÃ³n de prototipos**. Primero, debe habilitarlo:

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Luego, buscarÃ¡ **fuentes** que le permitan agregar propiedades arbitrarias al **`Object.prototype`**.

Si se encuentra algo, aparecerÃ¡ un botÃ³n de **Prueba** para **probar la fuente encontrada**. Haga clic en Ã©l, aparecerÃ¡ una nueva pestaÃ±a, cree un objeto en la consola y compruebe si existe la propiedad `testproperty`:
```javascript
let b = {}
b.testproperty
```
Una vez que encuentres una fuente, puedes **escanear para encontrar un gadget**:

1. Desde la vista del **DOM**, haz clic en el botÃ³n **Escanear para encontrar gadgets** junto a cualquier fuente de contaminaciÃ³n de prototipos que haya encontrado DOM Invader. DOM Invader abre una nueva pestaÃ±a y comienza a escanear en busca de gadgets adecuados.
2. En la misma pestaÃ±a, abre la pestaÃ±a **DOM Invader** en el panel de DevTools. Una vez que se completa el escaneo, la vista del **DOM** muestra cualquier sumidero al que DOM Invader pudo acceder a travÃ©s de los gadgets identificados. En el ejemplo a continuaciÃ³n, se pasÃ³ una propiedad de gadget llamada `html` al sumidero `innerHTML`.

## ContaminaciÃ³n del DOM

En la imagen anterior se puede ver que se puede activar el escaneo de contaminaciÃ³n del DOM. Una vez hecho esto, **DOM Invader comenzarÃ¡ a buscar vulnerabilidades de contaminaciÃ³n del DOM**.

## Referencias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
