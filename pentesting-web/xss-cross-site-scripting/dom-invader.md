## DOM Invader

O DOM Invader √© uma ferramenta do navegador instalada no navegador integrado do Burp. Ele ajuda a **detectar vulnerabilidades de XSS DOM** usando v√°rias fontes e sinks, incluindo mensagens da web e polui√ß√£o de prot√≥tipos. A ferramenta √© pr√©-instalada como uma extens√£o.

O DOM Invader integra uma guia dentro do painel DevTools do navegador, permitindo o seguinte:

1. **Identifica√ß√£o de sinks control√°veis** em uma p√°gina da web para teste de XSS DOM, fornecendo contexto e detalhes de sanitiza√ß√£o.
2. **Registro, edi√ß√£o e reenvio de mensagens da web** enviadas pelo m√©todo `postMessage()` para teste de XSS DOM. O DOM Invader tamb√©m pode detectar automaticamente vulnerabilidades usando mensagens da web especialmente criadas.
3. Detec√ß√£o de **fontes de polui√ß√£o de prot√≥tipos do lado do cliente** e varredura de gadgets control√°veis enviados para sinks arriscados.
4. Identifica√ß√£o de **vulnerabilidades de clobbering do DOM**.

### Habilitar

No navegador integrado do Burp, v√° para a **extens√£o Burp** e habilite-a:

<figure><img src="../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

Agora atualize a p√°gina e na **Dev Tools** voc√™ encontrar√° a **guia DOM Invader:**

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

### Injetar um Canary

Na imagem anterior, voc√™ pode ver um **grupo aleat√≥rio de caracteres, que √© o Canary**. Agora voc√™ deve come√ßar a **injet√°-lo** em diferentes partes da web (par√¢metros, formul√°rios, URL...) e clicar em pesquisar a cada vez. O DOM Invader verificar√° se o **canary terminou em algum sink interessante** que possa ser explorado.

Al√©m disso, as op√ß√µes **Injetar par√¢metros de URL** e Injetar formul√°rios abrir√£o automaticamente uma **nova guia** **injetando** o **canary** em todos os **par√¢metros de URL** e **formul√°rios** que encontrar.

### Injetar um Canary vazio

Se voc√™ quiser apenas encontrar sinks potenciais que a p√°gina possa ter, mesmo que n√£o sejam explor√°veis, voc√™ pode **procurar por um canary vazio**.

### Mensagens da Web

O DOM Invader permite testar o XSS DOM usando mensagens da web com recursos como:

1. **Registro de mensagens da web** enviadas via `postMessage()`, semelhante ao registro de hist√≥rico de solicita√ß√£o/resposta HTTP do Burp Proxy.
2. **Modifica√ß√£o** e **reenvio** de mensagens da web para testar manualmente o XSS DOM, semelhante √† fun√ß√£o do Burp Repeater.
3. **Altera√ß√£o autom√°tica** e envio de mensagens da web para sondar o XSS DOM.

#### Detalhes da mensagem

Voc√™ pode clicar em cada mensagem para ver informa√ß√µes mais detalhadas sobre ela, incluindo se as propriedades `origin`, `data` ou `source` da mensagem s√£o acessadas pelo JavaScript do lado do cliente.

* **`origin`**: Se as informa√ß√µes de **origem da mensagem n√£o forem verificadas**, voc√™ poder√° enviar mensagens entre origens para o manipulador de eventos **de um dom√≠nio externo arbitr√°rio**. Mas se for verificado, ainda pode ser inseguro.
* **`data`**: Aqui √© onde a carga √∫til √© enviada. Se esses dados n√£o forem usados, o sink ser√° in√∫til.
* **`source`**: Avalia se a propriedade de origem, geralmente referenciando um iframe, √© validada em vez da origem. Mesmo que isso seja verificado, n√£o garante que a valida√ß√£o n√£o possa ser contornada.

#### Responder a uma mensagem

1. Na visualiza√ß√£o de **Mensagens**, clique em qualquer mensagem para abrir a caixa de di√°logo de detalhes da mensagem.
2. Edite o campo **Dados** conforme necess√°rio.
3. Clique em **Enviar**.

### Polui√ß√£o de Prot√≥tipos

O DOM Invader tamb√©m pode procurar por **vulnerabilidades de Polui√ß√£o de Prot√≥tipos**. Primeiro, voc√™ precisa habilit√°-lo:

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Em seguida, ele **procurar√° por fontes** que permitam adicionar propriedades arbitr√°rias ao **`Object.prototype`**.

Se algo for encontrado, um bot√£o **Testar** aparecer√° para **testar a fonte encontrada**. Clique nele, uma nova guia aparecer√°, crie um objeto no console e verifique se a `testproperty` existe:
```javascript
let b = {}
b.testproperty
```
Uma vez que voc√™ encontrou uma fonte, voc√™ pode **procurar por um gadget**:

1. Na visualiza√ß√£o do **DOM**, clique no bot√£o **Procurar por gadgets** ao lado de qualquer fonte de polui√ß√£o de prot√≥tipo que o DOM Invader tenha encontrado. O DOM Invader abre uma nova guia e come√ßa a procurar por gadgets adequados.
2. Na mesma guia, abra a guia **DOM Invader** no painel DevTools. Uma vez que a varredura √© conclu√≠da, a visualiza√ß√£o do **DOM** exibe quaisquer sinks que o DOM Invader foi capaz de acessar atrav√©s dos gadgets identificados. No exemplo abaixo, uma propriedade de gadget chamada `html` foi passada para o sink `innerHTML`.

## Clobbering do DOM

Na imagem anterior, √© poss√≠vel ver que a varredura de clobbering do DOM pode ser ativada. Uma vez feito isso, o **DOM Invader come√ßar√° a procurar por vulnerabilidades de clobbering do DOM**.

## Refer√™ncias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
