# DOM Invader

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repos de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DOM Invader

DOM Invader es una herramienta de navegador instalada en el navegador incorporado de Burp. Asiste en la **detecci칩n de vulnerabilidades DOM XSS** utilizando diversas fuentes y sumideros, incluyendo mensajes web y contaminaci칩n de prototipos. La herramienta est치 preinstalada como una extensi칩n.

DOM Invader integra una pesta침a dentro del panel DevTools del navegador que permite lo siguiente:

1. **Identificaci칩n de sumideros controlables** en una p치gina web para pruebas de DOM XSS, proporcionando contexto y detalles de saneamiento.
2. **Registro, edici칩n y reenv칤o de mensajes web** enviados a trav칠s del m칠todo `postMessage()` para pruebas de DOM XSS. DOM Invader tambi칠n puede detectar autom치ticamente vulnerabilidades utilizando mensajes web especialmente dise침ados.
3. Detecci칩n de fuentes de **contaminaci칩n de prototipos en el lado del cliente** y escaneo de gadgets controlables enviados a sumideros riesgosos.
4. Identificaci칩n de **vulnerabilidades de DOM clobbering**.

### Act칤valo

En el navegador incorporado de Burp ve a la **extensi칩n de Burp** y act칤vala:

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

Ahora actualiza la p치gina y en los **Dev Tools** encontrar치s la **pesta침a DOM Invader:**

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Inyecta un Canary

En la imagen anterior puedes ver un **grupo aleatorio de caracteres, eso es el Canary**. Ahora deber칤as empezar a **inyectarlo** en diferentes partes de la web (par치metros, formularios, URL...) y cada vez hacer clic en buscar. DOM Invader comprobar치 si el **canary termin칩 en alg칰n sumidero interesante** que podr칤a ser explotado.

Adem치s, las opciones **Inject URL params** e Inject forms abrir치n autom치ticamente una **nueva pesta침a** **inyectando** el **canary** en cada **URL** par치metro y **formulario** que encuentre.

### Inyecta un Canary vac칤o

Si solo quieres encontrar posibles sumideros que la p치gina podr칤a tener, incluso si no son explotables, puedes **buscar un canary vac칤o**.

### Mensajes Post

DOM Invader permite probar DOM XSS utilizando mensajes web con caracter칤sticas como:

1. **Registro de mensajes web** enviados a trav칠s de `postMessage()`, similar al registro de historial de solicitudes/respuestas HTTP de Burp Proxy.
2. **Modificaci칩n** y **reemisi칩n** de mensajes web para probar manualmente DOM XSS, similar a la funci칩n de Burp Repeater.
3. **Alteraci칩n autom치tica** y env칤o de mensajes web para sondear DOM XSS.

#### Detalles del mensaje

Puedes hacer clic en cada mensaje para ver m치s informaci칩n detallada sobre 칠l, incluyendo si las propiedades `origin`, `data` o `source` del mensaje son accedidas por el JavaScript del lado del cliente.

* **`origin`** : Si la **informaci칩n de origen del mensaje no se verifica**, podr칤as ser capaz de enviar mensajes de origen cruzado al manejador de eventos **desde un dominio externo arbitrario**. Pero si se verifica, a칰n podr칤a ser inseguro.
* **`data`**: Aqu칤 es donde se env칤a la carga 칰til. Si estos datos no se utilizan, el sumidero es in칰til.
* **`source`**: Eval칰a si la propiedad source, que generalmente hace referencia a un iframe, es validada en lugar del origen. Incluso si esto se verifica, no asegura que la validaci칩n no pueda ser eludida.

#### Responder un mensaje

1. Desde la vista **Mensajes**, haz clic en cualquier mensaje para abrir el di치logo de detalles del mensaje.
2. Edita el campo **Data** seg칰n sea necesario.
3. Haz clic en **Enviar**.

### Contaminaci칩n de Prototipos

DOM Invader tambi칠n puede buscar **vulnerabilidades de Contaminaci칩n de Prototipos**. Primero, necesitas activarlo:

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

Luego, buscar치 **fuentes** que te permitan agregar propiedades arbitrarias al **`Object.prototype`**.

Si se encuentra algo, aparecer치 un bot칩n **Test** para **probar la fuente encontrada**. Haz clic en 칠l, se abrir치 una nueva pesta침a, crea un objeto en la consola y verifica si existe la propiedad `testproperty`:
```javascript
let b = {}
b.testproperty
```
Una vez que hayas encontrado una fuente, puedes **buscar un gadget**:

1. Desde la vista **DOM**, haz clic en el bot칩n **Buscar gadgets** junto a cualquier fuente de contaminaci칩n de prototipos que DOM Invader haya encontrado. DOM Invader abre una nueva pesta침a y comienza a buscar gadgets adecuados.
2. En la misma pesta침a, abre la pesta침a **DOM Invader** en el panel de DevTools. Una vez que la b칰squeda ha terminado, la vista **DOM** muestra cualquier punto de entrada que DOM Invader pudo acceder a trav칠s de los gadgets identificados. En el ejemplo a continuaci칩n, una propiedad de gadget llamada `html` se pas칩 al punto de entrada `innerHTML`.

## DOM clobbering

En la imagen anterior es posible ver que se puede activar la b칰squeda de DOM clobbering. Una vez hecho, **DOM Invader comenzar치 a buscar vulnerabilidades de DOM clobbering**.

## Referencias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
