# Invador DOM

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Invador DOM

O Invador DOM Ã© uma ferramenta do navegador instalada no navegador integrado do Burp. Ele ajuda a **detectar vulnerabilidades de XSS DOM** usando vÃ¡rias fontes e sinks, incluindo mensagens da web e poluiÃ§Ã£o de protÃ³tipos. A ferramenta Ã© prÃ©-instalada como uma extensÃ£o.

O Invador DOM integra uma guia dentro do painel DevTools do navegador, permitindo o seguinte:

1. **IdentificaÃ§Ã£o de sinks controlÃ¡veis** em uma pÃ¡gina da web para teste de XSS DOM, fornecendo contexto e detalhes de sanitizaÃ§Ã£o.
2. **Registro, ediÃ§Ã£o e reenvio de mensagens da web** enviadas via mÃ©todo `postMessage()` para teste de XSS DOM. O Invador DOM tambÃ©m pode detectar automaticamente vulnerabilidades usando mensagens da web especialmente criadas.
3. DetecÃ§Ã£o de **fontes de poluiÃ§Ã£o de protÃ³tipos do lado do cliente** e varredura de gadgets controlÃ¡veis enviados para sinks arriscados.
4. IdentificaÃ§Ã£o de **vulnerabilidades de clobbering DOM**.

### Habilitar

No navegador integrado do Burp, vÃ¡ para a **extensÃ£o Burp** e habilite-a:

<figure><img src="../../.gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

Agora atualize a pÃ¡gina e na **Dev Tools** vocÃª encontrarÃ¡ a **guia Invador DOM:**

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

### Injetar um canÃ¡rio

Na imagem anterior, vocÃª pode ver um **grupo aleatÃ³rio de caracteres, que Ã© o canÃ¡rio**. Agora vocÃª deve comeÃ§ar a **injetÃ¡-lo** em diferentes partes da web (parÃ¢metros, formulÃ¡rios, URL...) e clicar em pesquisar cada vez. O Invador DOM verificarÃ¡ se o **canÃ¡rio terminou em algum sink interessante** que possa ser explorado.

AlÃ©m disso, as opÃ§Ãµes **Injetar parÃ¢metros de URL** e Injetar formulÃ¡rios abrirÃ£o automaticamente uma **nova guia** **injetando** o **canÃ¡rio** em todos os **parÃ¢metros de URL** e **formulÃ¡rios** que encontrar.

### Injetar um canÃ¡rio vazio

Se vocÃª quiser apenas encontrar sinks potenciais que a pÃ¡gina possa ter, mesmo que nÃ£o sejam explorÃ¡veis, vocÃª pode **procurar por um canÃ¡rio vazio**.

### Mensagens da web

O Invador DOM permite testar o XSS DOM usando mensagens da web com recursos como:

1. **Registro de mensagens da web** enviadas via `postMessage()`, semelhante ao registro de histÃ³rico de solicitaÃ§Ã£o/resposta HTTP do Burp Proxy.
2. **ModificaÃ§Ã£o** e **reenvio** de mensagens da web para testar manualmente o XSS DOM, semelhante Ã  funÃ§Ã£o do Burp Repeater.
3. **AlteraÃ§Ã£o automÃ¡tica** e envio de mensagens da web para sondar o XSS DOM.

#### Detalhes da mensagem

VocÃª pode clicar em cada mensagem para ver informaÃ§Ãµes mais detalhadas sobre ela, incluindo se as propriedades `origin`, `data` ou `source` da mensagem sÃ£o acessadas pelo JavaScript do lado do cliente.

* **`origin`**: Se as informaÃ§Ãµes de **origem da mensagem nÃ£o forem verificadas**, vocÃª poderÃ¡ enviar mensagens de origem cruzada para o manipulador de eventos **de um domÃ­nio externo arbitrÃ¡rio**. Mas se for verificado, ainda pode ser inseguro.
* **`data`**: Aqui Ã© onde a carga Ãºtil Ã© enviada. Se esses dados nÃ£o forem usados, o sink Ã© inÃºtil.
* **`source`**: Avalia se a propriedade de origem, geralmente referenciando um iframe, Ã© validada em vez da origem. Mesmo que isso seja verificado, nÃ£o garante que a validaÃ§Ã£o nÃ£o possa ser contornada.

#### Responder a uma mensagem

1. Na visualizaÃ§Ã£o de **Mensagens**, clique em qualquer mensagem para abrir a caixa de diÃ¡logo de detalhes da mensagem.
2. Edite o campo **Dados** conforme necessÃ¡rio.
3. Clique em **Enviar**.

### PoluiÃ§Ã£o de protÃ³tipos

O Invador DOM tambÃ©m pode procurar por **vulnerabilidades de poluiÃ§Ã£o de protÃ³tipos**. Primeiro, vocÃª precisa habilitÃ¡-lo:

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

Em seguida, ele **procurarÃ¡ por fontes** que permitam adicionar propriedades arbitrÃ¡rias ao **`Object.prototype`**.

Se algo for encontrado, um botÃ£o **Testar** aparecerÃ¡ para **testar a fonte encontrada**. Clique nele, uma nova guia aparecerÃ¡, crie um objeto no console e verifique se a `testproperty` existe:
```javascript
let b = {}
b.testproperty
```
Uma vez que vocÃª encontrou uma fonte, vocÃª pode **procurar por um gadget**:

1. Na visualizaÃ§Ã£o do **DOM**, clique no botÃ£o **Procurar por gadgets** ao lado de qualquer fonte de poluiÃ§Ã£o de protÃ³tipo que o DOM Invader tenha encontrado. O DOM Invader abre uma nova guia e comeÃ§a a procurar por gadgets adequados.
2. Na mesma guia, abra a guia **DOM Invader** no painel DevTools. Uma vez que a varredura Ã© concluÃ­da, a visualizaÃ§Ã£o do **DOM** exibe quaisquer sinks que o DOM Invader foi capaz de acessar atravÃ©s dos gadgets identificados. No exemplo abaixo, uma propriedade de gadget chamada `html` foi passada para o sink `innerHTML`.

## Clobbering do DOM

Na imagem anterior, Ã© possÃ­vel ver que a varredura de clobbering do DOM pode ser ativada. Uma vez feito isso, o **DOM Invader comeÃ§arÃ¡ a procurar por vulnerabilidades de clobbering do DOM**.

## ReferÃªncias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
