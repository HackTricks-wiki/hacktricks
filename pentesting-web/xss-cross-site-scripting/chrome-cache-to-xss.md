# Chrome Cacheã‚’åˆ©ç”¨ã—ãŸXSSæ”»æ’ƒ

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€[**ã“ã®è§£èª¬è¨˜äº‹**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote)ã‹ã‚‰å–å¾—ã•ã‚Œã¾ã—ãŸã€‚

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯2ã¤ã®é‡è¦ãªã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ï¼š

* **ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆbfcacheï¼‰**
* å‚ç…§ï¼š[https://web.dev/i18n/en/bfcache/](https://web.dev/i18n/en/bfcache/)
* ã“ã‚Œã¯ã€**JavaScriptãƒ’ãƒ¼ãƒ—ã‚’å«ã‚€**ãƒšãƒ¼ã‚¸ã®å®Œå…¨ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã—ã¾ã™ã€‚
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚
* **ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥**
* å‚ç…§ï¼š[https://www.chromium.org/developers/design-documents/network-stack/disk-cache/](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/)
* ã“ã‚Œã¯ã€Webã‹ã‚‰å–å¾—ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿å­˜ã—ã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯**JavaScriptãƒ’ãƒ¼ãƒ—ã¯å«ã¾ã‚Œã¾ã›ã‚“**ã€‚
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯é€šä¿¡ã‚³ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®èˆˆå‘³æ·±ã„ç‚¹ã¨ã—ã¦ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯Webãƒšãƒ¼ã‚¸ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸHTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã ã‘ã§ãªãã€**`fetch`ã§å–å¾—ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚‚å«ã¾ã‚Œã¾ã™**ã€‚è¨€ã„æ›ãˆã‚Œã°ã€**`fetch`ã§å–å¾—ã—ãŸ**ãƒªã‚½ãƒ¼ã‚¹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€**ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒšãƒ¼ã‚¸ä¸Šã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**ã—ã¾ã™ã€‚

ã‚‚ã†1ã¤é‡è¦ãªãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸãƒšãƒ¼ã‚¸ãŒä¸¡æ–¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æœ‰åŠ¹ãªå ´åˆã€**bfcacheãŒãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€ä¸¡æ–¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ã€ãªã‚“ã‚‰ã‹ã®æ–¹æ³•ã§**bfcacheã‚’ç„¡åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚

### bfcacheã®ç„¡åŠ¹åŒ–

bfcacheã¯ã€puppeteerã®[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://github.com/puppeteer/puppeteer/blob/v19.2.0/packages/puppeteer-core/src/node/ChromeLauncher.ts#L175)ã«ã‚ˆã£ã¦ç„¡åŠ¹ã«ã•ã‚Œã¾ã™ã€‚

ã“ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§èˆˆå‘³æ·±ã„å‹•ä½œã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã€bfcache[\[2\]](https://blog.arkark.dev/2022/11/18/seccon-en/#fn2)ã‚’ç„¡åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚bfcacheãŒç„¡åŠ¹ã«ãªã‚‹æ¡ä»¶ã¯å¤šãã‚ã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆãŒã‚ã‚Šã¾ã™ï¼š

* [https://source.chromium.org/chromium/chromium/src/+/main:out/mac-Debug/gen/third\_party/blink/renderer/core/inspector/protocol/page.cc?q=BackForwardCacheNotRestoredReasonEnum \&ss=chromium](https://source.chromium.org/chromium/chromium/src/+/main:out/mac-Debug/gen/third\_party/blink/renderer/core/inspector/protocol/page.cc?q=BackForwardCacheNotRestoredReasonEnum%20\&ss=chromium)

ç°¡å˜ãªæ–¹æ³•ã¯ã€`RelatedActiveContentsExist`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

* `RelatedActiveContentsExist`ï¼š`window.open()`ã§é–‹ã‹ã‚Œã€`window.opener`ã®å‚ç…§ã‚’æŒã¤ãƒšãƒ¼ã‚¸ã€‚
* å‚ç…§ï¼š[https://web.dev/i18n/en/bfcache/#avoid-windowopener-references](https://web.dev/i18n/en/bfcache/#avoid-windowopener-references)

ã—ãŸãŒã£ã¦ã€æ¬¡ã®æ‰‹é †ã§ã“ã®å‹•ä½œã‚’å†ç¾ã§ãã¾ã™ï¼š

1. Webãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ï¼ˆä¾‹ï¼š`https://example.com`ï¼‰ã€‚
2. `open("http://spanote.seccon.games:3000/api/token")`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-04.png)
* ã‚µãƒ¼ãƒãƒ¼ã¯500ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã§å¿œç­”ã—ã¾ã™ã€‚
3. é–‹ã„ãŸã‚¿ãƒ–ã§`http://spanote.seccon.games:3000/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-05.png)
* ãã®å¾Œã€`http://spanote.seccon.games:3000/api/token`ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
4. `history.back()`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-06.png)
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒãƒšãƒ¼ã‚¸ä¸Šã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ï¼

Google Chromeã®DevToolsã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ï¼š\
![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-07.png)
* [ğŸ’¬](https://emojipedia.org/speech-balloon/) [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[Telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€Twitterã§[ğŸ¦](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)@carlospolopmã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
