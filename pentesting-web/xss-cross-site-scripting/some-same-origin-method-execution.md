# SOME - EjecuciÃ³n de mÃ©todo de misma origen

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## EjecuciÃ³n de mÃ©todo de misma origen

HabrÃ¡ ocasiones en las que puedas ejecutar un javascript limitado en una pÃ¡gina. Por ejemplo, en el caso en el que puedas [**controlar un valor de devoluciÃ³n de llamada que se ejecutarÃ¡**](./#javascript-function).

En esos casos, una de las mejores cosas que podrÃ­as hacer es **acceder al DOM para llamar a cualquier** acciÃ³n sensible que puedas encontrar allÃ­ (como hacer clic en un botÃ³n). Sin embargo, por lo general, encontrarÃ¡s esta vulnerabilidad en **pequeÃ±os puntos finales sin nada interesante en el DOM**.

En esos escenarios, este ataque serÃ¡ muy Ãºtil, porque su objetivo es poder **abusar de la ejecuciÃ³n limitada de JS dentro de un DOM desde una pÃ¡gina diferente del mismo dominio** con acciones mucho mÃ¡s interesantes.

BÃ¡sicamente, el flujo del ataque es el siguiente:

* Encuentra un **callback que puedas abusar** (potencialmente limitado a \[\w\\.\_]).
  * Si no estÃ¡ limitado y puedes ejecutar cualquier JS, podrÃ­as simplemente abusar de esto como un XSS regular.
* Haz que la **vÃ­ctima abra una pÃ¡gina** controlada por el **atacante**.
* La **pÃ¡gina se abrirÃ¡ a sÃ­ misma** en una **ventana diferente** (la nueva ventana tendrÃ¡ el objeto **`opener`** haciendo referencia a la inicial).
* La **pÃ¡gina inicial** cargarÃ¡ la **pÃ¡gina** donde se encuentra el **DOM interesante**.
* La **segunda pÃ¡gina** cargarÃ¡ la **pÃ¡gina vulnerable abusando del callback** y usando el objeto **`opener`** para **acceder y ejecutar alguna acciÃ³n en la pÃ¡gina inicial** (que ahora contiene el DOM interesante).

{% hint style="danger" %}
Ten en cuenta que incluso si la pÃ¡gina inicial accede a una nueva URL despuÃ©s de haber creado la segunda pÃ¡gina, el **objeto `opener` de la segunda pÃ¡gina sigue siendo una referencia vÃ¡lida a la primera pÃ¡gina en el nuevo DOM**.

AdemÃ¡s, para que la segunda pÃ¡gina pueda usar el objeto opener, **ambas pÃ¡ginas deben estar en el mismo origen**. Esta es la razÃ³n por la que, para abusar de esta vulnerabilidad, necesitas encontrar algÃºn tipo de **XSS en el mismo origen**.
{% endhint %}

### ExplotaciÃ³n

* Puedes usar este formulario para **generar un PoC** para explotar este tipo de vulnerabilidad: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Para encontrar una ruta DOM a un elemento HTML con un clic, puedes usar esta extensiÃ³n del navegador: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Ejemplo

* Puedes encontrar un ejemplo vulnerable en [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
  * Ten en cuenta que en este ejemplo el servidor estÃ¡ **generando cÃ³digo javascript** y **aÃ±adiÃ©ndolo** al HTML basado en el **contenido del parÃ¡metro de devoluciÃ³n de llamada:** `<script>opener.{callbacl_content}</script>` . Es por eso que en este ejemplo no necesitas indicar el uso de `opener` explÃ­citamente.
* TambiÃ©n revisa esta soluciÃ³n de CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Referencias

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)
