# SOME - Same Origin Method Execution

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* 쯊rabajas en una **empresa de ciberseguridad**? 쯈uieres que tu **empresa sea anunciada en HackTricks**? 쯆 quieres tener acceso a la **칰ltima versi칩n de PEASS o descargar HackTricks en PDF**? 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt칠n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **칔nete al** [**游눫**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) es un motor de b칰squeda alimentado por la **dark web** que ofrece funcionalidades **gratuitas** para verificar si una empresa o sus clientes han sido **comprometidos** por **malwares de robo**.

El objetivo principal de WhiteIntel es combatir los secuestros de cuentas y los ataques de ransomware resultantes de malwares que roban informaci칩n.

Puedes visitar su sitio web y probar su motor de forma **gratuita** en:

{% embed url="https://whiteintel.io" %}

---

## Ejecuci칩n de M칠todo de Mismo Origen

Habr치 ocasiones en las que puedas ejecutar algo de javascript limitado en una p치gina. Por ejemplo, en el caso en el que puedas [**controlar un valor de devoluci칩n de llamada que se ejecutar치**](./#javascript-function).

En esos casos, una de las mejores cosas que podr칤as hacer es **acceder al DOM para llamar a cualquier** acci칩n sensible que puedas encontrar all칤 (como hacer clic en un bot칩n). Sin embargo, generalmente encontrar치s esta vulnerabilidad en **peque침os puntos finales sin nada interesante en el DOM**.

En esos escenarios, este ataque ser치 muy 칰til, porque su objetivo es poder **abusar de la ejecuci칩n de JS limitada dentro de un DOM desde una p치gina diferente del mismo dominio** con acciones mucho m치s interesantes.

B치sicamente, el flujo del ataque es el siguiente:

* Encuentra un **callback que puedas abusar** (potencialmente limitado a \[\w\\.\_]).
* Si no est치 limitado y puedes ejecutar cualquier JS, simplemente podr칤as abusar de esto como un XSS regular.
* Haz que la **v칤ctima abra una p치gina** controlada por el **atacante**.
* La **p치gina se abrir치** en una **ventana diferente** (la nueva ventana tendr치 el objeto **`opener`** haciendo referencia a la inicial).
* La **p치gina inicial** cargar치 la **p치gina** donde se encuentra el **DOM interesante**.
* La **segunda p치gina** cargar치 la **p치gina vulnerable abusando del callback** y utilizando el objeto **`opener`** para **acceder y ejecutar alguna acci칩n en la p치gina inicial** (que ahora contiene el DOM interesante).

{% hint style="danger" %}
Ten en cuenta que incluso si la p치gina inicial accede a una nueva URL despu칠s de haber creado la segunda p치gina, el **objeto `opener` de la segunda p치gina sigue siendo una referencia v치lida a la primera p치gina en el nuevo DOM**.

Adem치s, para que la segunda p치gina pueda usar el objeto opener, **ambas p치ginas deben estar en el mismo origen**. Esta es la raz칩n por la que, para abusar de esta vulnerabilidad, necesitas encontrar alg칰n tipo de **XSS en el mismo origen**.
{% endhint %}

### Explotaci칩n

* Puedes usar este formulario para **generar un PoC** para explotar este tipo de vulnerabilidad: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Para encontrar una ruta DOM a un elemento HTML con un clic, puedes usar esta extensi칩n del navegador: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Ejemplo

* Puedes encontrar un ejemplo vulnerable en [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Ten en cuenta que en este ejemplo, el servidor est치 **generando c칩digo javascript** y **a침adi칠ndolo** al HTML basado en el **contenido del par치metro de devoluci칩n de llamada:** `<script>opener.{callbacl_content}</script>` . Por eso, en este ejemplo no necesitas indicar el uso de `opener` expl칤citamente.
* Tambi칠n revisa este an치lisis de CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Referencias

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/) 

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* 쯊rabajas en una **empresa de ciberseguridad**? 쯈uieres que tu **empresa sea anunciada en HackTricks**? 쯆 quieres tener acceso a la **칰ltima versi칩n de PEASS o descargar HackTricks en PDF**? 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt칠n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **칔nete al** [**游눫**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
