# DOM XSS

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚§ã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* **[ğŸ’¬](https://emojipedia.org/speech-balloon/) Discordã‚°ãƒ«ãƒ¼ãƒ—**ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## DOMã®è„†å¼±æ€§

DOMã®è„†å¼±æ€§ã¯ã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹**ã‚½ãƒ¼ã‚¹**ï¼ˆ`location.search`ã€`document.referrer`ã€`document.cookie`ãªã©ï¼‰ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ãŒå®‰å…¨ã§ãªã„çŠ¶æ…‹ã§**ã‚·ãƒ³ã‚¯**ã«è»¢é€ã•ã‚Œã‚‹ã¨ç™ºç”Ÿã—ã¾ã™ã€‚ã‚·ãƒ³ã‚¯ã¯ã€æ‚ªæ„ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨æœ‰å®³ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å®Ÿè¡Œã¾ãŸã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãã‚‹é–¢æ•°ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä¾‹ï¼š`eval()`ã€`document.body.innerHTML`ï¼‰ã§ã™ã€‚

- **ã‚½ãƒ¼ã‚¹**ã¯ã€æ”»æ’ƒè€…ã«ã‚ˆã£ã¦æ“ä½œå¯èƒ½ãªå…¥åŠ›ã§ã‚ã‚Šã€URLã€ã‚¯ãƒƒã‚­ãƒ¼ã€Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚
- **ã‚·ãƒ³ã‚¯**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œãªã©ã®æœ‰å®³ãªåŠ¹æœã‚’ã‚‚ãŸã‚‰ã™å¯èƒ½æ€§ã®ã‚ã‚‹å±é™ºãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ãªæ¤œè¨¼ã‚„ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãªã—ã«ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚·ãƒ³ã‚¯ã«æµã‚Œã‚‹ã¨ã€XSSãªã©ã®æ”»æ’ƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

{% hint style="info" %}
**ã‚½ãƒ¼ã‚¹ã¨ã‚·ãƒ³ã‚¯ã®ã‚ˆã‚Šæœ€æ–°ã®ãƒªã‚¹ãƒˆã¯ã€** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki) **ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**
{% endhint %}

**ä¸€èˆ¬çš„ãªã‚½ãƒ¼ã‚¹:**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**ä¸€èˆ¬çš„ãªã‚·ãƒ³ã‚¯:**

| [**ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**](dom-xss.md#open-redirect)                                    | [**Javascript Injection**](dom-xss.md#javascript-injection)                         | [**DOMãƒ‡ãƒ¼ã‚¿æ“ä½œ**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹æ“ä½œ**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Ajaxãƒªã‚¯ã‚¨ã‚¹ãƒˆæ“ä½œ**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**ãƒªãƒ³ã‚¯æ“ä½œ**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰JSONã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**HTML5ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œ**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**XPathã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Cookieæ“ä½œ**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³æ“ä½œ**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**WebSocket-URLãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°**](dom-xss.md#websocket-url-poisoning)      |
| [**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**](dom-xss.md#client-side-sql-injection)            | [**Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ“ä½œ**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

**`innerHTML`** ã‚·ãƒ³ã‚¯ã¯ã€ç¾ä»£ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ `script` è¦ç´ ã‚’å—ã‘å…¥ã‚Œãšã€`svg onload` ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ç™ºç«ã—ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`img` ã‚„ `iframe` ã®ã‚ˆã†ãªä»£æ›¿è¦ç´ ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã“ã®ç¨®ã®XSSã¯ãŠãã‚‰ã**æœ€ã‚‚è¦‹ã¤ã‘ã«ãã„**ã‚‚ã®ã§ã‚ã‚Šã€JSã‚³ãƒ¼ãƒ‰ã®å†…éƒ¨ã‚’èª¿ã¹ã€åˆ¶å¾¡å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã€ãã®å ´åˆã«ã¯ä»»æ„ã®JSã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’è¦‹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ã“ã‚Œã‚‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)

## ä¾‹

### ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

From: [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

**DOMå†…ã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã€ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã§ãã‚‹ã‚·ãƒ³ã‚¯ã«æ›¸ãè¾¼ã‚€å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç”Ÿã™ã‚‹URLã®å…ˆé ­éƒ¨åˆ†ã‚’åˆ¶å¾¡ã§ãã‚‹å ´åˆã€**`javascript:alert(1)`**ãªã©ã®ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

ã‚·ãƒ³ã‚¯:
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Cookie manipulation

From: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

DOMãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒƒã‚­ãƒ¼æ“ä½œã®è„†å¼±æ€§ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ”»æ’ƒè€…ã«ã‚ˆã£ã¦åˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒƒã‚­ãƒ¼ã®å€¤ã«çµ„ã¿è¾¼ã‚€å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã«ã‚ˆã‚Šã€ã‚¯ãƒƒã‚­ãƒ¼ãŒã‚µã‚¤ãƒˆå†…ã§ä½¿ç”¨ã•ã‚Œã‚‹å ´åˆã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®äºˆæœŸã—ãªã„å‹•ä½œãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚¯ãƒƒã‚­ãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¿½è·¡ã«é–¢ä¸ã—ã¦ã„ã‚‹å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºå®šæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã«é–¢é€£ã™ã‚‹ä¸»è¦ãªã‚·ãƒ³ã‚¯ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

ã‚·ãƒ³ã‚¯:
```javascript
document.cookie
```
### JavaScript Injection

From: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

DOMãƒ™ãƒ¼ã‚¹ã®JavaScriptã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã€æ”»æ’ƒè€…ã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ãã«ä½œæˆã•ã‚Œã¾ã™ã€‚

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ“ä½œ

From: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ“ä½œã«é–¢ã™ã‚‹è„†å¼±æ€§** ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ”»æ’ƒè€…ãŒåˆ¶å¾¡ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ `document.domain` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹ã¨ç™ºç”Ÿã—ã¾ã™ã€‚

`document.domain` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã‚‹ **åŒä¸€ã‚ªãƒªã‚¸ãƒ³ãƒãƒªã‚·ãƒ¼** ã® **å¼·åˆ¶** ã«ãŠã„ã¦ **é‡è¦ãªå½¹å‰²** ã‚’æœãŸã—ã¾ã™ã€‚ç•°ãªã‚‹ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®2ã¤ã®ãƒšãƒ¼ã‚¸ãŒãã‚Œãã‚Œ `document.domain` ã‚’ **åŒã˜å€¤** ã«è¨­å®šã™ã‚‹ã¨ã€åˆ¶é™ãªã—ã«ç›¸äº’ä½œç”¨ã§ãã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã¯ `document.domain` ã«å‰²ã‚Šå½“ã¦å¯èƒ½ãªå€¤ã«ä¸€å®šã® **åˆ¶é™** ã‚’èª²ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ãƒšãƒ¼ã‚¸ã®ã‚ªãƒªã‚¸ãƒ³ã«å®Œå…¨ã«é–¢é€£ã®ãªã„å€¤ã®å‰²ã‚Šå½“ã¦ã‚’é˜²ããŸã‚ã®ä¾‹å¤–ãŒå­˜åœ¨ã—ã¾ã™ã€‚é€šå¸¸ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯ **å­ãƒ‰ãƒ¡ã‚¤ãƒ³** ã¾ãŸã¯ **è¦ªãƒ‰ãƒ¡ã‚¤ãƒ³** ã®ä½¿ç”¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

ã‚·ãƒ³ã‚¯:
```javascript
document.domain
```
### WebSocket-URL poisoning

From: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**WebSocket-URL poisoning**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒWebSocketæ¥ç¶šã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆURLã¨ã—ã¦**åˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨**ã™ã‚‹å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

Sinks:

`WebSocket`ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€WebSocket-URLãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã®è„†å¼±æ€§ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### Link manipulation

From: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**DOMãƒ™ãƒ¼ã‚¹ã®ãƒªãƒ³ã‚¯æ“ä½œã®è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç¾åœ¨ã®ãƒšãƒ¼ã‚¸å†…ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¯ãƒªãƒƒã‚«ãƒ–ãƒ«ãƒªãƒ³ã‚¯ã‚„ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡URLãªã©ã§ã™ã€‚

Sinks:
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Ajax request manipulation

From: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Ajaxãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ“ä½œè„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ`XmlHttpRequest`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ç™ºè¡Œã•ã‚Œã‚‹Ajaxãƒªã‚¯ã‚¨ã‚¹ãƒˆã«**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

Sinks:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æ“ä½œ

From: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æ“ä½œã®è„†å¼±æ€§** ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ `filename` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ **æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†API** ã«æ¸¡ã™ã¨ãã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã¯ã€æ”»æ’ƒè€…ãŒURLã‚’æ§‹ç¯‰ã—ã¦æ‚ªæ„ã®ã‚ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ãŸã‚Šæ›¸ãè¾¼ã‚“ã ã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨ªã‚Œã‚‹ã¨ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ãŒä»»æ„ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ãŸã‚Šæ›¸ãè¾¼ã‚“ã ã‚Šã™ã‚‹** å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã‚·ãƒ³ã‚¯:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

From: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã§ãªã„æ–¹æ³•ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰SQLã‚¯ã‚¨ãƒªã«çµ„ã¿è¾¼ã‚€**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

Sinks:
```javascript
executeSql()
```
### HTML5ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ“ä½œ

From: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**HTML5ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ“ä½œã«é–¢ã™ã‚‹è„†å¼±æ€§** ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’Webãƒ–ãƒ©ã‚¦ã‚¶ã®HTML5ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆ`localStorage`ã¾ãŸã¯`sessionStorage`ï¼‰ã«ä¿å­˜ã™ã‚‹ã¨ãã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®è¡Œå‹•è‡ªä½“ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã§ã‚ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãã®å¾Œãã®ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã§ãªã„æ–¹æ³•ã§å‡¦ç†ã™ã‚‹ã¨å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’åˆ©ç”¨ã—ã¦ã€ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°ã‚„JavaScriptã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®ä»–ã®DOMãƒ™ãƒ¼ã‚¹ã®æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã‚·ãƒ³ã‚¯:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### XPath injection

From: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**DOM-based XPath-injection vulnerabilities** occur when a script incorporates **attacker-controllable data into an XPath query**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰JSONã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

From: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**DOMãƒ™ãƒ¼ã‚¹ã®JSONã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€æ–‡å­—åˆ—ã‚’JSONãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã—ã¦è§£æã—ã€ãã®å¾Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã‚‹**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ“ä½œ

From: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’ãƒ–ãƒ©ã‚¦ã‚¶å†…ã®åˆ¥ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦é€ä¿¡ã™ã‚‹**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚è„†å¼±ãªWebãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ“ä½œã®**ä¾‹**ã¯ã€[PortSwiggerã®Webã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ã‚«ãƒ‡ãƒŸãƒ¼](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚·ãƒ³ã‚¯ï¼š

`postMessage()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦Webãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã¨ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒå—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã§ãªã„æ–¹æ³•ã§å‡¦ç†ã™ã‚‹ã¨è„†å¼±æ€§ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### DOMãƒ‡ãƒ¼ã‚¿ã®æ“ä½œ

From: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**DOMãƒ‡ãƒ¼ã‚¿ã®æ“ä½œã®è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**DOMå†…ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€**å ´åˆã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã¯ã€æ”»æ’ƒè€…ãŒåˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨ªã‚Œã‚‹ã¨ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰UIã®å¤–è¦³ã‚„å‹•ä½œã‚’å¤‰æ›´ã§ãã‚‹URLã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦

From: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**DOMãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦ã®è„†å¼±æ€§**ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ**æ”»æ’ƒè€…ãŒåˆ¶å¾¡å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã§ãªã„æ–¹æ³•ã§å•é¡Œã®ã‚ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ APIã«æ¸¡ã™**ã¨ãã«ç™ºç”Ÿã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€å‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãŒ**éå‰°ãªCPUã‚„ãƒ‡ã‚£ã‚¹ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’æ¶ˆè²»ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹API**ãŒå«ã¾ã‚Œã¾ã™ã€‚ã“ã®ã‚ˆã†ãªè„†å¼±æ€§ã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒ`localStorage`ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã‚ˆã†ã¨ã™ã‚‹è©¦ã¿ã‚’æ‹’å¦ã—ãŸã‚Šã€ãƒ“ã‚¸ãƒ¼ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’çµ‚äº†ã—ãŸã‚Šã™ã‚‹ã“ã¨ã§ã€é‡å¤§ãªå‰¯ä½œç”¨ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã‚·ãƒ³ã‚¯:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚§ã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* **ğŸ’¬** [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ **ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«PRã‚’** [**hacktricksãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
