# HTTP Response Smuggling / Desync

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Consigue el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DesincronizaciÃ³n de la cola de solicitudes HTTP

En primer lugar, esta tÃ©cnica **abusa de una vulnerabilidad de HTTP Request Smuggling**, por lo que es necesario saber quÃ© es:

La **principal** **diferencia** entre esta tÃ©cnica y un HTTP Request smuggling comÃºn es que, **en lugar de atacar la solicitud del vÃ­ctima agregando un prefijo**, vamos a **filtrar o modificar la respuesta que recibe la vÃ­ctima**. Esto se hace enviando 2 solicitudes completas para desincronizar la cola de respuestas de los proxies, en lugar de enviar 1 solicitud y media para abusar del HTTP Request smuggling.

Esto se debe a que vamos a poder **desincronizar la cola de respuestas** para que la **respuesta** de la **solicitud legÃ­tima** de la **vÃ­ctima sea enviada al atacante**, o **inyectando contenido controlado por el atacante en la respuesta a la vÃ­ctima**.

### DesincronizaciÃ³n de la canalizaciÃ³n HTTP

HTTP/1.1 permite solicitar **diferentes recursos sin necesidad de esperar a que se completen los anteriores**. Por lo tanto, si hay un **proxy** en el **medio**, es tarea del proxy **mantener una coincidencia sincronizada de las solicitudes enviadas al backend y las respuestas que llegan de Ã©l**.

Sin embargo, hay un problema para desincronizar la cola de respuestas. Si un atacante envÃ­a un ataque de HTTP Response smuggling y las respuestas a la **solicitud inicial y la oculta se responden inmediatamente**, la respuesta oculta no se insertarÃ¡ en la cola de respuesta de la vÃ­ctima, sino que **se descartarÃ¡ como un error**.

![](<../.gitbook/assets/image (635) (1) (1) (1).png>)

Por lo tanto, es necesario que la **solicitud oculta** **tome mÃ¡s tiempo para procesarse** dentro del servidor de back-end. Por lo tanto, cuando se procese la solicitud oculta, la comunicaciÃ³n con el atacante habrÃ¡ terminado.

Si en esta situaciÃ³n especÃ­fica una **vÃ­ctima ha enviado una solicitud** y la **solicitud oculta se responde antes** de la solicitud legÃ­tima, la **respuesta oculta se enviarÃ¡ a la vÃ­ctima**. Por lo tanto, el atacante estarÃ¡ **controlando la solicitud "realizada" por la vÃ­ctima**.

AdemÃ¡s, si el **atacante realiza una solicitud** y la **respuesta legÃ­tima** a la **solicitud de la vÃ­ctima se responde antes** de la solicitud del atacante. La **respuesta a la vÃ­ctima se enviarÃ¡ al atacante**, **robando** la respuesta a la vÃ­ctima (que puede contener, por ejemplo, el encabezado **Set-Cookie**).

![](<../.gitbook/assets/image (658) (1).png>)

![](<../.gitbook/assets/image (655) (1) (1) (1).png>)

### MÃºltiples inyecciones anidadas

Otra **diferencia interesante** con el **HTTP Request Smuggling** comÃºn es que, en un ataque de smuggling comÃºn, el **objetivo** es **modificar el comienzo de la solicitud de la vÃ­ctima** para que realice una acciÃ³n inesperada. En un ataque de **HTTP Response smuggling**, como se estÃ¡n **enviando solicitudes completas**, se puede **inyectar en una carga Ãºtil decenas de respuestas** que **desincronizarÃ¡n a decenas de usuarios** que **recibirÃ¡n las respuestas inyectadas**.

AdemÃ¡s de poder **distribuir mÃ¡s fÃ¡cilmente decenas de exploits** entre usuarios legÃ­timos,
## Referencias

* No olvides revisar este video que explica todas estas tÃ©cnicas muy bien: [https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s](https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Revisa los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
