# Bypass de 2FA/OTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Bypass de autenticaciÃ³n de dos factores**

### **Bypass directo**

Para saltarse el 2FA, simplemente **intenta acceder directamente al siguiente punto final** (necesitas conocer la ruta del siguiente punto final). Si esto no funciona, intenta cambiar el **encabezado Referrer** como si vinieras de la pÃ¡gina de 2FA.

### **ReutilizaciÃ³n de token**

Tal vez puedas reutilizar un token previamente utilizado dentro de la cuenta para autenticarte.

### Compartir tokens no utilizados

Verifica si puedes obtener el token de tu cuenta y trata de usarlo para saltarte el 2FA en una cuenta diferente.

### Token filtrado

Â¿Se filtrÃ³ el token en una respuesta de la aplicaciÃ³n web?

### Enlace de verificaciÃ³n de correo electrÃ³nico

Intenta usar el **enlace de verificaciÃ³n de correo electrÃ³nico recibido cuando se creÃ³ la cuenta** para ver si, incluso si se configurÃ³ el 2FA, aÃºn puedes acceder a tu perfil solo con ese enlace ([publicaciÃ³n](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### Permiso de sesiÃ³n

Usando la misma sesiÃ³n, inicia el flujo utilizando tu cuenta y la cuenta de la vÃ­ctima. Cuando llegues al punto de 2FA en ambas cuentas, completa el 2FA con tu cuenta pero no accedas a la siguiente parte. En lugar de eso, intenta acceder al siguiente paso con el flujo de la cuenta de la vÃ­ctima. Si el backend solo establece un booleano dentro de tus sesiones diciendo que has pasado el 2FA con Ã©xito, podrÃ¡s saltarte el 2FA de la vÃ­ctima.

### FunciÃ³n de restablecimiento de contraseÃ±a

En casi todas las aplicaciones web, la **funciÃ³n de restablecimiento de contraseÃ±a inicia sesiÃ³n automÃ¡ticamente** al completar el procedimiento de restablecimiento.\
Verifica si se envÃ­a un **correo** con un **enlace** para **restablecer la contraseÃ±a** y si puedes **reutilizar** ese **enlace** para restablecer la contraseÃ±a tantas veces como desees (incluso si la vÃ­ctima cambia su direcciÃ³n de correo electrÃ³nico).

### OAuth

Si puedes comprometer la cuenta del usuario en una plataforma de **OAuth** confiable (Google, Facebook...)

### Fuerza bruta

#### Falta de lÃ­mite de velocidad

Â¿Hay algÃºn lÃ­mite en el nÃºmero de cÃ³digos que puedes probar, para que puedas simplemente hacer fuerza bruta? Ten cuidado con un posible lÃ­mite de velocidad "silencioso", siempre prueba varios cÃ³digos y luego el real para confirmar la vulnerabilidad.

#### LÃ­mite de flujo pero sin lÃ­mite de velocidad

En este caso, hay un lÃ­mite de flujo (tienes que hacer fuerza bruta muy lentamente: 1 hilo y algo de espera antes de 2 intentos) pero no hay lÃ­mite de velocidad. Entonces, con suficiente tiempo, puedes encontrar el cÃ³digo vÃ¡lido.

#### Reenviar el cÃ³digo y restablecer el lÃ­mite

Hay un lÃ­mite de velocidad, pero cuando "reenvÃ­as el cÃ³digo", se envÃ­a el mismo cÃ³digo y se restablece el lÃ­mite de velocidad. Entonces, puedes hacer fuerza bruta en el cÃ³digo mientras lo reenvÃ­as para que nunca se alcance el lÃ­mite de velocidad.

#### Bypass del lÃ­mite de velocidad del lado del cliente

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Falta de lÃ­mite de velocidad en la cuenta del usuario

A veces puedes configurar el 2FA para algunas acciones dentro de tu cuenta (cambiar correo electrÃ³nico, contraseÃ±a...). Sin embargo, incluso en los casos en que hay un lÃ­mite de velocidad cuando intentaste iniciar sesiÃ³n, no hay ningÃºn lÃ­mite de velocidad para proteger las acciones dentro de la cuenta.

#### Falta de lÃ­mite de velocidad al reenviar el cÃ³digo por SMS

No podrÃ¡s saltarte el 2FA, pero podrÃ¡s hacer que la empresa gaste dinero.

#### RegeneraciÃ³n infinita de OTP

Si puedes **generar un nuevo OTP infinitas veces**, el OTP es lo suficientemente **simple** (4 nÃºmeros) y puedes probar hasta 4 o 5 tokens por OTP generado, simplemente prueba los mismos 4 o 5 tokens cada vez y genera OTP hasta que coincida con los que estÃ¡s usando.

### CondiciÃ³n de carrera

Consulta la secciÃ³n sobre el bypass de 2FA en la siguiente pÃ¡gina:

{% content-ref url="race-condition.md" %}
[race-condition.md](race-condition.md)
{% endcontent-ref %}

### CSRF/Clickjacking

Verifica si hay una vulnerabilidad de Cross Site Request Forgery (CSRF) o Clickjacking para desactivar el 2FA.

### Funcionalidad de recordarme
#### Cookie adivinable

Si la funcionalidad de "recordarme" utiliza una nueva cookie con un cÃ³digo adivinable, intenta adivinarlo.

#### DirecciÃ³n IP

Si la funcionalidad de "recordarme" estÃ¡ vinculada a tu direcciÃ³n IP, puedes intentar averiguar la direcciÃ³n IP de la vÃ­ctima e impersonarla utilizando el encabezado **X-Forwarded-For**.

### Versiones antiguas

#### Subdominios

Si puedes encontrar algunos subdominios de "pruebas" con la funcionalidad de inicio de sesiÃ³n, es posible que estÃ©n utilizando versiones antiguas que no admiten la autenticaciÃ³n de dos factores (por lo que se omite directamente) o esos puntos finales podrÃ­an admitir una versiÃ³n vulnerable de la autenticaciÃ³n de dos factores.

#### APIs

Si descubres que la autenticaciÃ³n de dos factores utiliza una API ubicada en un directorio /v\* (como "/v3/"), esto probablemente significa que hay puntos finales de API antiguos que podrÃ­an ser vulnerables a algÃºn tipo de omisiÃ³n de la autenticaciÃ³n de dos factores.

### Sesiones anteriores

Cuando se habilita la autenticaciÃ³n de dos factores, las sesiones anteriores creadas deben finalizarse. Esto se debe a que cuando un cliente tiene su cuenta comprometida, puede querer protegerla activando la autenticaciÃ³n de dos factores, pero si las sesiones anteriores no se finalizan, esto no lo protegerÃ¡.

### Control de acceso inadecuado a cÃ³digos de respaldo

Los cÃ³digos de respaldo se generan inmediatamente despuÃ©s de habilitar la autenticaciÃ³n de dos factores y estÃ¡n disponibles en una sola solicitud. DespuÃ©s de cada llamada subsiguiente a la solicitud, los cÃ³digos pueden regenerarse o permanecer sin cambios (cÃ³digos estÃ¡ticos). Si existen configuraciones incorrectas de CORS/vulnerabilidades de XSS y otros errores que permiten "extraer" los cÃ³digos de respaldo de la solicitud de respuesta del punto final del cÃ³digo de respaldo, entonces el atacante podrÃ­a robar los cÃ³digos y omitir la autenticaciÃ³n de dos factores si se conocen el nombre de usuario y la contraseÃ±a.

### DivulgaciÃ³n de informaciÃ³n

Si notas que aparece informaciÃ³n confidencial en la pÃ¡gina de autenticaciÃ³n de dos factores que no conocÃ­as previamente (como el nÃºmero de telÃ©fono), esto se puede considerar una vulnerabilidad de divulgaciÃ³n de informaciÃ³n.

### **Restablecimiento de contraseÃ±a == desactivar la autenticaciÃ³n de dos factores**

1. Crea una cuenta y activa la autenticaciÃ³n de dos factores.
2. Cierra sesiÃ³n en esa cuenta.
3. Ahora, ve a la pÃ¡gina de restablecimiento de contraseÃ±a olvidada.
4. Cambia tu contraseÃ±a.
5. Ahora intenta iniciar sesiÃ³n.
6. Si no se te solicita ingresar un cÃ³digo de autenticaciÃ³n de dos factores, puedes informarlo.

## Referencias

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Â¿Trabajas en una **empresa de ciberseguridad**? Â¿Quieres ver tu **empresa anunciada en HackTricks**? Â¿O quieres tener acceso a la **Ãºltima versiÃ³n de PEASS o descargar HackTricks en PDF**? Â¡Consulta los [**PLANES DE SUSCRIPCIÃ“N**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecciÃ³n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* ObtÃ©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **Ãšnete al** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sÃ­gueme** en **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
