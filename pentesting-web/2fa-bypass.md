# Bypass de 2FA/OTP

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Bypass de autenticaci√≥n de dos factores**

### **Bypass directo**

Para saltarse la autenticaci√≥n de dos factores, simplemente **intenta acceder directamente al siguiente punto final** (necesitas conocer la ruta del siguiente punto final). Si esto no funciona, intenta cambiar el **encabezado Referrer** como si vinieras de la p√°gina de autenticaci√≥n de dos factores.

### **Reutilizaci√≥n de token**

Tal vez puedas reutilizar un token previamente utilizado dentro de la cuenta para autenticarte.

### Compartir tokens no utilizados

Verifica si puedes obtener el token de tu cuenta y trata de usarlo para saltarte la autenticaci√≥n de dos factores en una cuenta diferente.

### Token filtrado

¬øSe filtr√≥ el token en una respuesta de la aplicaci√≥n web?

### Enlace de verificaci√≥n de correo electr√≥nico

Intenta usar el **enlace de verificaci√≥n de correo electr√≥nico recibido cuando se cre√≥ la cuenta** para ver si, incluso si se configur√≥ la autenticaci√≥n de dos factores, a√∫n puedes acceder a tu perfil solo con ese enlace ([publicaci√≥n](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### Permiso de sesi√≥n

Usando la misma sesi√≥n, inicia el flujo utilizando tu cuenta y la cuenta de la v√≠ctima. Cuando llegues al punto de autenticaci√≥n de dos factores en ambas cuentas, completa la autenticaci√≥n de dos factores con tu cuenta pero no accedas a la siguiente parte. En lugar de eso, intenta acceder al siguiente paso con el flujo de la cuenta de la v√≠ctima. Si el backend solo establece un booleano dentro de tus sesiones que indique que has pasado la autenticaci√≥n de dos factores con √©xito, podr√°s saltarte la autenticaci√≥n de dos factores de la v√≠ctima.

### Funci√≥n de restablecimiento de contrase√±a

En casi todas las aplicaciones web, la funci√≥n de restablecimiento de contrase√±a **inicia sesi√≥n autom√°ticamente al usuario en la aplicaci√≥n** despu√©s de que se complete el procedimiento de restablecimiento.\
Verifica si se env√≠a un **correo electr√≥nico** con un **enlace** para **restablecer la contrase√±a** y si puedes **reutilizar** ese **enlace** para restablecer la contrase√±a tantas veces como desees (incluso si la v√≠ctima cambia su direcci√≥n de correo electr√≥nico).

### OAuth

Si puedes comprometer la cuenta del usuario en una plataforma de **OAuth** confiable (Google, Facebook...)

### Fuerza bruta

#### Falta de l√≠mite de velocidad

¬øHay alg√∫n l√≠mite en el n√∫mero de c√≥digos que puedes probar, para que puedas simplemente hacer fuerza bruta? Ten cuidado con un posible l√≠mite de velocidad "silencioso", siempre prueba varios c√≥digos y luego el real para confirmar la vulnerabilidad.

#### L√≠mite de flujo pero sin l√≠mite de velocidad

En este caso, hay un l√≠mite de flujo (tienes que hacer fuerza bruta muy lentamente: 1 hilo y algo de espera antes de 2 intentos) pero no hay l√≠mite de velocidad. Entonces, con suficiente tiempo, podr√°s encontrar el c√≥digo v√°lido.

#### Reenviar el c√≥digo y restablecer el l√≠mite

Hay un l√≠mite de velocidad, pero cuando "reenv√≠as el c√≥digo", se env√≠a el mismo c√≥digo y se restablece el l√≠mite de velocidad. Entonces, puedes hacer fuerza bruta en el c√≥digo mientras lo reenv√≠as para que nunca se alcance el l√≠mite de velocidad.

#### Bypass del l√≠mite de velocidad del lado del cliente

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Falta de l√≠mite de velocidad en la cuenta del usuario

A veces puedes configurar la autenticaci√≥n de dos factores para algunas acciones dentro de tu cuenta (cambiar correo electr√≥nico, contrase√±a...). Sin embargo, incluso en los casos en que hay un l√≠mite de velocidad cuando intentas iniciar sesi√≥n, no hay ning√∫n l√≠mite de velocidad para proteger las acciones dentro de la cuenta.

#### Falta de l√≠mite de velocidad al reenviar el c√≥digo por SMS

No podr√°s saltarte la autenticaci√≥n de dos factores, pero podr√°s hacer que la empresa gaste dinero.

#### Regeneraci√≥n infinita de OTP

Si puedes **generar un nuevo OTP infinitas veces**, el OTP es lo suficientemente **simple** (4 n√∫meros) y puedes probar hasta 4 o 5 tokens por OTP generado, simplemente prueba los mismos 4 o 5 tokens cada vez y genera OTP hasta que coincida con los que est√°s usando.

### CSRF/Clickjacking

Verifica si hay una vulnerabilidad de Cross Site Request Forgery (CSRF) o Clickjacking para desactivar la autenticaci√≥n de dos factores.

### Funcionalidad de "Recu√©rdame"

#### Cookie adivinable

Si la funcionalidad de "recu√©rdame" utiliza una nueva cookie con un c√≥digo adivinable, intenta adivinarlo.

#### Direcci√≥n IP

Si la funcionalidad de "recu√©rdame" est√° vinculada a tu direcci√≥n IP, puedes intentar averiguar la direcci√≥n IP de la v√≠ctima e impersonarla utilizando el encabezado **X-Forwarded-For**.
### Versiones antiguas

#### Subdominios

Si encuentras subdominios de "pruebas" con funcionalidad de inicio de sesi√≥n, es posible que est√©n utilizando versiones antiguas que no admiten la autenticaci√≥n de dos factores (por lo que se puede omitir directamente) o que esos puntos finales admitan una versi√≥n vulnerable de la autenticaci√≥n de dos factores.

#### APIs

Si descubres que la autenticaci√≥n de dos factores utiliza una API ubicada en un directorio /v\* (como "/v3/"), esto probablemente significa que existen puntos finales de API antiguos que podr√≠an ser vulnerables a alg√∫n tipo de omisi√≥n de la autenticaci√≥n de dos factores.

### Sesiones anteriores

Cuando se habilita la autenticaci√≥n de dos factores, las sesiones anteriores creadas deben finalizarse. Esto se debe a que cuando un cliente tiene su cuenta comprometida, puede querer protegerla activando la autenticaci√≥n de dos factores, pero si las sesiones anteriores no se finalizan, esto no lo proteger√°.

### Control de acceso inadecuado a c√≥digos de respaldo

Los c√≥digos de respaldo se generan inmediatamente despu√©s de habilitar la autenticaci√≥n de dos factores y est√°n disponibles en una sola solicitud. Despu√©s de cada llamada subsiguiente a la solicitud, los c√≥digos pueden regenerarse o permanecer sin cambios (c√≥digos est√°ticos). Si existen configuraciones incorrectas de CORS/vulnerabilidades XSS y otros errores que permiten "extraer" los c√≥digos de respaldo de la respuesta de la solicitud del punto final del c√≥digo de respaldo, entonces el atacante podr√≠a robar los c√≥digos y omitir la autenticaci√≥n de dos factores si se conocen el nombre de usuario y la contrase√±a.

### Divulgaci√≥n de informaci√≥n

Si notas que aparece informaci√≥n confidencial en la p√°gina de autenticaci√≥n de dos factores que no conoc√≠as previamente (como el n√∫mero de tel√©fono), esto se puede considerar una vulnerabilidad de divulgaci√≥n de informaci√≥n.

### **Restablecimiento de contrase√±a == desactivar la autenticaci√≥n de dos factores**

1. Crea una cuenta y activa la autenticaci√≥n de dos factores.
2. Cierra sesi√≥n en esa cuenta.
3. Ahora, ve a la p√°gina de restablecimiento de contrase√±a.
4. Cambia tu contrase√±a.
5. Intenta iniciar sesi√≥n ahora.
6. Si no se te solicita ingresar un c√≥digo de autenticaci√≥n de dos factores, puedes informarlo.

## Referencias

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
