# Toma de control de cuenta

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Problema de autorizaci贸n**

Se debe intentar cambiar el correo electr贸nico de una cuenta, y se debe examinar el proceso de confirmaci贸n. Si se encuentra d茅bil, el correo electr贸nico debe cambiarse por el del objetivo y luego confirmarse.

## **Problema de Normalizaci贸n Unicode**

1. La cuenta del objetivo `victim@gmail.com`
2. Se debe crear una cuenta utilizando Unicode\
por ejemplo: `vitim@gmail.com`

Para m谩s detalles, consulta el documento sobre Normalizaci贸n Unicode:

[unicode-normalization.md](unicode-injection/unicode-normalization.md)

## **Reutilizaci贸n de Token de Restablecimiento**

Si el sistema objetivo permite que el **enlace de restablecimiento se reutilice**, se deben realizar esfuerzos para **encontrar m谩s enlaces de restablecimiento** utilizando herramientas como `gau`, `wayback` o `scan.io`.

## **Antes de la Toma de Control de Cuenta**

1. Se debe utilizar el correo electr贸nico de la v铆ctima para registrarse en la plataforma y se debe establecer una contrase帽a (se debe intentar confirmarla, aunque la falta de acceso a los correos electr贸nicos de la v铆ctima podr铆a hacer que esto sea imposible).
2. Se debe esperar a que la v铆ctima se registre utilizando OAuth y confirme la cuenta.
3. Se espera que el registro regular se confirme, lo que permitir谩 acceder a la cuenta de la v铆ctima.

## **Configuraci贸n incorrecta de CORS para la Toma de Control de Cuenta**

Si la p谩gina contiene **configuraciones incorrectas de CORS**, es posible que se pueda **robar informaci贸n sensible** del usuario para **tomar el control de su cuenta** o hacer que cambie la informaci贸n de autenticaci贸n con el mismo prop贸sito:

{% content-ref url="cors-bypass.md" %}
[cors-bypass.md](cors-bypass.md)
{% endcontent-ref %}

## **CSRF para la Toma de Control de Cuenta**

Si la p谩gina es vulnerable a CSRF, es posible que se pueda hacer que el **usuario modifique su contrase帽a**, correo electr贸nico o autenticaci贸n para luego acceder a ella:

{% content-ref url="csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

## **XSS para la Toma de Control de Cuenta**

Si encuentras un XSS en la aplicaci贸n, es posible que puedas robar cookies, almacenamiento local o informaci贸n de la p谩gina web que podr铆a permitirte tomar el control de la cuenta:

{% content-ref url="xss-cross-site-scripting/" %}
[xss-cross-site-scripting](xss-cross-site-scripting/)
{% endcontent-ref %}

## **Mismo Origen + Cookies**

Si encuentras un XSS limitado o tomas el control de un subdominio, podr铆as jugar con las cookies (fijarlas, por ejemplo) para intentar comprometer la cuenta de la v铆ctima:

{% content-ref url="hacking-with-cookies/" %}
[hacking-with-cookies](hacking-with-cookies/)
{% endcontent-ref %}

## **Atacando el Mecanismo de Restablecimiento de Contrase帽a**

{% content-ref url="reset-password.md" %}
[reset-password.md](reset-password.md)
{% endcontent-ref %}

## **Manipulaci贸n de Respuesta**

Si la respuesta de autenticaci贸n se puede **reducir a un simple booleano, intenta cambiar false por true** y verifica si obtienes acceso.

## OAuth para la Toma de Control de Cuenta

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

## Inyecci贸n de Cabecera de Host

1. Se modifica la cabecera de Host al iniciar una solicitud de restablecimiento de contrase帽a.
2. Se altera la cabecera de proxy `X-Forwarded-For` a `attacker.com`.
3. Las cabeceras de Host, Referrer y Origin se cambian simult谩neamente a `attacker.com`.
4. Despu茅s de iniciar un restablecimiento de contrase帽a y luego optar por reenviar el correo, se emplean los tres m茅todos mencionados anteriormente.

## Manipulaci贸n de Respuesta

1. **Manipulaci贸n de C贸digo**: Se cambia el c贸digo de estado a `200 OK`.
2. **Manipulaci贸n de C贸digo y Cuerpo**:
* Se cambia el c贸digo de estado a `200 OK`.
* Se modifica el cuerpo de la respuesta a `{"success":true}` o a un objeto vac铆o `{}`.

Estas t茅cnicas de manipulaci贸n son efectivas en escenarios donde se utiliza JSON para la transmisi贸n y recepci贸n de datos.

## Cambiar el correo electr贸nico de la sesi贸n actual

Desde [este informe](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

* El atacante solicita cambiar su correo electr贸nico por uno nuevo.
* El atacante recibe un enlace para confirmar el cambio de correo electr贸nico.
* El atacante env铆a al v铆ctima el enlace para que haga clic en 茅l.
* El correo electr贸nico de la v铆ctima se cambia al indicado por el atacante.
* El atacante puede recuperar la contrase帽a y tomar el control de la cuenta.

Esto tambi茅n ocurri贸 en [**este informe**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).

## Referencias

* [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
* [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
