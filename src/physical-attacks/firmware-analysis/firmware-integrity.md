{{#include ../../banners/hacktricks-training.md}}

## Цілісність ПЗ

**Користувацьке ПЗ та/або скомпільовані двійкові файли можуть бути завантажені для використання вразливостей перевірки цілісності або підпису**. Наступні кроки можна виконати для компіляції бекдор бінд шелу:

1. ПЗ можна витягти за допомогою firmware-mod-kit (FMK).
2. Слід визначити архітектуру цільового ПЗ та порядок байтів.
3. Можна створити крос-компілятор за допомогою Buildroot або інших відповідних методів для середовища.
4. Бекдор можна створити за допомогою крос-компілятора.
5. Бекдор можна скопіювати до витягнутого ПЗ в директорію /usr/bin.
6. Відповідний двійковий файл QEMU можна скопіювати до кореневої файлової системи витягнутого ПЗ.
7. Бекдор можна емуляувати за допомогою chroot та QEMU.
8. До бекдору можна отримати доступ через netcat.
9. Двійковий файл QEMU слід видалити з кореневої файлової системи витягнутого ПЗ.
10. Модифіковане ПЗ можна повторно упакувати за допомогою FMK.
11. Бекдоре ПЗ можна протестувати, емуляуючи його за допомогою інструменту аналізу ПЗ (FAT) та підключаючись до цільової IP-адреси та порту бекдору за допомогою netcat.

Якщо кореневий шел вже був отриманий через динамічний аналіз, маніпуляцію завантажувачем або тестування апаратної безпеки, можна виконати попередньо скомпільовані шкідливі двійкові файли, такі як імпланти або реверс шелли. Автоматизовані інструменти для завантаження/імплантації, такі як фреймворк Metasploit та 'msfvenom', можна використовувати за наступними кроками:

1. Слід визначити архітектуру цільового ПЗ та порядок байтів.
2. Msfvenom можна використовувати для вказівки цільового корисного навантаження, IP-адреси атакуючого хоста, номера порту для прослуховування, типу файлу, архітектури, платформи та вихідного файлу.
3. Корисне навантаження можна передати на скомпрометований пристрій та переконатися, що воно має права на виконання.
4. Metasploit можна підготувати для обробки вхідних запитів, запустивши msfconsole та налаштувавши параметри відповідно до корисного навантаження.
5. Реверсний шел meterpreter можна виконати на скомпрометованому пристрої.
6. Сесії meterpreter можна моніторити, коли вони відкриваються.
7. Можна виконувати дії після експлуатації.

Якщо можливо, вразливості в скриптах запуску можна використовувати для отримання постійного доступу до пристрою під час перезавантажень. Ці вразливості виникають, коли скрипти запуску посилаються, [символічно посилаються](https://www.chromium.org/chromium-os/chromiumos-design-docs/hardening-against-malicious-stateful-data) або залежать від коду, розташованого в ненадійних змонтованих місцях, таких як SD-карти та флеш-обсяги, що використовуються для зберігання даних поза кореневими файловими системами.

## Посилання

- Для отримання додаткової інформації перегляньте [https://scriptingxss.gitbook.io/firmware-security-testing-methodology/](https://scriptingxss.gitbook.io/firmware-security-testing-methodology/)

{{#include ../../banners/hacktricks-training.md}}
