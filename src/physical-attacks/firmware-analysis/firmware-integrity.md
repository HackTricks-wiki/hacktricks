{{#include ../../banners/hacktricks-training.md}}

## ファームウェアの整合性

**カスタムファームウェアおよび/またはコンパイルされたバイナリは、整合性または署名検証の欠陥を悪用するためにアップロードできます**。バックドアバインドシェルのコンパイルには以下の手順を実行できます：

1. ファームウェアはfirmware-mod-kit (FMK)を使用して抽出できます。
2. 対象のファームウェアアーキテクチャとエンディアンネスを特定する必要があります。
3. 環境に適した方法でBuildrootを使用してクロスコンパイラを構築できます。
4. クロスコンパイラを使用してバックドアを構築できます。
5. バックドアは抽出されたファームウェアの/usr/binディレクトリにコピーできます。
6. 適切なQEMUバイナリは抽出されたファームウェアのrootfsにコピーできます。
7. chrootとQEMUを使用してバックドアをエミュレートできます。
8. netcatを介してバックドアにアクセスできます。
9. QEMUバイナリは抽出されたファームウェアのrootfsから削除する必要があります。
10. 修正されたファームウェアはFMKを使用して再パッケージ化できます。
11. バックドア付きファームウェアは、ファームウェア分析ツールキット（FAT）を使用してエミュレートし、netcatを使用してターゲットバックドアのIPとポートに接続することでテストできます。

動的分析、ブートローダー操作、またはハードウェアセキュリティテストを通じてルートシェルがすでに取得されている場合、インプラントやリバースシェルなどの事前コンパイルされた悪意のあるバイナリを実行できます。Metasploitフレームワークや'msfvenom'のような自動化されたペイロード/インプラントツールは、以下の手順を使用して活用できます：

1. 対象のファームウェアアーキテクチャとエンディアンネスを特定する必要があります。
2. Msfvenomを使用して、ターゲットペイロード、攻撃者ホストIP、リスニングポート番号、ファイルタイプ、アーキテクチャ、プラットフォーム、および出力ファイルを指定できます。
3. ペイロードは侵害されたデバイスに転送され、実行権限があることを確認する必要があります。
4. Metasploitはmsfconsoleを起動し、ペイロードに応じて設定を構成することで、受信リクエストを処理する準備をします。
5. 侵害されたデバイスでmeterpreterリバースシェルを実行できます。
6. meterpreterセッションが開くときに監視できます。
7. ポストエクスプロイト活動を実行できます。

可能であれば、起動スクリプト内の脆弱性を悪用して、再起動を通じてデバイスへの持続的なアクセスを取得できます。これらの脆弱性は、起動スクリプトが信頼できないマウントされた場所（SDカードやルートファイルシステムの外にデータを保存するために使用されるフラッシュボリュームなど）にあるコードを参照、[シンボリックリンク](https://www.chromium.org/chromium-os/chromiumos-design-docs/hardening-against-malicious-stateful-data)または依存する場合に発生します。

## 参考文献

- 詳細情報は[https://scriptingxss.gitbook.io/firmware-security-testing-methodology/](https://scriptingxss.gitbook.io/firmware-security-testing-methodology/)を確認してください。

{{#include ../../banners/hacktricks-training.md}}
