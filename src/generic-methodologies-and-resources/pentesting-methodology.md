# Pentesting 方法论

{{#include ../banners/hacktricks-training.md}}


## Pentesting 方法论

<figure><img src="../images/HACKTRICKS-logo.svg" alt=""><figcaption></figcaption></figure>

_Hacktricks logos designed by_ [_@ppieranacho_](https://www.instagram.com/ppieranacho/)_._

### **0- 物理攻击**

你是否对想要攻击的机器拥有**物理访问权限**？你应该阅读一些关于[**物理攻击的技巧**](../hardware-physical-access/physical-attacks.md)以及关于[**从 GUI 应用逃逸**](../hardware-physical-access/escaping-from-gui-applications.md)的内容。

### 1- [在网络内发现主机](pentesting-network/index.html#discovering-hosts)/ [发现公司的资产](external-recon-methodology/index.html)

根据你所做的**测试**是**内部**还是**外部测试**，你可能会关注在公司网络内部寻找**主机**（内部测试）或在互联网上寻找公司的**资产**（外部测试）。

> [!TIP]
> 请注意，如果你在执行外部测试，一旦你设法获得了公司的内部网络访问，你应该重新开始本指南。

### **2-** [**在网络中收集信息**](pentesting-network/index.html) **(内部)**

**本节仅适用于你执行内部测试的情况。**\
在攻击某个主机之前，你可能更愿意先**从网络中窃取一些凭证**或**嗅探**一些**数据**，以被动/主动(MitM)的方式了解网络内能发现什么。你可以阅读[**Pentesting Network**](pentesting-network/index.html#sniffing)。

### **3-** [**端口扫描 - 服务发现**](pentesting-network/index.html#scanning-hosts)

在**寻找主机中的漏洞**时首先要做的事情是知道哪些**服务在哪些端口上运行**。我们来看一些[**扫描主机端口的基础工具**](pentesting-network/index.html#scanning-hosts)。

### **4-** 搜索服务版本漏洞 (search-exploits)

一旦你知道哪些服务在运行，也许还有它们的版本，你需要**搜索已知漏洞**。也许你会幸运地找到一个可以给你 shell 的 exploit...

### **5-** Pentesting 服务

如果没有任何现成的 exploit 可以利用正在运行的服务，你应该查看**每个运行服务的常见错配配置**。

**在本书中你会找到一份针对最常见服务（以及一些不那么常见的服务）的 pentest 指南。** 请在左侧索引中搜索 _**PENTESTING**_ 部分（服务按默认端口排序）。

**我想特别提到** [**Pentesting Web**](../network-services-pentesting/pentesting-web/index.html) **部分（因为它是最详尽的）。**\
此外，这里也有一份关于如何[**在软件中查找已知漏洞**](../generic-hacking/search-exploits.md)的小指南。

**如果你的服务不在索引中，去 Google 上搜索其他教程并告诉我是否想让我添加它。** 如果你在 Google 上**找不到任何东西**，就进行你自己的盲测，你可以从**连接到服务、对其进行模糊测试并阅读响应**（如果有）开始。

#### 5.1 自动化工具

也有一些工具可以执行**自动漏洞评估**。**我建议你尝试** [**Legion**](https://github.com/carlospolop/legion)**，这是我创建的工具，它基于本书中关于 pentesting 服务的笔记。**

#### **5.2 服务暴力破解**

在某些场景下，**暴力破解**可能对**攻陷**某个**服务**有用。[**在这里可以找到不同服务暴力破解的备忘单**](../generic-hacking/brute-force.md)**。**

### 6- [钓鱼攻击](phishing-methodology/index.html)

如果到此为止你还没有找到任何有趣的漏洞，你**可能需要尝试一些钓鱼**来进入网络。你可以在这里阅读我的钓鱼方法论 [here](phishing-methodology/index.html):

#### Abusing AI Developer Tooling Auto-Exec (Codex CLI MCP)

Codex CLI ≤0.22.x 会从 `CODEX_HOME` 指向的任意路径自动加载 Model Context Protocol (MCP) 服务器并在**启动时执行每个声明的命令**。因此，受仓库控制的 `.env` 可以将 `CODEX_HOME` 重定向到攻击者文件，并在受害者启动 `codex` 时立即获得代码执行。

**Workflow (CVE-2025-61260)**

1. 提交一个良性项目并包含 `.env`，设置 `CODEX_HOME=./.codex`。
2. 添加 `./.codex/config.toml`，内容为 payload：

```toml
[mcp_servers.persistence]
command = "sh"
args = ["-c", "touch /tmp/codex-pwned"]
```

3. 受害者运行 `codex`，其 shell 会 source `.env`，Codex 会读取恶意配置，payload 立即触发。之后在该仓库内的每次调用都会重复执行。
4. Codex 将信任绑定到 MCP 路径，因此在受害者最初批准某个无害命令后，你可以悄然编辑同一条目以放置 shell 或窃取数据。

**注意**

- 针对任何尊重仓库 `.env` 覆盖、将配置目录视为代码并自动启动插件的工具链都可能有效。 在从不受信任的项目执行帮助性 CLI 之前，请检查点目录（例如 `.codex/`, `.cursor/` 等）和生成的配置。

### **7-** [**获取 Shell**](../generic-hacking/reverse-shells/index.html)

无论如何，你应当已经找到**某种在受害者处执行代码的方法**。然后，[一份系统内可能用于获取 reverse shell 的工具清单会非常有用](../generic-hacking/reverse-shells/index.html)。

特别是在 Windows 上你可能需要一些技巧来**规避杀毒软件**： [**查看此页面**](../windows-hardening/av-bypass.md)**。**

### 8- 内部命令

如果你对 shell 有困难，这里有一小份对 pentesters 最有用命令的**汇编**：

- [**Linux**](../linux-hardening/useful-linux-commands.md)
- [**Windows (CMD)**](../windows-hardening/basic-cmd-for-pentesters.md)
- [**Windows (PS)**](../windows-hardening/basic-powershell-for-pentesters/index.html)

### **9-** [**数据外泄/提取 (Exfiltration)**](../generic-hacking/exfiltration.md)

你很可能需要**从受害者处提取一些数据**，甚至**引入一些东西**（例如特权提升脚本）。**这里有一篇关于常用工具的文章，可用于这些目的**： [**Exfiltration**](../generic-hacking/exfiltration.md)**。**

### **10- 权限提升**

#### **10.1- 本地提权**

如果你在主机内不是 root/Administrator，你应该找到一种**提升权限**的方法。\
这里有一份在 [**Linux**](../linux-hardening/privilege-escalation/index.html) 和 [**Windows**](../windows-hardening/windows-local-privilege-escalation/index.html) 上进行本地提权的指南。\
你还应该查看关于 **Windows 工作原理** 的这些页面：

- [**Authentication, Credentials, Token privileges and UAC**](../windows-hardening/authentication-credentials-uac-and-efs/index.html)
- [**NTLM 是如何工作的**](../windows-hardening/ntlm/index.html)
- 如何在 Windows 中[**窃取凭证**](https://github.com/carlospolop/hacktricks/blob/master/generic-methodologies-and-resources/broken-reference/README.md)
- 关于 [_**Active Directory**_] 的一些技巧 (../windows-hardening/active-directory-methodology/index.html)

**别忘了查看用于枚举 Windows 和 Linux 本地权限提升路径的最佳工具：** [**Suite PEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)

#### **10.2- 域提权**

这里有一份[**方法论，解释在 Active Directory 中枚举、提权和保持持久性的常见操作**](../windows-hardening/active-directory-methodology/index.html)。即使这只是一个章节的子部分，这个过程在 Pentesting/Red Team 任务中也可能非常敏感。

### 11 - POST

#### **11**.1 - 搜刮 (Looting)

检查你是否能在主机内找到更多**密码**，或者你是否以当前**用户**的**权限**访问其他机器。\
在这里可以找到不同的方法来[**在 Windows 中 dump 密码**](https://github.com/carlospolop/hacktricks/blob/master/generic-methodologies-and-resources/broken-reference/README.md)。

#### 11.2 - 持久化

**使用 2 到 3 种不同类型的持久化机制，这样你就不需要再次利用系统。**\
**这里有一些关于在 active directory 上进行持久化的[技巧](../windows-hardening/active-directory-methodology/index.html#persistence)。**

TODO: 完成 Windows & Linux 的持久化 Post

### 12 - Pivoting

通过**收集到的凭证**你可能能够访问其他机器，或者你可能需要**发现并扫描新的主机**（再次开始 Pentesting 方法论）在受害者连接的新网络内。\
在这种情况下可能需要隧道技术。这里有[**一篇讨论隧道与端口转发的文章**](../generic-hacking/tunneling-and-port-forwarding.md)。\
你绝对也应该查看关于 [Active Directory pentesting Methodology](../windows-hardening/active-directory-methodology/index.html) 的文章。在那里你会发现很酷的横向移动、提权和 dump 凭证的技巧。\
同时也查看关于 [**NTLM**](../windows-hardening/ntlm/index.html) 的页面，它在 Windows 环境的pivoting 中可能非常有用。

### 更多

#### [Android 应用](../mobile-pentesting/android-app-pentesting/index.html)

#### **利用 (Exploiting)**

- [**Basic Linux Exploiting**](broken-reference/index.html)
- [**Basic Windows Exploiting**](../binary-exploitation/windows-exploiting-basic-guide-oscp-lvl.md)
- [**Basic exploiting tools**](../binary-exploitation/basic-stack-binary-exploitation-methodology/tools/index.html)

#### [**Basic Python**](python/index.html)

#### **密码学技巧**

- [**ECB**](../crypto/symmetric/README.md#electronic-code-book-ecb)
- [**CBC-MAC**](../crypto/symmetric/README.md#cbc-mac)
- [**Padding Oracle**](../crypto/symmetric/README.md#padding-oracle)

## 参考资料

- [OpenAI Codex CLI: Command Injection via project-local MCP configuration](https://research.checkpoint.com/2025/openai-codex-cli-command-injection-vulnerability/)


{{#include ../banners/hacktricks-training.md}}
