# Evil Twin EAP-TLS

{{#include ../../banners/hacktricks-training.md}}

EAP-TLS आमतौर पर WPA2/3-Enterprise के लिए "secure" विकल्प है, लेकिन assessments के दौरान दो व्यावहारिक कमजोरियाँ नियमित रूप से सामने आती हैं:

- **Unauthenticated identity leakage**: outer EAP-Response/Identity किसी भी TLS tunnel के बन जाने से पहले cleartext में भेजा जाता है, इसलिए real domain usernames अक्सर हवा में leak हो जाते हैं।
- **Broken client server-validation**: अगर supplicant RADIUS server certificate को सख्ती से verify नहीं करता (या users को warnings पर click-through करने देता है), तो एक rogue AP self-signed cert के साथ अभी भी victims को onboard कर सकता है – mutual TLS को one-way TLS में बदल देता है।

## Unauthenticated EAP identity leakage / username enumeration

EAP एक identity exchange चलाता है *before* TLS शुरू होने के। अगर client अपने outer identity के रूप में real domain username इस्तेमाल करता है, तो RF range में कोई भी बिना authenticating किए उसे harvest कर सकता है।

**Passive harvest workflow**
```bash
# 1) Park on the right channel/BSSID
airodump-ng -i $IFACE -c $CHAN --bssid $BSSID

# 2) Decode EAP frames and extract identities
# Trigger a client connection (e.g., your phone) to see the leak
tshark -i "$IFACE" -Y eap -V | grep "Identity: *[a-z]\|*[A-Z]\|*[0-9]"
```
प्रभाव: तेज, बिना-प्रमाणीकरण उपयोगकर्ता नाम संग्रह → password spraying, phishing, account correlation को बढ़ावा देता है। यह और भी खराब होता है जब उपयोगकर्ता नाम ईमेल पते से मेल खाते हों।

## Evil Twin टूटे हुए सर्वर सत्यापन के माध्यम से ("mTLS?")

Rogue APs जो corporate SSID ब्रॉडकास्ट कर रहे हैं कोई भी सर्टिफिकेट पेश कर सकते हैं। यदि क्लाइंट:
- **सर्वर सर्टिफिकेट का सत्यापन नहीं करता**, या
- **उपयोगकर्ता से अनुमति माँगता है** और अनविश्वसनीय CAs/self-signed सर्टिफिकेट्स को ओवरराइड करने की अनुमति देता है,
तो EAP-TLS परस्पर होना बंद हो जाता है। एक संशोधित **hostapd/hostapd-wpe** जो client-cert सत्यापन छोड़ देता है (उदाहरण के लिए, `SSL_set_verify(..., 0)`) Evil Twin खड़ा करने के लिए पर्याप्त है।

### Rogue infra त्वरित नोट

हाल की Kali पर, hostapd-2.6 (from https://w1.fi/releases/) का उपयोग करके `hostapd-wpe` को कंपाइल करें और पहले legacy OpenSSL headers इंस्टॉल करें:
```bash
apt-get install libssl1.0-dev
# patch hostapd-wpe to set verify_peer=0 in SSL_set_verify to accept any client cert
```
### Windows supplicant misconfig pitfalls (GUI/GPO)

Key knobs from the Windows EAP-TLS profile:
- **Verify the server's identity by validating the certificate**
- Checked → chain must be trusted; unchecked → any self-signed cert is accepted.
- **Connect to these servers**
- Empty → any cert from a trusted CA is accepted; set CN/SAN list to pin expected RADIUS names.
- **Don't prompt user to authorise new servers or trusted certification authorities**
- Checked → users cannot click through; unchecked → user can trust an untrusted CA/cert and join the rogue AP.

Observed outcomes:
- **Strict validation + no prompts** → rogue cert rejected; Windows logs an event and TLS fails (good detection signal).
- **Validation + user prompt** → user acceptance = successful Evil Twin association.
- **No validation** → silent Evil Twin association with any cert.

## References

- [EAP-TLS: The most secure option? (NCC Group)](https://www.nccgroup.com/research-blog/eap-tls-the-most-secure-option/)
- [EAP-TLS wireless infrastructure (Versprite hostapd bypass)](https://versprite.com/blog/eap-tls-wireless-infrastructure/)
- [RFC 4282 - Network Access Identifier](https://datatracker.ietf.org/doc/html/rfc4282)
- [Microsoft ServerValidationParameters (WLAN profile)](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-gpwl/0765966e-a16a-4e75-aec6-0f5f7bfbf31c)

{{#include ../../banners/hacktricks-training.md}}
