# Evil Twin EAP-TLS

{{#include ../../banners/hacktricks-training.md}}



U nekom trenutku bilo je potrebno koristiti predloženo rešenje iz posta ispod, ali koraci u [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) više nisu radili u modernom kali (2019v3).\
U svakom slučaju, lako je naterati ih da rade.\
Samo je potrebno preuzeti hostapd-2.6 odavde: [https://w1.fi/releases/](https://w1.fi/releases/) i pre ponovne kompilacije hostapd-wpe instalirati: `apt-get install libssl1.0-dev`

### Analyzing and Exploiting EAP-TLS in Wireless Networks

#### Background: EAP-TLS in Wireless Networks

EAP-TLS je bezbednosni protokol koji pruža uzajamnu autentifikaciju između klijenta i servera koristeći sertifikate. Veza se uspostavlja samo ako klijent i server autentifikuju sertifikate jedni drugih.

#### Challenge Encountered

Tokom procene, naišao je na zanimljivu grešku prilikom korišćenja alata `hostapd-wpe`. Alat je odbio vezu klijenta zbog toga što je sertifikat klijenta potpisan od strane nepoznate sertifikacione vlasti (CA). To je ukazalo na to da klijent veruje sertifikatu lažnog servera, što ukazuje na labave bezbednosne konfiguracije na strani klijenta.

#### Objective: Setting Up a Man-in-the-Middle (MiTM) Attack

Cilj je bio modifikovati alat da prihvati bilo koji sertifikat klijenta. To bi omogućilo uspostavljanje veze sa zloćudnom bežičnom mrežom i omogućilo MiTM napad, potencijalno hvatajući plaintext akreditive ili druge osetljive podatke.

#### Solution: Modifying `hostapd-wpe`

Analiza izvornog koda `hostapd-wpe` otkrila je da je validacija sertifikata klijenta kontrolisana parametrima (`verify_peer`) u OpenSSL funkciji `SSL_set_verify`. Promenom vrednosti ovog parametra sa 1 (validirati) na 0 (ne validirati), alat je bio podešen da prihvati bilo koji sertifikat klijenta.

#### Execution of the Attack

1. **Environment Check:** Koristite `airodump-ng` za praćenje bežičnih mreža i identifikaciju ciljeva.
2. **Set Up Fake AP:** Pokrenite modifikovani `hostapd-wpe` da kreirate lažni pristupni tačku (AP) koji imitira ciljanju mrežu.
3. **Captive Portal Customization:** Prilagodite stranicu za prijavu na captive portal da izgleda legitimno i poznato ciljanom korisniku.
4. **De-authentication Attack:** Opcionalno, izvršite de-auth napad da isključite klijenta iz legitimne mreže i povežete ga sa lažnim AP.
5. **Capturing Credentials:** Kada se klijent poveže na lažni AP i interaguje sa captive portalom, njihovi akreditive se hvataju.

#### Observations from the Attack

- Na Windows mašinama, sistem može automatski da se poveže na lažni AP, prikazujući captive portal kada se pokuša web navigacija.
- Na iPhone-u, korisnik može biti upitan da prihvati novi sertifikat, a zatim mu se prikazuje captive portal.

#### Conclusion

Iako se EAP-TLS smatra sigurnim, njegova efikasnost u velikoj meri zavisi od ispravne konfiguracije i opreznog ponašanja krajnjih korisnika. Pogrešno konfigurisani uređaji ili nesvesni korisnici koji prihvataju lažne sertifikate mogu oslabiti bezbednost mreže zaštićene EAP-TLS.

For further details check https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## References

- [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)



{{#include ../../banners/hacktricks-training.md}}
