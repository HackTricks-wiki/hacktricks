# Evil Twin EAP-TLS

{{#include ../../banners/hacktricks-training.md}}

Το EAP-TLS είναι η συνήθης «secure» επιλογή για WPA2/3-Enterprise, αλλά δύο πρακτικές αδυναμίες εμφανίζονται τακτικά κατά τις αξιολογήσεις:

- **Unauthenticated identity leakage**: το εξωτερικό EAP-Response/Identity αποστέλλεται σε cleartext πριν καν χτιστεί TLS tunnel, οπότε οι πραγματικοί domain usernames συχνά leak μέσω του αέρα.
- **Broken client server-validation**: εάν ο supplicant δεν επαληθεύει αυστηρά το RADIUS server certificate (ή επιτρέπει στους χρήστες να αποδέχονται warnings), ένα rogue AP με self-signed cert μπορεί ακόμα να onboard-άρει θύματα — μετατρέποντας το mutual TLS σε one-way TLS.

## Unauthenticated EAP identity leakage / username enumeration

Το EAP πραγματοποιεί μια ανταλλαγή ταυτότητας *πριν* ξεκινήσει το TLS. Εάν ο client χρησιμοποιεί το πραγματικό domain username ως εξωτερική του ταυτότητα, οποιοσδήποτε εντός της RF εμβέλειας μπορεί να το συλλέξει χωρίς να αυθεντικοποιηθεί.

**Passive harvest workflow**
```bash
# 1) Park on the right channel/BSSID
airodump-ng -i $IFACE -c $CHAN --bssid $BSSID

# 2) Decode EAP frames and extract identities
# Trigger a client connection (e.g., your phone) to see the leak
tshark -i "$IFACE" -Y eap -V | grep "Identity: *[a-z]\|*[A-Z]\|*[0-9]"
```
Επίπτωση: γρήγορη συλλογή ονομάτων χρήστη χωρίς αυθεντικοποίηση (no-auth) → τροφοδοτεί password spraying, phishing, account correlation. Χειρότερα όταν τα ονόματα χρήστη ταιριάζουν με διευθύνσεις email.

## Evil Twin μέσω κατεστραμμένης επικύρωσης διακομιστή ("mTLS?")

Rogue APs που εκπέμπουν το εταιρικό SSID μπορούν να παρουσιάσουν οποιοδήποτε πιστοποιητικό. Εάν ο client:
- **δεν επαληθεύει** το πιστοποιητικό του διακομιστή, ή
- **ζητάει από τον χρήστη** και επιτρέπει την παράκαμψη μη αξιόπιστων CAs/self-signed certs,
τότε το EAP-TLS παύει να είναι αμοιβαίο. Ένα τροποποιημένο **hostapd/hostapd-wpe** που παραλείπει την επικύρωση client-cert (π.χ. `SSL_set_verify(..., 0)`) αρκεί για να στηθεί το Evil Twin.

### Σύντομη σημείωση για Rogue infra

Σε πρόσφατο Kali, μεταγλωττίστε το `hostapd-wpe` χρησιμοποιώντας hostapd-2.6 (από https://w1.fi/releases/) και εγκαταστήστε πρώτα τα legacy OpenSSL headers:
```bash
apt-get install libssl1.0-dev
# patch hostapd-wpe to set verify_peer=0 in SSL_set_verify to accept any client cert
```
### Παγίδες λανθασμένης διαμόρφωσης του Windows supplicant (GUI/GPO)

Key knobs from the Windows EAP-TLS profile:
- **Verify the server's identity by validating the certificate**
- Επιλεγμένο → η αλυσίδα πρέπει να είναι trusted; Μη επιλεγμένο → any self-signed cert γίνεται αποδεκτό.
- **Connect to these servers**
- Κενό → any cert από μια trusted CA γίνεται αποδεκτό; ορίστε λίστα CN/SAN για να pin-άρετε τα αναμενόμενα RADIUS ονόματα.
- **Don't prompt user to authorise new servers or trusted certification authorities**
- Επιλεγμένο → οι χρήστες δεν μπορούν να κάνουν click-through; Μη επιλεγμένο → ο χρήστης μπορεί να εμπιστευτεί μια untrusted CA/cert και να ενταχθεί στον rogue AP.

Observed outcomes:
- **Strict validation + no prompts** → rogue cert απορρίπτεται; Windows καταγράφει ένα event και το TLS αποτυγχάνει (καλό σήμα ανίχνευσης).
- **Validation + user prompt** → αποδοχή χρήστη = επιτυχής Evil Twin σύνδεση.
- **No validation** → αθόρυβη Evil Twin σύνδεση με οποιοδήποτε cert.

## References

- [EAP-TLS: The most secure option? (NCC Group)](https://www.nccgroup.com/research-blog/eap-tls-the-most-secure-option/)
- [EAP-TLS wireless infrastructure (Versprite hostapd bypass)](https://versprite.com/blog/eap-tls-wireless-infrastructure/)
- [RFC 4282 - Network Access Identifier](https://datatracker.ietf.org/doc/html/rfc4282)
- [Microsoft ServerValidationParameters (WLAN profile)](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-gpwl/0765966e-a16a-4e75-aec6-0f5f7bfbf31c)

{{#include ../../banners/hacktricks-training.md}}
