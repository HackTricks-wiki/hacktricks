# Evil Twin EAP-TLS

{{#include ../../banners/hacktricks-training.md}}

在某个时候，我需要使用下面帖子中提出的解决方案，但[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)中的步骤在现代Kali（2019v3）中不再有效。\
无论如何，让它们工作很简单。\
您只需从这里下载hostapd-2.6：[https://w1.fi/releases/](https://w1.fi/releases/)，并在重新编译hostapd-wpe之前安装：`apt-get install libssl1.0-dev`

### Analyzing and Exploiting EAP-TLS in Wireless Networks

#### Background: EAP-TLS in Wireless Networks

EAP-TLS是一种安全协议，通过使用证书在客户端和服务器之间提供相互认证。只有在客户端和服务器相互验证对方的证书后，连接才会建立。

#### Challenge Encountered

在评估过程中，使用`hostapd-wpe`工具时遇到了一个有趣的错误。该工具拒绝了客户端的连接，因为客户端的证书是由一个未知的证书颁发机构（CA）签署的。这表明客户端确实信任假服务器的证书，指向客户端侧安全配置松懈。

#### Objective: Setting Up a Man-in-the-Middle (MiTM) Attack

目标是修改该工具以接受任何客户端证书。这将允许与恶意无线网络建立连接，并启用MiTM攻击，可能捕获明文凭据或其他敏感数据。

#### Solution: Modifying `hostapd-wpe`

对`hostapd-wpe`源代码的分析显示，客户端证书验证由OpenSSL函数`SSL_set_verify`中的一个参数（`verify_peer`）控制。通过将该参数的值从1（验证）更改为0（不验证），该工具被修改为接受任何客户端证书。

#### Execution of the Attack

1. **Environment Check:** 使用`airodump-ng`监控无线网络并识别目标。
2. **Set Up Fake AP:** 运行修改后的`hostapd-wpe`以创建一个模仿目标网络的假接入点（AP）。
3. **Captive Portal Customization:** 自定义登录页面，使其看起来合法且熟悉目标用户。
4. **De-authentication Attack:** 可选地执行去认证攻击，以使客户端与合法网络断开连接并连接到假AP。
5. **Capturing Credentials:** 一旦客户端连接到假AP并与强制门户互动，他们的凭据就会被捕获。

#### Observations from the Attack

- 在Windows机器上，系统可能会自动连接到假AP，在尝试网页导航时呈现强制门户。
- 在iPhone上，用户可能会被提示接受新证书，然后呈现强制门户。

#### Conclusion

虽然EAP-TLS被认为是安全的，但其有效性在很大程度上依赖于正确的配置和终端用户的谨慎行为。配置错误的设备或不知情的用户接受恶意证书可能会破坏EAP-TLS保护网络的安全性。

有关更多详细信息，请查看https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## References

- [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

{{#include ../../banners/hacktricks-training.md}}
