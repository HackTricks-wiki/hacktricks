# Evil Twin EAP-TLS

{{#include ../../banners/hacktricks-training.md}}

EAP-TLS is die algemene "secure" keuse vir WPA2/3-Enterprise, maar twee praktiese swakhede verskyn gereeld tydens assesserings:

- **Unauthenticated identity leakage**: die outer EAP-Response/Identity word in cleartext gestuur voordat enige TLS tunnel opgebou is, sodat werklike domeingebruikersname dikwels oor die lug leak.
- **Broken client server-validation**: as die supplicant nie die RADIUS server certificate streng verifieer nie (of gebruikers toelaat om waarskuwings deur te klik), kan 'n rogue AP met 'n self-signed cert steeds slachtoffers onboard — wat mutual TLS in one-way TLS verander.

## Unauthenticated EAP identity leakage / username enumeration

EAP dryf 'n identiteituitruiling *voor* TLS begin. As die kliënt die werklike domeingebruikersnaam as sy outer identity gebruik, kan enigiemand binne RF-bereik dit harvest sonder om te authentiseer.

**Passive harvest workflow**
```bash
# 1) Park on the right channel/BSSID
airodump-ng -i $IFACE -c $CHAN --bssid $BSSID

# 2) Decode EAP frames and extract identities
# Trigger a client connection (e.g., your phone) to see the leak
tshark -i "$IFACE" -Y eap -V | grep "Identity: *[a-z]\|*[A-Z]\|*[0-9]"
```
Impak: vinnige, no-auth gebruikersname-versameling → voed password spraying, phishing, account correlation. Slegter wanneer gebruikersname ooreenstem met e-posadresse.

## Evil Twin via gebrekkige server-validasie ("mTLS?")

Rogue APs wat die korporatiewe SSID uitsaai kan enige sertifikaat aanbied. As die kliënt:
- **die server cert nie valideer nie**, of
- **die gebruiker vra** en toestaan om onbetroubare CAs/self-signed sertifikate te oorroep,
dan hou EAP-TLS op om mutual te wees. 'n Gewysigde **hostapd/hostapd-wpe** wat kliënt-sertifikaat-validasie oorslaan (bv., `SSL_set_verify(..., 0)`) is genoeg om die Evil Twin op te rig.

### Rogue infra - kort nota

Op onlangse Kali, kompileer `hostapd-wpe` met hostapd-2.6 (from https://w1.fi/releases/) en installeer eers die legacy OpenSSL headers:
```bash
apt-get install libssl1.0-dev
# patch hostapd-wpe to set verify_peer=0 in SSL_set_verify to accept any client cert
```
### Windows supplicant miskonfigurasie valkuils (GUI/GPO)

Belangrike knoppies van die Windows EAP-TLS profiel:
- **Verify the server's identity by validating the certificate**
- Gekontroleer → ketting moet vertrou word; nie gekontroleer → enige self-ondertekende cert word aanvaar.
- **Connect to these servers**
- Leeg → enige cert van 'n vertroude CA word aanvaar; stel CN/SAN lys om verwagte RADIUS name te pin.
- **Don't prompt user to authorise new servers or trusted certification authorities**
- Gekontroleer → gebruikers kan nie deurklik nie; nie gekontroleer → gebruiker kan 'n onbetroubare CA/cert vertrou en by die rogue AP aansluit.

Waargenome uitkomste:
- **Strict validation + no prompts** → rogue cert rejected; Windows logs an event and TLS fails (good detection signal).
- **Validation + user prompt** → user acceptance = successful Evil Twin association.
- **No validation** → silent Evil Twin association with any cert.

## References

- [EAP-TLS: The most secure option? (NCC Group)](https://www.nccgroup.com/research-blog/eap-tls-the-most-secure-option/)
- [EAP-TLS wireless infrastructure (Versprite hostapd bypass)](https://versprite.com/blog/eap-tls-wireless-infrastructure/)
- [RFC 4282 - Network Access Identifier](https://datatracker.ietf.org/doc/html/rfc4282)
- [Microsoft ServerValidationParameters (WLAN profile)](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-gpwl/0765966e-a16a-4e75-aec6-0f5f7bfbf31c)

{{#include ../../banners/hacktricks-training.md}}
