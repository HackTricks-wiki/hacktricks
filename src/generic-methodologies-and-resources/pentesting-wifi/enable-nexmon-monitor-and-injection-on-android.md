# NexMon İzleme Modunu ve Paket Enjeksiyonunu Android'de Etkinleştir (Broadcom yongaları)

{{#include ../../banners/hacktricks-training.md}}

## Genel Bakış
Çoğu modern Android telefonu, 802.11 izleme modu veya çerçeve enjeksiyon yetenekleri olmadan gönderilen bir Broadcom/Cypress Wi-Fi yongası içerir. Açık kaynak NexMon çerçevesi, bu özellikleri eklemek için özel yazılımı yamanlar ve bunları bir paylaşılan kütüphane (`libnexmon.so`) ve bir CLI yardımcı programı (`nexutil`) aracılığıyla açığa çıkarır. Bu kütüphaneyi stok Wi-Fi sürücüsüne önceden yükleyerek, köklü bir cihaz ham 802.11 trafiğini yakalayabilir ve rastgele çerçeveler enjekte edebilir – bu da harici bir USB adaptörüne olan ihtiyacı ortadan kaldırır.

Bu sayfa, tamamen yamalanmış bir Samsung Galaxy S10 (BCM4375B1) örneğini kullanarak hızlı bir iş akışını belgelemektedir:

* Yamalanmış yazılım + `libnexmon.so` içeren NexMon Magisk modülü
* İzleme modu geçişini otomatikleştirmek için Hijacker Android uygulaması
* Dahili arayüze doğrudan klasik kablosuz araçları (aircrack-ng, wifite, mdk4 …) çalıştırmak için isteğe bağlı Kali NetHunter chroot

Aynı teknik, kamuya açık bir NexMon yaması bulunan herhangi bir cep telefonuna uygulanabilir (Pixel 1, Nexus 6P, Galaxy S7/S8, vb.).

---

## Ön Koşullar
* Desteklenen bir Broadcom/Cypress yongası olan Android cep telefonu (örn. BCM4358/59/43596/4375B1)
* Magisk ≥ 24 ile kök erişimi
* BusyBox (çoğu ROM/NetHunter zaten içerir)
* Aşağıdakileri sağlayan NexMon Magisk ZIP veya kendinden derlenmiş yaman:
* `/system/lib*/libnexmon.so`
* `/system/xbin/nexutil`
* Hijacker ≥ 1.7 (arm/arm64) – [https://github.com/chrisk44/Hijacker](https://github.com/chrisk44/Hijacker)
* (İsteğe bağlı) Kali NetHunter veya kablosuz araçları çalıştırmayı düşündüğünüz herhangi bir Linux chroot

---

## NexMon yamasını flaşlama (Magisk)
1. Tam cihaz/yazılımınız için ZIP'i indirin (örnek: `nexmon-s10.zip`).
2. Magisk'i açın -> Modüller -> Depodan yükle -> ZIP'i seçin ve yeniden başlatın.
Modül, `libnexmon.so` dosyasını `/data/adb/modules/<module>/lib*/` dizinine kopyalar ve SELinux etiketlerinin doğru olduğundan emin olur.
3. Kurulumu doğrulayın:
```bash
ls -lZ $(find / -name libnexmon.so 2>/dev/null)
sha1sum $(which nexutil)
```

---

## Hijacker'ı Yapılandırma
Hijacker, `airodump`, `wifite` vb. çalıştırmadan önce izleme modunu otomatik olarak geçiştirebilir. **Ayarlar -> Gelişmiş** bölümüne aşağıdaki girişleri ekleyin (modülünüz farklıysa kütüphane yolunu düzenleyin):
```
Prefix:
LD_PRELOAD=/data/user/0/com.hijacker/files/lib/libnexmon.so

Enable monitor mode:
svc wifi disable; ifconfig wlan0 up; nexutil -s0x613 -i -v2

Disable monitor mode:
nexutil -m0; svc wifi enable
```
“Start monitor mode on airodump start” seçeneğini etkinleştirerek, her Hijacker taramasının yerel izleme modunda (`wlan0` yerine `wlan0mon`) gerçekleşmesini sağlayın.

Eğer Hijacker başlatıldığında hatalar gösteriyorsa, paylaşılan depolama alanında gerekli dizini oluşturun ve uygulamayı yeniden açın:
```bash
mkdir -p /storage/emulated/0/Hijacker
```
### Bu `nexutil` bayrakları ne anlama geliyor?
* **`-s0x613`**   Firmware değişkeni 0x613 (FCAP_FRAME_INJECTION) yaz → `1` (rastgele çerçevelerin TX'ini etkinleştir).
* **`-i`**         Arayüzü izleme moduna al (radiotap başlığı eklenecek).
* **`-v2`**        Ayrıntılı düzeyi ayarla; `2` onay ve firmware sürümünü yazdırır.
* **`-m0`**        Yönetilen modu geri yükle (kullanılan *devre dışı bırak* komutunda).

*İzleme modunu etkinleştirdikten sonra* arayüzü izleme durumunda görmeli ve ham çerçeveleri yakalamalısınız:
```bash
airodump-ng --band abg wlan0
```
---

## Manuel tek satır (Hijacker olmadan)
```bash
# Enable monitor + injection
svc wifi disable && ifconfig wlan0 up && nexutil -s0x613 -i -v2

# Disable and return to normal Wi-Fi
nexutil -m0 && svc wifi enable
```
Eğer sadece pasif sniffing'e ihtiyacınız varsa, `-s0x613` bayrağını atlayın.

---

## Kali NetHunter / chroot içinde `libnexmon` kullanma
Kali'deki stok kullanıcı alanı araçları NexMon'u tanımıyor, ancak `LD_PRELOAD` ile kullanmaya zorlayabilirsiniz:

1. Önceden derlenmiş paylaşılan nesneyi chroot içine kopyalayın:
```bash
cp /sdcard/Download/kalilibnexmon.so <chroot>/lib/
```
2. **Android ana bilgisayarı** üzerinden izleme modunu etkinleştirin (yukarıdaki komut veya Hijacker aracılığıyla).
3. Kali içinde herhangi bir kablosuz aracı preload ile başlatın:
```bash
sudo su
export LD_PRELOAD=/lib/kalilibnexmon.so
wifite -i wlan0        # veya aircrack-ng, mdk4 …
```
4. İşiniz bittiğinde, Android'de her zamanki gibi izleme modunu devre dışı bırakın.

Firmware zaten radiotap enjeksiyonunu işlediğinden, kullanıcı alanı araçları harici bir Atheros adaptörü gibi davranır.

---

## Olası Tipik Saldırılar
Monitor + TX aktif olduğunda şunları yapabilirsiniz:
* `wifite`, `hcxdumptool`, `airodump-ng` ile WPA(2/3-SAE) el sıkışmalarını veya PMKID'leri yakalayın.
* Müşterileri yeniden bağlanmaya zorlamak için deauthentication / disassociation çerçeveleri enjekte edin.
* `mdk4`, `aireplay-ng`, Scapy vb. ile keyfi yönetim/veri çerçeveleri oluşturun.
* Telefon üzerinden sahte AP'ler oluşturun veya KARMA/MANA saldırıları gerçekleştirin.

Galaxy S10'daki performans, harici USB NIC'lerle karşılaştırılabilir (~20 dBm TX, 2-3 M pps RX).

---

## Sorun Giderme
* `Device or resource busy` – izleme modunu etkinleştirmeden önce **Android Wi-Fi hizmetinin devre dışı olduğundan emin olun** (`svc wifi disable`).
* `nexutil: ioctl(PRIV_MAGIC) failed` – kütüphane önceden yüklenmemiş; `LD_PRELOAD` yolunu kontrol edin.
* Çerçeve enjeksiyonu çalışıyor ama paket yakalanmıyor – bazı ROM'lar kanalları sert bir şekilde engeller; `nexutil -c <channel>` veya `iwconfig wlan0 channel <n>` deneyin.
* SELinux kütüphaneyi engelliyor – cihazı *Permissive* olarak ayarlayın veya modül bağlamını düzeltin: `chcon u:object_r:system_lib_file:s0 libnexmon.so`.

---

## Referanslar
* [Samsung Galaxy S10'da kablosuz enjeksiyon ile Hijacker](https://forums.kali.org/t/hijacker-on-the-samsung-galaxy-s10-with-wireless-injection/10305)
* [NexMon – firmware yamanlama çerçevesi](https://github.com/seemoo-lab/nexmon)
* [Hijacker (Android için aircrack-ng GUI)](https://github.com/chrisk44/Hijacker)

{{#include ../../banners/hacktricks-training.md}}
