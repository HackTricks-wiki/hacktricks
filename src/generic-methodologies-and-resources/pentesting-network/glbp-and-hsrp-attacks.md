# GLBP & HSRP Attacks

{{#include ../../banners/hacktricks-training.md}}


## FHRP Hijacking Overview

### Insights into FHRP

FHRP को नेटवर्क की मजबूती प्रदान करने के लिए डिज़ाइन किया गया है, जो कई राउटर्स को एकल वर्चुअल यूनिट में मिलाता है, इस प्रकार लोड वितरण और दोष सहिष्णुता को बढ़ाता है। Cisco Systems ने इस सूट में प्रमुख प्रोटोकॉल पेश किए, जैसे GLBP और HSRP।

### GLBP Protocol Insights

Cisco का निर्माण, GLBP, TCP/IP स्टैक पर कार्य करता है, संचार के लिए UDP का उपयोग करते हुए पोर्ट 3222 पर। GLBP समूह में राउटर्स 3-सेकंड के अंतराल पर "hello" पैकेट्स का आदान-प्रदान करते हैं। यदि कोई राउटर 10 सेकंड के लिए इन पैकेट्स को भेजने में विफल रहता है, तो इसे ऑफ़लाइन माना जाता है। हालाँकि, ये टाइमर निश्चित नहीं होते हैं और इन्हें संशोधित किया जा सकता है।

### GLBP Operations and Load Distribution

GLBP राउटर्स के बीच लोड वितरण को सक्षम बनाकर अलग खड़ा होता है, जो एकल वर्चुअल IP के साथ कई वर्चुअल MAC पतों का उपयोग करता है। GLBP समूह में, प्रत्येक राउटर पैकेट फॉरवर्डिंग में शामिल होता है। HSRP/VRRP के विपरीत, GLBP कई तंत्रों के माध्यम से वास्तविक लोड संतुलन प्रदान करता है:

- **Host-Dependent Load Balancing:** एक होस्ट को स्थिर AVF MAC पता असाइनमेंट बनाए रखता है, जो स्थिर NAT कॉन्फ़िगरेशन के लिए आवश्यक है।
- **Round-Robin Load Balancing:** डिफ़ॉल्ट दृष्टिकोण, अनुरोध करने वाले होस्टों के बीच AVF MAC पता असाइनमेंट को वैकल्पिक करता है।
- **Weighted Round-Robin Load Balancing:** पूर्वनिर्धारित "Weight" मैट्रिक्स के आधार पर लोड वितरित करता है।

### Key Components and Terminologies in GLBP

- **AVG (Active Virtual Gateway):** मुख्य राउटर, जो समकक्ष राउटर्स को MAC पतों को आवंटित करने के लिए जिम्मेदार है।
- **AVF (Active Virtual Forwarder):** एक राउटर जिसे नेटवर्क ट्रैफ़िक प्रबंधित करने के लिए नामित किया गया है।
- **GLBP Priority:** एक मैट्रिक जो AVG को निर्धारित करता है, जो 100 के डिफ़ॉल्ट से शुरू होता है और 1 से 255 के बीच होता है।
- **GLBP Weight:** एक राउटर पर वर्तमान लोड को दर्शाता है, जिसे मैन्युअल रूप से या ऑब्जेक्ट ट्रैकिंग के माध्यम से समायोजित किया जा सकता है।
- **GLBP Virtual IP Address:** सभी जुड़े उपकरणों के लिए नेटवर्क का डिफ़ॉल्ट गेटवे के रूप में कार्य करता है।

इंटरैक्शन के लिए, GLBP आरक्षित मल्टीकास्ट पते 224.0.0.102 और UDP पोर्ट 3222 का उपयोग करता है। राउटर्स 3-सेकंड के अंतराल पर "hello" पैकेट्स भेजते हैं, और यदि 10 सेकंड के दौरान कोई पैकेट छूट जाता है, तो उन्हें गैर-कार्यात्मक माना जाता है।

### GLBP Attack Mechanism

एक हमलावर उच्चतम प्राथमिकता मान (255) के साथ GLBP पैकेट भेजकर प्राथमिक राउटर बन सकता है। इससे DoS या MITM हमले हो सकते हैं, जो ट्रैफ़िक को इंटरसेप्ट या रीडायरेक्ट करने की अनुमति देते हैं।

### Executing a GLBP Attack with Loki

[Loki](https://github.com/raizo62/loki_on_kali) एक GLBP हमले को प्राथमिकता और वजन को 255 पर सेट करके पैकेट इंजेक्ट करके कर सकता है। हमले से पहले के चरणों में वर्चुअल IP पते, प्रमाणीकरण की उपस्थिति, और राउटर प्राथमिकता मानों जैसी जानकारी इकट्ठा करना शामिल है, जैसे कि Wireshark का उपयोग करना।

Attack Steps:

1. प्रमिस्क्यूअस मोड में स्विच करें और IP फॉरवर्डिंग सक्षम करें।
2. लक्षित राउटर की पहचान करें और इसका IP प्राप्त करें।
3. एक Gratuitous ARP उत्पन्न करें।
4. AVG का अनुकरण करते हुए एक दुर्भावनापूर्ण GLBP पैकेट इंजेक्ट करें।
5. हमलावर के नेटवर्क इंटरफेस को GLBP वर्चुअल IP को दर्शाते हुए एक द्वितीयक IP पता असाइन करें।
6. पूर्ण ट्रैफ़िक दृश्यता के लिए SNAT लागू करें।
7. मूल AVG राउटर के माध्यम से निरंतर इंटरनेट एक्सेस सुनिश्चित करने के लिए रूटिंग को समायोजित करें।

इन चरणों का पालन करके, हमलावर "मैन इन द मिडल" के रूप में खुद को स्थापित करता है, जो नेटवर्क ट्रैफ़िक को इंटरसेप्ट और विश्लेषण करने में सक्षम होता है, जिसमें असुरक्षित या संवेदनशील डेटा शामिल है।

प्रदर्शन के लिए, यहां आवश्यक कमांड स्निपेट्स हैं:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
नेटवर्क ट्रैफ़िक की निगरानी और इंटरसेप्टिंग net-creds.py या समान उपकरणों का उपयोग करके किया जा सकता है ताकि समझौता किए गए नेटवर्क के माध्यम से बहने वाले डेटा को कैप्चर और विश्लेषण किया जा सके।

### HSRP हाईजैकिंग का पैसिव स्पष्टीकरण कमांड विवरण के साथ

#### HSRP (हॉट स्टैंडबाई राउटर/रिडंडेंसी प्रोटोकॉल) का अवलोकन

HSRP एक Cisco का स्वामित्व वाला प्रोटोकॉल है जिसे नेटवर्क गेटवे रिडंडेंसी के लिए डिज़ाइन किया गया है। यह एक साझा IP पते के साथ कई भौतिक राउटरों को एकल तार्किक इकाई में कॉन्फ़िगर करने की अनुमति देता है। इस तार्किक इकाई का प्रबंधन एक प्राथमिक राउटर द्वारा किया जाता है जो ट्रैफ़िक को निर्देशित करने के लिए जिम्मेदार होता है। GLBP के विपरीत, जो लोड संतुलन के लिए प्राथमिकता और वजन जैसे मैट्रिक्स का उपयोग करता है, HSRP ट्रैफ़िक प्रबंधन के लिए एकल सक्रिय राउटर पर निर्भर करता है।

#### HSRP में भूमिकाएँ और शब्दावली

- **HSRP सक्रिय राउटर**: वह उपकरण जो गेटवे के रूप में कार्य करता है, ट्रैफ़िक प्रवाह का प्रबंधन करता है।
- **HSRP स्टैंडबाई राउटर**: एक बैकअप राउटर, जो सक्रिय राउटर के विफल होने पर कार्यभार संभालने के लिए तैयार है।
- **HSRP समूह**: राउटरों का एक सेट जो एकल लचीला वर्चुअल राउटर बनाने के लिए सहयोग करता है।
- **HSRP MAC पता**: HSRP सेटअप में तार्किक राउटर को असाइन किया गया एक वर्चुअल MAC पता।
- **HSRP वर्चुअल IP पता**: HSRP समूह का वर्चुअल IP पता, जो जुड़े उपकरणों के लिए डिफ़ॉल्ट गेटवे के रूप में कार्य करता है।

#### HSRP संस्करण

HSRP दो संस्करणों में आता है, HSRPv1 और HSRPv2, जो मुख्य रूप से समूह क्षमता, मल्टीकास्ट IP उपयोग और वर्चुअल MAC पता संरचना में भिन्न होते हैं। प्रोटोकॉल सेवा जानकारी के आदान-प्रदान के लिए विशिष्ट मल्टीकास्ट IP पतों का उपयोग करता है, जिसमें हर 3 सेकंड में Hello पैकेट भेजे जाते हैं। यदि 10 सेकंड के अंतराल में कोई पैकेट प्राप्त नहीं होता है, तो राउटर को निष्क्रिय माना जाता है।

#### HSRP हमले की विधि

HSRP हमले सक्रिय राउटर की भूमिका को अधिकतम प्राथमिकता मान को इंजेक्ट करके बलात्कृत करने में शामिल होते हैं। इससे मैन-इन-द-मिडल (MITM) हमले का कारण बन सकता है। हमले से पहले के आवश्यक कदमों में HSRP सेटअप के बारे में डेटा एकत्र करना शामिल है, जिसे ट्रैफ़िक विश्लेषण के लिए Wireshark का उपयोग करके किया जा सकता है।

#### HSRP प्रमाणीकरण को बायपास करने के चरण

1. HSRP डेटा वाले नेटवर्क ट्रैफ़िक को .pcap फ़ाइल के रूप में सहेजें।
```shell
tcpdump -w hsrp_traffic.pcap
```
2. hsrp2john.py का उपयोग करके .pcap फ़ाइल से MD5 हैश निकालें।
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper का उपयोग करके MD5 हैश को क्रैक करें।
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**लोकी के साथ HSRP इंजेक्शन निष्पादित करना**

1. HSRP विज्ञापनों की पहचान करने के लिए लोकी लॉन्च करें।
2. नेटवर्क इंटरफ़ेस को प्रमिस्क्यूअस मोड में सेट करें और IP फॉरवर्डिंग सक्षम करें।
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. लोकी का उपयोग करके विशिष्ट राउटर को लक्षित करें, क्रैक किया गया HSRP पासवर्ड दर्ज करें, और सक्रिय राउटर की नकल करने के लिए आवश्यक कॉन्फ़िगरेशन करें।
4. सक्रिय राउटर की भूमिका प्राप्त करने के बाद, अपने नेटवर्क इंटरफ़ेस और IP टेबल को वैध ट्रैफ़िक को इंटरसेप्ट करने के लिए कॉन्फ़िगर करें।
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. राउटिंग टेबल को संशोधित करें ताकि ट्रैफ़िक पूर्व सक्रिय राउटर के माध्यम से रूट हो।
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. इंटरसेप्टेड ट्रैफ़िक से क्रेडेंशियल कैप्चर करने के लिए net-creds.py या समान उपयोगिता का उपयोग करें।
```shell
sudo python2 net-creds.py -i eth0
```

इन चरणों को निष्पादित करने से हमलावर को ट्रैफ़िक को इंटरसेप्ट और हेरफेर करने की स्थिति में रखा जाता है, जो GLBP हाईजैकिंग की प्रक्रिया के समान है। यह HSRP जैसे रिडंडेंसी प्रोटोकॉल में कमजोरियों और मजबूत सुरक्षा उपायों की आवश्यकता को उजागर करता है।

## संदर्भ

- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)


{{#include ../../banners/hacktricks-training.md}}
