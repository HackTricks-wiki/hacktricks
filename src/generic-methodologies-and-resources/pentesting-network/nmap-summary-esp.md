# Nmap Özeti (ESP)

{{#include ../../banners/hacktricks-training.md}}
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parametreler

### Taranacak IP'ler

- **`<ip>,<net/mask>`:** IP'leri doğrudan belirtir
- **`-iL <ips_file>`:** list_IPs
- **`-iR <number>`**: Rastgele IP sayısı; olası IP'leri `--exclude <Ips>` veya `--excludefile <file>` ile dışlayabilirsiniz.

### Cihaz keşfi

Varsayılan olarak Nmap şu keşif aşamasını başlatır: `-PA80 -PS443 -PE -PP`

- **`-sL`**: İnvazif değildir, hedefleri listeleyerek isim çözümü için **DNS** istekleri yapar. Örneğin www.prueba.es/24 içindeki tüm IP'lerin bizim hedefimiz olup olmadığını görmek için faydalıdır.
- **`-Pn`**: **Ping yok**. Hepsinin aktif olduğunu biliyorsanız kullanışlıdır (değilse çok zaman kaybedebilirsiniz, ayrıca false negative üretebilir), keşif aşamasını engeller.
- **`-sn`** : **Port taraması yok**. Keşif aşamasını tamamladıktan sonra portları taramaz. Göreceli olarak sessizdir ve küçük ağ taramaları için uygundur. Yetkilerle 80'e ACK (-PA), 443'e SYN (-PS) ve echo ile Timestamp isteği gönderir; yetkisiz ise her zaman bağlantıları tamamlar. Hedef ağ ise sadece ARP(-PR) kullanır. Başka bir seçenekle birlikte kullanılırsa, sadece diğer seçeneğe ait paketler gönderilir.
- **`-PR`**: **ARP ping**. Ağımızdaki bilgisayarları analiz ederken varsayılan olarak kullanılır, ping kullanmaktan daha hızlıdır. ARP paketleri gönderilmesini istemezseniz `--send-ip` kullanın.
- **`-PS <ports>`**: SYN paketleri gönderir; SYN/ACK ile cevaplanırsa port açık kabul edilir (bağlantıyı bitirmemek için RST ile cevaplanır), RST ile cevaplanırsa kapalı, cevap yoksa ulaşılamaz. Yetki yoksa tam bağlantı otomatik kullanılır. Port belirtilmezse varsayılan 80'e atılır.
- **`-PA <ports>`**: Öncekine benzer ama ACK ile; ikisini kombinlemek daha iyi sonuç verir.
- **`-PU <ports>`**: Amaç tersidir, genelde kapalı olması beklenen portlara gönderilir. Bazı firewall'lar sadece TCP kontrol eder. Kapalıysa port unreachable ile cevap verir, farklı bir icmp ile veya cevap yoksa destination unreachable/filtrelenmiş kabul edilir.
- **`-PE, -PP, -PM`** : ICMP PING'leri: echo reply, timestamp ve addresmask. Hedefin aktif olup olmadığını anlamak için gönderilir.
- **`-PY<ports>`**: Varsayılan olarak 80'e SCTP INIT probe'ları gönderir; INIT-ACK (açık) veya ABORT (kapalı), hiçbir şey veya ICMP unreachable (inaktif) dönebilir.
- **`-PO <protocols>`**: Başlıklarda bir protokol belirtilir; varsayılan 1(ICMP), 2(IGMP) ve 4(Encap IP). ICMP, IGMP, TCP (6) ve UDP (17) için protokol başlıkları gönderilir, diğerleri için sadece IP başlığı gönderilir. Amaç, başlıkların bozulması sonucu Protocol unreachable veya aynı protokolden yanıt alıp hedefin up olup olmadığını anlamaktır.
- **`-n`**: DNS yok
- **`-R`**: DNS her zaman

### Port tarama teknikleri

- **`-sS`**: Bağlantıyı tamamlamaz, iz bırakmaz; kullanılabiliyorsa çok iyi. (yetkiler) Varsayılan olarak kullanılır.
- **`-sT`**: Bağlantıyı tamamlar, iz bırakır ama kesin çalışır. Varsayılan olarak yetkisiz.
- **`-sU`**: Daha yavaş, UDP için. Başlıca: DNS(53), SNMP(161,162), DHCP(67 ve 68), (`-sU53,161,162,67,68`): open(reply), closed(port unreachable), filtered (başka bir ICMP), open/filtered (cevap yok). open/filtered durumunda `-sV` birçok istek göndererek nmap'in desteklediği sürümlerden birini tespit etmeye çalışır ve gerçek durumu belirleyebilir. Süreyi çok uzatır.
- **`-sY`**: SCTP; bağlantı kurulmaz, log oluşmaz, -PY gibi çalışır.
- **`-sN,-sX,-sF`:** Null, Fin, Xmas; bazı firewall'ları delip bilgi çıkarabilirler. Standart uyumlu makineler, SYN, RST veya ACK bayrakları olmayan isteklere RST ile cevap verirler: open/filtered (cevap yok), closed (RST), filtered (ICMP unreachable). Windows, Cisco, BSDI ve OS/400 üzerinde güvenilmez. Unix üzerinde çalışır.
- **`-sM`**: Maimon taraması: FIN ve ACK bayrakları gönderir, BSD için kullanılır; güncel olarak hepsini closed olarak döndürecektir.
- **`-sA, sW`**: ACK ve Window; firewall tespiti için, portların filtrelenip filtrelenmediği anlaşılır. -sW open/closed ayrımı yapar çünkü açık olanlar farklı window değeri ile RST yanıtı verir: open (RST window != 0), closed (RST window = 0), filtered (ICMP unreachable veya cevap yok). Tüm makineler böyle çalışmaz; eğer hepsi closed çıkıyorsa yöntem işe yaramıyor demektir; birkaç açık varsa düzgün çalışıyor; çok açık ve az kapalı varsa ters davranıyor olabilir.
- **`-sI`:** Idle scan. Aktif bir firewall varsa ama belirli bir IP'ye filtrelemediğini biliyorsak (veya anonim kalmak istiyorsak) zombie scanner kullanabiliriz (tüm portlar için çalışır). Olası zombileri bulmak için ipidseq script'ini veya exploit auxiliary/scanner/ip/ipidseq kullanabiliriz. Bu tarayıcı IP paketlerinin IPID numarasına dayanır.
- **`--badsum`:** Checksum'ı yanlış gönderir; makineler paketleri atabilir ama firewall'lar bir cevap verebilir; firewall tespiti için kullanılır.
- **`-sZ`:** "Weird" SCTP scanner; cookie echo fragment gönderildiğinde açıksa atılması, kapalıysa ABORT ile cevaplanması beklenir. Init'in geçemediği firewall'lardan geçebilir, dezavantajı filtered ile open ayrımını yapamamasıdır.
- **`-sO`:** IP protokol taraması. Bozuk ve boş başlıklar gönderir; bazen protokol bile ayırt edilemez. ICMP unreachable protocol gelirse kapalı, unreachable port gelirse açık, başka hata gelirse filtered, hiçbir şey gelmezse open|filtered kabul edilir.
- **`-b <server>`:** FTP host üzerinden tarama -> Başka bir makineden bir host'u taramak için kullanılır; başka makinenin FTP'sine bağlanıp o makineden taramak istediğiniz portlara dosya gönderilmesini istersiniz; verilen yanıtlara göre açık/kapalı değerlendirilir. [\<user>:\<password>@]\<server>\[:\<port>] Çoğu FTP sunucusu artık bunu yapmaya izin vermediği için pratikte az kullanışlıdır.

### Odak Analizi

**-p:** Taranacak portları belirtmek için kullanılır. Tüm 65.535 portu seçmek için: **-p-** veya **-p all**. Nmap dahili olarak popülerliğe göre sınıflandırma yapar. Varsayılan olarak en popüler 1000 portu kullanır. **-F** (hızlı tarama) ile en popüler 100'ü tarar. **--top-ports <number>** ile belirtilen sayıda en popüler port taranır (1 ile 65.335 arası). Portları rastgele sırada kontrol eder; bunu önlemek için **-r** kullanın. Belirli portlar da seçebilirsiniz: 20-30,80,443,1024- (sonuncusu 1024'ten itibaren tüm portları ifade eder). Protokollere göre grup da yapılabilir: U:53,T:21-25,80,139,S:9. Ayrıca Nmap'in popüler portları içinde bir aralık seçilebilir: -p [-1024] nmap-services içindekilerden 1024'e kadar olanları tarar. **--port-ratio <ratio>** 0 ile 1 arasında bir oran vererek en yaygın portları analiz eder.

**-sV** Sürüm taraması, yoğunluğu 0 ile 9 arasında ayarlanabilir, varsayılan 7'dir.

**--version-intensity <number>** Yoğunluğu ayarlar; düşükse sadece en olası probe'ları atar, hepsini değil. Bu sayede UDP tarama süresini ciddi şekilde kısaltabilirsiniz.

**-O** OS tespiti

**--osscan-limit** Sağlıklı OS tespiti için en az bir açık ve bir kapalı porta ihtiyaç vardır. Bu koşul sağlanmazsa ve bu seçenek ayarlıysa OS tahmini denemeyecektir (zaman kazandırır).

**--osscan-guess** OS tespiti mükemmel olmadığında daha agresif denemeler yapar.

**Script'ler**

--script _<filename>_|_<category>_|_<directory>_|_<expression>_[,...]

Varsayılan script'leri kullanmak için -sC veya --script=default kullanın

Kullanılabilir türler: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, ve vuln

- **Auth:** mevcut tüm authentication script'lerini çalıştırır
- **Default:** temel varsayılan araç script'lerini çalıştırır
- **Discovery:** hedef veya kurbandan bilgi alır
- **External:** dış kaynakları kullanan script
- **Intrusive:** kurbana/hedefe müdahaleci kabul edilen script'leri kullanır
- **Malware:** kötü amaçlı yazılım veya backdoor'ların açtığı bağlantıları kontrol eder
- **Safe:** müdahaleci olmayan script'leri çalıştırır
- **Vuln:** bilinen zafiyetleri keşfeder
- **All:** mevcut tüm NSE uzantı script'lerini çalıştırır

Script aramak için:

**nmap --script-help="http-\*" -> Those starting with http-**

**nmap --script-help="not intrusive" -> All except those**

**nmap --script-help="default or safe" -> Those in either or both**

**nmap --script-help="default and safe" --> Those in both**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

--script-args _<n1>_=_<v1>_,_<n2>_={_<n3>_=_<v3>_},_<n4>_={_<v4>_,_<v5>_}

--script-args-file _<filename>_

--script-help _<filename>_|_<category>_|_<directory>_|_<expression>_|all[,...]

--script-trace ---> Script'in nasıl ilerlediğine dair bilgi verir

--script-updatedb

**Bir script kullanmak için sadece yazın: nmap --script Script_Name target** --> Script kullanıldığında hem script hem de tarayıcı çalışacaktır, dolayısıyla tarayıcı seçenekleri de eklenebilir. Sadece safe olanları çalıştırmak için **"safe=1"** ekleyebiliriz.

**Zaman Kontrolü**

**Nmap zamanı saniye, dakika, ms cinsinden değiştirebilir:** --host-timeout argümanları 900000ms, 900, 900s ve 15m hepsi aynı anlama gelir.

Nmap, taranacak host sayısını gruplara böler ve bu grupları bloklar halinde analiz eder; bir bloğu bitirmeden sonraki bloğa geçmez (kullanıcı bloğun analiz edilene kadar güncelleme almaz). Bu yüzden Nmap için büyük gruplar kullanmak daha optimaldir. Varsayılan olarak bir class C'de 256 kullanır.

Bunu şu seçeneklerle değiştirebilirsiniz: **--min-hostgroup** _**<numhosts>**_**;** **--max-hostgroup** _**<numhosts>**_ (Paralel tarama grup boyutlarını ayarlar)

Paralel scanner sayısını kontrol edebilirsiniz ama genelde buna müdahale etmeyin (Nmap ağ durumuna göre otomatik kontrol içerir): **--min-parallelism** _**<numprobes>**_**;** **--max-parallelism** _**<numprobes>**_

RTT timeout'u değiştirebiliriz ama genelde gerekli değildir: **--min-rtt-timeout** _**<time>**_**,** **--max-rtt-timeout** _**<time>**_**,** **--initial-rtt-timeout** _**<time>**_

Deneme sayısını değiştirebiliriz: **--max-retries** _**<numtries>**_

Bir host'un tarama süresini değiştirebiliriz: **--host-timeout** _**<time>**_

Her test arasındaki beklemeyi artırarak yavaşlatabiliriz: **--scan-delay** _**<time>**_**;** **--max-scan-delay** _**<time>**_

Saniyedeki paket sayısını değiştirebiliriz: **--min-rate** _**<number>**_**;** **--max-rate** _**<number>**_

Filtrelenmiş veya kapalı birçok port uzun süre cevap verir. Sadece açık olanlarla ilgileniyorsak daha hızlı olmak için: **--defeat-rst-ratelimit**

Nmap'in ne kadar agresif olacağını belirlemek için: -T paranoid|sneaky|polite|normal|aggressive|insane

-T (0-1)

-T0 --> Her seferinde sadece 1 port tarar ve bir sonrakine geçmeden önce 5dk bekler

-T1 ve T2 --> Çok benzer; ancak sırasıyla 15s ve 0.4s beklerler

-T3 --> Varsayılan çalışma, paralel taramayı içerir

-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Port erişimine izin vermezler ve paketleri analiz ederler.

**-f** Paketleri parçalar; varsayılan olarak header'dan sonra 8byte'lık parçalar yapar; bu boyutu belirtmek için ..mtu kullanın (bununla -f kullanmayın), offset 8'in katı olmalıdır. **Version scanner'lar ve script'ler fragmentation'ı desteklemez**

**-D decoy1,decoy2,ME** Nmap taramaları farklı IP adreslerinden geliyormuş gibi gönderir, böylece sizi gizler. Eğer listede ME yazarsanız, Nmap sizi oraya yerleştirir; tamamen maskelemek için önünüzde 5-6 tane koymak daha iyidir. RND:<number> ile rastgele IP üretilebilir; <number> kadar rastgele IP oluşturur. TCP connection olmadan çalışan TCP version detector'larla çalışmazlar. Ağ içindeyseniz aktif IP'ler kullanmak istersiniz, aksi halde tek aktif sizmişsiniz gibi kolayca anlaşılır.

Rastgele IP kullanmak için: nmap -D RND:10 Target_IP

**-S IP** Nmap IP'nizi yakalayamıyorsa bunu vermek için kullanılır. Ayrıca başka bir hedefin sizi taradığı izlenimini vermek için de işe yarar.

**-e <interface>** Arayüz seçimi

Birçok yönetici, her şey düzgün çalışsın diye bazı giriş portlarını açık bırakır; bunlar DNS veya FTP portları olabilir... Bu zafiyeti bulmak için Nmap şu seçeneği sağlar: **--source-port** _**<portnumber>**_**; -g** _**<portnumber>**_ _Eşdeğerdirler_

**--data** _**<hex string>**_ Hexadecimal veri gönderir: --data 0xdeadbeef ve --data \xCA\xFE\x09

**--data-string** _**<string>**_ Normal metin gönderir: --data-string "Scan conducted by Security Ops, extension 7192"

**--data-length** _**<number>**_ Nmap sadece header gönderiyorsa, buna ek olarak rastgele oluşturulmuş daha fazla byte ekler

IP paketini tamamen yapılandırmak için **--ip-options** kullanın

Gönderilen ve alınan paketlerdeki seçenekleri görmek isterseniz, --packet-trace belirtin. IP options ile Nmap kullanımı hakkında daha fazla bilgi ve örnek için bkz. [http://seclists.org/nmap-dev/2006/q3/52](http://seclists.org/nmap-dev/2006/q3/52).

**--ttl** _**<value>**_

**--randomize-hosts** Saldırıyı daha az belirgin yapmak için

**--spoof-mac** _**<MAC address, prefix, or vendor name>**_ MAC adresini değiştirmek için; örnekler: Apple, 0, 01:02:03:04:05:06, deadbeefcafe, 0020F2, ve Cisco

**--proxies** _**<Comma-separated list of proxy URLs>**_ Proxy kullanmak için; bazı proxy'ler Nmap'in istediği kadar açık bağlantı tutmayabilir, bu nedenle paralellik ayarlanmalıdır: --max-parallelism

**-sP** Ağımızdaki hostları ARP ile keşfetmek için

Birçok yönetici belirli bir porttan gelen tüm paketlere izin veren firewall kuralı oluşturur (ör. 20,53,67). Nmap'e paketlerimizi bu portlardan göndermesini söyleyebiliriz: **nmap --source-port 53 IP**

**Çıktılar**

**-oN file** Normal çıktı

**-oX file** XML çıktı

**-oS file** Script kiddies çıktısı

**-oG file** Grep'lenebilir çıktı

**-oA file** Hepsi (oS hariç değil)

**-v level** ayrıntı seviyesi

**-d level** hata ayıklama seviyesi

**--reason** Host ve durumun nedeni

**--stats-every time** Belirtilen aralıkta ilerleme raporu

**--packet-trace** Hangi paketlerin çıktığını görmek için; filtreler belirtilebilir, ör: --version-trace veya --script-trace

**--open** sadece open, open|filtered ve unfiltered gösterir

**--resume file** Özet çıktıyı sürdürür

**Çeşitli**

**-6** IPv6'ya izin verir

**-A** şu seçeneklerle eşdeğerdir: -O -sV -sC --traceroute

**Çalışma zamanı**

Nmap çalışırken seçenekleri değiştirebiliriz:

v / V Verbosity seviyesini artır / azalt

d / D Debug seviyesini artır / azalt

p / P Packet tracing aç / kapat

? Çalışma zamanı etkileşimli yardım ekranını yazdır

**Vulscan**

Nmap script'i, elde edilen servis sürümlerini offline bir veritabanında (başka kaynaklardan indirilen) arar ve olası zafiyetleri döndürür

Kullandığı DB'ler:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

İndirmek ve Nmap klasörüne kurmak için:

wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz && tar -czvf nmap_nse_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Ayrıca DB paketlerini indirip /usr/share/nmap/scripts/vulscan/ dizinine eklemeniz gerekir.

Kullanım:

Tümünü kullanmak için: sudo nmap -sV --script=vulscan HOST_TO_SCAN

Belirli bir DB kullanmak için: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST_TO_SCAN

## Nmap Servis taramasını x16 hızlandırma

[**bu yazıya göre**](https://joshua.hu/nmap-speedup-service-scanning-16x) nmap servis analizini hızlandırmak için **/usr/share/nmap/nmap-service-probes** içindeki tüm **`totalwaitms`** değerlerini **300** ve **`tcpwrappedms`** değerini **200** olarak değiştirebilirsiniz.

Ayrıca, özel olarak tanımlanmamış **`servicewaitms`** değerleri için varsayılan **`5000`** kullanılır. Bu yüzden ya her probe'a değer ekleyebilir ya da **nmap'i derleyip** varsayılan değeri [**service_scan.h**](https://github.com/nmap/nmap/blob/master/service_scan.h#L79) içinde değiştirebilirsiniz.

`/usr/share/nmap/nmap-service-probes` dosyasındaki **`totalwaitms`** ve **`tcpwrappedms`** değerlerini hiç değiştirmek istemiyorsanız, [parsing kodunu](https://github.com/nmap/nmap/blob/master/service_scan.cc#L1358) bu değerlerin `nmap-service-probes` dosyasında tamamen göz ardı edilmesi için düzenleyebilirsiniz.

## Sınırlı ortamlarda statik Nmap derleme

Hardening yapılmış veya minimal Linux ortamlarda (container'lar, appliance'lar) dinamik bağlı Nmap ikili dosyaları genellikle eksik runtime loader veya shared library'ler yüzünden çalışmaz (/lib64/ld-linux-x86-64.so.2, libc.so gibi). Kendi statik bağlı Nmap'inizi derleyip NSE verisini paketlemek, sistem paketleri kurmadan çalıştırma sağlar.

Yüksek seviye yaklaşım
- Docker ile temiz bir amd64 Ubuntu builder kullanın.
- OpenSSL ve PCRE2'yi statik kütüphane olarak derleyin.
- Nmap'i statik linkleyerek ve dahil edilen libpcap/libdnet'i kullanarak dinamik bağımlılıklardan kaçının.
- Binary ile birlikte NSE script'leri ve veri dizinlerini paketleyin.

Hedef mimarinin tespiti (örnek)
```bash
uname -a
# If building from macOS/ARM/etc., pin the builder arch:
docker run --rm --platform=linux/amd64 -v "$(pwd)":/out -w /tmp ubuntu:22.04 bash -lc 'echo ok'
```
Adım 1 — Araç zincirini hazırla
```bash
set -euo pipefail
export DEBIAN_FRONTEND=noninteractive
apt-get update && apt-get install -y --no-install-recommends \
build-essential ca-certificates curl bzip2 xz-utils pkg-config perl python3 file git \
automake autoconf libtool m4 zlib1g-dev
```
Adım 2 — Statik OpenSSL (1.1.1w) derleme
```bash
OSSL="1.1.1w"
curl -fsSLO "https://www.openssl.org/source/openssl-$OSSL.tar.gz"
tar xzf "openssl-$OSSL.tar.gz" && cd "openssl-$OSSL"
./Configure no-shared no-zlib linux-x86_64 -static --prefix=/opt/ossl
make -j"$(nproc)" && make install_sw
cd /tmp
```
Adım 3 — Statik PCRE2 (10.43) derleme
```bash
PCRE2=10.43
curl -fsSLO "https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$PCRE2/pcre2-$PCRE2.tar.bz2"
tar xjf "pcre2-$PCRE2.tar.bz2" && cd "pcre2-$PCRE2"
./configure --disable-shared --enable-static --prefix=/opt/pcre2
make -j"$(nproc)" && make install
cd /tmp
```
Adım 4 — Statik Nmap derleme (7.98)
```bash
NMAP=7.98
curl -fsSLO "https://nmap.org/dist/nmap-$NMAP.tar.bz2"
tar xjf "nmap-$NMAP.tar.bz2" && cd "nmap-$NMAP"
export CPPFLAGS="-I/opt/ossl/include -I/opt/pcre2/include"
export LDFLAGS="-L/opt/ossl/lib -L/opt/pcre2/lib -static -static-libstdc++ -static-libgcc"
export LIBS="-lpcre2-8 -ldl -lpthread -lz"
./configure \
--with-openssl=/opt/ossl \
--with-libpcre=/opt/pcre2 \
--with-libpcap=included \
--with-libdnet=included \
--without-zenmap --without-ndiff --without-nmap-update
# Avoid building shared libpcap by accident
sed -i -e "s/^shared: /shared: #/" libpcap/Makefile || true
make -j1 V=1 nmap
strip nmap
```
Temel noktalar
- -static, -static-libstdc++, -static-libgcc statik bağlamayı zorlar.
- --with-libpcap=included/--with-libdnet=included kullanımı sistem paylaşılan kütüphanelerden kaçınır.
- sed ile yapılan düzenleme, mevcutsa paylaşılan bir libpcap hedefini etkisiz hale getirir.

Adım 5 — İkili (binary) ve NSE verilerini paketleme
```bash
mkdir -p /out/nmap-bundle/nmap-data
cp nmap /out/nmap-bundle/nmap-linux-amd64-static
cp -r scripts nselib /out/nmap-bundle/nmap-data/
cp nse_main.lua nmap-services nmap-protocols nmap-service-probes \
nmap-mac-prefixes nmap-os-db nmap-payloads nmap-rpc \
/out/nmap-bundle/nmap-data/ 2>/dev/null || true

tar -C /out -czf /out/nmap-linux-amd64-static-bundle.tar.gz nmap-bundle
```
Doğrulama ve operasyon notları
- Artefakt üzerinde file komutunu kullanarak statik olarak bağlandığını doğrulayın.
- Nmap yüklü olmayan hostlarda script uyumluluğunu sağlamak için NSE verilerini binary ile birlikte tutun.
- Statik bir binary olsa bile yürütme AppArmor/seccomp/SELinux tarafından engellenebilir; DNS/egress yine de çalışmalıdır.
- Deterministik derlemeler, opak “static” binary’leri indirmeye kıyasla tedarik zinciri riskini azaltır.

One-liner (Dockerized)
<details>
<summary>Derle, paketle ve artefakt bilgilerini yazdır</summary>
```bash
docker run --rm --platform=linux/amd64 -v "$(pwd)":/out -w /tmp ubuntu:22.04 bash -lc '
set -euo pipefail
export DEBIAN_FRONTEND=noninteractive
apt-get update && apt-get install -y --no-install-recommends \
build-essential ca-certificates curl bzip2 xz-utils pkg-config perl python3 file git \
automake autoconf libtool m4 zlib1g-dev

OSSL="1.1.1w"; curl -fsSLO "https://www.openssl.org/source/openssl-$OSSL.tar.gz" \
&& tar xzf "openssl-$OSSL.tar.gz" && cd "openssl-$OSSL" \
&& ./Configure no-shared no-zlib linux-x86_64 -static --prefix=/opt/ossl \
&& make -j"$(nproc)" && make install_sw && cd /tmp

PCRE2=10.43; curl -fsSLO "https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$PCRE2/pcre2-$PCRE2.tar.bz2" \
&& tar xjf "pcre2-$PCRE2.tar.bz2" && cd "pcre2-$PCRE2" \
&& ./configure --disable-shared --enable-static --prefix=/opt/pcre2 \
&& make -j"$(nproc)" && make install && cd /tmp

NMAP=7.98; curl -fsSLO "https://nmap.org/dist/nmap-$NMAP.tar.bz2" \
&& tar xjf "nmap-$NMAP.tar.bz2" && cd "nmap-$NMAP" \
&& export CPPFLAGS="-I/opt/ossl/include -I/opt/pcre2/include" \
&& export LDFLAGS="-L/opt/ossl/lib -L/opt/pcre2/lib -static -static-libstdc++ -static-libgcc" \
&& export LIBS="-lpcre2-8 -ldl -lpthread -lz" \
&& ./configure --with-openssl=/opt/ossl --with-libpcre=/opt/pcre2 --with-libpcap=included --with-libdnet=included --without-zenmap --without-ndiff --without-nmap-update \
&& sed -i -e "s/^shared: /shared: #/" libpcap/Makefile || true \
&& make -j1 V=1 nmap && strip nmap

mkdir -p /out/nmap-bundle/nmap-data \
&& cp nmap /out/nmap-bundle/nmap-linux-amd64-static \
&& cp -r scripts nselib /out/nmap-bundle/nmap-data/ \
&& cp nse_main.lua nmap-services nmap-protocols nmap-service-probes nmap-mac-prefixes nmap-os-db nmap-payloads nmap-rpc /out/nmap-bundle/nmap-data/ 2>/dev/null || true \
&& tar -C /out -czf /out/nmap-linux-amd64-static-bundle.tar.gz nmap-bundle \
&& echo "===== OUTPUT ====="; ls -lah /out; echo "===== FILE TYPE ====="; file /out/nmap-bundle/nmap-linux-amd64-static || true
'
```
</details>

## Referanslar

- [Kısıtlı ortamlardaki işler için statik Nmap ikili dosyasının derlenmesi](https://www.pentestpartners.com/security-blog/compiling-static-nmap-binary-for-jobs-in-restricted-environments/)
- [Static Nmap Binary Generator (yardımcı araç)](https://github.com/0x5ubt13/static_nmap_binary_generator)
- [OpenSSL kaynakları](https://www.openssl.org/source/)
- [PCRE2 sürümleri](https://github.com/PCRE2Project/pcre2/releases)
- [Nmap kaynak tarball'ları](https://nmap.org/dist/)


{{#include ../../banners/hacktricks-training.md}}
