# Nmap Opsomming (ESP)

{{#include ../../banners/hacktricks-training.md}}
```
nmap -sV -sC -O -n -oA nmapscan 192.168.0.1/24
```
## Parameters

### IPs to scan

- **`<ip>,<net/mask>`:** Gee die ips direk aan
- **`-iL <ips_file>`:** list_IPs
- **`-iR <number>`**: Aantal ewekansige Ips, jy kan moontlike Ips uitsluit met `--exclude <Ips>` of `--excludefile <file>`.

### Equipment discovery

By default Nmap launches a discovery phase consisting of: `-PA80 -PS443 -PE -PP`

- **`-sL`**: Nie-invasief, lys die teikens deur **DNS** versoeke te maak om name op te los. Nuttig om te weet of byvoorbeeld www.prueba.es/24 al die Ips ons teikens is.
- **`-Pn`**: **Geen ping**. Nuttig as jy weet dat almal aktief is (anders kan jy baie tyd verloor, en hierdie opsie kan vals negatiewe lewer wat sê hulle is nie aktief nie), dit voorkom die discovery-fase.
- **`-sn`** : **Geen port scan**. Na voltooiing van die verkenningsfase, word poorte nie geskan nie. Dit is relatief stealthy en laat ’n klein netwerkverkenning toe. Met privilegies stuur dit ’n ACK (-PA) na 80, ’n SYN(-PS) na 443 en ’n echo request en Timestamp request; sonder privilegies voltooi dit altyd verbindings. As die teiken die netwerk is, gebruik dit slegs ARP(-PR). As dit saam met ’n ander opsie gebruik word, word slegs die pakkette van die ander opsie weggelaat.
- **`-PR`**: **Ping ARP**. Word standaard gebruik wanneer rekenaars in ons netwerk ontleed word, dit is vinniger as pings. As jy nie ARP-pakkette wil gebruik nie, gebruik `--send-ip`.
- **`-PS <ports>`**: Stuur SYN-pakkette; as dit met SYN/ACK beantwoord word is dit open (dan antwoord dit met RST sodat die verbinding nie geëindig word nie), as dit met RST beantwoord word is dit closed en as dit nie antwoord nie is dit unreachable. Sonder privilegies word ’n volle verbinding outomaties gebruik. As geen poorte gegee word nie, word dit na 80 gestuur.
- **`-PA <ports>`**: Soos die vorige maar met ACK; die kombinasie van die twee gee beter resultate.
- **`-PU <ports>`**: Die teenoorgestelde doel; gestuur na poorte wat verwag word toe te wees toe. Sommige firewalls kyk net na TCP-verbindinge. As dit gesluit is, word daar met port unreachable geantwoord; as dit met ’n ander icmp beantwoord of niks, word dit as destination unreachable gelaat.
- **`-PE, -PP, -PM`** : ICMP PINGS: echo reply, timestamp en addresmask. Word geloods om uit te vind of die teiken aktief is.
- **`-PY<ports>`**: Stuur SCTP INIT probes na 80 standaard; INIT-ACK(open) of ABORT(closed) of niks of ICMP unreachable(inactive) kan geantwoord word.
- **`-PO <protocols>`**: ’n Protokol word in die headers aangedui, standaard 1(ICMP), 2(IGMP) en 4(Encap IP). Vir ICMP, IGMP, TCP (6) en UDP (17) word protokolheaders gestuur, vir die res slegs die IP-header. Doel is om, weens malformed headers, Protocol unreachable of antwoorde van dieselfde protokol te kry om te weet of dit op is.
- **`-n`**: Geen DNS
- **`-R`**: DNS altyd

### Port scanning techniques

- **`-sS`**: Voltooi nie die verbinding nie, laat geen spoor nie — baie goed as dit gebruik kan word (privileges). Dit is die standaard.
- **`-sT`**: Voltooi die verbinding, dus laat dit ’n spoor, maar dit kan beslis gebruik word. Standaard sonder privilegies.
- **`-sU`**: Stadiger, vir UDP. Meesal: DNS(53), SNMP(161,162), DHCP(67 and 68), (-sU53,161,162,67,68): open(reply), closed(port unreachable), filtered (ander ICMP), open/filtered (niks). In geval van open/filtered stuur -sV baie versoeke om enige van die weergawes wat nmap ondersteun te identifiseer en die ware toestand te kan bepaal. Dit verhoog tyd aansienlik.
- **`-sY`**: SCTP-protokol — misluk om verbinding te vestig, dus geen logs nie, werk soos -PY
- **`-sN,-sX,-sF`:** Null, Fin, Xmas — kan sekere firewalls omseil en inligting onttrek. Gebaseer op die feit dat standaard-konforme masjiene met RST moet antwoord op versoeke wat nie SYN, RST of ACK vlae het: open/filtered(niks), closed(RST), filtered (ICMP unreachable). Onbetroubaar op Windows, Cisco, BSDI en OS/400. Op Unix wel.
- **`-sM`**: Maimon scan: Stuur FIN en ACK vlae, gebruiklik vir BSD, tans sal dit alles as closed teruggee.
- **`-sA, sW`**: ACK en Window, word gebruik om firewalls te identifiseer en te weet of poorte gefilter is. Die -sW onderskei tussen open/closed aangesien open met ’n ander window-waarde reageer: open (RST met window ≠ 0), closed (RST window = 0), filtered (ICMP unreachable of niks). Nie alle rekenaars werk so nie; as alles closed is, werk dit nie, as ’n paar open is, werk dit goed, en as baie open en min closed is, werk dit andersom.
- **`-sI`:** Idle scan. Vir gevalle met ’n aktiewe firewall maar waar ons weet dit filter nie na ’n sekere IP nie (of wanneer ons anonimiteit wil hê), kan ons die zombie scanner gebruik (werk vir alle poorte). Om moontlike zombies te vind kan ons die script ipidseq of die exploit auxiliary/scanner/ip/ipidseq gebruik. Hierdie skandering is gebaseer op die IPID-getal van die IP-pakkette.
- **`--badsum`:** Stuur die checksum verkeerd; rekenaars sal pakkette verwerp, maar firewalls kan iets antwoord — gebruik om firewalls te identifiseer.
- **`-sZ`:** "Weird" SCTP scanner — wanneer probes met cookie echo fragments gestuur word, moet dit weggegooi word as open of met ABORT beantwoord as closed. Kan deur sekere firewalls gaan waar init nie deurkom nie; nadeel is dat dit nie tussen filtered en open onderskei nie.
- **`-sO`:** Protocol IP scan. Stuur slegte en leë headers waarin soms nie eers die protokol onderskei kan word nie. As ICMP unreachable protocol kom, is dit closed; as unreachable port kom, is dit open; as ’n ander fout kom, filtered; as niks kom, open|filtered.
- **`-b <server>`:** FTPhost --> Word gebruik om ’n host vanaf ’n ander een te scan deur die ftp van ’n ander masjien te gebruik en dit te vra om lêers te stuur na die poorte wat jy wil skandeer; volgens die antwoorde weet ons of dit open is. [\<user>:\<password>@]\<server>\[:\<port>] Byna alle ftp servers laat dit nie meer toe nie en dus het dit min praktiese nut.

### **Focus Analysis**

**-p:** Gebruik om poorte te spesifiseer om te skandeer. Om alle 65,535 poorte te kies: **-p-** of **-p all**. Nmap het ’n interne klassifikasie gebaseer op gewildheid. Standaard gebruik dit die top 1000 poorte. Met **-F** (fast scan) ontleed dit die top 100. Met **--top-ports <number>** ontleed dit daardie aantal top-poorte (van 1 tot 65,535). Dit toets poorte in ewekansige volgorde; om dit te voorkom, gebruik **-r**. Ons kan ook spesifieke poorte kies: 20-30,80,443,1024- (laasgenoemde beteken kyk van 1024 af). Ons kan ook poorte groepeer volgens protokolle: U:53,T:21-25,80,139,S:9. Ons kan ook ’n reeks binne Nmap se popular poorte kies: -p [-1024] ontleed tot poort 1024 uit diegene in nmap-services. **--port-ratio <ratio>** Ontleed die mees algemene poorte binne ’n verhouding tussen 0 en 1

**-sV** Weergawe-skandering, die intensiteit kan gereguleer word van 0 tot 9, standaard is 7.

**--version-intensity <number>** Ons reguleer die intensiteit; hoe laer dit is, hoe meer sal dit slegs die waarskynlikste probes stuur en nie almal nie. Hiermee kan ons UDP-skanderingstyd aansienlik verkort.

**-O** OS detection

**--osscan-limit** Vir behoorlike host-oskandering is ten minste een open poort en een closed poort nodig. As hierdie voorwaarde nie voldaan word en ons het dit gestel, sal dit nie OS-voorspelling probeer doen nie (spaar tyd).

**--osscan-guess** Wanneer OS detection nie perfek is nie, laat dit harder probeer.

**Scripts**

--script _<filename>_|_<category>_|_<directory>_|_<expression>_[,...]

Om default scripts te gebruik, gebruik -sC of --script=default

Beskikbare tipes: auth, broadcast, default, discovery, dos, exploit, external, fuzzer, intrusive, malware, safe, version, en vuln

- **Auth:** voer alle beskikbare authentication scripts uit
- **Default:** voer basiese default tool scripts uit
- **Discovery:** haal inligting vanaf die teiken of slagoffer
- **External:** script vir gebruik van eksterne hulpbronne
- **Intrusive:** gebruik scripts wat as intrusive teen die slagoffer/teiken beskou word
- **Malware:** kyk na verbindings wat deur kwaadwillige kode of backdoors geopen is
- **Safe:** voer nie-intrusiewe scripts uit
- **Vuln:** ontdek die mees bekende vulnerabilities
- **All:** voer absoluut alle beskikbare NSE extension scripts uit

Om te soek na scripts:

**nmap --script-help="http-\*" -> Those starting with http-**

**nmap --script-help="not intrusive" -> All except those**

**nmap --script-help="default or safe" -> Those in either or both**

**nmap --script-help="default and safe" --> Those in both**

**nmap --script-help="(default or safe or intrusive) and not http-\*"**

--script-args _<n1>_=_<v1>_,_<n2>_={_<n3>_=_<v3>_},_<n4>_={_<v4>_,_<v5>_}

--script-args-file _<filename>_

--script-help _<filename>_|_<category>_|_<directory>_|_<expression>_|all[,...]

--script-trace ---> Verskaf inligting oor hoe die script vorder

--script-updatedb

**Om ’n script te gebruik, tik net: nmap --script Script_Name target** --> Wanneer ’n script gebruik word, sal beide die script en die skandeerder uitgevoer word, dus kan skandeerder-opsies ook bygevoeg word. Ons kan **"safe=1"** byvoeg om slegs safe scripts uit te voer.

**Time Control**

**Nmap kan tyd in sekondes, minute, ms wysig:** --host-timeout argumente 900000ms, 900, 900s, en 15m doen almal dieselfde.

Nmap verdeel die totale aantal hosts om te skandeer in groepe en ontleed hierdie groepe in blokke, so dit gaan nie na die volgende blok totdat alles in die blok ontleed is nie (en die gebruiker kry geen opdaterings totdat die blok ontleed is nie). Dit maak dit meer optimaal vir Nmap om groot groepe te gebruik. Standaard in Class C gebruik dit 256.

Dit kan verander word met **--min-hostgroup** _**<numhosts>**_**;** **--max-hostgroup** _**<numhosts>**_ (Pas parallel scan groepsgroottes aan)

Jy kan die aantal parallel scanners beheer, maar dit is beter om dit nie te doen nie (Nmap het reeds outomatiese beheer gebaseer op netwerkstatus): **--min-parallelism** _**<numprobes>**_**;** **--max-parallelism** _**<numprobes>**_

Ons kan die RTT-timeout verander, maar dit is gewoonlik nie nodig nie: **--min-rtt-timeout** _**<time>**_**,** **--max-rtt-timeout** _**<time>**_**,** **--initial-rtt-timeout** _**<time>**_

Ons kan die aantal pogings verander: **--max-retries** _**<numtries>**_

Ons kan die skanderingstyd van ’n host verander: **--host-timeout** _**<time>**_

Ons kan die tyd tussen elke toets verhoog om dit te vertraag: **--scan-delay** _**<time>**_**;** **--max-scan-delay** _**<time>**_

Ons kan die aantal pakkette per sekonde verander: **--min-rate** _**<number>**_**;** **--max-rate** _**<number>**_

Baie poorte neem lank om te reageer wanneer gefilter of gesluit. As ons slegs in open poorte belangstel, kan ons vinniger gaan met: **--defeat-rst-ratelimit**

Om te definieer hoe aggressief ons wil hê Nmap moet wees: -T paranoid|sneaky|polite|normal|aggressive|insane

-T (0-1)

-T0 --> Skandeer net 1 poort op ’n slag en wag 5 minute voor die volgende

-T1 en T2 --> Baie soortgelyk maar wag slegs 15 en 0.4s onderskeidelik tussen elke toets

-T3 --> Standaard werking, sluit parallelle skandering in

-T4 --> --max-rtt-timeout 1250ms --min-rtt-timeout 100ms --initial-rtt-timeout 500ms --max-retries 6 --max-scan-delay 10ms

-T5 --> --max-rtt-timeout 300ms --min-rtt-timeout 50ms --initial-rtt-timeout 250ms --max-retries 2 --host-timeout 15m --max-scan-delay 5ms

**Firewall/IDS**

Hulle laat nie toegang tot poorte toe en ontleed pakkette nie.

**-f** Om pakkette te fragment, standaard fragmenteer dit in 8 bytes na die header; om daardie grootte te spesifiseer gebruik ..mtu (met dit, moenie -f gebruik nie), die offset moet ’n veelvoud van 8 wees. **Version scanners en scripts ondersteun nie fragmentasie nie**

**-D decoy1,decoy2,ME** Nmap stuur skanders maar met ander IP-adresse as oorsprong, sodoende verberg dit jou. As jy ME in die lys sit, plaas Nmap jou daar; beter om 5 of 6 voor jou te sit om jou heeltemal te mask. Random IPs kan gegenereer word met RND:<number> om <number> ewekansige IPs te genereer. Hulle werk nie met TCP version detectors sonder verbinding nie. As jy binne ’n netwerk is, is jy belangstel in aktiewe IPs, anders sal dit maklik wees om uit te vind dat jy die enigste aktiewe een is.

Om random IPs te gebruik: nmap -D RND:10 Target_IP

**-S IP** Vir wanneer Nmap jou IP nie optel nie — gee dit. Dien ook om hulle te laat dink ’n ander teiken scan hulle.

**-e <interface>** Om die interface te kies

Baie administrateurs laat ingangspoorte oop vir alles sodat dit korrek werk en dit vir hulle makliker is as om ’n ander oplossing te vind. Dit kan DNS- of FTP-poorte wees... om hierdie kwesbaarheid te vind het Nmap: **--source-port** _**<portnumber>**_**;-g** _**<portnumber>**_ _Hulle is ekwivalent_

**--data** _**<hex string>**_ Om hex teks te stuur: --data 0xdeadbeef en --data \xCA\xFE\x09

**--data-string** _**<string>**_ Om normale teks te stuur: --data-string "Scan conducted by Security Ops, extension 7192"

**--data-length** _**<number>**_ Nmap stuur slegs headers; hiermee voeg ons ’n aantal ekstra bytes by (wat ewekansig gegenereer sal word)

Om die IP-pakket volledig te konfigureer gebruik **--ip-options**

As jy die opsies in gestuurde en ontvangde pakkette wil sien, spesifiseer --packet-trace. Vir meer inligting en voorbeelde van IP-options met Nmap, sien [http://seclists.org/nmap-dev/2006/q3/52](http://seclists.org/nmap-dev/2006/q3/52).

**--ttl** _**<value>**_

**--randomize-hosts** Om die aanval minder voor die hand liggend te maak

**--spoof-mac** _**<MAC address, prefix, or vendor name>**_ Om die MAC te verander — voorbeelde: Apple, 0, 01:02:03:04:05:06, deadbeefcafe, 0020F2, en Cisco

**--proxies** _**<Comma-separated list of proxy URLs>**_ Om proxies te gebruik; soms hou ’n proxy nie soveel oop verbindings as wat Nmap wil nie, so parallelism sal aangepas moet word: --max-parallelism

**-sP** Om hosts in ons netwerk deur ARP te ontdek

Baie administrateurs skep ’n firewall-reël wat alle pakkette vanaf ’n bepaalde poort deurlaat (soos 20,53 en 67); ons kan Nmap vertel om ons pakkette vanaf daardie poorte te stuur: **nmap --source-port 53 IP**

**Outputs**

**-oN file** Normal output

**-oX file** XML output

**-oS file** Script kiddies output

**-oG file** Greppable output

**-oA file** All except -oS

**-v level** verbosity

**-d level** debugging

**--reason** Rede vir host en toestand

**--stats-every time** Elke daardie tyd gee dit ’n status oor vordering

**--packet-trace** Om te sien watter pakkette uitgaan; filters kan gespesifiseer word soos: --version-trace of --script-trace

**--open** wys open, open|filtered en unfiltered

**--resume file** Gee ’n opsomming

**Miscellaneous**

**-6** Ondersteun IPv6

**-A** is dieselfde as -O -sV -sC --traceroute

**Run time**

Terwyl Nmap loop kan ons opsies verander:

v / V Verhoog / verlaag die verbosity-vlak

d / D Verhoog / verlaag die debugging-vlak

p / P Skakel packet tracing aan / af

? Druk om ’n runtime interaktiewe help-skerm te vertoon

**Vulscan**

Nmap script wat weergawes van dienste wat gevind is teen ’n offline databasis (afgelaai vanaf ander groot bronne) kyk en moontlike vulnerabilities teruggee

Die DBs wat dit gebruik is:

1. Scipvuldb.csv | [http://www.scip.ch/en/?vuldb](http://www.scip.ch/en/?vuldb)
2. Cve.csv | [http://cve.mitre.org](http://cve.mitre.org/)
3. Osvdb.csv | [http://www.osvdb.org](http://www.osvdb.org/)
4. Securityfocus.csv | [http://www.securityfocus.com/bid/](http://www.securityfocus.com/bid/)
5. Securitytracker.csv | [http://www.securitytracker.com](http://www.securitytracker.com/)
6. Xforce.csv | [http://xforce.iss.net](http://xforce.iss.net/)
7. Exploitdb.csv | [http://www.exploit-db.com](http://www.exploit-db.com/)
8. Openvas.csv | [http://www.openvas.org](http://www.openvas.org/)

Om af te laai en te installeer in die Nmap gids:

wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz && tar -czvf nmap_nse_vulscan-2.0.tar.gz vulscan/ && sudo cp -r vulscan/ /usr/share/nmap/scripts/

Jy sal ook die DB-pakkette moet aflaai en byvoeg na /usr/share/nmap/scripts/vulscan/

Gebruik:

Om alles te gebruik: sudo nmap -sV --script=vulscan HOST_TO_SCAN

Om ’n spesifieke DB te gebruik: sudo nmap -sV --script=vulscan --script-args vulscandb=cve.csv HOST_TO_SCAN

## Speed Up Nmap Service scan x16

According [**to this post**](https://joshua.hu/nmap-speedup-service-scanning-16x) you can speed up the nmap service analysis by modifying all the **`totalwaitms`** values in **`/usr/share/nmap/nmap-service-probes`** to **300** and **`tcpwrappedms`** to **200**.

Moreover, probes which do not have a specifically defined **`servicewaitms`** use a default value of **`5000`**. Therefore, we can either add values to each of the probes, or we can **compile nmap** ourselves and change the default value in [**service_scan.h**](https://github.com/nmap/nmap/blob/master/service_scan.h#L79).

If you don't want to change the values of **`totalwaitms`** and **`tcpwrappedms`** at all in the `/usr/share/nmap/nmap-service-probes` file, you can edit the [parsing code](https://github.com/nmap/nmap/blob/master/service_scan.cc#L1358) such that these values in the `nmap-service-probes` file are completely ignored.


## Build a static Nmap for restricted environments

In hardened or minimal Linux environments (containers, appliances), dynamically linked Nmap binaries often fail due to missing runtime loaders or shared libraries (e.g., /lib64/ld-linux-x86-64.so.2, libc.so). Building your own statically linked Nmap and bundling NSE data allows execution without installing system packages.

High-level approach
- Use a clean amd64 Ubuntu builder via Docker.
- Build OpenSSL and PCRE2 as static libraries.
- Build Nmap linking statically and using the included libpcap/libdnet to avoid dynamic deps.
- Bundle NSE scripts and data directories with the binary.

Discover target architecture (example)
```bash
uname -a
# If building from macOS/ARM/etc., pin the builder arch:
docker run --rm --platform=linux/amd64 -v "$(pwd)":/out -w /tmp ubuntu:22.04 bash -lc 'echo ok'
```
Stap 1 — Berei die toolchain voor
```bash
set -euo pipefail
export DEBIAN_FRONTEND=noninteractive
apt-get update && apt-get install -y --no-install-recommends \
build-essential ca-certificates curl bzip2 xz-utils pkg-config perl python3 file git \
automake autoconf libtool m4 zlib1g-dev
```
Stap 2 — Bou statiese OpenSSL (1.1.1w)
```bash
OSSL="1.1.1w"
curl -fsSLO "https://www.openssl.org/source/openssl-$OSSL.tar.gz"
tar xzf "openssl-$OSSL.tar.gz" && cd "openssl-$OSSL"
./Configure no-shared no-zlib linux-x86_64 -static --prefix=/opt/ossl
make -j"$(nproc)" && make install_sw
cd /tmp
```
Stap 3 — Bou statiese PCRE2 (10.43)
```bash
PCRE2=10.43
curl -fsSLO "https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$PCRE2/pcre2-$PCRE2.tar.bz2"
tar xjf "pcre2-$PCRE2.tar.bz2" && cd "pcre2-$PCRE2"
./configure --disable-shared --enable-static --prefix=/opt/pcre2
make -j"$(nproc)" && make install
cd /tmp
```
Stap 4 — Bou statiese Nmap (7.98)
```bash
NMAP=7.98
curl -fsSLO "https://nmap.org/dist/nmap-$NMAP.tar.bz2"
tar xjf "nmap-$NMAP.tar.bz2" && cd "nmap-$NMAP"
export CPPFLAGS="-I/opt/ossl/include -I/opt/pcre2/include"
export LDFLAGS="-L/opt/ossl/lib -L/opt/pcre2/lib -static -static-libstdc++ -static-libgcc"
export LIBS="-lpcre2-8 -ldl -lpthread -lz"
./configure \
--with-openssl=/opt/ossl \
--with-libpcre=/opt/pcre2 \
--with-libpcap=included \
--with-libdnet=included \
--without-zenmap --without-ndiff --without-nmap-update
# Avoid building shared libpcap by accident
sed -i -e "s/^shared: /shared: #/" libpcap/Makefile || true
make -j1 V=1 nmap
strip nmap
```
Belangrike punte
- -static, -static-libstdc++, -static-libgcc dwing statiese koppeling.
- Gebruik van --with-libpcap=included/--with-libdnet=included vermy stelsel-gedeelde libs.
- sed-aanpassing neutraliseer 'n gedeelde libpcap teiken indien teenwoordig.

Stap 5 — Bundel binêre en NSE-data
```bash
mkdir -p /out/nmap-bundle/nmap-data
cp nmap /out/nmap-bundle/nmap-linux-amd64-static
cp -r scripts nselib /out/nmap-bundle/nmap-data/
cp nse_main.lua nmap-services nmap-protocols nmap-service-probes \
nmap-mac-prefixes nmap-os-db nmap-payloads nmap-rpc \
/out/nmap-bundle/nmap-data/ 2>/dev/null || true

tar -C /out -czf /out/nmap-linux-amd64-static-bundle.tar.gz nmap-bundle
```
Verifikasie- en bedryfsnotas
- Gebruik file op die artefak om te bevestig dat dit staties gekoppeld is.
- Bewaar NSE-data saam met die binary om skrippariteit op hosts sonder Nmap te verseker.
- Selfs met 'n statiese binary kan uitvoering deur AppArmor/seccomp/SELinux geblokkeer word; DNS/egress moet steeds werk.
- Deterministiese builds verminder voorsieningskettingrisiko teenoor die aflaai van ondoorgrondelike “static” binaries.

One-liner (Dockerized)
<details>
<summary>Bou, bundel en druk artefak-inligting</summary>
```bash
docker run --rm --platform=linux/amd64 -v "$(pwd)":/out -w /tmp ubuntu:22.04 bash -lc '
set -euo pipefail
export DEBIAN_FRONTEND=noninteractive
apt-get update && apt-get install -y --no-install-recommends \
build-essential ca-certificates curl bzip2 xz-utils pkg-config perl python3 file git \
automake autoconf libtool m4 zlib1g-dev

OSSL="1.1.1w"; curl -fsSLO "https://www.openssl.org/source/openssl-$OSSL.tar.gz" \
&& tar xzf "openssl-$OSSL.tar.gz" && cd "openssl-$OSSL" \
&& ./Configure no-shared no-zlib linux-x86_64 -static --prefix=/opt/ossl \
&& make -j"$(nproc)" && make install_sw && cd /tmp

PCRE2=10.43; curl -fsSLO "https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$PCRE2/pcre2-$PCRE2.tar.bz2" \
&& tar xjf "pcre2-$PCRE2.tar.bz2" && cd "pcre2-$PCRE2" \
&& ./configure --disable-shared --enable-static --prefix=/opt/pcre2 \
&& make -j"$(nproc)" && make install && cd /tmp

NMAP=7.98; curl -fsSLO "https://nmap.org/dist/nmap-$NMAP.tar.bz2" \
&& tar xjf "nmap-$NMAP.tar.bz2" && cd "nmap-$NMAP" \
&& export CPPFLAGS="-I/opt/ossl/include -I/opt/pcre2/include" \
&& export LDFLAGS="-L/opt/ossl/lib -L/opt/pcre2/lib -static -static-libstdc++ -static-libgcc" \
&& export LIBS="-lpcre2-8 -ldl -lpthread -lz" \
&& ./configure --with-openssl=/opt/ossl --with-libpcre=/opt/pcre2 --with-libpcap=included --with-libdnet=included --without-zenmap --without-ndiff --without-nmap-update \
&& sed -i -e "s/^shared: /shared: #/" libpcap/Makefile || true \
&& make -j1 V=1 nmap && strip nmap

mkdir -p /out/nmap-bundle/nmap-data \
&& cp nmap /out/nmap-bundle/nmap-linux-amd64-static \
&& cp -r scripts nselib /out/nmap-bundle/nmap-data/ \
&& cp nse_main.lua nmap-services nmap-protocols nmap-service-probes nmap-mac-prefixes nmap-os-db nmap-payloads nmap-rpc /out/nmap-bundle/nmap-data/ 2>/dev/null || true \
&& tar -C /out -czf /out/nmap-linux-amd64-static-bundle.tar.gz nmap-bundle \
&& echo "===== OUTPUT ====="; ls -lah /out; echo "===== FILE TYPE ====="; file /out/nmap-bundle/nmap-linux-amd64-static || true
'
```
</details>

## Verwysings

- [Compiling static Nmap binary for jobs in restricted environments](https://www.pentestpartners.com/security-blog/compiling-static-nmap-binary-for-jobs-in-restricted-environments/)
- [Static Nmap Binary Generator (helper tool)](https://github.com/0x5ubt13/static_nmap_binary_generator)
- [OpenSSL sources](https://www.openssl.org/source/)
- [PCRE2 releases](https://github.com/PCRE2Project/pcre2/releases)
- [Nmap source tarballs](https://nmap.org/dist/)


{{#include ../../banners/hacktricks-training.md}}
