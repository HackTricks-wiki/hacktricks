# Lateral VLAN Segmentation Bypass

{{#include ../../banners/hacktricks-training.md}}

스위치에 직접 접근할 수 있는 경우, VLAN 세분화를 우회할 수 있습니다. 이는 연결된 포트를 트렁크 모드로 재구성하고, 대상 VLAN에 대한 가상 인터페이스를 설정하며, 시나리오에 따라 동적으로(DHCP) 또는 정적으로 IP 주소를 설정하는 것을 포함합니다 (**자세한 내용은 [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9) 확인하세요.**)

먼저, 특정 연결된 포트를 식별해야 합니다. 이는 일반적으로 CDP 메시지를 통해 수행되거나 **include** 마스크를 통해 포트를 검색하여 수행할 수 있습니다.

**CDP가 작동하지 않는 경우, MAC 주소를 검색하여 포트 식별을 시도할 수 있습니다**:
```
SW1(config)# show mac address-table | include 0050.0000.0500
```
트렁크 모드로 전환하기 전에 기존 VLAN 목록을 작성하고 해당 식별자를 확인해야 합니다. 이러한 식별자는 인터페이스에 할당되어 트렁크를 통해 다양한 VLAN에 접근할 수 있게 합니다. 사용 중인 포트는 예를 들어 VLAN 10과 연결되어 있습니다.
```
SW1# show vlan brief
```
**트렁크 모드로 전환하려면 인터페이스 구성 모드에 들어가야 합니다**:
```
SW1(config)# interface GigabitEthernet 0/2
SW1(config-if)# switchport trunk encapsulation dot1q
SW1(config-if)# switchport mode trunk
```
트렁크 모드로 전환하면 일시적으로 연결이 중단되지만, 이후에 복원할 수 있습니다.

그런 다음 가상 인터페이스가 생성되고, VLAN ID가 할당되며, 활성화됩니다:
```bash
sudo vconfig add eth0 10
sudo vconfig add eth0 20
sudo vconfig add eth0 50
sudo vconfig add eth0 60
sudo ifconfig eth0.10 up
sudo ifconfig eth0.20 up
sudo ifconfig eth0.50 up
sudo ifconfig eth0.60 up
```
그 후, DHCP를 통해 주소 요청이 이루어집니다. DHCP가 불가능한 경우, 주소를 수동으로 구성할 수 있습니다:
```bash
sudo dhclient -v eth0.10
sudo dhclient -v eth0.20
sudo dhclient -v eth0.50
sudo dhclient -v eth0.60
```
인터페이스(VLAN 10)에서 정적 IP 주소를 수동으로 설정하는 예:
```bash
sudo ifconfig eth0.10 10.10.10.66 netmask 255.255.255.0
```
연결성은 VLAN 10, 20, 50 및 60의 기본 게이트웨이에 ICMP 요청을 시작하여 테스트됩니다.

궁극적으로 이 프로세스는 VLAN 세분화를 우회할 수 있게 하여, 모든 VLAN 네트워크에 대한 제한 없는 접근을 용이하게 하고, 후속 작업을 위한 기반을 마련합니다.

## References

- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

{{#include ../../banners/hacktricks-training.md}}
