{{#include ../../banners/hacktricks-training.md}}

# Nadharia ya Msingi ya IPv6

## Mitandao

Anwani za IPv6 zimeundwa ili kuboresha shirika la mtandao na mwingiliano wa vifaa. Anwani ya IPv6 imegawanywa katika:

1. **Kipengele cha Mtandao**: Bits 48 za mwanzo, zinazoamua sehemu ya mtandao.
2. **Kitambulisho cha Subnet**: Bits 16 zinazofuata, zinazotumika kufafanua subnets maalum ndani ya mtandao.
3. **Kitambulisho cha Interface**: Bits 64 za mwisho, zinazotambulisha kipekee kifaa ndani ya subnet.

Ingawa IPv6 inakosa protokali ya ARP inayopatikana katika IPv4, inintroduce **ICMPv6** yenye ujumbe kuu wawili:

- **Ujumbe wa Kutafuta Majirani (NS)**: Ujumbe wa multicast kwa ajili ya kutatua anwani.
- **Tangazo la Majirani (NA)**: Majibu ya unicast kwa NS au matangazo ya ghafla.

IPv6 pia inajumuisha aina maalum za anwani:

- **Anwani ya Loopback (`::1`)**: Sawia na `127.0.0.1` ya IPv4, kwa mawasiliano ya ndani ndani ya mwenyeji.
- **Anwani za Link-Local (`FE80::/10`)**: Kwa shughuli za mtandao wa ndani, si kwa usafirishaji wa intaneti. Vifaa kwenye mtandao wa ndani sawa vinaweza kugundua kila mmoja kwa kutumia safu hii.

### Matumizi ya Vitendo ya IPv6 katika Amri za Mtandao

Ili kuingiliana na mitandao ya IPv6, unaweza kutumia amri mbalimbali:

- **Ping Anwani za Link-Local**: Angalia uwepo wa vifaa vya ndani kwa kutumia `ping6`.
- **Ugunduzi wa Majirani**: Tumia `ip neigh` kuona vifaa vilivyogunduliwa kwenye safu ya kiungo.
- **alive6**: Chombo mbadala cha kugundua vifaa kwenye mtandao sawa.

Hapa chini kuna mifano ya amri:
```bash
ping6 â€“I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
IPv6 anwani zinaweza kutolewa kutoka kwa anwani ya MAC ya kifaa kwa mawasiliano ya ndani. Hapa kuna mwongozo rahisi juu ya jinsi ya kupata anwani ya Link-local IPv6 kutoka kwa anwani ya MAC inayojulikana, na muhtasari mfupi wa aina za anwani za IPv6 na mbinu za kugundua anwani za IPv6 ndani ya mtandao.

## **Kutoa Link-local IPv6 kutoka kwa Anwani ya MAC**

Kutoa anwani ya MAC **`12:34:56:78:9a:bc`**, unaweza kujenga anwani ya Link-local IPv6 kama ifuatavyo:

1. Geuza MAC kuwa muundo wa IPv6: **`1234:5678:9abc`**
2. Ongeza `fe80::` na weka `fffe` katikati: **`fe80::1234:56ff:fe78:9abc`**
3. Geuza bit ya saba kutoka kushoto, ukibadilisha `1234` kuwa `1034`: **`fe80::1034:56ff:fe78:9abc`**

## **Aina za Anwani za IPv6**

- **Unique Local Address (ULA)**: Kwa mawasiliano ya ndani, si ya kuelekezwa kwenye mtandao wa umma. Kichwa: **`FEC00::/7`**
- **Multicast Address**: Kwa mawasiliano moja-kwa-mengi. Inatumwa kwa interfaces zote katika kundi la multicast. Kichwa: **`FF00::/8`**
- **Anycast Address**: Kwa mawasiliano moja-kwa-karibu. Inatumwa kwa interface ya karibu kulingana na itifaki ya kuelekeza. Sehemu ya **`2000::/3`** anuwai ya unicast ya kimataifa.

## **Kichwa cha Anwani**

- **fe80::/10**: Link-Local anwani (sawa na 169.254.x.x)
- **fc00::/7**: Unique Local-Unicast (sawa na anuwai za kibinafsi za IPv4 kama 10.x.x.x, 172.16.x.x, 192.168.x.x)
- **2000::/3**: Global Unicast
- **ff02::1**: Multicast Wote Nodes
- **ff02::2**: Multicast Router Nodes

## **Kugundua Anwani za IPv6 ndani ya Mtandao**

### Njia 1: Kutumia Anwani za Link-local

1. Pata anwani ya MAC ya kifaa ndani ya mtandao.
2. Pata anwani ya Link-local IPv6 kutoka kwa anwani ya MAC.

### Njia 2: Kutumia Multicast

1. Tuma ping kwa anwani ya multicast `ff02::1` ili kugundua anwani za IPv6 kwenye mtandao wa ndani.
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## IPv6 Man-in-the-Middle (MitM) Attacks

Mbinu kadhaa zipo za kutekeleza mashambulizi ya MitM katika mitandao ya IPv6, kama vile:

- Kupotosha matangazo ya jirani au router ya ICMPv6.
- Kutumia ujumbe wa ICMPv6 redirect au "Packet Too Big" kubadilisha routing.
- Kushambulia mobile IPv6 (kawaida inahitaji IPSec kuzuiliwa).
- Kuanzisha seva ya rogue DHCPv6.

# Identifying IPv6 Addresses in the eild

## Exploring Subdomains

Njia ya kupata subdomains ambazo zinaweza kuhusishwa na anwani za IPv6 inahusisha kutumia injini za utafutaji. Kwa mfano, kutumia muundo wa swali kama `ipv6.*` inaweza kuwa na ufanisi. Maalum, amri ifuatayo ya utafutaji inaweza kutumika katika Google:
```bash
site:ipv6./
```
## Kutumia Maswali ya DNS

Ili kubaini anwani za IPv6, aina fulani za rekodi za DNS zinaweza kuulizwa:

- **AXFR**: Inahitaji uhamisho kamili wa eneo, ambayo inaweza kufichua anuwai ya rekodi za DNS.
- **AAAA**: Inatafuta moja kwa moja anwani za IPv6.
- **ANY**: Swali pana linalorejesha rekodi zote za DNS zinazopatikana.

## Kuchunguza kwa Ping6

Baada ya kubaini anwani za IPv6 zinazohusiana na shirika, zana ya `ping6` inaweza kutumika kwa uchunguzi. Zana hii husaidia katika kutathmini majibu ya anwani za IPv6 zilizobainishwa, na inaweza pia kusaidia katika kugundua vifaa vya IPv6 vilivyo karibu.

## Marejeleo

- [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
- [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)

{{#include ../../banners/hacktricks-training.md}}
