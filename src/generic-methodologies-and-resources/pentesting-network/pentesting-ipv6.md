{{#include ../../banners/hacktricks-training.md}}

# Osnovna teorija IPv6

## Mreže

IPv6 adrese su strukturirane da poboljšaju organizaciju mreže i interakciju uređaja. IPv6 adresa se deli na:

1. **Mrežni prefiks**: Prvih 48 bita, koji određuju segment mreže.
2. **Subnet ID**: Sledećih 16 bita, koji se koriste za definisanje specifičnih podmreža unutar mreže.
3. **Identifikator interfejsa**: Poslednjih 64 bita, koji jedinstveno identifikuju uređaj unutar podmreže.

Dok IPv6 izostavlja ARP protokol koji se nalazi u IPv4, uvodi **ICMPv6** sa dve glavne poruke:

- **Zahtev za suseda (NS)**: Multicast poruke za rešavanje adresa.
- **Oglas suseda (NA)**: Unicast odgovori na NS ili spontani oglasi.

IPv6 takođe uključuje posebne tipove adresa:

- **Loopback adresa (`::1`)**: Ekvivalent IPv4 `127.0.0.1`, za internu komunikaciju unutar hosta.
- **Link-Local adrese (`FE80::/10`)**: Za lokalne mrežne aktivnosti, ne za internet rutiranje. Uređaji na istoj lokalnoj mreži mogu otkriti jedni druge koristeći ovaj opseg.

### Praktična upotreba IPv6 u mrežnim komandama

Da biste interagovali sa IPv6 mrežama, možete koristiti razne komande:

- **Ping Link-Local adrese**: Proverite prisustvo lokalnih uređaja koristeći `ping6`.
- **Otkriće suseda**: Koristite `ip neigh` da biste videli uređaje otkrivene na link sloju.
- **alive6**: Alternativni alat za otkrivanje uređaja na istoj mreži.

Ispod su neki primeri komandi:
```bash
ping6 –I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
IPv6 adrese se mogu izvesti iz MAC adrese uređaja za lokalnu komunikaciju. Evo pojednostavljenog vodiča o tome kako izvesti Link-local IPv6 adresu iz poznate MAC adrese, kao i kratak pregled tipova IPv6 adresa i metoda za otkrivanje IPv6 adresa unutar mreže.

## **Izvođenje Link-local IPv6 iz MAC adrese**

Data je MAC adresa **`12:34:56:78:9a:bc`**, možete konstruisati Link-local IPv6 adresu na sledeći način:

1. Konvertujte MAC u IPv6 format: **`1234:5678:9abc`**
2. Dodajte `fe80::` i umetnite `fffe` u sredinu: **`fe80::1234:56ff:fe78:9abc`**
3. Invertujte sedmi bit s leva, menjajući `1234` u `1034`: **`fe80::1034:56ff:fe78:9abc`**

## **Tipovi IPv6 adresa**

- **Unique Local Address (ULA)**: Za lokalne komunikacije, nije namenjena za javno internet rutiranje. Prefiks: **`FEC00::/7`**
- **Multicast Address**: Za komunikaciju jedan-prema-mnogima. Dostavlja se svim interfejsima u multicast grupi. Prefiks: **`FF00::/8`**
- **Anycast Address**: Za komunikaciju jedan-prema-najbližem. Šalje se najbližem interfejsu prema rutirajućem protokolu. Deo **`2000::/3`** globalnog unicast opsega.

## **Prefiksi adresa**

- **fe80::/10**: Link-Local adrese (slično 169.254.x.x)
- **fc00::/7**: Unique Local-Unicast (slično privatnim IPv4 opsezima kao što su 10.x.x.x, 172.16.x.x, 192.168.x.x)
- **2000::/3**: Global Unicast
- **ff02::1**: Multicast All Nodes
- **ff02::2**: Multicast Router Nodes

## **Otkrivanje IPv6 adresa unutar mreže**

### Način 1: Korišćenje Link-local adresa

1. Nabavite MAC adresu uređaja unutar mreže.
2. Izvedite Link-local IPv6 adresu iz MAC adrese.

### Način 2: Korišćenje Multicast

1. Pošaljite ping na multicast adresu `ff02::1` da otkrijete IPv6 adrese na lokalnoj mreži.
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## IPv6 Man-in-the-Middle (MitM) napadi

Postoji nekoliko tehnika za izvođenje MitM napada u IPv6 mrežama, kao što su:

- Lažiranje ICMPv6 suseda ili usmerivačkih oglasa.
- Korišćenje ICMPv6 preusmeravanja ili poruka "Packet Too Big" za manipulaciju rutiranjem.
- Napad na mobilni IPv6 (obično zahteva da IPSec bude onemogućen).
- Postavljanje lažnog DHCPv6 servera.

# Identifikacija IPv6 adresa u terenu

## Istraživanje poddomena

Metoda za pronalaženje poddomena koji su potencijalno povezani sa IPv6 adresama uključuje korišćenje pretraživača. Na primer, korišćenje obrasca upita kao što je `ipv6.*` može biti efikasno. Konkretno, sledeća pretraga može se koristiti u Google-u:
```bash
site:ipv6./
```
## Korišćenje DNS Upita

Da bi se identifikovale IPv6 adrese, određene vrste DNS zapisa mogu se upitavati:

- **AXFR**: Zahteva potpunu transfer zonu, potencijalno otkrivajući širok spektar DNS zapisa.
- **AAAA**: Direktno traži IPv6 adrese.
- **ANY**: Širok upit koji vraća sve dostupne DNS zapise.

## Istraživanje sa Ping6

Nakon identifikacije IPv6 adresa povezanih sa organizacijom, `ping6` alat može se koristiti za istraživanje. Ovaj alat pomaže u proceni odzivnosti identifikovanih IPv6 adresa, i može takođe pomoći u otkrivanju susednih IPv6 uređaja.

## Reference

- [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
- [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)

{{#include ../../banners/hacktricks-training.md}}
