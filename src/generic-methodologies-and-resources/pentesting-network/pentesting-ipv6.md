{{#include ../../banners/hacktricks-training.md}}

# Théorie de base de l'IPv6

## Réseaux

Les adresses IPv6 sont structurées pour améliorer l'organisation du réseau et l'interaction des dispositifs. Une adresse IPv6 est divisée en :

1. **Préfixe de réseau** : Les 48 premiers bits, déterminant le segment de réseau.
2. **ID de sous-réseau** : Les 16 bits suivants, utilisés pour définir des sous-réseaux spécifiques au sein du réseau.
3. **Identifiant d'interface** : Les 64 derniers bits, identifiant de manière unique un dispositif au sein du sous-réseau.

Bien que l'IPv6 omette le protocole ARP trouvé dans l'IPv4, il introduit **ICMPv6** avec deux messages principaux :

- **Solicitation de voisin (NS)** : Messages multicast pour la résolution d'adresse.
- **Annonce de voisin (NA)** : Réponses unicast aux NS ou annonces spontanées.

L'IPv6 incorpore également des types d'adresses spéciaux :

- **Adresse de boucle (`::1`)** : Équivalente à `127.0.0.1` de l'IPv4, pour la communication interne au sein de l'hôte.
- **Adresses Link-Local (`FE80::/10`)** : Pour les activités de réseau local, non pour le routage Internet. Les dispositifs sur le même réseau local peuvent se découvrir en utilisant cette plage.

### Utilisation pratique de l'IPv6 dans les commandes réseau

Pour interagir avec les réseaux IPv6, vous pouvez utiliser diverses commandes :

- **Ping des adresses Link-Local** : Vérifiez la présence de dispositifs locaux en utilisant `ping6`.
- **Découverte de voisin** : Utilisez `ip neigh` pour voir les dispositifs découverts au niveau de la couche de liaison.
- **alive6** : Un outil alternatif pour découvrir des dispositifs sur le même réseau.

Voici quelques exemples de commandes :
```bash
ping6 –I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
Les adresses IPv6 peuvent être dérivées de l'adresse MAC d'un appareil pour la communication locale. Voici un guide simplifié sur la façon de dériver l'adresse IPv6 Link-local à partir d'une adresse MAC connue, ainsi qu'un aperçu des types d'adresses IPv6 et des méthodes pour découvrir des adresses IPv6 au sein d'un réseau.

## **Dérivation de l'IPv6 Link-local à partir de l'adresse MAC**

Étant donné une adresse MAC **`12:34:56:78:9a:bc`**, vous pouvez construire l'adresse IPv6 Link-local comme suit :

1. Convertir la MAC au format IPv6 : **`1234:5678:9abc`**
2. Préfixer `fe80::` et insérer `fffe` au milieu : **`fe80::1234:56ff:fe78:9abc`**
3. Inverser le septième bit à partir de la gauche, changeant `1234` en `1034` : **`fe80::1034:56ff:fe78:9abc`**

## **Types d'adresses IPv6**

- **Adresse locale unique (ULA)** : Pour les communications locales, non destinée au routage sur Internet public. Préfixe : **`FEC00::/7`**
- **Adresse multicast** : Pour la communication un-à-plusieurs. Livrée à toutes les interfaces dans le groupe multicast. Préfixe : **`FF00::/8`**
- **Adresse anycast** : Pour la communication un-à-proche. Envoyée à l'interface la plus proche selon le protocole de routage. Partie de la plage unicast globale **`2000::/3`**.

## **Préfixes d'adresses**

- **fe80::/10** : Adresses Link-Local (similaire à 169.254.x.x)
- **fc00::/7** : Unicast local unique (similaire aux plages IPv4 privées comme 10.x.x.x, 172.16.x.x, 192.168.x.x)
- **2000::/3** : Unicast global
- **ff02::1** : Multicast Tous les Nœuds
- **ff02::2** : Multicast Nœuds Routeurs

## **Découverte des adresses IPv6 au sein d'un réseau**

### Méthode 1 : Utilisation des adresses Link-local

1. Obtenez l'adresse MAC d'un appareil au sein du réseau.
2. Dérivez l'adresse IPv6 Link-local à partir de l'adresse MAC.

### Méthode 2 : Utilisation du multicast

1. Envoyez un ping à l'adresse multicast `ff02::1` pour découvrir les adresses IPv6 sur le réseau local.
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## Attaques Man-in-the-Middle (MitM) IPv6

Plusieurs techniques existent pour exécuter des attaques MitM dans des réseaux IPv6, telles que :

- Usurpation des annonces de voisins ou de routeurs ICMPv6.
- Utilisation de messages ICMPv6 de redirection ou "Packet Too Big" pour manipuler le routage.
- Attaque sur IPv6 mobile (nécessite généralement que l'IPSec soit désactivé).
- Mise en place d'un serveur DHCPv6 malveillant.

# Identification des adresses IPv6 dans le champ

## Exploration des sous-domaines

Une méthode pour trouver des sous-domaines potentiellement liés à des adresses IPv6 consiste à tirer parti des moteurs de recherche. Par exemple, utiliser un modèle de requête comme `ipv6.*` peut être efficace. Plus précisément, la commande de recherche suivante peut être utilisée dans Google :
```bash
site:ipv6./
```
## Utilisation des requêtes DNS

Pour identifier les adresses IPv6, certains types d'enregistrements DNS peuvent être interrogés :

- **AXFR** : Demande un transfert complet de zone, pouvant révéler un large éventail d'enregistrements DNS.
- **AAAA** : Recherche directement des adresses IPv6.
- **ANY** : Une requête large qui renvoie tous les enregistrements DNS disponibles.

## Exploration avec Ping6

Après avoir identifié les adresses IPv6 associées à une organisation, l'utilitaire `ping6` peut être utilisé pour l'exploration. Cet outil aide à évaluer la réactivité des adresses IPv6 identifiées et peut également aider à découvrir des dispositifs IPv6 adjacents.

## Références

- [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
- [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)

{{#include ../../banners/hacktricks-training.md}}
