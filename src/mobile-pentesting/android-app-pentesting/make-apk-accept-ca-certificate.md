{{#include ../../banners/hacktricks-training.md}}

Alguns aplicativos não aceitam certificados baixados pelo usuário, então, para inspecionar o tráfego da web de alguns aplicativos, precisamos realmente descompilar o aplicativo, adicionar algumas coisas e recompilá-lo.

# Automático

A ferramenta [**https://github.com/shroudedcode/apk-mitm**](https://github.com/shroudedcode/apk-mitm) fará **automaticamente** as alterações necessárias no aplicativo para começar a capturar as solicitações e também desativará o pinning de certificado (se houver).

# Manual

Primeiro, descompilamos o aplicativo: `apktool d *file-name*.apk`

![](../../images/img9.png)

Em seguida, vamos para o arquivo **Manifest.xml** e rolamos até a tag `<\application android>` e vamos adicionar a seguinte linha se ela ainda não estiver lá:

`android:networkSecurityConfig="@xml/network_security_config"`

Antes de adicionar:

![](../../images/img10.png)

Depois de adicionar:

![](../../images/img11.png)

Agora vá para a pasta **res/xml** e crie/modifique um arquivo chamado network_security_config.xml com o seguinte conteúdo:
```markup
<network-security-config>
<base-config>
<trust-anchors>
<!-- Trust preinstalled CAs -->
<certificates src="system" />
<!-- Additionally trust user added CAs -->
<certificates src="user" />
</trust-anchors>
</base-config>
</network-security-config>
```
Então salve o arquivo e saia de todos os diretórios e reconstrua o apk com o seguinte comando: `apktool b *folder-name/* -o *output-file.apk*`

![](../../images/img12.png)

Finalmente, você só precisa **assinar a nova aplicação**. [Leia esta seção da página Smali - Decompiling/\[Modifying\]/Compiling para aprender como assiná-la](smali-changes.md#sing-the-new-apk).

{{#include ../../banners/hacktricks-training.md}}
