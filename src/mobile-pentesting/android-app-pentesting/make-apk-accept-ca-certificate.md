{{#include ../../banners/hacktricks-training.md}}

Alcune applicazioni non gradiscono i certificati scaricati dagli utenti, quindi per ispezionare il traffico web di alcune app dobbiamo effettivamente decompilare l'applicazione, aggiungere alcune cose e ricompilarla.

# Automatico

Lo strumento [**https://github.com/shroudedcode/apk-mitm**](https://github.com/shroudedcode/apk-mitm) apporterà **automaticamente** le modifiche necessarie all'applicazione per iniziare a catturare le richieste e disabiliterà anche il certificate pinning (se presente).

# Manuale

Prima decompiliamo l'app: `apktool d *file-name*.apk`

![](../../images/img9.png)

Poi andiamo nel file **Manifest.xml** e scorriamo fino al tag `<\application android>` e aggiungiamo la seguente riga se non è già presente:

`android:networkSecurityConfig="@xml/network_security_config"`

Prima di aggiungere:

![](../../images/img10.png)

Dopo aver aggiunto:

![](../../images/img11.png)

Ora andiamo nella cartella **res/xml** e creiamo/modifichiamo un file chiamato network_security_config.xml con i seguenti contenuti:
```markup
<network-security-config>
<base-config>
<trust-anchors>
<!-- Trust preinstalled CAs -->
<certificates src="system" />
<!-- Additionally trust user added CAs -->
<certificates src="user" />
</trust-anchors>
</base-config>
</network-security-config>
```
Quindi salva il file e esci da tutte le directory e ricostruisci l'apk con il seguente comando: `apktool b *folder-name/* -o *output-file.apk*`

![](../../images/img12.png)

Infine, devi solo **firmare la nuova applicazione**. [Leggi questa sezione della pagina Smali - Decompiling/\[Modifying\]/Compiling per imparare come firmarlo](smali-changes.md#sing-the-new-apk).

{{#include ../../banners/hacktricks-training.md}}
