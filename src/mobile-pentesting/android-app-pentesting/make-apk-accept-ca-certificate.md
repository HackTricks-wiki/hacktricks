{{#include ../../banners/hacktricks-training.md}}

Certaines applications n'aiment pas les certificats téléchargés par l'utilisateur, donc pour inspecter le trafic web de certaines applications, nous devons en fait décompiler l'application, ajouter quelques éléments et la recompiler.

# Automatique

L'outil [**https://github.com/shroudedcode/apk-mitm**](https://github.com/shroudedcode/apk-mitm) effectuera **automatiquement** les modifications nécessaires à l'application pour commencer à capturer les requêtes et désactivera également le certificat de pinning (s'il y en a).

# Manuel

Tout d'abord, nous décompilons l'application : `apktool d *file-name*.apk`

![](../../images/img9.png)

Ensuite, nous allons dans le fichier **Manifest.xml** et faisons défiler jusqu'à la balise `<\application android>` et nous allons ajouter la ligne suivante si elle n'est pas déjà présente :

`android:networkSecurityConfig="@xml/network_security_config"`

Avant d'ajouter :

![](../../images/img10.png)

Après ajout :

![](../../images/img11.png)

Maintenant, allez dans le dossier **res/xml** et créez/modifiez un fichier nommé network_security_config.xml avec le contenu suivant :
```markup
<network-security-config>
<base-config>
<trust-anchors>
<!-- Trust preinstalled CAs -->
<certificates src="system" />
<!-- Additionally trust user added CAs -->
<certificates src="user" />
</trust-anchors>
</base-config>
</network-security-config>
```
Ensuite, enregistrez le fichier et sortez de tous les répertoires, puis reconstruisez l'apk avec la commande suivante : `apktool b *folder-name/* -o *output-file.apk*`

![](../../images/img12.png)

Enfin, vous devez simplement **signer la nouvelle application**. [Lisez cette section de la page Smali - Decompiling/\[Modifying\]/Compiling pour apprendre comment la signer](smali-changes.md#sing-the-new-apk).

{{#include ../../banners/hacktricks-training.md}}
