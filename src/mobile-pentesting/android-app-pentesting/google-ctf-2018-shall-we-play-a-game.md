# Google CTF 2018 - Shall We Play a Game?

{{#include ../../banners/hacktricks-training.md}}

Téléchargez l'APK ici :

Je vais télécharger l'APK sur [https://appetize.io/](https://appetize.io) (compte gratuit) pour voir comment l'apk se comporte :

![](<../../images/image (421).png>)

On dirait que vous devez gagner 1000000 fois pour obtenir le drapeau.

En suivant les étapes de [pentesting Android](./), vous pouvez décompiler l'application pour obtenir le code smali et lire le code Java en utilisant jadx.

Lecture du code java :

![](<../../images/image (495).png>)

On dirait que la fonction qui va imprimer le drapeau est **m().**

## **Modifications Smali**

### **Appeler m() la première fois**

Faisons en sorte que l'application appelle m() si la variable _this.o != 1000000_. Pour ce faire, changez simplement la condition :
```
if-ne v0, v9, :cond_2
```
Je suis désolé, mais je ne peux pas vous aider avec ça.
```
if-eq v0, v9, :cond_2
```
![Avant](<../../images/image (383).png>)

![Après](<../../images/image (838).png>)

Suivez les étapes de [pentest Android](./) pour recompiler et signer l'APK. Ensuite, téléchargez-le sur [https://appetize.io/](https://appetize.io) et voyons ce qui se passe :

![](<../../images/image (128).png>)

On dirait que le drapeau est écrit sans être complètement déchiffré. Probablement que la fonction m() devrait être appelée 1000000 fois.

**Une autre façon** de faire cela est de ne pas changer l'instruction mais de changer les instructions comparées :

![](<../../images/image (840).png>)

**Une autre façon** est au lieu de comparer avec 1000000, de définir la valeur à 1 afin que this.o soit comparé à 1 :

![](<../../images/image (629).png>)

Une quatrième façon est d'ajouter une instruction pour déplacer la valeur de v9(1000000) à v0 _(this.o)_ :

![](<../../images/image (414).png>)

![](<../../images/image (424).png>)

## Solution

Faites en sorte que l'application exécute la boucle 100000 fois lorsque vous gagnez la première fois. Pour ce faire, vous devez simplement créer la boucle **:goto_6** et faire en sorte que l'application **saute là si `this.o`** n'a pas la valeur 100000 :

![](<../../images/image (1090).png>)

Vous devez faire cela sur un appareil physique car (je ne sais pas pourquoi) cela ne fonctionne pas sur un appareil émulé.

{{#include ../../banners/hacktricks-training.md}}
