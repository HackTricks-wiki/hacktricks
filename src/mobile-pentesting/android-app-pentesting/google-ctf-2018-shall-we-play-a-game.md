# Google CTF 2018 - Shall We Play a Game?

{{#include ../../banners/hacktricks-training.md}}

APKをここからダウンロード：

APKの挙動を確認するために、[https://appetize.io/](https://appetize.io)（無料アカウント）にAPKをアップロードします：

![](<../../images/image (421).png>)

フラグを取得するには1000000回勝つ必要があるようです。

[Androidのペンテスト](./)の手順に従って、アプリケーションをデコンパイルしてsmaliコードを取得し、jadxを使用してJavaコードを読むことができます。

Javaコードを読む：

![](<../../images/image (495).png>)

フラグを印刷する関数は**m()**のようです。

## **Smaliの変更**

### **最初にm()を呼び出す**

変数_this.oが1000000でない場合にアプリケーションがm()を呼び出すようにしましょう。そのためには、条件を変更するだけです：
```
if-ne v0, v9, :cond_2
```
翻訳するテキストを提供してください。
```
if-eq v0, v9, :cond_2
```
![Before](<../../images/image (383).png>)

![After](<../../images/image (838).png>)

[Androidのペンテスト](./)の手順に従ってAPKを再コンパイルして署名します。次に、[https://appetize.io/](https://appetize.io)にアップロードして、何が起こるか見てみましょう：

![](<../../images/image (128).png>)

フラグは完全に復号化されずに書き込まれているようです。おそらくm()関数は1000000回呼び出されるべきです。

**別の方法**は、命令を変更せずに比較される命令を変更することです：

![](<../../images/image (840).png>)

**別の方法**は、1000000と比較するのではなく、値を1に設定してthis.oが1と比較されるようにすることです：

![](<../../images/image (629).png>)

4つ目の方法は、v9(1000000)の値をv0 _(this.o)_に移動する命令を追加することです：

![](<../../images/image (414).png>)

![](<../../images/image (424).png>)

## 解決策

最初に勝ったときにアプリケーションがループを100000回実行するようにします。そのためには、**:goto_6**ループを作成し、`this.o`が100000の値でない場合にアプリケーションが**そこにジャンプする**ようにします：

![](<../../images/image (1090).png>)

これを物理デバイス内で行う必要があります（なぜかはわかりませんが、エミュレートされたデバイスでは動作しません）。

{{#include ../../banners/hacktricks-training.md}}
