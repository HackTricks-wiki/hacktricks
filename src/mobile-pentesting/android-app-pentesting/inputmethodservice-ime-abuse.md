# Android IME / InputMethodService Misbruik (Skadelike Sleutelborde)

{{#include ../../banners/hacktricks-training.md}}

## Oorsig

Android laat derdeparty-sleutelborde toe via 'n `InputMethodService` (IME). Sodra 'n gebruiker 'n sleutelbord **aktiveer** en dit kies as die **huidige invoermetode**, kan die IME in wese **alle teksinvoer** wat op die toestel oor toepassings heen gegenereer word, bespied (en beïnvloed).

Dit is waarom verskeie Android banking trojans 'n "secure keyboard" funksie insluit: die kwaadwillige IME ontvang toetsaanslae selfs van toepassings wat nooit 'n `WebView` inbed nie (banktoepassings, kletsapps, crypto wallets, ens.).

> [!NOTE]
> `android.permission.BIND_INPUT_METHOD` word gewoonlik op die IME *service* gedeklaar sodat slegs die stelsel daaraan kan bind. Dit verklaar op sigself gee nie spesiale voorregte nie; die sleutelstap is om die slagoffer te kry om die sleutelbord in die Instellings te **aktiveer/kies**.

## Manifest-verklaring

'n Sleutelbord word blootgestel via 'n service met die `android.view.InputMethod` intent-aksie en 'n IME-konfigurasie-XML:
```xml
<!-- AndroidManifest.xml -->
<service
android:name=".SpyKeyboard"
android:permission="android.permission.BIND_INPUT_METHOD"
android:exported="false">

<intent-filter>
<action android:name="android.view.InputMethod" />
</intent-filter>

<meta-data
android:name="android.view.im"
android:resource="@xml/spy_ime" />
</service>
```
**Opsporingswenk:** 'n app wat nie na 'n sleutelbord lyk nie maar 'n `InputMethodService` verklaar, is 'n sterk rooi vlag.

## Waar die data vandaan kom

Tydens uitvoering leer 'n IME:

- Die **teiken-app** waarin getik word (via `EditorInfo`, bv. `attribute.packageName` in `onStartInput`).
- Die teks wat ingevoer word (deur die IME se interaksie met die huidige `InputConnection` en/of sleutelgebeurtenisse, afhangend van die implementering).

Minimale (nie-funksionele) skets van die hoë-signaal hookpunt:
```java
public class SpyKeyboard extends InputMethodService {
@Override public void onStartInput(EditorInfo attribute, boolean restarting) {
// attribute.packageName identifies the foreground app receiving input
}
}
```
## Algemene aktiverings- en versamelingswerkvloei (waargeneem in die veld)

- Die APK word bemark as ’n “veilige toetsbord” of die toetsbord is ingebed in ’n breër trojan.
- Die malware lei die slagoffer na die stelseltoetsbordinstellings (bv. deur `Settings.ACTION_INPUT_METHOD_SETTINGS` te laai en/of UI automation te gebruik) totdat die IME aangeskakel en as verstek gestel is.
- Toetsdrukke word per-app gebuffer en via die malware se bestaande C2-kanaal exfiltrated, dikwels gekombineer met ander databronne (bv., `WebView` man-in-the-browser telemetry).

## Hoe om op te spoor / te triageer

### Toestelkontroles

- **Instellings**: Geïnstalleerde toetsborde / standaardtoetsbord (kyk vir onbekende IMEs).
- **ADB**:
```bash
adb shell dumpsys input_method
adb shell ime list -a
adb shell ime help
```
### Statiese triage van 'n APK

- Kyk vir `InputMethodService` klasse en die `android.view.InputMethod` intent filter.
- Inspekteer die `@xml/*` IME-config wat deur `android.view.im` verwys word.
- Kontroleer of die app se verklaarde funksionaliteit ooreenstem met die lewering van 'n volledige sleutelbord-UI/hulpbronne.

## Mitigasies

- **Gebruiker/MDM**: gebruik 'n toelaatlys vir betroubare sleutelborde; blokkeer onbekende IMEs in bestuurde profiele/toestelle.
- **App-kant (hoogrisko-apps)**: verkies phishing-weerstandige verifikasie (passkeys/biometrics) en vermy om op “secret text entry” as 'n sekuriteitsgrens staat te maak (n kwaadaardige IME sit onder die app UI).
