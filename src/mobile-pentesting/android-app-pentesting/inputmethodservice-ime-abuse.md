# Android IME / InputMethodService दुरुपयोग (दुष्ट कीबोर्ड)

{{#include ../../banners/hacktricks-training.md}}

## सारांश

Android तीसरे-पक्ष कीबोर्ड को `InputMethodService` (IME) के माध्यम से अनुमति देता है। एक बार जब उपयोगकर्ता किसी कीबोर्ड को **सक्रिय** कर देता है और उसे **वर्तमान इनपुट मेथड** के रूप में चुन लेता है, तो IME डिवाइस पर ऐप्स में उत्पन्न लगभग **सभी टेक्स्ट इनपुट** को देख (और प्रभावित) कर सकता है।

इसी वजह से कई Android बैंकिंग trojans एक “secure keyboard” फीचर बंडल करते हैं: दुष्ट IME को कीस्ट्रोक्स मिलते हैं यहाँ तक कि उन ऐप्स से भी जो कभी `WebView` एम्बेड नहीं करते (banking apps, chat apps, crypto wallets, आदि)।

> [!NOTE]
> `android.permission.BIND_INPUT_METHOD` सामान्यतः IME *service* पर घोषित किया जाता है ताकि केवल सिस्टम ही इसे bind कर सके। इसे घोषित करने से अपने आप कोई विशेष privilegess नहीं मिलते; मुख्य कदम पीड़ित को Settings में कीबोर्ड को **सक्रिय/चुन**ने के लिए प्रेरित करना है।

## मैनिफेस्ट घोषणा

एक कीबोर्ड एक सेवा के माध्यम से एक्सपोज़ किया जाता है जिसका intent action `android.view.InputMethod` होता है और एक IME configuration XML:
```xml
<!-- AndroidManifest.xml -->
<service
android:name=".SpyKeyboard"
android:permission="android.permission.BIND_INPUT_METHOD"
android:exported="false">

<intent-filter>
<action android:name="android.view.InputMethod" />
</intent-filter>

<meta-data
android:name="android.view.im"
android:resource="@xml/spy_ime" />
</service>
```
**Hunting tip:** कीबोर्ड जैसा न दिखने वाला एक ऐप जो `InputMethodService` घोषित करता है, गंभीर चेतावनी संकेत है।

## डेटा कहाँ से आता है

रनटाइम पर IME निम्न जानकारी प्राप्त करता है:

- जिस ऐप में टाइप किया जा रहा है वह **लक्षित ऐप** (`EditorInfo` के माध्यम से, उदाहरण के लिए `onStartInput` में `attribute.packageName`)।
- दर्ज किया जा रहा टेक्स्ट (IME की वर्तमान `InputConnection` के साथ इंटरैक्शन और/या key events के माध्यम से, जो implementation पर निर्भर करता है)।

न्यूनतम (गैर-कार्यात्मक) स्केच उच्च-सिग्नल हुक बिंदु का:
```java
public class SpyKeyboard extends InputMethodService {
@Override public void onStartInput(EditorInfo attribute, boolean restarting) {
// attribute.packageName identifies the foreground app receiving input
}
}
```
## सामान्य सक्रियकरण और संग्रह वर्कफ़्लो (वाइल्ड में देखा गया)

- APK को “सुरक्षित कीबोर्ड” के रूप में मार्केट किया जाता है या कीबोर्ड किसी बड़े trojan के अंदर एम्बेड होता है।
- malware पीड़ित को सिस्टम कीबोर्ड सेटिंग्स में ले जाता है (उदा. `Settings.ACTION_INPUT_METHOD_SETTINGS` लॉन्च करके और/या UI automation का उपयोग करके) जब तक IME सक्षम न हो जाए और default सेट न हो जाए।
- Keystrokes प्रति-app बफ़र किए जाते हैं और malware के मौजूदा C2 चैनल के माध्यम से exfiltrated किए जाते हैं, अक्सर अन्य डेटा स्रोतों (उदा., `WebView` man-in-the-browser telemetry) के साथ मिलाकर।

## पहचान / ट्रायाज

### डिवाइस पर जाँच

- **Settings**: Installed keyboards / default keyboard (अनजान IMEs देखें).
- **ADB**:
```bash
adb shell dumpsys input_method
adb shell ime list -a
adb shell ime help
```
### APK की स्थैतिक जाँच

- `InputMethodService` क्लासेस और `android.view.InputMethod` intent filter की खोज करें।
- `@xml/*` IME config का निरीक्षण करें जो `android.view.im` द्वारा संदर्भित है।
- जाँचें कि ऐप की कथित कार्यक्षमता पूरी keyboard UI/resources भेजने से मेल खाती है या नहीं।

## निवारक उपाय

- **User/MDM**: विश्वसनीय keyboards को allowlist करें; managed profiles/devices में अज्ञात IMEs को ब्लॉक करें।
- **App-side (high risk apps)**: phishing-resistant प्रमाणीकरण (passkeys/biometrics) को प्राथमिकता दें और “secret text entry” को सुरक्षा सीमा के रूप में भरोसा करने से बचें (एक दुष्ट IME ऐप UI के नीचे स्थित रहता है)।
