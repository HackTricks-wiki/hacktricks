# Tapjacking

{{#include ../../banners/hacktricks-training.md}}


## **बुनियादी जानकारी**

**Tapjacking** एक हमला है जहाँ एक **malicious** **application** लॉन्च की जाती है और यह **positions itself on top of a victim application**. जब यह विजिबली victim app को ओक्लूड कर देता है, तो इसका **user interface** इस तरह डिज़ाइन किया जाता है कि उपयोगकर्ता को इससे इंटरैक्ट करने के लिए भ्रमित किया जा सके, जबकि यह इंटरैक्शन को victim app तक पास कर रहा होता है। प्रभावतः, यह उपयोगकर्ता को यह जानने से अंधा कर देता है कि वे असल में victim app पर कार्रवाई कर रहे हैं।

### पहचान

* Android manifest में **exported activities** देखें (intent-filter वाले activity डिफ़ॉल्ट रूप से exported होते हैं)। यदि कोई exported activity किसी permission से protected है, तो attacking app को वही **same permission** चाहिए होगा, जो exploitability को सीमित करता है।
* `AndroidManifest.xml` में **minimum SDK** वर्ज़न `android:minSdkVersion` जांचें। यदि यह **lower than 30** है, तो पुराने डिफ़ॉल्ट व्यवहार tapjacking को exploit करने में आसान बना सकते हैं।
* रनटाइम पर blocked touches का पता लगाने के लिए `logcat` का उपयोग करें (Android 12+): सिस्टम तब लॉग करता है `Untrusted touch due to occlusion by <package>` जब overlays फ़िल्टर किए जाते हैं।

### सुरक्षा

#### Android 12+ डिफ़ॉल्ट ब्लॉकिंग और compat flags

Android 12 (API 31) ने **"Block untrusted touches"** पेश किया: किसी अन्य UID विंडो से आने वाले touches जिनका प्रकार `TYPE_APPLICATION_OVERLAY` है (opacity ≥0.8) उन्हें ड्रॉप कर दिया जाता है। यह डिफ़ॉल्ट रूप से सक्षम है। टेस्ट के दौरान आप इसे टॉगल कर सकते हैं:
```bash
# disable blocking for a specific package (for PoC crafting)
adb shell am compat disable BLOCK_UNTRUSTED_TOUCHES com.example.victim
# re‑enable
adb shell am compat reset BLOCK_UNTRUSTED_TOUCHES com.example.victim
```
विश्वसनीय विंडो (accessibility, IME, assistant) अभी भी इवेंट्स प्राप्त करती हैं। अदृश्य या पूरी तरह पारदर्शी overlays भी block को बायपास कर देते हैं, जिसे हमलावर `alpha < 0.8` रखकर दुरुपयोग करने की कोशिश करते हैं।

#### **partial occlusion** से निपटना

ऐसे आंशिक overlays जो लक्षित क्षेत्र को दिखाई देने योग्य छोड़ते हैं उन्हें auto-block नहीं किया जाता। संवेदनशील views में इन्हें निवारण करें — उन इवेंट्स को reject करके जिनमें **`FLAG_WINDOW_IS_PARTIALLY_OBSCURED`** flag लगा हो:
```java
@Override
public boolean onFilterTouchEventForSecurity(MotionEvent event) {
if ((event.getFlags() & MotionEvent.FLAG_WINDOW_IS_PARTIALLY_OBSCURED) != 0) {
return false; // drop tap when anything partially obscures us
}
return super.onFilterTouchEventForSecurity(event);
}
```
#### `filterTouchesWhenObscured`

यदि **`android:filterTouchesWhenObscured`** को **`true`** पर सेट किया गया है, तो `View` को टच नहीं मिलेंगे जब भी view की विंडो किसी अन्य दिखाई देने वाली विंडो द्वारा छिपाई गई हो।

#### **`setFilterTouchesWhenObscured`**

एट्रिब्यूट **`setFilterTouchesWhenObscured`** को true पर सेट करने से इस vulnerability के exploitation को रोक सकता है यदि Android संस्करण निचला हो।\
यदि इसे **`true`** पर सेट किया जाए, उदाहरण के लिए, एक बटन अपने आप **छिपा होने पर अक्षम** किया जा सकता है:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## शोषण

### Tapjacking-ExportedActivity

सबसे हालिया Android एप्लिकेशन जो Tapjacking हमला करता है (और लक्षित एप्लिकेशन की exported activity को पहले invoke करता है) पाया जा सकता है: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

इसे उपयोग करने के लिए **README निर्देशों** का पालन करें।

### FloatingWindowApp

एक उदाहरण प्रोजेक्ट जो **FloatingWindowApp** को implement करता है, जिसका उपयोग अन्य activities के ऊपर रखकर clickjacking attack करने के लिए किया जा सकता है, पाया जा सकता है [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (काफ़ी पुराना है, apk build करने में शुभकामनाएँ)।

### Qark

> [!CAUTION]
> ऐसा लगता है कि यह प्रोजेक्ट अब unmaintained है और यह functionality अब ठीक से काम नहीं कर रही है

आप [**qark**](https://github.com/linkedin/qark) का उपयोग `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` पैरामीटर्स के साथ करके संभावित **Tapjacking** कमजोरियों का परीक्षण करने के लिए एक malicious application बना सकते हैं.\

निवारण अपेक्षाकृत सरल है क्योंकि developer चुन सकता है कि जब कोई view किसी अन्य द्वारा ढकी हो तो touch events न ग्रहण किए जाएँ। [Android Developer’s Reference](https://developer.android.com/reference/android/view/View#security) का उपयोग करते हुए:

> कभी-कभी यह आवश्यक होता है कि एक एप्लिकेशन यह सत्यापित कर सके कि कोई क्रिया उपयोगकर्ता के पूर्ण ज्ञान और सहमति के साथ की जा रही है, जैसे कि permission request को स्वीकृत करना, कोई खरीदारी करना या किसी advertisement पर क्लिक करना। दुर्भाग्यवश, एक malicious application उपयोगकर्ता को इन क्रियाओं के लिए अनभिज्ञ रूप से स्पूफ़ करने की कोशिश कर सकता है, यदि वह view के इरादे को छिपा दे। समाधान के रूप में, framework एक touch filtering मैकेनिज्म प्रदान करता है जिसका उपयोग उन views की सुरक्षा सुधारने के लिए किया जा सकता है जो संवेदनशील functionality तक पहुँच प्रदान करते हैं।
>
> Touch filtering सक्षम करने के लिए, [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) को कॉल करें या android:filterTouchesWhenObscured layout attribute को true सेट करें। जब सक्षम हो, framework उन touches को discard कर देगा जो तब प्राप्त होते हैं जब view की window किसी अन्य visible window द्वारा obscured होती है। परिणामस्वरूप, view को touches नहीं मिलेंगे जब भी कोई toast, dialog या अन्य window view की window के ऊपर दिखाई दे।

---

### Recent overlay-based malware techniques

* **Hook/Ermac variants** लगभग पारदर्शी overlays (उदाहरण के लिए fake NFC prompts) का उपयोग gestures और lock-screen PINs capture करने के लिए करते हैं जबकि touches को नीचे forward किया जाता है, और ये Accessibility-ATS modules के माध्यम से वितरित होते हैं।
* **Anatsa/TeaBot droppers** सैकड़ों banking/crypto apps के लिए overlays भेजते हैं और पूर्ण-स्क्रीन "maintenance" overlays दिखाते हैं ताकि पीड़ित रोक दिए जाएँ जबकि ATS transfers पूरा करता है।
* **Hidden-VNC banking RATs** संक्षेप में phishing overlays दिखाकर credentials capture करते हैं, फिर covert VNC और Accessibility पर निर्भर रहते हैं ताकि taps को replay किया जा सके और ऑन-डिवाइस artifacts कम रहें।

रेड टीमों के लिए व्यावहारिक निष्कर्ष: Android 12 blocking को बायपास करने के लिए `alpha < 0.8` overlay मिलाएँ, फिर उपयोगकर्ता सेवा toggle करने के बाद full-screen accessibility overlay पर escalate करें। credentials capture होने के बाद नियंत्रण बनाए रखने के लिए `GestureDescription` या headless VNC को instrument करें।

---

## Accessibility Overlay Phishing (Banking-Trojan Variant)

classic Tapjacking के अलावा, आधुनिक Android banking malware परिवार (उदाहरण के लिए **ToxicPanda**, BrasDex, Sova, आदि) **Accessibility Service** का दुरुपयोग करते हैं ताकि वे वैध एप्लिकेशन के ऊपर full-screen WebView **overlay** रख सकें और फिर भी उपयोगकर्ता इनपुट को नीचे स्थित view पर **forward** कर सकें। यह विश्वसनीयता बहुत बढ़ा देता है और attackers को credentials, OTPs चुराने या fraudulent transactions को ऑटोमेट करने की अनुमति देता है।

### यह कैसे काम करता है
1. Malicious APK उच्च-संवेदनशील `BIND_ACCESSIBILITY_SERVICE` permission का अनुरोध करता है, आमतौर पर इस अनुरोध को fake Google/Chrome/PDF-viewer dialog के पीछे छिपाकर।
2. एक बार उपयोगकर्ता सेवा सक्षम कर देता है, malware प्रोग्रामेटिक रूप से उन taps का अनुकरण करता है जो अतिरिक्त dangerous permissions (`READ_SMS`, `SYSTEM_ALERT_WINDOW`, `REQUEST_INSTALL_PACKAGES`, …) देने के लिए आवश्यक होते हैं।
3. एक **WebView** inflate की जाती है और window manager में **`TYPE_ACCESSIBILITY_OVERLAY`** window type का उपयोग करके जोड़ी जाती है। Overlay को पूरी तरह opaque या semi-transparent रूप में render किया जा सकता है और इसे *“through”* के रूप में flag किया जा सकता है ताकि original touches अभी भी background activity को भेजे जाएँ (इस प्रकार transaction वास्तव में होता है जबकि पीड़ित केवल phishing फ़ॉर्म देखता है)।
```java
WebView phishingView = new WebView(getApplicationContext());
phishingView.getSettings().setJavaScriptEnabled(true);
phishingView.loadUrl("file:///android_asset/bank_login.html");

WindowManager wm = (WindowManager) getSystemService(WINDOW_SERVICE);
WindowManager.LayoutParams lp = new WindowManager.LayoutParams(
WindowManager.LayoutParams.MATCH_PARENT,
WindowManager.LayoutParams.MATCH_PARENT,
WindowManager.LayoutParams.TYPE_ACCESSIBILITY_OVERLAY,  // <-- bypasses SYSTEM_ALERT_WINDOW prompt
WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE |
WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL,        // «through» flag → forward touches
PixelFormat.TRANSLUCENT);
wm.addView(phishingView, lp);
```
### बैंकिंग Trojans द्वारा प्रयुक्त सामान्य कार्यप्रवाह
* इंस्टॉल किए गए पैकेजों से (`QUERY_ALL_PACKAGES`) यह पता लगाएँ कि कौन सा banking / wallet ऐप वर्तमान में खुला है।
* C2 से एक **HTML/JS overlay template** डाउनलोड करें जो उस विशिष्ट एप्लिकेशन की बिल्कुल नकल करता है (लोगो, रंग, i18n स्ट्रिंग्स…)।
* ओवरले दिखाएँ और credentials/PIN/pattern एकत्र करें।
* **Accessibility API** (`performGlobalAction`, `GestureDescription`) का उपयोग करके बैकग्राउंड में ट्रांसफर स्वचालित करें।

### पहचान और निवारण
* `adb shell pm list packages -3 -e BIND_ACCESSIBILITY_SERVICE` के साथ इंस्टॉल किए गए ऐप्स की सूची का ऑडिट करें।
* एप्लिकेशन की तरफ़ से (bank / wallet):
- संवेदनशील व्यूज़ पर non-Play-Store सेवाओं को ब्लॉक करने के लिए **`android:accessibilityDataSensitive="accessibilityDataPrivateYes"`** (Android 14+) सक्षम करें।
- इसे `setFilterTouchesWhenObscured(true)` और `FLAG_SECURE` के साथ मिलाएँ।

पूर्ण रिमोट डिवाइस कंट्रोल के लिए Accessibility Services का उपयोग करने पर अतिरिक्त विवरणों के लिए (उदा. PlayPraetor, SpyNote, आदि) देखें:


{{#ref}}
accessibility-services-abuse.md
{{#endref}}

## संदर्भ
* [Android Developers – Tapjacking risk & mitigations (updated 2024)](https://developer.android.com/privacy-and-security/risks/tapjacking)
* [Zimperium – HOOK v3 overlay expansion (Aug 2025)](https://thehackernews.com/2025/08/hook-android-trojan-adds-ransomware.html)

{{#include ../../banners/hacktricks-training.md}}
