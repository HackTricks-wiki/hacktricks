# Frida Handleiding

{{#include ../../../banners/hacktricks-training.md}}


## Installasie

Installeer **frida tools**:
```bash
pip install frida-tools
pip install frida
```
**Download and install** op die android-toestel die **frida server** ([Download the latest release](https://github.com/frida/frida/releases)).\
One-liner om adb in root-modus te herbegin, daarmee te koppel, frida-server op te laai, uitvoerregte te gee en dit in die agtergrond te laat loop:
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**Kontroleer** of dit **werk**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## frida-ui (blaaier-gebaseerde Frida controller)

**frida-ui** verskaf 'n web UI op `http://127.0.0.1:8000` om devices/apps te lys en targets te attach of te spawn met scripts (geen CLI nodig nie).

- Installeer (pin `frida` to the device server version):
```bash
uv tool install frida-ui --with frida==16.7.19
# pipx install frida-ui
# pip install frida-ui
```
- Voer uit:
```bash
frida-ui
frida-ui --host 127.0.0.1 --port 8000 --reload
```
- Kenmerke: ontdek USB-/lokale toestelle, voeg afgeleë bedieners by (`192.168.1.x:27042`), en ondersteun **Attach**, **Spawn**, en **Spawn & Run** (to hook before early `onCreate()` logic).
- Skriptering: redigeerder, sleep-en-plaas `.js`, importeer CodeShare, aflaai skripte en sessielogs.
- Afgeleë bedieners: `./frida-server -l 0.0.0.0:27042 -D` maak dit op die netwerk beskikbaar sodat frida-ui kan koppel sonder ADB.

## Frida server vs. Gadget (root vs. no-root)

Two common ways to instrument Android apps with Frida:

- Frida server (rooted devices): Stoot en voer 'n native daemon uit wat jou toelaat om aan enige proses te koppel.
- Frida Gadget (no root): Bundel Frida as 'n gedeelde biblioteek binne die APK en laai dit outomaties in die teikenproses.

Frida server (rooted)
```bash
# Download the matching frida-server binary for your device's arch
# https://github.com/frida/frida/releases
adb root
adb push frida-server-<ver>-android-<arch> /data/local/tmp/frida-server
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &    # run at boot via init/magisk if desired

# From host, list processes and attach
frida-ps -Uai
frida -U -n com.example.app
```
Frida Gadget (no-root)

1) Pak die APK uit, voeg die gadget .so en config by:
- Plaas libfrida-gadget.so in `lib/<abi>/` (bv., lib/arm64-v8a/)
- Skep assets/frida-gadget.config met jou script loading settings

Voorbeeld frida-gadget.config
```json
{
"interaction": { "type": "script", "path": "/sdcard/ssl-bypass.js" },
"runtime": { "logFile": "/sdcard/frida-gadget.log" }
}
```
2) Verwys/laai die gadget sodat dit vroeg geïinitialiseer word:
- Maklikste: Voeg 'n klein Java-stub by System.loadLibrary("frida-gadget") in Application.onCreate(), of gebruik die reeds-bestaande native lib loading.

3) Herpak en teken die APK, en installeer dit:
```bash
apktool d app.apk -o app_m
# ... add gadget .so and config ...
apktool b app_m -o app_gadget.apk
uber-apk-signer -a app_gadget.apk -o out_signed
adb install -r out_signed/app_gadget-aligned-debugSigned.apk
```
4) Koppel vanaf host na die gadget process:
```bash
frida-ps -Uai
frida -U -n com.example.app
```
Aantekeninge
- Gadget word deur sommige beskermings opgespoor; hou name/paaie subtiel en laai laat/voorwaardelik indien nodig.
- By geharde apps, gee voorkeur aan gerootde toetsing met server + late attach, of kombineer dit met Magisk/Zygisk verberging.

## JDWP-based Frida injection without root/repackaging (frida-jdwp-loader)

As die APK debuggable is (android:debuggable="true"), kan jy oor JDWP koppel en 'n native library by 'n Java breakpoint inject. Geen root en geen APK-herpakking benodig nie.

- Repo: https://github.com/frankheat/frida-jdwp-loader
- Vereistes: ADB, Python 3, USB/Wireless debugging. App moet debuggable wees (emulator met `ro.debuggable=1`, gerootte toestel met `resetprop`, of herbou die manifest).

Vinnige begin:
```bash
git clone https://github.com/frankheat/frida-jdwp-loader.git
cd frida-jdwp-loader
# Inject frida-gadget.so into a debuggable target
python frida-jdwp-loader.py frida -n com.example.myapplication
# Keep the breakpoint thread suspended for early hooks
python frida-jdwp-loader.py frida -n com.example.myapplication -s
# Networkless: run a local agent script via Gadget "script" mode
python frida-jdwp-loader.py frida -n com.example.myapplication -i script -l script.js
```
Aantekeninge
- Modusse: spawn (break at Application.onCreate) or attach (break at Activity.onStart). Use `-b` to set a specific Java method, `-g` to select Gadget version/path, `-p` to choose JDWP port.
- Luister-modus: forward Gadget (standaard 127.0.0.1:27042) indien nodig: `adb forward tcp:27042 tcp:27042`; then `frida-ps -H 127.0.0.1:27042`.
- Dit maak gebruik van JDWP-debugging. Risiko: versending van debuggable builds of blootstelling van JDWP.

## Self-contained agent + Gadget inbedding (Frida 17+; geautomatiseer met Objection)

Frida 17 het die ingeboude Java/ObjC bridges van GumJS verwyder. If your agent hooks Java, you must include the Java bridge inside your bundle.

1) Skep 'n Frida agent (TypeScript) en sluit die Java bridge in
```bash
# Scaffolding
frida-create -t agent -o mod
cd mod && npm install
# Install the Java bridge for Frida 17+
npm install frida-java-bridge
# Dev loop (optional live-reload via REPL)
npm run watch
```
Minimaal Java hook (dwing dobbelrolle na 1):
```ts
import Java from "frida-java-bridge";

Java.perform(function () {
var dicer = Java.use("org.secuso.privacyfriendlydicer.dicer.Dicer");
dicer.rollDice.implementation = function (numDice: number, numFaces: number) {
return Array(numDice).fill(1);
};
});
```
Bou 'n enkele bundel vir inbedding:
```bash
npm run build    # produces _agent.js via frida-compile
```
Vinnige USB-toets (opsioneel):
```bash
frida -U -f org.secuso.privacyfriendlydicer -l _agent.js
```
2) Konfigureer Gadget om jou script auto-load
Objection’s patcher verwag 'n Gadget config; wanneer jy script mode gebruik, spesifiseer die on-disk path binne die APK lib dir:
```json
{
"interaction": {
"type": "script",
"path": "libfrida-gadget.script.so"
}
}
```
3) Outomatiseer APK patching met Objection
```bash
# Embed Gadget, config, and your compiled agent into the APK; rebuild and sign
objection patchapk -s org.secuso.privacyfriendlydicer.apk \
-c gadget-config.json \
-l mod/_agent.js \
--use-aapt2
```
Wat patchapk doen (op 'n hoë vlak):
- Detecteer die toestel se ABI (bv. arm64-v8a) en haal die ooreenstemmende Gadget af
- Voeg opsioneel android.permission.INTERNET by wanneer nodig
- Spuit 'n statiese klas-initialiseerder in die launch activity wat System.loadLibrary("frida-gadget") aanroep
- Plaas die volgende onder `lib/<abi>/`:
- libfrida-gadget.so
- libfrida-gadget.config.so (geserialiseerde konfigurasie)
- libfrida-gadget.script.so (jou _agent.js)

Example injected smali (static initializer):
```smali
.method static constructor <clinit>()V
.locals 1
const-string v0, "frida-gadget"
invoke-static {v0}, Ljava/lang/System;->loadLibrary(Ljava/lang/String;)V
return-void
.end method
```
4) Verifieer die repack
```bash
apktool d org.secuso.privacyfriendlydicer.apk
apktool d org.secuso.privacyfriendlydicer.objection.apk
# Inspect differences
diff -r org.secuso.privacyfriendlydicer org.secuso.privacyfriendlydicer.objection
```
Verwagte veranderinge:
- AndroidManifest.xml kan `<uses-permission android:name="android.permission.INTERNET"/>` insluit
- Nuwe native libs onder `lib/<abi>/` soos hierbo
- Launchable activity smali bevat 'n statiese `<clinit>` wat System.loadLibrary("frida-gadget") aanroep

5) Split APKs
- Patch die base APK (die een wat die MAIN/LAUNCHER activity verklaar)
- Re-sign oorblywende splits met dieselfde sleutel:
```bash
objection signapk split1.apk split2.apk ...
```
- Installeer splits saam:
```bash
adb install-multiple split1.apk split2.apk ...
```
- Vir verspreiding, kan jy splits saamvoeg in 'n enkele APK met APKEditor, en dan align/sign

## Verwyder FLAG_SECURE tydens dinamiese analise

Apps wat `getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE)` aanroep voorkom skermkiekies, afstandsvertonings en selfs Android se recent-task snapshots. Toe Freedom Chat hierdie vlag afdwing, was die enigste manier om die leaks te dokumenteer om die venster tydens runtime te knoei. 'n Betroubare patroon is:

- Hook elke `Window` overload wat die vlag weer kan toepas (`setFlags`, `addFlags`, `setAttributes`) en maskeer bit `0x00002000` (`WindowManager.LayoutParams.FLAG_SECURE`).
- Nadat elke activity hervat word, skeduleer 'n UI-thread oproep na `clearFlags(FLAG_SECURE)` sodat Dialogs/Fragments wat later geskep word die ontgrendelde toestand erf.
- Apps gebou met React Native / Flutter skep dikwels geneste vensters; hook `android.app.Dialog`/`android.view.View` helpers of deurloop `getWindow().peekDecorView()` as jy nog swart rame sien.

<details>
<summary>Frida hook wat Window.FLAG_SECURE skoonmaak</summary>
```javascript
Java.perform(function () {
var LayoutParams = Java.use("android.view.WindowManager$LayoutParams");
var FLAG_SECURE = LayoutParams.FLAG_SECURE.value;
var Window = Java.use("android.view.Window");
var Activity = Java.use("android.app.Activity");

function strip(value) {
var masked = value & (~FLAG_SECURE);
if (masked !== value) {
console.log("[-] Stripped FLAG_SECURE from 0x" + value.toString(16));
}
return masked;
}

Window.setFlags.overload('int', 'int').implementation = function (flags, mask) {
return this.setFlags.call(this, strip(flags), strip(mask));
};

Window.addFlags.implementation = function (flags) {
return this.addFlags.call(this, strip(flags));
};

Window.setAttributes.implementation = function (attrs) {
attrs.flags.value = strip(attrs.flags.value);
return this.setAttributes.call(this, attrs);
};

Activity.onResume.implementation = function () {
this.onResume();
var self = this;
Java.scheduleOnMainThread(function () {
try {
self.getWindow().clearFlags(FLAG_SECURE);
console.log("[+] Cleared FLAG_SECURE on " + self.getClass().getName());
} catch (err) {
console.log("[!] clearFlags failed: " + err);
}
});
};
});
```
</details>

Voer die script uit met `frida -U -f <package> -l disable-flag-secure.js --no-pause`, interaksie met die UI, en skermkiekies/opnames sal weer werk. Omdat alles op die UI-thread gebeur is daar geen flikkering nie, en jy kan steeds die hook met HTTP Toolkit/Burp kombineer om die verkeer vas te vang wat die `/channel` PIN leak onthul het.

## Dynamiese DEX dumping / unpacking met clsdumper (Frida)

`clsdumper` is 'n Frida-gebaseerde dinamiese **DEX/class dumper** wat geharde apps oorleef deur 'n anti-Frida pre-stage te kombineer met native en Java discovery strategies (werk selfs as `Java.perform()` sterf). Vereistes: Python 3.10+, 'n rooted device met `frida-server` wat loop, USB of `--host` TCP-verbinding.

**Installeer & vinnige gebruik**
```bash
pip install clsdumper
# Attach to a running app
clsdumper com.example.app
# Spawn first (hooks before early loaders)
clsdumper com.example.app --spawn
# Select strategies
clsdumper com.example.app --strategies fart_dump,oat_extract
```
**CLI-opsies (mees nuttig)**
- `target`: pakketnaam of PID.
- `--spawn`: spawn in plaas van attach.
- `--host <ip>`: verbind na remote frida-server.
- `--strategies <comma>`: beperk/kies extractors; standaard is almal behalwe `mmap_hook` (prestasie-intensief).
- `--no-scan` / `--deep-scan`: skakel diep geheue-skandering af of maak dit stadiger (voeg CDEX-skandering by).
- `--extract-classes`: nabehandel dumps na `.smali` via androguard.
- `--no-anti-frida`: sla die pre-hook bypass-fase oor.
- `--list` / `--list-apps`: lys lopende prosesse of geïnstalleerde pakkette.

**Anti-instrumentasie-omseiling (fase 0)**
- Haak `sigaction`/`signal` om die registrasie van crash-/anti-debug-hanteerders te blokkeer.
- Bedien 'n gefiltreerde `/proc/self/maps` via `memfd_create` om Frida-gebiede te verberg.
- Monitor `pthread_create` om watchdog-drade wat Frida jaag, te vang/neutraliseer.

**DEX-ontdekking (fase 1–2)** — meerdere komplementêre strategieë met per-treffer metadata + deduplisering (agent-side djb2, host-side SHA-256):
- Native (geen Java-brug benodig nie): `art_walk` (walk ART Runtime→ClassLinker→DexFile), `open_common_hook` (hook `DexFile::OpenCommon`), `memory_scan` (DEX magic in readable maps), `oat_extract` (parse mapped .vdex/.oat), `fart_dump` (hook `DefineClass` + walk `class_table_`), `dexfile_constructor` (hook `OatDexFile` constructors), `mmap_hook` (watch `mmap/mmap64`, off by default for perf).
- Java (wanneer beskikbaar): `cookie` (read `mCookie` from ClassLoaders), `classloader_hook` (monitor `loadClass`, `DexClassLoader`, `InMemoryDexClassLoader`).

**Uitsetindeling**
```
dump_<target>/
dex/classes_001.dex ...
classes/                 # only when --extract-classes
metadata.json            # strategy per hit + hashes
```
Wenk: beskermde apps laai dikwels kode vanaf verskeie bronne (in-memory payload, vdex/oat, custom loaders). Om met die standaard multi-strategy set plus `--spawn` te werk maksimeer dekking; skakel `--deep-scan` slegs aan wanneer nodig om prestasieverlies te voorkom.

## Handleidings

### [Tutorial 1](frida-tutorial-1.md)

**Vanaf**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**Bronkode**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**Volg die [link to read it](frida-tutorial-1.md).**

### [Tutorial 2](frida-tutorial-2.md)

**Vanaf**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Dele 2, 3 & 4)\
**APKs en Bronkode**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**Volg die [link to read it.](frida-tutorial-2.md)**

### [Tutorial 3](owaspuncrackable-1.md)

**Vanaf**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk)

**Volg die [link to read it](owaspuncrackable-1.md).**

**Jy kan meer Awesome Frida-skripte hier vind:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Vinnige Voorbeelde

### Frida vanaf die opdragreël aanroep
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Basiese Python-skrip
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking functions sonder parameters

Hook die function `a()` van die class `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
rootcheck1.a.overload().implementation = function () {
return false;
};
});
```
Hook java `exit()`
```javascript
var sysexit = Java.use("java.lang.System")
sysexit.exit.overload("int").implementation = function (var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)")
}
```
Hook MainActivity `.onStart()` & `.onCreate()`
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity")
mainactivity.onStart.overload().implementation = function () {
send("MainActivity.onStart() HIT!!!")
var ret = this.onStart.overload().call(this)
}
mainactivity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("MainActivity.onCreate() HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
Hook android `.onCreate()`
```javascript
var activity = Java.use("android.app.Activity")
activity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("Activity HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
### Hooking funksies met parameters en die waarde terugkry

Hooking van 'n decryption function. Print die input, call die original function om die input te decrypt en uiteindelik print die plain data:

<details>
<summary>Hooking 'n decryption function (Java) — print inputs/outputs</summary>
```javascript
function getString(data) {
var ret = ""
for (var i = 0; i < data.length; i++) {
ret += data[i].toString()
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a")
aes_decrypt.a.overload("[B", "[B").implementation = function (var_0, var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding")
send("Key       : " + getString(var_0))
send("Encrypted : " + getString(var_1))
var ret = this.a.overload("[B", "[B").call(this, var_0, var_1)
send("Decrypted : " + ret)

var flag = ""
for (var i = 0; i < ret.length; i++) {
flag += String.fromCharCode(ret[i])
}
send("Decrypted flag: " + flag)
return ret //[B
}
```
</details>

### Hooking van funksies en dit met ons insette aanroep

Hook 'n funksie wat 'n string ontvang en roep dit aan met 'n ander string (van [here](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String") // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function (x) {
//hooking the new function
var my_string = string_class.$new("My TeSt String#####") //creating a new String by using `new` operator
console.log("Original arg: " + x)
var ret = this.fun(my_string) // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: " + ret)
return ret
}
```
### Kry 'n reeds geskepte object van 'n class

As jy 'n attribuut van 'n reeds geskepte object wil onttrek, kan jy dit gebruik.

In hierdie voorbeeld sien jy hoe om die object van die class my_activity te kry en hoe om die funksie .secret() aan te roep wat 'n private attribuut van die object sal print:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
//This function will be called for every instance found by frida
console.log("Found instance: " + instance)
console.log("Result of secret func: " + instance.secret())
},
onComplete: function () {},
})
```
## Ander Frida-tutorials

- [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
- [Part 1 of Advanced Frida Usage blog series: IOS Encryption Libraries](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)


## Verwysings

- [Build a Repeatable Android Bug Bounty Lab: Emulator vs Magisk, Burp, Frida, and Medusa](https://www.yeswehack.com/learn-bug-bounty/android-lab-mobile-hacking-tools)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Frida releases (server binaries)](https://github.com/frida/frida/releases)
- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)
- [frida-jdwp-loader](https://github.com/frankheat/frida-jdwp-loader)
- [Library injection for debuggable Android apps (blog)](https://koz.io/library-injection-for-debuggable-android-apps/)
- [jdwp-lib-injector (original idea/tool)](https://github.com/ikoz/jdwp-lib-injector)
- [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier)
- ["Super secure" MAGA-themed messaging app leaks everyone’s phone number](https://ericdaigle.ca/posts/super-secure-maga-messaging-app-leaks-everyones-phone-number/)
- [Android Frida Hooking: Disabling FLAG_SECURE](https://www.securify.nl/en/blog/android-frida-hooking-disabling-flagsecure/)
- [frida-ui](https://github.com/adityatelange/frida-ui)
- [clsdumper — Android Dynamic Class Dumper](https://github.com/TheQmaks/clsdumper)

{{#include ../../../banners/hacktricks-training.md}}
