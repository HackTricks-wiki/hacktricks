# Frida-Anleitung

{{#include ../../../banners/hacktricks-training.md}}


## Installation

Installiere **frida tools**:
```bash
pip install frida-tools
pip install frida
```
**Herunterladen und installieren** auf dem Android-Gerät den **frida server** ([Download the latest release](https://github.com/frida/frida/releases)).\
Einzeiler, um adb im root-Modus neu zu starten, damit zu verbinden, frida-server hochzuladen, Ausführungsrechte zu vergeben und ihn im Hintergrund auszuführen:
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**Prüfe** ob es **funktioniert**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Frida server vs. Gadget (root vs. no-root)

Zwei gängige Wege, Android-Apps mit Frida zu instrumentieren:

- Frida server (rooted devices): Push und starte einen nativen Daemon, der es dir ermöglicht, dich an jeden Prozess anzuhängen.
- Frida Gadget (no root): Binde Frida als shared library in die APK ein und lade sie automatisch im Zielprozess.

Frida server (rooted)
```bash
# Download the matching frida-server binary for your device's arch
# https://github.com/frida/frida/releases
adb root
adb push frida-server-<ver>-android-<arch> /data/local/tmp/frida-server
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &    # run at boot via init/magisk if desired

# From host, list processes and attach
frida-ps -Uai
frida -U -n com.example.app
```
Frida Gadget (no-root)

1) Entpacke die APK, füge die gadget .so und die config hinzu:
- Platziere libfrida-gadget.so in `lib/<abi>/` (z. B. lib/arm64-v8a/)
- Erstelle assets/frida-gadget.config mit Einstellungen zum Laden deiner Skripte

Beispiel frida-gadget.config
```json
{
"interaction": { "type": "script", "path": "/sdcard/ssl-bypass.js" },
"runtime": { "logFile": "/sdcard/frida-gadget.log" }
}
```
2) Referenziere/lade das Gadget, damit es frühzeitig initialisiert wird:

- Am einfachsten: Füge einen kleinen Java-Stub mit System.loadLibrary("frida-gadget") in Application.onCreate() hinzu, oder verwende bereits vorhandenes natives Laden von Bibliotheken.

3) APK neu packen und signieren, dann installieren:
```bash
apktool d app.apk -o app_m
# ... add gadget .so and config ...
apktool b app_m -o app_gadget.apk
uber-apk-signer -a app_gadget.apk -o out_signed
adb install -r out_signed/app_gadget-aligned-debugSigned.apk
```
4) Vom Host an den Gadget-Prozess anhängen:
```bash
frida-ps -Uai
frida -U -n com.example.app
```
Hinweise
- Gadget wird von einigen Schutzmechanismen erkannt; halte Namen/Pfade unauffällig und lade es spät/bedingt, falls nötig.
- Bei gehärteten Apps bevorzuge Tests auf gerooteten Geräten mit server + late attach, oder kombiniere dies mit Magisk/Zygisk hiding.

## Eigenständiger agent + Gadget-Einbettung (Frida 17+; automatisiert mit Objection)

Frida 17 entfernte die eingebauten Java/ObjC bridges aus GumJS. Wenn dein agent Java hookt, musst du die Java bridge in dein bundle aufnehmen.

1) Erstelle einen Frida agent (TypeScript) und füge die Java bridge hinzu
```bash
# Scaffolding
frida-create -t agent -o mod
cd mod && npm install
# Install the Java bridge for Frida 17+
npm install frida-java-bridge
# Dev loop (optional live-reload via REPL)
npm run watch
```
Minimaler Java hook (erzwingt, dass Würfelwürfe 1 sind):
```ts
import Java from "frida-java-bridge";

Java.perform(function () {
var dicer = Java.use("org.secuso.privacyfriendlydicer.dicer.Dicer");
dicer.rollDice.implementation = function (numDice: number, numFaces: number) {
return Array(numDice).fill(1);
};
});
```
Erstelle ein einzelnes Bundle zum Einbetten:
```bash
npm run build    # produces _agent.js via frida-compile
```
Schneller USB-Test (optional):
```bash
frida -U -f org.secuso.privacyfriendlydicer -l _agent.js
```
2) Konfiguriere Gadget so, dass es dein script automatisch lädt
Objection’s patcher erwartet eine Gadget config; wenn du script mode verwendest, gib den on-disk-Pfad innerhalb des APK lib dir an:
```json
{
"interaction": {
"type": "script",
"path": "libfrida-gadget.script.so"
}
}
```
3) APK-Patching mit Objection automatisieren
```bash
# Embed Gadget, config, and your compiled agent into the APK; rebuild and sign
objection patchapk -s org.secuso.privacyfriendlydicer.apk \
-c gadget-config.json \
-l mod/_agent.js \
--use-aapt2
```
Was patchapk macht (auf hoher Ebene):
- Ermittelt die Geräte-ABI (z. B. arm64-v8a) und lädt das passende Gadget
- Fügt optional android.permission.INTERNET hinzu, wenn erforderlich
- Injiziert einen statischen Klasseninitialisierer, der System.loadLibrary("frida-gadget") in die Launch-Activity aufruft
- Platziert die folgenden Dateien unter `lib/<abi>/`:
- libfrida-gadget.so
- libfrida-gadget.config.so (serialized config)
- libfrida-gadget.script.so (your _agent.js)

Beispiel injizierter smali (statischer Initialisierer):
```smali
.method static constructor <clinit>()V
.locals 1
const-string v0, "frida-gadget"
invoke-static {v0}, Ljava/lang/System;->loadLibrary(Ljava/lang/String;)V
return-void
.end method
```
4) Überprüfe das repack
```bash
apktool d org.secuso.privacyfriendlydicer.apk
apktool d org.secuso.privacyfriendlydicer.objection.apk
# Inspect differences
diff -r org.secuso.privacyfriendlydicer org.secuso.privacyfriendlydicer.objection
```
Erwartete Änderungen:
- AndroidManifest.xml kann `<uses-permission android:name="android.permission.INTERNET"/>` enthalten
- Neue native libs unter lib/<abi>/ wie oben
- Die smali der startbaren Activity enthält ein statisches `<clinit>`, das System.loadLibrary("frida-gadget") aufruft

5) Split APKs
- Patch das base APK (das die MAIN/LAUNCHER activity deklariert)
- Re-sign die verbleibenden splits mit demselben Key:
```bash
objection signapk split1.apk split2.apk ...
```
- Installiere Splits zusammen:
```bash
adb install-multiple split1.apk split2.apk ...
```
- Zur Verteilung können Sie Splits mit APKEditor in eine einzelne APK zusammenführen und dann align/sign

Defensive Hinweise (worauf beim hardening zu achten ist)
- Implementieren Sie signature/repackage-Prüfungen und runtime integrity/attestation
- Erkennen Sie unerwartetes System.loadLibrary("frida-gadget") oder verdächtige native libs beim Start
- Vermeiden Sie die Deklaration ungenutzter INTERNET permission; reduzieren Sie die gadget detection surface

## Tutorials

### [Tutorial 1](frida-tutorial-1.md)

**From**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**Source Code**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**Folgen Sie dem [Link, um es zu lesen](frida-tutorial-1.md).**

### [Tutorial 2](frida-tutorial-2.md)

**From**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Parts 2, 3 & 4)\
**APKs and Source code**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**Folgen Sie dem[ Link, um es zu lesen.](frida-tutorial-2.md)**

### [Tutorial 3](owaspuncrackable-1.md)

**From**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk)

**Folgen Sie dem [Link, um es zu lesen](owaspuncrackable-1.md).**

**Weitere großartige Frida-Skripte finden Sie hier:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Quick Examples

### Calling Frida from command line
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Grundlegendes Python-Skript
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking von Funktionen ohne Parameter

Hook die Funktion `a()` der Klasse `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
Hook java `exit()`
```javascript
var sysexit = Java.use("java.lang.System")
sysexit.exit.overload("int").implementation = function (var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)")
}
```
Hook MainActivity `.onStart()` & `.onCreate()`
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity")
mainactivity.onStart.overload().implementation = function () {
send("MainActivity.onStart() HIT!!!")
var ret = this.onStart.overload().call(this)
}
mainactivity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("MainActivity.onCreate() HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
Hook android `.onCreate()`
```javascript
var activity = Java.use("android.app.Activity")
activity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("Activity HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
### Hooking von Funktionen mit Parametern und Abrufen des Werts

Hooking einer decryption-Funktion. Gib den Input aus, rufe die originale Funktion auf, decrypt den Input und gib schließlich die Klartextdaten aus:
```javascript
function getString(data) {
var ret = ""
for (var i = 0; i < data.length; i++) {
ret += data[i].toString()
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a")
aes_decrypt.a.overload("[B", "[B").implementation = function (var_0, var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding")
send("Key       : " + getString(var_0))
send("Encrypted : " + getString(var_1))
var ret = this.a.overload("[B", "[B").call(this, var_0, var_1)
send("Decrypted : " + ret)

var flag = ""
for (var i = 0; i < ret.length; i++) {
flag += String.fromCharCode(ret[i])
}
send("Decrypted flag: " + flag)
return ret //[B
}
```
### Hooking functions und sie mit unserem input aufrufen

Hook a function, die einen string entgegennimmt, und rufe sie mit einem anderen string auf (aus [here](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String") // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function (x) {
//hooking the new function
var my_string = string_class.$new("My TeSt String#####") //creating a new String by using `new` operator
console.log("Original arg: " + x)
var ret = this.fun(my_string) // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: " + ret)
return ret
}
```
### Zugriff auf ein bereits erstelltes Objekt einer Klasse

Wenn du ein Attribut eines erstellten Objekts auslesen willst, kannst du Folgendes verwenden.

In diesem Beispiel siehst du, wie man das Objekt der Klasse my_activity erhält und die Funktion .secret() aufruft, die ein privates Attribut des Objekts ausgibt:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
//This function will be called for every instance found by frida
console.log("Found instance: " + instance)
console.log("Result of secret func: " + instance.secret())
},
onComplete: function () {},
})
```
## Weitere Frida-Tutorials

- [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
- [Part 1 of Advanced Frida Usage blog series: IOS Encryption Libraries](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)


## Referenzen

- [Build a Repeatable Android Bug Bounty Lab: Emulator vs Magisk, Burp, Frida, and Medusa](https://www.yeswehack.com/learn-bug-bounty/android-lab-mobile-hacking-tools)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Frida releases (server binaries)](https://github.com/frida/frida/releases)
- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)

{{#include ../../../banners/hacktricks-training.md}}
