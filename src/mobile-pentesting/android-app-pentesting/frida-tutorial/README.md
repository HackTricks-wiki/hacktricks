# Frida Handleiding

{{#include ../../../banners/hacktricks-training.md}}


## Installasie

Installeer **frida tools**:
```bash
pip install frida-tools
pip install frida
```
**Laai af en installeer** op die android die **frida server** ([Download the latest release](https://github.com/frida/frida/releases)).\
Eenreël-opdrag om adb te herbegin in root-modus, daaraan te koppel, frida-server op te laai, uitvoerpermissies te gee en dit in die agtergrond te laat loop:
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**Kontroleer** of dit **werk**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Frida server vs. Gadget (root vs. no-root)

Twee algemene maniere om Android-apps met Frida te instrumenteer:

- Frida server (rooted devices): Duw en voer 'n inheemse daemon uit wat jou toelaat om by enige proses aan te koppel.
- Frida Gadget (no root): Verpak Frida as 'n gedeelde biblioteek binne die APK en laai dit outomaties in die teikenproses.

Frida server (rooted)
```bash
# Download the matching frida-server binary for your device's arch
# https://github.com/frida/frida/releases
adb root
adb push frida-server-<ver>-android-<arch> /data/local/tmp/frida-server
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &    # run at boot via init/magisk if desired

# From host, list processes and attach
frida-ps -Uai
frida -U -n com.example.app
```
Frida Gadget (no-root)

1) Pak die APK uit, voeg die gadget .so en config by:
- Plaas libfrida-gadget.so in `lib/<abi>/` (bv., lib/arm64-v8a/)
- Skep assets/frida-gadget.config met jou instellings vir die laai van scripts

Voorbeeld frida-gadget.config
```json
{
"interaction": { "type": "script", "path": "/sdcard/ssl-bypass.js" },
"runtime": { "logFile": "/sdcard/frida-gadget.log" }
}
```
2) Verwys/laai die gadget sodat dit vroeg geïnitialiseer word:
- Maklikste: Voeg 'n klein Java-stub by wat System.loadLibrary("frida-gadget") in Application.onCreate() aanroep, of gebruik bestaande native lib loading.

3) Repak en teken die APK, dan installeer:
```bash
apktool d app.apk -o app_m
# ... add gadget .so and config ...
apktool b app_m -o app_gadget.apk
uber-apk-signer -a app_gadget.apk -o out_signed
adb install -r out_signed/app_gadget-aligned-debugSigned.apk
```
4) Sluit vanaf host by die gadget process aan:
```bash
frida-ps -Uai
frida -U -n com.example.app
```
Aantekeninge
- Gadget word deur sekere beskermings gedetekteer; hou name/paaie onopvallend en laai dit laat of voorwaardelik indien nodig.
- By geharde apps, verkies rooted testing met server + late attach, of kombineer met Magisk/Zygisk hiding.

## JDWP-based Frida injection without root/repackaging (frida-jdwp-loader)

As die APK debuggable is (android:debuggable="true"), kan jy oor JDWP aanheg en 'n native library by 'n Java breakpoint injekteer. Geen root en geen APK repackaging nie.

- Repo: https://github.com/frankheat/frida-jdwp-loader
- Vereistes: ADB, Python 3, USB/Wireless debugging. Die app moet debuggable wees (emulator met `ro.debuggable=1`, rooted device met `resetprop`, of herbou die manifest).

Vinnige begin
```bash
git clone https://github.com/frankheat/frida-jdwp-loader.git
cd frida-jdwp-loader
# Inject frida-gadget.so into a debuggable target
python frida-jdwp-loader.py frida -n com.example.myapplication
# Keep the breakpoint thread suspended for early hooks
python frida-jdwp-loader.py frida -n com.example.myapplication -s
# Networkless: run a local agent script via Gadget "script" mode
python frida-jdwp-loader.py frida -n com.example.myapplication -i script -l script.js
```
Aantekeninge
- Modusse: spawn (break at Application.onCreate) of attach (break at Activity.onStart). Gebruik `-b` om 'n spesifieke Java-metode te stel, `-g` om Gadget-weergawe/-pad te kies, `-p` om die JDWP-poort te kies.
- Luister-modus: stuur Gadget vooruit (standaard 127.0.0.1:27042) indien nodig: `adb forward tcp:27042 tcp:27042`; dan `frida-ps -H 127.0.0.1:27042`.
- Dit maak gebruik van JDWP-debugging. Die risiko is om debuggable builds uit te lewer of JDWP bloot te stel.

## Self-contained agent + Gadget embedding (Frida 17+; automated with Objection)

Frida 17 het die ingeboude Java/ObjC bridges uit GumJS verwyder. As jou agent Java hook, moet jy die Java bridge binne jou bundle insluit.

1) Create a Frida agent (TypeScript) and include the Java bridge
```bash
# Scaffolding
frida-create -t agent -o mod
cd mod && npm install
# Install the Java bridge for Frida 17+
npm install frida-java-bridge
# Dev loop (optional live-reload via REPL)
npm run watch
```
Minimale Java hook (dwing dobbelrolle na 1):
```ts
import Java from "frida-java-bridge";

Java.perform(function () {
var dicer = Java.use("org.secuso.privacyfriendlydicer.dicer.Dicer");
dicer.rollDice.implementation = function (numDice: number, numFaces: number) {
return Array(numDice).fill(1);
};
});
```
Bou 'n enkele bundel vir inbedding:
```bash
npm run build    # produces _agent.js via frida-compile
```
Vinnige USB-toets (opsioneel):
```bash
frida -U -f org.secuso.privacyfriendlydicer -l _agent.js
```
2) Stel Gadget in om jou script outomaties te laai
Objection’s patcher verwag 'n Gadget config; wanneer jy script mode gebruik, spesifiseer die on-disk path binne die APK lib dir:
```json
{
"interaction": {
"type": "script",
"path": "libfrida-gadget.script.so"
}
}
```
3) Outomatiseer APK patching met Objection
```bash
# Embed Gadget, config, and your compiled agent into the APK; rebuild and sign
objection patchapk -s org.secuso.privacyfriendlydicer.apk \
-c gadget-config.json \
-l mod/_agent.js \
--use-aapt2
```
Wat patchapk doen (hoogvlak):
- Detecteer device ABI (bv., arm64-v8a) en haal die ooreenstemmende Gadget af
- Voeg opsioneel android.permission.INTERNET by indien nodig
- Injecteer 'n statiese klas-initialiseerder wat System.loadLibrary("frida-gadget") aanroep in die launch-aktiwiteit
- Plaas die volgende onder `lib/<abi>/`:
- libfrida-gadget.so
- libfrida-gadget.config.so (geserialiseerde config)
- libfrida-gadget.script.so (jou _agent.js)

Example injected smali (statiese initialiseerder):
```smali
.method static constructor <clinit>()V
.locals 1
const-string v0, "frida-gadget"
invoke-static {v0}, Ljava/lang/System;->loadLibrary(Ljava/lang/String;)V
return-void
.end method
```
4) Verifieer die repack
```bash
apktool d org.secuso.privacyfriendlydicer.apk
apktool d org.secuso.privacyfriendlydicer.objection.apk
# Inspect differences
diff -r org.secuso.privacyfriendlydicer org.secuso.privacyfriendlydicer.objection
```
Verwagte veranderinge:
- AndroidManifest.xml mag `<uses-permission android:name="android.permission.INTERNET"/>` insluit
- Nuwe native libs onder `lib/<abi>/` soos hierbo
- Launchable activity smali bevat 'n statiese `<clinit>` wat System.loadLibrary("frida-gadget") aanroep

5) Split APKs
- Patch the base APK (the one that declares MAIN/LAUNCHER activity)
- Re-sign remaining splits with the same key:
```bash
objection signapk split1.apk split2.apk ...
```
- Installeer splits saam:
```bash
adb install-multiple split1.apk split2.apk ...
```
- Vir verspreiding kan jy splits saamvoeg in 'n enkele APK met APKEditor, en dan align/sign

## Handleidings

### [Tutorial 1](frida-tutorial-1.md)

**Van**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**Bronkode**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**Volg die [skakel om dit te lees](frida-tutorial-1.md).**

### [Tutorial 2](frida-tutorial-2.md)

**Van**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Dele 2, 3 & 4)\
**APKs en Bronkode**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**Volg die [skakel om dit te lees.](frida-tutorial-2.md)**

### [Tutorial 3](owaspuncrackable-1.md)

**Van**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk)

**Volg die [skakel om dit te lees](owaspuncrackable-1.md).**

**Jy kan meer Awesome Frida-skripte hier vind:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Vinnige Voorbeelde

### Frida vanaf die opdragreël aanroep
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Basiese Python-skrip
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking functions without parameters

Hook die function `a()` van die klas `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()")
return false;
};
});
```
Hook java `exit()`
```javascript
var sysexit = Java.use("java.lang.System")
sysexit.exit.overload("int").implementation = function (var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)")
}
```
Hook MainActivity `.onStart()` & `.onCreate()`
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity")
mainactivity.onStart.overload().implementation = function () {
send("MainActivity.onStart() HIT!!!")
var ret = this.onStart.overload().call(this)
}
mainactivity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("MainActivity.onCreate() HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
Hook android `.onCreate()`
```javascript
var activity = Java.use("android.app.Activity")
activity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("Activity HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
### Hooking functions met parameters en die waarde verkry

Hooking a decryption function. Druk die input, roep die original function om die input te decrypt, en druk uiteindelik die plain data:

<details>
<summary>Hooking a decryption function (Java) — print inputs/outputs</summary>
```javascript
function getString(data) {
var ret = ""
for (var i = 0; i < data.length; i++) {
ret += data[i].toString()
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a")
aes_decrypt.a.overload("[B", "[B").implementation = function (var_0, var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding")
send("Key       : " + getString(var_0))
send("Encrypted : " + getString(var_1))
var ret = this.a.overload("[B", "[B").call(this, var_0, var_1)
send("Decrypted : " + ret)

var flag = ""
for (var i = 0; i < ret.length; i++) {
flag += String.fromCharCode(ret[i])
}
send("Decrypted flag: " + flag)
return ret //[B
}
```
</details>

### Hooking functions en hulle met ons inset aanroep

Hook 'n function wat 'n string ontvang en roep dit met 'n ander string aan (van [here](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String") // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function (x) {
//hooking the new function
var my_string = string_class.$new("My TeSt String#####") //creating a new String by using `new` operator
console.log("Original arg: " + x)
var ret = this.fun(my_string) // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: " + ret)
return ret
}
```
### Kry 'n reeds geskepte objek van 'n klas

As jy 'n attribuut van 'n geskepte objek wil uittrek, kan jy dit gebruik.

In hierdie voorbeeld gaan jy sien hoe om die objek van die klas my_activity te kry en hoe om die funksie .secret() aan te roep wat 'n private attribuut van die objek sal afdruk:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
//This function will be called for every instance found by frida
console.log("Found instance: " + instance)
console.log("Result of secret func: " + instance.secret())
},
onComplete: function () {},
})
```
## Ander Frida handleidings

- [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
- [Deel 1 van die Advanced Frida Usage blogreeks: IOS Encryption Libraries](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)


## Verwysings

- [Bou 'n herhaalbare Android Bug Bounty-lab: Emulator vs Magisk, Burp, Frida en Medusa](https://www.yeswehack.com/learn-bug-bounty/android-lab-mobile-hacking-tools)
- [Frida Gadget-dokumentasie](https://frida.re/docs/gadget/)
- [Frida vrystellings (server binaries)](https://github.com/frida/frida/releases)
- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Modding en verspreiding van mobiele apps met Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)
- [frida-jdwp-loader](https://github.com/frankheat/frida-jdwp-loader)
- [Biblioteek-inspuiting vir debuggable Android-apps (blog)](https://koz.io/library-injection-for-debuggable-android-apps/)
- [jdwp-lib-injector (original idea/tool)](https://github.com/ikoz/jdwp-lib-injector)
- [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier)

{{#include ../../../banners/hacktricks-training.md}}
