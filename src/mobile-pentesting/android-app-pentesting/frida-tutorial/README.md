# Frida Οδηγός

{{#include ../../../banners/hacktricks-training.md}}


## Εγκατάσταση

Εγκαταστήστε **frida tools**:
```bash
pip install frida-tools
pip install frida
```
**Κατέβασε και εγκατάστησε** στο Android τον **frida server** ([Download the latest release](https://github.com/frida/frida/releases)).\
Μία one-liner εντολή για να επανεκκινήσεις το adb σε root mode, να συνδεθείς σε αυτό, να ανεβάσεις το frida-server, να δώσεις exec permissions και να το τρέξεις στο background:
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**Ελέγξτε** αν **λειτουργεί**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Frida server vs. Gadget (root vs. no-root)

Δύο κοινές μέθοδοι για την instrumentation εφαρμογών Android με Frida:

- Frida server (rooted devices): Προώθησε και εκτέλεσε έναν native daemon που σου επιτρέπει να επισυνάπτεσαι σε οποιαδήποτε διεργασία.
- Frida Gadget (no root): Συμπεριέλαβε το Frida ως shared library μέσα στο APK και φόρτωσέ το αυτόματα μέσα στη στοχευμένη διεργασία.

Frida server (rooted)
```bash
# Download the matching frida-server binary for your device's arch
# https://github.com/frida/frida/releases
adb root
adb push frida-server-<ver>-android-<arch> /data/local/tmp/frida-server
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &    # run at boot via init/magisk if desired

# From host, list processes and attach
frida-ps -Uai
frida -U -n com.example.app
```
Frida Gadget (no-root)

1) Αποσυμπιέστε το APK, προσθέστε το gadget .so και το config:
- Τοποθετήστε libfrida-gadget.so στο `lib/<abi>/` (π.χ., lib/arm64-v8a/)
- Δημιουργήστε assets/frida-gadget.config με τις ρυθμίσεις φόρτωσης των script σας

Παράδειγμα frida-gadget.config
```json
{
"interaction": { "type": "script", "path": "/sdcard/ssl-bypass.js" },
"runtime": { "logFile": "/sdcard/frida-gadget.log" }
}
```
2) Αναφορά/φόρτωση του gadget ώστε να αρχικοποιηθεί νωρίς:
- Εύκολο: Προσθέστε ένα μικρό Java stub με System.loadLibrary("frida-gadget") στο Application.onCreate(), ή χρησιμοποιήστε την ήδη υπάρχουσα φόρτωση native lib.

3) Επανασυσκευάστε και υπογράψτε το APK, μετά εγκαταστήστε:
```bash
apktool d app.apk -o app_m
# ... add gadget .so and config ...
apktool b app_m -o app_gadget.apk
uber-apk-signer -a app_gadget.apk -o out_signed
adb install -r out_signed/app_gadget-aligned-debugSigned.apk
```
4) Συνδέστε από host στη διαδικασία gadget:
```bash
frida-ps -Uai
frida -U -n com.example.app
```
Notes
- Gadget ανιχνεύεται από κάποιες προστασίες· κρατήστε ονόματα/διαδρομές stealthy και φορτώστε αργά/υπό συνθήκη αν χρειάζεται.
- Σε hardened apps, προτιμήστε rooted testing με server + late attach, ή συνδυάστε με Magisk/Zygisk hiding.

## JDWP-based Frida injection without root/repackaging (frida-jdwp-loader)

If the APK is debuggable (android:debuggable="true"), you can attach over JDWP and inject a native library at a Java breakpoint. Δεν απαιτείται root και ούτε APK repackaging.

- Repo: https://github.com/frankheat/frida-jdwp-loader
- Requirements: ADB, Python 3, USB/Wireless debugging. Η εφαρμογή πρέπει να είναι debuggable (emulator with `ro.debuggable=1`, rooted device with `resetprop`, or rebuild manifest).

Quick start
```bash
git clone https://github.com/frankheat/frida-jdwp-loader.git
cd frida-jdwp-loader
# Inject frida-gadget.so into a debuggable target
python frida-jdwp-loader.py frida -n com.example.myapplication
# Keep the breakpoint thread suspended for early hooks
python frida-jdwp-loader.py frida -n com.example.myapplication -s
# Networkless: run a local agent script via Gadget "script" mode
python frida-jdwp-loader.py frida -n com.example.myapplication -i script -l script.js
```
Notes
- Λειτουργίες: spawn (break at Application.onCreate) or attach (break at Activity.onStart). Χρησιμοποιήστε `-b` για να ορίσετε μία συγκεκριμένη Java μέθοδο, `-g` για να επιλέξετε έκδοση/διαδρομή Gadget, `-p` για να επιλέξετε θύρα JDWP.
- Λειτουργία ακρόασης: προωθήστε το Gadget (προεπιλογή 127.0.0.1:27042) αν χρειάζεται: `adb forward tcp:27042 tcp:27042`; στη συνέχεια `frida-ps -H 127.0.0.1:27042`.
- Αυτό αξιοποιεί το JDWP debugging. Ο κίνδυνος είναι η αποστολή debuggable builds ή η έκθεση του JDWP.

## Self-contained agent + Gadget embedding (Frida 17+; automated with Objection)

Το Frida 17 αφαίρεσε τις built-in Java/ObjC bridges από το GumJS. Αν ο agent σας κάνει hook στην Java, πρέπει να συμπεριλάβετε τη Java bridge μέσα στο bundle σας.

1) Δημιουργήστε έναν Frida agent (TypeScript) και συμπεριλάβετε τη Java bridge
```bash
# Scaffolding
frida-create -t agent -o mod
cd mod && npm install
# Install the Java bridge for Frida 17+
npm install frida-java-bridge
# Dev loop (optional live-reload via REPL)
npm run watch
```
Ελάχιστο Java hook (εξαναγκάζει τις ρίψεις ζαριών στο 1):
```ts
import Java from "frida-java-bridge";

Java.perform(function () {
var dicer = Java.use("org.secuso.privacyfriendlydicer.dicer.Dicer");
dicer.rollDice.implementation = function (numDice: number, numFaces: number) {
return Array(numDice).fill(1);
};
});
```
Δημιουργήστε ένα ενιαίο bundle για embedding:
```bash
npm run build    # produces _agent.js via frida-compile
```
Γρήγορος USB έλεγχος (προαιρετικό):
```bash
frida -U -f org.secuso.privacyfriendlydicer -l _agent.js
```
2) Ρυθμίστε το Gadget ώστε να κάνει auto-load το script σας
Το patcher του Objection αναμένει μια Gadget config; όταν χρησιμοποιείτε script mode, καθορίστε το on-disk path μέσα στο APK lib dir:
```json
{
"interaction": {
"type": "script",
"path": "libfrida-gadget.script.so"
}
}
```
3) Αυτοματοποιήστε το APK patching με Objection
```bash
# Embed Gadget, config, and your compiled agent into the APK; rebuild and sign
objection patchapk -s org.secuso.privacyfriendlydicer.apk \
-c gadget-config.json \
-l mod/_agent.js \
--use-aapt2
```
Τι κάνει το patchapk (σε υψηλό επίπεδο):
- Εντοπίζει το ABI της συσκευής (π.χ., arm64-v8a) και κατεβάζει το matching Gadget
- Προαιρετικά προσθέτει android.permission.INTERNET όταν χρειάζεται
- Εισάγει έναν στατικό αρχικοποιητή κλάσης που καλεί System.loadLibrary("frida-gadget") στην activity εκκίνησης
- Τοποθετεί τα ακόλουθα κάτω από `lib/<abi>/`:
- libfrida-gadget.so
- libfrida-gadget.config.so (serialized config)
- libfrida-gadget.script.so (your _agent.js)

Παράδειγμα εγχυμένου smali (static initializer):
```smali
.method static constructor <clinit>()V
.locals 1
const-string v0, "frida-gadget"
invoke-static {v0}, Ljava/lang/System;->loadLibrary(Ljava/lang/String;)V
return-void
.end method
```
4) Επαληθεύστε το repack
```bash
apktool d org.secuso.privacyfriendlydicer.apk
apktool d org.secuso.privacyfriendlydicer.objection.apk
# Inspect differences
diff -r org.secuso.privacyfriendlydicer org.secuso.privacyfriendlydicer.objection
```
Αναμενόμενες αλλαγές:
- AndroidManifest.xml μπορεί να περιλαμβάνει `<uses-permission android:name="android.permission.INTERNET"/>`
- Νέες native libs κάτω από `lib/<abi>/` όπως παραπάνω
- Η Launchable activity smali περιέχει ένα static `<clinit>` που καλεί System.loadLibrary("frida-gadget")

5) Split APKs
- Patch το base APK (αυτό που δηλώνει MAIN/LAUNCHER activity)
- Re-sign τα υπόλοιπα splits με το ίδιο key:
```bash
objection signapk split1.apk split2.apk ...
```
- Εγκαταστήστε τα splits μαζί:
```bash
adb install-multiple split1.apk split2.apk ...
```
- Για διανομή, μπορείτε να συγχωνεύσετε τα splits σε ένα ενιαίο APK με APKEditor, και στη συνέχεια να κάνετε align/sign

## Clearing FLAG_SECURE during dynamic analysis

Οι εφαρμογές που καλούν `getWindow().setFlags(LayoutParams.FLAG_SECURE, LayoutParams.FLAG_SECURE)` εμποδίζουν screenshots, απομακρυσμένες οθόνες και ακόμη και τα recent-task snapshots του Android. Όταν το Freedom Chat επέβαλε αυτή τη σημαία, ο μόνος τρόπος να τεκμηριωθούν τα leaks ήταν να τροποποιηθεί το παράθυρο κατά τη διάρκεια εκτέλεσης. Ένα αξιόπιστο μοτίβο είναι:

- Hook every `Window` overload that can re-apply the flag (`setFlags`, `addFlags`, `setAttributes`) and mask out bit `0x00002000` (`WindowManager.LayoutParams.FLAG_SECURE`).
- Μετά από κάθε activity resume, προγραμμάτισε μια κλήση στο UI-thread προς `clearFlags(FLAG_SECURE)` ώστε τα Dialogs/Fragments που δημιουργούνται αργότερα να κληρονομήσουν την ξεκλείδωτη κατάσταση.
- Οι εφαρμογές που έχουν κατασκευαστεί με React Native / Flutter συχνά δημιουργούν nested windows· κάντε hook στα helpers `android.app.Dialog`/`android.view.View` ή περπατήστε το `getWindow().peekDecorView()` αν εξακολουθείτε να βλέπετε black frames.

<details>
<summary>Frida hook clearing Window.FLAG_SECURE</summary>
```javascript
Java.perform(function () {
var LayoutParams = Java.use("android.view.WindowManager$LayoutParams");
var FLAG_SECURE = LayoutParams.FLAG_SECURE.value;
var Window = Java.use("android.view.Window");
var Activity = Java.use("android.app.Activity");

function strip(value) {
var masked = value & (~FLAG_SECURE);
if (masked !== value) {
console.log("[-] Stripped FLAG_SECURE from 0x" + value.toString(16));
}
return masked;
}

Window.setFlags.overload('int', 'int').implementation = function (flags, mask) {
return this.setFlags.call(this, strip(flags), strip(mask));
};

Window.addFlags.implementation = function (flags) {
return this.addFlags.call(this, strip(flags));
};

Window.setAttributes.implementation = function (attrs) {
attrs.flags.value = strip(attrs.flags.value);
return this.setAttributes.call(this, attrs);
};

Activity.onResume.implementation = function () {
this.onResume();
var self = this;
Java.scheduleOnMainThread(function () {
try {
self.getWindow().clearFlags(FLAG_SECURE);
console.log("[+] Cleared FLAG_SECURE on " + self.getClass().getName());
} catch (err) {
console.log("[!] clearFlags failed: " + err);
}
});
};
});
```
</details>

Εκτελέστε το script με `frida -U -f <package> -l disable-flag-secure.js --no-pause`, αλληλεπιδράστε με το UI, και τα στιγμιότυπα/εγγραφές θα λειτουργήσουν ξανά. Επειδή όλα συμβαίνουν στο UI thread δεν υπάρχει flicker, και μπορείτε ακόμα να συνδυάσετε το hook με HTTP Toolkit/Burp για να καταγράψετε την κίνηση που αποκάλυψε το `/channel` PIN leak.


## Οδηγοί

### [Οδηγός 1](frida-tutorial-1.md)

**Από**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**Πηγαίος κώδικας**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**Ακολουθήστε τον [σύνδεσμο για να το διαβάσετε](frida-tutorial-1.md).**

### [Οδηγός 2](frida-tutorial-2.md)

**Από**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Μέρη 2, 3 & 4)\
**APKs και πηγαίος κώδικας**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**Ακολουθήστε τον [σύνδεσμο για να το διαβάσετε.](frida-tutorial-2.md)**

### [Οδηγός 3](owaspuncrackable-1.md)

**Από**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk)

**Ακολουθήστε τον [σύνδεσμο για να το διαβάσετε](owaspuncrackable-1.md).**

**Μπορείτε να βρείτε περισσότερα Awesome Frida scripts εδώ:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Γρήγορα Παραδείγματα

### Κλήση του Frida από τη γραμμή εντολών
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Βασικό Python Script
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking συναρτήσεων χωρίς παραμέτρους

Hook τη συνάρτηση `a()` της κλάσης `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()")
return false;
};
});
```
Hook java `exit()`
```javascript
var sysexit = Java.use("java.lang.System")
sysexit.exit.overload("int").implementation = function (var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)")
}
```
Hook MainActivity `.onStart()` και `.onCreate()`
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity")
mainactivity.onStart.overload().implementation = function () {
send("MainActivity.onStart() HIT!!!")
var ret = this.onStart.overload().call(this)
}
mainactivity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("MainActivity.onCreate() HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
Hook android `.onCreate()`
```javascript
var activity = Java.use("android.app.Activity")
activity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("Activity HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
### Hooking συναρτήσεις με παραμέτρους και ανάκτηση της τιμής

Hooking μιας συνάρτησης αποκρυπτογράφησης. Εκτύπωσε την είσοδο, κάλεσε την αρχική συνάρτηση για να αποκρυπτογραφήσει την είσοδο και τέλος, εκτύπωσε τα απλά δεδομένα:

<details>
<summary>Hooking μιας συνάρτησης αποκρυπτογράφησης (Java) — εκτύπωση εισόδων/εξόδων</summary>
```javascript
function getString(data) {
var ret = ""
for (var i = 0; i < data.length; i++) {
ret += data[i].toString()
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a")
aes_decrypt.a.overload("[B", "[B").implementation = function (var_0, var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding")
send("Key       : " + getString(var_0))
send("Encrypted : " + getString(var_1))
var ret = this.a.overload("[B", "[B").call(this, var_0, var_1)
send("Decrypted : " + ret)

var flag = ""
for (var i = 0; i < ret.length; i++) {
flag += String.fromCharCode(ret[i])
}
send("Decrypted flag: " + flag)
return ret //[B
}
```
</details>

### Hooking functions και κλήση τους με το input μας

Hook μια function που λαμβάνει ένα string και κάλεσέ την με άλλο string (from [here](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String") // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function (x) {
//hooking the new function
var my_string = string_class.$new("My TeSt String#####") //creating a new String by using `new` operator
console.log("Original arg: " + x)
var ret = this.fun(my_string) // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: " + ret)
return ret
}
```
### Λήψη ήδη δημιουργημένου αντικειμένου μιας κλάσης

Αν θέλετε να εξάγετε κάποια ιδιότητα από ένα δημιουργημένο αντικείμενο, μπορείτε να χρησιμοποιήσετε αυτό.

Σε αυτό το παράδειγμα θα δείτε πώς να πάρετε το αντικείμενο της κλάσης my_activity και πώς να καλέσετε τη συνάρτηση .secret() που θα εκτυπώσει μια ιδιωτική ιδιότητα του αντικειμένου:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
//This function will be called for every instance found by frida
console.log("Found instance: " + instance)
console.log("Result of secret func: " + instance.secret())
},
onComplete: function () {},
})
```
## Άλλοι οδηγοί για Frida

- [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
- [Part 1 of Advanced Frida Usage blog series: IOS Encryption Libraries](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)


## Αναφορές

- [Build a Repeatable Android Bug Bounty Lab: Emulator vs Magisk, Burp, Frida, and Medusa](https://www.yeswehack.com/learn-bug-bounty/android-lab-mobile-hacking-tools)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Frida releases (server binaries)](https://github.com/frida/frida/releases)
- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)
- [frida-jdwp-loader](https://github.com/frankheat/frida-jdwp-loader)
- [Library injection for debuggable Android apps (blog)](https://koz.io/library-injection-for-debuggable-android-apps/)
- [jdwp-lib-injector (original idea/tool)](https://github.com/ikoz/jdwp-lib-injector)
- [jdwp-shellifier](https://github.com/hugsy/jdwp-shellifier)
- ["Super secure" MAGA-themed messaging app leaks everyone’s phone number](https://ericdaigle.ca/posts/super-secure-maga-messaging-app-leaks-everyones-phone-number/)
- [Android Frida Hooking: Disabling FLAG_SECURE](https://www.securify.nl/en/blog/android-frida-hooking-disabling-flagsecure/)

{{#include ../../../banners/hacktricks-training.md}}
