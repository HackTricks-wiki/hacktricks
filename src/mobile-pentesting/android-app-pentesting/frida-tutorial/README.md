# Frida Οδηγός

{{#include ../../../banners/hacktricks-training.md}}


## Εγκατάσταση

Εγκαταστήστε **frida tools**:
```bash
pip install frida-tools
pip install frida
```
**Κατεβάστε και εγκαταστήστε** στο Android το **frida server** ([Download the latest release](https://github.com/frida/frida/releases)).\
Μια εντολή-γραμμή για να επανεκκινήσετε το adb σε root mode, να συνδεθείτε σε αυτό, να ανεβάσετε το frida-server, να δώσετε δικαιώματα εκτέλεσης και να το τρέξετε στο παρασκήνιο:
```bash
adb root; adb connect localhost:6000; sleep 1; adb push frida-server /data/local/tmp/; adb shell "chmod 755 /data/local/tmp/frida-server"; adb shell "/data/local/tmp/frida-server &"
```
**Ελέγξτε** αν **λειτουργεί**:
```bash
frida-ps -U #List packages and processes
frida-ps -U | grep -i <part_of_the_package_name> #Get all the package name
```
## Frida server vs. Gadget (root vs. no-root)

Δύο συνηθισμένοι τρόποι για παρεμβολή σε εφαρμογές Android με το Frida:

- Frida server (rooted devices): Ανεβάστε και τρέξτε έναν native daemon που σας επιτρέπει να συνδεθείτε σε οποιαδήποτε διεργασία.
- Frida Gadget (no root): Πακετάρει το Frida ως shared library μέσα στο APK και το φορτώνει αυτόματα στην στοχευόμενη διεργασία.

Frida server (rooted)
```bash
# Download the matching frida-server binary for your device's arch
# https://github.com/frida/frida/releases
adb root
adb push frida-server-<ver>-android-<arch> /data/local/tmp/frida-server
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &    # run at boot via init/magisk if desired

# From host, list processes and attach
frida-ps -Uai
frida -U -n com.example.app
```
Frida Gadget (no-root)

1) Αποσυμπιέστε το APK, προσθέστε το gadget .so και το config:
- Τοποθετήστε libfrida-gadget.so στο `lib/<abi>/` (π.χ., lib/arm64-v8a/)
- Δημιουργήστε assets/frida-gadget.config με τις ρυθμίσεις φόρτωσης script σας

Example frida-gadget.config
```json
{
"interaction": { "type": "script", "path": "/sdcard/ssl-bypass.js" },
"runtime": { "logFile": "/sdcard/frida-gadget.log" }
}
```
2) Αναφορά/φόρτωση του gadget ώστε να αρχικοποιηθεί νωρίς:
- Το πιο εύκολο: Προσθέστε ένα μικρό Java stub με System.loadLibrary("frida-gadget") στο Application.onCreate(), ή χρησιμοποιήστε το native lib loading που υπάρχει ήδη.

3) Επαναπακετάρετε και υπογράψτε το APK, στη συνέχεια εγκαταστήστε:
```bash
apktool d app.apk -o app_m
# ... add gadget .so and config ...
apktool b app_m -o app_gadget.apk
uber-apk-signer -a app_gadget.apk -o out_signed
adb install -r out_signed/app_gadget-aligned-debugSigned.apk
```
4) Συνδέστε από host στη gadget process:
```bash
frida-ps -Uai
frida -U -n com.example.app
```
Σημειώσεις
- Gadget ανιχνεύεται από ορισμένες προστασίες· κρατήστε τα ονόματα/διαδρομές διακριτικά και φορτώστε αργά/υπό όρους αν χρειαστεί.
- Σε hardened εφαρμογές, προτιμήστε rooted testing με server + late attach, ή συνδυάστε με κρυψώνα Magisk/Zygisk.

## Αυτόνομο agent + Gadget ενσωμάτωση (Frida 17+; automated with Objection)

Το Frida 17 αφαίρεσε τις ενσωματωμένες Java/ObjC bridges από το GumJS. Αν το agent σας κάνει hooks σε Java, πρέπει να συμπεριλάβετε το Java bridge μέσα στο bundle σας.

1) Δημιουργήστε ένα Frida agent (TypeScript) και συμπεριλάβετε το Java bridge
```bash
# Scaffolding
frida-create -t agent -o mod
cd mod && npm install
# Install the Java bridge for Frida 17+
npm install frida-java-bridge
# Dev loop (optional live-reload via REPL)
npm run watch
```
Ελάχιστο Java hook (αναγκάζει τις ρίψεις των ζαριών να γίνουν 1):
```ts
import Java from "frida-java-bridge";

Java.perform(function () {
var dicer = Java.use("org.secuso.privacyfriendlydicer.dicer.Dicer");
dicer.rollDice.implementation = function (numDice: number, numFaces: number) {
return Array(numDice).fill(1);
};
});
```
Δημιουργήστε ένα ενιαίο bundle για ενσωμάτωση:
```bash
npm run build    # produces _agent.js via frida-compile
```
Γρήγορος έλεγχος USB (προαιρετικό):
```bash
frida -U -f org.secuso.privacyfriendlydicer -l _agent.js
```
2) Διαμορφώστε το Gadget ώστε να φορτώνει αυτόματα το script σας
Ο patcher του Objection αναμένει μια Gadget config· όταν χρησιμοποιείτε script mode, καθορίστε τη διαδρομή στο δίσκο μέσα στον APK lib dir:
```json
{
"interaction": {
"type": "script",
"path": "libfrida-gadget.script.so"
}
}
```
3) Αυτοματοποιήστε το patching του APK με Objection
```bash
# Embed Gadget, config, and your compiled agent into the APK; rebuild and sign
objection patchapk -s org.secuso.privacyfriendlydicer.apk \
-c gadget-config.json \
-l mod/_agent.js \
--use-aapt2
```
Τι κάνει το patchapk (σε υψηλό επίπεδο):
- Εντοπίζει το ABI της συσκευής (π.χ., arm64-v8a) και ανακτά το αντίστοιχο Gadget
- Προαιρετικά προσθέτει android.permission.INTERNET όταν χρειάζεται
- Εισάγει έναν static class initializer που καλεί System.loadLibrary("frida-gadget") στην launch activity
- Τοποθετεί τα ακόλουθα κάτω από `lib/<abi>/`:
- libfrida-gadget.so
- libfrida-gadget.config.so (serialized config)
- libfrida-gadget.script.so (your _agent.js)

Παράδειγμα εγχυμένου smali (static initializer):
```smali
.method static constructor <clinit>()V
.locals 1
const-string v0, "frida-gadget"
invoke-static {v0}, Ljava/lang/System;->loadLibrary(Ljava/lang/String;)V
return-void
.end method
```
4) Επαληθεύστε το repack
```bash
apktool d org.secuso.privacyfriendlydicer.apk
apktool d org.secuso.privacyfriendlydicer.objection.apk
# Inspect differences
diff -r org.secuso.privacyfriendlydicer org.secuso.privacyfriendlydicer.objection
```
Αναμενόμενες αλλαγές:
- AndroidManifest.xml μπορεί να περιέχει `<uses-permission android:name="android.permission.INTERNET"/>`
- Νέες native libs κάτω από lib/<abi>/ όπως παραπάνω
- Το launchable activity smali περιέχει ένα static `<clinit>` που καλεί System.loadLibrary("frida-gadget")

5) Split APKs
- Patch το base APK (αυτό που δηλώνει την MAIN/LAUNCHER activity)
- Επανυπογράψτε τα υπόλοιπα splits με το ίδιο κλειδί:
```bash
objection signapk split1.apk split2.apk ...
```
- Εγκαταστήστε τα splits μαζί:
```bash
adb install-multiple split1.apk split2.apk ...
```
- Για διανομή, μπορείς να συγχωνεύσεις τα splits σε ένα μόνο APK με APKEditor, και μετά να το align/sign

Σημειώσεις άμυνας (τι να προσέξετε κατά τη θωράκιση)
- Εφαρμόστε ελέγχους υπογραφής/repackage και runtime integrity/attestation
- Εντοπίστε μη αναμενόμενο System.loadLibrary("frida-gadget") ή ύποπτες native libs κατά την εκκίνηση
- Αποφύγετε να δηλώνετε άδεια INTERNET που δεν χρησιμοποιείται· μειώστε την επιφάνεια ανίχνευσης gadget

## Οδηγοί

### [Οδηγός 1](frida-tutorial-1.md)

**Από**: [https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1](https://medium.com/infosec-adventures/introduction-to-frida-5a3f51595ca1)\
**APK**: [https://github.com/t0thkr1s/frida-demo/releases](https://github.com/t0thkr1s/frida-demo/releases)\
**Πηγαίος Κώδικας**: [https://github.com/t0thkr1s/frida-demo](https://github.com/t0thkr1s/frida-demo)

**Ακολούθησε τον [σύνδεσμο για να το διαβάσεις](frida-tutorial-1.md).**

### [Οδηγός 2](frida-tutorial-2.md)

**Από**: [https://11x256.github.io/Frida-hooking-android-part-2/](https://11x256.github.io/Frida-hooking-android-part-2/) (Μέρη 2, 3 & 4)\
**APKs και Πηγαίος Κώδικας**: [https://github.com/11x256/frida-android-examples](https://github.com/11x256/frida-android-examples)

**Ακολούθησε τον[ σύνδεσμο για να το διαβάσεις.](frida-tutorial-2.md)**

### [Οδηγός 3](owaspuncrackable-1.md)

**Από**: [https://joshspicer.com/android-frida-1](https://joshspicer.com/android-frida-1)\
**APK**: [https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk](https://github.com/OWASP/owasp-mstg/blob/master/Crackmes/Android/Level_01/UnCrackable-Level1.apk)

**Ακολούθησε τον [σύνδεσμο για να το διαβάσεις](owaspuncrackable-1.md).**

**Μπορείτε να βρείτε περισσότερα Awesome Frida scripts εδώ:** [**https://codeshare.frida.re/**](https://codeshare.frida.re)

## Γρήγορα Παραδείγματα

### Κλήση του Frida από τη γραμμή εντολών
```bash
frida-ps -U

#Basic frida hooking
frida -l disableRoot.js -f owasp.mstg.uncrackable1

#Hooking before starting the app
frida -U --no-pause -l disableRoot.js -f owasp.mstg.uncrackable1
#The --no-pause and -f options allow the app to be spawned automatically,
#frozen so that the instrumentation can occur, and the automatically
#continue execution with our modified code.
```
### Βασικό σενάριο Python
```python
import frida, sys

jscode = open(sys.argv[0]).read()
process = frida.get_usb_device().attach('infosecadventures.fridademo')
script = process.create_script(jscode)
print('[ * ] Running Frida Demo application')
script.load()
sys.stdin.read()
```
### Hooking συναρτήσεων χωρίς παραμέτρους

Hook τη συνάρτηση `a()` της κλάσης `sg.vantagepoint.a.c`
```javascript
Java.perform(function () {
;  rootcheck1.a.overload().implementation = function() {
rootcheck1.a.overload().implementation = function() {
send("sg.vantagepoint.a.c.a()Z   Root check 1 HIT!  su.exists()");
return false;
};
});
```
Hook java `exit()`
```javascript
var sysexit = Java.use("java.lang.System")
sysexit.exit.overload("int").implementation = function (var_0) {
send("java.lang.System.exit(I)V  // We avoid exiting the application  :)")
}
```
Hook MainActivity `.onStart()` & `.onCreate()`
```javascript
var mainactivity = Java.use("sg.vantagepoint.uncrackable1.MainActivity")
mainactivity.onStart.overload().implementation = function () {
send("MainActivity.onStart() HIT!!!")
var ret = this.onStart.overload().call(this)
}
mainactivity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("MainActivity.onCreate() HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
Hook android `.onCreate()`
```javascript
var activity = Java.use("android.app.Activity")
activity.onCreate.overload("android.os.Bundle").implementation = function (
var_0
) {
send("Activity HIT!!!")
var ret = this.onCreate.overload("android.os.Bundle").call(this, var_0)
}
```
### Hooking συναρτήσεων με παραμέτρους και ανάκτηση της τιμής

Hooking μιας decryption function. Εκτύπωσε το input, κάλεσε την original function για να decrypt το input και, τελικά, εκτύπωσε τα plain data:
```javascript
function getString(data) {
var ret = ""
for (var i = 0; i < data.length; i++) {
ret += data[i].toString()
}
return ret
}
var aes_decrypt = Java.use("sg.vantagepoint.a.a")
aes_decrypt.a.overload("[B", "[B").implementation = function (var_0, var_1) {
send("sg.vantagepoint.a.a.a([B[B)[B   doFinal(enc)  // AES/ECB/PKCS7Padding")
send("Key       : " + getString(var_0))
send("Encrypted : " + getString(var_1))
var ret = this.a.overload("[B", "[B").call(this, var_0, var_1)
send("Decrypted : " + ret)

var flag = ""
for (var i = 0; i < ret.length; i++) {
flag += String.fromCharCode(ret[i])
}
send("Decrypted flag: " + flag)
return ret //[B
}
```
### Hooking functions and calling them with our input

Hook a function που λαμβάνει ένα string και κάλεσέ την με άλλο string (από [here](https://11x256.github.io/Frida-hooking-android-part-2/))
```javascript
var string_class = Java.use("java.lang.String") // get a JS wrapper for java's String class

my_class.fun.overload("java.lang.String").implementation = function (x) {
//hooking the new function
var my_string = string_class.$new("My TeSt String#####") //creating a new String by using `new` operator
console.log("Original arg: " + x)
var ret = this.fun(my_string) // calling the original function with the new String, and putting its return value in ret variable
console.log("Return value: " + ret)
return ret
}
```
### Λήψη ήδη δημιουργημένου αντικειμένου μιας κλάσης

Αν θέλετε να εξαγάγετε κάποια ιδιότητα ενός δημιουργημένου αντικειμένου, μπορείτε να χρησιμοποιήσετε αυτό.

Στο παράδειγμα αυτό θα δείτε πώς να πάρετε το αντικείμενο της κλάσης my_activity και πώς να καλέσετε τη συνάρτηση .secret() που θα εκτυπώσει μια ιδιωτική ιδιότητα του αντικειμένου:
```javascript
Java.choose("com.example.a11x256.frida_test.my_activity", {
onMatch: function (instance) {
//This function will be called for every instance found by frida
console.log("Found instance: " + instance)
console.log("Result of secret func: " + instance.secret())
},
onComplete: function () {},
})
```
## Άλλοι οδηγοί για Frida

- [https://github.com/DERE-ad2001/Frida-Labs](https://github.com/DERE-ad2001/Frida-Labs)
- [Part 1 of Advanced Frida Usage blog series: IOS Encryption Libraries](https://8ksec.io/advanced-frida-usage-part-1-ios-encryption-libraries-8ksec-blogs/)


## Αναφορές

- [Build a Repeatable Android Bug Bounty Lab: Emulator vs Magisk, Burp, Frida, and Medusa](https://www.yeswehack.com/learn-bug-bounty/android-lab-mobile-hacking-tools)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Frida releases (server binaries)](https://github.com/frida/frida/releases)
- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)

{{#include ../../../banners/hacktricks-training.md}}
