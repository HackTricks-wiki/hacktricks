# Objection Tutorial

{{#include ../../../banners/hacktricks-training.md}}

## **Introducción**

**objection - Exploración móvil en tiempo de ejecución**

[**Objection**](https://github.com/sensepost/objection) es un conjunto de herramientas para exploración móvil en tiempo de ejecución, potenciado por [Frida](https://www.frida.re). Fue creado con el objetivo de ayudar a evaluar aplicaciones móviles y su postura de seguridad sin la necesidad de un dispositivo móvil jailbroken o rooted.

**Nota:** Esto no es una forma de jailbreak / root bypass. Al usar `objection`, aún estás limitado por todas las restricciones impuestas por el sandbox aplicable al que te enfrentas.

### Resumen

El **objetivo** de **objection** es permitir al usuario invocar las **principales acciones que ofrece Frida**. **De lo contrario**, el usuario tendrá que crear un **script único para cada aplicación** que quiera probar.

## Tutorial

Para este tutorial voy a usar el APK que puedes descargar aquí:

{{#file}}
app-release.zip
{{#endfile}}

O desde su [original repository ](https://github.com/asvid/FridaApp)(descargar app-release.apk)

### Instalación
```bash
pip3 install objection
```
### Conexión

Haz una **conexión ADB regular** y **inicia** el **frida** server en el dispositivo (y comprueba que **frida** está funcionando tanto en el cliente como en el server).

Si estás usando un **rooted device** es necesario seleccionar la aplicación que quieres probar dentro de la opción _**--gadget**_. en este caso:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Acciones básicas

No todos los comandos posibles de objections serán listados en este tutorial; solo aquellos que he encontrado más útiles.

#### Entorno

Puede haber información interesante (como passwords o paths) dentro del entorno.
```bash
env
```
![](<../../../images/image (220).png>)

#### Información de Frida
```bash
frida
```
![](<../../../images/image (1093).png>)

#### Subir/Descargar
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importar script de frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Detección de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Exec Command
```bash
android shell_exec whoami
```
#### Capturas de pantalla
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Static analysis made Dynamic

En una aplicación real deberíamos conocer toda la información descubierta en esta parte antes de usar objection gracias al **static analysis**. De todas formas, así quizá puedas ver **algo nuevo**, ya que aquí solo tendrás una lista completa de clases, métodos y objetos exportados.

Esto también es útil si de algún modo eres **incapaz de obtener código fuente legible** de la app.

#### List activities, receivers and services
```bash
android hooking list activities
```
![](<../../../images/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida lanzará un error si no se encuentra ninguna

#### Obteniendo la actividad actual
```bash
android hooking get current_activity
```
![](<../../../images/image (813).png>)

#### Buscar clases

Empecemos a buscar clases dentro de nuestra aplicación
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../images/image (507).png>)

#### Buscar métodos de una clase

Ahora extraigamos los métodos dentro de la clase _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../images/image (929).png>)

#### Listar Methods declarados de una clase con sus parameters

Veamos qué parameters necesitan los methods de la clase:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../images/image (299).png>)

#### Listar clases

También puedes listar todas las clases que se cargaron dentro de la aplicación actual:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Esto es muy útil si quieres **hacer hook al método de una clase y solo conoces el nombre de la clase**. Puedes usar esta función para **buscar qué módulo posee la clase** y luego hacer hook a su método.

### Hooking being easy

#### Hooking (watching) a method

From the [source code](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) of the application we know that the **función** _**sum()**_ **de** _**MainActivity**_ se ejecuta **cada segundo**. Intentemos **volcar toda la información posible** cada vez que se llama la función (argumentos, valor de retorno y backtrace):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../images/image (1086).png>)

#### Hooking (watching) an entire class

En realidad, encuentro todos los métodos de la clase MainActivity realmente interesantes, vamos a **hook them all**. Ten cuidado, esto podría **crash** una aplicación.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
Si interactúas con la aplicación mientras la clase está hooked verás cuándo **cada función es invocada**, sus **argumentos** y el valor de **retorno**.

![](<../../../images/image (861).png>)

#### Changing boolean return value of a function

Desde el código fuente puedes ver que la función _checkPin_ recibe un _String_ como argumento y devuelve un _boolean_. Hagamos que la función **siempre devuelva true**:

![](<../../../images/image (883).png>)

Ahora, si escribes cualquier cosa en el campo de texto para el código PIN verás que cualquier cosa es válida:

![](<../../../images/image (228).png>)

### Instancias de clase

Busca e imprime **instancias en vivo de una clase Java específica**, especificada por un nombre de clase completamente calificado. Out es el resultado de un intento de obtener un valor de cadena para una objection descubierta que típicamente **contendría los valores de las propiedades del objeto**.
```
android heap print_instances <class>
```
![](<../../../images/image (1095).png>)

### Keystore/Intents

Puedes manipular el keystore y los intents usando:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Memoria

#### Volcado
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lista
```bash
memory list modules
```
![](<../../../images/image (286).png>)

En la parte inferior de la lista puedes ver frida:

![](<../../../images/image (1097).png>)

Veamos qué está exportando frida:

![](<../../../images/image (298).png>)

#### Buscar/Escribir

También puedes buscar y escribir en la memoria con objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Puedes usar el comando `sqlite` para interactuar con bases de datos sqlite.

### Salir
```bash
exit
```
## Lo que echo de menos en Objection

- Los métodos de hooking a veces hacen que la aplicación se bloquee (esto también es por Frida).
- No puedes usar las instances de las classes para llamar funciones de la instance. Y no puedes crear nuevas instances de classes y usarlas para llamar funciones.
- No existe un atajo (como el de sslpinnin) para hook todos los métodos crypto comunes que utiliza la aplicación para ver texto cifrado, texto plano, keys, IVs y algoritmos usados.

## Referencias

- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)

{{#include ../../../banners/hacktricks-training.md}}
