# Objection Tutoriel

{{#include ../../../banners/hacktricks-training.md}}

## **Introduction**

**objection - Exploration mobile à l'exécution**

[**Objection**](https://github.com/sensepost/objection) est un toolkit d'exploration mobile à l'exécution, propulsé par [Frida](https://www.frida.re). Il a été conçu pour aider à évaluer les applications mobiles et leur posture de sécurité sans nécessiter un appareil mobile jailbroken ou rooted.

**Note :** Il ne s'agit pas d'une forme de jailbreak / root bypass. En utilisant `objection`, vous restez néanmoins limité par toutes les restrictions imposées par le sandbox applicable auquel vous êtes confronté.

### Résumé

Le **but** de **objection** est de permettre à l'utilisateur d'appeler les **principales actions offertes par Frida**. **Sinon**, l'utilisateur devra créer un **script distinct pour chaque application** qu'il souhaite tester.

## Tutoriel

Pour ce tutoriel, j'utiliserai l'APK que vous pouvez télécharger ici :

{{#file}}
app-release.zip
{{#endfile}}

Ou depuis son [dépôt original](https://github.com/asvid/FridaApp) (download app-release.apk)

### Installation
```bash
pip3 install objection
```
### Connexion

Faites une **connexion ADB régulière** et **démarrez** le serveur **frida** sur l'appareil (et vérifiez que frida fonctionne à la fois sur le client et le serveur).

Si vous utilisez un **rooted device**, il est nécessaire de sélectionner l'application que vous voulez tester dans l'option _**--gadget**_. Dans ce cas :
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Actions de base

Toutes les commandes possibles d'objections ne seront pas listées dans ce tutoriel, seulement celles que j'ai trouvées les plus utiles.

#### Environnement

Certaines informations intéressantes (comme des mots de passe ou des chemins) peuvent se trouver dans l'environnement.
```bash
env
```
![](<../../../images/image (220).png>)

#### Informations sur Frida
```bash
frida
```
![](<../../../images/image (1093).png>)

#### Téléversement/Téléchargement
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importer le script frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Détection de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Commande Exec
```bash
android shell_exec whoami
```
#### Captures d'écran
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Static analysis made Dynamic

Dans une application réelle, nous devrions connaître toutes les informations découvertes dans cette partie avant d'utiliser objection grâce à **static analysis**. Quoi qu'il en soit, de cette manière vous pourriez peut‑être voir **quelque chose de nouveau** car ici vous n'aurez qu'une liste complète de classes, méthodes et objets exportés.

Ceci est aussi utile si, d'une manière ou d'une autre, vous êtes **dans l'incapacité d'obtenir un code source lisible** de l'application.

#### Lister les activities, receivers et services
```bash
android hooking list activities
```
![](<../../../images/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida générera une erreur si aucune n'est trouvée

#### Obtention de l'activité en cours
```bash
android hooking get current_activity
```
![](<../../../images/image (813).png>)

#### Rechercher des classes

Commençons par rechercher des classes dans notre application
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../images/image (507).png>)

#### Recherche des méthodes d'une classe

Maintenant, extrayons les méthodes à l'intérieur de la classe _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../images/image (929).png>)

#### Lister les méthodes déclarées d'une classe avec leurs paramètres

Déterminons quels paramètres sont nécessaires pour les méthodes de la classe :
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../images/image (299).png>)

#### Lister les classes

Vous pouvez aussi lister toutes les classes qui ont été chargées dans l'application courante :
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Ceci est très utile si vous voulez **hook la méthode d'une classe et que vous ne connaissez que le nom de la classe**. Vous pouvez utiliser cette fonction pour **rechercher quel module possède la classe** puis hook la méthode.

### Hooking — facile

#### Hooking (surveiller) une méthode

D'après le [source code](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de l'application, nous savons que la **fonction** _**sum()**_ **de** _**MainActivity**_ s'exécute **toutes les secondes**. Essayons de **dump toutes les informations possibles** chaque fois que la fonction est appelée (arguments, valeur de retour et backtrace) :
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../images/image (1086).png>)

#### Hooking (watching) d'une classe entière

En fait, je trouve toutes les méthodes de la classe MainActivity vraiment intéressantes, alors **hook them all**. Attention : cela pourrait **crash** l'application.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
If you play with the application while the class is hooked you will see when **each function is being called**, its **arguments** and the **return** value.

![](<../../../images/image (861).png>)

#### Changing boolean return value of a function

From the source code you can see that the function _checkPin_ gets a _String_ as argument and returns a _boolean_. Lets make the function **always return true**:

![](<../../../images/image (883).png>)

Now, If you write anything in the text box for the PIN code you will see tat anything is valid:

![](<../../../images/image (228).png>)

### Class instances

Search for and print **live instances of a specific Java class**, specified by a fully qualified class name. Out is the result of an attempt at getting a string value for a discovered objection which would typically **contain property values for the object**.
```
android heap print_instances <class>
```
![](<../../../images/image (1095).png>)

### Keystore/Intents

Vous pouvez manipuler le keystore et les intents en utilisant :
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Mémoire

#### Dump
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```bash
memory list modules
```
![](<../../../images/image (286).png>)

En bas de la liste, vous pouvez voir frida :

![](<../../../images/image (1097).png>)

Voyons ce que frida exporte :

![](<../../../images/image (298).png>)

#### Recherche/Écriture

Vous pouvez aussi rechercher et écrire dans la mémoire avec objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Vous pouvez utiliser la commande `sqlite` pour interagir avec les bases de données sqlite.

### Quitter
```bash
exit
```
## Ce qui me manque dans Objection

- Les méthodes de hooking font parfois planter l'application (c'est aussi dû à Frida).
- Vous ne pouvez pas utiliser les instances des classes pour appeler les fonctions de l'instance. Et vous ne pouvez pas créer de nouvelles instances de classes et les utiliser pour appeler des fonctions.
- Il n'existe pas de raccourci (comme celui pour sslpinnin) pour hooker toutes les méthodes crypto courantes utilisées par l'application afin de voir le texte chiffré, le texte en clair, les keys, les IVs et les algorithmes utilisés.

## Références

- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)

{{#include ../../../banners/hacktricks-training.md}}
