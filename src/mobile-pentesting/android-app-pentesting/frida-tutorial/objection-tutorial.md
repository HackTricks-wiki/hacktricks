# Objection Tutorial

{{#include ../../../banners/hacktricks-training.md}}

## **Inleiding**

**objection - Runtime mobiele verkenning**

[**Objection**](https://github.com/sensepost/objection) is 'n runtime mobiele verkenning toolkit, aangedryf deur [Frida](https://www.frida.re). Dit is gebou met die doel om te help om mobiele toepassings en hul sekuriteitsposisie te beoordeel sonder die behoefte aan 'n jailbroken of rooted mobiele toestel.

**Let wel:** Dit is nie 'n vorm van jailbreak / root bypass nie. Deur `objection` te gebruik, bly jy steeds beperk deur al die beperkinge wat deur die toepaslike sandbox opgelê word.

### Opsomming

Die **doel** van **objection** is om die gebruiker toe te laat om die **hoofaksies wat Frida bied** aan te roep. **Anders** sal die gebruiker 'n **enkele script vir elke toepassing** wat hy wil toets moet skep.

## Handleiding

Vir hierdie handleiding gaan ek die APK gebruik wat jy hier kan aflaai:

{{#file}}
app-release.zip
{{#endfile}}

Of vanaf sy [oorspronklike repository](https://github.com/asvid/FridaApp) (laai app-release.apk af)

### Installering
```bash
pip3 install objection
```
### Verbinding

Maak 'n **regular ADB conection** en **start** die **frida** server op die toestel (en kontroleer dat frida werk in beide die client en die server).

As jy 'n **rooted device** gebruik, is dit nodig om die toepassing wat jy wil toets te kies binne die _**--gadget**_ opsie. In hierdie geval:
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Basic Actions

Nie alle moontlike commands van objections sal in hierdie tutorial gelys word nie — slegs diegene wat ek nuttiger gevind het.

#### Environment

Sommige interessante inligting (soos passwords of paths) kan binne die environment gevind word.
```bash
env
```
![](<../../../images/image (220).png>)

#### Frida Inligting
```bash
frida
```
![](<../../../images/image (1093).png>)

#### Oplaai/Aflaai
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importeer frida script
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### Root opsporing
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Voer opdrag uit
```bash
android shell_exec whoami
```
#### Skermskote
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Static analysis made Dynamic

In 'n werklike toepassing behoort ons al die inligting wat in hierdie deel ontdek is te ken voordat ons objection gebruik danksy **static analysis**. Hoe dit ook al sy, op hierdie manier kan jy dalk **iets nuuts** sien, aangesien jy hier slegs 'n volledige lys van classes, methods and exported objects sal hê.

Dit is ook nuttig as jy op een of ander manier **unable to get some readable source code** van die app is.

#### Lys activities, receivers en services
```bash
android hooking list activities
```
![](<../../../images/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida sal 'n fout gooi as geen een gevind word

#### Kry huidige aktiwiteit
```bash
android hooking get current_activity
```
![](<../../../images/image (813).png>)

#### Soek Klasse

Kom ons begin soek na klasse binne ons toepassing
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../images/image (507).png>)

#### Soek metodes van 'n klas

Nou haal ons die metodes binne die klas _MainActivity:_ uit.
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../images/image (929).png>)

#### Lys verklaarde metodes van 'n klas en hul parameters

Kom ons bepaal watter parameters die metodes van die klas benodig:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../images/image (299).png>)

#### Lys klasse

Jy kan ook al die klasse wat in die huidige toepassing gelaai is, lys:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
Dit is baie nuttig as jy die method van 'n class wil hook en jy net die naam van die class ken. Jy kan hierdie function gebruik om te soek watter module die class besit en dan die method te hook.

### Hooking is maklik

#### Hooking (watching) 'n method

Uit die [source code](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) van die toepassing weet ons dat die **function** _**sum()**_ **from** _**MainActivity**_ elke sekonde uitgevoer word. Kom ons probeer elke keer wanneer die function aangeroep word, alle moontlike inligting te dump (arguments, return value en backtrace):
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../images/image (1086).png>)

#### Hooking (monitering) 'n hele klas

Ek vind eintlik al die metodes van die klas MainActivity regtig interessant — kom ons **hook them all**. Wees versigtig, dit kan 'n toepassing **crash**.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
As jy met die toepassing speel terwyl die klas gehook is, sal jy sien wanneer **elke funksie aangeroep word**, sy **argumente** en die **terugkeerwaarde**.

![](<../../../images/image (861).png>)

#### Verandering van boolean terugkeerwaarde van 'n funksie

Uit die bronkode kan jy sien dat die funksie _checkPin_ 'n _String_ as argument kry en 'n _boolean_ teruggee. Kom ons maak die funksie **altyd true teruggee**:

![](<../../../images/image (883).png>)

Nou, as jy enigiets in die tekskassie vir die PIN-kode tik, sal jy sien dat enigiets geldig is:

![](<../../../images/image (228).png>)

### Klasinstansies

Soek en druk **lewende instansies van 'n spesifieke Java-klas**, gespesifiseer deur 'n volledig gekwalifiseerde klassenaam. Uit is die resultaat van 'n poging om 'n stringwaarde te kry vir 'n ontdekte objection wat tipies **eienskapswaardes vir die objek bevat**.
```
android heap print_instances <class>
```
![](<../../../images/image (1095).png>)

### Keystore/Intents

Jy kan met die keystore en intents speel deur die volgende te gebruik:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### Geheue

#### Dump
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Lys
```bash
memory list modules
```
![](<../../../images/image (286).png>)

Onderaan die lys kan jy frida sien:

![](<../../../images/image (1097).png>)

Kom ons kyk wat frida uitvoer:

![](<../../../images/image (298).png>)

#### Soek/Skryf

Jy kan ook binne die geheue soek en skryf met objection:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Jy kan die opdrag `sqlite` gebruik om met sqlite-databasisse te kommunikeer.

### Verlaat
```bash
exit
```
## Wat ek in Objection mis

- Die hooking methods laat soms die toepassing vasloop (dit is ook te wyte aan Frida).
- Jy kan nie die instances van die classes gebruik om die functions van daardie instance aan te roep nie. En jy kan ook nie nuwe instances van classes skep en dit gebruik om functions aan te roep nie.
- Daar is nie 'n shortcut (soos die een vir sslpinnin) om al die algemene crypto-metodes wat deur die toepassing gebruik word te hook en sodoende cyphered text, plain text, keys, IVs en algorithms te sien nie.

## Verwysings

- [Objection (SensePost)](https://github.com/sensepost/objection)
- [Frida Gadget documentation](https://frida.re/docs/gadget/)
- [Modding And Distributing Mobile Apps with Frida](https://pit.bearblog.dev/modding-and-distributing-mobile-apps-with-frida/)

{{#include ../../../banners/hacktricks-training.md}}
