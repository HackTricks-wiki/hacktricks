# iOS Burp Suite Configuration

{{#include ../../banners/hacktricks-training.md}}

## iOSデバイスへのBurp証明書のインストール

iOSデバイスでの安全なウェブトラフィック分析とSSLピンニングのために、Burp Suiteは**Burp Mobile Assistant**を通じて、または手動設定を介して利用できます。以下は両方の方法の要約ガイドです：

### Burp Mobile Assistantによる自動インストール

**Burp Mobile Assistant**は、Burp証明書のインストールプロセス、プロキシ設定、およびSSLピンニングを簡素化します。詳細なガイダンスは[PortSwiggerの公式ドキュメント](https://portswigger.net/burp/documentation/desktop/tools/mobile-assistant/installing)で確認できます。

### 手動インストール手順

1. **プロキシ設定：** まず、iPhoneのWi-Fi設定でBurpをプロキシとして設定します。
2. **証明書ダウンロード：** デバイスのブラウザで`http://burp`に移動して証明書をダウンロードします。
3. **証明書インストール：** ダウンロードしたプロファイルを**設定** > **一般** > **VPNとデバイス管理**からインストールし、**証明書信頼設定**でPortSwigger CAの信頼を有効にします。

### インターセプションプロキシの設定

この設定により、iOSデバイスとインターネット間のトラフィック分析がBurpを介して可能になり、クライアント間トラフィックをサポートするWi-Fiネットワークが必要です。利用できない場合は、usbmuxdを介したUSB接続が代替手段として機能します。PortSwiggerのチュートリアルでは、[デバイス設定](https://support.portswigger.net/customer/portal/articles/1841108-configuring-an-ios-device-to-work-with-burp)や[証明書インストール](https://support.portswigger.net/customer/portal/articles/1841109-installing-burp-s-ca-certificate-in-an-ios-device)に関する詳細な指示が提供されています。

### ジェイルブレイクデバイスのための高度な設定

ジェイルブレイクされたデバイスを持つユーザーは、USB経由のSSH（**iproxy**を使用）を利用してトラフィックを直接Burpを通じてルーティングする方法があります：

1. **SSH接続の確立：** iproxyを使用してSSHをローカルホストに転送し、iOSデバイスからBurpを実行しているコンピュータへの接続を可能にします。

```bash
iproxy 2222 22
```

2. **リモートポートフォワーディング：** iOSデバイスのポート8080をコンピュータのローカルホストに転送し、Burpのインターフェースへの直接アクセスを有効にします。

```bash
ssh -R 8080:localhost:8080 root@localhost -p 2222
```

3. **グローバルプロキシ設定：** 最後に、iOSデバイスのWi-Fi設定を手動プロキシを使用するように設定し、すべてのウェブトラフィックをBurp経由で流します。

### フルネットワークモニタリング/スニッフィング

非HTTPデバイストラフィックのモニタリングは、すべての形式のデータトラフィックをキャプチャできるツール**Wireshark**を使用して効率的に行えます。iOSデバイスの場合、リモート仮想インターフェースの作成を通じてリアルタイムトラフィックモニタリングが可能であり、このプロセスは[このStack Overflowの投稿](https://stackoverflow.com/questions/9555403/capturing-mobile-phone-traffic-on-wireshark/33175819#33175819)で詳述されています。開始する前に、macOSシステムに**Wireshark**をインストールする必要があります。

手順は以下の重要なステップを含みます：

1. iOSデバイスとmacOSホストの間でUSB接続を開始します。
2. トラフィックモニタリングに必要なiOSデバイスの**UDID**を確認します。これはmacOSターミナルでコマンドを実行することで行えます：
```bash
$ rvictl -s <UDID>
Starting device <UDID> [SUCCEEDED] with interface rvi0
```
3. UDIDの特定後、**Wireshark**を開き、「rvi0」インターフェースを選択してデータキャプチャを行います。
4. 特定のIPアドレスに関連するHTTPトラフィックをキャプチャするなど、ターゲット監視のために、Wiresharkのキャプチャフィルターを使用できます：

## シミュレーターでのBurp証明書のインストール

- **Burp証明書のエクスポート**

_Proxy_ --> _Options_ --> _Export CA certificate_ --> _Certificate in DER format_

![](<../../images/image (534).png>)

- **証明書をエミュレーター内にドラッグアンドドロップ**
- **エミュレーター内で** _Settings_ --> _General_ --> _Profile_ --> _PortSwigger CA_に移動し、**証明書を確認**
- **エミュレーター内で** _Settings_ --> _General_ --> _About_ --> _Certificate Trust Settings_に移動し、**PortSwigger CAを有効にする**

![](<../../images/image (1048).png>)

**おめでとうございます、iOSシミュレーターにBurp CA証明書を正常に設定しました**

> [!NOTE]
> **iOSシミュレーターはMacOSのプロキシ設定を使用します。**

### MacOSプロキシ設定

Burpをプロキシとして設定する手順：

- _System Preferences_ --> _Network_ --> _Advanced_に移動
- _Proxies_タブで_ウェブプロキシ（HTTP）_と_セキュアウェブプロキシ（HTTPS）_にチェックを入れる
- 両方のオプションで_127.0.0.1:8080_を設定

![](<../../images/image (431).png>)

- _**Ok**_をクリックし、次に_**Apply**_をクリック


{{#include ../../banners/hacktricks-training.md}}
