# iOS UIActivity Sharing

{{#include ../../banners/hacktricks-training.md}}

# UIActivity Sharing Vereinfacht

Seit iOS 6 können Drittanbieteranwendungen **Daten** wie Text, URLs oder Bilder über Mechanismen wie AirDrop teilen, wie im [Inter-App Communication guide](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3) von Apple beschrieben. Diese Funktion zeigt ein systemweites _Teilen-Aktivitätsblatt_, das beim Interagieren mit der Schaltfläche "Teilen" erscheint.

Eine umfassende Auflistung aller integrierten Sharing-Optionen ist unter [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype) verfügbar. Entwickler können entscheiden, bestimmte Sharing-Optionen auszuschließen, wenn sie diese für ihre Anwendung als ungeeignet erachten.

## **Wie man Daten teilt**

Die Aufmerksamkeit sollte auf Folgendes gerichtet werden:

- Die Art der geteilten Daten.
- Die Einbeziehung benutzerdefinierter Aktivitäten.
- Der Ausschluss bestimmter Aktivitätstypen.

Das Teilen erfolgt durch die Instanziierung eines `UIActivityViewController`, dem die zum Teilen vorgesehenen Elemente übergeben werden. Dies wird erreicht durch:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Entwickler sollten den `UIActivityViewController` hinsichtlich der Aktivitäten und benutzerdefinierten Aktivitäten, mit denen er initialisiert wird, sowie der angegebenen `excludedActivityTypes` genau prüfen.

## **Wie man Daten empfängt**

Die folgenden Aspekte sind entscheidend beim Empfangen von Daten:

- Die Deklaration von **benutzerdefinierten Dokumenttypen**.
- Die Spezifikation von **Dokumenttypen, die die App öffnen kann**.
- Die Überprüfung der **Integrität der empfangenen Daten**.

Ohne Zugriff auf den Quellcode kann man dennoch die `Info.plist` auf Schlüssel wie `UTExportedTypeDeclarations`, `UTImportedTypeDeclarations` und `CFBundleDocumentTypes` überprüfen, um die Arten von Dokumenten zu verstehen, die eine App verarbeiten und deklarieren kann.

Ein prägnanter Leitfaden zu diesen Schlüsseln ist auf [Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i) verfügbar, der die Bedeutung der Definition und des Imports von UTIs für die systemweite Erkennung sowie die Zuordnung von Dokumenttypen zu Ihrer App für die Integration im Dialog "Öffnen mit" hervorhebt.

## Dynamischer Testansatz

Um **Aktivitäten zu senden**, könnte man:

- In die Methode `init(activityItems:applicationActivities:)` einhaken, um die Elemente und Aktivitäten, die geteilt werden, zu erfassen.
- Ausgeschlossene Aktivitäten identifizieren, indem man die Eigenschaft `excludedActivityTypes` abfängt.

Für **das Empfangen von Elementen** umfasst es:

- Eine Datei von einer anderen Quelle (z. B. AirDrop, E-Mail) mit der App zu teilen, die den Dialog "Öffnen mit..." auslöst.
- `application:openURL:options:` unter anderen während der statischen Analyse identifizierten Methoden abfangen, um die Reaktion der App zu beobachten.
- Fehlformatierte Dateien oder Fuzzing-Techniken einsetzen, um die Robustheit der App zu bewerten.

## Referenzen

- [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

{{#include ../../banners/hacktricks-training.md}}
