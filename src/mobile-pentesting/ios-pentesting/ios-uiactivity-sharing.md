# iOS UIActivity Sharing

{{#include ../../banners/hacktricks-training.md}}

# UIActivity Sharing Simplified

Od iOS 6, aplikacje innych firm mogą **dzielić dane** takie jak tekst, URL-e lub obrazy, korzystając z mechanizmów takich jak AirDrop, jak opisano w przewodniku Apple'a [Inter-App Communication guide](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3). Ta funkcja manifestuje się poprzez systemowy _arkusz aktywności udostępniania_, który pojawia się po interakcji z przyciskiem "Udostępnij".

Kompleksowa lista wszystkich wbudowanych opcji udostępniania jest dostępna w [UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype). Programiści mogą zdecydować się na wykluczenie określonych opcji udostępniania, jeśli uznają je za nieodpowiednie dla swojej aplikacji.

## **Jak udostępniać dane**

Należy zwrócić uwagę na:

- Charakter danych, które są udostępniane.
- Włączenie niestandardowych aktywności.
- Wykluczenie niektórych typów aktywności.

Udostępnianie jest ułatwione poprzez utworzenie `UIActivityViewController`, do którego przekazywane są elementy przeznaczone do udostępnienia. Osiąga się to poprzez wywołanie:
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Programiści powinni dokładnie przeanalizować `UIActivityViewController` pod kątem aktywności i niestandardowych aktywności, z którymi jest inicjowany, a także wszelkich określonych `excludedActivityTypes`.

## **Jak Otrzymać Dane**

Następujące aspekty są kluczowe przy odbieraniu danych:

- Deklaracja **niestandardowych typów dokumentów**.
- Określenie **typów dokumentów, które aplikacja może otworzyć**.
- Weryfikacja **integralności otrzymanych danych**.

Bez dostępu do kodu źródłowego, można nadal sprawdzić `Info.plist` pod kątem kluczy takich jak `UTExportedTypeDeclarations`, `UTImportedTypeDeclarations` i `CFBundleDocumentTypes`, aby zrozumieć, jakie typy dokumentów aplikacja może obsługiwać i deklarować.

Zwięzły przewodnik po tych kluczach jest dostępny na [Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i), podkreślając znaczenie definiowania i importowania UTI dla systemowego rozpoznawania oraz kojarzenia typów dokumentów z Twoją aplikacją w celu integracji w dialogu "Otwórz za pomocą".

## Podejście do Testowania Dynamicznego

Aby przetestować **wysyłanie aktywności**, można:

- Podłączyć się do metody `init(activityItems:applicationActivities:)`, aby przechwycić elementy i aktywności, które są udostępniane.
- Zidentyfikować wykluczone aktywności, przechwytując właściwość `excludedActivityTypes`.

W przypadku **otrzymywania elementów**, polega to na:

- Udostępnieniu pliku aplikacji z innego źródła (np. AirDrop, e-mail), co wywołuje dialog "Otwórz za pomocą...".
- Podłączeniu `application:openURL:options:` wśród innych metod zidentyfikowanych podczas analizy statycznej, aby obserwować reakcję aplikacji.
- Wykorzystaniu źle sformatowanych plików lub technik fuzzingowych do oceny odporności aplikacji.

## Odniesienia

- [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

{{#include ../../banners/hacktricks-training.md}}
