# iOS Test Ortamı

{{#include ../../banners/hacktricks-training.md}}

## Apple Geliştirici Programı

Bir **provisioning identity**, bir Apple geliştirici hesabıyla ilişkili olan bir dizi genel ve özel anahtardır. **Uygulamaları imzalamak** için **99$/yıl** ödeyerek **Apple Geliştirici Programı**'na kaydolmanız gerekir. Bunu yapmadan, kaynak kodundan uygulamaları fiziksel bir cihazda çalıştıramazsınız. Bunu yapmanın bir diğer seçeneği ise **jailbroken bir cihaz** kullanmaktır.

Xcode 7.2 ile birlikte Apple, gerçek bir iPhone'da uygulamanızı yazmanıza ve test etmenize olanak tanıyan **ücretsiz bir iOS geliştirme provisioning profili** oluşturma seçeneği sunmuştur. _Xcode_ --> _Preferences_ --> _Accounts_ --> _+_ (Kimlik bilgilerinizi ekleyin) --> _Oluşturulan Apple ID'ye tıklayın_ --> _Manage Certificates_ --> _+_ (Apple Development) --> _Done_\
\_\_Daha sonra, uygulamanızı iPhone'unuzda çalıştırmak için önce **iPhone'un bilgisayarı güvenilir olarak göstermesini sağlamalısınız.** Ardından, **Xcode'dan mobil uygulamayı çalıştırmayı deneyebilirsiniz,** ancak bir hata görünecektir. Bu nedenle _Ayarlar_ --> _Genel_ --> _Profiller ve Cihaz Yönetimi_ --> Güvenilmeyen profili seçin ve "**Güven**"e tıklayın.

**Aynı imzalama sertifikasıyla imzalanmış uygulamaların güvenli bir şekilde kaynak paylaşabileceğini** unutmayın, örneğin anahtar zinciri öğeleri gibi.

Provisioning profilleri telefonun içinde **`/Library/MobileDevice/ProvisioningProfiles`** dizininde saklanır.

## **Simülatör**

> [!NOTE]
> Bir **simülatörün emülatörle aynı olmadığını** unutmayın. Simülatör, cihazın davranışını ve işlevlerini simüle eder, ancak bunları gerçekten kullanmaz.

### **Simülatör**

Bilmeniz gereken ilk şey, **simülatör içinde bir pentest gerçekleştirmenin, jailbreak yapılmış bir cihazda yapmaktan çok daha sınırlı olacağıdır**.

Bir iOS uygulaması oluşturmak ve desteklemek için gereken tüm araçlar **sadece resmi olarak Mac OS'ta desteklenmektedir**.\
Apple'ın iOS uygulamalarını oluşturmak/hata ayıklamak/ölçümlemek için de facto aracı **Xcode**'dur. Uygulamanızı oluşturmak ve **test** etmek için gereken diğer bileşenleri, örneğin **simülatörler** ve farklı **SDK** **sürümlerini** indirmek için kullanılabilir.\
Xcode'u **resmi uygulama mağazasından indirmek** şiddetle tavsiye edilir. Diğer sürümler kötü amaçlı yazılım içerebilir.

Simülatör dosyaları `/Users/<username>/Library/Developer/CoreSimulator/Devices` dizininde bulunabilir.

Simülatörü açmak için Xcode'u çalıştırın, ardından _Xcode sekmesine_ tıklayın --> _Geliştirici araçlarını aç_ --> _Simülatör_\
\_\_Aşağıdaki resimde "iPod touch \[...\]" üzerine tıklayarak test etmek için başka bir cihaz seçebilirsiniz:

![](<../../images/image (270).png>)

![](<../../images/image (520).png>)

### Simülatördeki Uygulamalar

`/Users/<username>/Library/Developer/CoreSimulator/Devices` içinde tüm **kurulu simülatörleri** bulabilirsiniz. Emülatörlerden birinde oluşturulmuş bir uygulamanın dosyalarına erişmek istiyorsanız, **uygulamanın hangi emülatörde kurulu olduğunu bilmek zor olabilir**. Doğru UID'yi **bulmanın hızlı bir yolu**, simülatörde uygulamayı çalıştırmak ve şunu yürütmektir:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Bir UID'yi bildiğinizde, içindeki yüklü uygulamaları `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application` yolunda bulabilirsiniz.

Ancak, şaşırtıcı bir şekilde burada uygulamayı bulamayacaksınız. `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/` yoluna erişmeniz gerekiyor.

Ve bu klasörde **uygulamanın paketini bulabilirsiniz.**

## Emulator

Corellium, kamuya açık tek iOS emülatörüdür. Bu, kullanıcı başına lisans modeli ile bir kurumsal SaaS çözümüdür ve deneme lisansı sunmamaktadır.

## Jailbreak Gerekmez

**Jailbreak yapılmamış bir cihazda** bir iOS uygulamasını nasıl pentest edeceğinizi anlatan bu blog yazısını kontrol edin: [https://dvuln.com/blog/modern-ios-pentesting-no-jailbreak-needed](https://dvuln.com/blog/modern-ios-pentesting-no-jailbreak-needed)

## Jailbreaking

Apple, iPhone'da çalışan kodun **Apple tarafından verilen bir sertifika ile imzalanmasını** kesinlikle gerektirir. **Jailbreaking**, bu tür kısıtlamaları ve işletim sistemi tarafından konulan diğer güvenlik kontrollerini **aşma** sürecidir. Bu nedenle, cihaz jailbreak yapıldığında, uygulamaların yüklenmesini kontrol eden **bütünlük kontrolü** yamanır, böylece **bypass edilir**.

> [!NOTE]
> Android'in aksine, iOS'ta **imzasız/güvenilmeyen kodu çalıştırmak için "Geliştirici Modu"na geçemezsiniz.**

### Android Rooting vs. iOS Jailbreaking

Sıklıkla karşılaştırılsa da, Android'de **rooting** ve iOS'ta **jailbreaking** temelde farklı süreçlerdir. Android cihazlarda **`su` ikili dosyasını yüklemek** veya **sistemi köklü bir özel ROM ile değiştirmek** gibi işlemler, bootloader kilidi açıldığında mutlaka istismar gerektirmeyebilir. **Özel ROM'ların yüklenmesi**, bootloader kilidi açıldıktan sonra cihazın işletim sistemini değiştirir ve bazen bir istismar gerektirebilir.

Buna karşılık, iOS cihazları, bootloader'ın yalnızca Apple imzalı görüntüleri başlatmasına izin vermesi nedeniyle özel ROM'ları yükleyemez. **iOS'u jailbreak yapmak**, imzasız kod çalıştırmak için Apple'ın kod imzalama korumalarını aşmayı hedefler; bu süreç, Apple'ın sürekli güvenlik iyileştirmeleriyle karmaşıklaşır.

### Jailbreaking Zorlukları

iOS'u jailbreak yapmak, Apple'ın güvenlik açıklarını hızla yamalaması nedeniyle giderek zorlaşmaktadır. **iOS'u düşürmek**, bir sürümden sonra sınırlı bir süre için mümkündür, bu da jailbreak yapmayı zaman açısından hassas bir mesele haline getirir. Güvenlik testi için kullanılan cihazlar, yeniden jailbreak yapılması garanti edilmedikçe güncellenmemelidir.

iOS güncellemeleri, yalnızca Apple imzalı yanıtlar için yüklemeye izin veren bir **challenge-response mekanizması** (SHSH blobları) ile kontrol edilir. "İmzalama penceresi" olarak bilinen bu mekanizma, OTA firmware paketlerini depolama ve daha sonra kullanma yeteneğini sınırlar. [IPSW Downloads web sitesi](https://ipsw.me), mevcut imzalama pencerelerini kontrol etmek için bir kaynaktır.

### Jailbreak Çeşitleri

- **Tethered jailbreak** her yeniden başlatma için bir bilgisayar bağlantısı gerektirir.
- **Semi-tethered jailbreak** bilgisayar olmadan jailbreak yapılmamış moda geçişe izin verir.
- **Semi-untethered jailbreak** bilgisayar gerektirmeden manuel yeniden jailbreak yapmayı gerektirir.
- **Untethered jailbreak** yeniden uygulama gerektirmeden kalıcı bir jailbreak çözümü sunar.

### Jailbreaking Araçları ve Kaynakları

Jailbreaking araçları, iOS sürümüne ve cihaza göre değişir. [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) ve [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) gibi kaynaklar güncel bilgiler sağlar. Örnekler:

- A7-A11 çipli cihazlar için [Checkra1n](https://checkra.in/).
- iOS 15.0-16.5'te Checkm8 cihazları için [Palera1n](https://palera.in/).
- iOS sürümleri için 14.8'e kadar [Unc0ver](https://unc0ver.dev/).

Cihazınızı değiştirmek risk taşır ve jailbreak yaparken dikkatli olunmalıdır.

### Jailbreaking Faydaları ve Riskleri

Jailbreaking, **OS tarafından dayatılan sandboxing'i kaldırır**, uygulamaların tüm dosya sistemine erişmesine izin verir. Bu özgürlük, onaylanmamış uygulamaların yüklenmesini ve daha fazla API'ye erişimi sağlar. Ancak, normal kullanıcılar için jailbreak yapmak **tavsiye edilmez** çünkü potansiyel güvenlik riskleri ve cihaz kararsızlığı vardır.

### **Jailbreaking Sonrası**

{{#ref}}
basic-ios-testing-operations.md
{{#endref}}

### **Jailbreak Tespiti**

**Birçok uygulama, mobil cihazın jailbreak yapılıp yapılmadığını tespit etmeye çalışacak ve bu durumda uygulama çalışmayacaktır.**

- Jailbreak yapıldıktan sonra iOS'ta **dosyalar ve klasörler genellikle yüklenir**, bu dosyalar cihazın jailbreak yapılıp yapılmadığını belirlemek için aranabilir.
- Jailbreak yapılmış bir cihazda uygulamalar, sandbox dışındaki yeni dosyalara **okuma/yazma erişimi** alır.
- Bazı **API** **çağrıları** **farklı davranacaktır.**
- **OpenSSH** hizmetinin varlığı.
- `/bin/sh` çağrısı **0 yerine 1** döndürecektir.

**Jailbreaking'i tespit etme hakkında daha fazla bilgi** [**burada**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Bu tespitlerden kaçınmak için **objection'ın** `ios jailbreak disable` komutunu kullanmayı deneyebilirsiniz.

## **Jailbreak Tespiti Bypass**

- Bu tespitlerden kaçınmak için **objection'ın** `ios jailbreak disable` komutunu kullanmayı deneyebilirsiniz.
- Ayrıca **Liberty Lite** (https://ryleyangus.com/repo/) aracını yükleyebilirsiniz. Repo eklendikten sonra uygulama 'Arama' sekmesinde görünmelidir.

## Referanslar

- [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)

{{#include ../../banners/hacktricks-training.md}}
