# Firmware Analysis

{{#include ../../banners/hacktricks-training.md}}

## **Introduction**

å›ºä»¶æ˜¯ä½¿è®¾å¤‡æ­£å¸¸è¿è¡Œçš„åŸºæœ¬è½¯ä»¶ï¼Œé€šè¿‡ç®¡ç†å’Œä¿ƒè¿›ç¡¬ä»¶ç»„ä»¶ä¸ç”¨æˆ·äº¤äº’çš„è½¯ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚å®ƒå­˜å‚¨åœ¨æ°¸ä¹…å†…å­˜ä¸­ï¼Œç¡®ä¿è®¾å¤‡åœ¨å¼€æœºæ—¶èƒ½å¤Ÿè®¿é—®é‡è¦æŒ‡ä»¤ï¼Œä»è€Œå¯åŠ¨æ“ä½œç³»ç»Ÿã€‚æ£€æŸ¥å’Œå¯èƒ½ä¿®æ”¹å›ºä»¶æ˜¯è¯†åˆ«å®‰å…¨æ¼æ´çš„å…³é”®æ­¥éª¤ã€‚

## **Gathering Information**

**æ”¶é›†ä¿¡æ¯**æ˜¯ç†è§£è®¾å¤‡æ„æˆå’Œæ‰€ä½¿ç”¨æŠ€æœ¯çš„å…³é”®åˆæ­¥æ­¥éª¤ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠæ”¶é›†ä»¥ä¸‹æ•°æ®ï¼š

- CPUæ¶æ„å’Œè¿è¡Œçš„æ“ä½œç³»ç»Ÿ
- å¼•å¯¼åŠ è½½ç¨‹åºçš„å…·ä½“ä¿¡æ¯
- ç¡¬ä»¶å¸ƒå±€å’Œæ•°æ®è¡¨
- ä»£ç åº“æŒ‡æ ‡å’Œæºä½ç½®
- å¤–éƒ¨åº“å’Œè®¸å¯è¯ç±»å‹
- æ›´æ–°å†å²å’Œç›‘ç®¡è®¤è¯
- æ¶æ„å’Œæµç¨‹å›¾
- å®‰å…¨è¯„ä¼°å’Œå·²è¯†åˆ«çš„æ¼æ´

ä¸ºæ­¤ï¼Œ**å¼€æºæƒ…æŠ¥ï¼ˆOSINTï¼‰**å·¥å…·æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼ŒåŒæ—¶é€šè¿‡æ‰‹åŠ¨å’Œè‡ªåŠ¨å®¡æŸ¥è¿‡ç¨‹åˆ†æä»»ä½•å¯ç”¨çš„å¼€æºè½¯ä»¶ç»„ä»¶ä¹Ÿå¾ˆé‡è¦ã€‚åƒ[Coverity Scan](https://scan.coverity.com)å’Œ[Semmleâ€™s LGTM](https://lgtm.com/#explore)è¿™æ ·çš„å·¥å…·æä¾›å…è´¹çš„é™æ€åˆ†æï¼Œå¯ä»¥ç”¨æ¥å‘ç°æ½œåœ¨é—®é¢˜ã€‚

## **Acquiring the Firmware**

è·å–å›ºä»¶å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œï¼Œæ¯ç§æ–¹å¼çš„å¤æ‚ç¨‹åº¦ä¸åŒï¼š

- **ç›´æ¥**ä»æºå¤´ï¼ˆå¼€å‘è€…ã€åˆ¶é€ å•†ï¼‰
- **æ ¹æ®**æä¾›çš„è¯´æ˜**æ„å»º**
- **ä»**å®˜æ–¹æ”¯æŒç½‘ç«™**ä¸‹è½½**
- åˆ©ç”¨**Google dork**æŸ¥è¯¢æŸ¥æ‰¾æ‰˜ç®¡çš„å›ºä»¶æ–‡ä»¶
- ç›´æ¥è®¿é—®**äº‘å­˜å‚¨**ï¼Œä½¿ç”¨åƒ[S3Scanner](https://github.com/sa7mon/S3Scanner)è¿™æ ·çš„å·¥å…·
- é€šè¿‡ä¸­é—´äººæŠ€æœ¯**æ‹¦æˆª**æ›´æ–°
- é€šè¿‡**UART**ã€**JTAG**æˆ–**PICit**ç­‰è¿æ¥**æå–**è®¾å¤‡ä¸­çš„å›ºä»¶
- åœ¨è®¾å¤‡é€šä¿¡ä¸­**å—…æ¢**æ›´æ–°è¯·æ±‚
- è¯†åˆ«å¹¶ä½¿ç”¨**ç¡¬ç¼–ç çš„æ›´æ–°ç«¯ç‚¹**
- ä»å¼•å¯¼åŠ è½½ç¨‹åºæˆ–ç½‘ç»œ**è½¬å‚¨**
- åœ¨æ‰€æœ‰å…¶ä»–æ–¹æ³•å¤±è´¥æ—¶ï¼Œ**æ‹†å¸å¹¶è¯»å–**å­˜å‚¨èŠ¯ç‰‡ï¼Œä½¿ç”¨é€‚å½“çš„ç¡¬ä»¶å·¥å…·

## Analyzing the firmware

ç°åœ¨ä½ **æ‹¥æœ‰å›ºä»¶**ï¼Œä½ éœ€è¦æå–æœ‰å…³å®ƒçš„ä¿¡æ¯ï¼Œä»¥äº†è§£å¦‚ä½•å¤„ç†å®ƒã€‚ä½ å¯ä»¥ä½¿ç”¨çš„ä¸åŒå·¥å…·æœ‰ï¼š
```bash
file <bin>
strings -n8 <bin>
strings -tx <bin> #print offsets in hex
hexdump -C -n 512 <bin> > hexdump.out
hexdump -C <bin> | head # might find signatures in header
fdisk -lu <bin> #lists a drives partition and filesystems if multiple
```
å¦‚æœä½ ä½¿ç”¨è¿™äº›å·¥å…·æ²¡æœ‰æ‰¾åˆ°å¤ªå¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ `binwalk -E <bin>` æ£€æŸ¥å›¾åƒçš„ **entropy**ï¼Œå¦‚æœç†µä½ï¼Œé‚£ä¹ˆå®ƒä¸å¤ªå¯èƒ½è¢«åŠ å¯†ã€‚å¦‚æœç†µé«˜ï¼Œåˆ™å¾ˆå¯èƒ½è¢«åŠ å¯†ï¼ˆæˆ–ä»¥æŸç§æ–¹å¼å‹ç¼©ï¼‰ã€‚

æ­¤å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æå– **åµŒå…¥å›ºä»¶ä¸­çš„æ–‡ä»¶**ï¼š

{{#ref}}
../../generic-methodologies-and-resources/basic-forensic-methodology/partitions-file-systems-carving/file-data-carving-recovery-tools.md
{{#endref}}

æˆ–è€… [**binvis.io**](https://binvis.io/#/) ([code](https://code.google.com/archive/p/binvis/)) æ¥æ£€æŸ¥æ–‡ä»¶ã€‚

### è·å–æ–‡ä»¶ç³»ç»Ÿ

ä½¿ç”¨ä¹‹å‰æåˆ°çš„å·¥å…·ï¼Œå¦‚ `binwalk -ev <bin>`ï¼Œä½ åº”è¯¥èƒ½å¤Ÿ **æå–æ–‡ä»¶ç³»ç»Ÿ**ã€‚\
Binwalk é€šå¸¸ä¼šå°†å…¶æå–åˆ°ä¸€ä¸ª **ä»¥æ–‡ä»¶ç³»ç»Ÿç±»å‹å‘½åçš„æ–‡ä»¶å¤¹** ä¸­ï¼Œé€šå¸¸æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼šsquashfs, ubifs, romfs, rootfs, jffs2, yaffs2, cramfs, initramfsã€‚

#### æ‰‹åŠ¨æ–‡ä»¶ç³»ç»Ÿæå–

æœ‰æ—¶ï¼Œbinwalk **åœ¨å…¶ç­¾åä¸­æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é­”æœ¯å­—èŠ‚**ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ binwalk **æŸ¥æ‰¾æ–‡ä»¶ç³»ç»Ÿçš„åç§»é‡å¹¶ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åˆ‡å‰²å‹ç¼©çš„æ–‡ä»¶ç³»ç»Ÿ**ï¼Œå¹¶æ ¹æ®å…¶ç±»å‹ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ **æ‰‹åŠ¨æå–** æ–‡ä»¶ç³»ç»Ÿã€‚
```
$ binwalk DIR850L_REVB.bin

DECIMAL HEXADECIMAL DESCRIPTION
----------------------------------------------------------------------------- ---

0 0x0 DLOB firmware header, boot partition: """"dev=/dev/mtdblock/1""""
10380 0x288C LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 5213748 bytes
1704052 0x1A0074 PackImg section delimiter tag, little endian size: 32256 bytes; big endian size: 8257536 bytes
1704084 0x1A0094 Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 8256900 bytes, 2688 inodes, blocksize: 131072 bytes, created: 2016-07-12 02:28:41
```
è¿è¡Œä»¥ä¸‹ **dd å‘½ä»¤** åˆ‡å‰² Squashfs æ–‡ä»¶ç³»ç»Ÿã€‚
```
$ dd if=DIR850L_REVB.bin bs=1 skip=1704084 of=dir.squashfs

8257536+0 records in

8257536+0 records out

8257536 bytes (8.3 MB, 7.9 MiB) copied, 12.5777 s, 657 kB/s
```
å¦å¤–ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

`$ dd if=DIR850L_REVB.bin bs=1 skip=$((0x1A0094)) of=dir.squashfs`

- å¯¹äº squashfsï¼ˆåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ä½¿ç”¨ï¼‰

`$ unsquashfs dir.squashfs`

æ–‡ä»¶å°†éšåä½äº "`squashfs-root`" ç›®å½•ä¸­ã€‚

- CPIO å­˜æ¡£æ–‡ä»¶

`$ cpio -ivd --no-absolute-filenames -F <bin>`

- å¯¹äº jffs2 æ–‡ä»¶ç³»ç»Ÿ

`$ jefferson rootfsfile.jffs2`

- å¯¹äºå¸¦æœ‰ NAND é—ªå­˜çš„ ubifs æ–‡ä»¶ç³»ç»Ÿ

`$ ubireader_extract_images -u UBI -s <start_offset> <bin>`

`$ ubidump.py <bin>`

## åˆ†æå›ºä»¶

ä¸€æ—¦è·å¾—å›ºä»¶ï¼Œæ‹†è§£å®ƒä»¥ç†è§£å…¶ç»“æ„å’Œæ½œåœ¨æ¼æ´æ˜¯è‡³å…³é‡è¦çš„ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠåˆ©ç”¨å„ç§å·¥å…·åˆ†æå’Œæå–å›ºä»¶æ˜ åƒä¸­çš„æœ‰ä»·å€¼æ•°æ®ã€‚

### åˆæ­¥åˆ†æå·¥å…·

æä¾›äº†ä¸€ç»„å‘½ä»¤ç”¨äºå¯¹äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆç§°ä¸º `<bin>`ï¼‰è¿›è¡Œåˆæ­¥æ£€æŸ¥ã€‚è¿™äº›å‘½ä»¤æœ‰åŠ©äºè¯†åˆ«æ–‡ä»¶ç±»å‹ã€æå–å­—ç¬¦ä¸²ã€åˆ†æäºŒè¿›åˆ¶æ•°æ®ä»¥åŠç†è§£åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿçš„ç»†èŠ‚ï¼š
```bash
file <bin>
strings -n8 <bin>
strings -tx <bin> #prints offsets in hexadecimal
hexdump -C -n 512 <bin> > hexdump.out
hexdump -C <bin> | head #useful for finding signatures in the header
fdisk -lu <bin> #lists partitions and filesystems, if there are multiple
```
ä¸ºäº†è¯„ä¼°å›¾åƒçš„åŠ å¯†çŠ¶æ€ï¼Œä½¿ç”¨ `binwalk -E <bin>` æ£€æŸ¥ **entropy**ã€‚ä½ç†µè¡¨æ˜ç¼ºä¹åŠ å¯†ï¼Œè€Œé«˜ç†µåˆ™è¡¨ç¤ºå¯èƒ½å­˜åœ¨åŠ å¯†æˆ–å‹ç¼©ã€‚

å¯¹äºæå– **embedded files**ï¼Œæ¨èä½¿ç”¨ **file-data-carving-recovery-tools** æ–‡æ¡£å’Œ **binvis.io** è¿›è¡Œæ–‡ä»¶æ£€æŸ¥ã€‚

### æå–æ–‡ä»¶ç³»ç»Ÿ

ä½¿ç”¨ `binwalk -ev <bin>`ï¼Œé€šå¸¸å¯ä»¥æå–æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸æå–åˆ°ä¸€ä¸ªä»¥æ–‡ä»¶ç³»ç»Ÿç±»å‹å‘½åçš„ç›®å½•ä¸­ï¼ˆä¾‹å¦‚ï¼Œsquashfsï¼Œubifsï¼‰ã€‚ç„¶è€Œï¼Œå½“ **binwalk** ç”±äºç¼ºå°‘é­”æœ¯å­—èŠ‚è€Œæ— æ³•è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿç±»å‹æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æå–ã€‚è¿™æ¶‰åŠä½¿ç”¨ `binwalk` å®šä½æ–‡ä»¶ç³»ç»Ÿçš„åç§»é‡ï¼Œç„¶åä½¿ç”¨ `dd` å‘½ä»¤æå–æ–‡ä»¶ç³»ç»Ÿï¼š
```bash
$ binwalk DIR850L_REVB.bin

$ dd if=DIR850L_REVB.bin bs=1 skip=1704084 of=dir.squashfs
```
ä¹‹åï¼Œæ ¹æ®æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ï¼Œsquashfsã€cpioã€jffs2ã€ubifsï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„å‘½ä»¤æ‰‹åŠ¨æå–å†…å®¹ã€‚

### æ–‡ä»¶ç³»ç»Ÿåˆ†æ

æå–æ–‡ä»¶ç³»ç»Ÿåï¼Œå¼€å§‹å¯»æ‰¾å®‰å…¨æ¼æ´ã€‚é‡ç‚¹å…³æ³¨ä¸å®‰å…¨çš„ç½‘ç»œå®ˆæŠ¤è¿›ç¨‹ã€ç¡¬ç¼–ç çš„å‡­æ®ã€API ç«¯ç‚¹ã€æ›´æ–°æœåŠ¡å™¨åŠŸèƒ½ã€æœªç¼–è¯‘çš„ä»£ç ã€å¯åŠ¨è„šæœ¬å’Œç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥è¿›è¡Œç¦»çº¿åˆ†æã€‚

**å…³é”®ä½ç½®**å’Œ**é¡¹ç›®**æ£€æŸ¥åŒ…æ‹¬ï¼š

- **etc/shadow** å’Œ **etc/passwd** ä¸­çš„ç”¨æˆ·å‡­æ®
- **etc/ssl** ä¸­çš„ SSL è¯ä¹¦å’Œå¯†é’¥
- é…ç½®å’Œè„šæœ¬æ–‡ä»¶ä¸­çš„æ½œåœ¨æ¼æ´
- åµŒå…¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æ
- å¸¸è§ IoT è®¾å¤‡çš„ç½‘ç»œæœåŠ¡å™¨å’ŒäºŒè¿›åˆ¶æ–‡ä»¶

å¤šä¸ªå·¥å…·æœ‰åŠ©äºæ­ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•æ„Ÿä¿¡æ¯å’Œæ¼æ´ï¼š

- [**LinPEAS**](https://github.com/carlospolop/PEASS-ng) å’Œ [**Firmwalker**](https://github.com/craigz28/firmwalker) ç”¨äºæ•æ„Ÿä¿¡æ¯æœç´¢
- [**å›ºä»¶åˆ†æå’Œæ¯”è¾ƒå·¥å…· (FACT)**](https://github.com/fkie-cad/FACT_core) ç”¨äºå…¨é¢çš„å›ºä»¶åˆ†æ
- [**FwAnalyzer**](https://github.com/cruise-automation/fwanalyzer)ã€[**ByteSweep**](https://gitlab.com/bytesweep/bytesweep)ã€[**ByteSweep-go**](https://gitlab.com/bytesweep/bytesweep-go) å’Œ [**EMBA**](https://github.com/e-m-b-a/emba) ç”¨äºé™æ€å’ŒåŠ¨æ€åˆ†æ

### å¯¹ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶çš„å®‰å…¨æ£€æŸ¥

å¿…é¡»ä»”ç»†æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä¸­å‘ç°çš„æºä»£ç å’Œç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥å¯»æ‰¾æ¼æ´ã€‚åƒ **checksec.sh** è¿™æ ·çš„å·¥å…·ç”¨äº Unix äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ**PESecurity** ç”¨äº Windows äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¸®åŠ©è¯†åˆ«å¯èƒ½è¢«åˆ©ç”¨çš„æœªä¿æŠ¤äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

## æ¨¡æ‹Ÿå›ºä»¶è¿›è¡ŒåŠ¨æ€åˆ†æ

æ¨¡æ‹Ÿå›ºä»¶çš„è¿‡ç¨‹ä½¿å¾—èƒ½å¤Ÿå¯¹è®¾å¤‡çš„æ“ä½œæˆ–å•ä¸ªç¨‹åºè¿›è¡Œ**åŠ¨æ€åˆ†æ**ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¼šé‡åˆ°ç¡¬ä»¶æˆ–æ¶æ„ä¾èµ–æ€§çš„é—®é¢˜ï¼Œä½†å°†æ ¹æ–‡ä»¶ç³»ç»Ÿæˆ–ç‰¹å®šäºŒè¿›åˆ¶æ–‡ä»¶è½¬ç§»åˆ°å…·æœ‰åŒ¹é…æ¶æ„å’Œå­—èŠ‚åºçš„è®¾å¤‡ï¼ˆå¦‚ Raspberry Piï¼‰æˆ–é¢„æ„å»ºçš„è™šæ‹Ÿæœºä¸Šï¼Œå¯ä»¥ä¿ƒè¿›è¿›ä¸€æ­¥çš„æµ‹è¯•ã€‚

### æ¨¡æ‹Ÿå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶

åœ¨æ£€æŸ¥å•ä¸ªç¨‹åºæ—¶ï¼Œè¯†åˆ«ç¨‹åºçš„å­—èŠ‚åºå’Œ CPU æ¶æ„è‡³å…³é‡è¦ã€‚

#### MIPS æ¶æ„ç¤ºä¾‹

è¦æ¨¡æ‹Ÿ MIPS æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
file ./squashfs-root/bin/busybox
```
å¹¶å®‰è£…å¿…è¦çš„ä»¿çœŸå·¥å…·ï¼š
```bash
sudo apt-get install qemu qemu-user qemu-user-static qemu-system-arm qemu-system-mips qemu-system-x86 qemu-utils
```
å¯¹äº MIPSï¼ˆå¤§ç«¯ï¼‰ï¼Œä½¿ç”¨ `qemu-mips`ï¼Œè€Œå¯¹äºå°ç«¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€‰æ‹© `qemu-mipsel`ã€‚

#### ARM æ¶æ„ä»¿çœŸ

å¯¹äº ARM äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿‡ç¨‹ç±»ä¼¼ï¼Œä½¿ç”¨ `qemu-arm` æ¨¡æ‹Ÿå™¨è¿›è¡Œä»¿çœŸã€‚

### å®Œæ•´ç³»ç»Ÿä»¿çœŸ

åƒ [Firmadyne](https://github.com/firmadyne/firmadyne)ã€[Firmware Analysis Toolkit](https://github.com/attify/firmware-analysis-toolkit) ç­‰å·¥å…·ï¼Œä¿ƒè¿›å®Œæ•´å›ºä»¶ä»¿çœŸï¼Œè‡ªåŠ¨åŒ–è¿‡ç¨‹å¹¶å¸®åŠ©åŠ¨æ€åˆ†æã€‚

## å®è·µä¸­çš„åŠ¨æ€åˆ†æ

åœ¨æ­¤é˜¶æ®µï¼Œä½¿ç”¨çœŸå®æˆ–ä»¿çœŸçš„è®¾å¤‡ç¯å¢ƒè¿›è¡Œåˆ†æã€‚ä¿æŒå¯¹æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„ shell è®¿é—®è‡³å…³é‡è¦ã€‚ä»¿çœŸå¯èƒ½æ— æ³•å®Œç¾æ¨¡æ‹Ÿç¡¬ä»¶äº¤äº’ï¼Œå› æ­¤éœ€è¦å¶å°”é‡æ–°å¯åŠ¨ä»¿çœŸã€‚åˆ†æåº”é‡æ–°è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ©ç”¨æš´éœ²çš„ç½‘é¡µå’Œç½‘ç»œæœåŠ¡ï¼Œå¹¶æ¢ç´¢å¼•å¯¼åŠ è½½ç¨‹åºæ¼æ´ã€‚å›ºä»¶å®Œæ•´æ€§æµ‹è¯•å¯¹äºè¯†åˆ«æ½œåœ¨åé—¨æ¼æ´è‡³å…³é‡è¦ã€‚

## è¿è¡Œæ—¶åˆ†ææŠ€æœ¯

è¿è¡Œæ—¶åˆ†ææ¶‰åŠåœ¨å…¶æ“ä½œç¯å¢ƒä¸­ä¸è¿›ç¨‹æˆ–äºŒè¿›åˆ¶æ–‡ä»¶äº¤äº’ï¼Œä½¿ç”¨ gdb-multiarchã€Frida å’Œ Ghidra ç­‰å·¥å…·è®¾ç½®æ–­ç‚¹ï¼Œå¹¶é€šè¿‡æ¨¡ç³Šæµ‹è¯•å’Œå…¶ä»–æŠ€æœ¯è¯†åˆ«æ¼æ´ã€‚

## äºŒè¿›åˆ¶åˆ©ç”¨å’Œæ¦‚å¿µéªŒè¯

ä¸ºè¯†åˆ«çš„æ¼æ´å¼€å‘ PoC éœ€è¦å¯¹ç›®æ ‡æ¶æ„å’Œä½çº§è¯­è¨€ç¼–ç¨‹æœ‰æ·±å…¥ç†è§£ã€‚åµŒå…¥å¼ç³»ç»Ÿä¸­çš„äºŒè¿›åˆ¶è¿è¡Œæ—¶ä¿æŠ¤å¾ˆå°‘è§ï¼Œä½†å¦‚æœå­˜åœ¨ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å¦‚è¿”å›å¯¼å‘ç¼–ç¨‹ï¼ˆROPï¼‰ç­‰æŠ€æœ¯ã€‚

## å‡†å¤‡å¥½çš„æ“ä½œç³»ç»Ÿç”¨äºå›ºä»¶åˆ†æ

åƒ [AttifyOS](https://github.com/adi0x90/attifyos) å’Œ [EmbedOS](https://github.com/scriptingxss/EmbedOS) è¿™æ ·çš„æ“ä½œç³»ç»Ÿæä¾›é¢„é…ç½®çš„å›ºä»¶å®‰å…¨æµ‹è¯•ç¯å¢ƒï¼Œé…å¤‡å¿…è¦çš„å·¥å…·ã€‚

## å‡†å¤‡å¥½çš„æ“ä½œç³»ç»Ÿåˆ†æå›ºä»¶

- [**AttifyOS**](https://github.com/adi0x90/attifyos)ï¼šAttifyOS æ˜¯ä¸€ä¸ªæ—¨åœ¨å¸®åŠ©æ‚¨å¯¹ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡è¿›è¡Œå®‰å…¨è¯„ä¼°å’Œæ¸—é€æµ‹è¯•çš„å‘è¡Œç‰ˆã€‚å®ƒé€šè¿‡æä¾›ä¸€ä¸ªé¢„é…ç½®çš„ç¯å¢ƒï¼ŒåŠ è½½æ‰€æœ‰å¿…è¦çš„å·¥å…·ï¼ŒèŠ‚çœäº†æ‚¨å¤§é‡æ—¶é—´ã€‚
- [**EmbedOS**](https://github.com/scriptingxss/EmbedOS)ï¼šåŸºäº Ubuntu 18.04 çš„åµŒå…¥å¼å®‰å…¨æµ‹è¯•æ“ä½œç³»ç»Ÿï¼Œé¢„è£…å›ºä»¶å®‰å…¨æµ‹è¯•å·¥å…·ã€‚

## å›ºä»¶é™çº§æ”»å‡»ä¸ä¸å®‰å…¨çš„æ›´æ–°æœºåˆ¶

å³ä½¿ä¾›åº”å•†å¯¹å›ºä»¶é•œåƒå®æ–½äº†åŠ å¯†ç­¾åæ£€æŸ¥ï¼Œ**ç‰ˆæœ¬å›æ»šï¼ˆé™çº§ï¼‰ä¿æŠ¤é€šå¸¸è¢«çœç•¥**ã€‚å½“å¼•å¯¼æˆ–æ¢å¤åŠ è½½ç¨‹åºä»…ä½¿ç”¨åµŒå…¥çš„å…¬é’¥éªŒè¯ç­¾åï¼Œä½†ä¸æ¯”è¾ƒæ­£åœ¨é—ªå­˜çš„é•œåƒçš„ *ç‰ˆæœ¬*ï¼ˆæˆ–å•è°ƒè®¡æ•°å™¨ï¼‰æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆæ³•åœ°å®‰è£…ä¸€ä¸ª **è¾ƒæ—§çš„ã€ä»ç„¶å…·æœ‰æœ‰æ•ˆç­¾åçš„æ˜“å—æ”»å‡»çš„å›ºä»¶**ï¼Œä»è€Œé‡æ–°å¼•å…¥å·²ä¿®è¡¥çš„æ¼æ´ã€‚

å…¸å‹æ”»å‡»å·¥ä½œæµç¨‹ï¼š

1. **è·å–è¾ƒæ—§çš„ç­¾åé•œåƒ**
   * ä»ä¾›åº”å•†çš„å…¬å…±ä¸‹è½½é—¨æˆ·ã€CDN æˆ–æ”¯æŒç½‘ç«™è·å–ã€‚
   * ä»ä¼´éšçš„ç§»åŠ¨/æ¡Œé¢åº”ç”¨ç¨‹åºä¸­æå–ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Android APK çš„ `assets/firmware/` ä¸­ï¼‰ã€‚
   * ä»ç¬¬ä¸‰æ–¹å­˜å‚¨åº“å¦‚ VirusTotalã€äº’è”ç½‘æ¡£æ¡ˆã€è®ºå›ç­‰è·å–ã€‚
2. **é€šè¿‡ä»»ä½•æš´éœ²çš„æ›´æ–°é€šé“å°†é•œåƒä¸Šä¼ æˆ–æä¾›ç»™è®¾å¤‡**ï¼š
   * Web UIã€ç§»åŠ¨åº”ç”¨ APIã€USBã€TFTPã€MQTT ç­‰ã€‚
   * è®¸å¤šæ¶ˆè´¹ç±» IoT è®¾å¤‡æš´éœ² *æœªè®¤è¯* çš„ HTTP(S) ç«¯ç‚¹ï¼Œæ¥å— Base64 ç¼–ç çš„å›ºä»¶å—ï¼ŒæœåŠ¡å™¨ç«¯è§£ç å¹¶è§¦å‘æ¢å¤/å‡çº§ã€‚
3. é™çº§åï¼Œåˆ©ç”¨åœ¨æ–°ç‰ˆæœ¬ä¸­ä¿®è¡¥çš„æ¼æ´ï¼ˆä¾‹å¦‚ï¼Œåæ¥æ·»åŠ çš„å‘½ä»¤æ³¨å…¥è¿‡æ»¤å™¨ï¼‰ã€‚
4. å¯é€‰åœ°å°†æœ€æ–°é•œåƒé‡æ–°é—ªå­˜æˆ–ç¦ç”¨æ›´æ–°ï¼Œä»¥é¿å…åœ¨è·å¾—æŒä¹…æ€§åè¢«æ£€æµ‹ã€‚

### ç¤ºä¾‹ï¼šé™çº§åçš„å‘½ä»¤æ³¨å…¥
```http
POST /check_image_and_trigger_recovery?md5=1; echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC...' >> /root/.ssh/authorized_keys HTTP/1.1
Host: 192.168.0.1
Content-Type: application/octet-stream
Content-Length: 0
```
åœ¨æ˜“å—æ”»å‡»çš„ï¼ˆé™çº§ï¼‰å›ºä»¶ä¸­ï¼Œ`md5` å‚æ•°ç›´æ¥è¿æ¥åˆ° shell å‘½ä»¤ä¸­è€Œæ²¡æœ‰è¿›è¡Œæ¸…ç†ï¼Œä»è€Œå…è®¸æ³¨å…¥ä»»æ„å‘½ä»¤ï¼ˆåœ¨è¿™é‡Œ - å¯ç”¨åŸºäº SSH å¯†é’¥çš„ root è®¿é—®ï¼‰ã€‚åæ¥çš„å›ºä»¶ç‰ˆæœ¬å¼•å…¥äº†åŸºæœ¬çš„å­—ç¬¦è¿‡æ»¤å™¨ï¼Œä½†ç¼ºä¹é™çº§ä¿æŠ¤ä½¿å¾—ä¿®å¤å˜å¾—æ— æ•ˆã€‚

### ä»ç§»åŠ¨åº”ç”¨æå–å›ºä»¶

è®¸å¤šä¾›åº”å•†å°†å®Œæ•´çš„å›ºä»¶æ˜ åƒæ†ç»‘åœ¨å…¶é…å¥—çš„ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä»¥ä¾¿åº”ç”¨å¯ä»¥é€šè¿‡è“ç‰™/Wi-Fi æ›´æ–°è®¾å¤‡ã€‚è¿™äº›åŒ…é€šå¸¸ä»¥æœªåŠ å¯†çš„å½¢å¼å­˜å‚¨åœ¨ APK/APEX ä¸­ï¼Œè·¯å¾„å¦‚ `assets/fw/` æˆ– `res/raw/`ã€‚å·¥å…·å¦‚ `apktool`ã€`ghidra`ï¼Œç”šè‡³æ™®é€šçš„ `unzip` å…è®¸æ‚¨åœ¨ä¸æ¥è§¦ç‰©ç†ç¡¬ä»¶çš„æƒ…å†µä¸‹æå–ç­¾åçš„æ˜ åƒã€‚
```
$ apktool d vendor-app.apk -o vendor-app
$ ls vendor-app/assets/firmware
firmware_v1.3.11.490_signed.bin
```
### æ›´æ–°é€»è¾‘è¯„ä¼°æ¸…å•

* *æ›´æ–°ç«¯ç‚¹* çš„ä¼ è¾“/è®¤è¯æ˜¯å¦å¾—åˆ°å……åˆ†ä¿æŠ¤ï¼ˆTLS + è®¤è¯ï¼‰ï¼Ÿ
* è®¾å¤‡åœ¨åˆ·å†™ä¹‹å‰æ˜¯å¦æ¯”è¾ƒ **ç‰ˆæœ¬å·** æˆ– **å•è°ƒåå›æ»šè®¡æ•°å™¨**ï¼Ÿ
* é•œåƒæ˜¯å¦åœ¨å®‰å…¨å¯åŠ¨é“¾ä¸­è¿›è¡ŒéªŒè¯ï¼ˆä¾‹å¦‚ï¼ŒROMä»£ç æ£€æŸ¥ç­¾åï¼‰ï¼Ÿ
* ç”¨æˆ·ç©ºé—´ä»£ç æ˜¯å¦æ‰§è¡Œé¢å¤–çš„åˆç†æ€§æ£€æŸ¥ï¼ˆä¾‹å¦‚ï¼Œå…è®¸çš„åˆ†åŒºæ˜ å°„ã€å‹å·ï¼‰ï¼Ÿ
* *éƒ¨åˆ†* æˆ– *å¤‡ä»½* æ›´æ–°æµç¨‹æ˜¯å¦é‡ç”¨ç›¸åŒçš„éªŒè¯é€»è¾‘ï¼Ÿ

> ğŸ’¡  å¦‚æœä¸Šè¿°ä»»ä½•ä¸€é¡¹ç¼ºå¤±ï¼Œå¹³å°å¯èƒ½å®¹æ˜“å—åˆ°å›æ»šæ”»å‡»ã€‚

## æ¼”ç»ƒçš„æ˜“å—æ”»å‡»å›ºä»¶

è¦ç»ƒä¹ å‘ç°å›ºä»¶ä¸­çš„æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ˜“å—æ”»å‡»çš„å›ºä»¶é¡¹ç›®ä½œä¸ºèµ·ç‚¹ã€‚

- OWASP IoTGoat
- [https://github.com/OWASP/IoTGoat](https://github.com/OWASP/IoTGoat)
- Damn Vulnerable Router Firmware Project
- [https://github.com/praetorian-code/DVRF](https://github.com/praetorian-code/DVRF)
- Damn Vulnerable ARM Router (DVAR)
- [https://blog.exploitlab.net/2018/01/dvar-damn-vulnerable-arm-router.html](https://blog.exploitlab.net/2018/01/dvar-damn-vulnerable-arm-router.html)
- ARM-X
- [https://github.com/therealsaumil/armx#downloads](https://github.com/therealsaumil/armx#downloads)
- Azeria Labs VM 2.0
- [https://azeria-labs.com/lab-vm-2-0/](https://azeria-labs.com/lab-vm-2-0/)
- Damn Vulnerable IoT Device (DVID)
- [https://github.com/Vulcainreo/DVID](https://github.com/Vulcainreo/DVID)

## å‚è€ƒèµ„æ–™

- [https://scriptingxss.gitbook.io/firmware-security-testing-methodology/](https://scriptingxss.gitbook.io/firmware-security-testing-methodology/)
- [Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things](https://www.amazon.co.uk/Practical-IoT-Hacking-F-Chantzis/dp/1718500904)
- [Exploiting zero days in abandoned hardware â€“ Trail of Bits blog](https://blog.trailofbits.com/2025/07/25/exploiting-zero-days-in-abandoned-hardware/)

## åŸ¹è®­å’Œè®¤è¯

- [https://www.attify-store.com/products/offensive-iot-exploitation](https://www.attify-store.com/products/offensive-iot-exploitation)

{{#include ../../banners/hacktricks-training.md}}
