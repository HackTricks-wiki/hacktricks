{{#include ../../banners/hacktricks-training.md}}

## ファームウェアの整合性

**カスタムファームウェアおよび/またはコンパイルされたバイナリは、整合性または署名検証の欠陥を悪用するためにアップロードできます**。バックドアバインドシェルのコンパイルには、以下の手順を実行できます：

1. ファームウェアはfirmware-mod-kit (FMK)を使用して抽出できます。
2. 対象のファームウェアアーキテクチャとエンディアンネスを特定する必要があります。
3. Buildrootや環境に適した他の方法を使用してクロスコンパイラを構築できます。
4. クロスコンパイラを使用してバックドアを構築できます。
5. バックドアは抽出されたファームウェアの/usr/binディレクトリにコピーできます。
6. 適切なQEMUバイナリは抽出されたファームウェアのrootfsにコピーできます。
7. chrootとQEMUを使用してバックドアをエミュレートできます。
8. netcatを介してバックドアにアクセスできます。
9. QEMUバイナリは抽出されたファームウェアのrootfsから削除する必要があります。
10. 修正されたファームウェアはFMKを使用して再パッケージ化できます。
11. バックドア付きファームウェアは、ファームウェア分析ツールキット（FAT）を使用してエミュレートし、netcatを使用してターゲットのバックドアIPとポートに接続することでテストできます。

動的分析、ブートローダー操作、またはハードウェアセキュリティテストを通じてルートシェルがすでに取得されている場合、インプラントやリバースシェルなどの事前コンパイルされた悪意のあるバイナリを実行できます。Metasploitフレームワークや'msfvenom'のような自動化されたペイロード/インプラントツールを以下の手順で活用できます：

1. 対象のファームウェアアーキテクチャとエンディアンネスを特定する必要があります。
2. Msfvenomを使用して、ターゲットペイロード、攻撃者ホストIP、リスニングポート番号、ファイルタイプ、アーキテクチャ、プラットフォーム、および出力ファイルを指定できます。
3. ペイロードは侵害されたデバイスに転送され、実行権限があることを確認する必要があります。
4. Metasploitはmsfconsoleを起動し、ペイロードに応じて設定を構成することで、受信リクエストを処理する準備をします。
5. meterpreterリバースシェルは侵害されたデバイスで実行できます。

{{#include ../../banners/hacktricks-training.md}}
