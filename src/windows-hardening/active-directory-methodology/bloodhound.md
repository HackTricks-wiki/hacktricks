# BloodHound & Other AD Enum Tools

{{#include ../../banners/hacktricks-training.md}}

## AD Explorer

[AD Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer) είναι από το Sysinternal Suite:

> Ένας προηγμένος προβολέας και επεξεργαστής Active Directory (AD). Μπορείτε να χρησιμοποιήσετε το AD Explorer για να πλοηγηθείτε εύκολα σε μια βάση δεδομένων AD, να ορίσετε αγαπημένες τοποθεσίες, να δείτε ιδιότητες και χαρακτηριστικά αντικειμένων χωρίς να ανοίξετε παράθυρα διαλόγου, να επεξεργαστείτε δικαιώματα, να δείτε το σχήμα ενός αντικειμένου και να εκτελέσετε σύνθετες αναζητήσεις που μπορείτε να αποθηκεύσετε και να επανεκτελέσετε.

### Snapshots

Το AD Explorer μπορεί να δημιουργήσει snapshots ενός AD ώστε να μπορείτε να το ελέγξετε εκτός σύνδεσης.\
Μπορεί να χρησιμοποιηθεί για να ανακαλύψει ευπάθειες εκτός σύνδεσης ή για να συγκρίνει διαφορετικές καταστάσεις της βάσης δεδομένων AD με την πάροδο του χρόνου.

Θα χρειαστείτε το όνομα χρήστη, τον κωδικό πρόσβασης και την κατεύθυνση για να συνδεθείτε (απαιτείται οποιοσδήποτε χρήστης AD).

Για να πάρετε ένα snapshot του AD, πηγαίνετε στο `File` --> `Create Snapshot` και εισάγετε ένα όνομα για το snapshot.

## ADRecon

[**ADRecon**](https://github.com/adrecon/ADRecon) είναι ένα εργαλείο που εξάγει και συνδυάζει διάφορα αντικείμενα από ένα περιβάλλον AD. Οι πληροφορίες μπορούν να παρουσιαστούν σε μια **ειδικά διαμορφωμένη** αναφορά Microsoft Excel **που περιλαμβάνει** συνοπτικές προβολές με μετρικές για να διευκολύνει την ανάλυση και να παρέχει μια ολιστική εικόνα της τρέχουσας κατάστασης του στοχευμένου περιβάλλοντος AD.
```bash
# Run it
.\ADRecon.ps1
```
## BloodHound

From [https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound)

> BloodHound είναι μια εφαρμογή ιστού Javascript μιας σελίδας, χτισμένη πάνω από [Linkurious](http://linkurio.us/), συμπιεσμένη με [Electron](http://electron.atom.io/), με μια βάση δεδομένων [Neo4j](https://neo4j.com/) που τροφοδοτείται από έναν συλλέκτη δεδομένων C#.

Το BloodHound χρησιμοποιεί τη θεωρία γραφημάτων για να αποκαλύψει τις κρυφές και συχνά μη προγραμματισμένες σχέσεις μέσα σε ένα περιβάλλον Active Directory ή Azure. Οι επιτιθέμενοι μπορούν να χρησιμοποιήσουν το BloodHound για να εντοπίσουν εύκολα πολύπλοκες διαδρομές επίθεσης που διαφορετικά θα ήταν αδύνατο να εντοπιστούν γρήγορα. Οι υπερασπιστές μπορούν να χρησιμοποιήσουν το BloodHound για να εντοπίσουν και να εξαλείψουν αυτές τις ίδιες διαδρομές επίθεσης. Και οι δύο ομάδες, μπλε και κόκκινες, μπορούν να χρησιμοποιήσουν το BloodHound για να αποκτήσουν εύκολα μια βαθύτερη κατανόηση των σχέσεων προνομίων σε ένα περιβάλλον Active Directory ή Azure.

Έτσι, [Bloodhound ](https://github.com/BloodHoundAD/BloodHound)είναι ένα καταπληκτικό εργαλείο που μπορεί να καταγράψει αυτόματα ένα τομέα, να αποθηκεύσει όλες τις πληροφορίες, να βρει πιθανά μονοπάτια κλιμάκωσης προνομίων και να δείξει όλες τις πληροφορίες χρησιμοποιώντας γραφήματα.

Το Bloodhound αποτελείται από 2 κύρια μέρη: **ingestors** και την **εφαρμογή οπτικοποίησης**.

Οι **ingestors** χρησιμοποιούνται για να **καταγράψουν το τομέα και να εξάγουν όλες τις πληροφορίες** σε μια μορφή που θα κατανοήσει η εφαρμογή οπτικοποίησης.

Η **εφαρμογή οπτικοποίησης χρησιμοποιεί neo4j** για να δείξει πώς σχετίζονται όλες οι πληροφορίες και να δείξει διαφορετικούς τρόπους για να κλιμακώσουν τα προνόμια στον τομέα.

### Εγκατάσταση

Μετά τη δημιουργία του BloodHound CE, ολόκληρο το έργο ενημερώθηκε για ευκολία χρήσης με το Docker. Ο πιο εύκολος τρόπος για να ξεκινήσετε είναι να χρησιμοποιήσετε τη προ-configured Docker Compose ρύθμιση.

1. Εγκαταστήστε το Docker Compose. Αυτό θα πρέπει να περιλαμβάνεται με την εγκατάσταση του [Docker Desktop](https://www.docker.com/products/docker-desktop/).
2. Εκτελέστε:
```
curl -L https://ghst.ly/getbhce | docker compose -f - up
```
3. Εντοπίστε τον τυχαία παραγόμενο κωδικό πρόσβασης στην έξοδο του τερματικού του Docker Compose.  
4. Σε έναν περιηγητή, πηγαίνετε στο http://localhost:8080/ui/login. Συνδεθείτε με όνομα χρήστη admin και τον τυχαία παραγόμενο κωδικό πρόσβασης από τα logs.

Μετά από αυτό, θα χρειαστεί να αλλάξετε τον τυχαία παραγόμενο κωδικό πρόσβασης και θα έχετε έτοιμο το νέο περιβάλλον, από το οποίο μπορείτε να κατεβάσετε απευθείας τους ingestors.

### SharpHound

Έχουν πολλές επιλογές, αλλά αν θέλετε να εκτελέσετε το SharpHound από έναν υπολογιστή που είναι συνδεδεμένος στο domain, χρησιμοποιώντας τον τρέχοντα χρήστη σας και να εξάγετε όλες τις πληροφορίες μπορείτε να κάνετε:
```
./SharpHound.exe --CollectionMethods All
Invoke-BloodHound -CollectionMethod All
```
> Μπορείτε να διαβάσετε περισσότερα για τη **CollectionMethod** και τη συνεδρία loop [εδώ](https://support.bloodhoundenterprise.io/hc/en-us/articles/17481375424795-All-SharpHound-Community-Edition-Flags-Explained)

Αν επιθυμείτε να εκτελέσετε το SharpHound χρησιμοποιώντας διαφορετικά διαπιστευτήρια, μπορείτε να δημιουργήσετε μια συνεδρία CMD netonly και να εκτελέσετε το SharpHound από εκεί:
```
runas /netonly /user:domain\user "powershell.exe -exec bypass"
```
[**Μάθετε περισσότερα για το Bloodhound στο ired.team.**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux)

## Group3r

[**Group3r**](https://github.com/Group3r/Group3r) είναι ένα εργαλείο για να βρείτε **ευπάθειες** στο Active Directory που σχετίζονται με την **Ομάδα Πολιτικής**. \
Πρέπει να **τρέξετε το group3r** από έναν υπολογιστή μέσα στο domain χρησιμοποιώντας **οποιονδήποτε χρήστη του domain**.
```bash
group3r.exe -f <filepath-name.log>
# -s sends results to stdin
# -f send results to file
```
## PingCastle

[**PingCastle**](https://www.pingcastle.com/documentation/) **αξιολογεί την ασφάλεια ενός περιβάλλοντος AD** και παρέχει μια ωραία **έκθεση** με γραφήματα.

Για να το εκτελέσετε, μπορείτε να τρέξετε το εκτελέσιμο `PingCastle.exe` και θα ξεκινήσει μια **διαδραστική συνεδρία** παρουσιάζοντας ένα μενού επιλογών. Η προεπιλεγμένη επιλογή που πρέπει να χρησιμοποιήσετε είναι **`healthcheck`** που θα καθορίσει μια βασική **επισκόπηση** του **τομέα**, και θα βρει **λανθασμένες ρυθμίσεις** και **ευπάθειες**.&#x20;

{{#include ../../banners/hacktricks-training.md}}
