# Models RCE

{{#include ../banners/hacktricks-training.md}}

## Завантаження моделей до RCE

Моделі машинного навчання зазвичай поширюються в різних форматах, таких як ONNX, TensorFlow, PyTorch тощо. Ці моделі можуть бути завантажені на комп'ютери розробників або в продуктивні системи для їх використання. Зазвичай моделі не повинні містити шкідливий код, але є випадки, коли модель може бути використана для виконання довільного коду в системі як передбачена функція або через вразливість у бібліотеці завантаження моделі.

На момент написання це деякі приклади такого типу вразливостей:

| **Фреймворк / Інструмент**  | **Вразливість (CVE, якщо доступно)**                                                                                       | **RCE Вектор**                                                                                                                         | **Посилання**                               |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
| **PyTorch** (Python)        | *Небезпечна десеріалізація в* `torch.load` **(CVE-2025-32434)**                                                            | Шкідливий pickle в контрольній точці моделі призводить до виконання коду (обхід захисту `weights_only`)                                   | |
| PyTorch **TorchServe**      | *ShellTorch* – **CVE-2023-43654**, **CVE-2022-1471**                                                                        | SSRF + завантаження шкідливої моделі викликає виконання коду; десеріалізація Java RCE в API управління                                   | |
| **TensorFlow/Keras**        | **CVE-2021-37678** (небезпечний YAML) <br> **CVE-2024-3660** (Keras Lambda)                                               | Завантаження моделі з YAML використовує `yaml.unsafe_load` (виконання коду) <br> Завантаження моделі з **Lambda** шаром виконує довільний Python код | |
| TensorFlow (TFLite)         | **CVE-2022-23559** (парсинг TFLite)                                                                                         | Сформована модель `.tflite` викликає переповнення цілого числа → пошкодження купи (потенційний RCE)                                     | |
| **Scikit-learn** (Python)   | **CVE-2020-13092** (joblib/pickle)                                                                                          | Завантаження моделі через `joblib.load` виконує pickle з payload `__reduce__` зловмисника                                               | |
| **NumPy** (Python)          | **CVE-2019-6446** (небезпечний `np.load`) *спірний*                                                                         | За замовчуванням `numpy.load` дозволяє завантаження об'єктних масивів pickle – шкідливий `.npy/.npz` викликає виконання коду              | |
| **ONNX / ONNX Runtime**     | **CVE-2022-25882** (перехід директорії) <br> **CVE-2024-5187** (перехід tar)                                               | Зовнішній шлях ваг моделі ONNX може вийти за межі директорії (читання довільних файлів) <br> Шкідлива модель ONNX tar може перезаписати довільні файли (призводячи до RCE) | |
| ONNX Runtime (ризик дизайну)| *(Немає CVE)* Користувацькі операції ONNX / контрольний потік                                                                  | Модель з користувацьким оператором вимагає завантаження рідного коду зловмисника; складні графи моделей зловживають логікою для виконання непередбачених обчислень | |
| **NVIDIA Triton Server**    | **CVE-2023-31036** (перехід шляху)                                                                                          | Використання API завантаження моделі з увімкненим `--model-control` дозволяє відносний перехід шляху для запису файлів (наприклад, перезапис `.bashrc` для RCE) | |
| **GGML (формат GGUF)**      | **CVE-2024-25664 … 25668** (багато переповнень купи)                                                                        | Неправильний файл моделі GGUF викликає переповнення буфера купи в парсері, що дозволяє виконання довільного коду на системі жертви       | |
| **Keras (старі формати)**   | *(Немає нових CVE)* Спадковий Keras H5 модель                                                                                 | Шкідлива HDF5 (`.h5`) модель з кодом Lambda шару все ще виконується при завантаженні (режим безпеки Keras не охоплює старий формат – “атака з пониженням”) | |
| **Інші** (загальні)        | *Недолік дизайну* – серіалізація Pickle                                                                                      | Багато ML інструментів (наприклад, формати моделей на основі pickle, Python `pickle.load`) виконуватимуть довільний код, вбудований у файли моделей, якщо не вжити заходів | |

Більше того, є деякі моделі на основі python pickle, такі як ті, що використовуються [PyTorch](https://github.com/pytorch/pytorch/security), які можуть бути використані для виконання довільного коду в системі, якщо їх не завантажити з `weights_only=True`. Отже, будь-яка модель на основі pickle може бути особливо вразливою до цього типу атак, навіть якщо вони не вказані в таблиці вище.

{{#include ../banners/hacktricks-training.md}}
