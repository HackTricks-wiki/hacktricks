# Relro

{{#include ../../banners/hacktricks-training.md}}

## Relro

**RELRO** рдХрд╛ рдорддрд▓рдм рд╣реИ **Relocation Read-Only** рдФрд░ рдпрд╣ рдПрдХ рдРрд╕рд╛ рдЙрдкрд╛рдп рд╣реИ рдЬреЛ рд▓рд┐рдВрдХрд░реНрд╕ (`ld`) рджреНрд╡рд╛рд░рд╛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ ELF рдХреЗ рдбреЗрдЯрд╛ рд╕реЗрдЧрдореЗрдВрдЯ рдХреЗ рдПрдХ рдЙрдкрд╕рдореБрдЪреНрдЪрдп рдХреЛ **рд╕рднреА рдкреБрдирд░реНрд╕реНрдерд╛рдкрдиреЛрдВ рдХреЗ рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓** рдмрдирд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рд▓рдХреНрд╖реНрдп рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **GOT (Global Offset Table)** рдпрд╛ рдЕрдиреНрдп рдкреБрдирд░реНрд╕реНрдерд╛рдкрди-рд╕рдВрдмрдВрдзрд┐рдд рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдирд╛ рд╣реИ рдЬреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди рдбреЗрд░рд┐рдлрд░реЗрдВрд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ (рдЬреИрд╕реЗ `__fini_array`)ред

рдЖрдзреБрдирд┐рдХ рд▓рд┐рдВрдХрд░реНрд╕ RELRO рдХреЛ **GOT** (рдФрд░ рдХреБрдЫ рдЕрдиреНрдп рдЕрдиреБрднрд╛рдЧреЛрдВ) рдХреЛ **.bss** рд╕реЗ **рдкрд╣рд▓реЗ** рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП **рдкреБрдирдГ рдХреНрд░рдордмрджреНрдз** рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ тАУ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг тАУ рдПрдХ рд╕рдорд░реНрдкрд┐рдд `PT_GNU_RELRO` рд╕реЗрдЧрдореЗрдВрдЯ рдмрдирд╛рдХрд░ рдЬреЛ рдЧрддрд┐рд╢реАрд▓ рд▓реЛрдбрд░ рджреНрд╡рд╛рд░рд╛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж `RтАУX` рдХреЗ рд░реВрдк рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдореИрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, **.bss** рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдЕрдм GOT рддрдХ рдирд╣реАрдВ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рдФрд░ рдордирдорд╛рдиреЗ-рд▓рд┐рдЦрд╛рдИ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ RELRO-рд╕реБрд░рдХреНрд╖рд┐рдд рдкреГрд╖реНрда рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд┐рдд рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд▓рд┐рдВрдХрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ **рджреЛ рд╕реНрддрд░реЛрдВ** рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╣реИрдВ:

### Partial RELRO

* рдзреНрд╡рдЬ `-Wl,-z,relro` (рдпрд╛ рд╕реАрдзреЗ `ld` рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╕рдордп рдХреЗрд╡рд▓ `-z relro`) рдХреЗ рд╕рд╛рде рдЙрддреНрдкрдиреНрдиред
* рдХреЗрд╡рд▓ **GOT** рдХрд╛ **рдЧреИрд░-PLT** рднрд╛рдЧ (рдЬреЛ рдбреЗрдЯрд╛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕реЗрдЧрдореЗрдВрдЯ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдиреБрднрд╛рдЧ рдЬреЛ рд░рди-рдЯрд╛рдЗрдо рдкрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ тАУ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг **.got.plt** рдЬреЛ **lazy binding** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ тАУ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рд░рд╣рддреЗ рд╣реИрдВред
* рдЗрд╕рд▓рд┐рдП, рдПрдХ **рдордирдорд╛рдирд╛ рд▓рд┐рдЦрд╛рдИ** рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдЕрднреА рднреА PLT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдпрд╛ **ret2dlresolve** рдХрд░рдХреЗ)ред
* рдкреНрд░рджрд░реНрд╢рди рдкреНрд░рднрд╛рд╡ рдирдЧрдгреНрдп рд╣реИ рдФрд░ рдЗрд╕рд▓рд┐рдП **рд▓рдЧрднрдЧ рд╣рд░ рд╡рд┐рддрд░рдг рд╡рд░реНрд╖реЛрдВ рд╕реЗ рдХрдо рд╕реЗ рдХрдо Partial RELRO рдХреЗ рд╕рд╛рде рдкреИрдХреЗрдЬ рднреЗрдЬ рд░рд╣рд╛ рд╣реИ (рдпрд╣ 2016 рд╕реЗ GCC/Binutils рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реИ)**ред

### Full RELRO

* **рджреЛрдиреЛрдВ** рдзреНрд╡рдЬ `-Wl,-z,relro,-z,now` (рдЬрд┐рд╕реЗ `-z relro -z now` рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЗ рд╕рд╛рде рдЙрддреНрдкрдиреНрдиред `-z now` рдЧрддрд┐рд╢реАрд▓ рд▓реЛрдбрд░ рдХреЛ **рд╕рднреА** рдкреНрд░рддреАрдХреЛрдВ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддрд╛ рд╣реИ (eager binding) рддрд╛рдХрд┐ **.got.plt** рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рди рд╣реЛ рдФрд░ рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдореИрдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдкреВрд░рд╛ **GOT**, **.got.plt**, **.fini_array**, **.init_array**, **.preinit_array** рдФрд░ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рдЖрдВрддрд░рд┐рдХ glibc рддрд╛рд▓рд┐рдХрд╛рдПрдБ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ `PT_GNU_RELRO` рд╕реЗрдЧрдореЗрдВрдЯ рдХреЗ рдЕрдВрджрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИрдВред
* рдорд╛рдкрдиреЗ рдпреЛрдЧреНрдп рд╕реНрдЯрд╛рд░реНрдЯ-рдЕрдк рдУрд╡рд░рд╣реЗрдб рдЬреЛрдбрд╝рддрд╛ рд╣реИ (рд╕рднреА рдЧрддрд┐рд╢реАрд▓ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдиреЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдкрд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рд▓реЗрдХрд┐рди **рдХреЛрдИ рд░рди-рдЯрд╛рдЗрдо рдУрд╡рд░рд╣реЗрдб рдирд╣реАрдВ**ред

2023 рд╕реЗ рдХрдИ рдореБрдЦреНрдпрдзрд╛рд░рд╛ рдХреЗ рд╡рд┐рддрд░рдг рдиреЗ **рдкреВрд░реНрдг RELRO рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рдХреЗ рд╕рд╛рде **рд╕рд┐рд╕реНрдЯрдо рдЯреВрд▓-рдЪреЗрди** (рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдкреИрдХреЗрдЬ) рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд┐рдЪ рдХрд┐рдпрд╛ рд╣реИ тАУ рдЬреИрд╕реЗ **Debian 12 тАЬbookwormтАЭ (dpkg-buildflags 13.0.0)** рдФрд░ **Fedora 35+**ред рдПрдХ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдкрдХреЛ рдЗрд╕рд▓рд┐рдП рдЙрди рдмрд╛рдЗрдирд░реА рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬрд╣рд╛рдБ **рд╣рд░ GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╣реИ**ред

---

## How to Check the RELRO status of a binary
```bash
$ checksec --file ./vuln
[*] '/tmp/vuln'
Arch:     amd64-64-little
RELRO:    Full
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
```
`checksec` (рднрд╛рдЧ [pwntools](https://github.com/pwncollege/pwntools) рдФрд░ рдХрдИ рд╡рд┐рддрд░рдгреЛрдВ рдХрд╛) `ELF` рд╣реЗрдбрд░ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк `checksec` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рддреЛ `readelf` рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░реЗрдВ:
```bash
# Partial RELRO тЖТ PT_GNU_RELRO is present but BIND_NOW is *absent*
$ readelf -l ./vuln | grep -E "GNU_RELRO|BIND_NOW"
GNU_RELRO      0x0000000000600e20 0x0000000000600e20
```

```bash
# Full RELRO тЖТ PT_GNU_RELRO *and* the DF_BIND_NOW flag
$ readelf -d ./vuln | grep BIND_NOW
0x0000000000000010 (FLAGS)              FLAGS: BIND_NOW
```
рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдЪрд▓ рд░рд╣реА рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рд╕реЗрдЯ-рдпреВрдЖрдИрдбреА рд░реВрдЯ рд╣реЗрд▓реНрдкрд░), рддреЛ рдЖрдк рдЕрднреА рднреА рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЛ **`/proc/$PID/exe`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
readelf -l /proc/$(pgrep helper)/exe | grep GNU_RELRO
```
---

## рдЕрдкрдиреЗ рдХреЛрдб рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп RELRO рд╕рдХреНрд╖рдо рдХрд░рдирд╛
```bash
# GCC example тАУ create a PIE with Full RELRO and other common hardenings
$ gcc -fPIE -pie -z relro -z now -Wl,--as-needed -D_FORTIFY_SOURCE=2 main.c -o secure
```
`-z relro -z now` **GCC/clang** (рдХреЗ рдмрд╛рдж `-Wl,`) рдФрд░ **ld** рдХреЗ рд▓рд┐рдП рд╕реАрдзреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред **CMake 3.18+** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЖрдк рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░реАрд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдкреВрд░реНрдг RELRO рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```cmake
set(CMAKE_INTERPROCEDURAL_OPTIMIZATION ON) # LTO
set(CMAKE_ENABLE_EXPORTS OFF)
set(CMAKE_BUILD_RPATH_USE_ORIGIN ON)
set(CMAKE_EXE_LINKER_FLAGS "-Wl,-z,relro,-z,now")
```
---

## Bypass Techniques

| RELRO рд╕реНрддрд░ | рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ | рд╕рдВрднрд╛рд╡рд┐рдд рд╢реЛрд╖рдг рддрдХрдиреАрдХреЗрдВ |
|-------------|-------------------|----------------------------------|
| None / Partial | рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдирд╛ | 1. **.got.plt** рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдкрд┐рд╡рдЯ рдХрд░реЗрдВред<br>2. **ret2dlresolve** тАУ рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдЦрдВрдб рдореЗрдВ рдирдХрд▓реА `Elf64_Rela` рдФрд░ `Elf64_Sym` рдмрдирд╛рдПрдВ рдФрд░ `_dl_runtime_resolve` рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред<br>3. **.fini_array** / **atexit()** рд╕реВрдЪреА рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВред |
| Full | GOT рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ | 1. **рдЕрдиреНрдп рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдХреЛрдб рдкреЙрдЗрдВрдЯрд░реНрд╕** (C++ vtables, `__malloc_hook` < glibc 2.34, `__free_hook`, рдХрд╕реНрдЯрдо `.data` рд╕реЗрдХреНрд╢рди рдореЗрдВ рдХреЙрд▓рдмреИрдХ, JIT рдкреГрд╖реНрда) рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВред<br>2. libc рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ рдФрд░ **SROP/ROP into libc** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП *рд╕рд╛рдкреЗрдХреНрд╖ рдкрдврд╝рдиреЗ* рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдВред<br>3. **DT_RPATH**/`LD_PRELOAD` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдзреЛрдЦреЗрдмрд╛рдЬрд╝ рд╕рд╛рдЭрд╛ рд╡рд╕реНрддреБ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ (рдпрджрд┐ рд╡рд╛рддрд╛рд╡рд░рдг рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИ) рдпрд╛ **`ld_audit`**ред<br>4. GOT рдХреЛ рдЫреБрдП рдмрд┐рдирд╛ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдореЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП **рдлреЙрд░реНрдореЗрдЯ-рд╕реНрдЯреНрд░рд┐рдВрдЧ** рдпрд╛ рдЖрдВрд╢рд┐рдХ рдкреЙрдЗрдВрдЯрд░ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд╛ рд╢реЛрд╖рдг рдХрд░реЗрдВред |

> ЁЯТб рдкреВрд░реНрдг RELRO рдХреЗ рд╕рд╛рде рднреА **рд▓реЛрдб рдХреА рдЧрдИ рд╕рд╛рдЭрд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА (рдЬреИрд╕реЗ libc рд╕реНрд╡рдпрдВ)** рдХрд╛ **рдХреЗрд╡рд▓ рдЖрдВрд╢рд┐рдХ RELRO** рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЙрди рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрдм рд▓реЛрдбрд░ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛рдПрдВ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ **рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдиреЗ** рдХрд╛ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕рд╛рдЭрд╛ рд╡рд╕реНрддреБ рдХреЗ рдкреГрд╖реНрдареЛрдВ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЕрднреА рднреА libc рдХреЗ GOT рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдпрд╛ `__rtld_global` рд╕реНрдЯреИрдХ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдкрд┐рд╡рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЖрдзреБрдирд┐рдХ CTF рдЪреБрдиреМрддрд┐рдпреЛрдВ рдореЗрдВ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХрд╛ рдмрд╛рдпрдкрд╛рд╕ рдЙрджрд╛рд╣рд░рдг (2024 CTF тАУ *pwn.college тАЬenlightenedтАЭ*)

рдЪреБрдиреМрддреА рдкреВрд░реНрдг RELRO рдХреЗ рд╕рд╛рде рдЖрдИред рд╢реЛрд╖рдг рдиреЗ рдПрдХ **off-by-one** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рддрд╛рдХрд┐ рдПрдХ рд╣реАрдк рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рднреНрд░рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, `tcache poisoning` рдХреЗ рд╕рд╛рде libc рдХреЛ рд▓реАрдХ рдХрд┐рдпрд╛, рдФрд░ рдЕрдВрддрддрдГ `__free_hook` (RELRO рдЦрдВрдб рдХреЗ рдмрд╛рд╣рд░) рдХреЛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХ-рдЧреИрдЬреЗрдЯ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ред рдХреЛрдИ GOT рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рдереАред

---

## рд╣рд╛рд▓рд┐рдпрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди рдФрд░ рдХрдордЬреЛрд░рд┐рдпрд╛рдБ (2022-2025)

* **glibc 2.40 `__malloc_hook` / `__free_hook` рдХреЛ рдЕрдкреНрд░рдЪрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ (2025)** тАУ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЖрдзреБрдирд┐рдХ рд╣реАрдк рд╢реЛрд╖рдг рдЬреЛ рдЗрди рдкреНрд░рддреАрдХреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рдереЗ, рдЕрдм **`rtld_global._dl_load_jump`** рдпрд╛ C++ рдЕрдкрд╡рд╛рдж рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдЬреИрд╕реЗ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдкрд░ рдкрд┐рд╡рдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЪреВрдВрдХрд┐ рд╣реБрдХ **RELRO** рдХреЗ рдмрд╛рд╣рд░ рд░рд╣рддреЗ рд╣реИрдВ, рдЙрдирдХреА рд╣рдЯрд╛рдиреЗ рд╕реЗ рдкреВрд░реНрдг RELRO рдмрд╛рдпрдкрд╛рд╕ рдХреА рдХрдард┐рдирд╛рдИ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред
* **Binutils 2.41 тАЬmax-page-sizeтАЭ рд╕реБрдзрд╛рд░ (2024)** тАУ рдПрдХ рдмрдЧ рдиреЗ RELRO рдЦрдВрдб рдХреЗ рдЕрдВрддрд┐рдо рдХреБрдЫ рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рдХреБрдЫ ARM64 рдирд┐рд░реНрдорд╛рдгреЛрдВ рдкрд░ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдкреГрд╖реНрда рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА, рдЬрд┐рд╕рд╕реЗ рдПрдХ рдЫреЛрдЯрд╛ **RELRO рдЧреИрдк** рдмрдирд╛ рдЬреЛ `mprotect` рдХреЗ рдмрд╛рдж рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛ред рдЕрдкрд╕реНрдЯреНрд░реАрдо рдЕрдм `PT_GNU_RELRO` рдХреЛ рдкреГрд╖реНрда рд╕реАрдорд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЙрд╕ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдорд╛рдорд▓реЗ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

---

## рд╕рдВрджрд░реНрдн

* Binutils рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ тАУ *`-z relro`, `-z now` рдФрд░ `PT_GNU_RELRO`*
* *тАЬRELRO тАУ рдкреВрд░реНрдг, рдЖрдВрд╢рд┐рдХ рдФрд░ рдмрд╛рдпрдкрд╛рд╕ рддрдХрдиреАрдХреЗрдВтАЭ* тАУ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ @ wolfslittlered 2023

{{#include ../../banners/hacktricks-training.md}}
