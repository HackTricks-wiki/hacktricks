# Print Stack Canary

{{#include ../../../banners/hacktricks-training.md}}

## Büyütülmüş yığın

Bir **stack overflow** açığına sahip bir **programın** **puts** fonksiyonunu **yığın taşmasına** **işaret eden** bir **kısma** yönlendirebildiği bir durumu hayal edin. Saldırgan, **kanaryanın ilk baytının bir null bayt olduğunu** (`\x00`) ve kanaryanın geri kalanının **rastgele** baytlar olduğunu bilir. Ardından, saldırgan **kanaryanın ilk baytına kadar yığını** **aşan** bir taşma oluşturabilir.

Sonra, saldırgan **payload'un ortasında puts fonksiyonunu** **çağırır** ve bu, **kanaryayı** **yazdırır** (ilk null bayt hariç).

Bu bilgiyle saldırgan, kanaryayı (aynı program oturumunda) bilerek **yeni bir saldırı oluşturup gönderebilir**.

Açıkça, bu taktik çok **kısıtlıdır** çünkü saldırgan **payload'unun içeriğini** **yazdırabilmeli** ve **kanaryayı** **sızdırabilmeli** ve ardından **yeni bir payload** oluşturup (aynı program oturumunda) **gerçek buffer overflow'u** **gönderebilmelidir**.

**CTF örnekleri:**&#x20;

- [**https://guyinatuxedo.github.io/08-bof_dynamic/csawquals17_svc/index.html**](https://guyinatuxedo.github.io/08-bof_dynamic/csawquals17_svc/index.html)
- 64 bit, ASLR etkin ama PIE yok, ilk adım kanaryanın 0x00 baytına kadar bir taşma doldurmak ve ardından puts'u çağırarak sızdırmaktır. Kanarya ile bir ROP gadget'ı oluşturulur ve puts'un GOT'dan adresini sızdırmak için puts'u çağırır ve ardından `system('/bin/sh')` çağırmak için bir ROP gadget'ı.
- [**https://guyinatuxedo.github.io/14-ret_2_system/hxp18_poorCanary/index.html**](https://guyinatuxedo.github.io/14-ret_2_system/hxp18_poorCanary/index.html)
- 32 bit, ARM, relro yok, kanarya, nx, pie yok. Kanaryayı sızdırmak için puts'a bir çağrı ile taşma ve `system`'ı çağıran bir ROP zinciri ile r0'ı (arg `/bin/sh`) ve pc'yi (system adresi) pop'lamak.

## Keyfi Okuma

**Keyfi okuma** ile format **string'leri** tarafından sağlanan bir yöntemle kanaryayı sızdırmak mümkün olabilir. Bu örneğe bakın: [**https://ir0nstone.gitbook.io/notes/types/stack/canaries**](https://ir0nstone.gitbook.io/notes/types/stack/canaries) ve keyfi bellek adreslerini okumak için format string'lerini kötüye kullanma hakkında okuyabilirsiniz:

{{#ref}}
../../format-strings/
{{#endref}}

- [https://guyinatuxedo.github.io/14-ret_2_system/asis17_marymorton/index.html](https://guyinatuxedo.github.io/14-ret_2_system/asis17_marymorton/index.html)
- Bu zorluk, yığından kanaryayı okumak için çok basit bir şekilde bir format string'ini kötüye kullanıyor.

{{#include ../../../banners/hacktricks-training.md}}
