# Temel İkili İstismar Metodolojisi

{{#include ../../banners/hacktricks-training.md}}

## ELF Temel Bilgiler

Herhangi bir şeyi istismar etmeye başlamadan önce, bir **ELF ikilisi** yapısının bir kısmını anlamak ilginçtir:

{{#ref}}
elf-tricks.md
{{#endref}}

## İstismar Araçları

{{#ref}}
tools/
{{#endref}}

## Yığın Taşması Metodolojisi

Bu kadar çok teknikle, her tekniğin ne zaman faydalı olacağına dair bir şemaya sahip olmak iyidir. Aynı korumaların farklı teknikleri etkileyeceğini unutmayın. Her koruma bölümünde korumaları aşmanın yollarını bulabilirsiniz, ancak bu metodolojide değil.

## Akışı Kontrol Etme

Bir programın akışını kontrol etmenin farklı yolları vardır:

- [**Yığın Taşmaları**](../stack-overflow/) yığından dönüş işaretçisini veya EBP -> ESP -> EIP'yi yazma.
- Taşmayı tetiklemek için bir [**Tam Sayı Taşması**](../integer-overflow.md) istismar etmeniz gerekebilir.
- Ya da **Rastgele Yazmalar + Yaz Ne Nerede ile İcra** yoluyla.
- [**Format dizeleri**](../format-strings/)**:** `printf`'i kullanarak rastgele içeriği rastgele adreslere yazma.
- [**Dizi İndeksleme**](../array-indexing.md): Bazı dizileri kontrol edebilmek ve rastgele yazma elde edebilmek için kötü tasarlanmış bir indekslemeyi istismar etme.
- Taşmayı tetiklemek için bir [**Tam Sayı Taşması**](../integer-overflow.md) istismar etmeniz gerekebilir.
- **bof'dan WWW'ye ROP ile**: Bir tampon taşmasını istismar ederek bir ROP oluşturma ve WWW'yi elde etme.

**Yaz Ne Nerede ile İcra** tekniklerini şurada bulabilirsiniz:

{{#ref}}
../arbitrary-write-2-exec/
{{#endref}}

## Sonsuz Döngüler

Dikkate alınması gereken bir şey, genellikle **bir zafiyetin yalnızca bir kez istismar edilmesinin yeterli olmayabileceğidir**; özellikle bazı korumaların aşılması gerekir. Bu nedenle, bir **tek zafiyeti aynı ikilinin yürütülmesi sırasında birkaç kez istismar edilebilir hale getirmek** için bazı seçenekleri tartışmak ilginçtir:

- **`main` fonksiyonunun** adresini veya **zafiyetin** meydana geldiği adresi bir **ROP** zincirine yazma.
- Uygun bir ROP zincirini kontrol ederek, o zincirdeki tüm eylemleri gerçekleştirebilirsiniz.
- **`exit` adresini GOT'ta** (veya ikili tarafından bitirilmeden önce kullanılan herhangi bir fonksiyonda) **zafiyete geri dönmek için** adres yazma.
- [**.fini_array**](../arbitrary-write-2-exec/www2exec-.dtors-and-.fini_array.md#eternal-loop)**'de açıklandığı gibi**, burada zafiyeti tekrar çağıracak bir fonksiyon ve **`__libc_csu_fini`**'yi çağıracak bir fonksiyon saklayın; bu da `.fini_array`'dan fonksiyonu tekrar çağıracaktır.

## İstismar Hedefleri

### Hedef: Mevcut bir fonksiyonu çağırmak

- [**ret2win**](./#ret2win): Bayrağı almak için çağırmanız gereken (belki bazı özel parametrelerle) kodda bir fonksiyon var.
- [**PIE**](../common-binary-protections-and-bypasses/pie/) **ve** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) olmayan bir **normal bof'da**, yığında saklanan dönüş adresine adresi yazmanız yeterlidir.
- [**PIE**](../common-binary-protections-and-bypasses/pie/) olan bir bof'da, bunu aşmanız gerekecek.
- [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) olan bir bof'da, bunu aşmanız gerekecek.
- **ret2win** fonksiyonunu doğru bir şekilde çağırmak için birkaç parametre ayarlamanız gerekiyorsa:
- Tüm parametreleri hazırlamak için yeterli gadget varsa bir [**ROP**](./#rop-and-ret2...-techniques) **zinciri** kullanabilirsiniz.
- Birçok kaydı kontrol etmek için [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) (bu syscall'ı çağırabiliyorsanız).
- Birçok kaydı kontrol etmek için [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) ve [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md) gadget'ları.
- [**Yaz Ne Nerede**](../arbitrary-write-2-exec/) aracılığıyla, **`win`** fonksiyonunu çağırmak için diğer zafiyetleri (bof olmayan) istismar edebilirsiniz.
- [**Göstergeleri Yönlendirme**](../stack-overflow/pointer-redirecting.md): Yığın, çağrılacak bir fonksiyona veya ilginç bir fonksiyon (system veya printf) tarafından kullanılacak bir dizeye işaret eden göstergeler içeriyorsa, o adresi yazmak mümkündür.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) veya [**PIE**](../common-binary-protections-and-bypasses/pie/) adresleri etkileyebilir.
- [**Başlatılmamış değişkenler**](../stack-overflow/uninitialized-variables.md): Asla bilemezsiniz.

### Hedef: RCE

#### Shellcode aracılığıyla, eğer nx devre dışıysa veya shellcode ile ROP'u karıştırarak:

- [**(Yığın) Shellcode**](./#stack-shellcode): Bu, dönüş işaretçisini yazdıktan önce veya sonra yığında bir shellcode saklamak ve ardından **ona atlamak** için yararlıdır:
- Her durumda, eğer bir [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) varsa, normal bir bof'da bunu aşmanız gerekecek (sızdırma).
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ve** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) olmadan, yığın adresine atlamak mümkündür çünkü asla değişmeyecektir.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) ile, ona atlamak için [**ret2esp/ret2reg**](../rop-return-oriented-programing/ret2esp-ret2reg.md) gibi tekniklere ihtiyacınız olacak.
- [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) ile, bazı [**ROP**](../rop-return-oriented-programing/) kullanarak `memprotect`'i çağırmanız ve bazı sayfaları `rwx` yapmanız gerekecek; böylece shellcode'u oraya saklayabilir (örneğin, read çağırarak) ve ardından oraya atlayabilirsiniz.
- Bu, shellcode ile bir ROP zincirini karıştıracaktır.

#### Syscall'lar aracılığıyla

- [**Ret2syscall**](../rop-return-oriented-programing/rop-syscall-execv/): Rastgele komutları çalıştırmak için `execve`'yi çağırmak için yararlıdır. **Belirli syscall'ı parametrelerle çağırmak için gadget'leri bulabilmeniz gerekir.**
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) veya [**PIE**](../common-binary-protections-and-bypasses/pie/) etkinse, ikili veya kütüphanelerden ROP gadget'lerini kullanabilmek için bunları aşmanız gerekecek.
- [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) **ret2execve**'yi hazırlamak için yararlı olabilir.
- Birçok kaydı kontrol etmek için [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) ve [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md) gadget'ları.

#### libc aracılığıyla

- [**Ret2lib**](../rop-return-oriented-programing/ret2lib/): Genellikle **`libc`**'den bir fonksiyonu (örneğin, **`system`**) bazı hazırlanmış argümanlarla (örneğin, `'/bin/sh'`) çağırmak için yararlıdır. İstediğiniz fonksiyonu çağırmak için ikilinin **kütüphaneyi yüklemesi** gerekir (genellikle libc).
- **Statik derlenmiş ve** [**PIE**](../common-binary-protections-and-bypasses/pie/) yoksa, `system` ve `/bin/sh`'nin **adresleri** değişmeyecek, bu nedenle bunları statik olarak kullanmak mümkündür.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ve yüklü libc sürümünü bilmeden**, `system` ve `/bin/sh`'nin **adresleri** değişmeyecek, bu nedenle bunları statik olarak kullanmak mümkündür.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ama** [**PIE**](../common-binary-protections-and-bypasses/pie/) yoksa, libc'yi bilerek ve ikili `system`** fonksiyonunu kullanıyorsa, **GOT'taki system adresine `ret` yaparak** `'/bin/sh'` adresini parametre olarak verebilirsiniz (bunu çözmeniz gerekecek).
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) ama [**PIE**](../common-binary-protections-and-bypasses/pie/) yoksa, libc'yi bilerek ve **ikili `system`** kullanmıyorsanız:
- [**`ret2dlresolve`**](../rop-return-oriented-programing/ret2dlresolve.md) kullanarak `system`'in adresini çözümleyin ve çağırın.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) aşın ve `system` ile `'/bin/sh'`'nin adresini bellek içinde hesaplayın.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **ve** [**PIE**](../common-binary-protections-and-bypasses/pie/) ile ve libc'yi bilmeden: Şunları yapmanız gerekir:
- [**PIE**](../common-binary-protections-and-bypasses/pie/) aşın.
- Kullanılan **`libc` sürümünü** bulun (birkaç fonksiyon adresini sızdırın).
- Devam etmek için **ASLR ile önceki senaryoları** kontrol edin.

#### EBP/RBP aracılığıyla

- [**Yığın Pivotlama / EBP2Ret / EBP Zincirleme**](../stack-overflow/stack-pivoting-ebp2ret-ebp-chaining.md): Yığındaki saklanan EBP aracılığıyla RET'i kontrol etmek için ESP'yi kontrol edin.
- **Birden fazla** yığın taşmaları için yararlıdır.
- Yüklemenin bellek içinde payload'u oluştururken EIP'i istismar ederek EIP'i kontrol etmenin alternatif bir yolu olarak yararlıdır ve ardından EBP aracılığıyla ona atlayabilirsiniz.

#### Çeşitli

- [**Göstergeleri Yönlendirme**](../stack-overflow/pointer-redirecting.md): Yığın, çağrılacak bir fonksiyona veya ilginç bir fonksiyon (system veya printf) tarafından kullanılacak bir dizeye işaret eden göstergeler içeriyorsa, o adresi yazmak mümkündür.
- [**ASLR**](../common-binary-protections-and-bypasses/aslr/) veya [**PIE**](../common-binary
