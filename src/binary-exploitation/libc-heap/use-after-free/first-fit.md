# First Fit

{{#include ../../../banners/hacktricks-training.md}}

## **First Fit**

рдЬрдм рдЖрдк glibc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдореЗрдореЛрд░реА рдХреЛ рдлреНрд░реА рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдореЗрдореЛрд░реА рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди "рдмрд┐рди" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣рд╛рдБ рджреЛ рд╕рд╛рдорд╛рдиреНрдп рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХрд╛ рдПрдХ рд╕рд░рд▓ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рд╣реИ: рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдФрд░ рдлрд╛рд╕реНрдЯрдмрд┐рдиред

### Unsorted Bins

рдЬрдм рдЖрдк рдПрдХ рдореЗрдореЛрд░реА рдЯреБрдХрдбрд╝рд╛ рдлреНрд░реА рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдлрд╛рд╕реНрдЯ рдЯреБрдХрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдмрд┐рди рдПрдХ рд╕реВрдЪреА рдХреА рддрд░рд╣ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдирдП рдлреНрд░реА рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рд╕рд╛рдордиреЗ ( "рд╣реЗрдб") рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред рдЬрдм рдЖрдк рдореЗрдореЛрд░реА рдХрд╛ рдПрдХ рдирдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреЛ рдкреАрдЫреЗ ( "рдЯреЗрд▓") рд╕реЗ рджреЗрдЦрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдРрд╕рд╛ рдЯреБрдХрдбрд╝рд╛ рдвреВрдВрдв рд╕рдХреЗ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рд╣реЛред рдпрджрд┐ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╕реЗ рдХреЛрдИ рдЯреБрдХрдбрд╝рд╛ рдЖрдкрдХреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝рд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рд╛рдордиреЗ рдХрд╛ рднрд╛рдЧ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╢реЗрд╖ рднрд╛рдЧ рдмрд┐рди рдореЗрдВ рд░рд╣рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:

- рдЖрдк 300 рдмрд╛рдЗрдЯ (`a`) рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ 250 рдмрд╛рдЗрдЯ (`b`), рдлрд┐рд░ `a` рдХреЛ рдлреНрд░реА рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ 250 рдмрд╛рдЗрдЯ (`c`) рдорд╛рдВрдЧрддреЗ рд╣реИрдВред
- рдЬрдм рдЖрдк `a` рдХреЛ рдлреНрд░реА рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред
- рдпрджрд┐ рдЖрдк рдлрд┐рд░ рд╕реЗ 250 рдмрд╛рдЗрдЯ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ `a` рдХреЛ рдЯреЗрд▓ рдореЗрдВ рдкрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдлрд┐рдЯ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рднрд╛рдЧ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдмрд╛рдХреА рдХреЛ рдмрд┐рди рдореЗрдВ рд░рдЦрддрд╛ рд╣реИред
- `c` рдкрд┐рдЫрд▓реЗ `a` рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдФрд░ `a` рдХреА рд╕рд╛рдордЧреНрд░реА рд╕реЗ рднрд░рд╛ рд╣реЛрдЧрд╛ред
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins рдЫреЛрдЯреЗ рдореЗрдореЛрд░реА рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдХреЗ рд╡рд┐рдкрд░реАрдд, рдлрд╛рд╕реНрдЯрдмрд┐рди рдирдП рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рд╕рд┐рд░ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЕрдВрддрд┐рдо-рдореЗрдВ-рдкреНрд░рдердо-рдирд┐рдХрд╛рд▓рдиреЗ (LIFO) рд╡реНрдпрд╡рд╣рд╛рд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдореЗрдореЛрд░реА рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рдЯреБрдХрдбрд╝рд╛ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд╕рд┐рд░ рд╕реЗ рдЦреАрдВрдЪреЗрдЧрд╛ред

Example:
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
---
### ЁЯФе рдЖрдзреБрдирд┐рдХ glibc рд╡рд┐рдЪрд╛рд░ (tcache тЙе 2.26)

glibc 2.26 рд╕реЗ рд╣рд░ рдереНрд░реЗрдб рдЕрдкрдиреА **tcache** рд░рдЦрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ *unsorted bin* рд╕реЗ *рдкрд╣рд▓реЗ* рдХреНрд╡реЗрд░реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдПрдХ first-fit рдкрд░рд┐рджреГрд╢реНрдп **рдХреЗрд╡рд▓ рддрдм** рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ рдпрджрд┐:

1. рдЕрдиреБрд░реЛрдзрд┐рдд рдЖрдХрд╛рд░ **`tcache_max`** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 64-рдмрд┐рдЯ рдкрд░ 0x420) рд╕реЗ **рдмрдбрд╝рд╛ рд╣реИ**, *рдпрд╛*
2. рд╕рдВрдмрдВрдзрд┐рдд tcache рдмрд┐рди **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рднрд░рд╛ рд╣реБрдЖ рд╣реИ рдпрд╛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЦрд╛рд▓реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** (7 рддрддреНрд╡реЛрдВ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдХреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд░рдЦрдХрд░)ред

рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╣рдорд▓реЛрдВ рдореЗрдВ рдЖрдк рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╕рд╣рд╛рдпрдХ рд░реВрдЯреАрди рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдЬреИрд╕реЗ:
```c
// Drain the tcache for a given size
for(int i = 0; i < 7; i++) pool[i] = malloc(0x100);
for(int i = 0; i < 7; i++) free(pool[i]);
```
рдПрдХ рдмрд╛рд░ рдЬрдм tcache рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдмрд╛рдж рдореЗрдВ рдХреА рдЧрдИ frees рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЬрд╛рддреА рд╣реИрдВ рдФрд░ рдХреНрд▓рд╛рд╕рд┐рдХ рдлрд░реНрд╕реНрдЯ-рдлрд┐рдЯ рд╡реНрдпрд╡рд╣рд╛рд░ (рдЯреЗрд▓ рд╕рд░реНрдЪ, рд╣реЗрдб рдЗрдВрд╕рд░реНрд╢рди) рдлрд┐рд░ рд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

---
### ЁЯЪй рдкрд╣рд▓реЗ-рдлрд┐рдЯ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ-рдЪрдВрдХ UAF рдмрдирд╛рдирд╛

рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЕрдВрд╢ (glibc 2.38 рдкрд░ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛) рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рд╕реНрдкреНрд▓рд┐рдЯрд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ 2 **рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдкреЙрдЗрдВрдЯрд░реНрд╕** рдмрдирд╛рдП рдЬрд╛ рд╕рдХреЗрдВ - рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдЬреЛ рдПрдХрд▓ рдлреНрд░реА рдХреЛ рд░рд╛рдЗрдЯ-рдЖрдлреНрдЯрд░-рдлреНрд░реА рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИред
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(){
setbuf(stdout, NULL);

/* 1. prepare 2 adjacent chunks and free the first one */
char *A = malloc(0x420);   // big enough to bypass tcache
char *B = malloc(0x420);
strcpy(A, "AAAA\n");
free(A);                   // A тЖТ unsorted

/* 2. request a *smaller* size to force a split of A */
char *C = malloc(0x400);   // returns lower half of former A

/* 3. The remainder of A is still in the unsorted bin.
Another 0x400-byte malloc will now return the *same*
region pointed to by B тАУ creating a UAF/overlap. */
char *C2 = malloc(0x400);

printf("B  = %p\nC2 = %p (overlaps B)\n", B, C2);

// Arbitrary write in B is immediately visible via C2
memset(B, 'X', 0x10);
fwrite(C2, 1, 0x10, stdout);  // prints Xs
}
```
Exploitation recipe (common in recent CTFs):

1. **рдЯрд╛рд░рдЧреЗрдЯ рдЖрдХрд╛рд░** рдХреЗ рд▓рд┐рдП tcache рдХреЛ **рдбреНрд░реЗрди** рдХрд░реЗрдВред
2. рдПрдХ **рдЪрдВрдХ** рдХреЛ **рдлреНрд░реА** рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЬрд╛рдПред
3. рдПрдХ рдереЛрдбрд╝рд╛ рдЫреЛрдЯрд╛ рдЖрдХрд╛рд░ **рдЕрд▓реЙрдЯ** рдХрд░реЗрдВ - рдЕрд▓реНрд▓реЛрдХреЗрдЯрд░ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдЪрдВрдХ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред
4. рдлрд┐рд░ рд╕реЗ **рдЕрд▓реЙрдЯ** рдХрд░реЗрдВ - рдмрдЪреЗ рд╣реБрдП рднрд╛рдЧ рдХрд╛ рдПрдХ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рд╣реЛрддрд╛ рд╣реИ тЖТ UAFред
5. рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝реАрд▓реНрдбреНрд╕ (рдлрдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░реНрд╕, FILE vtable, рдЖрджрд┐) рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВред

рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ 2024 HITCON Quals *Setjmp* рдЪреБрдиреМрддреА рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдЗрд╕ рд╕рдЯреАрдХ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ UAF рд╕реЗ `__free_hook` рдХреЗ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

---
### ЁЯЫбя╕П  Mitigations & Hardening

* **рд╕реЗрдл-рд▓рд┐рдВрдХрд┐рдВрдЧ (glibc тЙе 2.32)** рдХреЗрд╡рд▓ рд╕рд┐рдВрдЧрд▓реА-рд▓рд┐рдВрдХреНрдб *tcache*/**fastbin** рд╕реВрдЪрд┐рдпреЛрдВ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред рдЕрдирд╕реЙрд░реНрдЯреЗрдб/рдЫреЛрдЯреЗ/рдмрдбрд╝реЗ рдмрд┐рди рдЕрднреА рднреА рдХрдЪреНрдЪреЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдкрд╣рд▓реЗ-рдлрд┐рдЯ рдЖрдзрд╛рд░рд┐рдд рдУрд╡рд░рд▓реИрдк рддрдм рднреА рд╕рдВрднрд╡ рд╣реИрдВ рдпрджрд┐ рдЖрдк рдПрдХ рд╣реАрдк рд▓реАрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* **рд╣реАрдк рдкреЙрдЗрдВрдЯрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди & MTE** (ARM64) рдЕрднреА рддрдХ x86-64 glibc рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡рд┐рддрд░рдг рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдлреНрд▓реИрдЧ рдЬреИрд╕реЗ `GLIBC_TUNABLES=glibc.malloc.check=3` рдЕрд╕рдВрдЧрдд рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдкрд░ abort рдХрд░реЗрдВрдЧреЗ рдФрд░ рд╕рд░рд▓ PoCs рдХреЛ рддреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред
* **рдлреНрд░реА рдкрд░ tcache рднрд░рдирд╛** (2024 рдореЗрдВ glibc 2.41 рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд) рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдЙрдкрдпреЛрдЧ рдХреЛ рдФрд░ рдХрдо рдХрд░реЗрдЧрд╛; рд╕рд╛рдорд╛рдиреНрдп рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп рднрд╡рд┐рд╖реНрдп рдХреЗ рд░рд┐рд▓реАрдЬрд╝ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред

---
## Other References & Examples

- [**https://heap-exploitation.dhavalkapil.com/attacks/first_fit**](https://heap-exploitation.dhavalkapil.com/attacks/first_fit)
- [**https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/**](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
- ARM64. Use after free: рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ, рдЗрд╕реЗ рдлреНрд░реА рдХрд░реЗрдВ, рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ рдЬреЛ рдлреНрд░реА рдХрд┐рдП рдЧрдП рдЪрдВрдХ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, **рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рд╕реЗ user->password рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛**ред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **рдкрд╛рд╕рд╡рд░реНрдб рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
- [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use_after_free/#example**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use_after_free/#example)
- рдкреНрд░реЛрдЧреНрд░рд╛рдо рдиреЛрдЯреНрд╕ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдПрдХ рдиреЛрдЯ рдореЗрдВ рдиреЛрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдПрдХ malloc(8) рдореЗрдВ рд╣реЛрдЧреА (рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ) рдФрд░ рдПрдХ рдЕрдиреНрдп malloc(<size>) рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдиреЛрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрдЧреАред
- рд╣рдорд▓рд╛ 2 рдиреЛрдЯреНрд╕ (note0 рдФрд░ note1) рдмрдирд╛рдиреЗ рдХрд╛ рд╣реЛрдЧрд╛ рдЬрд┐рдирдХреА malloc рд╕рд╛рдордЧреНрд░реА рдиреЛрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝реА рд╣реЛрдЧреА рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдлреНрд░реА рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╡реЗ рдлрд╛рд╕реНрдЯ рдмрд┐рди (рдпрд╛ tcache) рдореЗрдВ рдЬрд╛рдПрдВред
- рдлрд┐рд░, рдПрдХ рдФрд░ рдиреЛрдЯ (note2) рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЖрдХрд╛рд░ 8 рд╣реЛред рд╕рд╛рдордЧреНрд░реА note1 рдореЗрдВ рд╣реЛрдЧреА рдХреНрдпреЛрдВрдХрд┐ рдЪрдВрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд╣рд╛рдБ рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ win рдлрд╝рдВрдХреНрд╢рди рдХреА рдУрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдиреЛрдЯ1 рдХреЛ Use-After-Free рдХрд░рдХреЗ рдирдП рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- [**https://guyinatuxedo.github.io/26-heap_grooming/pico_areyouroot/index.html**](https://guyinatuxedo.github.io/26-heap_grooming/pico_areyouroot/index.html)
- рдХреБрдЫ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛, рд╡рд╛рдВрдЫрд┐рдд рдорд╛рди рд▓рд┐рдЦрдирд╛, рдЗрд╕реЗ рдлреНрд░реА рдХрд░рдирд╛, рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЪреВрдВрдХрд┐ рдкрд┐рдЫрд▓реЗ рдбреЗрдЯрд╛ рдЕрднреА рднреА рд╡рд╣рд╛рдВ рд╣реИ, рдЗрд╕реЗ рдЪрдВрдХ рдореЗрдВ рдирдП рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рдорд╛рди рд╕реЗрдЯ рдХрд░рдирд╛ рдпрд╛ рдлреНрд▓реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред
- [**https://guyinatuxedo.github.io/26-heap_grooming/swamp19_heapgolf/index.html**](https://guyinatuxedo.github.io/26-heap_grooming/swamp19_heapgolf/index.html)
- рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЪрдВрдХ рдХреЗ рдЕрдВрджрд░ 4 рд▓рд┐рдЦрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╕рднреА рдХреЛ рдмрд▓рдкреВрд░реНрд╡рдХ рдлреНрд░реА рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рднреА)ред рдкреНрд░рддреНрдпреЗрдХ рдирдП рдЖрд╡рдВрдЯрд┐рдд рдЪрдВрдХ рдореЗрдВ рдЗрд╕рдХрд╛ рдирдВрдмрд░ рдПрд░реЗ рдЗрдВрдбреЗрдХреНрд╕ рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, 4 рдЪрдВрдХреНрд╕ (+ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд) рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ, рдЕрдВрддрд┐рдо рдореЗрдВ 4 рд╣реЛрдЧрд╛, рдЙрдиреНрд╣реЗрдВ рдлреНрд░реА рдХрд░реЗрдВ рдФрд░ рдкрд╣рд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рдкреБрдирдГ рдЖрд╡рдВрдЯрди рдХреЛ рдмрд▓ рджреЗрдВ, рдЬреЛ рдЕрдВрддрд┐рдо рдлреНрд░реА рдХрд┐рдП рдЧрдП рдЪрдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ 4 рд╣реЛрдЧрд╛ред
- 2024 HITCON Quals Setjmp write-up (Quarkslab) тАУ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдкрд╣рд▓реЗ-рдлрд┐рдЯ / рдЕрдирд╕реЙрд░реНрдЯреЗрдб-рд╕реНрдкреНрд▓рд┐рдЯ рдУрд╡рд░рд▓реИрдк рд╣рдорд▓рд╛: <https://ctftime.org/writeup/39355>
- Angstrom CTF 2024 *heapify* write-up тАУ рдЕрдирд╕реЙрд░реНрдЯреЗрдб-рдмрд┐рди рд╡рд┐рднрд╛рдЬрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ libc рд▓реАрдХ рдХрд░рдирд╛ рдФрд░ рдУрд╡рд░рд▓реИрдк рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛: <https://hackmd.io/@aneii11/H1S2snV40>

{{#include ../../../banners/hacktricks-training.md}}
