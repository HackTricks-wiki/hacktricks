# House of Lore | Small bin Attack

{{#include ../../banners/hacktricks-training.md}}

## Basic Information

### Code

- Angalia ile kutoka [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/)
- Hii haifanyi kazi
- Au: [https://github.com/shellphish/how2heap/blob/master/glibc_2.39/house_of_lore.c](https://github.com/shellphish/how2heap/blob/master/glibc_2.39/house_of_lore.c)
- Hii haifanyi kazi hata kama inajaribu kupita baadhi ya ukaguzi ikipata kosa: `malloc(): unaligned tcache chunk detected`
- Mfano huu bado unafanya kazi: [**https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html**](https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html)&#x20;

### Goal

- Ingiza **kipande kidogo cha uongo katika sanduku dogo ili iwezekane kukipatia**.\
Kumbuka kwamba kipande kidogo kilichoongezwa ni kile cha uongo ambacho mshambuliaji anaunda na si kipande cha uongo katika nafasi isiyo ya kawaida.

### Requirements

- Unda vipande viwili vya uongo na uviunganishe pamoja na kipande halali katika sanduku dogo:
- `fake0.bk` -> `fake1`
- `fake1.fd` -> `fake0`
- `fake0.fd` -> `legit` (unahitaji kubadilisha kiashiria katika kipande kidogo kilichofutwa kupitia udhaifu mwingine)
- `legit.bk` -> `fake0`

Kisha utaweza kukipatia `fake0`.

### Attack

- Kipande kidogo (`legit`) kinapatikana, kisha kingine kinapatikana ili kuzuia kuunganishwa na kipande kikuu. Kisha, `legit` kinafutwa (kikihamishwa kwenye orodha ya sanduku zisizo na mpangilio) na kipande kikubwa kinapatikana, **kikihamisha `legit` kwenye sanduku dogo.**
- Mshambuliaji anaunda vipande kadhaa vya uongo vidogo, na kufanya uunganisho unaohitajika ili kupita ukaguzi wa akili:
- `fake0.bk` -> `fake1`
- `fake1.fd` -> `fake0`
- `fake0.fd` -> `legit` (unahitaji kubadilisha kiashiria katika kipande kidogo kilichofutwa kupitia udhaifu mwingine)
- `legit.bk` -> `fake0`
- Kipande kidogo kinapatikana ili kupata legit, kikifanya **`fake0`** kuwa kwenye orodha ya juu ya sanduku dogo
- Kipande kingine kidogo kinapatikana, kikipata `fake0` kama kipande, na kuruhusu uwezekano wa kusoma/kandika viashiria ndani yake.

## References

- [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/)
- [https://heap-exploitation.dhavalkapil.com/attacks/house_of_lore](https://heap-exploitation.dhavalkapil.com/attacks/house_of_lore)
- [https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html](https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html)

{{#include ../../banners/hacktricks-training.md}}
