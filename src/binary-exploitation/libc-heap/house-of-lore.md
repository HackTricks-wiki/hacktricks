# House of Lore | Küçük bin Saldırısı

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

### Kod

- [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/) adresindekini kontrol et
- Bu çalışmıyor
- Ya da: [https://github.com/shellphish/how2heap/blob/master/glibc_2.39/house_of_lore.c](https://github.com/shellphish/how2heap/blob/master/glibc_2.39/house_of_lore.c)
- Bu, bazı kontrolleri atlamaya çalışsa bile `malloc(): unaligned tcache chunk detected` hatasını alarak çalışmıyor
- Bu örnek hala çalışıyor: [**https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html**](https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html)

### Hedef

- **Küçük bin içinde sahte bir küçük parça eklemek ve ardından bunu tahsis etmek mümkün hale getirmek.**\
Eklenen küçük parçanın, saldırganın oluşturduğu sahte parça olduğunu ve rastgele bir konumda olmadığını unutmayın.

### Gereksinimler

- 2 sahte parça oluşturun ve bunları birbirine ve küçük bin içindeki gerçek parçaya bağlayın:
- `fake0.bk` -> `fake1`
- `fake1.fd` -> `fake0`
- `fake0.fd` -> `legit` (serbest bırakılmış küçük bin parçasındaki bir işaretçiyi başka bir zafiyet aracılığıyla değiştirmeniz gerekiyor)
- `legit.bk` -> `fake0`

Böylece `fake0`'ı tahsis edebileceksiniz.

### Saldırı

- Bir küçük parça (`legit`) tahsis edilir, ardından üst parçayla birleştirmeyi önlemek için başka bir parça tahsis edilir. Sonra, `legit` serbest bırakılır (sıralanmamış bin listesine taşınır) ve daha büyük bir parça tahsis edilir, **`legit` küçük bin içine taşınır.**
- Bir saldırgan birkaç sahte küçük parça oluşturur ve gerekli bağlantıları yaparak güvenlik kontrollerini atlar:
- `fake0.bk` -> `fake1`
- `fake1.fd` -> `fake0`
- `fake0.fd` -> `legit` (serbest bırakılmış küçük bin parçasındaki bir işaretçiyi başka bir zafiyet aracılığıyla değiştirmeniz gerekiyor)
- `legit.bk` -> `fake0`
- `legit` almak için bir küçük parça tahsis edilir, bu da **`fake0`**'ı küçük parçaların üst listesine getirir
- Başka bir küçük parça tahsis edilir, `fake0` bir parça olarak alınır ve içinde işaretçileri okuma/yazma olanağı sağlar.

## Referanslar

- [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house_of_lore/)
- [https://heap-exploitation.dhavalkapil.com/attacks/house_of_lore](https://heap-exploitation.dhavalkapil.com/attacks/house_of_lore)
- [https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html](https://guyinatuxedo.github.io/40-house_of_lore/house_lore_exp/index.html)

{{#include ../../banners/hacktricks-training.md}}
