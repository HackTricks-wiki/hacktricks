# Hardware Hacking

{{#include ../../banners/hacktricks-training.md}}

## JTAG

Το JTAG επιτρέπει την εκτέλεση ενός boundary scan. Ο boundary scan αναλύει συγκεκριμένα κυκλώματα, συμπεριλαμβανομένων των ενσωματωμένων boundary-scan κελιών και καταχωρητών για κάθε ακίδα.

Το πρότυπο JTAG ορίζει **συγκεκριμένες εντολές για τη διεξαγωγή boundary scans**, συμπεριλαμβανομένων των εξής:

- **BYPASS** σας επιτρέπει να δοκιμάσετε ένα συγκεκριμένο τσιπ χωρίς το κόστος της διέλευσης από άλλα τσιπ.
- **SAMPLE/PRELOAD** παίρνει ένα δείγμα των δεδομένων που εισέρχονται και εξέρχονται από τη συσκευή όταν είναι σε κανονική λειτουργία.
- **EXTEST** ρυθμίζει και διαβάζει τις καταστάσεις των ακίδων.

Μπορεί επίσης να υποστηρίξει άλλες εντολές όπως:

- **IDCODE** για την αναγνώριση μιας συσκευής
- **INTEST** για την εσωτερική δοκιμή της συσκευής

Μπορεί να συναντήσετε αυτές τις οδηγίες όταν χρησιμοποιείτε ένα εργαλείο όπως το JTAGulator.

### The Test Access Port

Οι boundary scans περιλαμβάνουν δοκιμές της τετραπλής **Test Access Port (TAP)**, μιας γενικής θύρας που παρέχει **πρόσβαση στις λειτουργίες υποστήριξης δοκιμών JTAG** που είναι ενσωματωμένες σε ένα στοιχείο. Το TAP χρησιμοποιεί τα εξής πέντε σήματα:

- Test clock input (**TCK**) Το TCK είναι το **ρολόι** που καθορίζει πόσο συχνά ο ελεγκτής TAP θα εκτελεί μια ενέργεια (με άλλα λόγια, θα πηδά στην επόμενη κατάσταση στη μηχανή καταστάσεων).
- Test mode select (**TMS**) input Το TMS ελέγχει τη **πεπερασμένη μηχανή καταστάσεων**. Σε κάθε χτύπημα του ρολογιού, ο ελεγκτής JTAG TAP της συσκευής ελέγχει την τάση στην ακίδα TMS. Εάν η τάση είναι κάτω από ένα συγκεκριμένο κατώφλι, το σήμα θεωρείται χαμηλό και ερμηνεύεται ως 0, ενώ αν η τάση είναι πάνω από ένα συγκεκριμένο κατώφλι, το σήμα θεωρείται υψηλό και ερμηνεύεται ως 1.
- Test data input (**TDI**) Το TDI είναι η ακίδα που στέλνει **δεδομένα στο τσιπ μέσω των scan cells**. Κάθε προμηθευτής είναι υπεύθυνος για τον καθορισμό του πρωτοκόλλου επικοινωνίας μέσω αυτής της ακίδας, καθώς το JTAG δεν το καθορίζει.
- Test data output (**TDO**) Το TDO είναι η ακίδα που στέλνει **δεδομένα από το τσιπ**.
- Test reset (**TRST**) input Η προαιρετική TRST επαναφέρει τη πεπερασμένη μηχανή καταστάσεων **σε μια γνωστή καλή κατάσταση**. Εναλλακτικά, εάν το TMS κρατηθεί στο 1 για πέντε συνεχόμενους κύκλους ρολογιού, προκαλεί μια επαναφορά, με τον ίδιο τρόπο που θα έκανε η ακίδα TRST, γι' αυτό και η TRST είναι προαιρετική.

Μερικές φορές θα μπορείτε να βρείτε αυτές τις ακίδες σημειωμένες στην PCB. Σε άλλες περιπτώσεις, μπορεί να χρειαστεί να **τις βρείτε**.

### Identifying JTAG pins

Ο ταχύτερος αλλά πιο ακριβός τρόπος για να ανιχνεύσετε τις θύρες JTAG είναι χρησιμοποιώντας το **JTAGulator**, μια συσκευή που έχει δημιουργηθεί ειδικά για αυτόν τον σκοπό (αν και μπορεί **επίσης να ανιχνεύσει τις ακίδες UART**).

Έχει **24 κανάλια** που μπορείτε να συνδέσετε στις ακίδες των πλακετών. Στη συνέχεια, εκτελεί μια **επίθεση BF** όλων των πιθανών συνδυασμών στέλνοντας **IDCODE** και **BYPASS** εντολές boundary scan. Εάν λάβει μια απάντηση, εμφανίζει το κανάλι που αντιστοιχεί σε κάθε σήμα JTAG.

Ένας φθηνότερος αλλά πολύ πιο αργός τρόπος για να προσδιορίσετε τις ακίδες JTAG είναι χρησιμοποιώντας το [**JTAGenum**](https://github.com/cyphunk/JTAGenum/) φορτωμένο σε έναν μικροελεγκτή συμβατό με Arduino.

Χρησιμοποιώντας το **JTAGenum**, θα πρέπει πρώτα να **καθορίσετε τις ακίδες της συσκευής δοκιμής** που θα χρησιμοποιήσετε για την αρίθμηση. Θα πρέπει να αναφερθείτε στο διάγραμμα ακίδων της συσκευής και στη συνέχεια να συνδέσετε αυτές τις ακίδες με τα σημεία δοκιμής στη στοχευμένη σας συσκευή.

Ένας **τρίτος τρόπος** για να προσδιορίσετε τις ακίδες JTAG είναι να **εξετάσετε την PCB** για μία από τις ακίδες. Σε ορισμένες περιπτώσεις, οι PCB μπορεί να παρέχουν βολικά τη **διεύθυνση Tag-Connect**, η οποία είναι μια σαφής ένδειξη ότι η πλακέτα έχει και έναν συνδετήρα JTAG. Μπορείτε να δείτε πώς φαίνεται αυτή η διεπαφή στο [https://www.tag-connect.com/info/](https://www.tag-connect.com/info/). Επιπλέον, η εξέταση των **datasheets των chipsets στην PCB** μπορεί να αποκαλύψει διαγράμματα ακίδων που δείχνουν σε διεπαφές JTAG.

## SDW

Το SWD είναι ένα πρωτόκολλο ειδικό για ARM που έχει σχεδιαστεί για αποσφαλμάτωση.

Η διεπαφή SWD απαιτεί **δύο ακίδες**: ένα αμφίδρομο σήμα **SWDIO**, το οποίο είναι το ισοδύναμο των ακίδων **TDI και TDO του JTAG** και ένα ρολόι, και **SWCLK**, το οποίο είναι το ισοδύναμο του **TCK** στο JTAG. Πολλές συσκευές υποστηρίζουν τη **Serial Wire ή JTAG Debug Port (SWJ-DP)**, μια συνδυασμένη διεπαφή JTAG και SWD που σας επιτρέπει να συνδέσετε είτε μια συσκευή δοκιμής SWD είτε JTAG στο στόχο.

{{#include ../../banners/hacktricks-training.md}}
