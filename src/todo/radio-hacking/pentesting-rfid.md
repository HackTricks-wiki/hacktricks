# Pentesting RFID

{{#include ../../banners/hacktricks-training.md}}

## Uvod

**Radiofrekventna identifikacija (RFID)** je najpopularnije rešenje za kratkotalasnu radio komunikaciju. Obično se koristi za skladištenje i prenos informacija koje identifikuju entitet.

RFID oznaka može se oslanjati na **svoj izvor napajanja (aktivna)**, kao što je ugrađena baterija, ili primati napajanje od antene za čitanje koristeći trenutnu **indukovanu iz primljenih radio talasa** (**pasivna**).

### Kategorije

EPCglobal deli RFID oznake u šest kategorija. Oznaka u svakoj kategoriji ima sve mogućnosti navedene u prethodnoj kategoriji, čineći je unazad kompatibilnom.

- **Klasa 0** oznake su **pasivne** oznake koje rade u **UHF** opsegu. Dobavljač ih **preprogramira** u fabrici. Kao rezultat, ne možete **promeniti** informacije pohranjene u njihovoj memoriji.
- **Klasa 1** oznake takođe mogu raditi u **HF** opsegu. Pored toga, mogu se **pisati samo jednom** nakon proizvodnje. Mnoge oznake klase 1 takođe mogu obraditi **ciklične redundancijske provere** (CRC) komandi koje primaju. CRC su nekoliko dodatnih bajtova na kraju komandi za otkrivanje grešaka.
- **Klasa 2** oznake mogu se **pisati više puta**.
- **Klasa 3** oznake mogu sadržati **ugrađene senzore** koji mogu snimati parametre okruženja, kao što su trenutna temperatura ili kretanje oznake. Ove oznake su **polu-pasivne**, jer iako **imaju** ugrađeni izvor napajanja, kao što je integrisana **baterija**, ne mogu **inicirati** bežičnu **komunikaciju** sa drugim oznakama ili čitačima.
- **Klasa 4** oznake mogu inicirati komunikaciju sa drugim oznakama iste klase, čineći ih **aktivnim oznakama**.
- **Klasa 5** oznake mogu pružiti **napajanje drugim oznakama i komunicirati sa svim prethodnim klasama oznaka**. Oznake klase 5 mogu delovati kao **RFID čitači**.

### Informacije pohranjene u RFID oznakama

Memorija RFID oznake obično pohranjuje četiri vrste podataka: **identifikacione podatke**, koji **identifikuju** **entitet** na koji je oznaka pričvršćena (ovi podaci uključuju korisnički definisane oblasti, kao što su bankovni računi); **dodatne podatke**, koji pružaju **dodatne** **detalje** o entitetu; **kontrolne podatke**, koji se koriste za internu **konfiguraciju** oznake; i **proizvođačke podatke** oznake, koji sadrže jedinstveni identifikator oznake (**UID**) i detalje o **proizvodnji**, **vrsti** i **dobavljaču** oznake. Prve dve vrste podataka naći ćete u svim komercijalnim oznakama; poslednje dve mogu se razlikovati u zavisnosti od dobavljača oznake.

ISO standard definiše vrednost identifikatora aplikacione porodice (**AFI**), kod koji označava **vrstu objekta** kojem oznaka pripada. Još jedan važan registar, takođe definisan od strane ISO, je identifikator formata skladištenja podataka (**DSFID**), koji definiše **logičku organizaciju korisničkih podataka**.

Većina **bezbednosnih kontrola** RFID-a ima mehanizme koji **ograničavaju** **čitanje** ili **pisanje** operacija na svakoj korisničkoj memorijskoj blokadi i na posebnim registrima koji sadrže AFI i DSFID vrednosti. Ovi **zaključani** **mehanizmi** koriste podatke pohranjene u kontrolnoj memoriji i imaju **podrazumevane lozinke** koje je prekonfigurisao dobavljač, ali omogućavaju vlasnicima oznaka da **konfigurišu prilagođene lozinke**.

### Uporedba niskofrekventnih i visokofrekventnih oznaka

<figure><img src="../../images/image (983).png" alt=""><figcaption></figcaption></figure>

## Niskofrekventne RFID oznake (125kHz)

**Niskofrekventne oznake** se često koriste u sistemima koji **ne zahtevaju visoku bezbednost**: pristup zgradama, interkom ključevi, članstva u teretanama itd. Zbog svog većeg dometa, pogodne su za korišćenje za plaćeno parkiranje: vozač ne mora da dovede karticu blizu čitača, jer se aktivira iz daljine. U isto vreme, niskofrekventne oznake su vrlo primitivne, imaju nisku brzinu prenosa podataka. Iz tog razloga, nemoguće je implementirati složen dvostrani prenos podataka za stvari kao što su održavanje stanja i kriptografija. Niskofrekventne oznake samo prenose svoj kratki ID bez ikakvih sredstava za autentifikaciju.

Ovi uređaji se oslanjaju na **pasivnu** **RFID** tehnologiju i rade u **opsegu od 30 kHz do 300 kHz**, iako je uobičajeno koristiti 125 kHz do 134 kHz:

- **Dugi domet** — niža frekvencija prevodi se u veći domet. Postoje neki EM-Marin i HID čitači, koji rade na udaljenosti do jednog metra. Ovi se često koriste u parkiranju automobila.
- **Primitivni protokol** — zbog niske brzine prenosa podataka, ove oznake mogu samo prenositi svoj kratki ID. U većini slučajeva, podaci nisu autentifikovani i nisu zaštićeni na bilo koji način. Čim je kartica u dometu čitača, jednostavno počinje da prenosi svoj ID.
- **Niska bezbednost** — Ove kartice se lako mogu kopirati, ili čak pročitati iz tuđih džepova zbog primitivnosti protokola.

**Popularni 125 kHz protokoli:**

- **EM-Marin** — EM4100, EM4102. Najpopularniji protokol u CIS-u. Može se čitati sa udaljenosti od oko jednog metra zbog svoje jednostavnosti i stabilnosti.
- **HID Prox II** — niskofrekventni protokol koji je uveo HID Global. Ovaj protokol je popularniji u zapadnim zemljama. Složeniji je i kartice i čitači za ovaj protokol su relativno skupi.
- **Indala** — vrlo stari niskofrekventni protokol koji je uveo Motorola, a kasnije ga je kupio HID. Manje je verovatno da ćete ga sresti u prirodi u poređenju sa prethodna dva jer izlazi iz upotrebe.

U stvarnosti, postoji mnogo više niskofrekventnih protokola. Ali svi koriste istu modulaciju na fizičkom sloju i mogu se smatrati, na jedan ili drugi način, varijacijom onih navedenih iznad.

### Napad

Možete **napasti ove oznake sa Flipper Zero**:

{{#ref}}
flipper-zero/fz-125khz-rfid.md
{{#endref}}

## Visokofrekventne RFID oznake (13.56 MHz)

**Visokofrekventne oznake** se koriste za složeniju interakciju između čitača i oznake kada su potrebni kriptografija, veliki dvostrani prenos podataka, autentifikacija itd.\
Obično se nalaze u bankovnim karticama, javnom prevozu i drugim sigurnim propusnicama.

**Visokofrekventne 13.56 MHz oznake su skup standarda i protokola**. Obično se nazivaju [NFC](https://nfc-forum.org/what-is-nfc/about-the-technology/), ali to nije uvek tačno. Osnovni skup protokola koji se koristi na fizičkom i logičkom nivou je ISO 14443. Visokolevelski protokoli, kao i alternativni standardi (poput ISO 19092), zasnivaju se na njemu. Mnogi ljudi ovu tehnologiju nazivaju **Komunikacija u bliskom polju (NFC)**, termin za uređaje koji rade na frekvenciji od 13.56 MHz.

<figure><img src="../../images/image (930).png" alt=""><figcaption></figcaption></figure>

Ukratko, arhitektura NFC funkcioniše ovako: protokol prenosa bira kompanija koja pravi kartice i implementira se na osnovu niskolevelskog ISO 14443. Na primer, NXP je izmislio svoj vlastiti visokolevelski protokol prenosa pod nazivom Mifare. Ali na nižem nivou, Mifare kartice se zasnivaju na ISO 14443-A standardu.

Flipper može interagovati i sa niskolevelskim ISO 14443 protokolom, kao i sa Mifare Ultralight protokolom prenosa podataka i EMV-om koji se koristi u bankovnim karticama. Radimo na dodavanju podrške za Mifare Classic i NFC NDEF. Temeljno razmatranje protokola i standarda koji čine NFC zaslužuje poseban članak koji planiramo da objavimo kasnije.

Sve visokofrekventne kartice zasnovane na ISO 14443-A standardu imaju jedinstveni ID čipa. On deluje kao serijski broj kartice, poput MAC adrese mrežne kartice. **Obično, UID je dug 4 ili 7 bajtova**, ali može retko ići **do 10**. UIDs nisu tajni i lako se čitaju, **ponekad čak i odštampani na samoj kartici**.

Postoji mnogo sistema kontrole pristupa koji se oslanjaju na UID da **autentifikuju i odobre pristup**. Ponekad se to dešava **čak i kada RFID oznake** **podržavaju kriptografiju**. Takva **zloupotreba** ih snižava na nivo glupih **125 kHz kartica** u smislu **bezbednosti**. Virtuelne kartice (poput Apple Pay) koriste dinamički UID kako vlasnici telefona ne bi mogli otvarati vrata sa svojom aplikacijom za plaćanje.

- **Mali domet** — visokofrekventne kartice su posebno dizajnirane tako da moraju biti postavljene blizu čitača. To takođe pomaže u zaštiti kartice od neovlašćenih interakcija. Maksimalni domet čitanja koji smo uspeli da postignemo bio je oko 15 cm, i to sa čitačima visokog dometa po meri.
- **Napredni protokoli** — brzine prenosa podataka do 424 kbps omogućavaju složene protokole sa punim dvostranim prenosom podataka. Što zauzvrat **omogućava kriptografiju**, prenos podataka itd.
- **Visoka bezbednost** — visokofrekventne bežične kartice ni na koji način nisu inferiorne u odnosu na pametne kartice. Postoje kartice koje podržavaju kriptografski jake algoritme poput AES i implementiraju asimetričnu kriptografiju.

### Napad

Možete **napasti ove oznake sa Flipper Zero**:

{{#ref}}
flipper-zero/fz-nfc.md
{{#endref}}

Ili koristeći **proxmark**:

{{#ref}}
proxmark-3.md
{{#endref}}

### Izrada prenosnog HID MaxiProx 125 kHz mobilnog klonera

Ako vam je potrebno **rešenje sa dugim dometom**, **na baterije** za prikupljanje HID Prox® bedževa tokom red-team angažmana, možete pretvoriti zidni **HID MaxiProx 5375** čitač u samostalni kloner koji staje u ranac. Potpuni mehanički i električni vodič je dostupan ovde:

{{#ref}}
maxiprox-mobile-cloner.md
{{#endref}}

---

## Reference

- [https://blog.flipperzero.one/rfid/](https://blog.flipperzero.one/rfid/)
- [Let's Clone a Cloner – Part 3 (TrustedSec)](https://trustedsec.com/blog/lets-clone-a-cloner-part-3-putting-it-all-together)

{{#include ../../banners/hacktricks-training.md}}
