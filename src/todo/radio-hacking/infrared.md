# Υπέρυθρη

{{#include ../../banners/hacktricks-training.md}}

## Πώς λειτουργεί η Υπέρυθρη <a href="#how-the-infrared-port-works" id="how-the-infrared-port-works"></a>

**Το υπέρυθρο φως είναι αόρατο για τους ανθρώπους**. Το μήκος κύματος IR κυμαίνεται από **0.7 έως 1000 μικρόμετρα**. Οι οικιακοί τηλεχειριστήρες χρησιμοποιούν ένα σήμα IR για τη μετάδοση δεδομένων και λειτουργούν στο εύρος μήκους κύματος 0.75..1.4 μικρόμετρα. Ένας μικροελεγκτής στον τηλεχειριστήριο κάνει μια υπέρυθρη LED να αναβοσβήνει με μια συγκεκριμένη συχνότητα, μετατρέποντας το ψηφιακό σήμα σε σήμα IR.

Για να ληφθούν σήματα IR χρησιμοποιείται ένας **φωτοδέκτης**. Αυτός **μετατρέπει το υπέρυθρο φως σε παλμούς τάσης**, οι οποίοι είναι ήδη **ψηφιακά σήματα**. Συνήθως, υπάρχει ένα **φίλτρο σκοτεινού φωτός μέσα στον δέκτη**, το οποίο επιτρέπει **μόνο το επιθυμητό μήκος κύματος** και κόβει τον θόρυβο.

### Ποικιλία Πρωτοκόλλων IR <a href="#variety-of-ir-protocols" id="variety-of-ir-protocols"></a>

Τα πρωτόκολλα IR διαφέρουν σε 3 παράγοντες:

- κωδικοποίηση bit
- δομή δεδομένων
- συχνότητα φορέα — συχνά στο εύρος 36..38 kHz

#### Τρόποι κωδικοποίησης bit <a href="#bit-encoding-ways" id="bit-encoding-ways"></a>

**1. Κωδικοποίηση Απόστασης Παλμού**

Τα bits κωδικοποιούνται με την τροποποίηση της διάρκειας του διαστήματος μεταξύ των παλμών. Το πλάτος του παλμού είναι σταθερό.

<figure><img src="../../images/image (295).png" alt=""><figcaption></figcaption></figure>

**2. Κωδικοποίηση Πλάτους Παλμού**

Τα bits κωδικοποιούνται με την τροποποίηση του πλάτους του παλμού. Το πλάτος του διαστήματος μετά την έκρηξη του παλμού είναι σταθερό.

<figure><img src="../../images/image (282).png" alt=""><figcaption></figcaption></figure>

**3. Κωδικοποίηση Φάσης**

Είναι επίσης γνωστή ως κωδικοποίηση Manchester. Η λογική τιμή καθορίζεται από την πολικότητα της μετάβασης μεταξύ της έκρηξης του παλμού και του διαστήματος. "Διάστημα σε έκρηξη παλμού" δηλώνει λογική "0", "έκρηξη παλμού σε διάστημα" δηλώνει λογική "1".

<figure><img src="../../images/image (634).png" alt=""><figcaption></figcaption></figure>

**4. Συνδυασμός των προηγούμενων και άλλων εξωτικών**

> [!TIP]
> Υπάρχουν πρωτόκολλα IR που **προσπαθούν να γίνουν καθολικά** για αρκετούς τύπους συσκευών. Τα πιο διάσημα είναι τα RC5 και NEC. Δυστυχώς, το πιο διάσημο **δεν σημαίνει το πιο κοινό**. Στο περιβάλλον μου, συνάντησα μόνο δύο τηλεχειριστήρια NEC και κανένα RC5.
>
> Οι κατασκευαστές αγαπούν να χρησιμοποιούν τα δικά τους μοναδικά πρωτόκολλα IR, ακόμη και εντός της ίδιας κατηγορίας συσκευών (για παράδειγμα, TV-boxes). Επομένως, τα τηλεχειριστήρια από διαφορετικές εταιρείες και μερικές φορές από διαφορετικά μοντέλα της ίδιας εταιρείας, δεν μπορούν να λειτουργήσουν με άλλες συσκευές του ίδιου τύπου.

### Εξερεύνηση ενός σήματος IR

Ο πιο αξιόπιστος τρόπος για να δείτε πώς φαίνεται το σήμα IR του τηλεχειριστηρίου είναι να χρησιμοποιήσετε ένα παλμογράφο. Δεν αποδιαμορφώνει ή αναστρέφει το ληφθέν σήμα, απλά εμφανίζεται "όπως είναι". Αυτό είναι χρήσιμο για δοκιμές και αποσφαλμάτωση. Θα δείξω το αναμενόμενο σήμα με το παράδειγμα του πρωτοκόλλου NEC IR.

<figure><img src="../../images/image (235).png" alt=""><figcaption></figcaption></figure>

Συνήθως, υπάρχει μια προάγγελος στην αρχή ενός κωδικοποιημένου πακέτου. Αυτό επιτρέπει στον δέκτη να προσδιορίσει το επίπεδο ενίσχυσης και το υπόβαθρο. Υπάρχουν επίσης πρωτόκολλα χωρίς προάγγελο, για παράδειγμα, Sharp.

Στη συνέχεια, μεταδίδονται τα δεδομένα. Η δομή, η προάγγελος και η μέθοδος κωδικοποίησης bit καθορίζονται από το συγκεκριμένο πρωτόκολλο.

**Το πρωτόκολλο NEC IR** περιέχει μια σύντομη εντολή και έναν κωδικό επανάληψης, ο οποίος αποστέλλεται ενώ το κουμπί είναι πατημένο. Και η εντολή και ο κωδικός επανάληψης έχουν την ίδια προάγγελο στην αρχή.

Η **εντολή NEC**, εκτός από την προάγγελο, αποτελείται από ένα byte διεύθυνσης και ένα byte αριθμού εντολής, με το οποίο η συσκευή καταλαβαίνει τι πρέπει να εκτελέσει. Τα byte διεύθυνσης και αριθμού εντολής επαναλαμβάνονται με αντίστροφες τιμές, για να ελέγξουν την ακεραιότητα της μετάδοσης. Υπάρχει ένα επιπλέον bit διακοπής στο τέλος της εντολής.

Ο **κωδικός επανάληψης** έχει ένα "1" μετά την προάγγελο, το οποίο είναι ένα bit διακοπής.

Για **λογική "0" και "1"** το NEC χρησιμοποιεί Κωδικοποίηση Απόστασης Παλμού: πρώτα, μεταδίδεται μια έκρηξη παλμού μετά την οποία υπάρχει μια παύση, το μήκος της οποίας καθορίζει την τιμή του bit.

### Κλιματιστικά

Σε αντίθεση με άλλους τηλεχειριστήρες, **τα κλιματιστικά δεν μεταδίδουν απλώς τον κωδικό του πατημένου κουμπιού**. Επίσης **μεταδίδουν όλες τις πληροφορίες** όταν πατηθεί ένα κουμπί για να διασφαλίσουν ότι η **μηχανή κλιματισμού και το τηλεχειριστήριο είναι συγχρονισμένα**.\
Αυτό θα αποτρέψει το να αυξηθεί η θερμοκρασία από 20ºC σε 21ºC με ένα τηλεχειριστήριο, και στη συνέχεια όταν χρησιμοποιηθεί ένα άλλο τηλεχειριστήριο, το οποίο έχει ακόμα τη θερμοκρασία ως 20ºC, να αυξηθεί περισσότερο η θερμοκρασία, θα "αυξηθεί" σε 21ºC (και όχι σε 22ºC νομίζοντας ότι είναι σε 21ºC).

---

## Επιθέσεις & Επιθετική Έρευνα <a href="#attacks" id="attacks"></a>

Μπορείτε να επιτεθείτε στην Υπέρυθρη με το Flipper Zero:

{{#ref}}
flipper-zero/fz-infrared.md
{{#endref}}

### Ανάληψη Smart-TV / Set-top Box (EvilScreen)

Πρόσφατη ακαδημαϊκή εργασία (EvilScreen, 2022) απέδειξε ότι **οι τηλεχειριστήρες πολλαπλών καναλιών που συνδυάζουν Υπέρυθρη με Bluetooth ή Wi-Fi μπορούν να καταχραστούν για να αναλάβουν πλήρως σύγχρονες smart-TVs**. Η επίθεση συνδυάζει κωδικούς υπηρεσίας IR υψηλής προνομίας με πιστοποιημένα πακέτα Bluetooth, παρακάμπτοντας την απομόνωση καναλιών και επιτρέποντας αυθαίρετες εκκινήσεις εφαρμογών, ενεργοποίηση μικροφώνου ή εργοστασιακή επαναφορά χωρίς φυσική πρόσβαση. Οκτώ mainstream τηλεοράσεις από διαφορετικούς προμηθευτές — συμπεριλαμβανομένου ενός μοντέλου Samsung που ισχυρίζεται ότι συμμορφώνεται με το ISO/IEC 27001 — επιβεβαιώθηκαν ευάλωτες. Η μείωση απαιτεί διορθώσεις firmware από τον προμηθευτή ή πλήρη απενεργοποίηση των μη χρησιμοποιούμενων δέκτων IR.

### Εξαγωγή Δεδομένων μέσω IR LEDs (οικογένεια aIR-Jumper)

Οι κάμερες ασφαλείας, οι δρομολογητές ή ακόμη και κακόβουλα USB sticks περιλαμβάνουν συχνά **LED υπέρυθρης νυχτερινής όρασης**. Η έρευνα δείχνει ότι το κακόβουλο λογισμικό μπορεί να τροποποιήσει αυτά τα LED (<10–20 kbit/s με απλή OOK) για να **εξάγει μυστικά μέσω τοίχων και παραθύρων** σε μια εξωτερική κάμερα τοποθετημένη δεκάδες μέτρα μακριά. Επειδή το φως είναι εκτός του ορατού φάσματος, οι χειριστές σπάνια το παρατηρούν. Αντεπίθετα μέτρα:

* Φυσική ασπίδα ή αφαίρεση LED IR σε ευαίσθητες περιοχές
* Παρακολούθηση του κύκλου εργασίας LED κάμερας και της ακεραιότητας του firmware
* Εγκατάσταση φίλτρων IR-cut σε παράθυρα και κάμερες παρακολούθησης

Ένας επιτιθέμενος μπορεί επίσης να χρησιμοποιήσει ισχυρούς προβολείς IR για να **διεισδύσει** εντολές στο δίκτυο αναβοσβήνοντας δεδομένα πίσω σε ανασφαλείς κάμερες.

### Μακροχρόνια Βίαιη Δύναμη & Επεκτεταμένα Πρωτόκολλα με Flipper Zero 1.0

Το firmware 1.0 (Σεπτέμβριος 2024) πρόσθεσε **δεκάδες επιπλέον πρωτόκολλα IR και προαιρετικά εξωτερικά ενισχυτικά modules**. Συνδυασμένο με τη λειτουργία βίαιης δύναμης καθολικού τηλεχειριστηρίου, ένα Flipper μπορεί να απενεργοποιήσει ή να επαναρυθμίσει τις περισσότερες δημόσιες τηλεοράσεις/κλιματιστικά από απόσταση έως 30 μ. χρησιμοποιώντας μια ισχυρή δίοδο.

---

## Εργαλεία & Πρακτικά Παραδείγματα <a href="#tooling" id="tooling"></a>

### Υλικό

* **Flipper Zero** – φορητός πομποδέκτης με λειτουργίες εκμάθησης, αναπαραγωγής και βίαιης δύναμης (βλ. παραπάνω).
* **Arduino / ESP32** + IR LED / δέκτης TSOP38xx – φθηνός αναλυτής/πομπός DIY. Συνδυάστε με τη βιβλιοθήκη `Arduino-IRremote` (v4.x υποστηρίζει >40 πρωτόκολλα).
* **Λογικοί αναλυτές** (Saleae/FX2) – καταγραφή ωμών χρονισμών όταν το πρωτόκολλο είναι άγνωστο.
* **Smartphones με IR-blaster** (π.χ., Xiaomi) – γρήγορη δοκιμή πεδίου αλλά περιορισμένη εμβέλεια.

### Λογισμικό

* **`Arduino-IRremote`** – ενεργά συντηρημένη βιβλιοθήκη C++:
```cpp
#include <IRremote.hpp>
IRsend sender;
void setup(){ sender.begin(); }
void loop(){
sender.sendNEC(0x20DF10EF, 32); // Samsung TV Power
delay(5000);
}
```
* **IRscrutinizer / AnalysIR** – GUI αποκωδικοποιητές που εισάγουν ωμές καταγραφές και αυτόματα αναγνωρίζουν το πρωτόκολλο + παράγουν κώδικα Pronto/Arduino.
* **LIRC / ir-keytable (Linux)** – λήψη και έγχυση IR από τη γραμμή εντολών:
```bash
sudo ir-keytable -p nec,rc5 -t   # live-dump decoded scancodes
irsend SEND_ONCE samsung KEY_POWER
```

---

## Αμυντικά Μέτρα <a href="#defense" id="defense"></a>

* Απενεργοποιήστε ή καλύψτε τους δέκτες IR σε συσκευές που αναπτύσσονται σε δημόσιους χώρους όταν δεν απαιτείται.
* Επιβάλλετε *ζευγάρωμα* ή κρυπτογραφικούς ελέγχους μεταξύ smart-TVs και τηλεχειριστηρίων; απομονώστε τους προνομιακούς "κωδικούς υπηρεσίας".
* Εγκαταστήστε φίλτρα IR-cut ή ανιχνευτές συνεχούς κύματος γύρω από ταξινομημένες περιοχές για να σπάσετε οπτικά κρυφά κανάλια.
* Παρακολουθήστε την ακεραιότητα του firmware των καμερών/IoT συσκευών που εκθέτουν ελεγχόμενα LED IR.

## Αναφορές

- [Flipper Zero Infrared blog post](https://blog.flipperzero.one/infrared/)
- EvilScreen: Ανάληψη Smart TV μέσω μίμησης τηλεχειριστηρίου (arXiv 2210.03014)

{{#include ../../banners/hacktricks-training.md}}
