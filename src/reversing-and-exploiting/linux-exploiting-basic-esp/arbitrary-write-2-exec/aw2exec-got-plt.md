# AW2Exec - GOT/PLT

{{#include ../../../banners/hacktricks-training.md}}

## **基本情報**

### **GOT: グローバルオフセットテーブル**

**グローバルオフセットテーブル (GOT)** は、動的リンクバイナリで**外部関数のアドレス**を管理するために使用されるメカニズムです。これらの**アドレスは実行時まで知られない**ため（動的リンクのため）、GOTは**これらの外部シンボルのアドレスを動的に更新する方法**を提供します。

GOTの各エントリは、バイナリが呼び出す可能性のある外部ライブラリのシンボルに対応しています。**関数が最初に呼び出されると、その実際のアドレスは動的リンカーによって解決され、GOTに保存されます**。同じ関数への後続の呼び出しは、GOTに保存されたアドレスを使用し、再度アドレスを解決するオーバーヘッドを回避します。

### **PLT: プロシージャリンクテーブル**

**プロシージャリンクテーブル (PLT)** はGOTと密接に連携し、外部関数への呼び出しを処理するためのトランポリンとして機能します。バイナリが**外部関数を初めて呼び出すと、制御はその関数に関連付けられたPLTのエントリに渡されます**。このPLTエントリは、関数のアドレスがまだ解決されていない場合、動的リンカーを呼び出してアドレスを解決する責任があります。アドレスが解決された後、それはGOTに保存されます。

**したがって、** GOTエントリは外部関数または変数のアドレスが解決された後に直接使用されます。**PLTエントリは、動的リンカーを介してこれらのアドレスの初期解決を促進するために使用されます。**

## 実行を取得

### GOTを確認

GOTテーブルへのアドレスを取得するには: **`objdump -s -j .got ./exec`**

![](<../../../images/image (619).png>)

GEFで**実行可能ファイル**を**読み込む**と、**GOT**にある**関数**を**見る**ことができます: `gef➤ x/20x 0xADDR_GOT`

![](<../../../images/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

GEFを使用して**デバッグ**セッションを**開始**し、**`got`**を実行してGOTテーブルを表示できます:

![](<../../../images/image (621).png>)

### GOT2Exec

バイナリ内のGOTは、**関数のアドレス**または**PLT**セクションのアドレスを持っています。この任意の書き込みの目的は、後で実行される関数の**GOTエントリを上書きすること**です。例えば、**`system`** **関数**のPLTの**アドレス**で上書きします。

理想的には、**あなたが制御するパラメータで呼び出される関数のGOTを上書きする**ことになります（これにより、system関数に送信されるパラメータを制御できるようになります）。

もし**`system`** **がスクリプトで使用されていない場合**、system関数はPLTにエントリを持ちません。このシナリオでは、最初に`system`関数のアドレスを**リーク**し、その後GOTをこのアドレスを指すように上書きする必要があります。

PLTアドレスは**`objdump -j .plt -d ./vuln_binary`**で見ることができます。

## **One Gadget**

{{#ref}}
../one-gadget.md
{{#endref}}

## **保護**

**フルRELRO**保護は、バイナリが起動されるときにすべての関数のアドレスを解決し、その後**GOTテーブルを読み取り専用**にすることで、この種の技術から保護することを目的としています:

{{#ref}}
../common-binary-protections-and-bypasses/relro.md
{{#endref}}

## 参考文献

- [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
- [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{{#include ../../../banners/hacktricks-training.md}}
