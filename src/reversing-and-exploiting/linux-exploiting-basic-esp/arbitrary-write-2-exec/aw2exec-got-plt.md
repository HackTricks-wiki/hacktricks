# AW2Exec - GOT/PLT

{{#include ../../../banners/hacktricks-training.md}}

## **Grundinformationen**

### **GOT: Globale Offset-Tabelle**

Die **Globale Offset-Tabelle (GOT)** ist ein Mechanismus, der in dynamisch verlinkten Binärdateien verwendet wird, um die **Adressen externer Funktionen** zu verwalten. Da diese **Adressen bis zur Laufzeit nicht bekannt sind** (aufgrund der dynamischen Verlinkung), bietet die GOT eine Möglichkeit, die **Adressen dieser externen Symbole dynamisch zu aktualisieren**, sobald sie aufgelöst sind.

Jeder Eintrag in der GOT entspricht einem Symbol in den externen Bibliotheken, die die Binärdatei aufrufen kann. Wenn eine **Funktion zum ersten Mal aufgerufen wird, wird ihre tatsächliche Adresse vom dynamischen Linker aufgelöst und in der GOT gespeichert**. Nachfolgende Aufrufe der gleichen Funktion verwenden die in der GOT gespeicherte Adresse, wodurch der Overhead des erneuten Auflösens der Adresse vermieden wird.

### **PLT: Prozedurenverknüpfungstabelle**

Die **Prozedurenverknüpfungstabelle (PLT)** arbeitet eng mit der GOT zusammen und dient als Trampolin, um Aufrufe an externe Funktionen zu handhaben. Wenn eine Binärdatei **eine externe Funktion zum ersten Mal aufruft, wird die Kontrolle an einen Eintrag in der PLT übergeben, der mit dieser Funktion verknüpft ist**. Dieser PLT-Eintrag ist dafür verantwortlich, den dynamischen Linker aufzurufen, um die Adresse der Funktion aufzulösen, falls sie noch nicht aufgelöst wurde. Nachdem die Adresse aufgelöst wurde, wird sie in der GOT gespeichert.

**Daher** werden GOT-Einträge direkt verwendet, sobald die Adresse einer externen Funktion oder Variablen aufgelöst ist. **PLT-Einträge werden verwendet, um die anfängliche Auflösung** dieser Adressen über den dynamischen Linker zu erleichtern.

## Ausführung erhalten

### Überprüfen Sie die GOT

Holen Sie sich die Adresse zur GOT-Tabelle mit: **`objdump -s -j .got ./exec`**

![](<../../../images/image (619).png>)

Beobachten Sie, wie Sie nach dem **Laden** der **ausführbaren Datei** in GEF die **Funktionen** sehen können, die in der **GOT** sind: `gef➤ x/20x 0xADDR_GOT`

![](<../../../images/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

Mit GEF können Sie eine **Debugging**-Sitzung **starten** und **`got`** ausführen, um die GOT-Tabelle zu sehen:

![](<../../../images/image (621).png>)

### GOT2Exec

In einer Binärdatei hat die GOT die **Adressen zu den Funktionen oder** zum **PLT**-Abschnitt, der die Funktionsadresse lädt. Das Ziel dieses willkürlichen Schreibens ist es, einen **GOT-Eintrag** einer Funktion, die später ausgeführt wird, **mit** der **Adresse** des PLT der **`system`** **Funktion** beispielsweise zu **überschreiben**.

Idealerweise werden Sie die **GOT** einer **Funktion** **überschreiben**, die **mit von Ihnen kontrollierten Parametern aufgerufen wird** (so dass Sie die an die Systemfunktion gesendeten Parameter kontrollieren können).

Wenn **`system`** **nicht verwendet wird** von dem Skript, wird die Systemfunktion **keinen** Eintrag in der PLT haben. In diesem Szenario müssen Sie **zuerst die Adresse** der `system`-Funktion **leaken** und dann die GOT überschreiben, um auf diese Adresse zu zeigen.

Sie können die PLT-Adressen mit **`objdump -j .plt -d ./vuln_binary`** sehen.

## **One Gadget**

{{#ref}}
../one-gadget.md
{{#endref}}

## **Schutzmaßnahmen**

Der **Full RELRO**-Schutz soll gegen diese Art von Technik schützen, indem er alle Adressen der Funktionen beim Start der Binärdatei auflöst und die **GOT-Tabelle nachher schreibgeschützt** macht:

{{#ref}}
../common-binary-protections-and-bypasses/relro.md
{{#endref}}

## Referenzen

- [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
- [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{{#include ../../../banners/hacktricks-training.md}}
