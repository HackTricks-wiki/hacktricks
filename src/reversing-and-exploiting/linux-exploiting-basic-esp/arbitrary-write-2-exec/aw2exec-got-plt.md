# AW2Exec - GOT/PLT

{{#include ../../../banners/hacktricks-training.md}}

## **基本信息**

### **GOT: 全局偏移表**

**全局偏移表 (GOT)** 是一种用于动态链接二进制文件的机制，用于管理**外部函数的地址**。由于这些**地址在运行时才会被知道**（由于动态链接），GOT 提供了一种方法来**动态更新这些外部符号的地址**，一旦它们被解析。

GOT 中的每个条目对应于二进制文件可能调用的外部库中的一个符号。当**函数第一次被调用时，其实际地址由动态链接器解析并存储在 GOT 中**。对同一函数的后续调用使用存储在 GOT 中的地址，从而避免了再次解析地址的开销。

### **PLT: 过程链接表**

**过程链接表 (PLT)** 与 GOT 密切合作，作为处理对外部函数调用的跳板。当二进制文件**第一次调用外部函数时，控制权会传递给与该函数关联的 PLT 中的一个条目**。这个 PLT 条目负责调用动态链接器来解析函数的地址，如果它尚未被解析。地址解析后，会存储在 GOT 中。

**因此，** 一旦外部函数或变量的地址被解析，GOT 条目就会被直接使用。**PLT 条目用于通过动态链接器促进这些地址的初始解析。**

## 获取执行

### 检查 GOT

使用以下命令获取 GOT 表的地址：**`objdump -s -j .got ./exec`**

![](<../../../images/image (619).png>)

观察在 GEF 中**加载**可执行文件后，您可以**看到**在**GOT**中的**函数**：`gef➤ x/20x 0xADDR_GOT`

![](<../../../images/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

使用 GEF，您可以**开始**一个**调试**会话并执行**`got`**以查看 GOT 表：

![](<../../../images/image (621).png>)

### GOT2Exec

在二进制文件中，GOT 包含**函数的地址或**指向将加载函数地址的**PLT**部分。此任意写入的目标是**覆盖一个将要执行的函数的 GOT 条目**，例如用**`system`** **函数的 PLT 地址**。

理想情况下，您将**覆盖**一个**将被您控制的参数调用的函数的 GOT**（这样您就可以控制发送给系统函数的参数）。

如果脚本中**未使用**`system`，则系统函数在 PLT 中**不会**有条目。在这种情况下，您需要**首先泄漏 `system` 函数的地址**，然后覆盖 GOT 以指向该地址。

您可以使用**`objdump -j .plt -d ./vuln_binary`**查看 PLT 地址。

## **One Gadget**

{{#ref}}
../one-gadget.md
{{#endref}}

## **保护措施**

**完全 RELRO** 保护旨在通过在二进制文件启动时解析所有函数的地址并在此之后使**GOT 表只读**来防止这种技术：

{{#ref}}
../common-binary-protections-and-bypasses/relro.md
{{#endref}}

## 参考

- [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
- [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{{#include ../../../banners/hacktricks-training.md}}
