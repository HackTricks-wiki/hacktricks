# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> Sasa ni **ajabu sana kupata binary yenye sehemu ya .dtors**.

Destructors ni kazi ambazo **zinafanywa kabla ya programu kumaliza** (baada ya `main` function kurudi).\
Anwani za kazi hizi zimehifadhiwa ndani ya **`.dtors`** sehemu ya binary na kwa hivyo, ikiwa utaweza **kuandika** **anwani** kwenye **shellcode** katika **`__DTOR_END__`**, hiyo itakuwa **inafanywa** kabla ya programu kumaliza.

Pata anwani ya sehemu hii kwa:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
Kawaida utaona alama za **DTOR** **katikati** ya thamani `ffffffff` na `00000000`. Hivyo basi, ikiwa unaona tu hizo thamani, inamaanisha kwamba **hakuna kazi iliyosajiliwa**. Hivyo **andika upya** **`00000000`** na **anwani** ya **shellcode** ili kuitekeleza.

> [!WARNING]
> Bila shaka, kwanza unahitaji kupata **mahali pa kuhifadhi shellcode** ili baadaye uweze kuikalia.

## **.fini_array**

Kimsingi hii ni muundo wenye **kazi ambazo zitaitwa** kabla ya programu kumalizika, kama **`.dtors`**. Hii ni ya kuvutia ikiwa unaweza kuita **shellcode yako kwa kuruka tu kwenye anwani**, au katika hali ambapo unahitaji kurudi **kwenye `main`** tena ili **ku exploit udhaifu mara ya pili**.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
Kumbuka kwamba hii **haita** **unda** **mzunguko wa milele** kwa sababu unaporejea kwenye msingi, canary itagundua, mwisho wa stack unaweza kuwa umeharibiwa na kazi hiyo haitarudiwa tena. Hivyo kwa hili utaweza **kuwa na utekelezaji 1 zaidi** wa vuln.

> [!CAUTION]
> Kumbuka kwamba na [Full RELRO](../common-binary-protections-and-bypasses/relro.md), sehemu ya `.fini_array` imefanywa **kusomeka pekee**.

{{#include ../../../banners/hacktricks-training.md}}
