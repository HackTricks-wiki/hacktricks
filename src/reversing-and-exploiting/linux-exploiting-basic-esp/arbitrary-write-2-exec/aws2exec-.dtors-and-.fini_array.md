# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> Vandag is dit baie **vreemd om 'n binêre met 'n .dtors afdeling te vind**.

Die vernietigers is funksies wat **uitgevoer word voordat die program eindig** (nadat die `main` funksie terugkeer).\
Die adresse van hierdie funksies word binne die **`.dtors`** afdeling van die binêre gestoor en daarom, as jy daarin slaag om die **adres** na 'n **shellcode** in **`__DTOR_END__`** te **skryf**, sal dit **uitgevoer** word voordat die programme eindig.

Kry die adres van hierdie afdeling met:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
Gewoonlik sal jy die **DTOR** merkers **tussen** die waardes `ffffffff` en `00000000` vind. So as jy net daardie waardes sien, beteken dit dat daar **geen funksie geregistreer is** nie. So **oorwrite** die **`00000000`** met die **adres** na die **shellcode** om dit uit te voer.

> [!WARNING]
> Natuurlik moet jy eers 'n **plek vind om die shellcode te stoor** sodat jy dit later kan aanroep.

## **.fini_array**

Essensieel is dit 'n struktuur met **funksies wat aangeroep sal word** voordat die program eindig, soos **`.dtors`**. Dit is interessant as jy jou **shellcode kan aanroep deur net na 'n adres te spring**, of in gevalle waar jy weer **terug na `main`** moet gaan om die **kwesbaarheid 'n tweede keer te benut**.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
Let wel, dit **sal nie** 'n **ewige lus** **skep** nie, want wanneer jy terug na die hoof gaan, sal die canary dit opgemerk het, die einde van die stapel mag beskadig wees en die funksie sal nie weer opgeroep word nie. So met dit sal jy in staat wees om **1 meer uitvoering** van die kwesbaarheid te **he**.

> [!CAUTION]
> Let wel dat met [Full RELRO](../common-binary-protections-and-bypasses/relro.md), die afdeling `.fini_array` **lees-slegs** gemaak is.

{{#include ../../../banners/hacktricks-training.md}}
