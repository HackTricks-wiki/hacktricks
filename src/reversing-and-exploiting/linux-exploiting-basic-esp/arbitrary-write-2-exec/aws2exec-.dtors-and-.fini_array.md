# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> आजकल **.dtors सेक्शन वाला बाइनरी ढूंढना बहुत अजीब है**।

डिस्ट्रक्टर्स वे फ़ंक्शन हैं जो **कार्यक्रम समाप्त होने से पहले निष्पादित होते हैं** (जब `main` फ़ंक्शन लौटता है)।\
इन फ़ंक्शनों के पते बाइनरी के **`.dtors`** सेक्शन के अंदर संग्रहीत होते हैं और इसलिए, यदि आप **`__DTOR_END__`** में **शेलकोड** के लिए **पता लिखने** में सफल होते हैं, तो वह **कार्यक्रम समाप्त होने से पहले निष्पादित होगा**।

इस सेक्शन का पता प्राप्त करें:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
आमतौर पर आप **DTOR** मार्कर **`ffffffff`** और **`00000000`** के बीच पाएंगे। इसलिए यदि आप केवल उन मानों को देखते हैं, तो इसका मतलब है कि कोई **फंक्शन रजिस्टर नहीं है**। इसलिए **`00000000`** को **shellcode** के **पते** से **overwrite** करें ताकि इसे निष्पादित किया जा सके।

> [!WARNING]
> बेशक, आपको पहले **shellcode को स्टोर करने के लिए एक स्थान** खोजना होगा ताकि बाद में इसे कॉल किया जा सके।

## **.fini_array**

आधारभूत रूप से यह एक संरचना है जिसमें **फंक्शन होते हैं जो प्रोग्राम समाप्त होने से पहले कॉल किए जाएंगे**, जैसे **`.dtors`**। यह दिलचस्प है यदि आप अपने **shellcode को केवल एक पते पर कूदकर** कॉल कर सकते हैं, या उन मामलों में जहां आपको **फिर से `main`** पर वापस जाने की आवश्यकता होती है ताकि **कमजोरी का दोबारा शोषण** किया जा सके।
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
ध्यान दें कि यह **नहीं** **बनाएगा** एक **शाश्वत लूप** क्योंकि जब आप मुख्य में वापस आएंगे तो कैनरी इसे नोटिस करेगा, स्टैक का अंत भ्रष्ट हो सकता है और फ़ंक्शन फिर से नहीं बुलाया जाएगा। इसलिए इसके साथ आप **एक और निष्पादन** प्राप्त करने में सक्षम होंगे।

> [!CAUTION]
> ध्यान दें कि [Full RELRO](../common-binary-protections-and-bypasses/relro.md) के साथ, अनुभाग `.fini_array` **पढ़ने के लिए केवल** बनाया गया है।

{{#include ../../../banners/hacktricks-training.md}}
