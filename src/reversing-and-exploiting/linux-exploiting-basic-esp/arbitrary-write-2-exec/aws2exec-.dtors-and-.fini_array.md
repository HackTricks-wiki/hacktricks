# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> 现在找到一个带有 .dtors 部分的二进制文件是非常 **奇怪的**。

析构函数是在程序结束之前（在 `main` 函数返回后）**执行的函数**。\
这些函数的地址存储在二进制文件的 **`.dtors`** 部分，因此，如果你设法将 **地址** 写入 **`__DTOR_END__`** 中的 **shellcode**，那么它将在程序结束之前被 **执行**。

获取此部分的地址：
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
通常，您会发现 **DTOR** 标记 **在** 值 `ffffffff` 和 `00000000` 之间。因此，如果您只看到这些值，这意味着 **没有注册任何函数**。所以 **用** **shellcode** 的 **地址** **覆盖** **`00000000`** 以执行它。

> [!WARNING]
> 当然，您首先需要找到一个 **存储 shellcode 的地方** 以便稍后调用它。

## **.fini_array**

本质上，这是一个包含 **将在程序结束前调用的函数** 的结构，类似于 **`.dtors`**。如果您可以通过 **跳转到一个地址** 来调用您的 **shellcode**，或者在需要 **再次返回 `main`** 以 **第二次利用漏洞** 的情况下，这一点很有趣。
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
请注意，这 **不会** **创建** 一个 **永恒循环**，因为当你返回到主函数时，canary 会注意到，栈的末尾可能已被破坏，函数将不会再次被调用。因此，通过这个，你将能够 **再执行 1 次** 漏洞。

> [!CAUTION]
> 请注意，使用 [Full RELRO](../common-binary-protections-and-bypasses/relro.md) 时，`.fini_array` 部分是 **只读** 的。

{{#include ../../../banners/hacktricks-training.md}}
