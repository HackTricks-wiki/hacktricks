# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> Hoje em dia é muito **estranho encontrar um binário com uma seção .dtors**.

Os destruidores são funções que são **executadas antes do programa terminar** (após a função `main` retornar).\
Os endereços dessas funções são armazenados dentro da seção **`.dtors`** do binário e, portanto, se você conseguir **escrever** o **endereço** em um **shellcode** em **`__DTOR_END__`**, isso será **executado** antes que o programa termine.

Obtenha o endereço desta seção com:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
Geralmente, você encontrará os marcadores **DTOR** **entre** os valores `ffffffff` e `00000000`. Então, se você apenas ver esses valores, isso significa que **não há nenhuma função registrada**. Portanto, **sobrescreva** o **`00000000`** com o **endereço** do **shellcode** para executá-lo.

> [!WARNING]
> Claro, você primeiro precisa encontrar um **lugar para armazenar o shellcode** para depois chamá-lo.

## **.fini_array**

Essencialmente, esta é uma estrutura com **funções que serão chamadas** antes do programa terminar, como **`.dtors`**. Isso é interessante se você puder chamar seu **shellcode apenas pulando para um endereço**, ou em casos onde você precisa voltar para **`main`** novamente para **explorar a vulnerabilidade uma segunda vez**.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
Observe que isso **não** **criará** um **loop eterno** porque, quando você voltar para a função principal, o canário notará, o final da pilha pode estar corrompido e a função não será chamada novamente. Assim, com isso, você poderá **ter 1 execução a mais** da vulnerabilidade.

> [!CAUTION]
> Observe que com [Full RELRO](../common-binary-protections-and-bypasses/relro.md), a seção `.fini_array` é tornada **somente leitura**.

{{#include ../../../banners/hacktricks-training.md}}
