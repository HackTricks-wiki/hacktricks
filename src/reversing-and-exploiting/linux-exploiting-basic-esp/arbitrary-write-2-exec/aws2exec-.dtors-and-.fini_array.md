# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> 요즘은 **.dtors 섹션이 있는 바이너리를 찾는 것이 매우 이상합니다**.

소멸자는 프로그램이 **끝나기 전에 실행되는 함수**입니다 ( `main` 함수가 반환된 후).\
이 함수들의 주소는 바이너리의 **`.dtors`** 섹션에 저장되며, 따라서 **`__DTOR_END__`**에 **주소**를 **쉘코드**로 **쓰기**에 성공하면, 프로그램이 끝나기 전에 그것이 **실행됩니다**.

이 섹션의 주소를 얻으려면:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
보통 **DTOR** 마커는 `ffffffff`과 `00000000` 값 사이에 있습니다. 따라서 이 값들만 보인다면 **등록된 함수가 없다는** 의미입니다. 그러므로 **`00000000`**을 **실행할 셸코드의 주소**로 **덮어씌우세요**.

> [!WARNING]
> 물론, 먼저 **셸코드를 저장할 장소를 찾아야** 나중에 호출할 수 있습니다.

## **.fini_array**

본질적으로 이것은 프로그램이 종료되기 전에 **호출될 함수들**로 구성된 구조체입니다. 이는 **`.dtors`**와 유사합니다. 주소로 점프하여 **셸코드를 호출**할 수 있거나, **취약점을 두 번째로 악용하기 위해 다시 `main`으로 돌아가야** 하는 경우에 흥미롭습니다.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
이 **영원한 루프**를 **생성하지** 않을 것임에 유의하세요. 왜냐하면 main으로 돌아갈 때 canary가 이를 감지하고, 스택의 끝이 손상될 수 있으며, 함수가 다시 호출되지 않기 때문입니다. 따라서 이를 통해 **1회 더 실행**할 수 있습니다.

> [!CAUTION]
> [Full RELRO](../common-binary-protections-and-bypasses/relro.md)와 함께 `.fini_array` 섹션이 **읽기 전용**으로 설정된다는 점에 유의하세요.

{{#include ../../../banners/hacktricks-training.md}}
