# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> Günümüzde **.dtors bölümü olan bir ikili bulmak çok tuhaf**.

Yıkıcılar, program **tamamlanmadan önce** ( `main` fonksiyonu döndükten sonra) **çalıştırılan** fonksiyonlardır.\
Bu fonksiyonların adresleri, ikilinin **`.dtors`** bölümünde saklanır ve bu nedenle, eğer **__DTOR_END__**'ye bir **shellcode** adresi **yazmayı** başarırsanız, bu, program sona ermeden önce **çalıştırılacaktır**.

Bu bölümün adresini almak için:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
Genellikle **DTOR** işaretlerini `ffffffff` ve `00000000` değerleri **arasında** bulacaksınız. Yani bu değerleri gördüğünüzde, **kayıtlı bir fonksiyon yoktur** anlamına gelir. Bu yüzden **`00000000`** değerini **shellcode**'un **adresine** **yazın**.

> [!WARNING]
> Elbette, önce **shellcode**'u saklayacak bir **yer bulmanız** gerekiyor, böylece daha sonra onu çağırabilirsiniz.

## **.fini_array**

Temelde bu, program sona ermeden önce **çağrılacak fonksiyonlar** ile bir yapıdır, tıpkı **`.dtors`** gibi. Bu, **shellcode**'unuzu sadece bir adrese atlayarak çağırabiliyorsanız veya **zafiyeti ikinci kez istismar etmek için** tekrar **`main`**'e dönmeniz gereken durumlarda ilginçtir.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
Not edin ki bu **sonsuz bir döngü** **oluşturmayacak** çünkü ana fonksiyona geri döndüğünüzde kanarya bunu fark edecek, yığın sonu bozulmuş olabilir ve fonksiyon tekrar çağrılmayacak. Böylece, bu sayede **1 kez daha yürütme** gerçekleştirebileceksiniz.

> [!CAUTION]
> [Full RELRO](../common-binary-protections-and-bypasses/relro.md) ile birlikte `.fini_array` bölümü **salt okunur** hale gelir. 

{{#include ../../../banners/hacktricks-training.md}}
