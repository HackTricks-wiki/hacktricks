# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> 現在、**.dtors セクションを持つバイナリを見つけるのは非常に奇妙です**。

デストラクタは、**プログラムが終了する前に実行される関数**です（`main` 関数が戻った後）。\
これらの関数のアドレスはバイナリの **`.dtors`** セクションに格納されているため、**`__DTOR_END__`** に **シェルコード** の **アドレス**を書き込むことができれば、それはプログラムが終了する前に **実行されます**。

このセクションのアドレスを取得するには:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
通常、**DTOR** マーカーは `ffffffff` と `00000000` の値の **間** に見つかります。したがって、これらの値だけが見える場合は、**登録された関数がない** ことを意味します。したがって、**`00000000`** を **シェルコード** の **アドレス** で **上書き** します。

> [!WARNING]
> もちろん、最初に **シェルコードを保存する場所** を見つける必要があります。その後、呼び出すことができます。

## **.fini_array**

本質的に、これはプログラムが終了する前に **呼び出される関数** の構造体です。これは **`.dtors`** のように興味深いです。これは、**アドレスにジャンプしてシェルコードを呼び出す** ことができる場合や、**再度脆弱性を悪用するために `main` に戻る** 必要がある場合に役立ちます。
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
注意してください、これは**永遠のループ**を**作成しません**。なぜなら、メインに戻るとカナリアが気づき、スタックの終わりが破損している可能性があり、関数は再度呼び出されないからです。これにより、**もう1回の実行**が可能になります。

> [!CAUTION]
> [Full RELRO](../common-binary-protections-and-bypasses/relro.md)を使用すると、セクション`.fini_array`は**読み取り専用**になります。

{{#include ../../../banners/hacktricks-training.md}}
