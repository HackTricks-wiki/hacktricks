# AWS2Exec - .dtors & .fini_array

{{#include ../../../banners/hacktricks-training.md}}

## .dtors

> [!CAUTION]
> Сьогодні дуже **незвично знайти бінарний файл з секцією .dtors**.

Деструктори - це функції, які **виконуються перед завершенням програми** (після повернення функції `main`).\
Адреси цих функцій зберігаються в секції **`.dtors`** бінарного файлу, і тому, якщо вам вдасться **записати** **адресу** в **shellcode** в **`__DTOR_END__`**, вона буде **виконана** перед завершенням програми.

Отримайте адресу цієї секції за допомогою:
```bash
objdump -s -j .dtors /exec
rabin -s /exec | grep “__DTOR”
```
Зазвичай ви знайдете маркери **DTOR** **між** значеннями `ffffffff` та `00000000`. Тож, якщо ви просто бачите ці значення, це означає, що **функція не зареєстрована**. Тож **перезапишіть** **`00000000`** адресою **shellcode**, щоб виконати його.

> [!WARNING]
> Звичайно, спочатку вам потрібно знайти **місце для зберігання shellcode**, щоб пізніше викликати його.

## **.fini_array**

По суті, це структура з **функціями, які будуть викликані** перед завершенням програми, як **`.dtors`**. Це цікаво, якщо ви можете викликати свій **shellcode, просто стрибнувши на адресу**, або в випадках, коли вам потрібно знову **повернутися до `main`**, щоб **використати вразливість вдруге**.
```bash
objdump -s -j .fini_array ./greeting

./greeting:     file format elf32-i386

Contents of section .fini_array:
8049934 a0850408

#Put your address in 0x8049934
```
Зверніть увагу, що це **не** **створить** **вічний цикл**, оскільки, коли ви повернетеся до main, канарка помітить, що кінець стеку може бути пошкоджений, і функція не буде викликана знову. Таким чином, ви зможете **мати ще 1 виконання** вразливості.

> [!CAUTION]
> Зверніть увагу, що з [Full RELRO](../common-binary-protections-and-bypasses/relro.md) секція `.fini_array` зроблена **тільки для читання**.

{{#include ../../../banners/hacktricks-training.md}}
