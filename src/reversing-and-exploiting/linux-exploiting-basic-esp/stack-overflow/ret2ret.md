# Ret2ret & Reo2pop

{{#include ../../../banners/hacktricks-training.md}}

## Ret2ret

Bu tekniğin ana hedefi, **stack'teki mevcut bir işaretçiyi kötüye kullanarak ASLR'yi atlatmaya çalışmaktır**.

Temelde, stack taşmaları genellikle dizelerden kaynaklanır ve **dizeler bellekte sonlarında bir null byte ile biter**. Bu, stack'te zaten mevcut olan bir işaretçinin gösterdiği yeri azaltmayı denemeye olanak tanır. Yani eğer stack `0xbfffffdd` içeriyorsa, bu taşma onu `0xbfffff00`'a dönüştürebilir (son sıfırlanmış byte'a dikkat edin).

Eğer bu adres stack'teki shellcode'umuza işaret ediyorsa, akışı o adrese ulaştırmak mümkündür **`ret` talimatına adresler ekleyerek** bu adres ulaşılana kadar.

Bu nedenle saldırı şöyle olacaktır:

- NOP sled
- Shellcode
- EIP'den stack'i **`ret` adresleri ile üzerine yazmak** (RET sled)
- 0x00, stack'teki bir adresi değiştirerek NOP sled'e işaret etmesini sağlamak için dize tarafından eklenir

[**bu bağlantıya**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c) bakarak savunmasız bir ikili örneği görebilirsiniz ve [**bu bağlantıda**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c) ise istismarı görebilirsiniz.

## Ret2pop

Eğer **değiştirmek istemediğiniz stack'te mükemmel bir işaretçi bulursanız** (ret2ret'te son en düşük byte'ı `0x00` olarak değiştiriyoruz), aynı `ret2ret` saldırısını gerçekleştirebilirsiniz, ancak **RET sled'in uzunluğu 1 azaltılmalıdır** (böylece son `0x00` mükemmel işaretçinin hemen öncesindeki veriyi üzerine yazar) ve **RET sled'in son** adresi **`pop <reg>; ret`**'e işaret etmelidir.\
Bu şekilde, **mükemmel işaretçiden önceki veri stack'ten kaldırılacaktır** (bu `0x00` tarafından etkilenen veridir) ve **son `ret`, stack'teki mükemmel adrese herhangi bir değişiklik olmadan işaret edecektir**.

[**bu bağlantıya**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c) bakarak savunmasız bir ikili örneği görebilirsiniz ve [**bu bağlantıda**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c) ise istismarı görebilirsiniz.

## References

- [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

{{#include ../../../banners/hacktricks-training.md}}
