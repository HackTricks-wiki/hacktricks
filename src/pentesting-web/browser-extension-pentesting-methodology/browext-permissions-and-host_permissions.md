# BrowExt - izinler & host_permissions

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

### **`permissions`**

İzinler, uzantının **`manifest.json`** dosyasında **`permissions`** özelliği kullanılarak tanımlanır ve bir tarayıcının erişebileceği hemen her şeye (Çerezler veya Fiziksel Depolama) erişim sağlar:

Önceki manifest, uzantının `storage` iznine ihtiyaç duyduğunu belirtir. Bu, verilerini kalıcı olarak depolamak için [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanabileceği anlamına gelir. Kullanıcılara belirli bir kontrol seviyesi veren çerezler veya `localStorage` API'lerinin aksine, **uzantı depolaması genellikle yalnızca uzantıyı kaldırarak temizlenebilir**.

Bir uzantı, **`manifest.json`** dosyasında belirtilen izinleri talep edecektir ve uzantıyı yükledikten sonra, **her zaman tarayıcınızdaki izinlerini kontrol edebilirsiniz**, bu resimde gösterildiği gibi:

<figure><img src="../../images/image (18).png" alt=""><figcaption></figcaption></figure>

Bir Chromium Tarayıcı Uzantısının talep edebileceği [**tam izin listesine buradan ulaşabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve Firefox uzantıları için [**tam listeye buradan ulaşabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions)**.**

### `host_permissions`

İsteğe bağlı ancak güçlü bir ayar olan **`host_permissions`**, uzantının [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) ve [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) gibi API'ler aracılığıyla hangi hostlarla etkileşimde bulunabileceğini belirtir.

Aşağıdaki `host_permissions` temelde her web'e izin verir:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Bu, tarayıcı uzantısının serbestçe erişebileceği hostlardır. Bunun nedeni, bir tarayıcı uzantısı **`fetch("https://gmail.com/")`** çağrısı yaptığında CORS tarafından kısıtlanmamasıdır.

## `permissions` ve `host_permissions` istismar etme

### Sekmeler

Ayrıca, **`host_permissions`** “gelişmiş” [**sekme API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **işlevselliğini de açar.** Uzantının [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) çağrısını yapmasına ve yalnızca **kullanıcının tarayıcı sekmelerinin listesini** almakla kalmayıp aynı zamanda hangi **web sayfasının (adres ve başlık anlamında) yüklü olduğunu öğrenmesine** olanak tanır.

> [!CAUTION]
> Bununla kalmaz, [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **gibi dinleyiciler de çok daha kullanışlı hale gelir.** Bu dinleyiciler, yeni bir sayfa bir sekmeye yüklendiğinde bildirim alır.

### İçerik betiklerini çalıştırma <a href="#running-content-scripts" id="running-content-scripts"></a>

İçerik betikleri, uzantı manifestosuna statik olarak yazılmak zorunda değildir. Yeterli **`host_permissions`** verildiğinde, **uzantılar bunları dinamik olarak yükleyebilir** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **veya** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) çağrısını yaparak.

Her iki API de yalnızca uzantılarda içerik betiği olarak bulunan dosyaları değil, aynı zamanda **rastgele kodu** da çalıştırmaya olanak tanır. İlki, JavaScript kodunu bir dize olarak geçmeye izin verirken, ikincisi, enjekte edilebilirlik açıklarını azaltan bir JavaScript fonksiyonu bekler. Yine de, her iki API de kötüye kullanıldığında büyük zararlara yol açabilir.

> [!CAUTION]
> Yukarıdaki yeteneklere ek olarak, içerik betikleri örneğin **kimlik bilgilerini** web sayfalarına girildiğinde **yakalayabilir.** Onları kötüye kullanmanın bir başka klasik yolu, her bir web sitesine **reklam enjekte etmektir.** Haber sitelerinin güvenilirliğini kötüye kullanmak için **dolandırıcılık mesajları** eklemek de mümkündür. Son olarak, **banka** web sitelerini **manipüle ederek para transferlerini yönlendirebilirler.**

### Dolaylı ayrıcalıklar <a href="#implicit-privileges" id="implicit-privileges"></a>

Bazı uzantı ayrıcalıkları **açıkça beyan edilmek zorunda değildir.** Bir örnek, [sekme API'si](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): temel işlevselliği herhangi bir ayrıcalık olmaksızın erişilebilir. Herhangi bir uzantı, sekmeleri açtığınızda ve kapattığınızda bildirim alabilir, yalnızca bu sekmelerin hangi web siteleriyle ilişkili olduğunu bilmeyecektir.

Görünüşte zararsız mı? [tabs.create() API'si](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) biraz daha az zararsızdır. **Yeni bir sekme oluşturmak için kullanılabilir,** bu da [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ile temelde aynıdır ve herhangi bir web sitesi tarafından çağrılabilir. Ancak `window.open()` **açılır pencere engelleyicisine tabi iken, `tabs.create()` değildir.**

> [!CAUTION]
> Bir uzantı istediği zaman herhangi bir sayıda sekme oluşturabilir.

`tabs.create()` parametrelerine göz attığınızda, yeteneklerinin `window.open()`'un kontrol edebileceğinden çok daha öteye gittiğini de göreceksiniz. Ve Firefox, bu API ile `data:` URI'lerinin kullanılmasına izin vermezken, Chrome'un böyle bir koruması yoktur. **Bu tür URI'lerin üst düzeyde kullanımı,** [**oltalama için kötüye kullanıldığı gerekçesiyle yasaklanmıştır**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) `tabs.create()` ile çok benzer, ancak **mevcut bir sekmeyi değiştirir.** Yani, kötü niyetli bir uzantı örneğin rastgele bir reklam sayfasını sekmelerinizden birine yükleyebilir ve ilgili sekmeyi de etkinleştirebilir.

### Webcam, konum ve arkadaşları <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Web sitelerinin özel izinler talep edebileceğini muhtemelen biliyorsunuzdur, örneğin webcam'inize (video konferans araçları) veya coğrafi konumunuza (haritalar) erişmek için. Bu, kötüye kullanma potansiyeli yüksek olan bir özelliktir, bu nedenle kullanıcıların her seferinde bunu hala istediklerini onaylamaları gerekir.

> [!CAUTION]
> Tarayıcı uzantıları için durum böyle değil. **Eğer bir tarayıcı uzantısı** [**webcam'inize veya mikrofonunuza erişim istiyorsa**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, yalnızca bir kez izin istemesi gerekir.**

Tipik olarak, bir uzantı bunu kurulduktan hemen sonra yapar. Bu istem kabul edildiğinde, **webcam erişimi her zaman mümkündür**, kullanıcı bu noktada uzantıyla etkileşimde bulunmasa bile. Evet, bir kullanıcı yalnızca uzantının gerçekten webcam erişimine ihtiyacı varsa bu istemi kabul eder. Ancak bundan sonra, uzantının gizlice hiçbir şey kaydetmemesi için ona güvenmeleri gerekir.

[**Tam coğrafi konumunuza**](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) veya [panonuzun içeriğine](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API) erişim sağlamak için açıkça izin vermek tamamen gereksizdir. **Bir uzantı, manifestosunun** [**izinler bölümüne**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **`geolocation` veya `clipboard` ekler.** Bu erişim ayrıcalıkları, uzantı yüklendiğinde dolaylı olarak verilir. Bu nedenle, bu ayrıcalıklara sahip kötü niyetli veya tehlikeye atılmış bir uzantı, hareket profilinizi oluşturabilir veya kopyalanan şifreler için panonuzu izleyebilir, siz hiçbir şey fark etmeden.

**`history`** anahtar kelimesinin uzantı manifestosunun [izinler bölümüne](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) eklenmesi, **`history API'sine** [**erişim sağlar**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Bu, kullanıcının tüm tarayıcı geçmişini bir seferde almasına olanak tanır, kullanıcının bu web sitelerini tekrar ziyaret etmesini beklemeden.

**`bookmarks`** **izinleri** benzer kötüye kullanma potansiyeline sahiptir, bu, **tüm yer imlerini** [**yer imleri API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) aracılığıyla okumaya olanak tanır.

### Depolama izni <a href="#the-storage-permission" id="the-storage-permission"></a>

Uzantı depolaması, herhangi bir web sitesinin kullanabileceği [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ile çok benzer bir anahtar-değer koleksiyonudur. Bu nedenle, burada hassas bilgiler saklanmamalıdır.

Ancak, reklam şirketleri de bu depolamayı kötüye kullanabilir.

### Daha fazla izin

Bir Chromium Tarayıcı Uzantısının talep edebileceği [**tam izinler listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve Firefox uzantıları için [**tam listeyi burada bulabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions)**.**

## Önleme <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Google'ın geliştirici politikası, uzantıların işlevselliği için gerekli olandan daha fazla ayrıcalık talep etmesini açıkça yasaklar, bu da aşırı izin taleplerini etkili bir şekilde azaltır. Bir tarayıcı uzantısının bu sınırı aştığı bir örnek, uzantının bir eklenti mağazası yerine tarayıcı ile birlikte dağıtılmasıdır.

Tarayıcılar, uzantı ayrıcalıklarının kötüye kullanılmasını daha da sınırlayabilir. Örneğin, ekran kaydı için kullanılan Chrome'un [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) ve [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) API'leri, kötüye kullanımı en aza indirmek için tasarlanmıştır. tabCapture API'si yalnızca uzantı simgesine tıklamak gibi doğrudan kullanıcı etkileşimi ile etkinleştirilebilirken, desktopCapture, kaydedilecek pencere için kullanıcı onayı gerektirir ve gizli kayıt faaliyetlerini önler.

Ancak, güvenlik önlemlerinin sıkılaştırılması genellikle uzantıların esnekliğini ve kullanıcı dostluğunu azaltır. [activeTab izni](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab_permission) bu dengeyi göstermektedir. Uzantıların tüm internet üzerinde host ayrıcalıkları talep etme gereğini ortadan kaldırmak için tanıtılmıştır, bu da uzantıların yalnızca kullanıcı tarafından açıkça etkinleştirildiğinde mevcut sekmeye erişmesine olanak tanır. Bu model, kullanıcı tarafından başlatılan eylemler gerektiren uzantılar için etkili olsa da, otomatik veya önleyici eylemler gerektirenler için yetersiz kalır ve bu da kullanım kolaylığını ve anlık yanıt verme yeteneğini tehlikeye atar.

## **Referanslar**

- [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
- [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

{{#include ../../banners/hacktricks-training.md}}
