# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

Go JSON рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдБ рдкрд╛рдИ рдЧрдИрдВ, рд╣рд╛рд▓рд╛рдБрдХрд┐ рдпреЗ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рднреА рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдпреЗ рд╕рдорд╕реНрдпрд╛рдПрдБ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/) рдореЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХреА рдЧрдИ рдереАрдВред

Go рдХреЗ JSON, XML, рдФрд░ YAML рдкрд╛рд░реНрд╕рд░реНрд╕ рдореЗрдВ рдЕрд╕рдВрдЧрддрд┐рдпреЛрдВ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбрд┐рдлрд╝реЙрд▓реНрдЯреНрд╕ рдХреА рдПрдХ рд▓рдВрдмреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ**, **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ**, рдпрд╛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### (Un)Marshaling Unexpected Data

рдЙрджреНрджреЗрд╢реНрдп рдЙрди рд╕реНрдЯреНрд░рдХреНрдЪрд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝реАрд▓реНрдб (рдЬреИрд╕реЗ, `IsAdmin`, `Password`) рдХреЛ рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

- Example Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- рд╕рд╛рдорд╛рдиреНрдп рдХрдордЬреЛрд░рд┐рдпрд╛рдБ

1. **рдЧрд╛рдпрдм рдЯреИрдЧ** (рдХреЛрдИ рдЯреИрдЧ = рдлрд╝реАрд▓реНрдб рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрднреА рднреА рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ):
```go
type User struct {
Username string
}
```
рдкреЗрд▓реЛрдб:
```json
{"Username": "admin"}
```
2. **`-` рдХрд╛ рдЧрд▓рдд рдЙрдкрдпреЛрдЧ**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // тЭМ wrong
}
```
рдкреЗрд▓реЛрдб:
```json
{"-": true}
```
тЬФя╕П рдлрд╝реАрд▓реНрдб рдХреЛ (рдЕрди)рдорд╛рд░реНрд╢рд▓ рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХрд╛ рд╕рд╣реА рддрд░реАрдХрд╛:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser Differentials

рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдкрд╛рд░реНрд╕рд░реНрд╕ рдХреИрд╕реЗ рд╕рдорд╛рди рдкреЗрд▓реЛрдб рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЬреИрд╕реЗ рдХрд┐:
- CVE-2017-12635: рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХреБрдВрдЬреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Apache CouchDB рдмрд╛рдпрдкрд╛рд╕
- 2022: XML рдкрд╛рд░реНрд╕рд░ рдЕрд╕рдВрдЧрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Zoom 0-click RCE
- GitLab 2025 SAML рдмрд╛рдпрдкрд╛рд╕ XML рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

**1. рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдлрд╝реАрд▓реНрдб:**
Go рдХрд╛ `encoding/json` **рдЕрдВрддрд┐рдо** рдлрд╝реАрд▓реНрдб рд▓реЗрддрд╛ рд╣реИред
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
рдЕрдиреНрдп рдкрд╛рд░реНрд╕рд░ (рдЬреИрд╕реЗ, Java рдХрд╛ Jackson) **рдкрд╣рд▓рд╛** рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред

**2. рдХреЗрд╕ рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛:**
Go рдХреЗрд╕-рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдпреВрдирд┐рдХреЛрдб рдЯреНрд░рд┐рдХреНрд╕ рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ:
```go
json.Unmarshal([]byte(`{"aтДкtion┼┐": "bypass"}`), &req)
```
**3. рдХреНрд░реЙрд╕-рд╕реЗрд╡рд╛ рдЕрд╕рдВрдЧрддрд┐:**
рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ:
- Go рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдкреНрд░реЙрдХреНрд╕реА
- Python рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ AuthZ рд╕реЗрд╡рд╛

рд╣рдорд▓рд╛рд╡рд░ рднреЗрдЬрддрд╛ рд╣реИ:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python `UserAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
- Go `AdminAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ


### рдбреЗрдЯрд╛ рдлрд╝реЙрд░реНрдореЗрдЯ рднреНрд░рдо (Polyglots)

рд▓рдХреНрд╖реНрдп рдЙрди рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдлрд╝реЙрд░реНрдореЗрдЯ (JSON/XML/YAML) рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВ рдпрд╛ рдкрд╛рд░реНрд╕рд░ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдкрд░ рдЦреБрд▓рд╛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
- **CVE-2020-16250**: HashiCorp Vault рдиреЗ JSON рдХреЛ XML рдкрд╛рд░реНрд╕рд░ рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрдм STS рдиреЗ XML рдХреЗ рдмрдЬрд╛рдп JSON рд▓реМрдЯрд╛рдпрд╛ред

рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ:
- `Accept: application/json` рд╣реЗрдбрд░
- JSON рдмреЙрдбреА рдХрд╛ рдЖрдВрд╢рд┐рдХ рдирд┐рдпрдВрддреНрд░рдг

Go рдХрд╛ XML рдкрд╛рд░реНрд╕рд░ рдЗрд╕реЗ **рдлрд┐рд░ рднреА** рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрдВрдЬреЗрдХреНрдЯ рдХреА рдЧрдИ рдкрд╣рдЪрд╛рди рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред

- рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреЗрд▓реЛрдб:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
Result:
- **Go JSON** parser: `Action_2` (рдХреЗрд╕-рдЗрдВрд╕реЗрдВрд╕рд┐рдЯрд┐рд╡ + рдЕрдВрддрд┐рдо рдЬреАрддрддрд╛ рд╣реИ)
- **YAML** parser: `Action_1` (рдХреЗрд╕-рд╕реЗрдВрд╕рд┐рдЯрд┐рд╡)
- **XML** parser: parses `"Action_3"` inside the string


### ЁЯФР Mitigations

| Risk                        | Fix                                  |
|-----------------------------|---------------------------------------|
| Unknown fields             | `decoder.DisallowUnknownFields()`     |
| Duplicate fields (JSON)    | тЭМ No fix in stdlib                    |
| Case-insensitive match     | тЭМ No fix in stdlib                    |
| XML garbage data           | тЭМ No fix in stdlib                    |
| YAML: unknown keys         | `yaml.KnownFields(true)`              |


{{#include ../banners/hacktricks-training.md}}
