# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Dekoder

SledeÄ‡i problemi su otkriveni u Go JSON-u, iako se mogu pojaviti i u drugim jezicima. Ovi problemi su objavljeni u [**ovom blog postu**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/).

Go-ovi JSON, XML i YAML parseri imaju dugu istoriju nedoslednosti i nesigurnih podrazumevanih postavki koje se mogu iskoristiti za **obiÄ‡i autentifikaciju**, **poveÄ‡ati privilegije** ili **ekstraktovati osetljive podatke**.

### (Un)MarÅ¡alovanje NeoÄekivanih Podataka

Cilj je iskoristiti strukture koje omoguÄ‡avaju napadaÄu da Äita/piÅ¡e osetljiva polja (npr., `IsAdmin`, `Password`).

- Primer Strukture:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- UobiÄajene ranjivosti

1. **NedostajuÄ‡i tag** (bez taga = polje se i dalje obraÄ‘uje po defaultu):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **PogreÅ¡na upotreba `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // âŒ wrong
}
```
Teret:
```json
{"-": true}
```
âœ”ï¸ Pravi naÄin da se blokira polje od (de)serijalizacije:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser Differentials

Cilj je zaobiÄ‡i autorizaciju iskoriÅ¡Ä‡avanjem naÄina na koji razliÄiti parseri razliÄito interpretiraju isti payload, kao u:
- CVE-2017-12635: Apache CouchDB zaobilaÅ¾enje putem duplih kljuÄeva
- 2022: Zoom 0-click RCE putem nekonzistentnosti XML parsera
- GitLab 2025 SAML zaobilaÅ¾enje putem XML Äudnosti

**1. Dupli Polja:**
Go-ov `encoding/json` uzima **poslednje** polje.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
Ostali parseri (npr., Java-ov Jackson) mogu uzeti **prvi**.

**2. Neosetljivost na velika i mala slova:**
Go je neosetljiv na velika i mala slova:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
ÄŒak i Unicode trikovi rade:
```go
json.Unmarshal([]byte(`{"aâ„ªtionÅ¿": "bypass"}`), &req)
```
**3. NeusklaÅ¡enost izmeÄ‘u usluga:**
Zamislite:
- Proxy napisan u Go
- AuthZ usluga napisana u Pythonu

NapadaÄ Å¡alje:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python vidi `UserAction`, dozvoljava ga
- Go vidi `AdminAction`, izvrÅ¡ava ga


### Zbunjenost formata podataka (Poliglot)

Cilj je iskoristiti sisteme koji meÅ¡aju formate (JSON/XML/YAML) ili se otvaraju na greÅ¡kama parsera kao Å¡to su:
- **CVE-2020-16250**: HashiCorp Vault je parsirao JSON sa XML parserom nakon Å¡to je STS vratio JSON umesto XML.

NapadaÄ kontroliÅ¡e:
- `Accept: application/json` zaglavlje
- DelimiÄnu kontrolu nad JSON telom

Go-ov XML parser je to **u svakom sluÄaju** parsirao i verovao ubaÄenom identitetu.

- Kreirani payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
Rezultat:
- **Go JSON** parser: `Action_2` (neosetljivo + poslednje pobednik)
- **YAML** parser: `Action_1` (osetljivo na velika i mala slova)
- **XML** parser: parsira `"Action_3"` unutar stringa


### ğŸ” MoguÄ‡nosti ublaÅ¾avanja

| Rizik                       | ReÅ¡enje                              |
|-----------------------------|---------------------------------------|
| Nepoznata polja            | `decoder.DisallowUnknownFields()`     |
| Duplirana polja (JSON)     | âŒ Nema reÅ¡enja u stdlib              |
| Poklapanje bez obzira na velika i mala slova | âŒ Nema reÅ¡enja u stdlib              |
| XML smeÅ¡ni podaci          | âŒ Nema reÅ¡enja u stdlib              |
| YAML: nepoznati kljuÄevi    | `yaml.KnownFields(true)`              |


{{#include ../banners/hacktricks-training.md}}
