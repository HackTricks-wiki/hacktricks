# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

Les probl√®mes suivants ont √©t√© d√©tect√©s dans le Go JSON bien qu'ils puissent √©galement √™tre pr√©sents dans d'autres langages. Ces probl√®mes ont √©t√© publi√©s dans [**cet article de blog**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/).

Les parseurs JSON, XML et YAML de Go ont une longue liste d'incoh√©rences et de valeurs par d√©faut non s√©curis√©es qui peuvent √™tre exploit√©es pour **contourner l'authentification**, **escalader les privil√®ges** ou **exfiltrer des donn√©es sensibles**.


### (Un)Marshaling Unexpected Data

L'objectif est d'exploiter des structures qui permettent √† un attaquant de lire/√©crire des champs sensibles (par exemple, `IsAdmin`, `Password`).

- Exemple de structure :
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- Vuln√©rabilit√©s courantes

1. **Tag manquant** (pas de tag = le champ est toujours analys√© par d√©faut) :
```go
type User struct {
Username string
}
```
Charge utile :
```json
{"Username": "admin"}
```
2. **Utilisation incorrecte de `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // ‚ùå wrong
}
```
Charge utile :
```json
{"-": true}
```
‚úîÔ∏è M√©thode appropri√©e pour bloquer un champ de (d√©)s√©rialisation :
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Diff√©rences de Parser

L'objectif est de contourner l'autorisation en exploitant la fa√ßon dont diff√©rents parsers interpr√®tent la m√™me charge utile de mani√®re diff√©rente, comme dans :
- CVE-2017-12635 : contournement d'Apache CouchDB via des cl√©s dupliqu√©es
- 2022 : RCE 0-click de Zoom via une incoh√©rence du parser XML
- Contournement SAML de GitLab 2025 via des particularit√©s XML

**1. Champs Dupliqu√©s :**
Le `encoding/json` de Go prend le **dernier** champ.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
D'autres analyseurs (par exemple, Jackson de Java) peuvent prendre le **premier**.

**2. Insensibilit√© √† la casse :**
Go est insensible √† la casse :
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
M√™me les astuces Unicode fonctionnent :
```go
json.Unmarshal([]byte(`{"a‚Ñ™tion≈ø": "bypass"}`), &req)
```
**3. Mismatch entre services :**  
Imaginez :  
- Proxy √©crit en Go  
- Service AuthZ √©crit en Python  

L'attaquant envoie :
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python voit `UserAction`, l'autorise
- Go voit `AdminAction`, l'ex√©cute


### Confusion de format de donn√©es (Polyglots)

L'objectif est d'exploiter des syst√®mes qui m√©langent des formats (JSON/XML/YAML) ou √©chouent en mode ouvert lors d'erreurs de parsing comme :
- **CVE-2020-16250** : HashiCorp Vault a analys√© JSON avec un parseur XML apr√®s que STS a renvoy√© JSON au lieu de XML.

L'attaquant contr√¥le :
- L'en-t√™te `Accept: application/json`
- Un contr√¥le partiel du corps JSON

Le parseur XML de Go l'a analys√© **quand m√™me** et a fait confiance √† l'identit√© inject√©e.

- Charge utile con√ßue :
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
R√©sultat :
- **Go JSON** parser : `Action_2` (insensible √† la casse + dernier gagne)
- **YAML** parser : `Action_1` (sensible √† la casse)
- **XML** parser : analyse `"Action_3"` √† l'int√©rieur de la cha√Æne


### üîê Att√©nuations

| Risque                      | Correction                            |
|-----------------------------|---------------------------------------|
| Champs inconnus             | `decoder.DisallowUnknownFields()`     |
| Champs dupliqu√©s (JSON)     | ‚ùå Pas de correction dans la stdlib    |
| Correspondance insensible √† la casse | ‚ùå Pas de correction dans la stdlib    |
| Donn√©es XML ind√©sirables    | ‚ùå Pas de correction dans la stdlib    |
| YAML : cl√©s inconnues       | `yaml.KnownFields(true)`              |


{{#include ../banners/hacktricks-training.md}}
