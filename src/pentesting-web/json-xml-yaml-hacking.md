# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

Die folgenden Probleme wurden im Go JSON festgestellt, obwohl sie auch in anderen Sprachen vorhanden sein k√∂nnten. Diese Probleme wurden in [**diesem Blogbeitrag**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/) ver√∂ffentlicht.

Go‚Äôs JSON-, XML- und YAML-Parser haben eine lange Liste von Inkonsistenzen und unsicheren Standardeinstellungen, die ausgenutzt werden k√∂nnen, um **Authentifizierung zu umgehen**, **Berechtigungen zu eskalieren** oder **sensible Daten zu exfiltrieren**.

### (Un)Marshaling Unerwarteter Daten

Das Ziel ist es, Strukturen auszunutzen, die es einem Angreifer erm√∂glichen, sensible Felder zu lesen/schreiben (z. B. `IsAdmin`, `Password`).

- Beispielstruktur:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- H√§ufige Schwachstellen

1. **Fehlendes Tag** (kein Tag = Feld wird standardm√§√üig weiterhin analysiert):
```go
type User struct {
Username string
}
```
Nutzlast:
```json
{"Username": "admin"}
```
2. **Falsche Verwendung von `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // ‚ùå wrong
}
```
Nutzlast:
```json
{"-": true}
```
‚úîÔ∏è Richtige Methode, um ein Feld vom (De)Serialisieren abzuhalten:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser-Differenzen

Das Ziel ist es, die Autorisierung zu umgehen, indem man ausnutzt, wie verschiedene Parser dasselbe Payload unterschiedlich interpretieren, wie in:
- CVE-2017-12635: Apache CouchDB Umgehung √ºber doppelte Schl√ºssel
- 2022: Zoom 0-Klick RCE √ºber XML-Parser-Inkonsistenz
- GitLab 2025 SAML-Umgehung √ºber XML-Eigenheiten

**1. Doppelte Felder:**
Go's `encoding/json` nimmt das **letzte** Feld.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
Andere Parser (z. B. Javas Jackson) k√∂nnen das **erste** nehmen.

**2. Gro√ü-/Kleinschreibung:**
Go ist nicht gro√ü-/kleinschreibungsempfindlich:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
Sogar Unicode-Tricks funktionieren:
```go
json.Unmarshal([]byte(`{"a‚Ñ™tion≈ø": "bypass"}`), &req)
```
**3. Cross-Service-Mismatch:**
Stellen Sie sich vor:
- Proxy, geschrieben in Go
- AuthZ-Dienst, geschrieben in Python

Angreifer sendet:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python sieht `UserAction`, erlaubt es
- Go sieht `AdminAction`, f√ºhrt es aus


### Datenformatverwirrung (Polyglots)

Das Ziel ist es, Systeme auszunutzen, die Formate (JSON/XML/YAML) mischen oder bei Parserfehlern offen bleiben, wie z.B.:
- **CVE-2020-16250**: HashiCorp Vault analysierte JSON mit einem XML-Parser, nachdem STS JSON anstelle von XML zur√ºckgegeben hatte.

Der Angreifer kontrolliert:
- Den `Accept: application/json` Header
- Teilweise Kontrolle des JSON-K√∂rpers

Der XML-Parser von Go analysierte es **trotzdem** und vertraute der injizierten Identit√§t.

- Ausgekl√ºgelte Payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
- **Go JSON** Parser: `Action_2` (nicht gro√ü-/kleinschreibungsempfindlich + letzter gewinnt)
- **YAML** Parser: `Action_1` (gro√ü-/kleinschreibungsempfindlich)
- **XML** Parser: parst `"Action_3"` innerhalb des Strings


### üîê Minderung

| Risiko                      | L√∂sung                                 |
|-----------------------------|---------------------------------------|
| Unbekannte Felder           | `decoder.DisallowUnknownFields()`     |
| Duplizierte Felder (JSON)   | ‚ùå Keine L√∂sung in der Standardbibliothek |
| Gro√ü-/Kleinschreibungsempfindliche √úbereinstimmung | ‚ùå Keine L√∂sung in der Standardbibliothek |
| XML-M√ºlldaten               | ‚ùå Keine L√∂sung in der Standardbibliothek |
| YAML: unbekannte Schl√ºssel   | `yaml.KnownFields(true)`              |


{{#include ../banners/hacktricks-training.md}}
