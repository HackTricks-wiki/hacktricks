# 2FA/MFA/OTP Bypass

{{#include ../banners/hacktricks-training.md}}

## **Enhanced Two-Factor Authentication Bypass Techniques**

### **Direct Endpoint Access**

Para contornar 2FA, acesse diretamente o endpoint subsequente; conhecer o caminho é crucial. Se não funcionar, altere o **Referrer header** para imitar a navegação a partir da página de verificação do 2FA.

### **Token Reuse**

Reutilizar tokens previamente usados para autenticação dentro de uma conta pode ser eficaz.

### **Utilization of Unused Tokens**

Tentar extrair um token da própria conta para contornar 2FA em outra conta pode ser tentado.

### **Exposure of Token**

Verifique se o token é divulgado em alguma resposta da aplicação web.

### **Verification Link Exploitation**

Usar o link de verificação por email enviado quando a conta é criada pode permitir acesso ao perfil sem 2FA, como destacado em um [post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b).

### **Session Manipulation**

Iniciar sessões para a conta do próprio usuário e para a conta da vítima, e completar o 2FA para a conta do próprio usuário sem prosseguir, permite tentar acessar o próximo passo do fluxo da conta da vítima, explorando limitações no gerenciamento de sessão do backend.

### **Password Reset Mechanism**

Investigar a função de password reset — que autentica um usuário na aplicação após o reset — para avaliar se ela permite múltiplos resets usando o mesmo link é crucial. Fazer login com as credenciais recém-resetadas pode contornar o 2FA.

### **OAuth Platform Compromise**

Comprometer a conta de um usuário em uma plataforma confiável de **OAuth** (ex.: Google, Facebook) pode oferecer uma rota para contornar o 2FA.

### **Brute Force Attacks**

#### **Rate Limit Absence**

A ausência de um limite no número de tentativas de código permite ataques de brute force, embora deva-se considerar a possibilidade de rate limiting silencioso.

Observe que mesmo se um rate limit estiver em vigor, você deve testar se a resposta é diferente quando o OTP válido é enviado. No [**this post**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), o bug hunter descobriu que mesmo que o rate limit seja acionado após 20 tentativas malsucedidas respondendo com 401, se o código válido fosse enviado era recebida uma resposta 200.

#### **Slow Brute Force**

Um ataque de slow brute force é viável quando existem rate limits por fluxo sem um limite geral.

#### **Code Resend Limit Reset**

O reenvio do código zera o rate limit, facilitando tentativas contínuas de brute force.

#### **Client-Side Rate Limit Circumvention**

Um documento detalha técnicas para contornar rate limiting no lado do cliente.

#### **Internal Actions Lack Rate Limit**

Rate limits podem proteger tentativas de login, mas não ações internas da conta.

#### **SMS Code Resend Costs**

O reenvio excessivo de códigos via SMS gera custos para a empresa, embora não contorne o 2FA.

#### **Infinite OTP Regeneration**

Geração infinita de OTPs com códigos simples permite brute force ao tentar repetir um pequeno conjunto de códigos.

### **Race Condition Exploitation**

A exploração de race conditions para contornar 2FA pode ser encontrada em um documento específico.

### **CSRF/Clickjacking Vulnerabilities**

Explorar vulnerabilidades CSRF ou Clickjacking para desabilitar o 2FA é uma estratégia viável.

### **"Remember Me" Feature Exploits**

#### **Predictable Cookie Values**

Adivinhar o valor do cookie "remember me" pode contornar restrições.

#### **IP Address Impersonation**

Impersonar o endereço IP da vítima através do cabeçalho **X-Forwarded-For** pode contornar restrições.

### **Utilizing Older Versions**

#### **Subdomains**

Testar subdomínios pode revelar versões desatualizadas sem suporte a 2FA ou conter implementações de 2FA vulneráveis.

#### **API Endpoints**

Versões antigas de API, indicadas por caminhos /v\*/ em diretórios, podem ser vulneráveis a métodos de bypass de 2FA.

### **Handling of Previous Sessions**

Encerrar sessões existentes após a ativação do 2FA protege contas contra acesso não autorizado vindo de sessões comprometidas.

### **Access Control Flaws with Backup Codes**

A geração imediata e a possível recuperação não autorizada de backup codes após a ativação do 2FA, especialmente em casos de CORS mal configurado ou vulnerabilidades XSS, representa um risco.

### **Information Disclosure on 2FA Page**

A divulgação de informações sensíveis (ex.: número de telefone) na página de verificação do 2FA é um problema.

### **Password Reset Disabling 2FA**

Um processo que demonstra um possível método de bypass envolve criação de conta, ativação do 2FA, password reset e login subsequente sem a exigência do 2FA.

### **Decoy Requests**

Utilizar decoy requests para ofuscar tentativas de brute force ou enganar mecanismos de rate limiting adiciona outra camada às estratégias de bypass. Criar esses requests exige um entendimento apurado das medidas de segurança da aplicação e dos comportamentos de rate limiting.

### OTP Construction errors

Caso o OTP seja criado com base em dados que o usuário já possui ou que são enviados anteriormente para gerar o OTP, é possível que o usuário também o gere e o contorne.

## Referências

- [https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35](https://medium.com/@ISecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35)
- [https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718](https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718)
- [https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce](https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce)

P

{{#include ../banners/hacktricks-training.md}}
