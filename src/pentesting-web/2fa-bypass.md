# Contournement de 2FA/MFA/OTP

{{#include ../banners/hacktricks-training.md}}

## **Techniques Améliorées de Contournement de l'Authentification à Deux Facteurs**

### **Accès Direct aux Points de Terminaison**

Pour contourner 2FA, accédez directement au point de terminaison suivant, connaître le chemin est crucial. Si cela échoue, modifiez l'**en-tête Referrer** pour imiter la navigation depuis la page de vérification 2FA.

### **Réutilisation de Token**

Réutiliser des tokens précédemment utilisés pour l'authentification dans un compte peut être efficace.

### **Utilisation de Tokens Non Utilisés**

Extraire un token de son propre compte pour contourner 2FA dans un autre compte peut être tenté.

### **Exposition de Token**

Vérifiez si le token est divulgué dans une réponse de l'application web.

### **Exploitation de Lien de Vérification**

Utiliser le **lien de vérification par e-mail envoyé lors de la création du compte** peut permettre l'accès au profil sans 2FA, comme souligné dans un [post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b) détaillé.

### **Manipulation de Session**

Initier des sessions pour le compte de l'utilisateur et celui d'une victime, et compléter 2FA pour le compte de l'utilisateur sans continuer, permet d'essayer d'accéder à l'étape suivante dans le flux de compte de la victime, exploitant les limitations de gestion de session en backend.

### **Mécanisme de Réinitialisation de Mot de Passe**

Il est crucial d'examiner la fonction de réinitialisation de mot de passe, qui connecte un utilisateur à l'application après la réinitialisation, pour son potentiel à permettre plusieurs réinitialisations en utilisant le même lien. Se connecter avec les nouvelles informations d'identification réinitialisées pourrait contourner 2FA.

### **Compromission de Plateforme OAuth**

Compromettre le compte d'un utilisateur sur une plateforme **OAuth** de confiance (par exemple, Google, Facebook) peut offrir un moyen de contourner 2FA.

### **Attaques par Force Brute**

#### **Absence de Limite de Taux**

L'absence de limite sur le nombre de tentatives de code permet des attaques par force brute, bien que des limitations silencieuses potentielles doivent être prises en compte.

Notez que même si une limite de taux est en place, vous devriez essayer de voir si la réponse est différente lorsque le OTP valide est envoyé. Dans [**ce post**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), le chasseur de bugs a découvert que même si une limite de taux est déclenchée après 20 tentatives infructueuses en répondant avec 401, si le valide était envoyé, une réponse 200 était reçue.

#### **Force Brute Lente**

Une attaque par force brute lente est viable là où des limites de flux existent sans une limite de taux globale.

#### **Réinitialisation de Limite de Renvoi de Code**

Le renvoi du code réinitialise la limite de taux, facilitant les tentatives de force brute continues.

#### **Contournement de Limite de Taux Côté Client**

Un document détaille des techniques pour contourner la limitation de taux côté client.

#### **Absence de Limite de Taux pour Actions Internes**

Les limites de taux peuvent protéger les tentatives de connexion mais pas les actions internes du compte.

#### **Coûts de Renvoi de Code SMS**

Le renvoi excessif de codes par SMS entraîne des coûts pour l'entreprise, bien que cela ne contourne pas 2FA.

#### **Régénération Infinie de OTP**

La génération infinie de OTP avec des codes simples permet la force brute en réessayant un petit ensemble de codes.

### **Exploitation de Conditions de Course**

L'exploitation des conditions de course pour le contournement de 2FA peut être trouvée dans un document spécifique.

### **Vulnérabilités CSRF/Clickjacking**

Explorer les vulnérabilités CSRF ou Clickjacking pour désactiver 2FA est une stratégie viable.

### **Exploits de Fonctionnalité "Se Souvenir de Moi"**

#### **Valeurs de Cookie Prévisibles**

Deviner la valeur du cookie "se souvenir de moi" peut contourner les restrictions.

#### **Impersonation d'Adresse IP**

Imiter l'adresse IP de la victime via l'en-tête **X-Forwarded-For** peut contourner les restrictions.

### **Utilisation de Versions Anciennes**

#### **Sous-domaines**

Tester des sous-domaines peut utiliser des versions obsolètes manquant de support 2FA ou contenir des implémentations 2FA vulnérables.

#### **Points de Terminaison API**

Les anciennes versions d'API, indiquées par des chemins de répertoire /v\*/, peuvent être vulnérables aux méthodes de contournement de 2FA.

### **Gestion des Sessions Précédentes**

Mettre fin aux sessions existantes lors de l'activation de 2FA sécurise les comptes contre l'accès non autorisé depuis des sessions compromises.

### **Flaws de Contrôle d'Accès avec Codes de Sauvegarde**

La génération immédiate et la récupération potentielle non autorisée de codes de sauvegarde lors de l'activation de 2FA, en particulier avec des configurations CORS incorrectes/vulnérabilités XSS, posent un risque.

### **Divulgation d'Informations sur la Page 2FA**

La divulgation d'informations sensibles (par exemple, numéro de téléphone) sur la page de vérification 2FA est une préoccupation.

### **Réinitialisation de Mot de Passe Désactivant 2FA**

Un processus démontrant une méthode de contournement potentielle implique la création de compte, l'activation de 2FA, la réinitialisation de mot de passe, et la connexion subséquente sans l'exigence de 2FA.

### **Requêtes Leurres**

Utiliser des requêtes leurres pour obscurcir les tentatives de force brute ou induire en erreur les mécanismes de limitation de taux ajoute une autre couche aux stratégies de contournement. La création de telles requêtes nécessite une compréhension nuancée des mesures de sécurité de l'application et des comportements de limitation de taux.

### Erreurs de Construction de OTP

Dans le cas où le OTP est créé sur la base de données que l'utilisateur possède déjà ou qui est envoyée précédemment pour créer le OTP, il est possible pour l'utilisateur de le générer également et de le contourner.

## Références

- [https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35](https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/%22https:/medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35%22/README.md)
- [https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718](https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718)
- [https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce](https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce)

P

{{#include ../banners/hacktricks-training.md}}
