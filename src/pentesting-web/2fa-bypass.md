# 2FA/MFA/OTP Bypass

{{#include ../banners/hacktricks-training.md}}

## **Techniques avancées de contournement de l'authentification à deux facteurs**

### **Direct Endpoint Access**

Pour contourner 2FA, accédez directement à l'endpoint suivant ; connaître le chemin est crucial. Si cela échoue, modifiez le **Referrer header** pour imiter une navigation depuis la page de vérification 2FA.

### **Token Reuse**

La réutilisation de tokens déjà utilisés pour l'authentification dans un compte peut être efficace.

### **Utilization of Unused Tokens**

On peut tenter d'extraire un token depuis son propre compte pour contourner 2FA sur un autre compte.

### **Exposure of Token**

Vérifiez si le token est divulgué dans une réponse de l'application web.

### **Verification Link Exploitation**

L'utilisation du **lien de vérification par e-mail envoyé lors de la création du compte** peut permettre d'accéder au profil sans 2FA, comme souligné dans un [post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b).

### **Session Manipulation**

Initier des sessions pour le compte de l'utilisateur et celui de la victime, et compléter la 2FA pour le compte de l'utilisateur sans poursuivre, permet de tenter d'accéder à l'étape suivante du flux du compte de la victime, en exploitant des limitations de gestion de session côté backend.

### **Password Reset Mechanism**

Il est crucial d'examiner la fonction de réinitialisation de mot de passe qui connecte l'utilisateur à l'application après la réinitialisation, pour son potentiel à permettre plusieurs réinitialisations avec le même lien. Se connecter avec les identifiants nouvellement réinitialisés peut contourner 2FA.

### **OAuth Platform Compromise**

La compromission du compte d'un utilisateur sur une plateforme **OAuth** de confiance (p.ex. Google, Facebook) peut offrir une voie pour contourner 2FA.

### **Brute Force Attacks**

#### **Rate Limit Absence**

L'absence d'une limite sur le nombre de tentatives de code permet des attaques par force brute, bien qu'une limitation silencieuse du taux puisse exister.

Notez que même si une limitation de taux est en place, vous devriez vérifier si la réponse est différente lorsque l'OTP valide est envoyé. Dans [**this post**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), le bug hunter a découvert que même si une limitation de taux est déclenchée après 20 tentatives infructueuses en répondant par 401, si le code valide était envoyé, une réponse 200 était reçue.

#### **Slow Brute Force**

Une attaque par force brute lente est viable lorsque des limites de flux existent sans une limitation globale.

#### **Code Resend Limit Reset**

Le renvoi du code réinitialise la limite de taux, facilitant la poursuite des tentatives par force brute.

#### **Client-Side Rate Limit Circumvention**

Un document décrit des techniques pour contourner la limitation de taux côté client.

#### **Internal Actions Lack Rate Limit**

Les limitations de taux peuvent protéger les tentatives de connexion mais pas les actions internes du compte.

#### **SMS Code Resend Costs**

Le renvoi excessif de codes par SMS engendre des coûts pour l'entreprise, bien que cela ne contourne pas la 2FA.

#### **Infinite OTP Regeneration**

La génération infinie d'OTP avec des codes simples permet la force brute en réessayant un petit ensemble de codes.

### **Race Condition Exploitation**

L'exploitation de conditions de course pour contourner 2FA est décrite dans un document spécifique.

### **CSRF/Clickjacking Vulnerabilities**

Explorer des vulnérabilités CSRF ou Clickjacking pour désactiver la 2FA est une stratégie viable.

### **"Remember Me" Feature Exploits**

#### **Predictable Cookie Values**

Deviner la valeur du cookie "remember me" peut contourner les restrictions.

#### **IP Address Impersonation**

Usurper l'adresse IP de la victime via l'en-tête **X-Forwarded-For** peut contourner les restrictions.

### **Utilizing Older Versions**

#### **Subdomains**

Tester les sous-domaines peut révéler des versions obsolètes sans prise en charge de la 2FA ou contenant des implémentations 2FA vulnérables.

#### **API Endpoints**

Les versions d'API plus anciennes, indiquées par des chemins de répertoire /v\*/, peuvent être vulnérables à des méthodes de contournement de la 2FA.

### **Handling of Previous Sessions**

Terminer les sessions existantes lors de l'activation de la 2FA sécurise les comptes contre l'accès non autorisé depuis des sessions compromises.

### **Access Control Flaws with Backup Codes**

La génération immédiate et la récupération potentiellement non autorisée des codes de secours lors de l'activation de la 2FA, en particulier avec des mauvaises configurations CORS/vulnérabilités XSS, présentent un risque.

### **Information Disclosure on 2FA Page**

La divulgation d'informations sensibles (p.ex. numéro de téléphone) sur la page de vérification 2FA est préoccupante.

### **Password Reset Disabling 2FA**

Un processus démontrant une méthode potentielle de contournement implique la création de compte, l'activation de la 2FA, la réinitialisation du mot de passe, puis la connexion subséquente sans exigence de 2FA.

### **Decoy Requests**

L'utilisation de requêtes leurres pour obfusquer des tentatives par force brute ou tromper des mécanismes de limitation de taux ajoute une couche aux stratégies de contournement. Concevoir de telles requêtes nécessite une compréhension nuancée des mesures de sécurité de l'application et des comportements de limitation de taux.

### OTP Construction errors

Si l'OTP est généré à partir de données que l'utilisateur possède déjà ou qui sont envoyées préalablement pour créer l'OTP, il est possible que l'utilisateur puisse aussi le générer et le contourner.

## Références

- [https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35](https://medium.com/@ISecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35)
- [https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718](https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718)
- [https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce](https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce)

P

{{#include ../banners/hacktricks-training.md}}
