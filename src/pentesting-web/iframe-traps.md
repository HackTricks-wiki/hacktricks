# Iframe Traps

{{#include ../banners/hacktricks-training.md}}

## 基本情報

この形式のXSSを利用して、ユーザーがウェブページを移動する際に情報を盗むためのiframeの悪用は、trustedsec.comのこれら2つの投稿で最初に公開されました: [**ここ**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **と** [**ここ**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams)。

攻撃は、XSSに脆弱なページで始まり、**被害者がXSSを離れないように**、**ウェブアプリケーション全体を占めるiframe内をナビゲートさせる**ことが可能です。

XSS攻撃は基本的に、画面の100%にiframeでウェブページを読み込みます。したがって、被害者は**iframe内にいることに気づきません**。次に、被害者がiframe内のリンクをクリックしてページをナビゲートすると、彼は**iframe内をナビゲートしている**ことになり、このナビゲーションから情報を盗む任意のJSが読み込まれます。

さらに、より現実的にするために、iframeがページの位置を変更したときにチェックする**リスナー**を使用し、ユーザーがブラウザを使用してページを移動していると思わせるようにブラウザのURLを更新することが可能です。

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

さらに、リスナーを使用して、被害者が訪れている他のページだけでなく、**フォームに入力されたデータ**を盗んだり（認証情報？）、**ローカルストレージを盗む**ことも可能です...

もちろん、主な制限は、**被害者がタブを閉じたり、ブラウザに別のURLを入力するとiframeから脱出する**ことです。これを行う別の方法は、**ページをリフレッシュする**ことですが、これは新しいページがiframe内に読み込まれるたびに右クリックコンテキストメニューを無効にすることで部分的に**防止**できます。また、ユーザーのマウスがiframeを離れたときに気づくことで、ブラウザのリロードボタンをクリックする可能性があり、この場合、ブラウザのURLはXSSに脆弱な元のURLに更新されるため、ユーザーがリロードすると再度感染します（これはあまりステルスではないことに注意してください）。

{{#include ../banners/hacktricks-training.md}}
