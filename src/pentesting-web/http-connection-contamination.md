# Contaminación de Conexiones HTTP

{{#include ../banners/hacktricks-training.md}}

**Este es un resumen de la publicación: [https://portswigger.net/research/http-3-connection-contamination](https://portswigger.net/research/http-3-connection-contamination)**. ¡Consúltalo para más detalles!

Los navegadores web pueden reutilizar una única conexión HTTP/2+ para diferentes sitios web a través de [coalescencia de conexiones HTTP](https://daniel.haxx.se/blog/2016/08/18/http2-connection-coalescing), dado que comparten direcciones IP y un certificado TLS común. Sin embargo, esto puede entrar en conflicto con el **enrutamiento de primera solicitud** en proxies inversos, donde las solicitudes subsiguientes se dirigen al back-end determinado por la primera solicitud. Este enrutamiento incorrecto puede llevar a vulnerabilidades de seguridad, particularmente cuando se combina con certificados TLS comodín y dominios como `*.example.com`.

Por ejemplo, si `wordpress.example.com` y `secure.example.com` son servidos por el mismo proxy inverso y tienen un certificado comodín común, la coalescencia de conexiones de un navegador podría llevar a que las solicitudes a `secure.example.com` sean procesadas incorrectamente por el back-end de WordPress, explotando vulnerabilidades como XSS.

Para observar la coalescencia de conexiones, se puede utilizar la pestaña de Red de Chrome o herramientas como Wireshark. Aquí hay un fragmento para probar:
```javascript
fetch("//sub1.hackxor.net/", { mode: "no-cors", credentials: "include" }).then(
() => {
fetch("//sub2.hackxor.net/", { mode: "no-cors", credentials: "include" })
}
)
```
La amenaza actualmente está limitada debido a la rareza del enrutamiento de primera solicitud y la complejidad de HTTP/2. Sin embargo, los cambios propuestos en HTTP/3, que relajan el requisito de coincidencia de direcciones IP, podrían ampliar la superficie de ataque, haciendo que los servidores con un certificado comodín sean más vulnerables sin necesidad de un ataque MITM.

Las mejores prácticas incluyen evitar el enrutamiento de primera solicitud en proxies inversos y tener precaución con los certificados TLS comodín, especialmente con la llegada de HTTP/3. Las pruebas regulares y la conciencia de estas vulnerabilidades complejas e interconectadas son cruciales para mantener la seguridad web.

{{#include ../banners/hacktricks-training.md}}
