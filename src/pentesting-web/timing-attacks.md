# Ataki czasowe

{{#include ../banners/hacktricks-training.md}}

> [!WARNING]
> Aby uzyskać głębokie zrozumienie tej techniki, sprawdź oryginalny raport z [https://portswigger.net/research/listen-to-the-whispers-web-timing-attacks-that-actually-work](https://portswigger.net/research/listen-to-the-whispers-web-timing-attacks-that-actually-work)

## Podstawowe informacje

Podstawowym celem ataku czasowego jest w zasadzie możliwość odpowiedzi na skomplikowane pytania lub wykrycia ukrytych funkcjonalności poprzez **sprawdzanie różnic czasowych w odpowiedziach na podobne żądania**.

Tradycyjnie było to bardzo skomplikowane z powodu opóźnień i jittera wprowadzanego zarówno przez sieć, jak i serwer. Jednak od momentu odkrycia i poprawy [**ataku na pojedynczy pakiet w warunkach wyścigu**](race-condition.md#http-2-single-packet-attack-vs.-http-1.1-last-byte-synchronization), możliwe jest wykorzystanie tej techniki do usunięcia wszystkich opóźnień sieciowych z równania.\
Pozostawiając tylko **opóźnienia serwera**, atak czasowy staje się łatwiejszy do odkrycia i nadużycia.

## Odkrycia

### Ukryta powierzchnia ataku

W poście na blogu omówiono, jak przy użyciu tej techniki możliwe było znalezienie ukrytych parametrów, a nawet nagłówków, po prostu sprawdzając, że za każdym razem, gdy parametr lub nagłówek był obecny w żądaniu, występowała **różnica czasowa wynosząca około 5 ms**. W rzeczywistości ta technika odkrywania została dodana do **Param Miner** w Burp Suite.

Te różnice czasowe mogą wynikać z tego, że wykonano **żądanie DNS**, zapisano jakiś **log** z powodu nieprawidłowego wejścia lub ponieważ wykonano jakieś **sprawdzenia**, gdy parametr był obecny w żądaniu.

Co musisz pamiętać, wykonując tego rodzaju ataki, to że z powodu ukrytej natury powierzchni, możesz nie wiedzieć, co jest rzeczywistą przyczyną różnic czasowych.

### Błędy konfiguracji reverse proxy

W tym samym badaniu podano, że technika czasowa była świetna do odkrywania "ograniczonych SSRF" (które są SSRF, które mogą uzyskiwać dostęp tylko do dozwolonych adresów IP/domen). Po prostu **sprawdzając różnicę czasową, gdy ustawiona jest dozwolona domena** w porównaniu do sytuacji, gdy ustawiona jest niedozwolona domena, pomaga odkryć otwarte proxy, nawet jeśli odpowiedź jest taka sama.

Gdy odkryto ograniczone otwarte proxy, możliwe było znalezienie ważnych celów poprzez analizowanie znanych subdomen celu, co pozwoliło na:

- **Ominięcie zapór ogniowych** poprzez uzyskiwanie dostępu do zastrzeżonych subdomen za pośrednictwem **otwartego proxy** zamiast przez internet
- Co więcej, nadużywając **otwartego proxy**, możliwe jest również **odkrycie nowych subdomen dostępnych tylko wewnętrznie.**
- **Ataki naśladujące front-end**: Serwery front-end zazwyczaj dodają nagłówki dla backendu, takie jak `X-Forwarded-For` lub `X-Real-IP`. Otwarte proxy, które otrzymuje te nagłówki, doda je do żądanego punktu końcowego, w związku z czym atakujący mógłby uzyskać dostęp do jeszcze większej liczby wewnętrznych domen, dodając te nagłówki z wartościami z białej listy.

## Odniesienia

- [https://portswigger.net/research/listen-to-the-whispers-web-timing-attacks-that-actually-work](https://portswigger.net/research/listen-to-the-whispers-web-timing-attacks-that-actually-work)

{{#include ../banners/hacktricks-training.md}}
