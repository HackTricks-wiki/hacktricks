# Rate Limit Bypass

{{#include ../banners/hacktricks-training.md}}

## Rate limit bypass techniques

### Exploring Similar Endpoints

åº”å°è¯•å¯¹ç›®æ ‡ç«¯ç‚¹çš„ä¸åŒå˜ä½“è¿›è¡Œ brute force attacksï¼Œä¾‹å¦‚ `/api/v3/sign-up`ï¼ŒåŒ…æ‹¬è¯¸å¦‚ `/Sing-up`ã€`/SignUp`ã€`/singup`ã€`/api/v1/sign-up`ã€`/api/sign-up` ç­‰æ›¿ä»£è·¯å¾„ã€‚

### Incorporating Blank Characters in Code or Parameters

åœ¨ code æˆ–å‚æ•°ä¸­æ’å…¥åƒ `%00`ã€`%0d%0a`ã€`%0d`ã€`%0a`ã€`%09`ã€`%0C`ã€`%20` è¿™æ ·çš„ç©ºå­—èŠ‚ï¼Œå¯èƒ½æ˜¯ä¸ªæœ‰ç”¨çš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå°†å‚æ•°è°ƒæ•´ä¸º `code=1234%0a` å¯ä»¥é€šè¿‡è¾“å…¥å˜ä½“æ¥æ‰©å±•å°è¯•ï¼Œä¾‹å¦‚åœ¨ç”µå­é‚®ä»¶åœ°å€ä¸­åŠ å…¥æ¢è¡Œå­—ç¬¦ä»¥ç»•è¿‡å°è¯•æ¬¡æ•°é™åˆ¶ã€‚

### Manipulating IP Origin via Headers

ä¿®æ”¹è¯·æ±‚å¤´ä»¥æ”¹å˜æ„ŸçŸ¥åˆ°çš„ IP æ¥æºï¼Œå¯ä»¥å¸®åŠ©è§„é¿åŸºäº IP çš„ rate limitingã€‚åƒ `X-Originating-IP`ã€`X-Forwarded-For`ã€`X-Remote-IP`ã€`X-Remote-Addr`ã€`X-Client-IP`ã€`X-Host`ã€`X-Forwared-Host` è¿™æ ·çš„ headersï¼ˆåŒ…æ‹¬ä½¿ç”¨å¤šä¸ª `X-Forwarded-For` å®ä¾‹ï¼‰å¯ä»¥è¢«è°ƒæ•´ä¸ºæ¨¡æ‹Ÿæ¥è‡ªä¸åŒ IP çš„è¯·æ±‚ã€‚
```bash
X-Originating-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Host: 127.0.0.1
X-Forwared-Host: 127.0.0.1

# Double X-Forwarded-For header example
X-Forwarded-For:
X-Forwarded-For: 127.0.0.1
```
### æ›´æ”¹å…¶ä»–è¯·æ±‚å¤´

å»ºè®®ä¿®æ”¹å…¶ä»–è¯·æ±‚å¤´ï¼Œä¾‹å¦‚ user-agent å’Œ cookiesï¼Œå› ä¸ºè¿™äº›ä¹Ÿå¯ç”¨äºè¯†åˆ«å’Œè¿½è¸ªè¯·æ±‚æ¨¡å¼ã€‚æ›´æ”¹è¿™äº›è¯·æ±‚å¤´å¯ä»¥é˜²æ­¢è¯†åˆ«å¹¶è·Ÿè¸ªè¯·æ±‚è€…çš„æ´»åŠ¨ã€‚

### åˆ©ç”¨ API Gateway è¡Œä¸º

ä¸€äº› API Gateway è¢«é…ç½®ä¸ºæ ¹æ® endpoint å’Œå‚æ•°çš„ç»„åˆæ¥åº”ç”¨é€Ÿç‡é™åˆ¶ã€‚é€šè¿‡æ”¹å˜å‚æ•°å€¼æˆ–å‘è¯·æ±‚æ·»åŠ æ— å…³ç´§è¦çš„å‚æ•°ï¼Œå¯ä»¥ç»•è¿‡ç½‘å…³çš„é€Ÿç‡é™åˆ¶é€»è¾‘ï¼Œä½¿æ¯ä¸ªè¯·æ±‚çœ‹èµ·æ¥éƒ½æ˜¯å”¯ä¸€çš„ã€‚ä¾‹å¦‚ `/resetpwd?someparam=1`ã€‚

### åœ¨æ¯æ¬¡å°è¯•å‰ç™»å½•ä½ çš„è´¦æˆ·

åœ¨æ¯æ¬¡å°è¯•æˆ–æ¯ç»„å°è¯•å‰ç™»å½•è´¦æˆ·å¯èƒ½ä¼šé‡ç½®é€Ÿç‡é™åˆ¶è®¡æ•°å™¨ã€‚è¿™åœ¨æµ‹è¯•ç™»å½•åŠŸèƒ½æ—¶å°¤å…¶æœ‰ç”¨ã€‚ä½¿ç”¨åƒ Burp Suite è¿™æ ·çš„å·¥å…·å®æ–½ Pitchfork attackï¼Œåœ¨æ¯å‡ æ¬¡å°è¯•åè½®æ¢å‡­æ®å¹¶ç¡®ä¿å¯ç”¨ follow redirectsï¼Œå¯ä»¥æœ‰æ•ˆé‡ç½®é€Ÿç‡é™åˆ¶è®¡æ•°å™¨ã€‚

### ä½¿ç”¨ä»£ç†ç½‘ç»œ

éƒ¨ç½²ä»£ç†ç½‘ç»œï¼Œå°†è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ª IP åœ°å€ï¼Œå¯ä»¥æœ‰æ•ˆç»•è¿‡åŸºäº IP çš„é€Ÿç‡é™åˆ¶ã€‚é€šè¿‡é€šè¿‡å„ä¸ªä»£ç†è·¯ç”±æµé‡ï¼Œæ¯ä¸ªè¯·æ±‚çœ‹èµ·æ¥éƒ½æ¥è‡ªä¸åŒæ¥æºï¼Œä»è€Œå‰Šå¼±é€Ÿç‡é™åˆ¶çš„æ•ˆæœã€‚

### å°†æ”»å‡»åˆ†æ•£åˆ°ä¸åŒè´¦æˆ·æˆ–ä¼šè¯

å¦‚æœç›®æ ‡ç³»ç»ŸæŒ‰æ¯ä¸ªè´¦æˆ·æˆ–æ¯ä¸ªä¼šè¯æ–½åŠ é€Ÿç‡é™åˆ¶ï¼Œå°†æ”»å‡»æˆ–æµ‹è¯•åˆ†æ•£åˆ°å¤šä¸ªè´¦æˆ·æˆ–ä¼šè¯å¯ä»¥å¸®åŠ©è§„é¿æ£€æµ‹ã€‚è¯¥æ–¹æ³•éœ€è¦ç®¡ç†å¤šä¸ªèº«ä»½æˆ–ä¼šè¯ä»¤ç‰Œï¼Œä½†å¯ä»¥æœ‰æ•ˆåˆ†é…è´Ÿè½½ä»¥ä¿æŒåœ¨å…è®¸çš„é™åˆ¶å†…ã€‚

### ç»§ç»­å°è¯•

è¯·æ³¨æ„ï¼Œå³ä½¿å­˜åœ¨é€Ÿç‡é™åˆ¶ï¼Œä¹Ÿåº”å°è¯•åœ¨å‘é€æœ‰æ•ˆ OTP æ—¶æŸ¥çœ‹å“åº”æ˜¯å¦ä¸åŒã€‚åœ¨ [**è¿™ç¯‡æ–‡ç« **](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732) ä¸­ï¼Œè¯¥æ¼æ´çŒäººå‘ç°ï¼Œå³ä½¿åœ¨ 20 æ¬¡å¤±è´¥å°è¯•åè§¦å‘äº†é€Ÿç‡é™åˆ¶å¹¶ä»¥ 401 å“åº”ï¼Œå¦‚æœå‘é€äº†æœ‰æ•ˆçš„ OTPï¼Œä¼šæ”¶åˆ° 200 å“åº”ã€‚

---

### æ»¥ç”¨ HTTP/2 multiplexing & request pipelining (2023-2025)

ç°ä»£çš„ rateâ€“limiter å®ç°é€šå¸¸ç»Ÿè®¡çš„æ˜¯ **TCP connections**ï¼ˆç”šè‡³æ˜¯å•ä¸ª HTTP/1.1 è¯·æ±‚ï¼‰ï¼Œè€Œä¸æ˜¯è¿æ¥åŒ…å«çš„ *number of HTTP/2 streams*ã€‚å½“é‡ç”¨ç›¸åŒçš„ TLS è¿æ¥æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ‰“å¼€æ•°ç™¾ä¸ªå¹¶è¡Œæµï¼Œæ¯ä¸ªæµéƒ½æºå¸¦ç‹¬ç«‹è¯·æ±‚ï¼Œè€Œç½‘å…³åªä»é…é¢ä¸­æ‰£é™¤ *one* è¯·æ±‚ã€‚
```bash
# Send 100 POST requests in a single HTTP/2 connection with curl
seq 1 100 | xargs -I@ -P0 curl -k --http2-prior-knowledge -X POST \
-H "Content-Type: application/json" \
-d '{"code":"@"}' https://target/api/v2/verify &>/dev/null
```
å¦‚æœ limiter åªä¿æŠ¤ `/verify` è€Œä¸ä¿æŠ¤ `/api/v2/verify`ï¼Œä½ ä¹Ÿå¯ä»¥å°† **path confusion** ä¸ HTTP/2 å¤šè·¯å¤ç”¨ç»“åˆï¼Œç”¨äº *æå…¶* é«˜é€Ÿçš„ OTP æˆ– credential brute-forcingã€‚

> ğŸ¾  **æç¤ºï¼š** PortSwiggerâ€™s [Turbo Intruder](https://portswigger.net/research/turbo-intruder) æ”¯æŒ HTTP/2ï¼Œå…è®¸ä½ å¾®è°ƒ `maxConcurrentConnections` å’Œ `requestsPerConnection` æ¥è‡ªåŠ¨åŒ–æ­¤æ”»å‡»ã€‚

### GraphQL aliases & æ‰¹é‡æ“ä½œ

GraphQL å…è®¸å®¢æˆ·ç«¯é€šè¿‡åœ¨è¯·æ±‚å‰æ·»åŠ  *aliases*ï¼Œåœ¨å•ä¸ªè¯·æ±‚ä¸­å‘é€ **å¤šä¸ªåœ¨é€»è¾‘ä¸Šç‹¬ç«‹çš„ queries æˆ– mutations**ã€‚å› ä¸ºæœåŠ¡å™¨ä¼šæ‰§è¡Œæ¯ä¸ª aliasï¼Œä½† rate-limiter å¸¸å¸¸åªå°†å®ƒä»¬è®¡ä¸º*ä¸€æ¬¡*è¯·æ±‚ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§å¯é çš„ç»•è¿‡ login æˆ– password-reset throttling çš„æ–¹æ³•ã€‚
```graphql
mutation bruteForceOTP {
a: verify(code:"111111") { token }
b: verify(code:"222222") { token }
c: verify(code:"333333") { token }
# â€¦ add up to dozens of aliases â€¦
}
```
æŸ¥çœ‹å“åº”ï¼šå½“å‘½ä¸­æ­£ç¡®çš„ä»£ç æ—¶ï¼Œæ°å¥½åªæœ‰ä¸€ä¸ª alias ä¼šè¿”å› 200 OKï¼Œè€Œå…¶ä»–çš„åˆ™è¢« rate-limitedã€‚

è¯¥æŠ€æœ¯ç”± PortSwigger åœ¨ 2023 å¹´å…³äº â€œGraphQL batching & aliasesâ€ çš„ç ”ç©¶æ¨å¹¿ï¼Œå¹¶å¯¼è‡´äº†è®¸å¤šè¿‘æœŸçš„ bug-bounty æ”¯ä»˜ã€‚

### æ»¥ç”¨ *batch* æˆ– *bulk* REST endpoints

ä¸€äº› API æš´éœ²äº†è¾…åŠ©ç«¯ç‚¹ï¼Œä¾‹å¦‚ `/v2/batch`ï¼Œæˆ–è€…åœ¨è¯·æ±‚ä½“ä¸­æ¥å— **å¯¹è±¡æ•°ç»„**ã€‚å¦‚æœé™æµå™¨åªæ”¾åœ¨ *legacy* ç«¯ç‚¹ä¹‹å‰ï¼Œå°†å¤šä¸ªæ“ä½œåŒ…è£…åœ¨å•ä¸ª bulk è¯·æ±‚å†…å¯èƒ½ä¼šå®Œå…¨ç»•è¿‡è¯¥é˜²æŠ¤ã€‚
```json
[
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"123"}},
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"456"}}
]
```
### ä¸º sliding-window å®šæ—¶

ä¸€ä¸ªç»å…¸çš„ token-bucket æˆ– leaky-bucket é™é€Ÿå™¨ä¼šåœ¨å›ºå®šæ—¶é—´è¾¹ç•Œä¸Š *é‡ç½®*ï¼ˆä¾‹å¦‚ï¼Œæ¯åˆ†é’Ÿï¼‰ã€‚å¦‚æœè¯¥çª—å£å·²çŸ¥ï¼ˆä¾‹å¦‚é€šè¿‡é”™è¯¯ä¿¡æ¯å¦‚ `X-RateLimit-Reset: 27`ï¼‰ï¼Œåœ¨ bucket é‡ç½® **ä¹‹å‰** å‘é€å…è®¸çš„æœ€å¤§æ•°é‡çš„è¯·æ±‚ï¼Œç„¶åç«‹åˆ»å†å‘èµ·å¦ä¸€è½®å®Œæ•´çš„çªå‘è¯·æ±‚ã€‚
```
|<-- 60 s window â€‘->|<-- 60 s window â€‘->|
######                 ######
```
è¿™ä¸ªç®€å•çš„ä¼˜åŒ–å¯ä»¥åœ¨ä¸è§¦åŠä»»ä½•å…¶ä»– bypass technique çš„æƒ…å†µä¸‹å°†ååé‡æé«˜ä¸€å€ä»¥ä¸Šã€‚

### å‡çº§åˆ° WebSockets / gRPC streaming after the handshake

è®¸å¤š edge rate-limiters åªæ£€æŸ¥ **initial HTTP request**ã€‚ä¸€æ—¦è¿æ¥å‡çº§ä¸º WebSocket (HTTP 101) æˆ– gRPC bidirectional streamingï¼Œåç»­æ¶ˆæ¯é€šå¸¸ä¼šç»•è¿‡ request-per-second countersï¼Œå› ä¸ºå®ƒä»¬ä¸å†æ˜¯ç‹¬ç«‹çš„ HTTP requestsã€‚Cloudflare çš„æ–‡æ¡£æŒ‡å‡ºï¼Œåªæœ‰åˆå§‹å‡çº§è¯·æ±‚å—åˆ° WAF/rate-limiting è§„åˆ™çš„çº¦æŸï¼›ä¹‹åå‘é€çš„ frames æ˜¯ä¸é€æ˜çš„ã€‚

å®è·µå·¥ä½œæµç¨‹:
```bash
# Flood 1,000 OTP guesses through a single WebSocket connection
seq -w 000000 000999 | websocat -n ws://target.tld/api/verify-ws

# gRPC streaming: send multiple Verify requests in one stream
grpcurl -d @ -plaintext target.tld:50051 service.VerifyOTP/Stream <<'EOF'
{ "code": "111111" }
{ "code": "222222" }
{ "code": "333333" }
EOF
```
å¦‚æœ login/OTP endpoint åŒæ—¶æš´éœ² HTTP å’Œ WebSocket/gRPC å˜ä½“ï¼Œå…ˆå»ºç«‹å‡çº§åçš„é€šé“ï¼Œç„¶ååœ¨è¯¥å•ä¸€è¿æ¥å†… spray codesï¼Œä»¥è§„é¿æ¯æ¬¡è¯·æ±‚çš„é™é€Ÿã€‚

### åˆ©ç”¨ CDN PoP åˆ†ç‰‡è®¡æ•°å™¨

ä¸€äº› CDN ä¼šæŒ‰æ•°æ®ä¸­å¿ƒ/PoP å¯¹é™é€Ÿè®¡æ•°å™¨è¿›è¡Œåˆ†ç‰‡ï¼Œè€Œä¸æ˜¯å…¨å±€å…±äº«ã€‚Cloudflare æ˜ç¡®è¯´æ˜è®¡æ•°å™¨ä¸ä¼šåœ¨æ•°æ®ä¸­å¿ƒä¹‹é—´å…±äº«ã€‚é€šè¿‡å°†è¯·æ±‚è·¯ç”±åˆ°å¤šä¸ªåŒºåŸŸçš„å‡ºå£èŠ‚ç‚¹ï¼ˆresidential proxy pools, anycast VPNs, or cloud VMs pinned to different continentsï¼‰ï¼Œä½ å¯ä»¥æˆå€å¢åŠ å…è®¸çš„ååé‡ï¼šæ¯ä¸ª PoP éƒ½ä¸ºç›¸åŒçš„ key ç»´æŠ¤ç‹¬ç«‹çš„æ¡¶ã€‚

Quick and dirty layout using open proxies (example with `proxychains` + a countryâ€‘rotating list):
```bash
for p in $(cat proxies.txt); do
HTTPS_PROXY=$p curl -s -X POST https://target/api/login -d @payload.json &
done
wait
```
ç¡®ä¿ limiter key ä¸æ˜¯ per-accountï¼›å¦åˆ™ä¹Ÿè¦è½®æ¢ user IDs / session tokensã€‚

---

## å·¥å…·

- [**https://github.com/Hashtag-AMIN/hashtag-fuzz**](https://github.com/Hashtag-AMIN/hashtag-fuzz): Fuzzing toolï¼Œæ”¯æŒå¤´éƒ¨éšæœºåŒ–ã€åˆ†å—å­—å…¸å’Œè½®è¯¢ä»£ç†è½®æ¢ã€‚
- [**https://github.com/ustayready/fireprox**](https://github.com/ustayready/fireprox): è‡ªåŠ¨åˆ›å»ºä¸€æ¬¡æ€§ AWS API Gateway ç«¯ç‚¹ï¼Œä½¿æ¯ä¸ªè¯·æ±‚éƒ½æ¥è‡ªä¸åŒçš„ IP åœ°å€ â€”â€” éå¸¸é€‚åˆç»•è¿‡åŸºäº IP çš„é™æµã€‚
- **Burp Suite â€“ IPRotate + extension**: ä½¿ç”¨ä¸€ç»„ SOCKS/HTTP ä»£ç†ï¼ˆæˆ– AWS API Gatewayï¼‰åœ¨ *Intruder* å’Œ *Turbo Intruder* æ”»å‡»æœŸé—´é€æ˜åœ°è½®æ¢æº IPã€‚
- **Turbo Intruder (BApp)**: é«˜æ€§èƒ½æ”»å‡»å¼•æ“ï¼Œæ”¯æŒ HTTP/2 å¤šè·¯å¤ç”¨ï¼›å°† `requestsPerConnection` è°ƒæ•´ä¸º 100-1000 å¯å°†æ•°ç™¾ä¸ªè¯·æ±‚åˆå¹¶åˆ°å•ä¸ªè¿æ¥ä¸­ã€‚

## å‚è€ƒ

- [PortSwigger Research â€“ â€œBypassing rate limits with GraphQL aliasingâ€ (2023)](https://portswigger.net/research/graphql-authorization-bypass)
- [PortSwigger Research â€“ â€œHTTP/2: The Sequel is Always Worseâ€ (connection-based throttling) (2024)](https://portswigger.net/research/http2)
- [Cloudflare Docs â€“ WebSockets & WAF applicability (2025)](https://developers.cloudflare.com/network/websockets/)
- [Cloudflare Docs â€“ Request rate calculation and PoP-local counters (2025)](https://developers.cloudflare.com/waf/rate-limiting-rules/request-rate/)

{{#include ../banners/hacktricks-training.md}}
