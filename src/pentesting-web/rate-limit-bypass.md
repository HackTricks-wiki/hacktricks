# Rate Limit Bypass

{{#include ../banners/hacktricks-training.md}}

## Tehnike za zaobilaÅ¾enje ograniÄenja brzine

### IstraÅ¾ivanje sliÄnih krajnjih taÄaka

Treba pokuÅ¡ati izvrÅ¡iti brute force napade na varijacije ciljne krajnje taÄke, kao Å¡to su `/api/v3/sign-up`, ukljuÄujuÄ‡i alternative poput `/Sing-up`, `/SignUp`, `/singup`, `/api/v1/sign-up`, `/api/sign-up` itd.

### UkljuÄivanje praznih karaktera u kod ili parametre

Umetanje praznih bajtova kao Å¡to su `%00`, `%0d%0a`, `%0d`, `%0a`, `%09`, `%0C`, `%20` u kod ili parametre moÅ¾e biti korisna strategija. Na primer, podeÅ¡avanje parametra na `code=1234%0a` omoguÄ‡ava produÅ¾avanje pokuÅ¡aja kroz varijacije u unosu, kao Å¡to je dodavanje karaktera novog reda u adresu e-poÅ¡te kako bi se zaobiÅ¡la ograniÄenja pokuÅ¡aja.

### Manipulacija IP poreklom putem zaglavlja

Modifikovanje zaglavlja kako bi se promenilo percipirano IP poreklo moÅ¾e pomoÄ‡i u izbegavanju ograniÄenja brzine zasnovanih na IP-u. Zaglavlja kao Å¡to su `X-Originating-IP`, `X-Forwarded-For`, `X-Remote-IP`, `X-Remote-Addr`, `X-Client-IP`, `X-Host`, `X-Forwared-Host`, ukljuÄujuÄ‡i koriÅ¡Ä‡enje viÅ¡e instanci `X-Forwarded-For`, mogu se prilagoditi kako bi se simulirali zahtevi sa razliÄitih IP adresa.
```bash
X-Originating-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Host: 127.0.0.1
X-Forwared-Host: 127.0.0.1

# Double X-Forwarded-For header example
X-Forwarded-For:
X-Forwarded-For: 127.0.0.1
```
### Promena drugih zaglavlja

PreporuÄuje se menjanje drugih zaglavlja zahteva kao Å¡to su user-agent i kolaÄiÄ‡i, jer se oni takoÄ‘e mogu koristiti za identifikaciju i praÄ‡enje obrazaca zahteva. Promena ovih zaglavlja moÅ¾e spreÄiti prepoznavanje i praÄ‡enje aktivnosti podnosioca zahteva.

### IskoriÅ¡Ä‡avanje ponaÅ¡anja API Gateway-a

Neki API gateway-i su konfigurisani da primenjuju ograniÄenje brzine na osnovu kombinacije krajnje taÄke i parametara. Variranjem vrednosti parametara ili dodavanjem nevaÅ¾nih parametara u zahtev, moguÄ‡e je zaobiÄ‡i logiku ograniÄenja brzine gateway-a, ÄineÄ‡i svaki zahtev jedinstvenim. Na primer `/resetpwd?someparam=1`.

### Prijavljivanje na svoj nalog pre svakog pokuÅ¡aja

Prijavljivanje na nalog pre svakog pokuÅ¡aja, ili svake grupe pokuÅ¡aja, moÅ¾e resetovati brojaÄ ograniÄenja brzine. Ovo je posebno korisno prilikom testiranja funkcionalnosti prijavljivanja. KoriÅ¡Ä‡enje Pitchfork napada u alatima kao Å¡to je Burp Suite, za rotaciju akreditiva svakih nekoliko pokuÅ¡aja i osiguranje da su praÄ‡eni preusmeravanja oznaÄeni, moÅ¾e efikasno restartovati brojaÄe ograniÄenja brzine.

### KoriÅ¡Ä‡enje mreÅ¾a proksija

Implementacija mreÅ¾e proksija za distribuciju zahteva preko viÅ¡e IP adresa moÅ¾e efikasno zaobiÄ‡i ograniÄenja brzine zasnovana na IP-u. Usmeravanjem saobraÄ‡aja kroz razliÄite proksije, svaki zahtev izgleda kao da potiÄe iz razliÄitog izvora, razblaÅ¾ujuÄ‡i efikasnost ograniÄenja brzine.

### Deljenje napada preko razliÄitih naloga ili sesija

Ako ciljni sistem primenjuje ograniÄenja brzine na osnovu naloga ili sesije, distribucija napada ili testa preko viÅ¡e naloga ili sesija moÅ¾e pomoÄ‡i u izbegavanju otkrivanja. Ovaj pristup zahteva upravljanje viÅ¡e identiteta ili sesijskih tokena, ali moÅ¾e efikasno raspodeliti optereÄ‡enje kako bi ostalo unutar dozvoljenih granica.

### Nastavite da pokuÅ¡avate

Imajte na umu da Äak i ako je ograniÄenje brzine postavljeno, trebali biste pokuÅ¡ati da vidite da li je odgovor drugaÄiji kada je validan OTP poslat. U [**ovom postu**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), lovac na greÅ¡ke je otkrio da Äak i ako je ograniÄenje brzine aktivirano nakon 20 neuspeÅ¡nih pokuÅ¡aja odgovaranjem sa 401, ako je validan poslat, primljen je odgovor 200.

---

### Zloupotreba HTTP/2 multiplexing-a i pipelining-a zahteva (2023-2025)

Moderne implementacije ograniÄivaÄa brzine Äesto broje **TCP veze** (ili Äak pojedinaÄne HTTP/1.1 zahteve) umesto *broja HTTP/2 tokova* koje veza sadrÅ¾i. Kada se ista TLS veza ponovo koristi, napadaÄ moÅ¾e otvoriti stotine paralelnih tokova, od kojih svaki nosi poseban zahtev, dok gateway samo odbija *jedan* zahtev iz kvote.
```bash
# Send 100 POST requests in a single HTTP/2 connection with curl
seq 1 100 | xargs -I@ -P0 curl -k --http2-prior-knowledge -X POST \
-H "Content-Type: application/json" \
-d '{"code":"@"}' https://target/api/v2/verify &>/dev/null
```
Ako limiter Å¡titi samo `/verify` ali ne i `/api/v2/verify`, moÅ¾ete takoÄ‘e kombinovati **confuziju putanje** sa HTTP/2 multiplexingom za *ekstremno* brzu brute-force napad na OTP ili akreditive.

> ğŸ¾  **Savjet:** PortSwigger-ov [Turbo Intruder](https://portswigger.net/research/turbo-intruder) podrÅ¾ava HTTP/2 i omoguÄ‡ava vam da precizno podesite `maxConcurrentConnections` i `requestsPerConnection` za automatizaciju ovog napada.

### GraphQL aliasi i grupisane operacije

GraphQL omoguÄ‡ava klijentu da poÅ¡alje **several logically independent queries or mutations in a single request** tako Å¡to ih prefiksira sa *aliasima*. PoÅ¡to server izvrÅ¡ava svaki alias, ali limiter Äesto broji samo *jedan* zahtev, ovo je pouzdan zaobilaÅ¾enje za ograniÄavanje prijavljivanja ili resetovanja lozinke.
```graphql
mutation bruteForceOTP {
a: verify(code:"111111") { token }
b: verify(code:"222222") { token }
c: verify(code:"333333") { token }
# â€¦ add up to dozens of aliases â€¦
}
```
Pogledajte odgovor: taÄno jedan alias Ä‡e vratiti 200 OK kada se ispravan kod aktivira, dok su ostali podloÅ¾ni ograniÄenju.

Tehnika je popularizovana istraÅ¾ivanjem PortSwigger-a o â€œGraphQL batchovanju i aliasimaâ€ 2023. godine i odgovorna je za mnoge nedavne isplate u okviru bug-bounty programa.

### Zloupotreba *batch* ili *bulk* REST krajnjih taÄaka

Neki API-ji izlaÅ¾u pomoÄ‡ne krajnje taÄke kao Å¡to su `/v2/batch` ili prihvataju **niz objekata** u telu zahteva. Ako je ograniÄivaÄ postavljen samo ispred *legacy* krajnjih taÄaka, obavijanje viÅ¡e operacija unutar jednog bulk zahteva moÅ¾e potpuno zaobiÄ‡i zaÅ¡titu.
```json
[
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"123"}},
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"456"}}
]
```
### Tajming kliznog prozora

KlasiÄni token-bucket ili leaky-bucket limiter *resetuje* se na fiksnoj vremenskoj granici (na primer, svake minute). Ako je prozor poznat (npr. putem poruka o greÅ¡ci kao Å¡to je `X-RateLimit-Reset: 27`), poÅ¡aljite maksimalan dozvoljeni broj zahteva **neposredno pre** nego Å¡to se kofa resetuje, a zatim odmah poÅ¡aljite joÅ¡ jedan pun udar.
```
|<-- 60 s window â€‘->|<-- 60 s window â€‘->|
######                 ######
```
Ova jednostavna optimizacija moÅ¾e viÅ¡e nego udvostruÄiti vaÅ¡u propusnost bez dodirivanja bilo koje druge tehnike za zaobilaÅ¾enje.

---

## Alati

- [**https://github.com/Hashtag-AMIN/hashtag-fuzz**](https://github.com/Hashtag-AMIN/hashtag-fuzz): Alat za fuzzing koji podrÅ¾ava randomizaciju zaglavlja, delimiÄne liste reÄi i rotaciju proxy servera u krug.
- [**https://github.com/ustayready/fireprox**](https://github.com/ustayready/fireprox): Automatski kreira jednokratne AWS API Gateway krajnje taÄke tako da svaka zahtev dolazi sa razliÄite IP adrese â€“ savrÅ¡eno za prevazilaÅ¾enje ograniÄenja zasnovanih na IP-u.
- **Burp Suite â€“ IPRotate + ekstenzija**: Koristi bazen SOCKS/HTTP proxy servera (ili AWS API Gateway) za transparentnu rotaciju izvorne IP adrese tokom *Intruder* i *Turbo Intruder* napada.
- **Turbo Intruder (BApp)**: Visoko performantni napadaÄki motor koji podrÅ¾ava HTTP/2 multiplexing; podesite `requestsPerConnection` na 100-1000 da biste spojili stotine zahteva u jednu vezu.

## Reference

- PortSwigger Research â€“ â€œZaobilaÅ¾enje ograniÄenja brzine pomoÄ‡u GraphQL aliasingaâ€ (2023) <https://portswigger.net/research/graphql-authorization-bypass>
- PortSwigger Research â€“ â€œHTTP/2: Nastavak je uvek goriâ€ (odeljak *OgraniÄenje zasnovano na vezi*) (2024) <https://portswigger.net/research/http2>

{{#include ../banners/hacktricks-training.md}}
