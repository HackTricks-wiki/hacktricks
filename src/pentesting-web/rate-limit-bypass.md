# Rate Limit Bypass

{{#include ../banners/hacktricks-training.md}}

## Techniki omijania limitÃ³w

### Badanie podobnych punktÃ³w koÅ„cowych

NaleÅ¼y podjÄ…Ä‡ prÃ³by przeprowadzenia atakÃ³w brute force na warianty docelowego punktu koÅ„cowego, takie jak `/api/v3/sign-up`, w tym alternatywy takie jak `/Sing-up`, `/SignUp`, `/singup`, `/api/v1/sign-up`, `/api/sign-up` itd.

### Wprowadzanie pustych znakÃ³w w kodzie lub parametrach

Wstawianie pustych bajtÃ³w, takich jak `%00`, `%0d%0a`, `%0d`, `%0a`, `%09`, `%0C`, `%20` do kodu lub parametrÃ³w moÅ¼e byÄ‡ uÅ¼ytecznÄ… strategiÄ…. Na przykÅ‚ad, dostosowanie parametru do `code=1234%0a` pozwala na rozszerzenie prÃ³b poprzez wariacje w wejÅ›ciu, takie jak dodawanie znakÃ³w nowej linii do adresu e-mail, aby obejÅ›Ä‡ ograniczenia prÃ³b.

### Manipulowanie pochodzeniem IP za pomocÄ… nagÅ‚Ã³wkÃ³w

Modyfikacja nagÅ‚Ã³wkÃ³w w celu zmiany postrzeganego pochodzenia IP moÅ¼e pomÃ³c w ominiÄ™ciu limitÃ³w opartych na IP. NagÅ‚Ã³wki takie jak `X-Originating-IP`, `X-Forwarded-For`, `X-Remote-IP`, `X-Remote-Addr`, `X-Client-IP`, `X-Host`, `X-Forwared-Host`, w tym uÅ¼ycie wielu instancji `X-Forwarded-For`, mogÄ… byÄ‡ dostosowane w celu symulacji Å¼Ä…daÅ„ z rÃ³Å¼nych adresÃ³w IP.
```bash
X-Originating-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Host: 127.0.0.1
X-Forwared-Host: 127.0.0.1

# Double X-Forwarded-For header example
X-Forwarded-For:
X-Forwarded-For: 127.0.0.1
```
### Zmiana Innych NagÅ‚Ã³wkÃ³w

Zaleca siÄ™ modyfikacjÄ™ innych nagÅ‚Ã³wkÃ³w Å¼Ä…dania, takich jak user-agent i ciasteczka, poniewaÅ¼ mogÄ… one byÄ‡ rÃ³wnieÅ¼ uÅ¼ywane do identyfikacji i Å›ledzenia wzorcÃ³w Å¼Ä…daÅ„. Zmiana tych nagÅ‚Ã³wkÃ³w moÅ¼e zapobiec rozpoznawaniu i Å›ledzeniu dziaÅ‚aÅ„ osoby skÅ‚adajÄ…cej Å¼Ä…danie.

### Wykorzystanie Zachowania Bramy API

NiektÃ³re bramy API sÄ… skonfigurowane do stosowania limitÃ³w na podstawie kombinacji punktu koÅ„cowego i parametrÃ³w. Zmienianie wartoÅ›ci parametrÃ³w lub dodawanie nieistotnych parametrÃ³w do Å¼Ä…dania moÅ¼e umoÅ¼liwiÄ‡ obejÅ›cie logiki limitowania bramy, sprawiajÄ…c, Å¼e kaÅ¼de Å¼Ä…danie wydaje siÄ™ unikalne. Na przykÅ‚ad `/resetpwd?someparam=1`.

### Logowanie siÄ™ do swojego konta przed kaÅ¼dym podejÅ›ciem

Logowanie siÄ™ do konta przed kaÅ¼dym podejÅ›ciem lub kaÅ¼dÄ… seriÄ… prÃ³b moÅ¼e zresetowaÄ‡ licznik limitu. Jest to szczegÃ³lnie przydatne podczas testowania funkcji logowania. Wykorzystanie ataku Pitchfork w narzÄ™dziach takich jak Burp Suite, aby rotowaÄ‡ dane uwierzytelniajÄ…ce co kilka prÃ³b i upewniÄ‡ siÄ™, Å¼e przekierowania sÄ… oznaczone, moÅ¼e skutecznie zrestartowaÄ‡ liczniki limitu.

### Wykorzystanie Sieci Proxy

WdroÅ¼enie sieci proxy do rozdzielania Å¼Ä…daÅ„ na wiele adresÃ³w IP moÅ¼e skutecznie obejÅ›Ä‡ limity oparte na IP. Przez kierowanie ruchu przez rÃ³Å¼ne proxy, kaÅ¼de Å¼Ä…danie wydaje siÄ™ pochodziÄ‡ z innego ÅºrÃ³dÅ‚a, osÅ‚abiajÄ…c skutecznoÅ›Ä‡ limitu.

### Rozdzielanie Ataku na RÃ³Å¼ne Konta lub Sesje

JeÅ›li system docelowy stosuje limity na poziomie konta lub sesji, rozdzielenie ataku lub testu na wiele kont lub sesji moÅ¼e pomÃ³c w unikniÄ™ciu wykrycia. PodejÅ›cie to wymaga zarzÄ…dzania wieloma toÅ¼samoÅ›ciami lub tokenami sesji, ale moÅ¼e skutecznie rozÅ‚oÅ¼yÄ‡ obciÄ…Å¼enie, aby pozostaÄ‡ w dozwolonych limitach.

### Kontynuuj PrÃ³by

ZauwaÅ¼, Å¼e nawet jeÅ›li limit jest wprowadzony, powinieneÅ› sprÃ³bowaÄ‡ zobaczyÄ‡, czy odpowiedÅº jest inna, gdy wysÅ‚any jest waÅ¼ny OTP. W [**tym poÅ›cie**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), Å‚owca bÅ‚Ä™dÃ³w odkryÅ‚, Å¼e nawet jeÅ›li limit jest wyzwolony po 20 nieudanych prÃ³bach, odpowiadajÄ…c z 401, jeÅ›li wysÅ‚ano waÅ¼ny, otrzymano odpowiedÅº 200.

---

### Wykorzystywanie multiplexingu HTTP/2 i pipeliningu Å¼Ä…daÅ„ (2023-2025)

Nowoczesne implementacje limitÃ³w czÄ™sto liczÄ… **poÅ‚Ä…czenia TCP** (lub nawet pojedyncze Å¼Ä…dania HTTP/1.1) zamiast *liczby strumieni HTTP/2*, ktÃ³re zawiera poÅ‚Ä…czenie. Gdy to samo poÅ‚Ä…czenie TLS jest ponownie uÅ¼ywane, atakujÄ…cy moÅ¼e otworzyÄ‡ setki rÃ³wnolegÅ‚ych strumieni, z ktÃ³rych kaÅ¼dy niesie osobne Å¼Ä…danie, podczas gdy brama odejmuje *jedno* Å¼Ä…danie od limitu.
```bash
# Send 100 POST requests in a single HTTP/2 connection with curl
seq 1 100 | xargs -I@ -P0 curl -k --http2-prior-knowledge -X POST \
-H "Content-Type: application/json" \
-d '{"code":"@"}' https://target/api/v2/verify &>/dev/null
```
JeÅ›li limiter chroni tylko `/verify`, ale nie `/api/v2/verify`, moÅ¼esz rÃ³wnieÅ¼ poÅ‚Ä…czyÄ‡ **confusion path** z multiplexingiem HTTP/2 dla *ekstremalnie* szybkiego brute-forcingu OTP lub poÅ›wiadczeÅ„.

> ğŸ¾  **WskazÃ³wka:** PortSwiggerâ€™s [Turbo Intruder](https://portswigger.net/research/turbo-intruder) obsÅ‚uguje HTTP/2 i pozwala na precyzyjne dostosowanie `maxConcurrentConnections` oraz `requestsPerConnection`, aby zautomatyzowaÄ‡ ten atak.

### Aliasy GraphQL i operacje zbiorcze

GraphQL pozwala klientowi na wysyÅ‚anie **kilku logicznie niezaleÅ¼nych zapytaÅ„ lub mutacji w jednym Å¼Ä…daniu** poprzez ich prefiksowanie *aliasami*. PoniewaÅ¼ serwer wykonuje kaÅ¼dy alias, ale limiter czÄ™sto liczy tylko *jedno* Å¼Ä…danie, jest to niezawodne obejÅ›cie dla ograniczeÅ„ logowania lub resetowania hasÅ‚a.
```graphql
mutation bruteForceOTP {
a: verify(code:"111111") { token }
b: verify(code:"222222") { token }
c: verify(code:"333333") { token }
# â€¦ add up to dozens of aliases â€¦
}
```
Zobacz odpowiedÅº: dokÅ‚adnie jeden alias zwrÃ³ci 200 OK, gdy poprawny kod zostanie trafiony, podczas gdy inne sÄ… ograniczone przez limit.

Technika ta zostaÅ‚a spopularyzowana przez badania PortSwigger na temat â€GraphQL batching & aliasesâ€ w 2023 roku i byÅ‚a odpowiedzialna za wiele ostatnich wypÅ‚at w programach bug-bounty.

### NaduÅ¼ycie *batch* lub *bulk* punktÃ³w koÅ„cowych REST

NiektÃ³re API udostÄ™pniajÄ… pomocnicze punkty koÅ„cowe, takie jak `/v2/batch` lub akceptujÄ… **tablicÄ™ obiektÃ³w** w ciele Å¼Ä…dania. JeÅ›li limiter jest umieszczony tylko przed *legacy* punktami koÅ„cowymi, opakowanie wielu operacji w jedno Å¼Ä…danie zbiorcze moÅ¼e caÅ‚kowicie ominÄ…Ä‡ ochronÄ™.
```json
[
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"123"}},
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"456"}}
]
```
### Timing the sliding-window

Klasyczny limiter token-bucket lub leaky-bucket *resetuje siÄ™* na staÅ‚ej granicy czasowej (na przykÅ‚ad co minutÄ™). JeÅ›li okno jest znane (np. za pomocÄ… komunikatÃ³w o bÅ‚Ä™dach takich jak `X-RateLimit-Reset: 27`), wyÅ›lij maksymalnÄ… dozwolonÄ… liczbÄ™ Å¼Ä…daÅ„ **tuÅ¼ przed** zresetowaniem wiadra, a nastÄ™pnie natychmiast wyÅ›lij kolejny peÅ‚ny zryw.
```
|<-- 60 s window â€‘->|<-- 60 s window â€‘->|
######                 ######
```
Ta prosta optymalizacja moÅ¼e wiÄ™cej niÅ¼ podwoiÄ‡ TwojÄ… przepustowoÅ›Ä‡ bez dotykania jakiejkolwiek innej techniki obejÅ›cia.

---

## NarzÄ™dzia

- [**https://github.com/Hashtag-AMIN/hashtag-fuzz**](https://github.com/Hashtag-AMIN/hashtag-fuzz): NarzÄ™dzie do fuzzingu, ktÃ³re wspiera randomizacjÄ™ nagÅ‚Ã³wkÃ³w, podzielone listy sÅ‚Ã³w i rotacjÄ™ proxy w trybie round-robin.
- [**https://github.com/ustayready/fireprox**](https://github.com/ustayready/fireprox): Automatycznie tworzy jednorazowe punkty koÅ„cowe AWS API Gateway, dziÄ™ki czemu kaÅ¼de Å¼Ä…danie pochodzi z innego adresu IP â€“ idealne do pokonywania ograniczeÅ„ opartych na IP.
- **Burp Suite â€“ IPRotate + rozszerzenie**: UÅ¼ywa puli proxy SOCKS/HTTP (lub AWS API Gateway) do rotacji ÅºrÃ³dÅ‚owego IP w sposÃ³b przezroczysty podczas atakÃ³w *Intruder* i *Turbo Intruder*.
- **Turbo Intruder (BApp)**: Silnik atakujÄ…cy o wysokiej wydajnoÅ›ci wspierajÄ…cy multiplexing HTTP/2; dostosuj `requestsPerConnection` do 100-1000, aby zredukowaÄ‡ setki Å¼Ä…daÅ„ do jednego poÅ‚Ä…czenia.

## Odniesienia

- PortSwigger Research â€“ â€œBypassing rate limits with GraphQL aliasingâ€  (2023)  <https://portswigger.net/research/graphql-authorization-bypass>
- PortSwigger Research â€“ â€œHTTP/2: The Sequel is Always Worseâ€ (sekcja *Connection-based throttling*) (2024)  <https://portswigger.net/research/http2>

{{#include ../banners/hacktricks-training.md}}
