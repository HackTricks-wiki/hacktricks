# Omijanie ograniczeÅ„ liczby Å¼Ä…daÅ„

{{#include ../banners/hacktricks-training.md}}

## Techniki omijania limitÃ³w

### Badanie podobnych endpointÃ³w

NaleÅ¼y prÃ³bowaÄ‡ przeprowadzaÄ‡ brute force attacks na wariantach docelowego endpointu, takich jak `/api/v3/sign-up`, wÅ‚Ä…czajÄ…c alternatywy takie jak `/Sing-up`, `/SignUp`, `/singup`, `/api/v1/sign-up`, `/api/sign-up` itd.

### Wstawianie pustych znakÃ³w w kodzie lub parametrach

Wstawianie pustych bajtÃ³w, takich jak `%00`, `%0d%0a`, `%0d`, `%0a`, `%09`, `%0C`, `%20`, w kodzie lub parametrach moÅ¼e byÄ‡ uÅ¼ytecznÄ… strategiÄ…. Na przykÅ‚ad zmiana parametru na `code=1234%0a` pozwala rozszerzyÄ‡ prÃ³by przez wariacje w danych wejÅ›ciowych, np. dodanie znakÃ³w nowej linii do adresu e-mail w celu obejÅ›cia ograniczeÅ„ liczby prÃ³b.

### Manipulowanie pochodzeniem IP przez nagÅ‚Ã³wki

Modyfikowanie nagÅ‚Ã³wkÃ³w w celu zmiany postrzeganego pochodzenia IP moÅ¼e pomÃ³c w ominiÄ™ciu ograniczeÅ„ opartych na IP. NagÅ‚Ã³wki takie jak `X-Originating-IP`, `X-Forwarded-For`, `X-Remote-IP`, `X-Remote-Addr`, `X-Client-IP`, `X-Host`, `X-Forwared-Host`, w tym uÅ¼ycie wielu instancji `X-Forwarded-For`, mogÄ… byÄ‡ modyfikowane, aby zasymulowaÄ‡ Å¼Ä…dania z rÃ³Å¼nych adresÃ³w IP.
```bash
X-Originating-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Host: 127.0.0.1
X-Forwared-Host: 127.0.0.1

# Double X-Forwarded-For header example
X-Forwarded-For:
X-Forwarded-For: 127.0.0.1
```
### Zmiana innych nagÅ‚Ã³wkÃ³w

Zaleca siÄ™ modyfikowanie innych nagÅ‚Ã³wkÃ³w Å¼Ä…dania, takich jak user-agent i cookies, poniewaÅ¼ mogÄ… byÄ‡ uÅ¼ywane do identyfikacji i Å›ledzenia wzorcÃ³w Å¼Ä…daÅ„. Zmiana tych nagÅ‚Ã³wkÃ³w moÅ¼e uniemoÅ¼liwiÄ‡ rozpoznanie i Å›ledzenie dziaÅ‚aÅ„ Å¼Ä…dajÄ…cego.

### Wykorzystanie zachowania API gateways

NiektÃ³re API gateways sÄ… skonfigurowane tak, aby stosowaÄ‡ rate limiting na podstawie kombinacji endpointu i parametrÃ³w. Zmienianie wartoÅ›ci parametrÃ³w lub dodawanie do Å¼Ä…dania parametrÃ³w bez znaczenia moÅ¼e obejÅ›Ä‡ logikÄ™ rate-limiting gateweya, sprawiajÄ…c, Å¼e kaÅ¼de Å¼Ä…danie bÄ™dzie wyglÄ…daÄ‡ na unikatowe. Na przykÅ‚ad `/resetpwd?someparam=1`.

### Logowanie siÄ™ na konto przed kaÅ¼dÄ… prÃ³bÄ…

Logowanie siÄ™ na konto przed kaÅ¼dÄ… prÃ³bÄ… lub przed kaÅ¼dym zestawem prÃ³b moÅ¼e zresetowaÄ‡ licznik rate limit. Jest to szczegÃ³lnie przydatne przy testowaniu funkcji logowania. Wykorzystanie Pitchfork attack w narzÄ™dziach takich jak Burp Suite, aby rotowaÄ‡ poÅ›wiadczenia co kilka prÃ³b oraz upewnienie siÄ™, Å¼e opcja follow redirects jest zaznaczona, moÅ¼e skutecznie ponownie uruchomiÄ‡ liczniki rate limit.

### Wykorzystanie proxy networks

Rozmieszczenie sieci proxy w celu rozdzielenia Å¼Ä…daÅ„ pomiÄ™dzy wiele adresÃ³w IP moÅ¼e skutecznie obejÅ›Ä‡ IP-based rate limits. PrzekierowujÄ…c ruch przez rÃ³Å¼ne proxy, kaÅ¼de Å¼Ä…danie wyglÄ…da, jakby pochodziÅ‚o z innego ÅºrÃ³dÅ‚a, rozmywajÄ…c skutecznoÅ›Ä‡ rate limitu.

### Rozdzielenie ataku na rÃ³Å¼ne konta lub sesje

JeÅ›li system docelowy stosuje rate limits na poziomie konta (per-account) lub sesji (per-session), rozdzielenie ataku lub testu na wiele kont lub sesji moÅ¼e pomÃ³c w unikniÄ™ciu wykrycia. PodejÅ›cie to wymaga zarzÄ…dzania wieloma toÅ¼samoÅ›ciami lub session tokens, ale moÅ¼e skutecznie rozÅ‚oÅ¼yÄ‡ obciÄ…Å¼enie, Å¼eby pozostaÄ‡ w dozwolonych limitach.

### PrÃ³buj dalej

ZauwaÅ¼, Å¼e nawet jeÅ›li rate limit jest aktywny, warto sprawdziÄ‡, czy odpowiedÅº bÄ™dzie inna po wysÅ‚aniu prawidÅ‚owego OTP. W [**tym poÅ›cie**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), bug hunter odkryÅ‚, Å¼e nawet jeÅ›li po 20 nieudanych prÃ³bach rate limit jest wyzwalany i serwer odpowiada 401, to przy wysÅ‚aniu prawidÅ‚owej odpowiedzi otrzymano 200.

---

### Abusing HTTP/2 multiplexing & request pipelining (2023-2025)

WspÃ³Å‚czesne implementacje rateâ€“limiterÃ³w czÄ™sto zliczajÄ… **TCP connections** (a nawet pojedyncze HTTP/1.1 requests) zamiast *number of HTTP/2 streams* zawartych w poÅ‚Ä…czeniu. Gdy to samo TLS connection jest ponownie uÅ¼ywane, atakujÄ…cy moÅ¼e otworzyÄ‡ setki rÃ³wnolegÅ‚ych streams, z ktÃ³rych kaÅ¼dy niesie oddzielne Å¼Ä…danie, podczas gdy gateway odlicza tylko *one* request z przydziaÅ‚u.
```bash
# Send 100 POST requests in a single HTTP/2 connection with curl
seq 1 100 | xargs -I@ -P0 curl -k --http2-prior-knowledge -X POST \
-H "Content-Type: application/json" \
-d '{"code":"@"}' https://target/api/v2/verify &>/dev/null
```
JeÅ›li limiter chroni tylko `/verify`, a nie `/api/v2/verify`, moÅ¼esz teÅ¼ poÅ‚Ä…czyÄ‡ **path confusion** z HTTP/2 multiplexing, aby przeprowadziÄ‡ *niezwykle* szybkie brute-forcing OTP lub credential brute-forcing.

> ğŸ¾  **Tip:** PortSwiggerâ€™s [Turbo Intruder](https://portswigger.net/research/turbo-intruder) obsÅ‚uguje HTTP/2 i pozwala dostroiÄ‡ `maxConcurrentConnections` i `requestsPerConnection`, aby zautomatyzowaÄ‡ ten atak.

### GraphQL aliasy & operacje wsadowe

GraphQL pozwala klientowi wysÅ‚aÄ‡ kilka logicznie niezaleÅ¼nych zapytaÅ„ lub mutacji w jednym Å¼Ä…daniu, poprzedzajÄ…c je aliasami. PoniewaÅ¼ serwer wykonuje kaÅ¼dy alias, a rate-limiter czÄ™sto zlicza tylko jedno Å¼Ä…danie, jest to niezawodny bypass throttlingu dla loginu lub password-reset.
```graphql
mutation bruteForceOTP {
a: verify(code:"111111") { token }
b: verify(code:"222222") { token }
c: verify(code:"333333") { token }
# â€¦ add up to dozens of aliases â€¦
}
```
SpÃ³jrz na odpowiedÅº: dokÅ‚adnie jeden alias zwrÃ³ci 200 OK, gdy trafi wÅ‚aÅ›ciwy kod, a pozostaÅ‚e bÄ™dÄ… rate-limited.

Technika zostaÅ‚a spopularyzowana przez badania PortSwiggera dotyczÄ…ce â€œGraphQL batching & aliasesâ€ w 2023 roku i byÅ‚a odpowiedzialna za wiele ostatnich wypÅ‚at bug-bounty.

### NaduÅ¼ycie *batch* lub *bulk* REST endpoints

NiektÃ³re API udostÄ™pniajÄ… pomocnicze endpoints takie jak `/v2/batch` lub akceptujÄ… **array of objects** w ciele Å¼Ä…dania. JeÅ›li limiter jest umieszczony tylko przed *legacy* endpoints, opakowanie wielu operacji w jedno bulk request moÅ¼e caÅ‚kowicie obejÅ›Ä‡ ochronÄ™.
```json
[
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"123"}},
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"456"}}
]
```
### Czasowanie sliding-window

Klasyczny token-bucket lub leaky-bucket limiter *resetuje siÄ™* na ustalonej granicy czasowej (na przykÅ‚ad co minutÄ™). JeÅ›li okno jest znane (np. poprzez komunikaty o bÅ‚Ä™dach takie jak `X-RateLimit-Reset: 27`), wyÅ›lij maksymalnÄ… dozwolonÄ… liczbÄ™ Å¼Ä…daÅ„ **tuÅ¼ przed** tym, jak bucket siÄ™ zresetuje, a nastÄ™pnie natychmiast wyÅ›lij kolejny peÅ‚ny burst.
```
|<-- 60 s window â€‘->|<-- 60 s window â€‘->|
######                 ######
```
Ta prosta optymalizacja moÅ¼e wiÄ™cej niÅ¼ podwoiÄ‡ przepustowoÅ›Ä‡ bez ingerencji w Å¼adnÄ… innÄ… bypass technique.

### Uaktualnienie do WebSockets / gRPC streaming po handshake

Wiele edge rate-limiters sprawdza tylko **initial HTTP request**. Gdy poÅ‚Ä…czenie zostanie zaktualizowane do WebSocket (HTTP 101) lub gRPC bidirectional streaming, kolejne wiadomoÅ›ci czÄ™sto omijajÄ… request-per-second counters, poniewaÅ¼ nie sÄ… juÅ¼ osobnymi HTTP requests. Dokumentacja Cloudflareâ€™s zauwaÅ¼a, Å¼e tylko poczÄ…tkowe Å¼Ä…danie upgrade jest objÄ™te WAF/rate-limiting rules; frames wysyÅ‚ane pÃ³Åºniej sÄ… opaque.

Praktyczny workflow:
```bash
# Flood 1,000 OTP guesses through a single WebSocket connection
seq -w 000000 000999 | websocat -n ws://target.tld/api/verify-ws

# gRPC streaming: send multiple Verify requests in one stream
grpcurl -d @ -plaintext target.tld:50051 service.VerifyOTP/Stream <<'EOF'
{ "code": "111111" }
{ "code": "222222" }
{ "code": "333333" }
EOF
```
JeÅ›li endpoint login/OTP udostÄ™pnia zarÃ³wno warianty HTTP, jak i WebSocket/gRPC, najpierw nawiÄ…Å¼ zaktualizowany kanaÅ‚, a nastÄ™pnie spray codes w ramach tego pojedynczego poÅ‚Ä…czenia, aby obejÅ›Ä‡ per-request throttles.

### Wykorzystywanie CDN PoPâ€‘sharded counters

NiektÃ³re CDNs dzielÄ… liczniki rate-limit per data center/PoP zamiast globalnie. Cloudflare wyraÅºnie stwierdza, Å¼e liczniki nie sÄ… wspÃ³Å‚dzielone miÄ™dzy centrami danych. Przez kierowanie Å¼Ä…daÅ„ przez egress nodes w wielu regionach (residential proxy pools, anycast VPNs lub cloud VMs przypiÄ™te do rÃ³Å¼nych kontynentÃ³w) mnoÅ¼ysz dozwolonÄ… przepustowoÅ›Ä‡: kaÅ¼dy PoP utrzymuje niezaleÅ¼ny bucket dla tego samego klucza.

Szybki i prowizoryczny schemat z uÅ¼yciem open proxies (przykÅ‚ad z `proxychains` + listÄ… rotujÄ…cÄ… krajÃ³w):
```bash
for p in $(cat proxies.txt); do
HTTPS_PROXY=$p curl -s -X POST https://target/api/login -d @payload.json &
done
wait
```
Upewnij siÄ™, Å¼e klucz limitera nie jest przypisany na konto; w przeciwnym razie rotuj takÅ¼e identyfikatory uÅ¼ytkownikÃ³w / tokeny sesji.

---

## Tools

- [**https://github.com/Hashtag-AMIN/hashtag-fuzz**](https://github.com/Hashtag-AMIN/hashtag-fuzz): Fuzzing tool obsÅ‚ugujÄ…cy header randomisation, chunked word-lists i round-robin proxy rotation.
- [**https://github.com/ustayready/fireprox**](https://github.com/ustayready/fireprox): Automatycznie tworzy jednorazowe AWS API Gateway endpoints, dziÄ™ki czemu kaÅ¼de Å¼Ä…danie pochodzi z innego adresu IP â€” idealne do pokonania IP-based throttling.
- **Burp Suite â€“ IPRotate + extension**: UÅ¼ywa puli SOCKS/HTTP proxies (lub AWS API Gateway) do rotacji ÅºrÃ³dÅ‚owego adresu IP w sposÃ³b przeÅºroczysty podczas *Intruder* i *Turbo Intruder* attacks.
- **Turbo Intruder (BApp)**: Wysokowydajny silnik atakÃ³w z obsÅ‚ugÄ… HTTP/2 multiplexing; ustaw `requestsPerConnection` na 100â€“1000, aby zwinÄ…Ä‡ setki Å¼Ä…daÅ„ w jedno poÅ‚Ä…czenie.

## References

- [PortSwigger Research â€“ â€œBypassing rate limits with GraphQL aliasingâ€ (2023)](https://portswigger.net/research/graphql-authorization-bypass)
- [PortSwigger Research â€“ â€œHTTP/2: The Sequel is Always Worseâ€ (connection-based throttling) (2024)](https://portswigger.net/research/http2)
- [Cloudflare Docs â€“ WebSockets & WAF applicability (2025)](https://developers.cloudflare.com/network/websockets/)
- [Cloudflare Docs â€“ Request rate calculation and PoP-local counters (2025)](https://developers.cloudflare.com/waf/rate-limiting-rules/request-rate/)

{{#include ../banners/hacktricks-training.md}}
