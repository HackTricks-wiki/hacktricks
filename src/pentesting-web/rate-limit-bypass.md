# Bypass de Limite de Taxa

{{#include ../banners/hacktricks-training.md}}

## T√©cnicas de Bypass de Limite de Taxa

### Explorando Endpoints Similares

Devem ser feitas tentativas de realizar ataques de for√ßa bruta em varia√ß√µes do endpoint alvo, como `/api/v3/sign-up`, incluindo alternativas como `/Sing-up`, `/SignUp`, `/singup`, `/api/v1/sign-up`, `/api/sign-up`, etc.

### Incorporando Caracteres em Branco em C√≥digo ou Par√¢metros

Inserir bytes em branco como `%00`, `%0d%0a`, `%0d`, `%0a`, `%09`, `%0C`, `%20` em c√≥digo ou par√¢metros pode ser uma estrat√©gia √∫til. Por exemplo, ajustar um par√¢metro para `code=1234%0a` permite estender tentativas atrav√©s de varia√ß√µes na entrada, como adicionar caracteres de nova linha a um endere√ßo de e-mail para contornar limita√ß√µes de tentativas.

### Manipulando a Origem do IP via Cabe√ßalhos

Modificar cabe√ßalhos para alterar a origem do IP percebida pode ajudar a evitar limita√ß√£o de taxa baseada em IP. Cabe√ßalhos como `X-Originating-IP`, `X-Forwarded-For`, `X-Remote-IP`, `X-Remote-Addr`, `X-Client-IP`, `X-Host`, `X-Forwared-Host`, incluindo o uso de v√°rias inst√¢ncias de `X-Forwarded-For`, podem ser ajustados para simular solicita√ß√µes de diferentes IPs.
```bash
X-Originating-IP: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Host: 127.0.0.1
X-Forwared-Host: 127.0.0.1

# Double X-Forwarded-For header example
X-Forwarded-For:
X-Forwarded-For: 127.0.0.1
```
### Mudando Outros Cabe√ßalhos

Alterar outros cabe√ßalhos de solicita√ß√£o, como o user-agent e cookies, √© recomendado, pois esses tamb√©m podem ser usados para identificar e rastrear padr√µes de solicita√ß√£o. Mudar esses cabe√ßalhos pode prevenir o reconhecimento e rastreamento das atividades do solicitante.

### Aproveitando o Comportamento do API Gateway

Alguns gateways de API s√£o configurados para aplicar limita√ß√£o de taxa com base na combina√ß√£o de endpoint e par√¢metros. Variando os valores dos par√¢metros ou adicionando par√¢metros n√£o significativos √† solicita√ß√£o, √© poss√≠vel contornar a l√≥gica de limita√ß√£o de taxa do gateway, fazendo com que cada solicita√ß√£o pare√ßa √∫nica. Por exemplo `/resetpwd?someparam=1`.

### Fazendo Login na Sua Conta Antes de Cada Tentativa

Fazer login em uma conta antes de cada tentativa, ou a cada conjunto de tentativas, pode redefinir o contador de limita√ß√£o de taxa. Isso √© especialmente √∫til ao testar funcionalidades de login. Utilizando um ataque Pitchfork em ferramentas como Burp Suite, para rotacionar credenciais a cada poucas tentativas e garantindo que os redirecionamentos sejam marcados, pode efetivamente reiniciar os contadores de limita√ß√£o de taxa.

### Utilizando Redes de Proxy

Implantar uma rede de proxies para distribuir as solicita√ß√µes entre v√°rios endere√ßos IP pode efetivamente contornar limites de taxa baseados em IP. Roteando o tr√°fego atrav√©s de v√°rios proxies, cada solicita√ß√£o parece originar de uma fonte diferente, diluindo a efic√°cia da limita√ß√£o de taxa.

### Dividindo o Ataque Entre Diferentes Contas ou Sess√µes

Se o sistema alvo aplica limites de taxa com base em cada conta ou sess√£o, distribuir o ataque ou teste entre v√°rias contas ou sess√µes pode ajudar a evitar a detec√ß√£o. Essa abordagem requer gerenciar m√∫ltiplas identidades ou tokens de sess√£o, mas pode efetivamente distribuir a carga para permanecer dentro dos limites permitidos.

### Continue Tentando

Observe que, mesmo que um limite de taxa esteja em vigor, voc√™ deve tentar ver se a resposta √© diferente quando o OTP v√°lido √© enviado. Em [**este post**](https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732), o ca√ßador de bugs descobriu que, mesmo que um limite de taxa seja acionado ap√≥s 20 tentativas malsucedidas, respondendo com 401, se o v√°lido for enviado, uma resposta 200 foi recebida.

---

### Abusando da multiplexa√ß√£o HTTP/2 e do pipeline de solicita√ß√µes (2023-2025)

Implementa√ß√µes modernas de limitadores de taxa frequentemente contam **conex√µes TCP** (ou at√© mesmo solicita√ß√µes HTTP/1.1 individuais) em vez do *n√∫mero de streams HTTP/2* que uma conex√£o cont√©m. Quando a mesma conex√£o TLS √© reutilizada, um atacante pode abrir centenas de streams paralelos, cada um carregando uma solicita√ß√£o separada, enquanto o gateway deduz apenas *uma* solicita√ß√£o da cota.
```bash
# Send 100 POST requests in a single HTTP/2 connection with curl
seq 1 100 | xargs -I@ -P0 curl -k --http2-prior-knowledge -X POST \
-H "Content-Type: application/json" \
-d '{"code":"@"}' https://target/api/v2/verify &>/dev/null
```
Se o limitador protege apenas `/verify`, mas n√£o `/api/v2/verify`, voc√™ tamb√©m pode combinar **confus√£o de caminho** com multiplexa√ß√£o HTTP/2 para *extremamente* alta velocidade de for√ßa bruta de OTP ou credenciais.

> üêæ  **Dica:** O [Turbo Intruder](https://portswigger.net/research/turbo-intruder) da PortSwigger suporta HTTP/2 e permite ajustar `maxConcurrentConnections` e `requestsPerConnection` para automatizar este ataque.

### Aliases GraphQL & opera√ß√µes em lote

GraphQL permite que o cliente envie **v√°rias consultas ou muta√ß√µes logicamente independentes em uma √∫nica solicita√ß√£o** prefixando-as com *aliases*. Como o servidor executa cada alias, mas o limitador de taxa geralmente conta apenas *uma* solicita√ß√£o, isso √© uma forma confi√°vel de contornar a limita√ß√£o de login ou redefini√ß√£o de senha.
```graphql
mutation bruteForceOTP {
a: verify(code:"111111") { token }
b: verify(code:"222222") { token }
c: verify(code:"333333") { token }
# ‚Ä¶ add up to dozens of aliases ‚Ä¶
}
```
Olhe para a resposta: exatamente um alias retornar√° 200 OK quando o c√≥digo correto for atingido, enquanto os outros est√£o com limite de taxa.

A t√©cnica foi popularizada pela pesquisa da PortSwigger sobre ‚ÄúGraphQL batching & aliases‚Äù em 2023 e tem sido respons√°vel por muitos pagamentos recentes de bug-bounty.

### Abuso de endpoints REST *batch* ou *bulk*

Algumas APIs exp√µem endpoints auxiliares, como `/v2/batch`, ou aceitam um **array de objetos** no corpo da solicita√ß√£o. Se o limitador for colocado apenas na frente dos endpoints *legacy*, envolver v√°rias opera√ß√µes dentro de uma √∫nica solicita√ß√£o em massa pode contornar completamente a prote√ß√£o.
```json
[
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"123"}},
{"path": "/login", "method": "POST", "body": {"user":"bob","pass":"456"}}
]
```
### Temporizando a janela deslizante

Um limitador cl√°ssico de token-bucket ou leaky-bucket *reinicia* em um limite de tempo fixo (por exemplo, a cada minuto). Se a janela for conhecida (por exemplo, atrav√©s de mensagens de erro como `X-RateLimit-Reset: 27`), fa√ßa o n√∫mero m√°ximo permitido de solicita√ß√µes **pouco antes** de o balde reiniciar, e ent√£o imediatamente fa√ßa outro estouro completo.
```
|<-- 60 s window ‚Äë->|<-- 60 s window ‚Äë->|
######                 ######
```
Essa simples otimiza√ß√£o pode mais do que dobrar sua taxa de transfer√™ncia sem tocar em nenhuma outra t√©cnica de bypass.

---

## Ferramentas

- [**https://github.com/Hashtag-AMIN/hashtag-fuzz**](https://github.com/Hashtag-AMIN/hashtag-fuzz): Ferramenta de fuzzing que suporta randomiza√ß√£o de cabe√ßalhos, listas de palavras em chunks e rota√ß√£o de proxy round-robin.
- [**https://github.com/ustayready/fireprox**](https://github.com/ustayready/fireprox): Cria automaticamente endpoints descart√°veis do AWS API Gateway para que cada solicita√ß√£o se origine de um endere√ßo IP diferente ‚Äì perfeito para derrotar a limita√ß√£o baseada em IP.
- **Burp Suite ‚Äì IPRotate + extens√£o**: Usa um pool de proxies SOCKS/HTTP (ou AWS API Gateway) para rotacionar o IP de origem de forma transparente durante ataques *Intruder* e *Turbo Intruder*.
- **Turbo Intruder (BApp)**: Motor de ataque de alto desempenho que suporta multiplexa√ß√£o HTTP/2; ajuste `requestsPerConnection` para 100-1000 para colapsar centenas de solicita√ß√µes em uma √∫nica conex√£o.

## Refer√™ncias

- PortSwigger Research ‚Äì ‚ÄúBypassing rate limits with GraphQL aliasing‚Äù  (2023)  <https://portswigger.net/research/graphql-authorization-bypass>
- PortSwigger Research ‚Äì ‚ÄúHTTP/2: The Sequel is Always Worse‚Äù (se√ß√£o *Connection-based throttling*) (2024)  <https://portswigger.net/research/http2>

{{#include ../banners/hacktricks-training.md}}
