# DOM Invader

{{#include ../../banners/hacktricks-training.md}}

## DOM Invader

DOM Invader는 Burp의 내장 브라우저에 설치된 도구입니다. 이 도구는 웹 메시지 및 프로토타입 오염을 포함한 다양한 소스와 싱크를 사용하여 **DOM XSS 취약점**을 **탐지하는 데** 도움을 줍니다. 이 도구는 확장 프로그램으로 사전 설치되어 있습니다.

DOM Invader는 브라우저의 DevTools 패널 내에 탭을 통합하여 다음을 가능하게 합니다:

1. **DOM XSS 테스트를 위한 웹페이지에서 제어 가능한 싱크 식별**, 컨텍스트 및 정화 세부정보 제공.
2. **`postMessage()` 메서드를 통해 전송된 웹 메시지의 로깅, 편집 및 재전송**. DOM Invader는 특별히 제작된 웹 메시지를 사용하여 취약점을 자동으로 탐지할 수도 있습니다.
3. **클라이언트 측 프로토타입 오염** 소스 탐지 및 위험한 싱크로 전송된 제어 가능한 가젯 스캔.
4. **DOM 클로버링 취약점** 식별.

### 활성화하기

Burp의 내장 브라우저에서 **Burp 확장**으로 이동하여 활성화합니다:

<figure><img src="../../images/image (1129).png" alt=""><figcaption></figcaption></figure>

이제 페이지를 새로 고치고 **Dev Tools**에서 **DOM Invader 탭**을 찾을 수 있습니다:

<figure><img src="../../images/image (695).png" alt=""><figcaption></figcaption></figure>

### 카나리 주입하기

이전 이미지에서 **무작위 문자 그룹, 즉 카나리**를 볼 수 있습니다. 이제 웹의 다양한 부분(매개변수, 양식, URL 등)에 **주입**하기 시작하고 매번 검색을 클릭합니다. DOM Invader는 **카나리가 어떤 흥미로운 싱크에 도달했는지** 확인합니다.

또한, **Inject URL params** 및 Inject forms 옵션은 **새 탭**을 자동으로 열어 **URL** 매개변수와 **양식**에서 발견되는 모든 **카나리**를 **주입**합니다.

### 빈 카나리 주입하기

페이지에 잠재적인 싱크가 있을 수 있는지 찾고 싶지만, 그것들이 악용 가능하지 않더라도, **빈 카나리**를 **검색**할 수 있습니다.

### 메시지 전송

DOM Invader는 웹 메시지를 사용하여 DOM XSS를 테스트할 수 있도록 하며, 다음과 같은 기능을 제공합니다:

1. **`postMessage()`를 통해 전송된 웹 메시지 로깅**, Burp Proxy의 HTTP 요청/응답 기록 로깅과 유사합니다.
2. **웹 메시지의 수정** 및 **재발송**을 통해 DOM XSS를 수동으로 테스트할 수 있으며, Burp Repeater의 기능과 유사합니다.
3. **웹 메시지의 자동 변경** 및 전송을 통해 DOM XSS를 탐색합니다.

#### 메시지 세부정보

각 메시지에 대한 자세한 정보는 클릭하여 볼 수 있으며, 클라이언트 측 JavaScript가 메시지의 `origin`, `data` 또는 `source` 속성에 접근하는지 여부를 포함합니다.

- **`origin`** : 메시지의 **origin 정보가 확인되지 않으면**, 임의의 외부 도메인에서 이벤트 핸들러로 교차 출처 메시지를 보낼 수 있습니다. 그러나 확인되면 여전히 안전하지 않을 수 있습니다.
- **`data`**: 페이로드가 전송되는 곳입니다. 이 데이터가 사용되지 않으면, 싱크는 무용지물입니다.
- **`source`**: 일반적으로 iframe을 참조하는 source 속성이 origin 대신 검증되는지 평가합니다. 이것이 확인되더라도 검증이 우회될 수 없다는 보장은 없습니다.

#### 메시지 회신하기

1. **Messages** 보기에서 메시지를 클릭하여 메시지 세부정보 대화 상자를 엽니다.
2. 필요한 대로 **Data** 필드를 편집합니다.
3. **Send**를 클릭합니다.

### 프로토타입 오염

DOM Invader는 **프로토타입 오염 취약점**을 검색할 수도 있습니다. 먼저, 이를 활성화해야 합니다:

<figure><img src="../../images/image (1026).png" alt=""><figcaption></figcaption></figure>

그런 다음, **`Object.prototype`**에 임의의 속성을 추가할 수 있는 **소스**를 **검색**합니다.

무언가가 발견되면 **Test** 버튼이 나타나 **발견된 소스를 테스트**할 수 있습니다. 클릭하면 새 탭이 열리고 콘솔에서 객체를 생성하여 `testproperty`가 존재하는지 확인합니다:
```javascript
let b = {}
b.testproperty
```
소스를 찾으면 **가젯 스캔**을 할 수 있습니다:

1. **DOM** 뷰에서 식별된 프로토타입 오염 소스 옆에 있는 **가젯 스캔** 버튼을 클릭하면 DOM Invader가 새 탭을 엽니다. 적합한 가젯에 대한 스캔이 시작됩니다.
2. 동시에 같은 탭에서 DevTools 패널에 **DOM Invader** 탭이 열려 있어야 합니다. 스캔이 완료되면 식별된 가젯을 통해 접근 가능한 모든 싱크가 **DOM** 뷰에 표시됩니다. 예를 들어, `innerHTML` 싱크에 전달되는 `html`이라는 가젯 속성이 아래 예제에 표시됩니다.

## DOM 클로버링

이전 이미지에서 DOM 클로버링 스캔을 켤 수 있는 것을 볼 수 있습니다. 완료되면 **DOM Invader가 DOM 클로버링 취약점을 검색하기 시작합니다**.

## 참조

- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{{#include ../../banners/hacktricks-training.md}}
