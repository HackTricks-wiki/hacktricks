# Secuestro de cuenta

{{#include ../banners/hacktricks-training.md}}

## **Problema de autorización**

Se debe intentar cambiar el email de una cuenta y **examinar** el proceso de confirmación. Si se considera **débil**, se debe cambiar el email al del objetivo y luego confirmarlo.

## **Problema de normalización Unicode**

1. La cuenta de la víctima prevista `victim@gmail.com`
2. Se debe crear una cuenta usando Unicode\
por ejemplo: `vićtim@gmail.com`

Como se explica en [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), el ataque anterior también podría realizarse abusando de proveedores de identidad terceros:

- Crear una cuenta en el proveedor de identidad tercero con un email similar al de la víctima usando algún carácter unicode (`vićtim@company.com`).
- El proveedor tercero no debería verificar el email.
- Si el proveedor de identidad verifica el email, quizás puedas atacar la parte del dominio, por ejemplo: `victim@ćompany.com`, registrar ese dominio y esperar que el proveedor de identidad genere la versión ascii del dominio mientras la plataforma víctima normaliza el nombre de dominio.
- Iniciar sesión vía ese proveedor de identidad en la plataforma víctima, que debería normalizar el carácter unicode y permitirte acceder a la cuenta de la víctima.

Para más detalles, consulta el documento sobre Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reutilización del token de restablecimiento**

Si el sistema objetivo permite **reutilizar el enlace de restablecimiento**, se deben intentar **encontrar más enlaces de restablecimiento** usando herramientas como `gau`, `wayback` o `scan.io`.

## **Previo al secuestro de cuenta**

1. Se debe usar el email de la víctima para registrarse en la plataforma y establecer una contraseña (se debe intentar confirmarla, aunque la falta de acceso al email de la víctima puede hacer esto imposible).
2. Se debe esperar hasta que la víctima se registre usando OAuth y confirme la cuenta.
3. Se espera que el registro normal se confirme, permitiendo el acceso a la cuenta de la víctima.

## **Mala configuración de CORS para secuestro de cuenta**

Si la página contiene **mala configuración de CORS** podrías ser capaz de **robar información sensible** del usuario para **secuestrar su cuenta** o hacer que cambie información de autenticación con el mismo propósito:


{{#ref}}
cors-bypass.md
{{#endref}}

## **CSRF para secuestro de cuenta**

Si la página es vulnerable a CSRF podrías lograr que el **usuario modifique su contraseña**, email o autenticación para que luego puedas acceder a ella:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS para secuestro de cuenta**

Si encuentras un XSS en la aplicación podrías ser capaz de robar cookies, local storage o información de la página web que podría permitirte secuestrar la cuenta:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Si encuentras un XSS limitado o un subdomain take over, podrías jugar con las cookies (fijándolas por ejemplo) para intentar comprometer la cuenta de la víctima:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Atacar el mecanismo de restablecimiento de contraseña**


{{#ref}}
reset-password.md
{{#endref}}

## Restablecimientos por preguntas de seguridad que confían en nombres de usuario proporcionados por el cliente
Si un flujo de "actualizar preguntas de seguridad" toma un parámetro `username` aun cuando el llamador ya está autenticado, puedes sobrescribir los datos de recuperación de cualquier cuenta (incluidos admins) porque el backend típicamente ejecuta `UPDATE ... WHERE user_name = ?` con tu valor no confiable. El patrón es:

1. Inicia sesión con un usuario desechable y captura la cookie de sesión.
2. Envía el username de la víctima más nuevas respuestas vía el formulario de restablecimiento.
3. Autentícate inmediatamente a través del endpoint de login por preguntas de seguridad usando las respuestas que acabas de inyectar para heredar los privilegios de la víctima.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Los nombres de usuario enumerados pueden entonces ser apuntados mediante la técnica de overwrite descrita arriba o reutilizados contra servicios auxiliares (FTP/SSH password spraying).

## **Response Manipulation**

If the authentication response could be **reduced to a simple boolean just try to change false to true** and see if you get any access.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The Host header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The Host, Referrer, and Origin headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
- The status code is changed to `200 OK`.
- The response body is modified to `{"success":true}` or an empty object `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

Esto también ocurrió en [**este informe**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

Como se explica [**en esta publicación**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), era posible iniciar sesión en una cuenta, guardar las cookies como usuario autenticado, cerrar sesión y luego iniciar sesión de nuevo.\
Con el nuevo login, aunque se generaran cookies diferentes, las antiguas volvían a funcionar.

## Referencias

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
