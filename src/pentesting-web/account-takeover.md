# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Pokušajte promeniti email naloga i **obavezno pregledajte** proces potvrde. Ako se utvrdi da je **slab**, promenite email u onaj ciljanog korisnika i potom ga potvrdite.

## **Unicode Normalization Issue**

1. Nalog ciljanog korisnika `victim@gmail.com`
2. Kreirajte nalog koristeći Unicode  
   na primer: `vićtim@gmail.com`

Kao što je objašnjeno u [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), prethodni napad se može izvesti i zloupotrebom provajdera identiteta treće strane:

- Kreirajte nalog kod provajdera identiteta treće strane sa email-om sličnim žrtvinom koristeći neki unicode karakter (`vićtim@company.com`).
- Provajder treće strane ne bi trebalo da verifikuje email.
- Ako provajder identiteta verifikuje email, možda možete napasti deo domena kao: `victim@ćompany.com`, registrovati taj domen i nadati se da provajder identiteta generiše ASCII verziju domena dok platforma žrtve normalizuje ime domena.
- Prijavite se preko ovog provajdera identiteta na platformi žrtve koja bi trebalo da normalizuje unicode karakter i dozvoli vam pristup nalogu žrtve.

Za više detalja konsultujte dokument o Unicode normalizaciji:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Ako ciljani sistem dozvoljava **ponovnu upotrebu reset linka**, treba pokušati **pronaći više reset linkova** koristeći alate kao što su `gau`, `wayback` ili `scan.io`.

## **Pre Account Takeover**

1. Email žrtve treba koristiti za registraciju na platformi i treba postaviti lozinku (treba pokušati potvrditi nalog, iako nedostatak pristupa žrtvinim emailovima to može onemogućiti).
2. Treba sačekati da se žrtva registruje koristeći OAuth i potvrdi nalog.
3. Nadamo se da će obična registracija biti potvrđena, što omogućava pristup žrtvinom nalogu.

## **CORS Misconfiguration to Account Takeover**

Ako stranica sadrži **CORS misconfigurations**, možda ćete moći **ukrasti osetljive informacije** od korisnika kako biste **preuzeli njegov nalog** ili ga naterali da promeni auth informacije u istu svrhu:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Ako je stranica ranjiva na CSRF, možda ćete moći naterati **korisnika da izmeni svoju lozinku**, email ili autentifikaciju kako biste zatim mogli pristupiti nalogu:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Ako nađete XSS u aplikaciji, možda ćete moći ukrasti cookies, local storage ili informacije sa web stranice koje bi vam omogućile preuzimanje naloga:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Ako pronađete ograničen XSS ili subdomain take over, možete manipulisati cookies (npr. njihovo fixiranje) da pokušate kompromitovati nalog žrtve:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Ako tok "update security questions" prima parametar `username` iako je pozivalac već autentifikovan, možete prebrisati podatke za oporavak bilo kog naloga (uključujući admina), jer backend obično izvršava `UPDATE ... WHERE user_name = ?` sa vašom neproverenom vrednošću. Šablon je:

1. Prijavite se sa jednokratnim korisnikom i uhvatite session cookie.
2. Pošaljite username žrtve zajedno sa novim odgovorima putem forme za resetovanje.
3. Odmah se autentifikujte preko endpointa za login putem security-question koristeći odgovore koje ste upravo ubacili kako biste nasledili privilegije žrtve.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

If the authentication response could be **reduced to a simple boolean just try to change false to true** and see if you get any access.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The Host header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The Host, Referrer, and Origin headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
- The status code is changed to `200 OK`.
- The response body is modified to `{"success":true}` or an empty object `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
