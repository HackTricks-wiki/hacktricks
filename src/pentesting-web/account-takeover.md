# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Problema de Autorização**

Deve-se tentar alterar o email de uma conta e o processo de confirmação **deve ser examinado**. Se for considerado **fraco**, o email deve ser alterado para o do alvo pretendido e então confirmado.

## **Problema de Normalização Unicode**

1. A conta da vítima pretendida `victim@gmail.com`
2. Deve-se criar uma conta usando Unicode\
por exemplo: `vićtim@gmail.com`

Conforme explicado em [**esta palestra**](https://www.youtube.com/watch?v=CiIyaZ3x49c), o ataque anterior também pode ser feito abusando de third party identity providers:

- Crie uma conta no third party identity com email semelhante ao da vítima usando algum caractere unicode (`vićtim@company.com`).
- O third party provider não deve verificar o email
- Se o identity provider verificar o email, talvez você consiga atacar a parte do domínio, por exemplo: `victim@ćompany.com`, registrar esse domínio e torcer para que o identity provider gere a versão ascii do domínio enquanto a plataforma da vítima normaliza o nome de domínio.
- Faça login via esse identity provider na plataforma da vítima, que deve normalizar o caractere unicode e permitir que você acesse a conta da vítima.

Para mais detalhes, consulte o documento sobre Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Caso o sistema alvo permita que o **reset link seja reutilizado**, deve-se esforçar para **encontrar mais reset links** usando ferramentas como `gau`, `wayback`, ou `scan.io`.

## **Pré Account Takeover**

1. Deve-se usar o email da vítima para se cadastrar na plataforma e definir uma senha (deve-se tentar confirmá-la, embora a falta de acesso aos emails da vítima possa tornar isso impossível).
2. Deve-se aguardar até que a vítima se cadastre usando OAuth e confirme a conta.
3. Espera-se que o cadastro regular seja confirmado, permitindo o acesso à conta da vítima.

## **Misconfiguração CORS para Account Takeover**

Se a página contiver **CORS misconfigurations** você pode ser capaz de **roubar informações sensíveis** do usuário para **assumir a conta dele** ou fazê-lo alterar informações de autenticação para o mesmo propósito:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Se a página for vulnerável a CSRF você pode conseguir fazer o **usuário modificar sua senha**, email ou autenticação para que você então possa acessá-la:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Se você encontrar um XSS na aplicação, pode ser capaz de roubar cookies, local storage, ou informações da página web que poderiam permitir que você assumisse a conta:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

## **Same Origin + Cookies**

Se você encontrar um XSS limitado ou um subdomain take over, você pode manipular os cookies (fixando-os, por exemplo) para tentar comprometer a conta da vítima:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Se um fluxo de "update security questions" aceitar um parâmetro `username` mesmo que o chamador já esteja autenticado, você pode sobrescrever os dados de recuperação de qualquer conta (incluindo admins) porque o backend tipicamente executa `UPDATE ... WHERE user_name = ?` com o seu valor não confiável. O padrão é:

1. Faça login com um usuário descartável e capture o session cookie.
2. Envie o username da vítima mais novas respostas através do formulário de reset.
3. Autentique-se imediatamente pelo endpoint de login por security-question usando as respostas que você acabou de injetar para herdar os privilégios da vítima.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Nomes de usuário enumerados podem então ser alvo do overwrite technique acima ou reutilizados contra serviços auxiliares (FTP/SSH password spraying).

## **Response Manipulation**

Se a resposta de autenticação puder ser **reduced to a simple boolean just try to change false to true** tente apenas trocar false por true e veja se obtém acesso.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. O header Host é modificado após o início de uma solicitação de password reset.
2. O header proxy `X-Forwarded-For` é alterado para `attacker.com`.
3. Os headers Host, Referrer e Origin são simultaneamente alterados para `attacker.com`.
4. Após iniciar um password reset e optar por reenviar o email, todos os três métodos acima são empregados.

## Response Manipulation

1. **Code Manipulation**: O status code é alterado para `200 OK`.
2. **Code and Body Manipulation**:
- O status code é alterado para `200 OK`.
- O corpo da resposta é modificado para `{"success":true}` ou um objeto vazio `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

De [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- O atacante solicita a alteração do seu email para um novo
- O atacante recebe um link para confirmar a alteração do email
- O atacante envia o link para a vítima para que ela clique nele
- O email da vítima é alterado para o indicado pelo atacante
- O atacante pode recuperar a senha e assumir a conta

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- O atacante altera o email verificado para victim@test.com (sem verificação secundária na mudança de email)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

Conforme explicado [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), era possível fazer login em uma conta, salvar os cookies como um usuário autenticado, logout, e então fazer login novamente.\
Com o novo login, embora cookies diferentes pudessem ser gerados, os antigos voltavam a funcionar.

## References

- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
