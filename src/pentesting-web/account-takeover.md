# Hesap Ele Geçirme

{{#include ../banners/hacktricks-training.md}}

## **Yetkilendirme Sorunu**

Bir hesabın e-posta adresinin değiştirilmesi denenmeli ve onay süreci **incelenmelidir**. Eğer **zayıf** bulunursa, e-posta hedef kurbanın e-posta adresi ile değiştirilip onaylanmalıdır.

## **Unicode Normalizasyon Sorunu**

1. Hedef kurbanın hesabı `victim@gmail.com`
2. Unicode kullanarak bir hesap oluşturulmalıdır\
örneğin: `vićtim@gmail.com`

Açıklandığı gibi [**bu konuşmada**](https://www.youtube.com/watch?v=CiIyaZ3x49c), önceki saldırı üçüncü taraf kimlik sağlayıcılarını kötüye kullanarak da yapılabilir:

- Kurbanın e-posta adresine benzer bir e-posta ile üçüncü taraf kimlik sağlayıcısında bir hesap oluşturun, bazı unicode karakterleri kullanarak (`vićtim@company.com`).
- Üçüncü taraf sağlayıcı e-postayı doğrulamamalıdır.
- Eğer kimlik sağlayıcı e-postayı doğruluyorsa, belki de alan adı kısmını saldırıya uğratabilirsiniz, örneğin: `victim@ćompany.com` ve o alan adını kaydedip kimlik sağlayıcının alan adının ascii versiyonunu oluşturmasını umabilirsiniz, kurban platformu alan adı adını normalize ederken.
- Bu kimlik sağlayıcı aracılığıyla kurban platformuna giriş yapın, bu platform unicode karakterini normalize etmeli ve kurban hesabına erişim sağlamanıza izin vermelidir.

Daha fazla ayrıntı için Unicode Normalizasyonu belgesine bakın:

{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Sıfırlama Token'ını Yeniden Kullanma**

Hedef sistem **sıfırlama bağlantısının yeniden kullanılmasına** izin veriyorsa, `gau`, `wayback` veya `scan.io` gibi araçlar kullanarak **daha fazla sıfırlama bağlantısı bulmak** için çaba sarf edilmelidir.

## **Hesap Ele Geçirmeden Önce**

1. Kurbanın e-posta adresi platformda kaydolmak için kullanılmalı ve bir şifre belirlenmelidir (onaylamak için bir girişimde bulunulmalı, ancak kurbanın e-postalarına erişim yoksa bu imkansız hale gelebilir).
2. Kurbanın OAuth kullanarak kaydolmasını ve hesabı onaylamasını beklemelidir.
3. Normal kaydın onaylanması umulmakta, bu da kurbanın hesabına erişim sağlamaktadır.

## **CORS Yanlış Yapılandırması ile Hesap Ele Geçirme**

Eğer sayfa **CORS yanlış yapılandırmaları** içeriyorsa, kullanıcıdan **hassas bilgileri çalma** veya onun kimlik bilgilerini değiştirmesi için onu yönlendirme şansınız olabilir:

{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf ile Hesap Ele Geçirme**

Eğer sayfa CSRF'ye karşı savunmasızsa, **kullanıcının şifresini**, e-posta adresini veya kimlik doğrulamasını değiştirmesini sağlayabilir ve böylece erişim sağlayabilirsiniz:

{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS ile Hesap Ele Geçirme**

Eğer uygulamada bir XSS bulursanız, çerezleri, yerel depolamayı veya hesabı ele geçirmenizi sağlayacak web sayfasından bilgileri çalma şansınız olabilir:

{{#ref}}
xss-cross-site-scripting/
{{#endref}}

## **Aynı Kaynak + Çerezler**

Eğer sınırlı bir XSS veya bir alt alan ele geçirme bulursanız, çerezlerle oynamak (örneğin, onları sabitlemek) kurban hesabını tehlikeye atmak için bir yol olabilir:

{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Şifre Sıfırlama Mekanizmasına Saldırma**

{{#ref}}
reset-password.md
{{#endref}}

## **Yanıt Manipülasyonu**

Eğer kimlik doğrulama yanıtı **basit bir boolean'a indirgenebiliyorsa, false'u true olarak değiştirmeyi deneyin** ve erişim elde edip edemediğinizi görün.

## OAuth ile Hesap Ele Geçirme

{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Başlık Enjeksiyonu

1. Şifre sıfırlama isteği başlatıldıktan sonra Host başlığı değiştirilir.
2. `X-Forwarded-For` proxy başlığı `attacker.com` olarak değiştirilir.
3. Host, Referrer ve Origin başlıkları aynı anda `attacker.com` olarak değiştirilir.
4. Şifre sıfırlama başlatıldıktan sonra e-postayı yeniden göndermeyi seçerken, yukarıda belirtilen üç yöntem de kullanılır.

## Yanıt Manipülasyonu

1. **Kod Manipülasyonu**: Durum kodu `200 OK` olarak değiştirilir.
2. **Kod ve Gövde Manipülasyonu**:
- Durum kodu `200 OK` olarak değiştirilir.
- Yanıt gövdesi `{"success":true}` veya boş bir nesne `{}` olarak değiştirilir.

Bu manipülasyon teknikleri, veri iletimi ve alımı için JSON kullanıldığında etkilidir.

## Mevcut Oturumun E-posta Adresini Değiştirme

[bu rapordan](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Saldırgan yeni bir e-posta ile e-posta adresini değiştirmeyi talep eder.
- Saldırgan, e-posta değişikliğini onaylamak için bir bağlantı alır.
- Saldırgan, kurbana bağlantıyı gönderir, böylece tıklayabilir.
- Kurbanın e-posta adresi saldırganın belirttiği e-posta ile değiştirilir.
- Saldırgan şifreyi kurtarabilir ve hesabı ele geçirebilir.

Bu, [**bu raporda**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea) da olmuştur.

### Eski Çerezler

Açıklandığı gibi [**bu yazıda**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), bir hesaba giriş yapmak, çerezleri kimlik doğrulaması yapılmış bir kullanıcı olarak kaydetmek, çıkış yapmak ve sonra tekrar giriş yapmak mümkündü.\
Yeni girişle, farklı çerezler oluşturulsa da eski çerezler tekrar çalışmaya başladı.

## Referanslar

- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)

{{#include ../banners/hacktricks-training.md}}
