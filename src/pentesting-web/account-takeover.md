# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Si dovrebbe tentare di cambiare l'email di un account e il processo di conferma **deve essere esaminato**. Se risulta **debole**, l'email dovrebbe essere cambiata con quella della vittima presunta e poi confermata.

## **Unicode Normalization Issue**

1. L'account della vittima presunta `victim@gmail.com`
2. Bisogna creare un account usando Unicode\
ad esempio: `vićtim@gmail.com`

Come spiegato in [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), l'attacco precedente potrebbe essere eseguito anche abusando di provider di identità di terze parti:

- Creare un account nel provider di identità di terze parti con un'email simile a quella della vittima usando qualche carattere Unicode (`vićtim@company.com`).
- Il provider di terze parti non dovrebbe verificare l'email
- Se il provider verifica l'email, potresti attaccare la parte di dominio, ad esempio: `victim@ćompany.com` e registrare quel dominio sperando che il provider generi la versione ASCII del dominio mentre la piattaforma della vittima normalizza il nome del dominio.
- Effettuare il login tramite questo identity provider sulla piattaforma della vittima che dovrebbe normalizzare il carattere Unicode e permetterti di accedere all'account della vittima.

Per ulteriori dettagli, fare riferimento al documento sulla normalizzazione Unicode:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Se il sistema target consente il **riutilizzo del reset link**, si dovrebbero compiere sforzi per **trovare altri reset link** usando strumenti come `gau`, `wayback`, o `scan.io`.

## **Pre Account Takeover**

1. L'email della vittima dovrebbe essere usata per registrarsi sulla piattaforma e impostare una password (bisogna tentare di confermarla, anche se l'assenza di accesso alle email della vittima potrebbe renderlo impossibile).
2. Bisogna aspettare che la vittima si registri usando OAuth e confermi l'account.
3. Si spera che la registrazione regolare venga confermata, permettendo l'accesso all'account della vittima.

## **CORS Misconfiguration to Account Takeover**

Se la pagina contiene **CORS misconfigurations** potresti essere in grado di **rubare informazioni sensibili** dall'utente per **takeover his account** o fargli cambiare le informazioni di autenticazione per lo stesso scopo:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Se la pagina è vulnerabile a CSRF potresti riuscire a far sì che l'**utente modifichi la sua password**, email o autenticazione in modo da poter poi accedervi:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Se trovi una XSS nell'applicazione potresti essere in grado di rubare cookie, local storage, o informazioni dalla pagina web che potrebbero permetterti di takeover l'account:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Se trovi una XSS limitata o un subdomain take over, potresti giocare con i cookie (ad esempio fissandoli) per provare a compromettere l'account della vittima:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Se un flow "update security questions" accetta un parametro `username` anche se il chiamante è già autenticato, puoi sovrascrivere i dati di recovery di qualsiasi account (inclusi gli amministratori) perché il backend tipicamente esegue `UPDATE ... WHERE user_name = ?` con il tuo valore non attendibile. Il pattern è:

1. Accedi con un utente usa-e-getta e cattura il cookie di sessione.
2. Invia lo username della vittima più le nuove risposte tramite il form di reset.
3. Autenticati immediatamente attraverso l'endpoint di login per le domande di sicurezza usando le risposte che hai appena iniettato per ereditare i privilegi della vittima.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) è ora esposto senza toccare le risposte reali.

Gli username enumerati possono poi essere presi di mira tramite the overwrite technique sopra oppure riutilizzati contro servizi accessori (FTP/SSH password spraying).

## **Response Manipulation**

Se la authentication response può essere **ridotta a un semplice booleano prova a cambiare false in true** e verifica se ottieni accesso.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. L'header Host viene modificato dopo l'inizio della richiesta di password reset.
2. L'header proxy `X-Forwarded-For` viene alterato in `attacker.com`.
3. Gli header Host, Referrer e Origin vengono contemporaneamente cambiati in `attacker.com`.
4. Dopo aver avviato un password reset e poi aver scelto di rinviare la mail, vengono impiegati tutti e tre i metodi sopra menzionati.

## Response Manipulation

1. **Code Manipulation**: lo status code viene alterato in `200 OK`.
2. **Code and Body Manipulation**:
- Lo status code viene cambiato in `200 OK`.
- Il body della response viene modificato in `{"success":true}` o in un oggetto vuoto `{}`.

Queste tecniche di manipulation sono efficaci in scenari dove viene utilizzato JSON per la trasmissione e la ricezione dei dati.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker richiede di cambiare la sua email con una nuova
- Attacker riceve un link per confermare il cambio dell'email
- Attacker invia il link alla victim così che lo clicchi
- L'email della victim viene cambiata con quella indicata dall'attacker
- L'attacco può recuperare la password e take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins con attacker@test.com e verifica l'email al momento della signup.
- Attacker cambia l'email verificata in victim@test.com (no secondary verification on email change)
- Ora il sito permette a victim@test.com di login e abbiamo bypassato la email verification dell'utente victim.

### Old Cookies

Come spiegato [**in questo post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), era possibile login in un account, salvare i cookies come utente autenticato, logout, e poi login di nuovo.\
Con il nuovo login, anche se potevano essere generati cookies differenti, i vecchi sono tornati a funzionare.

## Riferimenti

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
