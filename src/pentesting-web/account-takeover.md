# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Magtigingskwessie**

Daar moet probeer word om die e-pos van 'n rekening te verander, en die bevestigingsproses **moet ondersoek word**. As dit as **swak** bevind word, moet die e-pos na dié van die beoogde slagoffer verander en dan bevestig word.

## **Unicode Normaliseringskwessie**

1. Die rekening van die beoogde slagoffer `victim@gmail.com`
2. Daar moet 'n rekening geskep word met Unicode\
byvoorbeeld: `vićtim@gmail.com`

As verduidelik in [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), kan die vorige aanval ook uitgevoer word deur derdeparty identity providers te misbruik:

- Skep 'n rekening by die derdeparty identity met 'n soortgelyke e-posadres as die slagoffer deur 'n unicode-karakter te gebruik (`vićtim@company.com`).
- Die derdeparty-provider behoort nie die e-pos te verifieer nie.
- As die identity provider die e-pos verifieer, kan jy dalk die domeingedeelte aanval soos: `victim@ćompany.com` en daardie domein registreer en hoop dat die identity provider die ASCII-weergawe van die domein genereer terwyl die slagofferplatform die domeinnaam normaliseer.
- Teken in via hierdie identity provider op die slagofferplatform wat die unicode-karakter behoort te normaliseer en jou toelaat om toegang tot die slagofferrekening te kry.

Vir verdere besonderhede, verwys na die dokument oor Unicode Normalisering:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Herbruik van Reset Token**

Indien die teikenstelsel toelaat dat die **reset-skakel hergebruik word**, moet pogings aangewend word om **meer reset-skakels te vind** deur gereedskap soos `gau`, `wayback`, of `scan.io` te gebruik.

## **Pre Account Takeover**

1. Die slagoffer se e-posadres moet gebruik word om op die platform aan te meld, en 'n wagwoord moet gestel word (daar moet 'n poging aangewend word om dit te bevestig, alhoewel gebrek aan toegang tot die slagoffer se e-posse dit moontlik onmoontlik maak).
2. Een moet wag totdat die slagoffer via OAuth aanmeld en die rekening bevestig.
3. Daar word gehoop dat die gewone registrasie bevestig sal word, wat toegang tot die slagoffer se rekening sal gee.

## **CORS-misconfigurasie na Account Takeover**

As die bladsy **CORS-misconfigurasies** bevat, kan jy dalk **gevoelige inligting** van die gebruiker steel om sy rekening te **oorneem** of hom laat verander van auth-inligting vir dieselfde doel:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf na Account Takeover**

Indien die bladsy vatbaar is vir CSRF kan jy moontlik die **gebruiker laat sy wagwoord**, e-pos of authentisering wysig sodat jy dan toegang kan kry:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS na Account Takeover**

As jy 'n XSS in die toepassing vind, kan jy dalk cookies, local storage, of inligting vanaf die webblad steel wat jou in staat kan stel om die rekening oor te neem:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribuut-alleen gereflekteerde payloads op aanmeldbladsye kan `document.onkeypress` inkoppel, toetsaanslae exfiltreer via `new Image().src`, en kredensiale steel sonder om die vorm in te dien. Sien [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) vir 'n praktiese workflow.

## **Gelyke oorsprong + Cookies**

As jy 'n beperkte XSS of 'n subdomein-oorneming vind, kan jy met die cookies speel (byvoorbeeld deur dit te fixateer) om te probeer die slagofferrekening te kompromitteer:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Aanval op Password Reset-meganisme**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Indien 'n "update security questions" vloei 'n `username` parameter aanvaar al is die oproeper reeds geauthentiseer, kan jy enige rekening se recovery-data oorskryf (insluitend admins) omdat die backend tipies `UPDATE ... WHERE user_name = ?` met jou onbetroubare waarde uitvoer. Die patroon is:

1. Teken aan met 'n weggooi-gebruiker en vang die session cookie.
2. Dien die slagoffer se username plus nuwe antwoorde via die reset-vorm in.
3. Verifieer onmiddellik deur die security-question login endpoint met die antwoorde wat jy net ingespuit het om die slagoffer se voorregte te erf.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Alles wat deur die victim se `$_SESSION` konteks (admin dashboards, gevaarlike stream-wrapper features, ens.) afgebaken is, is nou blootgestel sonder om die regte antwoorde aan te raak.

Enumerated usernames kan dan geteiken word via die bostaande overwrite-tegniek of hergebruik word teen ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

Indien die authentication response **gereduseer kan word tot 'n eenvoudige boolean, probeer net om false na true te verander** en kyk of jy toegang kry.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. Die Host header word gewysig nadat 'n password reset request geïnitieer is.
2. Die `X-Forwarded-For` proxy header word verander na `attacker.com`.
3. Die Host, Referrer, en Origin headers word terselfdertyd verander na `attacker.com`.
4. Na die inisieer van 'n password reset en dan die keuse om die mail weer te stuur, word al drie bogenoemde metodes toegepas.

## Response Manipulation

1. **Code Manipulation**: Die statuskode word verander na `200 OK`.
2. **Code and Body Manipulation**:
- Die statuskode word verander na `200 OK`.
- Die response body word gewysig na `{"success":true}` of 'n leë objek `{}`.

Hierdie manipulasie-tegnieke is effektief in scenario's waar JSON gebruik word vir data-oordrag en -ontvangs.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
