# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Слід спробувати змінити email облікового запису та уважно перевірити процес підтвердження. Якщо він виявиться слабким, потрібно змінити email на той, що належить жертві, та підтвердити його.

## **Unicode Normalization Issue**

1. Обліковий запис цільової жертви `victim@gmail.com`
2. Потрібно створити обліковий запис, використовуючи Unicode\
наприклад: `vićtim@gmail.com`

Як пояснено в [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), попередню атаку також можна здійснити, зловживаючи third party identity providers:

- Створіть обліковий запис у third party identity з email, схожим на email жертви, використавши якийсь unicode-символ (`vićtim@company.com`).
- Цей third party provider не повинен перевіряти email
- Якщо identity provider перевіряє email, можливо, можна атакувати частину домену, наприклад: `victim@ćompany.com`, зареєструвати цей домен і сподіватися, що identity provider згенерує ASCII-версію домену, тоді як платформа жертви нормалізує ім'я домену.
- Увійдіть через цей identity provider на платформу жертви, яка має нормалізувати unicode-символ і дозволити вам доступ до облікового запису жертви.

Для детальнішої інформації див. документ про Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Якщо цільова система дозволяє **reset link** повторно використовувати, слід докласти зусиль, щоб **знайти більше reset links** за допомогою інструментів, таких як `gau`, `wayback` або `scan.io`.

## **Pre Account Takeover**

1. Слід використати email жертви для реєстрації на платформі та встановити пароль (варто спробувати підтвердити його, хоча відсутність доступу до email жертви може зробити це неможливим).
2. Потрібно чекати, поки жертва не зареєструється через OAuth і не підтвердить обліковий запис.
3. Сподіваються, що звичайна реєстрація буде підтверджена, що дозволить отримати доступ до облікового запису жертви.

## **CORS Misconfiguration to Account Takeover**

Якщо сторінка містить **CORS misconfigurations**, ви можете **вкрасти конфіденційну інформацію** у користувача, щоб **захопити його обліковий запис** або змусити його змінити дані автентифікації з тією ж метою:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Якщо сторінка вразлива до CSRF, ви можете змусити **користувача змінити його пароль**, email або дані автентифікації, щоб потім отримати до нього доступ:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Якщо ви знайдете XSS в додатку, ви можете вкрасти cookies, local storage або інформацію зі сторінки, що може дозволити вам захопити обліковий запис:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Якщо ви знайдете обмежений XSS або зможете виконати subdomain take over, ви можете гратися з cookies (наприклад, фіксуючи їх), щоб спробувати скомпрометувати обліковий запис жертви:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
If an "update security questions" flow takes a `username` parameter even though the caller is already authenticated, you can overwrite any account's recovery data (including admins) because the backend typically runs `UPDATE ... WHERE user_name = ?` with your untrusted value. The pattern is:

1. Log in with a throwaway user and capture the session cookie.
2. Submit the victim username plus new answers via the reset form.
3. Immediately authenticate through the security-question login endpoint using the answers you just injected to inherit the victim's privileges.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Усе, що захищено контекстом `$_SESSION` victim (панелі адміністратора, небезпечні можливості stream-wrapper тощо), тепер відкрито без торкання реальних відповідей.

Перераховані імена користувачів можна потім таргетувати за допомогою overwrite technique, описаної вище, або повторно використовувати проти допоміжних сервісів (FTP/SSH password spraying).

## **Response Manipulation**

Якщо відповідь автентифікації можна **звес­ти до простого булевого значення — просто спробуйте змінити false на true** і подивіться, чи отримаєте доступ.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. Заголовок Host змінюється після ініціації запиту на скидання пароля.
2. Заголовок проксі `X-Forwarded-For` змінюється на `attacker.com`.
3. Заголовки Host, Referrer та Origin одночасно змінюються на `attacker.com`.
4. Після ініціації скидання пароля та вибору повторної відправки листа застосовуються всі три вищезгадані методи.

## Response Manipulation

1. **Code Manipulation**: статусний код змінюється на `200 OK`.
2. **Code and Body Manipulation**:
- Статусний код змінюється на `200 OK`.
- Тіло відповіді модифікується до `{"success":true}` або порожнього об'єкта `{}`.

Ці методи маніпуляції ефективні у сценаріях, де для передачі та отримання даних використовується JSON.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), було можливо увійти в обліковий запис, зберегти cookies як автентифікований користувач, вийти, а потім увійти знову.  
При новому вході, хоча могли бути згенеровані інші cookies, старі знову починали працювати.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
