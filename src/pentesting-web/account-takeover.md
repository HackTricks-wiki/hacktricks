# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Bir hesabın e-posta adresi değiştirmeye çalışılmalı ve onay süreci **incelenmelidir**. Eğer zayıf olduğu tespit edilirse, e-posta hedef kurbanın e-postasıyla değiştirilip onaylanmalıdır.

## **Unicode Normalization Issue**

1. Hedef kurbanın hesabı `victim@gmail.com`
2. Unicode kullanılarak bir hesap oluşturulmalı\
örneğin: `vićtim@gmail.com`

[**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c)da açıklandığı gibi, önceki saldırı üçüncü taraf identity provider'ları kötüye kullanarak da gerçekleştirilebilir:

- Üçüncü taraf identity üzerinde kurbana benzer bir e-posta ile hesap oluşturun, bazı unicode karakterleri kullanarak (`vićtim@company.com`).
- Üçüncü taraf provider e-postayı doğrulamamalı
- Eğer identity provider e-postayı doğruluyorsa, domain kısmına saldırmayı deneyebilirsiniz mesela: `victim@ćompany.com` ve o domaini kayıt edip, identity provider'ın domainin ascii versiyonunu üretmesini umabilirsiniz; aynı zamanda hedef platform domain adını normalize eder.
- Bu identity provider ile hedef platformda oturum açın; hedef platform unicode karakteri normalize edip hesabınıza erişime izin vermelidir.

Daha fazla detay için Unicode Normalization dokümanına bakınız:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Hedef sistem **reset linkinin yeniden kullanılmasına** izin veriyorsa, `gau`, `wayback` veya `scan.io` gibi araçlarla **daha fazla reset linki bulmaya** çalışılmalıdır.

## **Pre Account Takeover**

1. Kurbanın e-postası kullanılarak platformda bir kayıt oluşturulmalı ve bir parola belirlenmelidir (onayı denemek gerekir; fakat kurbanın e-postalarına erişim yoksa bu mümkün olmayabilir).
2. Kurbanın OAuth kullanarak kaydolması ve hesabı onaylaması beklenmelidir.
3. Normal kayıt onaylanırsa, kurbanın hesabına erişim sağlanması umulur.

## **CORS Misconfiguration to Account Takeover**

Eğer sayfada **CORS yapılandırma hataları** varsa, kullanıcıdan **hassas bilgi çalmak** ve kullanıcının hesabını **ele geçirmek** veya aynı amaçla kimlik bilgilerini değiştirmesini sağlamak mümkün olabilir:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Eğer sayfa CSRF'e (CSRF) karşı savunmasızsa, kullanıcının **parolasını**, e-postasını veya kimlik doğrulama bilgilerini değiştirtebilir ve ardından hesabına erişebilirsiniz:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Uygulamada bir XSS bulursanız, çerezleri, local storage'ı veya hesap ele geçirmeye izin verebilecek sayfa üzeri bilgileri çalabilirsiniz:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Giriş sayfalarındaki sadece attribute'lü reflected payload'lar `document.onkeypress`'i hooklayabilir, tuş vuruşlarını `new Image().src` ile exfiltrate edebilir ve formu submit etmeden kimlik bilgilerini çalabilir. Pratik bir iş akışı için [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) bölümüne bakın.

## **Same Origin + Cookies**

Eğer sınırlı bir XSS veya bir subdomain take over bulursanız, çerezlerle (örneğin fixate ederek) oynayarak hedef hesabı ele geçirmeyi deneyebilirsiniz:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Eğer "update security questions" akışı, çağıran zaten authenticated olsa bile bir `username` parametresi alıyorsa, backend tipik olarak sizin güvensiz değerinizi kullanarak `UPDATE ... WHERE user_name = ?` çalıştıracağından, herhangi bir hesabın kurtarma verilerini (adminler dahil) üzerine yazabilirsiniz. Desen şöyledir:

1. Throwaway bir kullanıcı ile giriş yapın ve session cookie'sini yakalayın.
2. Reset formu üzerinden hedef kullanıcının username'ini ve yeni cevapları gönderin.
3. Hemen ardından güvenlik-soru login endpoint'i üzerinden az önce enjekte ettiğiniz cevapları kullanarak authenticate olun ve hedefin ayrıcalıklarını devralın.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

Eğer kimlik doğrulama yanıtı basit bir boolean'a indirgenebiliyorsa, false'ı true'a değiştirmeyi deneyin ve erişim elde edip etmediğinizi görün.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. Bir password reset isteği başlatıldıktan sonra Host header değiştirilir.
2. `X-Forwarded-For` proxy header'ı `attacker.com` olarak değiştirilir.
3. Host, Referrer ve Origin header'ları eşzamanlı olarak `attacker.com` olarak değiştirilir.
4. Bir password reset başlatıldıktan ve e-postayı yeniden gönderme seçeneği seçildikten sonra, yukarıda bahsedilen üç yöntem de uygulanır.

## Response Manipulation

1. **Code Manipulation**: durum kodu `200 OK` olarak değiştirilir.
2. **Code and Body Manipulation**:
- durum kodu `200 OK` olarak değiştirilir.
- response body `{"success":true}` veya boş bir nesne `{}` olarak değiştirilir.

Bu manipülasyon teknikleri, JSON'un veri iletimi ve alımı için kullanıldığı senaryolarda etkilidir.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Saldırgan e-postasını yeni bir adresle değiştirmek için istekte bulunur
- Saldırgan e-posta değişikliğini onaylamak için bir bağlantı alır
- Saldırgan bu bağlantıyı kurbana gönderir, kurban tıklar
- Kurbanın e-postası saldırganın belirttiği adrese değiştirilir
- Saldırgan şifreyi kurtarabilir ve hesabı ele geçirebilir

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Saldırgan attacker@test.com ile giriş yapar ve signup sırasında e-postayı doğrular.
- Saldırgan doğrulanmış e-postayı victim@test.com olarak değiştirir (e-posta değişikliğinde ek doğrulama yok)
- Artık site victim@test.com ile girişe izin veriyor ve kurban kullanıcının e-posta doğrulamasını atladık.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), bir hesaba giriş yapmak, çerezleri doğrulanmış bir kullanıcı olarak kaydetmek, çıkış yapmak ve sonra tekrar giriş yapmak mümkündü.\
Yeni girişle, farklı çerezler oluşturulsa bile eski çerezler tekrar çalışır hale geliyordu.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
