# 계정 탈취

{{#include ../banners/hacktricks-training.md}}

## **권한 문제**

계정의 이메일을 변경하려 시도하고, 확인 절차는 **반드시 검토해야 합니다**. 확인 절차가 **약한** 것으로 판단되면 이메일을 의도된 피해자의 것으로 변경한 뒤 확인을 완료하세요.

## **유니코드 정규화 문제**

1. 피해자의 계정 `victim@gmail.com`  
2. Unicode를 사용해 계정을 생성하세요\
예: `vićtim@gmail.com`

[**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c)에서 설명한 바와 같이, 위 공격은 타사 identity providers를 악용해 수행할 수도 있습니다:

- 타사 identity에 피해자와 유사한 이메일로 유니코드 문자를 사용해 계정을 생성합니다 (`vićtim@company.com`).
- 타사 제공자는 이메일을 확인하지 않아야 합니다.
- 만약 identity provider가 이메일을 확인한다면, 도메인 부분을 공격할 수 있습니다. 예: `victim@ćompany.com` 같은 도메인을 등록하고 identity provider가 도메인의 ASCII 버전을 생성하고 피해자 플랫폼은 도메인 이름을 정규화하기를 기대합니다.
- 이 identity provider로 피해자 플랫폼에 로그인하면 플랫폼이 유니코드 문자를 정규화하여 피해자 계정에 접근할 수 있게 됩니다.

자세한 내용은 Unicode Normalization 문서를 참조하세요:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **리셋 토큰 재사용**

대상 시스템이 **reset link를 재사용**하도록 허용하면, `gau`, `wayback`, 또는 `scan.io` 같은 도구를 사용해 **더 많은 reset link를 찾는** 노력을 해야 합니다.

## **사전 계정 탈취**

1. 피해자의 이메일을 사용해 플랫폼에 가입하고 비밀번호를 설정합니다(확인을 시도해야 하지만 피해자의 이메일에 접근할 수 없으면 불가능할 수 있습니다).
2. 피해자가 OAuth로 가입하고 계정을 확인할 때까지 기다립니다.
3. 일반 가입이 확인되어 피해자 계정에 접근할 수 있게 되기를 기대합니다.

## **CORS misconfiguration을 통한 계정 탈취**

페이지에 **CORS misconfigurations**가 있으면 사용자의 민감한 정보를 **탈취**하여 그의 계정을 **탈취**하거나 동일한 목적을 위해 인증 정보를 변경하게 만들 수 있습니다:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf를 통한 계정 탈취**

페이지가 CSRF에 취약하면 **사용자가 비밀번호, 이메일 또는 인증 정보를 변경**하도록 만들어 이후에 접근할 수 있습니다:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS를 통한 계정 탈취**

애플리케이션에서 XSS를 찾으면 cookies, local storage, 또는 웹페이지에서 계정 탈취를 가능하게 할 수 있는 정보를 탈취할 수 있습니다:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- 로그인 페이지에서 Attribute-only reflected payloads는 `document.onkeypress`를 훅하고, `new Image().src`로 키스트로크를 유출하며, 폼을 제출하지 않고도 자격증명을 탈취할 수 있습니다. 실전 워크플로우는 [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs)를 참조하세요.

## **Same Origin + Cookies**

제한된 XSS나 subdomain take over를 발견하면, cookies를 조작(예: fixating)하여 피해자 계정을 탈취하려 시도할 수 있습니다:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **비밀번호 재설정 메커니즘 공격**


{{#ref}}
reset-password.md
{{#endref}}

## 클라이언트가 제공한 usernames를 신뢰하는 보안 질문 재설정
만약 "update security questions" 흐름이 호출자가 이미 인증된 상태임에도 `username` 파라미터를 받는다면, 백엔드가 일반적으로 `UPDATE ... WHERE user_name = ?` 같은 쿼리를 당신의 신뢰할 수 없는 값으로 실행하기 때문에(관리자 포함) 어떤 계정의 복구 데이터도 덮어쓸 수 있습니다. 패턴은 다음과 같습니다:

1. 임시 사용자로 로그인하고 session cookie를 캡처합니다.
2. 리셋 폼을 통해 피해자의 username과 새 답변을 제출합니다.
3. 즉시 방금 주입한 답변을 사용해 security-question 로그인 엔드포인트로 인증하여 피해자의 권한을 획득합니다.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

열거된 사용자명은 위의 overwrite 기법을 통해 표적으로 삼거나 보조 서비스(FTP/SSH 비밀번호 스프레이)에서 재사용할 수 있습니다.

## **Response Manipulation**

인증 응답을 단순한 불리언으로 축소할 수 있다면 **false를 true로 바꿔보세요** 그리고 접근이 가능한지 확인해보세요.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. 비밀번호 재설정 요청을 시작한 후 Host 헤더가 수정됩니다.
2. 프록시 헤더 `X-Forwarded-For`가 `attacker.com`으로 변경됩니다.
3. Host, Referrer, Origin 헤더를 동시에 `attacker.com`으로 변경합니다.
4. 비밀번호 재설정을 시작한 뒤 메일 재전송을 선택하면, 앞서 언급한 세 가지 방법을 모두 사용합니다.

## Response Manipulation

1. **Code Manipulation**: 상태 코드를 `200 OK`로 변경합니다.
2. **Code and Body Manipulation**:
- 상태 코드를 `200 OK`로 변경합니다.
- 응답 본문을 `{"success":true}` 또는 빈 객체 `{}`로 수정합니다.

이러한 조작 기법은 JSON이 데이터 전송 및 수신에 사용되는 시나리오에서 효과적입니다.

## Change email of current session

다음 [보고서](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)에서:

- 공격자는 자신의 이메일을 새 이메일로 변경하도록 요청합니다.
- 공격자는 이메일 변경을 확인하는 링크를 받습니다.
- 공격자는 피해자에게 그 링크를 보내 피해자가 클릭하게 합니다.
- 피해자의 이메일이 공격자가 지정한 이메일로 변경됩니다.
- 이 공격으로 비밀번호를 복구하고 계정을 탈취할 수 있습니다.

이것은 [**이 보고서**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)에서도 발생했습니다.


### Bypass email verification for Account Takeover
- 공격자는 attacker@test.com으로 로그인하고 가입 시 이메일을 확인합니다.
- 공격자는 확인된 이메일을 victim@test.com으로 변경합니다 (이메일 변경 시 추가 확인 없음).
- 이제 웹사이트는 victim@test.com으로 로그인을 허용하며, 피해자의 이메일 검증을 우회했습니다.

### Old Cookies

이 게시물([**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9))에서 설명한 것처럼, 계정에 로그인한 후 인증된 사용자로서 쿠키를 저장하고 로그아웃한 다음 다시 로그인할 수 있었습니다. 새 로그인으로 인해 다른 쿠키가 생성될 수 있지만 이전 쿠키가 다시 작동했습니다.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
