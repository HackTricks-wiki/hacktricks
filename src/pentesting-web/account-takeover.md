# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Problème d'autorisation**

Il faut tenter de modifier l'email d'un compte, et le processus de confirmation **doit être examiné**. S'il est jugé **faible**, l'email doit être changé pour celui de la victime ciblée puis confirmé.

## **Problème de normalisation Unicode**

1. Le compte de la victime ciblée `victim@gmail.com`  
2. Un compte doit être créé en utilisant Unicode\
par exemple: `vićtim@gmail.com`

Comme expliqué dans [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), l'attaque précédente pourrait aussi être réalisée en abusant des fournisseurs d'identité tiers :

- Créez un compte chez le fournisseur d'identité tiers avec un email similaire à celui de la victime en utilisant un caractère unicode (`vićtim@company.com`).
- Le fournisseur tiers ne devrait pas vérifier l'email.
- Si le fournisseur d'identité vérifie l'email, peut-être pouvez-vous attaquer la partie domaine comme : `victim@ćompany.com` et enregistrer ce domaine en espérant que le fournisseur d'identité génère la version ASCII du domaine tandis que la plateforme victime normalise le nom de domaine.
- Connectez-vous via ce fournisseur d'identité sur la plateforme de la victime, qui devrait normaliser le caractère unicode et vous permettre d'accéder au compte de la victime.

For further details, refer to the document on Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Si le système cible permet que le lien de réinitialisation soit **réutilisé**, il faut chercher à **trouver d'autres liens de réinitialisation** en utilisant des outils tels que `gau`, `wayback`, ou `scan.io`.

## **Pre Account Takeover**

1. L'email de la victime doit être utilisé pour s'inscrire sur la plateforme, et un mot de passe doit être défini (une tentative de confirmation doit être effectuée, bien que l'absence d'accès aux emails de la victime puisse rendre cela impossible).
2. Il faut attendre que la victime s'inscrive via OAuth et confirme le compte.
3. On espère que l'inscription régulière sera confirmée, permettant d'accéder au compte de la victime.

## **CORS Misconfiguration to Account Takeover**

Si la page contient des **CORS misconfigurations** vous pourriez être capable de **voler des informations sensibles** de l'utilisateur pour **prendre le contrôle de son compte** ou le pousser à modifier ses informations d'authentification dans ce but :


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Si la page est vulnérable au CSRF vous pourriez être capable de faire en sorte que **l'utilisateur modifie son mot de passe**, son email ou son authentification afin que vous puissiez ensuite y accéder :


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Si vous trouvez une XSS dans l'application, vous pourriez voler des cookies, le local storage, ou des informations de la page web qui pourraient vous permettre de prendre le contrôle du compte :


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Si vous trouvez une XSS limitée ou une prise de contrôle de sous-domaine, vous pouvez jouer avec les cookies (les fixer par exemple) pour tenter de compromettre le compte de la victime :


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Si un flux "update security questions" prend un paramètre `username` même si l'appelant est déjà authentifié, vous pouvez écraser les données de récupération de n'importe quel compte (y compris des admins) parce que le backend exécute typiquement `UPDATE ... WHERE user_name = ?` avec votre valeur non fiable. Le schéma est :

1. Se connecter avec un utilisateur jetable et capturer le cookie de session.
2. Soumettre le nom d'utilisateur de la victime plus de nouvelles réponses via le formulaire de réinitialisation.
3. S'authentifier immédiatement via l'endpoint de connexion par question de sécurité en utilisant les réponses que vous venez d'injecter pour hériter des privilèges de la victime.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

If the authentication response could be **reduced to a simple boolean just try to change `false` to `true`** and see if you get any access.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The `Host` header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The `Host`, `Referrer`, and `Origin` headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
- The status code is changed to `200 OK`.
- The response body is modified to `{"success":true}` or an empty object `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

From [ce rapport](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
