# Przejęcie konta

{{#include ../banners/hacktricks-training.md}}

## **Problem autoryzacji**

Należy spróbować zmienić adres e-mail konta i **dokładnie zbadać** proces potwierdzania. Jeśli okaże się on **słaby**, adres e-mail powinien zostać zmieniony na adres zamierzonej ofiary, a następnie potwierdzony.

## **Problem normalizacji Unicode**

1. Konto zamierzonej ofiary `victim@gmail.com`
2. Należy utworzyć konto używając Unicode\
   na przykład: `vićtim@gmail.com`

As explained in [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), the previous attack could also be done abusing third party identity providers:

- Create an account in the third party identity with similar email to the victim using some unicode character (`vićtim@company.com`).
- The third party provider shouldn't verify the email
- If the identity provider verifies the email, maybe you can attack the domain part like: `victim@ćompany.com` and register that domain and hope that the identity provider generates the ascii version of the domain while the victim platform normalize the domain name.
- Login via this identity provider in the victim platform who should normalize the unicode character and allow you to access the victim account.

For further details, refer to the document on Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Ponowne użycie tokena resetowania**

Jeśli docelowy system pozwala na **ponowne użycie linku resetującego**, należy podjąć próby **znalezienia większej liczby linków resetujących** za pomocą narzędzi takich jak `gau`, `wayback`, lub `scan.io`.

## **Przed przejęciem konta**

1. Należy użyć e-maila ofiary do rejestracji na platformie i ustawić hasło (należy spróbować je potwierdzić, choć brak dostępu do maili ofiary może to uniemożliwić).
2. Należy poczekać, aż ofiara zarejestruje się używając OAuth i potwierdzi konto.
3. Zakłada się, że zwykła rejestracja zostanie potwierdzona, co umożliwi dostęp do konta ofiary.

## **Błędna konfiguracja CORS prowadząca do przejęcia konta**

Jeżeli strona zawiera **błędne konfiguracje CORS**, możesz być w stanie **ukraść wrażliwe informacje** od użytkownika, by **przejąć jego konto** lub skłonić go do zmiany danych uwierzytelniających w tym samym celu:


{{#ref}}
cors-bypass.md
{{#endref}}

## **CSRF prowadzące do przejęcia konta**

Jeśli strona jest podatna na CSRF, możesz być w stanie sprawić, że **użytkownik zmieni swoje hasło**, e-mail lub dane uwierzytelniające, aby następnie uzyskać do niego dostęp:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS prowadzące do przejęcia konta**

Jeśli znajdziesz XSS w aplikacji, możesz być w stanie ukraść cookies, local storage lub informacje ze strony, które mogą umożliwić przejęcie konta:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Reflektowane payloady ograniczone do atrybutów na stronach logowania mogą podczepić `document.onkeypress`, eksfiltrować naciśnięcia klawiszy przez `new Image().src`, i wykraść poświadczenia bez wysyłania formularza. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Jeśli znajdziesz ograniczone XSS lub przejęcie subdomeny, możesz manipulować cookies (np. session fixation), aby spróbować przejąć konto ofiary:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Atak na mechanizm resetowania hasła**


{{#ref}}
reset-password.md
{{#endref}}

## Resety pytań bezpieczeństwa, które ufają nazwom użytkownika dostarczonym przez klienta
Jeśli proces „aktualizacji pytań bezpieczeństwa” przyjmuje parametr `username`, mimo że wywołujący jest już uwierzytelniony, możesz nadpisać dane odzyskiwania dowolnego konta (w tym administratorów), ponieważ backend zazwyczaj wykonuje `UPDATE ... WHERE user_name = ?` z twoją niezatwierdzoną wartością. Wzorzec postępowania to:

1. Zaloguj się kontem jednorazowym (throwaway) i przechwyć cookie sesji.
2. Prześlij nazwę użytkownika ofiary oraz nowe odpowiedzi przez formularz resetu.
3. Natychmiast uwierzytelnij się przez endpoint logowania za pomocą pytań bezpieczeństwa, używając odpowiedzi właśnie wstrzykniętych, aby przejąć uprawnienia ofiary.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Wszystko zabezpieczone kontekstem ofiary `$_SESSION` (admin dashboards, niebezpieczne funkcje stream-wrapper itp.) jest teraz odsłonięte bez potrzeby ingerencji w prawdziwe odpowiedzi.

Wyliczone nazwy użytkowników można następnie zaatakować przy użyciu powyższej techniki overwrite lub użyć ponownie przeciw usługom pomocniczym (FTP/SSH password spraying).

## **Response Manipulation**

Jeśli odpowiedź uwierzytelniająca może zostać **zredukowana do prostego booleanu — spróbuj zmienić false na true** i sprawdź, czy uzyskasz dostęp.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. Nagłówek Host jest modyfikowany po inicjacji żądania resetu hasła.
2. Nagłówek proxy `X-Forwarded-For` jest zmieniany na `attacker.com`.
3. Nagłówki Host, Referrer i Origin są jednocześnie zmieniane na `attacker.com`.
4. Po zainicjowaniu resetu hasła i wybraniu opcji ponownego wysłania maila stosowane są wszystkie trzy powyższe metody.

## Response Manipulation

1. **Code Manipulation**: Kod statusu jest zmieniany na `200 OK`.
2. **Code and Body Manipulation**:
- Kod statusu jest zmieniany na `200 OK`.
- Treść odpowiedzi jest zmieniona na `{"success":true}` lub na pusty obiekt `{}`.

Te techniki manipulacji są skuteczne w scenariuszach, gdzie JSON jest wykorzystywany do przesyłania i odbierania danych.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Atakujący żąda zmiany swojego e-maila na nowy
- Atakujący otrzymuje link do potwierdzenia zmiany e-maila
- Atakujący wysyła ofierze link, aby ona go kliknęła
- E-mail ofiary zostaje zmieniony na ten wskazany przez atakującego
- Atak może odzyskać hasło i przejąć konto

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Atakujący loguje się używając attacker@test.com i weryfikuje e-mail przy rejestracji.
- Atakujący zmienia zweryfikowany e-mail na victim@test.com (brak dodatkowej weryfikacji przy zmianie e-maila)
- Teraz serwis pozwala victim@test.com się zalogować i ominięto weryfikację e-mail użytkownika.

### Old Cookies

Jak wyjaśniono [**w tym poście**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), możliwe było zalogowanie się na konto, zapisanie cookies jako uwierzytelniony użytkownik, wylogowanie się, a następnie ponowne zalogowanie.\
Przy nowym logowaniu, mimo że mogły być wygenerowane inne cookies, stare ponownie zaczynały działać.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
