# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Jaribu kubadilisha barua pepe ya akaunti, na mchakato wa uthibitisho **unapaswa kuchunguzwa**. Ikiwa ukigundua kuwa ni **dhaifu**, barua pepe inapaswa kubadilishwa kwenda ile ya mhusika anayelengwa kisha kuthibitishwa.

## **Unicode Normalization Issue**

1. Akaunti ya mhusika anayelengwa `victim@gmail.com`
2. Akaunti inapaswa kuundwa ikitumia Unicode\ kwa mfano: `vićtim@gmail.com`

Kama ilivyoelezwa katika [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), shambulio lililotajwa hapo juu linaweza pia kufanywa kwa kutumia watoa huduma za utambulisho wa upande wa tatu:

- Unda akaunti kwa mtoa utambulisho wa upande wa tatu ukitumia barua pepe inayofanana na ya mhusika kwa kutumia herufi za Unicode (`vićtim@company.com`).
- Mtoa huduma wa upande wa tatu haipaswi kuthibitisha barua pepe
- Ikiwa mtoa utambulisho anathibitisha barua pepe, labda unaweza kushambulia sehemu ya domain kama: `victim@ćompany.com` na kujiandikisha kwenye domain hiyo na kuamini kwamba mtoa utambulisho ataunda toleo la ASCII la domain wakati jukwaa la mhusika linanormaliza jina la domain.
- Ingia kwa kutumia mtoa huduma huyo wa utambulisho kwenye jukwaa la mhusika ambalo linapaswa ku-normalize tabia ya unicode na kukuruhusu kupata akaunti ya mhusika.

For further details, refer to the document on Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Ikiwa mfumo lengwa unaruhusu **kiungo cha reset kutumika tena**, jitihada zinapaswa kufanywa **kutafuta viungo vingine vya reset** kwa kutumia zana kama `gau`, `wayback`, au `scan.io`.

## **Pre Account Takeover**

1. Barua pepe ya mhusika inapaswa kutumika kujiandikisha kwenye jukwaa, na nenosiri inapaswa kuwekwa (jaribio la kuthibitisha linapaswa kufanywa, ingawa ukosefu wa ufikiaji wa barua pepe za mhusika unaweza kufanya kuwa haiwezekani).
2. Inapaswa kusubiri mpaka mhusika ajiandikishe kwa kutumia OAuth na kuthibitisha akaunti.
3. Inatarajiwa kuwa usajili wa kawaida utaidhinishwa, kuruhusu kupata akaunti ya mhusika.

## **CORS Misconfiguration to Account Takeover**

Ikiwa ukurasa una **CORS misconfigurations** unaweza kuweza **kuiba taarifa nyeti** kutoka kwa mtumiaji ili **kuchukua udhibiti wa akaunti yake** au kumfanya abadilishe taarifa za uthibitishaji kwa kusudi hilo:

{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Ikiwa ukurasa una uwezekano wa CSRF unaweza kufanya mtumiaji **abadilisha nenosiri lake**, barua pepe au njia za uthibitishaji ili kisha uweze kuupata:

{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Ukipata XSS kwenye application unaweza kuiba cookies, local storage, au taarifa kutoka kwa ukurasa wa wavuti ambazo zinaweza kukuruhusu kuchukua udhibiti wa akaunti:

{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

Ukipata XSS iliyopunguzwa au subdomain takeover, unaweza kucheza na cookies (kwa mfano kuzi-fixate) kujaribu kuathiri akaunti ya mhusika:

{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Ikiwa mchakato wa "update security questions" unachukua parameter ya `username` ingawa mtumaji tayari ame-authenticated, unaweza kuandika juu data ya urejeshaji ya akaunti yoyote (kwa pamoja na admins) kwa sababu backend kawaida inafanya `UPDATE ... WHERE user_name = ?` na thamani yako isiyothibitishwa. Muundo ni:

1. Ingia kwa kutumia akaunti ya muda ('throwaway') na kunasa cookie ya session.
2. Tuma username ya mhusika pamoja na majibu mapya kupitia fomu ya reset.
3. Mara moja jithibitishe kupitia endpoint ya login ya security-question ukitumia majibu uliyoyaingiza ili upokee vibali vya mhusika.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

Ikiwa jibu la authentication linaweza **kupunguzwa kuwa boolean rahisi, jaribu kubadilisha false kuwa true** na uone kama unapata ufikiaji.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The Host header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The Host, Referrer, and Origin headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
- Code ya status inabadilishwa kuwa `200 OK`.
- Mwili wa response umebadilishwa kuwa `{"success":true}` au kitu tupu `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Change email of current session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Mshambulizi anaomba kubadilisha barua pepe yake kwa moja mpya
- Mshambulizi anapokea linki ya kuthibitisha mabadiliko ya barua pepe
- Mshambulizi anamtumia mwathiriwa linki ili aweze kubonyeza
- Barua pepe ya mwathiriwa inabadilishwa kuwa ile iliyoonyeshwa na mshambulizi
- Shambulio linaweza kurejesha password na kuchukua udhibiti wa akaunti

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Mshambulizi anaingia kwa attacker@test.com na anathibitisha barua pepe wakati wa signup.
- Mshambulizi anabadilisha barua pepe iliyothibitishwa kuwa victim@test.com (hakuna secondary verification on email change)
- Sasa tovuti inaruhusu victim@test.com kuingia na tumepita email verification ya mtumiaji mwathiriwa.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
