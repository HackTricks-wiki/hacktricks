# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Deve-se tentar alterar o email de uma conta e o processo de confirmação **deve ser examinado**. Se for considerado **fraco**, o email deve ser alterado para o da vítima pretendida e então confirmado.

## **Unicode Normalization Issue**

1. A conta da vítima pretendida `victim@gmail.com`
2. Deve-se criar uma conta usando Unicode\
for example: `vićtim@gmail.com`

As explained in [**this talk**](https://www.youtube.com/watch?v=CiIyaZ3x49c), the previous attack could also be done abusing third party identity providers:

- Crie uma conta no provedor de identidade de terceiros com um email similar ao da vítima usando algum caractere Unicode (`vićtim@company.com`).
- O provedor terceiro não deveria verificar o email
- Se o provedor de identidade verificar o email, talvez você consiga atacar a parte do domínio, por exemplo: `victim@ćompany.com` e registrar esse domínio e torcer para que o provedor de identidade gere a versão ascii do domínio enquanto a plataforma da vítima normaliza o nome do domínio.
- Faça login via esse provedor de identidade na plataforma da vítima, a qual deve normalizar o caractere Unicode e permitir que você acesse a conta da vítima.

For further details, refer to the document on Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Should the target system allow the **reset link to be reused**, efforts should be made to **find more reset links** using tools such as `gau`, `wayback`, or `scan.io`.

## **Pre Account Takeover**

1. Deve-se usar o email da vítima para se registrar na plataforma e definir uma senha (deve-se tentar confirmá-la, embora a falta de acesso aos emails da vítima possa tornar isso impossível).
2. Deve-se aguardar até que a vítima se registre usando OAuth e confirme a conta.
3. Espera-se que o registro regular seja confirmado, permitindo acesso à conta da vítima.

## **CORS Misconfiguration to Account Takeover**

If the page contains **CORS misconfigurations** you might be able to **steal sensitive information** from the user to **takeover his account** or make him change auth information for the same purpose:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

If the page is vulnerable to CSRF you might be able to make the **user modify his password**, email or authentication so you can then access it:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

If you find a XSS in application you might be able to steal cookies, local storage, or info from the web page that could allow you takeover the account:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads on login pages can hook `document.onkeypress`, exfiltrate keystrokes through `new Image().src`, and steal credentials without submitting the form. See [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) for a practical workflow.

## **Same Origin + Cookies**

If you find a limited XSS or a subdomain take over, you could play with the cookies (fixating them for example) to try to compromise the victim account:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
Se um fluxo de "update security questions" aceitar um parâmetro `username` mesmo que o chamador já esteja autenticado, você pode sobrescrever os dados de recuperação de qualquer conta (incluindo admins), pois o backend tipicamente executa `UPDATE ... WHERE user_name = ?` com seu valor não confiável. O padrão é:

1. Faça login com um usuário descartável e capture o cookie de sessão.
2. Envie o username da vítima mais as novas respostas através do formulário de reset.
3. Autentique-se imediatamente através do endpoint de login por security-question usando as respostas que você acabou de injetar para herdar os privilégios da vítima.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Usernames enumerados podem então ser alvo via the overwrite technique acima ou reutilizados contra serviços auxiliares (FTP/SSH password spraying).

## **Response Manipulation**

Se a resposta de autenticação puder ser **reduzida a um booleano simples, apenas tente mudar false para true** e veja se obtém acesso.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. O Host header é modificado após iniciar uma solicitação de password reset.
2. O header proxy `X-Forwarded-For` é alterado para `attacker.com`.
3. Os headers Host, Referrer, e Origin são alterados simultaneamente para `attacker.com`.
4. Depois de iniciar um password reset e optar por reenviar o e-mail, os três métodos acima são utilizados.

## Response Manipulation

1. **Code Manipulation**: O código de status é alterado para `200 OK`.
2. **Code and Body Manipulation**:
- O código de status é alterado para `200 OK`.
- O corpo da resposta é modificado para `{"success":true}` ou um objeto vazio `{}`.

Essas técnicas de manipulação são eficazes em cenários onde JSON é utilizado para transmissão e recebimento de dados.

## Alterar o e-mail da sessão atual

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Atacante solicita mudar seu e-mail para um novo
- Atacante recebe um link para confirmar a mudança do e-mail
- Atacante envia o link para a vítima para que ela clique
- O e-mail da vítima é alterado para o indicado pelo atacante
- O atacante pode recuperar a senha e tomar controle da conta

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Bypass email verification for Account Takeover
- Atacante faz login com attacker@test.com e verifica o e-mail ao se cadastrar.
- Atacante altera o e-mail verificado para victim@test.com (no secondary verification on email change)
- Agora o site permite victim@test.com fazer login e nós burlamos a verificação de e-mail do usuário vítima.

### Old Cookies

Como explicado [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), era possível fazer login em uma conta, salvar os cookies como usuário autenticado, fazer logout e então logar novamente.\
Com o novo login, embora cookies diferentes possam ser gerados, os antigos voltavam a funcionar novamente.

## Referências

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
