# Account Takeover

{{#include ../banners/hacktricks-training.md}}

## **Authorization Issue**

Πρέπει να επιχειρηθεί η αλλαγή του email ενός λογαριασμού, και η διαδικασία επιβεβαίωσης **πρέπει να εξεταστεί**. Εάν κριθεί **αδύναμη**, το email πρέπει να αλλάξει σε αυτό του επιδιωκόμενου θύματος και στη συνέχεια να επιβεβαιωθεί.

## **Unicode Normalization Issue**

1. Ο λογαριασμός του επιδιωκόμενου θύματος `victim@gmail.com`
2. Πρέπει να δημιουργηθεί ένας λογαριασμός χρησιμοποιώντας Unicode\
για παράδειγμα: `vićtim@gmail.com`

Όπως εξηγείται σε [**αυτήν την ομιλία**](https://www.youtube.com/watch?v=CiIyaZ3x49c), η προηγούμενη επίθεση θα μπορούσε επίσης να γίνει με κατάχρηση των third party identity providers:

- Δημιουργήστε έναν λογαριασμό στο third party identity με παρόμοιο email με αυτό του θύματος χρησιμοποιώντας κάποιο unicode χαρακτήρα (`vićtim@company.com`).
- Ο third party provider δεν πρέπει να επαληθεύει το email
- Αν ο identity provider επαληθεύει το email, ίσως μπορείτε να επιτεθείτε στο μέρος του domain όπως: `victim@ćompany.com` και να καταχωρήσετε αυτό το domain και να ελπίζετε ότι ο identity provider θα παράγει την ascii έκδοση του domain ενώ η πλατφόρμα-θύμα θα κανονικοποιεί το όνομα του domain.
- Συνδεθείτε μέσω αυτού του identity provider στην πλατφόρμα του θύματος, η οποία θα πρέπει να κανονικοποιήσει τους unicode χαρακτήρες και να σας επιτρέψει την πρόσβαση στον λογαριασμό του θύματος.

Για περισσότερες λεπτομέρειες, ανατρέξτε στο έγγραφο για Unicode Normalization:


{{#ref}}
unicode-injection/unicode-normalization.md
{{#endref}}

## **Reusing Reset Token**

Αν το σύστημα-στόχος επιτρέπει το **reset link to be reused**, πρέπει να γίνουν προσπάθειες να **find more reset links** χρησιμοποιώντας εργαλεία όπως `gau`, `wayback`, ή `scan.io`.

## **Pre Account Takeover**

1. Το email του θύματος θα πρέπει να χρησιμοποιηθεί για εγγραφή στην πλατφόρμα, και να οριστεί ένας κωδικός πρόσβασης (πρέπει να γίνει προσπάθεια επιβεβαίωσης, αν και η έλλειψη πρόσβασης στα emails του θύματος μπορεί να το καθιστά αδύνατο).
2. Πρέπει να περιμένετε μέχρι το θύμα να εγγραφεί χρησιμοποιώντας OAuth και να επιβεβαιώσει τον λογαριασμό.
3. Ελπίζεται ότι η κανονική εγγραφή θα επιβεβαιωθεί, επιτρέποντας την πρόσβαση στον λογαριασμό του θύματος.

## **CORS Misconfiguration to Account Takeover**

Εάν η σελίδα περιέχει **CORS misconfigurations**, μπορεί να καταφέρετε να **steal sensitive information** από τον χρήστη για να **takeover his account** ή να τον κάνετε να αλλάξει τα auth στοιχεία για τον ίδιο σκοπό:


{{#ref}}
cors-bypass.md
{{#endref}}

## **Csrf to Account Takeover**

Αν η σελίδα είναι ευάλωτη σε CSRF, μπορεί να καταφέρετε να αναγκάσετε τον χρήστη να αλλάξει τον κωδικό του, το email ή τις ρυθμίσεις authentication του, ώστε να αποκτήσετε πρόσβαση:


{{#ref}}
csrf-cross-site-request-forgery.md
{{#endref}}

## **XSS to Account Takeover**

Εάν βρείτε XSS στην εφαρμογή, μπορεί να καταφέρετε να κλέψετε cookies, local storage ή πληροφορίες από τη σελίδα που θα μπορούσαν να σας επιτρέψουν να takeover τον λογαριασμό:


{{#ref}}
xss-cross-site-scripting/
{{#endref}}

- Attribute-only reflected payloads σε login pages μπορούν να hookάρουν το `document.onkeypress`, να εξαγάγουν keystrokes μέσω `new Image().src`, και να κλέψουν credentials χωρίς να υποβάλουν τη φόρμα. Δείτε [Attribute-only login XSS behind WAFs](xss-cross-site-scripting/README.md#attribute-only-login-xss-behind-wafs) για μια πρακτική ροή εργασίας.

## **Same Origin + Cookies**

Αν βρείτε ένα περιορισμένο XSS ή ένα subdomain take over, μπορείτε να παίξετε με τα cookies (π.χ. fixating τους) για να προσπαθήσετε να παραβιάσετε τον λογαριασμό του θύματος:


{{#ref}}
hacking-with-cookies/
{{#endref}}

## **Attacking Password Reset Mechanism**


{{#ref}}
reset-password.md
{{#endref}}

## Security-question resets that trust client-supplied usernames
If an "update security questions" flow takes a `username` parameter even though the caller is already authenticated, you can overwrite any account's recovery data (including admins) because the backend typically runs `UPDATE ... WHERE user_name = ?` with your untrusted value. The pattern is:

1. Συνδεθείτε με έναν throwaway χρήστη και καταγράψτε το session cookie.
2. Υποβάλετε το username του θύματος μαζί με τις νέες απαντήσεις μέσω της φόρμας επαναφοράς.
3. Αυθεντικοποιηθείτε αμέσως μέσω του security-question login endpoint χρησιμοποιώντας τις απαντήσεις που μόλις εισαγάγατε για να κληρονομήσετε τα προνόμια του θύματος.
```http
POST /reset.php HTTP/1.1
Host: file.era.htb
Cookie: PHPSESSID=<low-priv>
Content-Type: application/x-www-form-urlencoded

username=admin_ef01cab31aa&new_answer1=A&new_answer2=B&new_answer3=C
```
Anything gated by the victim's `$_SESSION` context (admin dashboards, dangerous stream-wrapper features, etc.) is now exposed without touching the real answers.

Enumerated usernames can then be targeted via the overwrite technique above or reused against ancillary services (FTP/SSH password spraying).

## **Response Manipulation**

If the authentication response could be **reduced to a simple boolean just try to change false to true** and see if you get any access.

## OAuth to Account takeover


{{#ref}}
oauth-to-account-takeover.md
{{#endref}}

## Host Header Injection

1. The Host header is modified following a password reset request initiation.
2. The `X-Forwarded-For` proxy header is altered to `attacker.com`.
3. The Host, Referrer, and Origin headers are simultaneously changed to `attacker.com`.
4. After initiating a password reset and then opting to resend the mail, all three of the aforementioned methods are employed.

## Response Manipulation

1. **Code Manipulation**: The status code is altered to `200 OK`.
2. **Code and Body Manipulation**:
- The status code is changed to `200 OK`.
- The response body is modified to `{"success":true}` or an empty object `{}`.

These manipulation techniques are effective in scenarios where JSON is utilized for data transmission and receipt.

## Αλλαγή email της τρέχουσας session

From [this report](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

- Attacker requests to change his email with a new one
- Attacker receives a link to confirm the change of the email
- Attacker send the victim the link so he clicks it
- The victims email is changed to the one indicated by the attacker
- The attack can recover the password and take over the account

This also happened in [**this report**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).


### Παράκαμψη επαλήθευσης email για Account Takeover
- Attacker logins with attacker@test.com and verifies email upon signup.
- Attacker changes verified email to victim@test.com (no secondary verification on email change)
- Now the website allows victim@test.com to login and we have bypassed email verification of victim user.

### Old Cookies

As explained [**in this post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), it was possible to login into an account, save the cookies as an authenticated user, logout, and then login again.\
With the new login, although different cookies might be generated the old ones became to work again.

## References

- [https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/](https://blog.hackcommander.com/posts/2025/12/28/turning-a-harmless-xss-behind-a-waf-into-a-realistic-phishing-vector/)
- [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
- [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)
- [0xdf – HTB Era: security-question IDOR & username oracle](https://0xdf.gitlab.io/2025/11/29/htb-era.html)
{{#include ../banners/hacktricks-training.md}}
