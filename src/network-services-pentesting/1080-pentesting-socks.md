# 1080 - Pentesting Socks

{{#include ../banners/hacktricks-training.md}}

## 기본 정보

**SOCKS**는 클라이언트와 서버 간의 데이터를 프록시를 통해 전송하는 데 사용되는 프로토콜입니다. 다섯 번째 버전인 **SOCKS5**는 선택적 인증 기능을 추가하여 권한이 있는 사용자만 서버에 접근할 수 있도록 합니다. 주로 TCP 연결의 프록시와 UDP 패킷의 전달(`UDP ASSOCIATE` 명령을 통해)을 처리하며, OSI 모델의 세션 계층 (Layer 5)에서 동작합니다. 도구가 `socks5h` 스킴을 지원하면, DNS 해석이 프록시를 통해 강제로 이루어져 로컬 DNS leak을 방지하고 발신 호스트의 fingerprinting을 어렵게 합니다.

**기본 포트:** 1080

## 열거

### 인증 확인
```bash
nmap -p 1080 <ip> --script socks-auth-info
```
### Brute Force

#### 기본 사용법
```bash
nmap --script socks-brute -p 1080 <ip>
```
#### 고급 사용법
```bash
nmap  --script socks-brute --script-args userdb=users.txt,passdb=rockyou.txt,unpwdb.timelimit=30m -p 1080 <ip>
```
#### Output
```
PORT     STATE SERVICE
1080/tcp open  socks
| socks-brute:
|   Accounts
|     patrik:12345 - Valid credentials
|   Statistics
|_    Performed 1921 guesses in 6 seconds, average tps: 320
```
#### Hydra 모듈
```bash
hydra -L users.txt -P passwords.txt -s 1080 -t 16 -V <ip> socks5
```
### 방법 & open-proxy enumeration
```bash
nmap -sV --script socks-methods,socks-open-proxy -p 1080 <ip>
```
`socks-methods`는 서버가 지원하는 인증 유형을 나열하도록 강제하고, `socks-open-proxy`는 서비스가 릴레이로 악용될 수 있는지 확인하기 위해 아웃바운드 CONNECT를 시도합니다.

#### 원시 핸드셰이크 검사
```bash
printf '\x05\x01\x00' | nc -nv <ip> 1080
```
A `\x05 01 00` 응답은 SOCKS5가 "no authentication"을 제공함을 나타냅니다. `\x00` 다음에 `\x02`가 오면 username/password가 필요함을 의미하며, 이는 scripts에서 노출된 장치를 빠르게 fingerprinting하는 데 유용합니다.

### 빠른 egress 검증
```bash
curl --socks5-hostname <ip>:1080 https://ifconfig.me
curl --socks5-hostname user:pass@<ip>:1080 http://internal.target
```
DNS 해석이 원격에서 이루어지도록 `--socks5-hostname`(또는 `socks5h://` URL)를 사용하세요. 프록시가 실제로 내부 접근을 제공하는지 확인하려면 `proxychains4 -q nmap -sT -Pn --top-ports 200 <internal-host>`와 함께 사용하세요.

### 인터넷 전역 탐색 / 지문 수집
```bash
masscan 0.0.0.0/0 -p1080 --banners --rate 100000 -oX socks.xml
```
결과를 NSE, `zgrab2`, 또는 custom python scripts에 다시 피드백하여 유망한 호스트(예: 배너 문자열 `3proxy`, `Dante`, `MikroTik`)의 우선순위를 정하세요.


## Tunneling and Port Forwarding

tunneling and post forwarding에 관한 정보는 다음 페이지를 확인하세요: [Tunneling and Port Forwarding](../generic-hacking/tunneling-and-port-forwarding.md)

## 참고자료

- [Use a SOCKS5 Proxy to Access the Kubernetes API (Kubernetes Docs, 2024)](https://kubernetes.io/docs/tasks/extend-kubernetes/socks5-proxy-access-api)

{{#include ../banners/hacktricks-training.md}}
