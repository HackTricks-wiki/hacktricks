# 1080 - Pentesting Socks

{{#include ../banners/hacktricks-training.md}}

## 基本信息

**SOCKS** 是一种用于通过代理在客户端和服务器之间传输数据的协议。第五版，**SOCKS5**，增加了可选的认证功能，允许只有授权用户访问服务器。它主要负责代理 TCP 连接和转发 UDP 数据包（通过 `UDP ASSOCIATE` 命令），在 OSI 模型的会话层（Layer 5）运行。当工具支持 `socks5h` scheme 时，DNS 解析会被强制通过代理，防止本地 DNS leak，并且更难以对源主机进行指纹识别。

**默认端口：** 1080

## 枚举

### 认证检查
```bash
nmap -p 1080 <ip> --script socks-auth-info
```
### Brute Force

#### 基本用法
```bash
nmap --script socks-brute -p 1080 <ip>
```
#### 高级用法
```bash
nmap  --script socks-brute --script-args userdb=users.txt,passdb=rockyou.txt,unpwdb.timelimit=30m -p 1080 <ip>
```
我没有收到要翻译的文件内容。请粘贴 src/network-services-pentesting/1080-pentesting-socks.md 的内容（或上传文本），我会按要求将相关英文翻译成中文并严格保留原有的 markdown/HTML 标签、链接、路径和代码等不翻译的部分。
```
PORT     STATE SERVICE
1080/tcp open  socks
| socks-brute:
|   Accounts
|     patrik:12345 - Valid credentials
|   Statistics
|_    Performed 1921 guesses in 6 seconds, average tps: 320
```
#### Hydra 模块
```bash
hydra -L users.txt -P passwords.txt -s 1080 -t 16 -V <ip> socks5
```
### 方法 & open-proxy 枚举
```bash
nmap -sV --script socks-methods,socks-open-proxy -p 1080 <ip>
```
`socks-methods` 强制服务器列出支持的认证类型，而 `socks-open-proxy` 尝试发起出站 CONNECT 以确认该服务是否可以被滥用为中继。

#### 原始握手检查
```bash
printf '\x05\x01\x00' | nc -nv <ip> 1080
```
A `\x05 01 00` 响应表示 SOCKS5 提供 "no authentication"。任何 `\x00` 后接 `\x02` 表示需要 username/password，这对于在 scripts 中快速对暴露设备进行指纹识别很有用。

### 快速出站验证
```bash
curl --socks5-hostname <ip>:1080 https://ifconfig.me
curl --socks5-hostname user:pass@<ip>:1080 http://internal.target
```
使用 `--socks5-hostname`（或 `socks5h://` URLs），以便 DNS 解析在远程发生。将其与 `proxychains4 -q nmap -sT -Pn --top-ports 200 <internal-host>` 配合使用，以验证代理是否确实提供对内部网络的可达性。

### 互联网范围发现 / 指纹识别
```bash
masscan 0.0.0.0/0 -p1080 --banners --rate 100000 -oX socks.xml
```
将结果反馈到 NSE、`zgrab2` 或自定义 python 脚本，以优先排序有前景的主机（例如横幅字符串如 `3proxy`、`Dante`、`MikroTik`）。

## 隧道和端口转发

有关隧道和端口转发的信息，请查看页面： [Tunneling and Port Forwarding](../generic-hacking/tunneling-and-port-forwarding.md)

## 参考资料

- [Use a SOCKS5 Proxy to Access the Kubernetes API (Kubernetes Docs, 2024)](https://kubernetes.io/docs/tasks/extend-kubernetes/socks5-proxy-access-api)

{{#include ../banners/hacktricks-training.md}}
