# 1080 - Pentesting Socks

{{#include ../banners/hacktricks-training.md}}

## 基本情報

**SOCKS** は、クライアントとサーバ間でプロキシを通してデータを転送するためのプロトコルです。第5版である **SOCKS5** はオプションの認証機能を追加し、認可されたユーザのみがサーバにアクセスできるようにします。主にTCP接続のプロキシとUDPパケットの転送（`UDP ASSOCIATE` コマンド経由）を扱い、OSIモデルのセッション層（レイヤ5）で動作します。ツールが `socks5h` スキームをサポートしている場合、DNS解決はプロキシ経由に強制され、ローカルDNS leakを防ぎ、発信ホストの指紋付けを困難にします。

**デフォルトポート:** 1080

## 列挙

### 認証の確認
```bash
nmap -p 1080 <ip> --script socks-auth-info
```
### Brute Force

#### 基本的な使い方
```bash
nmap --script socks-brute -p 1080 <ip>
```
#### 高度な使い方
```bash
nmap  --script socks-brute --script-args userdb=users.txt,passdb=rockyou.txt,unpwdb.timelimit=30m -p 1080 <ip>
```
src/network-services-pentesting/1080-pentesting-socks.md の内容をここに貼ってください。内容を受け取り次第、指定どおり翻訳します。
```
PORT     STATE SERVICE
1080/tcp open  socks
| socks-brute:
|   Accounts
|     patrik:12345 - Valid credentials
|   Statistics
|_    Performed 1921 guesses in 6 seconds, average tps: 320
```
#### Hydra モジュール
```bash
hydra -L users.txt -P passwords.txt -s 1080 -t 16 -V <ip> socks5
```
### 方法 & open-proxy enumeration
```bash
nmap -sV --script socks-methods,socks-open-proxy -p 1080 <ip>
```
`socks-methods` はサーバーにサポートされている認証タイプの一覧を出力させ、`socks-open-proxy` はサービスがリレーとして悪用可能か確認するためにアウトバウンド CONNECT を試行します。

#### Raw ハンドシェイクの確認
```bash
printf '\x05\x01\x00' | nc -nv <ip> 1080
```
` \x05 01 00` のレスポンスは SOCKS5 が「no authentication」を提供していることを示します。`\x00` の直後に `\x02` が続く場合は username/password が必要で、これは scripts で exposed devices を素早く fingerprinting するのに便利です。

### クイック egress 検証
```bash
curl --socks5-hostname <ip>:1080 https://ifconfig.me
curl --socks5-hostname user:pass@<ip>:1080 http://internal.target
```
Use `--socks5-hostname`（または `socks5h://` URLs）を使用して、DNS 解決がリモートで行われるようにします。`proxychains4 -q nmap -sT -Pn --top-ports 200 <internal-host>` と組み合わせて、プロキシが実際に内部への到達性を提供しているか確認してください。

### Internet-wide discovery / fingerprinting
```bash
masscan 0.0.0.0/0 -p1080 --banners --rate 100000 -oX socks.xml
```
有望なホストを優先するために、結果をNSE、`zgrab2`、またはカスタム python スクリプトにフィードバックしてください（例：`3proxy`、`Dante`、`MikroTik` のようなバナー文字列）。


## Tunneling and Port Forwarding

Tunneling and Port Forwarding に関する情報は次のページを参照してください: [Tunneling and Port Forwarding](../generic-hacking/tunneling-and-port-forwarding.md)

## References

- [Use a SOCKS5 Proxy to Access the Kubernetes API (Kubernetes Docs, 2024)](https://kubernetes.io/docs/tasks/extend-kubernetes/socks5-proxy-access-api)

{{#include ../banners/hacktricks-training.md}}
