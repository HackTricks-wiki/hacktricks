# 123/udp - Pentesting NTP

{{#include ../banners/hacktricks-training.md}}

## ê¸°ë³¸ ì •ë³´

**ë„¤íŠ¸ì›Œí¬ ì‹œê°„ í”„ë¡œí† ì½œ (NTP)**ëŠ” ê°€ë³€ ëŒ€ê¸° ì‹œê°„ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì»´í“¨í„°ì™€ ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜ê°€ ì‹œê³„ë¥¼ ì •í™•í•˜ê²Œ ë™ê¸°í™”í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. IT ìš´ì˜, ë³´ì•ˆ ë° ë¡œê¹…ì—ì„œ ì •í™•í•œ ì‹œê°„ ìœ ì§€ì— í•„ìˆ˜ì ì…ë‹ˆë‹¤. ì‹œê°„ì€ ê±°ì˜ ëª¨ë“  ì¸ì¦, ì•”í˜¸ í”„ë¡œí† ì½œ ë° í¬ë Œì‹ í”„ë¡œì„¸ìŠ¤ì— ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì—, **NTPì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆëŠ” ê³µê²©ìëŠ” ì¢…ì¢… ë³´ì•ˆ í†µì œë¥¼ ìš°íšŒí•˜ê±°ë‚˜ ê³µê²©ì„ ì¡°ì‚¬í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### ìš”ì•½ ë° ë³´ì•ˆ íŒ

- **ëª©ì **: ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì¥ì¹˜ ì‹œê³„ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.
- **ì¤‘ìš”ì„±**: ë³´ì•ˆ, ë¡œê¹…, ì•”í˜¸ í”„ë¡œí† ì½œ ë° ë¶„ì‚° ì‹œìŠ¤í…œì— ì¤‘ìš”í•©ë‹ˆë‹¤.
- **ë³´ì•ˆ ì¡°ì¹˜**:
- ì¸ì¦ì´ ìˆëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” NTP ë˜ëŠ” NTS(ë„¤íŠ¸ì›Œí¬ ì‹œê°„ ë³´ì•ˆ) ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ë°ëª¬ì— ì¿¼ë¦¬/ëª…ë ¹ì„ í•  ìˆ˜ ìˆëŠ” ëŒ€ìƒì„ ì œí•œí•©ë‹ˆë‹¤ (``restrict default noquery``, ``kod`` ë“±).
- ë ˆê±°ì‹œ ëª¨ë“œ-6/7 ì œì–´ ì¿¼ë¦¬ (``monlist``, ``ntpdc``)ë¥¼ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ì†ë„ë¥¼ ì œí•œí•©ë‹ˆë‹¤.
- ë³€ì¡°ë¥¼ ìœ„í•´ ë™ê¸°í™” ë“œë¦¬í”„íŠ¸/ìœ¤ì´ˆ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
- ë°ëª¬ì„ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•©ë‹ˆë‹¤ (ì•„ë˜ì˜ ìµœê·¼ CVE ì°¸ì¡°).

**ê¸°ë³¸ í¬íŠ¸**
```
123/udp   NTP            (data + legacy control)
4460/tcp  NTS-KE (RFC 8915) â€“ TLS key-establishment for NTP
```

```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
---
## ì—´ê±°

### ê³ ì „ ntpd / ntpq / ntpdc
```bash
# Information & variables
ntpq -c rv <IP>
ntpq -c readvar <IP>
ntpq -c peers <IP>
ntpq -c associations <IP>

# Legacy mode-7 (often disabled >=4.2.8p9)
ntpdc -c monlist <IP>
ntpdc -c listpeers <IP>
ntpdc -c sysinfo  <IP>
```
### chrony / chronyc (ëŒ€ë¶€ë¶„ì˜ ìµœì‹  Linux ë°°í¬íŒì—ì„œ)

``cmdallow``ê°€ í™œì„±í™”ë˜ë©´ ì›ê²© IPì—ì„œ í—ˆìš©ë˜ëŠ” ëª¨ë‹ˆí„°ë§ ëª…ë ¹ì€ ê·¹íˆ ì¼ë¶€ì…ë‹ˆë‹¤:
```bash
chronyc -a -n tracking   -h <IP>
chronyc -a -n sources -v -h <IP>
chronyc -a -n sourcestats -h <IP>
```
**M/S** í”Œë˜ê·¸ì™€ ê¸°íƒ€ í•„ë“œ(ìŠ¤íŠ¸ë¼í…€, ë¦¬ì¹˜, ì§€í„° ë“±)ì˜ ì˜ë¯¸ëŠ” chronyc ë§¤ë‰´ì–¼ í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### Nmap
```bash
# Safe discovery & vuln detection
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>

# Explicit monlist check
nmap -sU -p123 --script ntp-monlist <IP>
```
### ëŒ€ëŸ‰/ì¸í„°ë„· ìŠ¤ìºë‹
```bash
# Check if MONLIST is enabled (zgrab2 module)
zgrab2 ntp --monlist --timeout 3 --output-file monlist.json -f "zmap_results.csv"
```
---
## êµ¬ì„± íŒŒì¼ ê²€ì‚¬

- ``/etc/ntp.conf`` (ntpd)
- ``/etc/chrony/chrony.conf`` (chrony)
- ``/etc/systemd/timesyncd.conf`` (timesyncd â€“ í´ë¼ì´ì–¸íŠ¸ ì „ìš©)

``restrict`` ë¼ì¸, ``kod`` (Kiss-o'-Death) ì„¤ì •, ``disable monitor``/``includefile /etc/ntp/crypto`` ë° *NTS*ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ (``nts enable``) íŠ¹ë³„íˆ ì£¼ì˜í•˜ì‹­ì‹œì˜¤.

---
## ìµœê·¼ ì·¨ì•½ì  (2023-2025)

| ì—°ë„ | CVE | êµ¬ì„± ìš”ì†Œ | ì˜í–¥ |
|------|-----|-----------|--------|
| 2023 | **CVE-2023-26551â†’26555** | ntp 4.2.8p15 (libntp *mstolfp*, *praecis_parse*) | **ntpq** ì‘ë‹µì„ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•œ ì—¬ëŸ¬ ê°œì˜ ê²½ê³„ ì´ˆê³¼ ì“°ê¸°. **4.2.8p16**ì—ì„œ íŒ¨ì¹˜ ğŸ¡’ ì—…ê·¸ë ˆì´ë“œ ë˜ëŠ” ë°±í¬íŠ¸ ìˆ˜ì •. îˆ€citeîˆ‚turn1search1îˆ‚turn1search2îˆ‚turn1search0îˆ|
| 2023 | **CVE-2023-33192** | **ntpd-rs** (Rust êµ¬í˜„) | ì˜ëª»ëœ **NTS** ì¿ í‚¤ë¡œ ì¸í•´ v0.3.3 ì´ì „ì— ì›ê²© **DoS** ë°œìƒ â€“ NTSê°€ **ë¹„í™œì„±í™”**ëœ ê²½ìš°ì—ë„ í¬íŠ¸ 123ì— ì˜í–¥ì„ ë¯¸ì¹¨. îˆ€citeîˆ‚turn4view0îˆ|
| 2024 | ë°°í¬íŒ ì—…ë°ì´íŠ¸ | **chrony 4.4 / 4.5** â€“ ì—¬ëŸ¬ ë³´ì•ˆ ê°•í™” ë° NTS-KE ìˆ˜ì • (ì˜ˆ: SUSE-RU-2024:2022) îˆ€citeîˆ‚turn2search2îˆ|
| 2024 | ê¸°ë¡ DDoS | CloudflareëŠ” **5.6 Tbps UDP ë°˜ì‚¬** ê³µê²©ì„ ë³´ê³  (NTPê°€ ì‚¬ìš©ëœ í”„ë¡œí† ì½œ ì¤‘ í•˜ë‚˜). ì¸í„°ë„·ì— ë…¸ì¶œëœ í˜¸ìŠ¤íŠ¸ì—ì„œ *monitor* ë° *monlist*ë¥¼ ë¹„í™œì„±í™”í•˜ì‹­ì‹œì˜¤. îˆ€citeîˆ‚turn5search0îˆ|

> **ìµìŠ¤í”Œë¡œì‡ í‚¤íŠ¸**: 2023 ntpq OOB-write ì‹œë¦¬ì¦ˆì— ëŒ€í•œ ê°œë… ì¦ëª… í˜ì´ë¡œë“œê°€ GitHubì— ìˆìœ¼ë©° (Meinberg ì‘ì„± ì°¸ì¡°) ì‹œìŠ¤í…œ ê´€ë¦¬ìì— ëŒ€í•œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ í”¼ì‹±ì„ ìœ„í•´ ë¬´ê¸°í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. îˆ€citeîˆ‚turn1search4îˆ

---
## ê³ ê¸‰ ê³µê²©

### 1. NTP ì¦í­ / ë°˜ì‚¬

êµ¬ì‹ Mode-7 ``monlist`` ì¿¼ë¦¬ëŠ” ìµœëŒ€ **600ê°œì˜ í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ**ë¥¼ ë°˜í™˜í•˜ë©° ì—¬ì „íˆ ìˆ˜ì²œ ê°œì˜ ì¸í„°ë„· í˜¸ìŠ¤íŠ¸ì— ì¡´ì¬í•©ë‹ˆë‹¤. ì‘ë‹µ (428-468 ë°”ì´íŠ¸/í•­ëª©)ì´ 8ë°”ì´íŠ¸ ìš”ì²­ë³´ë‹¤ *~ 200Ã—* ë” í¬ê¸° ë•Œë¬¸ì— ê³µê²©ìëŠ” ì„¸ ìë¦¬ ì¦í­ ê³„ìˆ˜ë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™„í™” ì¡°ì¹˜:

- ntp 4.2.8p15+ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ê³  ``disable monitor``ë¥¼ **ì¶”ê°€**í•˜ì‹­ì‹œì˜¤.
- ì—£ì§€ì—ì„œ UDP/123ì˜ ì†ë„ë¥¼ ì œí•œí•˜ê±°ë‚˜ DDoS ì¥ì¹˜ì—ì„œ *sessions-required*ë¥¼ í™œì„±í™”í•˜ì‹­ì‹œì˜¤.
- ì¶œì²˜ ìŠ¤í‘¸í•‘ì„ ì°¨ë‹¨í•˜ê¸° ìœ„í•´ *BCP 38* ì´íƒˆ í•„í„°ë§ì„ í™œì„±í™”í•˜ì‹­ì‹œì˜¤.

Cloudflareì˜ í•™ìŠµ ì„¼í„° ê¸°ì‚¬ë¥¼ ì°¸ì¡°í•˜ì—¬ ë‹¨ê³„ë³„ ë¶„ì„ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤. îˆ€citeîˆ‚turn5search1îˆ

### 2. ì‹œê°„ ì´ë™ / ì§€ì—° ê³µê²© (Khronos / Chronos ì—°êµ¬)

ì¸ì¦ì´ ìˆë”ë¼ë„, ê²½ë¡œìƒì˜ ê³µê²©ìëŠ” íŒ¨í‚·ì„ ë“œë¡­í•˜ê±°ë‚˜ ì§€ì—°ì‹œì¼œ í´ë¼ì´ì–¸íŠ¸ ì‹œê³„ë¥¼ ì¡°ìš©íˆ **ì´ë™**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. IETF **Khronos (ì´ì „ Chronos) ì´ˆì•ˆ**ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‹¤ì–‘í•œ ì„œë²„ë¥¼ ì¿¼ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ì •ìƒ í™•ì¸í•˜ì—¬ ğš¡ msë¥¼ ì´ˆê³¼í•˜ëŠ” ì´ë™ì„ ê°ì§€í•  ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤. ìµœì‹  chrony (4.4+)ëŠ” ì´ë¯¸ ìœ ì‚¬í•œ ì •ìƒ í•„í„° (``maxdistance`` / ``maxjitter``)ë¥¼ êµ¬í˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤. îˆ€citeîˆ‚turn9search1îˆ

### 3. NTS ë‚¨ìš© ë° 4460/tcp ë…¸ì¶œ

NTSëŠ” ë¬´ê±°ìš´ ì•”í˜¸í™”ë¥¼ ë³„ë„ì˜ **TLS 1.3 ì±„ë„ì—ì„œ 4460/tcp** (``ntske/1``)ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì˜ëª»ëœ êµ¬í˜„ (CVE-2023-33192 ì°¸ì¡°)ì€ ì¿ í‚¤ë¥¼ íŒŒì‹±í•  ë•Œ ì¶©ëŒí•˜ê±°ë‚˜ ì•½í•œ ì•”í˜¸ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. íœí…ŒìŠ¤í„°ëŠ”:
```bash
# TLS reconnaissance
nmap -sV -p 4460 --script ssl-enum-ciphers,ssl-cert <IP>

# Grab banner & ALPN
openssl s_client -connect <IP>:4460 -alpn ntske/1 -tls1_3 -ign_eof
```
ìì²´ ì„œëª…ëœ ì¸ì¦ì„œë‚˜ ë§Œë£Œëœ ì¸ì¦ì„œ ë° ì•½í•œ ì•”í˜¸í™” ìŠ¤ìœ„íŠ¸(ë¹„ AEAD)ë¥¼ ì°¾ìœ¼ì‹­ì‹œì˜¤. ì°¸ì¡°: RFC 8915 Â§4. îˆ€citeîˆ‚turn11search0îˆ

---
## ê°•í™” / ìµœì„ ì˜ í˜„ì¬ ê´€í–‰ (BCP-233 / RFC 8633)

*ìš´ì˜ìëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:*

1. **â‰¥ 4**ê°œì˜ ë…ë¦½ì ì´ê³  ë‹¤ì–‘í•œ ì‹œê°„ ì†ŒìŠ¤(ê³µê°œ í’€, GPS, PTP-ë¸Œë¦¬ì§€)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¨ì¼ ì†ŒìŠ¤ ì˜¤ì—¼ì„ í”¼í•˜ì‹­ì‹œì˜¤.
2. ``kod`` ë° ``limited``/``nomodify`` ì œí•œì„ í™œì„±í™”í•˜ì—¬ ì•…ì˜ì ì¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì „ì²´ ì‘ë‹µ ëŒ€ì‹  **Kiss-o'-Death** ì†ë„ ì œí•œ íŒ¨í‚·ì„ ë°›ë„ë¡ í•˜ì‹­ì‹œì˜¤.
3. **panic** ì´ë²¤íŠ¸ ë˜ëŠ” 1000ì´ˆ ì´ìƒì˜ ë‹¨ê³„ ì¡°ì •ì„ ìœ„í•´ ë°ëª¬ ë¡œê·¸ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì‹­ì‹œì˜¤. (RFC 8633 Â§5.3ì— ë”°ë¥¸ ê³µê²©ì˜ ì§•í›„.)
4. ë„ì•½ ì´ˆ ì¤‘ë‹¨ì„ í”¼í•˜ê¸° ìœ„í•´ **leap-smear**ë¥¼ ê³ ë ¤í•˜ë˜, *ëª¨ë“ * í•˜ë¥˜ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì¼í•œ ìŠ¤ë¯¸ì–´ ìœˆë„ìš°ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ì‹­ì‹œì˜¤.
5. ë„ì•½ ì´ˆ í”Œë˜ê·¸ê°€ ëˆ„ë½ë˜ì§€ ì•Šë„ë¡ í´ë§ì„ â‰¤24ì‹œê°„ìœ¼ë¡œ ìœ ì§€í•˜ì‹­ì‹œì˜¤.

í¬ê´„ì ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” RFC 8633ì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤. îˆ€citeîˆ‚turn8search0îˆ‚turn8search1îˆ

---
## Shodan / Censys Dorks
```
port:123 "ntpd"          # Version banner
udp port:123 monlist:true # Censys tag for vulnerable servers
port:4460 "ntske"         # NTS-KE
```
---
## ìœ ìš©í•œ ë„êµ¬

| ë„êµ¬ | ëª©ì  | ì˜ˆì‹œ |
|------|---------|---------|
| ``ntpwn`` | monlist ë° peers ì¿¼ë¦¬ë¥¼ ìŠ¤í”„ë ˆì´í•˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ í‚¤ë“œ ë˜í¼ | ``python ntpwn.py --monlist targets.txt`` |
| **zgrab2 ntp** | ëŒ€ëŸ‰ ìŠ¤ìº” / monlist í”Œë˜ê·¸ë¥¼ í¬í•¨í•œ JSON ì¶œë ¥ | ìœ„ì˜ ëª…ë ¹ ì°¸ì¡° |
| ``chronyd`` with ``allow`` | íœí…ŒìŠ¤íŠ¸ ì‹¤í—˜ì‹¤ì—ì„œ ì•…ì„± NTP ì„œë²„ ì‹¤í–‰ | ``chronyd -q 'server 127.127.1.0 iburst'`` |
| ``BetterCap`` | Wi-Fiì—ì„œ ì‹œê°„ ì´ë™ MITMì„ ìœ„í•œ NTP íŒ¨í‚· ì£¼ì… | ``set arp.spoof.targets <victim>; set ntp.time.delta 30s; arp.spoof on`` |

---
## HackTricks ìë™ ëª…ë ¹
```
Protocol_Name: NTP
Port_Number: 123
Protocol_Description: Network Time Protocol

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) ensures computers and network devices across variable-latency networks sync their clocks accurately. It's vital for maintaining precise timekeeping in IT operations, security, and logging. NTP's accuracy is essential, but it also poses security risks if not properly managed.

https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-ntp.html

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
---
## References

- RFC 8915 â€“ *Network Time Security for the Network Time Protocol* (port 4460) îˆ€citeîˆ‚turn11search0îˆ
- RFC 8633 â€“ *Network Time Protocol BCP* îˆ€citeîˆ‚turn8search0îˆ
- Cloudflare DDoS report 2024 Q4 (5.6 Tbps) îˆ€citeîˆ‚turn5search0îˆ
- Cloudflare *NTP Amplification Attack* article îˆ€citeîˆ‚turn5search1îˆ
- NTP 4.2.8p15 CVE series 2023-04 îˆ€citeîˆ‚turn1search4îˆ
- NVD entries **CVE-2023-26551â€“55**, **CVE-2023-33192** îˆ€citeîˆ‚turn1search1îˆ‚turn1search2îˆ‚turn1search0îˆ‚turn4view0îˆ
- SUSE chrony security update 2024 (chrony 4.5) îˆ€citeîˆ‚turn2search2îˆ
- Khronos/Chronos draft (time-shift mitigation) îˆ€citeîˆ‚turn9search1îˆ
- chronyc manual/examples for remote monitoring îˆ€citeîˆ‚turn3search0îˆ‚turn10search1îˆ
- zgrab2 ntp module docs îˆ€citeîˆ‚turn7search0îˆ
{{#include /banners/hacktricks-training.md}}
