# 123/udp - Pentesting NTP

{{#include ../banners/hacktricks-training.md}}

## Basic Information

**рдиреЗрдЯрд╡рд░реНрдХ рдЯрд╛рдЗрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (NTP)** рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрдВрдкреНрдпреВрдЯрд░ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЙрдкрдХрд░рдг рд╡рд┐рднрд┐рдиреНрди-рд▓реЗрдЯреЗрдВрд╕реА рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЕрдкрдиреЗ рдШрдбрд╝рд┐рдпреЛрдВ рдХреЛ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ рд╕рдордиреНрд╡рдпрд┐рдд рдХрд░реЗрдВред рдпрд╣ IT рд╕рдВрдЪрд╛рд▓рди, рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рд▓реЙрдЧрд┐рдВрдЧ рдореЗрдВ рд╕рдЯреАрдХ рд╕рдордпkeeping рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдЪреВрдВрдХрд┐ рд╕рдордп рдХрд╛ рдЙрдкрдпреЛрдЧ рд▓рдЧрднрдЧ рд╣рд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рдХреНрд░рд┐рдкреНрдЯреЛ-рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рдлреЛрд░реЗрдВрд╕рд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, **рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬреЛ NTP рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЕрдХреНрд╕рд░ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рд╣рдорд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рдХрдард┐рди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред**

### Summary & Security Tips

- **рдЙрджреНрджреЗрд╢реНрдп**: рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреА рдШрдбрд╝рд┐рдпреЛрдВ рдХреЛ рд╕рдордиреНрд╡рдпрд┐рдд рдХрд░рдирд╛ред
- **рдорд╣рддреНрд╡**: рд╕реБрд░рдХреНрд╖рд╛, рд▓реЙрдЧрд┐рдВрдЧ, рдХреНрд░рд┐рдкреНрдЯреЛ-рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╡рд┐рддрд░рд┐рдд рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдгред
- **рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп**:
- рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп NTP рдпрд╛ NTS (рдиреЗрдЯрд╡рд░реНрдХ рдЯрд╛рдЗрдо рд╕реБрд░рдХреНрд╖рд╛) рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
- рдпрд╣ рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреМрди рдбреЗрдорди рдХреЛ рдХреНрд╡реЗрд░реА/рдХрдорд╛рдВрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ (``restrict default noquery``, ``kod`` рдЖрджрд┐)ред
- рдкреБрд░рд╛рдиреЗ рдореЛрдб-6/7 рдирд┐рдпрдВрддреНрд░рдг рдХреНрд╡реЗрд░реА (``monlist``, ``ntpdc``) рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ рдпрд╛ рдЙрдирдХреА рджрд░ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВред
- рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХреЗ рд▓рд┐рдП рд╕рдордиреНрд╡рдп рдбреНрд░рд┐рдлреНрдЯ/рд▓реАрдк-рд╕реЗрдХрдВрдб рд╕реНрдерд┐рддрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред
- рдбреЗрдорди рдХреЛ рдЕрдкрдбреЗрдЯ рд░рдЦреЗрдВ (рдиреАрдЪреЗ рд╣рд╛рд▓ рдХреЗ CVEs рджреЗрдЦреЗрдВ)ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкреЛрд░реНрдЯреНрд╕**
```
123/udp   NTP            (data + legacy control)
4460/tcp  NTS-KE (RFC 8915) тАУ TLS key-establishment for NTP
```

```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
---
## Enumeration

### Classic ntpd / ntpq / ntpdc
```bash
# Information & variables
ntpq -c rv <IP>
ntpq -c readvar <IP>
ntpq -c peers <IP>
ntpq -c associations <IP>

# Legacy mode-7 (often disabled >=4.2.8p9)
ntpdc -c monlist <IP>
ntpdc -c listpeers <IP>
ntpdc -c sysinfo  <IP>
```
### chrony / chronyc (рдЕрдзрд┐рдХрд╛рдВрд╢ рдЖрдзреБрдирд┐рдХ Linux рд╡рд┐рддрд░рдгреЛрдВ рдореЗрдВ)

рдЬрдм ``cmdallow`` рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдХреЗрд╡рд▓ рдХреБрдЫ рд╣реА рдирд┐рдЧрд░рд╛рдиреА рдХрдорд╛рдВрдб рджреВрд░рд╕реНрде IPs рд╕реЗ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ:
```bash
chronyc -a -n tracking   -h <IP>
chronyc -a -n sources -v -h <IP>
chronyc -a -n sourcestats -h <IP>
```
**M/S** рдзреНрд╡рдЬреЛрдВ рдФрд░ рдЕрдиреНрдп рдХреНрд╖реЗрддреНрд░реЛрдВ (stratum, reach, jitter, рдЖрджрд┐) рдХреЗ рдЕрд░реНрде рдХреЗ рд▓рд┐рдП chronyc рдореИрди рдкреГрд╖реНрда рджреЗрдЦреЗрдВред

### Nmap
```bash
# Safe discovery & vuln detection
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>

# Explicit monlist check
nmap -sU -p123 --script ntp-monlist <IP>
```
### рдорд╛рд╕/рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ
```bash
# Check if MONLIST is enabled (zgrab2 module)
zgrab2 ntp --monlist --timeout 3 --output-file monlist.json -f "zmap_results.csv"
```
---
## рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

- ``/etc/ntp.conf`` (ntpd)
- ``/etc/chrony/chrony.conf`` (chrony)
- ``/etc/systemd/timesyncd.conf`` (timesyncd тАУ рдХреЗрд╡рд▓ рдХреНрд▓рд╛рдЗрдВрдЯ)

``restrict`` рд▓рд╛рдЗрдиреЛрдВ, ``kod`` (Kiss-o'-Death) рд╕реЗрдЯрд┐рдВрдЧреНрд╕, ``disable monitor``/``includefile /etc/ntp/crypto`` рдФрд░ рдпрд╣ рдХрд┐ *NTS* рд╕рдХреНрд╖рдо рд╣реИ (``nts enable``) рдкрд░ рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рджреЗрдВред

---
## рд╣рд╛рд▓ рдХреА рдХрдордЬреЛрд░рд┐рдпрд╛рдБ (2023-2025)

| рд╡рд░реНрд╖ | CVE | рдШрдЯрдХ | рдкреНрд░рднрд╛рд╡ |
|------|-----|-----------|--------|
| 2023 | **CVE-2023-26551тЖТ26555** | ntp 4.2.8p15 (libntp *mstolfp*, *praecis_parse*) | **ntpq** рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдВрдЪ рдпреЛрдЧреНрдп рдХрдИ рдЖрдЙрдЯ-рдСрдл-рдмрд╛рдЙрдВрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВред **4.2.8p16** рдореЗрдВ рдкреИрдЪ ЁЯбТ рдЕрдкрдЧреНрд░реЗрдб рдпрд╛ рдмреИрдХ-рдкреЛрд░реНрдЯ рдлрд┐рдХреНрд╕ рдХрд░реЗрдВред |
| 2023 | **CVE-2023-33192** | **ntpd-rs** (Rust рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди) | рдЧрд▓рдд рд╕реНрд╡рд░реВрдкрд┐рдд **NTS** рдХреБрдХреА рджреВрд░рд╕реНрде **DoS** рдХрд╛ рдХрд╛рд░рдг рдмрдирддреА рд╣реИ v0.3.3 рд╕реЗ рдкрд╣рд▓реЗ тАУ рдкреЛрд░реНрдЯ 123 рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ рдЬрдм NTS **рдЕрдХреНрд╖рдо** рд╣реЛред |
| 2024 | рд╡рд┐рддрд░рдг рдЕрдкрдбреЗрдЯ | **chrony 4.4 / 4.5** тАУ рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдФрд░ NTS-KE рдлрд┐рдХреНрд╕ (рдЬреИрд╕реЗ SUSE-RU-2024:2022) |
| 2024 | рд░рд┐рдХреЙрд░реНрдб DDoS | Cloudflare рдиреЗ **5.6 Tbps UDP рдкрд░рд╛рд╡рд░реНрддрди** рд╣рдорд▓реЗ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХреА (NTP рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рд╕реЗ рдПрдХ)ред рдЗрдВрдЯрд░рдиреЗрдЯ-рдлреЗрд╕рд┐рдВрдЧ рд╣реЛрд╕реНрдЯ рдкрд░ *monitor* рдФрд░ *monlist* рдХреЛ рдЕрдХреНрд╖рдо рд░рдЦреЗрдВред |

> **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд┐рдЯ**: 2023 ntpq OOB-write рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдг-рдСрдл-рдХреЙрдиреНрд╕реЗрдкреНрдЯ рдкреЗрд▓реЛрдб GitHub рдкрд░ рд╣реИрдВ (Meinberg рд▓реЗрдЦ рджреЗрдЦреЗрдВ) рдФрд░ рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдлрд╝рд┐рд╢рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╣рдерд┐рдпрд╛рд░рдмрдВрдж рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

---
## рдЙрдиреНрдирдд рд╣рдорд▓реЗ

### 1. NTP рдПрдореНрдкреНрд▓реАрдлрд┐рдХреЗрд╢рди / рдкрд░рд╛рд╡рд░реНрддрди

рд╡рд┐рд░рд╛рд╕рдд рдореЛрдб-7 ``monlist`` рдХреНрд╡реЗрд░реА **600 рд╣реЛрд╕реНрдЯ рдкрддреЗ** рддрдХ рд▓реМрдЯрд╛рддреА рд╣реИ рдФрд░ рдЕрднреА рднреА рд╣рдЬрд╛рд░реЛрдВ рдЗрдВрдЯрд░рдиреЗрдЯ рд╣реЛрд╕реНрдЯ рдкрд░ рдореМрдЬреВрдж рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдЙрддреНрддрд░ (428-468 рдмрд╛рдЗрдЯ/рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐) 8-рдмрд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рд╕реЗ *~ 200├Ч* рдмрдбрд╝рд╛ рд╣реИ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рддреАрди рдЕрдВрдХреЛрдВ рдХреЗ рдПрдореНрдкреНрд▓реАрдлрд┐рдХреЗрд╢рди рдлреИрдХреНрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред рд╢рдорди:

- ntp 4.2.8p15+ рдкрд░ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ рдФрд░ ``disable monitor`` **рдЬреЛрдбрд╝реЗрдВ**ред
- DDoS рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдПрдЬ рдкрд░ UDP/123 рдХреА рджрд░-рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рдпрд╛ *sessions-required* рд╕рдХреНрд╖рдо рдХрд░реЗрдВред
- рд╕реНрд░реЛрдд рд╕реНрдкреВрдлрд┐рдВрдЧ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП *BCP 38* рдирд┐рдХрд╛рд╕реА рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред

рдЪрд░рдг-рджрд░-рдЪрд░рдг рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП Cloudflare рдХреЗ рд▓рд░реНрдирд┐рдВрдЧ-рд╕реЗрдВрдЯрд░ рд▓реЗрдЦ рдХреЛ рджреЗрдЦреЗрдВред

### 2. рд╕рдордп-рд╢рд┐рдлреНрдЯ / рджреЗрд░реА рд╣рдорд▓реЗ (Khronos / Chronos рдЕрдиреБрд╕рдВрдзрд╛рди)

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рднреА, рдПрдХ рдСрди-рдкрд╛рде рд╣рдорд▓рд╛рд╡рд░ рдЪреБрдкрдЪрд╛рдк **рдХреНрд▓рд╛рдЗрдВрдЯ рдШрдбрд╝реА** рдХреЛ рдкреИрдХреЗрдЯ рдЧрд┐рд░рд╛рдХрд░/рджреЗрд░реА рдХрд░рдХреЗ **рд╢рд┐рдлреНрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИред IETF **Khronos (рдкреВрд░реНрд╡ рдореЗрдВ Chronos) рдбреНрд░рд╛рдлреНрдЯ** рдкреГрд╖реНрдарднреВрдорд┐ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреА рд╕рдЪреНрдЪрд╛рдИ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ ЁЭЪб ms рд╕реЗ рдЕрдзрд┐рдХ рд╢рд┐рдлреНрдЯ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЖрдзреБрдирд┐рдХ chrony (4.4+) рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд╕рдорд╛рди рд╕рдЪреНрдЪрд╛рдИ рдлрд╝рд┐рд▓реНрдЯрд░ (``maxdistance`` / ``maxjitter``) рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред

### 3. NTS рджреБрд░реБрдкрдпреЛрдЧ рдФрд░ 4460/tcp рдПрдХреНрд╕рдкреЛрдЬрд░

NTS рднрд╛рд░реА рдХреНрд░рд┐рдкреНрдЯреЛ рдХреЛ рдПрдХ рдЕрд▓рдЧ **TLS 1.3 рдЪреИрдирд▓ рдкрд░ 4460/tcp** (``ntske/1``) рдкрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред рдЦрд░рд╛рдм рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди (рджреЗрдЦреЗрдВ CVE-2023-33192) рдХреБрдХреАрдЬрд╝ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддреЗ рд╕рдордп рдХреНрд░реИрд╢ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ рдпрд╛ рдХрдордЬреЛрд░ рд╕рд┐рдлрд░ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред Pentesters рдХреЛ рдЪрд╛рд╣рд┐рдП:
```bash
# TLS reconnaissance
nmap -sV -p 4460 --script ssl-enum-ciphers,ssl-cert <IP>

# Grab banner & ALPN
openssl s_client -connect <IP>:4460 -alpn ntske/1 -tls1_3 -ign_eof
```
рд╕реНрд╡-рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдпрд╛ рд╕рдорд╛рдкреНрдд рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдФрд░ рдХрдордЬреЛрд░ рд╕рд┐рдлрд░-рд╕реБрдЗрдЯреНрд╕ (рдЧреИрд░-AEAD) рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВред рд╕рдВрджрд░реНрдн: RFC 8915 ┬з4ред

---
## рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ / рд╕рд░реНрд╡реЛрддреНрддрдо-рд╡рд░реНрддрдорд╛рди-рдкреНрд░рдерд╛ (BCP-233 / RFC 8633)

*рдСрдкрд░реЗрдЯрд░ рдХреЛ рдЪрд╛рд╣рд┐рдП:*

1. **тЙе 4** рд╕реНрд╡рддрдВрддреНрд░, рд╡рд┐рд╡рд┐рдз рд╕рдордп рд╕реНрд░реЛрддреЛрдВ (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреВрд▓, GPS, PTP-рдмреНрд░рд┐рдЬ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдХрд▓-рд╕реНрд░реЛрдд рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред
2. ``kod`` рдФрд░ ``limited``/``nomodify`` рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рддрд╛рдХрд┐ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЛ рдкреВрд░реНрдг рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрдЬрд╛рдп **Kiss-o'-Death** рджрд░-рд╕реАрдорд╛ рдкреИрдХреЗрдЯ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВред
3. **panic** рдШрдЯрдирд╛рдУрдВ рдпрд╛ рдЪрд░рдг рд╕рдорд╛рдпреЛрдЬрдиреЛрдВ > 1000 рд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП рдбреЗрдорди рд▓реЙрдЧ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВред (RFC 8633 ┬з5.3 рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╣рдорд▓реЗ рдХреЗ рд╕рдВрдХреЗрддред)
4. рдХреВрдж-рдзреБрдВрдзрд▓рд╛рдкрди рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **leap-smear** рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, рд▓реЗрдХрд┐рди рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ *рд╕рднреА* рдбрд╛рдЙрдирд╕реНрдЯреНрд░реАрдо рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдПрдХ рд╣реА рдзреБрдВрдзрд▓рд╛рдкрди рд╡рд┐рдВрдбреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
5. рдкреЛрд▓рд┐рдВрдЧ рдХреЛ тЙд24 рдШрдВрдЯреЗ рд░рдЦреЗрдВ рддрд╛рдХрд┐ рдХреВрдж-рд╕реЗрдХрдВрдб рдХреЗ рдЭрдВрдбреЗ рдЫреВрдЯ рди рдЬрд╛рдПрдВред

рд╡реНрдпрд╛рдкрдХ рдЪреЗрдХрд▓рд┐рд╕реНрдЯ рдХреЗ рд▓рд┐рдП RFC 8633 рджреЗрдЦреЗрдВред

---
## Shodan / Censys Dorks
```
port:123 "ntpd"          # Version banner
udp port:123 monlist:true # Censys tag for vulnerable servers
port:4460 "ntske"         # NTS-KE
```
---
## рдЙрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг

| рдЙрдкрдХрд░рдг | рдЙрджреНрджреЗрд╢реНрдп | рдЙрджрд╛рд╣рд░рдг |
|------|---------|---------|
| ``ntpwn`` | рд╕реНрдХреНрд░рд┐рдкреНрдЯ-рдХрд┐рдбреА wrapper рдЬреЛ monlist & peers рдХреНрд╡реЗрд░реА рдХреЛ рд╕реНрдкреНрд░реЗ рдХрд░рддрд╛ рд╣реИ | ``python ntpwn.py --monlist targets.txt`` |
| **zgrab2 ntp** | рдорд╛рд╕ рд╕реНрдХреИрдирд┐рдВрдЧ / JSON рдЖрдЙрдЯрдкреБрдЯ рдЬрд┐рд╕рдореЗрдВ monlist рдлреНрд▓реИрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИ | рдКрдкрд░ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЛ рджреЗрдЦреЗрдВ |
| ``chronyd`` with ``allow`` | рдкреЗрдВрдЯреЗрд╕реНрдЯ рд▓реИрдм рдореЗрдВ рдзреЛрдЦрд╛рдзрдбрд╝реА NTP рд╕рд░реНрд╡рд░ рдЪрд▓рд╛рдирд╛ | ``chronyd -q 'server 127.127.1.0 iburst'`` |
| ``BetterCap`` | Wi-Fi рдкрд░ рд╕рдордп-рд╢рд┐рдлреНрдЯ MITM рдХреЗ рд▓рд┐рдП NTP рдкреИрдХреЗрдЯ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдирд╛ | ``set arp.spoof.targets <victim>; set ntp.time.delta 30s; arp.spoof on`` |

---
## HackTricks рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрдорд╛рдВрдб
```
Protocol_Name: NTP
Port_Number: 123
Protocol_Description: Network Time Protocol

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) ensures computers and network devices across variable-latency networks sync their clocks accurately. It's vital for maintaining precise timekeeping in IT operations, security, and logging. NTP's accuracy is essential, but it also poses security risks if not properly managed.

https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-ntp.html

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
---
## рд╕рдВрджрд░реНрдн

- RFC 8915 тАУ *рдиреЗрдЯрд╡рд░реНрдХ рдЯрд╛рдЗрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдиреЗрдЯрд╡рд░реНрдХ рдЯрд╛рдЗрдо рд╕реБрд░рдХреНрд╖рд╛* (рдкреЛрд░реНрдЯ 4460)
- RFC 8633 тАУ *рдиреЗрдЯрд╡рд░реНрдХ рдЯрд╛рдЗрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓ BCP*
- Cloudflare DDoS рд░рд┐рдкреЛрд░реНрдЯ 2024 Q4 (5.6 Tbps)
- Cloudflare *NTP рдПрдореНрдкреНрд▓реАрдлрд┐рдХреЗрд╢рди рдЕрдЯреИрдХ* рд▓реЗрдЦ
- NTP 4.2.8p15 CVE рд╢реНрд░реГрдВрдЦрд▓рд╛ 2023-04
- NVD рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ **CVE-2023-26551тАУ55**, **CVE-2023-33192**
- SUSE рдХреНрд░реЛрдирд╛рдИ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдкрдбреЗрдЯ 2024 (рдХреНрд░реЛрдирд╛рдИ 4.5)
- Khronos/Chronos рдбреНрд░рд╛рдлреНрдЯ (рд╕рдордп-рд╢рд┐рдлреНрдЯ рд╢рдорди)
- chronyc рдореИрдиреБрдЕрд▓/рдЙрджрд╛рд╣рд░рдг рджреВрд░рд╕реНрде рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рд▓рд┐рдП
- zgrab2 ntp рдореЙрдбреНрдпреВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
{{#include /banners/hacktricks-training.md}}
