# 123/udp - Pentesting NTP

{{#include ../banners/hacktricks-training.md}}

## Basic Information

Î¤Î¿ **Network Time Protocol (NTP)** Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Î¿Î¹ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î­Ï‚ ÎºÎ±Î¹ Î¿Î¹ Î´Î¹ÎºÏ„Ï…Î±ÎºÎ­Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ ÏƒÎµ Î´Î¯ÎºÏ„Ï…Î± Î¼Îµ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Ï…Î½ Ï„Î¹Ï‚ ÏÎ¿Î»ÏŒÎ³Î¹Î± Ï„Î¿Ï…Ï‚ Î¼Îµ Î±ÎºÏÎ¯Î²ÎµÎ¹Î±. Î•Î¯Î½Î±Î¹ Î¶Ï‰Ï„Î¹ÎºÎ®Ï‚ ÏƒÎ·Î¼Î±ÏƒÎ¯Î±Ï‚ Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î±ÎºÏÎ¹Î²Î¿ÏÏ‚ Ï‡ÏÎ¿Î½Î¿Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚ ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ IT, Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®. Î•Ï€ÎµÎ¹Î´Î® Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÏƒÏ‡ÎµÎ´ÏŒÎ½ ÏƒÎµ ÎºÎ¬Î¸Îµ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚, ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¿Ï Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Î¿Ï… ÎºÎ±Î¹ ÎµÎ³ÎºÎ»Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¹ÎºÎ®Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚, **Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎµÎ¹ Ï„Î¿ NTP Î¼Ï€Î¿ÏÎµÎ¯ ÏƒÏ…Ï‡Î½Î¬ Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î® Î½Î± Î´Ï…ÏƒÎºÎ¿Î»Î­ÏˆÎµÎ¹ Ï„Î·Î½ Î­ÏÎµÏ…Î½Î± ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½.**

### Summary & Security Tips

- **Purpose**: Î£Ï…Î³Ï‡ÏÎ¿Î½Î¯Î¶ÎµÎ¹ Ï„Î¹Ï‚ ÏÎ¿Î»ÏŒÎ³Î¹Î± Ï„Ï‰Î½ ÏƒÏ…ÏƒÎºÎµÏ…ÏÎ½ Î¼Î­ÏƒÏ‰ Î´Î¹ÎºÏ„ÏÏ‰Î½.
- **Importance**: ÎšÏÎ¯ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±, Ï„Î·Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®, Ï„Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¬ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î± ÎºÎ±Î¹ Ï„Î± ÎºÎ±Ï„Î±Î½ÎµÎ¼Î·Î¼Î­Î½Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±.
- **Security Measures**:
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„ÎµÏ‚ Ï€Î·Î³Î­Ï‚ NTP Î® NTS (Network Time Security) Î¼Îµ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·.
- Î ÎµÏÎ¹Î¿ÏÎ¯ÏƒÏ„Îµ Ï€Î¿Î¹Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹/ÎµÎ½Ï„Î¿Î»Î® Ï„Î¿Î½ Î´Î±Î¯Î¼Î¿Î½Î± (``restrict default noquery``, ``kod`` Îº.Î»Ï€.).
- Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ ÎºÎ»Î·ÏƒÎµÎ¹Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï… Legacy Mode-6/7 (``monlist``, ``ntpdc``) Î® Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÏ„Îµ Ï„Î¹Ï‚.
- Î Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Ï„Î·Î½ Î±Ï€ÏŒÎºÎ»Î¹ÏƒÎ· ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î¿Ï/ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· leap-second Î³Î¹Î± Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ·.
- Î”Î¹Î±Ï„Î·ÏÎ®ÏƒÏ„Îµ Ï„Î¿Î½ Î´Î±Î¯Î¼Î¿Î½Î± ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î¿ (Î´ÎµÎ¯Ï„Îµ Ï„Î± Ï€ÏÏŒÏƒÏ†Î±Ï„Î± CVEs Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰).

**Default ports**
```
123/udp   NTP            (data + legacy control)
4460/tcp  NTS-KE (RFC 8915) â€“ TLS key-establishment for NTP
```

```
PORT    STATE SERVICE REASON
123/udp open  ntp     udp-response
```
---
## Enumeration

### Classic ntpd / ntpq / ntpdc
```bash
# Information & variables
ntpq -c rv <IP>
ntpq -c readvar <IP>
ntpq -c peers <IP>
ntpq -c associations <IP>

# Legacy mode-7 (often disabled >=4.2.8p9)
ntpdc -c monlist <IP>
ntpdc -c listpeers <IP>
ntpdc -c sysinfo  <IP>
```
### chrony / chronyc (ÏƒÎµ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÏƒÏÎ³Ï‡ÏÎ¿Î½ÎµÏ‚ Î´Î¹Î±Î½Î¿Î¼Î­Ï‚ Linux)

ÎœÏŒÎ½Î¿ Î¼Î¹Î± Ï‡Î¿ÏÏ†Ï„Î± ÎµÎ½Ï„Î¿Î»ÏÎ½ Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ·Ï‚ Î³Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€Î¿Î´ÎµÎºÏ„Î­Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Ï„Î¿ ``cmdallow``:
```bash
chronyc -a -n tracking   -h <IP>
chronyc -a -n sources -v -h <IP>
chronyc -a -n sourcestats -h <IP>
```
Î”ÎµÎ¯Ï„Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± man Ï„Î¿Ï… chronyc Î³Î¹Î± Ï„Î· ÏƒÎ·Î¼Î±ÏƒÎ¯Î± Ï„Ï‰Î½ ÏƒÎ·Î¼Î±Î¹ÏÎ½ **M/S** ÎºÎ±Î¹ Î¬Î»Î»Ï‰Î½ Ï€ÎµÎ´Î¯Ï‰Î½ (stratum, reach, jitter, Îº.Î»Ï€.).

### Nmap
```bash
# Safe discovery & vuln detection
nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 <IP>

# Explicit monlist check
nmap -sU -p123 --script ntp-monlist <IP>
```
### ÎœÎ±Î¶Î¹ÎºÎ®/Î”Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® ÏƒÎ¬ÏÏ‰ÏƒÎ·
```bash
# Check if MONLIST is enabled (zgrab2 module)
zgrab2 ntp --monlist --timeout 3 --output-file monlist.json -f "zmap_results.csv"
```
---
## Î•Î¾Î­Ï„Î±ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½

- ``/etc/ntp.conf`` (ntpd)
- ``/etc/chrony/chrony.conf`` (chrony)
- ``/etc/systemd/timesyncd.conf`` (timesyncd â€“ Î¼ÏŒÎ½Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚)

Î”ÏÏƒÏ„Îµ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ· Ï€ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÏ„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ ``restrict``, ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ``kod`` (Kiss-o'-Death), ``disable monitor``/``includefile /etc/ntp/crypto`` ÎºÎ±Î¹ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Ï„Î¿ *NTS* (``nts enable``).

---
## Î ÏÏŒÏƒÏ†Î±Ï„ÎµÏ‚ Î•Ï…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ (2023-2025)

| ÎˆÏ„Î¿Ï‚ | CVE | Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÏŒ | Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ |
|------|-----|-----------|--------|
| 2023 | **CVE-2023-26551â†’26555** | ntp 4.2.8p15 (libntp *mstolfp*, *praecis_parse*) | Î Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ ÎµÎºÏ„ÏŒÏ‚ Î¿ÏÎ¯Ï‰Î½ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼ÎµÏ‚ Î¼Î­ÏƒÏ‰ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ **ntpq**. Î”Î¹Î¿ÏÎ¸Ï‰Ï„Î¹ÎºÏŒ ÏƒÎµ **4.2.8p16** ğŸ¡’ Î±Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ· Î® ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÏ‰Î½. îˆ€citeîˆ‚turn1search1îˆ‚turn1search2îˆ‚turn1search0îˆ|
| 2023 | **CVE-2023-33192** | **ntpd-rs** (Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Rust) | ÎšÎ±ÎºÏÏ‚ Î´Î¹Î±Î¼Î¿ÏÏ†Ï‰Î¼Î­Î½Î¿ cookie **NTS** Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ **DoS** Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ v0.3.3 â€“ ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î·Î½ Î¸ÏÏÎ± 123 Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ ÏŒÏ„Î±Î½ Ï„Î¿ NTS ÎµÎ¯Î½Î±Î¹ **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿**. îˆ€citeîˆ‚turn4view0îˆ|
| 2024 | ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Î´Î¹Î±Î½Î¿Î¼Î®Ï‚ | **chrony 4.4 / 4.5** â€“ Î±ÏÎºÎµÏ„Î­Ï‚ Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÎ¹Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ & NTS-KE (Ï€.Ï‡. SUSE-RU-2024:2022) îˆ€citeîˆ‚turn2search2îˆ|
| 2024 | ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® DDoS | Î— Cloudflare Î±Î½Î±Ï†Î­ÏÎµÎ¹ Î¼Î¹Î± **5.6 Tbps UDP reflection** ÎµÏ€Î¯Î¸ÎµÏƒÎ· (NTP Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Ï‰Î½ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹). ÎšÏÎ±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ *monitor* & *monlist* Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± ÏƒÎµ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½Î¿Î¹ ÏƒÏ„Î¿ Î”Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿. îˆ€citeîˆ‚turn5search0îˆ|

> **Î•ÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎµÎ¹Ï‚**: Proof-of-concept payloads Î³Î¹Î± Ï„Î· ÏƒÎµÎ¹ÏÎ¬ OOB-write Ï„Î¿Ï… ntpq Ï„Î¿ 2023 ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± ÏƒÏ„Î¿ GitHub (Î²Î». Î±Î½Î±Ï†Î¿ÏÎ¬ Meinberg) ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± phishing Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î· ÏƒÎµ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚ ÏƒÏ…ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½. îˆ€citeîˆ‚turn1search4îˆ

---
## Î ÏÎ¿Ï‡Ï‰ÏÎ·Î¼Î­Î½ÎµÏ‚ Î•Ï€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚

### 1. Î•Î½Î¯ÏƒÏ‡Ï…ÏƒÎ· / Î‘Î½Ï„Î±Î½Î¬ÎºÎ»Î±ÏƒÎ· NTP

Î¤Î¿ legacy Mode-7 ``monlist`` query ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î­Ï‰Ï‚ **600 Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ host** ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Î±ÎºÏŒÎ¼Î± Ï€Î±ÏÏŒÎ½ ÏƒÎµ Ï‡Î¹Î»Î¹Î¬Î´ÎµÏ‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚ ÏƒÏ„Î¿ Î”Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿. Î•Ï€ÎµÎ¹Î´Î® Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· (428-468 bytes/ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·) ÎµÎ¯Î½Î±Î¹ *~ 200Ã—* Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î±Ï€ÏŒ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± 8 bytes, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹ ÏƒÎµ Ï€Î±ÏÎ¬Î³Î¿Î½Ï„ÎµÏ‚ ÎµÎ½Î¯ÏƒÏ‡Ï…ÏƒÎ·Ï‚ Ï„ÏÎ¹ÏÎ½ ÏˆÎ·Ï†Î¯Ï‰Î½. ÎœÎµÏ„ÏÎ¹Î±ÏƒÎ¼Î¿Î¯:

- Î‘Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ· ÏƒÎµ ntp 4.2.8p15+ ÎºÎ±Î¹ **Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·** ``disable monitor``.
- Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏÏ…Î¸Î¼Î¿Ï UDP/123 ÏƒÏ„Î·Î½ Î¬ÎºÏÎ· Î® ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· *sessions-required* ÏƒÎµ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ DDoS.
- Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· *BCP 38* Ï†Î¹Î»Ï„ÏÎ±ÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚ ÎµÎ¾ÏŒÎ´Î¿Ï… Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„ÎµÎ¯ Î· Ï€Î±ÏÎ±Ï€Î¿Î¯Î·ÏƒÎ· Ï€Î·Î³Î®Ï‚.

Î”ÎµÎ¯Ï„Îµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Ï„Î¿Ï… ÎºÎ­Î½Ï„ÏÎ¿Ï… Î¼Î¬Î¸Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ Cloudflare Î³Î¹Î± Î¼Î¹Î± Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ® Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î®. îˆ€citeîˆ‚turn5search1îˆ

### 2. Î•Ï€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Î§ÏÎ¿Î½Î¹ÎºÎ®Ï‚ ÎœÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ·Ï‚ / ÎšÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·Ï‚ (Î­ÏÎµÏ…Î½Î± Khronos / Chronos)

Î‘ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î¼Îµ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÏƒÎµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® Î¼Ï€Î¿ÏÎµÎ¯ ÏƒÎ¹Ï‰Ï€Î·Î»Î¬ Î½Î± **Î¼ÎµÏ„Î±Ï„Î¿Ï€Î¯ÏƒÎµÎ¹ Ï„Î¿ ÏÎ¿Î»ÏŒÎ¹ Ï„Î¿Ï… Ï€ÎµÎ»Î¬Ï„Î·** ÏÎ¯Ï‡Î½Î¿Î½Ï„Î±Ï‚/ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÏÎ½Ï„Î±Ï‚ Ï€Î±ÎºÎ­Ï„Î±. Î¤Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ **Khronos (Ï€ÏÏÎ·Î½ Chronos)** Ï„Î·Ï‚ IETF Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ Ï„Î·Î½ ÎµÏÏÏ„Î·ÏƒÎ· Î¼Î¹Î±Ï‚ Ï€Î¿Î¹ÎºÎ¹Î»Î¯Î±Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„ÏÎ½ ÏƒÏ„Î¿ Ï€Î±ÏÎ±ÏƒÎºÎ®Î½Î¹Î¿ ÎºÎ±Î¹ Ï„Î·Î½ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Ï„Î¿Ï… Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î¿Ï‚ Î³Î¹Î± Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏ…Î¸ÎµÎ¯ Î¼Î¹Î± Î¼ÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ· > ğš¡ ms. ÎŸ ÏƒÏÎ³Ï‡ÏÎ¿Î½Î¿Ï‚ chrony (4.4+) Î®Î´Î· ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÎ¹ Î­Î½Î± Ï€Î±ÏÏŒÎ¼Î¿Î¹Î¿ Ï†Î¯Î»Ï„ÏÎ¿ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·Ï‚ (``maxdistance`` / ``maxjitter``). îˆ€citeîˆ‚turn9search1îˆ

### 3. ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· NTS & Î­ÎºÎ¸ÎµÏƒÎ· 4460/tcp

Î¤Î¿ NTS Î¼ÎµÏ„Î±Ï†Î­ÏÎµÎ¹ Ï„Î·Î½ Î²Î±ÏÎ¹Î¬ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÏƒÎµ Î­Î½Î± Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„ÏŒ **TLS 1.3 ÎºÎ±Î½Î¬Î»Î¹ ÏƒÏ„Î¿ 4460/tcp** (``ntske/1``). ÎšÎ±ÎºÎ­Ï‚ Ï…Î»Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ (Î²Î». CVE-2023-33192) ÎºÎ±Ï„Î±ÏÏÎ­Î¿Ï…Î½ ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ· cookies Î® ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î±Î´ÏÎ½Î±Î¼Î¿Ï…Ï‚ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¿ÏÏ‚ Î±Î»Î³ÏŒÏÎ¹Î¸Î¼Î¿Ï…Ï‚. ÎŸÎ¹ pentesters Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹:
```bash
# TLS reconnaissance
nmap -sV -p 4460 --script ssl-enum-ciphers,ssl-cert <IP>

# Grab banner & ALPN
openssl s_client -connect <IP>:4460 -alpn ntske/1 -tls1_3 -ign_eof
```
Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ Î±Ï…Ï„Î¿-Ï…Ï€Î¿Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î± Î® Î»Î·Î³Î¼Î­Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÎ¬ ÎºÎ±Î¹ Î±Î´ÏÎ½Î±Î¼ÎµÏ‚ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ ÏƒÎ¿Ï…Î¯Ï„ÎµÏ‚ (Î¼Î·-AEAD). Î‘Î½Î±Ï†Î¿ÏÎ¬: RFC 8915 Â§4. îˆ€citeîˆ‚turn11search0îˆ

---
## Î£ÎºÎ»Î·ÏÎ¿Ï€Î¿Î¯Î·ÏƒÎ· / ÎšÎ±Î»ÏÏ„ÎµÏÎ·-Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ±-Î ÏÎ±ÎºÏ„Î¹ÎºÎ® (BCP-233 / RFC 8633)

*ÎŸÎ¹ Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î­Ï‚ Î Î¡Î•Î Î•Î™:*

1. ÎÎ± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ **â‰¥ 4** Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„ÎµÏ‚, Ï€Î¿Î¹ÎºÎ¹Î»ÏŒÎ¼Î¿ÏÏ†ÎµÏ‚ Ï€Î·Î³Î­Ï‚ Ï‡ÏÏŒÎ½Î¿Ï… (Î´Î·Î¼ÏŒÏƒÎ¹ÎµÏ‚ Ï€Î¹ÏƒÎ¯Î½ÎµÏ‚, GPS, PTP-Î³Î­Ï†Ï…ÏÎµÏ‚) Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸ÎµÎ¯ Î· Î´Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· Î±Ï€ÏŒ Î¼Î¯Î± Î¼ÏŒÎ½Î¿ Ï€Î·Î³Î®.
2. ÎÎ± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ ``kod`` ÎºÎ±Î¹ ``limited``/``nomodify`` ÏÏƒÏ„Îµ Î¿Î¹ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Î¹ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Î½Î± Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï€Î±ÎºÎ­Ï„Î± Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Ï **Kiss-o'-Death** Î±Î½Ï„Î¯ Î³Î¹Î± Ï€Î»Î®ÏÎµÎ¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚.
3. ÎÎ± Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ½ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… Î´Î±Î¯Î¼Î¿Î½Î± Î³Î¹Î± Î³ÎµÎ³Î¿Î½ÏŒÏ„Î± **panic** Î® ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î²Î·Î¼Î¬Ï„Ï‰Î½ > 1000 s. (Î¥Ï€Î¿Î³ÏÎ±Ï†Î­Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¿ RFC 8633 Â§5.3.)
4. ÎÎ± ÎµÎ¾ÎµÏ„Î¬ÏƒÎ¿Ï…Î½ Ï„Î¿ **leap-smear** Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸Î¿ÏÎ½ Î¿Î¹ Î´Î¹Î±ÎºÎ¿Ï€Î­Ï‚ Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½, Î±Î»Î»Î¬ Î½Î± Î´Î¹Î±ÏƒÏ†Î±Î»Î¯ÏƒÎ¿Ï…Î½ ÏŒÏ„Î¹ *ÏŒÎ»Î¿Î¹* Î¿Î¹ downstream Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î¿ Î¯Î´Î¹Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿ smear.
5. ÎÎ± Î´Î¹Î±Ï„Î·ÏÎ¿ÏÎ½ Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· â‰¤24 h ÏÏƒÏ„Îµ Î½Î± Î¼Î·Î½ Ï‡Î¬Î½Î¿Î½Ï„Î±Î¹ Î¿Î¹ ÏƒÎ·Î¼Î±Î¯ÎµÏ‚ Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½.

Î”ÎµÎ¯Ï„Îµ Ï„Î¿ RFC 8633 Î³Î¹Î± Î¼Î¹Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· Î»Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï…. îˆ€citeîˆ‚turn8search0îˆ‚turn8search1îˆ

---
## Shodan / Censys Dorks
```
port:123 "ntpd"          # Version banner
udp port:123 monlist:true # Censys tag for vulnerable servers
port:4460 "ntske"         # NTS-KE
```
---
## Î§ÏÎ®ÏƒÎ¹Î¼Î± Î•ÏÎ³Î±Î»ÎµÎ¯Î±

| Î•ÏÎ³Î±Î»ÎµÎ¯Î¿ | Î£ÎºÎ¿Ï€ÏŒÏ‚ | Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± |
|------|---------|---------|
| ``ntpwn`` | Wrapper Î³Î¹Î± script-kiddie Î³Î¹Î± Î½Î± ÏˆÎµÎºÎ¬ÏƒÎµÎ¹ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ monlist & peers | ``python ntpwn.py --monlist targets.txt`` |
| **zgrab2 ntp** | ÎœÎ±Î¶Î¹ÎºÎ® ÏƒÎ¬ÏÏ‰ÏƒÎ· / ÎˆÎ¾Î¿Î´Î¿Ï‚ JSON Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ ÏƒÎ·Î¼Î±Î¯Î± monlist | Î”ÎµÎ¯Ï„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÎµÎ½Ï„Î¿Î»Î® |
| ``chronyd`` Î¼Îµ ``allow`` | Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï… NTP server ÏƒÎµ ÎµÏÎ³Î±ÏƒÏ„Î®ÏÎ¹Î¿ pentest | ``chronyd -q 'server 127.127.1.0 iburst'`` |
| ``BetterCap`` | Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Ï€Î±ÎºÎ­Ï„Ï‰Î½ NTP Î³Î¹Î± MITM Î¼Îµ Î¼ÎµÏ„Î±Ï„ÏŒÏ€Î¹ÏƒÎ· Ï‡ÏÏŒÎ½Î¿Ï… ÏƒÎµ Wi-Fi | ``set arp.spoof.targets <victim>; set ntp.time.delta 30s; arp.spoof on`` |

---
## HackTricks Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ Î•Î½Ï„Î¿Î»Î­Ï‚
```
Protocol_Name: NTP
Port_Number: 123
Protocol_Description: Network Time Protocol

Entry_1:
Name: Notes
Description: Notes for NTP
Note: |
The Network Time Protocol (NTP) ensures computers and network devices across variable-latency networks sync their clocks accurately. It's vital for maintaining precise timekeeping in IT operations, security, and logging. NTP's accuracy is essential, but it also poses security risks if not properly managed.

https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-ntp.html

Entry_2:
Name: Nmap
Description: Enumerate NTP
Command: nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p 123 {IP}
```
---
## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

- RFC 8915 â€“ *Network Time Security for the Network Time Protocol* (port 4460) îˆ€citeîˆ‚turn11search0îˆ
- RFC 8633 â€“ *Network Time Protocol BCP* îˆ€citeîˆ‚turn8search0îˆ
- Cloudflare DDoS report 2024 Q4 (5.6 Tbps) îˆ€citeîˆ‚turn5search0îˆ
- Cloudflare *NTP Amplification Attack* article îˆ€citeîˆ‚turn5search1îˆ
- NTP 4.2.8p15 CVE series 2023-04 îˆ€citeîˆ‚turn1search4îˆ
- NVD entries **CVE-2023-26551â€“55**, **CVE-2023-33192** îˆ€citeîˆ‚turn1search1îˆ‚turn1search2îˆ‚turn1search0îˆ‚turn4view0îˆ
- SUSE chrony security update 2024 (chrony 4.5) îˆ€citeîˆ‚turn2search2îˆ
- Khronos/Chronos draft (time-shift mitigation) îˆ€citeîˆ‚turn9search1îˆ
- chronyc manual/examples for remote monitoring îˆ€citeîˆ‚turn3search0îˆ‚turn10search1îˆ
- zgrab2 ntp module docs îˆ€citeîˆ‚turn7search0îˆ
{{#include /banners/hacktricks-training.md}}
