# Ontdekking van CloudFlare

{{#include ../../banners/hacktricks-training.md}}

## Algemene tegnieke om Cloudflare te ontdek

- Jy kan 'n diens gebruik wat jou die **historiese DNS-rekords** van die domein gee. Miskien hardloop die webblad op 'n IP-adres wat voorheen gebruik is.
- Dieselfde kan bereik word deur **historiese SSL-sertifikate te kontroleer** wat na die oorspronklike IP-adres kan wys.
- Kyk ook na **DNS-rekords van ander subdomeine wat direk na IP's wys**, aangesien dit moontlik is dat ander subdomeine na dieselfde bediener wys (miskien vir FTP, mail of enige ander diens).
- As jy 'n **SSRF in die webtoepassing** vind, kan jy dit misbruik om die IP-adres van die bediener te bekom.
- Soek 'n unieke string van die webblad in soekenjins soos shodan (en dalk google en soortgelyke?). Miskien kan jy 'n IP-adres met daardie inhoud vind.
- Op 'n soortgelyke wyse, in plaas daarvan om na 'n unieke string te soek, kan jy vir die favicon-ikoon soek met die hulpmiddel: [https://github.com/karma9874/CloudFlare-IP] of met [https://github.com/pielco11/fav-up]
- Dit sal nie baie gereeld werk nie omdat die bediener dieselfde reaksie moet stuur wanneer dit via die IP-adres bereik word, maar jy weet nooit.

## Gereedskap om Cloudflare te ontdek

- Soek die domein binne [http://www.crimeflare.org:82/cfs.html] of [https://crimeflare.herokuapp.com]. Of gebruik die hulpmiddel [CloudPeler] (wat daardie API gebruik)
- Soek die domein by [https://leaked.site/index.php?resolver/cloudflare.0/]
- [**CF-Hero**](https://github.com/musana/CF-Hero) is 'n omvattende verkenningshulpmiddel wat ontwikkel is om die regte IP-adresse van webtoepassings beskerm deur Cloudflare te ontdek. Dit voer intelligensie-insameling uit uit meervoudige bronne deur verskeie metodes.
- [**CloudFlair**](https://github.com/christophetd/CloudFlair) is 'n hulpmiddel wat Censys-sertifikate sal deursoek wat die domeinnaam bevat, dan sal dit na IPv4-adresse in daardie sertifikate soek en uiteindelik probeer om die webblad by daardie IP's te bereik.
- [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r is 'n kragtige Python-hulpmiddel, noukeurig ontwerp om die werklike IP-adres van webwerwe wat deur Cloudflare en ander alternatiewe beskerm word, bloot te lê. Dit het ten doel om die werklike IP-adres van webbedieners wat agter Cloudflare se beskermingskerm weggesteek is, akkuraat te bepaal.
- [Censys](https://search.censys.io/)
- [Shodan](https://shodan.io/)
- [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
- As jy 'n stel potensiële IP's het waar die webblad gehost kan wees, kan jy [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder) gebruik.
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Opspoor Cloudflare vanaf wolk-infrastruktuur

Let wel: al is dit op AWS-machines gedoen, dit kan op enige ander wolkverskaffer gedoen word.

Vir 'n beter beskrywing van hierdie proses, sien:


{{#ref}}
https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks
{{#endref}}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Omseil Cloudflare deur Cloudflare

### Geverifieerde Origin Pulls

Hierdie meganisme steun op **client** [**SSL certificates**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) **om verbindings te verifieer** tussen **Cloudflare’s reverse-proxy** bedieners en die **origin** bediener, wat **mTLS** genoem word.

In plaas daarvan om hul eie sertifikaat te konfigureer, kan kliënte eenvoudig Cloudflare’s sertifikaat gebruik om enige verbinding vanaf Cloudflare toe te laat, **regardless of the tenant**.

> [!CAUTION]
> Daarom kan 'n aanvaller eenvoudig 'n **domain in Cloudflare using Cloudflare's certificate and point** opstel en dit na die **victim** domein **IP** adres wys. Op hierdie manier, deur sy domain heeltemal onbeskermd te stel, sal Cloudflare nie die gestuurde versoeke beskerm nie.

Meer inligting [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Toelaatlys Cloudflare IP Addresses

Hierdie metode sal **reject connections that do not originate from Cloudflare’s** IP-adresreekse. Dit is ook kwesbaar vir die vorige opstelling waar 'n aanvaller eenvoudig **point his own domain in Cloudflare** na die **victims IP** adres wys en dit aanval.

Meer inligting [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Omseil Cloudflare vir scraping

### Cache

Soms wil jy net Cloudflare omseil om net die webblad te scrape. Daar is 'n paar opsies hiervoor:

- Use Google cache: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
- Use other cache services such as [https://archive.org/web/](https://archive.org/web/)

### Gereedskap

Sommige gereedskap soos die volgende kan Cloudflare se beskerming teen scraping omseil (of kon dit voorheen):

- [https://github.com/sarperavci/CloudflareBypassForScraping](https://github.com/sarperavci/CloudflareBypassForScraping)

### Cloudflare Solvers

Daar is verskeie Cloudflare solvers ontwikkel:

- [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Guide here](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
- [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
- [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
- [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Archived]
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Fortified Headless Browsers <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Gebruik 'n headless browser wat nie as 'n automated browser opgespoor word nie (jy mag dit moet aanpas). Sommige opsies is:

- **Puppeteer:** Die [stealth plugin](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) vir [puppeteer](https://github.com/puppeteer/puppeteer).
- **Playwright:** Die [stealth plugin](https://www.npmjs.com/package/playwright-stealth) kom binnekort na Playwright. Volg ontwikkelinge [here](https://github.com/berstend/puppeteer-extra/issues/454) en [here](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
- **Selenium:** [SeleniumBase](https://github.com/seleniumbase/SeleniumBase) is 'n moderne browser automasie- raamwerk met ingeboude stealth vermoëns. Dit bied twee modusse: **UC Mode**, 'n geoptimaliseerde Selenium ChromeDriver patch gebaseer op [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver), en **CDP Mode**, wat bot-detektering kan omseil, CAPTCHAs kan oplos, en gevorderde metodes van die Chrome DevTools Protocol kan benut.

### Smart Proxy With Cloudflare Built-In Bypass <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Smart proxies** word voortdurend bygewerk deur gespesialiseerde maatskappye, met die doel om Cloudflare se sekuriteitsmaatreëls te omseil (omdat dit hul besigheid is).

Sommige van hulle is:

- [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
- [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
- [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
- [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) is bekend vir hul eiesoortige Cloudflare bypass-meganismes.

Vir diegene wat 'n geoptimaliseerde oplossing soek, staan die [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) uit. Hierdie diens integreer meer as 20 proxy providers in 'n enkele API, kies outomaties die beste en mees koste-effektiewe proxy vir jou teiken-domeine, en bied dus 'n beter opsie om Cloudflare se verdediging te navigeer.

### Reverse Engineer Cloudflare Anti-Bot Protection <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Reverse engineering van Cloudflare se anti-bot maatreëls is 'n taktiek wat deur smart proxy providers gebruik word, geskik vir uitgebreide web scraping sonder die hoë koste om baie headless browsers te bestuur.

**Voordele:** Hierdie metode maak dit moontlik om 'n uiters doeltreffende bypass te skep wat spesifiek op Cloudflare se kontroles mik, ideaal vir grootskaalse operasies.

**Nadele:** Die nadeel is die kompleksiteit van die begrip en misleiding van Cloudflare se doelbewus vae anti-bot stelsel, wat aanhoudende moeite vereis om verskeie strategieë te toets en die bypass op te dateer namate Cloudflare sy beskerming verbeter.

Vind meer inligting oor hoe om dit te doen in die [original article](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).

## Verwysings

- [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

{{#include ../../banners/hacktricks-training.md}}
