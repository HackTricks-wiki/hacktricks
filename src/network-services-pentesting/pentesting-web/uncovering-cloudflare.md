# CloudFlare'ı Ortaya Çıkarmak

{{#include ../../banners/hacktricks-training.md}}

## Cloudflare'ı Ortaya Çıkarmanın Yaygın Yöntemleri

- Domainin **geçmiş DNS kayıtları**nı veren bir servis kullanabilirsiniz. Belki web sayfası daha önce kullanılan bir IP adresinde çalışıyordur.
- Aynı amaç için **geçmiş SSL sertifikalarını kontrol etmek** işe yarayabilir; bunlar origin IP adresine işaret ediyor olabilir.
- Ayrıca **doğrudan IP'lere işaret eden diğer subdomain'lerin DNS kayıtlarını** kontrol edin; diğer subdomain'ler aynı sunucuya işaret ediyor olabilir (ör. FTP, mail veya başka bir servis).
- Eğer web uygulaması içinde bir **SSRF** bulursanız, bunu sunucunun IP adresini elde etmek için kullanabilirsiniz.
- Web sayfasına ait benzersiz bir string'i shodan gibi arama motorlarında (ve belki google ve benzerlerinde) arayın. O içeriğe sahip bir IP adresi bulabilirsiniz.
- Benzer şekilde, benzersiz bir string aramak yerine favicon ikonunu şu araçlarla arayabilirsiniz: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) veya [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up)
- Bu sık sık işe yaramayacaktır çünkü sunucunun IP adresiyle erişildiğinde aynı cevabı göndermesi gerekir, ama asla bilemezsiniz.

## Cloudflare'ı Ortaya Çıkarmak İçin Araçlar

- Domaini [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) veya [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com) içinde arayın. Ya da o API'yi kullanan [CloudPeler](https://github.com/zidansec/CloudPeler) aracını kullanın.
- Domaini [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/) içinde arayın.
- [**CF-Hero**](https://github.com/musana/CF-Hero) Cloudflare tarafından korunan web uygulamalarının gerçek IP adreslerini keşfetmek için geliştirilmiş kapsamlı bir reconnaissance aracıdır. Farklı yöntemlerle çoklu kaynak istihbaratı toplar.
- [**CloudFlair**](https://github.com/christophetd/CloudFlair) domain adını içeren Censys sertifikalarını kullanarak arama yapar, sonra bu sertifikalardaki IPv4'leri arar ve son olarak bu IP'lerdeki web sayfasına erişmeyi dener.
- [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r, Cloudflare ve benzeri servisler tarafından korunan sitelerin gerçek IP adreslerini ortaya çıkarmak için titizlikle hazırlanmış güçlü bir Python aracıdır. Temel amacı, Cloudflare'ın koruyucu kalkanının arkasında gizlenen web sunucularının gerçek IP adresini doğru şekilde tespit etmektir.
- [Censys](https://search.censys.io/)
- [Shodan](https://shodan.io/)
- [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
- Eğer web sayfasının bulunabileceği potansiyel IP'leriniz varsa [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder) kullanabilirsiniz.
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Bulut altyapısından Cloudflare'ı ortaya çıkarma

Bu işlem AWS makineleri için yapılsa bile, herhangi bir başka bulut sağlayıcısı için de yapılabilir.

Bu sürecin daha ayrıntılı açıklaması için şunu inceleyin:


{{#ref}}
https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks
{{#endref}}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Cloudflare üzerinden Cloudflare'ı atlatma

### Authenticated Origin Pulls

Bu mekanizma, **client** [**SSL certificates**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) **ile bağlantıları doğrulamak için** **Cloudflare’ın reverse-proxy** sunucuları ile **origin** sunucu arasındaki bağlantıları kullanır; buna **mTLS** denir.

Kendi sertifikasını yapılandırmak yerine, müşteriler Cloudflare’ın sertifikasını kullanarak Cloudflare'dan gelen herhangi bir bağlantıya izin verebilir, **tenant** ne olursa olsun.

> [!CAUTION]
> Bu nedenle, bir saldırgan **Cloudflare'da bir domain'i Cloudflare'ın sertifikasını kullanarak ayarlayıp** bunu **victim** domaininin **IP** adresine yönlendirebilir. Bu şekilde, domainini tamamen korunmasız bırakarak, Cloudflare gönderilen istekleri korumaz.

More info [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Allowlist Cloudflare IP Addresses

Bu, **Cloudflare’ın** IP adresi aralıklarından gelmeyen bağlantıları reddeder. Bu, saldırganın sadece **kendi domainini Cloudflare'da** **victims IP** adresine yönlendirip saldırması gibi önceki yapılandırmaya da açıktır.

More info [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Cloudflare'ı scraping için atlatma

### Önbellek

Bazen yalnızca web sayfasını scrape etmek için Cloudflare'ı atlamak istersiniz. Bunun için bazı seçenekler:

- Use Google cache: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
- Use other cache services such as [https://archive.org/web/](https://archive.org/web/)

### Araçlar

Aşağıdaki gibi bazı araçlar, Cloudflare'ın scraping korumasını atlayabilir (veya atlayabiliyordu):

- [https://github.com/sarperavci/CloudflareBypassForScraping](https://github.com/sarperavci/CloudflareBypassForScraping)

### Cloudflare Solvers

Bir dizi Cloudflare solver'ı geliştirildi:

- [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Guide here](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
- [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
- [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
- [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Archived]
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Güçlendirilmiş Headless Tarayıcılar <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Otomatik bir tarayıcı olarak tespit edilmeyen bir headless browser kullanın (bunun için özelleştirmeniz gerekebilir). Bazı seçenekler:

- **Puppeteer:** The [stealth plugin](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) for [puppeteer](https://github.com/puppeteer/puppeteer).
- **Playwright:** The [stealth plugin](https://www.npmjs.com/package/playwright-stealth) is coming to Playwright soon. Follow developments [here](https://github.com/berstend/puppeteer-extra/issues/454) and [here](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
- **Selenium:** [SeleniumBase](https://github.com/seleniumbase/SeleniumBase) modern bir browser automation framework olup yerleşik stealth yetenekleri sunar. İki modu vardır: **UC Mode**, [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) temelli optimize edilmiş bir Selenium ChromeDriver yaması ve **CDP Mode**, bot tespitini atlayabilen, CAPTCHA çözebilen ve Chrome DevTools Protocol'den gelişmiş yöntemler kullanabilen bir mod.

### Smart Proxy With Cloudflare Built-In Bypass <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Smart proxies** sürekli olarak uzman şirketler tarafından güncellenir ve amaçları Cloudflare'ın güvenlik önlemlerini aşmaktır (çünkü bu onların işi).

Bazılarından örnekler:

- [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
- [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
- [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
- [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) genellikle kendi özel Cloudflare bypass mekanizmaları ile bilinir.

Optimum bir çözüm arayanlar için, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) öne çıkar. Bu servis 20'den fazla proxy sağlayıcısını tek bir API içinde entegre eder, hedef domainler için en iyi ve maliyet-etkin proxy'yi otomatik olarak seçer ve böylece Cloudflare'ın savunmalarında gezinmek için üstün bir seçenek sunar.

### Cloudflare Anti-Bot Korumasını Tersine Mühendislik ile Çözme <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Cloudflare'ın anti-bot önlemlerini tersine mühendislik ile çözmek, smart proxy sağlayıcıları tarafından kullanılan bir taktiktir ve çok sayıda headless browser çalıştırmanın yüksek maliyetine katlanmadan kapsamlı web scraping için uygundur.

**Avantajları:** Bu yöntem, özellikle Cloudflare'ın kontrollerine yönelik son derece verimli bir bypass oluşturulmasına izin verir; büyük ölçekli operasyonlar için idealdir.

**Dezavantajları:** Dezavantajı, Cloudflare'ın kasıtlı olarak belirsiz bıraktığı anti-bot sistemini anlamak ve aldatmak için gereken karmaşıklıktır; farklı stratejileri test etmek ve Cloudflare korumalarını güçlendirdikçe bypass'ı güncellemek için sürekli çaba gerektirir.

Bunu nasıl yapacağınıza dair daha fazla bilgiyi orijinal makalede bulabilirsiniz: [original article](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).

## Referanslar

- [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

{{#include ../../banners/hacktricks-training.md}}
