# CloudFlare का पता लगाना

{{#include ../../banners/hacktricks-training.md}}

## Cloudflare का पता लगाने के सामान्य तरीके

- आप किसी ऐसी सर्विस का उपयोग कर सकते हैं जो डोमेन के **ऐतिहासिक DNS रिकॉर्ड** देती हो। शायद वेब पेज पहले इस्तेमाल हुए किसी IP address पर चल रहा हो।
- इसी तरह **ऐतिहासिक SSL certificates** की जाँच करके भी यह पता लगाया जा सकता है कि वे origin IP address की ओर इशारा करते हैं।
- अन्य सबडोमेन के **DNS रिकॉर्ड जो सीधे IPs की ओर इशारा करते हैं** भी जाँचें, क्योंकि संभव है कि अन्य सबडोमेन उसी सर्वर की ओर इशारा कर रहे हों (शायद FTP, mail या किसी अन्य सेवा के लिए)।
- यदि आपको वेब एप्लिकेशन के अंदर कोई **SSRF** मिले तो आप इसे दुरुपयोग करके सर्वर का IP address प्राप्त कर सकते हैं।
- वेब पेज की किसी unique string को shodan जैसे search engines में खोजें (और शायद google और समान सेवाओं में भी)। शायद आप उस कंटेंट वाले किसी IP address को ढूंढ लें।
- इसी तरह, unique string की जगह आप favicon icon के लिए खोज कर सकते हैं, उदाहरण के लिए टूल: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) या [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up) के साथ।
- यह अक्सर काम नहीं करेगा क्योंकि सर्वर को IP address से access किए जाने पर वही response भेजना चाहिए, पर कभी-कभी यह संभव हो सकता है।

## Cloudflare का पता लगाने के लिए टूल

- डोमेन को [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) या [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com) में खोजें। या उस API का उपयोग करने वाले टूल [CloudPeler](https://github.com/zidansec/CloudPeler) का उपयोग करें।
- डोमेन को [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/) में खोजें।
- [**CF-Hero**](https://github.com/musana/CF-Hero) एक व्यापक reconnaissance टूल है जो Cloudflare से संरक्षित वेब एप्लिकेशन के वास्तविक IP addresses खोजने के लिए विकसित किया गया है। यह विभिन्न तरीकों के माध्यम से multi-source intelligence gathering करता है।
- [**CloudFlair**](https://github.com/christophetd/CloudFlair) एक टूल है जो Censys certificates का उपयोग करके ऐसे certificates खोजता है जिनमें डोमेन नाम होता है, फिर उन प्रमाणपत्रों में IPv4s की तलाश करता है और अंत में उन IPs पर वेब पेज तक पहुँचने की कोशिश करता है।
- [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r एक शक्तिशाली Python टूल है जिसे विशेष रूप से उन वेबसाइटों का वास्तविक IP address उजागर करने के लिए सावधानीपूर्वक बनाया गया है जिन्हें Cloudflare और अन्य विकल्पों द्वारा सुरक्षित किया गया है। इसका मुख्य उद्देश्य उन वेब सर्वरों का वास्तविक IP address सटीक रूप से पता लगाना है जो Cloudflare की सुरक्षा परत के पीछे छिपे होते हैं।
- [Censys](https://search.censys.io/)
- [Shodan](https://shodan.io/)
- [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
- यदि आपके पास उन संभावित IPs का सेट है जहाँ वेब पेज हो सकता है तो आप [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder) का उपयोग कर सकते हैं।
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## क्लाउड इन्फ्रास्ट्रक्चर से Cloudflare का पता लगाना

ध्यान दें कि भले ही यह AWS मशीनों के लिए किया गया था, इसे किसी अन्य क्लाउड प्रदाता के लिए भी किया जा सकता है।

इस प्रक्रिया के बेहतर विवरण के लिए देखें:


{{#ref}}
https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks
{{#endref}}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Cloudflare के माध्यम से Cloudflare को बायपास करना

### Authenticated Origin Pulls

यह मैकेनिज्म **client** [**SSL certificates**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) पर निर्भर करता है ताकि **Cloudflare’s reverse-proxy** सर्वरों और **origin** सर्वर के बीच कनेक्शनों को प्रमाणीकृत किया जा सके, जिसे **mTLS** कहा जाता है।

अपने स्वयं के certificate को कॉन्फ़िगर करने के बजाय, ग्राहक सरलता से Cloudflare’s certificate का उपयोग कर सकते हैं ताकि Cloudflare से किसी भी कनेक्शन को अनुमति दी जा सके, **regardless of the tenant**।

> [!CAUTION]
> इसलिए, एक attacker बस **domain in Cloudflare using Cloudflare's certificate and point** कर सकता है और उसे **victim** के domain **IP** पते की ओर निर्देशित कर सकता है। इस तरह, अपना domain पूरी तरह असुरक्षित सेट करके, Cloudflare भेजे गए अनुरोधों की रक्षा नहीं करेगा।

More info [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Allowlist Cloudflare IP Addresses

यह उन कनेक्शनों को **reject connections that do not originate from Cloudflare’s** IP address ranges जो Cloudflare के IP रेंज से originate नहीं होते के लिए अस्वीकार करेगा। यह भी उस पिछले सेटअप के लिए कमजोर है जहाँ एक attacker बस अपना **point his own domain in Cloudflare** करके **victims IP** पते की ओर निर्देशित कर देता है और उस पर attack कर देता है।

More info [**here**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## स्क्रैपिंग के लिए Cloudflare को बायपास करें

### Cache

कभी-कभी आप केवल वेब पेज को स्क्रैप करने के लिए Cloudflare को बायपास करना चाहते हैं। इसके कुछ विकल्प हैं:

- Google cache का उपयोग करें: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
- या अन्य cache सेवाओं का उपयोग करें जैसे [https://archive.org/web/](https://archive.org/web/)

### Tools

निम्नलिखित कुछ tools Cloudflare की scraping के खिलाफ सुरक्षा को बायपास कर सकते हैं (या कर चुके हैं):

- [https://github.com/sarperavci/CloudflareBypassForScraping](https://github.com/sarperavci/CloudflareBypassForScraping)

### Cloudflare Solvers

कई Cloudflare solvers विकसित किए गए हैं:

- [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Guide here](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
- [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
- [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
- [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Archived]
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Fortified Headless Browsers <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

ऐसा headless browser उपयोग करें जिसे automated browser के रूप में detect न किया जा सके (इसके लिए आपको इसे customize करने की आवश्यकता पड़ सकती है)। कुछ विकल्प हैं:

- **Puppeteer:** [stealth plugin](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) for [puppeteer](https://github.com/puppeteer/puppeteer)।
- **Playwright:** [stealth plugin](https://www.npmjs.com/package/playwright-stealth) जल्द ही Playwright में आ रहा है। developments को यहाँ और यहाँ फॉलो करें।
- **Selenium:** [SeleniumBase](https://github.com/seleniumbase/SeleniumBase) एक आधुनिक browser automation framework है जिसमें built-in stealth क्षमताएँ हैं। यह दो मोड ऑफर करता है: **UC Mode**, एक optimized Selenium ChromeDriver पैच जो [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) पर आधारित है, और **CDP Mode**, जो bot detection बायपास कर सकता है, CAPTCHAs सॉल्व कर सकता है, और Chrome DevTools Protocol की advanced विधियों का लाभ उठा सकता है।

### Smart Proxy With Cloudflare Built-In Bypass <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Smart proxies** को specialized कंपनियों द्वारा लगातार अपडेट किया जाता है, जिनका उद्देश्य Cloudflare की security measures को मात देना होता है (क्योंकि यही उनका व्यवसाय है)।

इनमें से कुछ हैं:

- [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
- [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
- [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
- [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) जिनके proprietary Cloudflare bypass mechanisms के लिए नोट किया गया है।

एक optimized समाधान की तलाश करने वालों के लिए, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) उल्लेखनीय है। यह सर्विस 20+ proxy प्रदाताओं को एक single API में इंटीग्रेट करती है, अपने आप लक्ष्य डोमेन्स के लिए सबसे अच्छा और सबसे किफायती proxy चुनती है, और इस तरह Cloudflare की रक्षा से नेविगेट करने के लिए बेहतर विकल्प प्रदान करती है।

### Reverse Engineer Cloudflare Anti-Bot Protection <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Cloudflare की anti-bot measures का Reverse engineering एक tactic है जिसे smart proxy providers उपयोग करते हैं; यह बड़े पैमाने पर web scraping के लिए उपयुक्त है बिना कई headless browsers चलाने की उच्च लागत के।

**लाभ:** यह विधि Cloudflare के checks को लक्षित करने वाला एक अत्यंत कुशल bypass बनाने की अनुमति देती है, जो बड़े पैमाने के ऑपरेशनों के लिए आदर्श है।

**हानियाँ:** कमी यह है कि Cloudflare की जानबूझकर अस्पष्ट anti-bot प्रणाली को समझना और उसे धोखा देना जटिल है, जिसके लिए विभिन्न रणनीतियों का परीक्षण करने और Cloudflare द्वारा सुरक्षा बढ़ाने पर bypass को लगातार अपडेट करने का प्रयास आवश्यक होता है।

Find more info about how to do this in the [original article](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).

## References

- [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

{{#include ../../banners/hacktricks-training.md}}
