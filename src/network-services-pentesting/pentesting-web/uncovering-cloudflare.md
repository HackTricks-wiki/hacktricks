# Uncovering CloudFlare

{{#include ../../banners/hacktricks-training.md}}

## Common Techniques to Uncover Cloudflare

- Unaweza kutumia huduma fulani inayokupa **rekodi za kihistoria za DNS** za domain. Huenda ukurasa wa wavuti unatumia anwani ya IP iliyotumika hapo awali.
- Vivyo hivyo, inaweza kupatikana **kuangalia vyeti vya SSL vya kihistoria** ambavyo vinaweza kuelekeza kwenye anwani ya IP ya asili.
- Angalia pia **rekodi za DNS za subdomains nyingine zinazotaja moja kwa moja kwenye IPs**, kwani inawezekana subdomains nyingine zinaelekeza kwenye seva ile ile (huenda kutoa FTP, barua au huduma nyingine yoyote).
- Ikiwa unapata **SSRF ndani ya programu ya wavuti** unaweza kuitumia vibaya ili kupata anwani ya IP ya seva.
- Tafuta mfuatano wa kipekee wa ukurasa wa wavuti kwenye vivinjari kama shodan (na huenda google na mengineyo?). Huenda ukapata anwani ya IP yenye maudhui hayo.
- Kwa njia sawa badala ya kutafuta mfuatano wa kipekee unaweza kutafuta ikoni ya favicon kwa kutumia zana: [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) au kwa [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up)
- Hii haitafanya kazi mara nyingi kwa sababu seva inapaswa kutuma jibu sawa inapofikiwa kwa anwani ya IP, lakini hujui kamwe.

## Tools to uncover Cloudflare

- Tafuta domain ndani ya [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) au [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com). Au tumia zana [CloudPeler](https://github.com/zidansec/CloudPeler) (ambayo inatumia API hiyo)
- Tafuta domain katika [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/)
- [**CloudFlair**](https://github.com/christophetd/CloudFlair) ni zana ambayo itatafuta kwa kutumia vyeti vya Censys vinavyoshikilia jina la domain, kisha itatafuta IPv4s ndani ya vyeti hivyo na hatimaye itajaribu kufikia ukurasa wa wavuti katika IP hizo.
- [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r ni zana yenye nguvu ya Python iliyoundwa kwa makini ili kufichua anwani halisi ya IP ya tovuti zilizohifadhiwa na Cloudflare na mbadala zingine, huduma inayotumika sana ya usalama wa wavuti na kuboresha utendaji. Lengo lake kuu ni kutambua kwa usahihi anwani halisi ya IP ya seva za wavuti ambazo zimefichwa nyuma ya kinga ya Cloudflare.
- [Censys](https://search.censys.io/)
- [Shodan](https://shodan.io/)
- [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
- Ikiwa una seti ya IP zinazowezekana ambapo ukurasa wa wavuti unapatikana unaweza kutumia [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder)
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Kufichua Cloudflare kutoka kwa Miundombinu ya Wingu

Kumbuka kwamba hata kama hii ilifanywa kwa mashine za AWS, inaweza kufanywa kwa mtoa huduma mwingine yeyote wa wingu.

Kwa maelezo bora ya mchakato huu angalia: 

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Kupita Cloudflare kupitia Cloudflare

### Mvuto wa Asili Uliothibitishwa

Mekanism hii inategemea **mteja** [**vyeti vya SSL**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) **kuhakiki muunganisho** kati ya **seva za reverse-proxy za Cloudflare** na seva ya **asili**, ambayo inaitwa **mTLS**.

Badala ya kusanidi cheti chake mwenyewe, wateja wanaweza kutumia cheti cha Cloudflare kuruhusu muunganisho wowote kutoka Cloudflare, **bila kujali mpangaji**.

> [!CAUTION]
> Hivyo, mshambuliaji anaweza kuweka tu **domain katika Cloudflare akitumia cheti cha Cloudflare na kuelekeza** kwa anwani ya **IP** ya **mwathirika**. Kwa njia hii, kuweka domain yake bila ulinzi, Cloudflare haitalinda maombi yaliyotumwa.

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Ruhusu Anwani za IP za Cloudflare

Hii itakataa **muunganisho ambao haujatoka katika** anuwai za anwani za IP za Cloudflare. Hii pia ina hatari kwa mipangilio ya awali ambapo mshambuliaji anaweza tu **kuelekeza domain yake mwenyewe katika Cloudflare** kwa anwani ya **IP** ya wahanga na kuishambulia.

Maelezo zaidi [**hapa**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Kupita Cloudflare kwa ajili ya kuchora

### Kache

Wakati mwingine unataka tu kupita Cloudflare ili kuchora ukurasa wa wavuti. Kuna chaguzi kadhaa kwa hili:

- Tumia kache ya Google: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
- Tumia huduma nyingine za kache kama [https://archive.org/web/](https://archive.org/web/)

### Zana

Zana zingine kama hizi zinaweza kupita (au zilikuwa na uwezo wa kupita) ulinzi wa Cloudflare dhidi ya kuchora:

- [https://github.com/sarperavci/CloudflareBypassForScraping](https://github.com/sarperavci/CloudflareBypassForScraping)

### Wasaidizi wa Cloudflare

Kumekuwa na idadi ya wasaidizi wa Cloudflare waliotengenezwa:

- [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
- [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Mwongozo hapa](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
- [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
- [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
- [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Archived]
- [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Vivinjari vya Kichwa vya Fortified <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Tumia kivinjari kisicho na kichwa ambacho hakigunduliwi kama kivinjari cha kiotomatiki (huenda ukahitaji kukiboresha kwa hilo). Chaguzi zingine ni:

- **Puppeteer:** Plugin ya [stealth](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth) kwa [puppeteer](https://github.com/puppeteer/puppeteer).
- **Playwright:** Plugin ya [stealth](https://www.npmjs.com/package/playwright-stealth) inakuja kwa Playwright hivi karibuni. Fuata maendeleo [hapa](https://github.com/berstend/puppeteer-extra/issues/454) na [hapa](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra).
- **Selenium:** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) ni patch iliyoboreshwa ya Selenium Chromedriver.

### Proxy ya Smart Pamoja na Kupita kwa Cloudflare <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Proxy za Smart** zinasasishwa mara kwa mara na kampuni maalum, zikilenga kuzidi hatua za usalama za Cloudflare (kama hiyo ni biashara yao).

Baadhi yao ni:

- [ScraperAPI](https://www.scraperapi.com/?fp_ref=scrapeops)
- [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
- [Oxylabs](https://oxylabs.go2cloud.org/aff_c?offer_id=7&aff_id=379&url_id=32)
- [Smartproxy](https://prf.hn/click/camref:1100loxdG/[p_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) wanajulikana kwa mifumo yao ya kupita ya Cloudflare.

Kwa wale wanaotafuta suluhisho lililoboreshwa, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) inajitokeza. Huduma hii inajumuisha zaidi ya watoa huduma 20 wa proxy katika API moja, ikichagua kiotomatiki proxy bora na yenye gharama nafuu kwa maeneo yako ya lengo, hivyo kutoa chaguo bora kwa kuzunguka ulinzi wa Cloudflare.

### Uhandisi wa Kinyume wa Ulinzi wa Cloudflare Dhidi ya Bots <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Uhandisi wa kinyume wa hatua za Cloudflare dhidi ya bots ni mbinu inayotumiwa na watoa huduma wa proxy smart, inayofaa kwa kuchora wavuti kwa wingi bila gharama kubwa ya kuendesha vivinjari vingi visivyo na kichwa.

**Faida:** Njia hii inaruhusu kuunda kupita kwa ufanisi mkubwa ambayo inazingatia hasa ukaguzi wa Cloudflare, bora kwa operesheni kubwa.

**Hasara:** Upande mbaya ni ugumu wa kuelewa na kudanganya mfumo wa Cloudflare wa kupambana na bots ambao umefichwa kwa makusudi, ukihitaji juhudi endelevu kujaribu mikakati tofauti na kuboresha kupita kadri Cloudflare inavyoboresha ulinzi wake.

Pata maelezo zaidi kuhusu jinsi ya kufanya hivi katika [makala asilia](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/).

## Marejeleo

- [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

{{#include ../../banners/hacktricks-training.md}}
