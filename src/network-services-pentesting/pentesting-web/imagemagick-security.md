# ImageMagick Güvenliği

{{#include ../../banners/hacktricks-training.md}}

Daha fazla detay için [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html) adresini kontrol edin.

ImageMagick, çok yönlü bir görüntü işleme kütüphanesi olarak, geniş seçenekleri ve ayrıntılı çevrimiçi belgelerin eksikliği nedeniyle güvenlik politikasını yapılandırmada zorluklar sunmaktadır. Kullanıcılar genellikle parçalı internet kaynaklarına dayanarak politikalar oluşturur, bu da potansiyel yanlış yapılandırmalara yol açar. Kütüphane, her biri karmaşıklığına ve güvenlik açığı profilini etkileyen 100'den fazla görüntü formatını desteklemektedir; bu durum tarihsel güvenlik olaylarıyla gösterilmiştir.

## Daha Güvenli Politikalar İçin

Bu zorlukları ele almak için, ImageMagick'in güvenlik politikalarını tasarlamaya ve denetlemeye yardımcı olmak amacıyla bir [araç geliştirilmiştir](https://imagemagick-secevaluator.doyensec.com/). Bu araç, kapsamlı araştırmalara dayanmaktadır ve politikaların yalnızca sağlam değil, aynı zamanda istismar edilebilecek boşluklardan da arındırılmış olmasını sağlamayı hedeflemektedir.

## İzin Listesi vs. Yasak Listesi Yaklaşımı

Tarihsel olarak, ImageMagick politikaları yasak listesi yaklaşımına dayanıyordu; burada belirli kodlayıcılara erişim engelleniyordu. Ancak, ImageMagick 6.9.7-7'deki değişiklikler bu paradigmayı değiştirdi ve izin listesi yaklaşımını mümkün kıldı. Bu yaklaşım, önce tüm kodlayıcıları reddeder ve ardından güvenilir olanlara seçici olarak erişim izni vererek güvenlik duruşunu güçlendirir.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Politikalardaki Büyük/Küçük Harf Duyarlılığı

ImageMagick'teki politika desenlerinin büyük/küçük harf duyarlı olduğunu belirtmek önemlidir. Bu nedenle, kodlayıcıların ve modüllerin politikalar içinde doğru bir şekilde büyük harfle yazıldığından emin olmak, istenmeyen izinleri önlemek için hayati öneme sahiptir.

## Kaynak Sınırlamaları

ImageMagick, düzgün yapılandırılmadığında hizmet reddi saldırılarına karşı hassastır. Bu tür zayıflıkları önlemek için politikada açık kaynak sınırlamaları belirlemek esastır.

## Politika Parçalanması

Politikalar, farklı ImageMagick kurulumları arasında parçalanmış olabilir ve bu da potansiyel çakışmalara veya geçersiz kılmalara yol açabilir. Aktif politika dosyalarını bulmak ve doğrulamak için şu komutlar gibi komutlar kullanılması önerilir:
```shell
$ find / -iname policy.xml
```
## Başlangıç, Kısıtlayıcı Politika

Kısıtlayıcı bir politika şablonu, sıkı kaynak sınırlamaları ve erişim kontrollerine odaklanarak önerilmiştir. Bu şablon, belirli uygulama gereksinimleriyle uyumlu özel politikaların geliştirilmesi için bir temel olarak hizmet eder.

Bir güvenlik politikasının etkinliği, ImageMagick'te `identify -list policy` komutu kullanılarak doğrulanabilir. Ayrıca, daha önce bahsedilen [değerlendirici aracı](https://imagemagick-secevaluator.doyensec.com/) bireysel ihtiyaçlara göre politikayı geliştirmek için kullanılabilir.

## Referanslar

- [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html\*\*](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

{{#include ../../banners/hacktricks-training.md}}
