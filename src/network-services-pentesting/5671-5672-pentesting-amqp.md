# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

Van [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** is 'n **boodskap-rygprogram** ook bekend as 'n _boodskap broker_ of _ry bestuurder._ Eenvoudig gestel; dit is sagteware waar rye gedefinieer word, waaraan toepassings koppel om 'n boodskap of boodskappe oor te dra.\
> 'n **Boodskap kan enige soort inligting insluit**. Dit kan byvoorbeeld inligting bevat oor 'n proses of taak wat op 'n ander toepassing (wat selfs op 'n ander bediener kan wees) moet begin, of dit kan net 'n eenvoudige teksboodskap wees. Die ry-bestuurder sagteware stoor die boodskappe totdat 'n ontvangende toepassing koppel en 'n boodskap van die ry neem. Die ontvangende toepassing verwerk dan die boodskap.\
> Definisie van .

**Standaard poort**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Opname

### Handmatig
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Outomaties
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info <IP>

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Ander RabbitMQ poorte

In [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) kan jy vind dat **rabbitmq verskeie poorte gebruik**:

- **1883, 8883**: ([MQTT kliënte](http://mqtt.org) sonder en met TLS, as die [MQTT plugin](https://www.rabbitmq.com/mqtt.html) geaktiveer is. [**Leer meer oor hoe om MQTT hier te pentest**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, 'n peer discovery diens wat deur RabbitMQ nodes en CLI gereedskap gebruik word. [**Leer meer oor hoe om hierdie diens hier te pentest**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: gebruik deur AMQP 0-9-1 en 1.0 kliënte sonder en met TLS
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) kliënte, [bestuurs UI](https://www.rabbitmq.com/management.html) en [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (slegs as die [bestuurs plugin](https://www.rabbitmq.com/management.html) geaktiveer is). [**Leer meer oor hoe om hierdie diens hier te pentest**](15672-pentesting-rabbitmq-management.md).
- 15674: STOMP-over-WebSockets kliënte (slegs as die [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html) geaktiveer is)
- 15675: MQTT-over-WebSockets kliënte (slegs as die [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html) geaktiveer is)
- 15692: Prometheus metrieke (slegs as die [Prometheus plugin](https://www.rabbitmq.com/prometheus.html) geaktiveer is)
- 25672: gebruik vir inter-node en CLI gereedskap kommunikasie (Erlang verspreidingsbediener poort) en word toegeken uit 'n dinamiese reeks (beperk tot 'n enkele poort per standaard, bereken as AMQP poort + 20000). Tensy eksterne verbindings op hierdie poorte werklik nodig is (bv. die kluster gebruik [federasie](https://www.rabbitmq.com/federation.html) of CLI gereedskap word op masjiene buite die subnet gebruik), moet hierdie poorte nie publiek blootgestel word nie. Sien [netwerk gids](https://www.rabbitmq.com/networking.html) vir besonderhede. **Slegs 9 van hierdie poorte is op die internet geopen**.
- 35672-35682: gebruik deur CLI gereedskap (Erlang verspreidingskliënt poorte) vir kommunikasie met nodes en word toegeken uit 'n dinamiese reeks (bereken as bediener verspreidingspoort + 10000 deur bediener verspreidingspoort + 10010). Sien [netwerk gids](https://www.rabbitmq.com/networking.html) vir besonderhede.
- 61613, 61614: [STOMP kliënte](https://stomp.github.io/stomp-specification-1.2.html) sonder en met TLS (slegs as die [STOMP plugin](https://www.rabbitmq.com/stomp.html) geaktiveer is). Minder as 10 toestelle met hierdie poort oop en meestal UDP vir DHT nodes.

## Shodan

- `AMQP`

{{#include ../banners/hacktricks-training.md}}
