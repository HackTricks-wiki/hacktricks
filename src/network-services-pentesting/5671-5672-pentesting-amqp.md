# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## 기본 정보

출처: [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ**는 _메시지 브로커_ 또는 _큐 매니저_로도 알려진 **메시지 큐잉 소프트웨어**입니다. 간단히 말해; 큐가 정의되는 소프트웨어로, 애플리케이션들이 메시지를 전송하기 위해 연결합니다.\
> **메시지는 어떤 종류의 정보든 포함할 수 있습니다**. 예를 들어, 다른 애플리케이션(심지어 다른 서버에 있을 수도 있음)에서 시작해야 하는 프로세스나 작업에 대한 정보를 담을 수 있고, 단순한 텍스트 메시지일 수도 있습니다. 큐 매니저 소프트웨어는 수신 애플리케이션이 연결되어 큐에서 메시지를 가져갈 때까지 메시지를 저장합니다. 수신 애플리케이션이 그 메시지를 처리합니다.\
> 정의 출처: .

**Default port**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## 열거

### 수동
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="IP", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### 자동
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info IP

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Other RabbitMQ ports

In [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) you can find that **rabbitmq uses several ports**:

- **1883, 8883**: ([MQTT clients](http://mqtt.org) — TLS 비암호화 및 TLS 암호화 연결, [MQTT plugin](https://www.rabbitmq.com/mqtt.html)이 활성화된 경우. [**MQTT를 pentest하는 방법에 대해 자세히 알아보기**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, RabbitMQ 노드와 CLI 도구에서 사용하는 피어 검색 서비스. [**이 서비스를 pentest하는 방법에 대해 자세히 알아보기**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: AMQP 0-9-1 및 1.0 클라이언트의 TLS 미사용/사용 연결에 사용됨
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) 클라이언트, [management UI](https://www.rabbitmq.com/management.html) 및 [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (단, [management plugin](https://www.rabbitmq.com/management.html)이 활성화된 경우에만). [**이 서비스를 pentest하는 방법에 대해 자세히 알아보기**](15672-pentesting-rabbitmq-management.md).
- 15674: STOMP-over-WebSockets 클라이언트 (단, [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html)이 활성화된 경우에만)
- 15675: MQTT-over-WebSockets 클라이언트 (단, [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html)이 활성화된 경우에만)
- 15692: Prometheus metrics (단, [Prometheus plugin](https://www.rabbitmq.com/prometheus.html)이 활성화된 경우에만)
- 25672: 노드 간 및 CLI 도구 통신에 사용되는 포트(Erlang distribution server port)로 동적 범위에서 할당됨(기본적으로 단일 포트로 제한되며 AMQP 포트 + 20000으로 계산). 이러한 포트에 대한 외부 연결이 정말로 필요한 경우(예: 클러스터가 [federation](https://www.rabbitmq.com/federation.html)을 사용하거나 서브넷 외부 머신에서 CLI 도구를 사용하는 경우)가 아니라면, 이 포트들은 공개적으로 노출되어서는 안 됩니다. 자세한 내용은 [networking guide](https://www.rabbitmq.com/networking.html)를 참조하세요. **이 포트들 중 인터넷에 열린 포트는 9개뿐입니다**.
- 35672-35682: CLI 도구가 노드와 통신하기 위해 사용하는 포트(Erlang distribution client ports)로 동적 범위에서 할당됨(서버 distribution 포트 + 10000 ~ 서버 distribution 포트 + 10010으로 계산). 자세한 내용은 [networking guide](https://www.rabbitmq.com/networking.html)를 참조하세요.
- 61613, 61614: [STOMP clients](https://stomp.github.io/stomp-specification-1.2.html) TLS 비사용/사용 연결 (단, [STOMP plugin](https://www.rabbitmq.com/stomp.html)이 활성화된 경우에만). 이 포트가 열린 장치는 10대 미만이며 대부분 DHT 노드를 위한 UDP입니다.

## See also

{{#ref}}
4222-pentesting-nats.md
{{#endref}}

## Shodan

- `AMQP`

## References

- [CloudAMQP – RabbitMQ for beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
- [RabbitMQ Networking Guide](https://www.rabbitmq.com/networking.html)

{{#include ../banners/hacktricks-training.md}}
