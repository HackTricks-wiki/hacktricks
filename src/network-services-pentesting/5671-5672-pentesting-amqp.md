# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

Van [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** is a **sagteware vir boodskap-waglyste** ook bekend as 'n _message broker_ of _queue manager._ Eenvoudig gestel; dit is sagteware waar waglyste gedefinieer word, waarna toepassings koppel om 'n boodskap of boodskappe oor te dra.\\
> **A message can include any kind of information**. Dit kan byvoorbeeld inligting hê oor 'n proses of taak wat op 'n ander toepassing moet begin (wat selfs op 'n ander bediener kan wees), of dit kan net 'n eenvoudige teksboodskap wees. Die waglys-bestuurder-sagteware stoor die boodskappe totdat 'n ontvangende toepassing koppel en 'n boodskap van die waglys af neem. Die ontvangende toepassing verwerk dan die boodskap.\\
> Definisie van .

**Standaard poort**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Enumerasie

### Handmatig
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="IP", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Outomaties
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info IP

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Ander RabbitMQ-poorte

In [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) kan jy vind dat **rabbitmq verskeie poorte gebruik**:

- **1883, 8883**: ([MQTT clients](http://mqtt.org) sonder en met TLS, indien die [MQTT plugin](https://www.rabbitmq.com/mqtt.html) geaktiveer is. [**Learn more about how to pentest MQTT here**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, ’n peer-ontdekkingsdiens wat deur RabbitMQ-node en CLI tools gebruik word. [**Learn more about how to pentest this service here**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: gebruik deur AMQP 0-9-1 en 1.0 kliënte sonder en met TLS
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) clients, [management UI](https://www.rabbitmq.com/management.html) and [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (slegs as die [management plugin](https://www.rabbitmq.com/management.html) geaktiveer is). [**Learn more about how to pentest this service here**](15672-pentesting-rabbitmq-management.md).
- 15674: STOMP-over-WebSockets clients (slegs as die [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html) geaktiveer is)
- 15675: MQTT-over-WebSockets clients (slegs as die [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html) geaktiveer is)
- 15692: Prometheus metrics (slegs as die [Prometheus plugin](https://www.rabbitmq.com/prometheus.html) geaktiveer is)
- 25672: word gebruik vir inter-node en CLI tools kommunikasie (Erlang distribution server port) en word uit ’n dinamiese reeks toegewys (beperk tot ’n enkele poort standaard, bereken as AMQP port + 20000). Tensy eksterne verbindings op hierdie poorte regtig nodig is (bv. die cluster gebruik [federation](https://www.rabbitmq.com/federation.html) of CLI tools word op masjiene buite die subnet gebruik), moet hierdie poorte nie publieklik blootgestel word nie. Sien [networking guide](https://www.rabbitmq.com/networking.html) vir besonderhede. **Net 9 van hierdie poorte is oop op die internet**.
- 35672-35682: word deur CLI tools gebruik (Erlang distribution client ports) vir kommunikasie met node en word uit ’n dinamiese reeks toegewys (bereken as server distribution port + 10000 tot server distribution port + 10010). Sien [networking guide](https://www.rabbitmq.com/networking.html) vir besonderhede.
- 61613, 61614: [STOMP clients](https://stomp.github.io/stomp-specification-1.2.html) sonder en met TLS (slegs as die [STOMP plugin](https://www.rabbitmq.com/stomp.html) geaktiveer is). Minder as 10 toestelle met hierdie poort oop en meeste is UDP vir DHT nodes.

## Sien ook

{{#ref}}
4222-pentesting-nats.md
{{#endref}}

## Shodan

- `AMQP`

## Verwysings

- [CloudAMQP – RabbitMQ for beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
- [RabbitMQ Networking Guide](https://www.rabbitmq.com/networking.html)

{{#include ../banners/hacktricks-training.md}}
