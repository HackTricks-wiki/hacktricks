# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## Podstawowe informacje

Z [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** to **oprogramowanie do kolejkowania wiadomości** zwane także _brokerem wiadomości_ lub _menedżerem kolejek_. Mówiąc prosto; to oprogramowanie, w którym definiuje się kolejki, do których aplikacje łączą się, aby przesłać wiadomość lub wiadomości.\
> **Wiadomość może zawierać dowolny rodzaj informacji**. Może na przykład zawierać informacje o procesie lub zadaniu, które powinno się uruchomić w innej aplikacji (która może znajdować się nawet na innym serwerze), albo może to być po prostu zwykła wiadomość tekstowa. Oprogramowanie zarządzające kolejkami przechowuje wiadomości, aż aplikacja odbierająca połączy się i pobierze wiadomość z kolejki. Następnie aplikacja odbierająca przetwarza wiadomość.\
> Definicja z .

**Domyślny port**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Enumeracja

### Ręczne
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="IP", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Automatyczny
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info IP

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Inne porty RabbitMQ

W [https://www.rabbitmq.com/networking.html] możesz znaleźć informację, że **rabbitmq używa kilku portów**:

- **1883, 8883**: ([MQTT clients](http://mqtt.org) bez i z TLS, jeśli włączony jest [MQTT plugin](https://www.rabbitmq.com/mqtt.html). [**Learn more about how to pentest MQTT here**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, usługa odkrywania węzłów używana przez węzły RabbitMQ i narzędzia CLI. [**Learn more about how to pentest this service here**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: używane przez klientów AMQP 0-9-1 i 1.0 bez i z TLS
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) clients, [management UI](https://www.rabbitmq.com/management.html) oraz [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (tylko jeśli włączony jest [management plugin](https://www.rabbitmq.com/management.html)). [**Learn more about how to pentest this service here**](15672-pentesting-rabbitmq-management.md).
- 15674: STOMP-over-WebSockets clients (tylko jeśli włączony jest [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html))
- 15675: MQTT-over-WebSockets clients (tylko jeśli włączony jest [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html))
- 15692: Prometheus metrics (tylko jeśli włączony jest [Prometheus plugin](https://www.rabbitmq.com/prometheus.html))
- 25672: używany do komunikacji między węzłami i narzędzi CLI (port serwera dystrybucji Erlang) i przydzielany z zakresu dynamicznego (ograniczony domyślnie do pojedynczego portu, obliczanego jako AMQP port + 20000). O ile połączenia zewnętrzne na tych portach nie są naprawdę niezbędne (np. klaster używa [federation] lub narzędzia CLI są używane na maszynach poza podsiecią), te porty nie powinny być publicznie wystawione. Zobacz [networking guide] dla szczegółów. **Tylko 9 z tych portów jest otwartych w Internecie**.
- 35672-35682: używane przez narzędzia CLI (Erlang distribution client ports) do komunikacji z węzłami i przydzielane z zakresu dynamicznego (obliczane jako server distribution port + 10000 do server distribution port + 10010). Zobacz [networking guide] dla szczegółów.
- 61613, 61614: [STOMP clients] bez i z TLS (tylko jeśli włączony jest [STOMP plugin](https://www.rabbitmq.com/stomp.html)). Mniej niż 10 urządzeń ma ten port otwarty i głównie UDP dla węzłów DHT.

## Zobacz także

{{#ref}}
4222-pentesting-nats.md
{{#endref}}

## Shodan

- `AMQP`

## References

- [CloudAMQP – RabbitMQ for beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
- [RabbitMQ Networking Guide](https://www.rabbitmq.com/networking.html)

{{#include ../banners/hacktricks-training.md}}
