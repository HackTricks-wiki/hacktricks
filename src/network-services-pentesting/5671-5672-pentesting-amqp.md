# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## Taarifa za Msingi

Kutoka kwa [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** ni programu ya **kuorodhesha ujumbe** inayojulikana pia kama _wakala wa ujumbe_ au _msimamizi wa foleni._ Kwa kifupi; ni programu ambapo foleni zinafafanuliwa, ambazo maombi huunganisha ili kuhamisha ujumbe au ujumbe kadhaa.\
> **Ujumbe unaweza kujumuisha aina yoyote ya taarifa**. Kwa mfano, unaweza kuwa na taarifa kuhusu mchakato au kazi ambayo inapaswa kuanzishwa kwenye programu nyingine (ambayo inaweza hata kuwa kwenye seva nyingine), au inaweza kuwa ujumbe mfupi tu wa maandishi. Programu ya msimamizi wa foleni huhifadhi ujumbe hadi programu mpokeaji iunganishe na ichukue ujumbe kutoka kwenye foleni. Programu mpokeaji kisha inachakata ujumbe huo.\
> Ufafanuzi kutoka .

**Bandari ya chaguo-msingi**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Uorodheshaji

### Kwa mkono
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="IP", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Otomatiki
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info IP

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Bandari nyingine za RabbitMQ

In [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) you can find that **rabbitmq uses several ports**:

- **1883, 8883**: ([MQTT clients](http://mqtt.org) bila TLS na kwa TLS, if the [MQTT plugin](https://www.rabbitmq.com/mqtt.html) is enabled. [**Learn more about how to pentest MQTT here**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, huduma ya kugundua wenzao inayotumika na nodes za RabbitMQ na zana za CLI. [**Learn more about how to pentest this service here**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: zinatumiwa na wateja wa AMQP 0-9-1 na 1.0 bila TLS na kwa TLS
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) wateja, [management UI](https://www.rabbitmq.com/management.html) na [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (tu ikiwa [management plugin](https://www.rabbitmq.com/management.html) imewezeshwa). [**Learn more about how to pentest this service here**](15672-pentesting-rabbitmq-management.md).
- 15674: wateja wa STOMP-over-WebSockets (tu ikiwa [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html) imewezeshwa)
- 15675: wateja wa MQTT-over-WebSockets (tu ikiwa [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html) imewezeshwa)
- 15692: metriksi za Prometheus (tu ikiwa [Prometheus plugin](https://www.rabbitmq.com/prometheus.html) imewezeshwa)
- 25672: inatumiwa kwa mawasiliano kati ya node na zana za CLI (Erlang distribution server port) na inateguliwa kutoka kwa safu ya dynamic (imepunguzwa kwa port moja kwa default, inahesabiwa kama AMQP port + 20000). Isipokuwa uhusiano wa nje kwenye bandari hizi ni muhimu kweli (kwa mfano cluster inatumia [federation](https://www.rabbitmq.com/federation.html) au zana za CLI zinatumika kwenye mashine nje ya subnet), bandari hizi hazipaswi kufunguliwa kwa umma. See [networking guide](https://www.rabbitmq.com/networking.html) for details. **Only 9 of these ports opened on the internet**.
- 35672-35682: zinatumiwa na zana za CLI (Erlang distribution client ports) kwa mawasiliano na nodes na zimetengwa kutoka kwa safu ya dynamic (inahesabiwa kama server distribution port + 10000 hadi server distribution port + 10010). See [networking guide](https://www.rabbitmq.com/networking.html) for details.
- 61613, 61614: [STOMP clients](https://stomp.github.io/stomp-specification-1.2.html) bila TLS na kwa TLS (tu ikiwa [STOMP plugin](https://www.rabbitmq.com/stomp.html) imewezeshwa). Vifaa visivyozidi 10 vina bandari hii wazi na kwa kawaida UDP kwa nodes za DHT.

## Angalia pia

{{#ref}}
4222-pentesting-nats.md
{{#endref}}

## Shodan

- `AMQP`

## Marejeo

- [CloudAMQP â€“ RabbitMQ for beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
- [RabbitMQ Networking Guide](https://www.rabbitmq.com/networking.html)

{{#include ../banners/hacktricks-training.md}}
