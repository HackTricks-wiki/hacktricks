# 5671,5672 - Pentesting AMQP

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgi

Kaynak: [cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html):

> **RabbitMQ** bir **mesaj kuyruğu yazılımı** olup, _message broker_ veya _queue manager_ olarak da bilinir. Basitçe söylemek gerekirse; kuyrukların tanımlandığı, uygulamaların bağlanıp bir veya daha fazla mesaj aktarmak için kullandığı bir yazılımdır.\
> Bir **mesaj herhangi bir tür bilgi içerebilir**. Örneğin, başka bir uygulamada (hatta başka bir sunucuda) başlaması gereken bir süreç veya görevle ilgili bilgi içerebilir ya da basit bir metin mesajı olabilir. Kuyruk-yönetici yazılımı mesajları, bir alıcı uygulama bağlanıp kuyruktan bir mesaj aldığında işlemeye hazır olacak şekilde saklar. Alıcı uygulama daha sonra mesajı işler.\
> Definition from .

**Varsayılan port**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## Enumeration

### Manuel
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="IP", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### Otomatik
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info IP

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### Brute Force

- [**AMQP Protocol Brute-Force**](../generic-hacking/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
- [**STOMP Protocol Brute-Force**](../generic-hacking/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## Diğer RabbitMQ portları

In [https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) you can find that **rabbitmq uses several ports**:

- **1883, 8883**: ([MQTT clients](http://mqtt.org) without and with TLS, if the [MQTT plugin](https://www.rabbitmq.com/mqtt.html) is enabled. [**Learn more about how to pentest MQTT here**](1883-pentesting-mqtt-mosquitto.md).
- **4369: epmd**, RabbitMQ düğümleri ve CLI araçları tarafından kullanılan bir peer discovery service. [**Learn more about how to pentest this service here**](4369-pentesting-erlang-port-mapper-daemon-epmd.md).
- **5672, 5671**: AMQP 0-9-1 ve 1.0 istemcileri için TLS olmadan ve TLS ile kullanılır
- **15672**: [HTTP API](https://www.rabbitmq.com/management.html) istemcileri, [management UI](https://www.rabbitmq.com/management.html) ve [rabbitmqadmin](https://www.rabbitmq.com/management-cli.html) (sadece if the [management plugin](https://www.rabbitmq.com/management.html) is enabled). [**Learn more about how to pentest this service here**](15672-pentesting-rabbitmq-management.md).
- 15674: STOMP-over-WebSockets istemcileri (sadece if the [Web STOMP plugin](https://www.rabbitmq.com/web-stomp.html) is enabled)
- 15675: MQTT-over-WebSockets istemcileri (sadece if the [Web MQTT plugin](https://www.rabbitmq.com/web-mqtt.html) is enabled)
- 15692: Prometheus metrikleri (sadece if the [Prometheus plugin](https://www.rabbitmq.com/prometheus.html) is enabled)
- 25672: düğümler arası ve CLI araçlarıyla iletişim için kullanılır (Erlang distribution server port) ve dinamik bir aralıktan tahsis edilir (varsayılan olarak tek bir porta sınırlandırılır, AMQP port + 20000 olarak hesaplanır). Bu portlara dış bağlantılar gerçekten gerekli olmadıkça (ör. küme [federation] kullanıyorsa veya CLI araçları alt ağ dışındaki makinelerde kullanılıyorsa) bu portlar genel olarak açık olmamalıdır. Detaylar için bkz. [networking guide](https://www.rabbitmq.com/networking.html). **Only 9 of these ports opened on the internet**.
- 35672-35682: CLI araçları tarafından düğümlerle iletişim için kullanılan (Erlang distribution client ports) ve dinamik bir aralıktan tahsis edilen portlar (server distribution port + 10000 ile server distribution port + 10010 aralığına göre hesaplanır). Detaylar için bkz. [networking guide](https://www.rabbitmq.com/networking.html).
- 61613, 61614: [STOMP clients](https://stomp.github.io/stomp-specification-1.2.html) TLS olmadan ve TLS ile (sadece if the [STOMP plugin](https://www.rabbitmq.com/stomp.html) is enabled). Bu porta açık cihaz sayısı 10'dan azdır ve çoğunlukla DHT düğümleri için UDP kullanımı görülür.

## Ayrıca bakınız

{{#ref}}
4222-pentesting-nats.md
{{#endref}}

## Shodan

- `AMQP`

## References

- [CloudAMQP – RabbitMQ for beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
- [RabbitMQ Networking Guide](https://www.rabbitmq.com/networking.html)

{{#include ../banners/hacktricks-training.md}}
