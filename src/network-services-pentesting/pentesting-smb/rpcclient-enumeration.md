# rpcclient enumeration

{{#include ../../banners/hacktricks-training.md}}


### Przegląd identyfikatorów względnych (RID) i identyfikatorów zabezpieczeń (SID)

**Identyfikatory względne (RID)** i **Identyfikatory zabezpieczeń (SID)** są kluczowymi komponentami w systemach operacyjnych Windows do unikalnego identyfikowania i zarządzania obiektami, takimi jak użytkownicy i grupy, w obrębie domeny sieciowej.

- **SID** służą jako unikalne identyfikatory dla domen, zapewniając, że każda domena jest rozróżnialna.
- **RID** są dołączane do SID, aby tworzyć unikalne identyfikatory dla obiektów w tych domenach. Ta kombinacja pozwala na precyzyjne śledzenie i zarządzanie uprawnieniami obiektów oraz kontrolą dostępu.

Na przykład, użytkownik o imieniu `pepe` może mieć unikalny identyfikator łączący SID domeny z jego specyficznym RID, reprezentowany w formatach szesnastkowym (`0x457`) i dziesiętnym (`1111`). Skutkuje to pełnym i unikalnym identyfikatorem dla pepe w obrębie domeny, takim jak: `S-1-5-21-1074507654-1937615267-42093643874-1111`.

### **Enumeracja z rpcclient**

Narzędzie **`rpcclient`** z Samby jest wykorzystywane do interakcji z **punktami końcowymi RPC przez nazwane potoki**. Poniżej znajdują się polecenia, które można wydać do interfejsów SAMR, LSARPC i LSARPC-DS po nawiązaniu **sesji SMB**, często wymagających poświadczeń.

#### Informacje o serwerze

- Aby uzyskać **Informacje o serwerze**: używa się polecenia `srvinfo`.

#### Enumeracja użytkowników

- **Użytkownicy mogą być wylistowani** za pomocą: `querydispinfo` i `enumdomusers`.
- **Szczegóły użytkownika** za pomocą: `queryuser <0xrid>`.
- **Grupy użytkownika** za pomocą: `queryusergroups <0xrid>`.
- **SID użytkownika jest pobierany** przez: `lookupnames <username>`.
- **Aliasy użytkowników** za pomocą: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Enumeracja grup

- **Grupy** przez: `enumdomgroups`.
- **Szczegóły grupy** z: `querygroup <0xrid>`.
- **Członkowie grupy** przez: `querygroupmem <0xrid>`.

#### Enumeracja grup aliasów

- **Grupy aliasów** przez: `enumalsgroups <builtin|domain>`.
- **Członkowie grupy aliasów** z: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeracja domen

- **Domeny** używając: `enumdomains`.
- **SID domeny jest pobierany** przez: `lsaquery`.
- **Informacje o domenie są uzyskiwane** przez: `querydominfo`.

#### Enumeracja udostępnień

- **Wszystkie dostępne udostępnienia** przez: `netshareenumall`.
- **Informacje o konkretnym udostępnieniu są pobierane** z: `netsharegetinfo <share>`.

#### Dodatkowe operacje z SIDami

- **SIDy według nazwy** używając: `lookupnames <username>`.
- **Więcej SIDów** przez: `lsaenumsid`.
- **Cykliczne RIDy w celu sprawdzenia większej liczby SIDów** wykonuje się przez: `lookupsids <sid>`.

#### **Dodatkowe polecenia**

| **Polecenie**       | **Interfejs**                                                                                                                                     | **Opis**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Pobierz informacje o użytkowniku                                                                                                   |
| querygroup          | Pobierz informacje o grupie                                                                                                                    |                                                                                                                                       |
| querydominfo        | Pobierz informacje o domenie                                                                                                                   |                                                                                                                                       |
| enumdomusers        | Enumeruj użytkowników domeny                                                                                                                    |                                                                                                                                       |
| enumdomgroups       | Enumeruj grupy domeny                                                                                                                           |                                                                                                                                       |
| createdomuser       | Utwórz użytkownika domeny                                                                                                                      |                                                                                                                                       |
| deletedomuser       | Usuń użytkownika domeny                                                                                                                        |                                                                                                                                       |
| lookupnames         | LSARPC                                                                                                                                            | Wyszukaj nazwy użytkowników do wartości SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Wyszukaj SIDy do nazw użytkowników (cykliczne RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                       |
| lsaaddacctrights    | Dodaj prawa do konta użytkownika                                                                                                                |                                                                                                                                       |
| lsaremoveacctrights | Usuń prawa z konta użytkownika                                                                                                                  |                                                                                                                                       |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Uzyskaj informacje o głównej domenie                                                                                                 |
| dsenumdomtrusts     | Enumeruj zaufane domeny w obrębie lasu AD                                                                                                        |                                                                                                                                       |

Aby **lepiej zrozumieć** jak działają narzędzia _**samrdump**_ **i** _**rpcdump**_, powinieneś przeczytać [**Pentesting MSRPC**](../135-pentesting-msrpc.md).


{{#include ../../banners/hacktricks-training.md}}
