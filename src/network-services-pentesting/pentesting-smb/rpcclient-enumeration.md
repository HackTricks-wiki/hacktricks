# rpcclient Enumeration

{{#include ../../banners/hacktricks-training.md}}

<figure><img src="/images/image (2).png" alt=""><figcaption></figcaption></figure>

Vertiefen Sie Ihr Fachwissen in **Mobile Security** mit der 8kSec Academy. Meistern Sie die Sicherheit von iOS und Android durch unsere selbstgesteuerten Kurse und erhalten Sie ein Zertifikat:

{% embed url="https://academy.8ksec.io/" %}

### Übersicht über Relative Identifiers (RID) und Security Identifiers (SID)

**Relative Identifiers (RID)** und **Security Identifiers (SID)** sind Schlüsselkomponenten in Windows-Betriebssystemen zur eindeutigen Identifizierung und Verwaltung von Objekten, wie Benutzern und Gruppen, innerhalb einer Netzwerkdomäne.

- **SIDs** dienen als eindeutige Identifikatoren für Domänen und stellen sicher, dass jede Domäne unterscheidbar ist.
- **RIDs** werden an SIDs angehängt, um eindeutige Identifikatoren für Objekte innerhalb dieser Domänen zu erstellen. Diese Kombination ermöglicht eine präzise Verfolgung und Verwaltung von Objektberechtigungen und Zugriffskontrollen.

Zum Beispiel könnte ein Benutzer namens `pepe` einen eindeutigen Identifikator haben, der die SID der Domäne mit seiner spezifischen RID kombiniert, dargestellt in sowohl hexadezimaler (`0x457`) als auch dezimaler (`1111`) Form. Dies ergibt einen vollständigen und einzigartigen Identifikator für pepe innerhalb der Domäne wie: `S-1-5-21-1074507654-1937615267-42093643874-1111`.

### **Enumeration mit rpcclient**

Das **`rpcclient`**-Dienstprogramm von Samba wird verwendet, um mit **RPC-Endpunkten über benannte Pipes** zu interagieren. Nach der **Herstellung einer SMB-Sitzung**, die oft Anmeldeinformationen erfordert, können die folgenden Befehle an die SAMR-, LSARPC- und LSARPC-DS-Schnittstellen ausgegeben werden.

#### Serverinformationen

- Um **Serverinformationen** zu erhalten: wird der Befehl `srvinfo` verwendet.

#### Auflistung von Benutzern

- **Benutzer können aufgelistet werden** mit: `querydispinfo` und `enumdomusers`.
- **Details eines Benutzers** durch: `queryuser <0xrid>`.
- **Gruppen eines Benutzers** mit: `queryusergroups <0xrid>`.
- **Die SID eines Benutzers wird abgerufen** durch: `lookupnames <username>`.
- **Aliases von Benutzern** durch: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Aufzählung von Gruppen

- **Gruppen** durch: `enumdomgroups`.
- **Details einer Gruppe** mit: `querygroup <0xrid>`.
- **Mitglieder einer Gruppe** durch: `querygroupmem <0xrid>`.

#### Aufzählung von Alias-Gruppen

- **Alias-Gruppen** durch: `enumalsgroups <builtin|domain>`.
- **Mitglieder einer Alias-Gruppe** mit: `queryaliasmem builtin|domain <0xrid>`.

#### Aufzählung von Domänen

- **Domänen** mit: `enumdomains`.
- **Die SID einer Domäne wird abgerufen** durch: `lsaquery`.
- **Domäneninformationen werden erhalten** durch: `querydominfo`.

#### Aufzählung von Freigaben

- **Alle verfügbaren Freigaben** durch: `netshareenumall`.
- **Informationen über eine spezifische Freigabe werden abgerufen** mit: `netsharegetinfo <share>`.

#### Zusätzliche Operationen mit SIDs

- **SIDs nach Namen** mit: `lookupnames <username>`.
- **Weitere SIDs** durch: `lsaenumsid`.
- **RID-Zyklus zur Überprüfung weiterer SIDs** wird durchgeführt durch: `lookupsids <sid>`.

#### **Zusätzliche Befehle**

| **Befehl**          | **Schnittstelle**                                                                                                                                     | **Beschreibung**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Benutzerinformationen abrufen                                                                                                            |
| querygroup          | Gruppeninformationen abrufen                                                                                                                      |                                                                                                                                           |
| querydominfo        | Domäneninformationen abrufen                                                                                                                       |                                                                                                                                           |
| enumdomusers        | Domänenbenutzer auflisten                                                                                                                         |                                                                                                                                           |
| enumdomgroups       | Domänengruppen auflisten                                                                                                                          |                                                                                                                                           |
| createdomuser       | Einen Domänenbenutzer erstellen                                                                                                                   |                                                                                                                                           |
| deletedomuser       | Einen Domänenbenutzer löschen                                                                                                                     |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Benutzernamen in SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) Werte umwandeln |
| lookupsids          | SIDs in Benutzernamen umwandeln (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) Zyklus) |                                                                                                                                           |
| lsaaddacctrights    | Rechte zu einem Benutzerkonto hinzufügen                                                                                                           |                                                                                                                                           |
| lsaremoveacctrights | Rechte von einem Benutzerkonto entfernen                                                                                                           |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Primäre Domäneninformationen abrufen                                                                                                     |
| dsenumdomtrusts     | Vertrauenswürdige Domänen innerhalb eines AD-Waldes auflisten                                                                                     |                                                                                                                                           |

Um **besser zu verstehen**, wie die Tools _**samrdump**_ **und** _**rpcdump**_ funktionieren, sollten Sie [**Pentesting MSRPC**](../135-pentesting-msrpc.md) lesen.

<figure><img src="/images/image (2).png" alt=""><figcaption></figcaption></figure>

Vertiefen Sie Ihr Fachwissen in **Mobilsicherheit** mit der 8kSec Academy. Meistern Sie die Sicherheit von iOS und Android durch unsere selbstgesteuerten Kurse und erhalten Sie ein Zertifikat:

{% embed url="https://academy.8ksec.io/" %}

{{#include ../../banners/hacktricks-training.md}}
