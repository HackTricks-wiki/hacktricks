# rpcclient opsporing

{{#include ../../banners/hacktricks-training.md}}

<figure><img src="/images/image (2).png" alt=""><figcaption></figcaption></figure>

Verdiep jou kundigheid in **Mobiele Sekuriteit** met 8kSec Akademie. Meester iOS en Android sekuriteit deur ons self-gebaseerde kursusse en ontvang sertifisering:

{% embed url="https://academy.8ksec.io/" %}

### Oorsig van Relatiewe Identifiseerders (RID) en Sekuriteitsidentifiseerders (SID)

**Relatiewe Identifiseerders (RID)** en **Sekuriteitsidentifiseerders (SID)** is sleutelkomponente in Windows bedryfstelsels vir die unieke identifisering en bestuur van voorwerpe, soos gebruikers en groepe, binne 'n netwerkdomein.

- **SIDs** dien as unieke identifiseerders vir domeine, wat verseker dat elke domein onderskeibaar is.
- **RIDs** word by SIDs gevoeg om unieke identifiseerders vir voorwerpe binne daardie domeine te skep. Hierdie kombinasie stel presiese opsporing en bestuur van voorwerptoestemmings en toegangbeheer moontlik.

Byvoorbeeld, 'n gebruiker genaamd `pepe` mag 'n unieke identifiseerder hê wat die domein se SID met sy spesifieke RID kombineer, voorgestel in beide heksadesimale (`0x457`) en desimale (`1111`) formate. Dit lei tot 'n volledige en unieke identifiseerder vir pepe binne die domein soos: `S-1-5-21-1074507654-1937615267-42093643874-1111`.

### **Opsporing met rpcclient**

Die **`rpcclient`** nut van Samba word gebruik om te kommunikeer met **RPC eindpunte deur naamgebaseerde pype**. Hieronder is opdragte wat aan die SAMR, LSARPC, en LSARPC-DS interfaces gegee kan word nadat 'n **SMB-sessie gevestig is**, wat dikwels geloofsbriewe vereis.

#### Bediener Inligting

- Om **Bediener Inligting** te verkry: `srvinfo` opdrag word gebruik.

#### Opsporing van Gebruikers

- **Gebruikers kan gelys word** met: `querydispinfo` en `enumdomusers`.
- **Besonderhede van 'n gebruiker** deur: `queryuser <0xrid>`.
- **Groepen van 'n gebruiker** met: `queryusergroups <0xrid>`.
- **'n Gebruiker se SID word verkry** deur: `lookupnames <username>`.
- **Alias van gebruikers** deur: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Groepsevaluering

- **Groep** deur: `enumdomgroups`.
- **Besonderhede van 'n groep** met: `querygroup <0xrid>`.
- **Lede van 'n groep** deur: `querygroupmem <0xrid>`.

#### Alias Groepsevaluering

- **Alias groepe** deur: `enumalsgroups <builtin|domain>`.
- **Lede van 'n alias groep** met: `queryaliasmem builtin|domain <0xrid>`.

#### Domeinevaluering

- **Domeine** met: `enumdomains`.
- **'n Domein se SID word verkry** deur: `lsaquery`.
- **Domein inligting word verkry** deur: `querydominfo`.

#### Aandeelsevaluering

- **Alle beskikbare aandele** deur: `netshareenumall`.
- **Inligting oor 'n spesifieke aandeel word verkry** met: `netsharegetinfo <share>`.

#### Bykomende Operasies met SIDs

- **SIDs volgens naam** met: `lookupnames <username>`.
- **Meer SIDs** deur: `lsaenumsid`.
- **RID siklusse om meer SIDs te kontroleer** word uitgevoer deur: `lookupsids <sid>`.

#### **Ekstra opdragte**

| **Opdrag**          | **Koppelvlak**                                                                                                                                     | **Beskrywing**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Verkry gebruikersinligting                                                                                                               |
| querygroup          | Verkry groepinligting                                                                                                                            |                                                                                                                                           |
| querydominfo        | Verkry domeininligting                                                                                                                           |                                                                                                                                           |
| enumdomusers        | Evalueer domein gebruikers                                                                                                                       |                                                                                                                                           |
| enumdomgroups       | Evalueer domein groepe                                                                                                                          |                                                                                                                                           |
| createdomuser       | Skep 'n domein gebruiker                                                                                                                          |                                                                                                                                           |
| deletedomuser       | Verwyder 'n domein gebruiker                                                                                                                     |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Soek gebruikersname na SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) waardes |
| lookupsids          | Soek SIDs na gebruikersname (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) siklusse) |                                                                                                                                           |
| lsaaddacctrights    | Voeg regte by 'n gebruikersrekening                                                                                                              |                                                                                                                                           |
| lsaremoveacctrights | Verwyder regte van 'n gebruikersrekening                                                                                                         |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Verkry primêre domeininligting                                                                                                            |
| dsenumdomtrusts     | Evalueer vertroude domeine binne 'n AD-woud                                                                                                      |                                                                                                                                           |

Om **beter te verstaan** hoe die gereedskap _**samrdump**_ **en** _**rpcdump**_ werk, moet jy [**Pentesting MSRPC**](../135-pentesting-msrpc.md) lees.

<figure><img src="/images/image (2).png" alt=""><figcaption></figcaption></figure>

Verdiep jou kundigheid in **Mobiele Sekuriteit** met 8kSec Akademie. Meester iOS en Android sekuriteit deur ons self-gebaseerde kursusse en kry gesertifiseer:

{% embed url="https://academy.8ksec.io/" %}

{{#include ../../banners/hacktricks-training.md}}
