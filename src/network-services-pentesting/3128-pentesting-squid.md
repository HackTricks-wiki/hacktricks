# 3128/tcp - Pentesting Squid

{{#include ../banners/hacktricks-training.md}}

## Osnovne informacije

Iz [Wikipedia](<https://en.wikipedia.org/wiki/Squid_(software)>):

> **Squid** je keširajući i prosleđujući HTTP web proxy. Ima širok spektar upotreba, uključujući ubrzavanje web servera keširanjem ponovljenih zahteva, keširanje web, DNS i drugih mrežnih pretraga za grupu korisnika koji dele mrežne resurse, i unapređivanje bezbednosti filtriranjem saobraćaja. Iako se prvenstveno koristi za HTTP i FTP, Squid ima ograničenu podršku za nekoliko drugih protokola uključujući Internet Gopher, SSL, TLS i HTTPS. Squid ne podržava SOCKS protokol, za razliku od Privoxy, sa kojim se Squid može koristiti kako bi obezbedio podršku za SOCKS.

**Podrazumevani port:** 3128
```
PORT     STATE  SERVICE      VERSION
3128/tcp open   http-proxy   Squid http proxy 4.11
```
## Enumeration

### Web Proxy

Možete pokušati da postavite ovaj otkriveni servis kao proxy u vašem pregledaču. Međutim, ako je konfigurisan sa HTTP authentication, bićete upitani za korisnička imena i lozinke.
```bash
# Try to proxify curl
curl --proxy http://10.10.11.131:3128 http://10.10.11.131
```
### Nmap proxified

Takođe možete pokušati da zloupotrebite proxy da biste **skenirali interne portove koristeći nmap preko proxyja**.\
Konfigurišite proxychains da koristi squid proxy dodavanjem sledeće linije na kraj proxichains.conf fajla: `http 10.10.10.10 3128`  
Za proxy-je koji zahtevaju autentifikaciju, dodajte kredencijale u konfiguraciju tako što ćete uključiti korisničko ime i lozinku na kraju: `http 10.10.10.10 3128 username passw0rd`.

Zatim pokrenite nmap preko proxychains da biste **skenirali host lokalno**: `proxychains nmap -sT -n -p- localhost`

### SPOSE Scanner

Alternativno, Squid Pivoting Open Port Scanner ([spose.py](https://github.com/aancw/spose)) se može koristiti.
```bash
python spose.py --proxy http://10.10.11.131:3128 --target 10.10.11.131
```
### Pivot & konfiguracija alata

*Koristite Squid kao discovery pivot i transparentan upstream hop za CLI i browser alate.*

- **Scan “from” the proxy:** pokrenite SPOSE kroz Squid da enumerišete portove dostupne sa proxy host/loopback. Sa [uv](https://github.com/astral-sh/uv) možete instalirati deps i skenirati sve TCP portove direktno:
```bash
uv add --script spose.py -r requirements.txt
uv run spose.py --proxy http://SQUID_IP:3128 --target localhost --allports
```
- **Proxychains za HTTP interakciju:** dodajte strogi HTTP unos na dno `/etc/proxychains.conf`:
```ini
[ProxyList]
http    SQUID_IP   3128
```
Zatim komunicirajte sa internal listeners (npr. web UI vezan za 127.0.0.1) transparentno preko Squid:
```bash
proxychains curl http://127.0.0.1:9191 -v
```
- **Chaining Burp/Browser → Squid:** konfigurišite Burp *Proxy → Settings → Network → Connections → Upstream proxy servers* da pokazuje na `http://SQUID_IP:3128`. Zahtevi ka internim hostovima kao što je `http://127.0.0.1:9191` će prolaziti Browser → Burp → Squid → target, omogućavajući potpuno presretanje servisa koji inače nisu dostupni spolja.

## Izvori

- [SPOSE – Squid Pivoting Open Port Scanner](https://github.com/aancw/spose)
- [HTB Bamboo walkthrough (Squid pivoting example)](https://0xdf.gitlab.io/2026/02/03/htb-bamboo.html)

{{#include ../banners/hacktricks-training.md}}
