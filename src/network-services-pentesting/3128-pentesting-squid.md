# 3128/tcp - Pentesting Squid

{{#include ../banners/hacktricks-training.md}}

## Основна інформація

З [Wikipedia](<https://en.wikipedia.org/wiki/Squid_(software)>):

> **Squid** — кешуючий і переспрямовуючий HTTP web proxy. Має широкий спектр застосувань, включно з прискоренням веб-сервера за рахунок кешування повторних запитів, кешуванням web, DNS та інших мережевих пошуків для групи людей, які спільно використовують мережеві ресурси, а також сприянням безпеці шляхом фільтрації трафіку. Хоча переважно використовується для HTTP і FTP, Squid має обмежену підтримку кількох інших протоколів, включаючи Internet Gopher, SSL, TLS та HTTPS. Squid не підтримує протокол SOCKS, на відміну від Privoxy, з яким Squid можна використовувати для забезпечення підтримки SOCKS.

**Порт за замовчуванням:** 3128
```
PORT     STATE  SERVICE      VERSION
3128/tcp open   http-proxy   Squid http proxy 4.11
```
## Перерахування

### Веб-проксі

Ви можете спробувати встановити цей виявлений сервіс як проксі в браузері. Однак, якщо він налаштований з HTTP-аутентифікацією, вас попросять ввести ім'я користувача та пароль.
```bash
# Try to proxify curl
curl --proxy http://10.10.11.131:3128 http://10.10.11.131
```
### Nmap proxified

Ви також можете спробувати зловживати проксі, щоб **сканувати внутрішні порти, запустивши nmap через проксі**.\
Налаштуйте proxychains на використання squid proxy, додавши наступний рядок в кінець файлу proxichains.conf: `http 10.10.10.10 3128`  
Для проксі, що вимагають автентифікації, додайте облікові дані в конфігурацію, включивши ім'я користувача та пароль в кінці: `http 10.10.10.10 3128 username passw0rd`.

Потім запустіть nmap через proxychains, щоб **сканувати хост локально**: `proxychains nmap -sT -n -p- localhost`

### SPOSE сканер

Альтернативно, можна використати Squid Pivoting Open Port Scanner ([spose.py](https://github.com/aancw/spose)).
```bash
python spose.py --proxy http://10.10.11.131:3128 --target 10.10.11.131
```
### Pivot і конфігурація інструментів

*Використовуйте Squid як discovery pivot і прозорий upstream hop для CLI та browser tools.*

- **Scan “from” the proxy:** запускайте SPOSE через Squid для перерахунку портів, доступних з proxy host/loopback. За допомогою [uv](https://github.com/astral-sh/uv) ви можете встановити deps та просканувати всі TCP порти напряму:
```bash
uv add --script spose.py -r requirements.txt
uv run spose.py --proxy http://SQUID_IP:3128 --target localhost --allports
```
- **Proxychains for HTTP interaction:** додайте в кінець `/etc/proxychains.conf` строгий HTTP-запис:
```ini
[ProxyList]
http    SQUID_IP   3128
```
Потім взаємодійте з internal listeners (наприклад, web UI, прив'язаний до 127.0.0.1) прозоро через Squid:
```bash
proxychains curl http://127.0.0.1:9191 -v
```
- **Chaining Burp/Browser → Squid:** налаштуйте Burp *Proxy → Settings → Network → Connections → Upstream proxy servers* вказавши `http://SQUID_IP:3128`. Запити до внутрішніх хостів, таких як `http://127.0.0.1:9191`, пройдуть Browser → Burp → Squid → ціль, що дозволяє повністю перехоплювати сервіси, які інакше недоступні зовні.

## Посилання

- [SPOSE – Squid Pivoting Open Port Scanner](https://github.com/aancw/spose)
- [HTB Bamboo walkthrough (Squid pivoting example)](https://0xdf.gitlab.io/2026/02/03/htb-bamboo.html)

{{#include ../banners/hacktricks-training.md}}
