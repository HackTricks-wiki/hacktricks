# 3128/tcp - Pentesting Squid

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

Kaynak: [Wikipedia](<https://en.wikipedia.org/wiki/Squid_(software)>):

> **Squid** önbellekleme ve yönlendirme yapan bir HTTP web proxy'sidir. Tekrarlanan istekleri önbelleğe alarak bir web sunucusunu hızlandırmak, ağ kaynaklarını paylaşan bir grup için web, DNS ve diğer bilgisayar ağı sorgularını önbelleğe almak ve trafiği filtreleyerek güvenliğe yardımcı olmak gibi birçok kullanım alanı vardır. Her ne kadar öncelikle HTTP ve FTP için kullanılsa da, Squid Internet Gopher, SSL, TLS ve HTTPS dahil olmak üzere birkaç diğer protokole sınırlı destek içerir. Squid, Privoxy'nin aksine SOCKS protokolünü desteklemez; Privoxy ile birlikte kullanılarak SOCKS desteği sağlanabilir.

**Varsayılan port:** 3128
```
PORT     STATE  SERVICE      VERSION
3128/tcp open   http-proxy   Squid http proxy 4.11
```
## Keşif

### Web Proxy

Bu keşfedilen servisi tarayıcınızda proxy olarak ayarlamayı deneyebilirsiniz. Ancak, HTTP authentication ile yapılandırıldıysa username ve password girmeniz istenecektir.
```bash
# Try to proxify curl
curl --proxy http://10.10.11.131:3128 http://10.10.11.131
```
### Nmap proxified

Proxy'yü kötüye kullanarak **iç portları taramak için proxifying nmap** yöntemini de deneyebilirsiniz.\
Configure proxychains to use the squid proxy adding he following line at the end of the proxichains.conf file: `http 10.10.10.10 3128`
For proxies requiring authentication, append credentials to the configuration by including the username and password at the end: `http 10.10.10.10 3128 username passw0rd`.

Then run nmap with proxychains to **yerelden hedefi taramak**: `proxychains nmap -sT -n -p- localhost`

### SPOSE Scanner

Alternatif olarak, Squid Pivoting Open Port Scanner ([spose.py](https://github.com/aancw/spose)) kullanılabilir.
```bash
python spose.py --proxy http://10.10.11.131:3128 --target 10.10.11.131
```
### Pivot ve araç yapılandırması

*Keşif pivotu ve CLI ile browser araçları için şeffaf bir upstream hop olarak Squid kullanın.*

- **Scan “from” the proxy:** Squid üzerinden SPOSE çalıştırarak proxy host/loopback'tan erişilebilen portları listeleyin. With [uv](https://github.com/astral-sh/uv) you can install deps and scan all TCP ports directly:
```bash
uv add --script spose.py -r requirements.txt
uv run spose.py --proxy http://SQUID_IP:3128 --target localhost --allports
```
- **Proxychains for HTTP interaction:** `/etc/proxychains.conf` dosyasının en altına katı bir HTTP girişi ekleyin:
```ini
[ProxyList]
http    SQUID_IP   3128
```
Ardından Squid aracılığıyla iç dinleyicilerle (ör. 127.0.0.1'e bağlı bir web UI) şeffaf şekilde etkileşim kurun:
```bash
proxychains curl http://127.0.0.1:9191 -v
```
- **Chaining Burp/Browser → Squid:** Burp'ı *Proxy → Settings → Network → Connections → Upstream proxy servers* ayarından `http://SQUID_IP:3128`'e işaret edecek şekilde yapılandırın. `http://127.0.0.1:9191` gibi dahili hostlara yapılan istekler Browser → Burp → Squid → hedef üzerinden ilerleyecek ve dışarıdan erişilemeyen servislerin tam olarak yakalanmasını sağlayacaktır.

## Referanslar

- [SPOSE – Squid Pivoting Open Port Scanner](https://github.com/aancw/spose)
- [HTB Bamboo walkthrough (Squid pivoting example)](https://0xdf.gitlab.io/2026/02/03/htb-bamboo.html)

{{#include ../banners/hacktricks-training.md}}
