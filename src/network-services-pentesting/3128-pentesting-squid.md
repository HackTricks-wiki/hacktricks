# 3128/tcp - Pentesting Squid

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

Vanaf [Wikipedia](<https://en.wikipedia.org/wiki/Squid_(software)>):

> **Squid** is 'n kas- en deurstuurende HTTP-webproxy. Dit het 'n wye verskeidenheid gebruike, insluitend om 'n webbediener te versnel deur herhaalde versoeke te kas, om web-, DNS- en ander rekenaarnetwerk-opsoeke vir 'n groep gebruikers wat netwerkbronne deel te kas, en om sekuriteit te help deur verkeer te filtreer. Alhoewel hoofsaaklik gebruik vir HTTP en FTP, sluit Squid beperkte ondersteuning in vir verskeie ander protokolle, insluitend Internet Gopher, SSL, TLS en HTTPS. Squid ondersteun nie die SOCKS-protokol nie, anders as Privoxy, waarmee Squid saamgebruik kan word om SOCKS-ondersteuning te verskaf.

**Standaardpoort:** 3128
```
PORT     STATE  SERVICE      VERSION
3128/tcp open   http-proxy   Squid http proxy 4.11
```
## Enumerasie

### Web Proxy

Jy kan probeer om hierdie ontdekte diens as proxy in jou browser te stel. As dit egter met HTTP authentication gekonfigureer is, sal jy vir usernames en password gevra word.
```bash
# Try to proxify curl
curl --proxy http://10.10.11.131:3128 http://10.10.11.131
```
### Nmap proxified

Jy kan ook probeer om die proxy te misbruik om **scan internal ports proxifying nmap**.\
Konfigureer proxychains om die squid proxy te gebruik deur die volgende reël aan die einde van die proxichains.conf-lêer by te voeg: `http 10.10.10.10 3128`  
Vir proxies wat authentication vereis, voeg credentials by die konfigurasie deur die username en password aan die einde in te voeg: `http 10.10.10.10 3128 username passw0rd`.

Voer dan nmap met proxychains uit om **scan the host from local**: `proxychains nmap -sT -n -p- localhost`

### SPOSE Scanner

Alternatiewelik kan die Squid Pivoting Open Port Scanner ([spose.py](https://github.com/aancw/spose)) gebruik word.
```bash
python spose.py --proxy http://10.10.11.131:3128 --target 10.10.11.131
```
### Pivot- en tooling-konfigurasie

*Gebruik Squid as 'n ontdekking-pivot en 'n deursigtige upstream hop vir CLI- en browser-gereedskap.*

- **Scan “from” the proxy:** voer SPOSE deur Squid uit om poorte op te noem wat vanaf die proxy-host/loopback bereik kan word. Met [uv](https://github.com/astral-sh/uv) kan jy deps installeer en alle TCP-poorte direk skandeer:
```bash
uv add --script spose.py -r requirements.txt
uv run spose.py --proxy http://SQUID_IP:3128 --target localhost --allports
```
- **Proxychains for HTTP interaction:** voeg 'n streng HTTP-inskrywing by aan die onderkant van `/etc/proxychains.conf`:
```ini
[ProxyList]
http    SQUID_IP   3128
```
Interageer dan deursigtig met internal listeners (bv. 'n web UI gebind aan 127.0.0.1) deur Squid:
```bash
proxychains curl http://127.0.0.1:9191 -v
```
- **Chaining Burp/Browser → Squid:** konfigureer Burp *Proxy → Settings → Network → Connections → Upstream proxy servers* to point to `http://SQUID_IP:3128`. Versoeke na interne hosts soos `http://127.0.0.1:9191` sal deur Browser → Burp → Squid → target geloop word, wat volledige onderskepping van dienste moontlik maak wat andersins nie van buite bereikbaar is nie.

## Verwysings

- [SPOSE – Squid Pivoting Open Port Scanner](https://github.com/aancw/spose)
- [HTB Bamboo walkthrough (Squid pivoting example)](https://0xdf.gitlab.io/2026/02/03/htb-bamboo.html)

{{#include ../banners/hacktricks-training.md}}
