# 5439 - Pentesting Redshift

{{#include ../banners/hacktricks-training.md}}

## बुनियादी जानकारी

This port is used by **Amazon Redshift** (AWS managed data warehouse). Redshift wire protocol is a slightly modified **PostgreSQL** protocol, so most Postgres client tooling works (psql, psycopg2, JDBC/ODBC) but auth and TLS requirements differ.

For more information check:

{{#ref}}
https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-services/aws-redshift-enum.html
{{#endref}}

## एनेमरेशन और कनेक्टिविटी

- डिफ़ॉल्ट पोर्ट: **5439/TCP** (customizable). Serverless workgroups भी डिफ़ॉल्ट रूप से 5439 का उपयोग करते हैं।
- पब्लिक endpoint पैटर्न: `<clusterid>.<random>.<region>.redshift.amazonaws.com` (public) or `.redshift.amazonaws.com.cn` (China). Serverless: `<workgroup>.<random>.<region>.redshift-serverless.amazonaws.com`.
- **TLS**: Redshift को TLS 1.2+ और perfect-forward-secrecy ciphers की आवश्यकता होती है। पुराने क्लाइंट असफल हो सकते हैं; आधुनिक TLS मजबूर करें:
```bash
psql "host=<endpoint> port=5439 user=awsuser dbname=dev sslmode=require"
# or using redshift-psql wrapper
```
- **Parameter group `require_ssl`** यह नियंत्रित करता है कि plaintext की अनुमति है या नहीं। नए clusters/workgroups `default.redshift-2.0` का उपयोग करते हैं और `require_ssl=true` सेट होता है, इसलिए downgrade/mitm करना कठिन होता है।

### psql के साथ त्वरित enum
```bash
# basic banner/version
psql "host=<endpoint> user=<u> dbname=dev" -c 'select version();'
# list dbs, users, privileges
\l
\du
select * from pg_user;
select * from svv_redshift_sessions;
```
त्रुटियाँ गलत पासवर्ड बनाम अनुपस्थित उपयोगकर्ता को अलग करती हैं → संभावित **username enumeration** during brute force।

## परीक्षण के लिए प्रमाणीकरण पाथ

- **Database password** मास्टर उपयोगकर्ता (अक्सर नाम `awsuser`) या बनाए गए DB उपयोगकर्ताओं के लिए।
- **IAM auth tokens**: अल्पकालिक क्रेडेंशियल जनरेट करें और libpq/JDBC/ODBC के माध्यम से `sslmode=require` और `authMech=IAM` या `plugin_name=com.amazon.redshift.plugin.OktaCredentialsProvider` का उपयोग करके कनेक्ट करें। चोरी किए गए IAM creds/roles का दुरुपयोग `rds-db:connect` स्टाइल अनुमति के समकक्ष Redshift के लिए किया जा सकता है।
```bash
aws redshift get-cluster-credentials --cluster-identifier <id> \
--db-user pentest --db-name dev --duration-seconds 900
psql "host=<endpoint> user=pentest password=<token> dbname=dev sslmode=require"
```
- **IAM Identity Center / SAML / Azure AD plugins**: JDBC `plugin_name` SSO के लिए स्थानीय वेब सर्वर स्पिन कर सकता है; कैप्चर किया गया loopback callback SAML assertion या temp creds को leak कर सकता है।

## सामान्य गलत कॉन्फ़िगरेशन (नेटवर्क)

- Cluster में **PubliclyAccessible=true** और wide-open SG (0.0.0.0/0) होने पर Postgres-जैसा surface brute force या SQLi exploitation के लिए एक्सपोज़ होता है।
- **Default port 5439** और default SG आसान discovery (Shodan/Censys) की अनुमति देते हैं। पोर्ट बदलना मामूली छिपाव है पर अक्सर hardening चेकलिस्ट में अनदेखा किया जाता है।
- **No enhanced VPC routing** → COPY/UNLOAD सार्वजनिक Internet पर जाते हैं; जब attacker S3 bucket/endpoint को नियंत्रित करता है तो इसे exfil के लिए दुरुपयोग किया जा सकता है।

## आक्रमण नोट्स

- यदि login सफल होता है, तो serverless में Redshift में superuser नहीं होता; provisioned clusters में master user के पास व्यापक अधिकार होते हैं जैसे UDFs (Python) बनाना, Spectrum के लिए external schema बनाना, attacker S3 से COPY, और डेटा exfil करने के लिए `UNLOAD`।
- `max_concurrency_scaling_clusters`, `require_ssl`, `enable_user_activity_logging` के लिए cluster parameter group की जाँच करें – logging disabled होने से stealth में मदद मिलती है।
- Serverless workgroups अभी भी TCP के माध्यम से पहुंचने योग्य हैं; provisioned clusters जितना ही SQL attack surface मौजूद है।

## हालिया सुरक्षा परिवर्तन (आक्रमण प्रभाव)

- नए clusters/snapshots पर **Public access disabled by default**; legacy वाले अभी भी public हो सकते हैं।
- **Encryption at rest + enforced TLS by default** का अर्थ है कि sniffing/mitm करना कठिन है; वैध credentials की आवश्यकता होती है या VPC पथ में SSRF की आवश्यकता।

## References

- [AWS Security Blog – Redshift enhances security defaults (public access off, require SSL, encryption) – Nov 2024](https://aws.amazon.com/blogs/security/amazon-redshift-enhances-security-by-changing-default-behavior-in-2025/)
- [AWS Docs – Options for providing IAM credentials (JDBC/ODBC IAM/SAML plugins)](https://docs.aws.amazon.com/redshift/latest/mgmt/options-for-providing-iam-credentials.html)

{{#include ../banners/hacktricks-training.md}}
