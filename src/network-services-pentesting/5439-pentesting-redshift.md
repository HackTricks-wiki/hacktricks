# 5439 - Pentesting Redshift

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

Hierdie poort word gebruik deur **Amazon Redshift** (AWS managed data warehouse). Redshift wire protocol is 'n effens aangepaste **PostgreSQL** protocol, so meeste Postgres client tooling werk (psql, psycopg2, JDBC/ODBC) maar auth en TLS vereistes verskil.

Vir meer inligting kyk:

{{#ref}}
https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-services/aws-redshift-enum.html
{{#endref}}

## Enumerasie & Konnektiwiteit

- Standaardpoort: **5439/TCP** (aanpasbaar). Serverless workgroups standaard ook 5439.
- Publieke eindpuntpatroon: `<clusterid>.<random>.<region>.redshift.amazonaws.com` (publiek) of `.redshift.amazonaws.com.cn` (China). Serverless: `<workgroup>.<random>.<region>.redshift-serverless.amazonaws.com`.
- **TLS**: Redshift vereis TLS 1.2+ en perfect-forward-secrecy ciphers. Ouer kliënte kan misluk; dwing moderne TLS af:
```bash
psql "host=<endpoint> port=5439 user=awsuser dbname=dev sslmode=require"
# or using redshift-psql wrapper
```
- **Parameter group `require_ssl`** beheer of plaintext toegelaat word. Nuwe clusters/workgroups gebruik `default.redshift-2.0` met `require_ssl=true`, so downgrade/mitm is moeiliker.

### Vinnige enumerasie met psql
```bash
# basic banner/version
psql "host=<endpoint> user=<u> dbname=dev" -c 'select version();'
# list dbs, users, privileges
\l
\du
select * from pg_user;
select * from svv_redshift_sessions;
```
Foutboodskappe onderskei slegte wagwoord vs ontbrekende gebruiker → potensiële **username enumeration** tydens brute force.

## Verifikasiepade om te toets

- **Databasiswagwoord** vir master user (dikwels genaamd `awsuser`) of geskepte DB-gebruikers.
- **IAM auth tokens**: genereer kort-lewende credentials en koppel via libpq/JDBC/ODBC met `sslmode=require` en `authMech=IAM` of `plugin_name=com.amazon.redshift.plugin.OktaCredentialsProvider`. Misbruik gesteelde IAM creds/rolle met `rds-db:connect` styl permission ekwivalent vir Redshift.
```bash
aws redshift get-cluster-credentials --cluster-identifier <id> \
--db-user pentest --db-name dev --duration-seconds 900
psql "host=<endpoint> user=pentest password=<token> dbname=dev sslmode=require"
```
- **IAM Identity Center / SAML / Azure AD plugins**: JDBC `plugin_name` kan 'n plaaslike webserver opstart vir SSO; 'n vasgevang loopback callback kan SAML assertion of tydelike creds leak.

## Algemene wankonfigurasies (netwerk)

- Cluster gemerk **PubliclyAccessible=true** met 'n open SG (0.0.0.0/0) openbaar 'n Postgres-agtige oppervlak vir brute force of SQLi-uitbuiting.
- **Standaardpoort 5439** plus standaard SG maak maklike ontdekking (Shodan/Censys) moontlik. Om die poort te verander bied net 'n klein obscurity maar word soms oor die hoof gesien in verhardingskontrolelyste.
- **Geen enhanced VPC routing** → COPY/UNLOAD gaan oor die openbare Internet; kan misbruik word vir exfil wanneer 'n aanvaller S3 bucket/endpoint beheer.

## Aanvalsnotas

- As login slaag, het Redshift geen superuser in serverless nie; in provisioned clusters het die master user wye regte insluitend die skep van UDFs (Python), external schema na Spectrum, COPY vanaf aanvaller S3, en `UNLOAD` om data te exfil.
- Kontroleer die cluster parameter group vir `max_concurrency_scaling_clusters`, `require_ssl`, `enable_user_activity_logging` – logging gedeaktiveer help om onopgemerk te bly.
- Serverless workgroups is steeds via TCP bereikbaar; dieselfde SQL-aanvalsoppervlak as provisioned clusters.

## Onlangse sekuriteitsveranderings (aanvalsimpak)

- **Public access disabled by default** op nuwe clusters/snapshots; legacy ones mag steeds publiek wees.
- **Encryption at rest + enforced TLS by default** beteken sniffing/mitm moeiliker; geldige credentials of 'n SSRF in 'n VPC-pad is nodig.

## References

- [AWS Security Blog – Redshift enhances security defaults (public access off, require SSL, encryption) – Nov 2024](https://aws.amazon.com/blogs/security/amazon-redshift-enhances-security-by-changing-default-behavior-in-2025/)
- [AWS Docs – Options for providing IAM credentials (JDBC/ODBC IAM/SAML plugins)](https://docs.aws.amazon.com/redshift/latest/mgmt/options-for-providing-iam-credentials.html)

{{#include ../banners/hacktricks-training.md}}
