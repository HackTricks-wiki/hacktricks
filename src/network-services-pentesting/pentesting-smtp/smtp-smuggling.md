# SMTP Smuggling

{{#include ../../banners/hacktricks-training.md}}

## Temel Bilgiler

Bu tür bir zafiyet [**bu yazıda ilk olarak keşfedilmiştir**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/) burada, e-postayı tamamlarken SMTP protokolünün nasıl yorumlandığındaki farklılıkların **istismar edilebileceği** açıklanmaktadır; bu, bir saldırganın meşru e-postanın gövdesine daha fazla e-posta gizlemesine olanak tanır ve etkilenen alanın diğer kullanıcılarını (örneğin admin@outlook.com) taklit etmesine izin verir, SPF gibi savunmaları aşar.

### Neden

Bu, SMTP protokolünde, e-postada gönderilecek **mesaj verisinin** bir kullanıcı (saldırgan) tarafından kontrol edilmesindendir; bu kullanıcı, alıcıda ekstra e-postalar gizlemek için ayrıştırıcılardaki farklılıkları istismar eden özel olarak hazırlanmış veriler gönderebilir. İşte orijinal yazıdan bir örnek:

<figure><img src="../../images/image (8) (1) (1) (1) (1).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Nasıl

Bu zafiyeti istismar etmek için bir saldırganın, **Çıkış SMTP sunucusunun sadece 1 e-posta olduğunu düşündüğü ancak Giriş SMTP sunucusunun birden fazla e-posta olduğunu düşündüğü** bazı veriler göndermesi gerekir.

Araştırmacılar, farklı **Giriş sunucularının e-posta mesajının verisinin sonu olarak farklı karakterleri kabul ettiğini** keşfettiler; Çıkış sunucularının kabul etmediği karakterlerdir.\
Örneğin, verinin normal sonu `\r\n.\r` şeklindedir. Ancak Giriş SMTP sunucusu `\n.` desteği de sağlıyorsa, bir saldırgan **bu veriyi e-postasına ekleyebilir ve yeni e-postaları gizlemek için SMTP komutlarını göstermeye başlayabilir**; tıpkı önceki resimde olduğu gibi.

Tabii ki, bu yalnızca **Çıkış SMTP sunucusu bu veriyi** mesaj verisinin sonu olarak kabul etmediği takdirde çalışır; çünkü bu durumda 1 yerine 2 e-posta görecektir, bu nedenle sonunda bu zafiyette istismar edilen senkronizasyon bozukluğudur.

Potansiyel senkronizasyon bozukluğu verileri:

- `\n.`
- `\n.\r`

Ayrıca, SPF'nin aşıldığını unutmayın; çünkü `user@outlook.com` adresinden `admin@outlook.com` adresine bir e-posta gizlerseniz, **gönderen hala `outlook.com`'dur.**

## **Kaynaklar**

- [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

{{#include ../../banners/hacktricks-training.md}}
