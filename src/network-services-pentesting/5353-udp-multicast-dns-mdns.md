# 5353/UDP Multicast DNS (mDNS) και DNS-SD

{{#include ../banners/hacktricks-training.md}}

## **Βασικές Πληροφορίες**

**Multicast DNS (mDNS)** επιτρέπει **λειτουργίες παρόμοιες με το DNS** εντός τοπικών δικτύων χωρίς την ανάγκη παραδοσιακού διακομιστή DNS. Λειτουργεί στην **UDP θύρα 5353** και επιτρέπει στις συσκευές να ανακαλύπτουν η μία την άλλη και τις υπηρεσίες τους, κάτι που παρατηρείται συχνά σε διάφορες συσκευές IoT. **DNS Service Discovery (DNS-SD)**, που χρησιμοποιείται συχνά παράλληλα με το mDNS, βοηθά στην αναγνώριση υπηρεσιών που είναι διαθέσιμες στο δίκτυο μέσω τυπικών ερωτημάτων DNS.
```
PORT     STATE SERVICE
5353/udp open  zeroconf
```
### **Λειτουργία του mDNS**

Σε περιβάλλοντα χωρίς έναν τυπικό DNS server, το mDNS επιτρέπει στις συσκευές να επιλύουν ονόματα τομέα που τελειώνουν σε **.local** ερωτώντας τη διεύθυνση multicast **224.0.0.251** (IPv4) ή **FF02::FB** (IPv6). Σημαντικές πτυχές του mDNS περιλαμβάνουν μια τιμή **Time-to-Live (TTL)** που υποδεικνύει την εγκυρότητα της εγγραφής και ένα **QU bit** που διακρίνει μεταξύ unicast και multicast ερωτήσεων. Από πλευράς ασφάλειας, είναι κρίσιμο οι υλοποιήσεις του mDNS να επαληθεύουν ότι η διεύθυνση προέλευσης του πακέτου ευθυγραμμίζεται με το τοπικό υποδίκτυο.

### **Λειτουργία του DNS-SD**

Το DNS-SD διευκολύνει την ανακάλυψη δικτυακών υπηρεσιών ερωτώντας για εγγραφές δείκτη (PTR) που αντιστοιχούν σε τύπους υπηρεσιών και τις περιπτώσεις τους. Οι υπηρεσίες αναγνωρίζονται χρησιμοποιώντας ένα πρότυπο **\_\<Service>.\_tcp ή \_\<Service>.\_udp** εντός του τομέα **.local**, οδηγώντας στην ανακάλυψη αντίστοιχων **SRV** και **TXT records** που παρέχουν λεπτομερείς πληροφορίες για την υπηρεσία.

### **Εξερεύνηση Δικτύου**

#### **Χρήση του nmap**

Μια χρήσιμη εντολή για σάρωση του τοπικού δικτύου για υπηρεσίες mDNS είναι:
```bash
nmap -Pn -sUC -p5353 [target IP address]
```
Αυτή η εντολή βοηθά στην αναγνώριση ανοιχτών θυρών mDNS και των υπηρεσιών που διαφημίζονται μέσω αυτών.

#### **Δικτυακή Αρίθμηση με Pholus**

Για να στείλετε ενεργά αιτήματα mDNS και να καταγράψετε την κίνηση, το εργαλείο **Pholus** μπορεί να χρησιμοποιηθεί ως εξής:
```bash
sudo python3 pholus3.py [network interface] -rq -stimeout 10
```
## Επιθέσεις

### **Εκμετάλλευση mDNS Probing**

Ένας επιθετικός παράγοντας περιλαμβάνει την αποστολή ψευδών απαντήσεων σε mDNS probes, υποδεικνύοντας ότι όλα τα πιθανά ονόματα είναι ήδη σε χρήση, εμποδίζοντας έτσι τις νέες συσκευές να επιλέξουν ένα μοναδικό όνομα. Αυτό μπορεί να εκτελεστεί χρησιμοποιώντας:
```bash
sudo python pholus.py [network interface] -afre -stimeout 1000
```
Αυτή η τεχνική μπλοκάρει αποτελεσματικά τις νέες συσκευές από το να καταχωρούν τις υπηρεσίες τους στο δίκτυο.

**Συνοψίζοντας**, η κατανόηση της λειτουργίας του mDNS και του DNS-SD είναι κρίσιμη για τη διαχείριση και την ασφάλεια του δικτύου. Εργαλεία όπως το **nmap** και το **Pholus** προσφέρουν πολύτιρες πληροφορίες σχετικά με τις τοπικές υπηρεσίες δικτύου, ενώ η επίγνωση των πιθανών ευπαθειών βοηθά στην προστασία από επιθέσεις.

### Spoofing/MitM

Η πιο ενδιαφέρουσα επίθεση που μπορείτε να εκτελέσετε μέσω αυτής της υπηρεσίας είναι να πραγματοποιήσετε ένα **MitM** στην **επικοινωνία μεταξύ του πελάτη και του πραγματικού διακομιστή**. Μπορεί να είστε σε θέση να αποκτήσετε ευαίσθητα αρχεία (MitM την επικοινωνία με τον εκτυπωτή) ή ακόμα και διαπιστευτήρια (Windows authentication).\
Για περισσότερες πληροφορίες ελέγξτε:

{{#ref}}
../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## Αναφορές

- [Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things](https://books.google.co.uk/books/about/Practical_IoT_Hacking.html?id=GbYEEAAAQBAJ&redir_esc=y)

{{#include ../banners/hacktricks-training.md}}
