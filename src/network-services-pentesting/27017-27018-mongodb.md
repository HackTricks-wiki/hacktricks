# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Основна інформація

**MongoDB** — це система управління базами даних з **відкритим кодом**, яка використовує **модель бази даних, орієнтовану на документи**, для обробки різноманітних форм даних. Вона забезпечує гнучкість та масштабованість для керування неструктурованими або напівструктурованими даними в застосунках, таких як аналіз великих даних та управління контентом. **Default port:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Перерахування

### Вручну
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Декілька команд MongoDB:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Автоматично
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- All mongodb: `"mongodb server information"`
- Search for full open mongodb servers: `"mongodb server information" -"partially enabled"`
- Only partially enable auth: `"mongodb server information" "partially enabled"`

## Вхід

За замовчуванням mongo не вимагає пароля.\
**Admin** є поширеною базою даних у mongo.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Скрипт nmap: _**mongodb-brute**_ перевірить, чи потрібні creds.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Перегляньте вміст _/opt/bitnami/mongodb/mongodb.conf_, щоб дізнатися, чи потрібні облікові дані:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Приклад [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs are **12-byte hexadecimal** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

Наприклад, ось як можна розібрати фактичний Object ID, повернений застосунком: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 у десятковому = Friday, 31 July 2020 17:49:32
2. 9fa6dc: ідентифікатор машини
3. 2500: ID процесу
4. 314019: інкрементний лічильник

З перелічених елементів, ідентифікатор машини буде залишатися тим самим доти, доки база даних працює на тій самій фізичній/віртуальній машині. ID процесу зміниться тільки якщо процес MongoDB буде перезапущено. Мітка часу оновлюється щосекунди. Єдина складність при вгадуванні Object IDs простим інкрементуванням лічильника і значень мітки часу — те, що MongoDB генерує Object IDs і призначає їх на системному рівні.

Інструмент [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), враховуючи початковий Object ID (можна створити акаунт і отримати початковий ID), повертає приблизно 1000 імовірних Object IDs, які могли б бути призначені наступним об'єктам, тому вам залишається лише bruteforce їх.

## Post

Якщо ви root, ви можете **змінити** файл **mongodb.conf** так, щоб не потрібні були облікові дані (_noauth = true_) і **увійти без облікових даних**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

A widespread unauthenticated memory disclosure ("MongoBleed") impacts MongoDB 3.6–8.2 whenever the **zlib network compressor is enabled**. Під час декомпресії OP\_MSG MongoDB повертає **контролювану атакуючим довжину виділення замість реальної розпакованої довжини**, тому відповідь містить неініціалізовану пам'ять сервера, що належить іншим з'єднанням, файлам `/proc` або кешу WiredTiger.

### Exposure requirements & quick checks

- Версія сервера має належати до вразливих версій (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` or `networkMessageCompressors` must include `zlib` (default on many builds). Перевірте це з shell за допомогою:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- Зловмиснику потрібен лише мережевий доступ до порту MongoDB. Аутентифікація не потрібна.

### Процес експлуатації та збору даних

1. Ініціюйте wire-protocol handshake, вказавши `compressors:["zlib"]` і примусьте сесію використовувати zlib.
2. Надішліть спеціально сформовані стиснені OP\_MSG фрейми, у яких заявлений `uncompressedSize` значно перевищує реальний payload, через що MongoDB виділяє великий буфер.
3. Оскільки MongoDB копіює всю довжину буфера у відповідь, BSON parser трактує **сміттєві імена полів** як валідні дані, доки не зустріне `\x00`, leaking chunks of process memory on every response.
4. Варіюйте заявлену довжину документа/зсув, щоб обходити пам'ять процесу та агрегувати leaks.

Публічний PoC автоматизує підбір офсетів для зондування та вирізання повернутих фрагментів:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Перебір більших діапазонів зсуву послідовно дає:

- MongoDB внутрішні логи, UUID з'єднань, IP клієнтів та WireTiger stats.
- `/proc` артефакти, такі як `meminfo`, статистика сокетів або шляхи контейнерів, корисні для container escape або lateral movement.
- Секрети, які перебувають у пам'яті (database creds, API tokens, cloud keys, session cookies, etc.).

У великому масштабі нападники спочатку fingerprint інстанси `mongod` (наприклад, Censys виявив >87k відкритих сервісів), підтверджують version/compressor, а потім у циклі виконують вищевказану послідовність, щоб побудувати searchable dump of leaked strings для подальшого compromise.


## Посилання

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
