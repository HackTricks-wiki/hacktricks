# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Taarifa za Msingi

**MongoDB** ni mfumo wa usimamizi wa hifadhidata wa **chanzo wazi** unaotumia **mfano wa hifadhidata uliolengwa kwenye hati** kushughulikia aina mbalimbali za data. Unatoa kubadilika na uwezo wa kupanuka kwa kusimamia data zisizo na muundo au zenye muundo wa nusu katika programu kama vile uchambuzi wa data kubwa na usimamizi wa yaliyomo. **Bandari ya chaguo-msingi:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Uorodheshaji

### Kwa mkono
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Baadhi ya amri za MongoDB:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Otomatiki
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Mongodb zote: "mongodb server information"
- Tafuta server za mongodb zilizo wazi kabisa: "mongodb server information" -"partially enabled"
- Auth imewezeshwa kwa sehemu tu: "mongodb server information" "partially enabled"

## Login

Kwa chaguo-msingi mongo haiitaji nenosiri.\
**Admin** ni database ya kawaida ya mongo.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Skripti ya nmap: _**mongodb-brute**_ itakagua ikiwa creds zinahitajika.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Angalia ndani ya _/opt/bitnami/mongodb/mongodb.conf_ ili kujua kama credentials zinahitajika:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Example [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs are **12-byte hexadecimal** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

For example, here’s how we can dissect an actual Object ID returned by an application: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 in decimal = Ijumaa, 31 Julai 2020 17:49:32
2. 9fa6dc: Kitambulisho cha Mashine
3. 2500: Process ID
4. 314019: Kihesaji cha kuongezeka

Kati ya vipengele vilivyotajwa hapo juu, machine identifier itabaki ile ile kwa muda database ikitumia mashine sawa ya kimuundo/virtual. Process ID itabadilika tu ikiwa process ya MongoDB itaanza upya. Timestamp itasasishwa kila sekunde. Changamoto pekee katika kubahatisha Object IDs kwa kuongezea tu vihesaji na thamani za timestamp, ni ukweli kwamba MongoDB inatengeneza na kugawa Object IDs kwenye ngazi ya mfumo.

The tool [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), given a starting Object ID (you can create an account and get a starting ID), it sends back about 1000 probable Object IDs that could have possibly been assigned to the next objects, so you just need to bruteforce them.

## Post

Ikiwa wewe ni root unaweza **modify** faili ya **mongodb.conf** ili hakuna credentials zinahitajika (_noauth = true_) na **kuingia bila credentials**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

Uvujaji wa kumbukumbu usiohitaji uthibitisho ("MongoBleed") unaoenea unaathiri MongoDB 3.6–8.2 wakati wowote **zlib network compressor is enabled**. Wakati wa OP_MSG decompression MongoDB inarudisha **attacker-controlled allocation length badala ya real uncompressed length**, hivyo jibu lina nafasi za kumbukumbu za server ambazo hazijasajiliwa na zinamilikiwa na connections nyingine, faili za `/proc`, au cache ya WiredTiger.

### Exposure requirements & quick checks

- Server version lazima iwe ndani ya ranges zilizo hatarini (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` au `networkMessageCompressors` lazima ziwe na `zlib` (default on many builds). Check it from the shell with:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- Mshambuliaji anahitaji tu upatikanaji wa mtandao kwa port ya MongoDB. Hakuna uthibitishaji unahitajika.

### Exploitation & harvesting workflow

1. Anzisha handshake ya wire-protocol huku ukionyesha `compressors:["zlib"]` na kulazimisha kikao kutumia zlib.
2. Tuma fremu za OP\_MSG zilizobanwa na zimetengenezwa mahsusi ambazo `uncompressedSize` waliotaja ni kubwa mno kuliko payload halisi ili MongoDB itenge buffer kubwa.
3. Kwa sababu MongoDB inanakili urefu mzima wa buffer katika reply, BSON parser huchukulia **garbage field names** kama data halali mpaka itakapofika `\x00`, na hivyo leaking vipande vya kumbukumbu ya process kwa kila response.
4. Badilisha urefu/offset ya document uliodaiwa ili kutembea ndani ya kumbukumbu ya process na kujumlisha leaks.

The public PoC inafanya kiotomatiki offsets za uchunguzi na kuchonga fragments zilizorejeshwa:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Kukimbia anuwai kubwa za offset mara kwa mara kunatoa:

- Logi za ndani za MongoDB, connection UUIDs, client IPs na WireTiger stats.
- Mabaki ya `/proc` kama `meminfo`, takwimu za socket au container paths zinazosaidia container escape au lateral movement.
- Siri ambazo ziko ndani ya memory (database creds, API tokens, cloud keys, session cookies, n.k.).

Kwa kiwango kikubwa, attackers kwanza hufingerprint `mongod` instances (mfano, Censys iliona >87k exposed services), kuthibitisha version/compressor, kisha kuzungusha mfululizo hapo juu ili kujenga searchable dump ya leaked strings kwa compromise inayofuata.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
