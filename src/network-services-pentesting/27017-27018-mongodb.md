# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## बुनियादी जानकारी

**MongoDB** एक **ओपन सोर्स** डेटाबेस प्रबंधन प्रणाली है जो विभिन्न प्रकार के डेटा को संभालने के लिए एक **दस्तावेज़-उन्मुख डेटाबेस मॉडल** का उपयोग करती है। यह अनस्ट्रक्चर्ड या अर्ध-संरचित डेटा को प्रबंधित करने के लिए लचीलापन और स्केलेबिलिटी प्रदान करती है, जैसे कि बिग डेटा एनालिटिक्स और कंटेंट मैनेजमेंट जैसी एप्लिकेशन में। **Default port:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## सूचीकरण

### मैनुअल
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**कुछ MongoDB कमांड्स:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### स्वचालित
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- सभी mongodb: "mongodb server information"
- पूर्ण रूप से खुले mongodb सर्वरों को खोजें: "mongodb server information" -"partially enabled"
- केवल आंशिक रूप से auth सक्षम: "mongodb server information" "partially enabled"

## लॉगिन

डिफ़ॉल्ट रूप से mongo को पासवर्ड की आवश्यकता नहीं होती।\
**Admin** सामान्य mongo डेटाबेस है।
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
यह nmap script: _**mongodb-brute**_ जांचेगा कि creds की आवश्यकता है या नहीं।
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

देखें _/opt/bitnami/mongodb/mongodb.conf_ के अंदर कि क्या credentials की आवश्यकता है:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Example [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs are **12-बाइट हेक्साडेसिमल** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

For example, here’s how we can dissect an actual Object ID returned by an application: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 in decimal = Friday, 31 July 2020 17:49:32
2. 9fa6dc: Machine Identifier
3. 2500: Process ID
4. 314019: An incremental counter

ऊपर दिए गए तत्वों में, machine identifier वही रहेगा जब तक कि database उसी physical/virtual machine पर चल रहा हो। Process ID केवल तब बदलेगा जब MongoDB प्रक्रिया को restart किया जाए। Timestamp हर सेकंड अपडेट होगा। Object IDs को सिर्फ counter और timestamp मानों को बढ़ाकर अनुमान लगाने में एकमात्र चुनौती यह है कि MongoDB सिस्टम स्तर पर Object IDs बनाता और असाइन करता है।

The tool [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), given a starting Object ID (you can create an account and get a starting ID), it sends back about 1000 probable Object IDs that could have possibly been assigned to the next objects, so you just need to bruteforce them.

## Post

यदि आप root हैं तो आप **mongodb.conf** फ़ाइल को **संपादित** कर सकते हैं ताकि किसी credentials की आवश्यकता न हो (_noauth = true_) और बिना credentials के **login** कर सकें।

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

एक व्यापक अनप्रमाणीकृत मेमोरी डिस्क्लोज़र ("MongoBleed") MongoDB 3.6–8.2 को प्रभावित करता है whenever the **zlib network compressor is enabled**. During OP\_MSG decompression MongoDB returns the **attacker-controlled allocation length instead of the real uncompressed length**, इसलिए reply में uninitialized server memory आ सकती है जो कि अन्य connections, `/proc` फाइलें, या WiredTiger cache की हो सकती है।

### Exposure requirements & quick checks

- Server version must be within the vulnerable ranges (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` or `networkMessageCompressors` must include `zlib` (default on many builds). Check it from the shell with:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- attacker केवल MongoDB पोर्ट तक नेटवर्क एक्सेस की आवश्यकता रखता है। No authentication आवश्यक है।

### Exploitation & harvesting workflow

1. `compressors:["zlib"]` का विज्ञापन करते हुए wire-protocol handshake शुरू करें और session को zlib उपयोग करने के लिए बाध्य करें।
2. crafted compressed OP\_MSG frames भेजें जिनकी घोषित `uncompressedSize` वास्तविक payload से बहुत बड़ी हो ताकि MongoDB एक विशाल buffer allocate करे।
3. क्योंकि MongoDB पूरी buffer length को reply में copy करता है, BSON parser **garbage field names** को वैध डेटा मानता है जब तक यह `\x00` पर न पहुँच जाए, और हर response पर process memory के टुकड़े leak होते हैं।
4. claimed document length/offset बदलकर process memory में walk करें और leaks को aggregate करें।

The public PoC probing offsets और returned fragments की carving को automate करता है:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
बड़े offset ranges चलाने पर लगातार निम्न मिलता है:

- MongoDB internal logs, connection UUIDs, client IPs और WireTiger stats.
- `/proc` artifacts जैसे `meminfo`, socket statistics या container paths जो container escape या lateral movement में मददगार होते हैं।
- वे Secrets जो memory में resident होते हैं (database creds, API tokens, cloud keys, session cookies, आदि)।

बड़े पैमाने पर, attackers पहले `mongod` instances का fingerprint बनाते हैं (उदा., Censys ने >87k exposed services देखे), version/compressor की पुष्टि करते हैं, फिर ऊपर दिए गए क्रम को दोहराकर leaked strings का searchable dump बनाते हैं ताकि follow-on compromise किया जा सके।

## संदर्भ

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
