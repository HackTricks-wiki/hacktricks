# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Basiese Inligting

**MongoDB** is 'n **open source** databasisbestuurstelsel wat 'n **dokument-georiënteerde databasismodel** gebruik om uiteenlopende vorme van data te hanteer. Dit bied buigbaarheid en skaalbaarheid vir die bestuur van ongestruktureerde of semi-gestruktureerde data in toepassings soos big data-analise en inhoudsbestuur. **Standaardpoort:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Enumerasie

### Handmatig
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Sommige MongoDB kommando's:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Outomaties
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Alle mongodb: `"mongodb server information"`
- Soek na volledig oop mongodb-bedieners: `"mongodb server information" -"partially enabled"`
- Slegs gedeeltelik geaktiveerde auth: `"mongodb server information" "partially enabled"`

## Login

Standaard vereis mongo nie 'n wagwoord nie.\
**Admin** is 'n algemene mongo-databasis.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Die nmap-skrip: _**mongodb-brute**_ sal kyk of creds benodig word.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Kyk in _/opt/bitnami/mongodb/mongodb.conf_ om te sien of credentials nodig is:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Voorspelling

Voorbeeld [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs are **12-byte hexadecimal** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

Byvoorbeeld, hier is hoe ons 'n werklike Object ID wat deur 'n toepassing teruggegee is, kan ontleed: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 in desimaal = Vrydag, 31 Julie 2020 17:49:32
2. 9fa6dc: Masjienidentifiseerder
3. 2500: Proses-ID
4. 314019: 'n inkrementele teller

Van bogenoemde elemente sal die masjienidentifiseerder dieselfde bly solank die databasis op dieselfde fisiese/virtuele masjien loop. Proses-ID sal slegs verander as die MongoDB-proses herbegin word. Timestamp word elke sekonde opgedateer. Die enigste uitdaging om Object IDs te raai deur bloot die teller- en timestamp-waardes te verhoog, is die feit dat MongoDB Object IDs op stelselvlak genereer en toewys.

Die tool [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), gegewe 'n begin Object ID (jy kan 'n rekening skep en 'n begin-ID kry), stuur dit terug ongeveer 1000 waarskynlike Object IDs wat moontlik aan die volgende objekke toegeken kon wees, so jy hoef dit net te bruteforce.

## Post

As jy root is kan jy die **mongodb.conf**-lêer wysig sodat geen inlogbesonderhede benodig word nie (_noauth = true_) en sonder inlogbesonderhede aanmeld.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

'n Wydverspreide ongemagtigde geheue-onthulling ("MongoBleed") affekteer MongoDB 3.6–8.2 wanneer die **zlib network compressor is enabled**. Tydens OP\_MSG-dekompressie stuur MongoDB die **deur 'n aanvaller beheerde toewysingslengte in plaas van die werklike ongedrukte lengte**, sodat die antwoord ongeïnisialiseerde bedienergeheue bevat wat aan ander verbindings, `/proc`-lêers, of die WiredTiger-cache behoort.

### Blootstellingsvereistes en vinnige kontroles

- Bedienerweergawe moet binne die kwesbare reekse wees (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` or `networkMessageCompressors` must include `zlib` (standaard op baie builds). Check it from the shell with:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- Die aanvaller het slegs netwerktoegang tot die MongoDB-poort nodig. Geen verifikasie is nodig nie.

### Exploitation & harvesting workflow

1. Begin die wire-protocol handshake terwyl jy `compressors:["zlib"]` adverteer en dwing die sessie om zlib te gebruik.
2. Stuur vervaardigde gecomprimeerde OP\_MSG frames waarvan die verklaarde `uncompressedSize` veel groter is as die werklike payload, sodat MongoDB 'n reuse buffer toewys.
3. Omdat MongoDB die hele bufferlengte in die antwoord kopieer, behandel die BSON-parser **rommel veldname** as geldige data totdat dit `\x00` bereik, leaking stukkies van prosesgeheue by elke reaksie.
4. Varieer die beweerde dokumentlengte/offset om deur prosesgeheue te loop en die leaks te aggregeer.

Die publieke PoC outomatiseer die probe-offsets en die uitlees van die teruggestuurde fragmente:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Om wyer offset-reekse te gebruik lewer dit konsekwent:

- MongoDB interne logs, connection UUIDs, client IPs en WireTiger stats.
- `/proc`-artefakte soos `meminfo`, socket-statistieke of container paths wat nuttig is vir container escape of lateral movement.
- Geheime wat toevallig in geheue resident is (database creds, API tokens, cloud keys, session cookies, etc.).

Op skaal identifiseer aanvallers eers `mongod`-instansies (bv. Censys het >87k blootgestelde dienste gesien), bevestig die version/compressor, en herhaal dan die bogenoemde volgorde om 'n deursoekbare dump van leaked strings te bou vir verdere kompromittering.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
