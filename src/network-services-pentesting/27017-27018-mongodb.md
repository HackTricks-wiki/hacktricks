# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Osnovne informacije

**MongoDB** je sistem za upravljanje bazama podataka otvorenog koda koji koristi **dokument-orijentisani model baze podataka** za rukovanje raznovrsnim oblicima podataka. Pruža fleksibilnost i skalabilnost za upravljanje nestrukturiranim ili polustrukturiranim podacima u aplikacijama kao što su analitika velikih podataka i upravljanje sadržajem. **Podrazumevani port:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Enumeracija

### Ručna
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Neke MongoDB komande:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Automatski
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Svi mongodb serveri: "mongodb server information"
- Traži potpuno otvorene mongodb servere: "mongodb server information" -"partially enabled"
- Samo delimično omogućena autentifikacija: "mongodb server information" "partially enabled"

## Prijava

Podrazumevano mongo ne zahteva lozinku.\
**Admin** je česta mongo baza podataka.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
nmap skripta: _**mongodb-brute**_ će proveriti da li su creds potrebni.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Pogledajte u _/opt/bitnami/mongodb/mongodb.conf_ da biste saznali da li su credentials potrebni:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Primer [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs su **12-bajtni heksadecimalni** stringovi:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

Na primer, ovako možemo rastaviti stvarni Object ID koji vraća aplikacija: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 u decimalnom = Friday, 31 July 2020 17:49:32
2. 9fa6dc: Machine Identifier
3. 2500: Process ID
4. 314019: An incremental counter

Od gore navedenih elemenata, machine identifier će ostati isti dok baza radi na istoj fizičkoj/virtuelnoj mašini. Process ID će se promeniti samo ako se MongoDB proces restartuje. Timestamp se ažurira svake sekunde. Jedini izazov pri pogađanju Object ID-ova jednostavnim inkrementiranjem counter i timestamp vrednosti je činjenica da MongoDB generiše i dodeljuje Object ID-ove na sistemskom nivou.

Alat [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), dajući početni Object ID (možete napraviti nalog i dobiti početni ID), vraća oko 1000 verovatnih Object ID-ova koji su mogli biti dodeljeni narednim objektima, tako da ih samo treba bruteforce-ovati.

## Post

Ako ste root možete **modify** fajl **mongodb.conf** tako da nisu potrebni kredencijali (_noauth = true_) i **login without credentials**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

Rasprostranjeno neautentifikovano otkrivanje memorije ("MongoBleed") utiče na MongoDB 3.6–8.2 kad god je **zlib network compressor is enabled**. Tokom OP\_MSG dekompresije MongoDB vraća **attacker-controlled allocation length umesto stvarne nekompresovane dužine**, tako da odgovor sadrži neinicijalizovanu memoriju servera koja pripada drugim konekcijama, `/proc` fajlovima, ili WiredTiger cache-u.

### Zahtevi izloženosti i brze provere

- Verzija servera mora biti u okviru ranjivih opsega (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` ili `networkMessageCompressors` mora da uključi `zlib` (podrazumevano na mnogim build-ovima). Proverite iz shell-a sa:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- Napadaču je potreban samo mrežni pristup MongoDB portu. Autentifikacija nije potrebna.

### Exploitation & harvesting workflow

1. Pokrenite wire-protocol handshake dok reklamirate `compressors:["zlib"]` i primorajte sesiju da koristi zlib.
2. Pošaljite posebno pripremljene kompresovane OP\_MSG frejmove čija deklarisana `uncompressedSize` je mnogo veća od stvarnog payload-a, tako da MongoDB alocira ogroman buffer.
3. Pošto MongoDB kopira celu dužinu buffera u odgovor, BSON parser tretira **nevalidna imena polja** kao validne podatke dok ne naiđe na `\x00`, leaking delove memorije procesa pri svakom odgovoru.
4. Varirajte deklarisanu dužinu/offset dokumenta da biste šetali memorijom procesa i agregirali leaks.

The public PoC automates the probing offsets and carving of the returned fragments:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Pokretanje većih opsega offset-a dosledno daje:

- interni logovi MongoDB-a, UUID-ovi konekcija, IP adrese klijenata i WireTiger statistike.
- `/proc` artifakti kao što su `meminfo`, statistike soketa ili putanje kontejnera korisne za container escape ili lateral movement.
- tajne koje se nalaze u memoriji (database creds, API tokens, cloud keys, session cookies, itd.).

Na velikoj skali, napadači prvo fingerprintuju `mongod` instance (npr. Censys je video >87k izloženih servisa), potvrde verziju/kompresor, a zatim ponavljaju gore navedenu sekvencu da izgrade pretraživi dump of leaked strings za dalju kompromitaciju.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
