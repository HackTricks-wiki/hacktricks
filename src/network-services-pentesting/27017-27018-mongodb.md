# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Información básica

**MongoDB** es un sistema de gestión de bases de datos de **código abierto** que utiliza un **modelo de base de datos orientado a documentos** para manejar formas diversas de datos. Ofrece flexibilidad y escalabilidad para gestionar datos no estructurados o semiestructurados en aplicaciones como análisis de big data y gestión de contenido. **Puerto por defecto:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Enumeración

### Manual
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Algunos comandos de MongoDB:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Automático
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Todos los servidores mongodb: `"mongodb server information"`
- Buscar servidores mongodb completamente abiertos: `"mongodb server information" -"partially enabled"`
- Solo auth parcialmente habilitada: `"mongodb server information" "partially enabled"`

## Inicio de sesión

Por defecto mongo no requiere contraseña.\
**Admin** es una base de datos mongo común.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
El script de nmap: _**mongodb-brute**_ comprobará si se necesitan creds.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Revisa dentro de _/opt/bitnami/mongodb/mongodb.conf_ para saber si se necesitan credenciales:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Example [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Los Mongo Object IDs son **12-byte hexadecimal** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

For example, here’s how we can dissect an actual Object ID returned by an application: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 in decimal = viernes, 31 de julio de 2020 17:49:32
2. 9fa6dc: Identificador de máquina
3. 2500: ID del proceso
4. 314019: Un contador incremental

De los elementos anteriores, el identificador de máquina permanecerá igual mientras la base de datos se esté ejecutando en la misma máquina física/virtual. El ID del proceso solo cambiará si el proceso de MongoDB se reinicia. El timestamp se actualizará cada segundo. El único desafío al adivinar Object IDs simplemente incrementando el contador y los valores de timestamp, es el hecho de que MongoDB genera y asigna Object IDs a nivel del sistema.

The tool [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), given a starting Object ID (you can create an account and get a starting ID), it sends back about 1000 probable Object IDs that could have possibly been assigned to the next objects, so you just need to bruteforce them.

## Post

Si eres root puedes **modificar** el archivo **mongodb.conf** para que no se necesiten credenciales (_noauth = true_) y **loguearte sin credenciales**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

A widespread unauthenticated memory disclosure ("MongoBleed") impacts MongoDB 3.6–8.2 whenever the **zlib network compressor is enabled**. During OP\_MSG decompression MongoDB returns the **attacker-controlled allocation length instead of the real uncompressed length**, so the reply contains uninitialized server memory that belongs to other connections, `/proc` files, or the WiredTiger cache.

### Requisitos de exposición & comprobaciones rápidas

- La versión del servidor debe estar dentro de los rangos vulnerables (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` o `networkMessageCompressors` deben incluir `zlib` (por defecto en muchas builds). Compruébalo desde el shell con:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- El atacante solo necesita acceso de red al puerto de MongoDB. No se requiere autenticación.

### Exploitation & harvesting workflow

1. Iniciar el handshake del wire-protocol mientras se anuncia `compressors:["zlib"]` y forzar la sesión a usar zlib.
2. Enviar frames OP\_MSG comprimidos especialmente creados cuyo `uncompressedSize` declarado sea mucho mayor que la carga útil real, de modo que MongoDB asigne un buffer enorme.
3. Debido a que MongoDB copia la longitud completa del buffer en la respuesta, el BSON parser trata **nombres de campo basura** como datos válidos hasta que encuentra un `\x00`, leaking fragmentos de la memoria del proceso en cada respuesta.
4. Variar la longitud/offset declarados del documento para recorrer la memoria del proceso y agregar leaks.

The public PoC automates the probing offsets and carving of the returned fragments:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Running wider offset ranges consistently yields:

- MongoDB internal logs, connection UUIDs, client IPs and WireTiger stats.
- `/proc` artifacts such as `meminfo`, socket statistics or container paths helpful for container escape or lateral movement.
- Secrets that happen to be resident in memory (database creds, API tokens, cloud keys, session cookies, etc.).

A gran escala, los atacantes primero fingerprint `mongod` instances (p. ej., Censys saw >87k exposed services), confirman la version/compressor, y luego repiten la secuencia anterior para construir un dump searchable de leaked strings para compromisos posteriores.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
