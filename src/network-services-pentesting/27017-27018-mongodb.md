# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

**MongoDB** bir **açık kaynak** veritabanı yönetim sistemidir ve çeşitli veri biçimlerini işlemek için bir **belge odaklı veritabanı modeli** kullanır. Yapısal olmayan veya yarı-yapısal verilerin yönetimi için esneklik ve ölçeklenebilirlik sağlar; büyük veri analitiği ve içerik yönetimi gibi uygulamalarda kullanılır. **Varsayılan port:** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Keşif

### Manuel
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Bazı MongoDB komutları:**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Otomatik
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Tüm mongodb: `"mongodb server information"`
- Tamamen açık mongodb sunucularını ara: `"mongodb server information" -"partially enabled"`
- Sadece kısmen etkinleştirilmiş auth: `"mongodb server information" "partially enabled"`

## Giriş

Varsayılan olarak mongo parola gerektirmez.\
**Admin** yaygın bir mongo veritabanıdır.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
nmap scripti: _**mongodb-brute**_ creds'in gerekli olup olmadığını kontrol eder.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Credentials gerekip gerekmediğini öğrenmek için _/opt/bitnami/mongodb/mongodb.conf_ dosyasına bakın:
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Örnek [buradan](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Mongo Object IDs are **12-byte hexadecimal** strings:

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

Örneğin, bir uygulamanın döndürdüğü gerçek bir Object ID'yi şu şekilde ayrıştırabiliriz: 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 onluk = Cuma, 31 Temmuz 2020 17:49:32
2. 9fa6dc: Makine Tanımlayıcısı
3. 2500: İşlem Kimliği (PID)
4. 314019: Artan sayaç

Yukarıdaki öğelerden, makine tanımlayıcısı veritabanı aynı fiziksel/sanal makinede çalıştığı sürece aynı kalır. İşlem kimliği yalnızca MongoDB işlemi yeniden başlatılırsa değişir. Zaman damgası her saniye güncellenir. Sayaç ve zaman damgası değerlerini basitçe artırarak Object ID'leri tahmin etmedeki tek zorluk, MongoDB'nin Object ID'leri sistem seviyesinde oluşturup atamasıdır.

Araç [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), bir başlangıç Object ID verildiğinde (bir hesap oluşturup başlangıç ID'si alabilirsiniz), bir sonraki objelere atanmış olabilecek yaklaşık 1000 olası Object ID döndürür, böylece bunları sadece bruteforce yapmanız yeterlidir.

## Post

Eğer root iseniz **mongodb.conf** dosyasını **değiştirerek** kimlik bilgisi gerekmeyecek şekilde (_noauth = true_) ayarlayabilir ve **kimlik bilgisi olmadan giriş yapabilirsiniz**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

Geniş çapta doğrulanmamış bir bellek açığa çıkarma ("MongoBleed"), **zlib ağ sıkıştırıcısı etkin olduğunda** MongoDB 3.6–8.2 sürümlerini etkiler. OP\_MSG decompression sırasında MongoDB, gerçek açılmamış uzunluk yerine **saldırganın kontrolündeki tahsis uzunluğunu** döndürür; bu nedenle yanıt, diğer bağlantılara, `/proc` dosyalarına veya WiredTiger önbelleğine ait başlatılmamış sunucu belleğini içerir.

### Açığa çıkma gereksinimleri ve hızlı kontroller

- Sunucu sürümü belirtilen savunmasız aralıkta olmalıdır (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` veya `networkMessageCompressors` içinde `zlib` bulunmalıdır (birçok build'te varsayılan). Bunu shell'den şu komutla kontrol edin:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- Saldırganın yalnızca MongoDB portuna ağ erişimi olması yeterlidir. Kimlik doğrulaması gerekli değildir.

### Exploitation & harvesting workflow

1. `compressors:["zlib"]`'ü ilan ederken wire-protocol handshake'ini başlatın ve oturumun zlib kullanmasını zorlayın.
2. İlan edilen `uncompressedSize` gerçek payload'dan çok daha büyük olan hazırlanmış sıkıştırılmış OP_MSG frame'lerini gönderin; böylece MongoDB devasa bir buffer ayırır.
3. MongoDB tüm buffer uzunluğunu reply'e kopyaladığından, BSON parser **garbage field names**'i geçerli veri olarak işler; `\x00`'a ulaşana kadar devam eder ve her yanıtta leaking chunks of process memory oluşur.
4. İddia edilen document length/offset'i değiştirerek process memory üzerinde gezin ve leaks'leri topla.

The public PoC automates the probing offsets and carving of the returned fragments:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
Daha geniş offset aralıklarını çalıştırmak tutarlı şekilde şunları ortaya çıkarır:

- MongoDB iç logları, connection UUID'ları, client IP'leri ve WireTiger istatistikleri.
- `/proc` artefaktları (örn. `meminfo`), socket istatistikleri veya container path'leri — container escape veya lateral movement için faydalı.
- Bellekte bulunan gizli veriler (database creds, API tokens, cloud keys, session cookies vb.).

Büyük ölçekte, saldırganlar önce `mongod` instance'larını fingerprint'ler (örn. Censys >87k exposed services gördü), version/compressor'ı doğrular; sonra yukarıdaki işlemi döngüsel olarak tekrarlayarak follow-on compromise için searchable dump of leaked strings oluştururlar.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
