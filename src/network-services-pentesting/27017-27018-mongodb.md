# 27017,27018 - Pentesting MongoDB

{{#include ../banners/hacktricks-training.md}}

## Informations de base

**MongoDB** est un système de gestion de base de données **open source** qui utilise un modèle de base de données **orienté document** pour gérer diverses formes de données. Il offre flexibilité et scalabilité pour la gestion de données non structurées ou semi-structurées dans des applications telles que l'analytique Big Data et la gestion de contenu. **Port par défaut :** 27017, 27018
```
PORT      STATE SERVICE VERSION
27017/tcp open  mongodb MongoDB 2.6.9 2.6.9
```
## Énumération

### Manuel
```python
from pymongo import MongoClient
client = MongoClient(host, port, username=username, password=password)
client.server_info() #Basic info
#If you have admin access you can obtain more info
admin = client.admin
admin_info = admin.command("serverStatus")
cursor = client.list_databases()
for db in cursor:
print(db)
print(client[db["name"]].list_collection_names())
#If admin access, you could dump the database also
```
**Quelques commandes MongoDB :**
```bash
show dbs
use <db>
show collections
db.<collection>.find()  #Dump the collection
db.<collection>.count() #Number of records of the collection
db.current.find({"username":"admin"})  #Find in current db the username admin
```
### Automatique
```bash
nmap -sV --script "mongo* and default" -p 27017 <IP> #By default all the nmap mongo enumerate scripts are used
```
### Shodan

- Tous les mongodb: `"mongodb server information"`
- Rechercher les serveurs mongodb complètement ouverts: `"mongodb server information" -"partially enabled"`
- auth partiellement activée: `"mongodb server information" "partially enabled"`

## Login

Par défaut, mongo ne requiert pas de mot de passe.\
**Admin** est une base de données mongo courante.
```bash
mongo <HOST>
mongo <HOST>:<PORT>
mongo <HOST>:<PORT>/<DB>
mongo <database> -u <username> -p '<password>'
```
Le script nmap : _**mongodb-brute**_ vérifiera si des creds sont nécessaires.
```bash
nmap -n -sV --script mongodb-brute -p 27017 <ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#mongo)

Consultez _/opt/bitnami/mongodb/mongodb.conf_ pour savoir si des credentials sont nécessaires :
```bash
grep "noauth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#" #Not needed
grep "auth.*true" /opt/bitnami/mongodb/mongodb.conf | grep -v "^#\|noauth" #Not needed
```
## Mongo Objectid Predict

Example [from here](https://techkranti.com/idor-through-mongodb-object-ids-prediction/).

Les Mongo Object IDs sont des chaînes hexadécimales de **12 octets** :

![http://techidiocy.com/_id-objectid-in-mongodb/](../images/id-and-ObjectIds-in-MongoDB.png)

Par exemple, voici comment on peut disséquer un Object ID réel renvoyé par une application : 5f2459ac9fa6dc2500314019

1. 5f2459ac: 1596217772 en décimal = Friday, 31 July 2020 17:49:32
2. 9fa6dc: Identifiant machine
3. 2500: Process ID
4. 314019: Un compteur incrémental

Parmi ces éléments, l'identifiant machine restera le même tant que la base de données tourne sur la même machine physique/virtuelle. Le Process ID ne changera que si le processus MongoDB est redémarré. Le timestamp est mis à jour chaque seconde. Le seul défi pour deviner les Object IDs en incrémentant simplement les valeurs du compteur et du timestamp est le fait que Mongo DB génère et assigne les Object IDs au niveau système.

L'outil [https://github.com/andresriancho/mongo-objectid-predict](https://github.com/andresriancho/mongo-objectid-predict), étant donné un Object ID de départ (vous pouvez créer un compte et obtenir un ID de départ), renvoie environ 1000 Object IDs probables qui auraient pu être attribués aux objets suivants — il ne vous reste donc plus qu'à bruteforce les ID.

## Post

If you are root you can **modify** the **mongodb.conf** file so no credentials are needed (_noauth = true_) and **login without credentials**.

## MongoBleed zlib Memory Disclosure (CVE-2025-14847)

A widespread unauthenticated memory disclosure ("MongoBleed") impacts MongoDB 3.6–8.2 whenever the **zlib network compressor is enabled**. During OP\_MSG decompression MongoDB returns the **attacker-controlled allocation length instead of the real uncompressed length**, so the reply contains uninitialized server memory that belongs to other connections, `/proc` files, or the WiredTiger cache.

### Conditions d'exposition et vérifications rapides

- La version du serveur doit être dans les plages vulnérables (3.6, 4.0, 4.2, 4.4.0–4.4.29, 5.0.0–5.0.31, 6.0.0–6.0.26, 7.0.0–7.0.27, 8.0.0–8.0.16, 8.2.0–8.2.2).
- `net.compression.compressors` or `networkMessageCompressors` must include `zlib` (default on many builds). Check it from the shell with:
```javascript
db.adminCommand({getParameter: 1, networkMessageCompressors: 1})
```
- L'attaquant n'a besoin que d'un accès réseau au port MongoDB. Aucune authentification n'est nécessaire.

### Flux d'exploitation et de collecte

1. Initier le handshake du wire-protocol tout en annonçant `compressors:["zlib"]` et forcer la session à utiliser zlib.
2. Envoyer des trames OP\_MSG compressées conçues dont la `uncompressedSize` déclarée est bien plus grande que la payload réelle afin que MongoDB alloue un énorme buffer.
3. Parce que MongoDB copie la longueur totale du buffer dans la réponse, le BSON parser traite **noms de champs garbage** comme des données valides jusqu'à ce qu'il rencontre un `\x00`, leaking des morceaux de mémoire du processus à chaque réponse.
4. Varier la longueur/décalage du document déclaré pour parcourir la mémoire du processus et agréger les leaks.

Le PoC public automatise les offsets de probing et le carving des fragments retournés:
```bash
python3 mongobleed.py --host <target> --max-offset 50000 --output leaks.bin
```
L'exécution de plages d'offset plus larges produit systématiquement :

- les logs internes de MongoDB, les connection UUIDs, les client IPs et les WireTiger stats.
- les artifacts `/proc` tels que `meminfo`, les socket statistics ou des chemins de conteneur utiles pour container escape ou lateral movement.
- des secrets résidant en mémoire (database creds, API tokens, cloud keys, session cookies, etc.).

À grande échelle, les attaquants commencent par fingerprint des instances `mongod` (par ex., Censys a observé >87k services exposés), confirment la version/compressor, puis bouclent sur la séquence ci‑dessus pour construire un dump consultable de leaked strings en vue de compromissions ultérieures.


## References

- [Tenable – CVE-2025-14847 (MongoBleed): MongoDB Memory Leak Vulnerability Exploited in the Wild](https://www.tenable.com/blog/cve-2025-14847-mongobleed-mongodb-memory-leak-vulnerability-exploited-in-the-wild)
- [MongoDB Security Advisory SERVER-115508](https://jira.mongodb.org/browse/SERVER-115508)
- [Censys – MongoBleed Advisory](https://censys.com/advisory/cve-2025-14847)
- [MongoBleed PoC (joe-desimone/mongobleed)](https://github.com/joe-desimone/mongobleed)

---

{{#include ../banners/hacktricks-training.md}}
