{{#include ../banners/hacktricks-training.md}}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Bu, [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/) adresinden yapılan bir gönderinin özetidir.

## Metasploit ile SAProuter Penetrasyonu Anlama

SAProuter, SAP sistemleri için bir ters proxy olarak işlev görür ve esasen internet ile dahili SAP ağları arasındaki erişimi kontrol etmek için kullanılır. Genellikle, organizasyonel güvenlik duvarları aracılığıyla TCP port 3299'un açılmasıyla internete maruz bırakılır. Bu yapı, SAProuter'ı penetrasyon testi için cazip bir hedef haline getirir çünkü yüksek değerli dahili ağlara bir geçit işlevi görebilir.

**Tarama ve Bilgi Toplama**

Başlangıçta, belirli bir IP adresinde bir SAP yönlendiricisinin çalışıp çalışmadığını belirlemek için **sap_service_discovery** modülü kullanılarak bir tarama gerçekleştirilir. Bu adım, bir SAP yönlendiricisinin varlığını ve açık portunu belirlemek için kritik öneme sahiptir.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Keşif sonrasında, **sap_router_info_request** modülü ile SAP yönlendiricisinin yapılandırması üzerinde daha fazla araştırma yapılır ve bu, potansiyel olarak iç ağ detaylarını ortaya çıkarabilir.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**İç Hizmetlerin Sayımı**

Elde edilen iç ağ bilgileriyle, **sap_router_portscanner** modülü, SAProuter aracılığıyla iç hostları ve hizmetleri sorgulamak için kullanılır ve bu da iç ağlar ve hizmet yapılandırmaları hakkında daha derin bir anlayış sağlar.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Bu modülün belirli SAP örneklerine ve portlara hedefleme esnekliği, detaylı iç ağ keşfi için etkili bir araç olmasını sağlar.

**Gelişmiş Sayım ve ACL Haritalama**

Daha fazla tarama, SAProuter üzerindeki Erişim Kontrol Listelerinin (ACL) nasıl yapılandırıldığını, hangi bağlantıların izin verildiğini veya engellendiğini ortaya çıkarabilir. Bu bilgi, güvenlik politikalarını ve potansiyel zayıflıkları anlamada kritik öneme sahiptir.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**İç Hostların Kayıt Dışı Sayımı**

SAProuter'dan doğrudan bilgi sınırlı olduğunda, kayıt dışı sayım gibi teknikler uygulanabilir. Bu yaklaşım, iç hostname'lerin varlığını tahmin etmeye ve doğrulamaya çalışarak, doğrudan IP adresleri olmadan potansiyel hedefleri ortaya çıkarır.

**Sızma Testi için Bilgilerin Kullanımı**

Ağı haritaladıktan ve erişilebilir hizmetleri belirledikten sonra, sızma test uzmanları Metasploit'in proxy yeteneklerini kullanarak SAProuter üzerinden iç SAP hizmetlerinin daha fazla keşfi ve istismarı için geçiş yapabilirler.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Sonuç**

Bu yaklaşım, güvenli SAProuter yapılandırmalarının önemini vurgular ve hedefli pentesting ile iç ağlara erişim potansiyelini öne çıkarır. SAP yönlendiricilerini doğru bir şekilde güvence altına almak ve ağ güvenliği mimarisindeki rollerini anlamak, yetkisiz erişime karşı korunmak için kritik öneme sahiptir.

Metasploit modülleri ve bunların kullanımı hakkında daha ayrıntılı bilgi için [Rapid7'nin veritabanını](http://www.rapid7.com/db) ziyaret edin.

## **Kaynaklar**

- [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

- `port:3299 !HTTP Ağ paketi çok büyük`

{{#include ../banners/hacktricks-training.md}}
