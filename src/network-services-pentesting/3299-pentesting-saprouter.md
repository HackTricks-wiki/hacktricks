{{#include ../banners/hacktricks-training.md}}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Αυτό είναι μια περίληψη της ανάρτησης από [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Κατανόηση της Διείσδυσης του SAProuter με το Metasploit

Ο SAProuter λειτουργεί ως αντίστροφος διακομιστής μεσολάβησης για τα συστήματα SAP, κυρίως για τον έλεγχο της πρόσβασης μεταξύ του διαδικτύου και των εσωτερικών δικτύων SAP. Συνήθως εκτίθεται στο διαδίκτυο επιτρέποντας την TCP θύρα 3299 μέσω των οργανωτικών τειχών προστασίας. Αυτή η ρύθμιση καθιστά τον SAProuter ελκυστικό στόχο για pentesting, καθώς μπορεί να λειτουργήσει ως πύλη προς πολύτιμα εσωτερικά δίκτυα.

**Σάρωση και Συλλογή Πληροφοριών**

Αρχικά, πραγματοποιείται μια σάρωση για να προσδιοριστεί αν ένας SAP router λειτουργεί σε μια συγκεκριμένη IP χρησιμοποιώντας το **sap_service_discovery** module. Αυτό το βήμα είναι κρίσιμο για την καθ establishment της παρουσίας ενός SAP router και της ανοιχτής του θύρας.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Ακολουθώντας την ανακάλυψη, διεξάγεται περαιτέρω έρευνα στη διαμόρφωση του SAP router με το **sap_router_info_request** module για να αποκαλυφθούν πιθανώς λεπτομέρειες του εσωτερικού δικτύου.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Καταμέτρηση Εσωτερικών Υπηρεσιών**

Με τις αποκτηθείσες πληροφορίες από το εσωτερικό δίκτυο, το **sap_router_portscanner** module χρησιμοποιείται για να ερευνήσει εσωτερικούς υπολογιστές και υπηρεσίες μέσω του SAProuter, επιτρέποντας μια πιο βαθιά κατανόηση των εσωτερικών δικτύων και των ρυθμίσεων υπηρεσιών.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Η ευελιξία αυτού του module στοχεύει σε συγκεκριμένες περιπτώσεις SAP και θύρες, καθιστώντας το ένα αποτελεσματικό εργαλείο για λεπτομερή εξερεύνηση εσωτερικών δικτύων.

**Προχωρημένη Αρίθμηση και Χαρτογράφηση ACL**

Περαιτέρω σάρωση μπορεί να αποκαλύψει πώς είναι διαμορφωμένες οι Λίστες Ελέγχου Πρόσβασης (ACLs) στον SAProuter, λεπτομερώς ποιες συνδέσεις επιτρέπονται ή αποκλείονται. Αυτές οι πληροφορίες είναι καθοριστικές για την κατανόηση των πολιτικών ασφαλείας και των πιθανών ευπαθειών.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Τυφλή Αρίθμηση Εσωτερικών Φιλοξενουμένων**

Σε σενάρια όπου οι άμεσες πληροφορίες από το SAProuter είναι περιορισμένες, μπορούν να εφαρμοστούν τεχνικές όπως η τυφλή αρίθμηση. Αυτή η προσέγγιση προσπαθεί να μαντέψει και να επαληθεύσει την ύπαρξη εσωτερικών ονομάτων φιλοξενουμένων, αποκαλύπτοντας πιθανούς στόχους χωρίς άμεσες διευθύνσεις IP.

**Εκμετάλλευση Πληροφοριών για Δοκιμές Διείσδυσης**

Αφού χαρτογραφήσουν το δίκτυο και εντοπίσουν προσβάσιμες υπηρεσίες, οι δοκιμαστές διείσδυσης μπορούν να αξιοποιήσουν τις δυνατότητες proxy του Metasploit για να προχωρήσουν μέσω του SAProuter για περαιτέρω εξερεύνηση και εκμετάλλευση εσωτερικών υπηρεσιών SAP.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Συμπέρασμα**

Αυτή η προσέγγιση υπογραμμίζει τη σημασία των ασφαλών ρυθμίσεων SAProuter και επισημαίνει την πιθανότητα πρόσβασης σε εσωτερικά δίκτυα μέσω στοχευμένης pentesting. Η σωστή ασφάλιση των SAP routers και η κατανόηση του ρόλου τους στην αρχιτεκτονική ασφάλειας δικτύου είναι κρίσιμη για την προστασία από μη εξουσιοδοτημένη πρόσβαση.

Για περισσότερες λεπτομέρειες σχετικά με τα Metasploit modules και τη χρήση τους, επισκεφθείτε τη [βάση δεδομένων της Rapid7](http://www.rapid7.com/db).

## **Αναφορές**

- [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

- `port:3299 !HTTP Network packet too big`

{{#include ../banners/hacktricks-training.md}}
