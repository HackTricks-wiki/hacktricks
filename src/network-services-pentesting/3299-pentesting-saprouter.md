{{#include ../banners/hacktricks-training.md}}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Ovo je sažetak posta sa [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Razumevanje penetracije SAProuter-a sa Metasploit-om

SAProuter deluje kao obrnuti proxy za SAP sisteme, prvenstveno za kontrolu pristupa između interneta i internih SAP mreža. Obično je izložen internetu omogućavanjem TCP porta 3299 kroz organizacione vatrozidove. Ova postavka čini SAProuter privlačnom metom za pentesting jer može poslužiti kao ulazna tačka ka mrežama visoke vrednosti.

**Skener i prikupljanje informacija**

U početku se vrši skeniranje kako bi se utvrdilo da li SAP router radi na datoj IP adresi koristeći **sap_service_discovery** modul. Ovaj korak je ključan za utvrđivanje prisustva SAP router-a i njegovog otvorenog porta.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Nakon otkrića, sprovodi se dalja istraga konfiguracije SAP rutera pomoću **sap_router_info_request** modula kako bi se potencijalno otkrili detalji interne mreže.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Enumeracija Internih Usluga**

Sa dobijenim uvidima u internu mrežu, **sap_router_portscanner** modul se koristi za ispitivanje internih hostova i usluga kroz SAProuter, omogućavajući dublje razumevanje internih mreža i konfiguracija usluga.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Ova fleksibilnost modula u ciljanju specifičnih SAP instanci i portova čini ga efikasnim alatom za detaljno istraživanje interne mreže.

**Napredna enumeracija i mapiranje ACL-a**

Dalje skeniranje može otkriti kako su Access Control Lists (ACLs) konfigurisane na SAProuter-u, detaljno prikazujući koje su veze dozvoljene ili blokirane. Ove informacije su ključne za razumevanje bezbednosnih politika i potencijalnih ranjivosti.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Slepa Enumeracija Internih Hostova**

U scenarijima gde su direktne informacije iz SAProuter-a ograničene, tehnike poput slepe enumeracije mogu se primeniti. Ovaj pristup pokušava da pogodi i verifikuje postojanje internih imena hostova, otkrivajući potencijalne ciljeve bez direktnih IP adresa.

**Korišćenje Informacija za Pentesting**

Nakon što su mapirali mrežu i identifikovali dostupne usluge, pentesteri mogu iskoristiti Metasploit-ove proxy mogućnosti da se prebacuju kroz SAProuter za dalju eksploraciju i eksploataciju internih SAP usluga.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Zaključak**

Ovaj pristup naglašava važnost sigurnih SAProuter konfiguracija i ističe potencijal za pristup unutrašnjim mrežama kroz ciljani pentesting. Pravilno osiguranje SAP rutera i razumevanje njihove uloge u arhitekturi mrežne sigurnosti je ključno za zaštitu od neovlašćenog pristupa.

Za detaljnije informacije o Metasploit modulima i njihovoj upotrebi, posetite [Rapid7's database](http://www.rapid7.com/db).

## **Reference**

- [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

- `port:3299 !HTTP Network packet too big`

{{#include ../banners/hacktricks-training.md}}
