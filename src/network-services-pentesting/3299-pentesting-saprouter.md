{{#include ../banners/hacktricks-training.md}}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Це резюме посту з [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Розуміння проникнення в SAProuter за допомогою Metasploit

SAProuter діє як зворотний проксі для систем SAP, головним чином для контролю доступу між інтернетом та внутрішніми мережами SAP. Його зазвичай відкривають для інтернету, дозволяючи TCP порт 3299 через організаційні брандмауери. Ця конфігурація робить SAProuter привабливою мішенню для тестування на проникнення, оскільки він може слугувати шлюзом до внутрішніх мереж з високою цінністю.

**Сканування та збір інформації**

Спочатку виконується сканування, щоб визначити, чи працює SAP router на заданій IP-адресі, використовуючи модуль **sap_service_discovery**. Цей крок є вирішальним для встановлення наявності SAP router та його відкритого порту.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Після виявлення проводиться подальше розслідування конфігурації SAP маршрутизатора за допомогою модуля **sap_router_info_request**, щоб потенційно розкрити деталі внутрішньої мережі.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Перерахування внутрішніх сервісів**

З отриманими даними про внутрішню мережу, модуль **sap_router_portscanner** використовується для дослідження внутрішніх хостів і сервісів через SAProuter, що дозволяє глибше зрозуміти внутрішні мережі та конфігурації сервісів.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
Ця гнучкість модуля у націлюванні на конкретні екземпляри SAP та порти робить його ефективним інструментом для детального дослідження внутрішньої мережі.

**Розширена енумерація та картографування ACL**

Подальше сканування може виявити, як налаштовані списки контролю доступу (ACL) на SAProuter, детально описуючи, які з'єднання дозволені або заблоковані. Ця інформація є вирішальною для розуміння політик безпеки та потенційних вразливостей.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Сліпа енумерація внутрішніх хостів**

У сценаріях, де пряма інформація з SAProuter обмежена, можна застосувати техніки, такі як сліпа енумерація. Цей підхід намагається вгадати та перевірити існування внутрішніх імен хостів, виявляючи потенційні цілі без прямих IP-адрес.

**Використання інформації для пентестингу**

Маючи змодельовану мережу та ідентифіковані доступні сервіси, пентестери можуть використовувати можливості проксі Metasploit для переходу через SAProuter для подальшого дослідження та експлуатації внутрішніх SAP-сервісів.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Висновок**

Цей підхід підкреслює важливість безпечних конфігурацій SAProuter і висвітлює потенціал доступу до внутрішніх мереж через цілеспрямоване пенетрування. Правильне забезпечення SAP маршрутизаторів і розуміння їхньої ролі в архітектурі мережевої безпеки є критично важливими для захисту від несанкціонованого доступу.

Для отримання більш детальної інформації про модулі Metasploit та їх використання, відвідайте [базу даних Rapid7](http://www.rapid7.com/db).

## **Посилання**

- [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

- `port:3299 !HTTP Network packet too big`

{{#include ../banners/hacktricks-training.md}}
