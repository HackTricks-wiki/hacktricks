# 554,8554 - Pentesting RTSP

{{#include ../banners/hacktricks-training.md}}

## Informazioni di base

Da [wikipedia](https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol):

> Il **Real Time Streaming Protocol** (**RTSP**) è un protocollo di controllo di rete progettato per l'uso in sistemi di intrattenimento e comunicazione per controllare i server di streaming multimediale. Il protocollo viene utilizzato per stabilire e controllare sessioni multimediali tra i punti finali. I client dei server multimediali emettono comandi in stile VHS, come riproduci, registra e pausa, per facilitare il controllo in tempo reale dello streaming multimediale dal server a un client (Video On Demand) o da un client al server (Voice Recording).
>
> La trasmissione dei dati in streaming stessa non è un compito di RTSP. La maggior parte dei server RTSP utilizza il Real-time Transport Protocol (RTP) insieme al Real-time Control Protocol (RTCP) per la consegna del flusso multimediale. Tuttavia, alcuni fornitori implementano protocolli di trasporto proprietari. Il software del server RTSP di RealNetworks, ad esempio, utilizza anche il Real Data Transport (RDT) proprietario di RealNetworks.

**Porte predefinite:** 554,8554
```
PORT    STATE SERVICE
554/tcp open  rtsp
```
## Dettagli Chiave

**RTSP** è simile a HTTP ma progettato specificamente per lo streaming multimediale. È definito in una specifica semplice che può essere trovata qui:

[RTSP – RFC2326](https://tools.ietf.org/html/rfc2326)

I dispositivi potrebbero consentire accesso **non autenticato** o **autenticato**. Per verificare, viene inviato una richiesta "DESCRIBE". Un esempio di base è mostrato di seguito:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2`

Ricorda, il formato corretto include un doppio "\r\n" per una risposta coerente. Una risposta "200 OK" indica **accesso non autenticato**, mentre "401 Unauthorized" segnala la necessità di autenticazione, rivelando se è richiesta l'autenticazione **Basic** o **Digest**.

Per l'**autenticazione Basic**, codifichi il nome utente e la password in base64 e lo includi nella richiesta in questo modo:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==`

Questo esempio utilizza "admin" e "1234" per le credenziali. Ecco uno **script Python** per inviare una tale richiesta:
```python
import socket
req = "DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==\r\n\r\n"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.1.1", 554))
s.sendall(req)
data = s.recv(1024)
print(data)
```
**L'autenticazione di base** è più semplice e preferita. **L'autenticazione Digest** richiede una gestione attenta dei dettagli di autenticazione forniti nella risposta "401 Non autorizzato".

Questa panoramica semplifica il processo di accesso ai flussi RTSP, concentrandosi su **L'autenticazione di base** per la sua semplicità e praticità nei tentativi iniziali.

## Enumerazione

Otteniamo informazioni sui metodi validi e sugli URL supportati e proviamo a forzare l'accesso (se necessario) per accedere al contenuto.
```bash
nmap -sV --script "rtsp-*" -p <PORT> <IP>
```
#### Visualizzazione dello Stream RTSP con [ffplay](https://ffmpeg.org/ffplay.html)
Una volta scoperto un percorso RTSP valido (ad esempio, `/mpeg4`, `/live.sdp`) e confermato l'accesso (non autenticato o con credenziali), puoi utilizzare `ffplay` per trasmettere il feed:
```bash
ffplay -rtsp_transport tcp rtsp://<IP>/mpeg4 -x 2560 -y 1440
```
- `-rtsp_transport tcp`: Usa TCP invece di UDP per uno streaming più affidabile
- `-x`, `-y`: Flag opzionali per controllare la risoluzione video
- Sostituisci `<IP>` e il percorso come necessario

### [Brute Force](../generic-hacking/brute-force.md#rtsp)

### **Altri programmi utili**

Per bruteforce: [https://github.com/Tek-Security-Group/rtsp_authgrinder](https://github.com/Tek-Security-Group/rtsp_authgrinder)

[**Cameradar**](https://github.com/Ullaakut/cameradar)

- Rileva host RTSP aperti su qualsiasi obiettivo accessibile
- Ottieni le loro informazioni pubbliche (hostname, porta, modello della telecamera, ecc.)
- Avvia attacchi di dizionario automatizzati per ottenere il loro percorso di streaming (ad esempio /live.sdp)
- Avvia attacchi di dizionario automatizzati per ottenere il nome utente e la password delle telecamere
- Genera miniature da essi per controllare se gli streaming sono validi e avere un'anteprima rapida del loro contenuto
- Prova a creare una pipeline Gstreamer per controllare se sono correttamente codificati
- Stampa un riepilogo di tutte le informazioni che Cameradar potrebbe ottenere

## Riferimenti

- [https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol](https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol)
- [http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/](http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/)
- [https://github.com/Ullaakut/cameradar](https://github.com/Ullaakut/cameradar)

{{#include ../banners/hacktricks-training.md}}
