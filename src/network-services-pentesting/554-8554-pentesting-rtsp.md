# 554,8554 - Pentesting RTSP

{{#include ../banners/hacktricks-training.md}}

## Informações Básicas

De [wikipedia](https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol):

> O **Protocolo de Streaming em Tempo Real** (**RTSP**) é um protocolo de controle de rede projetado para uso em sistemas de entretenimento e comunicações para controlar servidores de mídia em streaming. O protocolo é usado para estabelecer e controlar sessões de mídia entre pontos finais. Clientes de servidores de mídia emitem comandos no estilo VHS, como reproduzir, gravar e pausar, para facilitar o controle em tempo real da mídia transmitida do servidor para um cliente (Vídeo Sob Demanda) ou de um cliente para o servidor (Gravação de Voz).
>
> A transmissão de dados de streaming em si não é uma tarefa do RTSP. A maioria dos servidores RTSP usa o Protocolo de Transporte em Tempo Real (RTP) em conjunto com o Protocolo de Controle em Tempo Real (RTCP) para entrega de fluxo de mídia. No entanto, alguns fornecedores implementam protocolos de transporte proprietários. O software do servidor RTSP da RealNetworks, por exemplo, também usou o Protocolo de Transporte de Dados Real (RDT) proprietário da RealNetworks.

**Portas padrão:** 554,8554
```
PORT    STATE SERVICE
554/tcp open  rtsp
```
## Detalhes Chave

**RTSP** é semelhante ao HTTP, mas projetado especificamente para streaming de mídia. Está definido em uma especificação simples que pode ser encontrada aqui:

[RTSP – RFC2326](https://tools.ietf.org/html/rfc2326)

Dispositivos podem permitir acesso **não autenticado** ou **autenticado**. Para verificar, uma solicitação "DESCRIBE" é enviada. Um exemplo básico é mostrado abaixo:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2`

Lembre-se, a formatação correta inclui um duplo "\r\n" para uma resposta consistente. Uma resposta "200 OK" indica **acesso não autenticado**, enquanto "401 Unauthorized" sinaliza a necessidade de autenticação, revelando se a autenticação **Basic** ou **Digest** é necessária.

Para **autenticação Basic**, você codifica o nome de usuário e a senha em base64 e inclui na solicitação assim:

`DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==`

Este exemplo usa "admin" e "1234" para as credenciais. Aqui está um **script Python** para enviar tal solicitação:
```python
import socket
req = "DESCRIBE rtsp://<ip>:<port> RTSP/1.0\r\nCSeq: 2\r\nAuthorization: Basic YWRtaW46MTIzNA==\r\n\r\n"
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.1.1", 554))
s.sendall(req)
data = s.recv(1024)
print(data)
```
**A autenticação básica** é mais simples e preferida. **A autenticação Digest** requer um manuseio cuidadoso dos detalhes de autenticação fornecidos na resposta "401 Unauthorized".

Esta visão geral simplifica o processo de acesso a streams RTSP, focando na **autenticação básica** por sua simplicidade e praticidade em tentativas iniciais.

## Enumeração

Vamos obter informações sobre os métodos válidos e URLs suportados e tentar forçar o acesso (se necessário) para obter acesso ao conteúdo.
```bash
nmap -sV --script "rtsp-*" -p <PORT> <IP>
```
#### Visualizando o Stream RTSP com [ffplay](https://ffmpeg.org/ffplay.html)
Uma vez que você tenha descoberto um caminho RTSP válido (por exemplo, `/mpeg4`, `/live.sdp`) e confirmado o acesso (não autenticado ou com credenciais), você pode usar `ffplay` para transmitir o feed:
```bash
ffplay -rtsp_transport tcp rtsp://<IP>/mpeg4 -x 2560 -y 1440
```
- `-rtsp_transport tcp`: Use TCP em vez de UDP para streaming mais confiável
- `-x`, `-y`: Flags opcionais para controlar a resolução do vídeo
- Substitua `<IP>` e o caminho conforme necessário

### [Força Bruta](../generic-hacking/brute-force.md#rtsp)

### **Outros programas úteis**

Para bruteforce: [https://github.com/Tek-Security-Group/rtsp_authgrinder](https://github.com/Tek-Security-Group/rtsp_authgrinder)

[**Cameradar**](https://github.com/Ullaakut/cameradar)

- Detectar hosts RTSP abertos em qualquer alvo acessível
- Obter suas informações públicas (nome do host, porta, modelo da câmera, etc.)
- Lançar ataques de dicionário automatizados para obter a rota de streaming (por exemplo /live.sdp)
- Lançar ataques de dicionário automatizados para obter o nome de usuário e a senha das câmeras
- Gerar miniaturas a partir delas para verificar se os streams são válidos e ter uma prévia rápida de seu conteúdo
- Tentar criar um pipeline Gstreamer para verificar se estão devidamente codificados
- Imprimir um resumo de todas as informações que o Cameradar conseguiu obter

## Referências

- [https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol](https://en.wikipedia.org/wiki/Real_Time_Streaming_Protocol)
- [http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/](http://badguyfu.net/rtsp-brute-forcing-for-fun-and-naked-pictures/)
- [https://github.com/Ullaakut/cameradar](https://github.com/Ullaakut/cameradar)

{{#include ../banners/hacktricks-training.md}}
