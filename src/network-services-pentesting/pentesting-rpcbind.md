# 111/TCP/UDP - Pentesting Portmapper

{{#include ../banners/hacktricks-training.md}}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Βασικές Πληροφορίες

**Portmapper** είναι μια υπηρεσία που χρησιμοποιείται για την αντιστοίχιση θυρών υπηρεσιών δικτύου σε **RPC** (Remote Procedure Call) αριθμούς προγράμματος. Λειτουργεί ως κρίσιμος παράγοντας σε **Unix-based systems**, διευκολύνοντας την ανταλλαγή πληροφοριών μεταξύ αυτών των συστημάτων. Η **θύρα** που σχετίζεται με το **Portmapper** σαρώνεται συχνά από επιτιθέμενους καθώς μπορεί να αποκαλύψει πολύτιμες πληροφορίες. Αυτές οι πληροφορίες περιλαμβάνουν τον τύπο του **Unix Operating System (OS)** που εκτελείται και λεπτομέρειες σχετικά με τις υπηρεσίες που είναι διαθέσιμες στο σύστημα. Επιπλέον, το **Portmapper** χρησιμοποιείται συνήθως σε συνδυασμό με **NFS (Network File System)**, **NIS (Network Information Service)** και άλλες **RPC-based services** για την αποτελεσματική διαχείριση υπηρεσιών δικτύου.

**Προεπιλεγμένη θύρα:** 111/TCP/UDP, 32771 στο Oracle Solaris
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## Καταμέτρηση
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
Μερικές φορές δεν σας δίνει καμία πληροφορία, σε άλλες περιπτώσεις θα λάβετε κάτι σαν αυτό:

![](<../images/image (553).png>)

### Shodan

- `port:111 portmap`

## RPCBind + NFS

Αν βρείτε την υπηρεσία NFS τότε πιθανότατα θα μπορέσετε να καταγράψετε και να κατεβάσετε (και ίσως να ανεβάσετε) αρχεία:

![](<../images/image (872).png>)

Διαβάστε[ 2049 - Pentesting NFS service](nfs-service-pentesting.md) για να μάθετε περισσότερα σχετικά με το πώς να δοκιμάσετε αυτό το πρωτόκολλο.

## NIS

Η εξερεύνηση των ευπαθειών **NIS** περιλαμβάνει μια διαδικασία δύο βημάτων, ξεκινώντας με την αναγνώριση της υπηρεσίας `ypbind`. Ο ακρογωνιαίος λίθος αυτής της εξερεύνησης είναι η αποκάλυψη του **ονόματος τομέα NIS**, χωρίς το οποίο η πρόοδος σταματά.

![](<../images/image (859).png>)

Το ταξίδι της εξερεύνησης ξεκινά με την εγκατάσταση των απαραίτητων πακέτων (`apt-get install nis`). Το επόμενο βήμα απαιτεί τη χρήση του `ypwhich` για να επιβεβαιωθεί η παρουσία του διακομιστή NIS, κάνοντάς του ping με το όνομα τομέα και τη διεύθυνση IP του διακομιστή, διασφαλίζοντας ότι αυτά τα στοιχεία είναι ανώνυμα για λόγους ασφαλείας.

Το τελικό και κρίσιμο βήμα περιλαμβάνει την εντολή `ypcat` για την εξαγωγή ευαίσθητων δεδομένων, ιδιαίτερα κωδικών πρόσβασης χρηστών που είναι κρυπτογραφημένοι. Αυτοί οι κατακερματισμοί, μόλις σπάσουν χρησιμοποιώντας εργαλεία όπως το **John the Ripper**, αποκαλύπτουν πληροφορίες σχετικά με την πρόσβαση στο σύστημα και τα προνόμια.
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```
### NIF αρχεία

| **Κύριο αρχείο**  | **Χάρτης(ες)**                  | **Σημειώσεις**                         |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | Περιέχει ονόματα υπολογιστών και λεπτομέρειες IP |
| /etc/passwd      | passwd.byname, passwd.byuid | Αρχείο κωδικών χρηστών NIS            |
| /etc/group       | group.byname, group.bygid   | Αρχείο ομάδας NIS                    |
| /usr/lib/aliases | mail.aliases                | Λεπτομέρειες ψευδωνύμων email              |

## RPC Χρήστες

Αν βρείτε την υπηρεσία **rusersd** καταχωρημένη έτσι:

![](<../images/image (1041).png>)

Μπορείτε να απαριθμήσετε τους χρήστες του συστήματος. Για να μάθετε πώς, διαβάστε [1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md).

## Παράκαμψη Φιλτραρισμένου Portmapper port

Όταν διεξάγετε μια **σάρωση nmap** και ανακαλύπτετε ανοιχτές θύρες NFS με την θύρα 111 να είναι φιλτραρισμένη, η άμεση εκμετάλλευση αυτών των θυρών δεν είναι εφικτή. Ωστόσο, με την **προσομοίωση μιας υπηρεσίας portmapper τοπικά και τη δημιουργία ενός τούνελ από τον υπολογιστή σας** προς τον στόχο, η εκμετάλλευση καθίσταται δυνατή χρησιμοποιώντας τυπικά εργαλεία. Αυτή η τεχνική επιτρέπει την παράκαμψη της φιλτραρισμένης κατάστασης της θύρας 111, επιτρέποντας έτσι την πρόσβαση στις υπηρεσίες NFS. Για λεπτομερείς οδηγίες σχετικά με αυτή τη μέθοδο, ανατρέξτε στο άρθρο που είναι διαθέσιμο [σε αυτόν τον σύνδεσμο](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc).

## Shodan

- `Portmap`

## Εργαστήρια για πρακτική

- Εξασκηθείτε σε αυτές τις τεχνικές στην [**Irked HTB μηχανή**](https://app.hackthebox.com/machines/Irked).

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## HackTricks Αυτόματες Εντολές
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
{{#include ../banners/hacktricks-training.md}}
