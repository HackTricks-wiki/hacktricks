# 111/TCP/UDP - Pentesting Portmapper

{{#include ../banners/hacktricks-training.md}}

## 基本情報

**Portmapper** は、ネットワークサービスポートを **RPC** (Remote Procedure Call) プログラム番号にマッピングするために利用されるサービスです。これは **Unixベースのシステム** において重要なコンポーネントとして機能し、これらのシステム間での情報交換を促進します。**Portmapper** に関連付けられた **ポート** は、攻撃者によって頻繁にスキャンされ、貴重な情報を明らかにする可能性があります。この情報には、実行中の **Unixオペレーティングシステム (OS)** の種類や、システム上で利用可能なサービスの詳細が含まれます。さらに、**Portmapper** は、ネットワークサービスを効果的に管理するために **NFS (Network File System)**、**NIS (Network Information Service)**、およびその他の **RPCベースのサービス** と共に一般的に使用されます。

**デフォルトポート:** 111/TCP/UDP, Oracle Solaris では 32771
```
PORT    STATE SERVICE
111/tcp open  rpcbind
```
## 列挙
```
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
時には何の情報も得られないことがありますが、他の場面では次のような情報が得られます：

![](<../images/image (553).png>)

### Shodan

- `port:111 portmap`

## RPCBind + NFS

サービスNFSが見つかれば、ファイルをリストし、ダウンロード（そして場合によってはアップロード）できる可能性があります：

![](<../images/image (872).png>)

このプロトコルのテスト方法について詳しくは[ 2049 - Pentesting NFS service](nfs-service-pentesting.md)をお読みください。

## NIS

**NIS**の脆弱性を探るには、`ypbind`サービスの特定から始まる二段階のプロセスが必要です。この探索の基盤は**NISドメイン名**を明らかにすることであり、これがなければ進展はありません。

![](<../images/image (859).png>)

探索の旅は、必要なパッケージのインストール（`apt-get install nis`）から始まります。次のステップでは、`ypwhich`を使用して、ドメイン名とサーバーIPでpingを送り、NISサーバーの存在を確認します。これらの要素はセキュリティのために匿名化される必要があります。

最後の重要なステップは、`ypcat`コマンドを使用して、特に暗号化されたユーザーパスワードなどの機密データを抽出することです。これらのハッシュは、**John the Ripper**のようなツールを使用して解読されると、システムアクセスや権限に関する洞察を明らかにします。
```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```
### NIFファイル

| **マスターファイル**  | **マップ**                  | **ノート**                         |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | ホスト名とIPの詳細を含む           |
| /etc/passwd      | passwd.byname, passwd.byuid | NISユーザーパスワードファイル      |
| /etc/group       | group.byname, group.bygid   | NISグループファイル                |
| /usr/lib/aliases | mail.aliases                | メールエイリアスの詳細            |

## RPCユーザー

**rusersd**サービスが次のようにリストされている場合：

![](<../images/image (1041).png>)

ボックスのユーザーを列挙することができます。方法を学ぶには[1026 - Pentesting Rsusersd](1026-pentesting-rusersd.md)を参照してください。

## フィルタリングされたポートマッパーポートのバイパス

**nmapスキャン**を実施し、ポート111がフィルタリングされているオープンNFSポートを発見した場合、これらのポートの直接的な悪用は実行可能ではありません。しかし、**ローカルでポートマッパーサービスをシミュレートし、あなたのマシンからターゲットへのトンネルを作成することにより**、標準ツールを使用して悪用が可能になります。この技術により、ポート111のフィルタリング状態をバイパスし、NFSサービスへのアクセスが可能になります。この方法に関する詳細なガイダンスは、[このリンク](https://medium.com/@sebnemK/how-to-bypass-filtered-portmapper-port-111-27cee52416bc)にある記事を参照してください。

## Shodan

- `Portmap`

## 実践用ラボ

- [**Irked HTBマシン**](https://app.hackthebox.com/machines/Irked)でこれらの技術を練習してください。

## HackTricks自動コマンド
```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for PortMapper
Note: |
Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-rpcbind.html

Entry_2:
Name: rpc info
Description: May give netstat-type info
Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
Name: nmap
Description: May give netstat-type info
Command: nmap -sSUC -p 111 {IP}
```
{{#include ../banners/hacktricks-training.md}}
